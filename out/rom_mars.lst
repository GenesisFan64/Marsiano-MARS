 AS V1.42 Beta [Bld 118] - source file mars.asm - page 1 - 3/25/2022 5:01:36


       1/       0 :                     ; ===========================================================================
       2/       0 :                     ; +-----------------------------------------------------------------+
       3/       0 :                     ; PROJECT MARSIANO
       4/       0 :                     ; +-----------------------------------------------------------------+
       5/       0 :                     
       6/       0 :                     		include	"system/macros.asm"	; Assembler macros
(1)    1/       0 :                     ; ===========================================================================
(1)    2/       0 :                     ; ----------------------------------------------------------------
(1)    3/       0 :                     ; MACROS
(1)    4/       0 :                     ; ----------------------------------------------------------------
(1)    5/       0 :                     
(1)    6/       0 :                     ; --------------------------------------------------------
(1)    7/       0 :                     ; AS Main settings
(1)    8/       0 :                     ; --------------------------------------------------------
(1)    9/       0 :                     
(1)   10/       0 :                     		!org 0				; Start at 0
(1)   11/       0 :                     		cpu 		68000		; Current CPU is 68k, gets changed later
(1)   12/       0 :                     		padding		off		; Dont pad dc.b
(1)   13/       0 :                     		listing 	purecode	; Want listing file, but only the final code in expanded macros
(1)   14/       0 :                     		supmode 	on 		; Supervisor mode
(1)   15/       0 :                     		dottedstructs	off		; If needed
(1)   16/       0 :                     		page 		0
(1)   17/       0 :                     
(1)   18/       0 :                     ; ====================================================================
(1)   19/       0 :                     ; ---------------------------------------------
(1)   20/       0 :                     ; Functions
(1)   21/       0 :                     ; ---------------------------------------------
(1)   22/       0 :                     
(1)   23/       0 :                     ; doubleword 	function l,r,(l<<16&$FFFF0000|r&$FFFF)			; LLLL RRRR
(1)   24/       0 :                     mapsize		function l,r,(((l-1)/8)<<16&$FFFF0000|((r-1)/8)&$FFFF)	; for cells w/h use doubleword
(1)   25/       0 :                     locate		function a,b,c,(c&$FF)|(b<<8&$FF00)|(a<<16&$FF0000)	; VDP locate: Layer|X pos|Y pos for some video routines
(1)   26/       0 :                     
(1)   27/       0 :                     ; ====================================================================
(1)   28/       0 :                     ; ---------------------------------------------
(1)   29/       0 :                     ; Macros
(1)   30/       0 :                     ; ---------------------------------------------
(1)   31/       0 :                     
(1)   32/       0 : =$0                 paddingSoFar set 0
(1)   33/       0 :                     notZ80 function cpu,(cpu<>128)&&(cpu<>32988)
(1)   34/       0 :                     
(1)   35/       0 :                     ; -------------------------------------
(1)   36/       0 :                     ; Reserve memory section
(1)   37/       0 :                     ;
(1)   38/       0 :                     ; NOTE: This doesn't work for Z80
(1)   39/       0 :                     ; -------------------------------------
(1)   40/       0 :                     
(1)   41/       0 :                     struct		macro thisinput			; Reserve memory address
(1)   42/       0 :                     GLBL_LASTPC	set *
(1)   43/       0 :                     		dephase
(1)   44/       0 :                     GLBL_LASTORG	set *
(1)   45/       0 :                     		phase thisinput
(1)   46/       0 :                     		endm
(1)   47/       0 :                     		
(1)   48/       0 :                     ; -------------------------------------
(1)   49/       0 :                     ; Finish
(1)   50/       0 :                     ; -------------------------------------
(1)   51/       0 :                     
(1)   52/       0 :                     finish		macro				; Then finish custom struct.
(1)   53/       0 :                     		!org GLBL_LASTORG
(1)   54/       0 :                     		phase GLBL_LASTPC
(1)   55/       0 :                     		endm
(1)   56/       0 :                     
(1)   57/       0 :                     ; -------------------------------------
(1)   58/       0 :                     ; Custom ORG
(1)   59/       0 :                     ;
(1)   60/       0 :                     ; (from s2disasm)
(1)   61/       0 :                     ; -------------------------------------
(1)   62/       0 :                     
(1)   63/       0 :                     org macro address
(1)   64/       0 :                     	if notZ80(MOMCPU)
(1)   65/       0 :                     		if address < *
(1)   66/       0 :                     			error "too much stuff before org $\{address} ($\{(*-address)} bytes)"
(1)   67/       0 :                     		elseif address > *
(1)   68/       0 :                     paddingSoFar	set paddingSoFar + address - *
(1)   69/       0 :                     			!org address
(1)   70/       0 :                     		endif
(1)   71/       0 :                     	else
(1)   72/       0 :                     		if address < $
(1)   73/       0 :                     			error "too much stuff before org 0\{address}h (0\{($-address)}h bytes)"
(1)   74/       0 :                     		else
(1)   75/       0 :                     			while address > $
(1)   76/       0 :                     				db 0
(1)   77/       0 :                     			endm
(1)   78/       0 :                     		endif
(1)   79/       0 :                     	endif
(1)   80/       0 :                         endm
(1)   81/       0 :                     
       7/       0 :                     		include	"system/md/map.asm"	; Genesis hardware map
(1)    1/       0 :                     ; ====================================================================
(1)    2/       0 :                     ; ----------------------------------------------------------------
(1)    3/       0 :                     ; Genesis / MegaDrive 68k map
(1)    4/       0 :                     ; ----------------------------------------------------------------
(1)    5/       0 :                     
(1)    6/       0 : =$200000            sys_exram	equ	$200000		; Second half of 4MB rom or external RAM (Normal or save data)
(1)    7/       0 : =$A00000            z80_cpu		equ	$A00000		; Z80 CPU area, size: $2000
(1)    8/       0 : =$A04000            ym_ctrl_1	equ	$A04000		; YM2612 reg 1
(1)    9/       0 : =$A04001            ym_data_1	equ	$A04001		; YM2612 reg 2
(1)   10/       0 : =$A04002            ym_ctrl_2	equ	$A04002		; YM2612 reg 1
(1)   11/       0 : =$A04003            ym_data_2	equ	$A04003		; YM2612 reg 2
(1)   12/       0 : =$A10001            sys_io		equ	$A10001		; bits: OVRSEAS(7)|PAL(6)|DISK(5)|VER(3-0)
(1)   13/       0 : =$A10003            sys_data_1	equ	$A10003		; Port 1 DATA
(1)   14/       0 : =$A10005            sys_data_2	equ	$A10005		; Port 2 DATA
(1)   15/       0 : =$A10007            sys_data_3	equ	$A10007		; Modem DATA
(1)   16/       0 : =$A10009            sys_ctrl_1	equ	$A10009		; Port 1 CTRL
(1)   17/       0 : =$A1000B            sys_ctrl_2	equ	$A1000B		; Port 2 CTRL
(1)   18/       0 : =$A1000D            sys_ctrl_3	equ	$A1000D		; Modem CTRL
(1)   19/       0 : =$A11100            z80_bus 	equ	$A11100		; only use bit 0 (bit 8 as WORD)
(1)   20/       0 : =$A11200            z80_reset	equ	$A11200		; WRITE only ($0000 reset/$0100 cancel)
(1)   21/       0 : =$A130F1            md_bank_sram	equ	$A130F1		; Make SRAM visible at $200000
(1)   22/       0 : =$A14000            sys_tmss	equ	$A14000		; write "SEGA" here for ver > 0
(1)   23/       0 : =$C00000            vdp_data	equ	$C00000		; video data port
(1)   24/       0 : =$C00004            vdp_ctrl	equ	$C00004		; video control port
(1)   25/       0 : =$C00011            psg_ctrl	equ	$C00011		; PSG control
(1)   26/       0 :                     
(1)   27/       0 :                     ; ----------------------------------------------------------------
(1)   28/       0 :                     ; Genesis / Mega drive Z80 map
(1)   29/       0 :                     ; ----------------------------------------------------------------
(1)   30/       0 :                     
(1)   31/       0 : =$4000              zym_ctrl_1	equ	$4000		; YM2612 reg 1
(1)   32/       0 : =$4001              zym_data_1	equ	$4001		; YM2612 reg 2
(1)   33/       0 : =$4002              zym_ctrl_2	equ	$4002		; YM2612 reg 1
(1)   34/       0 : =$4003              zym_data_2	equ	$4003		; YM2612 reg 2
(1)   35/       0 : =$6000              zbank		equ	$6000		; Z80 ROM BANK: %XXXXXXXX X0000000 00000000 (9-byte writes)
(1)   36/       0 :                     ; zvdp_data	equ	$7F00		; video data port
(1)   37/       0 :                     ; zvdp_ctrl	equ	$7F04		; video control port
(1)   38/       0 : =$7F11              zpsg_ctrl	equ	$7F11		; PSG control
(1)   39/       0 :                     
(1)   40/       0 :                     ; ----------------------------------------------------------------
(1)   41/       0 :                     ; 32X registers
(1)   42/       0 :                     ; ----------------------------------------------------------------
(1)   43/       0 :                     
(1)   44/       0 : =$A130EC            sysmars_id	equ	$A130EC		; 32X's ID: "MARS"
(1)   45/       0 : =$A15100            sysmars_reg	equ	$A15100		; MARS 32X registers section, see system/mars/map.asm for variables
(1)   46/       0 :                     
       8/       0 :                     		include	"system/md/const.asm"	; Genesis variables (and some shared with SH2)
(1)    1/       0 :                     ; ====================================================================
(1)    2/       0 :                     ; ----------------------------------------------------------------
(1)    3/       0 :                     ; MD/MARS shared constants
(1)    4/       0 :                     ; ----------------------------------------------------------------
(1)    5/       0 :                     
(1)    6/       0 : =$10                MAX_MDDMATSK	equ 16		; MAX DMA transfer requests for VBlank
(1)    7/       0 : =$10                MAX_MODELS	equ 16
(1)    8/       0 :                     
(1)    9/       0 :                     ; ====================================================================
(1)   10/       0 :                     ; --------------------------------------------------------
(1)   11/       0 :                     ; Settings
(1)   12/       0 :                     ; --------------------------------------------------------
(1)   13/       0 :                     
(1)   14/       0 : =$FFFF9000          MDRAM_START	equ $FFFF9000	; Start of working MD RAM
(1)   15/       0 : =$800               MAX_MDERAM	equ $800	; MAX RAM for current screen mode
(1)   16/       0 : =$7FF               varNullVram	equ $7FF	; Default Blank tile for some video routines
(1)   17/       0 :                     
(1)   18/       0 :                     ; ====================================================================
(1)   19/       0 :                     ; ----------------------------------------------------------------
(1)   20/       0 :                     ; Shared structs for both Genesis and 32X
(1)   21/       0 :                     ; ----------------------------------------------------------------
(1)   22/       0 :                     
(1)   23/       0 :                     ; model objects
(1)   24/       0 :                     ;
(1)   25/       0 : (MACRO)             		struct 0
(1)   25/       0 : =$0                 GLBL_LASTPC     set *
(1)   25/       0 :                                     dephase
(1)   25/       0 : =$0                 GLBL_LASTORG    set *
(1)   25/       0 :                                     phase 0
(1)   26/       0 :                     mdl_data	ds.l 1			; Model data pointer, if zero: no model
(1)   27/       4 :                     mdl_option	ds.l 1			; Model options: pixelvalue add
(1)   28/       8 :                     mdl_x_pos	ds.l 1			; X position $000000.00
(1)   29/       C :                     mdl_y_pos	ds.l 1			; Y position $000000.00
(1)   30/      10 :                     mdl_z_pos	ds.l 1			; Z position $000000.00
(1)   31/      14 :                     mdl_x_rot	ds.l 1			; X rotation $000000.00
(1)   32/      18 :                     mdl_y_rot	ds.l 1			; Y rotation $000000.00
(1)   33/      1C :                     mdl_z_rot	ds.l 1			; Z rotation $000000.00
(1)   34/      20 :                     ; mdl_animdata	ds.l 1			; Model animation data pointer, zero: no animation
(1)   35/      20 :                     ; mdl_animframe	ds.l 1			; Current frame in animation
(1)   36/      20 :                     ; mdl_animtimer	ds.l 1			; Animation timer
(1)   37/      20 :                     ; mdl_animspd	ds.l 1			; Animation USER speed setting
(1)   38/      20 :                     sizeof_mdlobj	ds.l 0
(1)   39/      20 : (MACRO)             		finish
(1)   39/       0 :                                     !org GLBL_LASTORG
(1)   39/       0 :                                     phase GLBL_LASTPC
(1)   40/       0 :                     
(1)   41/       0 :                     ; --------------------------------------------------------
(1)   42/       0 :                     ; Controller
(1)   43/       0 :                     ; --------------------------------------------------------
(1)   44/       0 :                     
(1)   45/       0 :                     ; Controller buffer data (after calling System_Input)
(1)   46/       0 :                     ;
(1)   47/       0 :                     ; Type/Revision byte:
(1)   48/       0 :                     ;
(1)   49/       0 :                     ; ID    |
(1)   50/       0 :                     ; $0D   | $00 - Original 3 button
(1)   51/       0 :                     ;       | $01 - 6 button version: XYZM
(1)   52/       0 :                     
(1)   53/       0 : (MACRO)             		struct 0
(1)   53/       0 : =$0                 GLBL_LASTPC     set *
(1)   53/       0 :                                     dephase
(1)   53/       0 : =$0                 GLBL_LASTORG    set *
(1)   53/       0 :                                     phase 0
(1)   54/       0 :                     pad_id		ds.b 1			; Controller ID
(1)   55/       1 :                     pad_ver		ds.b 1			; Controller type/revision
(1)   56/       2 :                     on_hold		ds.w 1			; User HOLD bits
(1)   57/       4 :                     on_press	ds.w 1			; User PRESSED bits
(1)   58/       6 :                     mouse_x		ds.w 1			; Mouse X add/sub
(1)   59/       8 :                     mouse_y		ds.w 1			; Mouse Y add/sub
(1)   60/       A :                     extr_3		ds.w 1
(1)   61/       C :                     extr_4		ds.w 1
(1)   62/       E :                     extr_5		ds.w 1
(1)   63/      10 :                     sizeof_input	ds.l 0
(1)   64/      10 : (MACRO)             		finish
(1)   64/       0 :                                     !org GLBL_LASTORG
(1)   64/       0 :                                     phase GLBL_LASTPC
(1)   65/       0 :                     
(1)   66/       0 :                     ; Read as (Controller_1) then add +on_hold or +on_press
(1)   67/       0 : =$FFFFFFFFFF..      Controller_1	equ RAM_InputData
(1)   68/       0 : =$FFFFFFFFFF..      Controller_2	equ RAM_InputData+sizeof_input
(1)   69/       0 :                     
(1)   70/       0 :                     ; Read WORD in +on_hold or +on_press
(1)   71/       0 : =$1                 JoyUp		equ $0001
(1)   72/       0 : =$2                 JoyDown		equ $0002
(1)   73/       0 : =$4                 JoyLeft		equ $0004
(1)   74/       0 : =$8                 JoyRight	equ $0008
(1)   75/       0 : =$10                JoyB		equ $0010
(1)   76/       0 : =$20                JoyC		equ $0020
(1)   77/       0 : =$40                JoyA		equ $0040
(1)   78/       0 : =$80                JoyStart	equ $0080
(1)   79/       0 : =$100               JoyZ		equ $0100
(1)   80/       0 : =$200               JoyY		equ $0200
(1)   81/       0 : =$400               JoyX		equ $0400
(1)   82/       0 : =$800               JoyMode		equ $0800
(1)   83/       0 : =$0                 bitJoyUp	equ 0		; READ THESE AS A WORD
(1)   84/       0 : =$1                 bitJoyDown	equ 1
(1)   85/       0 : =$2                 bitJoyLeft	equ 2
(1)   86/       0 : =$3                 bitJoyRight	equ 3
(1)   87/       0 : =$4                 bitJoyB		equ 4
(1)   88/       0 : =$5                 bitJoyC		equ 5
(1)   89/       0 : =$6                 bitJoyA		equ 6
(1)   90/       0 : =$7                 bitJoyStart	equ 7
(1)   91/       0 : =$8                 bitJoyZ		equ 8
(1)   92/       0 : =$9                 bitJoyY		equ 9
(1)   93/       0 : =$A                 bitJoyX		equ 10
(1)   94/       0 : =$B                 bitJoyMode	equ 11
(1)   95/       0 :                     
(1)   96/       0 :                     ; Mega Mouse
(1)   97/       0 :                     ; Read WORD in +on_hold or +on_press
(1)   98/       0 : =$1                 ClickR		equ $0001
(1)   99/       0 : =$2                 ClickL		equ $0002
(1)  100/       0 : =$4                 ClickM		equ $0004	; US MOUSE ONLY
(1)  101/       0 : =$8                 ClickS		equ $0008	; (Untested)
(1)  102/       0 : =$0                 bitClickR	equ 0
(1)  103/       0 : =$1                 bitClickL	equ 1
(1)  104/       0 : =$2                 bitClickM	equ 2
(1)  105/       0 : =$3                 bitClickS	equ 3
(1)  106/       0 :                     
(1)  107/       0 :                     ; ====================================================================
(1)  108/       0 :                     ; ----------------------------------------------------------------
(1)  109/       0 :                     ; System RAM
(1)  110/       0 :                     ; ----------------------------------------------------------------
(1)  111/       0 :                     
(1)  112/       0 : (MACRO)             		struct RAM_MdSystem
(1)  112/       0 : =$0                 GLBL_LASTPC     set *
(1)  112/       0 :                                     dephase
(1)  112/       0 : =$0                 GLBL_LASTORG    set *
(1)  112/FFFFFFFFFFFFA622 :                                     phase RAM_MDSYSTEM
(1)  113/FFFFFFFFFFFFA622 :                     RAM_InputData	ds.b sizeof_input*4		; Input data section
(1)  114/FFFFFFFFFFFFA662 :                     RAM_SaveData	ds.b $200			; SRAM data cache
(1)  115/FFFFFFFFFFFFA862 :                     RAM_DmaCode	ds.b $180
(1)  116/FFFFFFFFFFFFA9E2 :                     RAM_SysRandVal	ds.l 1				; Random value
(1)  117/FFFFFFFFFFFFA9E6 :                     RAM_SysRandSeed	ds.l 1				; Randomness seed
(1)  118/FFFFFFFFFFFFA9EA :                     RAM_initflug	ds.l 1				; "INIT" flag
(1)  119/FFFFFFFFFFFFA9EE :                     RAM_MdMarsVInt	ds.w 3				; VBlank jump (JMP xxxx xxxx)
(1)  120/FFFFFFFFFFFFA9F4 :                     RAM_MdMarsHint	ds.w 3				; HBlank jump (JMP xxxx xxxx)
(1)  121/FFFFFFFFFFFFA9FA :                     RAM_SysFlags	ds.w 1				; Game engine flags (note: it's a byte)
(1)  122/FFFFFFFFFFFFA9FC :                     sizeof_mdsys	ds.l 0
(1)  123/FFFFFFFFFFFFA9FE : (MACRO)             		finish
(1)  123/FFFFFFFFFFFFA622 :                                     !org GLBL_LASTORG
(1)  123/       0 :                                     phase GLBL_LASTPC
(1)  124/       0 :                     
(1)  125/       0 :                     ; ====================================================================
(1)  126/       0 :                     ; ----------------------------------------------------------------
(1)  127/       0 :                     ; Sound 68k RAM
(1)  128/       0 :                     ; ----------------------------------------------------------------
(1)  129/       0 :                     
(1)  130/       0 : (MACRO)             		struct RAM_MdSound
(1)  130/       0 : =$0                 GLBL_LASTPC     set *
(1)  130/       0 :                                     dephase
(1)  130/       0 : =$0                 GLBL_LASTORG    set *
(1)  130/FFFFFFFFFFFF9800 :                                     phase RAM_MDSOUND
(1)  131/FFFFFFFFFFFF9800 :                     RAM_SndSaveReg	ds.l 8			; Backup registers here instead of stack (TODO)
(1)  132/FFFFFFFFFFFF9820 :                     sizeof_mdsnd	ds.l 0
(1)  133/FFFFFFFFFFFF9820 : (MACRO)             		finish
(1)  133/FFFFFFFFFFFF9800 :                                     !org GLBL_LASTORG
(1)  133/       0 :                                     phase GLBL_LASTPC
(1)  134/       0 :                     		
(1)  135/       0 :                     ; ====================================================================
(1)  136/       0 :                     ; ----------------------------------------------------------------
(1)  137/       0 :                     ; Video RAM
(1)  138/       0 :                     ; ----------------------------------------------------------------
(1)  139/       0 :                     
(1)  140/       0 : (MACRO)             			struct RAM_MdVideo
(1)  140/       0 : =$0                 GLBL_LASTPC     set *
(1)  140/       0 :                                     dephase
(1)  140/       0 : =$0                 GLBL_LASTORG    set *
(1)  140/FFFFFFFFFFFF9820 :                                     phase RAM_MDVIDEO
(1)  141/FFFFFFFFFFFF9820 :                     RAM_HorScroll		ds.l 240		; DMA Horizontal scroll data
(1)  142/FFFFFFFFFFFF9BE0 :                     RAM_VerScroll		ds.l 320/16		; DMA Vertical scroll data (TODO: check if this is the correct size)
(1)  143/FFFFFFFFFFFF9C30 :                     RAM_Sprites		ds.w 8*70		; DMA Sprites
(1)  144/FFFFFFFFFFFFA090 :                     RAM_Palette		ds.w 64			; DMA palette
(1)  145/FFFFFFFFFFFFA110 :                     RAM_MdMarsPalFd		ds.w 256		; Target 32X palette for FadeIn/Out
(1)  146/FFFFFFFFFFFFA310 :                     RAM_PaletteFd		ds.w 64			; Target MD palette for FadeIn/Out
(1)  147/FFFFFFFFFFFFA390 :                     RAM_VdpDmaList		ds.w 7*MAX_MDDMATSK	; DMA BLAST Transfer list for VBlank
(1)  148/FFFFFFFFFFFFA470 :                     RAM_VidPrntList		ds.w 3*64		; Video_Print list: Address, Type
(1)  149/FFFFFFFFFFFFA5F0 :                     RAM_VdpDmaIndx		ds.w 1			; Current index in DMA BLAST list
(1)  150/FFFFFFFFFFFFA5F2 :                     RAM_VdpDmaMod		ds.w 1			; Mid-write flag (just to be safe)
(1)  151/FFFFFFFFFFFFA5F4 :                     RAM_VidPrntVram		ds.w 1			; Default VRAM location for ASCII text used by Video_Print
(1)  152/FFFFFFFFFFFFA5F6 :                     RAM_FadeMdReq		ds.w 1			; FadeIn/Out request for Genesis palette (01-FadeIn 02-FadeOut)
(1)  153/FFFFFFFFFFFFA5F8 :                     RAM_FadeMdIncr		ds.w 1			; Fading increment count
(1)  154/FFFFFFFFFFFFA5FA :                     RAM_FadeMdDelay		ds.w 1			; Fading delay
(1)  155/FFFFFFFFFFFFA5FC :                     RAM_FadeMdTmr		ds.w 1			; Fading delay timer (Write to both FadeMdDel and here)
(1)  156/FFFFFFFFFFFFA5FE :                     RAM_FadeMarsReq		ds.w 1			; Same thing but for 32X's 256-color (01-FadeIn 02-FadeOut)
(1)  157/FFFFFFFFFFFFA600 :                     RAM_FadeMarsIncr	ds.w 1			; (Hint: Set to 4 to syncronize Genesis FadeIn/Out)
(1)  158/FFFFFFFFFFFFA602 :                     RAM_FadeMarsDelay	ds.w 1
(1)  159/FFFFFFFFFFFFA604 :                     RAM_FadeMarsTmr		ds.w 1
(1)  160/FFFFFFFFFFFFA606 :                     RAM_FrameCount		ds.l 1			; Frames counter
(1)  161/FFFFFFFFFFFFA60A :                     RAM_VdpRegs		ds.b 24			; VDP Register cache
(1)  162/FFFFFFFFFFFFA622 :                     sizeof_mdvid		ds.l 0
(1)  163/FFFFFFFFFFFFA624 : (MACRO)             			finish
(1)  163/FFFFFFFFFFFF9820 :                                     !org GLBL_LASTORG
(1)  163/       0 :                                     phase GLBL_LASTPC
(1)  164/       0 :                     
(1)  165/       0 :                     ; ; ====================================================================
(1)  166/       0 :                     ; ; ----------------------------------------------------------------
(1)  167/       0 :                     ; ; 32X control using DREQ
(1)  168/       0 :                     ; ;
(1)  169/       0 :                     ; ; *** CALL System_MdMarsDreq AFTER DOING ANY CHANGE
(1)  170/       0 :                     ; ; IN THIS AREA, OUTSIDE VBLANK ***
(1)  171/       0 :                     ; ;
(1)  172/       0 :                     ; ; Size for this buffer is set externally on
(1)  173/       0 :                     ; ; the MAX_MDDREQ setting.
(1)  174/       0 :                     ; ; ----------------------------------------------------------------
(1)  175/       0 :                     ;
(1)  176/       0 :                     ; 		struct RAM_MdDreq
(1)  177/       0 :                     ; RAM_MdMarsPal	ds.w 256
(1)  178/       0 :                     ; RAM_MdMarsBg	ds.l $10
(1)  179/       0 :                     ; sizeof_dreqmd	ds.l 0
(1)  180/       0 :                     ; 		finish
(1)  181/       0 :                     ; 	if MOMPASS=7
(1)  182/       0 :                     ; 		message "DREQ RAM: \{(sizeof_dreqmd-RAM_MdDreq)&$FFFFFF} of \{(MAX_MDDREQ)&$FFFFFF}"
(1)  183/       0 :                     ; 	endif
(1)  184/       0 :                     
(1)  185/       0 :                     ; ====================================================================
(1)  186/       0 :                     ; ----------------------------------------------------------------
(1)  187/       0 :                     ; MD RAM
(1)  188/       0 :                     ;
(1)  189/       0 :                     ; NOTE for porting this to Sega CD (or SegaCD+32X):
(1)  190/       0 :                     ; $FFFD00 to $FFFDFF is reserved for the MAIN-CPU's vectors
(1)  191/       0 :                     ; ----------------------------------------------------------------
(1)  192/       0 :                     
(1)  193/       0 : (MACRO)             		struct MDRAM_START
(1)  193/       0 : =$0                 GLBL_LASTPC     set *
(1)  193/       0 :                                     dephase
(1)  193/       0 : =$0                 GLBL_LASTORG    set *
(1)  193/FFFFFFFFFFFF9000 :                                     phase MDRAM_START
(1)  203/FFFFFFFFFFFF9000 :                     RAM_ModeBuff	ds.b MAX_MDERAM			; Second pass: sizes are set
(1)  204/FFFFFFFFFFFF9800 :                     RAM_MdSound	ds.b sizeof_mdsnd-RAM_MdSound
(1)  205/FFFFFFFFFFFF9820 :                     RAM_MdVideo	ds.b sizeof_mdvid-RAM_MdVideo
(1)  206/FFFFFFFFFFFFA622 :                     RAM_MdSystem	ds.b sizeof_mdsys-RAM_MdSystem
(1)  207/FFFFFFFFFFFFA9FC :                     RAM_MdGlobal	ds.b sizeof_mdglbl-RAM_MdGlobal
(1)  208/FFFFFFFFFFFFAA00 :                     RAM_MdDreq	ds.b sizeof_dreq
(1)  209/FFFFFFFFFFFFAE30 :                     sizeof_mdram	ds.l 0
(1)  211/FFFFFFFFFFFFAE30 :                     
MD RAM: FF9000-FFAE30
(1)  213/FFFFFFFFFFFFAE30 :                     		message "MD RAM: \{(MDRAM_START)&$FFFFFF}-\{(sizeof_mdram)&$FFFFFF}"
(1)  215/FFFFFFFFFFFFAE30 : (MACRO)             		finish
(1)  215/FFFFFFFFFFFF9000 :                                     !org GLBL_LASTORG
(1)  215/       0 :                                     phase GLBL_LASTPC
(1)  216/       0 :                     
       9/       0 :                     		include	"system/mars/map.asm"	; 32X hardware map
(1)    1/       0 :                     ; ====================================================================
(1)    2/       0 :                     ; ----------------------------------------------------------------
(1)    3/       0 :                     ; SH2 MAP
(1)    4/       0 :                     ; ----------------------------------------------------------------
(1)    5/       0 :                     
(1)    6/       0 :                     ; --------------------------------------------------------
(1)    7/       0 :                     ; SH2 SIDE MAP
(1)    8/       0 :                     ; --------------------------------------------------------
(1)    9/       0 :                     
(1)   10/       0 : =$0                 CS0		equ	$00000000	; Boot rom & system registers
(1)   11/       0 : =$2000000           CS1		equ	$02000000	; ROM data (all 4MB), Locked if RV=1
(1)   12/       0 : =$4000000           CS2		equ	$04000000	; Framebuffer section
(1)   13/       0 : =$6000000           CS3		equ	$06000000	; SDRAM
(1)   14/       0 : =$20000000          TH		equ	$20000000	; Cache-thru OR|value
(1)   15/       0 : =$20004000          _sysreg		equ	$00004000|TH	; MARS System registers (MD: sysmars_reg)
(1)   16/       0 : =$20004100          _vdpreg		equ	$00004100|TH	; SuperVDP registers
(1)   17/       0 : =$20004200          _palette	equ	$00004200|TH	; Palette RAM for Pixel-Packed or RLE mode
(1)   18/       0 : =$4000000           _framebuffer:	equ	CS2		; Framebuffer, first 240 are the linetable
(1)   19/       0 : =$4020000           _overwrite:	equ	CS2+$20000	; Overwrite, $00-byte writes are ignored
(1)   20/       0 :                     
(1)   21/       0 :                     ; OLD, stable:
(1)   22/       0 :                     ; CS0		equ	$00000000	; Boot rom & system registers
(1)   23/       0 :                     ; CS1		equ	$02000000	; ROM data (all 4MB), Locked if RV=1
(1)   24/       0 :                     ; CS2		equ	$04000000	; Framebuffer section
(1)   25/       0 :                     ; CS3		equ	$06000000	; SDRAM
(1)   26/       0 :                     ; TH		equ	$20000000	; Cache-thru OR|value
(1)   27/       0 :                     ; _sysreg		equ	$00004000|TH	; MARS System registers (MD: sysmars_reg)
(1)   28/       0 :                     ; _vdpreg		equ	$00004100|TH	; SuperVDP registers
(1)   29/       0 :                     ; _palette	equ	$00004200|TH	; Palette RAM for Pixel-Packed or RLE mode
(1)   30/       0 :                     ; _framebuffer:	equ	CS2|TH		; Framebuffer, first 240 are the linetable
(1)   31/       0 :                     ; _overwrite:	equ	CS2|TH+$20000	; Overwrite, $00-byte writes are ignored
(1)   32/       0 :                     
(1)   33/       0 :                     ; --------------------------------------------------------
(1)   34/       0 :                     ; Variables
(1)   35/       0 :                     ; --------------------------------------------------------
(1)   36/       0 :                     
(1)   37/       0 :                     ; ------------------------------------------------
(1)   38/       0 :                     ; System
(1)   39/       0 :                     ; ------------------------------------------------
(1)   40/       0 :                     
(1)   41/       0 :                     ; _sysreg
(1)   42/       0 : =$0                 adapter		equ	$00		; adapter control register (Read as WORD)
(1)   43/       0 : =$1                 intmask		equ	$01		; SH2 CPU ONLY: interrupts mask
(1)   44/       0 : =$3                 standby		equ	$03		; CMD interrupt request bit by MD side (slave|master) (BYTE)
(1)   45/       0 : =$5                 hcount		equ	$05		; H Counter (BYTE)
(1)   46/       0 : =$6                 dreqctl		equ	$06		; DREQ control (WORD)
(1)   47/       0 : =$8                 dreqsource	equ	$08		; DREQ source address
(1)   48/       0 : =$C                 dreqdest	equ	$0C		; DREQ destination address
(1)   49/       0 : =$10                dreqlen		equ	$10		; DREQ length
(1)   50/       0 : =$12                dreqfifo	equ	$12		; DREQ FIFO
(1)   51/       0 : =$14                vresintclr	equ	$14		; VRES interrupt clear
(1)   52/       0 : =$16                vintclr		equ	$16		; V interrupt clear
(1)   53/       0 : =$18                hintclr		equ	$18		; H interrupt clear
(1)   54/       0 : =$1A                cmdintclr	equ	$1a		; CMD interrupt clear
(1)   55/       0 : =$1C                pwmintclr	equ	$1C		; PWM interrupt clear
(1)   56/       0 : =$20                comm0		equ	$20		; Communication ports ***
(1)   57/       0 : =$21                comm1		equ	$21		; ALL CPUs can see this ports: including Z80
(1)   58/       0 : =$22                comm2		equ	$22		; only be careful with the read/write directions.
(1)   59/       0 : =$23                comm3		equ	$23		; ODD addresses (1,3,5...) are BYTE-read only.
(1)   60/       0 : =$24                comm4		equ	$24		; EVEN addresses (0,2,4...) can be read as WORDs
(1)   61/       0 : =$25                comm5		equ	$25		; Writing LONG addreses are possible depending
(1)   62/       0 : =$26                comm6		equ	$26		; of the CPU's aligment limitations.
(1)   63/       0 : =$27                comm7		equ	$27		;
(1)   64/       0 : =$28                comm8		equ	$28		;
(1)   65/       0 : =$29                comm9		equ	$29		;
(1)   66/       0 : =$2A                comm10		equ	$2A		;
(1)   67/       0 : =$2B                comm11		equ	$2B		;
(1)   68/       0 : =$2C                comm12		equ	$2C		;
(1)   69/       0 : =$2D                comm13		equ	$2D		;
(1)   70/       0 : =$2E                comm14		equ	$2E		;
(1)   71/       0 : =$2F                comm15		equ	$2F		;
(1)   72/       0 : =$30                timerctl	equ	$30		; PWM Timer Control
(1)   73/       0 : =$31                pwmctl		equ	$31		; PWM Control
(1)   74/       0 : =$32                cycle		equ	$32		; PWM Cycle
(1)   75/       0 : =$34                lchwidth	equ	$34		; PWM L ch Width
(1)   76/       0 : =$36                rchwidth	equ	$36		; PWM R ch Width
(1)   77/       0 : =$38                monowidth	equ	$38		; PWM Monaural Width
(1)   78/       0 :                     
(1)   79/       0 :                     ; _sysreg
(1)   80/       0 :                     ; adapter
(1)   81/       0 : =$1                 CART		equ	%00000001	; CD or Cartridge
(1)   82/       0 : =$2                 ADEN		equ	%00000010	; MARS Enabled: No/Yes
(1)   83/       0 : =$80                FM		equ	%10000000	; SuperVDP permission: MD or SH
(1)   84/       0 :                     ; framectl
(1)   85/       0 : =$1                 FS		equ	%00000001	; Current framebuffer DRAM pixel data
(1)   86/       0 : =$2                 FEN		equ	%00000010	; Can write to Framebuffer: Yes/No
(1)   87/       0 :                     ; vdpsts
(1)   88/       0 : =$80                VBLK		equ	%10000000	; VBlank bit
(1)   89/       0 : =$40                HBLK		equ	%01000000	; HBlank bit
(1)   90/       0 : =$20                PEN		equ	%00100000	; Can write to Palette: Yes/No
(1)   91/       0 :                     ; intmask
(1)   92/       0 : =$8                 VIRQ_ON		equ	$08		; IRQ masks for IRQ mask register
(1)   93/       0 : =$4                 HIRQ_ON		equ	$04
(1)   94/       0 : =$2                 CMDIRQ_ON	equ	$02
(1)   95/       0 : =$1                 PWMIRQ_ON	equ	$01
(1)   96/       0 :                     
(1)   97/       0 :                     ; _vdpreg
(1)   98/       0 : =$0                 tvmode		equ	$00		; TV mode register
(1)   99/       0 : =$1                 bitmapmd	equ	$01		; Bitmap mode register
(1)  100/       0 : =$2                 shift		equ	$02		; Shift Control register
(1)  101/       0 : =$4                 filllength	equ	$04		; Auto Fill Length register
(1)  102/       0 : =$6                 fillstart	equ	$06		; Auto Fill Start Address register
(1)  103/       0 : =$8                 filldata	equ	$08		; Auto Fill Data register
(1)  104/       0 : =$A                 vdpsts		equ	$0A		; VDP Status register
(1)  105/       0 : =$B                 framectl	equ	$0B		; Frame Buffer Control register
(1)  106/       0 :                     
(1)  107/       0 :                     ; --------------------------------------------------------
(1)  108/       0 :                     ; SH2 Internal registers, independent for each CPU
(1)  109/       0 :                     ; --------------------------------------------------------
(1)  110/       0 :                     
(1)  111/       0 :                     ; DMA Channel 0: General data transfer
(1)  112/       0 :                     ; DMA Channel 1: PWM exclusive
(1)  113/       0 : =$FFFFFE00          _SERIAL		equ	$FFFFFE00	; Serial Control
(1)  114/       0 : =$FFFFFE10          _FRT		equ	$FFFFFE10	; Free run timer
(1)  115/       0 : =$0                 _TIER		equ	$00		; Timer interrupt enable register
(1)  116/       0 : =$1                 _TCSR		equ	$01		; Timer control & status register
(1)  117/       0 : =$2                 _FRC_H		equ	$02		; free running counter High
(1)  118/       0 : =$3                 _FRC_L		equ	$03		; free running counter Low
(1)  119/       0 : =$4                 _OCR_H		equ	$04		; Output compare register High
(1)  120/       0 : =$5                 _OCR_L		equ	$05		; Output compare register Low
(1)  121/       0 : =$6                 _TCR		equ	$06		; Timer control register
(1)  122/       0 : =$7                 _TOCR		equ	$07		; timer output compare control register
(1)  123/       0 : =$FFFFFE92          _CCR:		equ	$FFFFFE92
(1)  124/       0 : =$FFFFFF00          _JR		equ	$FFFFFF00	; DIVU (--- / val)
(1)  125/       0 : =$FFFFFF04          _HRL32		equ	$FFFFFF04	; DIVU (val / ---) or LOW Result if read
(1)  126/       0 : =$FFFFFF10          _HRH		equ	$FFFFFF10	; DIVU Result, HIGH
(1)  127/       0 : =$FFFFFF14          _HRL		equ	$FFFFFF14	; DIVU Result, LOW
(1)  128/       0 : =$FFFFFF80          _DMASOURCE0	equ	$FFFFFF80	; DMA source address 0
(1)  129/       0 : =$FFFFFF84          _DMADEST0	equ	$FFFFFF84	; DMA destination address 0
(1)  130/       0 : =$FFFFFF88          _DMACOUNT0	equ	$FFFFFF88	; DMA transfer count 0
(1)  131/       0 : =$FFFFFF8C          _DMACHANNEL0	equ	$FFFFFF8C	; DMA channel control 0
(1)  132/       0 : =$FFFFFF90          _DMASOURCE1	equ	$FFFFFF90	; DMA source address 1
(1)  133/       0 : =$FFFFFF94          _DMADEST1	equ	$FFFFFF94	; DMA destination address 1
(1)  134/       0 : =$FFFFFF98          _DMACOUNT1	equ	$FFFFFF98	; DMA transfer count 1
(1)  135/       0 : =$FFFFFF9C          _DMACHANNEL1	equ	$FFFFFF9C	; DMA channel control 1
(1)  136/       0 : =$FFFFFFA0          _DMAVECTORN0	equ	$FFFFFFA0	; DMA vector number N0
(1)  137/       0 : =$FFFFFFA4          _DMAVECTORE0	equ	$FFFFFFA4	; DMA vector number E0
(1)  138/       0 : =$FFFFFFA8          _DMAVECTORN1	equ	$FFFFFFA8	; DMA vector number N1
(1)  139/       0 : =$FFFFFFAC          _DMAVECTORE1	equ	$FFFFFFAC	; DMA vector number E1
(1)  140/       0 : =$FFFFFFB0          _DMAOPERATION	equ	$FFFFFFB0	; DMA operation
(1)  141/       0 : =$FFFFFFB4          _DMAREQACK0	equ	$FFFFFFB4	; DMA request/ack select control 0
(1)  142/       0 : =$FFFFFFB8          _DMAREQACK1	equ	$FFFFFFB8	; DMA request/ack select control 1
(1)  143/       0 :                     
      10/       0 :                     		include	"system/mars/dreq.asm"	; DREQ map for both sides
(1)    1/       0 :                     ; ====================================================================
(1)    2/       0 :                     ; ----------------------------------------------------------------
(1)    3/       0 :                     ; DREQ RAM control
(1)    4/       0 :                     ;
(1)    5/       0 :                     ; To read these labels...
(1)    6/       0 :                     ;
(1)    7/       0 :                     ; On the Genesis Side:
(1)    8/       0 :                     ; 	lea	(RAM_MdDreq+DREQ_LABEL),a0
(1)    9/       0 :                     ;
(1)   10/       0 :                     ; On the 32X Side:
(1)   11/       0 :                     ; 	mov	#RAM_Mars_DreqRead+DREQ_LABEL,r1
(1)   12/       0 :                     ; ----------------------------------------------------------------
(1)   13/       0 :                     
(1)   14/       0 :                     ; MUST be aligned by 8bytes (Size must end with 0 or 8)
(1)   15/       0 :                     
(1)   16/       0 : (MACRO)             		struct 0
(1)   16/       0 : =$0                 GLBL_LASTPC     set *
(1)   16/       0 :                                     dephase
(1)   16/       0 : =$0                 GLBL_LASTORG    set *
(1)   16/       0 :                                     phase 0
(1)   17/       0 :                     				; Screen Mode 02:
(1)   18/       0 :                     Dreq_BgEx_X	ds.l 1		; X pos 0000.0000
(1)   19/       4 :                     Dreq_BgEx_Y	ds.l 1		; Y pos 0000.0000
(1)   20/       8 :                     Dreq_BgEx_Data	ds.l 1		; Source data (ON SH2's MAP)
(1)   21/       C :                     Dreq_BgEx_W	ds.l 1		; Width
(1)   22/      10 :                     Dreq_BgEx_H	ds.l 1		; Height
(1)   23/      14 :                     
(1)   24/      14 :                     				; Screen mode 03:
(1)   25/      14 :                     Dreq_SclData	ds.l 1		; Source data (ON SH2's MAP)
(1)   26/      18 :                     Dreq_SclX	ds.l 1		; X pos 0000.0000
(1)   27/      1C :                     Dreq_SclY	ds.l 1		; Y pos 0000.0000
(1)   28/      20 :                     Dreq_SclDX	ds.l 1		; DX 0000.0000
(1)   29/      24 :                     Dreq_SclDY	ds.l 1		; DY 0000.0000
(1)   30/      28 :                     Dreq_SclWidth	ds.l 1		; Width
(1)   31/      2C :                     Dreq_SclHeight	ds.l 1		; Height
(1)   32/      30 :                     
(1)   33/      30 :                     Dreq_Palette	ds.w 256
(1)   34/     230 :                     Dreq_Objects	ds.b sizeof_mdlobj*MAX_MODELS	; <-- labels from SH2 side
(1)   35/     430 :                     
(1)   36/     430 :                     sizeof_dreq	ds.l 0
(1)   37/     430 : (MACRO)             		finish
(1)   37/       0 :                                     !org GLBL_LASTORG
(1)   37/       0 :                                     phase GLBL_LASTPC
(1)   38/       0 :                     
(1)   39/       0 :                     ; MAX_DREQ		equ sizeof_dreq
(1)   40/       0 :                     
DREQ RAM uses: 430
(1)   42/       0 :                     		message "DREQ RAM uses: \{sizeof_dreq}"
(1)   44/       0 :                     
      11/       0 :                     		include "code/global.asm"	; Global user variables on the Genesis
(1)    1/       0 :                     ; ====================================================================
(1)    2/       0 :                     ; ----------------------------------------------------------------
(1)    3/       0 :                     ; Global RAM variables on the Genesis side
(1)    4/       0 :                     ; (Score, Level, etc.)
(1)    5/       0 :                     ; ----------------------------------------------------------------
(1)    6/       0 :                     
(1)    7/       0 : (MACRO)             		struct RAM_MdGlobal
(1)    7/       0 : =$0                 GLBL_LASTPC     set *
(1)    7/       0 :                                     dephase
(1)    7/       0 : =$0                 GLBL_LASTORG    set *
(1)    7/FFFFFFFFFFFFA9FC :                                     phase RAM_MDGLOBAL
(1)    8/FFFFFFFFFFFFA9FC :                     RAM_MdGlbl_Null	ds.l 1
(1)    9/FFFFFFFFFFFFAA00 :                     sizeof_mdglbl	ds.l 0
(1)   10/FFFFFFFFFFFFAA00 : (MACRO)             		finish
(1)   10/FFFFFFFFFFFFA9FC :                                     !org GLBL_LASTORG
(1)   10/       0 :                                     phase GLBL_LASTPC
(1)   11/       0 :                     
(1)   12/       0 :                     
      12/       0 :                     		include	"system/head.asm"	; 32X header
(1)    1/       0 :                     ; ====================================================================
(1)    2/       0 :                     ; ----------------------------------------------------------------
(1)    3/       0 :                     ; ROM HEADER FOR 32X
(1)    4/       0 :                     ;
(1)    5/       0 :                     ; These labels still work even if the 32X isn't present
(1)    6/       0 :                     ; ----------------------------------------------------------------
(1)    7/       0 :                     
(1)    8/       0 : 0000 0000           		dc.l 0				; Stack point
(1)    9/       4 : 0000 03F0           		dc.l $3F0			; Entry point (always $3F0)
(1)   10/       8 : 0000 089A           		dc.l MD_ErrBus			; Bus error
(1)   11/       C : 0000 089A           		dc.l MD_ErrAddr			; Address error
(1)   12/      10 : 0000 089A           		dc.l MD_ErrIll			; ILLEGAL Instruction
(1)   13/      14 : 0000 089A           		dc.l MD_ErrZDiv			; Divide by 0
(1)   14/      18 : 0000 089A           		dc.l MD_ErrChk			; CHK Instruction
(1)   15/      1C : 0000 089A           		dc.l MD_ErrTrapV		; TRAPV Instruction
(1)   16/      20 : 0000 089A           		dc.l MD_ErrPrivl		; Privilege violation
(1)   17/      24 : 0000 089A           		dc.l MD_Trace			; Trace
(1)   18/      28 : 0000 089A           		dc.l MD_Line1010		; Line 1010 Emulator
(1)   19/      2C : 0000 089A           		dc.l MD_Line1111		; Line 1111 Emulator
(1)   20/      30 : 0000 089A           		dc.l MD_ErrorEx			; Error exception
(1)   21/      34 : 0000 089A           		dc.l MD_ErrorEx
(1)   22/      38 : 0000 089A           		dc.l MD_ErrorEx
(1)   23/      3C : 0000 089A           		dc.l MD_ErrorEx
(1)   24/      40 : 0000 089A           		dc.l MD_ErrorEx
(1)   25/      44 : 0000 089A           		dc.l MD_ErrorEx
(1)   26/      48 : 0000 089A           		dc.l MD_ErrorEx
(1)   27/      4C : 0000 089A           		dc.l MD_ErrorEx
(1)   28/      50 : 0000 089A           		dc.l MD_ErrorEx
(1)   29/      54 : 0000 089A           		dc.l MD_ErrorEx
(1)   30/      58 : 0000 089A           		dc.l MD_ErrorEx
(1)   31/      5C : 0000 089A           		dc.l MD_ErrorEx
(1)   32/      60 : 0000 089A           		dc.l MD_ErrorEx
(1)   33/      64 : 0000 089A           		dc.l MD_ErrorTrap
(1)   34/      68 : 0000 089A           		dc.l MD_ErrorTrap
(1)   35/      6C : 0000 089A           		dc.l MD_ErrorTrap
(1)   36/      70 : FFFF A9F4           		dc.l RAM_MdMarsHInt		; RAM jump for HBlank (JMP xxxx xxxx)
(1)   37/      74 : 0000 089A           		dc.l MD_ErrorTrap
(1)   38/      78 : FFFF A9EE           		dc.l RAM_MdMarsVInt		; RAM jump for VBlank (JMP xxxx xxxx)
(1)   39/      7C : 0000 089A           		dc.l MD_ErrorTrap
(1)   40/      80 : 0000 089A           		dc.l MD_ErrorTrap
(1)   41/      84 : 0000 089A           		dc.l MD_ErrorTrap
(1)   42/      88 : 0000 089A           		dc.l MD_ErrorTrap
(1)   43/      8C : 0000 089A           		dc.l MD_ErrorTrap
(1)   44/      90 : 0000 089A           		dc.l MD_ErrorTrap
(1)   45/      94 : 0000 089A           		dc.l MD_ErrorTrap
(1)   46/      98 : 0000 089A           		dc.l MD_ErrorTrap
(1)   47/      9C : 0000 089A           		dc.l MD_ErrorTrap
(1)   48/      A0 : 0000 089A           		dc.l MD_ErrorTrap
(1)   49/      A4 : 0000 089A           		dc.l MD_ErrorTrap
(1)   50/      A8 : 0000 089A           		dc.l MD_ErrorTrap
(1)   51/      AC : 0000 089A           		dc.l MD_ErrorTrap
(1)   52/      B0 : 0000 089A           		dc.l MD_ErrorTrap
(1)   53/      B4 : 0000 089A           		dc.l MD_ErrorTrap
(1)   54/      B8 : 0000 089A           		dc.l MD_ErrorTrap
(1)   55/      BC : 0000 089A           		dc.l MD_ErrorTrap
(1)   56/      C0 : 0000 089A           		dc.l MD_ErrorTrap
(1)   57/      C4 : 0000 089A           		dc.l MD_ErrorTrap
(1)   58/      C8 : 0000 089A           		dc.l MD_ErrorTrap
(1)   59/      CC : 0000 089A           		dc.l MD_ErrorTrap
(1)   60/      D0 : 0000 089A           		dc.l MD_ErrorTrap
(1)   61/      D4 : 0000 089A           		dc.l MD_ErrorTrap
(1)   62/      D8 : 0000 089A           		dc.l MD_ErrorTrap
(1)   63/      DC : 0000 089A           		dc.l MD_ErrorTrap
(1)   64/      E0 : 0000 089A           		dc.l MD_ErrorTrap
(1)   65/      E4 : 0000 089A           		dc.l MD_ErrorTrap
(1)   66/      E8 : 0000 089A           		dc.l MD_ErrorTrap
(1)   67/      EC : 0000 089A           		dc.l MD_ErrorTrap
(1)   68/      F0 : 0000 089A           		dc.l MD_ErrorTrap
(1)   69/      F4 : 0000 089A           		dc.l MD_ErrorTrap
(1)   70/      F8 : 0000 089A           		dc.l MD_ErrorTrap
(1)   71/      FC : 0000 089A           		dc.l MD_ErrorTrap
(1)   72/     100 : 5345 4741 2033 3258 		dc.b "SEGA 32X        "
                    2020 2020 2020 2020 
(1)   73/     110 : 2843 2947 4636 3420 		dc.b "(C)GF64 2022.???"
                    3230 3232 2E3F 3F3F 
(1)   74/     120 : 5072 6F79 6563 746F 		dc.b "Proyecto MARSIANO                               "
                    204D 4152 5349 414E 
                    4F20 2020 2020 2020 
                    2020 2020 2020 2020 
                    2020 2020 2020 2020 
                    2020 2020 2020 2020 
(1)   75/     150 : 5072 6F6A 6563 7420 		dc.b "Project MARSIANO                                "
                    4D41 5253 4941 4E4F 
                    2020 2020 2020 2020 
                    2020 2020 2020 2020 
                    2020 2020 2020 2020 
                    2020 2020 2020 2020 
(1)   76/     180 : 474D 2048 4F4D 4542 		dc.b "GM HOMEBREW-00"
                    5245 572D 3030      
(1)   77/     18E : 0000                		dc.w 0
(1)   78/     190 : 4A36 2020 2020 2020 		dc.b "J6              "
                    2020 2020 2020 2020 
(1)   79/     1A0 : 0000 0000           		dc.l 0
(1)   80/     1A4 : 000D EA80           		dc.l ROM_END
(1)   81/     1A8 : 00FF 0000           		dc.l $FF0000
(1)   82/     1AC : 00FF FFFF           		dc.l $FFFFFF
(1)   83/     1B0 : 2020 2020           		dc.l $20202020		; dc.b "RA",$F8,$20
(1)   84/     1B4 : 2020 2020           		dc.l $20202020		; $200000
(1)   85/     1B8 : 2020 2020           		dc.l $20202020		; $203FFF
(1)   86/     1BC :                     		align $1F0
(1)   87/     1F0 : 5520 2020 2020 2020 		dc.b "U               "
                    2020 2020 2020 2020 
(1)   88/     200 :                     
(1)   89/     200 :                     ; ====================================================================
(1)   90/     200 :                     ; ----------------------------------------------------------------
(1)   91/     200 :                     ; Second header for 32X
(1)   92/     200 :                     ;
(1)   93/     200 :                     ; These new jumps are for the 68K if the 32X is currently
(1)   94/     200 :                     ; active.
(1)   95/     200 :                     ; ----------------------------------------------------------------
(1)   96/     200 :                     
(1)   97/     200 : 4EF9 0088 0800      		jmp	($880000|MARS_Entry).l
(1)   98/     206 : 4EF9 0088 089A      		jmp	($880000|MD_ErrBus).l			; Bus error
(1)   99/     20C : 4EF9 0088 089A      		jmp	($880000|MD_ErrAddr).l			; Address error
(1)  100/     212 : 4EF9 0088 089A      		jmp	($880000|MD_ErrIll).l			; ILLEGAL Instruction
(1)  101/     218 : 4EF9 0088 089A      		jmp	($880000|MD_ErrZDiv).l			; Divide by 0
(1)  102/     21E : 4EF9 0088 089A      		jmp	($880000|MD_ErrChk).l			; CHK Instruction
(1)  103/     224 : 4EF9 0088 089A      		jmp	($880000|MD_ErrTrapV).l			; TRAPV Instruction
(1)  104/     22A : 4EF9 0088 089A      		jmp	($880000|MD_ErrPrivl).l			; Privilege violation
(1)  105/     230 : 4EF9 0088 089A      		jmp	($880000|MD_Trace).l			; Trace
(1)  106/     236 : 4EF9 0088 089A      		jmp	($880000|MD_Line1010).l			; Line 1010 Emulator
(1)  107/     23C : 4EF9 0088 089A      		jmp	($880000|MD_Line1111).l			; Line 1111 Emulator
(1)  108/     242 : 4EF9 0088 089A      		jmp	($880000|MD_ErrorEx).l			; Error exception
(1)  109/     248 : 4EF9 0088 089A      		jmp	($880000|MD_ErrorEx).l
(1)  110/     24E : 4EF9 0088 089A      		jmp	($880000|MD_ErrorEx).l
(1)  111/     254 : 4EF9 0088 089A      		jmp	($880000|MD_ErrorEx).l
(1)  112/     25A : 4EF9 0088 089A      		jmp	($880000|MD_ErrorEx).l
(1)  113/     260 : 4EF9 0088 089A      		jmp	($880000|MD_ErrorEx).l
(1)  114/     266 : 4EF9 0088 089A      		jmp	($880000|MD_ErrorEx).l
(1)  115/     26C : 4EF9 0088 089A      		jmp	($880000|MD_ErrorEx).l
(1)  116/     272 : 4EF9 0088 089A      		jmp	($880000|MD_ErrorEx).l
(1)  117/     278 : 4EF9 0088 089A      		jmp	($880000|MD_ErrorEx).l
(1)  118/     27E : 4EF9 0088 089A      		jmp	($880000|MD_ErrorEx).l
(1)  119/     284 : 4EF9 0088 089A      		jmp	($880000|MD_ErrorEx).l
(1)  120/     28A : 4EF9 0088 089A      		jmp	($880000|MD_ErrorEx).l
(1)  121/     290 : 4EF9 0088 089A      		jmp	($880000|MD_ErrorTrap).l
(1)  122/     296 : 4EF9 0088 089A      		jmp	($880000|MD_ErrorTrap).l
(1)  123/     29C : 4EF9 0088 089A      		jmp	($880000|MD_ErrorTrap).l
(1)  124/     2A2 : 4EF9 FFFF A9F4      		jmp	(RAM_MdMarsHInt).l			; RAM jump for HBlank (JMP xxxx xxxx)
(1)  125/     2A8 : 4EF9 0088 089A      		jmp	($880000|MD_ErrorTrap).l
(1)  126/     2AE : 4EF9 FFFF A9EE      		jmp	(RAM_MdMarsVInt).l			; RAM jump for VBlank (JMP xxxx xxxx)
(1)  127/     2B4 : 4EF9 0088 089A      		jmp	($880000|MD_ErrorTrap).l
(1)  128/     2BA : 4EF9 0088 089A      		jmp	($880000|MD_ErrorTrap).l
(1)  129/     2C0 : 4EF9 0088 089A      		jmp	($880000|MD_ErrorTrap).l
(1)  130/     2C6 : 4EF9 0088 089A      		jmp	($880000|MD_ErrorTrap).l
(1)  131/     2CC : 4EF9 0088 089A      		jmp	($880000|MD_ErrorTrap).l
(1)  132/     2D2 : 4EF9 0088 089A      		jmp	($880000|MD_ErrorTrap).l
(1)  133/     2D8 : 4EF9 0088 089A      		jmp	($880000|MD_ErrorTrap).l
(1)  134/     2DE : 4EF9 0088 089A      		jmp	($880000|MD_ErrorTrap).l
(1)  135/     2E4 : 4EF9 0088 089A      		jmp	($880000|MD_ErrorTrap).l
(1)  136/     2EA : 4EF9 0088 089A      		jmp	($880000|MD_ErrorTrap).l
(1)  137/     2F0 : 4EF9 0088 089A      		jmp	($880000|MD_ErrorTrap).l
(1)  138/     2F6 : 4EF9 0088 089A      		jmp	($880000|MD_ErrorTrap).l
(1)  139/     2FC : 4EF9 0088 089A      		jmp	($880000|MD_ErrorTrap).l
(1)  140/     302 : 4EF9 0088 089A      		jmp	($880000|MD_ErrorTrap).l
(1)  141/     308 : 4EF9 0088 089A      		jmp	($880000|MD_ErrorTrap).l
(1)  142/     30E : 4EF9 0088 089A      		jmp	($880000|MD_ErrorTrap).l
(1)  143/     314 : 4EF9 0088 089A      		jmp	($880000|MD_ErrorTrap).l
(1)  144/     31A : 4EF9 0088 089A      		jmp	($880000|MD_ErrorTrap).l
(1)  145/     320 : 4EF9 0088 089A      		jmp	($880000|MD_ErrorTrap).l
(1)  146/     326 : 4EF9 0088 089A      		jmp	($880000|MD_ErrorTrap).l
(1)  147/     32C : 4EF9 0088 089A      		jmp	($880000|MD_ErrorTrap).l
(1)  148/     332 : 4EF9 0088 089A      		jmp	($880000|MD_ErrorTrap).l
(1)  149/     338 : 4EF9 0088 089A      		jmp	($880000|MD_ErrorTrap).l
(1)  150/     33E : 4EF9 0088 089A      		jmp	($880000|MD_ErrorTrap).l
(1)  151/     344 : 4EF9 0088 089A      		jmp	($880000|MD_ErrorTrap).l
(1)  152/     34A : 4EF9 0088 089A      		jmp	($880000|MD_ErrorTrap).l
(1)  153/     350 : 4EF9 0088 089A      		jmp	($880000|MD_ErrorTrap).l
(1)  154/     356 : 4EF9 0088 089A      		jmp	($880000|MD_ErrorTrap).l
(1)  155/     35C : 4EF9 0088 089A      		jmp	($880000|MD_ErrorTrap).l
(1)  156/     362 : 4EF9 0088 089A      		jmp	($880000|MD_ErrorTrap).l
(1)  157/     368 : 4EF9 0088 089A      		jmp	($880000|MD_ErrorTrap).l
(1)  158/     36E : 4EF9 0088 089A      		jmp	($880000|MD_ErrorTrap).l
(1)  159/     374 : 4EF9 0088 089A      		jmp	($880000|MD_ErrorTrap).l
(1)  160/     37A :                     
(1)  161/     37A :                     ; ----------------------------------------------------------------
(1)  162/     37A :                     
(1)  163/     37A :                     		align $3C0
(1)  164/     3C0 : 4D41 5253 2043 4845 		dc.b "MARS CHECK MODE "			; Module name
                    434B 204D 4F44 4520 
(1)  165/     3D0 : 0000 0000           		dc.l 0					; Version (always 0)
(1)  166/     3D4 : 0002 2B80           		dc.l MARS_RAMDATA			; Set to 0 if SH2 code points to ROM
(1)  167/     3D8 : 0000 0000           		dc.l 0					; Zero.
(1)  168/     3DC : 0000 9D30           		dc.l MARS_RAMDATA_e-MARS_RAMDATA	; Set to 4 if SH2 code points to ROM
(1)  169/     3E0 : 0600 0E70           		dc.l SH2_M_Entry			; Master SH2 PC (SH2 map area)
(1)  170/     3E4 : 0600 13A0           		dc.l SH2_S_Entry			; Slave SH2 PC (SH2 map area)
(1)  171/     3E8 : 0600 0000           		dc.l SH2_Master				; Master SH2 default VBR
(1)  172/     3EC : 0600 0124           		dc.l SH2_Slave				; Slave SH2 default VBR
(1)  173/     3F0 :                     		binclude "system/mars/data/security.bin"
(1)  174/     800 :                     
(1)  175/     800 :                     ; ====================================================================
(1)  176/     800 :                     ; ----------------------------------------------------------------
(1)  177/     800 :                     ; Entry point, this must be located at $800
(1)  178/     800 :                     ;
(1)  179/     800 :                     ; At this point, the initialization
(1)  180/     800 :                     ; returns the following bits:
(1)  181/     800 :                     ;
(1)  182/     800 :                     ; d0: %h0000000 rsc000ti
(1)  183/     800 :                     ; 	h - Cold start / Hot Start
(1)  184/     800 :                     ; 	r - SDRAM Self Check pass or error
(1)  185/     800 :                     ; 	s - Security check pass or error
(1)  186/     800 :                     ; 	c - Checksum pass or error
(1)  187/     800 :                     ; 	t - TV mode pass or error
(1)  188/     800 :                     ; 	i - MARS ID pass or error
(1)  189/     800 :                     ;
(1)  190/     800 :                     ; d1: %m0000000 jdk0vvv
(1)  191/     800 :                     ; 	m - MARS TV mode
(1)  192/     800 :                     ; 	j - Country: Japan / Overseas
(1)  193/     800 :                     ; 	d - MD TV mode
(1)  194/     800 :                     ; 	k - DISK connected: Yes / No
(1)  195/     800 :                     ; 	v - Version
(1)  196/     800 :                     ;
(1)  197/     800 :                     ; Carry flag: "MARS ID" and Self Check result
(1)  198/     800 :                     ; 	cc: Test passed
(1)  199/     800 :                     ; 	cs: Test failed**
(1)  200/     800 :                     ;
(1)  201/     800 :                     ; ** HARDWARE BUG: It may still trigger if using
(1)  202/     800 :                     ; DREQ, DMA or Watchdog, and/or pressing RESET
(1)  203/     800 :                     ; so many times.
(1)  204/     800 :                     ; ----------------------------------------------------------------
(1)  205/     800 :                     
(1)  206/     800 :                     MARS_Entry:
(1)  207/     800 : 657A                		bcs	.no_mars
(1)  208/     802 : 23FC 0000 0000 FFFF 		move.l	#0,(RAM_initflug).l	; Reset "INIT" flag
                    A9EA                
(1)  209/     80C : 0800 000F           		btst	#15,d0			; Soft reset?
(1)  210/     810 : 6700 00A0           		beq	MD_Init
(1)  211/     814 : 4BF9 00A1 5100      		lea	(sysmars_reg).l,a5	; a5 - MARS register
(1)  212/     81A : 082D 0000 0001      		btst.b	#0,1(a5)		; 32X enabled?
(1)  213/     820 : 664A                		bne	.adapter_enbl		; If yes, start booting
(1)  214/     822 : 41FA 0020           		lea	.ram_code(pc),a0	; Copy the adapter-retry code to RAM
(1)  215/     826 : 43F9 00FF 0000      		lea	($FF0000).l,a1		; and jump there.
(1)  216/     82C : 22D8                		move.l	(a0)+,(a1)+
(1)  217/     82E : 22D8                		move.l	(a0)+,(a1)+
(1)  218/     830 : 22D8                		move.l	(a0)+,(a1)+
(1)  219/     832 : 22D8                		move.l	(a0)+,(a1)+
(1)  220/     834 : 22D8                		move.l	(a0)+,(a1)+
(1)  221/     836 : 22D8                		move.l	(a0)+,(a1)+
(1)  222/     838 : 22D8                		move.l	(a0)+,(a1)+
(1)  223/     83A : 22D8                		move.l	(a0)+,(a1)+
(1)  224/     83C : 41F9 00FF 0000      		lea	($FF0000).l,a0
(1)  225/     842 : 4ED0                		jmp	(a0)
(1)  226/     844 :                     .ram_code:
(1)  227/     844 : 1ABC 0001           		move.b	#1,adapter(a5)		; Enable adapter.
(1)  228/     848 : 41FA 000A           		lea	.restarticd(pc),a0	; JUMP to the following code in
(1)  229/     84C : D1FC 0088 0000      		adda.l	#$880000,a0		; the new 68k location
(1)  230/     852 : 4ED0                		jmp	(a0)
(1)  231/     854 :                     .restarticd:
(1)  232/     854 : 4BF9 00A1 0000      		lea	($A10000).l,a5		; a5 - MD's I/O area
(1)  233/     85A : 287C FFFF FFC0      		move.l	#-64,a4			; a4 - $FFFFFF9C
(1)  234/     860 : 3E3C 0F3C           		move.w	#3900,d7		; d7 - loop this many times
(1)  235/     864 : 43F9 0088 06E4      		lea	($880000+$6E4),a1	; Jump to ?res_wait (check ICD_MARS.PRG)
(1)  236/     86A : 4ED1                		jmp	(a1)
(1)  237/     86C :                     .adapter_enbl:
(1)  238/     86C : 4BF9 00A1 5100      		lea	(sysmars_reg),a5
(1)  239/     872 : 082D 0001 0001      		btst.b	#1,1(a5)		; SH2 Reset request?
(1)  240/     878 : 667C                		bne	MD_HotStart		; If not, we are on hotstart
(1)  241/     87A : 60D8                		bra.s	.restarticd
(1)  242/     87C :                     
(1)  243/     87C :                     ; ====================================================================
(1)  244/     87C :                     ; ----------------------------------------------------------------
(1)  245/     87C :                     ; If 32X is not detected...
(1)  246/     87C :                     ;
(1)  247/     87C :                     ; This only works in emulators, though.
(1)  248/     87C :                     ; ----------------------------------------------------------------
(1)  249/     87C :                     
(1)  250/     87C :                     .no_mars:
(1)  251/     87C : 0800 0005           		btst	#5,d0		; If for some reason we got here...
(1)  252/     880 : 6630                		bne.s	MD_Init		;
(1)  253/     882 :                     
(1)  254/     882 :                     	; And if 32X is not present...
(1)  255/     882 : 46FC 2700           		move.w	#$2700,sr			; Disable interrupts
(1)  256/     886 : 23FC C000 0000 00C0 		move.l	#$C0000000,(vdp_ctrl).l		; VDP: Point to Color 0
                    0004                
(1)  257/     890 : 33FC 0E00 00C0 0000 		move.w	#$0E00,(vdp_data).l		; Write blue
(1)  258/     898 : 60FE                		bra.s	*				; Infinite loop.
(1)  259/     89A :                     
(1)  260/     89A :                     ; ====================================================================
(1)  261/     89A :                     ; ----------------------------------------------------------------
(1)  262/     89A :                     ; 68k's Error handlers
(1)  263/     89A :                     ; ----------------------------------------------------------------
(1)  264/     89A :                     
(1)  265/     89A :                     MD_ErrBus:		; Bus error
(1)  266/     89A :                     MD_ErrAddr:		; Address error
(1)  267/     89A :                     MD_ErrIll:		; ILLEGAL Instruction
(1)  268/     89A :                     MD_ErrZDiv:		; Divide by 0
(1)  269/     89A :                     MD_ErrChk:		; CHK Instruction
(1)  270/     89A :                     MD_ErrTrapV:		; TRAPV Instruction
(1)  271/     89A :                     MD_ErrPrivl:		; Privilege violation
(1)  272/     89A :                     MD_Trace:		; Trace
(1)  273/     89A :                     MD_Line1010:		; Line 1010 Emulator
(1)  274/     89A :                     MD_Line1111:		; Line 1111 Emulator
(1)  275/     89A :                     MD_ErrorEx:		; Error exception
(1)  276/     89A :                     MD_ErrorTrap:
(1)  277/     89A : 46FC 2700           		move.w	#$2700,sr			; Disable interrupts
(1)  278/     89E : 23FC C000 0000 00C0 		move.l	#$C0000000,(vdp_ctrl).l		; VDP: Point to Color 0
                    0004                
(1)  279/     8A8 : 33FC 000E 00C0 0000 		move.w	#$000E,(vdp_data).l		; Write blue
(1)  280/     8B0 : 60FE                		bra.s	*
(1)  281/     8B2 :                     
(1)  282/     8B2 :                     ; ------------------------------------------------
(1)  283/     8B2 :                     ; Init
(1)  284/     8B2 :                     ; ------------------------------------------------
(1)  285/     8B2 :                     
(1)  286/     8B2 :                     MD_Init:
(1)  287/     8B2 : 46FC 2700           		move.w	#$2700,sr
(1)  288/     8B6 : 3039 00C0 0004      .wait_dma:	move.w	(vdp_ctrl).l,d0
(1)  289/     8BC : 0800 0001           		btst	#1,d0
(1)  290/     8C0 : 66F4                		bne.s	.wait_dma
(1)  291/     8C2 : 4BF9 00A1 5100      		lea	(sysmars_reg).l,a5
(1)  292/     8C8 : 3B7C 0000 0006      		move.w	#0,dreqctl(a5)			; Clear 68S and RV
(1)  293/     8CE : 0CAD 4D5F 4F4B 0020 .wm:		cmp.l	#"M_OK",comm0(a5)		; SH2 Master active?
(1)  294/     8D6 : 66F6                		bne.s	.wm
(1)  295/     8D8 : 0CAD 535F 4F4B 0024 .ws:		cmp.l	#"S_OK",comm4(a5)		; SH2 Slave active?
(1)  296/     8E0 : 66F6                		bne.s	.ws
(1)  297/     8E2 : 7000                		moveq	#0,d0				; Reset comm values
(1)  298/     8E4 : 2B40 0020           		move.l	d0,comm0(a5)
(1)  299/     8E8 : 2B40 0024           		move.l	d0,comm4(a5)
(1)  300/     8EC : 23FC 494E 4954 FFFF 		move.l	#"INIT",(RAM_initflug).l	; Set "INIT" as our boot flag
                    A9EA                
(1)  301/     8F6 :                     MD_HotStart:
(1)  302/     8F6 : 0CB9 494E 4954 FFFF 		cmp.l	#"INIT",(RAM_initflug).l
                    A9EA                
(1)  303/     900 : 66B0                		bne	MD_Init
(1)  304/     902 : 7000                		moveq	#0,d0				; Clear USP
(1)  305/     904 : 2C40                		movea.l	d0,a6
(1)  306/     906 : 4E66                		move.l	a6,usp
(1)  307/     908 : 3039 00C0 0004      .waitframe:	move.w	(vdp_ctrl).l,d0			; Wait VBlank
(1)  308/     90E : 0800 0007           		btst	#7,d0
(1)  309/     912 : 67F4                		beq.s	.waitframe
(1)  310/     914 : 41F9 FFFF 0000      		lea	($FFFF0000),a0			; Clear our RAM
(1)  311/     91A : 223C FFFF AE30      		move.l	#sizeof_mdram,d1		; Also using this as a delay in case
(1)  312/     920 : 7000                		moveq	#0,d0				; DREQ needs to "cool down" (on soft reset)
(1)  313/     922 :                     .loop_ram:
(1)  314/     922 : 30C0                		move.w	d0,(a0)+
(1)  315/     924 : B1C1                		cmp.l	d1,a0
(1)  316/     926 : 65FA                		bcs.s	.loop_ram
(1)  317/     928 : 23FC 8004 8104 00C0 		move.l	#$80048104,(vdp_ctrl).l		; Default top VDP regs
                    0004                
(1)  318/     932 : 4CF9 7FFF 00FF 0000 		movem.l	($FF0000),d0-a6			; Clear registers (using zeros from RAM)
(1)  319/     93A :                     	; jump goes here...
(1)  320/     93A :                     
      13/     93A :                     
      14/     93A :                     ; ====================================================================
      15/     93A :                     ; ----------------------------------------------------------------
      16/     93A :                     ; Main 68k code
      17/     93A :                     ; ----------------------------------------------------------------
      18/     93A :                     
      19/     93A : 4EF9 0088 39A4      		jmp	(thisCode_Top).l
      20/     940 :                     
      21/     940 :                     ; ====================================================================
      22/     940 :                     ; --------------------------------------------------------
      23/     940 :                     ; Section stored at the $880000 area
      24/     940 :                     ; --------------------------------------------------------
      25/     940 :                     
      26/     940 :                     MdRamCode:
      27/  880940 :                     		phase $880000+*
      28/  880940 :                     		include	"system/md/sound.asm"
(1)    1/  880940 :                     ; ====================================================================
(1)    2/  880940 :                     ; ----------------------------------------------------------------
(1)    3/  880940 :                     ; GEMA Sound driver
(1)    4/  880940 :                     ; ----------------------------------------------------------------
(1)    5/  880940 :                     
(1)    6/  880940 :                     ; --------------------------------------------------------
(1)    7/  880940 :                     ; Initialize Sound
(1)    8/  880940 :                     ;
(1)    9/  880940 :                     ; Uses:
(1)   10/  880940 :                     ; a0-a1,d0-d1
(1)   11/  880940 :                     ; --------------------------------------------------------
(1)   12/  880940 :                     
(1)   13/  880940 :                     	; This align is for GEMS emulator only
(1)   14/  880940 :                     	; in case gets stuck in a black screen
(1)   15/  880940 :                     		align $80
(1)   16/  880980 :                     
(1)   17/  880980 :                     Sound_Init:
(1)   18/  880980 : 33FC 0100 00A1 1100 		move.w	#$0100,(z80_bus).l		; Request Z80 stop
(1)   19/  880988 : 13FC 0001 00A1 1200 		move.b	#1,(z80_reset).l		; And reset
(1)   20/  880990 :                     .wait:
(1)   21/  880990 : 0839 0000 00A1 1100 		btst	#0,(z80_bus).l
(1)   22/  880998 : 66F6                		bne.s	.wait
(1)   23/  88099A : 41F9 00A0 0000      		lea	(z80_cpu).l,a0			; Clean entire Z80 area first
(1)   24/  8809A0 : 303C 1FFF           		move.w	#$1FFF,d0
(1)   25/  8809A4 : 7200                		moveq	#0,d1
(1)   26/  8809A6 :                     .cleanup:
(1)   27/  8809A6 : 10C1                		move.b	d1,(a0)+
(1)   28/  8809A8 : 51C8 FFFC           		dbf	d0,.cleanup
(1)   29/  8809AC : 41F9 0088 0BE0      		lea	(Z80_CODE|$880000).l,a0		; a0 - Z80 code (on $880000 area)
(1)   30/  8809B2 : 43F9 00A0 0000      		lea	(z80_cpu).l,a1			; a1 - Z80 area
(1)   31/  8809B8 : 303C 1F4E           		move.w	#(Z80_CODE_END-Z80_CODE)-1,d0	; d0 - Size
(1)   32/  8809BC :                     .copy:
(1)   33/  8809BC : 12D8                		move.b	(a0)+,(a1)+
(1)   34/  8809BE : 51C8 FFFC           		dbf	d0,.copy
(1)   35/  8809C2 : 13FC 0001 00A1 1200 		move.b	#1,(z80_reset).l		; Reset again
(1)   36/  8809CA : 4E71                		nop
(1)   37/  8809CC : 4E71                		nop
(1)   38/  8809CE : 4E71                		nop
(1)   39/  8809D0 : 33FC 0000 00A1 1100 		move.w	#0,(z80_bus).l			; Start Z80
(1)   40/  8809D8 : 4E75                		rts
(1)   41/  8809DA :                     
(1)   42/  8809DA :                     ; ====================================================================
(1)   43/  8809DA :                     ; ----------------------------------------------------------------
(1)   44/  8809DA :                     ; Subroutines
(1)   45/  8809DA :                     ; ----------------------------------------------------------------
(1)   46/  8809DA :                     
(1)   47/  8809DA :                     ; ------------------------------------------------
(1)   48/  8809DA :                     ; Lock Z80, get bus
(1)   49/  8809DA :                     ; ------------------------------------------------
(1)   50/  8809DA :                     
(1)   51/  8809DA :                     sndLockZ80:
(1)   52/  8809DA : 33FC 0100 00A1 1100 		move.w	#$0100,(z80_bus).l
(1)   53/  8809E2 :                     .wait:
(1)   54/  8809E2 : 0839 0000 00A1 1100 		btst	#0,(z80_bus).l
(1)   55/  8809EA : 66F6                		bne.s	.wait
(1)   56/  8809EC : 4E75                		rts
(1)   57/  8809EE :                     
(1)   58/  8809EE :                     ; ------------------------------------------------
(1)   59/  8809EE :                     ; Unlock Z80, return bus
(1)   60/  8809EE :                     ; ------------------------------------------------
(1)   61/  8809EE :                     
(1)   62/  8809EE :                     sndUnlockZ80:
(1)   63/  8809EE : 33FC 0000 00A1 1100 		move.w	#0,(z80_bus).l
(1)   64/  8809F6 : 4E75                		rts
(1)   65/  8809F8 :                     
(1)   66/  8809F8 :                     ; ------------------------------------------------
(1)   67/  8809F8 :                     ; 68k-to-z80 Sound request
(1)   68/  8809F8 :                     ; enter/exit routines
(1)   69/  8809F8 :                     ;
(1)   70/  8809F8 :                     ; d6 - commFifo index
(1)   71/  8809F8 :                     ; ------------------------------------------------
(1)   72/  8809F8 :                     
(1)   73/  8809F8 :                     sndReq_Enter:
(1)   74/  8809F8 : 48F9 60C0 FFFF 9800 		movem.l	d6-d7/a5-a6,(RAM_SndSaveReg).l
(1)   75/  880A00 : 7C00                		moveq	#0,d6
(1)   76/  880A02 : 40C6                		move.w	sr,d6
(1)   77/  880A04 : 33FC 0100 00A1 1100 		move.w	#$0100,(z80_bus).l		; Request Z80 Stop
(1)   78/  880A0C : 4846                		swap	d6
(1)   79/  880A0E : 007C 0700           		or.w	#$0700,sr			; disable ints
(1)   80/  880A12 : 4BF9 00A0 001F      		lea	(z80_cpu+commZWrite),a5		; a5 - commZWrite
(1)   81/  880A18 : 4DF9 00A0 1F00      		lea	(z80_cpu+commZfifo),a6		; a6 - fifo command list
(1)   82/  880A1E :                     .wait:
(1)   83/  880A1E : 0839 0000 00A1 1100 		btst	#0,(z80_bus).l			; Wait for Z80
(1)   84/  880A26 : 66F6                		bne.s	.wait
(1)   85/  880A28 : 1C15                		move.b	(a5),d6				; d6 - index fifo position
(1)   86/  880A2A : 4886                		ext.w	d6				; extend to 16 bits
(1)   87/  880A2C : 4E75                		rts
(1)   88/  880A2E :                     ; JUMP ONLY
(1)   89/  880A2E :                     sndReq_Exit:
(1)   90/  880A2E : 33FC 0000 00A1 1100 		move.w	#0,(z80_bus).l
(1)   91/  880A36 : 4846                		swap	d6
(1)   92/  880A38 : 46C6                		move.w	d6,sr
(1)   93/  880A3A : 4CF9 60C0 FFFF 9800 		movem.l	(RAM_SndSaveReg).l,d6-d7/a5-a6
(1)   94/  880A42 : 4E75                		rts
(1)   95/  880A44 :                     
(1)   96/  880A44 :                     ; ------------------------------------------------
(1)   97/  880A44 :                     ; Send request id and arguments
(1)   98/  880A44 :                     ;
(1)   99/  880A44 :                     ; Input:
(1)  100/  880A44 :                     ; d7 - byte to write
(1)  101/  880A44 :                     ; d6 - index pointer
(1)  102/  880A44 :                     ; a5 - commZWrite, update index
(1)  103/  880A44 :                     ; a6 - commZfifo command list
(1)  104/  880A44 :                     ;
(1)  105/  880A44 :                     ; *** CALL sndReq_Enter FIRST ***
(1)  106/  880A44 :                     ; ------------------------------------------------
(1)  107/  880A44 :                     
(1)  108/  880A44 :                     sndReq_scmd:
(1)  109/  880A44 : 1DBC 00FF 6000      		move.b	#-1,(a6,d6.w)			; write command-start flag
(1)  110/  880A4A : 5206                		addq.b	#1,d6				; next fifo pos
(1)  111/  880A4C : 0206 003F           		andi.b	#$3F,d6
(1)  112/  880A50 : 600C                		bra.s	sndReq_sbyte
(1)  113/  880A52 :                     sndReq_slong:
(1)  114/  880A52 : 610A                		bsr	sndReq_sbyte
(1)  115/  880A54 : E09F                		ror.l	#8,d7
(1)  116/  880A56 :                     sndReq_saddr:
(1)  117/  880A56 : 6106                		bsr	sndReq_sbyte
(1)  118/  880A58 : E09F                		ror.l	#8,d7
(1)  119/  880A5A :                     sndReq_sword:
(1)  120/  880A5A : 6102                		bsr	sndReq_sbyte
(1)  121/  880A5C : E09F                		ror.l	#8,d7
(1)  122/  880A5E :                     sndReq_sbyte:
(1)  123/  880A5E : 1D87 6000           		move.b	d7,(a6,d6.w)			; write byte
(1)  124/  880A62 : 5206                		addq.b	#1,d6				; next fifo pos
(1)  125/  880A64 : 0206 003F           		andi.b	#$3F,d6
(1)  126/  880A68 : 1A86                		move.b	d6,(a5)				; update commZWrite
(1)  127/  880A6A : 4E75                		rts
(1)  128/  880A6C :                     
(1)  129/  880A6C :                     ; --------------------------------------------------------
(1)  130/  880A6C :                     ; Sound_DMA_Pause
(1)  131/  880A6C :                     ;
(1)  132/  880A6C :                     ; Call this BEFORE making any DMA task
(1)  133/  880A6C :                     ;
(1)  134/  880A6C :                     ; Uses:
(1)  135/  880A6C :                     ; d6,d7
(1)  136/  880A6C :                     ; --------------------------------------------------------
(1)  137/  880A6C :                     
(1)  138/  880A6C :                     Sound_DMA_Pause:
(1)  139/  880A6C : 4847                		swap	d7
(1)  140/  880A6E : 4846                		swap	d6
(1)  141/  880A70 :                     .retry:
(1)  142/  880A70 : 6100 FF68           		bsr	sndLockZ80
(1)  143/  880A74 : 1E39 00A0 001D      		move.b	(z80_cpu+commZRomRd),d7		; Get mid-read bit
(1)  144/  880A7A : 6100 FF72           		bsr	sndUnlockZ80
(1)  145/  880A7E : 4A07                		tst.b	d7
(1)  146/  880A80 : 6708                		beq.s	.safe
(1)  147/  880A82 : 7E44                		moveq	#68,d7
(1)  148/  880A84 : 51CF FFFE           		dbf	d7,*
(1)  149/  880A88 : 60E6                		bra.s	.retry
(1)  150/  880A8A :                     .safe:
(1)  151/  880A8A : 6100 FF4E           		bsr	sndLockZ80
(1)  152/  880A8E : 13FC 0001 00A0 001C 		move.b	#1,(z80_cpu+commZRomBlk)	; Block flag for Z80
(1)  153/  880A96 : 6100 FF56           		bsr	sndUnlockZ80
(1)  154/  880A9A :                     
(1)  155/  880A9A : 3C3C 0002           		move.w	#2,d6
(1)  156/  880A9E : 1E39 00A1 512E      .wait_in:	move.b	(sysmars_reg+comm14),d7
(1)  157/  880AA4 : CE7C 00F0           		and.w	#%11110000,d7
(1)  158/  880AA8 : 66F4                		bne.s	.wait_in
(1)  159/  880AAA : 8E06                		or.b	d6,d7
(1)  160/  880AAC : 13C7 00A1 512E      		move.b	d7,(sysmars_reg+comm14).l
(1)  161/  880AB2 : 1E39 00A1 512E      		move.b	(sysmars_reg+comm14).l,d7
(1)  162/  880AB8 : CE7C 000F           		and.w	#%00001111,d7
(1)  163/  880ABC : BE06                		cmp.b	d6,d7
(1)  164/  880ABE : 66DE                		bne.s	.wait_in
(1)  165/  880AC0 : 08F9 0007 00A1 512E 		bset	#7,(sysmars_reg+comm14).l
(1)  166/  880AC8 : 08F9 0001 00A1 5103 		bset	#1,(sysmars_reg+standby).l	; Request Slave CMD
(1)  167/  880AD0 :                     ; ; .wait_cmd:	btst	#1,(sysmars_reg+standby).l
(1)  168/  880AD0 :                     ; ; 		bne.s	.wait_cmd
(1)  169/  880AD0 : 1E39 00A1 512E      .wait_out:	move.b	(sysmars_reg+comm14),d7
(1)  170/  880AD6 : CE7C 00F0           		and.w	#%11110000,d7
(1)  171/  880ADA : 66F4                		bne.s	.wait_out
(1)  172/  880ADC : 4846                		swap	d6
(1)  173/  880ADE : 4847                		swap	d7
(1)  174/  880AE0 : 4E75                		rts
(1)  175/  880AE2 :                     
(1)  176/  880AE2 :                     ; --------------------------------------------------------
(1)  177/  880AE2 :                     ; Sound_DMA_Resume
(1)  178/  880AE2 :                     ;
(1)  179/  880AE2 :                     ; Call this AFTER finishing DMA
(1)  180/  880AE2 :                     ; --------------------------------------------------------
(1)  181/  880AE2 :                     
(1)  182/  880AE2 :                     Sound_DMA_Resume:
(1)  183/  880AE2 : 4847                		swap	d7
(1)  184/  880AE4 : 4846                		swap	d6
(1)  185/  880AE6 : 6100 FEF2           		bsr	sndLockZ80
(1)  186/  880AEA : 13FC 0000 00A0 001C 		move.b	#0,(z80_cpu+commZRomBlk)
(1)  187/  880AF2 : 6100 FEFA           		bsr	sndUnlockZ80
(1)  188/  880AF6 :                     
(1)  189/  880AF6 : 3C3C 0003           		move.w	#3,d6
(1)  190/  880AFA : 1E39 00A1 512E      .wait_in:	move.b	(sysmars_reg+comm14),d7
(1)  191/  880B00 : CE7C 00F0           		and.w	#%11110000,d7
(1)  192/  880B04 : 66F4                		bne.s	.wait_in
(1)  193/  880B06 : 8E06                		or.b	d6,d7
(1)  194/  880B08 : 13C7 00A1 512E      		move.b	d7,(sysmars_reg+comm14).l
(1)  195/  880B0E : 1E39 00A1 512E      		move.b	(sysmars_reg+comm14).l,d7
(1)  196/  880B14 : CE7C 000F           		and.w	#%00001111,d7
(1)  197/  880B18 : BE06                		cmp.b	d6,d7
(1)  198/  880B1A : 66DE                		bne.s	.wait_in
(1)  199/  880B1C : 08F9 0007 00A1 512E 		bset	#7,(sysmars_reg+comm14).l
(1)  200/  880B24 : 08F9 0001 00A1 5103 		bset	#1,(sysmars_reg+standby).l	; Request Slave CMD
(1)  201/  880B2C :                     ; ; .wait_cmd:	btst	#1,(sysmars_reg+standby).l
(1)  202/  880B2C :                     ; ; 		bne.s	.wait_cmd
(1)  203/  880B2C : 1E39 00A1 512E      .wait_out:	move.b	(sysmars_reg+comm14),d7
(1)  204/  880B32 : CE7C 00F0           		and.w	#%11110000,d7
(1)  205/  880B36 : 66F4                		bne.s	.wait_out
(1)  206/  880B38 : 4846                		swap	d6
(1)  207/  880B3A : 4847                		swap	d7
(1)  208/  880B3C : 4E75                		rts
(1)  209/  880B3E :                     
(1)  210/  880B3E :                     ; --------------------------------------------------------
(1)  211/  880B3E :                     ; SoundReq_SetTrack
(1)  212/  880B3E :                     ;
(1)  213/  880B3E :                     ; a0 - Pointer to Pattern, Blocks and Instruments list
(1)  214/  880B3E :                     ;      in this order:
(1)  215/  880B3E :                     ;  	dc.l pattern_data
(1)  216/  880B3E :                     ;  	dc.l block_data
(1)  217/  880B3E :                     ;  	dc.l instrument_data
(1)  218/  880B3E :                     ;
(1)  219/  880B3E :                     ; d0 - Slot
(1)  220/  880B3E :                     ; d1 - Ticks
(1)  221/  880B3E :                     ; d2 - From block
(1)  222/  880B3E :                     ; d3 - Flags: %00004321
(1)  223/  880B3E :                     ; 	1234 - Use global tempos 1,2,3 or 4
(1)  224/  880B3E :                     ;
(1)  225/  880B3E :                     ; Uses:
(1)  226/  880B3E :                     ; d6-d7,a5-a6
(1)  227/  880B3E :                     ; --------------------------------------------------------
(1)  228/  880B3E :                     
(1)  229/  880B3E :                     Sound_TrkPlay:
(1)  230/  880B3E : 6100 FEB8           		bsr	sndReq_Enter
(1)  231/  880B42 : 3E3C 0000           		move.w	#$00,d7		; Command $00
(1)  232/  880B46 : 6100 FEFC           		bsr	sndReq_scmd
(1)  233/  880B4A : 1E00                		move.b	d0,d7		; d0 - Slot
(1)  234/  880B4C : 6100 FF10           		bsr	sndReq_sbyte
(1)  235/  880B50 : 1E01                		move.b	d1,d7		; d1 - Ticks
(1)  236/  880B52 : 6100 FF0A           		bsr	sndReq_sbyte
(1)  237/  880B56 : 1E02                		move.b	d2,d7		; d2 - Start block
(1)  238/  880B58 : 6100 FF04           		bsr	sndReq_sbyte
(1)  239/  880B5C : 1E03                		move.b	d3,d7		; d3 - Flags (%321 enable these timers)
(1)  240/  880B5E : CE7C 0007           		and.w	#%111,d7
(1)  241/  880B62 : 6100 FEFA           		bsr	sndReq_sbyte
(1)  242/  880B66 : 2E18                		move.l	(a0)+,d7	; Patt data point
(1)  243/  880B68 : 6100 FEEC           		bsr	sndReq_saddr
(1)  244/  880B6C : 2E18                		move.l	(a0)+,d7	; Block data point
(1)  245/  880B6E : 6100 FEE6           		bsr	sndReq_saddr
(1)  246/  880B72 : 2E18                		move.l	(a0)+,d7	; Intrument data
(1)  247/  880B74 : 6100 FEE0           		bsr	sndReq_saddr
(1)  248/  880B78 : 6000 FEB4           		bra 	sndReq_Exit
(1)  249/  880B7C :                     
(1)  250/  880B7C :                     ; --------------------------------------------------------
(1)  251/  880B7C :                     ; SoundReq_StopTrack (Pause too.)
(1)  252/  880B7C :                     ;
(1)  253/  880B7C :                     ; d0 - Slot
(1)  254/  880B7C :                     ; --------------------------------------------------------
(1)  255/  880B7C :                     
(1)  256/  880B7C :                     Sound_TrkStop:
(1)  257/  880B7C : 6100 FE7A           		bsr	sndReq_Enter
(1)  258/  880B80 : 3E3C 0001           		move.w	#$01,d7		; Command $01
(1)  259/  880B84 : 6100 FEBE           		bsr	sndReq_scmd
(1)  260/  880B88 : 1E00                		move.b	d0,d7		; d0 - Slot
(1)  261/  880B8A : 6100 FED2           		bsr	sndReq_sbyte
(1)  262/  880B8E : 6000 FE9E           		bra 	sndReq_Exit
(1)  263/  880B92 :                     
(1)  264/  880B92 :                     ; --------------------------------------------------------
(1)  265/  880B92 :                     ; Sound_TrkResume
(1)  266/  880B92 :                     ;
(1)  267/  880B92 :                     ; d0 - Slot
(1)  268/  880B92 :                     ; --------------------------------------------------------
(1)  269/  880B92 :                     
(1)  270/  880B92 :                     Sound_TrkResume:
(1)  271/  880B92 : 6100 FE64           		bsr	sndReq_Enter
(1)  272/  880B96 : 3E3C 0002           		move.w	#$02,d7		; Command $01
(1)  273/  880B9A : 6100 FEA8           		bsr	sndReq_scmd
(1)  274/  880B9E : 1E00                		move.b	d0,d7		; d0 - Slot
(1)  275/  880BA0 : 6100 FEBC           		bsr	sndReq_sbyte
(1)  276/  880BA4 : 6000 FE88           		bra 	sndReq_Exit
(1)  277/  880BA8 :                     
(1)  278/  880BA8 :                     ; --------------------------------------------------------
(1)  279/  880BA8 :                     ; Sound_TrkTicks
(1)  280/  880BA8 :                     ;
(1)  281/  880BA8 :                     ; d0 - Slot
(1)  282/  880BA8 :                     ; d1 - Ticks
(1)  283/  880BA8 :                     ; --------------------------------------------------------
(1)  284/  880BA8 :                     
(1)  285/  880BA8 :                     Sound_TrkTicks:
(1)  286/  880BA8 : 6100 FE4E           		bsr	sndReq_Enter
(1)  287/  880BAC : 3E3C 0008           		move.w	#$08,d7		; Command $08
(1)  288/  880BB0 : 6100 FE92           		bsr	sndReq_scmd
(1)  289/  880BB4 : 1E00                		move.b	d0,d7		; d0 - Slot
(1)  290/  880BB6 : 6100 FEA6           		bsr	sndReq_sbyte
(1)  291/  880BBA : 1E01                		move.b	d1,d7		; d1 - Ticks
(1)  292/  880BBC : 6100 FEA0           		bsr	sndReq_sbyte
(1)  293/  880BC0 : 6000 FE6C           		bra 	sndReq_Exit
(1)  294/  880BC4 :                     
(1)  295/  880BC4 :                     ; --------------------------------------------------------
(1)  296/  880BC4 :                     ; Sound_GlbTempo
(1)  297/  880BC4 :                     ;
(1)  298/  880BC4 :                     ; d0 - Slot
(1)  299/  880BC4 :                     ; d1 - Tempo (WORD)
(1)  300/  880BC4 :                     ; --------------------------------------------------------
(1)  301/  880BC4 :                     
(1)  302/  880BC4 :                     Sound_GlbTempo:
(1)  303/  880BC4 : 6100 FE32           		bsr	sndReq_Enter
(1)  304/  880BC8 : 3E3C 0010           		move.w	#$10,d7		; Command $10
(1)  305/  880BCC : 6100 FE76           		bsr	sndReq_scmd
(1)  306/  880BD0 : 1E00                		move.b	d0,d7		; d0 - Slot
(1)  307/  880BD2 : 6100 FE8A           		bsr	sndReq_sbyte
(1)  308/  880BD6 : 3E01                		move.w	d1,d7		; d1 - Tempo MSB
(1)  309/  880BD8 : 6100 FE80           		bsr	sndReq_sword
(1)  310/  880BDC : 6000 FE50           		bra 	sndReq_Exit
(1)  311/  880BE0 :                     
(1)  312/  880BE0 :                     ; --------------------------------------------------------
(1)  313/  880BE0 :                     
(1)  314/  880BE0 :                     		align 4
(1)  315/  880BE0 :                     Z80_CODE:
(1)  316/  880BE0 :                     		cpu Z80			; Set Z80 here
(1)  317/       0 :                     		phase 0			; And set PC to 0
(1)  318/       0 :                     		include "system/md/z_driver.asm"
(2)    1/       0 :                     ; --------------------------------------------------------
(2)    2/       0 :                     ; GEMA sound driver, inspired by GEMS (kinda)
(2)    3/       0 :                     ;
(2)    4/       0 :                     ; Two playable track slots: BGM(0) and SFX(1)
(2)    5/       0 :                     ;
(2)    6/       0 :                     ; Slot 1 can either overwrite chip channels or
(2)    7/       0 :                     ; if possible grab unused slots
(2)    8/       0 :                     ;
(2)    9/       0 :                     ; WARNING: DAC sample playback has to be sync'd manually
(2)   10/       0 :                     ; on every code change, sample rate is at the
(2)   11/       0 :                     ; 18000hz range
(2)   12/       0 :                     ; --------------------------------------------------------
(2)   13/       0 :                     
(2)   14/       0 :                     ; --------------------------------------------------------
(2)   15/       0 :                     ; User settings
(2)   16/       0 :                     ; --------------------------------------------------------
(2)   17/       0 :                     
(2)   18/       0 : =11H                MAX_TRKCHN	equ 17		; Max internal tracker channels (4PSG + 6FM + 7PWM)
(2)   19/       0 : =FFFFFFFFFFF..      ZSET_WTUNE	equ -24		; Manual frequency adjustment for DAC WAVE playback
(2)   20/       0 : =0H                 ZSET_TESTME	equ 0		; Set to 1 to "hear" test the DAC playback
(2)   21/       0 :                     
(2)   22/       0 :                     ; --------------------------------------------------------
(2)   23/       0 :                     ; Structs
(2)   24/       0 :                     ;
(2)   25/       0 :                     ; NOTE: struct doesn't work here. use equs instead
(2)   26/       0 :                     ; --------------------------------------------------------
(2)   27/       0 :                     
(2)   28/       0 :                     ; trkBuff struct
(2)   29/       0 :                     ; LIMIT: 20h (32) bytes
(2)   30/       0 : =0H                 trk_romBlk	equ 0	; 24-bit base block data
(2)   31/       0 : =3H                 trk_romPatt	equ 3	; 24-bit base patt data
(2)   32/       0 : =6H                 trk_romIns	equ 6	; 24-bit ROM instrument pointers
(2)   33/       0 : =9H                 trk_romPattRd	equ 9	; same but for reading
(2)   34/       0 : =CH                 trk_Read	equ 12	; Current track position (in our storage)
(2)   35/       0 : =EH                 trk_Rows	equ 14	; Current track length
(2)   36/       0 : =10H                trk_Halfway	equ 16	; Only 00h or 80h
(2)   37/       0 : =11H                trk_currBlk	equ 17	; Current block
(2)   38/       0 : =12H                trk_setBlk	equ 18	; Start on this block
(2)   39/       0 : =13H                trk_status	equ 19	; %ERPB Sxxx | E-enabled / R-Init|Restart track / P-refill-on-playback / B-use global beats / S-silence
(2)   40/       0 : =14H                trk_tickTmr	equ 20	; Ticks timer
(2)   41/       0 : =15H                trk_tickSet	equ 21	; Ticks set for this track
(2)   42/       0 : =16H                trk_sizeIns	equ 22	; Max instrument storage
(2)   43/       0 : =17H                trk_rowPause	equ 23	; Row pause timer
(2)   44/       0 : =1AH                trk_CachNotes	equ 26	; Pointer to track storage (100h bytes long and aligned)
(2)   45/       0 : =1CH                trk_CmdReq	equ 28	; Track command requests
(2)   46/       0 :                     
(2)   47/       0 :                     ; Tracker channel data, 8 bytes each.
(2)   48/       0 : =0H                 chnl_Chip	equ 0		; *** MUST BE AT 0 ***
(2)   49/       0 : =1H                 chnl_Note	equ 1
(2)   50/       0 : =2H                 chnl_Ins	equ 2
(2)   51/       0 : =3H                 chnl_Vol	equ 3
(2)   52/       0 : =4H                 chnl_EffId	equ 4
(2)   53/       0 : =5H                 chnl_EffArg	equ 5
(2)   54/       0 : =6H                 chnl_Type	equ 6		; Impulse-note bits
(2)   55/       0 : =7H                 chnl_Flags	equ 7		; playback requests and other specific bits
(2)   56/       0 :                     
(2)   57/       0 :                     ; --------------------------------------------------------
(2)   58/       0 :                     ; Variables
(2)   59/       0 :                     ; --------------------------------------------------------
(2)   60/       0 :                     
(2)   61/       0 :                     ; To brute force DAC playback
(2)   62/       0 :                     ; on or off
(2)   63/       0 : =0H                 zopcNop		equ	00h
(2)   64/       0 : =8H                 zopcEx		equ	08h
(2)   65/       0 : =C9H                zopcRet		equ 	0C9h
(2)   66/       0 : =D9H                zopcExx		equ	0D9h		; (dac_me ONLY)
(2)   67/       0 : =F5H                zopcPushAf	equ	0F5h		; (dac_fill ONLY)
(2)   68/       0 :                     
(2)   69/       0 :                     ; PSG external control
(2)   70/       0 : =0H                 COM		equ	0
(2)   71/       0 : =4H                 LEV		equ	4
(2)   72/       0 : =8H                 ATK		equ	8
(2)   73/       0 : =CH                 DKY		equ	12
(2)   74/       0 : =10H                SLV		equ	16
(2)   75/       0 : =14H                RRT		equ	20
(2)   76/       0 : =18H                MODE		equ	24
(2)   77/       0 : =1CH                DTL		equ	28
(2)   78/       0 : =20H                DTH		equ	32
(2)   79/       0 : =24H                ALV		equ	36
(2)   80/       0 : =28H                FLG		equ	40
(2)   81/       0 : =2CH                TMR		equ	44
(2)   82/       0 : =30H                PVOL		equ	48
(2)   83/       0 :                     
(2)   84/       0 :                     ; FMCOM		equ	0
(2)   85/       0 : =6H                 FMKEYS		equ	6
(2)   86/       0 : =CH                 FMVOL		equ	12
(2)   87/       0 : =12H                FMPAN 		equ	18
(2)   88/       0 : =18H                FMFRQH		equ	24
(2)   89/       0 : =1EH                FMFRQL		equ	30
(2)   90/       0 :                     
(2)   91/       0 : =0H                 PWCOM		equ	0
(2)   92/       0 : =8H                 PWPTH_V		equ	8	; Volume | Pitch MSB (%VVVVVVPP)
(2)   93/       0 : =10H                PWPHL		equ	16	; Pitch LSB
(2)   94/       0 : =18H                PWOUTF		equ	24	; Output mode/bits + SH2 section (ROM $02 or SDRAM $06)
(2)   95/       0 : =20H                PWINSH		equ	32	; 24-bit sample address
(2)   96/       0 : =28H                PWINSM		equ	40
(2)   97/       0 : =30H                PWINSL		equ	48
(2)   98/       0 :                     
(2)   99/       0 :                     ; ====================================================================
(2)  100/       0 :                     ; --------------------------------------------------------
(2)  101/       0 :                     ; Code starts here
(2)  102/       0 :                     ; --------------------------------------------------------
(2)  103/       0 :                     
(2)  104/       0 : F3                  		di			; Disable interrputs
(2)  105/       1 : ED 56               		im	1		; Interrupt mode 1
(2)  106/       3 : 31 00 20            		ld	sp,2000h	; Set stack at the end of Z80
(2)  107/       6 : 18 36               		jr	z80_init	; Jump to z80_init
(2)  108/       8 :                     
(2)  109/       8 :                     ; --------------------------------------------------------
(2)  110/       8 :                     ; RST 8 (dac_me)
(2)  111/       8 :                     ; *** self-modifiable code ***
(2)  112/       8 :                     ;
(2)  113/       8 :                     ; Writes wave data to DAC using the data stored
(2)  114/       8 :                     ; on the wave buffer. call this routine every 6
(2)  115/       8 :                     ; or more lines of code to keep playing the sample
(2)  116/       8 :                     ; at the desired sample rate while processing code
(2)  117/       8 :                     ;
(2)  118/       8 :                     ; Input (EXX):
(2)  119/       8 :                     ;  c - WAVE buffer MSB
(2)  120/       8 :                     ; de - Pitch (xx.00)
(2)  121/       8 :                     ; h  - WAVE buffer LSB (as xx.00)
(2)  122/       8 :                     ;
(2)  123/       8 :                     ; Uses (EXX):
(2)  124/       8 :                     ; b
(2)  125/       8 :                     ;
(2)  126/       8 :                     ; Notes:
(2)  127/       8 :                     ; call dac_on to enable WAVE playback
(2)  128/       8 :                     ; or
(2)  129/       8 :                     ; call dac_off to disable it (check for FM6 manually)
(2)  130/       8 :                     ; --------------------------------------------------------
(2)  131/       8 :                     
(2)  132/       8 :                     ; NOTE: This plays at 18000hz but we are using
(2)  133/       8 :                     ; 16000hz as the "center" note (C-5)
(2)  134/       8 :                     ; check ZSET_WTUNE if you want change the
(2)  135/       8 :                     ; "center" frequency.
(2)  136/       8 :                     
(2)  137/       8 : (MACRO)             		org 8
(2)  138/       8 : D9                  dac_me:		exx			; <-- this changes between EXX(play) and RET(stop)
(2)  139/       9 : 08                  		ex	af,af'		; Swap af
(2)  140/       A : 45                  		ld	b,l		; Save pitch's .00 to b
(2)  141/       B : 3E 2A               		ld	a,2Ah		; YM register command 2Ah
(2)  142/       D : 32 00 40            		ld	(Zym_ctrl_1),a
(2)  143/      10 : 6C                  		ld	l,h		; L - xx.00 to 00xx
(2)  144/      11 : 61                  		ld	h,c		; H - Wave buffer MSB | 00xx
(2)  145/      12 : 7E                  		ld	a,(hl)		; Now read byte from the wave buffer
(2)  146/      13 : 32 01 40            		ld	(Zym_data_1),a	; and write it to DAC
(2)  147/      16 : 65                  		ld	h,l		; get hl back
(2)  148/      17 : 68                  		ld	l,b		; Get .00 back from b to l
(2)  149/      18 : 19                  		add	hl,de		; Pitch increment hl
(2)  150/      19 : 08                  		ex	af,af'		; return af
(2)  151/      1A : D9                  		exx
(2)  152/      1B : C9                  		ret
(2)  153/      1C :                     
(2)  154/      1C :                     ; --------------------------------------------------------
(2)  155/      1C :                     
(2)  156/      1C : 00                  commZRomBlk	db 0			; 68k ROM block flag
(2)  157/      1D : 00                  commZRomRd	db 0			; Z80 ROM reading flag
(2)  158/      1E : 00                  commZRead	db 0			; cmd read pointer (here)
(2)  159/      1F : 00                  commZWrite	db 0			; cmd fifo wptr (from 68k)
(2)  160/      20 :                     
(2)  161/      20 :                     ; --------------------------------------------------------
(2)  162/      20 :                     ; RST 20h (dac_me)
(2)  163/      20 :                     ; *** self-modifiable code ***
(2)  164/      20 :                     ;
(2)  165/      20 :                     ; Checks if the WAVE cache needs refilling to keep
(2)  166/      20 :                     ; it playing, THIS BREAKS ALL REGISTERS IF
(2)  167/      20 :                     ; REFILL IS NEEDED.
(2)  168/      20 :                     ; --------------------------------------------------------
(2)  169/      20 :                     
(2)  170/      20 : (MACRO)             		org 20h
(2)  171/      20 : F5                  dac_fill:	push	af		; <-- this changes between PUSH AF(playing) and RET(stopped)
(2)  172/      21 : 3A 46 1F            		ld	a,(dDacFifoMid)	; a - Get current wavebuffer LSB (00h or 80h)
(2)  173/      24 : D9                  		exx
(2)  174/      25 : AC                  		xor	h		; 00xx.00
(2)  175/      26 : D9                  		exx
(2)  176/      27 : E6 80               		and	80h		; Check if bit changed
(2)  177/      29 : C2 4F 13            		jp	nz,dac_refill	; If it did, refill and update LSB to check
(2)  178/      2C : F1                  		pop	af
(2)  179/      2D : C9                  		ret
(2)  180/      2E :                     
(2)  181/      2E :                     ; --------------------------------------------------------
(2)  182/      2E :                     
(2)  183/      2E : 00                  x68ksrclsb	db 0		; transferRom temporal LSB
(2)  184/      2F : 00                  x68ksrcmid	db 0		; transferRom temporal MID
(2)  185/      30 : 00                  currTickBits	db 0		; Current Tick/Tempo bitflags (000000BTb B-beat, T-tick)
(2)  186/      31 : 00                  marsUpd		db 0		; flag to request a PWM transfer
(2)  187/      32 : 00                  marsBlock	db 0		; flag to temporally disable PWM communication
(2)  188/      33 : 00                  palMode		db 0		; PAL speed flag (TODO)
(2)  189/      34 : D4 00               sbeatPtck	dw 200+12	; Global tempo (sub beats)
(2)  190/      36 : 00 00               sbeatAcc	dw 0		; Accumulates on each tick to trigger the sub beats
(2)  191/      38 :                     
(2)  192/      38 :                     ; --------------------------------------------------------
(2)  193/      38 :                     ; Z80 Interrupt at 0038h
(2)  194/      38 :                     ;
(2)  195/      38 :                     ; Sets the TICK flag
(2)  196/      38 :                     ; --------------------------------------------------------
(2)  197/      38 :                     
(2)  198/      38 : (MACRO)             		org 38h			; Align 38h
(2)  199/      38 : ED 73 BE 19         		ld	(tickFlag),sp	; Use sp to set TICK flag (xx1F, read as tickFlag+1)
(2)  200/      3C : F3                  		di			; Disable interrupt until next request
(2)  201/      3D : C9                  		ret
(2)  202/      3E :                     
(2)  203/      3E :                     ; --------------------------------------------------------
(2)  204/      3E :                     ; Initilize
(2)  205/      3E :                     ; --------------------------------------------------------
(2)  206/      3E :                     
(2)  207/      3E :                     z80_init:
(2)  208/      3E : CD 1F 0E            		call	gema_init	; Initilize VBLANK sound driver
(2)  209/      41 : FB                  		ei
(2)  210/      42 :                     
(2)  211/      42 :                     ; --------------------------------------------------------
(2)  212/      42 :                     ; MAIN LOOP
(2)  213/      42 :                     ; --------------------------------------------------------
(2)  214/      42 :                     
(2)  215/      42 :                     drv_loop:
(2)  216/      42 : CF                  		rst	8
(2)  217/      43 : CD 84 0E            		call	get_tick		; Check for Tick on VBlank
(2)  218/      46 : E7                  		rst	20h			; first dacfill
(2)  219/      47 : CF                  		rst	8
(2)  220/      48 : 06 00               		ld	b,0			; b - Reset current flags (beat|tick)
(2)  221/      4A : 3A C0 19            		ld	a,(tickCnt)
(2)  222/      4D : D6 01               		sub	1
(2)  223/      4F : 38 0C               		jr	c,.noticks
(2)  224/      51 : 32 C0 19            		ld	(tickCnt),a
(2)  225/      54 : CF                  		rst	8
(2)  226/      55 : CD 8E 0F            		call	chip_env		; Process PSG volume and freqs manually
(2)  227/      58 : CD 84 0E            		call	get_tick		; Check for another tick
(2)  228/      5B : 06 01               		ld 	b,01b			; Set TICK (01b) flag, and clear BEAT
(2)  229/      5D :                     .noticks:
(2)  230/      5D : 3A 37 00            		ld	a,(sbeatAcc+1)		; check beat counter (scaled by tempo)
(2)  231/      60 : D6 01               		sub	1
(2)  232/      62 : 38 06               		jr	c,.nobeats
(2)  233/      64 : 32 37 00            		ld	(sbeatAcc+1),a		; 1/24 beat passed.
(2)  234/      67 : CB C8               		set	1,b			; Set BEAT (10b) flag
(2)  235/      69 : CF                  		rst	8
(2)  236/      6A :                     .nobeats:
(2)  237/      6A : CF                  		rst	8
(2)  238/      6B : 78                  		ld	a,b			; Any beat/tick change?
(2)  239/      6C : B7                  		or	a
(2)  240/      6D : 28 13               		jr	z,.neither
(2)  241/      6F : 32 30 00            		ld	(currTickBits),a	; Save BEAT/TICK bits
(2)  242/      72 : CD 84 0E            		call	get_tick
(2)  243/      75 : CD 3B 05            		call	setupchip		; Send changes to sound chips
(2)  244/      78 : CD 84 0E            		call	get_tick
(2)  245/      7B : CD B9 01            		call	updtrack		; Update track data
(2)  246/      7E : CD 84 0E            		call	get_tick
(2)  247/      81 : CF                  		rst	8
(2)  248/      82 :                     .neither:
(2)  249/      82 : CD AD 04            		call	mars_scomm		; 32X communication for PWM playback
(2)  250/      85 : CD 84 0E            		call	get_tick
(2)  251/      88 : CF                  		rst	8
(2)  252/      89 :                     .next_cmd:
(2)  253/      89 : 3A 1F 00            		ld	a,(commZWrite)		; Check command READ and WRITE indexes
(2)  254/      8C : 47                  		ld	b,a
(2)  255/      8D : 3A 1E 00            		ld	a,(commZRead)
(2)  256/      90 : B8                  		cp	b
(2)  257/      91 : 28 AF               		jr	z,drv_loop		; If both are equal: no requests
(2)  258/      93 : CD 9F 01            		call	get_cmdbyte
(2)  259/      96 : FE FF               		cp	-1			; Got -1? (Start of command)
(2)  260/      98 : 20 A8               		jr	nz,drv_loop
(2)  261/      9A : CD 9F 01            		call	get_cmdbyte		; Read command number
(2)  262/      9D : 87                  		add	a,a			; * 2
(2)  263/      9E : 21 AA 00            		ld	hl,.list		; Then jump to one of these...
(2)  264/      A1 : 16 00               		ld	d,0
(2)  265/      A3 : 5F                  		ld	e,a
(2)  266/      A4 : 19                  		add	hl,de
(2)  267/      A5 : 7E                  		ld	a,(hl)
(2)  268/      A6 : 23                  		inc	hl
(2)  269/      A7 : 66                  		ld	h,(hl)
(2)  270/      A8 : 6F                  		ld	l,a
(2)  271/      A9 : E9                  		jp	(hl)
(2)  272/      AA :                     .list:
(2)  273/      AA : EE 00               		dw .cmnd_trkplay		; $00 - Play
(2)  274/      AC : 4A 01               		dw .cmnd_trkstop		; $01 - Stop/Pause
(2)  275/      AE : 56 01               		dw .cmnd_trkresume		; $02 - Resume
(2)  276/      B0 : EA 00               		dw .cmnd_0			; $03 -
(2)  277/      B2 : EA 00               		dw .cmnd_0			; $04 -
(2)  278/      B4 : EA 00               		dw .cmnd_0			; $05 -
(2)  279/      B6 : EA 00               		dw .cmnd_0			; $06 -
(2)  280/      B8 : EA 00               		dw .cmnd_0			; $07 -
(2)  281/      BA : 63 01               		dw .cmnd_trkticks		; $08 - Set ticks
(2)  282/      BC : EA 00               		dw .cmnd_0			; $09 -
(2)  283/      BE : EA 00               		dw .cmnd_0			; $0A -
(2)  284/      C0 : EA 00               		dw .cmnd_0			; $0B -
(2)  285/      C2 : EA 00               		dw .cmnd_0			; $0C -
(2)  286/      C4 : EA 00               		dw .cmnd_0			; $0D -
(2)  287/      C6 : EA 00               		dw .cmnd_0			; $0E -
(2)  288/      C8 : EA 00               		dw .cmnd_0			; $0F -
(2)  289/      CA : 75 01               		dw .cmnd_trktempo		; $10 - Set global subbeats
(2)  290/      CC : EA 00               		dw .cmnd_0
(2)  291/      CE : EA 00               		dw .cmnd_0
(2)  292/      D0 : EA 00               		dw .cmnd_0
(2)  293/      D2 : EA 00               		dw .cmnd_0			; $14
(2)  294/      D4 : EA 00               		dw .cmnd_0
(2)  295/      D6 : EA 00               		dw .cmnd_0
(2)  296/      D8 : EA 00               		dw .cmnd_0
(2)  297/      DA : EA 00               		dw .cmnd_0			; $18
(2)  298/      DC : EA 00               		dw .cmnd_0
(2)  299/      DE : EA 00               		dw .cmnd_0
(2)  300/      E0 : EA 00               		dw .cmnd_0
(2)  301/      E2 : EA 00               		dw .cmnd_0			; $1C
(2)  302/      E4 : EA 00               		dw .cmnd_0
(2)  303/      E6 : EA 00               		dw .cmnd_0
(2)  304/      E8 : EA 00               		dw .cmnd_0
(2)  305/      EA :                     
(2)  306/      EA :                     ; --------------------------------------------------------
(2)  307/      EA :                     ; Command list
(2)  308/      EA :                     ; --------------------------------------------------------
(2)  309/      EA :                     
(2)  310/      EA :                     .cmnd_0:
(2)  311/      EA : 18 FE               		jr	$			; BAD COMMAND
(2)  312/      EC : 18 9B               		jr	.next_cmd
(2)  313/      EE :                     
(2)  314/      EE :                     ; --------------------------------------------------------
(2)  315/      EE :                     ; $01 - Set NEW track
(2)  316/      EE :                     ; --------------------------------------------------------
(2)  317/      EE :                     
(2)  318/      EE :                     ; Slot
(2)  319/      EE :                     ; Ticks
(2)  320/      EE :                     ; 24-bit patt data
(2)  321/      EE :                     ; 24-bit block data
(2)  322/      EE :                     .cmnd_trkplay:
(2)  323/      EE : CD 9F 01            		call	get_cmdbyte		; Get track slot
(2)  324/      F1 : CD 8A 01            		call	get_trkindx		; and read index iy
(2)  325/      F4 : CD 9F 01            		call	get_cmdbyte		; Get ticks
(2)  326/      F7 : FD 77 15            		ld	(iy+trk_tickSet),a
(2)  327/      FA : CD 9F 01            		call	get_cmdbyte		; Start block
(2)  328/      FD : FD 77 12            		ld	(iy+trk_setBlk),a
(2)  329/     100 : CD 9F 01            		call	get_cmdbyte		; Flag bits
(2)  330/     103 : F6 C0               		or	11000000b		; Enable + First fill bits
(2)  331/     105 : FD 77 13            		ld	(iy+trk_status),a
(2)  332/     108 : CD 9F 01            		call	get_cmdbyte		; Pattern data
(2)  333/     10B : FD 77 03            		ld	(iy+trk_romPatt),a
(2)  334/     10E : CD 9F 01            		call	get_cmdbyte
(2)  335/     111 : FD 77 04            		ld	(iy+(trk_romPatt+1)),a
(2)  336/     114 : CD 9F 01            		call	get_cmdbyte
(2)  337/     117 : FD 77 05            		ld	(iy+(trk_romPatt+2)),a
(2)  338/     11A : CD 9F 01            		call	get_cmdbyte		; Block data
(2)  339/     11D : FD 77 00            		ld	(iy+trk_romBlk),a
(2)  340/     120 : CD 9F 01            		call	get_cmdbyte
(2)  341/     123 : FD 77 01            		ld	(iy+(trk_romBlk+1)),a
(2)  342/     126 : CD 9F 01            		call	get_cmdbyte
(2)  343/     129 : CD 84 0E            		call	get_tick
(2)  344/     12C : FD 77 02            		ld	(iy+(trk_romBlk+2)),a
(2)  345/     12F : CD 9F 01            		call	get_cmdbyte		; Instrument data
(2)  346/     132 : FD 77 06            		ld	(iy+trk_romIns),a
(2)  347/     135 : CD 9F 01            		call	get_cmdbyte
(2)  348/     138 : FD 77 07            		ld	(iy+(trk_romIns+1)),a
(2)  349/     13B : CD 9F 01            		call	get_cmdbyte
(2)  350/     13E : FD 77 08            		ld	(iy+(trk_romIns+2)),a
(2)  351/     141 : 3E 01               		ld	a,1
(2)  352/     143 : FD 77 14            		ld	(iy+trk_tickTmr),a
(2)  353/     146 : CF                  		rst	8
(2)  354/     147 : C3 89 00            		jp	.next_cmd
(2)  355/     14A :                     
(2)  356/     14A :                     ; --------------------------------------------------------
(2)  357/     14A :                     ; $02 - Stop/Pause track
(2)  358/     14A :                     ; --------------------------------------------------------
(2)  359/     14A :                     
(2)  360/     14A :                     .cmnd_trkstop:
(2)  361/     14A : CD 9F 01            		call	get_cmdbyte		; Get track slot
(2)  362/     14D : CD 8A 01            		call	get_trkindx		; and read index iy
(2)  363/     150 : CD 80 04            		call	track_out
(2)  364/     153 : C3 89 00            		jp	.next_cmd
(2)  365/     156 :                     
(2)  366/     156 :                     ; --------------------------------------------------------
(2)  367/     156 :                     ; $04 - Resume track
(2)  368/     156 :                     ; --------------------------------------------------------
(2)  369/     156 :                     
(2)  370/     156 :                     .cmnd_trkresume:
(2)  371/     156 : CD 9F 01            		call	get_cmdbyte		; Get track slot
(2)  372/     159 : CD 8A 01            		call	get_trkindx		; and read index iy
(2)  373/     15C : FD CB 13 FE         		set	7,(iy+trk_status)	; Slot ON
(2)  374/     160 : C3 89 00            		jp	.next_cmd
(2)  375/     163 :                     
(2)  376/     163 :                     ; --------------------------------------------------------
(2)  377/     163 :                     ; $08 - Set track's ticks
(2)  378/     163 :                     ; --------------------------------------------------------
(2)  379/     163 :                     
(2)  380/     163 :                     .cmnd_trkticks:
(2)  381/     163 : CD 9F 01            		call	get_cmdbyte		; Get track slot
(2)  382/     166 : CD 8A 01            		call	get_trkindx		; and read index iyc
(2)  383/     169 : CD 9F 01            		call	get_cmdbyte
(2)  384/     16C : FD 77 15            		ld	(iy+trk_tickSet),a
(2)  385/     16F : FD 77 14            		ld	(iy+trk_tickTmr),a
(2)  386/     172 : C3 89 00            		jp	.next_cmd
(2)  387/     175 :                     
(2)  388/     175 :                     ; --------------------------------------------------------
(2)  389/     175 :                     ; $10 - Set global tempo
(2)  390/     175 :                     ; --------------------------------------------------------
(2)  391/     175 :                     
(2)  392/     175 :                     .cmnd_trktempo:
(2)  393/     175 : CD 9F 01            		call	get_cmdbyte		; Get track slot
(2)  394/     178 : CD 8A 01            		call	get_trkindx		; and read index iyc
(2)  395/     17B : CD 9F 01            		call	get_cmdbyte
(2)  396/     17E : 32 34 00            		ld	(sbeatPtck),a
(2)  397/     181 : CD 9F 01            		call	get_cmdbyte
(2)  398/     184 : 32 35 00            		ld	(sbeatPtck+1),a
(2)  399/     187 : C3 89 00            		jp	.next_cmd
(2)  400/     18A :                     
(2)  401/     18A :                     ; --------------------------------------------------------
(2)  402/     18A :                     ; Pick track buffer
(2)  403/     18A :                     ;
(2)  404/     18A :                     ; a - track index
(2)  405/     18A :                     ; --------------------------------------------------------
(2)  406/     18A :                     
(2)  407/     18A :                     get_trkindx:
(2)  408/     18A : 21 9B 01            		ld	hl,trkPointers
(2)  409/     18D : 87                  		add	a,a
(2)  410/     18E : 16 00               		ld	d,0
(2)  411/     190 : 5F                  		ld	e,a
(2)  412/     191 : CF                  		rst	8
(2)  413/     192 : 19                  		add	hl,de
(2)  414/     193 : 7E                  		ld	a,(hl)
(2)  415/     194 : 23                  		inc	hl
(2)  416/     195 : 66                  		ld	h,(hl)
(2)  417/     196 : 6F                  		ld	l,a
(2)  418/     197 : E5                  		push	hl
(2)  419/     198 : FD E1               		pop	iy
(2)  420/     19A : C9                  		ret
(2)  421/     19B :                     trkPointers:
(2)  422/     19B : 66 17               		dw trkBuff_0
(2)  423/     19D : 0E 18               		dw trkBuff_1
(2)  424/     19F :                     
(2)  425/     19F :                     ; --------------------------------------------------------
(2)  426/     19F :                     ; Read cmd byte, auto re-aligns to 7Fh
(2)  427/     19F :                     ; --------------------------------------------------------
(2)  428/     19F :                     
(2)  429/     19F :                     get_cmdbyte:
(2)  430/     19F : C5                  		push	bc
(2)  431/     1A0 : D5                  		push	de
(2)  432/     1A1 : E5                  		push	hl
(2)  433/     1A2 :                     .getcbytel:
(2)  434/     1A2 :                     ; 		ld	a,(commZWrite)
(2)  435/     1A2 :                     ; 		ld	b,a
(2)  436/     1A2 : 3A 1E 00            		ld	a,(commZRead)
(2)  437/     1A5 :                     ; 		cp	b
(2)  438/     1A5 :                     ; 		jr	z,.getcbytel	; wait for a command from 68k
(2)  439/     1A5 : CF                  		rst	8
(2)  440/     1A6 : 06 00               		ld	b,0
(2)  441/     1A8 : 4F                  		ld	c,a
(2)  442/     1A9 : 21 00 1F            		ld	hl,commZfifo
(2)  443/     1AC : 09                  		add	hl,bc
(2)  444/     1AD : 3C                  		inc	a
(2)  445/     1AE : E6 3F               		and	3Fh		; command list limit
(2)  446/     1B0 : CF                  		rst	8
(2)  447/     1B1 : 32 1E 00            		ld	(commZRead),a
(2)  448/     1B4 : 7E                  		ld	a,(hl)		; a - the byte we got
(2)  449/     1B5 : E1                  		pop	hl
(2)  450/     1B6 : D1                  		pop	de
(2)  451/     1B7 : C1                  		pop	bc
(2)  452/     1B8 : C9                  		ret
(2)  453/     1B9 :                     
(2)  454/     1B9 :                     ; ====================================================================
(2)  455/     1B9 :                     ; ----------------------------------------------------------------
(2)  456/     1B9 :                     ; Sound playback code
(2)  457/     1B9 :                     ; ----------------------------------------------------------------
(2)  458/     1B9 :                     
(2)  459/     1B9 :                     ; --------------------------------------------------------
(2)  460/     1B9 :                     ; Read track data
(2)  461/     1B9 :                     ; --------------------------------------------------------
(2)  462/     1B9 :                     
(2)  463/     1B9 :                     updtrack:
(2)  464/     1B9 : E7                  		rst	20h
(2)  465/     1BA : FD 21 66 17         		ld	iy,trkBuff_0		; BGM
(2)  466/     1BE : CF                  		rst	8
(2)  467/     1BF : 11 B6 18            		ld	de,insDataC_0
(2)  468/     1C2 : CD D1 01            		call	.read_track
(2)  469/     1C5 : FD 21 0E 18         		ld	iy,trkBuff_1		; SFX
(2)  470/     1C9 : 11 36 19            		ld	de,insDataC_1
(2)  471/     1CC : CF                  		rst	8
(2)  472/     1CD : CD D1 01            		call	.read_track
(2)  473/     1D0 : C9                  		ret
(2)  474/     1D1 :                     
(2)  475/     1D1 :                     ; ----------------------------------------
(2)  476/     1D1 :                     ; Read current track
(2)  477/     1D1 :                     ;
(2)  478/     1D1 :                     ; iy - Track control
(2)  479/     1D1 :                     ; ix - Track channels
(2)  480/     1D1 :                     ; de - Instrument CACHE point
(2)  481/     1D1 :                     ; ----------------------------------------
(2)  482/     1D1 :                     
(2)  483/     1D1 :                     .read_track:
(2)  484/     1D1 : FD 46 13            		ld	b,(iy+trk_status)	; b - Track status
(2)  485/     1D4 : CB 78               		bit	7,b			; Active?
(2)  486/     1D6 : C8                  		ret	z
(2)  487/     1D7 : FD 7E 1C            		ld	a,(iy+trk_CmdReq)	; Any mid-request?
(2)  488/     1DA : B7                  		or	a
(2)  489/     1DB : C0                  		ret	nz
(2)  490/     1DC : ED 53 B6 19         		ld	(currInsData),de	; save temporal InsData
(2)  491/     1E0 : CF                  		rst	8
(2)  492/     1E1 : 3A 30 00            		ld	a,(currTickBits)	; a - Tick/Beat bits
(2)  493/     1E4 : CB 40               		bit	0,b			; This track uses Beats?
(2)  494/     1E6 : 28 03               		jr	z,.sfxmd		; Nope
(2)  495/     1E8 : CB 4F               		bit	1,a			; BEAT passed?
(2)  496/     1EA : C8                  		ret	z
(2)  497/     1EB :                     .sfxmd:
(2)  498/     1EB : CB 47               		bit	0,a			; TICK passed?
(2)  499/     1ED : C8                  		ret	z
(2)  500/     1EE : FD 7E 14            		ld	a,(iy+trk_tickTmr)	; TICK timer for this track
(2)  501/     1F1 : 3D                  		dec	a
(2)  502/     1F2 : FD 77 14            		ld	(iy+trk_tickTmr),a
(2)  503/     1F5 : CF                  		rst	8
(2)  504/     1F6 : B7                  		or	a
(2)  505/     1F7 : C0                  		ret	nz			; If != 0, exit
(2)  506/     1F8 : CB 68               		bit	5,b			; Effect-requested track set?
(2)  507/     1FA : C4 02 04            		call	nz,.effect_fill
(2)  508/     1FD : CB 70               		bit	6,b			; Restart/First time?
(2)  509/     1FF : C4 0A 04            		call	nz,.first_fill
(2)  510/     202 : FD 7E 15            		ld	a,(iy+trk_tickSet)	; Set new tick timer
(2)  511/     205 : FD 77 14            		ld	(iy+trk_tickTmr),a
(2)  512/     208 : CF                  		rst	8
(2)  513/     209 : FD 6E 0C            		ld	l,(iy+trk_Read)		; hl - Pattern data to read in cache
(2)  514/     20C : FD 66 0D            		ld	h,(iy+((trk_Read+1)))
(2)  515/     20F : FD 4E 0E            		ld	c,(iy+trk_Rows)		; bc - Set row counter
(2)  516/     212 : FD 46 0F            		ld	b,(iy+(trk_Rows+1))
(2)  517/     215 : 79                  		ld	a,c
(2)  518/     216 : B0                  		or	b
(2)  519/     217 : CC 5C 03            		call	z,.next_track		; If rowtimer == 0, get next track data
(2)  520/     21A : FE FF               		cp	-1			; or exit.
(2)  521/     21C : C8                  		ret	z
(2)  522/     21D : CF                  		rst	8
(2)  523/     21E :                     
(2)  524/     21E :                     ; --------------------------------
(2)  525/     21E :                     ; Main reading loop
(2)  526/     21E :                     ; --------------------------------
(2)  527/     21E :                     
(2)  528/     21E :                     .next_note:
(2)  529/     21E : FD 7E 17            		ld	a,(iy+trk_rowPause)	; Check rowtimer
(2)  530/     221 : B7                  		or	a
(2)  531/     222 : 20 17               		jr	nz,.decrow
(2)  532/     224 : 7E                  		ld	a,(hl)			; Check if timer or note
(2)  533/     225 : B7                  		or	a
(2)  534/     226 : 28 08               		jr	z,.exit			; If == 00h: exit
(2)  535/     228 : FA 47 02            		jp	m,.has_note		; 80h-0FFh: note data
(2)  536/     22B : FD 77 17            		ld	(iy+trk_rowPause),a
(2)  537/     22E : 18 00               		jr	.exit			; make row-timer, set hl+1
(2)  538/     230 :                     
(2)  539/     230 :                     ; --------------------------------
(2)  540/     230 :                     ; Exit
(2)  541/     230 :                     ; --------------------------------
(2)  542/     230 :                     
(2)  543/     230 :                     .exit:
(2)  544/     230 : CD E3 02            		call	.inc_cpatt
(2)  545/     233 : FD 75 0C            		ld	(iy+trk_Read),l		; Update read location
(2)  546/     236 : FD 74 0D            		ld	(iy+((trk_Read+1))),h
(2)  547/     239 : 18 03               		jr	.decrow_e
(2)  548/     23B :                     .decrow:
(2)  549/     23B : FD 35 17            		dec	(iy+trk_rowPause)
(2)  550/     23E :                     .decrow_e:
(2)  551/     23E : CF                  		rst	8
(2)  552/     23F : 0B                  		dec	bc			; Decrement this row
(2)  553/     240 : FD 71 0E            		ld	(iy+trk_Rows),c		; And update it
(2)  554/     243 : FD 70 0F            		ld	(iy+(trk_Rows+1)),b
(2)  555/     246 : C9                  		ret
(2)  556/     247 :                     
(2)  557/     247 :                     ; --------------------------------
(2)  558/     247 :                     ; New note request
(2)  559/     247 :                     ; --------------------------------
(2)  560/     247 :                     
(2)  561/     247 :                     .has_note:
(2)  562/     247 : C5                  		push	bc			; Save rowcount
(2)  563/     248 : 4F                  		ld	c,a			; c - Copy of control+channel
(2)  564/     249 : CD E3 02            		call	.inc_cpatt
(2)  565/     24C : 79                  		ld	a,c
(2)  566/     24D : FD E5               		push	iy
(2)  567/     24F : DD E1               		pop	ix
(2)  568/     251 : 11 20 00            		ld	de,20h			; Point to track-data
(2)  569/     254 : DD 19               		add	ix,de
(2)  570/     256 : CF                  		rst	8
(2)  571/     257 : E6 3F               		and	00111111b
(2)  572/     259 :                     ; 		cp	(iy+trk_numChnls)	; TODO: mala idea.
(2)  573/     259 :                     ; 		jp	nc,.rnout_chnls
(2)  574/     259 : 87                  		add	a,a			; * 8
(2)  575/     25A : 87                  		add	a,a
(2)  576/     25B : 87                  		add	a,a
(2)  577/     25C : 16 00               		ld 	d,0
(2)  578/     25E : 5F                  		ld	e,a
(2)  579/     25F : DD 19               		add	ix,de
(2)  580/     261 : CF                  		rst	8
(2)  581/     262 : DD 46 06            		ld	b,(ix+chnl_Type)	; b - last Note type
(2)  582/     265 : CB 71               		bit	6,c			; Next byte is new type?
(2)  583/     267 : 28 06               		jr	z,.old_type
(2)  584/     269 : 7E                  		ld	a,(hl)
(2)  585/     26A : DD 77 06            		ld	(ix+chnl_Type),a
(2)  586/     26D : 47                  		ld	b,a
(2)  587/     26E : 2C                  		inc 	l
(2)  588/     26F :                     .old_type:
(2)  589/     26F :                     	; b - evinEVIN
(2)  590/     26F :                     	;     E-effect/V-volume/I-instrument/N-note
(2)  591/     26F :                     	;     evin: byte is already stored on track-channel buffer
(2)  592/     26F :                     	;     EVIN: next byte(s) contain a new value, for eff:2 bytes
(2)  593/     26F : CF                  		rst	8
(2)  594/     270 : CB 40               		bit	0,b
(2)  595/     272 : 28 07               		jr	z,.no_note
(2)  596/     274 : 7E                  		ld	a,(hl)
(2)  597/     275 : DD 77 01            		ld	(ix+chnl_Note),a
(2)  598/     278 : CD E3 02            		call	.inc_cpatt
(2)  599/     27B :                     .no_note:
(2)  600/     27B : CB 48               		bit	1,b
(2)  601/     27D : 28 07               		jr	z,.no_ins
(2)  602/     27F : 7E                  		ld	a,(hl)
(2)  603/     280 : DD 77 02            		ld	(ix+chnl_Ins),a
(2)  604/     283 : CD E3 02            		call	.inc_cpatt
(2)  605/     286 :                     .no_ins:
(2)  606/     286 : CF                  		rst	8
(2)  607/     287 : CB 50               		bit	2,b
(2)  608/     289 : 28 07               		jr	z,.no_vol
(2)  609/     28B : 7E                  		ld	a,(hl)
(2)  610/     28C : DD 77 03            		ld	(ix+chnl_Vol),a
(2)  611/     28F : CD E3 02            		call	.inc_cpatt
(2)  612/     292 :                     .no_vol:
(2)  613/     292 : CB 58               		bit	3,b
(2)  614/     294 : 28 0E               		jr	z,.no_eff
(2)  615/     296 : 7E                  		ld	a,(hl)
(2)  616/     297 : DD 77 04            		ld	(ix+chnl_EffId),a
(2)  617/     29A : CD E3 02            		call	.inc_cpatt
(2)  618/     29D : 7E                  		ld	a,(hl)
(2)  619/     29E : DD 77 05            		ld	(ix+chnl_EffArg),a
(2)  620/     2A1 : CD E3 02            		call	.inc_cpatt
(2)  621/     2A4 :                     .no_eff:
(2)  622/     2A4 : CF                  		rst	8
(2)  623/     2A5 : 78                  		ld	a,b			; Merge the Impulse recycle bits to main bits
(2)  624/     2A6 : CB 3F               		srl	a
(2)  625/     2A8 : CB 3F               		srl	a
(2)  626/     2AA : CB 3F               		srl	a
(2)  627/     2AC : CB 3F               		srl	a
(2)  628/     2AE : E6 0F               		and	00001111b
(2)  629/     2B0 : 4F                  		ld	c,a
(2)  630/     2B1 : CF                  		rst	8
(2)  631/     2B2 : 78                  		ld	a,b
(2)  632/     2B3 : E6 0F               		and	00001111b
(2)  633/     2B5 : B1                  		or	c
(2)  634/     2B6 : 4F                  		ld	c,a
(2)  635/     2B7 : DD 7E 07            		ld	a,(ix+chnl_Flags)
(2)  636/     2BA : B1                  		or	c
(2)  637/     2BB : DD 77 07            		ld	(ix+chnl_Flags),a
(2)  638/     2BE : CF                  		rst	8
(2)  639/     2BF : C1                  		pop	bc			; Restore rowcount
(2)  640/     2C0 :                     
(2)  641/     2C0 :                     	; Check for effects that change things
(2)  642/     2C0 :                     	; to internal playback (jump, tempo, etc.)
(2)  643/     2C0 : E6 08               		and	1000b		; Filter EFFECT bit only
(2)  644/     2C2 : B7                  		or	a
(2)  645/     2C3 : CA 1E 02            		jp	z,.next_note
(2)  646/     2C6 : DD 7E 04            		ld	a,(ix+chnl_EffId)
(2)  647/     2C9 : B7                  		or	a		; 00h = invalid effect
(2)  648/     2CA : CA 1E 02            		jp	z,.next_note
(2)  649/     2CD : FE 01               		cp	1		; Effect A: Tick set
(2)  650/     2CF : CC 2D 03            		call	z,.eff_A
(2)  651/     2D2 : FE 02               		cp	2		; Effect B: Position Jump
(2)  652/     2D4 : CC 37 03            		call	z,.eff_B
(2)  653/     2D7 : FE 03               		cp	3		; Effect C: Pattern break
(2)  654/     2D9 : CC 51 03            		call	z,.eff_C
(2)  655/     2DC : C3 1E 02            		jp	.next_note
(2)  656/     2DF :                     .rnout_chnls:
(2)  657/     2DF : C1                  		pop	bc
(2)  658/     2E0 : C3 1E 02            		jp	.next_note
(2)  659/     2E3 :                     
(2)  660/     2E3 :                     ; ----------------------------------------
(2)  661/     2E3 :                     ; Call this to increment the
(2)  662/     2E3 :                     ; cache pattern read pointer (iy+trk_Read)
(2)  663/     2E3 :                     ; it also refills the next section to
(2)  664/     2E3 :                     ; read if needed.
(2)  665/     2E3 :                     ;
(2)  666/     2E3 :                     ; NOTE: breaks A
(2)  667/     2E3 :                     ; ----------------------------------------
(2)  668/     2E3 :                     
(2)  669/     2E3 :                     .inc_cpatt:
(2)  670/     2E3 : 2C                  		inc	l
(2)  671/     2E4 : FD 7E 13            		ld	a,(iy+trk_status)	; Increment-fill enabled?
(2)  672/     2E7 : E6 10               		and	00010000b
(2)  673/     2E9 : B7                  		or	a
(2)  674/     2EA : C8                  		ret	z
(2)  675/     2EB : CF                  		rst	8
(2)  676/     2EC : FD 7E 10            		ld	a,(iy+trk_Halfway)
(2)  677/     2EF : AD                  		xor	l
(2)  678/     2F0 : E6 80               		and	080h			; Check for 00h/80h
(2)  679/     2F2 : C8                  		ret	z
(2)  680/     2F3 : CF                  		rst	8
(2)  681/     2F4 : 3A 1C 00            		ld	a,(commZRomBlk)		; Got mid-DMA?
(2)  682/     2F7 : B7                  		or	a
(2)  683/     2F8 : 28 06               		jr	z,.grab_asap
(2)  684/     2FA : 7D                  		ld	a,l			; Last chance
(2)  685/     2FB : E6 7F               		and	07Fh
(2)  686/     2FD : FE 70               		cp	070h
(2)  687/     2FF : D8                  		ret	c
(2)  688/     300 :                     .grab_asap:
(2)  689/     300 : E7                  		rst	20h			; refill request
(2)  690/     301 : FD 7E 10            		ld	a,(iy+trk_Halfway)	; +80h to halfway
(2)  691/     304 : 54                  		ld	d,h
(2)  692/     305 : 5F                  		ld	e,a
(2)  693/     306 : CF                  		rst	8
(2)  694/     307 : C6 80               		add 	a,080h
(2)  695/     309 : FD 77 10            		ld	(iy+trk_Halfway),a
(2)  696/     30C : E5                  		push	hl
(2)  697/     30D : C5                  		push	bc
(2)  698/     30E : 01 80 00            		ld	bc,80h			; 80h size + increment value
(2)  699/     311 : FD 6E 09            		ld	l,(iy+trk_romPattRd)
(2)  700/     314 : FD 66 0A            		ld	h,(iy+(trk_romPattRd+1))
(2)  701/     317 : CF                  		rst	8
(2)  702/     318 : FD 7E 0B            		ld	a,(iy+(trk_romPattRd+2))
(2)  703/     31B : 09                  		add	hl,bc
(2)  704/     31C : CE 00               		adc	a,0
(2)  705/     31E : FD 75 09            		ld	(iy+trk_romPattRd),l
(2)  706/     321 : FD 74 0A            		ld	(iy+(trk_romPattRd+1)),h
(2)  707/     324 : FD 77 0B            		ld	(iy+(trk_romPattRd+2)),a
(2)  708/     327 : CD F3 0E            		call	transferRom
(2)  709/     32A : C1                  		pop	bc
(2)  710/     32B : E1                  		pop	hl
(2)  711/     32C : C9                  		ret
(2)  712/     32D :                     
(2)  713/     32D :                     ; ----------------------------------------
(2)  714/     32D :                     ; Effect A: Set ticks
(2)  715/     32D :                     ; ----------------------------------------
(2)  716/     32D :                     
(2)  717/     32D :                     .eff_A:
(2)  718/     32D : DD 5E 05            		ld	e,(ix+chnl_EffArg)	; e - ticks number
(2)  719/     330 : FD 73 15            		ld	(iy+trk_tickSet),e	; set for both Set and Timer.
(2)  720/     333 : FD 73 14            		ld	(iy+trk_tickTmr),e
(2)  721/     336 : C9                  		ret
(2)  722/     337 :                     
(2)  723/     337 :                     ; ----------------------------------------
(2)  724/     337 :                     ; Effect B: jump to a new block
(2)  725/     337 :                     ; ----------------------------------------
(2)  726/     337 :                     
(2)  727/     337 :                     .eff_B:
(2)  728/     337 : F5                  		push	af
(2)  729/     338 : DD 5E 05            		ld	e,(ix+chnl_EffArg)	; e - Block SLOT to jump
(2)  730/     33B : FD 73 11            		ld 	(iy+trk_currBlk),e
(2)  731/     33E : CF                  		rst	8
(2)  732/     33F : FD 36 17 00         		ld	(iy+trk_rowPause),0	; Reset rowpause
(2)  733/     343 : DD 36 04 00         		ld	(ix+chnl_EffId),0	; (failsafe)
(2)  734/     347 : DD 36 05 00         		ld	(ix+chnl_EffArg),0
(2)  735/     34B : FD CB 13 EE         		set	5,(iy+trk_status)	; set fill-from-effect flag on exit
(2)  736/     34F : F1                  		pop	af
(2)  737/     350 : C9                  		ret
(2)  738/     351 :                     
(2)  739/     351 :                     ; ----------------------------------------
(2)  740/     351 :                     ; Effect C: Pattern break/exit
(2)  741/     351 :                     ; ***Not exactly as in Impulse but
(2)  742/     351 :                     ; jumps to the next block
(2)  743/     351 :                     ;
(2)  744/     351 :                     ; If set to -1 it will end the track,
(2)  745/     351 :                     ; so you can put multiple SFX into the
(2)  746/     351 :                     ; track file and call them by block.
(2)  747/     351 :                     ; ----------------------------------------
(2)  748/     351 :                     
(2)  749/     351 :                     .eff_C:
(2)  750/     351 : 01 00 00            		ld	bc,0			; clear rowcount
(2)  751/     354 : DD 7E 05            		ld	a,(ix+chnl_EffArg)
(2)  752/     357 : FE FF               		cp	-1			; EffArg == -1?
(2)  753/     359 : CA 6E 04            		jp	z,.trkend_effC		; Use it as track-end (for SFX)
(2)  754/     35C :                     
(2)  755/     35C :                     ; ----------------------------------------
(2)  756/     35C :                     ; If pattern finished, load the next one
(2)  757/     35C :                     ; ----------------------------------------
(2)  758/     35C :                     
(2)  759/     35C :                     .next_track:
(2)  760/     35C : FD 7E 11            		ld	a,(iy+trk_currBlk)	; Increment next block
(2)  761/     35F : 3C                  		inc	a
(2)  762/     360 : FD 77 11            		ld 	(iy+trk_currBlk),a
(2)  763/     363 :                     
(2)  764/     363 :                     ; Load track data to cache
(2)  765/     363 :                     ; a - Block
(2)  766/     363 :                     ;
(2)  767/     363 :                     ; hl - trk_read on halfway
(2)  768/     363 :                     .set_track:
(2)  769/     363 : CF                  		rst	8
(2)  770/     364 : FD 36 10 80         		ld	(iy+trk_Halfway),80h	; Reset halfway
(2)  771/     368 :                     ; 		ld	l,(iy+trk_CachNotes)	; Set trk_read point on halfway
(2)  772/     368 :                     ; 		ld	h,(iy+(trk_CachNotes+1))
(2)  773/     368 :                     ; 		ld	de,80h
(2)  774/     368 :                     ; 		add	hl,de
(2)  775/     368 : 2E 00               		ld	l,0			; quick reset trk_read
(2)  776/     36A : FD 75 0C            		ld	(iy+trk_Read),l
(2)  777/     36D : FD 74 0D            		ld	(iy+((trk_Read+1))),h
(2)  778/     370 :                     
(2)  779/     370 : E5                  		push	hl			; Save hl
(2)  780/     371 : 11 00 00            		ld	de,0
(2)  781/     374 : 5F                  		ld	e,a
(2)  782/     375 : CF                  		rst	8
(2)  783/     376 : FD 6E 00            		ld	l,(iy+trk_romBlk)	; Get block position
(2)  784/     379 : FD 66 01            		ld	h,(iy+(trk_romBlk+1))	; directly from ROM
(2)  785/     37C : FD 7E 02            		ld	a,(iy+(trk_romBlk+2))
(2)  786/     37F : 19                  		add	hl,de
(2)  787/     380 : CE 00               		adc	a,0
(2)  788/     382 : 47                  		ld	b,a
(2)  789/     383 : CF                  		rst	8
(2)  790/     384 : CD A5 0E            		call	showRom
(2)  791/     387 : CD C6 0E            		call	readRomB
(2)  792/     38A : FE FF               		cp	-1			; if block == -1, end
(2)  793/     38C : CA 6D 04            		jp	z,.track_end
(2)  794/     38F :                     
(2)  795/     38F :                     	; a - head index
(2)  796/     38F : 87                  		add	a,a
(2)  797/     390 : 87                  		add	a,a
(2)  798/     391 : 16 00               		ld	d,0
(2)  799/     393 : 5F                  		ld	e,a
(2)  800/     394 : FD 6E 03            		ld	l,(iy+trk_romPatt)
(2)  801/     397 : CF                  		rst	8
(2)  802/     398 : FD 66 04            		ld	h,(iy+(trk_romPatt+1))
(2)  803/     39B : FD 7E 05            		ld	a,(iy+(trk_romPatt+2))
(2)  804/     39E : 19                  		add	hl,de
(2)  805/     39F : CE 00               		adc	a,0
(2)  806/     3A1 : 11 49 1F            		ld	de,trkHdOut
(2)  807/     3A4 : D5                  		push	de
(2)  808/     3A5 : 01 06 00            		ld	bc,6			; thispoint, rowcount, nextpoint
(2)  809/     3A8 : CD F3 0E            		call	transferRom
(2)  810/     3AB : E1                  		pop	hl
(2)  811/     3AC : 5E                  		ld	e,(hl)			; de - pointer increment
(2)  812/     3AD : 23                  		inc	hl
(2)  813/     3AE : 56                  		ld	d,(hl)
(2)  814/     3AF : 23                  		inc	hl
(2)  815/     3B0 : 4E                  		ld	c,(hl)			; bc - row count
(2)  816/     3B1 : 23                  		inc	hl
(2)  817/     3B2 : 46                  		ld	b,(hl)
(2)  818/     3B3 : CF                  		rst	8
(2)  819/     3B4 : FD 71 0E            		ld	(iy+trk_Rows),c		; Save this number of rows to buffer
(2)  820/     3B7 : FD 70 0F            		ld	(iy+(trk_Rows+1)),b	; on Tick pauses
(2)  821/     3BA : C5                  		push	bc			; Save bc
(2)  822/     3BB : E7                  		rst	20h			; refill wave
(2)  823/     3BC :                     
(2)  824/     3BC :                     	; Detect pattern size... last moment addition
(2)  825/     3BC :                     	; for patterns lower than 80h.
(2)  826/     3BC :                     	; This saves cycles if using SFX
(2)  827/     3BC :                     	; hl - next pattern point (includes final)
(2)  828/     3BC :                     	; de - this pattern
(2)  829/     3BC :                     	; bc - final size for transferRom
(2)  830/     3BC : 3A 4D 1F            		ld	a,(trkHdOut+4)	; hl - de
(2)  831/     3BF : 6F                  		ld	l,a
(2)  832/     3C0 : 3A 4E 1F            		ld	a,(trkHdOut+5)
(2)  833/     3C3 : 67                  		ld	h,a
(2)  834/     3C4 : 3F                  		ccf			; remove carry first
(2)  835/     3C5 : ED 52               		sbc	hl,de
(2)  836/     3C7 : FD 4E 13            		ld	c,(iy+trk_status)
(2)  837/     3CA : CB A1               		res	4,c
(2)  838/     3CC : 7C                  		ld	a,h		; h == 0?
(2)  839/     3CD : B7                  		or	a
(2)  840/     3CE :                     ; 		jp	m,$
(2)  841/     3CE : 20 04               		jr	nz,.szmuch
(2)  842/     3D0 : CB 7D               		bit	7,l
(2)  843/     3D2 : 28 05               		jr	z,.szgood
(2)  844/     3D4 :                     .szmuch:
(2)  845/     3D4 : 21 80 00            		ld	hl,080h			; bc - max transfer size 080h
(2)  846/     3D7 : CB E1               		set	4,c
(2)  847/     3D9 :                     .szgood:
(2)  848/     3D9 : FD 71 13            		ld	(iy+trk_status),c
(2)  849/     3DC : 44                  		ld	b,h
(2)  850/     3DD : 4D                  		ld	c,l
(2)  851/     3DE : FD 6E 03            		ld	l,(iy+trk_romPatt)	; hl - ROM pattern data pointer
(2)  852/     3E1 : FD 66 04            		ld	h,(iy+(trk_romPatt+1))
(2)  853/     3E4 : FD 7E 05            		ld	a,(iy+(trk_romPatt+2))
(2)  854/     3E7 : 19                  		add	hl,de			; hl + de
(2)  855/     3E8 : CE 00               		adc	a,0			; and highest byte too.
(2)  856/     3EA : CF                  		rst	8
(2)  857/     3EB : FD 75 09            		ld	(iy+trk_romPattRd),l	; Save copy of the pointer for READ
(2)  858/     3EE : FD 74 0A            		ld	(iy+(trk_romPattRd+1)),h
(2)  859/     3F1 : FD 77 0B            		ld	(iy+(trk_romPattRd+2)),a
(2)  860/     3F4 : FD 56 0D            		ld	d,(iy+(trk_Read+1))	; de - destination to data CACHE
(2)  861/     3F7 : FD 5E 0C            		ld	e,(iy+trk_Read)
(2)  862/     3FA :                     ; 		ld	bc,080h			; bc - 080h
(2)  863/     3FA : CD F3 0E            		call	transferRom
(2)  864/     3FD : CF                  		rst	8
(2)  865/     3FE : C1                  		pop	bc			; Get bc back
(2)  866/     3FF : E1                  		pop	hl			; hl too.
(2)  867/     400 : AF                  		xor	a			; return 0
(2)  868/     401 : C9                  		ret
(2)  869/     402 :                     
(2)  870/     402 :                     ; ----------------------------------------
(2)  871/     402 :                     ; First time playing or moving
(2)  872/     402 :                     ; to next track.
(2)  873/     402 :                     ; ----------------------------------------
(2)  874/     402 :                     
(2)  875/     402 :                     .effect_fill:
(2)  876/     402 : E7                  		rst	20h			; Refill wave data
(2)  877/     403 : CB A8               		res	5,b			; Reset refill-from-effect flag
(2)  878/     405 : FD 70 13            		ld	(iy+trk_status),b
(2)  879/     408 : 18 36               		jr	.go_effect
(2)  880/     40A :                     ; 		call	.go_effect
(2)  881/     40A :                     ; 		ret
(2)  882/     40A :                     
(2)  883/     40A :                     ; returns bc as row counter
(2)  884/     40A :                     .first_fill:
(2)  885/     40A : E7                  		rst	20h
(2)  886/     40B : CB B0               		res	6,b			; Reset FILL flag
(2)  887/     40D : FD 70 13            		ld	(iy+trk_status),b
(2)  888/     410 : FD E5               		push	iy
(2)  889/     412 : DD E1               		pop	ix			; copy iy to ix
(2)  890/     414 : 11 20 00            		ld	de,20h			; go to channel data
(2)  891/     417 : DD 19               		add	ix,de
(2)  892/     419 : CF                  		rst	8
(2)  893/     41A : 01 00 00            		ld	bc,0
(2)  894/     41D : 11 08 00            		ld	de,8
(2)  895/     420 : 06 11               		ld	b,MAX_TRKCHN
(2)  896/     422 :                     .clrf:
(2)  897/     422 : CF                  		rst	8
(2)  898/     423 : DD 7E 00            		ld	a,(ix+chnl_Chip)
(2)  899/     426 : B7                  		or	a
(2)  900/     427 : 28 09               		jr	z,.nochip
(2)  901/     429 : DD 36 01 FE         		ld	(ix+chnl_Note),-2
(2)  902/     42D : DD 36 07 01         		ld	(ix+chnl_Flags),1
(2)  903/     431 : CF                  		rst	8
(2)  904/     432 :                     .nochip:
(2)  905/     432 : DD 19               		add	ix,de
(2)  906/     434 : 10 EC               		djnz	.clrf
(2)  907/     436 : FD 36 17 00         		ld	(iy+trk_rowPause),0	; Reset row timer
(2)  908/     43A : FD 7E 12            		ld	a,(iy+trk_setBlk)	; Set current block
(2)  909/     43D : FD 77 11            		ld 	(iy+trk_currBlk),a
(2)  910/     440 :                     .go_effect:
(2)  911/     440 : CF                  		rst	8			; First cache fills
(2)  912/     441 : FD 6E 06            		ld	l,(iy+trk_romIns)	; Recieve almost 100h of instrument pointers
(2)  913/     444 : FD 66 07            		ld	h,(iy+(trk_romIns+1))	; NOTE: transferRom can't do 100h
(2)  914/     447 : FD 7E 08            		ld	a,(iy+(trk_romIns+2))
(2)  915/     44A : ED 5B B6 19         		ld	de,(currInsData)
(2)  916/     44E : 06 00               		ld	b,0
(2)  917/     450 : FD 4E 16            		ld	c,(iy+trk_sizeIns)
(2)  918/     453 : CD F3 0E            		call	transferRom
(2)  919/     456 : CF                  		rst	8
(2)  920/     457 : FD 6E 1A            		ld	l,(iy+trk_CachNotes)	; Read first cache notes
(2)  921/     45A : FD 66 1B            		ld	h,(iy+(trk_CachNotes+1))
(2)  922/     45D : 11 80 00            		ld	de,80h
(2)  923/     460 : 19                  		add	hl,de
(2)  924/     461 : FD 75 0C            		ld	(iy+trk_Read),l
(2)  925/     464 : FD 74 0D            		ld	(iy+((trk_Read+1))),h
(2)  926/     467 : FD 7E 11            		ld	a,(iy+trk_currBlk)
(2)  927/     46A : C3 63 03            		jp	.set_track
(2)  928/     46D :                     
(2)  929/     46D :                     ; If -1, track ends
(2)  930/     46D :                     ; Automutes channels too.
(2)  931/     46D :                     .track_end:
(2)  932/     46D : E1                  		pop	hl			; Get hl back
(2)  933/     46E :                     .trkend_effC:
(2)  934/     46E : CD 80 04            		call	track_out
(2)  935/     471 : CF                  		rst	8
(2)  936/     472 : FD 36 17 00         		ld	(iy+trk_rowPause),0
(2)  937/     476 : FD 36 14 00         		ld	(iy+trk_tickTmr),0
(2)  938/     47A : 01 00 00            		ld	bc,0			; Set bc rowcount to 0
(2)  939/     47D : 3E FF               		ld	a,-1			; Return -1
(2)  940/     47F : C9                  		ret
(2)  941/     480 :                     
(2)  942/     480 :                     ; ----------------------------------------
(2)  943/     480 :                     ; Delete all track data
(2)  944/     480 :                     ; ----------------------------------------
(2)  945/     480 :                     
(2)  946/     480 :                     track_out:
(2)  947/     480 : FD E5               		push	iy
(2)  948/     482 : DD E1               		pop	ix
(2)  949/     484 : 11 20 00            		ld	de,20h
(2)  950/     487 : DD 19               		add	ix,de
(2)  951/     489 : CF                  		rst	8
(2)  952/     48A : 11 08 00            		ld	de,8
(2)  953/     48D : 06 11               		ld	b,MAX_TRKCHN
(2)  954/     48F :                     .clrfe:
(2)  955/     48F : DD 7E 00            		ld	a,(ix+chnl_Chip)
(2)  956/     492 : B7                  		or	a
(2)  957/     493 : 28 0E               		jr	z,.nochip
(2)  958/     495 : DD 36 01 FE         		ld	(ix+chnl_Note),-2
(2)  959/     499 : DD 7E 07            		ld	a,(ix+chnl_Flags)
(2)  960/     49C : E6 F0               		and	11110000b
(2)  961/     49E : F6 01               		or	1
(2)  962/     4A0 : DD 77 07            		ld	(ix+chnl_Flags),a
(2)  963/     4A3 :                     .nochip:
(2)  964/     4A3 : DD 19               		add	ix,de
(2)  965/     4A5 : 10 E8               		djnz	.clrfe
(2)  966/     4A7 : 3E FF               		ld	a,-1			; STOPALL track command
(2)  967/     4A9 : FD 77 1C            		ld	(iy+trk_CmdReq),a
(2)  968/     4AC : C9                  		ret
(2)  969/     4AD :                     
(2)  970/     4AD :                     ; --------------------------------------------------------
(2)  971/     4AD :                     ; ** 32X ONLY ***
(2)  972/     4AD :                     ; Communicate to Slave SH2 to play
(2)  973/     4AD :                     ; PWM sound channels
(2)  974/     4AD :                     ; --------------------------------------------------------
(2)  975/     4AD :                     
(2)  976/     4AD :                     mars_scomm:
(2)  977/     4AD : 21 00 60            		ld	hl,6000h	; Point BANK closely
(2)  978/     4B0 : CF                  		rst	8		; to the 32X area
(2)  979/     4B1 : 36 00               		ld	(hl),0
(2)  980/     4B3 : 36 01               		ld	(hl),1
(2)  981/     4B5 : 36 00               		ld	(hl),0
(2)  982/     4B7 : 36 00               		ld	(hl),0
(2)  983/     4B9 : CF                  		rst	8
(2)  984/     4BA : 36 00               		ld	(hl),0
(2)  985/     4BC : 36 00               		ld	(hl),0
(2)  986/     4BE : 36 01               		ld	(hl),1
(2)  987/     4C0 : 36 00               		ld	(hl),0
(2)  988/     4C2 : 36 01               		ld	(hl),1
(2)  989/     4C4 : CF                  		rst	8
(2)  990/     4C5 : FD 21 00 D1         		ld	iy,5100h|8000h	; iy - mars sysreg
(2)  991/     4C9 : DD 21 5B 1A         		ld	ix,pwmcom
(2)  992/     4CD : 3A 32 00            		ld	a,(marsBlock)	; block MARS requests?
(2)  993/     4D0 : B7                  		or	a
(2)  994/     4D1 : 20 5D               		jr	nz,.blocked
(2)  995/     4D3 : 3A 31 00            		ld	a,(marsUpd)	; update?
(2)  996/     4D6 : B7                  		or	a
(2)  997/     4D7 : C8                  		ret	z
(2)  998/     4D8 : CF                  		rst	8
(2)  999/     4D9 : AF                  		xor	a
(2) 1000/     4DA : 32 31 00            		ld	(marsUpd),a
(2) 1001/     4DD :                     
(2) 1002/     4DD :                     .wait_enter:
(2) 1003/     4DD : FD 7E 2E            		ld	a,(iy+comm14)	; check if 68k got first.
(2) 1004/     4E0 : CB 7F               		bit	7,a
(2) 1005/     4E2 : 20 F9               		jr	nz,.wait_enter
(2) 1006/     4E4 : F6 01               		or	1		; Set CMD mode 1
(2) 1007/     4E6 : FD 77 2E            		ld	(iy+comm14),a
(2) 1008/     4E9 : E6 0F               		and	00001111b	; did it write?
(2) 1009/     4EB : FE 01               		cp	1
(2) 1010/     4ED : 20 EE               		jr	nz,.wait_enter
(2) 1011/     4EF : FD CB 2E FE         		set	7,(iy+comm14)	; Enter transfer loop
(2) 1012/     4F3 : FD CB 03 CE         		set	1,(iy+standby)	; Request Slave CMD
(2) 1013/     4F7 :                     .wait_cmd:
(2) 1014/     4F7 : FD CB 03 4E         		bit	1,(iy+standby)	; Got in?
(2) 1015/     4FB : 20 FA               		jr	nz,.wait_cmd
(2) 1016/     4FD : 0E 0E               		ld	c,14		; c - 14 words
(2) 1017/     4FF :                     .next_pass:
(2) 1018/     4FF : FD E5               		push	iy
(2) 1019/     501 : E1                  		pop	hl
(2) 1020/     502 : CF                  		rst	8
(2) 1021/     503 : 11 28 00            		ld	de,comm8	; hl - comm8
(2) 1022/     506 : 19                  		add	hl,de
(2) 1023/     507 : 06 02               		ld	b,2
(2) 1024/     509 :                     .next_comm:
(2) 1025/     509 : DD 56 00            		ld	d,(ix)
(2) 1026/     50C : DD 5E 01            		ld	e,(ix+1)
(2) 1027/     50F : DD 23               		inc	ix
(2) 1028/     511 : DD 23               		inc	ix
(2) 1029/     513 : CF                  		rst	8
(2) 1030/     514 : 72                  		ld	(hl),d
(2) 1031/     515 : 23                  		inc	hl
(2) 1032/     516 : 73                  		ld	(hl),e
(2) 1033/     517 : 23                  		inc	hl
(2) 1034/     518 : 10 EF               		djnz	.next_comm
(2) 1035/     51A : FD CB 2E F6         		set	6,(iy+comm14)	; Send CLK to Slave CMD
(2) 1036/     51E : CF                  		rst	8
(2) 1037/     51F :                     .w_pass2:
(2) 1038/     51F : FD CB 2E 76         		bit	6,(iy+comm14)	; CLK cleared?
(2) 1039/     523 : 20 FA               		jr	nz,.w_pass2
(2) 1040/     525 : 0D                  		dec	c
(2) 1041/     526 : 20 D7               		jr	nz,.next_pass
(2) 1042/     528 : FD CB 2E BE         		res	7,(iy+comm14)	; Break transfer loop
(2) 1043/     52C : FD CB 2E B6         		res	6,(iy+comm14)
(2) 1044/     530 :                     
(2) 1045/     530 :                     	; clear COM bytes here.
(2) 1046/     530 :                     .blocked:
(2) 1047/     530 : 21 5B 1A            		ld	hl,pwmcom
(2) 1048/     533 : 06 07               		ld	b,7		; MAX PWM channels
(2) 1049/     535 :                     .clrcom:
(2) 1050/     535 : 36 00               		ld	(hl),0
(2) 1051/     537 : 23                  		inc	hl
(2) 1052/     538 : 10 FB               		djnz	.clrcom
(2) 1053/     53A : C9                  		ret
(2) 1054/     53B :                     
(2) 1055/     53B :                     ; --------------------------------------------------------
(2) 1056/     53B :                     ; Set and play instruments in their respective channels
(2) 1057/     53B :                     ; --------------------------------------------------------
(2) 1058/     53B :                     
(2) 1059/     53B :                     setupchip:
(2) 1060/     53B : 21 B6 18            		ld	hl,insDataC_0
(2) 1061/     53E : FD 21 66 17         		ld	iy,trkBuff_0		; iy - Tracker channels
(2) 1062/     542 : CD 4C 05            		call	.mk_chip
(2) 1063/     545 : 21 36 19            		ld	hl,insDataC_1
(2) 1064/     548 : FD 21 0E 18         		ld	iy,trkBuff_1
(2) 1065/     54C :                     .mk_chip:
(2) 1066/     54C : FD 7E 13            		ld	a,(iy+trk_status)	; enable bit? (as plus/minus test)
(2) 1067/     54F : B7                  		or	a
(2) 1068/     550 : F0                  		ret	p
(2) 1069/     551 : FD 7E 1C            		ld	a,(iy+trk_CmdReq)
(2) 1070/     554 : FD 36 1C 00         		ld	(iy+trk_CmdReq),0
(2) 1071/     558 : FE FF               		cp	-1
(2) 1072/     55A : 20 04               		jr	nz,.clr
(2) 1073/     55C : FD CB 13 BE         		res	7,(iy+trk_status)
(2) 1074/     560 :                     .clr:
(2) 1075/     560 : 22 B6 19            		ld	(currInsData),hl
(2) 1076/     563 : FD 22 BC 19         		ld	(currTrkCtrl),iy
(2) 1077/     567 :                     ; 		rst	8
(2) 1078/     567 : 11 20 00            		ld	de,20h
(2) 1079/     56A : FD 19               		add	iy,de
(2) 1080/     56C : 06 11               		ld	b,MAX_TRKCHN
(2) 1081/     56E :                     .nxt_chnl:
(2) 1082/     56E : FD 7E 07            		ld	a,(iy+chnl_Flags)	; Get status bits
(2) 1083/     571 : E6 0F               		and	00001111b
(2) 1084/     573 : B7                  		or	a			; Check for non-zero
(2) 1085/     574 : C4 80 05            		call	nz,.do_chnl
(2) 1086/     577 : CF                  		rst	8
(2) 1087/     578 : 11 08 00            		ld	de,8			; Next CHANNEL
(2) 1088/     57B : FD 19               		add	iy,de
(2) 1089/     57D : 10 EF               		djnz	.nxt_chnl
(2) 1090/     57F : C9                  		ret
(2) 1091/     580 :                     
(2) 1092/     580 :                     ; ----------------------------------------
(2) 1093/     580 :                     ; Channel requested update
(2) 1094/     580 :                     ;
(2) 1095/     580 :                     ; iy - Current channel
(2) 1096/     580 :                     ; ----------------------------------------
(2) 1097/     580 :                     
(2) 1098/     580 :                     .do_chnl:
(2) 1099/     580 : C5                  		push	bc
(2) 1100/     581 : CD 66 0D            		call	.check_ins
(2) 1101/     584 : FE FF               		cp	-1			; NULL instrument?
(2) 1102/     586 : 28 39               		jr	z,.no_chnl
(2) 1103/     588 : CD 76 0C            		call	.chip_swap		; check if this channel switched chip
(2) 1104/     58B : CD 79 0D            		call	.check_chnl		; a - chip requested
(2) 1105/     58E : FE FF               		cp	-1
(2) 1106/     590 : 28 25               		jr	z,.ran_out
(2) 1107/     592 : 22 BA 19            		ld	(currInsPos),hl
(2) 1108/     595 : DD 22 B8 19         		ld	(currTblPos),ix
(2) 1109/     599 : E7                  		rst	20h
(2) 1110/     59A : FD CB 07 4E         		bit	1,(iy+chnl_Flags)
(2) 1111/     59E : C4 C7 05            		call	nz,.req_ins
(2) 1112/     5A1 : FD CB 07 56         		bit	2,(iy+chnl_Flags)
(2) 1113/     5A5 : C4 24 07            		call	nz,.req_vol
(2) 1114/     5A8 : CF                  		rst	8
(2) 1115/     5A9 : FD CB 07 5E         		bit	3,(iy+chnl_Flags)
(2) 1116/     5AD : C4 BF 07            		call	nz,.req_eff
(2) 1117/     5B0 : FD CB 07 46         		bit	0,(iy+chnl_Flags)
(2) 1118/     5B4 : C4 1B 0A            		call	nz,.req_note
(2) 1119/     5B7 :                     ; 		ld	a,(iy+chnl_Flags)	; Instrument+effect also allowed.
(2) 1120/     5B7 :                     ; 		and	1010b
(2) 1121/     5B7 :                     ; 		or	a
(2) 1122/     5B7 :                     ; 		call	nz,.req_note
(2) 1123/     5B7 :                     
(2) 1124/     5B7 :                     .ran_out:
(2) 1125/     5B7 : FD 7E 07            		ld	a,(iy+chnl_Flags)	; Clear status bits
(2) 1126/     5BA : E6 F0               		and	11110000b
(2) 1127/     5BC : FD 77 07            		ld	(iy+chnl_Flags),a
(2) 1128/     5BF : C1                  		pop	bc
(2) 1129/     5C0 : C9                  		ret
(2) 1130/     5C1 :                     .no_chnl:
(2) 1131/     5C1 :                     ; 		call	.chip_swap
(2) 1132/     5C1 : FD 36 00 00         		ld	(iy+chnl_Chip),0
(2) 1133/     5C5 :                     ; 		ld	(ix+chnl_Flags),0
(2) 1134/     5C5 : C1                  		pop	bc
(2) 1135/     5C6 : C9                  		ret
(2) 1136/     5C7 :                     
(2) 1137/     5C7 :                     ; ----------------------------------------
(2) 1138/     5C7 :                     ; bit 1: Intrument
(2) 1139/     5C7 :                     ; ----------------------------------------
(2) 1140/     5C7 :                     
(2) 1141/     5C7 :                     .req_ins:
(2) 1142/     5C7 : 2A BA 19            		ld	hl,(currInsPos)
(2) 1143/     5CA : DD 2A B8 19         		ld	ix,(currTblPos)
(2) 1144/     5CE : 7E                  		ld	a,(hl)
(2) 1145/     5CF : E6 F0               		and	11110000b
(2) 1146/     5D1 : FE 80               		cp	80h		; PSG normal
(2) 1147/     5D3 : 28 5A               		jr	z,.ins_psg
(2) 1148/     5D5 : FE 90               		cp	90h		; PSG noise
(2) 1149/     5D7 : 28 50               		jr	z,.ins_psgn
(2) 1150/     5D9 : CF                  		rst	8
(2) 1151/     5DA : FE A0               		cp	0A0h		; FM normal
(2) 1152/     5DC : CA A7 06            		jp	z,.ins_fm
(2) 1153/     5DF : FE B0               		cp	0B0h		; FM special
(2) 1154/     5E1 : CA 98 06            		jp	z,.ins_fm3
(2) 1155/     5E4 : FE C0               		cp	0C0h		; DAC
(2) 1156/     5E6 : 28 76               		jr	z,.ins_dac
(2) 1157/     5E8 : FE D0               		cp	0D0h		; PWM
(2) 1158/     5EA : CA EE 05            		jp	z,.ins_pwm
(2) 1159/     5ED : C9                  		ret
(2) 1160/     5EE :                     
(2) 1161/     5EE :                     ; --------------------------------
(2) 1162/     5EE :                     ; FM,FM3,FM6
(2) 1163/     5EE :                     ; --------------------------------
(2) 1164/     5EE :                     
(2) 1165/     5EE :                     .ins_pwm:
(2) 1166/     5EE : 56                  		ld	d,(hl)		; d - Flags
(2) 1167/     5EF : 23                  		inc	hl
(2) 1168/     5F0 : 7E                  		ld	a,(hl)		; Save pitch
(2) 1169/     5F1 : 23                  		inc	hl
(2) 1170/     5F2 : DD 77 03            		ld	(ix+3),a
(2) 1171/     5F5 : DD 7E 02            		ld	a,(ix+2)
(2) 1172/     5F8 : DD 21 5B 1A         		ld	ix,pwmcom	; ix - pwmcom
(2) 1173/     5FC : E6 07               		and	000111b
(2) 1174/     5FE : 06 00               		ld	b,0
(2) 1175/     600 : 4F                  		ld	c,a
(2) 1176/     601 : DD 09               		add	ix,bc
(2) 1177/     603 : 7E                  		ld	a,(hl)		; SH2 BANK
(2) 1178/     604 : 23                  		inc	hl
(2) 1179/     605 : E6 0F               		and	00001111b
(2) 1180/     607 : 47                  		ld	b,a		; b - Section, ROM or SDRAM
(2) 1181/     608 : DD 7E 18            		ld	a,(ix+PWOUTF)
(2) 1182/     60B : E6 30               		and	00110000b	; keep flag LR
(2) 1183/     60D : 4F                  		ld	c,a		; save them as C
(2) 1184/     60E : 7A                  		ld	a,d
(2) 1185/     60F : E6 03               		and	00000011b	; Stereo|Loop bits
(2) 1186/     611 : 0F                  		rrca			; carry...
(2) 1187/     612 : 0F                  		rrca
(2) 1188/     613 : B1                  		or	c
(2) 1189/     614 : B0                  		or	b
(2) 1190/     615 : DD 77 18            		ld	(ix+PWOUTF),a
(2) 1191/     618 : 7E                  		ld	a,(hl)		; Grab the 24-bit address (BIG endian)
(2) 1192/     619 : 23                  		inc	hl
(2) 1193/     61A : DD 77 20            		ld	(ix+PWINSH),a
(2) 1194/     61D : CF                  		rst	8
(2) 1195/     61E : 7E                  		ld	a,(hl)
(2) 1196/     61F : 23                  		inc	hl
(2) 1197/     620 : DD 77 28            		ld	(ix+PWINSM),a
(2) 1198/     623 : 7E                  		ld	a,(hl)
(2) 1199/     624 : 23                  		inc	hl
(2) 1200/     625 : DD 77 30            		ld	(ix+PWINSL),a
(2) 1201/     628 : C9                  		ret
(2) 1202/     629 :                     
(2) 1203/     629 :                     ; --------------------------------
(2) 1204/     629 :                     ; PSG1-3,PSGN
(2) 1205/     629 :                     ; --------------------------------
(2) 1206/     629 :                     
(2) 1207/     629 :                     .ins_psgn:
(2) 1208/     629 : 7E                  		ld	a,(hl)		; Extra bits for NOISE
(2) 1209/     62A : E6 07               		and	111b
(2) 1210/     62C : DD 77 04            		ld	(ix+4),a
(2) 1211/     62F :                     .ins_psg:
(2) 1212/     62F : CF                  		rst	8
(2) 1213/     630 : 23                  		inc	hl		; Skip ID
(2) 1214/     631 : 7E                  		ld	a,(hl)
(2) 1215/     632 : DD 77 03            		ld	(ix+3),a	; Save pitch
(2) 1216/     635 : 23                  		inc	hl
(2) 1217/     636 : DD 7E 02            		ld	a,(ix+2)
(2) 1218/     639 : E6 03               		and	11b
(2) 1219/     63B : 16 00               		ld	d,0
(2) 1220/     63D : 5F                  		ld	e,a
(2) 1221/     63E : DD 21 11 16         		ld	ix,psgcom
(2) 1222/     642 : DD 19               		add	ix,de
(2) 1223/     644 : 7E                  		ld	a,(hl)
(2) 1224/     645 :                     
(2) 1225/     645 :                     	; TODO: ponerlos en un buffer separado
(2) 1226/     645 : DD 77 24            		ld	(ix+ALV),a	; ALV
(2) 1227/     648 : 23                  		inc	hl
(2) 1228/     649 : 7E                  		ld	a,(hl)
(2) 1229/     64A : DD 77 08            		ld	(ix+ATK),a	; ATK
(2) 1230/     64D : 23                  		inc	hl
(2) 1231/     64E : CF                  		rst	8
(2) 1232/     64F : 7E                  		ld	a,(hl)
(2) 1233/     650 : DD 77 10            		ld	(ix+SLV),a	; SLV
(2) 1234/     653 : 23                  		inc	hl
(2) 1235/     654 : 7E                  		ld	a,(hl)
(2) 1236/     655 : DD 77 0C            		ld	(ix+DKY),a	; DKY
(2) 1237/     658 : 23                  		inc	hl
(2) 1238/     659 : 7E                  		ld	a,(hl)
(2) 1239/     65A : DD 77 14            		ld	(ix+RRT),a	; RRT
(2) 1240/     65D : C9                  		ret
(2) 1241/     65E :                     
(2) 1242/     65E :                     ; --------------------------------
(2) 1243/     65E :                     ; FM,FM3,FM6
(2) 1244/     65E :                     ; --------------------------------
(2) 1245/     65E :                     
(2) 1246/     65E :                     .ins_dac:
(2) 1247/     65E : DD 36 04 01         		ld	(ix+4),1	; e - alternate mode flag (FM6 as DAC)
(2) 1248/     662 : 7E                  		ld	a,(hl)		; Grab flags from ID
(2) 1249/     663 : E6 01               		and	001b
(2) 1250/     665 : 32 CC 19            		ld	(wave_Flags),a
(2) 1251/     668 : 23                  		inc	hl
(2) 1252/     669 : 7E                  		ld	a,(hl)		; Save pitch
(2) 1253/     66A : DD 77 03            		ld	(ix+3),a
(2) 1254/     66D : 23                  		inc	hl
(2) 1255/     66E : 4E                  		ld	c,(hl)		; Grab the 24-bit address
(2) 1256/     66F : 23                  		inc	hl		; big endian this time.
(2) 1257/     670 : CF                  		rst	8
(2) 1258/     671 : 56                  		ld	d,(hl)
(2) 1259/     672 : 23                  		inc	hl
(2) 1260/     673 : 5E                  		ld	e,(hl)
(2) 1261/     674 :                     
(2) 1262/     674 : CF                  		rst	8
(2) 1263/     675 : 6B                  		ld	l,e
(2) 1264/     676 : 62                  		ld	h,d
(2) 1265/     677 : 79                  		ld	a,c
(2) 1266/     678 : E5                  		push	hl		; Recieve LEN and LOOP
(2) 1267/     679 : F5                  		push	af		; from the WAVE itself
(2) 1268/     67A : 11 C4 19            		ld	de,wave_Len
(2) 1269/     67D : 01 06 00            		ld	bc,6
(2) 1270/     680 : CF                  		rst	8
(2) 1271/     681 : CD F3 0E            		call	transferRom
(2) 1272/     684 : F1                  		pop	af
(2) 1273/     685 : E1                  		pop	hl
(2) 1274/     686 : 01 06 00            		ld	bc,6		; skip LEN point
(2) 1275/     689 : 09                  		add	hl,bc
(2) 1276/     68A : CE 00               		adc	a,0
(2) 1277/     68C : 22 C1 19            		ld	(wave_Start),hl	; save START point
(2) 1278/     68F : 32 C3 19            		ld	(wave_Start+2),a
(2) 1279/     692 : 3E 04               		ld	a,100b		; Force FM6 off
(2) 1280/     694 : 32 4A 16            		ld	(fmcom+5),a
(2) 1281/     697 : C9                  		ret
(2) 1282/     698 :                     
(2) 1283/     698 :                     ; FM3 special mode
(2) 1284/     698 :                     .ins_fm3:
(2) 1285/     698 : 3E 02               		ld	a,2		; manual index
(2) 1286/     69A : 1E 01               		ld	e,1		; set as alternate FM
(2) 1287/     69C : CD D2 06            		call	.rd_fmins
(2) 1288/     69F : 21 47 16            		ld	hl,fmcom+2
(2) 1289/     6A2 : 7E                  		ld	a,(hl)		; instrument update bit
(2) 1290/     6A3 : F6 10               		or	00010000b	; flag
(2) 1291/     6A5 : 77                  		ld	(hl),a
(2) 1292/     6A6 : C9                  		ret
(2) 1293/     6A7 :                     ; Regular FM
(2) 1294/     6A7 :                     .ins_fm:
(2) 1295/     6A7 : CF                  		rst	8
(2) 1296/     6A8 : 1E 00               		ld	e,0		; Set as normal FM
(2) 1297/     6AA : DD 7E 02            		ld	a,(ix+2)
(2) 1298/     6AD : E6 07               		and	00000111b
(2) 1299/     6AF : FE 05               		cp	5		; Check if we are on FM6
(2) 1300/     6B1 : 20 08               		jr	nz,.not_prdac
(2) 1301/     6B3 : 57                  		ld	d,a
(2) 1302/     6B4 : 3E 04               		ld	a,100b		; Force DAC stop
(2) 1303/     6B6 : CF                  		rst	8
(2) 1304/     6B7 : 32 65 17            		ld	(daccom),a
(2) 1305/     6BA : 7A                  		ld	a,d
(2) 1306/     6BB :                     .not_prdac:
(2) 1307/     6BB : 1E 00               		ld	e,0		; Set as Normal
(2) 1308/     6BD : CD D2 06            		call	.rd_fmins
(2) 1309/     6C0 : DD 7E 02            		ld	a,(ix+2)
(2) 1310/     6C3 : E6 07               		and	00000111b
(2) 1311/     6C5 : 16 00               		ld	d,0
(2) 1312/     6C7 : CF                  		rst	8
(2) 1313/     6C8 : 5F                  		ld	e,a
(2) 1314/     6C9 : 21 45 16            		ld	hl,fmcom
(2) 1315/     6CC : 19                  		add	hl,de
(2) 1316/     6CD : 7E                  		ld	a,(hl)		; instrument update bit
(2) 1317/     6CE : F6 10               		or	00010000b	; flag
(2) 1318/     6D0 : 77                  		ld	(hl),a
(2) 1319/     6D1 : C9                  		ret
(2) 1320/     6D2 :                     
(2) 1321/     6D2 :                     ; Read FM instrument
(2) 1322/     6D2 :                     ;
(2) 1323/     6D2 :                     ; e - alternate mode flag
(2) 1324/     6D2 :                     .rd_fmins:
(2) 1325/     6D2 : DD 73 04            		ld	(ix+4),e	; e - alternate mode flag
(2) 1326/     6D5 : 23                  		inc	hl		; skip ID and pitch
(2) 1327/     6D6 : 5E                  		ld	e,(hl)
(2) 1328/     6D7 : DD 73 03            		ld	(ix+3),e	; save pitch
(2) 1329/     6DA : 23                  		inc	hl
(2) 1330/     6DB : 87                  		add	a,a
(2) 1331/     6DC : 16 00               		ld	d,0
(2) 1332/     6DE : 5F                  		ld	e,a
(2) 1333/     6DF : CF                  		rst	8
(2) 1334/     6E0 : E5                  		push	hl		; save ins hl
(2) 1335/     6E1 : 21 18 07            		ld	hl,.fmpickins
(2) 1336/     6E4 : 19                  		add	hl,de
(2) 1337/     6E5 : 5E                  		ld	e,(hl)		; get output location
(2) 1338/     6E6 : 23                  		inc	hl		; from list
(2) 1339/     6E7 : 56                  		ld	d,(hl)
(2) 1340/     6E8 : CF                  		rst	8
(2) 1341/     6E9 : E1                  		pop	hl
(2) 1342/     6EA : 7E                  		ld	a,(hl)		; a - xx0000
(2) 1343/     6EB : 23                  		inc	hl
(2) 1344/     6EC : 4E                  		ld	c,(hl)		; c - 00xx00
(2) 1345/     6ED : 23                  		inc	hl
(2) 1346/     6EE : 6E                  		ld	l,(hl)		; l - 0000xx
(2) 1347/     6EF : 61                  		ld	h,c		; c to h
(2) 1348/     6F0 : D5                  		push	de
(2) 1349/     6F1 : CF                  		rst	8
(2) 1350/     6F2 : 4F                  		ld	c,a
(2) 1351/     6F3 : DD 7E 07            		ld	a,(ix+7)
(2) 1352/     6F6 : B9                  		cp	c
(2) 1353/     6F7 : 20 0C               		jr	nz,.confm_rd
(2) 1354/     6F9 : DD 7E 06            		ld	a,(ix+6)
(2) 1355/     6FC : BC                  		cp	h
(2) 1356/     6FD : 20 06               		jr	nz,.confm_rd
(2) 1357/     6FF : DD 7E 05            		ld	a,(ix+5)
(2) 1358/     702 : BD                  		cp	l
(2) 1359/     703 : 28 11               		jr	z,.fmsame_ins
(2) 1360/     705 :                     .confm_rd:
(2) 1361/     705 : CF                  		rst	8
(2) 1362/     706 : DD 75 05            		ld	(ix+5),l
(2) 1363/     709 : DD 74 06            		ld	(ix+6),h
(2) 1364/     70C : DD 71 07            		ld	(ix+7),c
(2) 1365/     70F : 79                  		ld	a,c
(2) 1366/     710 : 01 28 00            		ld	bc,028h		; 28h bytes
(2) 1367/     713 : CD F3 0E            		call	transferRom	; Transfer instrument data from ROM
(2) 1368/     716 :                     .fmsame_ins:
(2) 1369/     716 : E1                  		pop	hl
(2) 1370/     717 : C9                  		ret
(2) 1371/     718 :                     
(2) 1372/     718 :                     ; manual location for each instr cache
(2) 1373/     718 :                     ; 28h bytes each
(2) 1374/     718 :                     .fmpickins:
(2) 1375/     718 : 69 16               		dw fmins_com
(2) 1376/     71A : 91 16               		dw fmins_com2
(2) 1377/     71C : B9 16               		dw fmins_com3
(2) 1378/     71E : E1 16               		dw fmins_com4
(2) 1379/     720 : 09 17               		dw fmins_com5
(2) 1380/     722 : 31 17               		dw fmins_com6
(2) 1381/     724 :                     
(2) 1382/     724 :                     ; ----------------------------------------
(2) 1383/     724 :                     ; bit 2
(2) 1384/     724 :                     ; ----------------------------------------
(2) 1385/     724 :                     
(2) 1386/     724 :                     .req_vol:
(2) 1387/     724 : 2A BA 19            		ld	hl,(currInsPos)
(2) 1388/     727 : DD 2A B8 19         		ld	ix,(currTblPos)
(2) 1389/     72B : 7E                  		ld	a,(hl)
(2) 1390/     72C : E6 F0               		and	11110000b
(2) 1391/     72E : FE 80               		cp	80h		; PSG normal
(2) 1392/     730 : 28 45               		jr	z,.vol_psg
(2) 1393/     732 : FE 90               		cp	90h		; PSG noise
(2) 1394/     734 : 28 41               		jr	z,.vol_psg
(2) 1395/     736 : CF                  		rst	8
(2) 1396/     737 : FE A0               		cp	0A0h		; FM normal
(2) 1397/     739 : 28 5F               		jr	z,.vol_fm
(2) 1398/     73B : FE B0               		cp	0B0h		; FM special (same thing)
(2) 1399/     73D : 28 5B               		jr	z,.vol_fm
(2) 1400/     73F :                     ; 		cp	0C0h		; DAC
(2) 1401/     73F :                     ; 		jr	z,.vol_dac
(2) 1402/     73F : FE D0               		cp	0D0h		; PWM
(2) 1403/     741 : 28 01               		jr	z,.vol_pwm
(2) 1404/     743 : C9                  		ret
(2) 1405/     744 :                     
(2) 1406/     744 :                     ; --------------------------------
(2) 1407/     744 :                     ; FM,FM3,FM6
(2) 1408/     744 :                     .vol_pwm:
(2) 1409/     744 : 01 00 00            		ld	bc,0
(2) 1410/     747 : DD 7E 02            		ld	a,(ix+2)
(2) 1411/     74A : E6 07               		and	00000111b
(2) 1412/     74C : 4F                  		ld	c,a
(2) 1413/     74D : CF                  		rst	8
(2) 1414/     74E : DD 21 5B 1A         		ld	ix,pwmcom
(2) 1415/     752 : DD 09               		add	ix,bc
(2) 1416/     754 : DD 7E 08            		ld	a,(ix+PWPTH_V)
(2) 1417/     757 : E6 03               		and	00000011b
(2) 1418/     759 : 4F                  		ld	c,a		; c - MSB Pitch bits
(2) 1419/     75A : FD 7E 03            		ld	a,(iy+chnl_Vol)
(2) 1420/     75D : D6 40               		sub	a,40h
(2) 1421/     75F : CF                  		rst	8
(2) 1422/     760 : ED 44               		neg	a		; reverse impulse volume
(2) 1423/     762 : 87                  		add	a,a
(2) 1424/     763 : 87                  		add	a,a
(2) 1425/     764 : 30 03               		jr	nc,.pvmuch
(2) 1426/     766 : 3E FF               		ld	a,-1
(2) 1427/     768 : CF                  		rst	8
(2) 1428/     769 :                     .pvmuch:
(2) 1429/     769 : B1                  		or	c
(2) 1430/     76A : DD 77 08            		ld	(ix+PWPTH_V),a
(2) 1431/     76D : DD CB 00 EE         		set	5,(ix)		; set volume update bit
(2) 1432/     771 : 3E 01               		ld	a,1
(2) 1433/     773 : 32 31 00            		ld	(marsUpd),a
(2) 1434/     776 : C9                  		ret
(2) 1435/     777 :                     
(2) 1436/     777 :                     ; --------------------------------
(2) 1437/     777 :                     ; PSG1-3,PSGN
(2) 1438/     777 :                     
(2) 1439/     777 :                     .vol_psg:
(2) 1440/     777 : DD 7E 02            		ld	a,(ix+2)
(2) 1441/     77A : DD 21 11 16         		ld	ix,psgcom
(2) 1442/     77E : E6 03               		and	11b
(2) 1443/     780 : 16 00               		ld	d,0
(2) 1444/     782 : 5F                  		ld	e,a
(2) 1445/     783 : DD 19               		add	ix,de
(2) 1446/     785 : FD 7E 03            		ld	a,(iy+chnl_Vol)
(2) 1447/     788 : D6 40               		sub	a,40h
(2) 1448/     78A : ED 44               		neg	a
(2) 1449/     78C : 4F                  		ld	c,a
(2) 1450/     78D : FE 40               		cp	40h
(2) 1451/     78F : 20 02               		jr	nz,.vmuch
(2) 1452/     791 : 0E FF               		ld	c,-1
(2) 1453/     793 :                     .vmuch:
(2) 1454/     793 : 79                  		ld	a,c
(2) 1455/     794 : 87                  		add	a,a
(2) 1456/     795 : 87                  		add	a,a
(2) 1457/     796 : DD 77 30            		ld	(ix+PVOL),a
(2) 1458/     799 :                     ; 		ld	a,(ix)
(2) 1459/     799 :                     ; 		or	00100000b	; Set volume
(2) 1460/     799 :                     ; 		ld	(ix),a		; update flag
(2) 1461/     799 : C9                  		ret
(2) 1462/     79A :                     
(2) 1463/     79A :                     ; --------------------------------
(2) 1464/     79A :                     ; FM,FM3,FM6
(2) 1465/     79A :                     .vol_fm:
(2) 1466/     79A : 01 00 00            		ld	bc,0
(2) 1467/     79D : DD 7E 02            		ld	a,(ix+2)
(2) 1468/     7A0 : E6 07               		and	00000111b
(2) 1469/     7A2 : 4F                  		ld	c,a
(2) 1470/     7A3 : DD 21 45 16         		ld	ix,fmcom
(2) 1471/     7A7 : DD 09               		add	ix,bc
(2) 1472/     7A9 : FD 7E 03            		ld	a,(iy+chnl_Vol)
(2) 1473/     7AC : D6 40               		sub	a,40h
(2) 1474/     7AE : CF                  		rst	8
(2) 1475/     7AF : ED 44               		neg	a		; reverse impulse volume
(2) 1476/     7B1 : CB 3F               		srl	a		; /2
(2) 1477/     7B3 : DD 77 0C            		ld	(ix+FMVOL),a
(2) 1478/     7B6 : DD 7E 00            		ld	a,(ix)		; volume update
(2) 1479/     7B9 : F6 20               		or	00100000b	; flag, plus keyon
(2) 1480/     7BB : DD 77 00            		ld	(ix),a
(2) 1481/     7BE : C9                  		ret
(2) 1482/     7BF :                     
(2) 1483/     7BF :                     ; ----------------------------------------
(2) 1484/     7BF :                     ; bit 3
(2) 1485/     7BF :                     ; ----------------------------------------
(2) 1486/     7BF :                     
(2) 1487/     7BF :                     .req_eff:
(2) 1488/     7BF : 2A BA 19            		ld	hl,(currInsPos)
(2) 1489/     7C2 : DD 2A B8 19         		ld	ix,(currTblPos)
(2) 1490/     7C6 : FD 7E 04            		ld	a,(iy+chnl_EffId)	; effect id == 0?
(2) 1491/     7C9 : B7                  		or	a
(2) 1492/     7CA : C8                  		ret	z
(2) 1493/     7CB : 57                  		ld	d,a
(2) 1494/     7CC : 7E                  		ld	a,(hl)
(2) 1495/     7CD : E6 F0               		and	11110000b
(2) 1496/     7CF : FD 5E 05            		ld	e,(iy+chnl_EffArg)
(2) 1497/     7D2 : CF                  		rst	8
(2) 1498/     7D3 : FE 80               		cp	80h			; PSG normal
(2) 1499/     7D5 : 28 16               		jr	z,.eff_psg
(2) 1500/     7D7 : FE 90               		cp	90h			; PSG noise
(2) 1501/     7D9 : 28 12               		jr	z,.eff_psg
(2) 1502/     7DB : FE A0               		cp	0A0h			; FM Normal
(2) 1503/     7DD : 28 21               		jr	z,.eff_fm
(2) 1504/     7DF : CF                  		rst	8
(2) 1505/     7E0 : FE B0               		cp	0B0h			; FM Special
(2) 1506/     7E2 : 28 1C               		jr	z,.eff_fm
(2) 1507/     7E4 : FE C0               		cp	0C0h			; DAC
(2) 1508/     7E6 : 28 2F               		jr	z,.eff_dac
(2) 1509/     7E8 : FE D0               		cp	0D0h			; PWM
(2) 1510/     7EA : 28 3D               		jr	z,.eff_pwm
(2) 1511/     7EC : C9                  		ret
(2) 1512/     7ED :                     
(2) 1513/     7ED :                     ; --------------------------------
(2) 1514/     7ED :                     
(2) 1515/     7ED :                     .eff_psg:
(2) 1516/     7ED : 7A                  		ld	a,d
(2) 1517/     7EE : FE 04               		cp	4		; Effect D?
(2) 1518/     7F0 : CA 40 08            		jp	z,.effPsg_D
(2) 1519/     7F3 : FE 05               		cp	5		; Effect E?
(2) 1520/     7F5 : CA C0 08            		jp	z,.effPsg_E
(2) 1521/     7F8 : CF                  		rst	8
(2) 1522/     7F9 : FE 06               		cp	6		; Effect F?
(2) 1523/     7FB : CA F2 08            		jp	z,.effPsg_F
(2) 1524/     7FE : CF                  		rst	8
(2) 1525/     7FF : C9                  		ret
(2) 1526/     800 :                     .eff_fm:
(2) 1527/     800 : 7A                  		ld	a,d
(2) 1528/     801 : FE 04               		cp	4		; Effect D?
(2) 1529/     803 : CA 6E 08            		jp	z,.effFm_D
(2) 1530/     806 : FE 05               		cp	5		; Effect E?
(2) 1531/     808 : CA CA 08            		jp	z,.effFm_E
(2) 1532/     80B : CF                  		rst	8
(2) 1533/     80C : FE 06               		cp	6		; Effect F?
(2) 1534/     80E : CA 00 09            		jp	z,.effFm_F
(2) 1535/     811 : FE 18               		cp	24		; Effect X?
(2) 1536/     813 : CA DD 09            		jp	z,.effFm_X
(2) 1537/     816 : C9                  		ret
(2) 1538/     817 :                     .eff_dac:
(2) 1539/     817 : 7A                  		ld	a,d
(2) 1540/     818 : FE 05               		cp	5		; Effect E?
(2) 1541/     81A : CA D8 08            		jp	z,.effDac_E
(2) 1542/     81D : FE 06               		cp	6		; Effect F?
(2) 1543/     81F : CA 07 09            		jp	z,.effDac_F
(2) 1544/     822 : CF                  		rst	8
(2) 1545/     823 : FE 18               		cp	24		; Effect X?
(2) 1546/     825 : CA DD 09            		jp	z,.effFm_X
(2) 1547/     828 : C9                  		ret
(2) 1548/     829 :                     .eff_pwm:
(2) 1549/     829 : 3E 01               		ld	a,1
(2) 1550/     82B : 32 31 00            		ld	(marsUpd),a
(2) 1551/     82E : 7A                  		ld	a,d
(2) 1552/     82F :                     ; 		cp	4		; Effect D?
(2) 1553/     82F :                     ; 		jp	z,.effFm_D
(2) 1554/     82F : FE 05               		cp	5		; Effect E?
(2) 1555/     831 : CA E5 08            		jp	z,.effPwm_E
(2) 1556/     834 : CF                  		rst	8
(2) 1557/     835 : FE 06               		cp	6		; Effect F?
(2) 1558/     837 : CA 0D 09            		jp	z,.effPwm_F
(2) 1559/     83A : FE 18               		cp	24		; Effect X?
(2) 1560/     83C : CA C4 09            		jp	z,.effPwm_X	; recycle FM's panning
(2) 1561/     83F : C9                  		ret
(2) 1562/     840 :                     
(2) 1563/     840 :                     ; --------------------------------
(2) 1564/     840 :                     ; Effect D
(2) 1565/     840 :                     ; --------------------------------
(2) 1566/     840 :                     
(2) 1567/     840 :                     .effPsg_D:
(2) 1568/     840 : 7B                  		ld	a,e
(2) 1569/     841 : B7                  		or	a
(2) 1570/     842 : C8                  		ret	z
(2) 1571/     843 : 06 00               		ld	b,0
(2) 1572/     845 : DD 7E 02            		ld	a,(ix+2)
(2) 1573/     848 : E6 03               		and	011b
(2) 1574/     84A : 4F                  		ld	c,a
(2) 1575/     84B : DD 21 11 16         		ld	ix,psgcom
(2) 1576/     84F : DD 09               		add	ix,bc
(2) 1577/     851 : CD 9D 08            		call	.grab_dval
(2) 1578/     854 : 87                  		add	a,a
(2) 1579/     855 : 87                  		add	a,a
(2) 1580/     856 : 87                  		add	a,a
(2) 1581/     857 : 4F                  		ld	c,a
(2) 1582/     858 : CB 79               		bit	7,c
(2) 1583/     85A : 20 09               		jr	nz,.lowp
(2) 1584/     85C : DD 7E 30            		ld	a,(ix+PVOL)
(2) 1585/     85F : 81                  		add	a,c
(2) 1586/     860 : D8                  		ret	c
(2) 1587/     861 : DD 77 30            		ld	(ix+PVOL),a
(2) 1588/     864 : C9                  		ret
(2) 1589/     865 :                     .lowp:
(2) 1590/     865 : DD 7E 30            		ld	a,(ix+PVOL)
(2) 1591/     868 : 81                  		add	a,c
(2) 1592/     869 : D0                  		ret	nc
(2) 1593/     86A : DD 77 30            		ld	(ix+PVOL),a
(2) 1594/     86D : C9                  		ret
(2) 1595/     86E :                     .effFm_D:
(2) 1596/     86E : 7B                  		ld	a,e
(2) 1597/     86F : B7                  		or	a
(2) 1598/     870 : C8                  		ret	z
(2) 1599/     871 : 06 00               		ld	b,0
(2) 1600/     873 : DD 7E 02            		ld	a,(ix+2)
(2) 1601/     876 : E6 07               		and	111b
(2) 1602/     878 : 4F                  		ld	c,a
(2) 1603/     879 : DD 21 45 16         		ld	ix,fmcom
(2) 1604/     87D : DD 09               		add	ix,bc
(2) 1605/     87F : CD 9D 08            		call	.grab_dval
(2) 1606/     882 :                     ; 		srl	a		; TODO: checar que tanto
(2) 1607/     882 :                     ; 		srl	a		; shifteo esto
(2) 1608/     882 : 4F                  		ld	c,a
(2) 1609/     883 : DD CB 00 EE         		set	5,(ix)
(2) 1610/     887 : CB 79               		bit	7,c
(2) 1611/     889 : 20 09               		jr	nz,.lowpf
(2) 1612/     88B : DD 7E 0C            		ld	a,(ix+FMVOL)
(2) 1613/     88E : 81                  		add	a,c
(2) 1614/     88F : D8                  		ret	c
(2) 1615/     890 : DD 77 0C            		ld	(ix+FMVOL),a
(2) 1616/     893 : C9                  		ret
(2) 1617/     894 :                     .lowpf:
(2) 1618/     894 : DD 7E 0C            		ld	a,(ix+FMVOL)
(2) 1619/     897 : 81                  		add	a,c
(2) 1620/     898 : D0                  		ret	nc
(2) 1621/     899 : DD 77 0C            		ld	(ix+FMVOL),a
(2) 1622/     89C : C9                  		ret
(2) 1623/     89D :                     
(2) 1624/     89D :                     ; a - increment/decrement value
(2) 1625/     89D :                     .grab_dval:
(2) 1626/     89D : 7B                  		ld	a,e
(2) 1627/     89E : E6 F0               		and	11110000b
(2) 1628/     8A0 : FE F0               		cp	11110000b
(2) 1629/     8A2 : 28 03               		jr	z,.go_down
(2) 1630/     8A4 : B7                  		or	a
(2) 1631/     8A5 : 20 09               		jr	nz,.go_up
(2) 1632/     8A7 :                     .go_down:
(2) 1633/     8A7 : 7B                  		ld	a,e
(2) 1634/     8A8 : E6 0F               		and	00001111b
(2) 1635/     8AA : CB 7B               		bit	7,e
(2) 1636/     8AC : C0                  		ret	nz
(2) 1637/     8AD : 87                  		add	a,a
(2) 1638/     8AE : CF                  		rst	8
(2) 1639/     8AF : C9                  		ret
(2) 1640/     8B0 :                     .go_up:
(2) 1641/     8B0 : 7B                  		ld	a,e
(2) 1642/     8B1 : 0F                  		rrca
(2) 1643/     8B2 : 0F                  		rrca
(2) 1644/     8B3 : 0F                  		rrca
(2) 1645/     8B4 : 0F                  		rrca
(2) 1646/     8B5 : CF                  		rst	8
(2) 1647/     8B6 : E6 0F               		and	00001111b
(2) 1648/     8B8 : ED 44               		neg	a
(2) 1649/     8BA : CB 5B               		bit	3,e
(2) 1650/     8BC : C0                  		ret	nz
(2) 1651/     8BD : 87                  		add	a,a
(2) 1652/     8BE : CF                  		rst	8
(2) 1653/     8BF : C9                  		ret
(2) 1654/     8C0 :                     
(2) 1655/     8C0 :                     ; --------------------------------
(2) 1656/     8C0 :                     ; Effect E
(2) 1657/     8C0 :                     ; --------------------------------
(2) 1658/     8C0 :                     
(2) 1659/     8C0 :                     .effPsg_E:
(2) 1660/     8C0 : CD A5 09            		call	.grab_prtm
(2) 1661/     8C3 : 16 00               		ld	d,0
(2) 1662/     8C5 : 87                  		add	a,a
(2) 1663/     8C6 : 5F                  		ld	e,a
(2) 1664/     8C7 : C3 7B 09            		jp	.freqinc_psg
(2) 1665/     8CA :                     .effFm_E:
(2) 1666/     8CA : CD A5 09            		call	.grab_prtm
(2) 1667/     8CD : ED 44               		neg	a
(2) 1668/     8CF : B7                  		or	a
(2) 1669/     8D0 : 28 02               		jr	z,.e_neg
(2) 1670/     8D2 : 16 FF               		ld	d,-1
(2) 1671/     8D4 :                     .e_neg:
(2) 1672/     8D4 : 5F                  		ld	e,a
(2) 1673/     8D5 : C3 55 09            		jp	.freqinc_fm
(2) 1674/     8D8 :                     .effDac_E:
(2) 1675/     8D8 : CD A5 09            		call	.grab_prtm
(2) 1676/     8DB : ED 44               		neg	a
(2) 1677/     8DD : B7                  		or	a
(2) 1678/     8DE : 28 02               		jr	z,.e_negd
(2) 1679/     8E0 : 16 FF               		ld	d,-1
(2) 1680/     8E2 :                     .e_negd:
(2) 1681/     8E2 : 5F                  		ld	e,a
(2) 1682/     8E3 : 18 60               		jr	.freqinc_dac
(2) 1683/     8E5 :                     
(2) 1684/     8E5 :                     .effPwm_E:
(2) 1685/     8E5 : CD A5 09            		call	.grab_prtm
(2) 1686/     8E8 :                     ; 		sra	a
(2) 1687/     8E8 :                     ; 		sra	a
(2) 1688/     8E8 : ED 44               		neg	a
(2) 1689/     8EA : B7                  		or	a
(2) 1690/     8EB : 28 02               		jr	z,.e_fnegd2
(2) 1691/     8ED : 16 FF               		ld	d,-1
(2) 1692/     8EF :                     .e_fnegd2:
(2) 1693/     8EF : 5F                  		ld	e,a
(2) 1694/     8F0 : 18 1F               		jr	.freqinc_pwm
(2) 1695/     8F2 :                     
(2) 1696/     8F2 :                     ; --------------------------------
(2) 1697/     8F2 :                     ; Effect F
(2) 1698/     8F2 :                     ; --------------------------------
(2) 1699/     8F2 :                     
(2) 1700/     8F2 :                     ; PSG
(2) 1701/     8F2 :                     .effPsg_F:
(2) 1702/     8F2 : CD A5 09            		call	.grab_prtm
(2) 1703/     8F5 : 87                  		add	a,a
(2) 1704/     8F6 : ED 44               		neg	a
(2) 1705/     8F8 : B7                  		or	a
(2) 1706/     8F9 : 28 02               		jr	z,.e_negp
(2) 1707/     8FB : 16 FF               		ld	d,-1
(2) 1708/     8FD :                     .e_negp:
(2) 1709/     8FD : 5F                  		ld	e,a
(2) 1710/     8FE : 18 7B               		jr	.freqinc_psg
(2) 1711/     900 :                     .effFm_F:
(2) 1712/     900 : CD A5 09            		call	.grab_prtm
(2) 1713/     903 : 87                  		add	a,a
(2) 1714/     904 : 5F                  		ld	e,a
(2) 1715/     905 : 18 4E               		jr	.freqinc_fm
(2) 1716/     907 :                     .effDac_F:
(2) 1717/     907 : CD A5 09            		call	.grab_prtm
(2) 1718/     90A : 5F                  		ld	e,a
(2) 1719/     90B : 18 38               		jr	.freqinc_dac
(2) 1720/     90D :                     .effPwm_F:
(2) 1721/     90D : CD A5 09            		call	.grab_prtm
(2) 1722/     910 :                     ; 		sra	a
(2) 1723/     910 :                     ; 		sra	a
(2) 1724/     910 : 5F                  		ld	e,a
(2) 1725/     911 :                     
(2) 1726/     911 :                     ; --------------------------------
(2) 1727/     911 :                     ; For effects E and F:
(2) 1728/     911 :                     ;
(2) 1729/     911 :                     ; de - freq incr/decr
(2) 1730/     911 :                     
(2) 1731/     911 :                     .freqinc_pwm:
(2) 1732/     911 : DD 7E 02            		ld	a,(ix+2)
(2) 1733/     914 : E6 07               		and	111b
(2) 1734/     916 : DD 21 5B 1A         		ld	ix,pwmcom
(2) 1735/     91A : 06 00               		ld	b,0
(2) 1736/     91C : 4F                  		ld	c,a
(2) 1737/     91D : CF                  		rst	8
(2) 1738/     91E : DD 09               		add	ix,bc
(2) 1739/     920 : DD 7E 08            		ld	a,(ix+PWPTH_V)
(2) 1740/     923 : E6 03               		and	00000011b
(2) 1741/     925 : 67                  		ld	h,a
(2) 1742/     926 : DD 6E 10            		ld	l,(ix+PWPHL)
(2) 1743/     929 : 19                  		add	hl,de
(2) 1744/     92A : DD 7E 08            		ld	a,(ix+PWPTH_V)
(2) 1745/     92D : E6 FC               		and	11111100b
(2) 1746/     92F : CF                  		rst	8
(2) 1747/     930 : B4                  		or	h
(2) 1748/     931 : DD 77 08            		ld	(ix+PWPTH_V),a
(2) 1749/     934 : DD 75 10            		ld	(ix+PWPHL),l
(2) 1750/     937 : DD 7E 00            		ld	a,(ix)			; pitch bend request
(2) 1751/     93A : F6 10               		or	00010000b
(2) 1752/     93C : DD 77 00            		ld	(ix),a
(2) 1753/     93F : 3E 01               		ld	a,1
(2) 1754/     941 : 32 31 00            		ld	(marsUpd),a
(2) 1755/     944 : C9                  		ret
(2) 1756/     945 :                     
(2) 1757/     945 :                     .freqinc_dac:
(2) 1758/     945 : 2A CA 19            		ld	hl,(wave_Pitch)		; tricky one...
(2) 1759/     948 : 19                  		add	hl,de
(2) 1760/     949 : 22 CA 19            		ld	(wave_Pitch),hl
(2) 1761/     94C : 3A 65 17            		ld	a,(daccom)
(2) 1762/     94F : F6 10               		or	00010000b
(2) 1763/     951 : 32 65 17            		ld	(daccom),a
(2) 1764/     954 : C9                  		ret
(2) 1765/     955 :                     
(2) 1766/     955 :                     .freqinc_fm:
(2) 1767/     955 : DD 7E 02            		ld	a,(ix+2)
(2) 1768/     958 : E6 07               		and	111b
(2) 1769/     95A : DD 21 45 16         		ld	ix,fmcom
(2) 1770/     95E : 06 00               		ld	b,0
(2) 1771/     960 : 4F                  		ld	c,a
(2) 1772/     961 : CF                  		rst	8
(2) 1773/     962 : DD 09               		add	ix,bc
(2) 1774/     964 : DD 66 18            		ld	h,(ix+FMFRQH)
(2) 1775/     967 : DD 6E 1E            		ld	l,(ix+FMFRQL)
(2) 1776/     96A : 19                  		add	hl,de
(2) 1777/     96B : DD 74 18            		ld	(ix+FMFRQH),h
(2) 1778/     96E : CF                  		rst	8
(2) 1779/     96F : DD 75 1E            		ld	(ix+FMFRQL),l
(2) 1780/     972 : DD 7E 00            		ld	a,(ix)
(2) 1781/     975 : F6 01               		or	00000001b
(2) 1782/     977 : DD 77 00            		ld	(ix),a
(2) 1783/     97A : C9                  		ret
(2) 1784/     97B :                     .freqinc_psg:
(2) 1785/     97B : DD 7E 02            		ld	a,(ix+2)
(2) 1786/     97E : E6 03               		and	011b
(2) 1787/     980 : DD 21 11 16         		ld	ix,psgcom
(2) 1788/     984 : 06 00               		ld	b,0
(2) 1789/     986 : 4F                  		ld	c,a
(2) 1790/     987 : DD 09               		add	ix,bc
(2) 1791/     989 : CF                  		rst	8
(2) 1792/     98A : DD 66 20            		ld	h,(ix+DTH)
(2) 1793/     98D : DD 6E 1C            		ld	l,(ix+DTL)
(2) 1794/     990 : 19                  		add	hl,de
(2) 1795/     991 : 7C                  		ld	a,h
(2) 1796/     992 : E6 07               		and	00000111b
(2) 1797/     994 : 67                  		ld	h,a
(2) 1798/     995 : CF                  		rst	8
(2) 1799/     996 : DD 74 20            		ld	(ix+DTH),h
(2) 1800/     999 : DD 75 1C            		ld	(ix+DTL),l
(2) 1801/     99C : DD 7E 00            		ld	a,(ix)
(2) 1802/     99F : F6 01               		or	00000001b
(2) 1803/     9A1 : DD 77 00            		ld	(ix),a
(2) 1804/     9A4 : C9                  		ret
(2) 1805/     9A5 :                     ; grab portametro value
(2) 1806/     9A5 :                     .grab_prtm:
(2) 1807/     9A5 : 16 00               		ld	d,0
(2) 1808/     9A7 : 7B                  		ld	a,e
(2) 1809/     9A8 : E6 F0               		and	11110000b
(2) 1810/     9AA : FE F0               		cp	0F0h
(2) 1811/     9AC : 20 07               		jr	nz,.e_nof
(2) 1812/     9AE : CF                  		rst	8
(2) 1813/     9AF : 7B                  		ld	a,e
(2) 1814/     9B0 : E6 0F               		and	0Fh
(2) 1815/     9B2 : 87                  		add	a,a
(2) 1816/     9B3 : 18 0E               		jr	.e_go
(2) 1817/     9B5 :                     .e_nof:
(2) 1818/     9B5 : CF                  		rst	8
(2) 1819/     9B6 : FE E0               		cp	0E0h
(2) 1820/     9B8 : 20 05               		jr	nz,.e_noef
(2) 1821/     9BA : 7B                  		ld	a,e
(2) 1822/     9BB : E6 0F               		and	0Fh
(2) 1823/     9BD : 18 04               		jr	.e_go
(2) 1824/     9BF :                     .e_noef:
(2) 1825/     9BF : CF                  		rst	8
(2) 1826/     9C0 : 7B                  		ld	a,e
(2) 1827/     9C1 : 87                  		add	a,a
(2) 1828/     9C2 : 87                  		add	a,a
(2) 1829/     9C3 :                     .e_go:
(2) 1830/     9C3 : C9                  		ret
(2) 1831/     9C4 :                     
(2) 1832/     9C4 :                     ; --------------------------------
(2) 1833/     9C4 :                     ; Effect X: Panning
(2) 1834/     9C4 :                     ; --------------------------------
(2) 1835/     9C4 :                     
(2) 1836/     9C4 :                     ; PWM points here too.
(2) 1837/     9C4 :                     .effPwm_X:
(2) 1838/     9C4 : 7B                  		ld	a,e
(2) 1839/     9C5 : 07                  		rlca
(2) 1840/     9C6 : 07                  		rlca
(2) 1841/     9C7 : E6 03               		and	00000011b
(2) 1842/     9C9 : 21 17 0A            		ld	hl,.fmpan_list
(2) 1843/     9CC : 11 00 00            		ld	de,0
(2) 1844/     9CF : 5F                  		ld	e,a
(2) 1845/     9D0 : CF                  		rst	8
(2) 1846/     9D1 : 19                  		add	hl,de
(2) 1847/     9D2 : 5E                  		ld	e,(hl)
(2) 1848/     9D3 : FD 7E 07            		ld	a,(iy+chnl_Flags)
(2) 1849/     9D6 : E6 CF               		and	11001111b
(2) 1850/     9D8 : B3                  		or	e
(2) 1851/     9D9 : FD 77 07            		ld	(iy+chnl_Flags),a
(2) 1852/     9DC : C9                  		ret
(2) 1853/     9DD :                     
(2) 1854/     9DD :                     ; PWM points here too.
(2) 1855/     9DD :                     .effFm_X:
(2) 1856/     9DD : DD 7E 02            		ld	a,(ix+2)
(2) 1857/     9E0 : E6 07               		and	111b
(2) 1858/     9E2 : 06 00               		ld	b,0
(2) 1859/     9E4 : 4F                  		ld	c,a
(2) 1860/     9E5 : DD 21 45 16         		ld	ix,fmcom
(2) 1861/     9E9 : DD 09               		add	ix,bc
(2) 1862/     9EB : 7B                  		ld	a,e
(2) 1863/     9EC : 07                  		rlca
(2) 1864/     9ED : 07                  		rlca
(2) 1865/     9EE : E6 03               		and	00000011b
(2) 1866/     9F0 : 21 17 0A            		ld	hl,.fmpan_list
(2) 1867/     9F3 : 11 00 00            		ld	de,0
(2) 1868/     9F6 : 5F                  		ld	e,a
(2) 1869/     9F7 : CF                  		rst	8
(2) 1870/     9F8 : 19                  		add	hl,de
(2) 1871/     9F9 : 5E                  		ld	e,(hl)
(2) 1872/     9FA : FD 7E 07            		ld	a,(iy+chnl_Flags)
(2) 1873/     9FD : E6 CF               		and	11001111b
(2) 1874/     9FF : B3                  		or	e
(2) 1875/     A00 : FD 77 07            		ld	(iy+chnl_Flags),a
(2) 1876/     A03 : FD 7E 07            		ld	a,(iy+chnl_Flags)
(2) 1877/     A06 : 87                  		add	a,a		; move LR bits
(2) 1878/     A07 : 87                  		add	a,a
(2) 1879/     A08 : 2F                  		cpl
(2) 1880/     A09 : E6 C0               		and	11000000b	; Set Panning ENABLE bits
(2) 1881/     A0B : DD 77 12            		ld	(ix+FMPAN),a
(2) 1882/     A0E :                     
(2) 1883/     A0E :                     ; 		ld	a,(iy+chnl_Flags)
(2) 1884/     A0E :                     ; 		add	a,a		; move LR bits
(2) 1885/     A0E :                     ; 		add	a,a
(2) 1886/     A0E :                     ; 		cpl
(2) 1887/     A0E :                     ; 		and	11000000b	; Set Panning ENABLE bits
(2) 1888/     A0E :                     ; 		ld	(ix+FMPAN),a
(2) 1889/     A0E :                     ; 		ld	e,11110000b	; ALLOWED keys (TEMPORAL)
(2) 1890/     A0E :                     ; 		rst	8
(2) 1891/     A0E :                     ; 		ld	(ix+FMKEYS),e
(2) 1892/     A0E : DD 7E 00            		ld	a,(ix)		; key on
(2) 1893/     A11 : F6 40               		or	01000000b
(2) 1894/     A13 : DD 77 00            		ld	(ix),a
(2) 1895/     A16 :                     
(2) 1896/     A16 : C9                  		ret
(2) 1897/     A17 :                     .fmpan_list:
(2) 1898/     A17 : 10                  		db 00010000b	; 000h
(2) 1899/     A18 : 10                  		db 00010000b	; 040h
(2) 1900/     A19 : 00                  		db 00000000b	; 080h
(2) 1901/     A1A : 20                  		db 00100000b	; 0C0h
(2) 1902/     A1B :                     
(2) 1903/     A1B :                     ; ----------------------------------------
(2) 1904/     A1B :                     ; bit 0
(2) 1905/     A1B :                     ; ----------------------------------------
(2) 1906/     A1B :                     
(2) 1907/     A1B :                     .req_note:
(2) 1908/     A1B : 2A BA 19            		ld	hl,(currInsPos)
(2) 1909/     A1E : DD 2A B8 19         		ld	ix,(currTblPos)
(2) 1910/     A22 : 7E                  		ld	a,(hl)
(2) 1911/     A23 : 4F                  		ld	c,a		; special copy
(2) 1912/     A24 : E6 F0               		and	11110000b
(2) 1913/     A26 : FE 80               		cp	80h		; PSG normal
(2) 1914/     A28 : CA 04 0B            		jp	z,.note_psg
(2) 1915/     A2B : FE 90               		cp	90h		; PSG noise
(2) 1916/     A2D : CA D7 0A            		jp	z,.note_psgn
(2) 1917/     A30 : FE A0               		cp	0A0h
(2) 1918/     A32 : CA D5 0B            		jp	z,.note_fm
(2) 1919/     A35 : CF                  		rst	8
(2) 1920/     A36 : FE B0               		cp	0B0h
(2) 1921/     A38 : CA B1 0B            		jp	z,.note_fm3
(2) 1922/     A3B : FE C0               		cp	0C0h
(2) 1923/     A3D : CA 6E 0B            		jp	z,.note_dac
(2) 1924/     A40 : FE D0               		cp	0D0h
(2) 1925/     A42 : CA 46 0A            		jp	z,.note_pwm
(2) 1926/     A45 : C9                  		ret
(2) 1927/     A46 :                     
(2) 1928/     A46 :                     ; --------------------------------
(2) 1929/     A46 :                     ; Note: PWM
(2) 1930/     A46 :                     ; --------------------------------
(2) 1931/     A46 :                     
(2) 1932/     A46 :                     .note_pwm:
(2) 1933/     A46 : 3E 01               		ld	a,1			; Send MARS request
(2) 1934/     A48 : 32 31 00            		ld	(marsUpd),a
(2) 1935/     A4B : 21 5B 1A            		ld	hl,pwmcom
(2) 1936/     A4E : DD 7E 02            		ld	a,(ix+2)
(2) 1937/     A51 : E6 07               		and	000111b
(2) 1938/     A53 : 06 00               		ld	b,0
(2) 1939/     A55 : 4F                  		ld	c,a
(2) 1940/     A56 : 09                  		add	hl,bc
(2) 1941/     A57 : CF                  		rst	8
(2) 1942/     A58 : FD 7E 01            		ld	a,(iy+chnl_Note)
(2) 1943/     A5B : FE FF               		cp	-1
(2) 1944/     A5D : CA A8 0A            		jp	z,.pwm_keyoff
(2) 1945/     A60 : FE FE               		cp	-2
(2) 1946/     A62 : CA AC 0A            		jp	z,.pwm_keycut
(2) 1947/     A65 : 11 00 00            		ld	de,0
(2) 1948/     A68 : DD 5E 03            		ld	e,(ix+3)		; Get pitch
(2) 1949/     A6B : 83                  		add	a,e
(2) 1950/     A6C : 87                  		add	a,a
(2) 1951/     A6D : CF                  		rst	8
(2) 1952/     A6E : 5F                  		ld	e,a
(2) 1953/     A6F : 79                  		ld	a,c
(2) 1954/     A70 : F6 D0               		or	0D0h
(2) 1955/     A72 : FD 77 00            		ld	(iy+chnl_Chip),a	; Set as PWM
(2) 1956/     A75 : E5                  		push	hl
(2) 1957/     A76 : DD E1               		pop	ix
(2) 1958/     A78 : 21 21 15            		ld	hl,wavFreq_List
(2) 1959/     A7B : 19                  		add	hl,de
(2) 1960/     A7C : 5E                  		ld	e,(hl)
(2) 1961/     A7D : 23                  		inc	hl
(2) 1962/     A7E : 56                  		ld	d,(hl)			; note: max 111b
(2) 1963/     A7F : CF                  		rst	8
(2) 1964/     A80 : DD CB 00 C6         		set	0,(ix)			; Note-on
(2) 1965/     A84 : 7A                  		ld	a,d
(2) 1966/     A85 : FD CB 07 56         		bit	2,(iy+chnl_Flags)	; check if volume is being used
(2) 1967/     A89 : 28 06               		jr	z,.pwmn_kpv
(2) 1968/     A8B : DD 7E 08            		ld	a,(ix+PWPTH_V)
(2) 1969/     A8E : E6 FC               		and	11111100b
(2) 1970/     A90 : B2                  		or	d
(2) 1971/     A91 :                     .pwmn_kpv:
(2) 1972/     A91 : DD 77 08            		ld	(ix+PWPTH_V),a
(2) 1973/     A94 : DD 73 10            		ld	(ix+PWPHL),e
(2) 1974/     A97 : DD 7E 18            		ld	a,(ix+PWOUTF)
(2) 1975/     A9A : E6 CF               		and	11001111b		; Keep other bits
(2) 1976/     A9C : 4F                  		ld	c,a
(2) 1977/     A9D : FD 7E 07            		ld	a,(iy+chnl_Flags)	; 00LR 0000
(2) 1978/     AA0 : 2F                  		cpl
(2) 1979/     AA1 : E6 30               		and	00110000b
(2) 1980/     AA3 : B1                  		or	c
(2) 1981/     AA4 : DD 77 18            		ld	(ix+PWOUTF),a
(2) 1982/     AA7 : C9                  		ret
(2) 1983/     AA8 :                     
(2) 1984/     AA8 :                     ; PSG Keyoff
(2) 1985/     AA8 :                     .pwm_keyoff:
(2) 1986/     AA8 : 0E 02               		ld	c,010b
(2) 1987/     AAA : 71                  		ld	(hl),c
(2) 1988/     AAB : C9                  		ret
(2) 1989/     AAC :                     .pwm_keycut:
(2) 1990/     AAC : 0E 04               		ld	c,100b
(2) 1991/     AAE : 18 06               		jr	.chnl_unlink
(2) 1992/     AB0 :                     
(2) 1993/     AB0 :                     ; 		ld	a,100b			; Request DAC stop
(2) 1994/     AB0 :                     ; 		ld	(daccom),a
(2) 1995/     AB0 :                     ; .doff:
(2) 1996/     AB0 :                     ; 		ld	hl,0
(2) 1997/     AB0 :                     ; 		ld	(tblFM6),hl
(2) 1998/     AB0 :                     ; 		ld	(iy+chnl_Chip),0
(2) 1999/     AB0 :                     ; 		ret
(2) 2000/     AB0 :                     
(2) 2001/     AB0 :                     ; --------------------------------
(2) 2002/     AB0 :                     ; Note: PSG1-3,PSGN
(2) 2003/     AB0 :                     ; --------------------------------
(2) 2004/     AB0 :                     
(2) 2005/     AB0 :                     ; PSG Keyoff
(2) 2006/     AB0 :                     .poff:
(2) 2007/     AB0 : 0E 02               		ld	c,010b
(2) 2008/     AB2 : 71                  		ld	(hl),c
(2) 2009/     AB3 : C9                  		ret
(2) 2010/     AB4 :                     ; PSG Keycut
(2) 2011/     AB4 :                     .pcut:
(2) 2012/     AB4 : 0E 04               		ld	c,100b
(2) 2013/     AB6 :                     .chnl_unlink:
(2) 2014/     AB6 : CF                  		rst	8
(2) 2015/     AB7 : FD E5               		push	iy
(2) 2016/     AB9 : D1                  		pop	de
(2) 2017/     ABA : DD 7E 00            		ld	a,(ix)
(2) 2018/     ABD : BB                  		cp	e
(2) 2019/     ABE : C0                  		ret	nz
(2) 2020/     ABF : DD 7E 01            		ld	a,(ix+1)
(2) 2021/     AC2 : BA                  		cp	d
(2) 2022/     AC3 : C0                  		ret	nz
(2) 2023/     AC4 : CF                  		rst	8
(2) 2024/     AC5 : 71                  		ld	(hl),c
(2) 2025/     AC6 : DD 36 00 00         		ld	(ix),0
(2) 2026/     ACA : DD 36 01 00         		ld	(ix+1),0
(2) 2027/     ACE : DD 36 03 00         		ld	(ix+3),0	; pitch zero
(2) 2028/     AD2 : FD 36 00 00         		ld	(iy+chnl_Chip),0
(2) 2029/     AD6 : C9                  		ret
(2) 2030/     AD7 :                     
(2) 2031/     AD7 :                     ; Play PSG note
(2) 2032/     AD7 :                     .note_psgn:
(2) 2033/     AD7 : DD 7E 02            		ld	a,(ix+2)
(2) 2034/     ADA : F6 90               		or	90h
(2) 2035/     ADC : FD 77 00            		ld	(iy+chnl_Chip),a
(2) 2036/     ADF : 21 14 16            		ld 	hl,psgcom+3
(2) 2037/     AE2 : FD 7E 01            		ld	a,(iy+chnl_Note)
(2) 2038/     AE5 : FE FE               		cp	-2
(2) 2039/     AE7 : CA B4 0A            		jp	z,.pcut
(2) 2040/     AEA : FE FF               		cp	-1
(2) 2041/     AEC : CA B0 0A            		jp	z,.poff
(2) 2042/     AEF : 5F                  		ld	e,a
(2) 2043/     AF0 : DD 7E 04            		ld 	a,(ix+4)
(2) 2044/     AF3 : 32 47 1F            		ld	(psgHatMode),a
(2) 2045/     AF6 : E6 03               		and	011b
(2) 2046/     AF8 : FE 03               		cp	011b
(2) 2047/     AFA : 20 05               		jr	nz,.np2_n
(2) 2048/     AFC : 3E 04               		ld	a,100b
(2) 2049/     AFE : 32 13 16            		ld	(psgcom+2),a
(2) 2050/     B01 :                     .np2_n:
(2) 2051/     B01 : 7B                  		ld	a,e
(2) 2052/     B02 : 18 32               		jr	.notepsg_fn
(2) 2053/     B04 :                     .note_psg:
(2) 2054/     B04 : DD 7E 02            		ld	a,(ix+2)
(2) 2055/     B07 : F6 80               		or	80h
(2) 2056/     B09 : FD 77 00            		ld	(iy+chnl_Chip),a
(2) 2057/     B0C : DD 7E 02            		ld	a,(ix+2)
(2) 2058/     B0F : CF                  		rst	8
(2) 2059/     B10 : E6 03               		and	11b
(2) 2060/     B12 : 16 00               		ld	d,0
(2) 2061/     B14 : 5F                  		ld	e,a
(2) 2062/     B15 : 21 11 16            		ld 	hl,psgcom
(2) 2063/     B18 : 19                  		add	hl,de
(2) 2064/     B19 : FE 02               		cp	2
(2) 2065/     B1B : 20 0C               		jr	nz,.notepsg_c
(2) 2066/     B1D : 3A 47 1F            		ld	a,(psgHatMode)
(2) 2067/     B20 : E6 03               		and	011b
(2) 2068/     B22 : FE 03               		cp	011b
(2) 2069/     B24 : 20 03               		jr	nz,.notepsg_c
(2) 2070/     B26 : 36 04               		ld	(hl),100b	; key-cut PSG3 but dont unlink
(2) 2071/     B28 : C9                  		ret
(2) 2072/     B29 :                     .notepsg_c:
(2) 2073/     B29 : FD 7E 01            		ld	a,(iy+chnl_Note)
(2) 2074/     B2C : FE FE               		cp	-2
(2) 2075/     B2E : CA B4 0A            		jp	z,.pcut
(2) 2076/     B31 : FE FF               		cp	-1
(2) 2077/     B33 : CA B0 0A            		jp	z,.poff
(2) 2078/     B36 :                     .notepsg_fn:
(2) 2079/     B36 : CF                  		rst	8
(2) 2080/     B37 : E5                  		push	hl		; save psgcom
(2) 2081/     B38 : 21 2F 14            		ld	hl,psgFreq_List
(2) 2082/     B3B : DD 4E 03            		ld	c,(ix+3)
(2) 2083/     B3E : 81                  		add	a,c
(2) 2084/     B3F : 87                  		add	a,a
(2) 2085/     B40 : 11 00 00            		ld	de,0
(2) 2086/     B43 : 5F                  		ld	e,a
(2) 2087/     B44 : 19                  		add	hl,de
(2) 2088/     B45 : 5E                  		ld	e,(hl)
(2) 2089/     B46 : 23                  		inc	hl
(2) 2090/     B47 : 56                  		ld	d,(hl)
(2) 2091/     B48 : 01 00 00            		ld	bc,0
(2) 2092/     B4B : E6 03               		and	11b
(2) 2093/     B4D : 4F                  		ld	c,a
(2) 2094/     B4E : DD E5               		push	ix		; swap ix to hl
(2) 2095/     B50 : E1                  		pop	hl
(2) 2096/     B51 : CF                  		rst	8
(2) 2097/     B52 : 23                  		inc	hl		; skip link
(2) 2098/     B53 : 23                  		inc	hl
(2) 2099/     B54 : 23                  		inc 	hl		; channel id
(2) 2100/     B55 : 23                  		inc	hl		; pitch
(2) 2101/     B56 :                     ; 		ld	a,c
(2) 2102/     B56 :                     ; 		cp	3
(2) 2103/     B56 :                     ; 		jr	nz,.npsg2
(2) 2104/     B56 :                     ; 		ld 	a,(ix+4)
(2) 2105/     B56 :                     ; 		ld	(psgHatMode),a
(2) 2106/     B56 :                     ; .npsg2:
(2) 2107/     B56 : DD E1               		pop	ix			; restore psgcom as ix
(2) 2108/     B58 : FD 7E 07            		ld	a,(iy+chnl_Flags)	; Check is volume bit
(2) 2109/     B5B : CB 57               		bit	2,a			; is being used
(2) 2110/     B5D : 20 04               		jr	nz,.nodefv
(2) 2111/     B5F : DD 36 30 00         		ld	(ix+PVOL),0		; if not, set max volume
(2) 2112/     B63 :                     .nodefv:
(2) 2113/     B63 : DD 73 1C            		ld	(ix+DTL),e
(2) 2114/     B66 : DD 72 20            		ld	(ix+DTH),d
(2) 2115/     B69 : DD 36 00 01         		ld	(ix+COM),001b	; Key ON
(2) 2116/     B6D : C9                  		ret
(2) 2117/     B6E :                     
(2) 2118/     B6E :                     ; --------------------------------
(2) 2119/     B6E :                     ; Note: FM,FM3,FM6
(2) 2120/     B6E :                     ; --------------------------------
(2) 2121/     B6E :                     
(2) 2122/     B6E :                     .note_dac:
(2) 2123/     B6E : 21 65 17            		ld	hl,daccom
(2) 2124/     B71 : FD 7E 01            		ld	a,(iy+chnl_Note)
(2) 2125/     B74 : FE FF               		cp	-1
(2) 2126/     B76 : CA 72 0C            		jp	z,.fm_keyoff
(2) 2127/     B79 : FE FE               		cp	-2
(2) 2128/     B7B : CA 6D 0C            		jp	z,.fm_keycut
(2) 2129/     B7E : FD 36 00 C0         		ld	(iy+chnl_Chip),0C0h	; Set as DAC
(2) 2130/     B82 : 11 00 00            		ld	de,0
(2) 2131/     B85 : DD 5E 03            		ld	e,(ix+3)		; Get pitch
(2) 2132/     B88 : 83                  		add	a,e
(2) 2133/     B89 : 87                  		add	a,a
(2) 2134/     B8A : 5F                  		ld	e,a
(2) 2135/     B8B : 21 21 15            		ld	hl,wavFreq_List
(2) 2136/     B8E : 19                  		add	hl,de
(2) 2137/     B8F : 7E                  		ld	a,(hl)
(2) 2138/     B90 : 23                  		inc	hl
(2) 2139/     B91 : 66                  		ld	h,(hl)
(2) 2140/     B92 : CF                  		rst	8
(2) 2141/     B93 : 6F                  		ld	l,a
(2) 2142/     B94 : 11 E8 FF            		ld	de,ZSET_WTUNE		; Fine-tune to desired
(2) 2143/     B97 : 19                  		add	hl,de			; WAVE frequency
(2) 2144/     B98 : 22 CA 19            		ld	(wave_Pitch),hl
(2) 2145/     B9B :                     ; 		ld	a,1
(2) 2146/     B9B :                     ; 		and	001b
(2) 2147/     B9B :                     ; 		ld	(wave_Flags),a
(2) 2148/     B9B : 3E 01               		ld	a,001b			; Request DAC play
(2) 2149/     B9D : 32 65 17            		ld	(daccom),a
(2) 2150/     BA0 : C9                  		ret
(2) 2151/     BA1 :                     .dcut:
(2) 2152/     BA1 : 3E 04               		ld	a,100b			; Request DAC stop
(2) 2153/     BA3 : 32 65 17            		ld	(daccom),a
(2) 2154/     BA6 :                     .doff:
(2) 2155/     BA6 : 21 00 00            		ld	hl,0
(2) 2156/     BA9 : 22 17 1A            		ld	(tblFM6),hl
(2) 2157/     BAC : FD 36 00 00         		ld	(iy+chnl_Chip),0
(2) 2158/     BB0 : C9                  		ret
(2) 2159/     BB1 :                     ; FM3 special
(2) 2160/     BB1 :                     .note_fm3:
(2) 2161/     BB1 : 21 47 16            		ld	hl,fmcom+2		; Channel 3 fmcom
(2) 2162/     BB4 : FD 7E 01            		ld	a,(iy+chnl_Note)
(2) 2163/     BB7 : FE FF               		cp	-1
(2) 2164/     BB9 : CA 72 0C            		jp	z,.fm_keyoff
(2) 2165/     BBC : FE FE               		cp	-2
(2) 2166/     BBE : CA 6D 0C            		jp	z,.fm_keycut
(2) 2167/     BC1 : FD 36 00 B0         		ld	(iy+chnl_Chip),0B0h	; Set as FM3 special
(2) 2168/     BC5 : 16 27               		ld	d,27h
(2) 2169/     BC7 : 3E 40               		ld	a,01000000b
(2) 2170/     BC9 : 32 48 1F            		ld	(fmSpcMode),a
(2) 2171/     BCC : 5F                  		ld	e,a
(2) 2172/     BCD : CD D7 12            		call	fm_send_1
(2) 2173/     BD0 : E5                  		push	hl
(2) 2174/     BD1 : DD E1               		pop	ix
(2) 2175/     BD3 : 18 74               		jr	.fm_chnlkon
(2) 2176/     BD5 :                     ; Normal FM
(2) 2177/     BD5 :                     .note_fm:
(2) 2178/     BD5 : FD 7E 01            		ld	a,(iy+chnl_Note)
(2) 2179/     BD8 : 57                  		ld	d,a
(2) 2180/     BD9 : DD 5E 03            		ld	e,(ix+3)
(2) 2181/     BDC : 83                  		add	a,e
(2) 2182/     BDD : CF                  		rst	8
(2) 2183/     BDE : 4F                  		ld	c,a			; c - Note+pitch
(2) 2184/     BDF : DD 7E 02            		ld	a,(ix+2)
(2) 2185/     BE2 : 47                  		ld	b,a
(2) 2186/     BE3 : E6 07               		and	00000111b
(2) 2187/     BE5 : 21 45 16            		ld	hl,fmcom		; hl - fmcom list
(2) 2188/     BE8 : 11 00 00            		ld	de,0
(2) 2189/     BEB : E6 07               		and	111b
(2) 2190/     BED : 5F                  		ld	e,a
(2) 2191/     BEE : 19                  		add	hl,de
(2) 2192/     BEF : CF                  		rst	8
(2) 2193/     BF0 : FD 7E 01            		ld	a,(iy+chnl_Note)
(2) 2194/     BF3 : FE FF               		cp	-1
(2) 2195/     BF5 : 28 7B               		jr	z,.fm_keyoff
(2) 2196/     BF7 : FE FE               		cp	-2
(2) 2197/     BF9 : 28 72               		jr	z,.fm_keycut
(2) 2198/     BFB : 78                  		ld	a,b			; Set chip as FM
(2) 2199/     BFC : E6 07               		and	111b
(2) 2200/     BFE : FE 02               		cp	2			; Check if we got into channel 3
(2) 2201/     C00 : 20 0E               		jr	nz,.rd_nt3
(2) 2202/     C02 : 47                  		ld	b,a
(2) 2203/     C03 : 16 27               		ld	d,27h			; Disable CH3 special mode
(2) 2204/     C05 : 3E 00               		ld	a,00000000b
(2) 2205/     C07 : 32 48 1F            		ld	(fmSpcMode),a
(2) 2206/     C0A : CF                  		rst	8
(2) 2207/     C0B : 5F                  		ld	e,a
(2) 2208/     C0C : CD D7 12            		call	fm_send_1
(2) 2209/     C0F : 78                  		ld	a,b
(2) 2210/     C10 :                     .rd_nt3:
(2) 2211/     C10 : F6 A0               		or	0A0h
(2) 2212/     C12 : FD 77 00            		ld	(iy+chnl_Chip),a
(2) 2213/     C15 : 79                  		ld	a,c
(2) 2214/     C16 : CF                  		rst	8
(2) 2215/     C17 : 06 00               		ld	b,0			; b - octave
(2) 2216/     C19 : 1E 07               		ld	e,7
(2) 2217/     C1B :                     .get_oct:
(2) 2218/     C1B : 4F                  		ld	c,a
(2) 2219/     C1C : D6 0C               		sub	12
(2) 2220/     C1E : B7                  		or	a
(2) 2221/     C1F : FA 26 0C            		jp	m,.fnd_oct
(2) 2222/     C22 : 04                  		inc	b
(2) 2223/     C23 : 1D                  		dec	e
(2) 2224/     C24 : 20 F5               		jr	nz,.get_oct
(2) 2225/     C26 :                     .fnd_oct:
(2) 2226/     C26 :                     	; b - octave / c - note
(2) 2227/     C26 : D5                  		push	de
(2) 2228/     C27 : CF                  		rst	8		; ix - current fmcom
(2) 2229/     C28 : 79                  		ld	a,c
(2) 2230/     C29 : 87                  		add	a,a
(2) 2231/     C2A : 4F                  		ld	c,a		; c - freq word
(2) 2232/     C2B : 78                  		ld	a,b
(2) 2233/     C2C : 87                  		add	a,a
(2) 2234/     C2D : 87                  		add	a,a
(2) 2235/     C2E : 87                  		add	a,a
(2) 2236/     C2F : 06 00               		ld	b,0
(2) 2237/     C31 : E5                  		push	hl
(2) 2238/     C32 : CF                  		rst	8
(2) 2239/     C33 : DD E1               		pop	ix
(2) 2240/     C35 : 21 17 14            		ld	hl,fmFreq_List
(2) 2241/     C38 : 09                  		add	hl,bc
(2) 2242/     C39 : 23                  		inc	hl
(2) 2243/     C3A : 4F                  		ld	c,a		; c - octave << 3
(2) 2244/     C3B : 7E                  		ld	a,(hl)		; Note MSB
(2) 2245/     C3C : B1                  		or	c		; add octave
(2) 2246/     C3D : 57                  		ld	d,a
(2) 2247/     C3E : 2B                  		dec	hl
(2) 2248/     C3F : CF                  		rst	8
(2) 2249/     C40 : 7E                  		ld	a,(hl)
(2) 2250/     C41 : 5F                  		ld	e,a
(2) 2251/     C42 : DD 72 18            		ld	(ix+FMFRQH),d	; Save freq MSB
(2) 2252/     C45 : DD 73 1E            		ld	(ix+FMFRQL),e	; Save freq LSB
(2) 2253/     C48 : D1                  		pop	de
(2) 2254/     C49 :                     .fm_chnlkon:
(2) 2255/     C49 : FD 7E 07            		ld	a,(iy+chnl_Flags)
(2) 2256/     C4C : 87                  		add	a,a		; move LR bits
(2) 2257/     C4D : 87                  		add	a,a
(2) 2258/     C4E : 2F                  		cpl
(2) 2259/     C4F : E6 C0               		and	11000000b	; Set Panning ENABLE bits
(2) 2260/     C51 : DD 77 12            		ld	(ix+FMPAN),a
(2) 2261/     C54 : 1E F0               		ld	e,11110000b	; ALLOWED keys (TEMPORAL)
(2) 2262/     C56 : CF                  		rst	8
(2) 2263/     C57 : DD 73 06            		ld	(ix+FMKEYS),e
(2) 2264/     C5A : DD 7E 00            		ld	a,(ix)		; key on
(2) 2265/     C5D : F6 41               		or	01000001b
(2) 2266/     C5F : DD 77 00            		ld	(ix),a
(2) 2267/     C62 : FD CB 07 56         		bit	2,(iy+chnl_Flags)	; check if volume is being used
(2) 2268/     C66 : 20 04               		jr	nz,.fm_kpv
(2) 2269/     C68 : DD 36 0C 00         		ld	(ix+FMVOL),0
(2) 2270/     C6C :                     .fm_kpv:
(2) 2271/     C6C : C9                  		ret
(2) 2272/     C6D :                     
(2) 2273/     C6D :                     ; keyoff/cut
(2) 2274/     C6D :                     .fm_keycut:
(2) 2275/     C6D : 0E 04               		ld	c,100b
(2) 2276/     C6F : C3 B6 0A            		jp	.chnl_unlink
(2) 2277/     C72 :                     .fm_keyoff:
(2) 2278/     C72 : 0E 02               		ld	c,010b
(2) 2279/     C74 : 71                  		ld	(hl),c
(2) 2280/     C75 : C9                  		ret
(2) 2281/     C76 :                     
(2) 2282/     C76 :                     ; ----------------------------------------
(2) 2283/     C76 :                     ; Channel chip swap
(2) 2284/     C76 :                     ; ----------------------------------------
(2) 2285/     C76 :                     
(2) 2286/     C76 :                     .chip_swap:
(2) 2287/     C76 : 4F                  		ld	c,a		; c - New chip ID
(2) 2288/     C77 : E6 F0               		and	11110000b
(2) 2289/     C79 : 47                  		ld	b,a
(2) 2290/     C7A : FD 7E 00            		ld	a,(iy+chnl_Chip)
(2) 2291/     C7D : CF                  		rst	8
(2) 2292/     C7E : 5F                  		ld	e,a		; e - Old chip ID
(2) 2293/     C7F : E6 F0               		and	11110000b
(2) 2294/     C81 : B8                  		cp	b
(2) 2295/     C82 : 28 2E               		jr	z,.chip_out
(2) 2296/     C84 : 57                  		ld	d,a		; d - reuse last ID
(2) 2297/     C85 : 79                  		ld	a,c		; New chip-ins is null?
(2) 2298/     C86 : FE FF               		cp	-1
(2) 2299/     C88 : 20 05               		jr	nz,.from_nl
(2) 2300/     C8A : 7B                  		ld	a,e		; Reuse OLD ID
(2) 2301/     C8B : CF                  		rst	8
(2) 2302/     C8C : E6 F0               		and	11110000b
(2) 2303/     C8E : 57                  		ld	d,a		; new id to check
(2) 2304/     C8F :                     .from_nl:
(2) 2305/     C8F : 7A                  		ld	a,d
(2) 2306/     C90 : 16 00               		ld	d,0
(2) 2307/     C92 : FE 80               		cp	80h
(2) 2308/     C94 : CC 01 0D            		call	z,.psg_out
(2) 2309/     C97 : FE 90               		cp	90h
(2) 2310/     C99 : CC F3 0C            		call	z,.psgn_out
(2) 2311/     C9C : CF                  		rst	8
(2) 2312/     C9D : FE A0               		cp	0A0h
(2) 2313/     C9F : CC 21 0D            		call	z,.fm_out
(2) 2314/     CA2 : FE B0               		cp	0B0h
(2) 2315/     CA4 : CC E5 0C            		call	z,.fm3_out
(2) 2316/     CA7 : FE C0               		cp	0C0h
(2) 2317/     CA9 : CC D7 0C            		call	z,.dac_out
(2) 2318/     CAC : FE D0               		cp	0D0h
(2) 2319/     CAE : CC B4 0C            		call	z,.pwm_out
(2) 2320/     CB1 : CF                  		rst	8
(2) 2321/     CB2 :                     .chip_out:
(2) 2322/     CB2 : 79                  		ld	a,c
(2) 2323/     CB3 : C9                  		ret
(2) 2324/     CB4 :                     
(2) 2325/     CB4 :                     .pwm_out:
(2) 2326/     CB4 : E5                  		push	hl
(2) 2327/     CB5 : 7B                  		ld	a,e
(2) 2328/     CB6 : E6 07               		and	111b
(2) 2329/     CB8 : 47                  		ld	b,a
(2) 2330/     CB9 : 5F                  		ld	e,a
(2) 2331/     CBA : CF                  		rst	8
(2) 2332/     CBB : 87                  		add	a,a
(2) 2333/     CBC : 87                  		add	a,a
(2) 2334/     CBD : 87                  		add	a,a
(2) 2335/     CBE : 5F                  		ld	e,a
(2) 2336/     CBF : 21 21 1A            		ld	hl,tblPWM
(2) 2337/     CC2 : 19                  		add	hl,de
(2) 2338/     CC3 : CD 3F 0D            		call	.chp_unlk
(2) 2339/     CC6 : CF                  		rst	8
(2) 2340/     CC7 : 16 00               		ld	d,0
(2) 2341/     CC9 : 58                  		ld	e,b
(2) 2342/     CCA : 21 5B 1A            		ld	hl,pwmcom
(2) 2343/     CCD : 19                  		add	hl,de
(2) 2344/     CCE : 36 04               		ld	(hl),100b
(2) 2345/     CD0 : 3E 01               		ld	a,1
(2) 2346/     CD2 : 32 31 00            		ld	(marsUpd),a
(2) 2347/     CD5 : 18 48               		jr	.p_out
(2) 2348/     CD7 :                     
(2) 2349/     CD7 :                     .dac_out:
(2) 2350/     CD7 : E5                  		push	hl
(2) 2351/     CD8 : 21 17 1A            		ld	hl,tblFM6
(2) 2352/     CDB : CD 3F 0D            		call	.chp_unlk
(2) 2353/     CDE : 21 65 17            		ld	hl,daccom
(2) 2354/     CE1 : 36 04               		ld	(hl),100b
(2) 2355/     CE3 : E1                  		pop	hl
(2) 2356/     CE4 : C9                  		ret
(2) 2357/     CE5 :                     .fm3_out:
(2) 2358/     CE5 : E5                  		push	hl
(2) 2359/     CE6 : 21 0F 1A            		ld	hl,tblFM3
(2) 2360/     CE9 : CD 3F 0D            		call	.chp_unlk
(2) 2361/     CEC : 21 47 16            		ld	hl,fmcom+2
(2) 2362/     CEF : 36 04               		ld	(hl),100b
(2) 2363/     CF1 : E1                  		pop	hl
(2) 2364/     CF2 : C9                  		ret
(2) 2365/     CF3 :                     .psgn_out:
(2) 2366/     CF3 : E5                  		push	hl
(2) 2367/     CF4 : 21 E7 19            		ld	hl,tblPSGN
(2) 2368/     CF7 : CD 3F 0D            		call	.chp_unlk
(2) 2369/     CFA : 21 14 16            		ld	hl,psgcom+3
(2) 2370/     CFD : 36 04               		ld	(hl),100b
(2) 2371/     CFF : E1                  		pop	hl
(2) 2372/     D00 : C9                  		ret
(2) 2373/     D01 :                     .psg_out:
(2) 2374/     D01 : E5                  		push	hl
(2) 2375/     D02 : 7B                  		ld	a,e
(2) 2376/     D03 : E6 03               		and	011b
(2) 2377/     D05 : 47                  		ld	b,a
(2) 2378/     D06 : 5F                  		ld	e,a
(2) 2379/     D07 : 87                  		add	a,a
(2) 2380/     D08 : CF                  		rst	8
(2) 2381/     D09 : 87                  		add	a,a
(2) 2382/     D0A : 87                  		add	a,a
(2) 2383/     D0B : 5F                  		ld	e,a
(2) 2384/     D0C : 21 CD 19            		ld	hl,tblPSG
(2) 2385/     D0F : 19                  		add	hl,de
(2) 2386/     D10 : CD 3F 0D            		call	.chp_unlk
(2) 2387/     D13 : 20 0A               		jr	nz,.p_out
(2) 2388/     D15 : CF                  		rst	8
(2) 2389/     D16 : 16 00               		ld	d,0
(2) 2390/     D18 : 58                  		ld	e,b
(2) 2391/     D19 : 21 11 16            		ld	hl,psgcom
(2) 2392/     D1C : 19                  		add	hl,de
(2) 2393/     D1D : 36 04               		ld	(hl),100b
(2) 2394/     D1F :                     .p_out:
(2) 2395/     D1F : E1                  		pop	hl
(2) 2396/     D20 : C9                  		ret
(2) 2397/     D21 :                     .fm_out:
(2) 2398/     D21 : E5                  		push	hl
(2) 2399/     D22 : 7B                  		ld	a,e
(2) 2400/     D23 : E6 07               		and	111b
(2) 2401/     D25 : 47                  		ld	b,a
(2) 2402/     D26 : 5F                  		ld	e,a
(2) 2403/     D27 : CF                  		rst	8
(2) 2404/     D28 : 87                  		add	a,a
(2) 2405/     D29 : 87                  		add	a,a
(2) 2406/     D2A : 87                  		add	a,a
(2) 2407/     D2B : 5F                  		ld	e,a
(2) 2408/     D2C : 21 EF 19            		ld	hl,tblFM
(2) 2409/     D2F : 19                  		add	hl,de
(2) 2410/     D30 : CD 3F 0D            		call	.chp_unlk
(2) 2411/     D33 : CF                  		rst	8
(2) 2412/     D34 : 16 00               		ld	d,0
(2) 2413/     D36 : 58                  		ld	e,b
(2) 2414/     D37 : 21 45 16            		ld	hl,fmcom
(2) 2415/     D3A : 19                  		add	hl,de
(2) 2416/     D3B : 36 04               		ld	(hl),100b
(2) 2417/     D3D : 18 E0               		jr	.p_out
(2) 2418/     D3F :                     
(2) 2419/     D3F :                     .chp_unlk:
(2) 2420/     D3F : FD E5               		push	iy
(2) 2421/     D41 : D1                  		pop	de
(2) 2422/     D42 : CF                  		rst	8
(2) 2423/     D43 : 7E                  		ld	a,(hl)
(2) 2424/     D44 : BB                  		cp	e
(2) 2425/     D45 : C0                  		ret	nz
(2) 2426/     D46 : 23                  		inc	hl
(2) 2427/     D47 : 7E                  		ld	a,(hl)
(2) 2428/     D48 : BA                  		cp	d
(2) 2429/     D49 : C0                  		ret	nz
(2) 2430/     D4A : 2B                  		dec	hl
(2) 2431/     D4B : CF                  		rst	8
(2) 2432/     D4C : 36 00               		ld	(hl),0
(2) 2433/     D4E : 23                  		inc	hl
(2) 2434/     D4F : 36 00               		ld	(hl),0
(2) 2435/     D51 : 23                  		inc	hl
(2) 2436/     D52 : 5E                  		ld	e,(hl)	; c - ID
(2) 2437/     D53 : 23                  		inc	hl
(2) 2438/     D54 : 36 00               		ld	(hl),0	; reset 5 bytes of settings
(2) 2439/     D56 : CF                  		rst	8
(2) 2440/     D57 : 23                  		inc	hl
(2) 2441/     D58 : 36 00               		ld	(hl),0
(2) 2442/     D5A : 23                  		inc	hl
(2) 2443/     D5B : 36 00               		ld	(hl),0
(2) 2444/     D5D : 23                  		inc	hl
(2) 2445/     D5E : 36 00               		ld	(hl),0
(2) 2446/     D60 : 23                  		inc	hl
(2) 2447/     D61 : 36 00               		ld	(hl),0
(2) 2448/     D63 : AF                  		xor	a
(2) 2449/     D64 : B7                  		or	a
(2) 2450/     D65 : C9                  		ret
(2) 2451/     D66 :                     
(2) 2452/     D66 :                     ; ----------------------------------------
(2) 2453/     D66 :                     ; Sets current instrument data
(2) 2454/     D66 :                     ;
(2) 2455/     D66 :                     ;   -1 - Null instrument
(2) 2456/     D66 :                     ;  80h - PSG
(2) 2457/     D66 :                     ;  90h - PSG Noise
(2) 2458/     D66 :                     ; 0A0h - FM
(2) 2459/     D66 :                     ; 0B0h - FM3 Special
(2) 2460/     D66 :                     ; 0C0h - FM6 Sample
(2) 2461/     D66 :                     ; 0D0h - PWM (or extra)
(2) 2462/     D66 :                     ; ----------------------------------------
(2) 2463/     D66 :                     
(2) 2464/     D66 :                     .check_ins:
(2) 2465/     D66 : FD 7E 02            		ld	a,(iy+chnl_Ins)
(2) 2466/     D69 : 3D                  		dec	a		; minus 1
(2) 2467/     D6A : F8                  		ret	m		; return as -1 if no ins is used.
(2) 2468/     D6B : 87                  		add	a,a		; * 08h
(2) 2469/     D6C : 87                  		add	a,a
(2) 2470/     D6D : CF                  		rst	8
(2) 2471/     D6E : 87                  		add	a,a
(2) 2472/     D6F : 2A B6 19            		ld	hl,(currInsData)
(2) 2473/     D72 : 11 00 00            		ld	de,0
(2) 2474/     D75 : 5F                  		ld	e,a
(2) 2475/     D76 : 19                  		add	hl,de
(2) 2476/     D77 : 7E                  		ld	a,(hl)
(2) 2477/     D78 : C9                  		ret
(2) 2478/     D79 :                     
(2) 2479/     D79 :                     ; ----------------------------------------
(2) 2480/     D79 :                     ; Checks which channel type is using
(2) 2481/     D79 :                     ; auto-set channel
(2) 2482/     D79 :                     ;
(2) 2483/     D79 :                     ; a - sound chip
(2) 2484/     D79 :                     ; ----------------------------------------
(2) 2485/     D79 :                     
(2) 2486/     D79 :                     .check_chnl:
(2) 2487/     D79 : FE FF               		cp	-1		; if -1: Null
(2) 2488/     D7B : C8                  		ret	z
(2) 2489/     D7C : CF                  		rst	8
(2) 2490/     D7D : 4F                  		ld	c,a		; save copy to c
(2) 2491/     D7E : 87                  		add	a,a		; * 2
(2) 2492/     D7F : 16 00               		ld	d,0
(2) 2493/     D81 : 0F                  		rrca
(2) 2494/     D82 : 0F                  		rrca
(2) 2495/     D83 : 0F                  		rrca
(2) 2496/     D84 : 0F                  		rrca
(2) 2497/     D85 : E6 0F               		and	00001111b
(2) 2498/     D87 : 5F                  		ld	e,a
(2) 2499/     D88 : DD 21 AA 0D         		ld	ix,.tbllist	; get table from list
(2) 2500/     D8C : DD 19               		add	ix,de
(2) 2501/     D8E : DD 5E 00            		ld	e,(ix)
(2) 2502/     D91 : DD 56 01            		ld	d,(ix+1)
(2) 2503/     D94 : CF                  		rst	8
(2) 2504/     D95 : D5                  		push	de
(2) 2505/     D96 : DD E1               		pop	ix
(2) 2506/     D98 : 79                  		ld	a,c		; restore from c
(2) 2507/     D99 : FE 90               		cp	90h		; type PSGN?
(2) 2508/     D9B : 28 19               		jr	z,.chk_tbln
(2) 2509/     D9D : FE B0               		cp	0B0h		; type FM3?
(2) 2510/     D9F : 28 15               		jr	z,.chk_tbln
(2) 2511/     DA1 : FE C0               		cp	0C0h		; type DAC?
(2) 2512/     DA3 : 28 11               		jr	z,.chk_tbln
(2) 2513/     DA5 : 18 1B               		jr	.chk_tbl
(2) 2514/     DA7 :                     .bad_ins:
(2) 2515/     DA7 : 3E FF               		ld	a,-1
(2) 2516/     DA9 : C9                  		ret
(2) 2517/     DAA :                     
(2) 2518/     DAA :                     ; --------------------------------------------
(2) 2519/     DAA :                     
(2) 2520/     DAA :                     .tbllist:
(2) 2521/     DAA : CD 19               		dw tblPSG	;  80h
(2) 2522/     DAC : E7 19               		dw tblPSGN	;  90h
(2) 2523/     DAE : EF 19               		dw tblFM	; 0A0h
(2) 2524/     DB0 : 0F 1A               		dw tblFM3	; 0B0h
(2) 2525/     DB2 : 17 1A               		dw tblFM6	; 0C0h
(2) 2526/     DB4 : 21 1A               		dw tblPWM	; 0D0h
(2) 2527/     DB6 :                     
(2) 2528/     DB6 :                     ; --------------------------------------------
(2) 2529/     DB6 :                     ; Check SINGLE channel table
(2) 2530/     DB6 :                     ; (FM3,FM6,PSGN)
(2) 2531/     DB6 :                     ; --------------------------------------------
(2) 2532/     DB6 :                     
(2) 2533/     DB6 :                     ; This auto-replaces the LINKED channel
(2) 2534/     DB6 :                     .chk_tbln:
(2) 2535/     DB6 :                     
(2) 2536/     DB6 :                     ; 	TODO: priority overwrite goes here...
(2) 2537/     DB6 :                     ; 		push	iy
(2) 2538/     DB6 :                     ; 		pop	de		; de - Copy of curr track-channel
(2) 2539/     DB6 :                     ; 		rst	8
(2) 2540/     DB6 :                     ; 		ld	a,(ix+1)	; MSB | LSB
(2) 2541/     DB6 :                     ; 		or	(ix)		; Check if blank
(2) 2542/     DB6 :                     ; 		jr	z,.new
(2) 2543/     DB6 :                     ; 		ld	a,(ix+1)	; MSB | LSB
(2) 2544/     DB6 :                     ; 		cp	d		; Same MSB?
(2) 2545/     DB6 :                     ; 		jr	nz,.busy_s
(2) 2546/     DB6 :                     ; 		ld	a,(ix)
(2) 2547/     DB6 :                     ; 		cp	e		; Same LSB?
(2) 2548/     DB6 :                     ; 		jr	nc,.busy_s
(2) 2549/     DB6 :                     .new:
(2) 2550/     DB6 : CF                  		rst	8
(2) 2551/     DB7 : DD 73 00            		ld	(ix),e		; NEW slot
(2) 2552/     DBA : DD 72 01            		ld	(ix+1),d
(2) 2553/     DBD : AF                  		xor	a		; Found free slot, pick it.
(2) 2554/     DBE : C9                  		ret
(2) 2555/     DBF :                     .busy_s:
(2) 2556/     DBF : 3E FF               		ld	a,-1
(2) 2557/     DC1 : C9                  		ret
(2) 2558/     DC2 :                     
(2) 2559/     DC2 :                     ; --------------------------------------------
(2) 2560/     DC2 :                     ; Check available channel slot from list
(2) 2561/     DC2 :                     ; --------------------------------------------
(2) 2562/     DC2 :                     
(2) 2563/     DC2 :                     .chk_tbl:
(2) 2564/     DC2 : 01 00 00            		ld	bc,0		; bc - Free slot point
(2) 2565/     DC5 :                     .next:
(2) 2566/     DC5 : DD 7E 01            		ld	a,(ix+1)	; Check MSB first
(2) 2567/     DC8 : FE FF               		cp	-1		; End of list? (as WORD: 0FFxxh)
(2) 2568/     DCA : 28 3D               		jr	z,.chkfree
(2) 2569/     DCC : FD E5               		push	iy
(2) 2570/     DCE : D1                  		pop	de		; de - Copy of curr track-channel
(2) 2571/     DCF : CF                  		rst	8
(2) 2572/     DD0 : BA                  		cp	d		; check if link matches
(2) 2573/     DD1 : 20 08               		jr	nz,.diffr
(2) 2574/     DD3 : DD 7E 00            		ld	a,(ix)
(2) 2575/     DD6 : BB                  		cp	e
(2) 2576/     DD7 : 20 02               		jr	nz,.diffr
(2) 2577/     DD9 : AF                  		xor	a		; return 0
(2) 2578/     DDA : C9                  		ret
(2) 2579/     DDB :                     .diffr:
(2) 2580/     DDB : 79                  		ld	a,c		; bc link already set?
(2) 2581/     DDC : B0                  		or	b
(2) 2582/     DDD : 20 23               		jr	nz,.alrdfnd
(2) 2583/     DDF : CF                  		rst	8
(2) 2584/     DE0 : DD 5E 01            		ld	e,(ix+1)	; Check if this link == 0
(2) 2585/     DE3 : DD 7E 00            		ld	a,(ix)
(2) 2586/     DE6 : B3                  		or	e
(2) 2587/     DE7 : 28 15               		jr	z,.fndlink
(2) 2588/     DE9 : D5                  		push	de		; Check if this link is
(2) 2589/     DEA : DD 56 01            		ld	d,(ix+1)	; floating.
(2) 2590/     DED : DD 5E 00            		ld	e,(ix)
(2) 2591/     DF0 : 13                  		inc	de
(2) 2592/     DF1 : CF                  		rst	8
(2) 2593/     DF2 : 1A                  		ld	a,(de)
(2) 2594/     DF3 : D1                  		pop	de
(2) 2595/     DF4 : FE FE               		cp	-2
(2) 2596/     DF6 : 28 06               		jr	z,.fndlink
(2) 2597/     DF8 : FE FF               		cp	-1
(2) 2598/     DFA : 28 02               		jr	z,.fndlink
(2) 2599/     DFC : 18 04               		jr	.alrdfnd
(2) 2600/     DFE :                     ; 		ld	a,e		; TODO: priority.
(2) 2601/     DFE :                     ; 		cp	d
(2) 2602/     DFE :                     ; 		jr	nc,.alrdfnd
(2) 2603/     DFE :                     .fndlink:
(2) 2604/     DFE : DD E5               		push	ix		; bc - got new link
(2) 2605/     E00 : C1                  		pop	bc
(2) 2606/     E01 : CF                  		rst	8
(2) 2607/     E02 :                     .alrdfnd:
(2) 2608/     E02 : 11 08 00            		ld	de,8		; Next channel table
(2) 2609/     E05 : DD 19               		add	ix,de
(2) 2610/     E07 : 18 BC               		jr	.next
(2) 2611/     E09 :                     
(2) 2612/     E09 :                     ; free link slot
(2) 2613/     E09 :                     .chkfree:
(2) 2614/     E09 : 79                  		ld	a,c		; found free link?
(2) 2615/     E0A : B0                  		or	b
(2) 2616/     E0B : 28 0F               		jr	z,.fndslot
(2) 2617/     E0D : C5                  		push	bc
(2) 2618/     E0E : DD E1               		pop	ix		; tell ix is the new slot
(2) 2619/     E10 : FD E5               		push	iy
(2) 2620/     E12 : D1                  		pop	de		; and mark it on buffer
(2) 2621/     E13 : CF                  		rst	8
(2) 2622/     E14 : DD 73 00            		ld	(ix),e
(2) 2623/     E17 : DD 72 01            		ld	(ix+1),d
(2) 2624/     E1A : AF                  		xor	a
(2) 2625/     E1B : C9                  		ret
(2) 2626/     E1C :                     .fndslot:
(2) 2627/     E1C : 3E FF               		ld	a,-1		; linksteal check goes here
(2) 2628/     E1E : C9                  		ret
(2) 2629/     E1F :                     
(2) 2630/     E1F :                     ; ====================================================================
(2) 2631/     E1F :                     ; ----------------------------------------------------------------
(2) 2632/     E1F :                     ; Subroutines
(2) 2633/     E1F :                     ; ----------------------------------------------------------------
(2) 2634/     E1F :                     
(2) 2635/     E1F :                     ; --------------------------------------------------------
(2) 2636/     E1F :                     ; Init sound engine
(2) 2637/     E1F :                     ; --------------------------------------------------------
(2) 2638/     E1F :                     
(2) 2639/     E1F :                     gema_init:
(2) 2640/     E1F : CD 02 13            		call	dac_off
(2) 2641/     E22 : 21 00 1C            		ld	hl,dWaveBuff	; hl - Wave buffer START
(2) 2642/     E25 : 11 01 1C            		ld	de,dWaveBuff+1	; de - Wave next byte
(2) 2643/     E28 : 01 FF 00            		ld	bc,100h-1	; bc - length for copying
(2) 2644/     E2B : 36 80               		ld	(hl),80h	; Set first byte
(2) 2645/     E2D : ED B0               		ldir			; Start copying
(2) 2646/     E2F : 21 11 7F            		ld	hl,Zpsg_ctrl	; Silence PSG channels
(2) 2647/     E32 : 36 9F               		ld	(hl),09Fh
(2) 2648/     E34 : 36 BF               		ld	(hl),0BFh
(2) 2649/     E36 : 36 DF               		ld	(hl),0DFh
(2) 2650/     E38 : 36 FF               		ld	(hl),0FFh
(2) 2651/     E3A : 11 0B 22            		ld	de,2208h|3	; Set default LFO
(2) 2652/     E3D : CD D7 12            		call	fm_send_1
(2) 2653/     E40 : 11 00 27            		ld	de,2700h	; CH3 special and timers off
(2) 2654/     E43 : CD D7 12            		call	fm_send_1
(2) 2655/     E46 : 11 00 28            		ld	de,2800h	; FM KEYS off
(2) 2656/     E49 : CD D7 12            		call	fm_send_1
(2) 2657/     E4C : 1C                  		inc	e
(2) 2658/     E4D : CD D7 12            		call	fm_send_1
(2) 2659/     E50 : 1C                  		inc	e
(2) 2660/     E51 : CD D7 12            		call	fm_send_1
(2) 2661/     E54 : 1C                  		inc	e
(2) 2662/     E55 : 1C                  		inc	e
(2) 2663/     E56 : CD D7 12            		call	fm_send_1
(2) 2664/     E59 : 1C                  		inc	e
(2) 2665/     E5A : CD D7 12            		call	fm_send_1
(2) 2666/     E5D : 1C                  		inc	e
(2) 2667/     E5E : CD D7 12            		call	fm_send_1
(2) 2668/     E61 :                     
(2) 2669/     E61 :                     	; set each tracks' settings
(2) 2670/     E61 : FD 21 66 17         		ld	iy,trkBuff_0
(2) 2671/     E65 : 21 00 1D            		ld	hl,trkData_0
(2) 2672/     E68 : 1E 11               		ld	e,MAX_TRKCHN
(2) 2673/     E6A : 16 80               		ld	d,8*16			; maximum size
(2) 2674/     E6C : CD 7A 0E            		call	.set_it
(2) 2675/     E6F : FD 21 0E 18         		ld	iy,trkBuff_1
(2) 2676/     E73 : 21 00 1E            		ld	hl,trkData_1
(2) 2677/     E76 : 1E 11               		ld	e,MAX_TRKCHN
(2) 2678/     E78 : 16 80               		ld	d,8*16
(2) 2679/     E7A :                     .set_it:
(2) 2680/     E7A : FD 75 1A            		ld	(iy+trk_CachNotes),l
(2) 2681/     E7D : FD 74 1B            		ld	(iy+(trk_CachNotes+1)),h
(2) 2682/     E80 :                     ; 		ld	(iy+trk_numChnls),e
(2) 2683/     E80 : FD 72 16            		ld	(iy+trk_sizeIns),d
(2) 2684/     E83 : C9                  		ret
(2) 2685/     E84 :                     
(2) 2686/     E84 :                     ; --------------------------------------------------------
(2) 2687/     E84 :                     ; get_tick
(2) 2688/     E84 :                     ;
(2) 2689/     E84 :                     ; Checks if VBlank triggred a TICK
(2) 2690/     E84 :                     ; (1/150 NTSC, 1/120 PAL)
(2) 2691/     E84 :                     ; --------------------------------------------------------
(2) 2692/     E84 :                     
(2) 2693/     E84 :                     get_tick:
(2) 2694/     E84 : F3                  		di				; Disable ints
(2) 2695/     E85 : F5                  		push	af
(2) 2696/     E86 : E5                  		push	hl
(2) 2697/     E87 : 21 BF 19            		ld	hl,tickFlag+1		; read last TICK flag
(2) 2698/     E8A : 7E                  		ld	a,(hl)			; non-zero value (1Fh)?
(2) 2699/     E8B : B7                  		or 	a
(2) 2700/     E8C : 28 13               		jr	z,.ctnotick
(2) 2701/     E8E : 36 00               		ld	(hl),0			; Reset TICK flag
(2) 2702/     E90 : 23                  		inc	hl			; Move to tickCnt
(2) 2703/     E91 : 34                  		inc	(hl)			; and increment
(2) 2704/     E92 : CF                  		rst	8
(2) 2705/     E93 : D5                  		push	de
(2) 2706/     E94 : 2A 36 00            		ld	hl,(sbeatAcc)		; Increment subbeats
(2) 2707/     E97 : ED 5B 34 00         		ld	de,(sbeatPtck)
(2) 2708/     E9B : CF                  		rst	8
(2) 2709/     E9C : 19                  		add	hl,de
(2) 2710/     E9D : 22 36 00            		ld	(sbeatAcc),hl
(2) 2711/     EA0 : D1                  		pop	de
(2) 2712/     EA1 :                     .ctnotick:
(2) 2713/     EA1 : E1                  		pop	hl
(2) 2714/     EA2 : F1                  		pop	af
(2) 2715/     EA3 : FB                  		ei				; Enable ints again
(2) 2716/     EA4 : C9                  		ret
(2) 2717/     EA5 :                     
(2) 2718/     EA5 :                     ; --------------------------------------------------------
(2) 2719/     EA5 :                     ; showRom:
(2) 2720/     EA5 :                     ; Get ROM position visible for reading
(2) 2721/     EA5 :                     ;
(2) 2722/     EA5 :                     ; Input:
(2) 2723/     EA5 :                     ;  b - ROM address $xx0000
(2) 2724/     EA5 :                     ; hl - ROM address $00xxxx
(2) 2725/     EA5 :                     ;
(2) 2726/     EA5 :                     ; Output:
(2) 2727/     EA5 :                     ; hl - ROM position ready to use for reading
(2) 2728/     EA5 :                     ; --------------------------------------------------------
(2) 2729/     EA5 :                     
(2) 2730/     EA5 :                     showRom:
(2) 2731/     EA5 : CF                  		rst	8
(2) 2732/     EA6 : D5                  		push	de
(2) 2733/     EA7 : C5                  		push	bc
(2) 2734/     EA8 : 11 00 60            		ld	de,6000h
(2) 2735/     EAB : 7C                  		ld	a,h
(2) 2736/     EAC : 07                  		rlca
(2) 2737/     EAD : CF                  		rst	8
(2) 2738/     EAE : 12                  		ld	(de),a
(2) 2739/     EAF : 78                  		ld	a,b
(2) 2740/     EB0 : 12                  		ld	(de),a
(2) 2741/     EB1 : 1F                  		rra
(2) 2742/     EB2 : 12                  		ld	(de),a
(2) 2743/     EB3 : 1F                  		rra
(2) 2744/     EB4 : 12                  		ld	(de),a
(2) 2745/     EB5 : 1F                  		rra
(2) 2746/     EB6 : CF                  		rst	8
(2) 2747/     EB7 : 12                  		ld	(de),a
(2) 2748/     EB8 : 1F                  		rra
(2) 2749/     EB9 : 12                  		ld	(de),a
(2) 2750/     EBA : 1F                  		rra
(2) 2751/     EBB : 12                  		ld	(de),a
(2) 2752/     EBC : 1F                  		rra
(2) 2753/     EBD : 12                  		ld	(de),a
(2) 2754/     EBE : 1F                  		rra
(2) 2755/     EBF : 12                  		ld	(de),a
(2) 2756/     EC0 : CF                  		rst	8
(2) 2757/     EC1 : C1                  		pop	bc
(2) 2758/     EC2 : D1                  		pop	de
(2) 2759/     EC3 : CB FC               		set	7,h
(2) 2760/     EC5 : C9                  		ret
(2) 2761/     EC6 :                     
(2) 2762/     EC6 :                     ; --------------------------------------------------------
(2) 2763/     EC6 :                     ; readRomB:
(2) 2764/     EC6 :                     ; Reads a byte from ROM safetly, for a single and quick
(2) 2765/     EC6 :                     ; byte-read only, NOT autoswitchable.
(2) 2766/     EC6 :                     ; CALL showRom FIRST, DO NOT CALL RST 20h (dac_fill)
(2) 2767/     EC6 :                     ; BEFORE GETTING HERE
(2) 2768/     EC6 :                     ;
(2) 2769/     EC6 :                     ; Input:
(2) 2770/     EC6 :                     ; hl - ROM position in Z80's area
(2) 2771/     EC6 :                     ;      (BANK must be set already)
(2) 2772/     EC6 :                     ;
(2) 2773/     EC6 :                     ; Output:
(2) 2774/     EC6 :                     ; a - byte recieved
(2) 2775/     EC6 :                     ; --------------------------------------------------------
(2) 2776/     EC6 :                     
(2) 2777/     EC6 :                     ; ALL this code just to read one byte without bothering
(2) 2778/     EC6 :                     ; the DMA from the 68k side
(2) 2779/     EC6 :                     
(2) 2780/     EC6 :                     readRomB:
(2) 2781/     EC6 : DD E5               		push	ix
(2) 2782/     EC8 : DD 21 1C 00         		ld	ix,commZRomBlk
(2) 2783/     ECC : DD CB 01 C6         		set	0,(ix+1)	; ROM read request
(2) 2784/     ED0 : DD CB 00 46         		bit	0,(ix)		; 68k is on DMA?
(2) 2785/     ED4 : 20 09               		jr	nz,.wait
(2) 2786/     ED6 : 7E                  .imback:	ld	a,(hl)		; Read the byte.
(2) 2787/     ED7 : DD CB 01 86         		res	0,(ix+1)
(2) 2788/     EDB : CF                  		rst	8
(2) 2789/     EDC : DD E1               		pop	ix
(2) 2790/     EDE : C9                  		ret
(2) 2791/     EDF :                     .wait:
(2) 2792/     EDF : DD CB 01 86         		res	0,(ix+1)	; Not reading ROM
(2) 2793/     EE3 :                     .w2:
(2) 2794/     EE3 : CF                  		rst	8
(2) 2795/     EE4 : 00                  		nop
(2) 2796/     EE5 : 00                  		nop
(2) 2797/     EE6 : CF                  		rst	8
(2) 2798/     EE7 : DD CB 00 46         		bit	0,(ix)		; Is ROM free from 68K?
(2) 2799/     EEB : 20 F6               		jr	nz,.w2
(2) 2800/     EED : DD CB 01 C6         		set	0,(ix+1)	; Reading ROM again.
(2) 2801/     EF1 : 18 E3               		jr	.imback
(2) 2802/     EF3 :                     
(2) 2803/     EF3 :                     ; --------------------------------------------------------
(2) 2804/     EF3 :                     ; transferRom
(2) 2805/     EF3 :                     ;
(2) 2806/     EF3 :                     ; Transfer bytes from ROM to Z80, this also tells
(2) 2807/     EF3 :                     ; to 68k that we are reading fom ROM
(2) 2808/     EF3 :                     ;
(2) 2809/     EF3 :                     ; Input:
(2) 2810/     EF3 :                     ; a  - Source ROM address $xx0000
(2) 2811/     EF3 :                     ;  c - Byte count (size 0 NOT allowed, MAX: 0FFh)
(2) 2812/     EF3 :                     ; hl - Source ROM address $00xxxx
(2) 2813/     EF3 :                     ; de - Destination address
(2) 2814/     EF3 :                     ;
(2) 2815/     EF3 :                     ; Uses:
(2) 2816/     EF3 :                     ; b, ix
(2) 2817/     EF3 :                     ;
(2) 2818/     EF3 :                     ; Notes:
(2) 2819/     EF3 :                     ; call dac_fill first if transfering anything other than
(2) 2820/     EF3 :                     ; sample data, just to be safe
(2) 2821/     EF3 :                     ; --------------------------------------------------------
(2) 2822/     EF3 :                     
(2) 2823/     EF3 :                     ; Note: got this from GEMS...
(2) 2824/     EF3 :                     
(2) 2825/     EF3 :                     transferRom:
(2) 2826/     EF3 : CF                  		rst	8
(2) 2827/     EF4 : DD E5               		push	ix
(2) 2828/     EF6 : DD 21 1C 00         		ld	ix,commZRomBlk	; ix - rom read/block flags
(2) 2829/     EFA : 22 2E 00            		ld	(x68ksrclsb),hl	; save hl copy
(2) 2830/     EFD : CB BC               		res	7,h
(2) 2831/     EFF : 06 00               		ld	b,0
(2) 2832/     F01 : 0B                  		dec	bc
(2) 2833/     F02 : 09                  		add	hl,bc
(2) 2834/     F03 : CB 7C               		bit	7,h
(2) 2835/     F05 : 20 0B               		jr	nz,.double
(2) 2836/     F07 : 2A 2E 00            		ld	hl,(x68ksrclsb)	; single transfer
(2) 2837/     F0A : 0C                  		inc	c
(2) 2838/     F0B : 47                  		ld	b,a
(2) 2839/     F0C : CD 37 0F            		call	.transfer
(2) 2840/     F0F : DD E1               		pop	ix
(2) 2841/     F11 : C9                  		ret
(2) 2842/     F12 :                     .double:
(2) 2843/     F12 : CF                  		rst	8
(2) 2844/     F13 : 47                  		ld	b,a		; double transfer
(2) 2845/     F14 : C5                  		push	bc
(2) 2846/     F15 : E5                  		push	hl
(2) 2847/     F16 : 79                  		ld	a,c
(2) 2848/     F17 : 95                  		sub	a,l
(2) 2849/     F18 : 4F                  		ld	c,a
(2) 2850/     F19 : 2A 2E 00            		ld	hl,(x68ksrclsb)
(2) 2851/     F1C : CD 37 0F            		call	.transfer
(2) 2852/     F1F : E1                  		pop	hl
(2) 2853/     F20 : C1                  		pop	bc
(2) 2854/     F21 : CF                  		rst	8
(2) 2855/     F22 : 4D                  		ld	c,l
(2) 2856/     F23 : 0C                  		inc	c
(2) 2857/     F24 : 3A 2F 00            		ld	a,(x68ksrcmid)
(2) 2858/     F27 : E6 80               		and	80h
(2) 2859/     F29 : C6 80               		add	a,80h
(2) 2860/     F2B : 67                  		ld	h,a
(2) 2861/     F2C : 2E 00               		ld	l,0
(2) 2862/     F2E : 30 01               		jr	nc,.x68knocarry
(2) 2863/     F30 : 04                  		inc	b
(2) 2864/     F31 :                     .x68knocarry:
(2) 2865/     F31 : CD 37 0F            		call	.transfer
(2) 2866/     F34 : DD E1               		pop	ix
(2) 2867/     F36 : C9                  		ret
(2) 2868/     F37 :                     
(2) 2869/     F37 :                     ; ------------------------------------------------
(2) 2870/     F37 :                     ; b  - Source ROM xx0000
(2) 2871/     F37 :                     ;  c - Bytes to transfer (00h not allowed)
(2) 2872/     F37 :                     ; hl - Source ROM 00xxxx (OR'd with 8000h)
(2) 2873/     F37 :                     ; de - Destination address
(2) 2874/     F37 :                     ;
(2) 2875/     F37 :                     ; Uses:
(2) 2876/     F37 :                     ; a
(2) 2877/     F37 :                     ; ------------------------------------------------
(2) 2878/     F37 :                     
(2) 2879/     F37 :                     .transfer:
(2) 2880/     F37 : CD A5 0E            		call	showRom
(2) 2881/     F3A :                     
(2) 2882/     F3A :                     	; Transfer data in packs of bytes
(2) 2883/     F3A :                     	; while playing cache WAV in the process
(2) 2884/     F3A :                     	; *** CRITICAL PROCESS FOR WAV PLAYBACK ***
(2) 2885/     F3A :                     	;
(2) 2886/     F3A :                     	; pseudo-ref for ldir:
(2) 2887/     F3A :                     	; ld (de),(hl)
(2) 2888/     F3A :                     	; inc de
(2) 2889/     F3A :                     	; inc hl
(2) 2890/     F3A :                     	; dec bc
(2) 2891/     F3A :                     	;
(2) 2892/     F3A : 06 00               		ld	b,0
(2) 2893/     F3C : 79                  		ld	a,c		; a - pieces counter
(2) 2894/     F3D : DD CB 01 C6         		set	0,(ix+1)	; Tell to 68k that we are reading from ROM
(2) 2895/     F41 : D6 06               		sub	6		; LENGHT lower than 6?
(2) 2896/     F43 : 38 11               		jr	c,.x68klast	; Process single piece only
(2) 2897/     F45 :                     .x68kloop:
(2) 2898/     F45 : CF                  		rst	8
(2) 2899/     F46 : 0E 05               		ld	c,6-1
(2) 2900/     F48 : DD CB 00 46         		bit	0,(ix)		; If 68k requested ROM block from here
(2) 2901/     F4C : 20 1A               		jr	nz,.x68klpwt
(2) 2902/     F4E :                     .x68klpcont:
(2) 2903/     F4E : CF                  		rst	8
(2) 2904/     F4F : ED B0               		ldir			; (de) to (hl) until bc==0
(2) 2905/     F51 : D6 05               		sub	a,6-1
(2) 2906/     F53 : D2 45 0F            		jp	nc,.x68kloop
(2) 2907/     F56 :                     ; last block
(2) 2908/     F56 :                     .x68klast:
(2) 2909/     F56 : C6 06               		add	a,6
(2) 2910/     F58 : 4F                  		ld	c,a
(2) 2911/     F59 : DD CB 00 46         		bit	0,(ix)		; If 68k requested ROM block from here
(2) 2912/     F5D : C2 7B 0F            		jp	nz,.x68klstwt
(2) 2913/     F60 :                     .x68klstcont:
(2) 2914/     F60 : CF                  		rst	8
(2) 2915/     F61 : ED B0               		ldir
(2) 2916/     F63 : DD CB 01 86         		res	0,(ix+1)	; Tell 68k we are done reading
(2) 2917/     F67 : C9                  		ret
(2) 2918/     F68 :                     
(2) 2919/     F68 :                     ; If Genesis wants to do DMA, loop indef here until it finishes.
(2) 2920/     F68 :                     ; if on mid-loop
(2) 2921/     F68 :                     .x68klpwt:
(2) 2922/     F68 : DD CB 01 86         		res	0,(ix+1)	; Tell 68k we are out, waiting.
(2) 2923/     F6C :                     .x68kpwtlp:
(2) 2924/     F6C : CF                  		rst	8
(2) 2925/     F6D : 00                  		nop
(2) 2926/     F6E : CF                  		rst	8
(2) 2927/     F6F : DD CB 00 46         		bit	0,(ix)		; 68k finished?
(2) 2928/     F73 : 20 F7               		jr	nz,.x68kpwtlp
(2) 2929/     F75 : DD CB 01 C6         		set	0,(ix+1)	; Set Z80 read flag again, and return
(2) 2930/     F79 : 18 D3               		jr	.x68klpcont
(2) 2931/     F7B :                     
(2) 2932/     F7B :                     ; or in the last piece
(2) 2933/     F7B :                     .x68klstwt:
(2) 2934/     F7B : DD CB 01 86         		res	0,(ix+1)	; Tell 68k we are out, waiting.
(2) 2935/     F7F :                     .x68klstwtlp:
(2) 2936/     F7F : CF                  		rst	8
(2) 2937/     F80 : 00                  		nop
(2) 2938/     F81 : CF                  		rst	8
(2) 2939/     F82 : DD CB 00 46         		bit	0,(ix)		; 68k finished?
(2) 2940/     F86 : 20 F7               		jr	nz,.x68klstwtlp
(2) 2941/     F88 : DD CB 01 C6         		set	0,(ix+1)	; Set Z80 read flag again, and return
(2) 2942/     F8C : 18 D2               		jr	.x68klstcont
(2) 2943/     F8E :                     
(2) 2944/     F8E :                     ; ====================================================================
(2) 2945/     F8E :                     ; ----------------------------------------------------------------
(2) 2946/     F8E :                     ; Sound chip routines
(2) 2947/     F8E :                     ; ----------------------------------------------------------------
(2) 2948/     F8E :                     
(2) 2949/     F8E :                     ; --------------------------------------------------------
(2) 2950/     F8E :                     ; chip_env
(2) 2951/     F8E :                     ;
(2) 2952/     F8E :                     ; Process PSG and FM
(2) 2953/     F8E :                     ; --------------------------------------------------------
(2) 2954/     F8E :                     
(2) 2955/     F8E :                     ; Read PSG list backwards so it autodetects
(2) 2956/     F8E :                     ; Tone3 mode
(2) 2957/     F8E :                     
(2) 2958/     F8E :                     chip_env:
(2) 2959/     F8E : FD 21 14 16         		ld	iy,psgcom+3		; Start from NOISE first
(2) 2960/     F92 : 21 11 7F            		ld	hl,Zpsg_ctrl
(2) 2961/     F95 : 16 E0               		ld	d,0E0h			; PSG first ctrl command
(2) 2962/     F97 : 1E 04               		ld	e,4			; 4 channels
(2) 2963/     F99 :                     .vloop:
(2) 2964/     F99 : CF                  		rst	8
(2) 2965/     F9A : FD 4E 00            		ld	c,(iy+COM)		; c - current command
(2) 2966/     F9D : FD 36 00 00         		ld	(iy+COM),0
(2) 2967/     FA1 : CB 51               		bit	2,c			; bit 2 - stop sound
(2) 2968/     FA3 : 28 17               		jr	z,.ckof
(2) 2969/     FA5 : FD 36 04 FF         		ld	(iy+LEV),-1		; reset level
(2) 2970/     FA9 : FD 36 28 01         		ld	(iy+FLG),1		; and update
(2) 2971/     FAD : FD 36 18 00         		ld	(iy+MODE),0		; envelope off
(2) 2972/     FB1 : 7B                  		ld	a,e
(2) 2973/     FB2 : FE 04               		cp	4
(2) 2974/     FB4 : 20 06               		jr	nz,.ckof
(2) 2975/     FB6 : 3E 00               		ld	a,0
(2) 2976/     FB8 : 32 47 1F            		ld	(psgHatMode),a
(2) 2977/     FBB : CF                  		rst	8
(2) 2978/     FBC :                     .ckof:
(2) 2979/     FBC : CB 49               		bit	1,c			; bit 1 - key off
(2) 2980/     FBE : 28 19               		jr      z,.ckon
(2) 2981/     FC0 : FD 7E 18            		ld	a,(iy+MODE)		; mode 0?
(2) 2982/     FC3 : B7                  		or	a
(2) 2983/     FC4 : 28 13               		jr	z,.ckon
(2) 2984/     FC6 : FD 36 28 01         		ld	(iy+FLG),1		; psg update flag
(2) 2985/     FCA : FD 36 18 04         		ld	(iy+MODE),100b		; set envelope mode 100b
(2) 2986/     FCE : 7B                  		ld	a,e
(2) 2987/     FCF : FE 04               		cp	4
(2) 2988/     FD1 : 20 06               		jr	nz,.ckon
(2) 2989/     FD3 : 3E 00               		ld	a,0
(2) 2990/     FD5 : 32 47 1F            		ld	(psgHatMode),a
(2) 2991/     FD8 : CF                  		rst	8
(2) 2992/     FD9 :                     .ckon:
(2) 2993/     FD9 : CB 41               		bit	0,c			; bit 0 - key on
(2) 2994/     FDB : 28 57               		jr	z,.envproc
(2) 2995/     FDD : FD 36 04 FF         		ld	(iy+LEV),-1		; reset level
(2) 2996/     FE1 : 3A 47 1F            		ld	a,(psgHatMode)		; check if using tone3 mode.
(2) 2997/     FE4 : 4F                  		ld	c,a
(2) 2998/     FE5 : E6 03               		and	11b
(2) 2999/     FE7 : FE 03               		cp	11b
(2) 3000/     FE9 : 28 24               		jr	z,.tnmode
(2) 3001/     FEB :                     .wrfreq:
(2) 3002/     FEB : 7B                  		ld	a,e
(2) 3003/     FEC : FE 04               		cp	4
(2) 3004/     FEE : 28 35               		jr	z,.sethat
(2) 3005/     FF0 : CF                  		rst	8
(2) 3006/     FF1 :                     
(2) 3007/     FF1 : FD 7E 1C            		ld	a,(iy+DTL)	; Grab LSB 4 right bits
(2) 3008/     FF4 : E6 0F               		and	00001111b
(2) 3009/     FF6 : B2                  		or	d		; OR with current channel
(2) 3010/     FF7 : 77                  		ld	(hl),a		; write it
(2) 3011/     FF8 : FD 7E 1C            		ld	a,(iy+DTL)	; Grab LSB 4 left bits
(2) 3012/     FFB : 0F                  		rrca
(2) 3013/     FFC : 0F                  		rrca
(2) 3014/     FFD : 0F                  		rrca
(2) 3015/     FFE : 0F                  		rrca
(2) 3016/     FFF : E6 0F               		and	00001111b
(2) 3017/    1001 : 4F                  		ld	c,a
(2) 3018/    1002 : FD 7E 20            		ld	a,(iy+DTH)	; Grab MSB bits
(2) 3019/    1005 : 07                  		rlca
(2) 3020/    1006 : 07                  		rlca
(2) 3021/    1007 : 07                  		rlca
(2) 3022/    1008 : 07                  		rlca
(2) 3023/    1009 : E6 30               		and	00110000b
(2) 3024/    100B : B1                  		or	c
(2) 3025/    100C : 77                  		ld	(hl),a
(2) 3026/    100D :                     
(2) 3027/    100D : 18 1C               		jr	.nskip
(2) 3028/    100F :                     ; Tone3 mode
(2) 3029/    100F :                     .tnmode:
(2) 3030/    100F : 7B                  		ld	a,e
(2) 3031/    1010 : FE 04               		cp	4			; NOISE
(2) 3032/    1012 : 28 06               		jr	z,.psteal
(2) 3033/    1014 : FE 03               		cp	3			; PSG3, can't play
(2) 3034/    1016 : 28 13               		jr	z,.nskip
(2) 3035/    1018 : 18 D1               		jr	.wrfreq
(2) 3036/    101A :                     .psteal:
(2) 3037/    101A : CF                  		rst	8
(2) 3038/    101B : FD 7E 1C            		ld	a,(iy+DTL)		; Steal PSG3's freq
(2) 3039/    101E : F6 C0               		or	0C0h
(2) 3040/    1020 : 77                  		ld	(hl),a
(2) 3041/    1021 : FD 7E 20            		ld	a,(iy+DTH)
(2) 3042/    1024 : 77                  		ld	(hl),a
(2) 3043/    1025 :                     .sethat:
(2) 3044/    1025 : CF                  		rst	8
(2) 3045/    1026 : 3A 47 1F            		ld	a,(psgHatMode)		; write hat mode only.
(2) 3046/    1029 : B2                  		or	d
(2) 3047/    102A : 77                  		ld	(hl),a
(2) 3048/    102B :                     .nskip:
(2) 3049/    102B : FD 36 28 01         		ld	(iy+FLG),1		; psg update flag
(2) 3050/    102F : FD 36 18 01         		ld	(iy+MODE),001b		; set to attack mode
(2) 3051/    1033 : CF                  		rst	8
(2) 3052/    1034 :                     
(2) 3053/    1034 :                     ; ----------------------------
(2) 3054/    1034 :                     ; Process effects
(2) 3055/    1034 :                     ; ----------------------------
(2) 3056/    1034 :                     
(2) 3057/    1034 :                     .envproc:
(2) 3058/    1034 : CF                  		rst	8
(2) 3059/    1035 : FD 7E 18            		ld	a,(iy+MODE)
(2) 3060/    1038 : B7                  		or	a			; no modes
(2) 3061/    1039 : CA BF 10            		jp	z,.vedlp
(2) 3062/    103C : FE 01               		cp 	001b			; Attack mode
(2) 3063/    103E : 20 2C               		jr	nz,.chk2
(2) 3064/    1040 : FD 36 28 01         		ld	(iy+FLG),1		; psg update flag
(2) 3065/    1044 : FD 46 24            		ld	b,(iy+ALV)
(2) 3066/    1047 : FD 7E 08            		ld	a,(iy+ATK)		; if ATK == 0, don't use
(2) 3067/    104A : B7                  		or	a
(2) 3068/    104B : 28 16               		jr	z,.atkend
(2) 3069/    104D : 4F                  		ld	c,a			; c - attack rate
(2) 3070/    104E : 78                  		ld	a,b			; a - attack level
(2) 3071/    104F : CF                  		rst	8
(2) 3072/    1050 : FD 46 24            		ld	b,(iy+ALV)		; b - OLD attack level
(2) 3073/    1053 : 91                  		sub	a,c			; (attack rate) - (level)
(2) 3074/    1054 : 38 0D               		jr	c,.atkend		; if carry: already finished
(2) 3075/    1056 : 28 0B               		jr	z,.atkend		; if zero: no attack rate
(2) 3076/    1058 : B8                  		cp	b			; attack rate == level?
(2) 3077/    1059 : 38 08               		jr	c,.atkend
(2) 3078/    105B : 28 06               		jr	z,.atkend
(2) 3079/    105D : FD 77 04            		ld	(iy+LEV),a		; set new level
(2) 3080/    1060 : CF                  		rst	8
(2) 3081/    1061 : 18 5C               		jr	.vedlp
(2) 3082/    1063 :                     .atkend:
(2) 3083/    1063 : FD 70 04            		ld	(iy+LEV),b		; attack level = new level
(2) 3084/    1066 :                     .atkzero:
(2) 3085/    1066 : FD 36 18 02         		ld	(iy+MODE),010b		; set to decay mode
(2) 3086/    106A : 18 53               		jr	.vedlp
(2) 3087/    106C :                     .chk2:
(2) 3088/    106C :                     
(2) 3089/    106C : FE 02               		cp	010b			; Decay mode
(2) 3090/    106E : 20 31               		jr	nz,.chk4
(2) 3091/    1070 :                     .dectmr:
(2) 3092/    1070 : FD 36 28 01         		ld	(iy+FLG),1		; psg update flag
(2) 3093/    1074 : FD 7E 04            		ld	a,(iy+LEV)		; a - Level
(2) 3094/    1077 : FD 46 10            		ld	b,(iy+SLV)		; b - Sustain
(2) 3095/    107A : B8                  		cp	b
(2) 3096/    107B : 38 0D               		jr	c,.dkadd		; if carry: add
(2) 3097/    107D : 28 18               		jr	z,.dkyend		; if zero:  finish
(2) 3098/    107F : CF                  		rst	8
(2) 3099/    1080 : FD 96 0C            		sub	(iy+DKY)		; substract decay rate
(2) 3100/    1083 : 38 12               		jr	c,.dkyend		; finish if wraped.
(2) 3101/    1085 : B8                  		cp	b			; compare level
(2) 3102/    1086 : 38 0F               		jr	c,.dkyend		; and finish
(2) 3103/    1088 : 18 08               		jr	.dksav
(2) 3104/    108A :                     .dkadd:
(2) 3105/    108A : FD 86 0C            		add	a,(iy+DKY)		;  (level) + (decay rate)
(2) 3106/    108D : 38 08               		jr	c,.dkyend		; finish if wraped.
(2) 3107/    108F : B8                  		cp	b			; compare level
(2) 3108/    1090 : 30 05               		jr	nc,.dkyend
(2) 3109/    1092 :                     .dksav:
(2) 3110/    1092 : FD 77 04            		ld	(iy+LEV),a		; save new level
(2) 3111/    1095 : 18 28               		jr	.vedlp
(2) 3112/    1097 :                     .dkyend:
(2) 3113/    1097 : CF                  		rst	8
(2) 3114/    1098 : FD 70 04            		ld	(iy+LEV),b		; save last attack
(2) 3115/    109B : FD 36 18 04         		ld	(iy+MODE),100b		; and set to sustain
(2) 3116/    109F : 18 1E               		jr	.vedlp
(2) 3117/    10A1 :                     .chk4:
(2) 3118/    10A1 : FE 04               		cp	100b			; Sustain phase
(2) 3119/    10A3 : 20 1A               		jr	nz,.vedlp
(2) 3120/    10A5 : FD 36 28 01         		ld	(iy+FLG),1		; psg update flag
(2) 3121/    10A9 : FD 7E 04            		ld	a,(iy+LEV)		; a - Level
(2) 3122/    10AC : CF                  		rst	8
(2) 3123/    10AD : FD 86 14            		add 	a,(iy+RRT)		; add Release Rate
(2) 3124/    10B0 : 38 05               		jr	c,.killenv		; release done
(2) 3125/    10B2 : FD 77 04            		ld	(iy+LEV),a		; set new Level
(2) 3126/    10B5 : 18 08               		jr	.vedlp
(2) 3127/    10B7 :                     .killenv:
(2) 3128/    10B7 : FD 36 04 FF         		ld	(iy+LEV),-1		; Silence this channel
(2) 3129/    10BB : FD 36 18 00         		ld	(iy+MODE),0		; Reset mode
(2) 3130/    10BF :                     .vedlp:
(2) 3131/    10BF : FD 7E 28            		ld	a,(iy+FLG)
(2) 3132/    10C2 : B7                  		or	a
(2) 3133/    10C3 : 28 1E               		jr	z,.noupd
(2) 3134/    10C5 : FD 36 28 00         		ld	(iy+FLG),0	; Reset until next one
(2) 3135/    10C9 : CF                  		rst	8
(2) 3136/    10CA : FD 7E 04            		ld	a,(iy+LEV)	; a - Level
(2) 3137/    10CD : FD 86 30            		add	a,(iy+PVOL)	; Level + master volume
(2) 3138/    10D0 : 30 02               		jr	nc,.vlmuch
(2) 3139/    10D2 : 3E FF               		ld	a,-1
(2) 3140/    10D4 :                     .vlmuch:
(2) 3141/    10D4 : CB 3F               		srl	a		; (Level >> 4)
(2) 3142/    10D6 : CB 3F               		srl	a
(2) 3143/    10D8 : CB 3F               		srl	a
(2) 3144/    10DA : CF                  		rst	8
(2) 3145/    10DB : CB 3F               		srl	a
(2) 3146/    10DD : E6 0F               		and	00001111b
(2) 3147/    10DF : F6 90               		or	90h		; Set volume-set mode
(2) 3148/    10E1 : B2                  		or	d		; add current channel
(2) 3150/    10E2 : 77                  		ld	(hl),a		; Write volume
(2) 3152/    10E3 :                     
(2) 3153/    10E3 :                     .noupd:
(2) 3154/    10E3 : FD 2B               		dec	iy		; next COM to check
(2) 3155/    10E5 : 7A                  		ld	a,d
(2) 3156/    10E6 : CF                  		rst	8
(2) 3157/    10E7 : D6 20               		sub	a,20h		; next PSG (backwards)
(2) 3158/    10E9 : 57                  		ld	d,a
(2) 3159/    10EA : 1D                  		dec	e
(2) 3160/    10EB : C2 99 0F            		jp	nz,.vloop
(2) 3161/    10EE :                     
(2) 3162/    10EE :                     ; ----------------------------
(2) 3163/    10EE :                     ; FM section
(2) 3164/    10EE :                     ; ----------------------------
(2) 3165/    10EE :                     
(2) 3166/    10EE :                     	; Read FM channels
(2) 3167/    10EE :                     	; iy - FM com
(2) 3168/    10EE :                     	; ix - FM current instrument data
(2) 3169/    10EE :                     	;  c - FM channel ID
(2) 3170/    10EE : FD 21 45 16         		ld	iy,fmcom
(2) 3171/    10F2 : DD 21 69 16         		ld	ix,fmins_com
(2) 3172/    10F6 : 01 00 05            		ld	bc,0500h
(2) 3173/    10F9 : C5                  .nextfm_1:	push	bc
(2) 3174/    10FA : CD 50 11            		call	.fm_chnl	; Channel 1
(2) 3175/    10FD : C1                  		pop	bc
(2) 3176/    10FE : 11 28 00            		ld	de,28h
(2) 3177/    1101 : DD 19               		add	ix,de
(2) 3178/    1103 : FD 23               		inc	iy
(2) 3179/    1105 : CF                  		rst	8
(2) 3180/    1106 : 0C                  		inc	c
(2) 3181/    1107 : 79                  		ld	a,c
(2) 3182/    1108 : FE 03               		cp	3		; c == 3?
(2) 3183/    110A : 20 02               		jr	nz,.nomidc
(2) 3184/    110C : 0C                  		inc	c
(2) 3185/    110D : CF                  		rst	8
(2) 3186/    110E :                     .nomidc:
(2) 3187/    110E : 10 E9               		djnz	.nextfm_1
(2) 3188/    1110 :                     
(2) 3189/    1110 :                     	; Special check for Channel 6
(2) 3190/    1110 : 3A 65 17            		ld	a,(daccom)	; Channel 6 / DAC
(2) 3191/    1113 : 5F                  		ld	e,a
(2) 3192/    1114 : AF                  		xor	a
(2) 3193/    1115 : 32 65 17            		ld	(daccom),a
(2) 3194/    1118 : CB 43               		bit	0,e		; WAVE sample request
(2) 3195/    111A : 20 21               		jr	nz,.req_dac
(2) 3196/    111C : CB 63               		bit	4,e
(2) 3197/    111E : 20 2A               		jr	nz,.req_pitch
(2) 3198/    1120 : CF                  		rst	8
(2) 3199/    1121 : CB 53               		bit	2,e		; key-cut?
(2) 3200/    1123 : C2 02 13            		jp	nz,dac_off
(2) 3201/    1126 : CB 4B               		bit	1,e		; key-off?
(2) 3202/    1128 : C0                  		ret	nz
(2) 3203/    1129 : 3A 08 00            		ld 	a,(dac_me)	; manually check if
(2) 3204/    112C : FE D9               		cp	zopcExx		; WAVE playback is active
(2) 3205/    112E : C8                  		ret	z
(2) 3206/    112F : 11 28 00            		ld	de,28h
(2) 3207/    1132 : DD 19               		add	ix,de
(2) 3208/    1134 : CF                  		rst	8
(2) 3209/    1135 : DD 7E 00            		ld	a,(ix)
(2) 3210/    1138 : FD 23               		inc	iy
(2) 3211/    113A : 0C                  		inc	c
(2) 3212/    113B : 18 13               		jr	.fm_chnl			; Channel 6 (normal)
(2) 3213/    113D :                     .req_dac:
(2) 3214/    113D : 16 B6               		ld	d,0B6h			; Panning for DAC
(2) 3215/    113F : 3A 5C 16            		ld	a,((fmcom+5)+FMPAN)	; Reuse FM6's panning
(2) 3216/    1142 : 1E C0               		ld	e,11000000b
(2) 3217/    1144 : CD E2 12            		call	fm_send_2
(2) 3218/    1147 : C3 17 13            		jp	dac_play		; Set playback
(2) 3219/    114A :                     .req_pitch:
(2) 3220/    114A : D9                  		exx
(2) 3221/    114B : 2A CA 19            		ld	hl,(wave_Pitch)
(2) 3222/    114E : D9                  		exx
(2) 3223/    114F :                     ; 		bit	4,c
(2) 3224/    114F :                     ; 		ret	nz
(2) 3225/    114F :                     ; 		exx
(2) 3226/    114F :                     ; 		push	de
(2) 3227/    114F :                     ; 		exx
(2) 3228/    114F :                     ; 		pop	hl
(2) 3229/    114F :                     ; 		rst	8
(2) 3230/    114F :                     ; 		add	hl,de
(2) 3231/    114F :                     ; 		push	hl
(2) 3232/    114F :                     ; 		exx
(2) 3233/    114F :                     ; 		pop	de
(2) 3234/    114F :                     ; 		exx
(2) 3235/    114F : C9                  		ret
(2) 3236/    1150 :                     
(2) 3237/    1150 :                     ; ----------------------------------------
(2) 3238/    1150 :                     ; Control current FM channel
(2) 3239/    1150 :                     ;
(2) 3240/    1150 :                     ; iy - fmcom
(2) 3241/    1150 :                     ; ix - Instrument data pointer
(2) 3242/    1150 :                     ;  c - FM chip ID
(2) 3243/    1150 :                     ; ----------------------------------------
(2) 3244/    1150 :                     
(2) 3245/    1150 :                     	; 0pvi 0cop
(2) 3246/    1150 :                     	; pvi - update bits:
(2) 3247/    1150 :                     	;      volume(v)
(2) 3248/    1150 :                     	;      instrument(i)
(2) 3249/    1150 :                     	;      panning(p)
(2) 3250/    1150 :                     	;
(2) 3251/    1150 :                     	; c/o/p key cut, key off, key on
(2) 3252/    1150 :                     .fm_chnl:
(2) 3253/    1150 : FD 7E 00            		ld	a,(iy)		; Get comm bits
(2) 3254/    1153 : B7                  		or	a
(2) 3255/    1154 : C8                  		ret	z
(2) 3256/    1155 : FD 36 00 00         		ld	(iy),0		; Reset
(2) 3257/    1159 : CB 57               		bit	2,a		; Key-cut (010b) bit?
(2) 3258/    115B : C2 E3 11            		jp	nz,.fm_keycut
(2) 3259/    115E : CB 4F               		bit	1,a		; Key-off (100b) bit?
(2) 3260/    1160 : C2 F8 11            		jp	nz,.fm_keyoff
(2) 3261/    1163 : 47                  		ld	b,a		; b - other update bits
(2) 3262/    1164 : 79                  		ld	a,c		; check for Channel 6
(2) 3263/    1165 : FE 06               		cp	6
(2) 3264/    1167 : CC 02 13            		call	z,dac_off	; auto-mute WAVE playback
(2) 3265/    116A : CF                  		rst	8
(2) 3266/    116B : CB 60               		bit	4,b		; Instrument-update bit?  (%0001xxxx)
(2) 3267/    116D : C4 18 12            		call	nz,.fm_insupd
(2) 3268/    1170 : CB 68               		bit	5,b		; Volume-update bit? (%0010xxxx)
(2) 3269/    1172 : C4 7D 12            		call	nz,.fm_volupd	;
(2) 3270/    1175 : CB 70               		bit	6,b		; Panning update bit? (%0100xxxx)
(2) 3271/    1177 : C4 FF 11            		call	nz,.fm_panupd
(2) 3272/    117A : CB 40               		bit	0,b		; Key-on (001b) bit?
(2) 3273/    117C : C8                  		ret	z
(2) 3274/    117D :                     	; freq update
(2) 3275/    117D :                     	; all this code is for OP4 (if FM3 is in special)
(2) 3276/    117D : CF                  		rst	8
(2) 3277/    117E : 79                  		ld	a,c
(2) 3278/    117F : E6 03               		and	11b
(2) 3279/    1181 : F6 A4               		or	0A4h
(2) 3280/    1183 : 57                  		ld	d,a
(2) 3281/    1184 : FD 5E 18            		ld	e,(iy+FMFRQH)
(2) 3282/    1187 : CB 51               		bit	2,c
(2) 3283/    1189 : C4 E2 12            		call	nz,fm_send_2
(2) 3284/    118C : CC D7 12            		call	z,fm_send_1
(2) 3285/    118F : CF                  		rst	8
(2) 3286/    1190 : 15                  		dec	d
(2) 3287/    1191 : 15                  		dec	d
(2) 3288/    1192 : 15                  		dec	d
(2) 3289/    1193 : 15                  		dec	d
(2) 3290/    1194 : FD 5E 1E            		ld	e,(iy+FMFRQL)
(2) 3291/    1197 : CB 51               		bit	2,c
(2) 3292/    1199 : C4 E2 12            		call	nz,fm_send_2
(2) 3293/    119C : CC D7 12            		call	z,fm_send_1
(2) 3294/    119F : CF                  		rst	8
(2) 3295/    11A0 :                     
(2) 3296/    11A0 : 79                  		ld	a,c
(2) 3297/    11A1 : E6 03               		and	11b
(2) 3298/    11A3 : F6 B0               		or	0B0h
(2) 3299/    11A5 : 57                  		ld	d,a
(2) 3300/    11A6 : DD 5E 1C            		ld	e,(ix+1Ch)
(2) 3301/    11A9 : CB 51               		bit	2,c
(2) 3302/    11AB : C4 E2 12            		call	nz,fm_send_2
(2) 3303/    11AE : CC D7 12            		call	z,fm_send_1
(2) 3304/    11B1 : 14                  		inc	d
(2) 3305/    11B2 : 14                  		inc	d
(2) 3306/    11B3 : CF                  		rst	8
(2) 3307/    11B4 : 14                  		inc	d
(2) 3308/    11B5 : 14                  		inc	d
(2) 3309/    11B6 :                     ; 		call	.fm_panset
(2) 3310/    11B6 :                     
(2) 3311/    11B6 :                     	; For Special FM3 mode it just copy-pastes regs
(2) 3312/    11B6 :                     	; from a separate list
(2) 3313/    11B6 : 79                  		ld	a,c		; FM3 special check
(2) 3314/    11B7 : FE 02               		cp	2
(2) 3315/    11B9 : 20 19               		jr	nz,.notfm3
(2) 3316/    11BB : 3A 48 1F            		ld	a,(fmSpcMode)
(2) 3317/    11BE : E6 40               		and	01000000b
(2) 3318/    11C0 : B7                  		or	a
(2) 3319/    11C1 : 28 11               		jr	z,.notfm3
(2) 3320/    11C3 : CF                  		rst	8
(2) 3321/    11C4 : 21 59 17            		ld	hl,fm3reg
(2) 3322/    11C7 : 06 06               		ld	b,3*2
(2) 3323/    11C9 :                     .copyops:
(2) 3324/    11C9 : 5E                  		ld	e,(hl)
(2) 3325/    11CA : 23                  		inc	hl
(2) 3326/    11CB : 56                  		ld	d,(hl)
(2) 3327/    11CC : 23                  		inc	hl
(2) 3328/    11CD : 00                  		nop
(2) 3329/    11CE : CF                  		rst	8
(2) 3330/    11CF : CD D7 12            		call	fm_send_1
(2) 3331/    11D2 : 10 F5               		djnz	.copyops
(2) 3332/    11D4 :                     .notfm3:
(2) 3333/    11D4 :                     
(2) 3334/    11D4 : CF                  		rst	8
(2) 3335/    11D5 : 16 28               		ld	d,28h		; Keys
(2) 3336/    11D7 : DD 7E 1F            		ld	a,(ix+01Fh)	; a - Read this ins keys
(2) 3337/    11DA : FD 46 06            		ld	b,(iy+FMKEYS)	; b - ALLOWED bits from fmcom
(2) 3338/    11DD : A0                  		and	b
(2) 3339/    11DE : B1                  		or	c
(2) 3340/    11DF : 5F                  		ld	e,a
(2) 3344/    11E0 : C3 D7 12            		jp	fm_send_1
(2) 3345/    11E3 :                     
(2) 3346/    11E3 :                     .fm_keycut:
(2) 3347/    11E3 : 79                  		ld	a,c
(2) 3348/    11E4 : E6 03               		and	11b
(2) 3349/    11E6 : F6 B4               		or	0B4h
(2) 3350/    11E8 : 57                  		ld	d,a
(2) 3351/    11E9 : CF                  		rst	8
(2) 3352/    11EA : DD 7E 1D            		ld	a,(ix+1Dh)
(2) 3353/    11ED : E6 07               		and	00000111b
(2) 3354/    11EF : 5F                  		ld	e,a
(2) 3355/    11F0 : CB 51               		bit	2,c
(2) 3356/    11F2 : CC D7 12            		call	z,fm_send_1
(2) 3357/    11F5 : C4 E2 12            		call	nz,fm_send_2
(2) 3358/    11F8 :                     .fm_keyoff:
(2) 3359/    11F8 : CF                  		rst	8
(2) 3360/    11F9 : 59                  		ld	e,c
(2) 3361/    11FA : 16 28               		ld	d,28h
(2) 3362/    11FC : C3 D7 12            		jp	fm_send_1
(2) 3363/    11FF :                     ; d - 0B4h+
(2) 3364/    11FF :                     .fm_panupd:
(2) 3365/    11FF : 79                  		ld	a,c
(2) 3366/    1200 : E6 03               		and	11b
(2) 3367/    1202 : F6 B4               		or	0B4h
(2) 3368/    1204 : 57                  		ld	d,a
(2) 3369/    1205 :                     .fm_panset:
(2) 3370/    1205 : DD 5E 1D            		ld	e,(ix+1Dh)
(2) 3371/    1208 : FD 7E 12            		ld	a,(iy+FMPAN)
(2) 3372/    120B : E6 C0               		and	11000000b
(2) 3373/    120D : B3                  		or	e
(2) 3374/    120E : 5F                  		ld	e,a
(2) 3375/    120F : CB 51               		bit	2,c
(2) 3376/    1211 : C4 E2 12            		call	nz,fm_send_2
(2) 3377/    1214 : CC D7 12            		call	z,fm_send_1
(2) 3378/    1217 : C9                  		ret
(2) 3379/    1218 :                     
(2) 3380/    1218 :                     ; CPU-intense
(2) 3381/    1218 :                     ; only call this if needed
(2) 3382/    1218 :                     .fm_insupd:
(2) 3383/    1218 : C5                  		push	bc
(2) 3384/    1219 : CD F8 11            		call	.fm_keyoff		; restart chip channel
(2) 3385/    121C : E7                  		rst	20h;call dac_fill	; TODO: ver si se pone lento aqui...
(2) 3386/    121D : DD E5               		push	ix			; copy ix to hl
(2) 3387/    121F : E1                  		pop	hl
(2) 3388/    1220 : 79                  		ld	a,c
(2) 3389/    1221 : E6 03               		and	011b
(2) 3390/    1223 : F6 30               		or	30h
(2) 3391/    1225 : CF                  		rst	8
(2) 3392/    1226 : 57                  		ld	d,a
(2) 3393/    1227 : 06 1C               		ld	b,4*7
(2) 3394/    1229 :                     .copy_1:
(2) 3395/    1229 : CF                  		rst	8
(2) 3396/    122A : 5E                  		ld	e,(hl)
(2) 3397/    122B : CB 51               		bit	2,c
(2) 3398/    122D : CC D7 12            		call	z,fm_send_1
(2) 3399/    1230 : C4 E2 12            		call	nz,fm_send_2
(2) 3400/    1233 : 23                  		inc	hl
(2) 3401/    1234 : 14                  		inc	d
(2) 3402/    1235 : CF                  		rst	8
(2) 3403/    1236 : 00                  		nop
(2) 3404/    1237 : 14                  		inc	d
(2) 3405/    1238 : 14                  		inc	d
(2) 3406/    1239 : 14                  		inc	d
(2) 3407/    123A : 10 ED               		djnz	.copy_1
(2) 3408/    123C : 11 04 00            		ld	de,4		; skip AMS, FMS,
(2) 3409/    123F : 19                  		add	hl,de		; old FM3 check (oops) and keys
(2) 3410/    1240 : 79                  		ld	a,c		; check for Channel 3
(2) 3411/    1241 : FE 02               		cp	2
(2) 3412/    1243 : 20 36               		jr	nz,.fm_ins_ex
(2) 3413/    1245 : CF                  		rst	8
(2) 3414/    1246 : 3A 48 1F            		ld	a,(fmSpcMode)	; Is it in special mode?
(2) 3415/    1249 : CB 77               		bit	6,a
(2) 3416/    124B : 28 2E               		jr	z,.fm_ins_ex
(2) 3417/    124D : DD E5               		push	ix
(2) 3418/    124F : DD 21 59 17         		ld	ix,fm3reg
(2) 3419/    1253 : 06 03               		ld	b,3
(2) 3420/    1255 :                     .copyops3:
(2) 3421/    1255 : 56                  		ld	d,(hl)		; Read OP1-3 freqs
(2) 3422/    1256 : 23                  		inc	hl
(2) 3423/    1257 : CF                  		rst	8
(2) 3424/    1258 : 5E                  		ld	e,(hl)
(2) 3425/    1259 : 23                  		inc	hl
(2) 3426/    125A : DD 72 00            		ld	(ix),d
(2) 3427/    125D : DD 73 02            		ld	(ix+2),e
(2) 3428/    1260 : DD 23               		inc	ix
(2) 3429/    1262 : CF                  		rst	8
(2) 3430/    1263 : DD 23               		inc	ix
(2) 3431/    1265 : DD 23               		inc	ix
(2) 3432/    1267 : DD 23               		inc	ix
(2) 3433/    1269 : 10 EA               		djnz	.copyops3
(2) 3434/    126B : DD 21 47 16         		ld	ix,fmcom+2	; Read OP4 freq
(2) 3435/    126F : 56                  		ld	d,(hl)
(2) 3436/    1270 : 23                  		inc	hl
(2) 3437/    1271 : CF                  		rst	8
(2) 3438/    1272 : 5E                  		ld	e,(hl)
(2) 3439/    1273 : DD 72 18            		ld	(ix+FMFRQH),d
(2) 3440/    1276 : DD 73 1E            		ld	(ix+FMFRQL),e
(2) 3441/    1279 : DD E1               		pop	ix
(2) 3442/    127B :                     .fm_ins_ex:
(2) 3443/    127B : C1                  		pop	bc
(2) 3444/    127C : C9                  		ret
(2) 3445/    127D :                     
(2) 3446/    127D :                     ; b - Volume decrement
(2) 3447/    127D :                     ; c - Channel id
(2) 3448/    127D :                     ; d - 40h+ base reg
(2) 3449/    127D :                     ; h - Algorithm
(2) 3450/    127D :                     .fm_volupd:
(2) 3451/    127D : C5                  		push	bc
(2) 3452/    127E : FD 46 0C            		ld	b,(iy+FMVOL)
(2) 3453/    1281 :                     .fm_chnlvol:
(2) 3454/    1281 : DD E5               		push	ix
(2) 3455/    1283 : DD 7E 1C            		ld	a,(ix+1Ch)
(2) 3456/    1286 : E6 07               		and	111b
(2) 3457/    1288 : 67                  		ld	h,a
(2) 3458/    1289 : 11 04 00            		ld	de,4
(2) 3459/    128C : DD 19               		add	ix,de
(2) 3460/    128E : 79                  		ld	a,c
(2) 3461/    128F : E6 03               		and	11b
(2) 3462/    1291 : CF                  		rst	8
(2) 3463/    1292 : F6 40               		or	40h
(2) 3464/    1294 : 57                  		ld	d,a
(2) 3465/    1295 : 7C                  		ld	a,h		; Check 40h
(2) 3466/    1296 : FE 07               		cp	7		; Algorithm == 07h?
(2) 3467/    1298 : CC C3 12            		call	z,.do_vol
(2) 3468/    129B : 7A                  		ld	a,d
(2) 3469/    129C : C6 04               		add	a,4
(2) 3470/    129E : CF                  		rst	8
(2) 3471/    129F : 57                  		ld	d,a
(2) 3472/    12A0 : DD 23               		inc	ix
(2) 3473/    12A2 : 7C                  		ld	a,h		; Check 44h
(2) 3474/    12A3 : FE 05               		cp	5		; Algorithm > 05h?
(2) 3475/    12A5 : D4 C3 12            		call	nc,.do_vol
(2) 3476/    12A8 : 7A                  		ld	a,d
(2) 3477/    12A9 : C6 04               		add	a,4
(2) 3478/    12AB : 57                  		ld	d,a
(2) 3479/    12AC : DD 23               		inc	ix
(2) 3480/    12AE : CF                  		rst	8
(2) 3481/    12AF : 7C                  		ld	a,h		; Check 48h
(2) 3482/    12B0 : FE 04               		cp	4		; Algorithm > 04h?
(2) 3483/    12B2 : D4 C3 12            		call	nc,.do_vol
(2) 3484/    12B5 : 7A                  		ld	a,d
(2) 3485/    12B6 : C6 04               		add	a,4
(2) 3486/    12B8 : 57                  		ld	d,a
(2) 3487/    12B9 : DD 23               		inc	ix
(2) 3488/    12BB : CD C3 12            		call	.do_vol		; Do 4Ch
(2) 3489/    12BE : DD E1               		pop	ix
(2) 3490/    12C0 : C1                  		pop	bc
(2) 3491/    12C1 : CF                  		rst	8
(2) 3492/    12C2 : C9                  		ret
(2) 3493/    12C3 :                     .do_vol:
(2) 3494/    12C3 : DD 7E 00            		ld	a,(ix)
(2) 3495/    12C6 : 80                  		add	a,b
(2) 3496/    12C7 : FE 7F               		cp	7Fh
(2) 3497/    12C9 : 38 02               		jr	c,.vmuch
(2) 3498/    12CB : 3E 7F               		ld	a,7Fh
(2) 3499/    12CD :                     .vmuch:
(2) 3500/    12CD : 5F                  		ld	e,a
(2) 3501/    12CE : CB 51               		bit	2,c
(2) 3502/    12D0 : CC D7 12            		call	z,fm_send_1
(2) 3503/    12D3 : C4 E2 12            		call	nz,fm_send_2
(2) 3504/    12D6 : C9                  		ret
(2) 3505/    12D7 :                     
(2) 3506/    12D7 :                     ; ---------------------------------------------
(2) 3507/    12D7 :                     ; FM send registers
(2) 3508/    12D7 :                     ;
(2) 3509/    12D7 :                     ; Input:
(2) 3510/    12D7 :                     ; d - ctrl
(2) 3511/    12D7 :                     ; e - data
(2) 3512/    12D7 :                     ; ---------------------------------------------
(2) 3513/    12D7 :                     
(2) 3514/    12D7 :                     ; Channels 1-3 and global registers
(2) 3515/    12D7 :                     fm_send_1:
(2) 3516/    12D7 : 7A                  		ld	a,d
(2) 3517/    12D8 : 32 00 40            		ld	(Zym_ctrl_1),a
(2) 3518/    12DB : 00                  		nop
(2) 3519/    12DC : 7B                  		ld	a,e
(2) 3520/    12DD : 32 01 40            		ld	(Zym_data_1),a
(2) 3521/    12E0 : 00                  		nop
(2) 3522/    12E1 : C9                  		ret
(2) 3523/    12E2 :                     ; Channels 4-6
(2) 3524/    12E2 :                     fm_send_2:
(2) 3525/    12E2 : 7A                  		ld	a,d
(2) 3526/    12E3 : 32 02 40            		ld	(Zym_ctrl_2),a
(2) 3527/    12E6 : 00                  		nop
(2) 3528/    12E7 : 7B                  		ld	a,e
(2) 3529/    12E8 : 32 03 40            		ld	(Zym_data_2),a
(2) 3530/    12EB : 00                  		nop
(2) 3531/    12EC : C9                  		ret
(2) 3532/    12ED :                     
(2) 3533/    12ED :                     ; --------------------------------------------------------
(2) 3534/    12ED :                     ; brute-force WAVE ON/OFF playback
(2) 3535/    12ED :                     ; --------------------------------------------------------
(2) 3536/    12ED :                     
(2) 3537/    12ED :                     dac_on:
(2) 3538/    12ED : 3E 2B               		ld	a,2Bh
(2) 3539/    12EF : 32 00 40            		ld	(Zym_ctrl_1),a
(2) 3540/    12F2 : 3E 80               		ld	a,80h
(2) 3541/    12F4 : 32 01 40            		ld	(Zym_data_1),a
(2) 3542/    12F7 : 3E D9               		ld 	a,zopcExx
(2) 3543/    12F9 : 32 08 00            		ld	(dac_me),a
(2) 3544/    12FC : 3E F5               		ld 	a,zopcPushAf
(2) 3545/    12FE : 32 20 00            		ld	(dac_fill),a
(2) 3546/    1301 : C9                  		ret
(2) 3547/    1302 :                     dac_off:
(2) 3548/    1302 : 3E 2B               		ld	a,2Bh
(2) 3549/    1304 : 32 00 40            		ld	(Zym_ctrl_1),a
(2) 3550/    1307 : 3E 00               		ld	a,00h
(2) 3551/    1309 : 32 01 40            		ld	(Zym_data_1),a
(2) 3552/    130C : 3E C9               		ld 	a,zopcRet
(2) 3553/    130E : 32 08 00            		ld	(dac_me),a
(2) 3554/    1311 : 3E C9               		ld 	a,zopcRet
(2) 3555/    1313 : 32 20 00            		ld	(dac_fill),a
(2) 3556/    1316 : C9                  		ret
(2) 3557/    1317 :                     
(2) 3558/    1317 :                     ; --------------------------------------------------------
(2) 3559/    1317 :                     ; dac_play
(2) 3560/    1317 :                     ;
(2) 3561/    1317 :                     ; Plays a new sample
(2) 3562/    1317 :                     ; --------------------------------------------------------
(2) 3563/    1317 :                     
(2) 3564/    1317 :                     dac_play:
(2) 3565/    1317 : F3                  		di
(2) 3566/    1318 : CD 02 13            		call	dac_off
(2) 3567/    131B : D9                  		exx				; get exx regs
(2) 3568/    131C : 01 1C 00            		ld	bc,dWaveBuff>>8		; bc - WAVFIFO MSB
(2) 3569/    131F : ED 5B CA 19         		ld	de,(wave_Pitch)		; de - Pitch
(2) 3570/    1323 : 21 00 00            		ld	hl,(dWaveBuff&0FFh)<<8	; hl - WAVFIFO LSB pointer (xx.00)
(2) 3571/    1326 : D9                  		exx				; move them back
(2) 3572/    1327 : 2A C1 19            		ld	hl,(wave_Start)
(2) 3573/    132A : 3A C3 19            		ld 	a,(wave_Start+2)
(2) 3574/    132D : 22 40 1F            		ld	(dDacPntr),hl
(2) 3575/    1330 : 32 42 1F            		ld	(dDacPntr+2),a
(2) 3576/    1333 : 2A C4 19            		ld	hl,(wave_Len)
(2) 3577/    1336 : 3A C6 19            		ld 	a,(wave_Len+2)
(2) 3578/    1339 : 22 43 1F            		ld	(dDacCntr),hl
(2) 3579/    133C : 32 45 1F            		ld	(dDacCntr+2),a
(2) 3580/    133F : AF                  		xor	a
(2) 3581/    1340 : 32 46 1F            		ld	(dDacFifoMid),a
(2) 3582/    1343 : CD 4B 13            		call	dac_firstfill
(2) 3583/    1346 : CD ED 12            		call	dac_on
(2) 3584/    1349 : FB                  		ei
(2) 3585/    134A : C9                  		ret
(2) 3586/    134B :                     
(2) 3587/    134B :                     ; --------------------------------------------------------
(2) 3588/    134B :                     
(2) 3589/    134B :                     ; First wave fill
(2) 3590/    134B :                     dac_firstfill:
(2) 3591/    134B : CD 84 0E            		call	get_tick
(2) 3592/    134E : F5                  		push	af
(2) 3593/    134F :                     
(2) 3594/    134F :                     ; Wave refill request
(2) 3595/    134F :                     ; Got this from GEMS, but I changed it to play
(2) 3596/    134F :                     ; larger samples (7FFFFFh maximum)
(2) 3597/    134F :                     dac_refill:
(2) 3598/    134F : CF                  		rst	8
(2) 3599/    1350 : C5                  		push	bc
(2) 3600/    1351 : D5                  		push	de
(2) 3601/    1352 : E5                  		push	hl
(2) 3602/    1353 : 3A CC 19            		ld	a,(wave_Flags)
(2) 3603/    1356 : FE 07               		cp	111b
(2) 3604/    1358 : D2 0F 14            		jp	nc,.FDF7
(2) 3605/    135B : 3A 45 1F            		ld	a,(dDacCntr+2)	; Last bytes
(2) 3606/    135E : 2A 43 1F            		ld	hl,(dDacCntr)
(2) 3607/    1361 : 01 80 00            		ld	bc,80h
(2) 3608/    1364 : 37                  		scf
(2) 3609/    1365 : 3F                  		ccf
(2) 3610/    1366 : ED 42               		sbc	hl,bc
(2) 3611/    1368 : DE 00               		sbc	a,0
(2) 3612/    136A : 32 45 1F            		ld	(dDacCntr+2),a
(2) 3613/    136D : 22 43 1F            		ld	(dDacCntr),hl
(2) 3614/    1370 : 16 1C               		ld	d,dWaveBuff>>8
(2) 3615/    1372 : B7                  		or	a
(2) 3616/    1373 : FA 9D 13            		jp	m,.dac_over
(2) 3617/    1376 :                     .keepcntr:
(2) 3618/    1376 : 3A 46 1F            		ld	a,(dDacFifoMid)
(2) 3619/    1379 : 5F                  		ld	e,a
(2) 3620/    137A : C6 80               		add 	a,80h
(2) 3621/    137C : 32 46 1F            		ld	(dDacFifoMid),a
(2) 3622/    137F : 2A 40 1F            		ld	hl,(dDacPntr)
(2) 3623/    1382 : 3A 42 1F            		ld	a,(dDacPntr+2)
(2) 3624/    1385 : CD F3 0E            		call	transferRom
(2) 3625/    1388 : 2A 40 1F            		ld	hl,(dDacPntr)
(2) 3626/    138B : 3A 42 1F            		ld	a,(dDacPntr+2)
(2) 3627/    138E : 01 80 00            		ld	bc,80h
(2) 3628/    1391 : 09                  		add	hl,bc
(2) 3629/    1392 : CE 00               		adc	a,0
(2) 3630/    1394 : 22 40 1F            		ld	(dDacPntr),hl
(2) 3631/    1397 : 32 42 1F            		ld	(dDacPntr+2),a
(2) 3632/    139A : C3 12 14            		jp	.FDFreturn
(2) 3633/    139D :                     
(2) 3634/    139D :                     ; if wav's len-timer finished:
(2) 3635/    139D :                     .dac_over:
(2) 3636/    139D : 16 1C               		ld	d,dWaveBuff>>8
(2) 3637/    139F : 3A CC 19            		ld	a,(wave_Flags)
(2) 3638/    13A2 : E6 01               		and	01b
(2) 3639/    13A4 : B7                  		or	a
(2) 3640/    13A5 : C2 C8 13            		jp	nz,.FDF72
(2) 3641/    13A8 : 7D                  		ld	a,l
(2) 3642/    13A9 : C6 80               		add	a,80h
(2) 3643/    13AB : 4F                  		ld	c,a
(2) 3644/    13AC : 06 00               		ld	b,0
(2) 3645/    13AE : C5                  		push	bc
(2) 3646/    13AF : 3A 46 1F            		ld	a,(dDacFifoMid)
(2) 3647/    13B2 : 5F                  		ld	e,a
(2) 3648/    13B3 : C6 80               		add	a,80h
(2) 3649/    13B5 : 32 46 1F            		ld	(dDacFifoMid),a
(2) 3650/    13B8 : C1                  		pop	bc			; C <- # just xfered
(2) 3651/    13B9 : 79                  		ld	a,c
(2) 3652/    13BA : B0                  		or	b
(2) 3653/    13BB : 28 52               		jr	z,.FDF7
(2) 3654/    13BD : 2A 40 1F            		ld	hl,(dDacPntr)
(2) 3655/    13C0 : 3A 42 1F            		ld	a,(dDacPntr+2)
(2) 3656/    13C3 : CD F3 0E            		call	transferRom
(2) 3657/    13C6 : 18 47               		jr	.FDF7
(2) 3658/    13C8 :                     .FDF72:
(2) 3659/    13C8 :                     
(2) 3660/    13C8 :                     	; loop sample
(2) 3661/    13C8 : C5                  		push	bc
(2) 3662/    13C9 : D5                  		push	de
(2) 3663/    13CA : 3A C9 19            		ld	a,(wave_Loop+2)
(2) 3664/    13CD : 4F                  		ld	c,a
(2) 3665/    13CE : ED 5B C7 19         		ld	de,(wave_Loop)
(2) 3666/    13D2 : 2A C1 19            		ld	hl,(wave_Start)
(2) 3667/    13D5 : 3A C3 19            		ld 	a,(wave_Start+2)
(2) 3668/    13D8 : 81                  		add	a,c
(2) 3669/    13D9 : 19                  		add	hl,de
(2) 3670/    13DA : CE 00               		adc	a,0
(2) 3671/    13DC : 22 40 1F            		ld	(dDacPntr),hl
(2) 3672/    13DF : 32 42 1F            		ld	(dDacPntr+2),a
(2) 3673/    13E2 : 2A C4 19            		ld	hl,(wave_Len)
(2) 3674/    13E5 : 3A C6 19            		ld 	a,(wave_Len+2)
(2) 3675/    13E8 : 91                  		sub	a,c
(2) 3676/    13E9 : 37                  		scf
(2) 3677/    13EA : 3F                  		ccf
(2) 3678/    13EB : ED 52               		sbc	hl,de
(2) 3679/    13ED : DE 00               		sbc	a,0
(2) 3680/    13EF : 22 43 1F            		ld	(dDacCntr),hl
(2) 3681/    13F2 : 32 45 1F            		ld	(dDacCntr+2),a
(2) 3682/    13F5 : D1                  		pop	de
(2) 3683/    13F6 : C1                  		pop	bc
(2) 3684/    13F7 : 78                  		ld	a,b
(2) 3685/    13F8 : B1                  		or	c
(2) 3686/    13F9 : 28 17               		jr	z,.FDFreturn
(2) 3687/    13FB : 3A 46 1F            		ld	a,(dDacFifoMid)
(2) 3688/    13FE : 5F                  		ld	e,a
(2) 3689/    13FF : C6 80               		add	a,80h
(2) 3690/    1401 : 32 46 1F            		ld	(dDacFifoMid),a
(2) 3691/    1404 : 2A 40 1F            		ld	hl,(dDacPntr)
(2) 3692/    1407 : 3A 42 1F            		ld	a,(dDacPntr+2)
(2) 3693/    140A : CD F3 0E            		call	transferRom
(2) 3694/    140D : 18 03               		jr	.FDFreturn
(2) 3695/    140F :                     .FDF7:
(2) 3696/    140F : CD 02 13            		call	dac_off		; DAC finished
(2) 3697/    1412 :                     .FDFreturn:
(2) 3698/    1412 : E1                  		pop	hl
(2) 3699/    1413 : D1                  		pop	de
(2) 3700/    1414 : C1                  		pop	bc
(2) 3701/    1415 : F1                  		pop	af
(2) 3702/    1416 : C9                  		ret
(2) 3703/    1417 :                     
(2) 3704/    1417 :                     ; ====================================================================
(2) 3705/    1417 :                     ; ----------------------------------------------------------------
(2) 3706/    1417 :                     ; Tables
(2) 3707/    1417 :                     ; ----------------------------------------------------------------
(2) 3708/    1417 :                     
(2) 3709/    1417 : 84 02               fmFreq_List:	dw 644
(2) 3710/    1419 : A9 02               		dw 681
(2) 3711/    141B : D2 02               		dw 722
(2) 3712/    141D : FD 02               		dw 765
(2) 3713/    141F : 2A 03               		dw 810
(2) 3714/    1421 : 5A 03               		dw 858
(2) 3715/    1423 : 8E 03               		dw 910
(2) 3716/    1425 : C4 03               		dw 964
(2) 3717/    1427 : FD 03               		dw 1021
(2) 3718/    1429 : 39 04               		dw 1081
(2) 3719/    142B : 7A 04               		dw 1146
(2) 3720/    142D : BE 04               		dw 1214
(2) 3721/    142F :                     psgFreq_List:
(2) 3722/    142F : FF FF               		dw -1		; C-0 $0
(2) 3723/    1431 : FF FF               		dw -1
(2) 3724/    1433 : FF FF               		dw -1
(2) 3725/    1435 : FF FF               		dw -1
(2) 3726/    1437 : FF FF               		dw -1
(2) 3727/    1439 : FF FF               		dw -1
(2) 3728/    143B : FF FF               		dw -1
(2) 3729/    143D : FF FF               		dw -1
(2) 3730/    143F : FF FF               		dw -1
(2) 3731/    1441 : FF FF               		dw -1
(2) 3732/    1443 : FF FF               		dw -1
(2) 3733/    1445 : FF FF               		dw -1
(2) 3734/    1447 : FF FF               		dw -1		; C-1 $C
(2) 3735/    1449 : FF FF               		dw -1
(2) 3736/    144B : FF FF               		dw -1
(2) 3737/    144D : FF FF               		dw -1
(2) 3738/    144F : FF FF               		dw -1
(2) 3739/    1451 : FF FF               		dw -1
(2) 3740/    1453 : FF FF               		dw -1
(2) 3741/    1455 : FF FF               		dw -1
(2) 3742/    1457 : FF FF               		dw -1
(2) 3743/    1459 : FF FF               		dw -1
(2) 3744/    145B : FF FF               		dw -1
(2) 3745/    145D : FF FF               		dw -1
(2) 3746/    145F : FF FF               		dw -1		; C-2 $18
(2) 3747/    1461 : FF FF               		dw -1
(2) 3748/    1463 : FF FF               		dw -1
(2) 3749/    1465 : FF FF               		dw -1
(2) 3750/    1467 : FF FF               		dw -1
(2) 3751/    1469 : FF FF               		dw -1
(2) 3752/    146B : FF FF               		dw -1
(2) 3753/    146D : FF FF               		dw -1
(2) 3754/    146F : FF FF               		dw -1
(2) 3755/    1471 : FF FF               		dw -1
(2) 3756/    1473 : FF FF               		dw -1
(2) 3757/    1475 : FF FF               		dw -1
(2) 3758/    1477 : FF FF               		dw -1		; C-3 $24
(2) 3759/    1479 : FF FF               		dw -1
(2) 3760/    147B : FF FF               		dw -1
(2) 3761/    147D : FF FF               		dw -1
(2) 3762/    147F : FF FF               		dw -1
(2) 3763/    1481 : FF FF               		dw -1
(2) 3764/    1483 : FF FF               		dw -1
(2) 3765/    1485 : FF FF               		dw -1
(2) 3766/    1487 : FF FF               		dw -1
(2) 3767/    1489 : F8 03               		dw 3F8h
(2) 3768/    148B : BF 03               		dw 3BFh
(2) 3769/    148D : 89 03               		dw 389h
(2) 3770/    148F : 56 03               		dw 356h		;C-4 30
(2) 3771/    1491 : 26 03               		dw 326h
(2) 3772/    1493 : F9 02               		dw 2F9h
(2) 3773/    1495 : CE 02               		dw 2CEh
(2) 3774/    1497 : A5 02               		dw 2A5h
(2) 3775/    1499 : 80 02               		dw 280h
(2) 3776/    149B : 5C 02               		dw 25Ch
(2) 3777/    149D : 3A 02               		dw 23Ah
(2) 3778/    149F : 1A 02               		dw 21Ah
(2) 3779/    14A1 : FB 01               		dw 1FBh
(2) 3780/    14A3 : DF 01               		dw 1DFh
(2) 3781/    14A5 : C4 01               		dw 1C4h
(2) 3782/    14A7 : AB 01               		dw 1ABh		;C-5 3C
(2) 3783/    14A9 : 93 01               		dw 193h
(2) 3784/    14AB : 7D 01               		dw 17Dh
(2) 3785/    14AD : 67 01               		dw 167h
(2) 3786/    14AF : 53 01               		dw 153h
(2) 3787/    14B1 : 40 01               		dw 140h
(2) 3788/    14B3 : 2E 01               		dw 12Eh
(2) 3789/    14B5 : 1D 01               		dw 11Dh
(2) 3790/    14B7 : 0D 01               		dw 10Dh
(2) 3791/    14B9 : FE 00               		dw 0FEh
(2) 3792/    14BB : EF 00               		dw 0EFh
(2) 3793/    14BD : E2 00               		dw 0E2h
(2) 3794/    14BF : D6 00               		dw 0D6h		;C-6 48
(2) 3795/    14C1 : C9 00               		dw 0C9h
(2) 3796/    14C3 : BE 00               		dw 0BEh
(2) 3797/    14C5 : B4 00               		dw 0B4h
(2) 3798/    14C7 : A9 00               		dw 0A9h
(2) 3799/    14C9 : A0 00               		dw 0A0h
(2) 3800/    14CB : 97 00               		dw 97h
(2) 3801/    14CD : 8F 00               		dw 8Fh
(2) 3802/    14CF : 87 00               		dw 87h
(2) 3803/    14D1 : 7F 00               		dw 7Fh
(2) 3804/    14D3 : 78 00               		dw 78h
(2) 3805/    14D5 : 71 00               		dw 71h
(2) 3806/    14D7 : 6B 00               		dw 6Bh		; C-7 54
(2) 3807/    14D9 : 65 00               		dw 65h
(2) 3808/    14DB : 5F 00               		dw 5Fh
(2) 3809/    14DD : 5A 00               		dw 5Ah
(2) 3810/    14DF : 55 00               		dw 55h
(2) 3811/    14E1 : 50 00               		dw 50h
(2) 3812/    14E3 : 4B 00               		dw 4Bh
(2) 3813/    14E5 : 47 00               		dw 47h
(2) 3814/    14E7 : 43 00               		dw 43h
(2) 3815/    14E9 : 40 00               		dw 40h
(2) 3816/    14EB : 3C 00               		dw 3Ch
(2) 3817/    14ED : 39 00               		dw 39h
(2) 3818/    14EF : 36 00               		dw 36h		; C-8 $60
(2) 3819/    14F1 : 33 00               		dw 33h
(2) 3820/    14F3 : 30 00               		dw 30h
(2) 3821/    14F5 : 2D 00               		dw 2Dh
(2) 3822/    14F7 : 2B 00               		dw 2Bh
(2) 3823/    14F9 : 28 00               		dw 28h
(2) 3824/    14FB : 26 00               		dw 26h
(2) 3825/    14FD : 24 00               		dw 24h
(2) 3826/    14FF : 22 00               		dw 22h
(2) 3827/    1501 : 20 00               		dw 20h
(2) 3828/    1503 : 1F 00               		dw 1Fh
(2) 3829/    1505 : 1D 00               		dw 1Dh
(2) 3830/    1507 : 1B 00               		dw 1Bh		; C-9 $6C
(2) 3831/    1509 : 1A 00               		dw 1Ah
(2) 3832/    150B : 18 00               		dw 18h
(2) 3833/    150D : 17 00               		dw 17h
(2) 3834/    150F : 16 00               		dw 16h
(2) 3835/    1511 : 15 00               		dw 15h
(2) 3836/    1513 : 13 00               		dw 13h
(2) 3837/    1515 : 12 00               		dw 12h
(2) 3838/    1517 : 11 00               		dw 11h
(2) 3839/    1519 : 10 00                		dw 10h
(2) 3840/    151B : 09 00                		dw 9h
(2) 3841/    151D : 08 00                		dw 8h
(2) 3842/    151F : 00 00               		dw 0
(2) 3843/    1521 :                     
(2) 3844/    1521 :                     ; TODO: some of these freqs need checking
(2) 3845/    1521 : 00 01               wavFreq_List:	dw 100h		; C-0
(2) 3846/    1523 : 00 01               		dw 100h
(2) 3847/    1525 : 00 01               		dw 100h
(2) 3848/    1527 : 00 01               		dw 100h
(2) 3849/    1529 : 00 01               		dw 100h
(2) 3850/    152B : 00 01               		dw 100h
(2) 3851/    152D : 00 01               		dw 100h
(2) 3852/    152F : 00 01               		dw 100h
(2) 3853/    1531 : 00 01               		dw 100h
(2) 3854/    1533 : 00 01               		dw 100h
(2) 3855/    1535 : 00 01               		dw 100h
(2) 3856/    1537 : 00 01               		dw 100h
(2) 3857/    1539 : 00 01               		dw 100h		; C-1
(2) 3858/    153B : 00 01               		dw 100h
(2) 3859/    153D : 00 01               		dw 100h
(2) 3860/    153F : 00 01               		dw 100h
(2) 3861/    1541 : 00 01               		dw 100h
(2) 3862/    1543 : 00 01               		dw 100h
(2) 3863/    1545 : 00 01               		dw 100h
(2) 3864/    1547 : 00 01               		dw 100h
(2) 3865/    1549 : 00 01               		dw 100h
(2) 3866/    154B : 00 01               		dw 100h
(2) 3867/    154D : 00 01               		dw 100h
(2) 3868/    154F : 00 01               		dw 100h
(2) 3869/    1551 : 00 01               		dw 100h		; C-2
(2) 3870/    1553 : 00 01               		dw 100h
(2) 3871/    1555 : 00 01               		dw 100h
(2) 3872/    1557 : 00 01               		dw 100h
(2) 3873/    1559 : 00 01               		dw 100h
(2) 3874/    155B : 00 01               		dw 100h
(2) 3875/    155D : 00 01               		dw 100h
(2) 3876/    155F : 00 01               		dw 100h
(2) 3877/    1561 : 00 01               		dw 100h
(2) 3878/    1563 : 00 01               		dw 100h
(2) 3879/    1565 : 36 00               		dw 036h
(2) 3880/    1567 : 3B 00               		dw 03Bh
(2) 3881/    1569 : 3E 00               		dw 03Eh		; C-3 5512
(2) 3882/    156B : 43 00               		dw 043h		; C#3
(2) 3883/    156D : 46 00               		dw 046h		; D-3
(2) 3884/    156F : 49 00               		dw 049h		; D#3
(2) 3885/    1571 : 4E 00               		dw 04Eh		; E-3
(2) 3886/    1573 : 54 00               		dw 054h		; F-3
(2) 3887/    1575 : 58 00               		dw 058h		; F#3
(2) 3888/    1577 : 5E 00               		dw 05Eh		; G-3 8363 -17
(2) 3889/    1579 : 63 00               		dw 063h		; G#3
(2) 3890/    157B : 68 00               		dw 068h		; A-3
(2) 3891/    157D : 70 00               		dw 070h		; A#3
(2) 3892/    157F : 75 00               		dw 075h		; B-3
(2) 3893/    1581 : 85 00               		dw 085h		; C-4 11025 -12
(2) 3894/    1583 : 87 00               		dw 087h		; C#4
(2) 3895/    1585 : 8C 00               		dw 08Ch		; D-4
(2) 3896/    1587 : 9A 00               		dw 09Ah		; D#4
(2) 3897/    1589 : 9E 00               		dw 09Eh		; E-4
(2) 3898/    158B : AD 00               		dw 0ADh		; F-4
(2) 3899/    158D : B2 00               		dw 0B2h		; F#4
(2) 3900/    158F : C0 00               		dw 0C0h		; G-4
(2) 3901/    1591 : CC 00               		dw 0CCh		; G#4
(2) 3902/    1593 : D7 00               		dw 0D7h		; A-4
(2) 3903/    1595 : E6 00               		dw 0E6h		; A#4
(2) 3904/    1597 : F0 00               		dw 0F0h		; B-4
(2) 3905/    1599 : 00 01               		dw 100h		; C-5 22050
(2) 3906/    159B : 10 01               		dw 110h		; C#5
(2) 3907/    159D : 20 01               		dw 120h		; D-5
(2) 3908/    159F : 2E 01               		dw 12Eh		; D#5
(2) 3909/    15A1 : 42 01               		dw 142h		; E-5
(2) 3910/    15A3 : 5A 01               		dw 15Ah		; F-5
(2) 3911/    15A5 : 6A 01               		dw 16Ah		; F#5 32000 +6
(2) 3912/    15A7 : 7F 01               		dw 17Fh		; G-5
(2) 3913/    15A9 : 91 01               		dw 191h		; G#5
(2) 3914/    15AB : AC 01               		dw 1ACh		; A-5
(2) 3915/    15AD : C2 01               		dw 1C2h		; A#5
(2) 3916/    15AF : E0 01               		dw 1E0h		; B-5
(2) 3917/    15B1 : F8 01               		dw 1F8h		; C-6 44100 +12
(2) 3918/    15B3 : 10 02               		dw 210h		; C#6
(2) 3919/    15B5 : 40 02               		dw 240h		; D-6
(2) 3920/    15B7 : 60 02               		dw 260h		; D#6
(2) 3921/    15B9 : 80 02               		dw 280h		; E-6
(2) 3922/    15BB : A0 02               		dw 2A0h		; F-6
(2) 3923/    15BD : D0 02               		dw 2D0h		; F#6
(2) 3924/    15BF : F8 02               		dw 2F8h		; G-6
(2) 3925/    15C1 : 20 03               		dw 320h		; G#6
(2) 3926/    15C3 : 50 03               		dw 350h		; A-6
(2) 3927/    15C5 : 80 03               		dw 380h		; A#6
(2) 3928/    15C7 : C0 03               		dw 3C0h		; B-6
(2) 3929/    15C9 : 00 04               		dw 400h		; C-7 88200
(2) 3930/    15CB : 00 01               		dw 100h
(2) 3931/    15CD : 00 01               		dw 100h
(2) 3932/    15CF : 00 01               		dw 100h
(2) 3933/    15D1 : 00 01               		dw 100h
(2) 3934/    15D3 : 00 01               		dw 100h
(2) 3935/    15D5 : 00 01               		dw 100h
(2) 3936/    15D7 : 00 01               		dw 100h
(2) 3937/    15D9 : 00 01               		dw 100h
(2) 3938/    15DB : 00 01               		dw 100h
(2) 3939/    15DD : 00 01               		dw 100h
(2) 3940/    15DF : 00 01               		dw 100h
(2) 3941/    15E1 : 00 01               		dw 100h		; C-8
(2) 3942/    15E3 : 00 01               		dw 100h
(2) 3943/    15E5 : 00 01               		dw 100h
(2) 3944/    15E7 : 00 01               		dw 100h
(2) 3945/    15E9 : 00 01               		dw 100h
(2) 3946/    15EB : 00 01               		dw 100h
(2) 3947/    15ED : 00 01               		dw 100h
(2) 3948/    15EF : 00 01               		dw 100h
(2) 3949/    15F1 : 00 01               		dw 100h
(2) 3950/    15F3 : 00 01               		dw 100h
(2) 3951/    15F5 : 00 01               		dw 100h
(2) 3952/    15F7 : 00 01               		dw 100h
(2) 3953/    15F9 : 00 01               		dw 100h		; C-9
(2) 3954/    15FB : 00 01               		dw 100h
(2) 3955/    15FD : 00 01               		dw 100h
(2) 3956/    15FF : 00 01               		dw 100h
(2) 3957/    1601 : 00 01               		dw 100h
(2) 3958/    1603 : 00 01               		dw 100h
(2) 3959/    1605 : 00 01               		dw 100h
(2) 3960/    1607 : 00 01               		dw 100h
(2) 3961/    1609 : 00 01               		dw 100h
(2) 3962/    160B : 00 01               		dw 100h
(2) 3963/    160D : 00 01               		dw 100h
(2) 3964/    160F : 00 01               		dw 100h
(2) 3965/    1611 :                     
(2) 3966/    1611 :                     ; --------------------------------------------------------
(2) 3967/    1611 :                     
(2) 3968/    1611 :                     	; PSG psuedo-controls
(2) 3969/    1611 : 00 00 00 00         psgcom		db 00h,00h,00h,00h	;  0 command 1 = key on, 2 = key off, 4 = stop snd
(2) 3970/    1615 : FF FF FF FF         psglev		db -1, -1, -1, -1	;  4 output level attenuation (%llll.0000, -1 = silent)
(2) 3971/    1619 : 00 00 00 00         psgatk		db 00h,00h,00h,00h	;  8 attack rate
(2) 3972/    161D : 00 00 00 00         psgdec		db 00h,00h,00h,00h	; 12 decay rate
(2) 3973/    1621 : 00 00 00 00         psgslv		db 00h,00h,00h,00h	; 16 sustain level attenuation
(2) 3974/    1625 : 00 00 00 00         psgrrt		db 00h,00h,00h,00h	; 20 release rate
(2) 3975/    1629 : 00 00 00 00         psgenv		db 00h,00h,00h,00h	; 24 envelope mode 0 = off, 1 = attack, 2 = decay, 3 = sustain, 4
(2) 3976/    162D : 00 00 00 00         psgdtl		db 00h,00h,00h,00h	; 28 tone bottom 4 bits
(2) 3977/    1631 : 00 00 00 00         psgdth		db 00h,00h,00h,00h	; 32 tone upper 6 bits
(2) 3978/    1635 : 00 00 00 00         psgalv		db 00h,00h,00h,00h	; 36 attack level attenuation
(2) 3979/    1639 : 00 00 00 00         whdflg		db 00h,00h,00h,00h	; 40 flags to indicate hardware should be updated
(2) 3980/    163D : 00 00 00 00         psgtim		db 00h,00h,00h,00h	; 44 timer for sustain
(2) 3981/    1641 : 00 00 00 00         psgvol		db 00h,00h,00h,00h
(2) 3982/    1645 : 00 00 00 00 00 00   fmcom:		db 00h,00h,00h,00h,00h,00h	;  0 - play bits: 2-cut 1-off 0-play
(2) 3983/    164B : 00 00 00 00 00 00   		db 00h,00h,00h,00h,00h,00h	;  6 - keys xxxx0000b
(2) 3984/    1651 : 00 00 00 00 00 00   		db 00h,00h,00h,00h,00h,00h	; 12 - volume (for 40h+)
(2) 3985/    1657 : 00 00 00 00 00 00   		db 00h,00h,00h,00h,00h,00h	; 18 - panning (%LR000000)
(2) 3986/    165D : 00 00 00 00 00 00   		db 00h,00h,00h,00h,00h,00h	; 24 - A4h+ (MSB FIRST)
(2) 3987/    1663 : 00 00 00 00 00 00   		db 00h,00h,00h,00h,00h,00h	; 30 - A0h+
(2) 3988/    1669 :                     fmins_com:	ds 028h			; Current instrument data for each FM
(2) 3989/    1691 :                     fmins_com2:	ds 028h
(2) 3990/    16B9 :                     fmins_com3:	ds 028h
(2) 3991/    16E1 :                     fmins_com4:	ds 028h
(2) 3992/    1709 :                     fmins_com5:	ds 028h
(2) 3993/    1731 :                     fmins_com6:	ds 028h
(2) 3994/    1759 : 00 AC 00 A8         fm3reg:		dw 0AC00h,0A800h	; S3-S1, S4 is at A6/A2
(2) 3995/    175D : 00 AD 00 A9         		dw 0AD00h,0A900h
(2) 3996/    1761 : 00 AE 00 AA         		dw 0AE00h,0AA00h
(2) 3997/    1765 : 00                  daccom:		db 0			; single byte for key on, off and cut
(2) 3998/    1766 :                     
(2) 3999/    1766 :                     ; ====================================================================
(2) 4000/    1766 :                     ; ----------------------------------------------------------------
(2) 4001/    1766 :                     ; Z80 RAM
(2) 4002/    1766 :                     ; ----------------------------------------------------------------
(2) 4003/    1766 :                     
(2) 4004/    1766 :                     trkBuff_0	ds 20h+(MAX_TRKCHN*8)	;  *** TRACK BUFFER 0, 100h aligned ****
(2) 4005/    180E :                     trkBuff_1	ds 20h+(MAX_TRKCHN*8)	;  *** TRACK BUFFER 1, 100h aligned ****
(2) 4006/    18B6 :                     
(2) 4007/    18B6 :                     insDataC_0	ds 8*16		; Instrument data for each Track slot
(2) 4008/    1936 :                     insDataC_1	ds 8*16		; 8*MAX_INS
(2) 4009/    19B6 : 00 00               currInsData	dw 0
(2) 4010/    19B8 : 00 00               currTblPos	dw 0
(2) 4011/    19BA : 00 00               currInsPos	dw 0
(2) 4012/    19BC : 00 00               currTrkCtrl	dw 0
(2) 4013/    19BE : 00 00               tickFlag	dw 0		; Tick flag from VBlank, Read as (tickFlag+1) for reading/reseting
(2) 4014/    19C0 : 00                  tickCnt		db 0		; Tick counter (PUT THIS TAG AFTER tickFlag)
(2) 4015/    19C1 : 00 00               wave_Start	dw 0		; START: 68k 24-bit pointer
(2) 4016/    19C3 : 00                  		db 0
(2) 4017/    19C4 : 00 00               wave_Len	dw 0		; LENGTH 24-bit
(2) 4018/    19C6 : 00                  		db 0
(2) 4019/    19C7 : 00 00               wave_Loop	dw 0		; LOOP POINT 24-bit (MUST BE BELOW wave_Len)
(2) 4020/    19C9 : 00                  		db 0
(2) 4021/    19CA : 00 01               wave_Pitch	dw 0100h	; 01.00h
(2) 4022/    19CC : 00                  wave_Flags	db 0		; WAVE playback flags (%10x: 1 loop / 0 no loop)
(2) 4023/    19CD :                     
(2) 4024/    19CD :                     	; Channel tables: 10h bytes
(2) 4025/    19CD :                     	; 0  - Link addr (0000h = free, used chnls start from +0020h)
(2) 4026/    19CD :                     	; 2  - Channel index (ID is set extrenally)
(2) 4027/    19CD :                     	; 3  - Pitch
(2) 4028/    19CD :                     	; 4+ - Channel specific...
(2) 4029/    19CD :                     
(2) 4030/    19CD :                     	; PSG (80h+)
(2) 4031/    19CD :                     	;  4 - psgNoise mode
(2) 4032/    19CD : 00 00 00 00 00 00   tblPSG:		db 00h,00h,00h,00h,00h,00h,00h,00h	; Channel 1
                    00 00 
(2) 4033/    19D5 : 00 00 01 00 00 00   		db 00h,00h,01h,00h,00h,00h,00h,00h	; Channel 2
                    00 00 
(2) 4034/    19DD : 00 00 02 00 00 00   		db 00h,00h,02h,00h,00h,00h,00h,00h	; Channel 3
                    00 00 
(2) 4035/    19E5 : FF FF               		dw -1	; end-of-list
(2) 4036/    19E7 : 00 00 03 00 00 00   tblPSGN:	db 00h,00h,03h,00h,00h,00h,00h,00h	; Noise (DIRECT CHECK only)
                    00 00 
(2) 4037/    19EF :                     
(2) 4038/    19EF :                     	; FM: 90h+ FM3: 0A0h DAC: 0B0h
(2) 4039/    19EF :                     	;  4 - Special mode (FM3: Special, FM6: DAC)
(2) 4040/    19EF :                     	;  5 - 24-bit copy of ROM instrument pointer
(2) 4041/    19EF : 00 00 00 00 00 00   tblFM:		db 00h,00h,00h,00h,00h,00h,00h,00h	; Channel 1
                    00 00 
(2) 4042/    19F7 : 00 00 01 00 00 00   		db 00h,00h,01h,00h,00h,00h,00h,00h	; Channel 2
                    00 00 
(2) 4043/    19FF : 00 00 03 00 00 00   		db 00h,00h,03h,00h,00h,00h,00h,00h	; Channel 4
                    00 00 
(2) 4044/    1A07 : 00 00 04 00 00 00   		db 00h,00h,04h,00h,00h,00h,00h,00h	; Channel 5
                    00 00 
(2) 4045/    1A0F : 00 00 02 00 00 00   tblFM3:		db 00h,00h,02h,00h,00h,00h,00h,00h	; Channel 3
                    00 00 
(2) 4046/    1A17 : 00 00 05 00 00 00   tblFM6:		db 00h,00h,05h,00h,00h,00h,00h,00h	; Channel 6
                    00 00 
(2) 4047/    1A1F : FF FF               		dw -1	; end-of-list
(2) 4048/    1A21 :                     
(2) 4049/    1A21 : 00 00 00 00 00 00   tblPWM:		db 00h,00h,00h,00h,00h,00h,00h,00h	; Channel 1
                    00 00 
(2) 4050/    1A29 : 00 00 01 00 00 00   		db 00h,00h,01h,00h,00h,00h,00h,00h	; Channel 2
                    00 00 
(2) 4051/    1A31 : 00 00 02 00 00 00   		db 00h,00h,02h,00h,00h,00h,00h,00h	; Channel 3
                    00 00 
(2) 4052/    1A39 : 00 00 03 00 00 00   		db 00h,00h,03h,00h,00h,00h,00h,00h	; Channel 4
                    00 00 
(2) 4053/    1A41 : 00 00 04 00 00 00   		db 00h,00h,04h,00h,00h,00h,00h,00h	; Channel 5
                    00 00 
(2) 4054/    1A49 : 00 00 05 00 00 00   		db 00h,00h,05h,00h,00h,00h,00h,00h	; Channel 6
                    00 00 
(2) 4055/    1A51 : 00 00 06 00 00 00   		db 00h,00h,06h,00h,00h,00h,00h,00h	; Channel 7
                    00 00 
(2) 4056/    1A59 : FF FF               		dw -1
(2) 4057/    1A5B :                     
(2) 4058/    1A5B :                     	; Format:
(2) 4059/    1A5B :                     	; %00VP0CFO
(2) 4060/    1A5B :                     	; $vp
(2) 4061/    1A5B :                     	; $pp
(2) 4062/    1A5B :                     	; $fi + flags
(2) 4063/    1A5B :                     	; $ii
(2) 4064/    1A5B :                     	; $ii
(2) 4065/    1A5B :                     	; $ii
(2) 4066/    1A5B :                     ; 	 align 8
(2) 4067/    1A5B : 00 00 00 00 00 00   pwmcom:		db 00h,00h,00h,00h,00h,00h,00h,00h	; Playback bits: KeyOn/KeyOff/KeyCut/other update bits
                    00 00 
(2) 4068/    1A63 : 00 00 00 00 00 00   		db 00h,00h,00h,00h,00h,00h,00h,00h	; Volume | Pitch MSB
                    00 00 
(2) 4069/    1A6B : 00 00 00 00 00 00   		db 00h,00h,00h,00h,00h,00h,00h,00h	; Pitch LSB
                    00 00 
(2) 4070/    1A73 : 00 00 00 00 00 00   		db 00h,00h,00h,00h,00h,00h,00h,00h	; Playback flags: Loop/Stereo/Left/Right | 32-bit
                    00 00 
(2) 4071/    1A7B : 00 00 00 00 00 00   		db 00h,00h,00h,00h,00h,00h,00h,00h	; sample location
                    00 00 
(2) 4072/    1A83 : 00 00 00 00 00 00   		db 00h,00h,00h,00h,00h,00h,00h,00h
                    00 00 
(2) 4073/    1A8B : 00 00 00 00 00 00   		db 00h,00h,00h,00h,00h,00h,00h,00h
                    00 00 
(2) 4074/    1A93 :                     
(2) 4075/    1A93 : (MACRO)             		org 1C00h
(2) 4075/    1A93 : 00                                                  db 0
(2) 4075/    1A94 : 00                                                  db 0
(2) 4075/    1A95 : 00                                                  db 0
(2) 4075/    1A96 : 00                                                  db 0
(2) 4075/    1A97 : 00                                                  db 0
(2) 4075/    1A98 : 00                                                  db 0
(2) 4075/    1A99 : 00                                                  db 0
(2) 4075/    1A9A : 00                                                  db 0
(2) 4075/    1A9B : 00                                                  db 0
(2) 4075/    1A9C : 00                                                  db 0
(2) 4075/    1A9D : 00                                                  db 0
(2) 4075/    1A9E : 00                                                  db 0
(2) 4075/    1A9F : 00                                                  db 0
(2) 4075/    1AA0 : 00                                                  db 0
(2) 4075/    1AA1 : 00                                                  db 0
(2) 4075/    1AA2 : 00                                                  db 0
(2) 4075/    1AA3 : 00                                                  db 0
(2) 4075/    1AA4 : 00                                                  db 0
(2) 4075/    1AA5 : 00                                                  db 0
(2) 4075/    1AA6 : 00                                                  db 0
(2) 4075/    1AA7 : 00                                                  db 0
(2) 4075/    1AA8 : 00                                                  db 0
(2) 4075/    1AA9 : 00                                                  db 0
(2) 4075/    1AAA : 00                                                  db 0
(2) 4075/    1AAB : 00                                                  db 0
(2) 4075/    1AAC : 00                                                  db 0
(2) 4075/    1AAD : 00                                                  db 0
(2) 4075/    1AAE : 00                                                  db 0
(2) 4075/    1AAF : 00                                                  db 0
(2) 4075/    1AB0 : 00                                                  db 0
(2) 4075/    1AB1 : 00                                                  db 0
(2) 4075/    1AB2 : 00                                                  db 0
(2) 4075/    1AB3 : 00                                                  db 0
(2) 4075/    1AB4 : 00                                                  db 0
(2) 4075/    1AB5 : 00                                                  db 0
(2) 4075/    1AB6 : 00                                                  db 0
(2) 4075/    1AB7 : 00                                                  db 0
(2) 4075/    1AB8 : 00                                                  db 0
(2) 4075/    1AB9 : 00                                                  db 0
(2) 4075/    1ABA : 00                                                  db 0
(2) 4075/    1ABB : 00                                                  db 0
(2) 4075/    1ABC : 00                                                  db 0
(2) 4075/    1ABD : 00                                                  db 0
(2) 4075/    1ABE : 00                                                  db 0
(2) 4075/    1ABF : 00                                                  db 0
(2) 4075/    1AC0 : 00                                                  db 0
(2) 4075/    1AC1 : 00                                                  db 0
(2) 4075/    1AC2 : 00                                                  db 0
(2) 4075/    1AC3 : 00                                                  db 0
(2) 4075/    1AC4 : 00                                                  db 0
(2) 4075/    1AC5 : 00                                                  db 0
(2) 4075/    1AC6 : 00                                                  db 0
(2) 4075/    1AC7 : 00                                                  db 0
(2) 4075/    1AC8 : 00                                                  db 0
(2) 4075/    1AC9 : 00                                                  db 0
(2) 4075/    1ACA : 00                                                  db 0
(2) 4075/    1ACB : 00                                                  db 0
(2) 4075/    1ACC : 00                                                  db 0
(2) 4075/    1ACD : 00                                                  db 0
(2) 4075/    1ACE : 00                                                  db 0
(2) 4075/    1ACF : 00                                                  db 0
(2) 4075/    1AD0 : 00                                                  db 0
(2) 4075/    1AD1 : 00                                                  db 0
(2) 4075/    1AD2 : 00                                                  db 0
(2) 4075/    1AD3 : 00                                                  db 0
(2) 4075/    1AD4 : 00                                                  db 0
(2) 4075/    1AD5 : 00                                                  db 0
(2) 4075/    1AD6 : 00                                                  db 0
(2) 4075/    1AD7 : 00                                                  db 0
(2) 4075/    1AD8 : 00                                                  db 0
(2) 4075/    1AD9 : 00                                                  db 0
(2) 4075/    1ADA : 00                                                  db 0
(2) 4075/    1ADB : 00                                                  db 0
(2) 4075/    1ADC : 00                                                  db 0
(2) 4075/    1ADD : 00                                                  db 0
(2) 4075/    1ADE : 00                                                  db 0
(2) 4075/    1ADF : 00                                                  db 0
(2) 4075/    1AE0 : 00                                                  db 0
(2) 4075/    1AE1 : 00                                                  db 0
(2) 4075/    1AE2 : 00                                                  db 0
(2) 4075/    1AE3 : 00                                                  db 0
(2) 4075/    1AE4 : 00                                                  db 0
(2) 4075/    1AE5 : 00                                                  db 0
(2) 4075/    1AE6 : 00                                                  db 0
(2) 4075/    1AE7 : 00                                                  db 0
(2) 4075/    1AE8 : 00                                                  db 0
(2) 4075/    1AE9 : 00                                                  db 0
(2) 4075/    1AEA : 00                                                  db 0
(2) 4075/    1AEB : 00                                                  db 0
(2) 4075/    1AEC : 00                                                  db 0
(2) 4075/    1AED : 00                                                  db 0
(2) 4075/    1AEE : 00                                                  db 0
(2) 4075/    1AEF : 00                                                  db 0
(2) 4075/    1AF0 : 00                                                  db 0
(2) 4075/    1AF1 : 00                                                  db 0
(2) 4075/    1AF2 : 00                                                  db 0
(2) 4075/    1AF3 : 00                                                  db 0
(2) 4075/    1AF4 : 00                                                  db 0
(2) 4075/    1AF5 : 00                                                  db 0
(2) 4075/    1AF6 : 00                                                  db 0
(2) 4075/    1AF7 : 00                                                  db 0
(2) 4075/    1AF8 : 00                                                  db 0
(2) 4075/    1AF9 : 00                                                  db 0
(2) 4075/    1AFA : 00                                                  db 0
(2) 4075/    1AFB : 00                                                  db 0
(2) 4075/    1AFC : 00                                                  db 0
(2) 4075/    1AFD : 00                                                  db 0
(2) 4075/    1AFE : 00                                                  db 0
(2) 4075/    1AFF : 00                                                  db 0
(2) 4075/    1B00 : 00                                                  db 0
(2) 4075/    1B01 : 00                                                  db 0
(2) 4075/    1B02 : 00                                                  db 0
(2) 4075/    1B03 : 00                                                  db 0
(2) 4075/    1B04 : 00                                                  db 0
(2) 4075/    1B05 : 00                                                  db 0
(2) 4075/    1B06 : 00                                                  db 0
(2) 4075/    1B07 : 00                                                  db 0
(2) 4075/    1B08 : 00                                                  db 0
(2) 4075/    1B09 : 00                                                  db 0
(2) 4075/    1B0A : 00                                                  db 0
(2) 4075/    1B0B : 00                                                  db 0
(2) 4075/    1B0C : 00                                                  db 0
(2) 4075/    1B0D : 00                                                  db 0
(2) 4075/    1B0E : 00                                                  db 0
(2) 4075/    1B0F : 00                                                  db 0
(2) 4075/    1B10 : 00                                                  db 0
(2) 4075/    1B11 : 00                                                  db 0
(2) 4075/    1B12 : 00                                                  db 0
(2) 4075/    1B13 : 00                                                  db 0
(2) 4075/    1B14 : 00                                                  db 0
(2) 4075/    1B15 : 00                                                  db 0
(2) 4075/    1B16 : 00                                                  db 0
(2) 4075/    1B17 : 00                                                  db 0
(2) 4075/    1B18 : 00                                                  db 0
(2) 4075/    1B19 : 00                                                  db 0
(2) 4075/    1B1A : 00                                                  db 0
(2) 4075/    1B1B : 00                                                  db 0
(2) 4075/    1B1C : 00                                                  db 0
(2) 4075/    1B1D : 00                                                  db 0
(2) 4075/    1B1E : 00                                                  db 0
(2) 4075/    1B1F : 00                                                  db 0
(2) 4075/    1B20 : 00                                                  db 0
(2) 4075/    1B21 : 00                                                  db 0
(2) 4075/    1B22 : 00                                                  db 0
(2) 4075/    1B23 : 00                                                  db 0
(2) 4075/    1B24 : 00                                                  db 0
(2) 4075/    1B25 : 00                                                  db 0
(2) 4075/    1B26 : 00                                                  db 0
(2) 4075/    1B27 : 00                                                  db 0
(2) 4075/    1B28 : 00                                                  db 0
(2) 4075/    1B29 : 00                                                  db 0
(2) 4075/    1B2A : 00                                                  db 0
(2) 4075/    1B2B : 00                                                  db 0
(2) 4075/    1B2C : 00                                                  db 0
(2) 4075/    1B2D : 00                                                  db 0
(2) 4075/    1B2E : 00                                                  db 0
(2) 4075/    1B2F : 00                                                  db 0
(2) 4075/    1B30 : 00                                                  db 0
(2) 4075/    1B31 : 00                                                  db 0
(2) 4075/    1B32 : 00                                                  db 0
(2) 4075/    1B33 : 00                                                  db 0
(2) 4075/    1B34 : 00                                                  db 0
(2) 4075/    1B35 : 00                                                  db 0
(2) 4075/    1B36 : 00                                                  db 0
(2) 4075/    1B37 : 00                                                  db 0
(2) 4075/    1B38 : 00                                                  db 0
(2) 4075/    1B39 : 00                                                  db 0
(2) 4075/    1B3A : 00                                                  db 0
(2) 4075/    1B3B : 00                                                  db 0
(2) 4075/    1B3C : 00                                                  db 0
(2) 4075/    1B3D : 00                                                  db 0
(2) 4075/    1B3E : 00                                                  db 0
(2) 4075/    1B3F : 00                                                  db 0
(2) 4075/    1B40 : 00                                                  db 0
(2) 4075/    1B41 : 00                                                  db 0
(2) 4075/    1B42 : 00                                                  db 0
(2) 4075/    1B43 : 00                                                  db 0
(2) 4075/    1B44 : 00                                                  db 0
(2) 4075/    1B45 : 00                                                  db 0
(2) 4075/    1B46 : 00                                                  db 0
(2) 4075/    1B47 : 00                                                  db 0
(2) 4075/    1B48 : 00                                                  db 0
(2) 4075/    1B49 : 00                                                  db 0
(2) 4075/    1B4A : 00                                                  db 0
(2) 4075/    1B4B : 00                                                  db 0
(2) 4075/    1B4C : 00                                                  db 0
(2) 4075/    1B4D : 00                                                  db 0
(2) 4075/    1B4E : 00                                                  db 0
(2) 4075/    1B4F : 00                                                  db 0
(2) 4075/    1B50 : 00                                                  db 0
(2) 4075/    1B51 : 00                                                  db 0
(2) 4075/    1B52 : 00                                                  db 0
(2) 4075/    1B53 : 00                                                  db 0
(2) 4075/    1B54 : 00                                                  db 0
(2) 4075/    1B55 : 00                                                  db 0
(2) 4075/    1B56 : 00                                                  db 0
(2) 4075/    1B57 : 00                                                  db 0
(2) 4075/    1B58 : 00                                                  db 0
(2) 4075/    1B59 : 00                                                  db 0
(2) 4075/    1B5A : 00                                                  db 0
(2) 4075/    1B5B : 00                                                  db 0
(2) 4075/    1B5C : 00                                                  db 0
(2) 4075/    1B5D : 00                                                  db 0
(2) 4075/    1B5E : 00                                                  db 0
(2) 4075/    1B5F : 00                                                  db 0
(2) 4075/    1B60 : 00                                                  db 0
(2) 4075/    1B61 : 00                                                  db 0
(2) 4075/    1B62 : 00                                                  db 0
(2) 4075/    1B63 : 00                                                  db 0
(2) 4075/    1B64 : 00                                                  db 0
(2) 4075/    1B65 : 00                                                  db 0
(2) 4075/    1B66 : 00                                                  db 0
(2) 4075/    1B67 : 00                                                  db 0
(2) 4075/    1B68 : 00                                                  db 0
(2) 4075/    1B69 : 00                                                  db 0
(2) 4075/    1B6A : 00                                                  db 0
(2) 4075/    1B6B : 00                                                  db 0
(2) 4075/    1B6C : 00                                                  db 0
(2) 4075/    1B6D : 00                                                  db 0
(2) 4075/    1B6E : 00                                                  db 0
(2) 4075/    1B6F : 00                                                  db 0
(2) 4075/    1B70 : 00                                                  db 0
(2) 4075/    1B71 : 00                                                  db 0
(2) 4075/    1B72 : 00                                                  db 0
(2) 4075/    1B73 : 00                                                  db 0
(2) 4075/    1B74 : 00                                                  db 0
(2) 4075/    1B75 : 00                                                  db 0
(2) 4075/    1B76 : 00                                                  db 0
(2) 4075/    1B77 : 00                                                  db 0
(2) 4075/    1B78 : 00                                                  db 0
(2) 4075/    1B79 : 00                                                  db 0
(2) 4075/    1B7A : 00                                                  db 0
(2) 4075/    1B7B : 00                                                  db 0
(2) 4075/    1B7C : 00                                                  db 0
(2) 4075/    1B7D : 00                                                  db 0
(2) 4075/    1B7E : 00                                                  db 0
(2) 4075/    1B7F : 00                                                  db 0
(2) 4075/    1B80 : 00                                                  db 0
(2) 4075/    1B81 : 00                                                  db 0
(2) 4075/    1B82 : 00                                                  db 0
(2) 4075/    1B83 : 00                                                  db 0
(2) 4075/    1B84 : 00                                                  db 0
(2) 4075/    1B85 : 00                                                  db 0
(2) 4075/    1B86 : 00                                                  db 0
(2) 4075/    1B87 : 00                                                  db 0
(2) 4075/    1B88 : 00                                                  db 0
(2) 4075/    1B89 : 00                                                  db 0
(2) 4075/    1B8A : 00                                                  db 0
(2) 4075/    1B8B : 00                                                  db 0
(2) 4075/    1B8C : 00                                                  db 0
(2) 4075/    1B8D : 00                                                  db 0
(2) 4075/    1B8E : 00                                                  db 0
(2) 4075/    1B8F : 00                                                  db 0
(2) 4075/    1B90 : 00                                                  db 0
(2) 4075/    1B91 : 00                                                  db 0
(2) 4075/    1B92 : 00                                                  db 0
(2) 4075/    1B93 : 00                                                  db 0
(2) 4075/    1B94 : 00                                                  db 0
(2) 4075/    1B95 : 00                                                  db 0
(2) 4075/    1B96 : 00                                                  db 0
(2) 4075/    1B97 : 00                                                  db 0
(2) 4075/    1B98 : 00                                                  db 0
(2) 4075/    1B99 : 00                                                  db 0
(2) 4075/    1B9A : 00                                                  db 0
(2) 4075/    1B9B : 00                                                  db 0
(2) 4075/    1B9C : 00                                                  db 0
(2) 4075/    1B9D : 00                                                  db 0
(2) 4075/    1B9E : 00                                                  db 0
(2) 4075/    1B9F : 00                                                  db 0
(2) 4075/    1BA0 : 00                                                  db 0
(2) 4075/    1BA1 : 00                                                  db 0
(2) 4075/    1BA2 : 00                                                  db 0
(2) 4075/    1BA3 : 00                                                  db 0
(2) 4075/    1BA4 : 00                                                  db 0
(2) 4075/    1BA5 : 00                                                  db 0
(2) 4075/    1BA6 : 00                                                  db 0
(2) 4075/    1BA7 : 00                                                  db 0
(2) 4075/    1BA8 : 00                                                  db 0
(2) 4075/    1BA9 : 00                                                  db 0
(2) 4075/    1BAA : 00                                                  db 0
(2) 4075/    1BAB : 00                                                  db 0
(2) 4075/    1BAC : 00                                                  db 0
(2) 4075/    1BAD : 00                                                  db 0
(2) 4075/    1BAE : 00                                                  db 0
(2) 4075/    1BAF : 00                                                  db 0
(2) 4075/    1BB0 : 00                                                  db 0
(2) 4075/    1BB1 : 00                                                  db 0
(2) 4075/    1BB2 : 00                                                  db 0
(2) 4075/    1BB3 : 00                                                  db 0
(2) 4075/    1BB4 : 00                                                  db 0
(2) 4075/    1BB5 : 00                                                  db 0
(2) 4075/    1BB6 : 00                                                  db 0
(2) 4075/    1BB7 : 00                                                  db 0
(2) 4075/    1BB8 : 00                                                  db 0
(2) 4075/    1BB9 : 00                                                  db 0
(2) 4075/    1BBA : 00                                                  db 0
(2) 4075/    1BBB : 00                                                  db 0
(2) 4075/    1BBC : 00                                                  db 0
(2) 4075/    1BBD : 00                                                  db 0
(2) 4075/    1BBE : 00                                                  db 0
(2) 4075/    1BBF : 00                                                  db 0
(2) 4075/    1BC0 : 00                                                  db 0
(2) 4075/    1BC1 : 00                                                  db 0
(2) 4075/    1BC2 : 00                                                  db 0
(2) 4075/    1BC3 : 00                                                  db 0
(2) 4075/    1BC4 : 00                                                  db 0
(2) 4075/    1BC5 : 00                                                  db 0
(2) 4075/    1BC6 : 00                                                  db 0
(2) 4075/    1BC7 : 00                                                  db 0
(2) 4075/    1BC8 : 00                                                  db 0
(2) 4075/    1BC9 : 00                                                  db 0
(2) 4075/    1BCA : 00                                                  db 0
(2) 4075/    1BCB : 00                                                  db 0
(2) 4075/    1BCC : 00                                                  db 0
(2) 4075/    1BCD : 00                                                  db 0
(2) 4075/    1BCE : 00                                                  db 0
(2) 4075/    1BCF : 00                                                  db 0
(2) 4075/    1BD0 : 00                                                  db 0
(2) 4075/    1BD1 : 00                                                  db 0
(2) 4075/    1BD2 : 00                                                  db 0
(2) 4075/    1BD3 : 00                                                  db 0
(2) 4075/    1BD4 : 00                                                  db 0
(2) 4075/    1BD5 : 00                                                  db 0
(2) 4075/    1BD6 : 00                                                  db 0
(2) 4075/    1BD7 : 00                                                  db 0
(2) 4075/    1BD8 : 00                                                  db 0
(2) 4075/    1BD9 : 00                                                  db 0
(2) 4075/    1BDA : 00                                                  db 0
(2) 4075/    1BDB : 00                                                  db 0
(2) 4075/    1BDC : 00                                                  db 0
(2) 4075/    1BDD : 00                                                  db 0
(2) 4075/    1BDE : 00                                                  db 0
(2) 4075/    1BDF : 00                                                  db 0
(2) 4075/    1BE0 : 00                                                  db 0
(2) 4075/    1BE1 : 00                                                  db 0
(2) 4075/    1BE2 : 00                                                  db 0
(2) 4075/    1BE3 : 00                                                  db 0
(2) 4075/    1BE4 : 00                                                  db 0
(2) 4075/    1BE5 : 00                                                  db 0
(2) 4075/    1BE6 : 00                                                  db 0
(2) 4075/    1BE7 : 00                                                  db 0
(2) 4075/    1BE8 : 00                                                  db 0
(2) 4075/    1BE9 : 00                                                  db 0
(2) 4075/    1BEA : 00                                                  db 0
(2) 4075/    1BEB : 00                                                  db 0
(2) 4075/    1BEC : 00                                                  db 0
(2) 4075/    1BED : 00                                                  db 0
(2) 4075/    1BEE : 00                                                  db 0
(2) 4075/    1BEF : 00                                                  db 0
(2) 4075/    1BF0 : 00                                                  db 0
(2) 4075/    1BF1 : 00                                                  db 0
(2) 4075/    1BF2 : 00                                                  db 0
(2) 4075/    1BF3 : 00                                                  db 0
(2) 4075/    1BF4 : 00                                                  db 0
(2) 4075/    1BF5 : 00                                                  db 0
(2) 4075/    1BF6 : 00                                                  db 0
(2) 4075/    1BF7 : 00                                                  db 0
(2) 4075/    1BF8 : 00                                                  db 0
(2) 4075/    1BF9 : 00                                                  db 0
(2) 4075/    1BFA : 00                                                  db 0
(2) 4075/    1BFB : 00                                                  db 0
(2) 4075/    1BFC : 00                                                  db 0
(2) 4075/    1BFD : 00                                                  db 0
(2) 4075/    1BFE : 00                                                  db 0
(2) 4075/    1BFF : 00                                                  db 0
(2) 4075/    1C00 :                     
(2) 4076/    1C00 :                     dWaveBuff	ds 100h			; WAVE data buffer: 100h bytes, updates every 80h
(2) 4077/    1D00 :                     trkData_0	ds 100h			; Track note-cache buffers: 100h bytes, updates every 80h
(2) 4078/    1E00 :                     trkData_1	ds 100h
(2) 4079/    1F00 :                     commZfifo	ds 40h			; Buffer for command requests from 68k (40h bytes, loops)
(2) 4080/    1F40 : 00 00 00            dDacPntr	db 0,0,0		; WAVE play current ROM position
(2) 4081/    1F43 : 00 00 00            dDacCntr	db 0,0,0		; WAVE play length counter
(2) 4082/    1F46 : 00                  dDacFifoMid	db 0			; WAVE play halfway refill flag (00h/80h)
(2) 4083/    1F47 : 00                  psgHatMode	db 0
(2) 4084/    1F48 : 00                  fmSpcMode	db 0
(2) 4085/    1F49 :                     trkHdOut	ds 6			; temporal Header for reading Track position/row count
(2) 4086/    1F4F :                     
(2) 4087/    1F4F :                     ; Stack area
(2) 4088/    1F4F :                     
(1)  319/    1F4F :                     		cpu 68000
(1)  320/    1F4F :                     		padding off
(1)  321/  882B2F :                     		phase Z80_CODE+*
(1)  322/  882B2F :                     Z80_CODE_END:
(1)  323/  882B2F :                     		align 2
(1)  324/  882B30 :                     
(1)  325/  882B30 :                     
(1)  326/  882B30 :                     
      29/  882B30 :                     		include	"system/md/video.asm"
(1)    1/  882B30 :                     ; ====================================================================
(1)    2/  882B30 :                     ; ----------------------------------------------------------------
(1)    3/  882B30 :                     ; MD Video
(1)    4/  882B30 :                     ; ----------------------------------------------------------------
(1)    5/  882B30 :                     
(1)    6/  882B30 :                     ; ------------------------------------------------
(1)    7/  882B30 :                     ; vdp_ctrl READ bits
(1)    8/  882B30 :                     ; ------------------------------------------------
(1)    9/  882B30 :                     
(1)   10/  882B30 : =$2                 bitHint		equ 2
(1)   11/  882B30 : =$3                 bitVint		equ 3
(1)   12/  882B30 : =$1                 bitDma		equ 1
(1)   13/  882B30 :                     
(1)   14/  882B30 :                     ; ------------------------------------------------
(1)   15/  882B30 :                     ; VDP register variables
(1)   16/  882B30 :                     ; ------------------------------------------------
(1)   17/  882B30 :                     
(1)   18/  882B30 :                     ; Register $80
(1)   19/  882B30 : =$2                 HVStop		equ $02
(1)   20/  882B30 : =$10                HintEnbl	equ $10
(1)   21/  882B30 : =$1                 bitHVStop	equ 1
(1)   22/  882B30 : =$4                 bitHintEnbl	equ 4
(1)   23/  882B30 :                     
(1)   24/  882B30 :                     ; Register $81
(1)   25/  882B30 : =$40                DispEnbl 	equ $40
(1)   26/  882B30 : =$20                VintEnbl 	equ $20
(1)   27/  882B30 : =$10                DmaEnbl		equ $10
(1)   28/  882B30 : =$6                 bitDispEnbl	equ 6
(1)   29/  882B30 : =$5                 bitVintEnbl	equ 5
(1)   30/  882B30 : =$4                 bitDmaEnbl	equ 4
(1)   31/  882B30 : =$3                 bitV30		equ 3
(1)   32/  882B30 :                     
(1)   33/  882B30 :                     ; --------------------------------------------------------
(1)   34/  882B30 :                     ; Init Video
(1)   35/  882B30 :                     ; 
(1)   36/  882B30 :                     ; Uses:
(1)   37/  882B30 :                     ; a0-a2,d0-d1
(1)   38/  882B30 :                     ; --------------------------------------------------------
(1)   39/  882B30 :                     
(1)   40/  882B30 :                     Video_Init:		
(1)   41/  882B30 : 4DF8 9820           		lea	(RAM_MdVideo),a6	; Clear RAM
(1)   42/  882B34 : 7C00                		moveq	#0,d6
(1)   43/  882B36 : 3E3C 0E01           		move.w	#(sizeof_mdvid-RAM_MdVideo)-1,d7
(1)   44/  882B3A :                     .clrram:
(1)   45/  882B3A : 1CC6                		move.b	d6,(a6)+
(1)   46/  882B3C : 51CF FFFC           		dbf	d7,.clrram
(1)   47/  882B40 : 4DFA 07EA           		lea	list_vdpregs(pc),a6	; Init registers
(1)   48/  882B44 : 4BF8 A60A           		lea	(RAM_VdpRegs).w,a5
(1)   49/  882B48 : 49F9 00C0 0004      		lea	(vdp_ctrl),a4
(1)   50/  882B4E : 3C3C 8000           		move.w	#$8000,d6
(1)   51/  882B52 : 3E3C 0012           		move.w	#19-1,d7
(1)   52/  882B56 :                     .loop:
(1)   53/  882B56 : 1C1E                		move.b	(a6)+,d6
(1)   54/  882B58 : 1AC6                		move.b	d6,(a5)+
(1)   55/  882B5A : 3886                		move.w	d6,(a4)
(1)   56/  882B5C : DC7C 0100           		add.w	#$100,d6
(1)   57/  882B60 : 51CF FFF4           		dbf	d7,.loop
(1)   58/  882B64 :                     .exit:
(1)   59/  882B64 : 7000                		moveq	#0,d0
(1)   60/  882B66 : 6100 0604           		bsr	Video_MarsSetGfx
(1)   61/  882B6A :                     
(1)   62/  882B6A :                     	; DMA RV bit safe code
(1)   63/  882B6A :                     	; TODO: solo copiarme el write final en
(1)   64/  882B6A :                     	; vez de todo el codigo.
(1)   65/  882B6A : 43F9 0088 3360      		lea	(dmacode_start),a1
(1)   66/  882B70 : 41F9 FFFF A862      		lea	(RAM_DmaCode).l,a0
(1)   67/  882B76 : 303C 0049           		move.w	#((dmacode_end-dmacode_start)/4)-1,d0
(1)   68/  882B7A :                     .copysafe:
(1)   69/  882B7A : 20D9                		move.l	(a1)+,(a0)+
(1)   70/  882B7C : 51C8 FFFC           		dbf	d0,.copysafe
(1)   71/  882B80 : 4E75                		rts
(1)   72/  882B82 :                     
(1)   73/  882B82 :                     ; ====================================================================
(1)   74/  882B82 :                     ; ----------------------------------------------------------------
(1)   75/  882B82 :                     ; Video subroutines
(1)   76/  882B82 :                     ; ----------------------------------------------------------------
(1)   77/  882B82 :                     
(1)   78/  882B82 :                     ; --------------------------------------------------------
(1)   79/  882B82 :                     ; Video_Clear
(1)   80/  882B82 :                     ; 
(1)   81/  882B82 :                     ; Clear all video data from VRAM
(1)   82/  882B82 :                     ; --------------------------------------------------------
(1)   83/  882B82 :                     
(1)   84/  882B82 :                     Video_Clear:
(1)   85/  882B82 : 303C 0000           		move.w	#0,d0			; Clears until $57F
(1)   86/  882B86 : 323C 0000           		move.w	#0,d1
(1)   87/  882B8A : 343C AFE0           		move.w	#$57F*$20,d2
(1)   88/  882B8E : 6100 0464           		bsr	Video_Fill
(1)   89/  882B92 :                     
(1)   90/  882B92 :                     Video_ClearScreen:
(1)   91/  882B92 : 343C 0FFF           		move.w	#$FFF,d2		; FG/BG size
(1)   92/  882B96 : 1239 FFFF A60C      		move.b	(RAM_VdpRegs+2).l,d1	; FG
(1)   93/  882B9C : 0241 0038           		andi.w	#%111000,d1
(1)   94/  882BA0 : E149                		lsl.w	#8,d1
(1)   95/  882BA2 : E549                		lsl.w	#2,d1
(1)   96/  882BA4 : 6100 044E           		bsr	Video_Fill
(1)   97/  882BA8 : 1239 FFFF A60D      		move.b	(RAM_VdpRegs+3).l,d1	; BG
(1)   98/  882BAE : 0241 0007           		andi.w	#%000111,d1
(1)   99/  882BB2 : E149                		lsl.w	#8,d1
(1)  100/  882BB4 : EB49                		lsl.w	#5,d1
(1)  101/  882BB6 : 6100 043C           		bsr	Video_Fill
(1)  102/  882BBA : 343C 0FFF           		move.w	#$FFF,d2		; WD Size
(1)  103/  882BBE : 1239 FFFF A60E      		move.b	(RAM_VdpRegs+4).l,d1	; Window
(1)  104/  882BC4 : 0241 003E           		andi.w	#%111110,d1
(1)  105/  882BC8 : E149                		lsl.w	#8,d1
(1)  106/  882BCA : E549                		lsl.w	#2,d1
(1)  107/  882BCC : 6100 0426           		bsr	Video_Fill
(1)  108/  882BD0 :                     
(1)  109/  882BD0 : 41F8 9820           		lea	(RAM_HorScroll),a0
(1)  110/  882BD4 : 3E3C 00EF           		move.w	#240-1,d7
(1)  111/  882BD8 : 7000                		moveq	#0,d0
(1)  112/  882BDA :                     .xnext:
(1)  113/  882BDA : 20C0                		move.l	d0,(a0)+
(1)  114/  882BDC : 51CF FFFC           		dbf	d7,.xnext
(1)  115/  882BE0 : 41F8 9BE0           		lea	(RAM_VerScroll),a0
(1)  116/  882BE4 : 3E3C 0013           		move.w	#(320/16)-1,d7
(1)  117/  882BE8 : 7000                		moveq	#0,d0
(1)  118/  882BEA :                     .ynext:
(1)  119/  882BEA : 20C0                		move.l	d0,(a0)+
(1)  120/  882BEC : 51CF FFFC           		dbf	d7,.ynext
(1)  121/  882BF0 : 4E75                		rts
(1)  122/  882BF2 :                     
(1)  123/  882BF2 :                     ; --------------------------------------------------------
(1)  124/  882BF2 :                     ; Video_Update
(1)  125/  882BF2 :                     ; 
(1)  126/  882BF2 :                     ; Writes register data stored in RAM to VDP
(1)  127/  882BF2 :                     ; from Registers $80 to $90
(1)  128/  882BF2 :                     ; 
(1)  129/  882BF2 :                     ; Uses:
(1)  130/  882BF2 :                     ; d6-d7,a5-a6
(1)  131/  882BF2 :                     ; --------------------------------------------------------
(1)  132/  882BF2 :                     
(1)  133/  882BF2 :                     Video_Update:
(1)  134/  882BF2 : 4DF8 A60A           		lea	(RAM_VdpRegs).w,a6
(1)  135/  882BF6 : 4BF9 00C0 0004      		lea	(vdp_ctrl),a5
(1)  136/  882BFC : 3C3C 8000           		move.w	#$8000,d6
(1)  137/  882C00 : 3E3C 0010           		move.w	#17-1,d7
(1)  138/  882C04 :                     .loop:
(1)  139/  882C04 : 1C1E                		move.b	(a6)+,d6
(1)  140/  882C06 : 3A86                		move.w	d6,(a5)
(1)  141/  882C08 : DC7C 0100           		add.w	#$100,d6
(1)  142/  882C0C : 51CF FFF6           		dbf	d7,.loop
(1)  143/  882C10 :                     .exit:
(1)  144/  882C10 : 4E75                		rts
(1)  145/  882C12 :                     		
(1)  146/  882C12 :                     ; --------------------------------------------------------
(1)  147/  882C12 :                     ; Video_WaitFade
(1)  148/  882C12 :                     ;
(1)  149/  882C12 :                     ; Wait until fade request turn 0
(1)  150/  882C12 :                     ;
(1)  151/  882C12 :                     ; Returns:
(1)  152/  882C12 :                     ; bne - Still active
(1)  153/  882C12 :                     ; beq - Finished
(1)  154/  882C12 :                     ; --------------------------------------------------------
(1)  155/  882C12 :                     
(1)  156/  882C12 :                     Video_RunFade:
(1)  157/  882C12 : 613E                		bsr	Video_PalFade
(1)  158/  882C14 : 6100 05C4           		bsr	Video_MarsPalFade
(1)  159/  882C18 :                     Video_WaitFade:
(1)  160/  882C18 : 3E38 A5FE           		move.w	(RAM_FadeMarsReq),d7
(1)  161/  882C1C : 3C38 A5F6           		move.w	(RAM_FadeMdReq),d6
(1)  162/  882C20 : 8E46                		or.w	d6,d7
(1)  163/  882C22 : 4E75                		rts
(1)  164/  882C24 :                     
(1)  165/  882C24 :                     ; --------------------------------------------------------
(1)  166/  882C24 :                     ; Video_LoadPal
(1)  167/  882C24 :                     ; 
(1)  168/  882C24 :                     ; Input:
(1)  169/  882C24 :                     ; a0 - Palette data
(1)  170/  882C24 :                     ; d0 - Start position
(1)  171/  882C24 :                     ; d1 - Number of colors
(1)  172/  882C24 :                     ; 
(1)  173/  882C24 :                     ; Uses:
(1)  174/  882C24 :                     ; d5-d7,a6
(1)  175/  882C24 :                     ; --------------------------------------------------------
(1)  176/  882C24 :                     
(1)  177/  882C24 :                     Video_FadePal:
(1)  178/  882C24 : 4DF8 A310           		lea	(RAM_PaletteFd),a6
(1)  179/  882C28 : 4278 A5FC           		clr.w	(RAM_FadeMdTmr).w
(1)  180/  882C2C : 6004                		bra.s	vidMd_Pal
(1)  181/  882C2E :                     Video_LoadPal:
(1)  182/  882C2E : 4DF8 A090           		lea	(RAM_Palette),a6
(1)  183/  882C32 :                     vidMd_Pal:
(1)  184/  882C32 : 2A48                		move.l	a0,a5
(1)  185/  882C34 : 7E00                		moveq	#0,d7
(1)  186/  882C36 : 3E00                		move.w	d0,d7
(1)  187/  882C38 : DE47                		add.w	d7,d7
(1)  188/  882C3A : DCC7                		adda	d7,a6
(1)  189/  882C3C : 3E01                		move.w	d1,d7
(1)  190/  882C3E : 9E7C 0001           		sub.w	#1,d7
(1)  191/  882C42 : 3C02                		move.w	d2,d6
(1)  192/  882C44 : CC7C 0001           		and.w	#1,d6
(1)  193/  882C48 : E25E                		ror.w	#1,d6
(1)  194/  882C4A :                     .loop:
(1)  195/  882C4A : 3CDD                		move.w	(a5)+,(a6)+
(1)  196/  882C4C : 51CF FFFC           		dbf	d7,.loop
(1)  197/  882C50 : 4E75                		rts
(1)  198/  882C52 :                     
(1)  199/  882C52 :                     ; --------------------------------------------------------
(1)  200/  882C52 :                     ; Video_PalFade
(1)  201/  882C52 :                     ;
(1)  202/  882C52 :                     ; a0 - Palette data
(1)  203/  882C52 :                     ; d0 - Number of colors
(1)  204/  882C52 :                     ; d1 - Speed
(1)  205/  882C52 :                     ;
(1)  206/  882C52 :                     ; RAM_ReqFadeMars: (WORD)
(1)  207/  882C52 :                     ; $00 - No task (or finished)
(1)  208/  882C52 :                     ; $01 - Fade in
(1)  209/  882C52 :                     ; $02 - Fade out to black
(1)  210/  882C52 :                     ;
(1)  211/  882C52 :                     ; CALL THIS ONLY OUTSIDE OF VBLANK
(1)  212/  882C52 :                     ; --------------------------------------------------------
(1)  213/  882C52 :                     
(1)  214/  882C52 :                     Video_PalFade:
(1)  215/  882C52 : 0478 0001 A5FC      		sub.w	#1,(RAM_FadeMdTmr).w
(1)  216/  882C58 : 6A14                		bpl.s	.active
(1)  217/  882C5A : 31F8 A5FA A5FC      		move.w	(RAM_FadeMdDelay).w,(RAM_FadeMdTmr).w
(1)  218/  882C60 : 3E38 A5F6           		move.w	(RAM_FadeMdReq).w,d7
(1)  219/  882C64 : DE47                		add.w	d7,d7
(1)  220/  882C66 : 3E3B 7008           		move.w	.fade_list(pc,d7.w),d7
(1)  221/  882C6A : 4EFB 7004           		jmp	.fade_list(pc,d7.w)
(1)  222/  882C6E :                     .active:
(1)  223/  882C6E : 4E75                		rts
(1)  224/  882C70 :                     
(1)  225/  882C70 :                     ; --------------------------------------------
(1)  226/  882C70 :                     
(1)  227/  882C70 :                     .fade_list:
(1)  228/  882C70 : 0006                		dc.w .fade_done-.fade_list
(1)  229/  882C72 : 0008                		dc.w .fade_in-.fade_list
(1)  230/  882C74 : 00AC                		dc.w .fade_out-.fade_list
(1)  231/  882C76 :                     
(1)  232/  882C76 :                     ; --------------------------------------------
(1)  233/  882C76 :                     ; No fade or finished.
(1)  234/  882C76 :                     ; --------------------------------------------
(1)  235/  882C76 :                     
(1)  236/  882C76 :                     .fade_done:
(1)  237/  882C76 : 4E75                		rts
(1)  238/  882C78 :                     
(1)  239/  882C78 :                     ; --------------------------------------------
(1)  240/  882C78 :                     ; Fade in
(1)  241/  882C78 :                     ; --------------------------------------------
(1)  242/  882C78 :                     
(1)  243/  882C78 :                     .fade_in:
(1)  244/  882C78 : 4DF8 A310           		lea	(RAM_PaletteFd),a6
(1)  245/  882C7C : 4BF8 A090           		lea	(RAM_Palette),a5
(1)  246/  882C80 : 303C 0040           		move.w	#64,d0				; Num of colors
(1)  247/  882C84 : 3238 A5F8           		move.w	(RAM_FadeMdIncr).w,d1		; Speed
(1)  248/  882C88 : D241                		add.w	d1,d1
(1)  249/  882C8A : 3C00                		move.w	d0,d6
(1)  250/  882C8C : 4846                		swap	d6
(1)  251/  882C8E : 907C 0001           		sub.w	#1,d0
(1)  252/  882C92 :                     .nxt_pal:
(1)  253/  882C92 : 4242                		clr.w	d2		; Reset finished colorbits
(1)  254/  882C94 : 3E16                		move.w	(a6),d7		; d7 - Input
(1)  255/  882C96 : 3C15                		move.w	(a5),d6		; d6 - Output
(1)  256/  882C98 : 3607                		move.w	d7,d3		; RED
(1)  257/  882C9A : 3806                		move.w	d6,d4
(1)  258/  882C9C : CC7C 0EE0           		and.w	#%0000111011100000,d6
(1)  259/  882CA0 : C87C 000E           		and.w	#%0000000000001110,d4
(1)  260/  882CA4 : C67C 000E           		and.w	#%0000000000001110,d3
(1)  261/  882CA8 : D841                		add.w	d1,d4
(1)  262/  882CAA : B843                		cmp.w	d3,d4
(1)  263/  882CAC : 6506                		bcs.s	.no_red
(1)  264/  882CAE : 3803                		move.w	d3,d4
(1)  265/  882CB0 : 847C 0001           		or.w	#%001,d2	; RED is ready
(1)  266/  882CB4 :                     .no_red:
(1)  267/  882CB4 : 8C44                		or.w	d4,d6
(1)  268/  882CB6 : E949                		lsl.w	#4,d1
(1)  269/  882CB8 : 3607                		move.w	d7,d3		; GREEN
(1)  270/  882CBA : 3806                		move.w	d6,d4
(1)  271/  882CBC : CC7C 0E0E           		and.w	#%0000111000001110,d6
(1)  272/  882CC0 : C87C 00E0           		and.w	#%0000000011100000,d4
(1)  273/  882CC4 : C67C 00E0           		and.w	#%0000000011100000,d3
(1)  274/  882CC8 : D841                		add.w	d1,d4
(1)  275/  882CCA : B843                		cmp.w	d3,d4
(1)  276/  882CCC : 6506                		bcs.s	.no_grn
(1)  277/  882CCE : 3803                		move.w	d3,d4
(1)  278/  882CD0 : 847C 0002           		or.w	#%010,d2	; GREEN is ready
(1)  279/  882CD4 :                     .no_grn:
(1)  280/  882CD4 : 8C44                		or.w	d4,d6
(1)  281/  882CD6 : E949                		lsl.w	#4,d1
(1)  282/  882CD8 : 3607                		move.w	d7,d3		; BLUE
(1)  283/  882CDA : 3806                		move.w	d6,d4
(1)  284/  882CDC : CC7C 00EE           		and.w	#%0000000011101110,d6
(1)  285/  882CE0 : C87C 0E00           		and.w	#%0000111000000000,d4
(1)  286/  882CE4 : C67C 0E00           		and.w	#%0000111000000000,d3
(1)  287/  882CE8 : D841                		add.w	d1,d4
(1)  288/  882CEA : B843                		cmp.w	d3,d4
(1)  289/  882CEC : 6506                		bcs.s	.no_blu
(1)  290/  882CEE : 3803                		move.w	d3,d4
(1)  291/  882CF0 : 847C 0004           		or.w	#%100,d2	; BLUE is ready
(1)  292/  882CF4 :                     .no_blu:
(1)  293/  882CF4 : 8C44                		or.w	d4,d6
(1)  294/  882CF6 : E049                		lsr.w	#8,d1
(1)  295/  882CF8 : 3AC6                		move.w	d6,(a5)+
(1)  296/  882CFA : DCFC 0002           		adda	#2,a6
(1)  297/  882CFE : B47C 0007           		cmp.w	#%111,d2
(1)  298/  882D02 : 6608                		bne.s	.no_fnsh
(1)  299/  882D04 : 4846                		swap	d6
(1)  300/  882D06 : 9C7C 0001           		sub.w	#1,d6
(1)  301/  882D0A : 4846                		swap	d6
(1)  302/  882D0C :                     .no_fnsh:
(1)  303/  882D0C : 51C8 FF84           		dbf	d0,.nxt_pal
(1)  304/  882D10 : 4846                		swap	d6
(1)  305/  882D12 : 4A46                		tst.w	d6
(1)  306/  882D14 : 6604                		bne.s	.no_move
(1)  307/  882D16 : 4278 A5F6           		clr.w	(RAM_FadeMdReq).w
(1)  308/  882D1A :                     .no_move:
(1)  309/  882D1A : 4E75                		rts
(1)  310/  882D1C :                     
(1)  311/  882D1C :                     ; --------------------------------------------
(1)  312/  882D1C :                     ; Fade out
(1)  313/  882D1C :                     ; --------------------------------------------
(1)  314/  882D1C :                     
(1)  315/  882D1C :                     .fade_out:
(1)  316/  882D1C : 4DF8 A090           		lea	(RAM_Palette),a6
(1)  317/  882D20 : 303C 0040           		move.w	#64,d0				; Num of colors
(1)  318/  882D24 : 3238 A5F8           		move.w	(RAM_FadeMdIncr).w,d1		; Speed
(1)  319/  882D28 : 3C00                		move.w	d0,d6
(1)  320/  882D2A : 4846                		swap	d6
(1)  321/  882D2C : 907C 0001           		sub.w	#1,d0
(1)  322/  882D30 :                     .nxt_pal_o:
(1)  323/  882D30 : 4242                		clr.w	d2			; Reset finished colorbits
(1)  324/  882D32 : 3E16                		move.w	(a6),d7			; d7 - Input
(1)  325/  882D34 : 3C07                		move.w	d7,d6
(1)  326/  882D36 : CE7C 0EE0           		and.w	#%0000111011100000,d7
(1)  327/  882D3A : CC7C 000E           		and.w	#%0000000000001110,d6
(1)  328/  882D3E : 9C41                		sub.w	d1,d6
(1)  329/  882D40 : 6A06                		bpl.s	.no_red_o
(1)  330/  882D42 : 4246                		clr.w	d6
(1)  331/  882D44 : 847C 0001           		or.w	#%001,d2		; RED is ready
(1)  332/  882D48 :                     .no_red_o:
(1)  333/  882D48 : 8E46                		or.w	d6,d7
(1)  334/  882D4A : E949                		lsl.w	#4,d1
(1)  335/  882D4C : 3C07                		move.w	d7,d6
(1)  336/  882D4E : CE7C 0E0E           		and.w	#%0000111000001110,d7
(1)  337/  882D52 : CC7C 00E0           		and.w	#%0000000011100000,d6
(1)  338/  882D56 : 9C41                		sub.w	d1,d6
(1)  339/  882D58 : 6A06                		bpl.s	.no_grn_o
(1)  340/  882D5A : 4246                		clr.w	d6
(1)  341/  882D5C : 847C 0002           		or.w	#%010,d2		; GREEN is ready
(1)  342/  882D60 :                     .no_grn_o:
(1)  343/  882D60 : 8E46                		or.w	d6,d7
(1)  344/  882D62 : E949                		lsl.w	#4,d1
(1)  345/  882D64 : 3C07                		move.w	d7,d6
(1)  346/  882D66 : CE7C 00EE           		and.w	#%0000000011101110,d7
(1)  347/  882D6A : CC7C 0E00           		and.w	#%0000111000000000,d6
(1)  348/  882D6E : 9C41                		sub.w	d1,d6
(1)  349/  882D70 : 6A06                		bpl.s	.no_blu_o
(1)  350/  882D72 : 4246                		clr.w	d6
(1)  351/  882D74 : 847C 0004           		or.w	#%100,d2		; BLUE is ready
(1)  352/  882D78 :                     .no_blu_o:
(1)  353/  882D78 : 8E46                		or.w	d6,d7
(1)  354/  882D7A : E049                		lsr.w	#8,d1
(1)  355/  882D7C : 3CC7                		move.w	d7,(a6)+
(1)  356/  882D7E : B47C 0007           		cmp.w	#%111,d2
(1)  357/  882D82 : 6608                		bne.s	.no_fnsh_o
(1)  358/  882D84 : 4846                		swap	d6
(1)  359/  882D86 : 9C7C 0001           		sub.w	#1,d6
(1)  360/  882D8A : 4846                		swap	d6
(1)  361/  882D8C :                     .no_fnsh_o:
(1)  362/  882D8C : 51C8 FFA2           		dbf	d0,.nxt_pal_o
(1)  363/  882D90 : 4846                		swap	d6
(1)  364/  882D92 : 4A46                		tst.w	d6
(1)  365/  882D94 : 6604                		bne.s	.no_move_o
(1)  366/  882D96 : 4278 A5F6           		clr.w	(RAM_FadeMdReq).w
(1)  367/  882D9A :                     .no_move_o:
(1)  368/  882D9A : 4E75                		rts
(1)  369/  882D9C :                     
(1)  370/  882D9C :                     ; --------------------------------------------------------
(1)  371/  882D9C :                     ; Video_LoadMap
(1)  372/  882D9C :                     ; 
(1)  373/  882D9C :                     ; Load map data, Horizontal order
(1)  374/  882D9C :                     ; 
(1)  375/  882D9C :                     ; a0 - Map data
(1)  376/  882D9C :                     ; d0 | LONG - 00|Layer|X|Y, locate(lyr,x,y)  
(1)  377/  882D9C :                     ; d1 | LONG - Width|Height (in cells),  mapsize(x,y)
(1)  378/  882D9C :                     ; d2 | WORD - VRAM
(1)  379/  882D9C :                     ;
(1)  380/  882D9C :                     ; Can autodetect layer width.
(1)  381/  882D9C :                     ;
(1)  382/  882D9C :                     ; Uses:
(1)  383/  882D9C :                     ; d4-d7,a6
(1)  384/  882D9C :                     ; --------------------------------------------------------
(1)  385/  882D9C :                     
(1)  386/  882D9C :                     Video_LoadMap:
(1)  387/  882D9C : 4DF9 00C0 0000      		lea	(vdp_data),a6
(1)  388/  882DA2 : 6100 01B4           		bsr	vid_PickLayer
(1)  389/  882DA6 : 3A01                		move.w	d1,d5		; Start here
(1)  390/  882DA8 :                     .yloop:
(1)  391/  882DA8 : 4845                		swap	d5
(1)  392/  882DAA : 2D44 0004           		move.l	d4,4(a6)
(1)  393/  882DAE : 2E01                		move.l	d1,d7
(1)  394/  882DB0 : 4847                		swap	d7
(1)  395/  882DB2 :                     .xloop:
(1)  396/  882DB2 : 3A18                		move.w	(a0)+,d5
(1)  397/  882DB4 : BA7C FFFF           		cmp.w	#-1,d5
(1)  398/  882DB8 : 6606                		bne.s	.nonull
(1)  399/  882DBA : 3A3C 07FF           		move.w	#varNullVram,d5
(1)  400/  882DBE : 6002                		bra.s	.cont
(1)  401/  882DC0 :                     .nonull:
(1)  402/  882DC0 : DA42                		add.w	d2,d5
(1)  403/  882DC2 :                     .cont:
(1)  404/  882DC2 : 4847                		swap	d7
(1)  405/  882DC4 : 1E39 FFFF A616      		move.b	(RAM_VdpRegs+$C).l,d7
(1)  406/  882DCA : CE7C 0006           		and.w	#%110,d7
(1)  407/  882DCE : BE7C 0006           		cmp.w	#%110,d7
(1)  408/  882DD2 : 660E                		bne.s	.nodble
(1)  409/  882DD4 : 3E05                		move.w	d5,d7
(1)  410/  882DD6 : E24F                		lsr.w	#1,d7
(1)  411/  882DD8 : CE7C 07FF           		and.w	#$7FF,d7
(1)  412/  882DDC : CA7C F800           		and.w	#$F800,d5
(1)  413/  882DE0 : 8A47                		or.w	d7,d5
(1)  414/  882DE2 :                     .nodble:
(1)  415/  882DE2 : 4847                		swap	d7
(1)  416/  882DE4 : 3C85                		move.w	d5,(a6)
(1)  417/  882DE6 : 51CF FFCA           		dbf	d7,.xloop
(1)  418/  882DEA : D886                		add.l	d6,d4
(1)  419/  882DEC : 4845                		swap	d5
(1)  420/  882DEE : 51CD FFB8           		dbf	d5,.yloop
(1)  421/  882DF2 : 4E75                		rts
(1)  422/  882DF4 :                     
(1)  423/  882DF4 :                     ; ; --------------------------------------------------------
(1)  424/  882DF4 :                     ; ; Video_LoadMap_Vert
(1)  425/  882DF4 :                     ; ;
(1)  426/  882DF4 :                     ; ; Load map data, Vertical order
(1)  427/  882DF4 :                     ; ;
(1)  428/  882DF4 :                     ; ; a0 - Map data
(1)  429/  882DF4 :                     ; ; d0 | LONG - 00|Lyr|X|Y,  locate(lyr,x,y)
(1)  430/  882DF4 :                     ; ; d1 | LONG - Width|Height (cells),  mapsize(x,y)
(1)  431/  882DF4 :                     ; ; d2 | WORD - VRAM
(1)  432/  882DF4 :                     ;
(1)  433/  882DF4 :                     ; ; Uses:
(1)  434/  882DF4 :                     ; ; a4-a5,d4-d7
(1)  435/  882DF4 :                     ; ; --------------------------------------------------------
(1)  436/  882DF4 :                     ;
(1)  437/  882DF4 :                     ; Video_LoadMap_Vert:
(1)  438/  882DF4 :                     ; 		lea	(vdp_data),a4
(1)  439/  882DF4 :                     ; 		bsr	vid_PickLayer
(1)  440/  882DF4 :                     ; 		move.l	d1,d5		; Start here
(1)  441/  882DF4 :                     ; 		swap	d5
(1)  442/  882DF4 :                     ; .xloop:
(1)  443/  882DF4 :                     ; 		swap	d5
(1)  444/  882DF4 :                     ; 		move.l	d4,-(sp)
(1)  445/  882DF4 :                     ; 		move.w	d1,d7
(1)  446/  882DF4 :                     ; 		btst	#2,(RAM_VdpRegs+$C).l
(1)  447/  882DF4 :                     ; 		beq.s	.yloop
(1)  448/  882DF4 :                     ; 		lsr.w	#1,d7
(1)  449/  882DF4 :                     ; .yloop:
(1)  450/  882DF4 :                     ; 		move.l	d4,4(a4)
(1)  451/  882DF4 :                     ; 		move.w	(a0),d5
(1)  452/  882DF4 :                     ; 		cmp.w	#-1,d5
(1)  453/  882DF4 :                     ; 		bne.s	.nonull
(1)  454/  882DF4 :                     ; 		move.w	#varNullVram,d5
(1)  455/  882DF4 :                     ; 		bra.s	.cont
(1)  456/  882DF4 :                     ; .nonull:
(1)  457/  882DF4 :                     ; 		add.w	d2,d5
(1)  458/  882DF4 :                     ; .cont:
(1)  459/  882DF4 :                     ; 		swap	d7
(1)  460/  882DF4 :                     ; 		adda	#2,a0
(1)  461/  882DF4 :                     ; 		btst	#2,(RAM_VdpRegs+$C).l
(1)  462/  882DF4 :                     ; 		beq.s	.nodble
(1)  463/  882DF4 :                     ; 		adda	#2,a0
(1)  464/  882DF4 :                     ; 		move.w	d5,d7
(1)  465/  882DF4 :                     ; 		lsr.w	#1,d7
(1)  466/  882DF4 :                     ; 		and.w	#$7FF,d7
(1)  467/  882DF4 :                     ; 		and.w	#$F800,d5
(1)  468/  882DF4 :                     ; 		or.w	d7,d5
(1)  469/  882DF4 :                     ; .nodble:
(1)  470/  882DF4 :                     ; 		swap	d7
(1)  471/  882DF4 :                     ; 		move.w	d5,(a4)
(1)  472/  882DF4 :                     ; 		add.l	d6,d4
(1)  473/  882DF4 :                     ; 		dbf	d7,.yloop
(1)  474/  882DF4 :                     ; .outdbl:
(1)  475/  882DF4 :                     ; 		move.l	(sp)+,d4
(1)  476/  882DF4 :                     ; 		add.l	#$20000,d4
(1)  477/  882DF4 :                     ; 		swap	d5
(1)  478/  882DF4 :                     ; 		dbf	d5,.xloop
(1)  479/  882DF4 :                     ; 		rts
(1)  480/  882DF4 :                     		
(1)  481/  882DF4 :                     ; ; --------------------------------------------------------
(1)  482/  882DF4 :                     ; ; Video_AutoMap_Vert
(1)  483/  882DF4 :                     ; ;
(1)  484/  882DF4 :                     ; ; Make automatic map, Vertical order
(1)  485/  882DF4 :                     ; ;
(1)  486/  882DF4 :                     ; ; MCD: Use this to make a virtual screen
(1)  487/  882DF4 :                     ; ; for Stamps
(1)  488/  882DF4 :                     ; ;
(1)  489/  882DF4 :                     ; ; d0 | LONG - 00|Lyr|X|Y,  locate(lyr,x,y)
(1)  490/  882DF4 :                     ; ; d1 | LONG - Width|Height (cells),  mapsize(x,y)
(1)  491/  882DF4 :                     ; ; d2 | WORD - VRAM
(1)  492/  882DF4 :                     ;
(1)  493/  882DF4 :                     ; ; Uses:
(1)  494/  882DF4 :                     ; ; a4-a5,d4-d7
(1)  495/  882DF4 :                     ; ; --------------------------------------------------------
(1)  496/  882DF4 :                     ;
(1)  497/  882DF4 :                     ; ; TODO: double interlace
(1)  498/  882DF4 :                     ; Video_AutoMap_Vert:
(1)  499/  882DF4 :                     ; 		lea	(vdp_data),a4
(1)  500/  882DF4 :                     ; 		bsr	vid_PickLayer
(1)  501/  882DF4 :                     ; 		move.w	d2,d7		; Start here
(1)  502/  882DF4 :                     ; 		move.l	d1,d5
(1)  503/  882DF4 :                     ; 		swap	d5
(1)  504/  882DF4 :                     ; .xloop:
(1)  505/  882DF4 :                     ; 		swap	d5
(1)  506/  882DF4 :                     ; 		move.l	d4,-(sp)
(1)  507/  882DF4 :                     ; 		move.w	d1,d5
(1)  508/  882DF4 :                     ; 		btst	#2,(RAM_VdpRegs+$C).l
(1)  509/  882DF4 :                     ; 		beq.s	.yloop
(1)  510/  882DF4 :                     ; 		lsr.w	#1,d5
(1)  511/  882DF4 :                     ; .yloop:
(1)  512/  882DF4 :                     ; 		move.l	d4,4(a4)
(1)  513/  882DF4 :                     ; 		move.w	d7,(a4)
(1)  514/  882DF4 :                     ; 		add.w	#1,d7
(1)  515/  882DF4 :                     ; 		add.l	d6,d4
(1)  516/  882DF4 :                     ; 		dbf	d5,.yloop
(1)  517/  882DF4 :                     ;
(1)  518/  882DF4 :                     ; 		move.l	(sp)+,d4
(1)  519/  882DF4 :                     ; 		add.l	#$20000,d4
(1)  520/  882DF4 :                     ; 		swap	d5
(1)  521/  882DF4 :                     ; 		dbf	d5,.xloop
(1)  522/  882DF4 :                     ; 		rts
(1)  523/  882DF4 :                     
(1)  524/  882DF4 :                     ; --------------------------------------------------------
(1)  525/  882DF4 :                     ; Video_PrintInit
(1)  526/  882DF4 :                     ; 
(1)  527/  882DF4 :                     ; Load palette and font for printing text
(1)  528/  882DF4 :                     ; --------------------------------------------------------
(1)  529/  882DF4 :                     
(1)  530/  882DF4 :                     Video_PrintInit:
(1)  531/  882DF4 : 41FA 054A           		lea	ASCII_PAL(pc),a0
(1)  532/  882DF8 : 7030                		moveq	#$30,d0
(1)  533/  882DFA : 323C 000F           		move.w	#$F,d1
(1)  534/  882DFE : 6100 FE2E           		bsr	Video_LoadPal
(1)  535/  882E02 : 6100 FE20           		bsr	Video_FadePal
(1)  536/  882E06 : 203C 0001 5570      		move.l	#ASCII_FONT,d0
(1)  537/  882E0C : 323C B000           		move.w	#$580*$20,d1
(1)  538/  882E10 : 343C 1000           		move.w	#ASCII_FONT_e-ASCII_FONT,d2
(1)  539/  882E14 : 363C 6580           		move.w	#$580|$6000,d3
(1)  540/  882E18 : 31C3 A5F4           		move.w	d3,(RAM_VidPrntVram).w
(1)  541/  882E1C : 6000 0348           		bra	Video_LoadArt
(1)  542/  882E20 :                     
(1)  543/  882E20 :                     ; --------------------------------------------------------
(1)  544/  882E20 :                     ; Video_Print
(1)  545/  882E20 :                     ;
(1)  546/  882E20 :                     ; Prints string to layer
(1)  547/  882E20 :                     ; requires ASCII font
(1)  548/  882E20 :                     ; 
(1)  549/  882E20 :                     ; a0 - string data + RAM address to peek (optional)
(1)  550/  882E20 :                     ; d0 | LONG - 00|Lyr|X|Y, locate(lyr,x,y)
(1)  551/  882E20 :                     ; 
(1)  552/  882E20 :                     ; Special characters:
(1)  553/  882E20 :                     ; "//b" - Shows BYTE value
(1)  554/  882E20 :                     ; "//w" - Shows WORD value
(1)  555/  882E20 :                     ; "//l" - Shows LONG value
(1)  556/  882E20 :                     ;   $0A - Next line
(1)  557/  882E20 :                     ;   $00 - End of line
(1)  558/  882E20 :                     ;
(1)  559/  882E20 :                     ; After $00, put your RAM addresses in LONGS
(1)  560/  882E20 :                     ; don't forget to put align 2 at the end.
(1)  561/  882E20 :                     ;
(1)  562/  882E20 :                     ; CALL Video_PrintInit ONCE to use this feature.
(1)  563/  882E20 :                     ;
(1)  564/  882E20 :                     ; Uses:
(1)  565/  882E20 :                     ; d4-d7,a4-a6
(1)  566/  882E20 :                     ; --------------------------------------------------------
(1)  567/  882E20 :                     
(1)  568/  882E20 :                     Video_Print:
(1)  569/  882E20 :                     ; 		movem.l	d3-d7,-(sp)
(1)  570/  882E20 :                     ; 		movem.l	a4-a6,-(sp)
(1)  571/  882E20 :                     		
(1)  572/  882E20 : 4DF9 00C0 0000      		lea	(vdp_data),a6
(1)  573/  882E26 : 6100 0130           		bsr	vid_PickLayer
(1)  574/  882E2A : 4BF8 A470           		lea	(RAM_VidPrntList),a5
(1)  575/  882E2E :                     .newjump:
(1)  576/  882E2E : 2D44 0004           		move.l	d4,4(a6)
(1)  577/  882E32 : 2A04                		move.l	d4,d5
(1)  578/  882E34 :                     .loop:
(1)  579/  882E34 : 1E18                		move.b	(a0)+,d7
(1)  580/  882E36 : 6772                		beq	.exit
(1)  581/  882E38 : 0C07 000A           		cmpi.b	#$A,d7			; $A - next line?
(1)  582/  882E3C : 6718                		beq.s	.next
(1)  583/  882E3E : 0C07 005C           		cmpi.b	#$5C,d7			; $27 ("\") special?
(1)  584/  882E42 : 6716                		beq.s	.special
(1)  585/  882E44 : 0247 00FF           		andi.w	#$FF,d7
(1)  586/  882E48 :                     .puttext:
(1)  587/  882E48 : DE78 A5F4           		add.w	(RAM_VidPrntVram).w,d7	; VRAM add
(1)  588/  882E4C : 3C87                		move.w	d7,(a6)
(1)  589/  882E4E : DABC 0002 0000      		add.l	#$20000,d5
(1)  590/  882E54 : 60DE                		bra.s	.loop
(1)  591/  882E56 :                     ; Next line
(1)  592/  882E56 :                     .next:
(1)  593/  882E56 : D886                		add.l	d6,d4
(1)  594/  882E58 : 60D4                		bra.s	.newjump
(1)  595/  882E5A :                     
(1)  596/  882E5A :                     ; Specials
(1)  597/  882E5A :                     .special:
(1)  598/  882E5A : 1E18                		move.b	(a0)+,d7
(1)  599/  882E5C : 0C07 0062           		cmpi.b	#"b",d7
(1)  600/  882E60 : 6712                		beq.s	.isbyte
(1)  601/  882E62 : 0C07 0077           		cmpi.b	#"w",d7
(1)  602/  882E66 : 671E                		beq.s	.isword
(1)  603/  882E68 : 0C07 006C           		cmpi.b	#"l",d7
(1)  604/  882E6C : 672A                		beq.s	.islong
(1)  605/  882E6E : 3E3C 005C           		move.w	#"\\",d7			; nothing to do
(1)  606/  882E72 : 60D4                		bra.s	.puttext
(1)  607/  882E74 :                     		
(1)  608/  882E74 :                     	; TEMPORAL VALUES
(1)  609/  882E74 :                     .isbyte:
(1)  610/  882E74 : 2AC5                		move.l	d5,(a5)+
(1)  611/  882E76 : 3AFC 0001           		move.w	#1,(a5)+
(1)  612/  882E7A : DABC 0004 0000      		add.l	#$40000,d5
(1)  613/  882E80 : 2D45 0004           		move.l	d5,4(a6)
(1)  614/  882E84 : 60AE                		bra	.loop
(1)  615/  882E86 :                     .isword:
(1)  616/  882E86 : 2AC5                		move.l	d5,(a5)+
(1)  617/  882E88 : 3AFC 0002           		move.w	#2,(a5)+
(1)  618/  882E8C : DABC 0008 0000      		add.l	#$80000,d5
(1)  619/  882E92 : 2D45 0004           		move.l	d5,4(a6)
(1)  620/  882E96 : 609C                		bra	.loop
(1)  621/  882E98 :                     .islong:
(1)  622/  882E98 : 2AC5                		move.l	d5,(a5)+
(1)  623/  882E9A : 3AFC 0003           		move.w	#3,(a5)+
(1)  624/  882E9E : DABC 0010 0000      		add.l	#$100000,d5
(1)  625/  882EA4 : 2D45 0004           		move.l	d5,4(a6)
(1)  626/  882EA8 : 608A                		bra	.loop
(1)  627/  882EAA :                     .exit:
(1)  628/  882EAA :                     
(1)  629/  882EAA :                     ; --------------------------------------------------------
(1)  630/  882EAA :                     ; Print values
(1)  631/  882EAA :                     ; 
(1)  632/  882EAA :                     ; vvvv vvvv tttt
(1)  633/  882EAA :                     ; v - vdp pos
(1)  634/  882EAA :                     ; t - value type
(1)  635/  882EAA :                     ; --------------------------------------------------------
(1)  636/  882EAA :                     
(1)  637/  882EAA :                     ; reading byte by byte because longs doens't get
(1)  638/  882EAA :                     ; aligned after $00...
(1)  639/  882EAA :                     
(1)  640/  882EAA : 7800                		moveq	#0,d4
(1)  641/  882EAC : 7A00                		moveq	#0,d5
(1)  642/  882EAE : 7C00                		moveq	#0,d6
(1)  643/  882EB0 : 4BF8 A470           		lea	(RAM_VidPrntList),a5
(1)  644/  882EB4 :                     .nextv:
(1)  645/  882EB4 : 4A95                		tst.l	(a5)
(1)  646/  882EB6 : 6700 009E           		beq	.nothing
(1)  647/  882EBA :                     	; grab value
(1)  648/  882EBA : 7800                		moveq	#0,d4
(1)  649/  882EBC : 1818                		move.b	(a0)+,d4
(1)  650/  882EBE : E19C                		rol.l	#8,d4
(1)  651/  882EC0 : 1818                		move.b	(a0)+,d4
(1)  652/  882EC2 : E19C                		rol.l	#8,d4
(1)  653/  882EC4 : 1818                		move.b	(a0)+,d4
(1)  654/  882EC6 : E19C                		rol.l	#8,d4
(1)  655/  882EC8 : 1818                		move.b	(a0)+,d4
(1)  656/  882ECA : 2844                		movea.l	d4,a4
(1)  657/  882ECC : 7800                		moveq	#0,d4
(1)  658/  882ECE :                     
(1)  659/  882ECE :                     	; get value
(1)  660/  882ECE : 3C2D 0004           		move.w	4(a5),d6
(1)  661/  882ED2 : BC7C 0001           		cmp.w	#1,d6		; byte?
(1)  662/  882ED6 : 660E                		bne.s	.vbyte
(1)  663/  882ED8 : 1814                		move.b	(a4),d4
(1)  664/  882EDA : 2D55 0004           		move.l	(a5),4(a6)
(1)  665/  882EDE : E91C                		rol.b	#4,d4
(1)  666/  882EE0 : 6158                		bsr.s	.donibl
(1)  667/  882EE2 : E91C                		rol.b	#4,d4
(1)  668/  882EE4 : 6154                		bsr.s	.donibl
(1)  669/  882EE6 :                     .vbyte:
(1)  670/  882EE6 : BC7C 0002           		cmp.w	#2,d6		; word?
(1)  671/  882EEA : 661C                		bne.s	.vword
(1)  672/  882EEC : 1814                		move.b	(a4),d4
(1)  673/  882EEE : E15C                		rol.w	#8,d4
(1)  674/  882EF0 : 182C 0001           		move.b	1(a4),d4
(1)  675/  882EF4 : 2D55 0004           		move.l	(a5),4(a6)
(1)  676/  882EF8 : E95C                		rol.w	#4,d4
(1)  677/  882EFA : 613E                		bsr.s	.donibl
(1)  678/  882EFC : E95C                		rol.w	#4,d4
(1)  679/  882EFE : 613A                		bsr.s	.donibl
(1)  680/  882F00 : E95C                		rol.w	#4,d4
(1)  681/  882F02 : 6136                		bsr.s	.donibl
(1)  682/  882F04 : E95C                		rol.w	#4,d4
(1)  683/  882F06 : 6132                		bsr.s	.donibl
(1)  684/  882F08 :                     .vword:
(1)  685/  882F08 : BC7C 0003           		cmp.w	#3,d6		; long?
(1)  686/  882F0C : 6624                		bne.s	.vlong
(1)  687/  882F0E : 1814                		move.b	(a4),d4
(1)  688/  882F10 : E19C                		rol.l	#8,d4
(1)  689/  882F12 : 182C 0001           		move.b	1(a4),d4
(1)  690/  882F16 : E19C                		rol.l	#8,d4
(1)  691/  882F18 : 182C 0002           		move.b	2(a4),d4
(1)  692/  882F1C : E19C                		rol.l	#8,d4
(1)  693/  882F1E : 182C 0003           		move.b	3(a4),d4
(1)  694/  882F22 : 2D55 0004           		move.l	(a5),4(a6)
(1)  695/  882F26 : 3C3C 0007           		move.w	#7,d6
(1)  696/  882F2A : E99C                .lngloop:	rol.l	#4,d4
(1)  697/  882F2C : 610C                		bsr.s	.donibl
(1)  698/  882F2E : 51CE FFFA           		dbf	d6,.lngloop
(1)  699/  882F32 :                     .vlong:
(1)  700/  882F32 : 429D                		clr.l	(a5)+
(1)  701/  882F34 : 425D                		clr.w	(a5)+
(1)  702/  882F36 : 6000 FF7C           		bra	.nextv
(1)  703/  882F3A :                     
(1)  704/  882F3A :                     ; make nibble byte
(1)  705/  882F3A :                     .donibl:
(1)  706/  882F3A : 3A04                		move.w	d4,d5
(1)  707/  882F3C : 0245 000F           		andi.w	#%1111,d5
(1)  708/  882F40 : BA3C 000A           		cmp.b	#$A,d5
(1)  709/  882F44 : 6D04                		blt.s	.lowr
(1)  710/  882F46 : DA3C 0007           		add.b	#7,d5
(1)  711/  882F4A :                     .lowr:
(1)  712/  882F4A : DA7C 0030           		add.w	#"0",d5
(1)  713/  882F4E : DA78 A5F4           		add.w	(RAM_VidPrntVram),d5
(1)  714/  882F52 : 3C85                		move.w	d5,(a6)
(1)  715/  882F54 : 4E75                		rts
(1)  716/  882F56 :                     ; exit
(1)  717/  882F56 :                     .nothing:
(1)  718/  882F56 :                     ; 		movem.l	(sp)+,a4-a6
(1)  719/  882F56 :                     ; 		movem.l	(sp)+,d3-d7
(1)  720/  882F56 : 4E75                		rts
(1)  721/  882F58 :                     
(1)  722/  882F58 :                     ; --------------------------------------------------------
(1)  723/  882F58 :                     ; Shared: pick layer / x pos / y pos and set size
(1)  724/  882F58 :                     ; --------------------------------------------------------
(1)  725/  882F58 :                     
(1)  726/  882F58 :                     vid_PickLayer:
(1)  727/  882F58 : 2C00                		move.l	d0,d6			; Pick layer
(1)  728/  882F5A : 4846                		swap	d6
(1)  729/  882F5C : 0806 0000           		btst	#0,d6
(1)  730/  882F60 : 671E                		beq.s	.plawnd
(1)  731/  882F62 : 1839 FFFF A60E      		move.b	(RAM_VdpRegs+4).l,d4	; BG
(1)  732/  882F68 : 3A04                		move.w	d4,d5
(1)  733/  882F6A : E24D                		lsr.w	#1,d5
(1)  734/  882F6C : 0245 0003           		andi.w	#%11,d5
(1)  735/  882F70 : 4844                		swap	d4
(1)  736/  882F72 : 3805                		move.w	d5,d4
(1)  737/  882F74 : 4844                		swap	d4
(1)  738/  882F76 : 0244 0001           		andi.w	#1,d4
(1)  739/  882F7A : E14C                		lsl.w	#8,d4
(1)  740/  882F7C : EB4C                		lsl.w	#5,d4
(1)  741/  882F7E : 6028                		bra.s	.golyr
(1)  742/  882F80 :                     .plawnd:
(1)  743/  882F80 : 1839 FFFF A60C      		move.b	(RAM_VdpRegs+2).l,d4	; FG
(1)  744/  882F86 : 0806 0001           		btst	#1,d6
(1)  745/  882F8A : 6706                		beq.s	.nowd
(1)  746/  882F8C : 1839 FFFF A60D      		move.b	(RAM_VdpRegs+3).l,d4	; WINDOW
(1)  747/  882F92 :                     .nowd:		
(1)  748/  882F92 : 3A04                		move.w	d4,d5
(1)  749/  882F94 : E84D                		lsr.w	#4,d5
(1)  750/  882F96 : 0245 0003           		andi.w	#%11,d5
(1)  751/  882F9A : 4844                		swap	d4
(1)  752/  882F9C : 3805                		move.w	d5,d4
(1)  753/  882F9E : 4844                		swap	d4
(1)  754/  882FA0 : 0244 000E           		andi.w	#%00001110,d4
(1)  755/  882FA4 : E14C                		lsl.w	#8,d4
(1)  756/  882FA6 : E54C                		lsl.w	#2,d4
(1)  757/  882FA8 :                     .golyr:
(1)  758/  882FA8 : 0044 4000           		ori.w	#$4000,d4
(1)  759/  882FAC : 3A00                		move.w	d0,d5			; Y start pos
(1)  760/  882FAE : 0245 00FF           		andi.w	#$FF,d5			; Y only
(1)  761/  882FB2 : ED4D                		lsl.w	#6,d5			
(1)  762/  882FB4 : 1C38 A61A           		move.b	(RAM_VdpRegs+$10).w,d6
(1)  763/  882FB8 : 0246 0003           		andi.w	#%11,d6
(1)  764/  882FBC : 670A                		beq.s	.thissz
(1)  765/  882FBE : DA45                		add.w	d5,d5			; H64
(1)  766/  882FC0 : 0246 0002           		andi.w	#%10,d6
(1)  767/  882FC4 : 6702                		beq.s	.thissz
(1)  768/  882FC6 : DA45                		add.w	d5,d5			; H128		
(1)  769/  882FC8 :                     .thissz:
(1)  770/  882FC8 : D845                		add.w	d5,d4
(1)  771/  882FCA : 3A00                		move.w	d0,d5
(1)  772/  882FCC : 0245 FF00           		andi.w	#$FF00,d5		; X only
(1)  773/  882FD0 : EE4D                		lsr.w	#7,d5
(1)  774/  882FD2 : D845                		add.w	d5,d4			; X add
(1)  775/  882FD4 : 4844                		swap	d4
(1)  776/  882FD6 : 7C00                		moveq	#0,d6
(1)  777/  882FD8 : 3C3C 0040           		move.w	#$40,d6			; Set jump size
(1)  778/  882FDC : 1A38 A61A           		move.b	(RAM_VdpRegs+$10).w,d5
(1)  779/  882FE0 : 0245 0003           		andi.w	#%11,d5
(1)  780/  882FE4 : 670A                		beq.s	.thisszj
(1)  781/  882FE6 : DC46                		add.w	d6,d6			; H64
(1)  782/  882FE8 : 0245 0002           		andi.w	#%10,d5
(1)  783/  882FEC : 6702                		beq.s	.thisszj
(1)  784/  882FEE : DC46                		add.w	d6,d6			; H128		
(1)  785/  882FF0 :                     .thisszj:
(1)  786/  882FF0 : 4846                		swap	d6
(1)  787/  882FF2 : 4E75                		rts
(1)  788/  882FF4 :                     		
(1)  789/  882FF4 :                     ; --------------------------------------------------------
(1)  790/  882FF4 :                     ; Video_Fill
(1)  791/  882FF4 :                     ; 
(1)  792/  882FF4 :                     ; Fill data to VRAM
(1)  793/  882FF4 :                     ;
(1)  794/  882FF4 :                     ; d0 | WORD - Bytes to fill
(1)  795/  882FF4 :                     ; d1 | WORD - VRAM position
(1)  796/  882FF4 :                     ; d2 | WORD - Size
(1)  797/  882FF4 :                     ;
(1)  798/  882FF4 :                     ; Uses:
(1)  799/  882FF4 :                     ; d6-d7,a6
(1)  800/  882FF4 :                     ; --------------------------------------------------------
(1)  801/  882FF4 :                     
(1)  802/  882FF4 :                     Video_Fill:
(1)  803/  882FF4 : 4DF9 00C0 0004      		lea	(vdp_ctrl),a6
(1)  804/  882FFA : 3E3C 8100           		move.w	#$8100,d7
(1)  805/  882FFE : 1E38 A60B           		move.b	(RAM_VdpRegs+1),d7
(1)  806/  883002 : 08C7 0004           		bset	#bitDmaEnbl,d7
(1)  807/  883006 : 3C87                		move.w	d7,(a6)
(1)  808/  883008 : 3E16                .dmaw:		move.w	(a6),d7
(1)  809/  88300A : 0807 0001           		btst	#bitDma,d7
(1)  810/  88300E : 66F8                		bne.s	.dmaw
(1)  811/  883010 : 3CBC 8F01           		move.w	#$8F01,(a6)	; Increment $01
(1)  812/  883014 : 3E02                		move.w	d2,d7		; d2 - Size
(1)  813/  883016 : 2C3C 9400 9300      		move.l	#$94009300,d6
(1)  814/  88301C : E24F                		lsr.w	#1,d7
(1)  815/  88301E : 1C07                		move.b	d7,d6
(1)  816/  883020 : 4846                		swap	d6
(1)  817/  883022 : E04F                		lsr.w	#8,d7
(1)  818/  883024 : 1C07                		move.b	d7,d6
(1)  819/  883026 : 4846                		swap	d6
(1)  820/  883028 : 2C86                		move.l	d6,(a6)
(1)  821/  88302A : 3CBC 9780           		move.w	#$9780,(a6)	; DMA Fill mode
(1)  822/  88302E : 3E01                		move.w	d1,d7		; d1 - Destination
(1)  823/  883030 :                     ; 		lsl.w	#5,d7
(1)  824/  883030 : 3C07                		move.w	d7,d6
(1)  825/  883032 : 0246 3FFF           		andi.w	#$3FFF,d6
(1)  826/  883036 : 0046 4000           		ori.w	#$4000,d6
(1)  827/  88303A : 4846                		swap	d6
(1)  828/  88303C : 3C07                		move.w	d7,d6
(1)  829/  88303E : E04E                		lsr.w	#8,d6
(1)  830/  883040 : EC4E                		lsr.w	#6,d6
(1)  831/  883042 : 0246 0003           		andi.w	#%11,d6
(1)  832/  883046 : 0046 0080           		ori.w	#$80,d6
(1)  833/  88304A : 2C86                		move.l	d6,(a6)
(1)  834/  88304C : 3D40 FFFC           		move.w	d0,-4(a6)
(1)  835/  883050 : 3E16                .dmawe:		move.w	(a6),d7
(1)  836/  883052 : 0807 0001           		btst	#bitDma,d7
(1)  837/  883056 : 66F8                		bne.s	.dmawe
(1)  838/  883058 : 3CBC 8F02           		move.w	#$8F02,(a6)	; Increment $02
(1)  839/  88305C : 3E3C 8100           		move.w	#$8100,d7
(1)  840/  883060 : 1E38 A60B           		move.b	(RAM_VdpRegs+1),d7
(1)  841/  883064 : 3C87                		move.w	d7,(a6)
(1)  842/  883066 : 4E75                		rts
(1)  843/  883068 :                     
(1)  844/  883068 :                     ; --------------------------------------------------------
(1)  845/  883068 :                     ; Video_Copy
(1)  846/  883068 :                     ; 
(1)  847/  883068 :                     ; Copy VRAM data to another location
(1)  848/  883068 :                     ;
(1)  849/  883068 :                     ; d0 | WORD - VRAM Source
(1)  850/  883068 :                     ; d1 | WORD - VRAM Destination
(1)  851/  883068 :                     ; d2 | WORD - Size
(1)  852/  883068 :                     ;
(1)  853/  883068 :                     ; Uses:
(1)  854/  883068 :                     ; d6-d7,a6
(1)  855/  883068 :                     ; --------------------------------------------------------
(1)  856/  883068 :                     
(1)  857/  883068 :                     ; TODO: test if this works again...
(1)  858/  883068 :                     
(1)  859/  883068 :                     Video_Copy:
(1)  860/  883068 : 4DF9 00C0 0004      		lea	(vdp_ctrl),a6
(1)  861/  88306E : 3E3C 8100           		move.w	#$8100,d7
(1)  862/  883072 : 1E38 A60B           		move.b	(RAM_VdpRegs+1),d7
(1)  863/  883076 : 08C7 0004           		bset	#bitDmaEnbl,d7
(1)  864/  88307A : 3C87                		move.w	d7,(a6)
(1)  865/  88307C : 3E16                .dmaw:		move.w	(a6),d7
(1)  866/  88307E : 0807 0001           		btst	#bitDma,d7
(1)  867/  883082 : 66F8                		bne.s	.dmaw
(1)  868/  883084 : 3CBC 8F01           		move.w	#$8F01,(a6)		; Increment $01
(1)  869/  883088 : 3E02                		move.w	d2,d7			; SIZE
(1)  870/  88308A : 2C3C 9400 9300      		move.l	#$94009300,d6
(1)  871/  883090 : E24F                		lsr.w	#1,d7
(1)  872/  883092 : 1C07                		move.b	d7,d6
(1)  873/  883094 : 4846                		swap	d6
(1)  874/  883096 : E04F                		lsr.w	#8,d7
(1)  875/  883098 : 1C07                		move.b	d7,d6
(1)  876/  88309A : 4846                		swap	d6
(1)  877/  88309C : 2C86                		move.l	d6,(a6)
(1)  878/  88309E : 2C3C 9600 9500      		move.l	#$96009500,d6		; SOURCE
(1)  879/  8830A4 : 3E00                		move.w	d0,d7
(1)  880/  8830A6 : 1C07                		move.b	d7,d6
(1)  881/  8830A8 : 4846                		swap	d6
(1)  882/  8830AA : E04F                		lsr.w	#8,d7
(1)  883/  8830AC : 1C07                		move.b	d7,d6
(1)  884/  8830AE : 2C86                		move.l	d6,(a6)
(1)  885/  8830B0 : 3CBC 97C0           		move.w	#$97C0,(a6)		; DMA Copy mode
(1)  886/  8830B4 : 2E02                		move.l	d2,d7			; DESTINATION
(1)  887/  8830B6 :                     ; 		lsl.w	#5,d7
(1)  888/  8830B6 : 3C07                		move.w	d7,d6
(1)  889/  8830B8 : 0246 3FFF           		andi.w	#$3FFF,d6
(1)  890/  8830BC : 0046 4000           		ori.w	#$4000,d6
(1)  891/  8830C0 : 4846                		swap	d6
(1)  892/  8830C2 : 3C07                		move.w	d7,d6
(1)  893/  8830C4 : E04E                		lsr.w	#8,d6
(1)  894/  8830C6 : EC4E                		lsr.w	#6,d6
(1)  895/  8830C8 : 0246 0003           		andi.w	#%11,d6
(1)  896/  8830CC : 0046 00C0           		ori.w	#$C0,d6
(1)  897/  8830D0 : 2C86                		move.l	d6,(a6)
(1)  898/  8830D2 : 3D41 FFFC           		move.w	d1,-4(a6)
(1)  899/  8830D6 : 3E16                .dmawe:		move.w	(a6),d7
(1)  900/  8830D8 : 0807 0001           		btst	#bitDma,d7
(1)  901/  8830DC : 66F8                		bne.s	.dmawe
(1)  902/  8830DE : 3CBC 8F02           		move.w	#$8F02,(a6)		; Increment $02
(1)  903/  8830E2 : 3E3C 8100           		move.w	#$8100,d7
(1)  904/  8830E6 : 1E38 A60B           		move.b	(RAM_VdpRegs+1),d7
(1)  905/  8830EA : 3C87                		move.w	d7,(a6)
(1)  906/  8830EC : 4E75                		rts
(1)  907/  8830EE :                     
(1)  908/  8830EE :                     ; ====================================================================
(1)  909/  8830EE :                     ; --------------------------------------------------------
(1)  910/  8830EE :                     ; DMA ROM to VDP Transfer, sets RV=1
(1)  911/  8830EE :                     ; --------------------------------------------------------
(1)  912/  8830EE :                     
(1)  913/  8830EE :                     ; --------------------------------------------------------
(1)  914/  8830EE :                     ; Video_DmaMkEntry
(1)  915/  8830EE :                     ;
(1)  916/  8830EE :                     ; Sets a new DMA transfer task to the Blast list
(1)  917/  8830EE :                     ;
(1)  918/  8830EE :                     ; *** ONLY CALL THIS OUTSIDE OF VBLANK ***
(1)  919/  8830EE :                     ;
(1)  920/  8830EE :                     ; d0 | LONG - Art data
(1)  921/  8830EE :                     ; d1 | WORD - VRAM location
(1)  922/  8830EE :                     ; d2 | WORD - Size
(1)  923/  8830EE :                     ;
(1)  924/  8830EE :                     ; Uses:
(1)  925/  8830EE :                     ; d6-d7,a6
(1)  926/  8830EE :                     ; --------------------------------------------------------
(1)  927/  8830EE :                     
(1)  928/  8830EE :                     Video_DmaMkEntry:
(1)  929/  8830EE : 31FC 0001 A5F2      		move.w	#1,(RAM_VdpDmaMod).w
(1)  930/  8830F4 : 4DF8 A390           		lea	(RAM_VdpDmaList).w,a6
(1)  931/  8830F8 : 3E38 A5F0           		move.w	(RAM_VdpDmaIndx).w,d7
(1)  932/  8830FC : DCC7                		adda	d7,a6
(1)  933/  8830FE : DE7C 000E           		add.w	#7*2,d7
(1)  934/  883102 : 31C7 A5F0           		move.w	d7,(RAM_VdpDmaIndx).w
(1)  935/  883106 : 3E02                		move.w	d2,d7			; Length
(1)  936/  883108 : 2C3C 9400 9300      		move.l	#$94009300,d6
(1)  937/  88310E : E24F                		lsr.w	#1,d7
(1)  938/  883110 : 1C07                		move.b	d7,d6
(1)  939/  883112 : 4846                		swap	d6
(1)  940/  883114 : E04F                		lsr.w	#8,d7
(1)  941/  883116 : 1C07                		move.b	d7,d6
(1)  942/  883118 : 4846                		swap	d6
(1)  943/  88311A : 2CC6                		move.l	d6,(a6)+
(1)  944/  88311C : 2E00                		move.l	d0,d7			; Source
(1)  945/  88311E : E28F                  		lsr.l	#1,d7
(1)  946/  883120 : 2C3C 9600 9500       		move.l	#$96009500,d6
(1)  947/  883126 : 1C07                 		move.b	d7,d6
(1)  948/  883128 : E08F                 		lsr.l	#8,d7
(1)  949/  88312A : 4846                 		swap	d6
(1)  950/  88312C : 1C07                 		move.b	d7,d6
(1)  951/  88312E : 2CC6                 		move.l	d6,(a6)+
(1)  952/  883130 : 3C3C 9700            		move.w	#$9700,d6
(1)  953/  883134 : E08F                 		lsr.l	#8,d7
(1)  954/  883136 : 1C07                 		move.b	d7,d6
(1)  955/  883138 : 3CC6                 		move.w	d6,(a6)+
(1)  956/  88313A : 3E01                		move.w	d1,d7			; Destination
(1)  957/  88313C :                     ; 		and.w	#$7FF,d7
(1)  958/  88313C :                     ; 		lsl.w	#5,d7
(1)  959/  88313C : 3C07                		move.w	d7,d6
(1)  960/  88313E : CEBC 0000 3FE0      		and.l	#$3FE0,d7
(1)  961/  883144 : 0047 4000           		ori.w	#$4000,d7
(1)  962/  883148 : E04E                		lsr.w	#8,d6
(1)  963/  88314A : EC4E                		lsr.w	#6,d6
(1)  964/  88314C : 0246 0003           		andi.w	#%11,d6
(1)  965/  883150 : 0046 0080           		ori.w	#$80,d6
(1)  966/  883154 : 3CC7                		move.w	d7,(a6)+
(1)  967/  883156 : 3CC6                		move.w	d6,(a6)+
(1)  968/  883158 : 31FC 0000 A5F2      		move.w	#0,(RAM_VdpDmaMod).w
(1)  969/  88315E : 4E75                		rts
(1)  970/  883160 :                     
(1)  971/  883160 :                     ; --------------------------------------------------------
(1)  972/  883160 :                     ; Video_DmaBlast
(1)  973/  883160 :                     ;
(1)  974/  883160 :                     ; Process DMA tasks from a predefined list in RAM
(1)  975/  883160 :                     ; **CALL THIS DURING VBLANK ONLY**
(1)  976/  883160 :                     ;
(1)  977/  883160 :                     ; Uses:
(1)  978/  883160 :                     ; d5-d7,a3-a4
(1)  979/  883160 :                     ; --------------------------------------------------------
(1)  980/  883160 :                     
(1)  981/  883160 :                     ; Entry format:
(1)  982/  883160 :                     ; $94xx,$93xx,$96xx,$95xx,$97xx (SIZE,SOURCE)
(1)  983/  883160 :                     ; $40000080 (vdp destination + dma bit)
(1)  984/  883160 :                     
(1)  985/  883160 :                     Video_DmaBlast:
(1)  986/  883160 : 4EF9 FFFF A918      		jmp	(RAMDMA_Blast+RAM_DmaCode).l
(1)  987/  883166 :                     
(1)  988/  883166 :                     ; --------------------------------------------------------
(1)  989/  883166 :                     ; Load graphics using DMA, direct
(1)  990/  883166 :                     ;
(1)  991/  883166 :                     ; d0 | LONG - Art data
(1)  992/  883166 :                     ; d1 | WORD - VRAM location
(1)  993/  883166 :                     ; d2 | WORD - Size
(1)  994/  883166 :                     ;
(1)  995/  883166 :                     ; *** For faster transfers call this during VBlank ***
(1)  996/  883166 :                     ;
(1)  997/  883166 :                     ; Uses:
(1)  998/  883166 :                     ; d5-d7,a4-a6
(1)  999/  883166 :                     ; --------------------------------------------------------
(1) 1000/  883166 :                     
(1) 1001/  883166 :                     Video_LoadArt:
(1) 1002/  883166 : 4EF9 FFFF A862      		jmp	(RAMDMA_Load+RAM_DmaCode).l
(1) 1003/  88316C :                     
(1) 1004/  88316C :                     ; ====================================================================
(1) 1005/  88316C :                     ; ----------------------------------------------------------------
(1) 1006/  88316C :                     ; 32X EXCLUSIVE Video routines
(1) 1007/  88316C :                     ;
(1) 1008/  88316C :                     ; After any use of these routines call System_MdMarsDreq
(1) 1009/  88316C :                     ; to transfer the changes to the 32X side
(1) 1010/  88316C :                     ; ----------------------------------------------------------------
(1) 1011/  88316C :                     
(1) 1012/  88316C :                     ; --------------------------------------------------------
(1) 1013/  88316C :                     ; Video_MarsSetGfx
(1) 1014/  88316C :                     ; Sets graphics mode on the 32X side
(1) 1015/  88316C :                     ;
(1) 1016/  88316C :                     ; Input:
(1) 1017/  88316C :                     ; d0 - Graphics mode
(1) 1018/  88316C :                     ; --------------------------------------------------------
(1) 1019/  88316C :                     
(1) 1020/  88316C :                     Video_MarsSetGfx:
(1) 1021/  88316C : 3C00                		move.w	d0,d6
(1) 1022/  88316E : CC7C 0007           		and.w	#%00000111,d6			; Current limit: 8 modes
(1) 1023/  883172 : 8C7C 0080           		or.w	#$80,d6
(1) 1024/  883176 : 3E39 00A1 512C      		move.w	(sysmars_reg+comm12).l,d7	; Grab current comm12
(1) 1025/  88317C : CE7C FF00           		and.w	#$FF00,d7			; Clear our byte
(1) 1026/  883180 : 8E46                		or.w	d6,d7				; merge changes
(1) 1027/  883182 : 33C7 00A1 512C      		move.w	d7,(sysmars_reg+comm12).l	; Write into it.
(1) 1028/  883188 : 6010                		bra	Video_MarsWait
(1) 1029/  88318A :                     
(1) 1030/  88318A :                     ; --------------------------------------------------------
(1) 1031/  88318A :                     ; Video_MarsRedraw
(1) 1032/  88318A :                     ;
(1) 1033/  88318A :                     ; Call this to redraw the entire screen
(1) 1034/  88318A :                     ; on the 32X side.
(1) 1035/  88318A :                     ; --------------------------------------------------------
(1) 1036/  88318A :                     
(1) 1037/  88318A :                     Video_MarsRedraw:
(1) 1038/  88318A : 3E39 00A1 512C      		move.w	(sysmars_reg+comm12).l,d7
(1) 1039/  883190 : 08C7 0007           		bset	#7,d7
(1) 1040/  883194 : 33C7 00A1 512C      		move.w	d7,(sysmars_reg+comm12).l
(1) 1041/  88319A :                     
(1) 1042/  88319A :                     ; --------------------------------------------------------
(1) 1043/  88319A :                     
(1) 1044/  88319A :                     Video_MarsWait:
(1) 1045/  88319A : 3E39 00A1 512C      		move.w	(sysmars_reg+comm12).l,d7
(1) 1046/  8831A0 : 0807 0007           		btst	#7,d7
(1) 1047/  8831A4 : 66F4                		bne.s	Video_MarsWait
(1) 1048/  8831A6 : 4E75                		rts
(1) 1049/  8831A8 :                     
(1) 1050/  8831A8 :                     ; --------------------------------------------------------
(1) 1051/  8831A8 :                     ; Video_LoadPal_Mars
(1) 1052/  8831A8 :                     ;
(1) 1053/  8831A8 :                     ; Load Indexed palette directly to Buffer
(1) 1054/  8831A8 :                     ;
(1) 1055/  8831A8 :                     ; d0 - Start at
(1) 1056/  8831A8 :                     ; d1 - Number of colors
(1) 1057/  8831A8 :                     ; d2 - Priority bit OFF/ON
(1) 1058/  8831A8 :                     ; --------------------------------------------------------
(1) 1059/  8831A8 :                     
(1) 1060/  8831A8 :                     Video_FadePal_Mars:
(1) 1061/  8831A8 : 4DF8 A110           		lea	(RAM_MdMarsPalFd),a6
(1) 1062/  8831AC : 4278 A604           		clr.w	(RAM_FadeMarsTmr).w
(1) 1063/  8831B0 : 6004                		bra.s	vidMars_Pal
(1) 1064/  8831B2 :                     Video_LoadPal_Mars:
(1) 1065/  8831B2 : 4DF8 AA30           		lea	(RAM_MdDreq+Dreq_Palette).w,a6
(1) 1066/  8831B6 :                     vidMars_Pal:
(1) 1067/  8831B6 : 2A48                		move.l	a0,a5
(1) 1068/  8831B8 : 7E00                		moveq	#0,d7
(1) 1069/  8831BA : 3E00                		move.w	d0,d7
(1) 1070/  8831BC : DE47                		add.w	d7,d7
(1) 1071/  8831BE : DCC7                		adda	d7,a6
(1) 1072/  8831C0 : 3E01                		move.w	d1,d7
(1) 1073/  8831C2 : 9E7C 0001           		sub.w	#1,d7
(1) 1074/  8831C6 : 3C02                		move.w	d2,d6
(1) 1075/  8831C8 : CC7C 0001           		and.w	#1,d6
(1) 1076/  8831CC : E25E                		ror.w	#1,d6
(1) 1077/  8831CE :                     .loop:
(1) 1078/  8831CE : 3A1D                		move.w	(a5)+,d5
(1) 1079/  8831D0 : 8A46                		or.w	d6,d5
(1) 1080/  8831D2 : 3CC5                		move.w	d5,(a6)+
(1) 1081/  8831D4 : 51CF FFF8           		dbf	d7,.loop
(1) 1082/  8831D8 : 4E75                		rts
(1) 1083/  8831DA :                     
(1) 1084/  8831DA :                     ; --------------------------------------------------------
(1) 1085/  8831DA :                     ; Video_MarsPalFade
(1) 1086/  8831DA :                     ;
(1) 1087/  8831DA :                     ; a0 - Palette data
(1) 1088/  8831DA :                     ; d0 - Number of colors
(1) 1089/  8831DA :                     ; d1 - Speed
(1) 1090/  8831DA :                     ;
(1) 1091/  8831DA :                     ; RAM_ReqFadeMars: (WORD)
(1) 1092/  8831DA :                     ; $00 - No task (or finished)
(1) 1093/  8831DA :                     ; $01 - Fade in
(1) 1094/  8831DA :                     ; $02 - Fade out to black
(1) 1095/  8831DA :                     ;
(1) 1096/  8831DA :                     ; CALL THIS OUTSIDE OF VBLANK
(1) 1097/  8831DA :                     ; --------------------------------------------------------
(1) 1098/  8831DA :                     
(1) 1099/  8831DA :                     ; TODO: luego ver que hago con el priority bit
(1) 1100/  8831DA :                     
(1) 1101/  8831DA :                     Video_MarsPalFade:
(1) 1102/  8831DA : 0478 0001 A604      		sub.w	#1,(RAM_FadeMarsTmr).w
(1) 1103/  8831E0 : 6A14                		bpl.s	.active
(1) 1104/  8831E2 : 31F8 A602 A604      		move.w	(RAM_FadeMarsDelay).w,(RAM_FadeMarsTmr).w
(1) 1105/  8831E8 : 3E38 A5FE           		move.w	(RAM_FadeMarsReq).w,d7
(1) 1106/  8831EC : DE47                		add.w	d7,d7
(1) 1107/  8831EE : 3E3B 7008           		move.w	.fade_list(pc,d7.w),d7
(1) 1108/  8831F2 : 4EFB 7004           		jmp	.fade_list(pc,d7.w)
(1) 1109/  8831F6 :                     .active:
(1) 1110/  8831F6 : 4E75                		rts
(1) 1111/  8831F8 :                     
(1) 1112/  8831F8 :                     ; --------------------------------------------
(1) 1113/  8831F8 :                     
(1) 1114/  8831F8 :                     .fade_list:
(1) 1115/  8831F8 : 0006                		dc.w .fade_done-.fade_list
(1) 1116/  8831FA : 0008                		dc.w .fade_in-.fade_list
(1) 1117/  8831FC : 00B2                		dc.w .fade_out-.fade_list
(1) 1118/  8831FE :                     
(1) 1119/  8831FE :                     ; --------------------------------------------
(1) 1120/  8831FE :                     ; No fade or finished.
(1) 1121/  8831FE :                     ; --------------------------------------------
(1) 1122/  8831FE :                     
(1) 1123/  8831FE :                     .fade_done:
(1) 1124/  8831FE : 4E75                		rts
(1) 1125/  883200 :                     
(1) 1126/  883200 :                     ; --------------------------------------------
(1) 1127/  883200 :                     ; Fade in
(1) 1128/  883200 :                     ; --------------------------------------------
(1) 1129/  883200 :                     
(1) 1130/  883200 :                     .fade_in:
(1) 1131/  883200 : 4DF8 A110           		lea	(RAM_MdMarsPalFd),a6
(1) 1132/  883204 : 4BF8 AA30           		lea	(RAM_MdDreq+Dreq_Palette).w,a5
(1) 1133/  883208 : 303C 0100           		move.w	#256,d0				; Num of colors
(1) 1134/  88320C : 3238 A600           		move.w	(RAM_FadeMarsIncr).w,d1		; Speed
(1) 1135/  883210 : 3C00                		move.w	d0,d6
(1) 1136/  883212 : 4846                		swap	d6
(1) 1137/  883214 : 907C 0001           		sub.w	#1,d0
(1) 1138/  883218 :                     .nxt_pal:
(1) 1139/  883218 : 4242                		clr.w	d2		; Reset finished colorbits
(1) 1140/  88321A : 3E16                		move.w	(a6),d7		; d7 - Input
(1) 1141/  88321C : 3C15                		move.w	(a5),d6		; d6 - Output
(1) 1142/  88321E : 3607                		move.w	d7,d3		; RED
(1) 1143/  883220 : 3806                		move.w	d6,d4
(1) 1144/  883222 : CC7C FFE0           		and.w	#%1111111111100000,d6
(1) 1145/  883226 : C87C 001F           		and.w	#%0000000000011111,d4
(1) 1146/  88322A : C67C 001F           		and.w	#%0000000000011111,d3
(1) 1147/  88322E : D841                		add.w	d1,d4
(1) 1148/  883230 : B843                		cmp.w	d3,d4
(1) 1149/  883232 : 6506                		bcs.s	.no_red
(1) 1150/  883234 : 3803                		move.w	d3,d4
(1) 1151/  883236 : 847C 0001           		or.w	#%001,d2	; RED is ready
(1) 1152/  88323A :                     .no_red:
(1) 1153/  88323A : 8C44                		or.w	d4,d6
(1) 1154/  88323C : EB49                		lsl.w	#5,d1
(1) 1155/  88323E : 3607                		move.w	d7,d3		; GREEN
(1) 1156/  883240 : 3806                		move.w	d6,d4
(1) 1157/  883242 : CC7C FC1F           		and.w	#%1111110000011111,d6
(1) 1158/  883246 : C87C 03E0           		and.w	#%0000001111100000,d4
(1) 1159/  88324A : C67C 03E0           		and.w	#%0000001111100000,d3
(1) 1160/  88324E : D841                		add.w	d1,d4
(1) 1161/  883250 : B843                		cmp.w	d3,d4
(1) 1162/  883252 : 6506                		bcs.s	.no_grn
(1) 1163/  883254 : 3803                		move.w	d3,d4
(1) 1164/  883256 : 847C 0002           		or.w	#%010,d2	; GREEN is ready
(1) 1165/  88325A :                     .no_grn:
(1) 1166/  88325A : 8C44                		or.w	d4,d6
(1) 1167/  88325C : EB49                		lsl.w	#5,d1
(1) 1168/  88325E : 3607                		move.w	d7,d3		; BLUE
(1) 1169/  883260 : 3806                		move.w	d6,d4
(1) 1170/  883262 : CC7C 83FF           		and.w	#%1000001111111111,d6
(1) 1171/  883266 : C87C 7C00           		and.w	#%0111110000000000,d4
(1) 1172/  88326A : C67C 7C00           		and.w	#%0111110000000000,d3
(1) 1173/  88326E : D841                		add.w	d1,d4
(1) 1174/  883270 : B843                		cmp.w	d3,d4
(1) 1175/  883272 : 6506                		bcs.s	.no_blu
(1) 1176/  883274 : 3803                		move.w	d3,d4
(1) 1177/  883276 : 847C 0004           		or.w	#%100,d2	; BLUE is ready
(1) 1178/  88327A :                     .no_blu:
(1) 1179/  88327A : 8C44                		or.w	d4,d6
(1) 1180/  88327C : E049                		lsr.w	#8,d1
(1) 1181/  88327E : E449                		lsr.w	#2,d1
(1) 1182/  883280 : CE7C 8000           		and.w	#$8000,d7
(1) 1183/  883284 : 8C47                		or.w	d7,d6
(1) 1184/  883286 : 3AC6                		move.w	d6,(a5)+
(1) 1185/  883288 : DCFC 0002           		adda	#2,a6
(1) 1186/  88328C : B47C 0007           		cmp.w	#%111,d2
(1) 1187/  883290 : 6608                		bne.s	.no_fnsh
(1) 1188/  883292 : 4846                		swap	d6
(1) 1189/  883294 : 9C7C 0001           		sub.w	#1,d6
(1) 1190/  883298 : 4846                		swap	d6
(1) 1191/  88329A :                     .no_fnsh:
(1) 1192/  88329A : 51C8 FF7C           		dbf	d0,.nxt_pal
(1) 1193/  88329E : 4846                		swap	d6
(1) 1194/  8832A0 : 4A46                		tst.w	d6
(1) 1195/  8832A2 : 6604                		bne.s	.no_move
(1) 1196/  8832A4 : 4278 A5FE           		clr.w	(RAM_FadeMarsReq).w
(1) 1197/  8832A8 :                     .no_move:
(1) 1198/  8832A8 : 4E75                		rts
(1) 1199/  8832AA :                     
(1) 1200/  8832AA :                     ; --------------------------------------------
(1) 1201/  8832AA :                     ; Fade out
(1) 1202/  8832AA :                     ; --------------------------------------------
(1) 1203/  8832AA :                     
(1) 1204/  8832AA :                     .fade_out:
(1) 1205/  8832AA : 4DF8 AA30           		lea	(RAM_MdDreq+Dreq_Palette).w,a6
(1) 1206/  8832AE : 303C 0100           		move.w	#256,d0				; Num of colors
(1) 1207/  8832B2 : 3238 A600           		move.w	(RAM_FadeMarsIncr).w,d1		; Speed
(1) 1208/  8832B6 : 3C00                		move.w	d0,d6
(1) 1209/  8832B8 : 4846                		swap	d6
(1) 1210/  8832BA : 907C 0001           		sub.w	#1,d0
(1) 1211/  8832BE :                     .nxt_pal_o:
(1) 1212/  8832BE : 4242                		clr.w	d2		; Reset finished colorbits
(1) 1213/  8832C0 : 3E16                		move.w	(a6),d7		; d7 - Input
(1) 1214/  8832C2 : 3C07                		move.w	d7,d6
(1) 1215/  8832C4 : CE7C FFE0           		and.w	#%1111111111100000,d7
(1) 1216/  8832C8 : CC7C 001F           		and.w	#%0000000000011111,d6
(1) 1217/  8832CC : 9C41                		sub.w	d1,d6
(1) 1218/  8832CE : 6A06                		bpl.s	.no_red_o
(1) 1219/  8832D0 : 4246                		clr.w	d6
(1) 1220/  8832D2 : 847C 0001           		or.w	#%001,d2	; RED is ready
(1) 1221/  8832D6 :                     .no_red_o:
(1) 1222/  8832D6 : 8E46                		or.w	d6,d7
(1) 1223/  8832D8 : EB49                		lsl.w	#5,d1
(1) 1224/  8832DA : 3C07                		move.w	d7,d6
(1) 1225/  8832DC : CE7C FC1F           		and.w	#%1111110000011111,d7
(1) 1226/  8832E0 : CC7C 03E0           		and.w	#%0000001111100000,d6
(1) 1227/  8832E4 : 9C41                		sub.w	d1,d6
(1) 1228/  8832E6 : 6A06                		bpl.s	.no_grn_o
(1) 1229/  8832E8 : 4246                		clr.w	d6
(1) 1230/  8832EA : 847C 0002           		or.w	#%010,d2	; GREEN is ready
(1) 1231/  8832EE :                     .no_grn_o:
(1) 1232/  8832EE : 8E46                		or.w	d6,d7
(1) 1233/  8832F0 : EB49                		lsl.w	#5,d1
(1) 1234/  8832F2 : 3C07                		move.w	d7,d6
(1) 1235/  8832F4 : CE7C 83FF           		and.w	#%1000001111111111,d7
(1) 1236/  8832F8 : CC7C 7C00           		and.w	#%0111110000000000,d6
(1) 1237/  8832FC : 9C41                		sub.w	d1,d6
(1) 1238/  8832FE : 6A06                		bpl.s	.no_blu_o
(1) 1239/  883300 : 4246                		clr.w	d6
(1) 1240/  883302 : 847C 0004           		or.w	#%100,d2	; BLUE is ready
(1) 1241/  883306 :                     .no_blu_o:
(1) 1242/  883306 : 8E46                		or.w	d6,d7
(1) 1243/  883308 : E049                		lsr.w	#8,d1
(1) 1244/  88330A : E449                		lsr.w	#2,d1
(1) 1245/  88330C : 3CC7                		move.w	d7,(a6)+
(1) 1246/  88330E : B47C 0007           		cmp.w	#%111,d2
(1) 1247/  883312 : 6608                		bne.s	.no_fnsh_o
(1) 1248/  883314 : 4846                		swap	d6
(1) 1249/  883316 : 9C7C 0001           		sub.w	#1,d6
(1) 1250/  88331A : 4846                		swap	d6
(1) 1251/  88331C :                     .no_fnsh_o:
(1) 1252/  88331C : 51C8 FFA0           		dbf	d0,.nxt_pal_o
(1) 1253/  883320 : 4846                		swap	d6
(1) 1254/  883322 : 4A46                		tst.w	d6
(1) 1255/  883324 : 6604                		bne.s	.no_move_o
(1) 1256/  883326 : 4278 A5FE           		clr.w	(RAM_FadeMarsReq).w
(1) 1257/  88332A :                     .no_move_o:
(1) 1258/  88332A : 4E75                		rts
(1) 1259/  88332C :                     
(1) 1260/  88332C :                     ; ====================================================================
(1) 1261/  88332C :                     ; --------------------------------------------------------
(1) 1262/  88332C :                     ; Video data
(1) 1263/  88332C :                     ; --------------------------------------------------------
(1) 1264/  88332C :                     
(1) 1265/  88332C :                     list_vdpregs:
(1) 1266/  88332C : 04                  		dc.b $04			; HBlank int off, HV Counter on
(1) 1267/  88332D : 44                  		dc.b $44			; Display ON, VBlank int off
(1) 1268/  88332E : 30                  		dc.b (($C000)>>10)		; ForeGrd at VRAM $C000 (%00xxx000)
(1) 1269/  88332F : 34                  		dc.b (($D000)>>10)		; Window  at VRAM $D000 (%00xxxxy0)
(1) 1270/  883330 : 07                  		dc.b (($E000)>>13)		; BackGrd at VRAM $E000 (%00000xxx)
(1) 1271/  883331 : 7C                  		dc.b (($F800)>>9)		; Sprites at VRAM $F800 (%0xxxxxxy)
(1) 1272/  883332 : 00                  		dc.b $00			; Unused
(1) 1273/  883333 : 00                  		dc.b $00			; Background color: 0
(1) 1274/  883334 : 00                  		dc.b $00			; Unused
(1) 1275/  883335 : 00                  		dc.b $00			; Unused
(1) 1276/  883336 : 00                  		dc.b $00			; HInt value
(1) 1277/  883337 : 00                  		dc.b (%000|%00)			; No ExtInt, Scroll: VSCR:full HSCR:full
(1) 1278/  883338 : 81                  		dc.b $81			; H40, No shadow mode, Normal resolution
(1) 1279/  883339 : 3F                  		dc.b (($FC00)>>10)		; HScroll at VRAM $FC00 (%00xxxxxx)
(1) 1280/  88333A : 00                  		dc.b $00			; Unused
(1) 1281/  88333B : 02                  		dc.b $02			; VDP Auto increment by $02
(1) 1282/  88333C : 01                  		dc.b (%00<<4)|%01		; Layer size: V32 H64
(1) 1283/  88333D : 00                  		dc.b $00
(1) 1284/  88333E : 00                  		dc.b $00
(1) 1285/  88333F :                     		align 2
(1) 1286/  883340 : 0000 0EEE 0CCC 0AAA ASCII_PAL:	dc.w $0000,$0EEE,$0CCC,$0AAA,$0888,$0444,$000E,$0008
                    0888 0444 000E 0008 
(1) 1287/  883350 : 00EE 0088 00E0 0080 		dc.w $00EE,$0088,$00E0,$0080,$0E00,$0800,$0000,$0000
                    0E00 0800 0000 0000 
(1) 1288/  883360 :                     ASCII_PAL_e:
(1) 1289/  883360 :                     
(1) 1290/  883360 :                     ; --------------------------------------------------------
(1) 1291/  883360 :                     ; RAM-code, these routines use the RV bit
(1) 1292/  883360 :                     ; --------------------------------------------------------
(1) 1293/  883360 :                     
(1) 1294/  883360 :                     dmacode_start:
(1) 1295/       0 :                     		phase 0
(1) 1296/       0 :                     RAMDMA_Load:
(1) 1297/       0 : 40E7                		move.w	sr,-(sp)
(1) 1298/       2 : 007C 0700           		or	#$700,sr
(1) 1299/       6 : 49F9 00C0 0004      		lea	(vdp_ctrl),a4
(1) 1300/       C : 3C3C 8100           		move.w	#$8100,d6		; DMA ON
(1) 1301/      10 : 1C38 A60B           		move.b	(RAM_VdpRegs+1),d6
(1) 1302/      14 : 08C6 0004           		bset	#bitDmaEnbl,d6
(1) 1303/      18 : 3886                		move.w	d6,(a4)
(1) 1304/      1A : 3C02                		move.w	d2,d6			; Length
(1) 1305/      1C : 2A3C 9400 9300      		move.l	#$94009300,d5
(1) 1306/      22 : E24E                		lsr.w	#1,d6
(1) 1307/      24 : 1A06                		move.b	d6,d5
(1) 1308/      26 : 4845                		swap	d5
(1) 1309/      28 : E04E                		lsr.w	#8,d6
(1) 1310/      2A : 1A06                		move.b	d6,d5
(1) 1311/      2C : 4845                		swap	d5
(1) 1312/      2E : 2885                		move.l	d5,(a4)
(1) 1313/      30 : 2C00                		move.l	d0,d6			; Source
(1) 1314/      32 : E28E                  		lsr.l	#1,d6
(1) 1315/      34 : 2A3C 9600 9500       		move.l	#$96009500,d5
(1) 1316/      3A : 1A06                 		move.b	d6,d5
(1) 1317/      3C : E08E                 		lsr.l	#8,d6
(1) 1318/      3E : 4845                 		swap	d5
(1) 1319/      40 : 1A06                 		move.b	d6,d5
(1) 1320/      42 : 2885                 		move.l	d5,(a4)
(1) 1321/      44 : 3A3C 9700            		move.w	#$9700,d5
(1) 1322/      48 : E08E                 		lsr.l	#8,d6
(1) 1323/      4A : 1A06                 		move.b	d6,d5
(1) 1324/      4C : 3885                 		move.w	d5,(a4)
(1) 1325/      4E : 3C01                		move.w	d1,d6			; Destination
(1) 1326/      50 :                     ; 		and.w	#$7FF,d6
(1) 1327/      50 :                     ; 		lsl.w	#5,d6
(1) 1328/      50 : 3A06                		move.w	d6,d5
(1) 1329/      52 : CCBC 0000 3FE0      		and.l	#$3FE0,d6
(1) 1330/      58 : 0046 4000           		ori.w	#$4000,d6
(1) 1331/      5C :                     
(1) 1332/      5C : E04D                		lsr.w	#8,d5
(1) 1333/      5E : EC4D                		lsr.w	#6,d5
(1) 1334/      60 : 0245 0003           		andi.w	#%11,d5
(1) 1335/      64 : 0045 0080           		ori.w	#$80,d5
(1) 1336/      68 : 2E00                		move.l	d0,d7
(1) 1337/      6A : 4847                		swap	d7
(1) 1338/      6C : E04F                		lsr.w	#8,d7
(1) 1339/      6E : BE3C 00FF           		cmp.b	#$FF,d7
(1) 1340/      72 : 672E                		beq.s	.from_ram
(1) 1341/      74 : 4EB9 0088 0A6C      		jsr	Sound_DMA_Pause
(1) 1342/      7A : 08F9 0000 00A1 5107 		bset	#0,(sysmars_reg+dreqctl+1).l	; Set RV=1
(1) 1343/      82 : 3F05                 		move.w	d5,-(sp)
(1) 1344/      84 : 3886                		move.w	d6,(a4)				; d6 - First word
(1) 1345/      86 : 389F                		move.w	(sp)+,(a4)			; *** Second write, CPU freezes until it DMA ends
(1) 1346/      88 : 08B9 0000 00A1 5107 		bclr	#0,(sysmars_reg+dreqctl+1).l	; Set RV=0
(1) 1347/      90 : 3C3C 8100           		move.w	#$8100,d6			; DMA OFF
(1) 1348/      94 : 1C38 A60B           		move.b	(RAM_VdpRegs+1),d6
(1) 1349/      98 : 3886                		move.w	d6,(a4)
(1) 1350/      9A : 46DF                		move.w	(sp)+,sr
(1) 1351/      9C : 4EF9 0088 0AE2      		jmp	Sound_DMA_Resume
(1) 1352/      A2 :                     .from_ram:
(1) 1353/      A2 : 3887                		move.w	d7,(a4)
(1) 1354/      A4 : 3F05                 		move.w	d5,-(sp)
(1) 1355/      A6 : 389F                		move.w	(sp)+,(a4)			; Second write
(1) 1356/      A8 : 3E3C 8100           		move.w	#$8100,d7
(1) 1357/      AC : 1E38 A60B           		move.b	(RAM_VdpRegs+1),d7
(1) 1358/      B0 : 3887                		move.w	d7,(a4)
(1) 1359/      B2 : 46DF                		move.w	(sp)+,sr
(1) 1360/      B4 : 4E75                		rts
(1) 1361/      B6 :                     
(1) 1362/      B6 :                     RAMDMA_Blast:
(1) 1363/      B6 : 4A78 A5F2           		tst.w	(RAM_VdpDmaMod).w		; Got mid-write?
(1) 1364/      BA : 666A                		bne.s	.exit
(1) 1365/      BC : 4A78 A5F0           		tst.w	(RAM_VdpDmaIndx).w		; Index != 0?
(1) 1366/      C0 : 6764                		beq.s	.exit
(1) 1367/      C2 : 49F9 00C0 0004      		lea	(vdp_ctrl),a4
(1) 1368/      C8 : 47F8 A390           		lea	(RAM_VdpDmaList).w,a3
(1) 1369/      CC : 3E3C 8100           		move.w	#$8100,d7			; DMA ON
(1) 1370/      D0 : 1E38 A60B           		move.b	(RAM_VdpRegs+1),d7
(1) 1371/      D4 : 08C7 0004           		bset	#bitDmaEnbl,d7
(1) 1372/      D8 : 3887                		move.w	d7,(a4)
(1) 1373/      DA : 4EB9 0088 0A6C      		jsr	Sound_DMA_Pause			; Request Z80 stop and SH2 backup
(1) 1374/      E0 : 08F9 0000 00A1 5107 		bset	#0,(sysmars_reg+dreqctl+1).l	; Set RV=1
(1) 1375/      E8 : 4A78 A5F0           .next:		tst.w	(RAM_VdpDmaIndx).w
(1) 1376/      EC : 6720                		beq.s	.end
(1) 1377/      EE : 2893                		move.l	(a3),(a4)			; Size
(1) 1378/      F0 : 429B                		clr.l	(a3)+
(1) 1379/      F2 : 2893                		move.l	(a3),(a4)			; Source
(1) 1380/      F4 : 429B                		clr.l	(a3)+
(1) 1381/      F6 : 3893                		move.w	(a3),(a4)
(1) 1382/      F8 : 425B                		clr.w	(a3)+
(1) 1383/      FA : 3C13                		move.w	(a3),d6				; Destination
(1) 1384/      FC : 425B                		clr.w	(a3)+
(1) 1385/      FE : 3A13                		move.w	(a3),d5
(1) 1386/     100 : 425B                		clr.w	(a3)+
(1) 1387/     102 : 3886                		move.w	d6,(a4)
(1) 1388/     104 : 3885                		move.w	d5,(a4)
(1) 1389/     106 : 0478 000E A5F0      		sub.w	#7*2,(RAM_VdpDmaIndx).w
(1) 1390/     10C : 60DA                		bra.s	.next
(1) 1391/     10E :                     .end:
(1) 1392/     10E : 08B9 0000 00A1 5107 		bclr	#0,(sysmars_reg+dreqctl+1).l	; Set RV=0
(1) 1393/     116 : 4EB9 0088 0AE2      		jsr	Sound_DMA_Resume		; Resume Z80 and SH2 direct
(1) 1394/     11C : 3E3C 8100           		move.w	#$8100,d7			; DMA OFF
(1) 1395/     120 : 1E38 A60B           		move.b	(RAM_VdpRegs+1).w,d7
(1) 1396/     124 : 3887                		move.w	d7,(a4)
(1) 1397/     126 :                     .exit:
(1) 1398/     126 : 4E75                		rts
(1) 1399/    3488 :                     		dephase
(1) 1400/  883488 :                     		phase $880000+*
(1) 1401/  883488 :                     dmacode_end:
(1) 1402/  883488 :                     
      30/  883488 :                     		include	"system/md/system.asm"
(1)    1/  883488 :                     ; ====================================================================
(1)    2/  883488 :                     ; ----------------------------------------------------------------
(1)    3/  883488 :                     ; System
(1)    4/  883488 :                     ; ----------------------------------------------------------------
(1)    5/  883488 :                     
(1)    6/  883488 :                     ; --------------------------------------------------------
(1)    7/  883488 :                     ; Init System
(1)    8/  883488 :                     ; 
(1)    9/  883488 :                     ; Uses:
(1)   10/  883488 :                     ; a0-a2,d0-d1
(1)   11/  883488 :                     ; --------------------------------------------------------
(1)   12/  883488 :                     
(1)   13/  883488 :                     System_Init:
(1)   14/  883488 : 46FC 2700           		move.w	#$2700,sr		; Disable interrupts
(1)   15/  88348C : 40E7                		move.w	sr,-(sp)
(1)   16/  88348E : 33FC 0100 00A1 1100 		move.w	#$0100,(z80_bus).l	; Stop Z80
(1)   17/  883496 :                     .wait:
(1)   18/  883496 : 0839 0000 00A1 1100 		btst	#0,(z80_bus).l		; Wait for it
(1)   19/  88349E : 66F6                		bne.s	.wait
(1)   20/  8834A0 : 7040                		moveq	#%01000000,d0		; Init ports, TH=1
(1)   21/  8834A2 : 13C0 00A1 0009      		move.b	d0,(sys_ctrl_1).l	; Controller 1
(1)   22/  8834A8 : 13C0 00A1 000B      		move.b	d0,(sys_ctrl_2).l	; Controller 2
(1)   23/  8834AE : 13C0 00A1 000D      		move.b	d0,(sys_ctrl_3).l	; Modem
(1)   24/  8834B4 : 33FC 0000 00A1 1100 		move.w	#0,(z80_bus).l		; Enable Z80
(1)   25/  8834BC : 41F8 A622           		lea	(RAM_InputData),a0	; Clear input data buffer
(1)   26/  8834C0 : 323C 0010           		move.w	#sizeof_input-1/2,d1
(1)   27/  8834C4 : 7000                		moveq	#0,d0
(1)   28/  8834C6 :                     .clrinput:
(1)   29/  8834C6 : 30FC 0000           		move.w	#0,(a0)+
(1)   30/  8834CA : 51C9 FFFA           		dbf	d1,.clrinput
(1)   31/  8834CE : 303C 4EF9           		move.w	#$4EF9,d0		; Set JMP opcode for the Hblank/VBlank jumps
(1)   32/  8834D2 : 33C0 FFFF A9EE       		move.w	d0,(RAM_MdMarsVInt).l
(1)   33/  8834D8 : 33C0 FFFF A9F4      		move.w	d0,(RAM_MdMarsHInt).l
(1)   34/  8834DE : 203C 5625 5769      		move.l	#$56255769,d0		; Set these random values
(1)   35/  8834E4 : 223C 9511 6102      		move.l	#$95116102,d1
(1)   36/  8834EA : 23C0 FFFF A9E2      		move.l	d0,(RAM_SysRandVal).l
(1)   37/  8834F0 : 23C1 FFFF A9E6      		move.l	d1,(RAM_SysRandSeed).l
(1)   38/  8834F6 : 203C 0088 3932      		move.l	#VInt_Default,d0	; Set default ints
(1)   39/  8834FC : 223C 0088 394A      		move.l	#Hint_Default,d1
(1)   40/  883502 : 6100 0312           		bsr	System_SetInts
(1)   41/  883506 : 46DF                		move.w	(sp)+,sr
(1)   42/  883508 : 4E75                		rts
(1)   43/  88350A :                     
(1)   44/  88350A :                     ; ====================================================================
(1)   45/  88350A :                     ; --------------------------------------------------------
(1)   46/  88350A :                     ; System_Input
(1)   47/  88350A :                     ;
(1)   48/  88350A :                     ; CALL THIS ON VBLANK ONLY
(1)   49/  88350A :                     ; 
(1)   50/  88350A :                     ; Uses:
(1)   51/  88350A :                     ; d4-d6,a4-a6
(1)   52/  88350A :                     ; --------------------------------------------------------
(1)   53/  88350A :                     
(1)   54/  88350A :                     System_Input:
(1)   55/  88350A :                     ; 		move.w	#$0100,(z80_bus).l
(1)   56/  88350A :                     ; .wait:
(1)   57/  88350A :                     ; 		btst	#0,(z80_bus).l
(1)   58/  88350A :                     ; 		bne.s	.wait
(1)   59/  88350A : 4BF9 00A1 0003      		lea	(sys_data_1),a5		; BASE Genesis Input regs area
(1)   60/  883510 : 4DF8 A622           		lea	(RAM_InputData),a6
(1)   61/  883514 : 610C                		bsr.s	.this_one
(1)   62/  883516 : DAFC 0002           		adda	#2,a5
(1)   63/  88351A : DCFC 0010           		adda	#sizeof_input,a6
(1)   64/  88351E : 6102                		bsr.s	.this_one
(1)   65/  883520 :                     ; 		move.w	#0,(z80_bus).l
(1)   66/  883520 : 4E75                		rts
(1)   67/  883522 :                     
(1)   68/  883522 :                     ; --------------------------------------------------------	
(1)   69/  883522 :                     ; Read port
(1)   70/  883522 :                     ; 
(1)   71/  883522 :                     ; a5 - Current port
(1)   72/  883522 :                     ; a6 - Output data
(1)   73/  883522 :                     ; --------------------------------------------------------
(1)   74/  883522 :                     
(1)   75/  883522 :                     .this_one:
(1)   76/  883522 : 6100 0166           		bsr	.pick_id
(1)   77/  883526 : 1C84                		move.b	d4,pad_id(a6)
(1)   78/  883528 : B87C 000F           		cmp.w	#$F,d4
(1)   79/  88352C : 670E                		beq.s	.exit
(1)   80/  88352E : C87C 000F           		and.w	#$F,d4
(1)   81/  883532 : D844                		add.w	d4,d4
(1)   82/  883534 : 3A3B 400C           		move.w	.list(pc,d4.w),d5
(1)   83/  883538 : 4EFB 5008           		jmp	.list(pc,d5.w)
(1)   84/  88353C :                     .exit:
(1)   85/  88353C : 422E 0001           		clr.b	pad_ver(a6)
(1)   86/  883540 : 4E75                		rts
(1)   87/  883542 :                     
(1)   88/  883542 :                     ; --------------------------------------------------------
(1)   89/  883542 :                     ; Grab ID
(1)   90/  883542 :                     ; --------------------------------------------------------
(1)   91/  883542 :                     
(1)   92/  883542 :                     .list:
(1)   93/  883542 : FFFA                		dc.w .exit-.list	; $00
(1)   94/  883544 : FFFA                		dc.w .exit-.list
(1)   95/  883546 : FFFA                		dc.w .exit-.list
(1)   96/  883548 : 0020                		dc.w .id_03-.list	; $03 - Mega mouse
(1)   97/  88354A : FFFA                		dc.w .exit-.list	; $04
(1)   98/  88354C : FFFA                		dc.w .exit-.list
(1)   99/  88354E : FFFA                		dc.w .exit-.list
(1)  100/  883550 : FFFA                		dc.w .exit-.list
(1)  101/  883552 : FFFA                		dc.w .exit-.list	; $08
(1)  102/  883554 : FFFA                		dc.w .exit-.list
(1)  103/  883556 : FFFA                		dc.w .exit-.list
(1)  104/  883558 : FFFA                		dc.w .exit-.list
(1)  105/  88355A : FFFA                		dc.w .exit-.list	; $0C
(1)  106/  88355C : 00CA                		dc.w .id_0D-.list	; $0D - Genesis controller (3 or 6 button)
(1)  107/  88355E : FFFA                		dc.w .exit-.list
(1)  108/  883560 : FFFA                		dc.w .exit-.list
(1)  109/  883562 :                     
(1)  110/  883562 :                     ; --------------------------------------------------------
(1)  111/  883562 :                     ; ID $03
(1)  112/  883562 :                     ;
(1)  113/  883562 :                     ; Mega Mouse
(1)  114/  883562 :                     ; --------------------------------------------------------
(1)  115/  883562 :                     
(1)  116/  883562 :                     .id_03:
(1)  117/  883562 : 1ABC 0020           		move.b	#$20,(a5)
(1)  118/  883566 : 1B7C 0060 0006      		move.b	#$60,6(a5)
(1)  119/  88356C : 0815 0004           		btst	#4,(a5)
(1)  120/  883570 : 6700 0094           		beq.w	.invalid
(1)  121/  883574 : 1ABC 0000           		move.b	#$00,(a5)	; $0F
(1)  122/  883578 : 4E71                		nop
(1)  123/  88357A : 4E71                		nop
(1)  124/  88357C : 1ABC 0020           		move.b	#$20,(a5)	; $0F
(1)  125/  883580 : 4E71                		nop
(1)  126/  883582 : 4E71                		nop
(1)  127/  883584 : 1ABC 0000           		move.b	#$00,(a5)	; Yo | Xo | Ys | Xs
(1)  128/  883588 : 4E71                		nop
(1)  129/  88358A : 4E71                		nop
(1)  130/  88358C : 1A15                		move.b	(a5),d5		; d5 - X/Y direction bits (Ys Xs)
(1)  131/  88358E : 1ABC 0020           		move.b	#$20,(a5)	; C | M | R | L
(1)  132/  883592 : 4E71                		nop
(1)  133/  883594 : 4E71                		nop
(1)  134/  883596 : 1E15                		move.b	(a5),d7
(1)  135/  883598 : CE7C 000F            		and.w	#%1111,d7
(1)  136/  88359C : 3C2E 0002           		move.w	on_hold(a6),d6
(1)  137/  8835A0 : BF46                		eor.w	d7,d6
(1)  138/  8835A2 : 3D47 0002           		move.w	d7,on_hold(a6)
(1)  139/  8835A6 : CC47                		and.w	d7,d6
(1)  140/  8835A8 : 3D46 0004           		move.w	d6,on_press(a6)
(1)  141/  8835AC : 1ABC 0000           		move.b	#$00,(a5)	; X7 | X6 | X5 | X4
(1)  142/  8835B0 : 4E71                		nop
(1)  143/  8835B2 : 4E71                		nop
(1)  144/  8835B4 : 1E15                		move.b	(a5),d7
(1)  145/  8835B6 : 1ABC 0020           		move.b	#$20,(a5)	; X3 | X2 | X1 | X0
(1)  146/  8835BA : CE7C 000F           		and.w	#%1111,d7
(1)  147/  8835BE : E94F                		lsl.w	#4,d7
(1)  148/  8835C0 : 4E71                		nop
(1)  149/  8835C2 : 1C15                		move.b	(a5),d6
(1)  150/  8835C4 : CC7C 000F           		and.w	#%1111,d6
(1)  151/  8835C8 : 8E46                		or.w	d6,d7
(1)  152/  8835CA : 0805 0000           		btst    #0,d5
(1)  153/  8835CE : 6704                		beq.s	.x_neg
(1)  154/  8835D0 : 4407                		neg.b	d7
(1)  155/  8835D2 : 4447                		neg.w	d7
(1)  156/  8835D4 :                     .x_neg:
(1)  157/  8835D4 : 3D47 0006           		move.w	d7,mouse_x(a6)
(1)  158/  8835D8 : 1ABC 0000           		move.b	#$00,(a5)	; Y7 | Y6 | Y5 | Y4
(1)  159/  8835DC : 4E71                		nop
(1)  160/  8835DE : 4E71                		nop
(1)  161/  8835E0 : 1E15                		move.b	(a5),d7
(1)  162/  8835E2 : 1ABC 0020           		move.b	#$20,(a5)	; Y3 | Y2 | Y1 | Y0
(1)  163/  8835E6 : CE7C 000F           		and.w	#%1111,d7
(1)  164/  8835EA : E94F                		lsl.w	#4,d7
(1)  165/  8835EC : 4E71                		nop
(1)  166/  8835EE : 1C15                		move.b	(a5),d6
(1)  167/  8835F0 : CC7C 000F           		and.w	#%1111,d6
(1)  168/  8835F4 : 8E46                		or.w	d6,d7
(1)  169/  8835F6 : 0805 0001           		btst    #1,d5
(1)  170/  8835FA : 6704                		beq.s	.y_neg
(1)  171/  8835FC : 4407                		neg.b	d7
(1)  172/  8835FE : 4447                		neg.w	d7
(1)  173/  883600 :                     .y_neg:
(1)  174/  883600 : 4447                		neg.w	d7		; Reverse Y
(1)  175/  883602 : 3D47 0008           		move.w	d7,mouse_y(a6)
(1)  176/  883606 :                     
(1)  177/  883606 :                     .invalid:
(1)  178/  883606 : 1ABC 0060           		move.b	#$60,(a5)
(1)  179/  88360A : 4E75                		rts
(1)  180/  88360C :                     
(1)  181/  88360C :                     ; --------------------------------------------------------
(1)  182/  88360C :                     ; ID $0D
(1)  183/  88360C :                     ; 
(1)  184/  88360C :                     ; Normal controller, Old or New
(1)  185/  88360C :                     ; --------------------------------------------------------
(1)  186/  88360C :                     
(1)  187/  88360C :                     .id_0D:
(1)  188/  88360C : 1ABC 0040           		move.b	#$40,(a5)	; Show CB|RLDU
(1)  189/  883610 : 4E71                		nop
(1)  190/  883612 : 4E71                		nop
(1)  191/  883614 : 1A15                		move.b	(a5),d5
(1)  192/  883616 : CA7C 003F           		and.w	#%00111111,d5
(1)  193/  88361A : 1ABC 0000           		move.b	#$00,(a5)	; Show SA|RLDU
(1)  194/  88361E : 4E71                		nop
(1)  195/  883620 : 4E71                		nop
(1)  196/  883622 : 1815                		move.b	(a5),d4
(1)  197/  883624 : E54C                		lsl.w	#2,d4
(1)  198/  883626 : C87C 00C0           		and.w	#%11000000,d4
(1)  199/  88362A : 8845                		or.w	d5,d4
(1)  200/  88362C : 1ABC 0040           		move.b	#$40,(a5)	; Show CB|RLDU
(1)  201/  883630 : 4644                		not.w	d4
(1)  202/  883632 : 1A2E 0003           		move.b	on_hold+1(a6),d5
(1)  203/  883636 : B905                		eor.b	d4,d5
(1)  204/  883638 : 1ABC 0000           		move.b	#$00,(a5)	; Show SA|RLDU
(1)  205/  88363C : 1D44 0003           		move.b	d4,on_hold+1(a6)
(1)  206/  883640 : CA04                		and.b	d4,d5
(1)  207/  883642 : 1D45 0005           		move.b	d5,on_press+1(a6)
(1)  208/  883646 : 1ABC 0040           		move.b	#$40,(a5)	; 6 button responds
(1)  209/  88364A : 4E71                		nop
(1)  210/  88364C : 4E71                		nop
(1)  211/  88364E : 1815                		move.b	(a5),d4		; Grab ??|MXYZ
(1)  212/  883650 : 1ABC 0000            		move.b	#$00,(a5)
(1)  213/  883654 : 4E71                  		nop
(1)  214/  883656 : 4E71                  		nop
(1)  215/  883658 : 1C15                 		move.b	(a5),d6		; Type: $03 old, $0F new
(1)  216/  88365A : 1ABC 0040            		move.b	#$40,(a5)
(1)  217/  88365E : 4E71                 		nop
(1)  218/  883660 : 4E71                 		nop
(1)  219/  883662 : CC7C 000F           		and.w	#$F,d6
(1)  220/  883666 : E44E                		lsr.w	#2,d6
(1)  221/  883668 : CC7C 0001           		and.w	#1,d6
(1)  222/  88366C : 6716                		beq.s	.oldpad
(1)  223/  88366E : 4604                		not.b	d4
(1)  224/  883670 : C87C 000F            		and.w	#%1111,d4
(1)  225/  883674 : 1A2E 0002           		move.b	on_hold(a6),d5
(1)  226/  883678 : B905                		eor.b	d4,d5
(1)  227/  88367A : 1D44 0002           		move.b	d4,on_hold(a6)
(1)  228/  88367E : CA04                		and.b	d4,d5
(1)  229/  883680 : 1D45 0004           		move.b	d5,on_press(a6)
(1)  230/  883684 :                     .oldpad:
(1)  231/  883684 : 1D46 0001           		move.b	d6,pad_ver(a6)
(1)  232/  883688 : 4E75                		rts
(1)  233/  88368A :                     		
(1)  234/  88368A :                     ; --------------------------------------------------------
(1)  235/  88368A :                     ; Grab ID
(1)  236/  88368A :                     ; --------------------------------------------------------
(1)  237/  88368A :                     
(1)  238/  88368A :                     .pick_id:
(1)  239/  88368A : 7800                		moveq	#0,d4
(1)  240/  88368C : 1ABC 0070           		move.b	#%01110000,(a5)		; TH=1,TR=1,TL=1
(1)  241/  883690 : 4E71                		nop
(1)  242/  883692 : 4E71                		nop
(1)  243/  883694 : 610A                		bsr	.read
(1)  244/  883696 : 1ABC 0030           		move.b	#%00110000,(a5)		; TH=0,TR=1,TL=1
(1)  245/  88369A : 4E71                		nop
(1)  246/  88369C : 4E71                		nop
(1)  247/  88369E : D844                		add.w	d4,d4
(1)  248/  8836A0 :                     .read:
(1)  249/  8836A0 : 1A15                		move.b	(a5),d5
(1)  250/  8836A2 : 1C05                		move.b	d5,d6
(1)  251/  8836A4 : CC3C 000C           		and.b	#$C,d6
(1)  252/  8836A8 : 6702                		beq.s	.step_1
(1)  253/  8836AA : 5244                		addq.w	#1,d4
(1)  254/  8836AC :                     .step_1:
(1)  255/  8836AC : D844                		add.w	d4,d4
(1)  256/  8836AE : 1C05                		move.b	d5,d6
(1)  257/  8836B0 : CC7C 0003           		and.w	#3,d6
(1)  258/  8836B4 : 6702                		beq.s	.step_2
(1)  259/  8836B6 : 5244                		addq.w	#1,d4
(1)  260/  8836B8 :                     .step_2:
(1)  261/  8836B8 : 4E75                		rts
(1)  262/  8836BA :                     
(1)  263/  8836BA :                     ; --------------------------------------------------------
(1)  264/  8836BA :                     ; System_Random
(1)  265/  8836BA :                     ; 
(1)  266/  8836BA :                     ; Set random value
(1)  267/  8836BA :                     ; 
(1)  268/  8836BA :                     ; Output:
(1)  269/  8836BA :                     ; d0 | LONG
(1)  270/  8836BA :                     ; --------------------------------------------------------
(1)  271/  8836BA :                     
(1)  272/  8836BA :                     ; TODO: rewrite this
(1)  273/  8836BA :                     System_Random:
(1)  274/  8836BA : 2A38 A9E6           		move.l	(RAM_SysRandSeed),d5
(1)  275/  8836BE : 2838 A9E2           		move.l	(RAM_SysRandVal),d4
(1)  276/  8836C2 : E39D                		rol.l	#1,d5
(1)  277/  8836C4 : EAA4                		asr.l	d5,d4
(1)  278/  8836C6 : D885                		add.l	d5,d4
(1)  279/  8836C8 : 23C5 FFFF A9E6      		move.l	d5,(RAM_SysRandSeed).l
(1)  280/  8836CE : 23C4 FFFF A9E2      		move.l	d4,(RAM_SysRandVal).l
(1)  281/  8836D4 : 2004                		move.l	d4,d0
(1)  282/  8836D6 : 4E75                		rts
(1)  283/  8836D8 :                     
(1)  284/  8836D8 :                     ; --------------------------------------------------------
(1)  285/  8836D8 :                     ; System_SineWave_Cos / System_SineWave
(1)  286/  8836D8 :                     ;
(1)  287/  8836D8 :                     ; Read sinewave value
(1)  288/  8836D8 :                     ;
(1)  289/  8836D8 :                     ; Input:
(1)  290/  8836D8 :                     ; d0 | WORD - Tan
(1)  291/  8836D8 :                     ; d1 | WORD - Multiply by
(1)  292/  8836D8 :                     ;
(1)  293/  8836D8 :                     ; Output:
(1)  294/  8836D8 :                     ; d2 | LONG - Result (as 0000.0000)
(1)  295/  8836D8 :                     ; --------------------------------------------------------
(1)  296/  8836D8 :                     
(1)  297/  8836D8 :                     System_SineWave_Cos:
(1)  298/  8836D8 : 48A7 8000           		movem.w	d0,-(sp)
(1)  299/  8836DC : 7400                		moveq	#0,d2
(1)  300/  8836DE : D03C 0040           		add.b	#$40,d0
(1)  301/  8836E2 : 1400                		move.b	d0,d2
(1)  302/  8836E4 : E302                		asl.b	#1,d2
(1)  303/  8836E6 : 343B 202E           		move.w	MdSys_SineData(pc,d2.w),d2
(1)  304/  8836EA : C4C1                		mulu.w	d1,d2
(1)  305/  8836EC : 8000                		or.b	d0,d0
(1)  306/  8836EE : 6A02                		bpl.s	.dont_neg
(1)  307/  8836F0 : 4482                		neg.l	d2
(1)  308/  8836F2 :                     .dont_neg:
(1)  309/  8836F2 : 4C9F 0001           		movem.w	(sp)+,d0
(1)  310/  8836F6 : 4E75                		rts
(1)  311/  8836F8 :                     
(1)  312/  8836F8 :                     System_SineWave:
(1)  313/  8836F8 : 48A7 8000           		movem.w	d0,-(sp)
(1)  314/  8836FC : C07C 007F           		and.w	#$7F,d0
(1)  315/  883700 : E340                		asl.w	#1,d0
(1)  316/  883702 : 343B 0012           		move.w	MdSys_SineData(pc,d0.w),d2
(1)  317/  883706 : C4C1                		mulu.w	d1,d2
(1)  318/  883708 : 4C9F 0001           		movem.w	(sp)+,d0
(1)  319/  88370C : 5182                		subq.l	#8,d2
(1)  320/  88370E : 8000                		or.b	d0,d0
(1)  321/  883710 : 6A02                		bpl.s	.dont_neg
(1)  322/  883712 : 4482                		neg.l	d2
(1)  323/  883714 :                     .dont_neg:
(1)  324/  883714 : 4E75                		rts
(1)  325/  883716 :                     
(1)  326/  883716 : 0000 0006 000D 0013 MdSys_SineData:	dc.w 0,	6, $D, $13, $19, $1F, $26, $2C,	$32, $38, $3E
                    0019 001F 0026 002C 
                    0032 0038 003E      
(1)  327/  88372C : 0044 004A 0050 0056 		dc.w $44, $4A, $50, $56, $5C, $62, $68,	$6D, $73, $79
                    005C 0062 0068 006D 
                    0073 0079           
(1)  328/  883740 : 007E 0084 0089 008E 		dc.w $7E, $84, $89, $8E, $93, $98, $9D,	$A2, $A7, $AC
                    0093 0098 009D 00A2 
                    00A7 00AC           
(1)  329/  883754 : 00B1 00B5 00B9 00BE 		dc.w $B1, $B5, $B9, $BE, $C2, $C6, $CA,	$CE, $D1, $D5
                    00C2 00C6 00CA 00CE 
                    00D1 00D5           
(1)  330/  883768 : 00D8 00DC 00DF 00E2 		dc.w $D8, $DC, $DF, $E2, $E5, $E7, $EA,	$ED, $EF, $F1
                    00E5 00E7 00EA 00ED 
                    00EF 00F1           
(1)  331/  88377C : 00F3 00F5 00F7 00F8 		dc.w $F3, $F5, $F7, $F8, $FA, $FB, $FC,	$FD, $FE, $FF
                    00FA 00FB 00FC 00FD 
                    00FE 00FF           
(1)  332/  883790 : 00FF 0100 0100 0100 		dc.w $FF, $100,	$100, $100, $100, $100,	$FF, $FF, $FE
                    0100 0100 00FF 00FF 
                    00FE                
(1)  333/  8837A2 : 00FD 00FC 00FB 00FA 		dc.w $FD, $FC, $FB, $FA, $F8, $F7, $F5,	$F3, $F1, $EF
                    00F8 00F7 00F5 00F3 
                    00F1 00EF           
(1)  334/  8837B6 : 00ED 00EA 00E7 00E5 		dc.w $ED, $EA, $E7, $E5, $E2, $DF, $DC,	$D8, $D5, $D1
                    00E2 00DF 00DC 00D8 
                    00D5 00D1           
(1)  335/  8837CA : 00CE 00CA 00C6 00C2 		dc.w $CE, $CA, $C6, $C2, $BE, $B9, $B5,	$B1, $AC, $A7
                    00BE 00B9 00B5 00B1 
                    00AC 00A7           
(1)  336/  8837DE : 00A2 009D 0098 0093 		dc.w $A2, $9D, $98, $93, $8E, $89, $84,	$7E, $79, $73
                    008E 0089 0084 007E 
                    0079 0073           
(1)  337/  8837F2 : 006D 0068 0062 005C 		dc.w $6D, $68, $62, $5C, $56, $50, $4A,	$44, $3E, $38
                    0056 0050 004A 0044 
                    003E 0038           
(1)  338/  883806 : 0032 002C 0026 001F 		dc.w $32, $2C, $26, $1F, $19, $13, $D, 6
                    0019 0013 000D 0006 
(1)  339/  883816 :                     
(1)  340/  883816 :                     ; --------------------------------------------------------
(1)  341/  883816 :                     ; System_SetInts
(1)  342/  883816 :                     ;
(1)  343/  883816 :                     ; Set new interrputs
(1)  344/  883816 :                     ;
(1)  345/  883816 :                     ; d0 | LONG - VBlank
(1)  346/  883816 :                     ; d1 | LONG - HBlank
(1)  347/  883816 :                     ;
(1)  348/  883816 :                     ; Uses:
(1)  349/  883816 :                     ; d4
(1)  350/  883816 :                     ;
(1)  351/  883816 :                     ; Notes:
(1)  352/  883816 :                     ; Writing 0 or a negative number will skip change
(1)  353/  883816 :                     ; to the interrupt pointer
(1)  354/  883816 :                     ; --------------------------------------------------------
(1)  355/  883816 :                     
(1)  356/  883816 :                     System_SetInts:
(1)  357/  883816 : 2800                		move.l	d0,d4
(1)  358/  883818 : 670E                		beq.s	.novint
(1)  359/  88381A : 6B0C                		bmi.s	.novint
(1)  360/  88381C : 88BC 0088 0000      		or.l	#$880000,d4
(1)  361/  883822 : 23C4 FFFF A9F0       		move.l	d4,(RAM_MdMarsVInt+2).l
(1)  362/  883828 :                     .novint:
(1)  363/  883828 : 2801                		move.l	d1,d4
(1)  364/  88382A : 670E                		beq.s	.nohint
(1)  365/  88382C : 6B0C                		bmi.s	.nohint
(1)  366/  88382E : 88BC 0088 0000      		or.l	#$880000,d4
(1)  367/  883834 : 23C4 FFFF A9F6      		move.l	d4,(RAM_MdMarsHInt+2).l
(1)  368/  88383A :                     .nohint:
(1)  369/  88383A : 4E75                		rts
(1)  370/  88383C :                     
(1)  371/  88383C :                     ; --------------------------------------------------------
(1)  372/  88383C :                     ; System_SramInit
(1)  373/  88383C :                     ; 
(1)  374/  88383C :                     ; Init save data
(1)  375/  88383C :                     ; 
(1)  376/  88383C :                     ; Uses:
(1)  377/  88383C :                     ; a4,d4-d5
(1)  378/  88383C :                     ; --------------------------------------------------------
(1)  379/  88383C :                     
(1)  380/  88383C :                     ; TODO: Check if RV bit is needed here...
(1)  381/  88383C :                     System_SramInit:
(1)  382/  88383C : 13FC 0001 00A1 30F1 		move.b	#1,(md_bank_sram).l
(1)  383/  883844 : 49F9 0020 0001      		lea	($200001).l,a4
(1)  384/  88384A : 7800                		moveq	#0,d4
(1)  385/  88384C : 3A3C 1FFF           		move.w	#($4000/2)-1,d5
(1)  386/  883850 :                     .initsave:
(1)  387/  883850 : 1884                		move.b	d4,(a4)
(1)  388/  883852 : D8FC 0002           		adda	#2,a4
(1)  389/  883856 : 51CD FFF8           		dbf	d5,.initsave
(1)  390/  88385A : 13FC 0000 00A1 30F1 		move.b	#0,(md_bank_sram).l
(1)  391/  883862 : 4E75                		rts
(1)  392/  883864 :                     
(1)  393/  883864 :                     ; --------------------------------------------------------
(1)  394/  883864 :                     ; System_VBlnk_Enter, System_VBlnk_Exit
(1)  395/  883864 :                     ;
(1)  396/  883864 :                     ; Call System_VBlank to wait for the next frame.
(1)  397/  883864 :                     ; This will also update the control input and
(1)  398/  883864 :                     ; do DMA transfers
(1)  399/  883864 :                     ; --------------------------------------------------------
(1)  400/  883864 :                     
(1)  401/  883864 :                     System_VBlank:
(1)  402/  883864 :                     
(1)  403/  883864 :                     .wait_vblnk:
(1)  404/  883864 : 3839 00C0 0004      		move.w	(vdp_ctrl),d4
(1)  405/  88386A : 0804 0003           		btst	#bitVint,d4
(1)  406/  88386E : 67F4                		beq.s	.wait_vblnk
(1)  407/  883870 : 6100 FC98           		bsr	System_Input			; Read inputs FIRST
(1)  408/  883874 :                     
(1)  409/  883874 :                     	; DMA'd Scroll and Palette
(1)  410/  883874 : 4DF9 00C0 0004      		lea	(vdp_ctrl),a6
(1)  411/  88387A : 3E3C 8100           		move.w	#$8100,d7			; DMA ON
(1)  412/  88387E : 1E38 A60B           		move.b	(RAM_VdpRegs+1),d7
(1)  413/  883882 : 08C7 0004           		bset	#bitDmaEnbl,d7
(1)  414/  883886 : 3C87                		move.w	d7,(a6)
(1)  415/  883888 :                     ; 		bsr	Sound_DMA_Pause			; Don't need this.
(1)  416/  883888 : 2CBC 9400 9328      		move.l	#$94009328,(a6)
(1)  417/  88388E : 2CBC 96CD 95F0      		move.l	#$96009500|(RAM_VerScroll<<7&$FF0000)|(RAM_VerScroll>>1&$FF),(a6)
(1)  418/  883894 : 3CBC 977F           		move.w	#$9700|(RAM_VerScroll>>17&$7F),(a6)
(1)  419/  883898 : 3E3C 4000           		move.w	#$4000,d7
(1)  420/  88389C : 3F3C 0090           		move.w	#$0010|$80,-(sp)
(1)  421/  8838A0 : 3C87                		move.w	d7,(a6)
(1)  422/  8838A2 : 3C9F                		move.w	(sp)+,(a6)
(1)  423/  8838A4 : 2CBC 9401 93E0      		move.l	#$940193E0,(a6)
(1)  424/  8838AA : 2CBC 96CC 9510      		move.l	#$96009500|(RAM_HorScroll<<7&$FF0000)|(RAM_HorScroll>>1&$FF),(a6)
(1)  425/  8838B0 : 3CBC 977F           		move.w	#$9700|(RAM_HorScroll>>17&$7F),(a6)
(1)  426/  8838B4 : 3E3C 7C00           		move.w	#$7C00,d7
(1)  427/  8838B8 : 3F3C 0083           		move.w	#$0003|$80,-(sp)
(1)  428/  8838BC : 3C87                		move.w	d7,(a6)
(1)  429/  8838BE : 3C9F                		move.w	(sp)+,(a6)
(1)  430/  8838C0 : 2CBC 9401 9318      		move.l	#$94019318,(a6)
(1)  431/  8838C6 : 2CBC 96CE 9518      		move.l	#$96009500|(RAM_Sprites<<7&$FF0000)|(RAM_Sprites>>1&$FF),(a6)
(1)  432/  8838CC : 3CBC 977F           		move.w	#$9700|(RAM_Sprites>>17&$7F),(a6)
(1)  433/  8838D0 : 3E3C 7800           		move.w	#$7800,d7
(1)  434/  8838D4 : 3F3C 0083           		move.w	#$0003|$80,-(sp)
(1)  435/  8838D8 : 3C87                		move.w	d7,(a6)
(1)  436/  8838DA : 3C9F                		move.w	(sp)+,(a6)
(1)  437/  8838DC : 2CBC 9400 9340      		move.l	#$94009340,(a6)
(1)  438/  8838E2 : 2CBC 96D0 9548      		move.l	#$96009500|(RAM_Palette<<7&$FF0000)|(RAM_Palette>>1&$FF),(a6)
(1)  439/  8838E8 : 3CBC 977F           		move.w	#$9700|(RAM_Palette>>17&$7F),(a6)
(1)  440/  8838EC : 3E3C C000           		move.w	#$C000,d7
(1)  441/  8838F0 : 3F3C 0080           		move.w	#$0000|$80,-(sp)		; Palette is transfered here so
(1)  442/  8838F4 : 3C87                		move.w	d7,(a6)				; those dots will not get shown
(1)  443/  8838F6 : 3C9F                		move.w	(sp)+,(a6)			; on non-CRT displays
(1)  444/  8838F8 :                     ; 		bsr	Sound_DMA_Resume		; Resume Z80 and SH2 direct
(1)  445/  8838F8 : 3E3C 8100           		move.w	#$8100,d7			; DMA OFF
(1)  446/  8838FC : 1E38 A60B           		move.b	(RAM_VdpRegs+1).w,d7
(1)  447/  883900 : 3C87                		move.w	d7,(a6)
(1)  448/  883902 :                     
(1)  449/  883902 : 6100 F85C           		bsr	Video_DmaBlast		; DMA tasks
(1)  450/  883906 : 06B9 0000 0001 FFFF 		add.l	#1,(RAM_Framecount).l
                    A606                
(1)  451/  883910 :                     
(1)  452/  883910 : 41F8 AA00           		lea	(RAM_MdDreq),a0
(1)  453/  883914 : 303C 0430           		move.w	#sizeof_dreq,d0
(1)  454/  883918 : 6132                		bsr	System_SendDreq
(1)  455/  88391A : 4E75                		rts
(1)  456/  88391C :                     
(1)  457/  88391C :                     ; ; --------------------------------------------------------
(1)  458/  88391C :                     ; ; System_JumpRamCode
(1)  459/  88391C :                     ; ;
(1)  460/  88391C :                     ; ; Transfer user code to RAM and jump into it.
(1)  461/  88391C :                     ; ;
(1)  462/  88391C :                     ; ; Input:
(1)  463/  88391C :                     ; ; d0 - ROM pointer to code
(1)  464/  88391C :                     ; ; --------------------------------------------------------
(1)  465/  88391C :                     ;
(1)  466/  88391C :                     ; System_JumpRamCode:
(1)  467/  88391C :                     ; 		or.l	#$880000,d0
(1)  468/  88391C :                     ; 		move.l	d0,a0
(1)  469/  88391C :                     ; 		lea	(RAMCODE_USER),a1
(1)  470/  88391C :                     ; 		move.w	#$8000-1,d7
(1)  471/  88391C :                     ; .copyme2:
(1)  472/  88391C :                     ; 		move.b	(a0)+,(a1)+
(1)  473/  88391C :                     ; 		dbf	d7,.copyme2
(1)  474/  88391C :                     ; 		jmp	(RAMCODE_USER).l
(1)  475/  88391C :                     
(1)  476/  88391C :                     ; --------------------------------------------------------
(1)  477/  88391C :                     ; Initialize current screen mode
(1)  478/  88391C :                     ; --------------------------------------------------------
(1)  479/  88391C :                     
(1)  480/  88391C :                     Mode_Init:
(1)  481/  88391C : 6100 F264           		bsr	Video_Clear
(1)  482/  883920 : 49F8 9000           		lea	(RAM_ModeBuff),a4
(1)  483/  883924 : 3A3C 03FF           		move.w	#(MAX_MDERAM/2)-1,d5
(1)  484/  883928 : 7800                		moveq	#0,d4
(1)  485/  88392A :                     .clr:
(1)  486/  88392A : 38C4                		move.w	d4,(a4)+
(1)  487/  88392C : 51CD FFFC           		dbf	d5,.clr
(1)  488/  883930 : 4E75                		rts
(1)  489/  883932 :                     
(1)  490/  883932 :                     ; ====================================================================
(1)  491/  883932 :                     ; ----------------------------------------------------------------
(1)  492/  883932 :                     ; Default interrupts
(1)  493/  883932 :                     ; ----------------------------------------------------------------
(1)  494/  883932 :                     
(1)  495/  883932 :                     ; --------------------------------------------------------
(1)  496/  883932 :                     ; VBlank
(1)  497/  883932 :                     ; --------------------------------------------------------
(1)  498/  883932 :                     
(1)  499/  883932 :                     VInt_Default:
(1)  500/  883932 : 48E7 FFFE           		movem.l	d0-a6,-(sp)
(1)  501/  883936 : 6100 FBD2           		bsr	System_Input
(1)  502/  88393A : 06B9 0000 0001 FFFF 		add.l	#1,(RAM_FrameCount).l
                    A606                
(1)  503/  883944 : 4CDF 7FFF           		movem.l	(sp)+,d0-a6		
(1)  504/  883948 : 4E73                		rte
(1)  505/  88394A :                     
(1)  506/  88394A :                     ; --------------------------------------------------------
(1)  507/  88394A :                     ; HBlank
(1)  508/  88394A :                     ; --------------------------------------------------------
(1)  509/  88394A :                     
(1)  510/  88394A :                     HInt_Default:
(1)  511/  88394A : 4E73                		rte
(1)  512/  88394C :                     
(1)  513/  88394C :                     ; ====================================================================
(1)  514/  88394C :                     ; --------------------------------------------------------
(1)  515/  88394C :                     ; Send data to the 32X using DREQ
(1)  516/  88394C :                     ;
(1)  517/  88394C :                     ; Input:
(1)  518/  88394C :                     ; a0 - Data to send
(1)  519/  88394C :                     ; d0 - Size (8byte aligned)
(1)  520/  88394C :                     ;
(1)  521/  88394C :                     ; NOTE: THIS CODE ONLY WORKS PROPERLY ON
(1)  522/  88394C :                     ; THE $880000/$900000 AREAS.
(1)  523/  88394C :                     ; --------------------------------------------------------
(1)  524/  88394C :                     
(1)  525/  88394C :                     System_SendDreq:
(1)  526/  88394C : 40C7                		move.w	sr,d7
(1)  527/  88394E : 46FC 2700           		move.w	#$2700,sr
(1)  528/  883952 : 4BF9 00A1 5112      		lea	($A15112).l,a5			; a5 - DREQ FIFO port
(1)  529/  883958 : 3C00                		move.w	d0,d6				; Lenght in bytes
(1)  530/  88395A : E24E                		lsr.w	#1,d6				; lenght/2
(1)  531/  88395C :                     .retry:
(1)  532/  88395C : 33FC 0000 00A1 5106 		move.w	#0,(sysmars_reg+dreqctl).l	; Reset 68S
(1)  533/  883964 : 33C6 00A1 5110      		move.w	d6,(sysmars_reg+dreqlen).l	; Set transfer LENght
(1)  534/  88396A : 08F9 0002 00A1 5107 		bset	#2,(sysmars_reg+dreqctl+1).l	; Set 68S bit
(1)  535/  883972 : 08F9 0000 00A1 5103 		bset	#0,(sysmars_reg+standby).l	; Request Master CMD
(1)  536/  88397A :                     ; .wait_cmd:	btst	#0,(sysmars_reg+standby).l
(1)  537/  88397A :                     ; 		bne.s	.wait_cmd
(1)  538/  88397A : 0839 0006 00A1 512C .wait_bit:	btst	#6,(sysmars_reg+comm12).l	; Wait comm bit signal from SH2 to fill the first words.
(1)  539/  883982 : 67F6                		beq.s	.wait_bit
(1)  540/  883984 : 08B9 0006 00A1 512C 		bclr	#6,(sysmars_reg+comm12).l	; Clear it afterwards.
(1)  541/  88398C :                     
(1)  542/  88398C :                     	; *** CRITICAL PART ***
(1)  543/  88398C : 3A06                		move.w	d6,d5			; (lenght/2)/4
(1)  544/  88398E : E44D                		lsr.w	#2,d5
(1)  545/  883990 : 9A7C 0001           		sub.w	#1,d5			; minus 1 for the loop
(1)  546/  883994 : 3A98                .l0:		move.w  (a0)+,(a5)
(1)  547/  883996 : 3A98                		move.w  (a0)+,(a5)
(1)  548/  883998 : 3A98                		move.w  (a0)+,(a5)
(1)  549/  88399A : 3A98                		move.w  (a0)+,(a5)
(1)  550/  88399C :                     ; .l1:		btst	#7,(sysmars_reg+dreqctl+1).l
(1)  551/  88399C :                     ; 		bne.s	.l1
(1)  552/  88399C : 51CD FFF6           		dbf	d5,.l0
(1)  553/  8839A0 :                     ; 		btst	#2,(sysmars_reg+dreqctl).l
(1)  554/  8839A0 :                     ; 		bne	.retry
(1)  555/  8839A0 : 46C7                		move.w	d7,sr
(1)  556/  8839A2 : 4E75                		rts
(1)  557/  8839A4 :                     
(1)  558/  8839A4 :                     ; ====================================================================
(1)  559/  8839A4 :                     ; ----------------------------------------------------------------
(1)  560/  8839A4 :                     ; System data
(1)  561/  8839A4 :                     ; ----------------------------------------------------------------
(1)  562/  8839A4 :                     
      31/  8839A4 :                     		include "code/default.asm"
(1)    1/  8839A4 :                     ; ====================================================================
(1)    2/  8839A4 :                     ; ----------------------------------------------------------------
(1)    3/  8839A4 :                     ; Default gamemode
(1)    4/  8839A4 :                     ; ----------------------------------------------------------------
(1)    5/  8839A4 :                     
(1)    6/  8839A4 :                     ; ====================================================================
(1)    7/  8839A4 :                     ; ------------------------------------------------------
(1)    8/  8839A4 :                     ; Variables
(1)    9/  8839A4 :                     ; ------------------------------------------------------
(1)   10/  8839A4 :                     
(1)   11/  8839A4 : =$4000              var_MoveSpd	equ	$4000
(1)   12/  8839A4 : =$3                 MAX_TSTTRKS	equ	3
(1)   13/  8839A4 : =$4                 MAX_TSTENTRY	equ	4
(1)   14/  8839A4 :                     
(1)   15/  8839A4 :                     ; ====================================================================
(1)   16/  8839A4 :                     ; ------------------------------------------------------
(1)   17/  8839A4 :                     ; Structs
(1)   18/  8839A4 :                     ; ------------------------------------------------------
(1)   19/  8839A4 :                     
(1)   20/  8839A4 :                     ; 		struct 0
(1)   21/  8839A4 :                     ; strc_xpos	ds.w 1
(1)   22/  8839A4 :                     ; strc_ypos	ds.w 1
(1)   23/  8839A4 :                     ; 		finish
(1)   24/  8839A4 :                     
(1)   25/  8839A4 :                     ; ====================================================================
(1)   26/  8839A4 :                     ; ------------------------------------------------------
(1)   27/  8839A4 :                     ; This mode's RAM
(1)   28/  8839A4 :                     ; ------------------------------------------------------
(1)   29/  8839A4 :                     
(1)   30/  8839A4 : (MACRO)             		struct RAM_ModeBuff
(1)   30/  8839A4 : =$8839A4            GLBL_LASTPC     set *
(1)   30/    39A4 :                                     dephase
(1)   30/    39A4 : =$39A4              GLBL_LASTORG    set *
(1)   30/FFFFFFFFFFFF9000 :                                     phase RAM_MODEBUFF
(1)   31/FFFFFFFFFFFF9000 :                     
(1)   32/FFFFFFFFFFFF9000 :                     ; RAM_EmiPosX	ds.l 1
(1)   33/FFFFFFFFFFFF9000 :                     ; RAM_EmiPosY	ds.l 1
(1)   34/FFFFFFFFFFFF9000 :                     ; RAM_Ypos	ds.l 1
(1)   35/FFFFFFFFFFFF9000 :                     ; RAM_XposFg	ds.l 1
(1)   36/FFFFFFFFFFFF9000 :                     ; RAM_XposBg	ds.l 1
(1)   37/FFFFFFFFFFFF9000 :                     
(1)   38/FFFFFFFFFFFF9000 :                     RAM_CurrPage	ds.w 1
(1)   39/FFFFFFFFFFFF9002 :                     RAM_CurrGfx	ds.w 1
(1)   40/FFFFFFFFFFFF9004 :                     RAM_CurrSelc	ds.w 1
(1)   41/FFFFFFFFFFFF9006 :                     
(1)   42/FFFFFFFFFFFF9006 :                     ; RAM_EmiChar	ds.w 1
(1)   43/FFFFFFFFFFFF9006 :                     ; RAM_EmiAnim	ds.w 1
(1)   44/FFFFFFFFFFFF9006 :                     ; RAM_EmiFrame	ds.w 1
(1)   45/FFFFFFFFFFFF9006 :                     ; RAM_EmiHide	ds.w 1
(1)   46/FFFFFFFFFFFF9006 :                     ; RAM_CurrPage	ds.w 1
(1)   47/FFFFFFFFFFFF9006 :                     ; RAM_CurrSelc	ds.w 1
(1)   48/FFFFFFFFFFFF9006 :                     ; RAM_CurrIndx	ds.w 1
(1)   49/FFFFFFFFFFFF9006 :                     ; RAM_CurrTrack	ds.w 1
(1)   50/FFFFFFFFFFFF9006 :                     ; RAM_CurrTicks	ds.w 1
(1)   51/FFFFFFFFFFFF9006 :                     ; RAM_CurrTempo	ds.w 1
(1)   52/FFFFFFFFFFFF9006 :                     ; RAM_WindowCurr	ds.w 1
(1)   53/FFFFFFFFFFFF9006 :                     ; RAM_WindowNew	ds.w 1
(1)   54/FFFFFFFFFFFF9006 :                     ;
(1)   55/FFFFFFFFFFFF9006 :                     ; RAM_WaveTmr	ds.w 1
(1)   56/FFFFFFFFFFFF9006 :                     ; RAM_WaveTmr2	ds.w 1
(1)   57/FFFFFFFFFFFF9006 :                     ; RAM_BgCamera	ds.w 1
(1)   58/FFFFFFFFFFFF9006 : (MACRO)             		finish
(1)   58/FFFFFFFFFFFF9000 :                                     !org GLBL_LASTORG
(1)   58/  8839A4 :                                     phase GLBL_LASTPC
(1)   59/  8839A4 :                     
(1)   60/  8839A4 :                     ; ====================================================================
(1)   61/  8839A4 :                     ; ------------------------------------------------------
(1)   62/  8839A4 :                     ; Code start
(1)   63/  8839A4 :                     ; ------------------------------------------------------
(1)   64/  8839A4 :                     
(1)   65/  8839A4 :                     thisCode_Top:
(1)   66/  8839A4 : 46FC 2700           		move.w	#$2700,sr
(1)   67/  8839A8 : 6100 CFD6           		bsr	Sound_init
(1)   68/  8839AC : 6100 F182           		bsr	Video_init
(1)   69/  8839B0 : 6100 FAD6           		bsr	System_Init
(1)   70/  8839B4 : 08B9 0006 FFFF A60B 		bclr	#bitDispEnbl,(RAM_VdpRegs+1).l	; Enable Genesis display
(1)   71/  8839BC : 6100 F234           		bsr	Video_Update
(1)   72/  8839C0 : 6100 FF5A           		bsr	Mode_Init
(1)   73/  8839C4 : 6100 F42E           		bsr	Video_PrintInit
(1)   74/  8839C8 :                     
(1)   75/  8839C8 :                     ; 		move.w	#$9200,d0
(1)   76/  8839C8 :                     ; 		move.w	d0,(RAM_WindowCurr).w
(1)   77/  8839C8 :                     ; 		move.w	d0,(RAM_WindowNew).w
(1)   78/  8839C8 :                     
(1)   79/  8839C8 :                     	; Load palettes for fade-in
(1)   80/  8839C8 : 41FA 052A           		lea	PAL_TESTBOARD(pc),a0
(1)   81/  8839CC : 7000                		moveq	#0,d0
(1)   82/  8839CE : 323C 0020           		move.w	#$20,d1
(1)   83/  8839D2 : 6100 F250           		bsr	Video_FadePal
(1)   84/  8839D6 : 4278 A110           		clr.w	(RAM_MdMarsPalFd).w
(1)   85/  8839DA : 4278 AA30           		clr.w	(RAM_MdDreq+Dreq_Palette).w
(1)   86/  8839DE :                     
(1)   87/  8839DE : 08F9 0006 FFFF A60B 		bset	#bitDispEnbl,(RAM_VdpRegs+1).l	; Enable Genesis display
(1)   88/  8839E6 : 13FC 0007 FFFF A615 		move.b	#%111,(RAM_VdpRegs+$B).l	; Horizontall linescroll
(1)   89/  8839EE : 6100 F202           		bsr	Video_Update
(1)   90/  8839F2 :                     
(1)   91/  8839F2 : 41FA 0428           		lea	MasterTrkList+$10(pc),a0
(1)   92/  8839F6 : 3228 000C           		move.w	$C(a0),d1
(1)   93/  8839FA : 3628 000E           		move.w	$E(a0),d3
(1)   94/  8839FE : 7000                		moveq	#0,d0
(1)   95/  883A00 : 7400                		moveq	#0,d2
(1)   96/  883A02 : 6100 D13A           		bsr	Sound_TrkPlay
(1)   97/  883A06 :                     ; 		move.w	#200+12,(RAM_CurrTempo).w
(1)   98/  883A06 :                     
(1)   99/  883A06 :                     	; QUICKJUMP
(1)  100/  883A06 : 31FC 0000 9000      		move.w	#0,(RAM_CurrPage).w
(1)  101/  883A0C :                     
(1)  102/  883A0C :                     
(1)  103/  883A0C : 41F8 AC30           		lea	(RAM_MdDreq+Dreq_Objects),a0
(1)  104/  883A10 : 20BC 0600 6358      		move.l	#MarsObj_test,mdl_data(a0)
(1)  105/  883A16 : 217C FFFF F800 0010 		move.l	#-$800,mdl_z_pos(a0)
(1)  106/  883A1E :                     ; 		move.l	#$4000,mdl_y_pos(a0)
(1)  107/  883A1E :                     
(1)  108/  883A1E : 41F8 AA14           		lea	(RAM_MdDreq+Dreq_SclData),a0
(1)  109/  883A22 : 20FC 0209 6318      		move.l	#TESTMARS_BG2,(a0)+
(1)  110/  883A28 : 20FC 0000 0000      		move.l	#$00000000,(a0)+	; X pos
(1)  111/  883A2E : 20FC 0000 0000      		move.l	#$00000000,(a0)+	; Y pos
(1)  112/  883A34 : 20FC 0001 0000      		move.l	#$00010000,(a0)+	; DX
(1)  113/  883A3A : 20FC 0001 0000      		move.l	#$00010000,(a0)+	; DY
(1)  114/  883A40 : 20FC 0000 0140      		move.l	#320,(a0)+
(1)  115/  883A46 : 20FC 0000 00E0      		move.l	#224,(a0)+
(1)  116/  883A4C :                     
(1)  117/  883A4C :                     ; ====================================================================
(1)  118/  883A4C :                     ; ------------------------------------------------------
(1)  119/  883A4C :                     ; Loop
(1)  120/  883A4C :                     ; ------------------------------------------------------
(1)  121/  883A4C :                     
(1)  122/  883A4C :                     .loop:
(1)  123/  883A4C : 6100 FE16           		bsr	System_VBlank
(1)  124/  883A50 : 3038 9000           		move.w	(RAM_CurrPage).w,d0
(1)  125/  883A54 : C07C 001F           		and.w	#%11111,d0
(1)  126/  883A58 : D040                		add.w	d0,d0
(1)  127/  883A5A : D040                		add.w	d0,d0
(1)  128/  883A5C : D040                		add.w	d0,d0
(1)  129/  883A5E : 4A78 9000           		tst.w	(RAM_CurrPage).w
(1)  130/  883A62 : 6B06                		bmi.s	.on_loop
(1)  131/  883A64 : D0BC 0000 0004      		add.l	#4,d0
(1)  132/  883A6A :                     .on_loop:
(1)  133/  883A6A : 4EBB 0004           		jsr	.list(pc,d0.w)
(1)  134/  883A6E : 60DC                		bra	.loop
(1)  135/  883A70 :                     
(1)  136/  883A70 :                     ; ====================================================================
(1)  137/  883A70 :                     ; ------------------------------------------------------
(1)  138/  883A70 :                     ; Mode sections
(1)  139/  883A70 :                     ; ------------------------------------------------------
(1)  140/  883A70 :                     
(1)  141/  883A70 :                     .list:
(1)  142/  883A70 : 6000 0062           		bra.w	.page0
(1)  143/  883A74 : 6000 0034           		bra.w	.page0_init
(1)  144/  883A78 :                     
(1)  145/  883A78 : 6000 0140           		bra.w	.page1
(1)  146/  883A7C : 6000 008A           		bra.w	.page1_init
(1)  147/  883A80 :                     
(1)  148/  883A80 : 6000 01EC           		bra.w	.page2
(1)  149/  883A84 : 6000 01AE           		bra.w	.page2_init
(1)  150/  883A88 :                     
(1)  151/  883A88 : 6000 02BA           		bra.w	.page3
(1)  152/  883A8C : 6000 027E           		bra.w	.page3_init
(1)  153/  883A90 :                     
(1)  154/  883A90 : 6000 0042           		bra.w	.page0
(1)  155/  883A94 : 6000 0014           		bra.w	.page0_init
(1)  156/  883A98 :                     
(1)  157/  883A98 : 6000 003A           		bra.w	.page0
(1)  158/  883A9C : 6000 000C           		bra.w	.page0_init
(1)  159/  883AA0 :                     
(1)  160/  883AA0 : 6000 0032           		bra.w	.page0
(1)  161/  883AA4 : 6000 0004           		bra.w	.page0_init
(1)  162/  883AA8 :                     
(1)  163/  883AA8 :                     ; ====================================================================
(1)  164/  883AA8 :                     ; --------------------------------------------------
(1)  165/  883AA8 :                     ; Page 0
(1)  166/  883AA8 :                     ; --------------------------------------------------
(1)  167/  883AA8 :                     
(1)  168/  883AA8 :                     .page0_ret:
(1)  169/  883AA8 : 4E75                		rts
(1)  170/  883AAA :                     .page0_init:
(1)  171/  883AAA : 6100 F0E6           		bsr	Video_ClearScreen
(1)  172/  883AAE : 6100 F344           		bsr	Video_PrintInit
(1)  173/  883AB2 : 0078 8000 9000      		or.w	#$8000,(RAM_CurrPage).w
(1)  174/  883AB8 : 4278 9004           		clr.w	(RAM_CurrSelc).w
(1)  175/  883ABC :                     
(1)  176/  883ABC : 303C 0000           		move.w	#0,d0
(1)  177/  883AC0 : 6100 F6AA           		bsr	Video_MarsSetGfx
(1)  178/  883AC4 : 41FA 037C           		lea	str_Title(pc),a0	; Print menu
(1)  179/  883AC8 : 203C 0000 0202      		move.l	#locate(0,2,2),d0
(1)  180/  883ACE : 6100 F350           		bsr	Video_Print
(1)  181/  883AD2 : 6118                		bsr	.page0_cursor
(1)  182/  883AD4 :                     .page0:
(1)  183/  883AD4 : 6100 F13C           		bsr	Video_RunFade
(1)  184/  883AD8 : 66CE                		bne	.page0_ret
(1)  185/  883ADA :                     
(1)  186/  883ADA : 3E38 A626           		move.w	(Controller_1+on_press),d7
(1)  187/  883ADE : 0807 0007           		btst	#bitJoyStart,d7
(1)  188/  883AE2 : 6612                		bne.s	.page0_jump
(1)  189/  883AE4 : 7003                		moveq	#3,d0			; Numof entries
(1)  190/  883AE6 : 6100 02EE           		bsr	.move_cursor_ud		; Move U/D
(1)  191/  883AEA : 67BC                		beq.s	.page0_ret
(1)  192/  883AEC :                     .page0_cursor:
(1)  193/  883AEC : 223C 0000 0203      		move.l	#locate(0,2,3),d1
(1)  194/  883AF2 : 6000 02D0           		bra	.print_cursor
(1)  195/  883AF6 :                     .page0_jump:
(1)  196/  883AF6 : 6100 029C           		bsr	.fade_out
(1)  197/  883AFA : 3038 9004           		move.w	(RAM_CurrSelc).w,d0
(1)  198/  883AFE : D07C 0001           		add.w	#1,d0
(1)  199/  883B02 : 31C0 9000           		move.w	d0,(RAM_CurrPage).w
(1)  200/  883B06 : 4E75                		rts
(1)  201/  883B08 :                     
(1)  202/  883B08 :                     ; ====================================================================
(1)  203/  883B08 :                     ; --------------------------------------------------
(1)  204/  883B08 :                     ; Page 1
(1)  205/  883B08 :                     ; --------------------------------------------------
(1)  206/  883B08 :                     
(1)  207/  883B08 :                     .page1_init:
(1)  208/  883B08 : 6100 F088           		bsr	Video_ClearScreen
(1)  209/  883B0C : 0078 8000 9000      		or.w	#$8000,(RAM_CurrPage).w
(1)  210/  883B12 : 4278 9004           		clr.w	(RAM_CurrSelc).w
(1)  211/  883B16 :                     
(1)  212/  883B16 : 41F8 AA00           		lea	(RAM_MdDreq),a0
(1)  213/  883B1A : 217C 0202 EB18 0008 		move.l	#TESTMARS_BG,Dreq_BgEx_Data(a0)
(1)  214/  883B22 : 217C 0000 0480 000C 		move.l	#1152,Dreq_BgEx_W(a0)
(1)  215/  883B2A : 217C 0000 0170 0010 		move.l	#368,Dreq_BgEx_H(a0)
(1)  216/  883B32 : 217C 0090 0000 0004 		move.l	#$00900000,Dreq_BgEx_Y(a0)	; Y add
(1)  217/  883B3A : 6100 FD28           		bsr	System_VBlank
(1)  218/  883B3E :                     
(1)  219/  883B3E : 203C 0001 6570      		move.l	#ART_FGTEST,d0
(1)  220/  883B44 : 323C 5000           		move.w	#$280*$20,d1
(1)  221/  883B48 : 343C 2280           		move.w	#ART_FGTEST_e-ART_FGTEST,d2
(1)  222/  883B4C : 6100 F618           		bsr	Video_LoadArt
(1)  223/  883B50 : 203C 0001 87F0      		move.l	#ART_BGTEST,d0
(1)  224/  883B56 : 323C 0020           		move.w	#1*$20,d1
(1)  225/  883B5A : 343C 3140           		move.w	#ART_BGTEST_e-ART_BGTEST,d2
(1)  226/  883B5E : 6100 F606           		bsr	Video_LoadArt
(1)  227/  883B62 : 41F9 0091 3570      		lea	(MAP_FGTEST),a0
(1)  228/  883B68 : 203C 0000 0000      		move.l	#locate(0,0,0),d0
(1)  229/  883B6E : 223C 003F 001F      		move.l	#mapsize(512,256),d1
(1)  230/  883B74 : 343C 2280           		move.w	#$2000+$0280,d2
(1)  231/  883B78 : 6100 F222           		bsr	Video_LoadMap
(1)  232/  883B7C : 41F9 0091 4570      		lea	(MAP_BGTEST),a0
(1)  233/  883B82 : 203C 0001 0000      		move.l	#locate(1,0,0),d0
(1)  234/  883B88 : 223C 003F 001F      		move.l	#mapsize(512,256),d1
(1)  235/  883B8E : 343C 0001           		move.w	#$0001,d2
(1)  236/  883B92 : 6100 F208           		bsr	Video_LoadMap
(1)  237/  883B96 : 303C 0002           		move.w	#2,d0
(1)  238/  883B9A : 6100 F5D0           		bsr	Video_MarsSetGfx
(1)  239/  883B9E : 41F9 0091 3258      		lea	(PalData_Mars_Test),a0
(1)  240/  883BA4 : 7000                		moveq	#0,d0
(1)  241/  883BA6 : 323C 0100           		move.w	#256,d1
(1)  242/  883BAA : 7401                		moveq	#1,d2
(1)  243/  883BAC : 6100 F5FA           		bsr	Video_FadePal_Mars
(1)  244/  883BB0 : 4278 A110           		clr.w	(RAM_MdMarsPalFd).w
(1)  245/  883BB4 : 6156                		bsr	.this_bg
(1)  246/  883BB6 : 6100 01AC           		bsr	.fade_in
(1)  247/  883BBA :                     .page1:
(1)  248/  883BBA : 6150                		bsr	.this_bg
(1)  249/  883BBC :                     
(1)  250/  883BBC : 2038 AA00           		move.l	(RAM_MdDreq+Dreq_BgEx_X).w,d0
(1)  251/  883BC0 : 2238 AA04           		move.l	(RAM_MdDreq+Dreq_BgEx_Y).w,d1
(1)  252/  883BC4 : 2A3C 0002 0000      		move.l	#$20000,d5
(1)  253/  883BCA : 3E38 A624           		move.w	(Controller_1+on_hold),d7
(1)  254/  883BCE : 0807 0003           		btst	#bitJoyRight,d7
(1)  255/  883BD2 : 6702                		beq.s	.nor_m
(1)  256/  883BD4 : D085                		add.l	d5,d0
(1)  257/  883BD6 :                     .nor_m:
(1)  258/  883BD6 : 0807 0002           		btst	#bitJoyLeft,d7
(1)  259/  883BDA : 6702                		beq.s	.nol_m
(1)  260/  883BDC : 9085                		sub.l	d5,d0
(1)  261/  883BDE :                     .nol_m:
(1)  262/  883BDE : 0807 0001           		btst	#bitJoyDown,d7
(1)  263/  883BE2 : 6702                		beq.s	.nod_m
(1)  264/  883BE4 : D285                		add.l	d5,d1
(1)  265/  883BE6 :                     .nod_m:
(1)  266/  883BE6 : 0807 0000           		btst	#bitJoyUp,d7
(1)  267/  883BEA : 6702                		beq.s	.nou_m
(1)  268/  883BEC : 9285                		sub.l	d5,d1
(1)  269/  883BEE :                     .nou_m:
(1)  270/  883BEE : 21C0 AA00           		move.l	d0,(RAM_MdDreq+Dreq_BgEx_X).w
(1)  271/  883BF2 : 21C1 AA04           		move.l	d1,(RAM_MdDreq+Dreq_BgEx_Y).w
(1)  272/  883BF6 :                     
(1)  273/  883BF6 : 3E38 A626           		move.w	(Controller_1+on_press),d7
(1)  274/  883BFA : 0807 0007           		btst	#bitJoyStart,d7
(1)  275/  883BFE : 670A                		beq.s	.page1_ret
(1)  276/  883C00 : 31FC 0000 9000      		move.w	#0,(RAM_CurrPage).w
(1)  277/  883C06 : 6100 018C           		bsr	.fade_out
(1)  278/  883C0A :                     .page1_ret:
(1)  279/  883C0A : 4E75                		rts
(1)  280/  883C0C :                     
(1)  281/  883C0C :                     .this_bg:
(1)  282/  883C0C : 2038 AA00           		move.l	(RAM_MdDreq+Dreq_BgEx_X).w,d0
(1)  283/  883C10 : 2200                		move.l	d0,d1
(1)  284/  883C12 : 4840                		swap	d0
(1)  285/  883C14 : 4841                		swap	d1
(1)  286/  883C16 : E288                		lsr.l	#1,d0
(1)  287/  883C18 : E489                		lsr.l	#2,d1
(1)  288/  883C1A : 4440                		neg.w	d0
(1)  289/  883C1C : 4441                		neg.w	d1
(1)  290/  883C1E : 41F8 9820           		lea	(RAM_HorScroll),a0
(1)  291/  883C22 : 3E3C 006F           		move.w	#(224/2)-1,d7
(1)  292/  883C26 :                     .next:
(1)  293/  883C26 : 30C0                		move.w	d0,(a0)+
(1)  294/  883C28 : 30C1                		move.w	d1,(a0)+
(1)  295/  883C2A : 30C0                		move.w	d0,(a0)+
(1)  296/  883C2C : 30C1                		move.w	d1,(a0)+
(1)  297/  883C2E : 51CF FFF6           		dbf	d7,.next
(1)  298/  883C32 : 4E75                		rts
(1)  299/  883C34 :                     
(1)  300/  883C34 :                     ; ====================================================================
(1)  301/  883C34 :                     ; --------------------------------------------------
(1)  302/  883C34 :                     ; Page 2
(1)  303/  883C34 :                     ; --------------------------------------------------
(1)  304/  883C34 :                     
(1)  305/  883C34 :                     .page2_init:
(1)  306/  883C34 : 6100 EF5C           		bsr	Video_ClearScreen
(1)  307/  883C38 : 0078 8000 9000      		or.w	#$8000,(RAM_CurrPage).w
(1)  308/  883C3E : 4278 9004           		clr.w	(RAM_CurrSelc).w
(1)  309/  883C42 :                     
(1)  310/  883C42 : 41FA 0288           		lea	str_Page2(pc),a0	; Print text
(1)  311/  883C46 : 203C 0000 0202      		move.l	#locate(0,2,2),d0
(1)  312/  883C4C : 6100 F1D2           		bsr	Video_Print
(1)  313/  883C50 : 303C 0003           		move.w	#3,d0
(1)  314/  883C54 : 6100 F516           		bsr	Video_MarsSetGfx
(1)  315/  883C58 : 41F9 0091 3330      		lea	(PalData_Mars_Test2),a0
(1)  316/  883C5E : 7000                		moveq	#0,d0
(1)  317/  883C60 : 323C 0100           		move.w	#256,d1
(1)  318/  883C64 : 7400                		moveq	#0,d2
(1)  319/  883C66 : 6100 F540           		bsr	Video_FadePal_Mars
(1)  320/  883C6A : 6100 00F8           		bsr	.fade_in
(1)  321/  883C6E :                     .page2:
(1)  322/  883C6E : 41F8 AA00           		lea	(RAM_MdDreq),a0
(1)  323/  883C72 : 2028 0018           		move.l	Dreq_SclX(a0),d0
(1)  324/  883C76 : 2228 001C           		move.l	Dreq_SclY(a0),d1
(1)  325/  883C7A : 2428 0020           		move.l	Dreq_SclDX(a0),d2
(1)  326/  883C7E : 2628 0024           		move.l	Dreq_SclDY(a0),d3
(1)  327/  883C82 : 283C 0000 0100      		move.l	#$100,d4
(1)  328/  883C88 : 2A3C 0000 0200      		move.l	#$200,d5
(1)  329/  883C8E :                     
(1)  330/  883C8E : 3E38 A624           		move.w	(Controller_1+on_hold),d7
(1)  331/  883C92 : 3C07                		move.w	d7,d6
(1)  332/  883C94 : 0807 0001           		btst	#bitJoyDown,d7
(1)  333/  883C98 : 6704                		beq.s	.noz_down
(1)  334/  883C9A : D284                		add.l	d4,d1
(1)  335/  883C9C : 9685                		sub.l	d5,d3
(1)  336/  883C9E :                     .noz_down:
(1)  337/  883C9E : 3C07                		move.w	d7,d6
(1)  338/  883CA0 : 0806 0000           		btst	#bitJoyUp,d6
(1)  339/  883CA4 : 6704                		beq.s	.noz_up
(1)  340/  883CA6 : 9284                		sub.l	d4,d1
(1)  341/  883CA8 : D685                		add.l	d5,d3
(1)  342/  883CAA :                     .noz_up:
(1)  343/  883CAA : 3C07                		move.w	d7,d6
(1)  344/  883CAC : 0806 0003           		btst	#bitJoyRight,d6
(1)  345/  883CB0 : 6704                		beq.s	.noz_r
(1)  346/  883CB2 : D084                		add.l	d4,d0
(1)  347/  883CB4 : 9485                		sub.l	d5,d2
(1)  348/  883CB6 :                     .noz_r:
(1)  349/  883CB6 : 3C07                		move.w	d7,d6
(1)  350/  883CB8 : 0806 0002           		btst	#bitJoyLeft,d6
(1)  351/  883CBC : 6704                		beq.s	.noz_l
(1)  352/  883CBE : 9084                		sub.l	d4,d0
(1)  353/  883CC0 : D485                		add.l	d5,d2
(1)  354/  883CC2 :                     .noz_l:
(1)  355/  883CC2 : 2140 0018           		move.l	d0,Dreq_SclX(a0)
(1)  356/  883CC6 : 2141 001C           		move.l	d1,Dreq_SclY(a0)
(1)  357/  883CCA : 2142 0020           		move.l	d2,Dreq_SclDX(a0)
(1)  358/  883CCE : 2143 0024           		move.l	d3,Dreq_SclDY(a0)
(1)  359/  883CD2 :                     
(1)  360/  883CD2 : 3C07                		move.w	d7,d6
(1)  361/  883CD4 : 0806 000A           		btst	#bitJoyX,d6
(1)  362/  883CD8 : 671C                		beq.s	.nox_x
(1)  363/  883CDA : 41F8 AA18           		lea	(RAM_MdDreq+Dreq_SclX),a0
(1)  364/  883CDE : 20FC 0000 0000      		move.l	#$00000000,(a0)+	; X pos
(1)  365/  883CE4 : 20FC 0000 0000      		move.l	#$00000000,(a0)+	; Y pos
(1)  366/  883CEA : 20FC 0001 0000      		move.l	#$00010000,(a0)+	; DX
(1)  367/  883CF0 : 20FC 0001 0000      		move.l	#$00010000,(a0)+	; DY
(1)  368/  883CF6 :                     .nox_x:
(1)  369/  883CF6 :                     
(1)  370/  883CF6 : 3E38 A626           		move.w	(Controller_1+on_press),d7
(1)  371/  883CFA : 0807 0007           		btst	#bitJoyStart,d7
(1)  372/  883CFE : 670A                		beq.s	.page2_ret
(1)  373/  883D00 : 31FC 0000 9000      		move.w	#0,(RAM_CurrPage).w
(1)  374/  883D06 : 6100 008C           		bsr	.fade_out
(1)  375/  883D0A :                     .page2_ret:
(1)  376/  883D0A : 4E75                		rts
(1)  377/  883D0C :                     
(1)  378/  883D0C :                     ; ====================================================================
(1)  379/  883D0C :                     ; --------------------------------------------------
(1)  380/  883D0C :                     ; Page 3
(1)  381/  883D0C :                     ; --------------------------------------------------
(1)  382/  883D0C :                     
(1)  383/  883D0C :                     .page3_init:
(1)  384/  883D0C : 6100 EE84           		bsr	Video_ClearScreen
(1)  385/  883D10 : 0078 8000 9000      		or.w	#$8000,(RAM_CurrPage).w
(1)  386/  883D16 : 4278 9004           		clr.w	(RAM_CurrSelc).w
(1)  387/  883D1A :                     
(1)  388/  883D1A : 41FA 01C4           		lea	str_Page3(pc),a0	; Print text
(1)  389/  883D1E : 203C 0000 0202      		move.l	#locate(0,2,2),d0
(1)  390/  883D24 : 6100 F0FA           		bsr	Video_Print
(1)  391/  883D28 : 303C 0004           		move.w	#4,d0
(1)  392/  883D2C : 6100 F43E           		bsr	Video_MarsSetGfx
(1)  393/  883D30 : 41F9 0091 3530      		lea	(MDLDATA_PAL_TEST),a0
(1)  394/  883D36 : 7000                		moveq	#0,d0
(1)  395/  883D38 : 323C 0100           		move.w	#256,d1
(1)  396/  883D3C : 7400                		moveq	#0,d2
(1)  397/  883D3E : 6100 F468           		bsr	Video_FadePal_Mars
(1)  398/  883D42 :                     
(1)  399/  883D42 : 6120                		bsr	.fade_in
(1)  400/  883D44 :                     .page3:
(1)  401/  883D44 :                     ; 		bsr	System_VBlank
(1)  402/  883D44 : 41F8 AC30           		lea	(RAM_MdDreq+Dreq_Objects),a0
(1)  403/  883D48 : 06A8 0000 4000 0014 		add.l	#$4000,mdl_x_rot(a0)
(1)  404/  883D50 :                     ; 		add.l	#$1000,mdl_z_rot(a0)
(1)  405/  883D50 : 3E38 A626           		move.w	(Controller_1+on_press),d7
(1)  406/  883D54 : 0807 0007           		btst	#bitJoyStart,d7
(1)  407/  883D58 : 6708                		beq.s	.page3_ret
(1)  408/  883D5A : 31FC 0000 9000      		move.w	#0,(RAM_CurrPage).w
(1)  409/  883D60 : 6132                		bsr	.fade_out
(1)  410/  883D62 :                     .page3_ret:
(1)  411/  883D62 : 4E75                		rts
(1)  412/  883D64 :                     
(1)  413/  883D64 :                     ; ====================================================================
(1)  414/  883D64 :                     ; ----------------------------------------------
(1)  415/  883D64 :                     ; common subs
(1)  416/  883D64 :                     ; ----------------------------------------------
(1)  417/  883D64 :                     
(1)  418/  883D64 :                     .fade_in:
(1)  419/  883D64 : 31FC 0001 A5F6      		move.w	#1,(RAM_FadeMdReq).w
(1)  420/  883D6A : 31FC 0001 A5FE      		move.w	#1,(RAM_FadeMarsReq).w
(1)  421/  883D70 : 31FC 0001 A5F8      		move.w	#1,(RAM_FadeMdIncr).w
(1)  422/  883D76 : 31FC 0004 A600      		move.w	#4,(RAM_FadeMarsIncr).w
(1)  423/  883D7C : 31FC 0002 A5FA      		move.w	#2,(RAM_FadeMdDelay).w
(1)  424/  883D82 : 31FC 0002 A602      		move.w	#2,(RAM_FadeMarsDelay).w
(1)  425/  883D88 :                     .inw:
(1)  426/  883D88 : 6100 FADA           		bsr	System_VBlank
(1)  427/  883D8C : 6100 EE84           		bsr	Video_RunFade
(1)  428/  883D90 : 66F6                		bne.s	.inw
(1)  429/  883D92 : 4E75                		rts
(1)  430/  883D94 :                     
(1)  431/  883D94 :                     .fade_out:
(1)  432/  883D94 : 31FC 0002 A5F6      		move.w	#2,(RAM_FadeMdReq).w
(1)  433/  883D9A : 31FC 0002 A5FE      		move.w	#2,(RAM_FadeMarsReq).w
(1)  434/  883DA0 : 31FC 0001 A5F8      		move.w	#1,(RAM_FadeMdIncr).w
(1)  435/  883DA6 : 31FC 0004 A600      		move.w	#4,(RAM_FadeMarsIncr).w
(1)  436/  883DAC : 31FC 0002 A5FA      		move.w	#2,(RAM_FadeMdDelay).w
(1)  437/  883DB2 : 31FC 0002 A602      		move.w	#2,(RAM_FadeMarsDelay).w
(1)  438/  883DB8 :                     .ind:
(1)  439/  883DB8 : 6100 FAAA           		bsr	System_VBlank
(1)  440/  883DBC : 6100 EE54           		bsr	Video_RunFade
(1)  441/  883DC0 : 66F6                		bne.s	.ind
(1)  442/  883DC2 : 4E75                		rts
(1)  443/  883DC4 :                     
(1)  444/  883DC4 :                     .print_cursor:
(1)  445/  883DC4 : 41FA 0076           		lea	str_Cursor(pc),a0
(1)  446/  883DC8 : 7000                		moveq	#0,d0
(1)  447/  883DCA : 3038 9004           		move.w	(RAM_CurrSelc).w,d0
(1)  448/  883DCE : D081                		add.l	d1,d0
(1)  449/  883DD0 : 6100 F04E           		bsr	Video_Print
(1)  450/  883DD4 : 4E75                		rts
(1)  451/  883DD6 :                     
(1)  452/  883DD6 :                     .move_cursor_ud:
(1)  453/  883DD6 : 7E00                		moveq	#0,d7
(1)  454/  883DD8 : 3C38 A626           		move.w	(Controller_1+on_press),d6
(1)  455/  883DDC : 0806 0000           		btst	#bitJoyUp,d6
(1)  456/  883DE0 : 670E                		beq.s	.p0_down
(1)  457/  883DE2 : 4A78 9004           		tst.w	(RAM_CurrSelc).w
(1)  458/  883DE6 : 6708                		beq.s	.p0_down
(1)  459/  883DE8 : 0478 0001 9004      		sub.w	#1,(RAM_CurrSelc).w
(1)  460/  883DEE : 7E01                		moveq	#1,d7
(1)  461/  883DF0 :                     .p0_down:
(1)  462/  883DF0 : 0806 0001           		btst	#bitJoyDown,d6
(1)  463/  883DF4 : 6710                		beq.s	.p0_up
(1)  464/  883DF6 : 3E38 9004           		move.w	(RAM_CurrSelc).w,d7
(1)  465/  883DFA : BE40                		cmp.w	d0,d7
(1)  466/  883DFC : 6C08                		bge.s	.p0_up
(1)  467/  883DFE : 0678 0001 9004      		add.w	#1,(RAM_CurrSelc).w
(1)  468/  883E04 : 7E01                		moveq	#1,d7
(1)  469/  883E06 :                     .p0_up:
(1)  470/  883E06 : 4A47                		tst.w	d7
(1)  471/  883E08 : 4E75                		rts
(1)  472/  883E0A :                     
(1)  473/  883E0A :                     ; 		lea	(MDLDATA_PAL_TEST),a0
(1)  474/  883E0A :                     ; 		cmp.w	#4,(RAM_CurrGfx).w
(1)  475/  883E0A :                     ; 		beq.s	.thispal
(1)  476/  883E0A :                     ; 		lea	(PalData_Mars_Test2),a0
(1)  477/  883E0A :                     ; 		cmp.w	#3,(RAM_CurrGfx).w
(1)  478/  883E0A :                     ; 		beq.s	.thispal
(1)  479/  883E0A :                     ; 		lea	(PalData_Mars_Test),a0
(1)  480/  883E0A :                     ; .thispal:
(1)  481/  883E0A :                     ; 		moveq	#0,d0
(1)  482/  883E0A :                     ; 		move.w	#256,d1
(1)  483/  883E0A :                     ; 		moveq	#0,d2
(1)  484/  883E0A :                     ; 		bsr	Video_FadePal_Mars
(1)  485/  883E0A :                     ; 		move.w	#1,(RAM_FadeMdReq).w		; FadeIn request on both sides
(1)  486/  883E0A :                     ; 		move.w	#1,(RAM_FadeMarsReq).w
(1)  487/  883E0A :                     ; 		move.w	#1,(RAM_FadeMdIncr).w
(1)  488/  883E0A :                     ; 		move.w	#4,(RAM_FadeMarsIncr).w
(1)  489/  883E0A :                     ; 		move.w	#2,(RAM_FadeMdDelay).w
(1)  490/  883E0A :                     ; 		move.w	#2,(RAM_FadeMarsDelay).w
(1)  491/  883E0A :                     ; 		move.w	(RAM_CurrGfx).w,d0
(1)  492/  883E0A :                     ; 		bsr	Video_MarsSetGfx
(1)  493/  883E0A :                     ; .page0_loop:
(1)  494/  883E0A :                     ; ; 		bsr	Emilie_MkSprite
(1)  495/  883E0A :                     ; 		bsr	Video_RunFade
(1)  496/  883E0A :                     ; 		bne	.loop
(1)  497/  883E0A :                     ; 		move.w	(Controller_1+on_press),d7
(1)  498/  883E0A :                     ; 		btst	#bitJoyStart,d7
(1)  499/  883E0A :                     ; 		beq.s	.no_mode0
(1)  500/  883E0A :                     ; 		move.w	#1,(RAM_CurrPage).w
(1)  501/  883E0A :                     ; 		move.w	#$920D,(RAM_WindowNew).w
(1)  502/  883E0A :                     ; .no_mode0:
(1)  503/  883E0A :                     ; 		move.w	(Controller_1+on_press),d7
(1)  504/  883E0A :                     ; 		btst	#bitJoyZ,d7
(1)  505/  883E0A :                     ; 		beq.s	.noah
(1)  506/  883E0A :                     ; 		moveq	#0,d2
(1)  507/  883E0A :                     ; 		bsr	PlayThisSfx
(1)  508/  883E0A :                     ; .noah:
(1)  509/  883E0A :                     ;
(1)  510/  883E0A :                     ; 		move.l	(RAM_MdDreq+Dreq_BgEx_X).w,d0
(1)  511/  883E0A :                     ; 		move.l	(RAM_MdDreq+Dreq_BgEx_Y).w,d1
(1)  512/  883E0A :                     ; 		move.l	#$10000,d5
(1)  513/  883E0A :                     ; 		move.l	#1,d6
(1)  514/  883E0A :                     ; 		move.w	(Controller_1+on_hold),d7
(1)  515/  883E0A :                     ; 		btst	#bitJoyRight,d7
(1)  516/  883E0A :                     ; 		beq.s	.nor_m
(1)  517/  883E0A :                     ; 		add.l	d5,d0
(1)  518/  883E0A :                     ; 		sub.w	d6,d2
(1)  519/  883E0A :                     ; .nor_m:
(1)  520/  883E0A :                     ; 		btst	#bitJoyLeft,d7
(1)  521/  883E0A :                     ; 		beq.s	.nol_m
(1)  522/  883E0A :                     ; 		sub.l	d5,d0
(1)  523/  883E0A :                     ; 		add.w	d6,d2
(1)  524/  883E0A :                     ; .nol_m:
(1)  525/  883E0A :                     ; 		btst	#bitJoyDown,d7
(1)  526/  883E0A :                     ; 		beq.s	.nod_m
(1)  527/  883E0A :                     ; 		add.l	d5,d1
(1)  528/  883E0A :                     ; 		add.w	d6,d3
(1)  529/  883E0A :                     ; .nod_m:
(1)  530/  883E0A :                     ; 		btst	#bitJoyUp,d7
(1)  531/  883E0A :                     ; 		beq.s	.nou_m
(1)  532/  883E0A :                     ; 		sub.l	d5,d1
(1)  533/  883E0A :                     ; 		sub.w	d6,d3
(1)  534/  883E0A :                     ; .nou_m:
(1)  535/  883E0A :                     ; 		move.l	d0,(RAM_MdDreq+Dreq_BgEx_X).w
(1)  536/  883E0A :                     ; 		move.l	d1,(RAM_MdDreq+Dreq_BgEx_Y).w
(1)  537/  883E0A :                     ;
(1)  538/  883E0A :                     ; 		move.l	#0,d0
(1)  539/  883E0A :                     ; 		move.l	#0,d1
(1)  540/  883E0A :                     ; 		moveq	#0,d2
(1)  541/  883E0A :                     ; 		move.w	(Controller_1+on_press),d7
(1)  542/  883E0A :                     ; 		btst	#bitJoyB,d7
(1)  543/  883E0A :                     ; 		beq.s	.nor_m2
(1)  544/  883E0A :                     ; 		add.w	#1,(RAM_CurrGfx).w
(1)  545/  883E0A :                     ; 		moveq	#1,d2
(1)  546/  883E0A :                     ; .nor_m2:
(1)  547/  883E0A :                     ; 		btst	#bitJoyA,d7
(1)  548/  883E0A :                     ; 		beq.s	.nol_m2
(1)  549/  883E0A :                     ; 		sub.w	#1,(RAM_CurrGfx).w
(1)  550/  883E0A :                     ; 		moveq	#1,d2
(1)  551/  883E0A :                     ; .nol_m2:
(1)  552/  883E0A :                     ;
(1)  553/  883E0A :                     ; 		tst.w	d2
(1)  554/  883E0A :                     ; 		beq.s	.no_chng
(1)  555/  883E0A :                     ;
(1)  556/  883E0A :                     ; 		move.w	#2,(RAM_FadeMdReq).w		; FadeIn request on both sides
(1)  557/  883E0A :                     ; 		move.w	#2,(RAM_FadeMarsReq).w
(1)  558/  883E0A :                     ; 		move.w	#1,(RAM_FadeMdIncr).w
(1)  559/  883E0A :                     ; 		move.w	#4,(RAM_FadeMarsIncr).w
(1)  560/  883E0A :                     ; 		move.w	#2,(RAM_FadeMdDelay).w
(1)  561/  883E0A :                     ; 		move.w	#2,(RAM_FadeMarsDelay).w
(1)  562/  883E0A :                     ; .fadeout:
(1)  563/  883E0A :                     ; 		bsr	Video_RunFade
(1)  564/  883E0A :                     ; 		beq.s	.exit
(1)  565/  883E0A :                     ; 		bsr	System_VBlank
(1)  566/  883E0A :                     ; 		lea	(RAM_MdDreq),a0
(1)  567/  883E0A :                     ; 		move.w	#sizeof_dreq,d0
(1)  568/  883E0A :                     ; 		bsr	System_SendDreq
(1)  569/  883E0A :                     ; 		bra.s	.fadeout
(1)  570/  883E0A :                     ; .exit
(1)  571/  883E0A :                     ; 		move.w	#0,(RAM_CurrPage).w
(1)  572/  883E0A :                     ; ; .thispal:
(1)  573/  883E0A :                     ; ; 		moveq	#0,d2
(1)  574/  883E0A :                     ; ; 		moveq	#0,d0
(1)  575/  883E0A :                     ; ; 		move.w	#256,d1
(1)  576/  883E0A :                     ; ; 		bsr	Video_LoadPal_Mars
(1)  577/  883E0A :                     ; ; 		clr.w	(RAM_MdDreq+Dreq_Palette).w
(1)  578/  883E0A :                     ; .no_chng:
(1)  579/  883E0A :                     ; 		bsr	.move_model
(1)  580/  883E0A :                     
(1)  581/  883E0A :                     ; 	; Move Emily Fujiwara
(1)  582/  883E0A :                     ; 	; UDLR
(1)  583/  883E0A :                     ; 		move.w	(Controller_1+on_hold),d7
(1)  584/  883E0A :                     ; 		move.w	d7,d6
(1)  585/  883E0A :                     ; 		btst	#bitJoyDown,d7
(1)  586/  883E0A :                     ; 		beq.s	.noz_down
(1)  587/  883E0A :                     ; 		move.w	#0,(RAM_EmiFrame).w
(1)  588/  883E0A :                     ; 		add.w	#1,(RAM_EmiAnim).w
(1)  589/  883E0A :                     ; 		add.w	#1,(RAM_EmiPosY).w
(1)  590/  883E0A :                     ; .noz_down:
(1)  591/  883E0A :                     ; 		move.w	d7,d6
(1)  592/  883E0A :                     ; 		btst	#bitJoyUp,d6
(1)  593/  883E0A :                     ; 		beq.s	.noz_up
(1)  594/  883E0A :                     ; 		move.w	#4,(RAM_EmiFrame).w
(1)  595/  883E0A :                     ; 		add.w	#1,(RAM_EmiAnim).w
(1)  596/  883E0A :                     ; 		add.w	#-1,(RAM_EmiPosY).w
(1)  597/  883E0A :                     ; .noz_up:
(1)  598/  883E0A :                     ; 		move.w	d7,d6
(1)  599/  883E0A :                     ; 		btst	#bitJoyRight,d6
(1)  600/  883E0A :                     ; 		beq.s	.noz_r
(1)  601/  883E0A :                     ; 		move.w	#8,(RAM_EmiFrame).w
(1)  602/  883E0A :                     ; 		add.w	#1,(RAM_EmiAnim).w
(1)  603/  883E0A :                     ; 		add.w	#1,(RAM_EmiPosX).w
(1)  604/  883E0A :                     ; .noz_r:
(1)  605/  883E0A :                     ; 		move.w	d7,d6
(1)  606/  883E0A :                     ; 		btst	#bitJoyLeft,d6
(1)  607/  883E0A :                     ; 		beq.s	.noz_l
(1)  608/  883E0A :                     ; 		move.w	#$C,(RAM_EmiFrame).w
(1)  609/  883E0A :                     ; 		add.w	#1,(RAM_EmiAnim).w
(1)  610/  883E0A :                     ; 		add.w	#-1,(RAM_EmiPosX).w
(1)  611/  883E0A :                     ; .noz_l:
(1)  612/  883E0A :                     
(1)  613/  883E0A :                     ; 		lea	(RAM_MdDreq),a0
(1)  614/  883E0A :                     ; 		move.l	Dreq_SclX(a0),d0
(1)  615/  883E0A :                     ; 		move.l	Dreq_SclY(a0),d1
(1)  616/  883E0A :                     ; 		move.l	Dreq_SclDX(a0),d2
(1)  617/  883E0A :                     ; 		move.l	Dreq_SclDY(a0),d3
(1)  618/  883E0A :                     ; 		move.l	#$100,d4
(1)  619/  883E0A :                     ; 		move.l	#$200,d5
(1)  620/  883E0A :                     ;
(1)  621/  883E0A :                     ; 		move.w	(Controller_1+on_hold),d7
(1)  622/  883E0A :                     ; 		move.w	d7,d6
(1)  623/  883E0A :                     ; 		btst	#bitJoyDown,d7
(1)  624/  883E0A :                     ; 		beq.s	.noz_down
(1)  625/  883E0A :                     ; 		add.l	d4,d1
(1)  626/  883E0A :                     ; 		sub.l	d5,d3
(1)  627/  883E0A :                     ; .noz_down:
(1)  628/  883E0A :                     ; 		move.w	d7,d6
(1)  629/  883E0A :                     ; 		btst	#bitJoyUp,d6
(1)  630/  883E0A :                     ; 		beq.s	.noz_up
(1)  631/  883E0A :                     ; 		sub.l	d4,d1
(1)  632/  883E0A :                     ; 		add.l	d5,d3
(1)  633/  883E0A :                     ; .noz_up:
(1)  634/  883E0A :                     ; 		move.w	d7,d6
(1)  635/  883E0A :                     ; 		btst	#bitJoyRight,d6
(1)  636/  883E0A :                     ; 		beq.s	.noz_r
(1)  637/  883E0A :                     ; 		add.l	d4,d0
(1)  638/  883E0A :                     ; 		sub.l	d5,d2
(1)  639/  883E0A :                     ; .noz_r:
(1)  640/  883E0A :                     ; 		move.w	d7,d6
(1)  641/  883E0A :                     ; 		btst	#bitJoyLeft,d6
(1)  642/  883E0A :                     ; 		beq.s	.noz_l
(1)  643/  883E0A :                     ; 		sub.l	d4,d0
(1)  644/  883E0A :                     ; 		add.l	d5,d2
(1)  645/  883E0A :                     ; .noz_l:
(1)  646/  883E0A :                     ; 		move.l	d0,Dreq_SclX(a0)
(1)  647/  883E0A :                     ; 		move.l	d1,Dreq_SclY(a0)
(1)  648/  883E0A :                     ; 		move.l	d2,Dreq_SclDX(a0)
(1)  649/  883E0A :                     ; 		move.l	d3,Dreq_SclDY(a0)
(1)  650/  883E0A :                     ;
(1)  651/  883E0A :                     ; 		move.w	d7,d6
(1)  652/  883E0A :                     ; 		btst	#bitJoyX,d6
(1)  653/  883E0A :                     ; 		beq.s	.nox_x
(1)  654/  883E0A :                     ; 		lea	(RAM_MdDreq+Dreq_SclX),a0
(1)  655/  883E0A :                     ; 		move.l	#$00000000,(a0)+	; X pos
(1)  656/  883E0A :                     ; 		move.l	#$00000000,(a0)+	; Y pos
(1)  657/  883E0A :                     ; 		move.l	#$00010000,(a0)+	; DX
(1)  658/  883E0A :                     ; 		move.l	#$00010000,(a0)+	; DY
(1)  659/  883E0A :                     ; .nox_x:
(1)  660/  883E0A :                     
(1)  661/  883E0A :                     
(1)  662/  883E0A :                     ; 		move.w	d7,d6
(1)  663/  883E0A :                     ; 		btst	#bitJoyY,d6
(1)  664/  883E0A :                     ; 		beq.s	.noy
(1)  665/  883E0A :                     ; 		move.l	Dreq_SclDX(a0),d0
(1)  666/  883E0A :                     ; 		move.l	Dreq_SclDY(a0),d1
(1)  667/  883E0A :                     ; 		move.l	#$100,d2
(1)  668/  883E0A :                     ; 		add.l	d2,d0
(1)  669/  883E0A :                     ; 		add.l	d2,d1
(1)  670/  883E0A :                     ; 		move.l	d0,Dreq_SclDX(a0)
(1)  671/  883E0A :                     ; 		move.l	d1,Dreq_SclDY(a0)
(1)  672/  883E0A :                     ; .noy:
(1)  673/  883E0A :                     
(1)  674/  883E0A :                     ; 		bsr	Emilie_Move
(1)  675/  883E0A :                     ; 		bsr	.wave_backgrnd
(1)  676/  883E0A : 4E75                		rts
(1)  677/  883E0C :                     
(1)  678/  883E0C :                     ; .wave_backgrnd:
(1)  679/  883E0C :                     ; 	; wave background
(1)  680/  883E0C :                     ; 		lea	(RAM_HorScroll),a0
(1)  681/  883E0C :                     ; 		moveq	#112-1,d7
(1)  682/  883E0C :                     ; 		move.w	(RAM_WaveTmr),d0
(1)  683/  883E0C :                     ; 		move.w	#8,d1
(1)  684/  883E0C :                     ; .next:
(1)  685/  883E0C :                     ; 		bsr	System_SineWave
(1)  686/  883E0C :                     ; 		lsr.l	#8,d2
(1)  687/  883E0C :                     ; 		move.w	d2,2(a0)
(1)  688/  883E0C :                     ; 		adda	#4,a0
(1)  689/  883E0C :                     ; 		add.w	#1,d0
(1)  690/  883E0C :                     ; 		bsr	System_SineWave
(1)  691/  883E0C :                     ; 		lsr.l	#8,d2
(1)  692/  883E0C :                     ; 		move.w	d2,2(a0)
(1)  693/  883E0C :                     ; 		adda	#4,a0
(1)  694/  883E0C :                     ; 		add.w	#1,d0
(1)  695/  883E0C :                     ; 		dbf	d7,.next
(1)  696/  883E0C :                     ; 		add.w	#1,(RAM_WaveTmr).w
(1)  697/  883E0C :                     ;
(1)  698/  883E0C :                     ; 		lea	(RAM_VerScroll),a0
(1)  699/  883E0C :                     ; 		moveq	#(320/16)-1,d7
(1)  700/  883E0C :                     ; 		move.w	(RAM_WaveTmr),d0
(1)  701/  883E0C :                     ; 		move.w	#6,d1
(1)  702/  883E0C :                     ; .next2:
(1)  703/  883E0C :                     ; 		bsr	System_SineWave_Cos
(1)  704/  883E0C :                     ; 		lsr.l	#8,d2
(1)  705/  883E0C :                     ; 		move.w	d2,2(a0)
(1)  706/  883E0C :                     ; 		adda	#4,a0
(1)  707/  883E0C :                     ; 		add.w	#4,d0
(1)  708/  883E0C :                     ; 		dbf	d7,.next2
(1)  709/  883E0C :                     ; 		add.w	#1,(RAM_WaveTmr2).w
(1)  710/  883E0C :                     ;
(1)  711/  883E0C :                     ; ; 		bsr	Emilie_Move
(1)  712/  883E0C :                     ; ; 		bsr	Emilie_MkSprite
(1)  713/  883E0C :                     ; 		rts
(1)  714/  883E0C :                     ;
(1)  715/  883E0C :                     ; ; --------------------------------------------------
(1)  716/  883E0C :                     ; ; Mode 1
(1)  717/  883E0C :                     ; ; --------------------------------------------------
(1)  718/  883E0C :                     ;
(1)  719/  883E0C :                     ; .mode1:
(1)  720/  883E0C :                     ; 		tst.w	(RAM_CurrPage).w
(1)  721/  883E0C :                     ; 		bmi	.mode1_loop
(1)  722/  883E0C :                     ; 		or.w	#$8000,(RAM_CurrPage).w
(1)  723/  883E0C :                     ; 		bsr	.print_cursor
(1)  724/  883E0C :                     ; ; 		move.w	#1,(RAM_EmiHide).w
(1)  725/  883E0C :                     ; ; 		move.w	#1,(RAM_EmiUpd).w
(1)  726/  883E0C :                     ;
(1)  727/  883E0C :                     ; .mode1_loop:
(1)  728/  883E0C :                     ; 		move.w	(Controller_1+on_press),d7
(1)  729/  883E0C :                     ; 		btst	#bitJoyStart,d7
(1)  730/  883E0C :                     ; 		beq.s	.no_mode1
(1)  731/  883E0C :                     ; 		move.w	#0,(RAM_CurrPage).w
(1)  732/  883E0C :                     ; 		move.w	#$9200,(RAM_WindowNew).w
(1)  733/  883E0C :                     ; .no_mode1:
(1)  734/  883E0C :                     ; 		move.w	(Controller_1+on_press),d7
(1)  735/  883E0C :                     ; 		btst	#bitJoyY,d7
(1)  736/  883E0C :                     ; 		beq.s	.noy2
(1)  737/  883E0C :                     ; 		cmp.w	#1,(RAM_CurrIndx).w
(1)  738/  883E0C :                     ; 		beq.	.noy2
(1)  739/  883E0C :                     ; 		add.w	#1,(RAM_CurrIndx).w
(1)  740/  883E0C :                     ; 		bsr	.print_cursor
(1)  741/  883E0C :                     ; .noy2:
(1)  742/  883E0C :                     ; 		move.w	(Controller_1+on_hold),d7
(1)  743/  883E0C :                     ; 		btst	#bitJoyX,d7
(1)  744/  883E0C :                     ; 		beq.s	.nox2
(1)  745/  883E0C :                     ; 		tst.w	(RAM_CurrIndx).w
(1)  746/  883E0C :                     ; 		beq.s	.nox2
(1)  747/  883E0C :                     ; 		sub.w	#1,(RAM_CurrIndx).w
(1)  748/  883E0C :                     ; 		bsr	.print_cursor
(1)  749/  883E0C :                     ; .nox2:
(1)  750/  883E0C :                     ; 		move.w	(Controller_1+on_press),d7
(1)  751/  883E0C :                     ; 		btst	#bitJoyUp,d7
(1)  752/  883E0C :                     ; 		beq.s	.nou2
(1)  753/  883E0C :                     ; 		tst.w	(RAM_CurrSelc).w
(1)  754/  883E0C :                     ; 		beq.s	.nou2
(1)  755/  883E0C :                     ; 		sub.w	#1,(RAM_CurrSelc).w
(1)  756/  883E0C :                     ; 		bsr	.print_cursor
(1)  757/  883E0C :                     ; .nou2:
(1)  758/  883E0C :                     ; 		move.w	(Controller_1+on_press),d7
(1)  759/  883E0C :                     ; 		btst	#bitJoyDown,d7
(1)  760/  883E0C :                     ; 		beq.s	.nod2
(1)  761/  883E0C :                     ; 		cmp.w	#MAX_TSTENTRY,(RAM_CurrSelc).w
(1)  762/  883E0C :                     ; 		bge.s	.nod2
(1)  763/  883E0C :                     ; 		add.w	#1,(RAM_CurrSelc).w
(1)  764/  883E0C :                     ; 		bsr	.print_cursor
(1)  765/  883E0C :                     ; .nod2:
(1)  766/  883E0C :                     ;
(1)  767/  883E0C :                     ; 	; LEFT/RIGHT
(1)  768/  883E0C :                     ; 		lea	(RAM_CurrTrack),a1
(1)  769/  883E0C :                     ; 		cmp.w	#3,(RAM_CurrSelc).w
(1)  770/  883E0C :                     ; 		bne.s	.toptrk
(1)  771/  883E0C :                     ; 		add	#2,a1
(1)  772/  883E0C :                     ; .toptrk:
(1)  773/  883E0C :                     ; 		cmp.w	#4,(RAM_CurrSelc).w
(1)  774/  883E0C :                     ; 		bne.s	.toptrk2
(1)  775/  883E0C :                     ; 		add	#2*2,a1
(1)  776/  883E0C :                     ; .toptrk2:
(1)  777/  883E0C :                     ;
(1)  778/  883E0C :                     ; 		move.w	(Controller_1+on_hold),d7
(1)  779/  883E0C :                     ; 		and.w	#JoyB,d7
(1)  780/  883E0C :                     ; 		beq.s	.noba
(1)  781/  883E0C :                     ; 		add.w	#1,(a1)
(1)  782/  883E0C :                     ; 		bsr	.print_cursor
(1)  783/  883E0C :                     ; .noba:
(1)  784/  883E0C :                     ; 		move.w	(Controller_1+on_hold),d7
(1)  785/  883E0C :                     ; 		and.w	#JoyA,d7
(1)  786/  883E0C :                     ; 		beq.s	.noaa
(1)  787/  883E0C :                     ; 		sub.w	#1,(a1)
(1)  788/  883E0C :                     ; 		bsr	.print_cursor
(1)  789/  883E0C :                     ; .noaa:
(1)  790/  883E0C :                     ;
(1)  791/  883E0C :                     ;
(1)  792/  883E0C :                     ;
(1)  793/  883E0C :                     ; 		move.w	(Controller_1+on_press),d7
(1)  794/  883E0C :                     ; 		btst	#bitJoyLeft,d7
(1)  795/  883E0C :                     ; 		beq.s	.nol
(1)  796/  883E0C :                     ; ; 		tst.w	(a1)
(1)  797/  883E0C :                     ; ; 		beq.s	.nol
(1)  798/  883E0C :                     ; 		sub.w	#1,(a1)
(1)  799/  883E0C :                     ; 		bsr	.print_cursor
(1)  800/  883E0C :                     ; .nol:
(1)  801/  883E0C :                     ; 		move.w	(Controller_1+on_press),d7
(1)  802/  883E0C :                     ; 		btst	#bitJoyRight,d7
(1)  803/  883E0C :                     ; 		beq.s	.nor
(1)  804/  883E0C :                     ; ; 		cmp.w	#MAX_TSTTRKS,(a1)
(1)  805/  883E0C :                     ; ; 		bge.s	.nor
(1)  806/  883E0C :                     ; 		add.w	#1,(a1)
(1)  807/  883E0C :                     ; 		bsr	.print_cursor
(1)  808/  883E0C :                     ; .nor:
(1)  809/  883E0C :                     ;
(1)  810/  883E0C :                     ; 		move.w	(Controller_1+on_press),d7
(1)  811/  883E0C :                     ; 		and.w	#JoyC,d7
(1)  812/  883E0C :                     ; 		beq.s	.noc_c
(1)  813/  883E0C :                     ; 		move.w	(RAM_CurrIndx).w,d0
(1)  814/  883E0C :                     ; 		bsr	.procs_task
(1)  815/  883E0C :                     ; .noc_c:
(1)  816/  883E0C :                     ;
(1)  817/  883E0C :                     ; ; 		bsr	.wave_backgrnd
(1)  818/  883E0C :                     ; ; 		lea	str_COMM(pc),a0
(1)  819/  883E0C :                     ; ; 		move.l	#locate(0,2,9),d0
(1)  820/  883E0C :                     ; ; 		bsr	Video_Print
(1)  821/  883E0C :                     ; ; 		rts
(1)  822/  883E0C :                     ;
(1)  823/  883E0C :                     ; .move_model:
(1)  824/  883E0C :                     ; 		lea	(RAM_MdDreq+Dreq_Objects),a0
(1)  825/  883E0C :                     ; 		add.l	#$4000,mdl_x_rot(a0)
(1)  826/  883E0C :                     ; ; 		add.l	#$1000,mdl_z_rot(a0)
(1)  827/  883E0C :                     ; 		rts
(1)  828/  883E0C :                     ;
(1)  829/  883E0C :                     ; ; --------------------------------------------------
(1)  830/  883E0C :                     ;
(1)  831/  883E0C :                     ; .print_cursor:
(1)  832/  883E0C :                     ; ; 		lea	str_Status(pc),a0
(1)  833/  883E0C :                     ; ; 		move.l	#locate(2,20,4),d0
(1)  834/  883E0C :                     ; ; 		bsr	Video_Print
(1)  835/  883E0C :                     ; 		lea	str_Cursor(pc),a0
(1)  836/  883E0C :                     ; 		moveq	#0,d0
(1)  837/  883E0C :                     ; 		move.w	(RAM_CurrSelc).w,d0
(1)  838/  883E0C :                     ; 		add.l	#locate(2,2,5),d0
(1)  839/  883E0C :                     ; 		bsr	Video_Print
(1)  840/  883E0C :                     ; 		rts
(1)  841/  883E0C :                     ;
(1)  842/  883E0C :                     ; ; d1 - Track slot
(1)  843/  883E0C :                     ; .procs_task:
(1)  844/  883E0C :                     ; 		move.w	(RAM_CurrSelc).w,d7
(1)  845/  883E0C :                     ; 		add.w	d7,d7
(1)  846/  883E0C :                     ; 		move.w	.tasklist(pc,d7.w),d7
(1)  847/  883E0C :                     ; 		jmp	.tasklist(pc,d7.w)
(1)  848/  883E0C :                     ; .tasklist:
(1)  849/  883E0C :                     ; 		dc.w .task_00-.tasklist
(1)  850/  883E0C :                     ; 		dc.w .task_01-.tasklist
(1)  851/  883E0C :                     ; 		dc.w .task_02-.tasklist
(1)  852/  883E0C :                     ; 		dc.w .task_03-.tasklist
(1)  853/  883E0C :                     ; 		dc.w .task_04-.tasklist
(1)  854/  883E0C :                     ; ; 		dc.w .task_05-.tasklist
(1)  855/  883E0C :                     ;
(1)  856/  883E0C :                     ; ; d0 - Track slot
(1)  857/  883E0C :                     ; .task_00:
(1)  858/  883E0C :                     ; 		lea	MasterTrkList(pc),a0
(1)  859/  883E0C :                     ; 		move.w	(RAM_CurrTrack).w,d7
(1)  860/  883E0C :                     ; 		lsl.w	#4,d7
(1)  861/  883E0C :                     ; 		lea	(a0,d7.w),a0
(1)  862/  883E0C :                     ; 		move.w	$C(a0),d1
(1)  863/  883E0C :                     ; 		moveq	#0,d2
(1)  864/  883E0C :                     ; 		move.w	$E(a0),d3
(1)  865/  883E0C :                     ; 		bra	Sound_TrkPlay
(1)  866/  883E0C :                     ; .task_01:
(1)  867/  883E0C :                     ; 		bra	Sound_TrkStop
(1)  868/  883E0C :                     ; .task_02:
(1)  869/  883E0C :                     ; 		bra	Sound_TrkResume
(1)  870/  883E0C :                     ; .task_03:
(1)  871/  883E0C :                     ; 		move.w	(RAM_CurrTicks).w,d1
(1)  872/  883E0C :                     ; 		bra	Sound_TrkTicks
(1)  873/  883E0C :                     ; .task_04:
(1)  874/  883E0C :                     ; 		move.w	(RAM_CurrTempo).w,d1
(1)  875/  883E0C :                     ; 		bra	Sound_GlbTempo
(1)  876/  883E0C :                     ;
(1)  877/  883E0C :                     ; ; test playlist
(1)  878/  883E0C :                     MasterTrkList:
(1)  879/  883E0C : 0090 4195 0090 4193 	dc.l GemaPat_Test,GemaBlk_Test,GemaIns_Test
                    0090 602F           
(1)  880/  883E18 : 0003 0001           	dc.w 3,%001
(1)  881/  883E1C : 0090 6058 0090 6043 	dc.l GemaPat_Test2,GemaBlk_Test2,GemaIns_Test2
                    0090 7D17           
(1)  882/  883E28 : 0003 0001           	dc.w 3,%001
(1)  883/  883E2C : 0090 7D91 0090 7D73 	dc.l GemaPat_Test3,GemaBlk_Test3,GemaIns_Test3
                    0090 D580           
(1)  884/  883E38 : 0003 0001           	dc.w 3,%001
(1)  885/  883E3C :                     
(1)  886/  883E3C :                     	align 2
(1)  887/  883E3C :                     ;
(1)  888/  883E3C :                     ; ; ====================================================================
(1)  889/  883E3C :                     ; ; ------------------------------------------------------
(1)  890/  883E3C :                     ; ; Subroutines
(1)  891/  883E3C :                     ; ; ------------------------------------------------------
(1)  892/  883E3C :                     ;
(1)  893/  883E3C :                     ; ; d2 - BLOCK
(1)  894/  883E3C :                     ; PlayThisSfx:
(1)  895/  883E3C :                     ; 		lea	(GemaTrkData_Sfx),a0
(1)  896/  883E3C :                     ; 		moveq	#1,d0
(1)  897/  883E3C :                     ; 		moveq	#6,d1
(1)  898/  883E3C :                     ; ; 		moveq	#0,d2
(1)  899/  883E3C :                     ; 		moveq	#0,d3
(1)  900/  883E3C :                     ; 		bra	Sound_TrkPlay
(1)  901/  883E3C :                     ;
(1)  902/  883E3C :                     ;
(1)  903/  883E3C :                     ; Emilie_Move:
(1)  904/  883E3C :                     ;
(1)  905/  883E3C :                     ; 		lea	(Controller_2),a0
(1)  906/  883E3C :                     ; 		move.b	(a0),d0
(1)  907/  883E3C :                     ; 		cmp.b	#$03,d0
(1)  908/  883E3C :                     ; 		bne.s	.not_mouse
(1)  909/  883E3C :                     ;
(1)  910/  883E3C :                     ; 		move.w	#320,d2
(1)  911/  883E3C :                     ; 		move.w	(RAM_EmiPosX).w,d1
(1)  912/  883E3C :                     ; 		move.w	mouse_x(a0),d0
(1)  913/  883E3C :                     ; 		muls.w	#$0E,d0
(1)  914/  883E3C :                     ; 		asr.w	#4,d0
(1)  915/  883E3C :                     ; 		add.w	d0,d1
(1)  916/  883E3C :                     ; 		or.w	d1,d1
(1)  917/  883E3C :                     ; 		bpl.s	.left_x
(1)  918/  883E3C :                     ; 		clr.w	d1
(1)  919/  883E3C :                     ; .left_x:
(1)  920/  883E3C :                     ; 		cmp.w	d2,d1
(1)  921/  883E3C :                     ; 		blt.s	.right_x
(1)  922/  883E3C :                     ; 		move.w	d2,d1
(1)  923/  883E3C :                     ; .right_x:
(1)  924/  883E3C :                     ; 		move.w	d1,(RAM_EmiPosX).w
(1)  925/  883E3C :                     ;
(1)  926/  883E3C :                     ; 		move.w	#224,d2
(1)  927/  883E3C :                     ; 		move.w	(RAM_EmiPosY).w,d1
(1)  928/  883E3C :                     ; 		move.w	mouse_Y(a0),d0
(1)  929/  883E3C :                     ; 		muls.w	#$0E,d0
(1)  930/  883E3C :                     ; 		asr.w	#4,d0
(1)  931/  883E3C :                     ; 		add.w	d0,d1
(1)  932/  883E3C :                     ; 		or.w	d1,d1
(1)  933/  883E3C :                     ; 		bpl.s	.left_y
(1)  934/  883E3C :                     ; 		clr.w	d1
(1)  935/  883E3C :                     ; .left_y:
(1)  936/  883E3C :                     ; 		cmp.w	d2,d1
(1)  937/  883E3C :                     ; 		blt.s	.right_y
(1)  938/  883E3C :                     ; 		move.w	d2,d1
(1)  939/  883E3C :                     ; .right_y:
(1)  940/  883E3C :                     ; 		move.w	d1,(RAM_EmiPosY).w
(1)  941/  883E3C :                     ;
(1)  942/  883E3C :                     ; .not_mouse:
(1)  943/  883E3C :                     ; 		rts
(1)  944/  883E3C :                     ;
(1)  945/  883E3C :                     ; Emilie_MkSprite:
(1)  946/  883E3C :                     ; 		lea	(RAM_Sprites),a6
(1)  947/  883E3C :                     ; 		move.l	(RAM_EmiPosY),d0
(1)  948/  883E3C :                     ; 		move.l	(RAM_EmiPosX),d1
(1)  949/  883E3C :                     ; 		swap	d0
(1)  950/  883E3C :                     ; 		swap	d1
(1)  951/  883E3C :                     ; 		add.w	#$80+32,d0
(1)  952/  883E3C :                     ; 		add.w	#$80+32,d1
(1)  953/  883E3C :                     ; 		move.w	(RAM_EmiAnim),d2
(1)  954/  883E3C :                     ; 		lsr.w	#3,d2
(1)  955/  883E3C :                     ; 		and.w	#%11,d2
(1)  956/  883E3C :                     ; 		move.w	(RAM_EmiFrame),d3
(1)  957/  883E3C :                     ; 		add.w	d3,d2
(1)  958/  883E3C :                     ; 		add.w	d2,d2
(1)  959/  883E3C :                     ; 		lea	Map_Nicole(pc),a0
(1)  960/  883E3C :                     ; 		move.w	(a0,d2.w),d2
(1)  961/  883E3C :                     ; 		adda	d2,a0
(1)  962/  883E3C :                     ; 		move.b	(a0)+,d4
(1)  963/  883E3C :                     ; 		and.w	#$FF,d4
(1)  964/  883E3C :                     ; 		sub.w	#1,d4
(1)  965/  883E3C :                     ; 		move.w	#$0001,d5
(1)  966/  883E3C :                     ; 		move.w	#$0500|$2000,d6
(1)  967/  883E3C :                     ; .nxt_pz:
(1)  968/  883E3C :                     ; 		move.b	(a0)+,d3
(1)  969/  883E3C :                     ; 		ext.w	d3
(1)  970/  883E3C :                     ; 		add.w	d0,d3
(1)  971/  883E3C :                     ; 		move.w	d3,(a6)+
(1)  972/  883E3C :                     ;
(1)  973/  883E3C :                     ; 		move.b	(a0)+,d3
(1)  974/  883E3C :                     ; 		lsl.w	#8,d3
(1)  975/  883E3C :                     ; 		add.w	d5,d3
(1)  976/  883E3C :                     ; 		move.w	d3,(a6)+
(1)  977/  883E3C :                     ;
(1)  978/  883E3C :                     ; 		move.b	(a0)+,d3
(1)  979/  883E3C :                     ; 		lsl.w	#8,d3
(1)  980/  883E3C :                     ; 		move.b	(a0)+,d2
(1)  981/  883E3C :                     ; 		and.w	#$FF,d2
(1)  982/  883E3C :                     ; 		add.w	d3,d2
(1)  983/  883E3C :                     ; 		add.w	d6,d2
(1)  984/  883E3C :                     ; 		move.w	d2,(a6)+
(1)  985/  883E3C :                     ;
(1)  986/  883E3C :                     ; 		move.b	(a0)+,d3
(1)  987/  883E3C :                     ; 		ext.w	d3
(1)  988/  883E3C :                     ; 		add.w	d1,d3
(1)  989/  883E3C :                     ; 		move.w	d3,(a6)+
(1)  990/  883E3C :                     ; 		add.w	#1,d5
(1)  991/  883E3C :                     ; 		dbf	d4,.nxt_pz
(1)  992/  883E3C :                     ; 		clr.l	(a6)+
(1)  993/  883E3C :                     ; 		clr.l	(a6)+
(1)  994/  883E3C :                     ;
(1)  995/  883E3C :                     ; 	; DPLC
(1)  996/  883E3C :                     ; 		move.w	(RAM_EmiAnim),d2
(1)  997/  883E3C :                     ; 		lsr.w	#3,d2
(1)  998/  883E3C :                     ; 		and.w	#%11,d2
(1)  999/  883E3C :                     ; 		move.w	(RAM_EmiFrame),d3
(1) 1000/  883E3C :                     ; 		add.w	d3,d2
(1) 1001/  883E3C :                     ; 		add.w	d2,d2
(1) 1002/  883E3C :                     ; 		lea	Dplc_Nicole(pc),a0
(1) 1003/  883E3C :                     ; 		move.w	(a0,d2.w),d2
(1) 1004/  883E3C :                     ; 		adda	d2,a0
(1) 1005/  883E3C :                     ; 		move.w	(a0)+,d4
(1) 1006/  883E3C :                     ; 		and.w	#$FF,d4
(1) 1007/  883E3C :                     ; 		sub.w	#1,d4
(1) 1008/  883E3C :                     ; 		move.w	#$500,d5
(1) 1009/  883E3C :                     ;
(1) 1010/  883E3C :                     ;
(1) 1011/  883E3C :                     ; 	; d0 - graphics
(1) 1012/  883E3C :                     ; 	; d5 - VRAM OUTPUT
(1) 1013/  883E3C :                     ; 		lsl.w	#5,d5
(1) 1014/  883E3C :                     ; .nxt_dpz:
(1) 1015/  883E3C :                     ; 		move.l	#ART_EMI,d0
(1) 1016/  883E3C :                     ; 		move.w	(a0)+,d1
(1) 1017/  883E3C :                     ; 		move.w	d1,d2
(1) 1018/  883E3C :                     ; 		and.w	#$7FF,d1
(1) 1019/  883E3C :                     ; 		lsl.w	#5,d1
(1) 1020/  883E3C :                     ; 		add.l	d1,d0
(1) 1021/  883E3C :                     ; 		move.w	d5,d1
(1) 1022/  883E3C :                     ; 		lsr.w	#7,d2
(1) 1023/  883E3C :                     ; 		add.w	#$20,d2
(1) 1024/  883E3C :                     ; 		move.w	d2,d3
(1) 1025/  883E3C :                     ; 		bsr	Video_DmaMkEntry
(1) 1026/  883E3C :                     ; 		add.w	d3,d5
(1) 1027/  883E3C :                     ; 		dbf	d4,.nxt_dpz
(1) 1028/  883E3C :                     ; .no_upd:
(1) 1029/  883E3C :                     ; 		rts
(1) 1030/  883E3C :                     ; ;
(1) 1031/  883E3C :                     ; .hidefuji:
(1) 1032/  883E3C :                     ; 		lea	(RAM_Sprites),a6
(1) 1033/  883E3C :                     ; 		move.l	#0,(a6)+
(1) 1034/  883E3C :                     ; 		move.l	#0,(a6)+
(1) 1035/  883E3C :                     ; 		move.l	#0,(a6)+
(1) 1036/  883E3C :                     ; 		move.l	#0,(a6)+
(1) 1037/  883E3C :                     ; 		rts
(1) 1038/  883E3C :                     
(1) 1039/  883E3C :                     ; ====================================================================
(1) 1040/  883E3C :                     ; ------------------------------------------------------
(1) 1041/  883E3C :                     ; VBlank
(1) 1042/  883E3C :                     ; ------------------------------------------------------
(1) 1043/  883E3C :                     
(1) 1044/  883E3C :                     ; ------------------------------------------------------
(1) 1045/  883E3C :                     ; HBlank
(1) 1046/  883E3C :                     ; ------------------------------------------------------
(1) 1047/  883E3C :                     
(1) 1048/  883E3C :                     ; ====================================================================
(1) 1049/  883E3C :                     ; ------------------------------------------------------
(1) 1050/  883E3C :                     ; DATA
(1) 1051/  883E3C :                     ;
(1) 1052/  883E3C :                     ; Small stuff goes here
(1) 1053/  883E3C :                     ; ------------------------------------------------------
(1) 1054/  883E3C :                     
(1) 1055/  883E3C : 200A                str_Cursor:	dc.b " ",$A
(1) 1056/  883E3E : 3E0A                		dc.b ">",$A
(1) 1057/  883E40 : 2000                		dc.b " ",0
(1) 1058/  883E42 :                     		align 2
(1) 1059/  883E42 :                     
(1) 1060/  883E42 :                     str_Title:
(1) 1061/  883E42 : 4D41 5253 4941 4E4F 		dc.b "MARSIANO Project 32X 202X",$A
                    2050 726F 6A65 6374 
                    2033 3258 2032 3032 
                    580A                
(1) 1062/  883E5C : 0A                  		dc.b $A
(1) 1063/  883E5D : 2020 4772 6170 6869 		dc.b "  Graphics mode 01",$A
                    6373 206D 6F64 6520 
                    3031 0A             
(1) 1064/  883E70 : 2020 4772 6170 6869 		dc.b "  Graphics mode 02",$A
                    6373 206D 6F64 6520 
                    3032 0A             
(1) 1065/  883E83 : 2020 4772 6170 6869 		dc.b "  Graphics mode 03",$A
                    6373 206D 6F64 6520 
                    3033 0A             
(1) 1066/  883E96 : 2020 4745 4D41 2073 		dc.b "  GEMA sound player",0
                    6F75 6E64 2070 6C61 
                    7965 7200           
(1) 1067/  883EAA :                     		align 2
(1) 1068/  883EAA :                     
(1) 1069/  883EAA :                     str_Page1:
(1) 1070/  883EAA : 5465 7374 696E 6720 		dc.b "Testing GfxMode 01",0
                    4766 784D 6F64 6520 
                    3031 00             
(1) 1071/  883EBD :                     		align 2
(1) 1072/  883EBE :                     str_Page1_l:
(1) 1073/  883EBE : 5C6C 205C 6C00      		dc.b "\\l \\l",0
(1) 1074/  883EC4 : FFFF AA00           		dc.l RAM_MdDreq+Dreq_BgEx_X
(1) 1075/  883EC8 : FFFF AA04           		dc.l RAM_MdDreq+Dreq_BgEx_Y
(1) 1076/  883ECC :                     		align 2
(1) 1077/  883ECC :                     str_Page2:
(1) 1078/  883ECC : 5465 7374 696E 6720 		dc.b "Testing GfxMode 02",0
                    4766 784D 6F64 6520 
                    3032 00             
(1) 1079/  883EDF :                     		align 2
(1) 1080/  883EE0 :                     str_Page3:
(1) 1081/  883EE0 : 5465 7374 696E 6720 		dc.b "Testing 3D Objects",0
                    3344 204F 626A 6563 
                    7473 00             
(1) 1082/  883EF3 :                     		align 2
(1) 1083/  883EF4 :                     
(1) 1084/  883EF4 :                     ;
(1) 1085/  883EF4 :                     ; str_Status:
(1) 1086/  883EF4 :                     ; 		dc.b "\\w",$A,$A
(1) 1087/  883EF4 :                     ; 		dc.b "\\w",$A,$A,$A
(1) 1088/  883EF4 :                     ; 		dc.b "\\w",$A
(1) 1089/  883EF4 :                     ; 		dc.b "\\w",0
(1) 1090/  883EF4 :                     ; 		dc.l RAM_CurrIndx
(1) 1091/  883EF4 :                     ; 		dc.l RAM_CurrTrack
(1) 1092/  883EF4 :                     ; 		dc.l RAM_CurrTicks
(1) 1093/  883EF4 :                     ; 		dc.l RAM_CurrTempo
(1) 1094/  883EF4 :                     ; 		align 2
(1) 1095/  883EF4 :                     ; str_Gema:
(1) 1096/  883EF4 :                     ; 		dc.b "GEMA SOUND DRIVER TESTER",$A
(1) 1097/  883EF4 :                     ; 		dc.b $A
(1) 1098/  883EF4 :                     ; 		dc.b "Track index -----",$A,$A
(1) 1099/  883EF4 :                     ; 		dc.b "  Sound_TrkPlay",$A
(1) 1100/  883EF4 :                     ; 		dc.b "  Sound_TrkStop",$A
(1) 1101/  883EF4 :                     ; 		dc.b "  Sound_TrkResume",$A
(1) 1102/  883EF4 :                     ; 		dc.b "  Sound_TrkTicks",$A
(1) 1103/  883EF4 :                     ; 		dc.b "  Sound_GlbTempo",0
(1) 1104/  883EF4 :                     ; 		align 2
(1) 1105/  883EF4 :                     ; ; str_COMM:
(1) 1106/  883EF4 :                     ; ; 		dc.b "\\w \\w \\w \\w",$A
(1) 1107/  883EF4 :                     ; ; 		dc.b "\\w \\w \\w \\w",0
(1) 1108/  883EF4 :                     ; ; 		dc.l sysmars_reg+comm0
(1) 1109/  883EF4 :                     ; ; 		dc.l sysmars_reg+comm2
(1) 1110/  883EF4 :                     ; ; 		dc.l sysmars_reg+comm4
(1) 1111/  883EF4 :                     ; ; 		dc.l sysmars_reg+comm6
(1) 1112/  883EF4 :                     ; ; 		dc.l sysmars_reg+comm8
(1) 1113/  883EF4 :                     ; ; 		dc.l sysmars_reg+comm10
(1) 1114/  883EF4 :                     ; ; 		dc.l sysmars_reg+comm12
(1) 1115/  883EF4 :                     ; ; 		dc.l sysmars_reg+comm14
(1) 1116/  883EF4 :                     ; ; 		align 2
(1) 1117/  883EF4 :                     ;
(1) 1118/  883EF4 :                     ; str_InfoMouse:
(1) 1119/  883EF4 :                     ; 		dc.b "comm0: \\w",$A
(1) 1120/  883EF4 :                     ; 		dc.b "comm12: \\w comm14: \\w",$A,$A
(1) 1121/  883EF4 :                     ; ; 		dc.b "MD Framecount: \\l",$A
(1) 1122/  883EF4 :                     ; 		dc.b "\\l \\l",$A
(1) 1123/  883EF4 :                     ; 		dc.b "\\l \\l",0
(1) 1124/  883EF4 :                     ; 		dc.l sysmars_reg+comm0
(1) 1125/  883EF4 :                     ; 		dc.l sysmars_reg+comm12
(1) 1126/  883EF4 :                     ; 		dc.l sysmars_reg+comm14
(1) 1127/  883EF4 :                     ; ; 		dc.l RAM_Framecount
(1) 1128/  883EF4 :                     ; 		dc.l RAM_MdDreq+Dreq_SclX
(1) 1129/  883EF4 :                     ; 		dc.l RAM_MdDreq+Dreq_SclY
(1) 1130/  883EF4 :                     ; 		dc.l RAM_MdDreq+Dreq_SclDX
(1) 1131/  883EF4 :                     ; 		dc.l RAM_MdDreq+Dreq_SclDY
(1) 1132/  883EF4 :                     ;
(1) 1133/  883EF4 :                     ; ; 		dc.l RAM_MdDreq+Dreq_Objects+mdl_x_pos
(1) 1134/  883EF4 :                     ; ; 		dc.l RAM_MdDreq+Dreq_Objects+mdl_y_pos
(1) 1135/  883EF4 :                     ; ; 		dc.l RAM_MdDreq+Dreq_Objects+mdl_z_pos
(1) 1136/  883EF4 :                     ; 		align 2
(1) 1137/  883EF4 :                     
(1) 1138/  883EF4 :                     PAL_TESTBOARD:
(1) 1139/  883EF4 :                     		binclude "data/md/bg/bg_pal.bin"
(1) 1140/  883F14 :                     		binclude "data/md/bg/fg_pal.bin"
(1) 1141/  883F34 :                     		align 2
(1) 1142/  883F34 :                     PAL_BG:
(1) 1143/  883F34 :                     		binclude "data/md/bg/bg_pal.bin"
(1) 1144/  883F54 :                     		align 2
(1) 1145/  883F54 :                     
(1) 1146/  883F54 :                     Map_Nicole:
(1) 1147/  883F54 :                     		include "data/md/sprites/emi_map.asm"
(2)    1/  883F54 :                     .mappings:
(2)    2/  883F54 : 0020                		dc.w .frame_0-.mappings
(2)    3/  883F56 : 0030                		dc.w .frame_1-.mappings
(2)    4/  883F58 : 0045                		dc.w .frame_2-.mappings
(2)    5/  883F5A : 0055                		dc.w .frame_3-.mappings
(2)    6/  883F5C : 0065                		dc.w .frame_4-.mappings
(2)    7/  883F5E : 0075                		dc.w .frame_5-.mappings
(2)    8/  883F60 : 0085                		dc.w .frame_6-.mappings
(2)    9/  883F62 : 0095                		dc.w .frame_7-.mappings
(2)   10/  883F64 : 00A5                		dc.w .frame_8-.mappings
(2)   11/  883F66 : 00B5                		dc.w .frame_9-.mappings
(2)   12/  883F68 : 00C5                		dc.w .frame_10-.mappings
(2)   13/  883F6A : 00D5                		dc.w .frame_11-.mappings
(2)   14/  883F6C : 00E5                		dc.w .frame_12-.mappings
(2)   15/  883F6E : 00F5                		dc.w .frame_13-.mappings
(2)   16/  883F70 : 0105                		dc.w .frame_14-.mappings
(2)   17/  883F72 : 0115                		dc.w .frame_15-.mappings
(2)   18/  883F74 :                     .frame_0:
(2)   19/  883F74 : 03                  		dc.b $3
(2)   20/  883F75 :                     
(2)   21/  883F75 : C00F 0000 C0        		dc.b $C0,$F,$0,$0,$C0
(2)   22/  883F7A : E00C 0010 C0        		dc.b $E0,$C,$0,$10,$C0
(2)   23/  883F7F : E808 0014 C8        		dc.b $E8,$8,$0,$14,$C8
(2)   24/  883F84 :                     .frame_1:
(2)   25/  883F84 : 04                  		dc.b $4
(2)   26/  883F85 :                     
(2)   27/  883F85 : C00E 0000 C0        		dc.b $C0,$E,$0,$0,$C0
(2)   28/  883F8A : E00C 000C C0        		dc.b $E0,$C,$0,$C,$C0
(2)   29/  883F8F : D808 0010 C8        		dc.b $D8,$8,$0,$10,$C8
(2)   30/  883F94 : E804 0013 C8        		dc.b $E8,$4,$0,$13,$C8
(2)   31/  883F99 :                     .frame_2:
(2)   32/  883F99 : 03                  		dc.b $3
(2)   33/  883F9A :                     
(2)   34/  883F9A : C00F 0000 C0        		dc.b $C0,$F,$0,$0,$C0
(2)   35/  883F9F : E00C 0010 C0        		dc.b $E0,$C,$0,$10,$C0
(2)   36/  883FA4 : E808 0014 C8        		dc.b $E8,$8,$0,$14,$C8
(2)   37/  883FA9 :                     .frame_3:
(2)   38/  883FA9 : 03                  		dc.b $3
(2)   39/  883FAA :                     
(2)   40/  883FAA : C00F 0000 C0        		dc.b $C0,$F,$0,$0,$C0
(2)   41/  883FAF : E00C 0010 C0        		dc.b $E0,$C,$0,$10,$C0
(2)   42/  883FB4 : E804 0014 C8        		dc.b $E8,$4,$0,$14,$C8
(2)   43/  883FB9 :                     .frame_4:
(2)   44/  883FB9 : 03                  		dc.b $3
(2)   45/  883FBA :                     
(2)   46/  883FBA : C00F 0000 C0        		dc.b $C0,$F,$0,$0,$C0
(2)   47/  883FBF : E00C 0010 C0        		dc.b $E0,$C,$0,$10,$C0
(2)   48/  883FC4 : E808 0014 C8        		dc.b $E8,$8,$0,$14,$C8
(2)   49/  883FC9 :                     .frame_5:
(2)   50/  883FC9 : 03                  		dc.b $3
(2)   51/  883FCA :                     
(2)   52/  883FCA : C00F 0000 C0        		dc.b $C0,$F,$0,$0,$C0
(2)   53/  883FCF : E00C 0010 C0        		dc.b $E0,$C,$0,$10,$C0
(2)   54/  883FD4 : E804 0014 C8        		dc.b $E8,$4,$0,$14,$C8
(2)   55/  883FD9 :                     .frame_6:
(2)   56/  883FD9 : 03                  		dc.b $3
(2)   57/  883FDA :                     
(2)   58/  883FDA : C00F 0000 C0        		dc.b $C0,$F,$0,$0,$C0
(2)   59/  883FDF : E00C 0010 C0        		dc.b $E0,$C,$0,$10,$C0
(2)   60/  883FE4 : E808 0014 C8        		dc.b $E8,$8,$0,$14,$C8
(2)   61/  883FE9 :                     .frame_7:
(2)   62/  883FE9 : 03                  		dc.b $3
(2)   63/  883FEA :                     
(2)   64/  883FEA : C00F 0000 C0        		dc.b $C0,$F,$0,$0,$C0
(2)   65/  883FEF : E00C 0010 C0        		dc.b $E0,$C,$0,$10,$C0
(2)   66/  883FF4 : E804 0014 C8        		dc.b $E8,$4,$0,$14,$C8
(2)   67/  883FF9 :                     .frame_8:
(2)   68/  883FF9 : 03                  		dc.b $3
(2)   69/  883FFA :                     
(2)   70/  883FFA : C00B 0000 C0        		dc.b $C0,$B,$0,$0,$C0
(2)   71/  883FFF : E005 000C C8        		dc.b $E0,$5,$0,$C,$C8
(2)   72/  884004 : C002 0010 D8        		dc.b $C0,$2,$0,$10,$D8
(2)   73/  884009 :                     .frame_9:
(2)   74/  884009 : 03                  		dc.b $3
(2)   75/  88400A :                     
(2)   76/  88400A : C00F 0000 C0        		dc.b $C0,$F,$0,$0,$C0
(2)   77/  88400F : E80C 0010 C0        		dc.b $E8,$C,$0,$10,$C0
(2)   78/  884014 : E008 0014 C8        		dc.b $E0,$8,$0,$14,$C8
(2)   79/  884019 :                     .frame_10:
(2)   80/  884019 : 03                  		dc.b $3
(2)   81/  88401A :                     
(2)   82/  88401A : C00B 0000 C0        		dc.b $C0,$B,$0,$0,$C0
(2)   83/  88401F : E005 000C C8        		dc.b $E0,$5,$0,$C,$C8
(2)   84/  884024 : C002 0010 D8        		dc.b $C0,$2,$0,$10,$D8
(2)   85/  884029 :                     .frame_11:
(2)   86/  884029 : 03                  		dc.b $3
(2)   87/  88402A :                     
(2)   88/  88402A : C00F 0000 C0        		dc.b $C0,$F,$0,$0,$C0
(2)   89/  88402F : E80C 0010 C0        		dc.b $E8,$C,$0,$10,$C0
(2)   90/  884034 : E008 0014 C8        		dc.b $E0,$8,$0,$14,$C8
(2)   91/  884039 :                     .frame_12:
(2)   92/  884039 : 03                  		dc.b $3
(2)   93/  88403A :                     
(2)   94/  88403A : C00E 0000 C0        		dc.b $C0,$E,$0,$0,$C0
(2)   95/  88403F : D806 000C C8        		dc.b $D8,$6,$0,$C,$C8
(2)   96/  884044 : D800 0012 D8        		dc.b $D8,$0,$0,$12,$D8
(2)   97/  884049 :                     .frame_13:
(2)   98/  884049 : 03                  		dc.b $3
(2)   99/  88404A :                     
(2)  100/  88404A : C00F 0000 C0        		dc.b $C0,$F,$0,$0,$C0
(2)  101/  88404F : E009 0010 C0        		dc.b $E0,$9,$0,$10,$C0
(2)  102/  884054 : E800 0016 D8        		dc.b $E8,$0,$0,$16,$D8
(2)  103/  884059 :                     .frame_14:
(2)  104/  884059 : 03                  		dc.b $3
(2)  105/  88405A :                     
(2)  106/  88405A : C00E 0000 C0        		dc.b $C0,$E,$0,$0,$C0
(2)  107/  88405F : D806 000C C8        		dc.b $D8,$6,$0,$C,$C8
(2)  108/  884064 : D800 0012 D8        		dc.b $D8,$0,$0,$12,$D8
(2)  109/  884069 :                     .frame_15:
(2)  110/  884069 : 02                  		dc.b $2
(2)  111/  88406A :                     
(2)  112/  88406A : C00F 0000 C0        		dc.b $C0,$F,$0,$0,$C0
(2)  113/  88406F : E00D 0010 C0        		dc.b $E0,$D,$0,$10,$C0
(2)  114/  884074 :                     
(1) 1148/  884074 :                     		align 2
(1) 1149/  884074 :                     Dplc_Nicole:
(1) 1150/  884074 :                     		include "data/md/sprites/emi_plc.asm"
(2)    1/  884074 :                     .dplc:
(2)    2/  884074 : 0020                		dc.w .frame_0-.dplc
(2)    3/  884076 : 0028                		dc.w .frame_1-.dplc
(2)    4/  884078 : 0032                		dc.w .frame_2-.dplc
(2)    5/  88407A : 003A                		dc.w .frame_3-.dplc
(2)    6/  88407C : 0042                		dc.w .frame_4-.dplc
(2)    7/  88407E : 004A                		dc.w .frame_5-.dplc
(2)    8/  884080 : 0052                		dc.w .frame_6-.dplc
(2)    9/  884082 : 005A                		dc.w .frame_7-.dplc
(2)   10/  884084 : 0062                		dc.w .frame_8-.dplc
(2)   11/  884086 : 006A                		dc.w .frame_9-.dplc
(2)   12/  884088 : 0072                		dc.w .frame_10-.dplc
(2)   13/  88408A : 007A                		dc.w .frame_11-.dplc
(2)   14/  88408C : 0082                		dc.w .frame_12-.dplc
(2)   15/  88408E : 008A                		dc.w .frame_13-.dplc
(2)   16/  884090 : 0092                		dc.w .frame_14-.dplc
(2)   17/  884092 : 009A                		dc.w .frame_15-.dplc
(2)   18/  884094 :                     .frame_0:
(2)   19/  884094 : 0003                		dc.w $3
(2)   20/  884096 :                     
(2)   21/  884096 : F000                		dc.w $F000
(2)   22/  884098 : 3010                		dc.w $3010
(2)   23/  88409A : 2014                		dc.w $2014
(2)   24/  88409C :                     .frame_1:
(2)   25/  88409C : 0004                		dc.w $4
(2)   26/  88409E :                     
(2)   27/  88409E : B017                		dc.w $B017
(2)   28/  8840A0 : 3023                		dc.w $3023
(2)   29/  8840A2 : 2027                		dc.w $2027
(2)   30/  8840A4 : 102A                		dc.w $102A
(2)   31/  8840A6 :                     .frame_2:
(2)   32/  8840A6 : 0003                		dc.w $3
(2)   33/  8840A8 :                     
(2)   34/  8840A8 : F02C                		dc.w $F02C
(2)   35/  8840AA : 303C                		dc.w $303C
(2)   36/  8840AC : 2040                		dc.w $2040
(2)   37/  8840AE :                     .frame_3:
(2)   38/  8840AE : 0003                		dc.w $3
(2)   39/  8840B0 :                     
(2)   40/  8840B0 : F043                		dc.w $F043
(2)   41/  8840B2 : 3053                		dc.w $3053
(2)   42/  8840B4 : 1057                		dc.w $1057
(2)   43/  8840B6 :                     .frame_4:
(2)   44/  8840B6 : 0003                		dc.w $3
(2)   45/  8840B8 :                     
(2)   46/  8840B8 : F059                		dc.w $F059
(2)   47/  8840BA : 3069                		dc.w $3069
(2)   48/  8840BC : 206D                		dc.w $206D
(2)   49/  8840BE :                     .frame_5:
(2)   50/  8840BE : 0003                		dc.w $3
(2)   51/  8840C0 :                     
(2)   52/  8840C0 : F070                		dc.w $F070
(2)   53/  8840C2 : 3080                		dc.w $3080
(2)   54/  8840C4 : 1084                		dc.w $1084
(2)   55/  8840C6 :                     .frame_6:
(2)   56/  8840C6 : 0003                		dc.w $3
(2)   57/  8840C8 :                     
(2)   58/  8840C8 : F086                		dc.w $F086
(2)   59/  8840CA : 3096                		dc.w $3096
(2)   60/  8840CC : 209A                		dc.w $209A
(2)   61/  8840CE :                     .frame_7:
(2)   62/  8840CE : 0003                		dc.w $3
(2)   63/  8840D0 :                     
(2)   64/  8840D0 : F09D                		dc.w $F09D
(2)   65/  8840D2 : 30AD                		dc.w $30AD
(2)   66/  8840D4 : 10B1                		dc.w $10B1
(2)   67/  8840D6 :                     .frame_8:
(2)   68/  8840D6 : 0003                		dc.w $3
(2)   69/  8840D8 :                     
(2)   70/  8840D8 : B0B3                		dc.w $B0B3
(2)   71/  8840DA : 30BF                		dc.w $30BF
(2)   72/  8840DC : 20C3                		dc.w $20C3
(2)   73/  8840DE :                     .frame_9:
(2)   74/  8840DE : 0003                		dc.w $3
(2)   75/  8840E0 :                     
(2)   76/  8840E0 : F0C6                		dc.w $F0C6
(2)   77/  8840E2 : 30D6                		dc.w $30D6
(2)   78/  8840E4 : 20DA                		dc.w $20DA
(2)   79/  8840E6 :                     .frame_10:
(2)   80/  8840E6 : 0003                		dc.w $3
(2)   81/  8840E8 :                     
(2)   82/  8840E8 : B0DD                		dc.w $B0DD
(2)   83/  8840EA : 30E9                		dc.w $30E9
(2)   84/  8840EC : 20ED                		dc.w $20ED
(2)   85/  8840EE :                     .frame_11:
(2)   86/  8840EE : 0003                		dc.w $3
(2)   87/  8840F0 :                     
(2)   88/  8840F0 : F0F0                		dc.w $F0F0
(2)   89/  8840F2 : 3100                		dc.w $3100
(2)   90/  8840F4 : 2104                		dc.w $2104
(2)   91/  8840F6 :                     .frame_12:
(2)   92/  8840F6 : 0003                		dc.w $3
(2)   93/  8840F8 :                     
(2)   94/  8840F8 : B107                		dc.w $B107
(2)   95/  8840FA : 5113                		dc.w $5113
(2)   96/  8840FC : 0119                		dc.w $119
(2)   97/  8840FE :                     .frame_13:
(2)   98/  8840FE : 0003                		dc.w $3
(2)   99/  884100 :                     
(2)  100/  884100 : F11A                		dc.w $F11A
(2)  101/  884102 : 512A                		dc.w $512A
(2)  102/  884104 : 0130                		dc.w $130
(2)  103/  884106 :                     .frame_14:
(2)  104/  884106 : 0003                		dc.w $3
(2)  105/  884108 :                     
(2)  106/  884108 : B131                		dc.w $B131
(2)  107/  88410A : 513D                		dc.w $513D
(2)  108/  88410C : 0143                		dc.w $143
(2)  109/  88410E :                     .frame_15:
(2)  110/  88410E : 0002                		dc.w $2
(2)  111/  884110 :                     
(2)  112/  884110 : F144                		dc.w $F144
(2)  113/  884112 : 7154                		dc.w $7154
(2)  114/  884114 :                     
(1) 1151/  884114 :                     		align 2
(1) 1152/  884114 :                     
(1) 1153/  884114 :                     
(1) 1154/  884114 :                     ; ====================================================================
(1) 1155/  884114 :                     ; Report size
(1) 1160/  884114 :                     
      32/    4114 :                     		dephase
      33/    4114 :                     MdRamCode_end:
      34/    4114 :                     		align 2
      35/    4114 :                     
      36/    4114 :                     ; ====================================================================
      37/    4114 :                     ; ----------------------------------------------------------------
      38/    4114 :                     ; 68K DATA BANKs at $900000 1MB max
      39/    4114 :                     ; ----------------------------------------------------------------
      40/    4114 :                     
      41/    4114 :                     ; ---------------------------------------------
      42/    4114 :                     ; BANK 0
      43/    4114 :                     ;
      44/    4114 :                     ; First one is smaller than the others...
      45/    4114 :                     ; ---------------------------------------------
      46/    4114 :                     
      47/  904114 :                     		phase $900000+*				; Only one currently
      48/  904114 :                     		include "sound/tracks.asm"
(1)    1/  904114 :                     ; ================================================================
(1)    2/  904114 :                     ; ------------------------------------------------------------
(1)    3/  904114 :                     ; DATA SECTION
(1)    4/  904114 :                     ; 
(1)    5/  904114 :                     ; SOUND
(1)    6/  904114 :                     ; ------------------------------------------------------------
(1)    7/  904114 :                     
(1)    8/  904114 :                     ; PWM pitches:
(1)    9/  904114 :                     ; -17 - 8000
(1)   10/  904114 :                     
(1)   11/  904114 :                     ; Instrument macros
(1)   12/  904114 :                     ; do note that some 24-bit pointers add 90h to the MSB automaticly.
(1)   13/  904114 :                     ;
(1)   14/  904114 :                     ; TODO: this might fail.
(1)   15/  904114 :                     gInsNull macro
(1)   16/  904114 :                     	dc.b  -1,$00,$00,$00
(1)   17/  904114 :                     	dc.b $00,$00,$00,$00
(1)   18/  904114 :                     	endm
(1)   19/  904114 :                     
(1)   20/  904114 :                     ; alv: attack level (00=high)
(1)   21/  904114 :                     ; atk: attack rate
(1)   22/  904114 :                     ; slv: sustain (00=high)
(1)   23/  904114 :                     ; dky: decay rate (up)
(1)   24/  904114 :                     ; rrt: release rate (down)
(1)   25/  904114 :                     gInsPsg	macro pitch,alv,atk,slv,dky,rrt
(1)   26/  904114 :                     	dc.b $80,pitch,alv,atk
(1)   27/  904114 :                     	dc.b slv,dky,rrt,$00
(1)   28/  904114 :                     	endm
(1)   29/  904114 :                     
(1)   30/  904114 :                     ; same arguments as gInsPsg, but for the last one:
(1)   31/  904114 :                     ; mode: noise mode %tmm (PSGN only) t-Bass(0)|Noise(1) mm-Clock(0)|Clock/2(1)|Clock/4(2)|Tone3(3)
(1)   32/  904114 :                     gInsPsgN macro pitch,alv,atk,slv,dky,rrt,mode
(1)   33/  904114 :                     	dc.b $90|mode,pitch,alv,atk
(1)   34/  904114 :                     	dc.b slv,dky,rrt,0
(1)   35/  904114 :                     	endm
(1)   36/  904114 :                     
(1)   37/  904114 :                     ; fmins - 24-bit ROM pointer to patch data
(1)   38/  904114 :                     gInsFm macro pitch,fmins
(1)   39/  904114 :                     	dc.b $A0,pitch,((fmins>>16)&$FF),((fmins>>8)&$FF)
(1)   40/  904114 :                     	dc.b fmins&$FF,$00,$00,$00
(1)   41/  904114 :                     	endm
(1)   42/  904114 :                     
(1)   43/  904114 :                     ; Same as gInsFm
(1)   44/  904114 :                     ; But the last 4 words on the patch data are the custom frequencies
(1)   45/  904114 :                     ; for each operator in this order: OP1 OP2 OP3 OP4
(1)   46/  904114 :                     gInsFm3	macro pitch,fmins
(1)   47/  904114 :                     	dc.b $B0,pitch,((fmins>>16)&$FF),((fmins>>8)&$FF)
(1)   48/  904114 :                     	dc.b fmins&$FF,$00,$00,$00
(1)   49/  904114 :                     	endm
(1)   50/  904114 :                     
(1)   51/  904114 :                     ; start: Pointer to sample data:
(1)   52/  904114 :                     ;        dc.b end,end,end	; 24-bit LENGTH of the sample
(1)   53/  904114 :                     ;        dc.b loop,loop,loop	; 24-bit Loop point
(1)   54/  904114 :                     ;        dc.b (sound data)	; Then the actual sound data
(1)   55/  904114 :                     ; flags: %0-don't loop
(1)   56/  904114 :                     ; 	 %1-loop
(1)   57/  904114 :                     gInsDac	macro pitch,start,flags
(1)   58/  904114 :                     	dc.b $C0|flags,pitch,((start>>16)&$FF),((start>>8)&$FF)
(1)   59/  904114 :                     	dc.b start&$FF,0,0,0
(1)   60/  904114 :                     	endm
(1)   61/  904114 :                     
(1)   62/  904114 :                     ; start: Pointer to sample data:
(1)   63/  904114 :                     ;        dc.b end,end,end	; 24-bit LENGTH of the sample
(1)   64/  904114 :                     ;        dc.b loop,loop,loop	; 24-bit Loop point
(1)   65/  904114 :                     ;        dc.b (data)		; Then the actual sound data
(1)   66/  904114 :                     ; flags: %00SL
(1)   67/  904114 :                     ;        L - Loop sample No/Yes
(1)   68/  904114 :                     ;        S - Sample data is in stereo
(1)   69/  904114 :                     gInsPwm	macro pitch,start,flags
(1)   70/  904114 :                     	dc.b $D0|flags,pitch,((start>>24)&$FF),((start>>16)&$FF)
(1)   71/  904114 :                     	dc.b ((start>>8)&$FF),start&$FF,0,0
(1)   72/  904114 :                     	endm
(1)   73/  904114 :                     
(1)   74/  904114 :                     ; ------------------------------------------------------------
(1)   75/  904114 :                     ; SFX tracks
(1)   76/  904114 :                     ; ------------------------------------------------------------
(1)   77/  904114 :                     
(1)   78/  904114 :                     GemaTrkData_Sfx:
(1)   79/  904114 : 0090 4123           	dc.l GemaSfxPat_Boom
(1)   80/  904118 : 0090 4120           	dc.l GemaSfxBlk_Boom
(1)   81/  90411C : 0090 416F           	dc.l GemaSfxIns_Boom
(1)   82/  904120 :                     GemaSfxBlk_Boom:
(1)   83/  904120 :                     	binclude "sound/tracks/sfxpack_blk.bin"
(1)   84/  904123 :                     GemaSfxPat_Boom:
(1)   85/  904123 :                     	binclude "sound/tracks/sfxpack_patt.bin"
(1)   86/  90416F :                     GemaSfxIns_Boom:
(1)   87/  90416F : (MACRO)             	gInsFm3 0,FmIns_Fm3_Explosion
(1)   87/  90416F : B000 90D6                   dc.b $B0,0,((FMINS_FM3_EXPLOSION>>16)&$FF),((FMINS_FM3_EXPLOSION>>8)&$FF)
(1)   87/  904173 : 4800 0000                   dc.b FMINS_FM3_EXPLOSION&$FF,$00,$00,$00
(1)   88/  904177 : (MACRO)             	gInsPsgN 0,$00,$00,$00,$00,$02,%110
(1)   88/  904177 : 9600 0000                   dc.b $90|%110,0,$00,$00
(1)   88/  90417B : 0000 0200                   dc.b $00,$00,$02,0
(1)   89/  90417F : (MACRO)             	gInsFm 0,FmIns_Ding_toy
(1)   89/  90417F : A000 90D8                   dc.b $A0,0,((FMINS_DING_TOY>>16)&$FF),((FMINS_DING_TOY>>8)&$FF)
(1)   89/  904183 : 5000 0000                   dc.b FMINS_DING_TOY&$FF,$00,$00,$00
(1)   90/  904187 :                     
(1)   91/  904187 :                     GemaTrkData_Test:
(1)   92/  904187 : 0090 4195           	dc.l GemaPat_Test
(1)   93/  90418B : 0090 4193           	dc.l GemaBlk_Test
(1)   94/  90418F : 0090 602F           	dc.l GemaIns_Test
(1)   95/  904193 :                     GemaBlk_Test:
(1)   96/  904193 :                     	binclude "sound/tracks/test_blk.bin"
(1)   97/  904195 :                     GemaPat_Test:
(1)   98/  904195 :                     	binclude "sound/tracks/test_patt.bin"
(1)   99/  90602F :                     GemaIns_Test:
(1)  100/  90602F : (MACRO)             	gInsPwm 0,PwmIns_Test_st,%11
(1)  100/  90602F : D300 020B                   dc.b $D0|%11,0,((PWMINS_TEST_ST>>24)&$FF),((PWMINS_TEST_ST>>16)&$FF)
(1)  100/  906033 : 7B18 0000                   dc.b ((PWMINS_TEST_ST>>8)&$FF),PWMINS_TEST_ST&$FF,0,0
(1)  101/  906037 :                     
(1)  102/  906037 :                     ; GemaTrkData_Test:
(1)  103/  906037 :                     ; 	dc.l GemaPat_Test
(1)  104/  906037 :                     ; 	dc.l GemaBlk_Test
(1)  105/  906037 :                     ; 	dc.l GemaIns_Test
(1)  106/  906037 :                     ; GemaBlk_Test:
(1)  107/  906037 :                     ; 	binclude "sound/tracks/splash_hill_blk.bin"
(1)  108/  906037 :                     ; GemaPat_Test:
(1)  109/  906037 :                     ; 	binclude "sound/tracks/splash_hill_patt.bin"
(1)  110/  906037 :                     ; GemaIns_Test:
(1)  111/  906037 :                     ; 	gInsFm -12,FmIns_Trumpet_2
(1)  112/  906037 :                     ; 	gInsFm -12,FmIns_Bass_1
(1)  113/  906037 :                     ; 	gInsFm -12,FmIns_Brass_Eur
(1)  114/  906037 :                     ; 	gInsNull
(1)  115/  906037 :                     ; 	gInsNull
(1)  116/  906037 :                     ; 	gInsNull
(1)  117/  906037 :                     ; 	gInsPsg 0,$40,$50,$10,$06,$08
(1)  118/  906037 :                     ; 	gInsFm -12,FmIns_Trumpet_kon
(1)  119/  906037 :                     ; 	gInsFm -12,FmIns_Trumpet_1
(1)  120/  906037 :                     ; 	gInsNull
(1)  121/  906037 :                     
(1)  122/  906037 :                     ; 	gInsPwm 0,PwmIns_Test_st,%11
(1)  123/  906037 :                     
(1)  124/  906037 :                     ; 	gInsFm -12,FmIns_Brass_Eur
(1)  125/  906037 :                     ; 	gInsFm 0,FmIns_Bass_italo
(1)  126/  906037 :                     ; 	gInsDac -36,DacIns_wegot_kick,0
(1)  127/  906037 :                     ; 	gInsPsgN 0,$00,$00,$00,$00,$10,%100
(1)  128/  906037 :                     ; 	gInsNull
(1)  129/  906037 :                     ;
(1)  130/  906037 :                     ; 	gInsPsg 0,$40,$50,$10,$06,$08
(1)  131/  906037 :                     ; 	gInsDac +16,DacIns_snare_magn,0
(1)  132/  906037 :                     ; 	gInsFm -24,FmIns_Brass_Eur
(1)  133/  906037 :                     ; 	gInsNull
(1)  134/  906037 :                     ; 	gInsNull
(1)  135/  906037 :                     ;
(1)  136/  906037 :                     ; 	gInsNull
(1)  137/  906037 :                     ; 	gInsNull
(1)  138/  906037 :                     ; 	gInsFm -12,FmIns_Flaute_cave
(1)  139/  906037 :                     ; 	gInsNull
(1)  140/  906037 :                     ; 	gInsNull
(1)  141/  906037 :                     
(1)  142/  906037 :                     GemaTrkData_Test2:
(1)  143/  906037 : 0090 6058           	dc.l GemaPat_Test2
(1)  144/  90603B : 0090 6043           	dc.l GemaBlk_Test2
(1)  145/  90603F : 0090 7D17           	dc.l GemaIns_Test2
(1)  146/  906043 :                     GemaBlk_Test2:
(1)  147/  906043 :                     	binclude "sound/tracks/wegot_blk.bin"
(1)  148/  906058 :                     GemaPat_Test2:
(1)  149/  906058 :                     	binclude "sound/tracks/wegot_patt.bin"
(1)  150/  907D17 :                     GemaIns_Test2:
(1)  151/  907D17 : (MACRO)             	gInsFm 0,FmIns_PSynth_plus
(1)  151/  907D17 : A000 90D8                   dc.b $A0,0,((FMINS_PSYNTH_PLUS>>16)&$FF),((FMINS_PSYNTH_PLUS>>8)&$FF)
(1)  151/  907D1B : F000 0000                   dc.b FMINS_PSYNTH_PLUS&$FF,$00,$00,$00
(1)  152/  907D1F : (MACRO)             	gInsFm 0,FmIns_Bass_groove_2
(1)  152/  907D1F : A000 90D7                   dc.b $A0,0,((FMINS_BASS_GROOVE_2>>16)&$FF),((FMINS_BASS_GROOVE_2>>8)&$FF)
(1)  152/  907D23 : 7000 0000                   dc.b FMINS_BASS_GROOVE_2&$FF,$00,$00,$00
(1)  153/  907D27 : (MACRO)             	gInsDac -36,DacIns_wegot_kick,0
(1)  153/  907D27 : C0DC 90D9                   dc.b $C0|0,-36,((DACINS_WEGOT_KICK>>16)&$FF),((DACINS_WEGOT_KICK>>8)&$FF)
(1)  153/  907D2B : 1000 0000                   dc.b DACINS_WEGOT_KICK&$FF,0,0,0
(1)  154/  907D2F : (MACRO)             	gInsFm 0,FmIns_Bass_club
(1)  154/  907D2F : A000 90D7                   dc.b $A0,0,((FMINS_BASS_CLUB>>16)&$FF),((FMINS_BASS_CLUB>>8)&$FF)
(1)  154/  907D33 : 3000 0000                   dc.b FMINS_BASS_CLUB&$FF,$00,$00,$00
(1)  155/  907D37 : (MACRO)             	gInsFm3 0,FmIns_Fm3_OpenHat
(1)  155/  907D37 : B000 90D5                   dc.b $B0,0,((FMINS_FM3_OPENHAT>>16)&$FF),((FMINS_FM3_OPENHAT>>8)&$FF)
(1)  155/  907D3B : F800 0000                   dc.b FMINS_FM3_OPENHAT&$FF,$00,$00,$00
(1)  156/  907D3F : (MACRO)             	gInsPsg 0,$20,$40,$10,$01,$04
(1)  156/  907D3F : 8000 2040                   dc.b $80,0,$20,$40
(1)  156/  907D43 : 1001 0400                   dc.b $10,$01,$04,$00
(1)  157/  907D47 : (MACRO)             	gInsDac -36,DacIns_wegot_crash,0
(1)  157/  907D47 : C0DC 90E0                   dc.b $C0|0,-36,((DACINS_WEGOT_CRASH>>16)&$FF),((DACINS_WEGOT_CRASH>>8)&$FF)
(1)  157/  907D4B : 8A00 0000                   dc.b DACINS_WEGOT_CRASH&$FF,0,0,0
(1)  158/  907D4F : (MACRO)             	gInsPsgN 0,$00,$00,$00,$00,$10,%100
(1)  158/  907D4F : 9400 0000                   dc.b $90|%100,0,$00,$00
(1)  158/  907D53 : 0000 1000                   dc.b $00,$00,$10,0
(1)  159/  907D57 : (MACRO)             	gInsNull
(1)  159/  907D57 : FF00 0000                   dc.b  -1,$00,$00,$00
(1)  159/  907D5B : 0000 0000                   dc.b $00,$00,$00,$00
(1)  160/  907D5F : (MACRO)             	gInsNull
(1)  160/  907D5F : FF00 0000                   dc.b  -1,$00,$00,$00
(1)  160/  907D63 : 0000 0000                   dc.b $00,$00,$00,$00
(1)  161/  907D67 :                     
(1)  162/  907D67 :                     GemaTrkData_Test3:
(1)  163/  907D67 : 0090 4195           	dc.l GemaPat_Test
(1)  164/  907D6B : 0090 4193           	dc.l GemaBlk_Test
(1)  165/  907D6F : 0090 602F           	dc.l GemaIns_Test
(1)  166/  907D73 :                     GemaBlk_Test3:
(1)  167/  907D73 :                     	binclude "sound/tracks/vuela_blk.bin"
(1)  168/  907D91 :                     GemaPat_Test3:
(1)  169/  907D91 :                     	binclude "sound/tracks/vuela_patt.bin"
(1)  170/  90D580 :                     GemaIns_Test3:
(1)  171/  90D580 : (MACRO)             	gInsFm -12,FmIns_Brass_Eur
(1)  171/  90D580 : A0F4 90D8                   dc.b $A0,-12,((FMINS_BRASS_EUR>>16)&$FF),((FMINS_BRASS_EUR>>8)&$FF)
(1)  171/  90D584 : 7000 0000                   dc.b FMINS_BRASS_EUR&$FF,$00,$00,$00
(1)  172/  90D588 : (MACRO)             	gInsFm 0,FmIns_Bass_italo
(1)  172/  90D588 : A000 90D7                   dc.b $A0,0,((FMINS_BASS_ITALO>>16)&$FF),((FMINS_BASS_ITALO>>8)&$FF)
(1)  172/  90D58C : B000 0000                   dc.b FMINS_BASS_ITALO&$FF,$00,$00,$00
(1)  173/  90D590 : (MACRO)             	gInsDac -36,DacIns_wegot_kick,0
(1)  173/  90D590 : C0DC 90D9                   dc.b $C0|0,-36,((DACINS_WEGOT_KICK>>16)&$FF),((DACINS_WEGOT_KICK>>8)&$FF)
(1)  173/  90D594 : 1000 0000                   dc.b DACINS_WEGOT_KICK&$FF,0,0,0
(1)  174/  90D598 : (MACRO)             	gInsPsgN 0,$00,$00,$00,$00,$0E,%100
(1)  174/  90D598 : 9400 0000                   dc.b $90|%100,0,$00,$00
(1)  174/  90D59C : 0000 0E00                   dc.b $00,$00,$0E,0
(1)  175/  90D5A0 : (MACRO)             	gInsNull
(1)  175/  90D5A0 : FF00 0000                   dc.b  -1,$00,$00,$00
(1)  175/  90D5A4 : 0000 0000                   dc.b $00,$00,$00,$00
(1)  176/  90D5A8 : (MACRO)             	gInsPsg 0,$20,$40,$10,$06,$08
(1)  176/  90D5A8 : 8000 2040                   dc.b $80,0,$20,$40
(1)  176/  90D5AC : 1006 0800                   dc.b $10,$06,$08,$00
(1)  177/  90D5B0 : (MACRO)             	gInsDac +16,DacIns_snare_magn,0
(1)  177/  90D5B0 : C010 911E                   dc.b $C0|0,+16,((DACINS_SNARE_MAGN>>16)&$FF),((DACINS_SNARE_MAGN>>8)&$FF)
(1)  177/  90D5B4 : 7E00 0000                   dc.b DACINS_SNARE_MAGN&$FF,0,0,0
(1)  178/  90D5B8 : (MACRO)             	gInsFm -24,FmIns_Brass_Eur
(1)  178/  90D5B8 : A0E8 90D8                   dc.b $A0,-24,((FMINS_BRASS_EUR>>16)&$FF),((FMINS_BRASS_EUR>>8)&$FF)
(1)  178/  90D5BC : 7000 0000                   dc.b FMINS_BRASS_EUR&$FF,$00,$00,$00
(1)  179/  90D5C0 : (MACRO)             	gInsNull
(1)  179/  90D5C0 : FF00 0000                   dc.b  -1,$00,$00,$00
(1)  179/  90D5C4 : 0000 0000                   dc.b $00,$00,$00,$00
(1)  180/  90D5C8 : (MACRO)             	gInsNull
(1)  180/  90D5C8 : FF00 0000                   dc.b  -1,$00,$00,$00
(1)  180/  90D5CC : 0000 0000                   dc.b $00,$00,$00,$00
(1)  181/  90D5D0 : (MACRO)             	gInsNull
(1)  181/  90D5D0 : FF00 0000                   dc.b  -1,$00,$00,$00
(1)  181/  90D5D4 : 0000 0000                   dc.b $00,$00,$00,$00
(1)  182/  90D5D8 : (MACRO)             	gInsNull
(1)  182/  90D5D8 : FF00 0000                   dc.b  -1,$00,$00,$00
(1)  182/  90D5DC : 0000 0000                   dc.b $00,$00,$00,$00
(1)  183/  90D5E0 : (MACRO)             	gInsFm -24,FmIns_Trumpet_carnival
(1)  183/  90D5E0 : A0E8 90D8                   dc.b $A0,-24,((FMINS_TRUMPET_CARNIVAL>>16)&$FF),((FMINS_TRUMPET_CARNIVAL>>8)&$FF)
(1)  183/  90D5E4 : 3000 0000                   dc.b FMINS_TRUMPET_CARNIVAL&$FF,$00,$00,$00
(1)  184/  90D5E8 : (MACRO)             	gInsFm -12,FmIns_Ding_toy
(1)  184/  90D5E8 : A0F4 90D8                   dc.b $A0,-12,((FMINS_DING_TOY>>16)&$FF),((FMINS_DING_TOY>>8)&$FF)
(1)  184/  90D5EC : 5000 0000                   dc.b FMINS_DING_TOY&$FF,$00,$00,$00
(1)  185/  90D5F0 : (MACRO)             	gInsNull
(1)  185/  90D5F0 : FF00 0000                   dc.b  -1,$00,$00,$00
(1)  185/  90D5F4 : 0000 0000                   dc.b $00,$00,$00,$00
(1)  186/  90D5F8 :                     
(1)  187/  90D5F8 :                     
(1)  188/  90D5F8 :                     ; GemaTrkData_Test:
(1)  189/  90D5F8 :                     ; 	dc.l GemaPat_Test
(1)  190/  90D5F8 :                     ; 	dc.l GemaBlk_Test
(1)  191/  90D5F8 :                     ; 	dc.l GemaIns_Test
(1)  192/  90D5F8 :                     ; GemaBlk_Test:
(1)  193/  90D5F8 :                     ; 	binclude "sound/tracks/bonus_blk.bin"
(1)  194/  90D5F8 :                     ; GemaPat_Test:
(1)  195/  90D5F8 :                     ; 	binclude "sound/tracks/bonus_patt.bin"
(1)  196/  90D5F8 :                     ; GemaIns_Test:
(1)  197/  90D5F8 :                     ; 	gInsFm  -12,FmIns_Bass_Oil
(1)  198/  90D5F8 :                     ; 	gInsDac -24,DacIns_SaurKick,0
(1)  199/  90D5F8 :                     ; 	gInsPsgN 0,$00,$00,$00,$00,$18,%100
(1)  200/  90D5F8 :                     ; 	gInsPsgN 0,$00,$00,$00,$00,$18,%100
(1)  201/  90D5F8 :                     ; 	gInsPsgN 0,$00,$00,$00,$00,$10,%100
(1)  202/  90D5F8 :                     ; 	gInsDac -12,DacIns_Snare_Gem,0
(1)  203/  90D5F8 :                     ; 	gInsNull
(1)  204/  90D5F8 :                     ; 	gInsFm -12,FmIns_Organ_Ito
(1)  205/  90D5F8 :                     ; 	gInsNull
(1)  206/  90D5F8 :                     ; 	gInsNull
(1)  207/  90D5F8 :                     ; 	gInsNull
(1)  208/  90D5F8 :                     ; 	gInsFm -12,FmIns_Ding_Baseball
(1)  209/  90D5F8 :                     ; 	gInsFm -12,FmIns_Brass_Eur
(1)  210/  90D5F8 :                     ; 	gInsNull
(1)  211/  90D5F8 :                     ; 	gInsNull
(1)  212/  90D5F8 :                     ; 	gInsNull
(1)  213/  90D5F8 :                     ; 	gInsNull
(1)  214/  90D5F8 :                     ; 	gInsNull
(1)  215/  90D5F8 :                     ; 	gInsNull
(1)  216/  90D5F8 :                     ; 	gInsNull
(1)  217/  90D5F8 :                     ; 	gInsNull
(1)  218/  90D5F8 :                     ; 	gInsNull
(1)  219/  90D5F8 :                     ; 	gInsNull
(1)  220/  90D5F8 :                     ; 	gInsNull
(1)  221/  90D5F8 :                     ; 	gInsNull
(1)  222/  90D5F8 :                     ; 	gInsNull
(1)  223/  90D5F8 :                     ; 	gInsNull
(1)  224/  90D5F8 :                     
(1)  225/  90D5F8 :                     ; 	gInsFm3 0,FmIns_Fm3_Explosion
(1)  226/  90D5F8 :                     ; 	gInsPsgN 0,$00,$00,$00,$00,$02,%110
(1)  227/  90D5F8 :                     ; 	gInsFm 0,FmIns_Ding_toy
(1)  228/  90D5F8 :                     
(1)  229/  90D5F8 :                     ; GemaTrk_blk_Vectr:
(1)  230/  90D5F8 :                     ; 	binclude "sound/tracks/vectr_blk.bin"
(1)  231/  90D5F8 :                     ; GemaTrk_patt_Vectr:
(1)  232/  90D5F8 :                     ; 	binclude "sound/tracks/vectr_patt.bin"
(1)  233/  90D5F8 :                     ; GemaTrk_ins_Vectr:
(1)  234/  90D5F8 :                     ; 	gInsPwm -17,SmpIns_Vctr01,%001
(1)  235/  90D5F8 :                     ; 	gInsNull
(1)  236/  90D5F8 :                     ; 	gInsPwm -15,SmpIns_VctrCrash,0
(1)  237/  90D5F8 :                     ; 	gInsPwm -17,SmpIns_Vctr04,%001
(1)  238/  90D5F8 :                     ; 	gInsNull
(1)  239/  90D5F8 :                     ; 	gInsPwm -15,SmpIns_VctrTimpani,%001
(1)  240/  90D5F8 :                     ; 	gInsFm -22,FmIns_Bass_4
(1)  241/  90D5F8 :                     ; 	gInsPsg 0,$00,$00,$00,$00,$01
(1)  242/  90D5F8 :                     ; 	gInsPsg 0,$00,$00,$00,$00,$01
(1)  243/  90D5F8 :                     ; 	gInsPwm -17,SmpIns_VctrSnare,%000
(1)  244/  90D5F8 :                     ; 	gInsPwm -17,SmpIns_VctrKick,%000
(1)  245/  90D5F8 :                     ; 	gInsPsgN 0,$00,$00,$00,$00,$10,%100
(1)  246/  90D5F8 :                     ; 	gInsPsgN 0,$00,$00,$00,$00,$08,%100
(1)  247/  90D5F8 :                     ; 	gInsPwm -17,SmpIns_VctrBrass,%001
(1)  248/  90D5F8 :                     ;
(1)  249/  90D5F8 :                     ; GemaTrk_blk_BeMine:
(1)  250/  90D5F8 :                     ; 	binclude "sound/tracks/bemine_blk.bin"
(1)  251/  90D5F8 :                     ; GemaTrk_patt_BeMine:
(1)  252/  90D5F8 :                     ; 	binclude "sound/tracks/bemine_patt.bin"
(1)  253/  90D5F8 :                     ; GemaTrk_ins_BeMine:
(1)  254/  90D5F8 :                     ; 	gInsPwm -17,SmpIns_Bell_Ice,0
(1)  255/  90D5F8 :                     ; 	gInsPwm -17,SmpIns_Brass1_Hi,%01
(1)  256/  90D5F8 :                     ; 	gInsPwm -17,SmpIns_Brass1_Low,%01
(1)  257/  90D5F8 :                     ; 	gInsFm  -24,FmIns_Bass_groove
(1)  258/  90D5F8 :                     ; 	gInsFm3   0,FmIns_Fm3_OpenHat
(1)  259/  90D5F8 :                     ; 	gInsPwm -17,SmpIns_Snare_jam,0
(1)  260/  90D5F8 :                     ; 	gInsPwm -17,SmpIns_Kick_jam,0
(1)  261/  90D5F8 :                     ; 	gInsPwm -17,SmpIns_SnrTom_1,0
(1)  262/  90D5F8 :                     ; 	gInsPwm -17,SmpIns_Forest_1,0
(1)  263/  90D5F8 :                     ; 	gInsNull
(1)  264/  90D5F8 :                     ; 	gInsNull
(1)  265/  90D5F8 :                     ; 	gInsNull
(1)  266/  90D5F8 :                     ; 	gInsNull
(1)  267/  90D5F8 :                     ; 	gInsNull
(1)  268/  90D5F8 :                     ; 	gInsNull
(1)  269/  90D5F8 :                     ; 	gInsNull
(1)  270/  90D5F8 :                     ; 	gInsNull
(1)  271/  90D5F8 :                     ; 	gInsNull
(1)  272/  90D5F8 :                     ; 	gInsNull
(1)  273/  90D5F8 :                     ; 	gInsNull
(1)  274/  90D5F8 :                     ; 	gInsNull
(1)  275/  90D5F8 :                     ; 	gInsNull
(1)  276/  90D5F8 :                     ; 	gInsNull
(1)  277/  90D5F8 :                     ; 	gInsNull
(1)  278/  90D5F8 :                     ; 	gInsNull
(1)  279/  90D5F8 :                     ;
(1)  280/  90D5F8 :                     ; GemaTrk_blk_HILLS:
(1)  281/  90D5F8 :                     ; 	binclude "sound/tracks/hill_blk.bin"
(1)  282/  90D5F8 :                     ; GemaTrk_patt_HILLS:
(1)  283/  90D5F8 :                     ; 	binclude "sound/tracks/hill_patt.bin"
(1)  284/  90D5F8 :                     ; GemaTrk_ins_HILLS:
(1)  285/  90D5F8 :                     ; 	gInsPsg +2,$40,$02,$30,$10,$00
(1)  286/  90D5F8 :                     ; 	gInsFm -10,FmIns_Trumpet_1
(1)  287/  90D5F8 :                     ; 	gInsPsgN 0,$00,$00,$00,$00,$04,%110
(1)  288/  90D5F8 :                     ; 	gInsDac -3,DacIns_LowString,1;gInsPwm -8,DacIns_LowString,1
(1)  289/  90D5F8 :                     ; 	gInsFm -8-12,FmIns_Ding_Toy
(1)  290/  90D5F8 :                     ; 	gInsFm -25,FmIns_Bass_3
(1)  291/  90D5F8 :                     ; 	gInsNull
(1)  292/  90D5F8 :                     ; 	gInsNull
(1)  293/  90D5F8 :                     ; 	gInsNull
(1)  294/  90D5F8 :                     ; 	gInsNull
(1)  295/  90D5F8 :                     ; 	gInsNull
(1)  296/  90D5F8 :                     ; 	gInsNull
(1)  297/  90D5F8 :                     ; 	gInsNull
(1)  298/  90D5F8 :                     
      49/  90D5F8 :                     		include "sound/instr.asm"
(1)    1/  90D5F8 :                     ; ====================================================================
(1)    2/  90D5F8 :                     ; FM instrument patches
(1)    3/  90D5F8 :                     ;
(1)    4/  90D5F8 :                     ; This must be located at the 900000 area.
(1)    5/  90D5F8 :                     ; ====================================================================
(1)    6/  90D5F8 :                     
(1)    7/  90D5F8 :                     ; Sizes
(1)    8/  90D5F8 :                     ; Normal FM ins: $20
(1)    9/  90D5F8 :                     ; Special FM ins: $28
(1)   10/  90D5F8 :                     ;
(1)   11/  90D5F8 :                     
(1)   12/  90D5F8 :                     ; --------------------------------------------------------
(1)   13/  90D5F8 :                     ; FM instruments/patches
(1)   14/  90D5F8 :                     ; --------------------------------------------------------
(1)   15/  90D5F8 :                     
(1)   16/  90D5F8 :                     ; Sizes
(1)   17/  90D5F8 :                     ; Normal FM ins: $20
(1)   18/  90D5F8 :                     ; Special FM ins: $28
(1)   19/  90D5F8 :                     
(1)   20/  90D5F8 :                     ; FM3 Special
(1)   21/  90D5F8 :                     FmIns_Fm3_OpenHat:
(1)   22/  90D5F8 :                     		binclude "sound/instr/fm/fm3_openhat.gsx",$2478,$28
(1)   23/  90D620 :                     FmIns_Fm3_ClosedHat:
(1)   24/  90D620 :                     		binclude "sound/instr/fm/fm3_closedhat.gsx",$2478,$28
(1)   25/  90D648 :                     FmIns_Fm3_Explosion:
(1)   26/  90D648 :                     		binclude "sound/instr/fm/fm3_sfx_boomworm.gsx",$2478,$28
(1)   27/  90D670 :                     
(1)   28/  90D670 :                     ; Bass
(1)   29/  90D670 :                     FmIns_Bass_Oil:
(1)   30/  90D670 :                     		binclude "sound/instr/fm/bass_oil.gsx",$2478,$20
(1)   31/  90D690 :                     
(1)   32/  90D690 :                     ; Organ
(1)   33/  90D690 :                     FmIns_Organ_Ito:
(1)   34/  90D690 :                     		binclude "sound/instr/fm/organ_ito.gsx",$2478,$20
(1)   35/  90D6B0 :                     
(1)   36/  90D6B0 :                     ; Bell-ish
(1)   37/  90D6B0 :                     FmIns_Ding_Baseball:
(1)   38/  90D6B0 :                     		binclude "sound/instr/fm/ding_baseball.gsx",$2478,$20
(1)   39/  90D6D0 :                     
(1)   40/  90D6D0 :                     ; FmIns_Guitar_gem:
(1)   41/  90D6D0 :                     ; 		binclude "sound/instr/fm/guitar_gem.gsx",$2478,$20
(1)   42/  90D6D0 :                     ; Fmins_Guitar_Heavy:
(1)   43/  90D6D0 :                     ; 		binclude "sound/instr/fm/guitar_heavy.gsx",$2478,$20
(1)   44/  90D6D0 :                     ; Fmins_Guitar_puy:
(1)   45/  90D6D0 :                     ; 		binclude "sound/instr/fm/guitar_puy.gsx",$2478,$20
(1)   46/  90D6D0 :                     ; Fmins_Guitar_puy_2:
(1)   47/  90D6D0 :                     ; 		binclude "sound/instr/fm/guitar_puy_2.gsx",$2478,$20
(1)   48/  90D6D0 :                     FmIns_DrumKick_gem:
(1)   49/  90D6D0 :                     		binclude "sound/instr/fm/drum_kick_gem.gsx",$2478,$20
(1)   50/  90D6F0 :                     ;
(1)   51/  90D6F0 :                     ; ; FmIns_DrumKick:
(1)   52/  90D6F0 :                     ; ; 		binclude "sound/instr/fm/drum_kick.gsx",$2478,$20
(1)   53/  90D6F0 :                     ; ; FmIns_DrumSnare:
(1)   54/  90D6F0 :                     ; ; 		binclude "sound/instr/fm/drum_snare.gsx",$2478,$20
(1)   55/  90D6F0 :                     ; ; ; ; FmIns_DrumCloseHat:
(1)   56/  90D6F0 :                     ; ; ; ; 		binclude "sound/instr/fm/drum_closehat.gsx",$2478,$20
(1)   57/  90D6F0 :                     ; FmIns_PianoM1:
(1)   58/  90D6F0 :                     ; 		binclude "sound/instr/fm/piano_m1.gsx",$2478,$20
(1)   59/  90D6F0 :                     ; ; FmIns_PianoM116:
(1)   60/  90D6F0 :                     ; ; 		binclude "sound/instr/fm/piano_m116.gsx",$2478,$20
(1)   61/  90D6F0 :                     ;
(1)   62/  90D6F0 :                     ; ; ;
(1)   63/  90D6F0 :                     ; ; ; ; FmIns_Bass_gum:
(1)   64/  90D6F0 :                     ; ; ; ; 		binclude "sound/instr/fm/bass_gum.gsx",$2478,$20
(1)   65/  90D6F0 :                     FmIns_Bass_calm:
(1)   66/  90D6F0 :                     		binclude "sound/instr/fm/bass_calm.gsx",$2478,$20
(1)   67/  90D710 :                     ; FmIns_Bass_heavy:
(1)   68/  90D710 :                     ; 		binclude "sound/instr/fm/bass_heavy.gsx",$2478,$20
(1)   69/  90D710 :                     ; FmIns_Bass_ambient:
(1)   70/  90D710 :                     ; 		binclude "sound/instr/fm/bass_ambient.gsx",$2478,$20
(1)   71/  90D710 :                     ; ; ; FmIns_Brass_gummy:
(1)   72/  90D710 :                     ; ; ; 		binclude "sound/instr/fm/brass_gummy.gsx",$2478,$20
(1)   73/  90D710 :                     ; FmIns_Flaute_1:
(1)   74/  90D710 :                     ; 		binclude "sound/instr/fm/flaute_1.gsx",$2478,$20
(1)   75/  90D710 :                     FmIns_Bass_1:
(1)   76/  90D710 :                     		binclude "sound/instr/fm/bass_1.gsx",$2478,$20
(1)   77/  90D730 :                     ; FmIns_Bass_2:
(1)   78/  90D730 :                     ; 		binclude "sound/instr/fm/bass_2.gsx",$2478,$20
(1)   79/  90D730 :                     ; FmIns_Bass_3:
(1)   80/  90D730 :                     ; 		binclude "sound/instr/fm/bass_3.gsx",$2478,$20
(1)   81/  90D730 :                     ; FmIns_Bass_4:
(1)   82/  90D730 :                     ; 		binclude "sound/instr/fm/bass_4.gsx",$2478,$20
(1)   83/  90D730 :                     ; FmIns_Bass_5:
(1)   84/  90D730 :                     ; 		binclude "sound/instr/fm/bass_5.gsx",$2478,$20
(1)   85/  90D730 :                     FmIns_Bass_club:
(1)   86/  90D730 :                     		binclude "sound/instr/fm/bass_club.gsx",$2478,$20
(1)   87/  90D750 :                     FmIns_Bass_donna:
(1)   88/  90D750 :                     		binclude "sound/instr/fm/bass_donna.gsx",$2478,$20
(1)   89/  90D770 :                     FmIns_Bass_groove_2:
(1)   90/  90D770 :                     		binclude "sound/instr/fm/bass_groove_2.gsx",$2478,$20
(1)   91/  90D790 :                     FmIns_Bass_groove_gem:
(1)   92/  90D790 :                     		binclude "sound/instr/fm/bass_groove_gem.gsx",$2478,$20
(1)   93/  90D7B0 :                     FmIns_Bass_italo:
(1)   94/  90D7B0 :                     		binclude "sound/instr/fm/bass_italo.gsx",$2478,$20
(1)   95/  90D7D0 :                     ; FmIns_Bass_kon:
(1)   96/  90D7D0 :                     ; 		binclude "sound/instr/fm/bass_kon.gsx",$2478,$20
(1)   97/  90D7D0 :                     
(1)   98/  90D7D0 :                     ; FmIns_Bass_mecan:
(1)   99/  90D7D0 :                     ; 		binclude "sound/instr/fm/bass_mecan.gsx",$2478,$20
(1)  100/  90D7D0 :                     ;
(1)  101/  90D7D0 :                     ; ; ; FmIns_Bass_heavy:
(1)  102/  90D7D0 :                     ; ; ; 		binclude "sound/instr/fm/bass_heavy.gsx",$2478,$20
(1)  103/  90D7D0 :                     ; ; ; FmIns_Bass_metal:
(1)  104/  90D7D0 :                     ; ; ; 		binclude "sound/instr/fm/bass_metal.gsx",$2478,$20
(1)  105/  90D7D0 :                     ; FmIns_Bass_synth:
(1)  106/  90D7D0 :                     ; 		binclude "sound/instr/fm/bass_synth_1.gsx",$2478,$20
(1)  107/  90D7D0 :                     ; FmIns_Guitar_1:
(1)  108/  90D7D0 :                     ; 		binclude "sound/instr/fm/guitar_1.gsx",$2478,$20
(1)  109/  90D7D0 :                     ; ; ; FmIns_Horn_1:
(1)  110/  90D7D0 :                     ; ; ; 		binclude "sound/instr/fm/horn_1.gsx",$2478,$20
(1)  111/  90D7D0 :                     ; FmIns_Organ_M1:
(1)  112/  90D7D0 :                     ; 		binclude "sound/instr/fm/organ_m1.gsx",$2478,$20
(1)  113/  90D7D0 :                     ; ; ; FmIns_Bass_Beach:
(1)  114/  90D7D0 :                     ; ; ; 		binclude "sound/instr/fm/bass_beach.gsx",$2478,$20
(1)  115/  90D7D0 :                     ; ; ; FmIns_Bass_Beach_2:
(1)  116/  90D7D0 :                     ; ; ; 		binclude "sound/instr/fm/bass_beach_2.gsx",$2478,$20
(1)  117/  90D7D0 :                     ; ; ; FmIns_Brass_Cave:
(1)  118/  90D7D0 :                     ; ; ; 		binclude "sound/instr/fm/brass_cave.gsx",$2478,$20
(1)  119/  90D7D0 :                     ; ; FmIns_Brass_Gem:
(1)  120/  90D7D0 :                     ; ; 		binclude "sound/instr/fm/brass_gem.gsx",$2478,$20
(1)  121/  90D7D0 :                     ; ; FmIns_Piano_Small:
(1)  122/  90D7D0 :                     ; ; 		binclude "sound/instr/fm/piano_small.gsx",$2478,$20
(1)  123/  90D7D0 :                     ; ; FmIns_Piano:
(1)  124/  90D7D0 :                     ; ; 		binclude "sound/instr/fm/piano_m1.gsx",$2478,$20
(1)  125/  90D7D0 :                     FmIns_Trumpet_1:
(1)  126/  90D7D0 :                     		binclude "sound/instr/fm/trumpet_1.gsx",$2478,$20
(1)  127/  90D7F0 :                     FmIns_Trumpet_2:
(1)  128/  90D7F0 :                     		binclude "sound/instr/fm/trumpet_2.gsx",$2478,$20
(1)  129/  90D810 :                     FmIns_Trumpet_kon:
(1)  130/  90D810 :                     		binclude "sound/instr/fm/trumpet_kon.gsx",$2478,$20
(1)  131/  90D830 :                     ; FmIns_Trumpet_puy:
(1)  132/  90D830 :                     ; 		binclude "sound/instr/fm/trumpet_puy.gsx",$2478,$20
(1)  133/  90D830 :                     FmIns_Trumpet_carnival:
(1)  134/  90D830 :                     		binclude "sound/instr/fm/trumpet_carnivl.gsx",$2478,$20
(1)  135/  90D850 :                     
(1)  136/  90D850 :                     ; FmIns_Bell_Glass:
(1)  137/  90D850 :                     ; 		binclude "sound/instr/fm/bell_glass.gsx",$2478,$20
(1)  138/  90D850 :                     ; FmIns_Marimba_1:
(1)  139/  90D850 :                     ; 		binclude "sound/instr/fm/marimba_1.gsx",$2478,$20
(1)  140/  90D850 :                     
(1)  141/  90D850 :                     ; FmIns_Ambient_dark:
(1)  142/  90D850 :                     ; 		binclude "sound/instr/fm/ambient_dark.gsx",$2478,$20
(1)  143/  90D850 :                     ; FmIns_Ambient_spook:
(1)  144/  90D850 :                     ; 		binclude "sound/instr/fm/ambient_spook.gsx",$2478,$20
(1)  145/  90D850 :                     ; FmIns_Ambient_3:
(1)  146/  90D850 :                     ; 		binclude "sound/instr/fm/ambient_3.gsx",$2478,$20
(1)  147/  90D850 :                     FmIns_Ding_toy:
(1)  148/  90D850 :                     		binclude "sound/instr/fm/ding_toy.gsx",$2478,$20
(1)  149/  90D870 :                     ; FmIns_Bell_China:
(1)  150/  90D870 :                     ; 		binclude "sound/instr/fm/bell_china.gsx",$2478,$20
(1)  151/  90D870 :                     FmIns_Brass_Eur:
(1)  152/  90D870 :                     		binclude "sound/instr/fm/brass_eur.gsx",$2478,$20
(1)  153/  90D890 :                     FmIns_Brass_Puy:
(1)  154/  90D890 :                     		binclude "sound/instr/fm/brass_puy.gsx",$2478,$20
(1)  155/  90D8B0 :                     FmIns_Flaute_cave:
(1)  156/  90D8B0 :                     		binclude "sound/instr/fm/flaute_cave.gsx",$2478,$20
(1)  157/  90D8D0 :                     FmIns_Banjo_puy:
(1)  158/  90D8D0 :                     		binclude "sound/instr/fm/banjo_puy.gsx",$2478,$20
(1)  159/  90D8F0 :                     ; FmIns_Violin_gem:
(1)  160/  90D8F0 :                     ; 		binclude "sound/instr/fm/violin_gem.gsx",$2478,$20
(1)  161/  90D8F0 :                     
(1)  162/  90D8F0 :                     FmIns_PSynth_plus:
(1)  163/  90D8F0 :                     		binclude "sound/instr/fm/psynth_plus.gsx",$2478,$20
(1)  164/  90D910 :                     
      50/  90D910 :                     		include "sound/smpl_dac.asm"
(1)    1/  90D910 :                     ; ====================================================================
(1)    2/  90D910 :                     ; DAC samples
(1)    3/  90D910 :                     ;
(1)    4/  90D910 :                     ; This must be located at the 900000 area.
(1)    5/  90D910 :                     ; ====================================================================
(1)    6/  90D910 :                     
(1)    7/  90D910 :                     ; Special sample data macro
(1)    8/  90D910 :                     ;
(1)    9/  90D910 :                     ; aligns by 4 at the end so the sample can recycled on 32X
(1)   10/  90D910 :                     gSmpl macro locate,loop
(1)   11/  90D910 :                     .start
(1)   12/  90D910 :                     	dc.b ((.end-.start)&$FF),(((.end-.start)>>8)&$FF),(((.end-.start)>>16)&$FF)	; length
(1)   13/  90D910 :                     	dc.b ((loop)&$FF),(((loop)>>8)&$FF),(((loop)>>16)&$FF)
(1)   14/  90D910 :                     	binclude locate,$2C	; actual data
(1)   15/  90D910 :                     .end
(1)   16/  90D910 :                     	endm
(1)   17/  90D910 :                     
(1)   18/  90D910 :                     ; DacIns_Test:
(1)   19/  90D910 :                     ; 	gSmpl "sound/instr/smpl/baila.wav",0
(1)   20/  90D910 :                     
(1)   21/  90D910 :                     DacIns_wegot_kick:
(1)   22/  90D910 : (MACRO)             	gSmpl "sound/instr/smpl/wegot_kick.wav",0
(1)   22/  90D910 :                     .start
(1)   22/  90D910 : 7A07 00                     dc.b ((.end-.start)&$FF),(((.end-.start)>>8)&$FF),(((.end-.start)>>16)&$FF)     ; length
(1)   22/  90D913 : 0000 00                     dc.b ((0)&$FF),(((0)>>8)&$FF),(((0)>>16)&$FF)
(1)   22/  90D916 :                             binclude "sound/instr/smpl/wegot_kick.wav",$2C     ; actual data
(1)   22/  90E08A :                     .end
(1)   23/  90E08A :                     DacIns_wegot_crash:
(1)   24/  90E08A : (MACRO)             	gSmpl "sound/instr/smpl/wegot_crash.wav",0
(1)   24/  90E08A :                     .start
(1)   24/  90E08A : CA2C 00                     dc.b ((.end-.start)&$FF),(((.end-.start)>>8)&$FF),(((.end-.start)>>16)&$FF)     ; length
(1)   24/  90E08D : 0000 00                     dc.b ((0)&$FF),(((0)>>8)&$FF),(((0)>>16)&$FF)
(1)   24/  90E090 :                             binclude "sound/instr/smpl/wegot_crash.wav",$2C     ; actual data
(1)   24/  910D54 :                     .end
(1)   25/  910D54 :                     
(1)   26/  910D54 :                     DacIns_snare_lobo:
(1)   27/  910D54 : (MACRO)             	gSmpl "sound/instr/smpl/snare_lobo.wav",0
(1)   27/  910D54 :                     .start
(1)   27/  910D54 : 2A11 00                     dc.b ((.end-.start)&$FF),(((.end-.start)>>8)&$FF),(((.end-.start)>>16)&$FF)     ; length
(1)   27/  910D57 : 0000 00                     dc.b ((0)&$FF),(((0)>>8)&$FF),(((0)>>16)&$FF)
(1)   27/  910D5A :                             binclude "sound/instr/smpl/snare_lobo.wav",$2C     ; actual data
(1)   27/  911E7E :                     .end
(1)   28/  911E7E :                     DacIns_snare_magn:
(1)   29/  911E7E : (MACRO)             	gSmpl "sound/instr/smpl/snare_magn.wav",0
(1)   29/  911E7E :                     .start
(1)   29/  911E7E : DA13 00                     dc.b ((.end-.start)&$FF),(((.end-.start)>>8)&$FF),(((.end-.start)>>16)&$FF)     ; length
(1)   29/  911E81 : 0000 00                     dc.b ((0)&$FF),(((0)>>8)&$FF),(((0)>>16)&$FF)
(1)   29/  911E84 :                             binclude "sound/instr/smpl/snare_magn.wav",$2C     ; actual data
(1)   29/  913258 :                     .end
(1)   30/  913258 :                     
      51/  913258 :                     		include "data/md_bank0.asm"
(1)    1/  913258 :                     ; ====================================================================
(1)    2/  913258 :                     ; ----------------------------------------------------------------
(1)    3/  913258 :                     ; BANK 0 of 68k data ($900000-$9FFFFF)
(1)    4/  913258 :                     ; for big stuff like maps, levels, etc.
(1)    5/  913258 :                     ;
(1)    6/  913258 :                     ; For graphics use DMA and place your files at
(1)    7/  913258 :                     ; md_dma.asm (Watch out for the $20000-section limit.)
(1)    8/  913258 :                     ;
(1)    9/  913258 :                     ; Maximum size: $0FFFFF bytes per bank
(1)   10/  913258 :                     ; ----------------------------------------------------------------
(1)   11/  913258 :                     
(1)   12/  913258 :                     		align 2
(1)   13/  913258 :                     PalData_Mars_Test:
(1)   14/  913258 :                     		binclude "data/mars/test_pal.bin"
(1)   15/  913330 :                     		align 2
(1)   16/  913330 :                     PalData_Mars_Test2:
(1)   17/  913330 :                     		binclude "data/mars/test2_pal.bin"
(1)   18/  913530 :                     		align 2
(1)   19/  913530 :                     
(1)   20/  913530 :                     MDLDATA_PAL_TEST:
(1)   21/  913530 :                     		binclude "data/mars/objects/mtrl/pecsi_pal.bin"
(1)   22/  913570 :                     		align 2
(1)   23/  913570 :                     
(1)   24/  913570 :                     MAP_FGTEST:	binclude "data/md/bg/fg_map.bin"
(1)   25/  914570 :                     		align 2
(1)   26/  914570 :                     MAP_BGTEST:	binclude "data/md/bg/bg_map.bin"
(1)   27/  915570 :                     		align 2
(1)   28/  915570 :                     
      52/   15570 :                     		dephase
      53/   15570 :                     ; 		org $100000-4				; Fill this bank and
      54/   15570 :                     ; 		dc.b "BNK0"				; add a tag at the end
      55/   15570 :                     
      56/   15570 :                     ; ---------------------------------------------
      57/   15570 :                     ; BANK 1
      58/   15570 :                     ; ---------------------------------------------
      59/   15570 :                     
      60/   15570 :                     ; 		phase $900000
      61/   15570 :                     ; 		include "data/md_bank1.asm"
      62/   15570 :                     ; 		dephase
      63/   15570 :                     ; 		org $200000-4
      64/   15570 :                     ; 		dc.b "BNK1"
      65/   15570 :                     
      66/   15570 :                     ; ---------------------------------------------
      67/   15570 :                     ; BANK 2
      68/   15570 :                     ; ---------------------------------------------
      69/   15570 :                     
      70/   15570 :                     ; 		phase $900000
      71/   15570 :                     ; 		include "data/md_bank2.asm"
      72/   15570 :                     ; 		dephase
      73/   15570 :                     ; 		org $300000-4
      74/   15570 :                     ; 		dc.b "BNK2"
      75/   15570 :                     
      76/   15570 :                     ; ---------------------------------------------
      77/   15570 :                     ; BANK 3
      78/   15570 :                     ; ---------------------------------------------
      79/   15570 :                     
      80/   15570 :                     ; 		phase $900000
      81/   15570 :                     ; 		include "data/md_bank3.asm"
      82/   15570 :                     ; 		dephase
      83/   15570 :                     ; 		org $400000-4
      84/   15570 :                     ; 		dc.b "BNK3"
      85/   15570 :                     
      86/   15570 :                     ; ====================================================================
      87/   15570 :                     ; ----------------------------------------------------------------
      88/   15570 :                     ; MD DMA data: BANK-free but requres RV=1
      89/   15570 :                     ; ----------------------------------------------------------------
      90/   15570 :                     
      91/   15570 :                     		align 4
      92/   15570 :                     		include "data/md_dma.asm"
(1)    1/   15570 :                     ; ====================================================================
(1)    2/   15570 :                     ; ----------------------------------------------------------------
(1)    3/   15570 :                     ; DMA ROM DATA Transfer section
(1)    4/   15570 :                     ; 
(1)    5/   15570 :                     ; RV bit must be enabled to read from here
(1)    6/   15570 :                     ; ----------------------------------------------------------------
(1)    7/   15570 :                     
(1)    8/   15570 :                     
(1)    9/   15570 :                     ASCII_FONT:	binclude "system/md/data/font.bin"
(1)   10/   16570 :                     ASCII_FONT_e:
(1)   11/   16570 :                     
(1)   12/   16570 :                     ART_FGTEST:	binclude "data/md/bg/fg_art.bin"
(1)   13/   187F0 :                     ART_FGTEST_e:
(1)   14/   187F0 :                     ART_BGTEST:	binclude "data/md/bg/bg_art.bin"
(1)   15/   1B930 :                     ART_BGTEST_e:
(1)   16/   1B930 :                     		align $8000
(1)   17/   20000 :                     ART_EMI:	binclude "data/md/sprites/emi_art.bin"
(1)   18/   22B80 :                     ART_EMI_e:
(1)   19/   22B80 :                     		align 2
(1)   20/   22B80 :                     
(1)   21/   22B80 :                     
      93/   22B80 :                     
      94/   22B80 :                     ; ====================================================================
      95/   22B80 :                     ; ----------------------------------------------------------------
      96/   22B80 :                     ; SH2 RAM CODE
      97/   22B80 :                     ; ----------------------------------------------------------------
      98/   22B80 :                     
      99/   22B80 :                     		align 4
     100/   22B80 :                     MARS_RAMDATA:
     101/   22B80 :                     		include "system/mars/code.asm"
(1)    1/   22B80 :                     ; ====================================================================
(1)    2/   22B80 :                     ; ----------------------------------------------------------------
(1)    3/   22B80 :                     ; MARS SH2 Section
(1)    4/   22B80 :                     ;
(1)    5/   22B80 :                     ; CODE for both CPUs
(1)    6/   22B80 :                     ; RAM and some DATA go here
(1)    7/   22B80 :                     ; ----------------------------------------------------------------
(1)    8/   22B80 :                     
(1)    9/   22B80 :                     ; *************************************************
(1)   10/   22B80 :                     ; communication setup will be like this:
(1)   11/   22B80 :                     ;
(1)   12/   22B80 :                     ; comm0-comm7  - ** FREE to use ***
(1)   13/   22B80 :                     ; comm8-comm11 - Used to transfer data manually
(1)   14/   22B80 :                     ;                from Z80 to SH2 side, 68K
(1)   15/   22B80 :                     ;                uses DREQ.
(1)   16/   22B80 :                     ; comm12       - Master CPU control
(1)   17/   22B80 :                     ; comm14       - Slave CPU control
(1)   18/   22B80 :                     ;
(1)   19/   22B80 :                     ; CPU control bits:
(1)   20/   22B80 :                     ;
(1)   21/   22B80 :                     ; %BsssCCCC Immmmmmm
(1)   22/   22B80 :                     ;
(1)   23/   22B80 :                     ; B - BUSY bit, Manually set by 68K or Z80
(1)   24/   22B80 :                     ;     and cleared here on finish.
(1)   25/   22B80 :                     ; s - STATUS bits for the CMD interrupt
(1)   26/   22B80 :                     ; C - CMD Interrupt task mode
(1)   27/   22B80 :                     ;
(1)   28/   22B80 :                     ; I - Initialitation bit
(1)   29/   22B80 :                     ; m - Current mode for main loop, depending of
(1)   30/   22B80 :                     ;     the CPU
(1)   31/   22B80 :                     ; *************************************************
(1)   32/   22B80 :                     
(1)   33/ 6000000 :                     		phase CS3	; Now we are at SDRAM
(1)   34/ 6000000 :                     		cpu SH7600	; Should be SH7095 but this CPU mode works.
(1)   35/ 6000000 :                     
(1)   36/ 6000000 :                     ; ====================================================================
(1)   37/ 6000000 :                     ; ----------------------------------------------------------------
(1)   38/ 6000000 :                     ; MARS GLOBAL gbr variables for both SH2
(1)   39/ 6000000 :                     ; ----------------------------------------------------------------
(1)   40/ 6000000 :                     
(1)   41/ 6000000 : (MACRO)             			struct 0
(1)   41/ 6000000 : =$6000000           GLBL_LASTPC     set *
(1)   41/   22B80 :                                     dephase
(1)   41/   22B80 : =$22B80             GLBL_LASTORG    set *
(1)   41/       0 :                                     phase 0
(1)   42/       0 :                     marsGbl_PlyPzList_R	ds.l 1	; Current graphic piece to draw
(1)   43/       4 :                     marsGbl_PlyPzList_W	ds.l 1	; Current graphic piece to write
(1)   44/       8 :                     marsGbl_IndxPlgn	ds.l 1	; Current polygon to slice
(1)   45/       C :                     marsGbl_CurrZList	ds.l 1	; Current Zsort entry
(1)   46/      10 :                     marsGbl_CurrZTop	ds.l 1	; Current Zsort list
(1)   47/      14 :                     marsGbl_CurrFacePos	ds.l 1	; Current top face of the list while reading model data
(1)   48/      18 :                     marsGbl_CurrNumFaces	ds.w 1	; and the number of faces stored on that list
(1)   49/      1A :                     marsGbl_UpdModels	ds.w 1	; Flag to update models
(1)   50/      1C :                     marsGbl_WdgMode		ds.w 1	; Current Watchdog task
(1)   51/      1E :                     marsGbl_PolyBuffNum	ds.w 1	; Polygon-list swap number
(1)   52/      20 :                     marsGbl_PlyPzCntr	ds.w 1	; Number of graphic pieces to draw
(1)   53/      22 :                     marsGbl_PlgnCntr	ds.w 1	; Number of polygons to slice
(1)   54/      24 :                     marsGbl_XShift		ds.w 1	; Xshift bit at the start of master_loop (TODO: maybe a HBlank list?)
(1)   55/      26 :                     marsGbl_CurrFb		ds.w 1
(1)   56/      28 :                     marsGbl_RomBlkM		ds.w 1	; Flag to report that MASTER is reading from ROM area
(1)   57/      2A :                     marsGbl_RomBlkS		ds.w 1	; Flag to report that SLAVE is reading from ROM area
(1)   58/      2C :                     marsGbl_BgDrwAll	ds.w 1	; Write 2 to request FULL redraw
(1)   59/      2E :                     marsGbl_BgDrwR		ds.w 1	; Write 2 to only redraw offscreen section(s)
(1)   60/      30 :                     marsGbl_BgDrwL		ds.w 1	;
(1)   61/      32 :                     marsGbl_BgDrwU		ds.w 1	;
(1)   62/      34 :                     marsGbl_BgDrwD		ds.w 1	;
(1)   63/      36 :                     sizeof_MarsGbl		ds.l 0
(1)   64/      38 : (MACRO)             			finish
(1)   64/       0 :                                     !org GLBL_LASTORG
(1)   64/ 6000000 :                                     phase GLBL_LASTPC
(1)   65/ 6000000 :                     
(1)   66/ 6000000 :                     ; ====================================================================
(1)   67/ 6000000 :                     ; ----------------------------------------------------------------
(1)   68/ 6000000 :                     ; MASTER CPU VECTOR LIST (vbr)
(1)   69/ 6000000 :                     ; ----------------------------------------------------------------
(1)   70/ 6000000 :                     
(1)   71/ 6000000 :                     		align 4
(1)   72/ 6000000 :                     SH2_Master:
(1)   73/ 6000000 : 0600 0E70 0604 0000 		dc.l SH2_M_Entry,CS3|$40000	; Power PC, Stack
(1)   74/ 6000008 : 0600 0E70 0604 0000 		dc.l SH2_M_Entry,CS3|$40000	; Reset PC, Stack
(1)   75/ 6000010 :                     
(1)   76/ 6000010 : 0600 030C           		dc.l SH2_M_Error		; Illegal instruction
(1)   77/ 6000014 : 0000 0000           		dc.l 0				; reserved
(1)   78/ 6000018 : 0600 030C           		dc.l SH2_M_Error		; Invalid slot instruction
(1)   79/ 600001C : 2010 0400           		dc.l $20100400			; reserved
(1)   80/ 6000020 : 2010 0420           		dc.l $20100420			; reserved
(1)   81/ 6000024 : 0600 030C           		dc.l SH2_M_Error		; CPU address error
(1)   82/ 6000028 : 0600 030C           		dc.l SH2_M_Error		; DMA address error
(1)   83/ 600002C : 0600 030C           		dc.l SH2_M_Error		; NMI vector
(1)   84/ 6000030 : 0600 030C           		dc.l SH2_M_Error		; User break vector
(1)   85/ 6000034 :                     
(1)   86/ 6000034 : 0000 0000 0000 0000 		dc.l 0,0,0,0,0,0,0,0,0,0	; reserved
                    0000 0000 0000 0000 
                    0000 0000 0000 0000 
                    0000 0000 0000 0000 
                    0000 0000 0000 0000 
(1)   87/ 600005C : 0000 0000 0000 0000 		dc.l 0,0,0,0,0,0,0,0,0
                    0000 0000 0000 0000 
                    0000 0000 0000 0000 
                    0000 0000 0000 0000 
                    0000 0000           
(1)   88/ 6000080 :                     
(1)   89/ 6000080 : 0600 030C           		dc.l SH2_M_Error	; Trap user vectors
(1)   90/ 6000084 : 0600 030C           		dc.l SH2_M_Error
(1)   91/ 6000088 : 0600 030C           		dc.l SH2_M_Error
(1)   92/ 600008C : 0600 030C           		dc.l SH2_M_Error
(1)   93/ 6000090 : 0600 030C           		dc.l SH2_M_Error
(1)   94/ 6000094 : 0600 030C           		dc.l SH2_M_Error
(1)   95/ 6000098 : 0600 030C           		dc.l SH2_M_Error
(1)   96/ 600009C : 0600 030C           		dc.l SH2_M_Error
(1)   97/ 60000A0 : 0600 030C           		dc.l SH2_M_Error
(1)   98/ 60000A4 : 0600 030C           		dc.l SH2_M_Error
(1)   99/ 60000A8 : 0600 030C           		dc.l SH2_M_Error
(1)  100/ 60000AC : 0600 030C           		dc.l SH2_M_Error
(1)  101/ 60000B0 : 0600 030C           		dc.l SH2_M_Error
(1)  102/ 60000B4 : 0600 030C           		dc.l SH2_M_Error
(1)  103/ 60000B8 : 0600 030C           		dc.l SH2_M_Error
(1)  104/ 60000BC : 0600 030C           		dc.l SH2_M_Error
(1)  105/ 60000C0 : 0600 030C           		dc.l SH2_M_Error
(1)  106/ 60000C4 : 0600 030C           		dc.l SH2_M_Error
(1)  107/ 60000C8 : 0600 030C           		dc.l SH2_M_Error
(1)  108/ 60000CC : 0600 030C           		dc.l SH2_M_Error
(1)  109/ 60000D0 : 0600 030C           		dc.l SH2_M_Error
(1)  110/ 60000D4 : 0600 030C           		dc.l SH2_M_Error
(1)  111/ 60000D8 : 0600 030C           		dc.l SH2_M_Error
(1)  112/ 60000DC : 0600 030C           		dc.l SH2_M_Error
(1)  113/ 60000E0 : 0600 030C           		dc.l SH2_M_Error
(1)  114/ 60000E4 : 0600 030C           		dc.l SH2_M_Error
(1)  115/ 60000E8 : 0600 030C           		dc.l SH2_M_Error
(1)  116/ 60000EC : 0600 030C           		dc.l SH2_M_Error
(1)  117/ 60000F0 : 0600 030C           		dc.l SH2_M_Error
(1)  118/ 60000F4 : 0600 030C           		dc.l SH2_M_Error
(1)  119/ 60000F8 : 0600 030C           		dc.l SH2_M_Error
(1)  120/ 60000FC : 0600 030C           		dc.l SH2_M_Error
(1)  121/ 6000100 : 0600 0248            		dc.l master_irq		; Level 1 IRQ
(1)  122/ 6000104 : 0600 0248           		dc.l master_irq		; Level 2 & 3 IRQ
(1)  123/ 6000108 : 0600 0248           		dc.l master_irq		; Level 4 & 5 IRQ
(1)  124/ 600010C : 0600 0248           		dc.l master_irq		; Level 6 & 7 IRQ: PWM interupt
(1)  125/ 6000110 : 0600 0248           		dc.l master_irq		; Level 8 & 9 IRQ: Command interupt
(1)  126/ 6000114 : 0600 0248           		dc.l master_irq		; Level 10 & 11 IRQ: H Blank interupt
(1)  127/ 6000118 : 0600 0248           		dc.l master_irq		; Level 12 & 13 IRQ: V Blank interupt
(1)  128/ 600011C : 0600 0248           		dc.l master_irq		; Level 14 & 15 IRQ: Reset Button
(1)  129/ 6000120 :                     
(1)  130/ 6000120 :                     	; ON-chip interrupts go here (vbr+$120)
(1)  131/ 6000120 : 0600 0248           		dc.l master_irq		; Watchdog (custom)
(1)  132/ 6000124 :                     
(1)  133/ 6000124 :                     ; ====================================================================
(1)  134/ 6000124 :                     ; ----------------------------------------------------------------
(1)  135/ 6000124 :                     ; SLAVE CPU VECTOR LIST (vbr)
(1)  136/ 6000124 :                     ; ----------------------------------------------------------------
(1)  137/ 6000124 :                     
(1)  138/ 6000124 :                     		align 4
(1)  139/ 6000124 :                     SH2_Slave:
(1)  140/ 6000124 : 0600 13A0 0603 F000 		dc.l SH2_S_Entry,CS3|$3F000	; Cold PC,SP
(1)  141/ 600012C : 0600 13A0 0603 F000 		dc.l SH2_S_Entry,CS3|$3F000	; Manual PC,SP
(1)  142/ 6000134 :                     
(1)  143/ 6000134 : 0600 0314           		dc.l SH2_S_Error		; Illegal instruction
(1)  144/ 6000138 : 0000 0000           		dc.l 0				; reserved
(1)  145/ 600013C : 0600 0314           		dc.l SH2_S_Error		; Invalid slot instruction
(1)  146/ 6000140 : 2010 0400           		dc.l $20100400			; reserved
(1)  147/ 6000144 : 2010 0420           		dc.l $20100420			; reserved
(1)  148/ 6000148 : 0600 0314           		dc.l SH2_S_Error		; CPU address error
(1)  149/ 600014C : 0600 0314           		dc.l SH2_S_Error		; DMA address error
(1)  150/ 6000150 : 0600 0314           		dc.l SH2_S_Error		; NMI vector
(1)  151/ 6000154 : 0600 0314           		dc.l SH2_S_Error		; User break vector
(1)  152/ 6000158 :                     
(1)  153/ 6000158 : 0000 0000 0000 0000 		dc.l 0,0,0,0,0,0,0,0,0,0	; reserved
                    0000 0000 0000 0000 
                    0000 0000 0000 0000 
                    0000 0000 0000 0000 
                    0000 0000 0000 0000 
(1)  154/ 6000180 : 0000 0000 0000 0000 		dc.l 0,0,0,0,0,0,0,0,0
                    0000 0000 0000 0000 
                    0000 0000 0000 0000 
                    0000 0000 0000 0000 
                    0000 0000           
(1)  155/ 60001A4 :                     
(1)  156/ 60001A4 : 0600 0314           		dc.l SH2_S_Error		; Trap user vectors
(1)  157/ 60001A8 : 0600 0314           		dc.l SH2_S_Error
(1)  158/ 60001AC : 0600 0314           		dc.l SH2_S_Error
(1)  159/ 60001B0 : 0600 0314           		dc.l SH2_S_Error
(1)  160/ 60001B4 : 0600 0314           		dc.l SH2_S_Error
(1)  161/ 60001B8 : 0600 0314           		dc.l SH2_S_Error
(1)  162/ 60001BC : 0600 0314           		dc.l SH2_S_Error
(1)  163/ 60001C0 : 0600 0314           		dc.l SH2_S_Error
(1)  164/ 60001C4 : 0600 0314           		dc.l SH2_S_Error
(1)  165/ 60001C8 : 0600 0314           		dc.l SH2_S_Error
(1)  166/ 60001CC : 0600 0314           		dc.l SH2_S_Error
(1)  167/ 60001D0 : 0600 0314           		dc.l SH2_S_Error
(1)  168/ 60001D4 : 0600 0314           		dc.l SH2_S_Error
(1)  169/ 60001D8 : 0600 0314           		dc.l SH2_S_Error
(1)  170/ 60001DC : 0600 0314           		dc.l SH2_S_Error
(1)  171/ 60001E0 : 0600 0314           		dc.l SH2_S_Error
(1)  172/ 60001E4 : 0600 0314           		dc.l SH2_S_Error
(1)  173/ 60001E8 : 0600 0314           		dc.l SH2_S_Error
(1)  174/ 60001EC : 0600 0314           		dc.l SH2_S_Error
(1)  175/ 60001F0 : 0600 0314           		dc.l SH2_S_Error
(1)  176/ 60001F4 : 0600 0314           		dc.l SH2_S_Error
(1)  177/ 60001F8 : 0600 0314           		dc.l SH2_S_Error
(1)  178/ 60001FC : 0600 0314           		dc.l SH2_S_Error
(1)  179/ 6000200 : 0600 0314           		dc.l SH2_S_Error
(1)  180/ 6000204 : 0600 0314           		dc.l SH2_S_Error
(1)  181/ 6000208 : 0600 0314           		dc.l SH2_S_Error
(1)  182/ 600020C : 0600 0314           		dc.l SH2_S_Error
(1)  183/ 6000210 : 0600 0314           		dc.l SH2_S_Error
(1)  184/ 6000214 : 0600 0314           		dc.l SH2_S_Error
(1)  185/ 6000218 : 0600 0314           		dc.l SH2_S_Error
(1)  186/ 600021C : 0600 0314           		dc.l SH2_S_Error
(1)  187/ 6000220 : 0600 0314           		dc.l SH2_S_Error
(1)  188/ 6000224 : 0600 02AC            		dc.l slave_irq			; Level 1 IRQ
(1)  189/ 6000228 : 0600 02AC           		dc.l slave_irq			; Level 2 & 3 IRQ
(1)  190/ 600022C : 0600 02AC           		dc.l slave_irq			; Level 4 & 5 IRQ
(1)  191/ 6000230 : 0600 02AC           		dc.l slave_irq			; Level 6 & 7 IRQ: PWM interupt
(1)  192/ 6000234 : 0600 02AC           		dc.l slave_irq			; Level 8 & 9 IRQ: Command interupt
(1)  193/ 6000238 : 0600 02AC           		dc.l slave_irq			; Level 10 & 11 IRQ: H Blank interupt
(1)  194/ 600023C : 0600 02AC           		dc.l slave_irq			; Level 12 & 13 IRQ: V Blank interupt
(1)  195/ 6000240 : 0600 02AC           		dc.l slave_irq			; Level 14 & 15 IRQ: Reset Button
(1)  196/ 6000244 :                     
(1)  197/ 6000244 :                     	; ON-chip interrupts go here (vbr+$120)
(1)  198/ 6000244 : 0600 02AC           		dc.l slave_irq			; Watchdog (custom)
(1)  199/ 6000248 :                     
(1)  200/ 6000248 :                     ; ====================================================================
(1)  201/ 6000248 :                     ; ----------------------------------------------------------------
(1)  202/ 6000248 :                     ; irq
(1)  203/ 6000248 :                     ;
(1)  204/ 6000248 :                     ; r0-r1 are safe
(1)  205/ 6000248 :                     ; ----------------------------------------------------------------
(1)  206/ 6000248 :                     
(1)  207/ 6000248 :                     		align 4
(1)  208/ 6000248 :                     master_irq:
(1)  209/ 6000248 : 2F06                		mov.l	r0,@-r15
(1)  210/ 600024A : 2F16                		mov.l	r1,@-r15
(1)  211/ 600024C : 4F22                		sts.l	pr,@-r15
(1)  212/ 600024E : 0002                		stc	sr,r0
(1)  213/ 6000250 : 4009                		shlr2	r0
(1)  214/ 6000252 : C93C                		and	#$3C,r0
(1)  215/ 6000254 : D104                		mov	#int_m_list,r1
(1)  216/ 6000256 : 301C                		add	r1,r0
(1)  217/ 6000258 : 6102                		mov	@r0,r1
(1)  218/ 600025A : 410B                		jsr	@r1
(1)  219/ 600025C : 0009                		nop
(1)  220/ 600025E : 4F26                		lds.l	@r15+,pr
(1)  221/ 6000260 : 61F6                		mov.l	@r15+,r1
(1)  222/ 6000262 : 60F6                		mov.l	@r15+,r0
(1)  223/ 6000264 : 002B                		rte
(1)  224/ 6000266 : 0009                		nop
(1)  225/ 6000268 :                     		align 4
(1)  226/ 6000268 : 0600 026C           		ltorg
(1)  227/ 600026C :                     
(1)  228/ 600026C :                     ; ------------------------------------------------
(1)  229/ 600026C :                     ; irq list
(1)  230/ 600026C :                     ; ------------------------------------------------
(1)  231/ 600026C :                     
(1)  232/ 600026C :                     		align 4
(1)  233/ 600026C :                     int_m_list:
(1)  234/ 600026C : 0600 031C 0600 031C 		dc.l m_irq_bad,m_irq_bad
(1)  235/ 6000274 : 0600 031C 0600 031C 		dc.l m_irq_bad,m_irq_bad
(1)  236/ 600027C : C000 0000 C000 0000 		dc.l m_irq_custom,m_irq_custom
(1)  237/ 6000284 : 0600 0320 0600 0320 		dc.l m_irq_pwm,m_irq_pwm
(1)  238/ 600028C : 0600 0340 0600 0340 		dc.l m_irq_cmd,m_irq_cmd
(1)  239/ 6000294 : 0600 03B0 0600 03B0 		dc.l m_irq_h,m_irq_h
(1)  240/ 600029C : 0600 03D0 0600 03D0 		dc.l m_irq_v,m_irq_v
(1)  241/ 60002A4 : 0600 03F0 0600 03F0 		dc.l m_irq_vres,m_irq_vres
(1)  242/ 60002AC :                     
(1)  243/ 60002AC :                     ; ====================================================================
(1)  244/ 60002AC :                     ; ----------------------------------------------------------------
(1)  245/ 60002AC :                     ; irq
(1)  246/ 60002AC :                     ;
(1)  247/ 60002AC :                     ; r0-r1 are safe
(1)  248/ 60002AC :                     ; ----------------------------------------------------------------
(1)  249/ 60002AC :                     
(1)  250/ 60002AC :                     slave_irq:
(1)  251/ 60002AC : 2F06                		mov.l	r0,@-r15
(1)  252/ 60002AE : 2F16                		mov.l	r1,@-r15
(1)  253/ 60002B0 : 4F22                		sts.l	pr,@-r15
(1)  254/ 60002B2 :                     
(1)  255/ 60002B2 : 0002                		stc	sr,r0
(1)  256/ 60002B4 : 4009                		shlr2	r0
(1)  257/ 60002B6 : C93C                		and	#$3C,r0
(1)  258/ 60002B8 : D158                		mov	#int_s_list,r1
(1)  259/ 60002BA : 301C                		add	r1,r0
(1)  260/ 60002BC : 6102                		mov	@r0,r1
(1)  261/ 60002BE : 410B                		jsr	@r1
(1)  262/ 60002C0 : 0009                		nop
(1)  263/ 60002C2 :                     
(1)  264/ 60002C2 : 4F26                		lds.l	@r15+,pr
(1)  265/ 60002C4 : 61F6                		mov.l	@r15+,r1
(1)  266/ 60002C6 : 60F6                		mov.l	@r15+,r0
(1)  267/ 60002C8 : 002B                		rte
(1)  268/ 60002CA : 0009                		nop
(1)  269/ 60002CC :                     		align 4
(1)  270/ 60002CC :                     
(1)  271/ 60002CC :                     ; ------------------------------------------------
(1)  272/ 60002CC :                     ; irq list
(1)  273/ 60002CC :                     ; ------------------------------------------------
(1)  274/ 60002CC :                     
(1)  275/ 60002CC :                     int_s_list:
(1)  276/ 60002CC : 0600 0458 0600 0458 		dc.l s_irq_bad,s_irq_bad
(1)  277/ 60002D4 : 0600 0458 0600 0458 		dc.l s_irq_bad,s_irq_bad
(1)  278/ 60002DC : 0600 0458 0600 14D0 		dc.l s_irq_bad,s_irq_custom
(1)  279/ 60002E4 : C000 0150 C000 0150 		dc.l s_irq_pwm,s_irq_pwm
(1)  280/ 60002EC : 0600 045C 0600 045C 		dc.l s_irq_cmd,s_irq_cmd
(1)  281/ 60002F4 : 0600 064C 0600 064C 		dc.l s_irq_h,s_irq_h
(1)  282/ 60002FC : 0600 066C 0600 066C 		dc.l s_irq_v,s_irq_v
(1)  283/ 6000304 : 0600 068C 0600 068C 		dc.l s_irq_vres,s_irq_vres
(1)  284/ 600030C :                     
(1)  285/ 600030C :                     ; ====================================================================
(1)  286/ 600030C :                     ; ----------------------------------------------------------------
(1)  287/ 600030C :                     ; Noraml error trap
(1)  288/ 600030C :                     ; ----------------------------------------------------------------
(1)  289/ 600030C :                     
(1)  290/ 600030C :                     SH2_M_Error:
(1)  291/ 600030C : 0009                		nop
(1)  292/ 600030E : AFFD                		bra	SH2_M_Error
(1)  293/ 6000310 : 0009                		nop
(1)  294/ 6000312 :                     		align 4
(1)  295/ 6000314 :                     SH2_S_Error:
(1)  296/ 6000314 : 0009                		nop
(1)  297/ 6000316 : AFFD                		bra	SH2_S_Error
(1)  298/ 6000318 : 0009                		nop
(1)  299/ 600031A :                     		align 4
(1)  300/ 600031C :                     
(1)  301/ 600031C :                     ; ====================================================================
(1)  302/ 600031C :                     ; ----------------------------------------------------------------
(1)  303/ 600031C :                     ; MARS Interrupts
(1)  304/ 600031C :                     ; ----------------------------------------------------------------
(1)  305/ 600031C :                     
(1)  306/ 600031C :                     ; =================================================================
(1)  307/ 600031C :                     ; ------------------------------------------------
(1)  308/ 600031C :                     ; Master | Unused interrupt
(1)  309/ 600031C :                     ; ------------------------------------------------
(1)  310/ 600031C :                     
(1)  311/ 600031C :                     		align 4
(1)  312/ 600031C :                     m_irq_bad:
(1)  313/ 600031C : 000B                		rts
(1)  314/ 600031E : 0009                		nop
(1)  315/ 6000320 :                     		align 4
(1)  316/ 6000320 :                     
(1)  317/ 6000320 :                     ; =================================================================
(1)  318/ 6000320 :                     ; ------------------------------------------------
(1)  319/ 6000320 :                     ; Master | PWM Interrupt
(1)  320/ 6000320 :                     ; ------------------------------------------------
(1)  321/ 6000320 :                     
(1)  322/ 6000320 :                     m_irq_pwm:
(1)  323/ 6000320 : 9096                		mov	#$F0,r0
(1)  324/ 6000322 : 400E                		ldc	r0,sr
(1)  325/ 6000324 : 9195                		mov	#_FRT,r1
(1)  326/ 6000326 : 8417                		mov.b	@(7,r1),r0
(1)  327/ 6000328 : CA02                		xor	#2,r0
(1)  328/ 600032A : 8017                		mov.b	r0,@(7,r1)
(1)  329/ 600032C : D13C                		mov	#_sysreg+pwmintclr,r1
(1)  330/ 600032E : 2101                		mov.w	r0,@r1
(1)  331/ 6000330 : 0009                		nop
(1)  332/ 6000332 : 0009                		nop
(1)  333/ 6000334 : 0009                		nop
(1)  334/ 6000336 : 0009                		nop
(1)  335/ 6000338 : 0009                		nop
(1)  336/ 600033A : 000B                		rts
(1)  337/ 600033C : 0009                		nop
(1)  338/ 600033E :                     		align 4
(1)  339/ 6000340 :                     
(1)  340/ 6000340 :                     ; =================================================================
(1)  341/ 6000340 :                     ; ------------------------------------------------
(1)  342/ 6000340 :                     ; Master | CMD Interrupt
(1)  343/ 6000340 :                     ; ------------------------------------------------
(1)  344/ 6000340 :                     
(1)  345/ 6000340 :                     m_irq_cmd:
(1)  346/ 6000340 : 9086                		mov	#$F0,r0
(1)  347/ 6000342 : 400E                		ldc	r0,sr
(1)  348/ 6000344 : 9185                		mov	#_FRT,r1
(1)  349/ 6000346 : 8417                		mov.b	@(7,r1),r0
(1)  350/ 6000348 : CA02                		xor	#2,r0
(1)  351/ 600034A : 8017                		mov.b	r0,@(7,r1)
(1)  352/ 600034C : D135                		mov	#_sysreg+cmdintclr,r1
(1)  353/ 600034E : 2101                		mov.w	r0,@r1
(1)  354/ 6000350 : 2F26                		mov	r2,@-r15
(1)  355/ 6000352 : 2F36                		mov	r3,@-r15
(1)  356/ 6000354 : 2F46                		mov	r4,@-r15
(1)  357/ 6000356 : D434                		mov	#_sysreg,r4
(1)  358/ 6000358 : E380                		mov	#_DMASOURCE0,r3
(1)  359/ 600035A : D234                		mov	#_sysreg+comm12,r2	; LSB only
(1)  360/ 600035C : D134                		mov	#_sysreg+dreqfifo,r1
(1)  361/ 600035E : 5033                		mov	@($C,r3),r0		; Check if last DMA is active
(1)  362/ 6000360 : C901                		and	#%01,r0
(1)  363/ 6000362 : 2008                		tst	r0,r0
(1)  364/ 6000364 : 8902                		bt	.not_yet
(1)  365/ 6000366 : E000                		mov	#0,r0			; Force DMA off
(1)  366/ 6000368 : 130C                		mov	r0,@($30,r3)
(1)  367/ 600036A : 1303                		mov	r0,@($C,r3)
(1)  368/ 600036C :                     .not_yet:
(1)  369/ 600036C : 1303                		mov	r0,@($C,r3)
(1)  370/ 600036E : D031                		mov	#RAM_Mars_DreqDma,r0
(1)  371/ 6000370 : 2312                		mov	r1,@r3			; Source
(1)  372/ 6000372 : 1301                		mov	r0,@(4,r3)		; Destination
(1)  373/ 6000374 : 8548                		mov.w	@(dreqlen,r4),r0	; TODO: a check if this gets Zero'd
(1)  374/ 6000376 : 600F                		exts.w	r0,r0
(1)  375/ 6000378 : 1302                		mov	r0,@(8,r3)		; Length (set by 68k)
(1)  376/ 600037A : 906B                		mov	#%0100010011100001,r0	; Transfer mode + DMA enable bit
(1)  377/ 600037C : 1303                		mov	r0,@($C,r3)		; Dest:Incr(01) Src:Keep(00) Size:Word(01)
(1)  378/ 600037E : E001                		mov	#1,r0			; _DMAOPERATION = 1
(1)  379/ 6000380 : 130C                		mov	r0,@($30,r3)
(1)  380/ 6000382 :                     
(1)  381/ 6000382 :                     	; *** HARDWARE NOTE ***
(1)  382/ 6000382 :                     	; DMA takes a little to properly start:
(1)  383/ 6000382 :                     	; Put 5 instructions (or 5 nops) after
(1)  384/ 6000382 :                     	; writing _DMAOPERATION = 1
(1)  385/ 6000382 :                     	;
(1)  386/ 6000382 :                     	; On 32X Emulators it starts right away.
(1)  387/ 6000382 : 6020                		mov.b	@r2,r0			; Tell Genesis we are ready to
(1)  388/ 6000384 : CB40                		or	#%01000000,r0		; recieve the data from DREQ
(1)  389/ 6000386 : 2200                		mov.b	r0,@r2
(1)  390/ 6000388 : 0009                		nop
(1)  391/ 600038A : 0009                		nop
(1)  392/ 600038C :                     .wait_dma:
(1)  393/ 600038C : 5033                		mov	@($C,r3),r0	; Read DMA's mode for the active/enabled bits
(1)  394/ 600038E : C802                		tst	#%10,r0		; Active?
(1)  395/ 6000390 : 89FC                		bt	.wait_dma
(1)  396/ 6000392 :                     .time_out:
(1)  397/ 6000392 : E000                		mov	#0,r0		; _DMAOPERATION = 0
(1)  398/ 6000394 : 130C                		mov	r0,@($30,r3)
(1)  399/ 6000396 :                     
(1)  400/ 6000396 :                     	; *** HARDWARE NOTE ***
(1)  401/ 6000396 :                     	; If the CPU reads or writes to the DESTINATION data
(1)  402/ 6000396 :                     	; as we just recieved at any location: The DMA
(1)  403/ 6000396 :                     	; will finish early when it reaches the location
(1)  404/ 6000396 :                     	; that got modified.
(1)  405/ 6000396 :                     	;
(1)  406/ 6000396 :                     	; The only workaround is to copy-paste the data
(1)  407/ 6000396 :                     	; we just received into another buffer for reading
(1)  408/ 6000396 :                     	; it safetly.
(1)  409/ 6000396 :                     	;
(1)  410/ 6000396 :                     	; 32X Emulators doesn't recreate this limitation.
(1)  411/ 6000396 : D128                		mov	#RAM_Mars_DreqDma,r1
(1)  412/ 6000398 : D228                		mov	#RAM_Mars_DreqRead,r2
(1)  413/ 600039A : 935C                		mov	#sizeof_dreq/4,r3	; NOTE: copying as 4bytes
(1)  414/ 600039C :                     .copy_safe:
(1)  415/ 600039C : 6016                		mov	@r1+,r0
(1)  416/ 600039E : 2202                		mov	r0,@r2
(1)  417/ 60003A0 : 4310                		dt	r3
(1)  418/ 60003A2 : 8FFB                		bf/s	.copy_safe
(1)  419/ 60003A4 : 7204                		add	#4,r2
(1)  420/ 60003A6 :                     .bad_size:
(1)  421/ 60003A6 :                     
(1)  422/ 60003A6 : 64F6                		mov	@r15+,r4
(1)  423/ 60003A8 : 63F6                		mov	@r15+,r3
(1)  424/ 60003AA : 62F6                		mov	@r15+,r2
(1)  425/ 60003AC : 000B                		rts
(1)  426/ 60003AE : 0009                		nop
(1)  427/ 60003B0 :                     		align 4
(1)  428/ 60003B0 :                     
(1)  429/ 60003B0 :                     ; =================================================================
(1)  430/ 60003B0 :                     ; ------------------------------------------------
(1)  431/ 60003B0 :                     ; Master | HBlank
(1)  432/ 60003B0 :                     ; ------------------------------------------------
(1)  433/ 60003B0 :                     
(1)  434/ 60003B0 :                     m_irq_h:
(1)  435/ 60003B0 : 904E                		mov	#$F0,r0
(1)  436/ 60003B2 : 400E                		ldc	r0,sr
(1)  437/ 60003B4 : 914D                		mov	#_FRT,r1
(1)  438/ 60003B6 : 8417                		mov.b	@(7,r1),r0
(1)  439/ 60003B8 : CA02                		xor	#2,r0
(1)  440/ 60003BA : 8017                		mov.b	r0,@(7,r1)
(1)  441/ 60003BC : D120                		mov	#_sysreg+hintclr,r1
(1)  442/ 60003BE : 2101                		mov.w	r0,@r1
(1)  443/ 60003C0 : 0009                		nop
(1)  444/ 60003C2 : 0009                		nop
(1)  445/ 60003C4 : 0009                		nop
(1)  446/ 60003C6 : 0009                		nop
(1)  447/ 60003C8 : 0009                		nop
(1)  448/ 60003CA : 000B                		rts
(1)  449/ 60003CC : 0009                		nop
(1)  450/ 60003CE :                     		align 4
(1)  451/ 60003D0 :                     
(1)  452/ 60003D0 :                     ; =================================================================
(1)  453/ 60003D0 :                     ; ------------------------------------------------
(1)  454/ 60003D0 :                     ; Master | VBlank
(1)  455/ 60003D0 :                     ; ------------------------------------------------
(1)  456/ 60003D0 :                     
(1)  457/ 60003D0 :                     m_irq_v:
(1)  458/ 60003D0 : 903E                		mov	#$F0,r0
(1)  459/ 60003D2 : 400E                		ldc	r0,sr
(1)  460/ 60003D4 : 913D                		mov	#_FRT,r1
(1)  461/ 60003D6 : 8417                		mov.b	@(7,r1),r0
(1)  462/ 60003D8 : CA02                		xor	#2,r0
(1)  463/ 60003DA : 8017                		mov.b	r0,@(7,r1)
(1)  464/ 60003DC : D119                		mov	#_sysreg+vintclr,r1
(1)  465/ 60003DE : 2101                		mov.w	r0,@r1
(1)  466/ 60003E0 : 0009                		nop
(1)  467/ 60003E2 : 0009                		nop
(1)  468/ 60003E4 : 0009                		nop
(1)  469/ 60003E6 : 0009                		nop
(1)  470/ 60003E8 : 0009                		nop
(1)  471/ 60003EA : 000B                		rts
(1)  472/ 60003EC : 0009                		nop
(1)  473/ 60003EE :                     		align 4
(1)  474/ 60003F0 :                     
(1)  475/ 60003F0 :                     ; =================================================================
(1)  476/ 60003F0 :                     ; ------------------------------------------------
(1)  477/ 60003F0 :                     ; Master | VRES Interrupt (RESET button on Genesis)
(1)  478/ 60003F0 :                     ; ------------------------------------------------
(1)  479/ 60003F0 :                     
(1)  480/ 60003F0 :                     m_irq_vres:
(1)  481/ 60003F0 : 902E                		mov.l	#$F0,r0				; Interrupts OFF
(1)  482/ 60003F2 : 400E                		ldc	r0,sr
(1)  483/ 60003F4 : 912D                		mov	#_FRT,r1
(1)  484/ 60003F6 : 8417                		mov.b	@(7,r1),r0
(1)  485/ 60003F8 : CA02                		xor	#2,r0
(1)  486/ 60003FA : 8017                		mov.b	r0,@(7,r1)
(1)  487/ 60003FC : D10A                		mov.l	#_sysreg,r1
(1)  488/ 60003FE : 811A                		mov.w	r0,@(vresintclr,r1)
(1)  489/ 6000400 : E280                		mov	#_DMASOURCE0,r2
(1)  490/ 6000402 : 5023                		mov	@($C,r2),r0
(1)  491/ 6000404 : C901                		and	#%01,r0
(1)  492/ 6000406 : 2008                		tst	r0,r0
(1)  493/ 6000408 : 8902                		bt	.not_yet
(1)  494/ 600040A : E000                		mov	#0,r0		; Force DMA off
(1)  495/ 600040C : 120C                		mov	r0,@($30,r2)
(1)  496/ 600040E : 1203                		mov	r0,@($C,r2)
(1)  497/ 6000410 :                     .not_yet:
(1)  498/ 6000410 :                     ; 		mov.b   @(7,r1),r0
(1)  499/ 6000410 :                     ; 		tst     #%001,r0
(1)  500/ 6000410 :                     ; .rv_stuck:
(1)  501/ 6000410 :                     ; 		bf	.rv_stuck
(1)  502/ 6000410 : D00D                		mov	#"M_OK",r0
(1)  503/ 6000412 : 1108                		mov	r0,@(comm0,r1)
(1)  504/ 6000414 : D00D                		mov	#SH2_M_HotStart,r0
(1)  505/ 6000416 : 402B                		jmp	@r0
(1)  506/ 6000418 : 0009                		nop
(1)  507/ 600041A :                     		align 4
(1)  508/ 600041C : 0600 02CC 2000 401C 		ltorg		; Save MASTER IRQ literals here
                    2000 401A 2000 4000 
                    2000 402C 2000 4012 
                    2600 9D30 2600 9D30 
                    2600 A160 2000 4018 
                    2000 4016 4D5F 4F4B 
                    0600 0ED4 00F0 FE10 
                    44E1 010C           
(1)  509/ 6000458 :                     
(1)  510/ 6000458 :                     ; =================================================================
(1)  511/ 6000458 :                     ; ------------------------------------------------
(1)  512/ 6000458 :                     ; Slave | Unused Interrupt
(1)  513/ 6000458 :                     ; ------------------------------------------------
(1)  514/ 6000458 :                     
(1)  515/ 6000458 :                     		align 4
(1)  516/ 6000458 :                     s_irq_bad:
(1)  517/ 6000458 : 000B                		rts
(1)  518/ 600045A : 0009                		nop
(1)  519/ 600045C :                     		align 4
(1)  520/ 600045C :                     
(1)  521/ 600045C :                     ; =================================================================
(1)  522/ 600045C :                     ; ------------------------------------------------
(1)  523/ 600045C :                     ; Slave | PWM Interrupt
(1)  524/ 600045C :                     ; ------------------------------------------------
(1)  525/ 600045C :                     
(1)  526/ 600045C :                     ; check cache.asm
(1)  527/ 600045C :                     ; s_irq_pwm:
(1)  528/ 600045C :                     
(1)  529/ 600045C :                     ; =================================================================
(1)  530/ 600045C :                     ; ------------------------------------------------
(1)  531/ 600045C :                     ; Slave | CMD Interrupt
(1)  532/ 600045C :                     ; ------------------------------------------------
(1)  533/ 600045C :                     
(1)  534/ 600045C :                     s_irq_cmd:
(1)  535/ 600045C : 90F2                		mov	#$F0,r0
(1)  536/ 600045E : 400E                		ldc	r0,sr
(1)  537/ 6000460 : 91F1                		mov	#_FRT,r1
(1)  538/ 6000462 : 8417                		mov.b	@(7,r1),r0
(1)  539/ 6000464 : CA02                		xor	#2,r0
(1)  540/ 6000466 : 8017                		mov.b	r0,@(7,r1)
(1)  541/ 6000468 : D16A                		mov	#_sysreg+cmdintclr,r1	; Clear CMD flag
(1)  542/ 600046A : 2101                		mov.w	r0,@r1
(1)  543/ 600046C :                     
(1)  544/ 600046C :                     	; ---------------------------------
(1)  545/ 600046C :                     	; *** GEMA PWM DRIVER ***
(1)  546/ 600046C :                     	; ---------------------------------
(1)  547/ 600046C :                     
(1)  548/ 600046C : D16A                		mov	#_sysreg+comm14,r1
(1)  549/ 600046E : 6010                		mov.b	@r1,r0			; MSB only
(1)  550/ 6000470 : C90F                		and	#%00001111,r0
(1)  551/ 6000472 : 8800                		cmp/eq	#0,r0
(1)  552/ 6000474 : 8917                		bt	.get_out
(1)  553/ 6000476 : 2F26                		mov	r2,@-r15
(1)  554/ 6000478 : 2F36                		mov	r3,@-r15
(1)  555/ 600047A : 2F46                		mov	r4,@-r15
(1)  556/ 600047C : 2F56                		mov	r5,@-r15
(1)  557/ 600047E : 2F66                		mov	r6,@-r15
(1)  558/ 6000480 : 2F76                		mov	r7,@-r15
(1)  559/ 6000482 : 2F86                		mov	r8,@-r15
(1)  560/ 6000484 : 2F96                		mov	r9,@-r15
(1)  561/ 6000486 : 2FA6                		mov	r10,@-r15
(1)  562/ 6000488 : 2FB6                		mov	r11,@-r15
(1)  563/ 600048A : 2FC6                		mov	r12,@-r15
(1)  564/ 600048C : 2FD6                		mov	r13,@-r15
(1)  565/ 600048E : 2FE6                		mov	r14,@-r15
(1)  566/ 6000490 : 4F12                		sts	macl,@-r15
(1)  567/ 6000492 : 4F02                		sts	mach,@-r15
(1)  568/ 6000494 : 4F22                		sts	pr,@-r15
(1)  569/ 6000496 : 8801                		cmp/eq	#1,r0
(1)  570/ 6000498 : 8918                		bt	.mode_1
(1)  571/ 600049A : 8802                		cmp/eq	#2,r0
(1)  572/ 600049C : 8905                		bt	.mode_2
(1)  573/ 600049E : 8803                		cmp/eq	#3,r0
(1)  574/ 60004A0 : 890D                		bt	.mode_3
(1)  575/ 60004A2 : A0A5                		bra	.no_trnsfrex
(1)  576/ 60004A4 : 0009                		nop
(1)  577/ 60004A6 :                     .get_out:
(1)  578/ 60004A6 : A0B3                		bra	.no_ztrnsfr
(1)  579/ 60004A8 : 0009                		nop
(1)  580/ 60004AA :                     
(1)  581/ 60004AA :                     ; ---------------------------------
(1)  582/ 60004AA :                     ; CMD Mode 2: PWM Backup enter
(1)  583/ 60004AA :                     ; ---------------------------------
(1)  584/ 60004AA :                     
(1)  585/ 60004AA :                     .mode_2:
(1)  586/ 60004AA : D05C                		mov	#MarsSnd_Refill,r0
(1)  587/ 60004AC : 400B                		jsr	@r0
(1)  588/ 60004AE : 0009                		nop
(1)  589/ 60004B0 : D15B                		mov	#MarsSnd_RvMode,r1	; Set backup-playback flag
(1)  590/ 60004B2 : E001                		mov	#1,r0
(1)  591/ 60004B4 : 2102                		mov	r0,@r1
(1)  592/ 60004B6 : D158                		mov	#_sysreg+comm14,r1
(1)  593/ 60004B8 : E000                		mov	#0,r0
(1)  594/ 60004BA : A099                		bra	.no_trnsfrex
(1)  595/ 60004BC : 2100                		mov.b	r0,@r1
(1)  596/ 60004BE :                     
(1)  597/ 60004BE :                     ; ---------------------------------
(1)  598/ 60004BE :                     ; CMD Mode 3: PWM Backup exit
(1)  599/ 60004BE :                     ; ---------------------------------
(1)  600/ 60004BE :                     
(1)  601/ 60004BE :                     .mode_3:
(1)  602/ 60004BE : D159                		mov	#MarsSnd_RvMode,r1	; Clear backup-playback flag
(1)  603/ 60004C0 : E000                		mov	#0,r0
(1)  604/ 60004C2 : 2102                		mov	r0,@r1
(1)  605/ 60004C4 : D154                		mov	#_sysreg+comm14,r1
(1)  606/ 60004C6 : E000                		mov	#0,r0
(1)  607/ 60004C8 : A092                		bra	.no_trnsfrex
(1)  608/ 60004CA : 2100                		mov.b	r0,@r1
(1)  609/ 60004CC :                     
(1)  610/ 60004CC :                     ; ---------------------------------
(1)  611/ 60004CC :                     ; CMD Mode 1: Z80 transfer
(1)  612/ 60004CC :                     ; ---------------------------------
(1)  613/ 60004CC :                     
(1)  614/ 60004CC :                     .mode_1:
(1)  615/ 60004CC :                     	; First we recieve changes from Z80
(1)  616/ 60004CC :                     	; using comm8  for data
(1)  617/ 60004CC :                     	;  and  comm14 for busy/clock bits (bits 7,6)
(1)  618/ 60004CC : D156                		mov	#_sysreg+comm8,r1
(1)  619/ 60004CE : D257                		mov	#MarsSnd_PwmControl,r2
(1)  620/ 60004D0 : D351                		mov	#_sysreg+comm14,r3	; control comm
(1)  621/ 60004D2 :                     .wait_1:
(1)  622/ 60004D2 : 6030                		mov.b	@r3,r0
(1)  623/ 60004D4 : C880                		tst	#%10000000,r0		; Z80 enter/exit
(1)  624/ 60004D6 : 8909                		bt	.exit_c
(1)  625/ 60004D8 : C840                		tst	#%01000000,r0		; wait CLOCK
(1)  626/ 60004DA : 89FA                		bt	.wait_1
(1)  627/ 60004DC :                     .copy_1:
(1)  628/ 60004DC : 6012                		mov	@r1,r0
(1)  629/ 60004DE : 2202                		mov	r0,@r2
(1)  630/ 60004E0 : 7204                		add	#4,r2
(1)  631/ 60004E2 : 6030                		mov.b	@r3,r0			; CLK done
(1)  632/ 60004E4 : C9BF                		and	#%10111111,r0
(1)  633/ 60004E6 : 2300                		mov.b	r0,@r3
(1)  634/ 60004E8 : AFF3                		bra	.wait_1
(1)  635/ 60004EA : 0009                		nop
(1)  636/ 60004EC :                     .exit_c:
(1)  637/ 60004EC :                     
(1)  638/ 60004EC :                     	; Now loop for channels that need updating
(1)  639/ 60004EC :                     	;
(1)  640/ 60004EC :                     	; TODO: clearly rushed... but it works.
(1)  641/ 60004EC : E100                		mov	#0,r1				; r1 - Current PWM slot
(1)  642/ 60004EE : DE50                		mov	#MarsSnd_PwmControl,r14
(1)  643/ 60004F0 : 9AAA                		mov	#MAX_PWMCHNL,r10
(1)  644/ 60004F2 :                     .next_chnl:
(1)  645/ 60004F2 : 60E0                		mov.b	@r14,r0
(1)  646/ 60004F4 : C9FF                		and	#$FF,r0
(1)  647/ 60004F6 : 8800                		cmp/eq	#0,r0
(1)  648/ 60004F8 : 8976                		bt	.no_req
(1)  649/ 60004FA : 2DDA                		xor	r13,r13
(1)  650/ 60004FC : 2ED0                		mov.b	r13,@r14
(1)  651/ 60004FE : 6703                		mov	r0,r7
(1)  652/ 6000500 : C907                		and	#%111,r0
(1)  653/ 6000502 : 8804                		cmp/eq	#4,r0
(1)  654/ 6000504 : 8901                		bt	.pwm_keycut
(1)  655/ 6000506 : 8802                		cmp/eq	#2,r0
(1)  656/ 6000508 : 8B05                		bf	.no_keyoff
(1)  657/ 600050A :                     .pwm_keycut:
(1)  658/ 600050A : E200                		mov	#0,r2
(1)  659/ 600050C : D049                		mov	#MarsSound_PwmEnable,r0
(1)  660/ 600050E : 400B                		jsr	@r0
(1)  661/ 6000510 : 0009                		nop
(1)  662/ 6000512 : A069                		bra	.no_req
(1)  663/ 6000514 : 0009                		nop
(1)  664/ 6000516 :                     	; Normal playback
(1)  665/ 6000516 :                     .no_keyoff:
(1)  666/ 6000516 : 6073                		mov	r7,r0
(1)  667/ 6000518 : C810                		tst	#$10,r0
(1)  668/ 600051A : 890E                		bt	.no_pitchbnd
(1)  669/ 600051C : 6DE3                		mov	r14,r13
(1)  670/ 600051E : 7D08                		add	#8,r13		; skip COM
(1)  671/ 6000520 : 60D0                		mov.b	@r13,r0		; r2 - Get pitch MSB bits
(1)  672/ 6000522 : 7D08                		add	#8,r13
(1)  673/ 6000524 : C903                		and	#%11,r0
(1)  674/ 6000526 : 4018                		shll8	r0
(1)  675/ 6000528 : 6203                		mov	r0,r2
(1)  676/ 600052A : 60D0                		mov.b	@r13,r0		; Pitch LSB
(1)  677/ 600052C : 7D08                		add	#8,r13
(1)  678/ 600052E : C9FF                		and	#$FF,r0
(1)  679/ 6000530 : 202B                		or	r2,r0
(1)  680/ 6000532 : 6203                		mov	r0,r2
(1)  681/ 6000534 : D040                		mov	#MarsSound_SetPwmPitch,r0
(1)  682/ 6000536 : 400B                		jsr	@r0
(1)  683/ 6000538 : 0009                		nop
(1)  684/ 600053A :                     .no_pitchbnd:
(1)  685/ 600053A : 6073                		mov	r7,r0
(1)  686/ 600053C : C820                		tst	#$20,r0
(1)  687/ 600053E : 8908                		bt	.no_volumebnd
(1)  688/ 6000540 : 6703                		mov	r0,r7
(1)  689/ 6000542 : 6DE3                		mov	r14,r13
(1)  690/ 6000544 : 7D08                		add	#8,r13		; point to volume values
(1)  691/ 6000546 : 60D0                		mov.b	@r13,r0
(1)  692/ 6000548 : C9FC                		and	#%11111100,r0	; skip MSB pitch bits
(1)  693/ 600054A : 6203                		mov	r0,r2
(1)  694/ 600054C : D03B                		mov	#MarsSound_SetVolume,r0
(1)  695/ 600054E : 400B                		jsr	@r0
(1)  696/ 6000550 : 0009                		nop
(1)  697/ 6000552 :                     .no_volumebnd:
(1)  698/ 6000552 : 6073                		mov	r7,r0
(1)  699/ 6000554 : C801                		tst	#$01,r0		; key-on?
(1)  700/ 6000556 : 8947                		bt	.no_req
(1)  701/ 6000558 : 6DE3                		mov	r14,r13
(1)  702/ 600055A : 7D08                		add	#8,r13		; skip COM
(1)  703/ 600055C : 60D0                		mov.b	@r13,r0
(1)  704/ 600055E : 7D08                		add	#8,r13
(1)  705/ 6000560 : 6503                		mov	r0,r5
(1)  706/ 6000562 : C9FC                		and	#%11111100,r0	; skip MSB pitch bits
(1)  707/ 6000564 : 6603                		mov	r0,r6		; r6 - Volume
(1)  708/ 6000566 : 6053                		mov	r5,r0		; r5 - Get pitch MSB bits
(1)  709/ 6000568 : C903                		and	#%00000011,r0
(1)  710/ 600056A : 4018                		shll8	r0
(1)  711/ 600056C : 6503                		mov	r0,r5
(1)  712/ 600056E : 60D0                		mov.b	@r13,r0		; Pitch LSB
(1)  713/ 6000570 : 7D08                		add	#8,r13
(1)  714/ 6000572 : C9FF                		and	#$FF,r0
(1)  715/ 6000574 : 205B                		or	r5,r0
(1)  716/ 6000576 : 6503                		mov	r0,r5
(1)  717/ 6000578 : 60D0                		mov.b	@r13,r0		; flags | SH2 BANK
(1)  718/ 600057A : 7D08                		add	#8,r13
(1)  719/ 600057C : 6703                		mov	r0,r7		; r7 - Flags
(1)  720/ 600057E : C90F                		and	#%1111,r0
(1)  721/ 6000580 : 6803                		mov	r0,r8		; r8 - SH2 section (ROM or SDRAM)
(1)  722/ 6000582 : 4828                		shll16	r8
(1)  723/ 6000584 : 4818                		shll8	r8
(1)  724/ 6000586 : 4709                		shlr2	r7
(1)  725/ 6000588 : 4709                		shlr2	r7
(1)  726/ 600058A : 60D0                		mov.b	@r13,r0		; r2 - START point
(1)  727/ 600058C : 7D08                		add	#8,r13
(1)  728/ 600058E : C9FF                		and	#$FF,r0
(1)  729/ 6000590 : 4028                		shll16	r0
(1)  730/ 6000592 : 6303                		mov	r0,r3
(1)  731/ 6000594 : 60D0                		mov.b	@r13,r0
(1)  732/ 6000596 : 7D08                		add	#8,r13
(1)  733/ 6000598 : C9FF                		and	#$FF,r0
(1)  734/ 600059A : 4018                		shll8	r0
(1)  735/ 600059C : 6203                		mov	r0,r2
(1)  736/ 600059E : 60D0                		mov.b	@r13,r0
(1)  737/ 60005A0 : 7D08                		add	#8,r13
(1)  738/ 60005A2 : C9FF                		and	#$FF,r0
(1)  739/ 60005A4 : 203B                		or	r3,r0
(1)  740/ 60005A6 : 202B                		or	r2,r0
(1)  741/ 60005A8 : 6203                		mov	r0,r2
(1)  742/ 60005AA : 6423                		mov	r2,r4		; r4 - START copy
(1)  743/ 60005AC : 228B                		or	r8,r2		; add CS2
(1)  744/ 60005AE : 6024                		mov.b	@r2+,r0		; r3 - Length
(1)  745/ 60005B0 : C9FF                		and	#$FF,r0
(1)  746/ 60005B2 : 6303                		mov	r0,r3
(1)  747/ 60005B4 : 6024                		mov.b	@r2+,r0
(1)  748/ 60005B6 : C9FF                		and	#$FF,r0
(1)  749/ 60005B8 : 4018                		shll8	r0
(1)  750/ 60005BA : 230B                		or	r0,r3
(1)  751/ 60005BC : 6024                		mov.b	@r2+,r0
(1)  752/ 60005BE : C9FF                		and	#$FF,r0
(1)  753/ 60005C0 : 4028                		shll16	r0
(1)  754/ 60005C2 : 230B                		or	r0,r3
(1)  755/ 60005C4 : 334C                		add	r4,r3		; add end+start
(1)  756/ 60005C6 : 238B                		or	r8,r3		; add CS2
(1)  757/ 60005C8 : 6024                		mov.b	@r2+,r0		; get loop point
(1)  758/ 60005CA : C9FF                		and	#$FF,r0
(1)  759/ 60005CC : 6403                		mov	r0,r4
(1)  760/ 60005CE : 6024                		mov.b	@r2+,r0
(1)  761/ 60005D0 : C9FF                		and	#$FF,r0
(1)  762/ 60005D2 : 4018                		shll8	r0
(1)  763/ 60005D4 : 240B                		or	r0,r4
(1)  764/ 60005D6 : 6024                		mov.b	@r2+,r0
(1)  765/ 60005D8 : C9FF                		and	#$FF,r0
(1)  766/ 60005DA : 4028                		shll16	r0
(1)  767/ 60005DC : 240B                		or	r0,r4
(1)  768/ 60005DE : 9034                		mov	#%11111100,r0
(1)  769/ 60005E0 : 2809                		and	r0,r8
(1)  770/ 60005E2 : D017                		mov	#MarsSound_SetPwm,r0
(1)  771/ 60005E4 : 400B                		jsr	@r0
(1)  772/ 60005E6 : 0009                		nop
(1)  773/ 60005E8 :                     .no_req:
(1)  774/ 60005E8 : 7101                		add	#1,r1		; next PWM slot
(1)  775/ 60005EA : 4A10                		dt	r10
(1)  776/ 60005EC : 8F81                		bf/s	.next_chnl
(1)  777/ 60005EE : 7E01                		add	#1,r14		; next PWM entry
(1)  778/ 60005F0 :                     
(1)  779/ 60005F0 :                     	; ---------------------------------
(1)  780/ 60005F0 :                     	; *** END of PWM driver for GEMA
(1)  781/ 60005F0 :                     	; ---------------------------------
(1)  782/ 60005F0 :                     
(1)  783/ 60005F0 :                     .no_trnsfrex:
(1)  784/ 60005F0 : 4F26                		lds	@r15+,pr
(1)  785/ 60005F2 : 4F06                		lds	@r15+,mach
(1)  786/ 60005F4 : 4F16                		lds	@r15+,macl
(1)  787/ 60005F6 : 6EF6                		mov	@r15+,r14
(1)  788/ 60005F8 : 6DF6                		mov	@r15+,r13
(1)  789/ 60005FA : 6CF6                		mov	@r15+,r12
(1)  790/ 60005FC : 6BF6                		mov	@r15+,r11
(1)  791/ 60005FE : 6AF6                		mov	@r15+,r10
(1)  792/ 6000600 : 69F6                		mov	@r15+,r9
(1)  793/ 6000602 : 68F6                		mov	@r15+,r8
(1)  794/ 6000604 : 67F6                		mov	@r15+,r7
(1)  795/ 6000606 : 66F6                		mov	@r15+,r6
(1)  796/ 6000608 : 65F6                		mov	@r15+,r5
(1)  797/ 600060A : 64F6                		mov	@r15+,r4
(1)  798/ 600060C : 63F6                		mov	@r15+,r3
(1)  799/ 600060E : 62F6                		mov	@r15+,r2
(1)  800/ 6000610 :                     
(1)  801/ 6000610 :                     .no_ztrnsfr:
(1)  802/ 6000610 :                     
(1)  803/ 6000610 :                     ; 		nop
(1)  804/ 6000610 :                     ; 		nop
(1)  805/ 6000610 :                     ; 		nop
(1)  806/ 6000610 :                     ; 		nop
(1)  807/ 6000610 :                     ; 		nop
(1)  808/ 6000610 : 000B                		rts
(1)  809/ 6000612 : 0009                		nop
(1)  810/ 6000614 :                     		align 4
(1)  811/ 6000614 : 2000 401A 2000 402E 		ltorg
                    0600 0DF4 C000 073C 
                    C000 073C 2000 4028 
                    C000 0118 C000 0118 
                    0600 0DE4 0600 0DB4 
                    0600 0DCC 0600 0D78 
                    00F0 FE10 0007 00FC 
(1)  812/ 600064C :                     
(1)  813/ 600064C :                     ; =================================================================
(1)  814/ 600064C :                     ; ------------------------------------------------
(1)  815/ 600064C :                     ; Slave | HBlank
(1)  816/ 600064C :                     ; ------------------------------------------------
(1)  817/ 600064C :                     
(1)  818/ 600064C :                     s_irq_h:
(1)  819/ 600064C : 9044                		mov	#$F0,r0
(1)  820/ 600064E : 400E                		ldc	r0,sr
(1)  821/ 6000650 : 9143                		mov	#_FRT,r1
(1)  822/ 6000652 : 8417                		mov.b	@(7,r1),r0
(1)  823/ 6000654 : CA02                		xor	#2,r0
(1)  824/ 6000656 : 8017                		mov.b	r0,@(7,r1)
(1)  825/ 6000658 : D119                		mov	#_sysreg+hintclr,r1
(1)  826/ 600065A : 2101                		mov.w	r0,@r1
(1)  827/ 600065C : 0009                		nop
(1)  828/ 600065E : 0009                		nop
(1)  829/ 6000660 : 0009                		nop
(1)  830/ 6000662 : 0009                		nop
(1)  831/ 6000664 : 0009                		nop
(1)  832/ 6000666 : 000B                		rts
(1)  833/ 6000668 : 0009                		nop
(1)  834/ 600066A :                     		align 4
(1)  835/ 600066C :                     
(1)  836/ 600066C :                     ; =================================================================
(1)  837/ 600066C :                     ; ------------------------------------------------
(1)  838/ 600066C :                     ; Slave | VBlank
(1)  839/ 600066C :                     ; ------------------------------------------------
(1)  840/ 600066C :                     
(1)  841/ 600066C :                     s_irq_v:
(1)  842/ 600066C : 9034                		mov	#$F0,r0
(1)  843/ 600066E : 400E                		ldc	r0,sr
(1)  844/ 6000670 : 9133                		mov	#_FRT,r1
(1)  845/ 6000672 : 8417                		mov.b	@(7,r1),r0
(1)  846/ 6000674 : CA02                		xor	#2,r0
(1)  847/ 6000676 : 8017                		mov.b	r0,@(7,r1)
(1)  848/ 6000678 : D112                		mov	#_sysreg+vintclr,r1
(1)  849/ 600067A : 2101                		mov.w	r0,@r1
(1)  850/ 600067C : 0009                		nop
(1)  851/ 600067E : 0009                		nop
(1)  852/ 6000680 : 0009                		nop
(1)  853/ 6000682 : 0009                		nop
(1)  854/ 6000684 : 0009                		nop
(1)  855/ 6000686 : 000B                		rts
(1)  856/ 6000688 : 0009                		nop
(1)  857/ 600068A :                     		align 4
(1)  858/ 600068C :                     
(1)  859/ 600068C :                     ; =================================================================
(1)  860/ 600068C :                     ; ------------------------------------------------
(1)  861/ 600068C :                     ; Slave | VRES Interrupt (RESET button on Genesis)
(1)  862/ 600068C :                     ; ------------------------------------------------
(1)  863/ 600068C :                     
(1)  864/ 600068C :                     s_irq_vres:
(1)  865/ 600068C : 9024                		mov.l	#$F0,r0				; Interrupts OFF
(1)  866/ 600068E : 400E                		ldc	r0,sr
(1)  867/ 6000690 : 9123                		mov	#_FRT,r1
(1)  868/ 6000692 : 8417                		mov.b	@(7,r1),r0
(1)  869/ 6000694 : CA02                		xor	#2,r0
(1)  870/ 6000696 : 8017                		mov.b	r0,@(7,r1)
(1)  871/ 6000698 : D10B                		mov.l	#_sysreg,r1
(1)  872/ 600069A : 811A                		mov.w	r0,@(vresintclr,r1)
(1)  873/ 600069C : E280                		mov	#_DMASOURCE0,r2
(1)  874/ 600069E : 5023                		mov	@($C,r2),r0
(1)  875/ 60006A0 : C901                		and	#%01,r0
(1)  876/ 60006A2 : 2008                		tst	r0,r0
(1)  877/ 60006A4 : 8902                		bt	.not_yet
(1)  878/ 60006A6 : E000                		mov	#0,r0		; Force DMA off
(1)  879/ 60006A8 : 120C                		mov	r0,@($30,r2)
(1)  880/ 60006AA : 1203                		mov	r0,@($C,r2)
(1)  881/ 60006AC :                     .not_yet:
(1)  882/ 60006AC :                     ; 		mov	#$FFFFFE80,r1
(1)  883/ 60006AC :                     ; 		mov.w	#$A518,r0	; Disable Watchdog
(1)  884/ 60006AC :                     ; 		mov.w	r0,@r1
(1)  885/ 60006AC :                     
(1)  886/ 60006AC :                     ; 		mov.b   @(7,r1),r0
(1)  887/ 60006AC :                     ; 		tst     #%001,r0
(1)  888/ 60006AC :                     ; .rv_stuck:
(1)  889/ 60006AC :                     ; 		bf	.rv_stuck
(1)  890/ 60006AC : D207                		mov	#"M_OK",r2
(1)  891/ 60006AE : 5018                .wait_m:	mov	@(comm0,r1),r0
(1)  892/ 60006B0 : 3020                		cmp/eq	r2,r0
(1)  893/ 60006B2 : 8BFC                		bf	.wait_m
(1)  894/ 60006B4 : D006                		mov	#"S_OK",r0
(1)  895/ 60006B6 : 1109                		mov	r0,@(comm4,r1)
(1)  896/ 60006B8 : D006                		mov	#SH2_S_HotStart,r0
(1)  897/ 60006BA : 402B                		jmp	@r0
(1)  898/ 60006BC : 0009                		nop
(1)  899/ 60006BE :                     		align 4
(1)  900/ 60006C0 : 2000 4018 2000 4016 		ltorg			; Save SLAVE IRQ literals here
                    2000 4000 4D5F 4F4B 
                    535F 4F4B 0600 13F2 
                    00F0 FE10           
(1)  901/ 60006DC :                     
(1)  902/ 60006DC :                     ; ====================================================================
(1)  903/ 60006DC :                     ; ----------------------------------------------------------------
(1)  904/ 60006DC :                     ; MARS System features
(1)  905/ 60006DC :                     ; ----------------------------------------------------------------
(1)  906/ 60006DC :                     
(1)  907/ 60006DC :                     		include "system/mars/video.asm"
(2)    1/ 60006DC :                     ; ====================================================================
(2)    2/ 60006DC :                     ; ----------------------------------------------------------------
(2)    3/ 60006DC :                     ; MARS Video section
(2)    4/ 60006DC :                     ; ----------------------------------------------------------------
(2)    5/ 60006DC :                     
(2)    6/ 60006DC :                     ; ----------------------------------------
(2)    7/ 60006DC :                     ; Settings
(2)    8/ 60006DC :                     ; ----------------------------------------
(2)    9/ 60006DC :                     
(2)   10/ 60006DC : =$100               MAX_FACES	equ 256
(2)   11/ 60006DC : =$120               MAX_SVDP_PZ	equ 256+32
(2)   12/ 60006DC : =$FFFFFFFFFF..      MAX_ZDIST	equ -$2000		; Max 3D drawing distance (-Z)
(2)   13/ 60006DC : =$1E000             FBVRAM_PATCH	equ $1E000		; Framebuffer location for the affected XShift lines
(2)   14/ 60006DC :                     
(2)   15/ 60006DC :                     ; ----------------------------------------
(2)   16/ 60006DC :                     ; Variables
(2)   17/ 60006DC :                     ; ----------------------------------------
(2)   18/ 60006DC :                     
(2)   19/ 60006DC :                     ; 3D drawing area, affects 3D positions too.
(2)   20/ 60006DC : =$140               SCREEN_WIDTH	equ 320
(2)   21/ 60006DC : =$E0                SCREEN_HEIGHT	equ 224
(2)   22/ 60006DC :                     
(2)   23/ 60006DC :                     ; MSB
(2)   24/ 60006DC : =$80                PLGN_TEXURE	equ %10000000
(2)   25/ 60006DC : =$40                PLGN_TRI	equ %01000000
(2)   26/ 60006DC :                     
(2)   27/ 60006DC :                     ; ----------------------------------------
(2)   28/ 60006DC :                     ; Structs
(2)   29/ 60006DC :                     ; ----------------------------------------
(2)   30/ 60006DC :                     
(2)   31/ 60006DC :                     ; Be careful modifing these...
(2)   32/ 60006DC :                     ; The SH2 has limitation with indexing, bytes go first.
(2)   33/ 60006DC :                     ; (dont forget to align it)
(2)   34/ 60006DC :                     
(2)   35/ 60006DC : (MACRO)             		struct 0
(2)   35/ 60006DC : =$60006DC           GLBL_LASTPC     set *
(2)   35/   2325C :                                     dephase
(2)   35/   2325C : =$2325C             GLBL_LASTORG    set *
(2)   35/       0 :                                     phase 0
(2)   36/       0 :                     mbg_redraw	ds.b 1
(2)   37/       1 :                     mbg_flags	ds.b 1		; Current type of pixel-data: Indexed or Direct
(2)   38/       2 :                     mbg_xset	ds.b 1		; X-counter
(2)   39/       3 :                     mbg_yset	ds.b 1		; Y-counter
(2)   40/       4 :                     mbg_xpos_old	ds.w 1
(2)   41/       6 :                     mbg_ypos_old	ds.w 1
(2)   42/       8 :                     mbg_xinc_l	ds.w 1
(2)   43/       A :                     mbg_xinc_r	ds.w 1
(2)   44/       C :                     mbg_yinc_u	ds.w 1
(2)   45/       E :                     mbg_yinc_d	ds.w 1
(2)   46/      10 :                     mbg_width	ds.w 1
(2)   47/      12 :                     mbg_height	ds.w 1
(2)   48/      14 :                     mbg_yfb		ds.w 1		; TOP Y position, multiply by WIDTH externally
(2)   49/      16 :                     mbg_intrl_blk	ds.w 1		; Block size
(2)   50/      18 :                     mbg_intrl_w	ds.w 1		; Internal scrolling Width (MUST be larger than 320)
(2)   51/      1A :                     mbg_intrl_h	ds.w 1		; Internal scrolling Height
(2)   52/      1C :                     mbg_intrl_size	ds.l 1		;
(2)   53/      20 :                     mbg_data	ds.l 1
(2)   54/      24 :                     mbg_fbpos	ds.l 1		; Framebuffer TOPLEFT position
(2)   55/      28 :                     mbg_fbdata	ds.l 1		; Pixeldata location on Framebuffer
(2)   56/      2C :                     mbg_rfill	ds.l 1		; Refill buffer
(2)   57/      30 :                     mbg_indxinc	ds.l 1		; Index increment (NOTE: for all 4 pixels)
(2)   58/      34 :                     mbg_xpos	ds.l 1		; 0000.0000
(2)   59/      38 :                     mbg_ypos	ds.l 1		; 0000.0000
(2)   60/      3C :                     sizeof_marsbg	ds.l 0
(2)   61/      3C : (MACRO)             		finish
(2)   61/       0 :                                     !org GLBL_LASTORG
(2)   61/ 60006DC :                                     phase GLBL_LASTPC
(2)   62/ 60006DC :                     
(2)   63/ 60006DC :                     
(2)   64/ 60006DC : (MACRO)             		struct 0
(2)   64/ 60006DC : =$60006DC           GLBL_LASTPC     set *
(2)   64/   2325C :                                     dephase
(2)   64/   2325C : =$2325C             GLBL_LASTORG    set *
(2)   64/       0 :                                     phase 0
(2)   65/       0 :                     mbgsc_x_pos	ds.w 1		; 00.00
(2)   66/       2 :                     mbgsc_y_pos	ds.w 1		; 00.00
(2)   67/       4 :                     mbgsc_x_dx	ds.w 1		; 00.00
(2)   68/       6 :                     mbgsc_y_dy	ds.w 1		; 00.00
(2)   69/       8 :                     mbgsc_data	ds.l 1		; source data location
(2)   70/       C :                     sizeof_marsscbg	ds.l 0
(2)   71/       C : (MACRO)             		finish
(2)   71/       0 :                                     !org GLBL_LASTORG
(2)   71/ 60006DC :                                     phase GLBL_LASTPC
(2)   72/ 60006DC :                     
(2)   73/ 60006DC :                     ; ----------------------------------------
(2)   74/ 60006DC :                     
(2)   75/ 60006DC :                     ; ; model objects
(2)   76/ 60006DC :                     ; moved to const.asm
(2)   77/ 60006DC :                     ; 		struct 0
(2)   78/ 60006DC :                     ; mdl_data	ds.l 1			; Model data pointer, if zero: no model
(2)   79/ 60006DC :                     ; mdl_option	ds.l 1			; Model options: pixelvalue add
(2)   80/ 60006DC :                     ; mdl_x_pos	ds.l 1			; X position $000000.00
(2)   81/ 60006DC :                     ; mdl_y_pos	ds.l 1			; Y position $000000.00
(2)   82/ 60006DC :                     ; mdl_z_pos	ds.l 1			; Z position $000000.00
(2)   83/ 60006DC :                     ; mdl_x_rot	ds.l 1			; X rotation $000000.00
(2)   84/ 60006DC :                     ; mdl_y_rot	ds.l 1			; Y rotation $000000.00
(2)   85/ 60006DC :                     ; mdl_z_rot	ds.l 1			; Z rotation $000000.00
(2)   86/ 60006DC :                     ; mdl_animdata	ds.l 1			; Model animation data pointer, zero: no animation
(2)   87/ 60006DC :                     ; mdl_animframe	ds.l 1			; Current frame in animation
(2)   88/ 60006DC :                     ; mdl_animtimer	ds.l 1			; Animation timer
(2)   89/ 60006DC :                     ; mdl_animspd	ds.l 1			; Animation USER speed setting
(2)   90/ 60006DC :                     ; sizeof_mdlobj	ds.l 0
(2)   91/ 60006DC :                     ; 		finish
(2)   92/ 60006DC :                     
(2)   93/ 60006DC :                     ; field view camera
(2)   94/ 60006DC : (MACRO)             		struct 0
(2)   94/ 60006DC : =$60006DC           GLBL_LASTPC     set *
(2)   94/   2325C :                                     dephase
(2)   94/   2325C : =$2325C             GLBL_LASTORG    set *
(2)   94/       0 :                                     phase 0
(2)   95/       0 :                     cam_x_pos	ds.l 1			; X position $000000.00
(2)   96/       4 :                     cam_y_pos	ds.l 1			; Y position $000000.00
(2)   97/       8 :                     cam_z_pos	ds.l 1			; Z position $000000.00
(2)   98/       C :                     cam_x_rot	ds.l 1			; X rotation $000000.00
(2)   99/      10 :                     cam_y_rot	ds.l 1			; Y rotation $000000.00
(2)  100/      14 :                     cam_z_rot	ds.l 1			; Z rotation $000000.00
(2)  101/      18 :                     cam_animdata	ds.l 1			; Model animation data pointer, zero: no animation
(2)  102/      1C :                     cam_animframe	ds.l 1			; Current frame in animation
(2)  103/      20 :                     cam_animtimer	ds.l 1			; Animation timer
(2)  104/      24 :                     cam_animspd	ds.l 1			; Animation speed
(2)  105/      28 :                     sizeof_camera	ds.l 0
(2)  106/      28 : (MACRO)             		finish
(2)  106/       0 :                                     !org GLBL_LASTORG
(2)  106/ 60006DC :                                     phase GLBL_LASTPC
(2)  107/ 60006DC :                     
(2)  108/ 60006DC :                     ; 		struct 0
(2)  109/ 60006DC :                     ; mdllay_data	ds.l 1			; Model layout data, zero: Don't use layout
(2)  110/ 60006DC :                     ; mdllay_x	ds.l 1			; X position
(2)  111/ 60006DC :                     ; mdllay_y	ds.l 1			; Y position
(2)  112/ 60006DC :                     ; mdllay_z	ds.l 1			; Z position
(2)  113/ 60006DC :                     ; mdllay_x_last	ds.l 1			; LAST saved X position
(2)  114/ 60006DC :                     ; mdllay_y_last	ds.l 1			; LAST saved Y position
(2)  115/ 60006DC :                     ; mdllay_z_last	ds.l 1			; LAST saved Z position
(2)  116/ 60006DC :                     ; mdllay_xr_last	ds.l 1			; LAST saved X rotation
(2)  117/ 60006DC :                     ; sizeof_layout	ds.l 0
(2)  118/ 60006DC :                     ; 		finish
(2)  119/ 60006DC :                     
(2)  120/ 60006DC : (MACRO)             		struct 0
(2)  120/ 60006DC : =$60006DC           GLBL_LASTPC     set *
(2)  120/   2325C :                                     dephase
(2)  120/   2325C : =$2325C             GLBL_LASTORG    set *
(2)  120/       0 :                                     phase 0
(2)  121/       0 :                     plypz_type	ds.l 1			; Type | Option
(2)  122/       4 :                     plypz_mtrl	ds.l 1
(2)  123/       8 :                     plypz_ypos	ds.l 1			; Ytop | Ybottom
(2)  124/       C :                     plypz_xl	ds.l 1
(2)  125/      10 :                     plypz_xl_dx	ds.l 1
(2)  126/      14 :                     plypz_xr	ds.l 1
(2)  127/      18 :                     plypz_xr_dx	ds.l 1
(2)  128/      1C :                     plypz_src_xl	ds.l 1
(2)  129/      20 :                     plypz_src_xl_dx	ds.l 1
(2)  130/      24 :                     plypz_src_yl	ds.l 1
(2)  131/      28 :                     plypz_src_yl_dx	ds.l 1
(2)  132/      2C :                     plypz_src_xr	ds.l 1
(2)  133/      30 :                     plypz_src_xr_dx	ds.l 1
(2)  134/      34 :                     plypz_src_yr	ds.l 1
(2)  135/      38 :                     plypz_src_yr_dx	ds.l 1
(2)  136/      3C :                     sizeof_plypz	ds.l 0
(2)  137/      3C : (MACRO)             		finish
(2)  137/       0 :                                     !org GLBL_LASTORG
(2)  137/ 60006DC :                                     phase GLBL_LASTPC
(2)  138/ 60006DC :                     
(2)  139/ 60006DC :                     ; $38 bytes
(2)  140/ 60006DC : (MACRO)             		struct 0
(2)  140/ 60006DC : =$60006DC           GLBL_LASTPC     set *
(2)  140/   2325C :                                     dephase
(2)  140/   2325C : =$2325C             GLBL_LASTORG    set *
(2)  140/       0 :                                     phase 0
(2)  141/       0 :                     polygn_type	ds.l 1		; %MSTw wwww xxxx aaaa | Type bits and Material option (Width or PalIncr)
(2)  142/       4 :                     polygn_mtrl	ds.l 1		; Material Type: Color (0-255) or Texture data address
(2)  143/       8 :                     polygn_points	ds.l 4*2	; X/Y positions
(2)  144/      28 :                     polygn_srcpnts	ds.w 4*2	; X/Y texture points (16-bit), ignored on solidcolor
(2)  145/      38 :                     sizeof_polygn	ds.l 0
(2)  146/      38 : (MACRO)             		finish
(2)  146/       0 :                                     !org GLBL_LASTORG
(2)  146/ 60006DC :                                     phase GLBL_LASTPC
(2)  147/ 60006DC :                     
(2)  148/ 60006DC :                     ; ====================================================================
(2)  149/ 60006DC :                     ; ----------------------------------------------------------------
(2)  150/ 60006DC :                     ; Init MARS Video
(2)  151/ 60006DC :                     ; ----------------------------------------------------------------
(2)  152/ 60006DC :                     
(2)  153/ 60006DC :                     MarsVideo_Init:
(2)  154/ 60006DC : 4F22                		sts	pr,@-r15
(2)  155/ 60006DE : D116                		mov	#_sysreg,r1
(2)  156/ 60006E0 : 9034                		mov 	#FM,r0			; Set SVDP permission to SH2, but the Genesis
(2)  157/ 60006E2 : 8010                  		mov.b	r0,@(adapter,r1)	; will control the pallete using DREQ
(2)  158/ 60006E4 : D115                		mov 	#_vdpreg,r1
(2)  159/ 60006E6 : E000                		mov	#0,r0			; Start at blank
(2)  160/ 60006E8 : 8011                		mov.b	r0,@(bitmapmd,r1)
(2)  161/ 60006EA : C026                		mov.b	r0,@(marsGbl_CurrFb,gbr); Clear lastfb bit
(2)  162/ 60006EC : D214                		mov	#_framebuffer,r2	; Make null nametables
(2)  163/ 60006EE : B013                		bsr	.def_fb
(2)  164/ 60006F0 : 0009                		nop
(2)  165/ 60006F2 : B011                		bsr	.def_fb
(2)  166/ 60006F4 : 0009                		nop
(2)  167/ 60006F6 : D113                		mov	#RAM_Mars_Objects,r1
(2)  168/ 60006F8 : E210                		mov	#MAX_MODELS,r2
(2)  169/ 60006FA : E000                		mov	#0,r0
(2)  170/ 60006FC :                     .clnup:
(2)  171/ 60006FC : 1100                		mov	r0,@(mdl_data,r1)
(2)  172/ 60006FE :                     ; 		mov	r0,@(mdl_animdata,r1)
(2)  173/ 60006FE : 1102                		mov	r0,@(mdl_x_pos,r1)
(2)  174/ 6000700 : 1105                		mov	r0,@(mdl_x_rot,r1)
(2)  175/ 6000702 : 1103                		mov	r0,@(mdl_y_pos,r1)
(2)  176/ 6000704 : 1106                		mov	r0,@(mdl_y_rot,r1)
(2)  177/ 6000706 : 1103                		mov	r0,@(mdl_y_pos,r1)
(2)  178/ 6000708 : 1106                		mov	r0,@(mdl_y_rot,r1)
(2)  179/ 600070A : 4210                		dt	r2
(2)  180/ 600070C : 8FF6                		bf/s	.clnup
(2)  181/ 600070E : 7120                		add	#sizeof_mdlobj,r1
(2)  182/ 6000710 :                     
(2)  183/ 6000710 :                     	; Clear values
(2)  184/ 6000710 :                     	; TODO: checar bien esto porque se rompe en RESET
(2)  185/ 6000710 :                     ; 		mov	#RAM_Mars_BgBuffScrl,r1
(2)  186/ 6000710 :                     ; 		mov	#0,r0
(2)  187/ 6000710 :                     ; 		mov	r0,@(mbg_data,r1)
(2)  188/ 6000710 :                     ; 		mov	r0,@(mbg_xpos,r1)
(2)  189/ 6000710 :                     ; 		mov	r0,@(mbg_ypos,r1)
(2)  190/ 6000710 :                     ; 		mov.w	r0,@(mbg_xpos_old,r1)
(2)  191/ 6000710 :                     ; 		mov.w	r0,@(mbg_ypos_old,r1)
(2)  192/ 6000710 :                     ; 		mov.b	r0,@(mbg_xset,r1)
(2)  193/ 6000710 :                     ; 		mov.b	r0,@(mbg_yset,r1)
(2)  194/ 6000710 : 4F26                		lds	@r15+,pr
(2)  195/ 6000712 : 000B                		rts
(2)  196/ 6000714 : 0009                		nop
(2)  197/ 6000716 :                     		align 4
(2)  198/ 6000718 :                     ; Default linetable
(2)  199/ 6000718 :                     .def_fb:
(2)  200/ 6000718 : 6323                		mov	r2,r3
(2)  201/ 600071A : D00B                		mov	#$1FD80/2,r0		; very last usable (blank) line
(2)  202/ 600071C : 9417                		mov	#240,r4
(2)  203/ 600071E :                     .nxt_lne:
(2)  204/ 600071E : 2301                		mov.w	r0,@r3
(2)  205/ 6000720 : 4410                		dt	r4
(2)  206/ 6000722 : 8FFC                		bf/s	.nxt_lne
(2)  207/ 6000724 : 7302                		add	#2,r3
(2)  208/ 6000726 : 841B                		mov.b	@(framectl,r1),r0	; Frameswap & wait
(2)  209/ 6000728 : CA01                		xor	#1,r0
(2)  210/ 600072A : 6303                		mov	r0,r3
(2)  211/ 600072C : 801B                		mov.b	r0,@(framectl,r1)
(2)  212/ 600072E : 841B                .wait_frm:	mov.b	@(framectl,r1),r0
(2)  213/ 6000730 : 3300                		cmp/eq	r0,r3
(2)  214/ 6000732 : 8BFC                		bf	.wait_frm
(2)  215/ 6000734 : 000B                		rts
(2)  216/ 6000736 : 0009                		nop
(2)  217/ 6000738 :                     		align 4
(2)  218/ 6000738 :                     
(2)  219/ 6000738 : 2000 4000 2000 4100 		ltorg
                    0400 0000 2601 1668 
                    0000 FEC0 0080 00F0 
(2)  220/ 6000750 :                     
(2)  221/ 6000750 :                     ; ====================================================================
(2)  222/ 6000750 :                     ; ----------------------------------------------------------------
(2)  223/ 6000750 :                     ; Default subroutines
(2)  224/ 6000750 :                     ; ----------------------------------------------------------------
(2)  225/ 6000750 :                     
(2)  226/ 6000750 :                     ; ; ------------------------------------
(2)  227/ 6000750 :                     ; ; MarsVdp_LoadPal
(2)  228/ 6000750 :                     ; ;
(2)  229/ 6000750 :                     ; ; Load palette to RAM
(2)  230/ 6000750 :                     ; ; then the Palette will be transfered
(2)  231/ 6000750 :                     ; ; on VBlank
(2)  232/ 6000750 :                     ; ;
(2)  233/ 6000750 :                     ; ; Input:
(2)  234/ 6000750 :                     ; ; r1 - Palette data
(2)  235/ 6000750 :                     ; ; r2 - Start index
(2)  236/ 6000750 :                     ; ; r3 - Number of colors
(2)  237/ 6000750 :                     ; ; r4 - OR value ($0000 or $8000)
(2)  238/ 6000750 :                     ; ;
(2)  239/ 6000750 :                     ; ; Uses:
(2)  240/ 6000750 :                     ; ; r0,r4-r6
(2)  241/ 6000750 :                     ; ; ------------------------------------
(2)  242/ 6000750 :                     ;
(2)  243/ 6000750 :                     ; MarsVideo_LoadPal:
(2)  244/ 6000750 :                     ; ; 		mov.w	@(marsGbl_PalDmaMidWr,gbr),r0
(2)  245/ 6000750 :                     ; ; 		cmp/eq	#1,r0
(2)  246/ 6000750 :                     ; ; 		bt	MarsVideo_LoadPal
(2)  247/ 6000750 :                     ; 		mov 	r1,r5
(2)  248/ 6000750 :                     ; 		mov 	#RAM_Mars_Palette,r6
(2)  249/ 6000750 :                     ; 		mov 	r2,r0
(2)  250/ 6000750 :                     ; 		shll	r0
(2)  251/ 6000750 :                     ; 		add 	r0,r6
(2)  252/ 6000750 :                     ; 		mov 	r3,r0
(2)  253/ 6000750 :                     ; ; 		and	#$FF,r0
(2)  254/ 6000750 :                     ; ; 		cmp/pl	r0
(2)  255/ 6000750 :                     ; ; 		bf	.badlen
(2)  256/ 6000750 :                     ; 		mov	#256,r7
(2)  257/ 6000750 :                     ; 		cmp/gt	r7,r0
(2)  258/ 6000750 :                     ; 		bt	.loop
(2)  259/ 6000750 :                     ; 		mov	r0,r7
(2)  260/ 6000750 :                     ; .loop:
(2)  261/ 6000750 :                     ; 		mov.w	@r5+,r0
(2)  262/ 6000750 :                     ; 		or	r4,r0
(2)  263/ 6000750 :                     ; 		mov.w	r0,@r6
(2)  264/ 6000750 :                     ; 		dt	r7
(2)  265/ 6000750 :                     ; 		bf/s	.loop
(2)  266/ 6000750 :                     ; 		add 	#2,r6
(2)  267/ 6000750 :                     ; .badlen:
(2)  268/ 6000750 :                     ; 		mov	#RAM_Mars_Palette,r1	; lazy fix
(2)  269/ 6000750 :                     ; 		mov.w	@r1,r0			; for background
(2)  270/ 6000750 :                     ; 		mov	#$7FFF,r2
(2)  271/ 6000750 :                     ; 		and	r2,r0
(2)  272/ 6000750 :                     ; 		mov.w	r0,@r1
(2)  273/ 6000750 :                     ; 		rts
(2)  274/ 6000750 :                     ; 		nop
(2)  275/ 6000750 :                     ; 		align 4
(2)  276/ 6000750 :                     ; 		ltorg
(2)  277/ 6000750 :                     
(2)  278/ 6000750 :                     ; ; ------------------------------------
(2)  279/ 6000750 :                     ; ; MarsVdp_Print
(2)  280/ 6000750 :                     ; ;
(2)  281/ 6000750 :                     ; ; Prints text on screen
(2)  282/ 6000750 :                     ; ;
(2)  283/ 6000750 :                     ; ; Input:
(2)  284/ 6000750 :                     ; ; r1 - String data
(2)  285/ 6000750 :                     ; ; r2 - X pos
(2)  286/ 6000750 :                     ; ; r3 - Y pos
(2)  287/ 6000750 :                     ; ; ------------------------------------
(2)  288/ 6000750 :                     ;
(2)  289/ 6000750 :                     ; ; TODO: a ver si puedo copy-pastear
(2)  290/ 6000750 :                     ; ; el de Genesis, para los valores
(2)  291/ 6000750 :                     ; ; llamar _PrintVal
(2)  292/ 6000750 :                     ;
(2)  293/ 6000750 :                     ; MarsVdp_Print:
(2)  294/ 6000750 :                     ; 		sts	pr,@-r15
(2)  295/ 6000750 :                     ; 		mov	#RAM_Mars_BgBuffScrl,r14
(2)  296/ 6000750 :                     ; 		mov	#_framebuffer,r13
(2)  297/ 6000750 :                     ; 		mov	#m_ascii,r9
(2)  298/ 6000750 :                     ; 		mov.w	@(mbg_intrl_w,r14),r0
(2)  299/ 6000750 :                     ; 		mov	r0,r10
(2)  300/ 6000750 :                     ;
(2)  301/ 6000750 :                     ; 		mov.w	@(mbg_yfb,r14),r0
(2)  302/ 6000750 :                     ; 		add	r3,r0
(2)  303/ 6000750 :                     ; 		mulu	r10,r0
(2)  304/ 6000750 :                     ; 		mov	@(mbg_fbdata,r14),r0
(2)  305/ 6000750 :                     ; 		mov	r0,r11
(2)  306/ 6000750 :                     ; 		mov	@(mbg_fbpos,r14),r0
(2)  307/ 6000750 :                     ; 		add	r0,r11
(2)  308/ 6000750 :                     ; 		mov	r2,r0
(2)  309/ 6000750 :                     ; 		shll2	r0
(2)  310/ 6000750 :                     ; 		shll	r0
(2)  311/ 6000750 :                     ; 		add	r0,r11
(2)  312/ 6000750 :                     ; 		sts	macl,r0
(2)  313/ 6000750 :                     ; 		add	r0,r11
(2)  314/ 6000750 :                     ; 		mov	r11,r12
(2)  315/ 6000750 :                     ; .nxt_chr:
(2)  316/ 6000750 :                     ; 		mov.b	@r1,r0
(2)  317/ 6000750 :                     ; 		and	#$FF,r0
(2)  318/ 6000750 :                     ; 		cmp/eq	#$00,r0
(2)  319/ 6000750 :                     ; 		bt	.chr_exit
(2)  320/ 6000750 :                     ; 		cmp/eq	#$0A,r0
(2)  321/ 6000750 :                     ; 		bt	.chr_enter
(2)  322/ 6000750 :                     ; 		bsr	.put_chr
(2)  323/ 6000750 :                     ; 		nop
(2)  324/ 6000750 :                     ; 		add	#8,r11
(2)  325/ 6000750 :                     ; 		bra	.nxt_chr
(2)  326/ 6000750 :                     ; 		add	#1,r1
(2)  327/ 6000750 :                     ;
(2)  328/ 6000750 :                     ; .chr_enter:
(2)  329/ 6000750 :                     ; 		mov	#8,r0
(2)  330/ 6000750 :                     ; 		mulu	r0,r10
(2)  331/ 6000750 :                     ; 		sts	macl,r0
(2)  332/ 6000750 :                     ; 		add	r0,r12
(2)  333/ 6000750 :                     ; 		mov	r12,r11
(2)  334/ 6000750 :                     ; 		bra	.nxt_chr
(2)  335/ 6000750 :                     ; 		add	#1,r1
(2)  336/ 6000750 :                     ;
(2)  337/ 6000750 :                     ; .chr_exit:
(2)  338/ 6000750 :                     ; 		lds	@r15+,pr
(2)  339/ 6000750 :                     ; 		rts
(2)  340/ 6000750 :                     ; 		nop
(2)  341/ 6000750 :                     ; 		align 4
(2)  342/ 6000750 :                     ;
(2)  343/ 6000750 :                     ; .put_chr:
(2)  344/ 6000750 :                     ; 		mov	#$20,r8
(2)  345/ 6000750 :                     ; 		sub	r8,r0
(2)  346/ 6000750 :                     ; 		shll2	r0		; *$40
(2)  347/ 6000750 :                     ; 		shll2	r0
(2)  348/ 6000750 :                     ; 		shll2	r0
(2)  349/ 6000750 :                     ; 		mov	r9,r8
(2)  350/ 6000750 :                     ; 		add	r0,r8
(2)  351/ 6000750 :                     ; 		mov	r13,r7
(2)  352/ 6000750 :                     ; 		add	r11,r7
(2)  353/ 6000750 :                     ; 		mov	#8,r6
(2)  354/ 6000750 :                     ; .nxt_lns:
(2)  355/ 6000750 :                     ; 		mov	@r8+,r0
(2)  356/ 6000750 :                     ; 		mov	r0,@r7
(2)  357/ 6000750 :                     ; 		mov	@r8+,r0
(2)  358/ 6000750 :                     ; 		mov	r0,@(4,r7)
(2)  359/ 6000750 :                     ; 		dt	r6
(2)  360/ 6000750 :                     ; 		bf/s	.nxt_lns
(2)  361/ 6000750 :                     ; 		add	r10,r7
(2)  362/ 6000750 :                     ; 		rts
(2)  363/ 6000750 :                     ; 		nop
(2)  364/ 6000750 :                     ; 		align 4
(2)  365/ 6000750 :                     ;
(2)  366/ 6000750 :                     ; ; ------------------------------------
(2)  367/ 6000750 :                     ; ; MarsVdp_PrintVal
(2)  368/ 6000750 :                     ; ;
(2)  369/ 6000750 :                     ; ; Prints a value from ROM/RAM on
(2)  370/ 6000750 :                     ; ; screen
(2)  371/ 6000750 :                     ; ;
(2)  372/ 6000750 :                     ; ; Input:
(2)  373/ 6000750 :                     ; ; r1 - Value
(2)  374/ 6000750 :                     ; ; r2 - X pos
(2)  375/ 6000750 :                     ; ; r3 - Y pos
(2)  376/ 6000750 :                     ; ; r4 - Type
(2)  377/ 6000750 :                     ; ; ------------------------------------
(2)  378/ 6000750 :                     ;
(2)  379/ 6000750 :                     ; ; *** CURRENTLY 4BYTE LONGS ONLY ***
(2)  380/ 6000750 :                     ;
(2)  381/ 6000750 :                     ; MarsVdp_PrintVal:
(2)  382/ 6000750 :                     ; 		sts	pr,@-r15
(2)  383/ 6000750 :                     ; 		mov	#RAM_Mars_BgBuffScrl,r14
(2)  384/ 6000750 :                     ; 		mov	#_framebuffer,r13
(2)  385/ 6000750 :                     ; 		mov	#m_ascii,r12
(2)  386/ 6000750 :                     ; 		mov.w	@(mbg_intrl_w,r14),r0
(2)  387/ 6000750 :                     ; 		mov	r0,r10
(2)  388/ 6000750 :                     ; 		mov.w	@(mbg_yfb,r14),r0
(2)  389/ 6000750 :                     ; 		add	r3,r0
(2)  390/ 6000750 :                     ; 		mulu	r10,r0
(2)  391/ 6000750 :                     ; 		mov	@(mbg_fbdata,r14),r0
(2)  392/ 6000750 :                     ; 		mov	r0,r11
(2)  393/ 6000750 :                     ; 		mov	@(mbg_fbpos,r14),r0
(2)  394/ 6000750 :                     ; 		add	r0,r11
(2)  395/ 6000750 :                     ; 		mov	r2,r0
(2)  396/ 6000750 :                     ; 		shll2	r0
(2)  397/ 6000750 :                     ; 		shll	r0
(2)  398/ 6000750 :                     ; 		add	r0,r11
(2)  399/ 6000750 :                     ; 		sts	macl,r0
(2)  400/ 6000750 :                     ; 		add	r0,r11
(2)  401/ 6000750 :                     ;
(2)  402/ 6000750 :                     ; 		mov	r1,r4
(2)  403/ 6000750 :                     ; 		bsr	.put_value
(2)  404/ 6000750 :                     ; 		nop
(2)  405/ 6000750 :                     ; .chr_exit:
(2)  406/ 6000750 :                     ; 		lds	@r15+,pr
(2)  407/ 6000750 :                     ; 		rts
(2)  408/ 6000750 :                     ; 		nop
(2)  409/ 6000750 :                     ; 		align 4
(2)  410/ 6000750 :                     ;
(2)  411/ 6000750 :                     ; ; r4 - Value
(2)  412/ 6000750 :                     ; ; r5 - Type (1-byte 2-word 4-long)
(2)  413/ 6000750 :                     ; ;
(2)  414/ 6000750 :                     ; ; Uses:
(2)  415/ 6000750 :                     ; ; r7-r9
(2)  416/ 6000750 :                     ;
(2)  417/ 6000750 :                     ; .put_value:
(2)  418/ 6000750 :                     ; 		mov	#4,r5		; LONG temporal
(2)  419/ 6000750 :                     ; 		shll	r5
(2)  420/ 6000750 :                     ; .wrt_nibl:
(2)  421/ 6000750 :                     ; 		rotl	r4
(2)  422/ 6000750 :                     ; 		rotl	r4
(2)  423/ 6000750 :                     ; 		rotl	r4
(2)  424/ 6000750 :                     ; 		rotl	r4
(2)  425/ 6000750 :                     ; 		mov	r4,r0
(2)  426/ 6000750 :                     ; 		and	#%1111,r0
(2)  427/ 6000750 :                     ; 		mov	#$A,r7
(2)  428/ 6000750 :                     ; 		cmp/ge	r7,r0
(2)  429/ 6000750 :                     ; 		bf	.a_plus
(2)  430/ 6000750 :                     ; 		add	#7,r0
(2)  431/ 6000750 :                     ; .a_plus:
(2)  432/ 6000750 :                     ; 		add	#$10,r0
(2)  433/ 6000750 :                     ; 		shll2	r0		; *$40
(2)  434/ 6000750 :                     ; 		shll2	r0
(2)  435/ 6000750 :                     ; 		shll2	r0
(2)  436/ 6000750 :                     ; 		mov	r12,r7
(2)  437/ 6000750 :                     ; 		add	r0,r7
(2)  438/ 6000750 :                     ; 		mov	r13,r8
(2)  439/ 6000750 :                     ; 		add	r11,r8
(2)  440/ 6000750 :                     ; 		mov	#-4,r0
(2)  441/ 6000750 :                     ; 		and	r0,r8
(2)  442/ 6000750 :                     ; 		mov	#8,r9
(2)  443/ 6000750 :                     ; .nxt_lns:
(2)  444/ 6000750 :                     ; 		mov	@r7+,r0
(2)  445/ 6000750 :                     ; 		mov	r0,@r8
(2)  446/ 6000750 :                     ; 		mov	@r7+,r0
(2)  447/ 6000750 :                     ; 		mov	r0,@(4,r8)
(2)  448/ 6000750 :                     ; 		dt	r9
(2)  449/ 6000750 :                     ; 		bf/s	.nxt_lns
(2)  450/ 6000750 :                     ; 		add	r10,r8
(2)  451/ 6000750 :                     ; 		add	#8,r11
(2)  452/ 6000750 :                     ; 		dt	r5
(2)  453/ 6000750 :                     ; 		bf	.wrt_nibl
(2)  454/ 6000750 :                     ; 		rts
(2)  455/ 6000750 :                     ; 		nop
(2)  456/ 6000750 :                     ; 		align 4
(2)  457/ 6000750 :                     
(2)  458/ 6000750 :                     
(2)  459/ 6000750 :                     		ltorg		; save literals
(2)  460/ 6000750 :                     
(2)  461/ 6000750 :                     ; ====================================================================
(2)  462/ 6000750 :                     ; ----------------------------------------------------------------
(2)  463/ 6000750 :                     ; 256-color Scrolling background
(2)  464/ 6000750 :                     ; ----------------------------------------------------------------
(2)  465/ 6000750 :                     
(2)  466/ 6000750 :                     ; ---------------------------------------
(2)  467/ 6000750 :                     ; Draw ALL the pixel data on
(2)  468/ 6000750 :                     ; current framebuffer
(2)  469/ 6000750 :                     ;
(2)  470/ 6000750 :                     ; r1 - X pos
(2)  471/ 6000750 :                     ; r2 - Y pos
(2)  472/ 6000750 :                     ;
(2)  473/ 6000750 :                     ; *** THE OTHER DRAWING TIMERS U/D/L/R
(2)  474/ 6000750 :                     ; MUST BE ZERO BEFORE GETTING HERE ***
(2)  475/ 6000750 :                     ; ---------------------------------------
(2)  476/ 6000750 :                     
(2)  477/ 6000750 :                     ; TODO: no dibuja unos rows
(2)  478/ 6000750 :                     
(2)  479/ 6000750 :                     MarsVideo_DrawAllBg:
(2)  480/ 6000750 : 4F22                		sts	pr,@-r15
(2)  481/ 6000752 : DE53                		mov	#RAM_Mars_BgBuffScrl,r14
(2)  482/ 6000754 : 50E8                		mov	@(mbg_data,r14),r0
(2)  483/ 6000756 : 8800                		cmp/eq	#0,r0
(2)  484/ 6000758 : 8969                		bt	.no_data
(2)  485/ 600075A : 51ED                		mov	@(mbg_xpos,r14),r1
(2)  486/ 600075C : 52EE                		mov	@(mbg_ypos,r14),r2
(2)  487/ 600075E : 4129                		shlr16	r1
(2)  488/ 6000760 : 4229                		shlr16	r2
(2)  489/ 6000762 : 611F                		exts.w	r1,r1
(2)  490/ 6000764 : 622F                		exts.w	r2,r2
(2)  491/ 6000766 : 6D03                		mov	r0,r13				; r13 - pixel data
(2)  492/ 6000768 :                     
(2)  493/ 6000768 : 6013                		mov	r1,r0
(2)  494/ 600076A : 81E2                		mov.w	r0,@(mbg_xpos_old,r14)
(2)  495/ 600076C : 6023                		mov	r2,r0
(2)  496/ 600076E : 81E3                		mov.w	r0,@(mbg_ypos_old,r14)
(2)  497/ 6000770 : DC4C                		mov	#_framebuffer,r12
(2)  498/ 6000772 : 50EA                		mov	@(mbg_fbdata,r14),r0
(2)  499/ 6000774 : 3C0C                		add	r0,r12				; r12 - framebuffer output
(2)  500/ 6000776 : 85E8                		mov.w	@(mbg_width,r14),r0		; r11 - pixel-data WIDTH
(2)  501/ 6000778 : 6B03                		mov	r0,r11
(2)  502/ 600077A : 85EC                		mov.w	@(mbg_intrl_w,r14),r0		; r10 - internal WIDTH
(2)  503/ 600077C : 6A03                		mov	r0,r10
(2)  504/ 600077E : 85E9                		mov.w	@(mbg_height,r14),r0		;  r9 - image WIDTH
(2)  505/ 6000780 : 6903                		mov	r0,r9
(2)  506/ 6000782 : 85ED                		mov.w	@(mbg_intrl_h,r14),r0		;  r8 - internal HEIGHT
(2)  507/ 6000784 : 6803                		mov	r0,r8
(2)  508/ 6000786 : 85EB                		mov.w	@(mbg_intrl_blk,r14),r0		;  r7 - block size
(2)  509/ 6000788 : 6703                		mov	r0,r7
(2)  510/ 600078A : 667B                		neg	r7,r6				;  r6 - block limit bits
(2)  511/ 600078C : 55E7                		mov	@(mbg_intrl_size,r14),r5	;  r5 - internal WIDTH*HEIGHT
(2)  512/ 600078E : 948B                		mov	#320,r4				;  r4 - max
(2)  513/ 6000790 : 84E1                		mov.b	@(mbg_flags,r14),r0
(2)  514/ 6000792 : C901                		and	#1,r0
(2)  515/ 6000794 : 2008                		tst	r0,r0
(2)  516/ 6000796 : 8900                		bt	.indxmode
(2)  517/ 6000798 : 4400                		shll	r4
(2)  518/ 600079A :                     ; 		shll	r11
(2)  519/ 600079A :                     .indxmode:
(2)  520/ 600079A :                     
(2)  521/ 600079A :                     	; Set X/Y draw heads
(2)  522/ 600079A :                     .xinit_l:
(2)  523/ 600079A : 4111                		cmp/pz	r1
(2)  524/ 600079C : 8901                		bt	.xbg_back
(2)  525/ 600079E : AFFC                		bra	.xinit_l
(2)  526/ 60007A0 : 31BC                		add	r11,r1
(2)  527/ 60007A2 :                     .xbg_back:
(2)  528/ 60007A2 : 31B7                		cmp/gt	r11,r1			; First X limiter
(2)  529/ 60007A4 : 8B01                		bf	.xbg_inc
(2)  530/ 60007A6 : AFFC                		bra	.xbg_back
(2)  531/ 60007A8 : 31B8                		sub	r11,r1
(2)  532/ 60007AA :                     .xbg_inc:
(2)  533/ 60007AA : 4211                		cmp/pz	r2
(2)  534/ 60007AC : 8901                		bt	.ybg_back
(2)  535/ 60007AE : AFFC                		bra	.xbg_inc
(2)  536/ 60007B0 : 329C                		add	r9,r2
(2)  537/ 60007B2 :                     .ybg_back:
(2)  538/ 60007B2 : 3297                		cmp/gt	r9,r2			; First Y limiter
(2)  539/ 60007B4 : 8B01                		bf	.ybg_inc
(2)  540/ 60007B6 : AFFC                		bra	.ybg_back
(2)  541/ 60007B8 : 3298                		sub	r9,r2
(2)  542/ 60007BA :                     .ybg_inc:
(2)  543/ 60007BA : 6013                		mov	r1,r0
(2)  544/ 60007BC : 81E4                		mov.w	r0,@(mbg_xinc_l,r14)
(2)  545/ 60007BE : 304C                		add	r4,r0
(2)  546/ 60007C0 : 30B7                .lwr_xnxt:	cmp/gt	r11,r0
(2)  547/ 60007C2 : 8B01                		bf	.lwr_xvld
(2)  548/ 60007C4 : AFFC                		bra	.lwr_xnxt
(2)  549/ 60007C6 : 30B8                		sub	r11,r0
(2)  550/ 60007C8 :                     .lwr_xvld:
(2)  551/ 60007C8 : 81E5                		mov.w	r0,@(mbg_xinc_r,r14)
(2)  552/ 60007CA :                     
(2)  553/ 60007CA : 6023                		mov	r2,r0
(2)  554/ 60007CC : 81E6                		mov.w	r0,@(mbg_yinc_u,r14)
(2)  555/ 60007CE : 6303                		mov	r0,r3
(2)  556/ 60007D0 :                     
(2)  557/ 60007D0 : 338C                		add	r8,r3
(2)  558/ 60007D2 : 3378                		sub	r7,r3
(2)  559/ 60007D4 : 3393                .lwr_ynxt:	cmp/ge	r9,r3
(2)  560/ 60007D6 : 8B01                		bf	.lwr_yvld
(2)  561/ 60007D8 : AFFC                		bra	.lwr_ynxt
(2)  562/ 60007DA : 3398                		sub	r9,r3
(2)  563/ 60007DC :                     .lwr_yvld:
(2)  564/ 60007DC : 6033                		mov	r3,r0
(2)  565/ 60007DE : 81E7                		mov.w	r0,@(mbg_yinc_d,r14)
(2)  566/ 60007E0 :                     
(2)  567/ 60007E0 :                     	; r1 - X bg pos
(2)  568/ 60007E0 :                     	; r2 - Y bg pos
(2)  569/ 60007E0 :                     	; r3 - Framebuffer BASE
(2)  570/ 60007E0 :                     	; r4 - Y FB pos &BLKSIZE
(2)  571/ 60007E0 :                     	; Set X/Y framebuffer blocks
(2)  572/ 60007E0 : 85EA                		mov.w	@(mbg_yfb,r14),r0
(2)  573/ 60007E2 : 6403                		mov	r0,r4
(2)  574/ 60007E4 : 53E9                		mov	@(mbg_fbpos,r14),r3
(2)  575/ 60007E6 : 2469                		and	r6,r4
(2)  576/ 60007E8 : 2369                		and	r6,r3
(2)  577/ 60007EA : 2269                		and	r6,r2
(2)  578/ 60007EC : 2169                		and	r6,r1
(2)  579/ 60007EE : E600                		mov	#0,r6
(2)  580/ 60007F0 :                     .nxt_y:
(2)  581/ 60007F0 : 3483                		cmp/ge	r8,r4
(2)  582/ 60007F2 : 8B00                		bf	.nxt_y_l
(2)  583/ 60007F4 : 3488                		sub	r8,r4
(2)  584/ 60007F6 :                     .nxt_y_l:
(2)  585/ 60007F6 : 3293                		cmp/ge	r9,r2		; Y limiters
(2)  586/ 60007F8 : 8B00                		bf	.ybg_l
(2)  587/ 60007FA : 3298                		sub	r9,r2
(2)  588/ 60007FC :                     .ybg_l:
(2)  589/ 60007FC : 2F66                		mov	r6,@-r15
(2)  590/ 60007FE : 2F36                		mov	r3,@-r15
(2)  591/ 6000800 : 2F16                		mov	r1,@-r15
(2)  592/ 6000802 : E600                		mov	#0,r6
(2)  593/ 6000804 :                     .nxt_x:
(2)  594/ 6000804 : 31B3                		cmp/ge	r11,r1		; X pixel-data wrap
(2)  595/ 6000806 : 8B00                		bf	.xbg_l
(2)  596/ 6000808 : 31B8                		sub	r11,r1
(2)  597/ 600080A :                     .xbg_l:
(2)  598/ 600080A : 3353                		cmp/ge	r5,r3
(2)  599/ 600080C : 8B00                		bf	.nxt_x_l
(2)  600/ 600080E : 3358                		sub	r5,r3
(2)  601/ 6000810 :                     .nxt_x_l:
(2)  602/ 6000810 : B010                		bsr	.mk_piece
(2)  603/ 6000812 : 0009                		nop
(2)  604/ 6000814 : 337C                		add	r7,r3
(2)  605/ 6000816 : 367C                		add	r7,r6
(2)  606/ 6000818 : 36A3                		cmp/ge	r10,r6
(2)  607/ 600081A : 8FF3                		bf/s	.nxt_x
(2)  608/ 600081C : 317C                		add	r7,r1
(2)  609/ 600081E :                     
(2)  610/ 600081E : 61F6                		mov	@r15+,r1
(2)  611/ 6000820 : 63F6                		mov	@r15+,r3
(2)  612/ 6000822 : 66F6                		mov	@r15+,r6
(2)  613/ 6000824 :                     
(2)  614/ 6000824 : 347C                		add	r7,r4
(2)  615/ 6000826 : 327C                		add	r7,r2
(2)  616/ 6000828 : 367C                		add 	r7,r6
(2)  617/ 600082A : 3683                		cmp/ge	r8,r6
(2)  618/ 600082C : 8BE0                		bf	.nxt_y
(2)  619/ 600082E :                     
(2)  620/ 600082E :                     
(2)  621/ 600082E :                     .no_data:
(2)  622/ 600082E : 4F26                		lds	@r15+,pr
(2)  623/ 6000830 : 000B                		rts
(2)  624/ 6000832 : 0009                		nop
(2)  625/ 6000834 :                     		align 4
(2)  626/ 6000834 :                     
(2)  627/ 6000834 :                     	; r1 - X bg pos
(2)  628/ 6000834 :                     	; r2 - Y bg pos
(2)  629/ 6000834 :                     	; r3 - Framebuffer BASE
(2)  630/ 6000834 :                     	; r4 - Y FB pos &BLKSIZE
(2)  631/ 6000834 :                     	; Set X/Y framebuffer blocks
(2)  632/ 6000834 :                     .mk_piece:
(2)  633/ 6000834 : 2F16                		mov	r1,@-r15
(2)  634/ 6000836 : 2F26                		mov	r2,@-r15
(2)  635/ 6000838 : 2F36                		mov	r3,@-r15
(2)  636/ 600083A : 2F46                		mov	r4,@-r15
(2)  637/ 600083C : 2F66                		mov	r6,@-r15
(2)  638/ 600083E : 2F56                		mov	r5,@-r15
(2)  639/ 6000840 : 2F86                		mov	r8,@-r15
(2)  640/ 6000842 : 2F96                		mov	r9,@-r15
(2)  641/ 6000844 :                     
(2)  642/ 6000844 : 68D3                		mov	r13,r8		; BG X/Y add
(2)  643/ 6000846 : 22BE                		mulu	r11,r2
(2)  644/ 6000848 : 001A                		sts	macl,r0
(2)  645/ 600084A : 380C                		add	r0,r8
(2)  646/ 600084C : 381C                		add	r1,r8
(2)  647/ 600084E : 2A4E                		mulu	r4,r10		; Framebuffer X/Y add
(2)  648/ 6000850 : 091A                		sts	macl,r9
(2)  649/ 6000852 : 393C                		add	r3,r9
(2)  650/ 6000854 :                     
(2)  651/ 6000854 :                     ; 	; Hidden line
(2)  652/ 6000854 :                     ; 		mov	#320,r2
(2)  653/ 6000854 :                     ; 		mov.b	@(mbg_flags,r14),r0
(2)  654/ 6000854 :                     ; 		tst	#1,r0
(2)  655/ 6000854 :                     ; 		bt	.indxmoden
(2)  656/ 6000854 :                     ; 		shll	r2
(2)  657/ 6000854 :                     ; .indxmoden:
(2)  658/ 6000854 :                     ; 		cmp/gt	r2,r9
(2)  659/ 6000854 :                     ; 		bt	.y_nohdnln
(2)  660/ 6000854 :                     ;
(2)  661/ 6000854 :                     ;
(2)  662/ 6000854 :                     ; 		mov	r7,r2
(2)  663/ 6000854 :                     ; 		shlr2	r2
(2)  664/ 6000854 :                     ;
(2)  665/ 6000854 :                     ; 		mov	r9,r6
(2)  666/ 6000854 :                     ; 		add	r5,r6
(2)  667/ 6000854 :                     ; 		add	r12,r6
(2)  668/ 6000854 :                     ; 		mov	r8,r4
(2)  669/ 6000854 :                     ; .nxtlnghdn:
(2)  670/ 6000854 :                     ; 		mov	@r4+,r0
(2)  671/ 6000854 :                     ; 		mov	r0,@r6
(2)  672/ 6000854 :                     ; 		dt	r2
(2)  673/ 6000854 :                     ; 		bf/s	.nxtlnghdn
(2)  674/ 6000854 :                     ; 		add	#4,r6
(2)  675/ 6000854 :                     ; .y_nohdnln:
(2)  676/ 6000854 :                     
(2)  677/ 6000854 :                     
(2)  678/ 6000854 :                     	; Normal full block
(2)  679/ 6000854 : 6273                		mov	r7,r2
(2)  680/ 6000856 :                     .yblk_loopn:
(2)  681/ 6000856 : 3953                		cmp/ge	r5,r9
(2)  682/ 6000858 : 8B00                		bf	.ymax
(2)  683/ 600085A : 3958                		sub	r5,r9
(2)  684/ 600085C :                     .ymax:
(2)  685/ 600085C : 6373                		mov	r7,r3
(2)  686/ 600085E : 4309                		shlr2	r3
(2)  687/ 6000860 : 6483                		mov	r8,r4
(2)  688/ 6000862 : 6693                		mov	r9,r6
(2)  689/ 6000864 :                     
(2)  690/ 6000864 :                     .nxtlng:
(2)  691/ 6000864 : 6042                		mov	@r4,r0
(2)  692/ 6000866 : 6163                		mov	r6,r1
(2)  693/ 6000868 : 31CC                		add	r12,r1
(2)  694/ 600086A : 2102                		mov	r0,@r1
(2)  695/ 600086C : 911C                		mov	#320,r1
(2)  696/ 600086E : 3617                		cmp/gt	r1,r6
(2)  697/ 6000870 : 8903                		bt	.hdnpos
(2)  698/ 6000872 : 6163                		mov	r6,r1
(2)  699/ 6000874 : 315C                		add	r5,r1
(2)  700/ 6000876 : 31CC                		add	r12,r1
(2)  701/ 6000878 : 2102                		mov	r0,@r1
(2)  702/ 600087A :                     .hdnpos:
(2)  703/ 600087A : 7604                		add	#4,r6
(2)  704/ 600087C : 4310                		dt	r3
(2)  705/ 600087E : 8FF1                		bf/s	.nxtlng
(2)  706/ 6000880 : 7404                		add	#4,r4
(2)  707/ 6000882 :                     
(2)  708/ 6000882 : 38BC                		add	r11,r8	; TODO
(2)  709/ 6000884 : 4210                		dt	r2
(2)  710/ 6000886 : 8FE6                		bf/s	.yblk_loopn
(2)  711/ 6000888 : 39AC                		add	r10,r9
(2)  712/ 600088A :                     
(2)  713/ 600088A :                     .yblk_ex:
(2)  714/ 600088A : 69F6                		mov	@r15+,r9
(2)  715/ 600088C : 68F6                		mov	@r15+,r8
(2)  716/ 600088E : 65F6                		mov	@r15+,r5
(2)  717/ 6000890 : 66F6                		mov	@r15+,r6
(2)  718/ 6000892 : 64F6                		mov	@r15+,r4
(2)  719/ 6000894 : 63F6                		mov	@r15+,r3
(2)  720/ 6000896 : 62F6                		mov	@r15+,r2
(2)  721/ 6000898 : 61F6                		mov	@r15+,r1
(2)  722/ 600089A : 000B                		rts
(2)  723/ 600089C : 0009                		nop
(2)  724/ 600089E :                     		align 4
(2)  725/ 60008A0 : 2601 6C18 0400 0000 		ltorg
                    0140                
(2)  726/ 60008AA :                     
(2)  727/ 60008AA :                     ; ---------------------------------------
(2)  728/ 60008AA :                     ; Background:
(2)  729/ 60008AA :                     ; Draw Left/Right sections
(2)  730/ 60008AA :                     ; ---------------------------------------
(2)  731/ 60008AA :                     
(2)  732/ 60008AA :                     MarsVideo_BgDrawLR:
(2)  733/ 60008AA : DE20                		mov	#RAM_Mars_BgBuffScrl,r14
(2)  734/ 60008AC : 50E8                		mov	@(mbg_data,r14),r0
(2)  735/ 60008AE : 4015                		cmp/pl	r0
(2)  736/ 60008B0 : 8B26                		bf	.nxt_drawud
(2)  737/ 60008B2 : 85ED                		mov.w	@(mbg_intrl_h,r14),r0
(2)  738/ 60008B4 : 6D03                		mov	r0,r13
(2)  739/ 60008B6 : 85EB                		mov.w	@(mbg_intrl_blk,r14),r0
(2)  740/ 60008B8 : 640B                		neg	r0,r4
(2)  741/ 60008BA : 4009                		shlr2	r0
(2)  742/ 60008BC : 6C03                		mov	r0,r12
(2)  743/ 60008BE : DB1C                		mov	#Cach_BgFbPos_H,r11
(2)  744/ 60008C0 : 6BB2                		mov	@r11,r11
(2)  745/ 60008C2 : D31C                		mov	#Cach_BgFbPos_V,r3
(2)  746/ 60008C4 : 6332                		mov	@r3,r3
(2)  747/ 60008C6 : 85EC                		mov.w	@(mbg_intrl_w,r14),r0
(2)  748/ 60008C8 : 203F                		muls	r3,r0
(2)  749/ 60008CA : 001A                		sts	macl,r0
(2)  750/ 60008CC : 3B0C                		add	r0,r11
(2)  751/ 60008CE : 5AE7                		mov	@(mbg_intrl_size,r14),r10
(2)  752/ 60008D0 : 59EA                		mov	@(mbg_fbdata,r14),r9
(2)  753/ 60008D2 : D019                		mov	#_framebuffer,r0
(2)  754/ 60008D4 : 390C                		add	r0,r9
(2)  755/ 60008D6 : 50E8                		mov	@(mbg_data,r14),r0
(2)  756/ 60008D8 : 6803                		mov	r0,r8
(2)  757/ 60008DA : 6703                		mov	r0,r7
(2)  758/ 60008DC : 85E9                		mov.w	@(mbg_height,r14),r0
(2)  759/ 60008DE : 6603                		mov	r0,r6
(2)  760/ 60008E0 : 85E8                		mov.w	@(mbg_width,r14),r0
(2)  761/ 60008E2 : 206E                		mulu	r6,r0
(2)  762/ 60008E4 : 061A                		sts	macl,r6
(2)  763/ 60008E6 : 367C                		add	r7,r6
(2)  764/ 60008E8 : 6303                		mov	r0,r3
(2)  765/ 60008EA : D014                		mov	#Cach_YHead_U,r0
(2)  766/ 60008EC : 6002                		mov	@r0,r0
(2)  767/ 60008EE : 203E                		mulu	r3,r0
(2)  768/ 60008F0 : 001A                		sts	macl,r0
(2)  769/ 60008F2 : 380C                		add	r0,r8
(2)  770/ 60008F4 :                     
(2)  771/ 60008F4 : C517                		mov.w	@(marsGbl_BgDrwR,gbr),r0
(2)  772/ 60008F6 : 8800                		cmp/eq	#0,r0
(2)  773/ 60008F8 : 8B0A                		bf	.dtsk01_dright
(2)  774/ 60008FA : C518                		mov.w	@(marsGbl_BgDrwL,gbr),r0
(2)  775/ 60008FC : 8800                		cmp/eq	#0,r0
(2)  776/ 60008FE : 8B01                		bf	.dtsk01_dleft
(2)  777/ 6000900 :                     
(2)  778/ 6000900 :                     .nxt_drawud:
(2)  779/ 6000900 : 000B                		rts
(2)  780/ 6000902 : 0009                		nop
(2)  781/ 6000904 :                     		align 4
(2)  782/ 6000904 :                     
(2)  783/ 6000904 :                     .dtsk01_dleft:
(2)  784/ 6000904 : 4010                		dt	r0
(2)  785/ 6000906 : C118                		mov.w	r0,@(marsGbl_BgDrwL,gbr)
(2)  786/ 6000908 : D00D                		mov	#Cach_XHead_L,r0
(2)  787/ 600090A : 6002                		mov	@r0,r0
(2)  788/ 600090C : A01D                		bra	dtsk01_lrdraw
(2)  789/ 600090E : 6503                		mov	r0,r5
(2)  790/ 6000910 :                     .dtsk01_dright:
(2)  791/ 6000910 : 4010                		dt	r0
(2)  792/ 6000912 : C117                		mov.w	r0,@(marsGbl_BgDrwR,gbr)
(2)  793/ 6000914 : 9318                		mov	#320,r3			; Set FB position
(2)  794/ 6000916 : 84E1                		mov.b	@(mbg_flags,r14),r0
(2)  795/ 6000918 : C901                		and	#1,r0
(2)  796/ 600091A : 2008                		tst	r0,r0
(2)  797/ 600091C : 8900                		bt	.indxmode
(2)  798/ 600091E : 4300                		shll	r3
(2)  799/ 6000920 :                     .indxmode:
(2)  800/ 6000920 : 3B3C                		add	r3,r11
(2)  801/ 6000922 : 2B49                		and	r4,r11
(2)  802/ 6000924 : D007                		mov	#Cach_XHead_R,r0
(2)  803/ 6000926 : 6002                		mov	@r0,r0
(2)  804/ 6000928 : A00F                		bra	dtsk01_lrdraw
(2)  805/ 600092A : 6503                		mov	r0,r5
(2)  806/ 600092C :                     		align 4
(2)  807/ 600092C : 2601 6C18 C000 06A0 		ltorg
                    C000 069C 0400 0000 
                    C000 0694 C000 068C 
                    C000 0690 0140      
(2)  808/ 600094A :                     
(2)  809/ 600094A :                     	; r13 - Y lines
(2)  810/ 600094A :                     	; r12 - X block width
(2)  811/ 600094A :                     	; r11 - drawzone pos
(2)  812/ 600094A :                     	; r10 - drawzone size
(2)  813/ 600094A :                     	;  r9 - Framebuffer BASE
(2)  814/ 600094A :                     	;  r8 - Pixeldata Y-Current
(2)  815/ 600094A :                     	;  r7 - Pixeldata Y-Start
(2)  816/ 600094A :                     	;  r6 - Pixeldata Y-End
(2)  817/ 600094A :                     	;  r5 - Xadd
(2)  818/ 600094A :                     dtsk01_lrdraw:
(2)  819/ 600094A : 3863                		cmp/ge	r6,r8
(2)  820/ 600094C : 8B00                		bf	.yres
(2)  821/ 600094E : 6873                		mov	r7,r8
(2)  822/ 6000950 :                     .yres:
(2)  823/ 6000950 : 64C3                		mov	r12,r4
(2)  824/ 6000952 : 63B3                		mov	r11,r3
(2)  825/ 6000954 : 6283                		mov	r8,r2
(2)  826/ 6000956 : 325C                		add	r5,r2
(2)  827/ 6000958 :                     ; X draw
(2)  828/ 6000958 :                     .xline:
(2)  829/ 6000958 : 33A3                		cmp/ge	r10,r3
(2)  830/ 600095A : 8B01                		bf	.prefix_r
(2)  831/ 600095C : 33A8                		sub	r10,r3
(2)  832/ 600095E : 6B33                		mov	r3,r11
(2)  833/ 6000960 :                     .prefix_r:
(2)  834/ 6000960 : 6133                		mov	r3,r1
(2)  835/ 6000962 : 319C                		add	r9,r1
(2)  836/ 6000964 : 6022                		mov	@r2,r0
(2)  837/ 6000966 : 2102                		mov	r0,@r1
(2)  838/ 6000968 : 9184                		mov	#320,r1			; Hidden line
(2)  839/ 600096A : 84E1                		mov.b	@(mbg_flags,r14),r0
(2)  840/ 600096C : C901                		and	#1,r0
(2)  841/ 600096E : 2008                		tst	r0,r0
(2)  842/ 6000970 : 8900                		bt	.indxmode
(2)  843/ 6000972 : 4100                		shll	r1
(2)  844/ 6000974 :                     .indxmode:
(2)  845/ 6000974 : 3317                		cmp/gt	r1,r3
(2)  846/ 6000976 : 8904                		bt	.not_l2
(2)  847/ 6000978 : 6133                		mov	r3,r1
(2)  848/ 600097A : 319C                		add	r9,r1
(2)  849/ 600097C : 31AC                		add	r10,r1
(2)  850/ 600097E : 6022                		mov	@r2,r0
(2)  851/ 6000980 : 2102                		mov	r0,@r1
(2)  852/ 6000982 :                     .not_l2:
(2)  853/ 6000982 : 7204                		add	#4,r2
(2)  854/ 6000984 : 4410                		dt	r4
(2)  855/ 6000986 : 8FE7                		bf/s	.xline
(2)  856/ 6000988 : 7304                		add	#4,r3
(2)  857/ 600098A : 85E8                		mov.w	@(mbg_width,r14),r0
(2)  858/ 600098C : 380C                		add	r0,r8
(2)  859/ 600098E : 85EC                		mov.w	@(mbg_intrl_w,r14),r0
(2)  860/ 6000990 : 4D10                		dt	r13
(2)  861/ 6000992 : 8FDA                		bf/s	dtsk01_lrdraw
(2)  862/ 6000994 : 3B0C                		add	r0,r11
(2)  863/ 6000996 : 000B                		rts
(2)  864/ 6000998 : 0009                		nop
(2)  865/ 600099A :                     		align 4
(2)  866/ 600099C :                     
(2)  867/ 600099C :                     ; ---------------------------------------
(2)  868/ 600099C :                     ; Background:
(2)  869/ 600099C :                     ; Draw Up/Down sections
(2)  870/ 600099C :                     ; ---------------------------------------
(2)  871/ 600099C :                     
(2)  872/ 600099C :                     MarsVideo_BgDrawUD:
(2)  873/ 600099C : 5DEA                		mov	@(mbg_fbdata,r14),r13
(2)  874/ 600099E : D02F                		mov	#_framebuffer,r0
(2)  875/ 60009A0 : 3D0C                		add	r0,r13
(2)  876/ 60009A2 : 50E8                		mov	@(mbg_data,r14),r0
(2)  877/ 60009A4 : 6B03                		mov	r0,r11
(2)  878/ 60009A6 : 6C03                		mov	r0,r12
(2)  879/ 60009A8 : D02D                		mov	#Cach_BgFbPos_H,r0
(2)  880/ 60009AA : 6A02                		mov	@r0,r10
(2)  881/ 60009AC : D02D                		mov	#Cach_BgFbPos_V,r0
(2)  882/ 60009AE : 6902                		mov	@r0,r9
(2)  883/ 60009B0 : 58E7                		mov	@(mbg_intrl_size,r14),r8
(2)  884/ 60009B2 : 85E8                		mov.w	@(mbg_width,r14),r0
(2)  885/ 60009B4 : 6703                		mov	r0,r7
(2)  886/ 60009B6 :                     ; 		mov.b	@(mbg_flags,r14),r0
(2)  887/ 60009B6 :                     ; 		and	#1,r0
(2)  888/ 60009B6 :                     ; 		tst	r0,r0
(2)  889/ 60009B6 :                     ; 		bt	.indxmodew
(2)  890/ 60009B6 :                     ; 		shll	r7
(2)  891/ 60009B6 :                     ; .indxmodew:
(2)  892/ 60009B6 : D02C                		mov	#Cach_XHead_L,r0
(2)  893/ 60009B8 : 6002                		mov	@r0,r0
(2)  894/ 60009BA : 3C0C                		add	r0,r12
(2)  895/ 60009BC : 6693                		mov	r9,r6
(2)  896/ 60009BE :                     
(2)  897/ 60009BE : 85ED                		mov.w	@(mbg_intrl_h,r14),r0
(2)  898/ 60009C0 : 6503                		mov	r0,r5
(2)  899/ 60009C2 : 6403                		mov	r0,r4
(2)  900/ 60009C4 : 85EB                		mov.w	@(mbg_intrl_blk,r14),r0
(2)  901/ 60009C6 : 3408                		sub	r0,r4
(2)  902/ 60009C8 : 364C                		add	r4,r6
(2)  903/ 60009CA : 3657                .wrpagain:	cmp/gt	r5,r6
(2)  904/ 60009CC : 8B01                		bf	.upwrp
(2)  905/ 60009CE : AFFC                		bra	.wrpagain
(2)  906/ 60009D0 : 3658                		sub	r5,r6
(2)  907/ 60009D2 :                     .upwrp:
(2)  908/ 60009D2 :                     ; 		mov	#Cach_Drw_U,r1
(2)  909/ 60009D2 :                     ; 		mov	#Cach_Drw_D,r2
(2)  910/ 60009D2 : C519                		mov.w	@(marsGbl_BgDrwU,gbr),r0
(2)  911/ 60009D4 : 8800                		cmp/eq	#0,r0
(2)  912/ 60009D6 : 8B0C                		bf	.tsk00_up
(2)  913/ 60009D8 : C51A                		mov.w	@(marsGbl_BgDrwD,gbr),r0
(2)  914/ 60009DA : 8800                		cmp/eq	#0,r0
(2)  915/ 60009DC : 893C                		bt	drw_ud_exit
(2)  916/ 60009DE :                     .tsk00_down:
(2)  917/ 60009DE : 4010                		dt	r0
(2)  918/ 60009E0 : C11A                		mov.w	r0,@(marsGbl_BgDrwD,gbr)
(2)  919/ 60009E2 :                     
(2)  920/ 60009E2 : D022                		mov	#Cach_YHead_D,r0
(2)  921/ 60009E4 : 6002                		mov	@r0,r0
(2)  922/ 60009E6 : 207E                		mulu	r7,r0
(2)  923/ 60009E8 : 001A                		sts	macl,r0
(2)  924/ 60009EA : 3C0C                		add	r0,r12
(2)  925/ 60009EC : 3B0C                		add	r0,r11
(2)  926/ 60009EE : A008                		bra	.do_updown
(2)  927/ 60009F0 : 6963                		mov	r6,r9
(2)  928/ 60009F2 :                     .tsk00_up:
(2)  929/ 60009F2 : 4010                		dt	r0
(2)  930/ 60009F4 : C119                		mov.w	r0,@(marsGbl_BgDrwU,gbr)
(2)  931/ 60009F6 : D01E                		mov	#Cach_YHead_U,r0
(2)  932/ 60009F8 : 6002                		mov	@r0,r0
(2)  933/ 60009FA : 207E                		mulu	r7,r0
(2)  934/ 60009FC : 001A                		sts	macl,r0
(2)  935/ 60009FE : 3C0C                		add	r0,r12
(2)  936/ 6000A00 : 3B0C                		add	r0,r11
(2)  937/ 6000A02 :                     
(2)  938/ 6000A02 :                     	; Main U/D loop
(2)  939/ 6000A02 :                     	; r12 - pixel-data current pos
(2)  940/ 6000A02 :                     	; r11 - pixel-data loop pos
(2)  941/ 6000A02 :                     	; r10 - Internal scroll TOPLEFT
(2)  942/ 6000A02 :                     	; r9 - Internal scroll Y-add
(2)  943/ 6000A02 :                     	; r8 - Internal scroll drawarea size
(2)  944/ 6000A02 :                     	; r7 - pixel-data WIDTH
(2)  945/ 6000A02 :                     .do_updown:
(2)  946/ 6000A02 : 85EC                		mov.w	@(mbg_intrl_w,r14),r0
(2)  947/ 6000A04 : 209E                		mulu	r9,r0
(2)  948/ 6000A06 : 001A                		sts	macl,r0
(2)  949/ 6000A08 : 3A0C                		add	r0,r10
(2)  950/ 6000A0A : 85EB                		mov.w	@(mbg_intrl_blk,r14),r0
(2)  951/ 6000A0C : 6603                		mov	r0,r6
(2)  952/ 6000A0E :                     .y_loop:
(2)  953/ 6000A0E : 63C3                		mov	r12,r3
(2)  954/ 6000A10 : 64B3                		mov	r11,r4
(2)  955/ 6000A12 : 347C                		add	r7,r4
(2)  956/ 6000A14 : 85EC                		mov.w	@(mbg_intrl_w,r14),r0	; WIDTH / 4
(2)  957/ 6000A16 : 4009                		shlr2	r0
(2)  958/ 6000A18 : 6503                		mov	r0,r5
(2)  959/ 6000A1A :                     .x_loop:
(2)  960/ 6000A1A : 3A83                		cmp/ge	r8,r10			; topleft fb pos
(2)  961/ 6000A1C : 8B00                		bf	.lwrfb
(2)  962/ 6000A1E : 3A88                		sub	r8,r10
(2)  963/ 6000A20 :                     .lwrfb:
(2)  964/ 6000A20 : 3343                		cmp/ge	r4,r3
(2)  965/ 6000A22 : 8B00                		bf	.srclow
(2)  966/ 6000A24 : 63B3                		mov	r11,r3
(2)  967/ 6000A26 :                     .srclow:
(2)  968/ 6000A26 : 6136                		mov	@r3+,r1
(2)  969/ 6000A28 : 62A3                		mov	r10,r2
(2)  970/ 6000A2A : 32DC                		add	r13,r2
(2)  971/ 6000A2C : 6013                		mov	r1,r0
(2)  972/ 6000A2E : 2202                		mov	r0,@r2
(2)  973/ 6000A30 :                     
(2)  974/ 6000A30 : 9220                		mov	#320,r2			; Hidden line
(2)  975/ 6000A32 : 84E1                		mov.b	@(mbg_flags,r14),r0
(2)  976/ 6000A34 : C901                		and	#1,r0
(2)  977/ 6000A36 : 2008                		tst	r0,r0
(2)  978/ 6000A38 : 8900                		bt	.indxmode
(2)  979/ 6000A3A : 4200                		shll	r2
(2)  980/ 6000A3C :                     .indxmode:
(2)  981/ 6000A3C : 3A27                		cmp/gt	r2,r10
(2)  982/ 6000A3E : 8904                		bt	.hdnx
(2)  983/ 6000A40 : 62A3                		mov	r10,r2
(2)  984/ 6000A42 : 32DC                		add	r13,r2
(2)  985/ 6000A44 : 328C                		add	r8,r2
(2)  986/ 6000A46 : 6013                		mov	r1,r0
(2)  987/ 6000A48 : 2202                		mov	r0,@r2
(2)  988/ 6000A4A :                     .hdnx:
(2)  989/ 6000A4A : 4510                		dt	r5
(2)  990/ 6000A4C : 8FE5                		bf/s	.x_loop
(2)  991/ 6000A4E : 7A04                		add	#4,r10
(2)  992/ 6000A50 : 3B7C                		add	r7,r11			; Next SRC Y
(2)  993/ 6000A52 : 4610                		dt	r6
(2)  994/ 6000A54 : 8FDB                		bf/s	.y_loop
(2)  995/ 6000A56 : 3C7C                		add	r7,r12
(2)  996/ 6000A58 :                     drw_ud_exit:
(2)  997/ 6000A58 : 000B                		rts
(2)  998/ 6000A5A : 0009                		nop
(2)  999/ 6000A5C :                     		align 4
(2) 1000/ 6000A5C : 0400 0000 C000 06A0 		ltorg
                    C000 069C C000 068C 
                    C000 0698 C000 0694 
                    0140                
(2) 1001/ 6000A76 :                     
(2) 1002/ 6000A76 :                     ; ---------------------------------------
(2) 1003/ 6000A76 :                     ; MarsVideo_MoveBg
(2) 1004/ 6000A76 :                     ;
(2) 1005/ 6000A76 :                     ; This updates the background's
(2) 1006/ 6000A76 :                     ; X/Y position
(2) 1007/ 6000A76 :                     ;
(2) 1008/ 6000A76 :                     ; Call this during VBlank.
(2) 1009/ 6000A76 :                     ; ---------------------------------------
(2) 1010/ 6000A76 :                     
(2) 1011/ 6000A76 :                     MarsVideo_MoveBg:
(2) 1012/ 6000A76 : DE77                		mov	#RAM_Mars_BgBuffScrl,r14
(2) 1013/ 6000A78 : 50E8                		mov	@(mbg_data,r14),r0
(2) 1014/ 6000A7A : 8800                		cmp/eq	#0,r0
(2) 1015/ 6000A7C : 8B01                		bf	.has_scrldata
(2) 1016/ 6000A7E : 000B                		rts
(2) 1017/ 6000A80 : 0009                		nop
(2) 1018/ 6000A82 :                     .has_scrldata:
(2) 1019/ 6000A82 : E100                		mov	#0,r1
(2) 1020/ 6000A84 : E200                		mov	#0,r2
(2) 1021/ 6000A86 : 50ED                		mov	@(mbg_xpos,r14),r0	; 0000.0000
(2) 1022/ 6000A88 : 4029                		shlr16	r0
(2) 1023/ 6000A8A : 600F                		exts.w	r0,r0
(2) 1024/ 6000A8C : 6303                		mov	r0,r3
(2) 1025/ 6000A8E : 85E2                		mov.w	@(mbg_xpos_old,r14),r0
(2) 1026/ 6000A90 : 3300                		cmp/eq	r0,r3
(2) 1027/ 6000A92 : 8901                		bt	.xequ
(2) 1028/ 6000A94 : 6133                		mov	r3,r1
(2) 1029/ 6000A96 : 3108                		sub	r0,r1
(2) 1030/ 6000A98 :                     .xequ:
(2) 1031/ 6000A98 : 6033                		mov	r3,r0
(2) 1032/ 6000A9A : 81E2                		mov.w	r0,@(mbg_xpos_old,r14)
(2) 1033/ 6000A9C : 50EE                		mov	@(mbg_ypos,r14),r0	; 0000.0000
(2) 1034/ 6000A9E : 4029                		shlr16	r0
(2) 1035/ 6000AA0 : 600F                		exts.w	r0,r0
(2) 1036/ 6000AA2 : 6303                		mov	r0,r3
(2) 1037/ 6000AA4 : 85E3                		mov.w	@(mbg_ypos_old,r14),r0
(2) 1038/ 6000AA6 : 3300                		cmp/eq	r0,r3
(2) 1039/ 6000AA8 : 8901                		bt	.yequ
(2) 1040/ 6000AAA : 6233                		mov	r3,r2
(2) 1041/ 6000AAC : 3208                		sub	r0,r2
(2) 1042/ 6000AAE :                     .yequ:
(2) 1043/ 6000AAE : 6033                		mov	r3,r0
(2) 1044/ 6000AB0 : 81E3                		mov.w	r0,@(mbg_ypos_old,r14)
(2) 1045/ 6000AB2 : 4111                		cmp/pz	r1
(2) 1046/ 6000AB4 : 8900                		bt	.x_stend
(2) 1047/ 6000AB6 : 611F                		exts	r1,r1
(2) 1048/ 6000AB8 :                     .x_stend:
(2) 1049/ 6000AB8 : 4211                		cmp/pz	r2
(2) 1050/ 6000ABA : 8900                		bt	.y_stend
(2) 1051/ 6000ABC : 622F                		exts	r2,r2
(2) 1052/ 6000ABE :                     .y_stend:
(2) 1053/ 6000ABE :                     
(2) 1054/ 6000ABE :                     	; 256-color BG mode flag goes here
(2) 1055/ 6000ABE :                     ; 		mov	r1,r0
(2) 1056/ 6000ABE :                     ; 		or	r2,r0
(2) 1057/ 6000ABE :                     ; 		cmp/eq	#0,r0
(2) 1058/ 6000ABE :                     ; 		bt	.no_chng
(2) 1059/ 6000ABE :                     ; 		mov	#0,r0
(2) 1060/ 6000ABE :                     ; 		mov.w	r0,@(marsGbl_XPatch,gbr)
(2) 1061/ 6000ABE :                     .no_chng:
(2) 1062/ 6000ABE :                     ; 		mov.w	@(marsGbl_XShift,gbr),r0	; Also update the XShift
(2) 1063/ 6000ABE :                     ; 		add	r1,r0				; bit for 256-color mode
(2) 1064/ 6000ABE :                     ; 		mov.w	r0,@(marsGbl_XShift,gbr)
(2) 1065/ 6000ABE :                     
(2) 1066/ 6000ABE :                     	; ---------------------------------------
(2) 1067/ 6000ABE :                     	; Y Framebuffer position
(2) 1068/ 6000ABE :                     	; ---------------------------------------
(2) 1069/ 6000ABE :                     
(2) 1070/ 6000ABE : 85ED                		mov.w	@(mbg_intrl_h,r14),r0
(2) 1071/ 6000AC0 : 6303                		mov	r0,r3
(2) 1072/ 6000AC2 : 85EA                		mov.w	@(mbg_yfb,r14),r0
(2) 1073/ 6000AC4 : 6403                		mov	r0,r4
(2) 1074/ 6000AC6 : 342C                		add	r2,r4
(2) 1075/ 6000AC8 : 4215                		cmp/pl	r2
(2) 1076/ 6000ACA : 8B02                		bf	.ypu_negtv
(2) 1077/ 6000ACC : 3433                		cmp/ge	r3,r4
(2) 1078/ 6000ACE : 8B00                		bf	.ypu_negtv
(2) 1079/ 6000AD0 : 3438                		sub	r3,r4
(2) 1080/ 6000AD2 :                     .ypu_negtv:
(2) 1081/ 6000AD2 : 4211                		cmp/pz	r2
(2) 1082/ 6000AD4 : 8902                		bt	.ypu_postv
(2) 1083/ 6000AD6 : 4411                		cmp/pz	r4
(2) 1084/ 6000AD8 : 8900                		bt	.ypu_postv
(2) 1085/ 6000ADA : 343C                		add	r3,r4
(2) 1086/ 6000ADC :                     .ypu_postv:
(2) 1087/ 6000ADC : 6043                		mov	r4,r0
(2) 1088/ 6000ADE : 81EA                		mov.w	r0,@(mbg_yfb,r14)
(2) 1089/ 6000AE0 :                     
(2) 1090/ 6000AE0 :                     	; ---------------------------------------
(2) 1091/ 6000AE0 :                     	; Update Framebuffer TOP-LEFT position
(2) 1092/ 6000AE0 :                     	; ---------------------------------------
(2) 1093/ 6000AE0 :                     
(2) 1094/ 6000AE0 : 53E7                		mov	@(mbg_intrl_size,r14),r3
(2) 1095/ 6000AE2 : 50E9                		mov	@(mbg_fbpos,r14),r0
(2) 1096/ 6000AE4 : 301C                		add	r1,r0
(2) 1097/ 6000AE6 : 4115                		cmp/pl	r1
(2) 1098/ 6000AE8 : 8B02                		bf	.yx_negtv
(2) 1099/ 6000AEA : 3033                		cmp/ge	r3,r0
(2) 1100/ 6000AEC : 8B00                		bf	.yx_negtv
(2) 1101/ 6000AEE : 3038                		sub	r3,r0
(2) 1102/ 6000AF0 :                     .yx_negtv:
(2) 1103/ 6000AF0 : 4111                		cmp/pz	r1
(2) 1104/ 6000AF2 : 8902                		bt	.yx_postv
(2) 1105/ 6000AF4 : 4011                		cmp/pz	r0
(2) 1106/ 6000AF6 : 8900                		bt	.yx_postv
(2) 1107/ 6000AF8 : 303C                		add	r3,r0
(2) 1108/ 6000AFA :                     .yx_postv:
(2) 1109/ 6000AFA : 1E09                		mov	r0,@(mbg_fbpos,r14)
(2) 1110/ 6000AFC :                     
(2) 1111/ 6000AFC :                     	; ---------------------------------------
(2) 1112/ 6000AFC :                     	; Update background draw-heads
(2) 1113/ 6000AFC :                     	; r1 - X left/right
(2) 1114/ 6000AFC :                     	; r2 - Y up/down
(2) 1115/ 6000AFC :                     	; ---------------------------------------
(2) 1116/ 6000AFC :                     
(2) 1117/ 6000AFC : 85E8                		mov.w	@(mbg_width,r14),r0
(2) 1118/ 6000AFE : 6303                		mov	r0,r3
(2) 1119/ 6000B00 : 85E9                		mov.w	@(mbg_height,r14),r0
(2) 1120/ 6000B02 : 6403                		mov	r0,r4
(2) 1121/ 6000B04 : 85E5                		mov.w	@(mbg_xinc_r,r14),r0
(2) 1122/ 6000B06 : 6503                		mov	r0,r5
(2) 1123/ 6000B08 : 85E4                		mov.w	@(mbg_xinc_l,r14),r0
(2) 1124/ 6000B0A : 6603                		mov	r0,r6
(2) 1125/ 6000B0C : 85E6                		mov.w	@(mbg_yinc_u,r14),r0
(2) 1126/ 6000B0E : 6703                		mov	r0,r7
(2) 1127/ 6000B10 : 85E7                		mov.w	@(mbg_yinc_d,r14),r0
(2) 1128/ 6000B12 : 6803                		mov	r0,r8
(2) 1129/ 6000B14 : 351C                		add	r1,r5
(2) 1130/ 6000B16 : 4115                		cmp/pl	r1
(2) 1131/ 6000B18 : 8B02                		bf	.xnegtv
(2) 1132/ 6000B1A : 3533                		cmp/ge	r3,r5
(2) 1133/ 6000B1C : 8B00                		bf	.xnegtv
(2) 1134/ 6000B1E : 3538                		sub	r3,r5
(2) 1135/ 6000B20 :                     .xnegtv:
(2) 1136/ 6000B20 : 4111                		cmp/pz	r1
(2) 1137/ 6000B22 : 8902                		bt	.xpostv
(2) 1138/ 6000B24 : 4511                		cmp/pz	r5
(2) 1139/ 6000B26 : 8900                		bt	.xpostv
(2) 1140/ 6000B28 : 353C                		add	r3,r5
(2) 1141/ 6000B2A :                     .xpostv:
(2) 1142/ 6000B2A : 361C                		add	r1,r6
(2) 1143/ 6000B2C : 4115                		cmp/pl	r1
(2) 1144/ 6000B2E : 8B02                		bf	.xnegtvl
(2) 1145/ 6000B30 : 3633                		cmp/ge	r3,r6
(2) 1146/ 6000B32 : 8B00                		bf	.xnegtvl
(2) 1147/ 6000B34 : 3638                		sub	r3,r6
(2) 1148/ 6000B36 :                     .xnegtvl:
(2) 1149/ 6000B36 : 4111                		cmp/pz	r1
(2) 1150/ 6000B38 : 8902                		bt	.xpostvl
(2) 1151/ 6000B3A : 4611                		cmp/pz	r6
(2) 1152/ 6000B3C : 8900                		bt	.xpostvl
(2) 1153/ 6000B3E : 363C                		add	r3,r6
(2) 1154/ 6000B40 :                     .xpostvl:
(2) 1155/ 6000B40 :                     
(2) 1156/ 6000B40 : 372C                		add	r2,r7
(2) 1157/ 6000B42 : 4215                		cmp/pl	r2
(2) 1158/ 6000B44 : 8B02                		bf	.ynegtv
(2) 1159/ 6000B46 : 3743                		cmp/ge	r4,r7
(2) 1160/ 6000B48 : 8B00                		bf	.ynegtv
(2) 1161/ 6000B4A : 3748                		sub	r4,r7
(2) 1162/ 6000B4C :                     .ynegtv:
(2) 1163/ 6000B4C : 4211                		cmp/pz	r2
(2) 1164/ 6000B4E : 8902                		bt	.ypostv
(2) 1165/ 6000B50 : 4711                		cmp/pz	r7
(2) 1166/ 6000B52 : 8900                		bt	.ypostv
(2) 1167/ 6000B54 : 374C                		add	r4,r7
(2) 1168/ 6000B56 :                     .ypostv:
(2) 1169/ 6000B56 : 382C                		add	r2,r8
(2) 1170/ 6000B58 : 4215                		cmp/pl	r2
(2) 1171/ 6000B5A : 8B02                		bf	.ynegtvl
(2) 1172/ 6000B5C : 3843                		cmp/ge	r4,r8
(2) 1173/ 6000B5E : 8B00                		bf	.ynegtvl
(2) 1174/ 6000B60 : 3848                		sub	r4,r8
(2) 1175/ 6000B62 :                     .ynegtvl:
(2) 1176/ 6000B62 : 4211                		cmp/pz	r2
(2) 1177/ 6000B64 : 8902                		bt	.ypostvl
(2) 1178/ 6000B66 : 4811                		cmp/pz	r8
(2) 1179/ 6000B68 : 8900                		bt	.ypostvl
(2) 1180/ 6000B6A : 384C                		add	r4,r8
(2) 1181/ 6000B6C :                     .ypostvl:
(2) 1182/ 6000B6C : 6053                		mov	r5,r0
(2) 1183/ 6000B6E : 81E5                		mov.w	r0,@(mbg_xinc_r,r14)
(2) 1184/ 6000B70 : 6063                		mov	r6,r0
(2) 1185/ 6000B72 : 81E4                		mov.w	r0,@(mbg_xinc_l,r14)
(2) 1186/ 6000B74 : 6073                		mov	r7,r0
(2) 1187/ 6000B76 : 81E6                		mov.w	r0,@(mbg_yinc_u,r14)
(2) 1188/ 6000B78 : 6083                		mov	r8,r0
(2) 1189/ 6000B7A : 81E7                		mov.w	r0,@(mbg_yinc_d,r14)
(2) 1190/ 6000B7C :                     
(2) 1191/ 6000B7C :                     	; ---------------------------------------
(2) 1192/ 6000B7C :                     
(2) 1193/ 6000B7C :                     ; 		mov	#Cach_Drw_U,r8
(2) 1194/ 6000B7C :                     ; 		mov	#Cach_Drw_D,r9
(2) 1195/ 6000B7C : 85EB                		mov.w	@(mbg_intrl_blk,r14),r0
(2) 1196/ 6000B7E : 6303                		mov	r0,r3
(2) 1197/ 6000B80 : 2309                		and	r0,r3			; r3 - block size to check
(2) 1198/ 6000B82 : E500                		mov	#0,r5
(2) 1199/ 6000B84 : 84E3                		mov.b	@(mbg_yset,r14),r0
(2) 1200/ 6000B86 : 302C                		add	r2,r0
(2) 1201/ 6000B88 : 6603                		mov	r0,r6
(2) 1202/ 6000B8A : 2038                		tst	r3,r0
(2) 1203/ 6000B8C : 8915                		bt	.ydr_busy
(2) 1204/ 6000B8E : 4215                		cmp/pl	r2
(2) 1205/ 6000B90 : 8B08                		bf	.reqd_b
(2) 1206/ 6000B92 : C519                		mov.w	@(marsGbl_BgDrwU,gbr),r0
(2) 1207/ 6000B94 : 6403                		mov	r0,r4
(2) 1208/ 6000B96 : C51A                		mov.w	@(marsGbl_BgDrwD,gbr),r0
(2) 1209/ 6000B98 : 204B                		or	r4,r0
(2) 1210/ 6000B9A : 8800                		cmp/eq	#0,r0
(2) 1211/ 6000B9C : 8B0D                		bf	.ydr_busy
(2) 1212/ 6000B9E : E002                		mov	#2,r0
(2) 1213/ 6000BA0 : C11A                		mov.w	r0,@(marsGbl_BgDrwD,gbr)
(2) 1214/ 6000BA2 : 7501                		add	#$01,r5
(2) 1215/ 6000BA4 :                     .reqd_b:
(2) 1216/ 6000BA4 : 4211                		cmp/pz	r2
(2) 1217/ 6000BA6 : 8908                		bt	.ydr_busy
(2) 1218/ 6000BA8 : C519                		mov.w	@(marsGbl_BgDrwU,gbr),r0
(2) 1219/ 6000BAA : 6403                		mov	r0,r4
(2) 1220/ 6000BAC : C51A                		mov.w	@(marsGbl_BgDrwD,gbr),r0
(2) 1221/ 6000BAE : 204B                		or	r4,r0
(2) 1222/ 6000BB0 : 8800                		cmp/eq	#0,r0
(2) 1223/ 6000BB2 : 8B02                		bf	.ydr_busy
(2) 1224/ 6000BB4 : E002                		mov	#2,r0
(2) 1225/ 6000BB6 : C119                		mov.w	r0,@(marsGbl_BgDrwU,gbr)
(2) 1226/ 6000BB8 : 7501                		add	#$01,r5
(2) 1227/ 6000BBA :                     .ydr_busy:
(2) 1228/ 6000BBA : 85EB                		mov.w	@(mbg_intrl_blk,r14),r0
(2) 1229/ 6000BBC : 6403                		mov	r0,r4
(2) 1230/ 6000BBE : 6063                		mov	r6,r0
(2) 1231/ 6000BC0 : 4410                		dt	r4
(2) 1232/ 6000BC2 : 2049                		and	r4,r0
(2) 1233/ 6000BC4 : 80E3                		mov.b	r0,@(mbg_yset,r14)
(2) 1234/ 6000BC6 : 84E2                		mov.b	@(mbg_xset,r14),r0
(2) 1235/ 6000BC8 : 301C                		add	r1,r0
(2) 1236/ 6000BCA : 6603                		mov	r0,r6
(2) 1237/ 6000BCC : 2038                		tst	r3,r0
(2) 1238/ 6000BCE : 8915                		bt	.ydl_busy
(2) 1239/ 6000BD0 : 4115                		cmp/pl	r1
(2) 1240/ 6000BD2 : 8B08                		bf	.reqr_b
(2) 1241/ 6000BD4 : C518                		mov.w	@(marsGbl_BgDrwL,gbr),r0
(2) 1242/ 6000BD6 : 6403                		mov	r0,r4
(2) 1243/ 6000BD8 : C517                		mov.w	@(marsGbl_BgDrwR,gbr),r0
(2) 1244/ 6000BDA : 204B                		or	r4,r0
(2) 1245/ 6000BDC : 8800                		cmp/eq	#0,r0
(2) 1246/ 6000BDE : 8B0D                		bf	.ydl_busy
(2) 1247/ 6000BE0 : E002                		mov	#2,r0
(2) 1248/ 6000BE2 : C117                		mov.w	r0,@(marsGbl_BgDrwR,gbr)
(2) 1249/ 6000BE4 : 7502                		add	#$02,r5
(2) 1250/ 6000BE6 :                     .reqr_b:
(2) 1251/ 6000BE6 : 4111                		cmp/pz	r1
(2) 1252/ 6000BE8 : 8908                		bt	.ydl_busy
(2) 1253/ 6000BEA : C518                		mov.w	@(marsGbl_BgDrwL,gbr),r0
(2) 1254/ 6000BEC : 6403                		mov	r0,r4
(2) 1255/ 6000BEE : C517                		mov.w	@(marsGbl_BgDrwR,gbr),r0
(2) 1256/ 6000BF0 : 204B                		or	r4,r0
(2) 1257/ 6000BF2 : 8800                		cmp/eq	#0,r0
(2) 1258/ 6000BF4 : 8B02                		bf	.ydl_busy
(2) 1259/ 6000BF6 : E002                		mov	#2,r0
(2) 1260/ 6000BF8 : C118                		mov.w	r0,@(marsGbl_BgDrwL,gbr)
(2) 1261/ 6000BFA : 7502                		add	#$02,r5
(2) 1262/ 6000BFC :                     .ydl_busy:
(2) 1263/ 6000BFC : 85EB                		mov.w	@(mbg_intrl_blk,r14),r0
(2) 1264/ 6000BFE : 6403                		mov	r0,r4
(2) 1265/ 6000C00 : 6063                		mov	r6,r0
(2) 1266/ 6000C02 : 4410                		dt	r4
(2) 1267/ 6000C04 : 2049                		and	r4,r0
(2) 1268/ 6000C06 : 80E2                		mov.b	r0,@(mbg_xset,r14)
(2) 1269/ 6000C08 :                     
(2) 1270/ 6000C08 :                     	; Make snapshot of scroll variables for drawing
(2) 1271/ 6000C08 : 4515                		cmp/pl	r5
(2) 1272/ 6000C0A : 8B20                		bf	.dont_snap
(2) 1273/ 6000C0C : 85EB                		mov.w	@(mbg_intrl_blk,r14),r0
(2) 1274/ 6000C0E : 600B                		neg	r0,r0
(2) 1275/ 6000C10 : 6703                		mov	r0,r7
(2) 1276/ 6000C12 : D111                		mov	#Cach_XHead_L,r1
(2) 1277/ 6000C14 : D211                		mov	#Cach_XHead_R,r2
(2) 1278/ 6000C16 : D312                		mov	#Cach_YHead_U,r3
(2) 1279/ 6000C18 : D412                		mov	#Cach_YHead_D,r4
(2) 1280/ 6000C1A : D513                		mov	#Cach_BgFbPos_V,r5
(2) 1281/ 6000C1C : D613                		mov	#Cach_BgFbPos_H,r6
(2) 1282/ 6000C1E : 85E4                		mov.w	@(mbg_xinc_l,r14),r0
(2) 1283/ 6000C20 : 2079                		and	r7,r0
(2) 1284/ 6000C22 : 2102                		mov	r0,@r1
(2) 1285/ 6000C24 : 85E5                		mov.w	@(mbg_xinc_r,r14),r0
(2) 1286/ 6000C26 : 2079                		and	r7,r0
(2) 1287/ 6000C28 : 2202                		mov	r0,@r2
(2) 1288/ 6000C2A : 85E6                		mov.w	@(mbg_yinc_u,r14),r0
(2) 1289/ 6000C2C : 2079                		and	r7,r0
(2) 1290/ 6000C2E : 2302                		mov	r0,@r3
(2) 1291/ 6000C30 : 85E7                		mov.w	@(mbg_yinc_d,r14),r0
(2) 1292/ 6000C32 : 2079                		and	r7,r0
(2) 1293/ 6000C34 : 2402                		mov	r0,@r4
(2) 1294/ 6000C36 : 85EA                		mov.w	@(mbg_yfb,r14),r0
(2) 1295/ 6000C38 : 2079                		and	r7,r0
(2) 1296/ 6000C3A : 2502                		mov	r0,@r5
(2) 1297/ 6000C3C : 50E9                		mov	@(mbg_fbpos,r14),r0
(2) 1298/ 6000C3E : 2079                		and	r7,r0
(2) 1299/ 6000C40 : 6703                		mov	r0,r7
(2) 1300/ 6000C42 : 84E1                		mov.b	@(mbg_flags,r14),r0
(2) 1301/ 6000C44 : C901                		and	#1,r0
(2) 1302/ 6000C46 : 2008                		tst	r0,r0
(2) 1303/ 6000C48 : 8900                		bt	.indxmode
(2) 1304/ 6000C4A : 4700                		shll	r7
(2) 1305/ 6000C4C :                     .indxmode:
(2) 1306/ 6000C4C : 2672                		mov	r7,@r6
(2) 1307/ 6000C4E :                     .dont_snap:
(2) 1308/ 6000C4E :                     
(2) 1309/ 6000C4E : 000B                		rts
(2) 1310/ 6000C50 : 0009                		nop
(2) 1311/ 6000C52 :                     		align 4
(2) 1312/ 6000C54 : 2601 6C18 C000 068C 		ltorg
                    C000 0690 C000 0694 
                    C000 0698 C000 069C 
                    C000 06A0           
(2) 1313/ 6000C70 :                     
(2) 1314/ 6000C70 :                     ; ---------------------------------------
(2) 1315/ 6000C70 :                     ; Make a visible section on screen
(2) 1316/ 6000C70 :                     ;
(2) 1317/ 6000C70 :                     ; r1 - Background buffer
(2) 1318/ 6000C70 :                     ; r2 - Top Y
(2) 1319/ 6000C70 :                     ; r3 - Bottom Y
(2) 1320/ 6000C70 :                     ; ---------------------------------------
(2) 1321/ 6000C70 :                     
(2) 1322/ 6000C70 :                     MarsVideo_MakeTbl:
(2) 1323/ 6000C70 : DE23                		mov	#_framebuffer,r14		; r14 - Framebuffer BASE
(2) 1324/ 6000C72 : 5D1A                		mov	@(mbg_fbdata,r1),r13		; r13 - Framebuffer pixeldata position
(2) 1325/ 6000C74 : 5C17                		mov	@(mbg_intrl_size,r1),r12	; r12 - Full size of screen-scroll
(2) 1326/ 6000C76 : EA00                		mov	#0,r10				; r10 - line counter
(2) 1327/ 6000C78 : 851C                		mov.w	@(mbg_intrl_w,r1),r0
(2) 1328/ 6000C7A : 6903                		mov	r0,r9				;  r9 - Next line to add
(2) 1329/ 6000C7C : 6623                		mov	r2,r6
(2) 1330/ 6000C7E : 68E3                		mov	r14,r8
(2) 1331/ 6000C80 : 6023                		mov	r2,r0
(2) 1332/ 6000C82 : 4000                		shll	r0
(2) 1333/ 6000C84 : 380C                		add	r0,r8
(2) 1334/ 6000C86 : 851A                		mov.w	@(mbg_yfb,r1),r0
(2) 1335/ 6000C88 : 209E                		mulu	r9,r0
(2) 1336/ 6000C8A : 5519                		mov	@(mbg_fbpos,r1),r5
(2) 1337/ 6000C8C :                     ; 		shll	r5
(2) 1338/ 6000C8C : 6753                		mov	r5,r7
(2) 1339/ 6000C8E : 001A                		sts	macl,r0
(2) 1340/ 6000C90 : 370C                		add	r0,r7
(2) 1341/ 6000C92 : 943B                		mov	#$FF,r4
(2) 1342/ 6000C94 :                     .ln_loop:
(2) 1343/ 6000C94 : 6573                		mov	r7,r5
(2) 1344/ 6000C96 : 35C3                		cmp/ge	r12,r5
(2) 1345/ 6000C98 : 8B00                		bf	.xl_r
(2) 1346/ 6000C9A : 35C8                		sub	r12,r5
(2) 1347/ 6000C9C :                     .xl_r:
(2) 1348/ 6000C9C : 4511                		cmp/pz	r5
(2) 1349/ 6000C9E : 8900                		bt	.xl_l
(2) 1350/ 6000CA0 : 35CC                		add	r12,r5
(2) 1351/ 6000CA2 :                     .xl_l:
(2) 1352/ 6000CA2 : 6753                		mov	r5,r7
(2) 1353/ 6000CA4 : 379C                		add	r9,r7		; Add Y
(2) 1354/ 6000CA6 : 35DC                		add	r13,r5		; Add Framebuffer position
(2) 1355/ 6000CA8 : 4501                		shlr	r5		; divide by 2 (shift reg does the missing bit 0)
(2) 1356/ 6000CAA : 2851                		mov.w	r5,@r8		; send to FB's table
(2) 1357/ 6000CAC : 7802                		add	#2,r8
(2) 1358/ 6000CAE : 7A02                		add	#2,r10
(2) 1359/ 6000CB0 : 3630                		cmp/eq	r3,r6
(2) 1360/ 6000CB2 : 8FEF                		bf/s	.ln_loop
(2) 1361/ 6000CB4 : 7601                		add	#1,r6
(2) 1362/ 6000CB6 :                     
(2) 1363/ 6000CB6 :                     .no_lines:
(2) 1364/ 6000CB6 : 000B                		rts
(2) 1365/ 6000CB8 : 0009                		nop
(2) 1366/ 6000CBA :                     		align 4
(2) 1367/ 6000CBC :                     
(2) 1368/ 6000CBC :                     ; ---------------------------------------
(2) 1369/ 6000CBC :                     ; Call this after BEFORE swapping
(2) 1370/ 6000CBC :                     ; to fix that Xshift bit issue on
(2) 1371/ 6000CBC :                     ; Real Hardware
(2) 1372/ 6000CBC :                     ; ---------------------------------------
(2) 1373/ 6000CBC :                     
(2) 1374/ 6000CBC :                     MarsVideo_FixTblShift:
(2) 1375/ 6000CBC : C512                		mov.w	@(marsGbl_XShift,gbr),r0
(2) 1376/ 6000CBE : C901                		and	#1,r0
(2) 1377/ 6000CC0 : 8801                		cmp/eq	#1,r0
(2) 1378/ 6000CC2 : 8B1A                		bf	.ptchset
(2) 1379/ 6000CC4 : DE0E                		mov	#_framebuffer,r14		; r14 - Framebuffer BASE
(2) 1380/ 6000CC6 :                     ; 		mov.b	@(mbg_flags,r1),r0		; Background is Indexed?
(2) 1381/ 6000CC6 :                     ; 		and	#%00000001,r0
(2) 1382/ 6000CC6 :                     ; 		tst	r0,r0
(2) 1383/ 6000CC6 :                     ; 		bf	.ptchset
(2) 1384/ 6000CC6 : 6DE3                		mov	r14,r13
(2) 1385/ 6000CC8 : DC0E                		mov	#_framebuffer+FBVRAM_PATCH,r12	; r13 - Output for patched pixel lines
(2) 1386/ 6000CCA : 9B20                		mov	#240,r11
(2) 1387/ 6000CCC : 9A1E                		mov	#$FF,r10
(2) 1388/ 6000CCE : D90E                		mov	#$FFFF,r9
(2) 1389/ 6000CD0 :                     ; 		mov	#-2,r8
(2) 1390/ 6000CD0 :                     .loop:
(2) 1391/ 6000CD0 : 60D1                		mov.w	@r13,r0
(2) 1392/ 6000CD2 : 2099                		and	r9,r0
(2) 1393/ 6000CD4 : 6703                		mov	r0,r7
(2) 1394/ 6000CD6 : 20A9                		and	r10,r0
(2) 1395/ 6000CD8 : 30A0                		cmp/eq	r10,r0
(2) 1396/ 6000CDA : 8B0B                		bf	.tblexit
(2) 1397/ 6000CDC : 4700                		shll	r7
(2) 1398/ 6000CDE : 37EC                		add	r14,r7
(2) 1399/ 6000CE0 : 60C3                		mov	r12,r0
(2) 1400/ 6000CE2 : 4001                		shlr	r0
(2) 1401/ 6000CE4 : 2D01                		mov.w	r0,@r13
(2) 1402/ 6000CE6 : 9313                		mov	#(320+4)/2,r3
(2) 1403/ 6000CE8 :                     .copy:
(2) 1404/ 6000CE8 : 6071                		mov.w	@r7,r0
(2) 1405/ 6000CEA : 2C01                		mov.w	r0,@r12
(2) 1406/ 6000CEC : 7702                		add	#2,r7
(2) 1407/ 6000CEE : 4310                		dt	r3
(2) 1408/ 6000CF0 : 8FFA                		bf/s	.copy
(2) 1409/ 6000CF2 : 7C02                		add	#2,r12
(2) 1410/ 6000CF4 :                     .tblexit:
(2) 1411/ 6000CF4 : 4B10                		dt	r11
(2) 1412/ 6000CF6 : 8FEB                		bf/s	.loop
(2) 1413/ 6000CF8 : 7D02                		add	#2,r13
(2) 1414/ 6000CFA :                     .ptchset:
(2) 1415/ 6000CFA : 000B                		rts
(2) 1416/ 6000CFC : 0009                		nop
(2) 1417/ 6000CFE :                     		align 4
(2) 1418/ 6000D00 : 0400 0000 0401 E000 		ltorg
                    0000 FFFF 00FF 00F0 
                    00A2                
(2) 1419/ 6000D12 :                     
(2) 1420/ 6000D12 :                     ; ------------------------------------------------
(2) 1421/ 6000D12 :                     ; MarsVideo_MkScrlField
(2) 1422/ 6000D12 :                     ;
(2) 1423/ 6000D12 :                     ; Make a new internal background
(2) 1424/ 6000D12 :                     ; scrolling buffer
(2) 1425/ 6000D12 :                     ;
(2) 1426/ 6000D12 :                     ; First call this, set your values
(2) 1427/ 6000D12 :                     ; Then call MarsVideo_SetBg to set
(2) 1428/ 6000D12 :                     ; the source image (ROM or RAM)
(2) 1429/ 6000D12 :                     ;
(2) 1430/ 6000D12 :                     ; r1 - Background buffer
(2) 1431/ 6000D12 :                     ; r2 - Output framebuffer data
(2) 1432/ 6000D12 :                     ; r3 - Scroll block size (4 BYTE ALIGNED)
(2) 1433/ 6000D12 :                     ; r4 - Scroll visible width
(2) 1434/ 6000D12 :                     ; r5 - Scroll visible height
(2) 1435/ 6000D12 :                     ; r6 - Type: Indexed or Direct (TODO)
(2) 1436/ 6000D12 :                     ; ------------------------------------------------
(2) 1437/ 6000D12 :                     
(2) 1438/ 6000D12 :                     MarsVideo_MkScrlField:
(2) 1439/ 6000D12 : 6063                		mov	r6,r0
(2) 1440/ 6000D14 : C901                		and	#1,r0
(2) 1441/ 6000D16 : 2008                		tst	r0,r0
(2) 1442/ 6000D18 : 8900                		bt	.no_indx
(2) 1443/ 6000D1A : 4400                		shll	r4
(2) 1444/ 6000D1C :                     .no_indx:
(2) 1445/ 6000D1C : 343C                		add	r3,r4		; add block to width/height
(2) 1446/ 6000D1E : 353C                		add	r3,r5
(2) 1447/ 6000D20 : 112A                		mov	r2,@(mbg_fbdata,r1)
(2) 1448/ 6000D22 : 6033                		mov	r3,r0
(2) 1449/ 6000D24 : 811B                		mov.w	r0,@(mbg_intrl_blk,r1)
(2) 1450/ 6000D26 : 6043                		mov	r4,r0
(2) 1451/ 6000D28 : 811C                		mov.w	r0,@(mbg_intrl_w,r1)
(2) 1452/ 6000D2A : 6053                		mov	r5,r0
(2) 1453/ 6000D2C : 811D                		mov.w	r0,@(mbg_intrl_h,r1)
(2) 1454/ 6000D2E : 254E                		mulu	r4,r5
(2) 1455/ 6000D30 : 001A                		sts	macl,r0
(2) 1456/ 6000D32 : 1107                		mov	r0,@(mbg_intrl_size,r1)
(2) 1457/ 6000D34 : 6063                		mov	r6,r0
(2) 1458/ 6000D36 : 8011                		mov.b	r0,@(mbg_flags,r1)
(2) 1459/ 6000D38 : 000B                		rts
(2) 1460/ 6000D3A : 0009                		nop
(2) 1461/ 6000D3C :                     		align 4
(2) 1462/ 6000D3C :                     		ltorg
(2) 1463/ 6000D3C :                     
(2) 1464/ 6000D3C :                     ; ------------------------------------------------
(2) 1465/ 6000D3C :                     ; MarsVideo_SetBg
(2) 1466/ 6000D3C :                     ;
(2) 1467/ 6000D3C :                     ; Set pointer to read the pixel-data
(2) 1468/ 6000D3C :                     ;
(2) 1469/ 6000D3C :                     ; r1 - Background buffer
(2) 1470/ 6000D3C :                     ; r2 - Pixeldata output location on Framebuffer
(2) 1471/ 6000D3C :                     ; r3 - Source image WIDTH
(2) 1472/ 6000D3C :                     ; r4 - Source image HEIGHT
(2) 1473/ 6000D3C :                     ;
(2) 1474/ 6000D3C :                     ; WIDTH AND HEIGHT MUST BE ALIGNED IN "BLOCKS"
(2) 1475/ 6000D3C :                     ; ------------------------------------------------
(2) 1476/ 6000D3C :                     
(2) 1477/ 6000D3C :                     MarsVideo_SetBg:
(2) 1478/ 6000D3C : D106                		mov	#RAM_Mars_BgBuffScrl,r1
(2) 1479/ 6000D3E : 1128                		mov	r2,@(mbg_data,r1)
(2) 1480/ 6000D40 : 8411                		mov.b	@(mbg_flags,r1),r0
(2) 1481/ 6000D42 : C901                		and	#1,r0
(2) 1482/ 6000D44 : 2008                		tst	r0,r0
(2) 1483/ 6000D46 : 8900                		bt	.indxmode
(2) 1484/ 6000D48 : 4300                		shll	r3
(2) 1485/ 6000D4A :                     .indxmode:
(2) 1486/ 6000D4A : 6033                		mov	r3,r0
(2) 1487/ 6000D4C : 8118                		mov.w	r0,@(mbg_width,r1)
(2) 1488/ 6000D4E : 6043                		mov	r4,r0
(2) 1489/ 6000D50 : 8119                		mov.w	r0,@(mbg_height,r1)
(2) 1490/ 6000D52 : 000B                		rts
(2) 1491/ 6000D54 : 0009                		nop
(2) 1492/ 6000D56 :                     		align 4
(2) 1493/ 6000D58 : 2601 6C18           		ltorg
(2) 1494/ 6000D5C :                     
(2) 1495/ 6000D5C :                     ; ------------------------------------------------
(2) 1496/ 6000D5C :                     
(2) 1497/ 6000D5C :                     ; ; r1 - Left X
(2) 1498/ 6000D5C :                     ; ; r2 - Right X
(2) 1499/ 6000D5C :                     ; ; r3 - Y Position (max 240)
(2) 1500/ 6000D5C :                     ; ; r4 - Using these pixel(s)
(2) 1501/ 6000D5C :                     ; ;
(2) 1502/ 6000D5C :                     ; ; Uses the first background's
(2) 1503/ 6000D5C :                     ; ; top-left and Y
(2) 1504/ 6000D5C :                     ;
(2) 1505/ 6000D5C :                     ; ; TODO: a DirectColor version of this
(2) 1506/ 6000D5C :                     ; VideoMars_DrawLine:
(2) 1507/ 6000D5C :                     ; 		cmp/eq	r1,r2
(2) 1508/ 6000D5C :                     ; 		bt	.same_x
(2) 1509/ 6000D5C :                     ; 		mov	r2,r6
(2) 1510/ 6000D5C :                     ; 		sub	r1,r6
(2) 1511/ 6000D5C :                     ; 		cmp/pl	r6
(2) 1512/ 6000D5C :                     ; 		bf	.same_x
(2) 1513/ 6000D5C :                     ; 		shlr	r6
(2) 1514/ 6000D5C :                     ; 		mov	#RAM_Mars_BgBuffScrl,r14
(2) 1515/ 6000D5C :                     ; 		mov	#_vdpreg,r13
(2) 1516/ 6000D5C :                     ;
(2) 1517/ 6000D5C :                     ; 		mov.w	@(mbg_intrl_h,r14),r0
(2) 1518/ 6000D5C :                     ; 		mov	r0,r7
(2) 1519/ 6000D5C :                     ; 		mov.w	@(mbg_intrl_w,r14),r0
(2) 1520/ 6000D5C :                     ; 		mov	r0,r5
(2) 1521/ 6000D5C :                     ; 		mov.w	@(mbg_yfb,r14),r0
(2) 1522/ 6000D5C :                     ; 		add	r3,r0
(2) 1523/ 6000D5C :                     ; 		cmp/ge	r7,r0
(2) 1524/ 6000D5C :                     ; 		bf	.ylowr
(2) 1525/ 6000D5C :                     ; 		sub	r7,r0
(2) 1526/ 6000D5C :                     ; .ylowr:
(2) 1527/ 6000D5C :                     ; 		mulu	r5,r0
(2) 1528/ 6000D5C :                     ; 		sts	macl,r5
(2) 1529/ 6000D5C :                     ; 		mov	@(mbg_fbdata,r14),r0
(2) 1530/ 6000D5C :                     ; 		add	r0,r5
(2) 1531/ 6000D5C :                     ; 		mov	@(mbg_fbpos,r14),r0
(2) 1532/ 6000D5C :                     ; 		add	r0,r5
(2) 1533/ 6000D5C :                     ; 		add	r1,r5
(2) 1534/ 6000D5C :                     ; 		mov	@(mbg_intrl_size,r14),r0
(2) 1535/ 6000D5C :                     ; 		cmp/gt	r0,r5
(2) 1536/ 6000D5C :                     ; 		bf	.fb_decr
(2) 1537/ 6000D5C :                     ; 		sub	r0,r5
(2) 1538/ 6000D5C :                     ; .fb_decr:
(2) 1539/ 6000D5C :                     ; 		shlr	r5
(2) 1540/ 6000D5C :                     ;
(2) 1541/ 6000D5C :                     ; 	; r5 - topleft pos
(2) 1542/ 6000D5C :                     ; 	; r6 - length
(2) 1543/ 6000D5C :                     ;
(2) 1544/ 6000D5C :                     ; 	; Cross-check
(2) 1545/ 6000D5C :                     ; 		mov	r6,r0
(2) 1546/ 6000D5C :                     ; 		add	r5,r0
(2) 1547/ 6000D5C :                     ; 		mov	r0,r7
(2) 1548/ 6000D5C :                     ; 		mov	r5,r8
(2) 1549/ 6000D5C :                     ; 		shlr8	r7
(2) 1550/ 6000D5C :                     ; 		shlr8	r8
(2) 1551/ 6000D5C :                     ; 		cmp/eq	r7,r8
(2) 1552/ 6000D5C :                     ; 		bt	.single
(2) 1553/ 6000D5C :                     ; 		mov	r0,r8
(2) 1554/ 6000D5C :                     ; 		and	#$FF,r0
(2) 1555/ 6000D5C :                     ; 		cmp/eq	#0,r0
(2) 1556/ 6000D5C :                     ; 		bt	.single
(2) 1557/ 6000D5C :                     ;
(2) 1558/ 6000D5C :                     ; 	; Left write
(2) 1559/ 6000D5C :                     ; 		mov	r6,r7
(2) 1560/ 6000D5C :                     ; 		sub	r0,r6
(2) 1561/ 6000D5C :                     ; 		mov	r6,r0
(2) 1562/ 6000D5C :                     ; 		dt	r0
(2) 1563/ 6000D5C :                     ; 		mov.w	r0,@(filllength,r13)
(2) 1564/ 6000D5C :                     ; 		mov	r5,r0
(2) 1565/ 6000D5C :                     ; 		mov.w	r0,@(fillstart,r13)
(2) 1566/ 6000D5C :                     ; 		mov	r4,r0
(2) 1567/ 6000D5C :                     ; 		mov.w	r0,@(filldata,r13)
(2) 1568/ 6000D5C :                     ; .wait_l:	mov.w	@(vdpsts,r13),r0
(2) 1569/ 6000D5C :                     ; 		and	#%10,r0
(2) 1570/ 6000D5C :                     ; 		tst	r0,r0
(2) 1571/ 6000D5C :                     ; 		bf	.wait_l
(2) 1572/ 6000D5C :                     ;
(2) 1573/ 6000D5C :                     ; 		add	r7,r5
(2) 1574/ 6000D5C :                     ; 		mov	#$100,r6
(2) 1575/ 6000D5C :                     ; 		mov.w	@(fillstart,r13),r0
(2) 1576/ 6000D5C :                     ; 		add	r6,r0
(2) 1577/ 6000D5C :                     ; 		mov.w	r0,@(fillstart,r13)
(2) 1578/ 6000D5C :                     ; 		sub	r0,r5
(2) 1579/ 6000D5C :                     ; 		mov	r5,r0
(2) 1580/ 6000D5C :                     ; 		dt	r0
(2) 1581/ 6000D5C :                     ; 		mov.w	r0,@(filllength,r13)
(2) 1582/ 6000D5C :                     ; 		mov	r4,r0
(2) 1583/ 6000D5C :                     ; 		mov.w	r0,@(filldata,r13)
(2) 1584/ 6000D5C :                     ; .wait_r:	mov.w	@(vdpsts,r13),r0
(2) 1585/ 6000D5C :                     ; 		and	#%10,r0
(2) 1586/ 6000D5C :                     ; 		tst	r0,r0
(2) 1587/ 6000D5C :                     ; 		bf	.wait_r
(2) 1588/ 6000D5C :                     ; 		rts
(2) 1589/ 6000D5C :                     ; 		nop
(2) 1590/ 6000D5C :                     ; 		align 4
(2) 1591/ 6000D5C :                     ;
(2) 1592/ 6000D5C :                     ; ; Single write
(2) 1593/ 6000D5C :                     ; .single:
(2) 1594/ 6000D5C :                     ; 		mov	r6,r0
(2) 1595/ 6000D5C :                     ; 		dt	r0
(2) 1596/ 6000D5C :                     ; 		mov.w	r0,@(filllength,r13)
(2) 1597/ 6000D5C :                     ; 		mov	r5,r0
(2) 1598/ 6000D5C :                     ; 		mov.w	r0,@(fillstart,r13)
(2) 1599/ 6000D5C :                     ; 		mov	r4,r0
(2) 1600/ 6000D5C :                     ; 		mov.w	r0,@(filldata,r13)
(2) 1601/ 6000D5C :                     ; .wait_fb:	mov.w	@(vdpsts,r13),r0
(2) 1602/ 6000D5C :                     ; 		and	#%10,r0
(2) 1603/ 6000D5C :                     ; 		tst	r0,r0
(2) 1604/ 6000D5C :                     ; 		bf	.wait_fb
(2) 1605/ 6000D5C :                     ; 		rts
(2) 1606/ 6000D5C :                     ; 		nop
(2) 1607/ 6000D5C :                     ; 		align 4
(2) 1608/ 6000D5C :                     ; .same_x:
(2) 1609/ 6000D5C :                     ; 		rts
(2) 1610/ 6000D5C :                     ; 		nop
(2) 1611/ 6000D5C :                     ; 		align 4
(2) 1612/ 6000D5C :                     ; 		ltorg
(2) 1613/ 6000D5C :                     
(2) 1614/ 6000D5C :                     ; ====================================================================
(2) 1615/ 6000D5C :                     ; ----------------------------------------------------------------
(2) 1616/ 6000D5C :                     ; Polygons
(2) 1617/ 6000D5C :                     ; ----------------------------------------------------------------
(2) 1618/ 6000D5C :                     
(2) 1619/ 6000D5C :                     
(2) 1620/ 6000D5C :                     ; ====================================================================
(2) 1621/ 6000D5C :                     ; ----------------------------------------------------------------
(2) 1622/ 6000D5C :                     ; 3D Models
(2) 1623/ 6000D5C :                     ; ----------------------------------------------------------------
(2) 1624/ 6000D5C :                     
(2) 1625/ 6000D5C :                     ; ; ------------------------------------------------
(2) 1626/ 6000D5C :                     ; ; MarsMdl_Init
(2) 1627/ 6000D5C :                     ; ;
(2) 1628/ 6000D5C :                     ; ; Reset ALL objects
(2) 1629/ 6000D5C :                     ; ; ------------------------------------------------
(2) 1630/ 6000D5C :                     ;
(2) 1631/ 6000D5C :                     ; MarsMdl_Init:
(2) 1632/ 6000D5C :                     ; 		mov	#RAM_Mars_Objects,r1
(2) 1633/ 6000D5C :                     ; 		mov	#MAX_MODELS,r2
(2) 1634/ 6000D5C :                     ; 		mov	#0,r0
(2) 1635/ 6000D5C :                     ; .clnup:
(2) 1636/ 6000D5C :                     ; 		mov	r0,@(mdl_data,r1)
(2) 1637/ 6000D5C :                     ; ; 		mov	r0,@(mdl_animdata,r1)
(2) 1638/ 6000D5C :                     ; 		mov	r0,@(mdl_x_pos,r1)
(2) 1639/ 6000D5C :                     ; 		mov	r0,@(mdl_x_rot,r1)
(2) 1640/ 6000D5C :                     ; 		mov	r0,@(mdl_y_pos,r1)
(2) 1641/ 6000D5C :                     ; 		mov	r0,@(mdl_y_rot,r1)
(2) 1642/ 6000D5C :                     ; 		mov	r0,@(mdl_y_pos,r1)
(2) 1643/ 6000D5C :                     ; 		mov	r0,@(mdl_y_rot,r1)
(2) 1644/ 6000D5C :                     ; 		dt	r2
(2) 1645/ 6000D5C :                     ; 		bf/s	.clnup
(2) 1646/ 6000D5C :                     ; 		add	#sizeof_mdlobj,r1
(2) 1647/ 6000D5C :                     ;
(2) 1648/ 6000D5C :                     ; 	; Clear background and it's draw
(2) 1649/ 6000D5C :                     ; 	; requests
(2) 1650/ 6000D5C :                     ; 		mov	#RAM_Mars_BgBuffScrl,r1
(2) 1651/ 6000D5C :                     ; 		mov	#sizeof_marsbg/2,r2
(2) 1652/ 6000D5C :                     ; .clrbg:
(2) 1653/ 6000D5C :                     ; 		mov	r0,@r1
(2) 1654/ 6000D5C :                     ; 		dt	r2
(2) 1655/ 6000D5C :                     ; 		bf/s	.clrbg
(2) 1656/ 6000D5C :                     ; 		add	#2,r1
(2) 1657/ 6000D5C :                     ; 		mov.w	r0,@(marsGbl_BgDrwAll,gbr)
(2) 1658/ 6000D5C :                     ; 		mov.w	r0,@(marsGbl_BgDrwR,gbr)
(2) 1659/ 6000D5C :                     ; 		mov.w	r0,@(marsGbl_BgDrwL,gbr)
(2) 1660/ 6000D5C :                     ; 		mov.w	r0,@(marsGbl_BgDrwU,gbr)
(2) 1661/ 6000D5C :                     ; 		mov.w	r0,@(marsGbl_BgDrwD,gbr)
(2) 1662/ 6000D5C :                     ; 		rts
(2) 1663/ 6000D5C :                     ; 		nop
(2) 1664/ 6000D5C :                     ; 		align 4
(2) 1665/ 6000D5C :                     ; 		ltorg
(2) 1666/ 6000D5C :                     
(2) 1667/ 6000D5C :                     
(2) 1668/ 6000D5C :                     
(1)  908/ 6000D5C :                     		include "system/mars/sound.asm"
(2)    1/ 6000D5C :                     ; ====================================================================
(2)    2/ 6000D5C :                     ; ----------------------------------------------------------------
(2)    3/ 6000D5C :                     ; MARS Sound
(2)    4/ 6000D5C :                     ; ----------------------------------------------------------------
(2)    5/ 6000D5C :                     
(2)    6/ 6000D5C : =$7                 MAX_PWMCHNL	equ	7
(2)    7/ 6000D5C :                     
(2)    8/ 6000D5C :                     ; 32X sound channel
(2)    9/ 6000D5C : (MACRO)             		struct 0
(2)    9/ 6000D5C : =$6000D5C           GLBL_LASTPC     set *
(2)    9/   238DC :                                     dephase
(2)    9/   238DC : =$238DC             GLBL_LASTORG    set *
(2)    9/       0 :                                     phase 0
(2)   10/       0 :                     mchnsnd_enbl	ds.l 1
(2)   11/       4 :                     mchnsnd_read	ds.l 1		; 0 - off
(2)   12/       8 :                     mchnsnd_cchread	ds.l 1
(2)   13/       C :                     mchnsnd_bank	ds.l 1		; CS0-3 OR value
(2)   14/      10 :                     mchnsnd_start	ds.l 1
(2)   15/      14 :                     mchnsnd_end	ds.l 1
(2)   16/      18 :                     mchnsnd_loop	ds.l 1
(2)   17/      1C :                     mchnsnd_pitch	ds.l 1
(2)   18/      20 :                     mchnsnd_flags	ds.l 1		; %SLR S-wave format mono/stereo | LR-wave output bits
(2)   19/      24 :                     mchnsnd_vol	ds.l 1
(2)   20/      28 :                     sizeof_sndchn	ds.l 0
(2)   21/      28 : (MACRO)             		finish
(2)   21/       0 :                                     !org GLBL_LASTORG
(2)   21/ 6000D5C :                                     phase GLBL_LASTPC
(2)   22/ 6000D5C :                     
(2)   23/ 6000D5C :                     ; *** PWM INTERRUPT MOVED TO CACHE (see cache.asm)
(2)   24/ 6000D5C :                     
(2)   25/ 6000D5C :                     ; ====================================================================
(2)   26/ 6000D5C :                     ; ----------------------------------------------------------------
(2)   27/ 6000D5C :                     ; Subroutines
(2)   28/ 6000D5C :                     ; ----------------------------------------------------------------
(2)   29/ 6000D5C :                     
(2)   30/ 6000D5C :                     ; --------------------------------------------------------
(2)   31/ 6000D5C :                     ; Init Sound PWM
(2)   32/ 6000D5C :                     ;
(2)   33/ 6000D5C :                     ; Frequency values:
(2)   34/ 6000D5C :                     ; 23011361 NTSC
(2)   35/ 6000D5C :                     ; 22801467 PAL
(2)   36/ 6000D5C :                     ;
(2)   37/ 6000D5C :                     ; NOTE: The CLICK sound is normal.
(2)   38/ 6000D5C :                     ; --------------------------------------------------------
(2)   39/ 6000D5C :                     
(2)   40/ 6000D5C :                     MarsSound_Init:
(2)   41/ 6000D5C : 4F13                		stc	gbr,@-r15
(2)   42/ 6000D5E : D039                		mov	#_sysreg,r0
(2)   43/ 6000D60 : 401E                		ldc	r0,gbr
(2)   44/ 6000D62 : 9081                		mov	#$0105,r0
(2)   45/ 6000D64 : C118                		mov.w	r0,@(timerctl,gbr)
(2)   46/ 6000D66 : 9080                		mov	#((((23011361<<1)/22050+1)>>1)+1),r0	; Sample rate
(2)   47/ 6000D68 : C119                		mov.w	r0,@(cycle,gbr)
(2)   48/ 6000D6A : E001                		mov	#1,r0
(2)   49/ 6000D6C : C11C                		mov.w	r0,@(monowidth,gbr)
(2)   50/ 6000D6E : C11C                		mov.w	r0,@(monowidth,gbr)
(2)   51/ 6000D70 : C11C                		mov.w	r0,@(monowidth,gbr)
(2)   52/ 6000D72 :                     ; 		mov	#0,r0
(2)   53/ 6000D72 :                     ; 		mov	#MarsSnd_PwmChnls,r1
(2)   54/ 6000D72 :                     ; 		mov	#MAX_PWMCHNL,r2
(2)   55/ 6000D72 :                     ; 		mov	#sizeof_sndchn,r3
(2)   56/ 6000D72 :                     ; .clr_enbl:
(2)   57/ 6000D72 :                     ; 		mov	r0,@(mchnsnd_enbl,r1)
(2)   58/ 6000D72 :                     ; 		dt	r2
(2)   59/ 6000D72 :                     ; 		bf/s	.clr_enbl
(2)   60/ 6000D72 :                     ; 		add	r3,r1
(2)   61/ 6000D72 : 4F17                		ldc	@r15+,gbr
(2)   62/ 6000D74 : 000B                		rts
(2)   63/ 6000D76 : 0009                		nop
(2)   64/ 6000D78 :                     		align 4
(2)   65/ 6000D78 :                     
(2)   66/ 6000D78 :                     ; --------------------------------------------------------
(2)   67/ 6000D78 :                     ; MarsSound_SetPwm
(2)   68/ 6000D78 :                     ;
(2)   69/ 6000D78 :                     ; Set new sound data to a single channel
(2)   70/ 6000D78 :                     ;
(2)   71/ 6000D78 :                     ; Input:
(2)   72/ 6000D78 :                     ; r1 | Channel
(2)   73/ 6000D78 :                     ; r2 | Start address
(2)   74/ 6000D78 :                     ; r3 | End address
(2)   75/ 6000D78 :                     ; r4 | Loop address (ignored if loop flag isn't set)
(2)   76/ 6000D78 :                     ; r5 | Pitch ($xxxxxx.xx, $100 default speed)
(2)   77/ 6000D78 :                     ; r6 | Volume
(2)   78/ 6000D78 :                     ; r7 | Flags (Currently: %xxxxslLR)
(2)   79/ 6000D78 :                     ;      LR - output
(2)   80/ 6000D78 :                     ;      l - LOOP flag
(2)   81/ 6000D78 :                     ;      s - Sample is in stereo
(2)   82/ 6000D78 :                     ;
(2)   83/ 6000D78 :                     ; Uses:
(2)   84/ 6000D78 :                     ; r0,r8-r9
(2)   85/ 6000D78 :                     ; --------------------------------------------------------
(2)   86/ 6000D78 :                     
(2)   87/ 6000D78 :                     MarsSound_SetPwm:
(2)   88/ 6000D78 : D833                		mov	#MarsSnd_PwmChnls,r8
(2)   89/ 6000D7A : E028                		mov 	#sizeof_sndchn,r0
(2)   90/ 6000D7C : 201E                		mulu	r1,r0
(2)   91/ 6000D7E : 001A                		sts	macl,r0
(2)   92/ 6000D80 : 380C                		add 	r0,r8
(2)   93/ 6000D82 : E000                		mov 	#0,r0
(2)   94/ 6000D84 : 1800                		mov 	r0,@(mchnsnd_enbl,r8)
(2)   95/ 6000D86 :                     ; 		mov 	r0,@(mchnsnd_read,r8)
(2)   96/ 6000D86 :                     ; 		mov 	r0,@(mchnsnd_bank,r8)
(2)   97/ 6000D86 : 1857                		mov 	r5,@(mchnsnd_pitch,r8)
(2)   98/ 6000D88 : 1869                		mov 	r6,@(mchnsnd_vol,r8)
(2)   99/ 6000D8A : 1878                		mov 	r7,@(mchnsnd_flags,r8)
(2)  100/ 6000D8C : 6023                		mov 	r2,r0				; Set MSB
(2)  101/ 6000D8E : D92F                		mov 	#$FF000000,r9
(2)  102/ 6000D90 : 2099                		and 	r9,r0
(2)  103/ 6000D92 : 1803                		mov 	r0,@(mchnsnd_bank,r8)
(2)  104/ 6000D94 : 6043                		mov 	r4,r0				; Set POINTS
(2)  105/ 6000D96 : 88FF                		cmp/eq	#-1,r0
(2)  106/ 6000D98 : 8900                		bt	.endmrk
(2)  107/ 6000D9A : 4018                		shll8	r0
(2)  108/ 6000D9C :                     .endmrk:
(2)  109/ 6000D9C : 1806                		mov	r0,@(mchnsnd_loop,r8)
(2)  110/ 6000D9E : 6033                		mov 	r3,r0
(2)  111/ 6000DA0 : 4018                		shll8	r0
(2)  112/ 6000DA2 : 1805                		mov	r0,@(mchnsnd_end,r8)
(2)  113/ 6000DA4 : 6023                		mov 	r2,r0
(2)  114/ 6000DA6 : 4018                		shll8	r0
(2)  115/ 6000DA8 : 1804                		mov 	r0,@(mchnsnd_start,r8)
(2)  116/ 6000DAA : 1801                		mov 	r0,@(mchnsnd_read,r8)
(2)  117/ 6000DAC : E001                		mov 	#1,r0
(2)  118/ 6000DAE : 1800                		mov 	r0,@(mchnsnd_enbl,r8)
(2)  119/ 6000DB0 : 000B                		rts
(2)  120/ 6000DB2 : 0009                		nop
(2)  121/ 6000DB4 :                     		align 4
(2)  122/ 6000DB4 :                     
(2)  123/ 6000DB4 :                     ; --------------------------------------------------------
(2)  124/ 6000DB4 :                     ; MarsSound_MulPwmPitch
(2)  125/ 6000DB4 :                     ;
(2)  126/ 6000DB4 :                     ; Set pitch data to 8 consecutive sound channels
(2)  127/ 6000DB4 :                     ; starting from specific slot
(2)  128/ 6000DB4 :                     ;
(2)  129/ 6000DB4 :                     ; Input:
(2)  130/ 6000DB4 :                     ; r1 | Channel slot
(2)  131/ 6000DB4 :                     ; r2 | Pitch data
(2)  132/ 6000DB4 :                     ;
(2)  133/ 6000DB4 :                     ; Uses:
(2)  134/ 6000DB4 :                     ; r8
(2)  135/ 6000DB4 :                     ; --------------------------------------------------------
(2)  136/ 6000DB4 :                     
(2)  137/ 6000DB4 :                     MarsSound_SetPwmPitch:
(2)  138/ 6000DB4 : D826                		mov	#MarsSnd_PwmChnls,r8
(2)  139/ 6000DB6 : E028                		mov 	#sizeof_sndchn,r0
(2)  140/ 6000DB8 : 201E                		mulu	r1,r0
(2)  141/ 6000DBA : 001A                		sts	macl,r0
(2)  142/ 6000DBC : 380C                		add 	r0,r8
(2)  143/ 6000DBE : 5080                		mov	@(mchnsnd_enbl,r8),r0
(2)  144/ 6000DC0 : 8801                		cmp/eq	#1,r0
(2)  145/ 6000DC2 : 8B01                		bf	.off_1
(2)  146/ 6000DC4 : 5081                		mov	@(mchnsnd_read,r8),r0
(2)  147/ 6000DC6 : 1827                		mov	r2,@(mchnsnd_pitch,r8)
(2)  148/ 6000DC8 :                     .off_1:
(2)  149/ 6000DC8 : 000B                		rts
(2)  150/ 6000DCA : 0009                		nop
(2)  151/ 6000DCC :                     		align 4
(2)  152/ 6000DCC :                     
(2)  153/ 6000DCC :                     ; --------------------------------------------------------
(2)  154/ 6000DCC :                     ; MarsSound_SetVolume
(2)  155/ 6000DCC :                     ;
(2)  156/ 6000DCC :                     ; Input:
(2)  157/ 6000DCC :                     ; r1 | Channel slot
(2)  158/ 6000DCC :                     ; r2 | Volume data
(2)  159/ 6000DCC :                     ;
(2)  160/ 6000DCC :                     ; Uses:
(2)  161/ 6000DCC :                     ; r8
(2)  162/ 6000DCC :                     ; --------------------------------------------------------
(2)  163/ 6000DCC :                     
(2)  164/ 6000DCC :                     MarsSound_SetVolume:
(2)  165/ 6000DCC : D821                		mov	#MarsSnd_PwmChnls,r8
(2)  166/ 6000DCE : E028                		mov 	#sizeof_sndchn,r0
(2)  167/ 6000DD0 : 201E                		mulu	r1,r0
(2)  168/ 6000DD2 : 001A                		sts	macl,r0
(2)  169/ 6000DD4 : 380C                		add 	r0,r8
(2)  170/ 6000DD6 : 5080                		mov	@(mchnsnd_enbl,r8),r0
(2)  171/ 6000DD8 : 8801                		cmp/eq	#1,r0
(2)  172/ 6000DDA : 8B01                		bf	.off_1
(2)  173/ 6000DDC : 6023                		mov	r2,r0
(2)  174/ 6000DDE : 1809                		mov	r0,@(mchnsnd_vol,r8)
(2)  175/ 6000DE0 :                     .off_1:
(2)  176/ 6000DE0 : 000B                		rts
(2)  177/ 6000DE2 : 0009                		nop
(2)  178/ 6000DE4 :                     		align 4
(2)  179/ 6000DE4 :                     
(2)  180/ 6000DE4 :                     ; --------------------------------------------------------
(2)  181/ 6000DE4 :                     ; MarsSound_PwmEnable
(2)  182/ 6000DE4 :                     ;
(2)  183/ 6000DE4 :                     ; Turns ON or OFF Current PWM slot
(2)  184/ 6000DE4 :                     ;
(2)  185/ 6000DE4 :                     ; Input:
(2)  186/ 6000DE4 :                     ; r1 | Slot
(2)  187/ 6000DE4 :                     ; r2 | Enable/Disable
(2)  188/ 6000DE4 :                     ;
(2)  189/ 6000DE4 :                     ; Uses:
(2)  190/ 6000DE4 :                     ; r8
(2)  191/ 6000DE4 :                     ; --------------------------------------------------------
(2)  192/ 6000DE4 :                     
(2)  193/ 6000DE4 :                     MarsSound_PwmEnable:
(2)  194/ 6000DE4 : D81C                		mov	#MarsSnd_PwmChnls,r8
(2)  195/ 6000DE6 : E028                		mov 	#sizeof_sndchn,r0
(2)  196/ 6000DE8 : 201E                		mulu	r1,r0
(2)  197/ 6000DEA : 001A                		sts	macl,r0
(2)  198/ 6000DEC : 380C                		add 	r0,r8
(2)  199/ 6000DEE : 1820                		mov 	r2,@(mchnsnd_enbl,r8)
(2)  200/ 6000DF0 :                     ; 		mov 	#0,r0
(2)  201/ 6000DF0 :                     ; 		mov 	r0,@(mchnsnd_read,r8)
(2)  202/ 6000DF0 :                     ; 		mov 	r0,@(mchnsnd_bank,r8)
(2)  203/ 6000DF0 : 000B                		rts
(2)  204/ 6000DF2 : 0009                		nop
(2)  205/ 6000DF4 :                     		align 4
(2)  206/ 6000DF4 :                     
(2)  207/ 6000DF4 :                     ; --------------------------------------------------------
(2)  208/ 6000DF4 :                     ; MarsSound_Refill
(2)  209/ 6000DF4 :                     ;
(2)  210/ 6000DF4 :                     ; Uses:
(2)  211/ 6000DF4 :                     ; r1-r8
(2)  212/ 6000DF4 :                     ; --------------------------------------------------------
(2)  213/ 6000DF4 :                     
(2)  214/ 6000DF4 :                     ; The trick here is to keep PWM interrupt enabled while
(2)  215/ 6000DF4 :                     ; filling the backup data
(2)  216/ 6000DF4 :                     
(2)  217/ 6000DF4 :                     MarsSnd_Refill:
(2)  218/ 6000DF4 : D819                		mov	#MarsSnd_PwmChnls,r8
(2)  219/ 6000DF6 : E607                		mov	#MAX_PWMCHNL,r6
(2)  220/ 6000DF8 : E728                		mov	#sizeof_sndchn,r7
(2)  221/ 6000DFA : D519                		mov	#MarsSnd_PwmCache,r5
(2)  222/ 6000DFC :                     .next_one:
(2)  223/ 6000DFC : 5080                		mov	@(mchnsnd_enbl,r8),r0	; Finished already?
(2)  224/ 6000DFE : 8801                		cmp/eq	#1,r0
(2)  225/ 6000E00 : 8B19                		bf	.not_enbl
(2)  226/ 6000E02 : 5083                		mov	@(mchnsnd_bank,r8),r0
(2)  227/ 6000E04 : D217                		mov	#CS1,r2
(2)  228/ 6000E06 : 3020                		cmp/eq	r2,r0
(2)  229/ 6000E08 : 8B15                		bf	.not_enbl
(2)  230/ 6000E0A : E100                		mov	#0,r1
(2)  231/ 6000E0C : 1812                		mov	r1,@(mchnsnd_cchread,r8)
(2)  232/ 6000E0E : 6153                		mov	r5,r1
(2)  233/ 6000E10 : E220                		mov	#$80/4,r2
(2)  234/ 6000E12 : 5481                		mov	@(mchnsnd_read,r8),r4	; r4 - OLD READ pos
(2)  235/ 6000E14 : 6343                		mov	r4,r3
(2)  236/ 6000E16 : 4319                		shlr8	r3
(2)  237/ 6000E18 : 330C                		add	r0,r3
(2)  238/ 6000E1A :                     .copy_now:
(2)  239/ 6000E1A : 6034                		mov.b	@r3+,r0
(2)  240/ 6000E1C : 2100                		mov.b	r0,@r1
(2)  241/ 6000E1E : 7101                		add	#1,r1
(2)  242/ 6000E20 : 6034                		mov.b	@r3+,r0
(2)  243/ 6000E22 : 2100                		mov.b	r0,@r1
(2)  244/ 6000E24 : 7101                		add	#1,r1
(2)  245/ 6000E26 : 6034                		mov.b	@r3+,r0
(2)  246/ 6000E28 : 2100                		mov.b	r0,@r1
(2)  247/ 6000E2A : 7101                		add	#1,r1
(2)  248/ 6000E2C : 6034                		mov.b	@r3+,r0
(2)  249/ 6000E2E : 2100                		mov.b	r0,@r1
(2)  250/ 6000E30 : 4210                		dt	r2
(2)  251/ 6000E32 : 8FF2                		bf/s	.copy_now
(2)  252/ 6000E34 : 7101                		add	#1,r1
(2)  253/ 6000E36 :                     .not_enbl:
(2)  254/ 6000E36 : 9019                		mov	#$80,r0
(2)  255/ 6000E38 : 350C                		add	r0,r5
(2)  256/ 6000E3A : 4610                		dt	r6
(2)  257/ 6000E3C : 8FDE                		bf/s	.next_one
(2)  258/ 6000E3E : 387C                		add	r7,r8
(2)  259/ 6000E40 : 000B                		rts
(2)  260/ 6000E42 : 0009                		nop
(2)  261/ 6000E44 :                     		align 4
(2)  262/ 6000E44 : 2000 4000 C000 0000 		ltorg
                    FF00 0000 C000 0000 
                    C000 0000 C000 0000 
                    C000 0000 2601 6CC8 
                    0200 0000 0105 0415 
                    0080                
(2)  263/ 6000E6E :                     
(2)  264/ 6000E6E :                     ; ====================================================================
(2)  265/ 6000E6E :                     
(2)  266/ 6000E6E :                     		ltorg			; Save literals
(2)  267/ 6000E6E :                     
(1)  909/ 6000E6E :                     		align 4
(1)  910/ 6000E70 :                     
(1)  911/ 6000E70 :                     ; ====================================================================
(1)  912/ 6000E70 :                     ; ----------------------------------------------------------------
(1)  913/ 6000E70 :                     ; Master entry
(1)  914/ 6000E70 :                     ; ----------------------------------------------------------------
(1)  915/ 6000E70 :                     
(1)  916/ 6000E70 :                     		align 4
(1)  917/ 6000E70 :                     SH2_M_Entry:
(1)  918/ 6000E70 : 9E58                		mov.l	#$FFFFFE10,r14
(1)  919/ 6000E72 : E000                		mov	#0,r0
(1)  920/ 6000E74 : 80E0                		mov.b	r0,@(0,r14)
(1)  921/ 6000E76 : E0E2                		mov	#$FFFFFFE2,r0
(1)  922/ 6000E78 : 80E7                		mov.b	r0,@(7,r14)
(1)  923/ 6000E7A : E000                		mov	#0,r0
(1)  924/ 6000E7C : 80E4                		mov.b	r0,@(4,r14)
(1)  925/ 6000E7E : E001                		mov	#1,r0
(1)  926/ 6000E80 : 80E5                		mov.b	r0,@(5,r14)
(1)  927/ 6000E82 : E000                		mov	#0,r0
(1)  928/ 6000E84 : 80E6                		mov.b	r0,@(6,r14)
(1)  929/ 6000E86 : E001                		mov	#1,r0
(1)  930/ 6000E88 : 80E1                		mov.b	r0,@(1,r14)
(1)  931/ 6000E8A : E000                		mov	#0,r0
(1)  932/ 6000E8C : 80E3                		mov.b	r0,@(3,r14)
(1)  933/ 6000E8E : 80E2                		mov.b	r0,@(2,r14)
(1)  934/ 6000E90 : E0F2                		mov	#$FFFFFFF2,r0
(1)  935/ 6000E92 : 80E7                		mov.b	r0,@(7,r14)
(1)  936/ 6000E94 : E000                		mov	#0,r0
(1)  937/ 6000E96 : 80E4                		mov.b	r0,@(4,r14)
(1)  938/ 6000E98 : E001                		mov	#1,r0
(1)  939/ 6000E9A : 80E5                		mov.b	r0,@(5,r14)
(1)  940/ 6000E9C : E0E2                		mov	#$FFFFFFE2,r0
(1)  941/ 6000E9E : 80E7                		mov.b	r0,@(7,r14)
(1)  942/ 6000EA0 : 9041                		mov.l   #$FFFFFEE2,r0			; Watchdog: Set interrupt priority bits (IPRA)
(1)  943/ 6000EA2 : E150                		mov     #%0101<<4,r1
(1)  944/ 6000EA4 : 2011                		mov.w   r1,@r0
(1)  945/ 6000EA6 : 903F                		mov.l   #$FFFFFEE4,r0
(1)  946/ 6000EA8 : E148                		mov     #$120/4,r1			; Watchdog: Set jump pointer: VBR + (this/4) (WITV)
(1)  947/ 6000EAA : 4118                		shll8   r1
(1)  948/ 6000EAC : 2011                		mov.w   r1,@r0
(1)  949/ 6000EAE : 913C                		mov.l	#_CCR,r1
(1)  950/ 6000EB0 : E010                		mov	#$10,r0
(1)  951/ 6000EB2 : 2101                		mov.w	r0,@r1
(1)  952/ 6000EB4 : E009                		mov	#$09,r0
(1)  953/ 6000EB6 : 2101                		mov.w	r0,@r1
(1)  954/ 6000EB8 : D113                		mov 	#CACHE_MASTER,r1		; Transfer Master's "fast code" to CACHE
(1)  955/ 6000EBA : D214                		mov 	#$C0000000,r2
(1)  956/ 6000EBC : 9336                		mov 	#(CACHE_MASTER_E-CACHE_MASTER)/4,r3
(1)  957/ 6000EBE :                     .copy:
(1)  958/ 6000EBE : 6016                		mov 	@r1+,r0
(1)  959/ 6000EC0 : 2202                		mov 	r0,@r2
(1)  960/ 6000EC2 : 4310                		dt	r3
(1)  961/ 6000EC4 : 8FFB                		bf/s	.copy
(1)  962/ 6000EC6 : 7204                		add 	#4,r2
(1)  963/ 6000EC8 : D011                		mov	#MarsVideo_Init,r0		; Init Video
(1)  964/ 6000ECA : 400B                		jsr	@r0
(1)  965/ 6000ECC : 0009                		nop
(1)  966/ 6000ECE : D111                		mov	#_sysreg,r1
(1)  967/ 6000ED0 : E002                		mov	#CMDIRQ_ON,r0			; Enable usage of these interrupts
(1)  968/ 6000ED2 : 8011                    		mov.b	r0,@(intmask,r1)
(1)  969/ 6000ED4 :                     .wait_md:
(1)  970/ 6000ED4 :                     ; 		mov 	#_sysreg+comm12,r2
(1)  971/ 6000ED4 :                     ; 		mov.w	@r2,r0
(1)  972/ 6000ED4 :                     ; 		cmp/eq	#0,r0
(1)  973/ 6000ED4 :                     ; 		bf	.wait_md
(1)  974/ 6000ED4 :                     
(1)  975/ 6000ED4 :                     ; ====================================================================
(1)  976/ 6000ED4 :                     ; ----------------------------------------------------------------
(1)  977/ 6000ED4 :                     ; Master main code
(1)  978/ 6000ED4 :                     ;
(1)  979/ 6000ED4 :                     ; This CPU is exclusively used for Visual tasks:
(1)  980/ 6000ED4 :                     ; Background, Sprites and Polygons.
(1)  981/ 6000ED4 :                     ; ----------------------------------------------------------------
(1)  982/ 6000ED4 :                     
(1)  983/ 6000ED4 :                     SH2_M_HotStart:
(1)  984/ 6000ED4 : 902B                		mov	#$F0,r0				; Interrupts OFF
(1)  985/ 6000ED6 : 400E                		ldc	r0,sr
(1)  986/ 6000ED8 : 912A                		mov	#$FFFFFE80,r1
(1)  987/ 6000EDA : 902A                		mov.w	#$A518,r0			; Disable Watchdog
(1)  988/ 6000EDC : 2101                		mov.w	r0,@r1
(1)  989/ 6000EDE : DF0E                		mov	#CS3|$40000,r15			; Set default Stack for Master
(1)  990/ 6000EE0 : DE0E                		mov	#RAM_Mars_Global,r14		; GBR - Global values/variables go here.
(1)  991/ 6000EE2 : 4E1E                		ldc	r14,gbr
(1)  992/ 6000EE4 : DE0B                		mov	#$20004000,r14
(1)  993/ 6000EE6 : E000                		mov	#0,r0
(1)  994/ 6000EE8 : 81EA                		mov.w	r0,@($14,r14)
(1)  995/ 6000EEA : 81EB                		mov.w	r0,@($16,r14)
(1)  996/ 6000EEC : 81EC                		mov.w	r0,@($18,r14)
(1)  997/ 6000EEE : 81ED                		mov.w	r0,@($1A,r14)
(1)  998/ 6000EF0 : D10B                		mov	#RAM_Mars_DreqRead,r1		; Clear DREQ output
(1)  999/ 6000EF2 : 921F                		mov	#sizeof_dreq/4,r2		; NOTE: copying as 4bytes
(1) 1000/ 6000EF4 : E000                		mov	#0,r0
(1) 1001/ 6000EF6 :                     .clrram:
(1) 1002/ 6000EF6 : 2102                		mov	r0,@r1
(1) 1003/ 6000EF8 : 4210                		dt	r2
(1) 1004/ 6000EFA : 8FFC                		bf/s	.clrram
(1) 1005/ 6000EFC : 7104                		add	#4,r1
(1) 1006/ 6000EFE : E020                		mov	#$20,r0				; Interrupts ON
(1) 1007/ 6000F00 : 400E                		ldc	r0,sr
(1) 1008/ 6000F02 : A018                		bra	master_loop
(1) 1009/ 6000F04 : 0009                		nop
(1) 1010/ 6000F06 :                     		align 4
(1) 1011/ 6000F08 : 0600 1504 C000 0000 		ltorg
                    0600 06DC 2000 4000 
                    0604 0000 2600 A590 
                    2600 A160 FE10 FEE2 
                    FEE4 FE92 01A9 00F0 
                    FE80 A518 010C      
(1) 1012/ 6000F36 :                     
(1) 1013/ 6000F36 :                     ; ----------------------------------------------------------------
(1) 1014/ 6000F36 :                     ; MASTER Loop
(1) 1015/ 6000F36 :                     ; ----------------------------------------------------------------
(1) 1016/ 6000F36 :                     
(1) 1017/ 6000F36 :                     master_loop:
(1) 1018/ 6000F36 : D155                		mov	#_sysreg+comm0,r1		; DEBUG counter
(1) 1019/ 6000F38 : 6010                		mov.b	@r1,r0
(1) 1020/ 6000F3A : 7001                		add	#1,r0
(1) 1021/ 6000F3C : 2100                		mov.b	r0,@r1
(1) 1022/ 6000F3E :                     
(1) 1023/ 6000F3E :                     	; ---------------------------------------
(1) 1024/ 6000F3E :                     	; Wait frameswap
(1) 1025/ 6000F3E : D154                		mov	#_vdpreg,r1			; r1 - SVDP area
(1) 1026/ 6000F40 : 8515                .wait_fb:	mov.w	@(vdpsts,r1),r0			; SVDP FILL active?
(1) 1027/ 6000F42 : C802                		tst	#%10,r0
(1) 1028/ 6000F44 : 8BFC                		bf	.wait_fb
(1) 1029/ 6000F46 : 841B                		mov.b	@(framectl,r1),r0		; Framebuffer swap REQUEST.
(1) 1030/ 6000F48 : CA01                		xor	#1,r0				; manually Wait for VBlank after this
(1) 1031/ 6000F4A : 801B                		mov.b	r0,@(framectl,r1)
(1) 1032/ 6000F4C : 6203                		mov	r0,r2
(1) 1033/ 6000F4E : 841B                .wait_frmswp:	mov.b	@(framectl,r1),r0		; Framebuffer ready?
(1) 1034/ 6000F50 : 3200                		cmp/eq	r0,r2
(1) 1035/ 6000F52 : 8BFC                		bf	.wait_frmswp
(1) 1036/ 6000F54 : 4F03                		stc	sr,@-r15			; Interrupts OFF
(1) 1037/ 6000F56 : 90A9                		mov	#$F0,r0
(1) 1038/ 6000F58 : 400E                		ldc	r0,sr
(1) 1039/ 6000F5A :                     
(1) 1040/ 6000F5A :                     	; ---------------------------------------
(1) 1041/ 6000F5A :                     	; New frame is now shown on screen but
(1) 1042/ 6000F5A :                     	; we are still on VBlank
(1) 1043/ 6000F5A :                     	; ---------------------------------------
(1) 1044/ 6000F5A :                     
(1) 1045/ 6000F5A : C512                 		mov.w	@(marsGbl_XShift,gbr),r0	; Set SHIFT bit first
(1) 1046/ 6000F5C : D14D                		mov	#_vdpreg+shift,r1		; For the indexed-scrolling
(1) 1047/ 6000F5E : C901                		and	#1,r0
(1) 1048/ 6000F60 : 2101                		mov.w	r0,@r1
(1) 1049/ 6000F62 : D14B                		mov	#_vdpreg,r1
(1) 1050/ 6000F64 : 841A                .wait:		mov.b	@(vdpsts,r1),r0
(1) 1051/ 6000F66 : C920                		and	#$20,r0
(1) 1052/ 6000F68 : 2008                		tst	r0,r0				; Palette unlocked?
(1) 1053/ 6000F6A : 89FB                		bt	.wait
(1) 1054/ 6000F6C : D14A                		mov	#RAM_Mars_DreqRead+Dreq_Palette,r1
(1) 1055/ 6000F6E : D24B                		mov	#_palette,r2
(1) 1056/ 6000F70 : E310                 		mov	#256/16,r3
(1) 1057/ 6000F72 :                     .copy_pal:
(1) 1058/ 6000F72 :                     	rept 16
(1) 1059/ 6000F72 :                     		mov.w	@r1+,r0
(1) 1060/ 6000F72 :                     		mov.w	r0,@r2
(1) 1061/ 6000F72 :                     		add	#2,r2
(1) 1062/ 6000F72 :                     	endm
(1) 1059/ 6000F72 : 6015                		mov.w	@r1+,r0
(1) 1060/ 6000F74 : 2201                		mov.w	r0,@r2
(1) 1061/ 6000F76 : 7202                		add	#2,r2
(1) 1059/ 6000F78 : 6015                		mov.w	@r1+,r0
(1) 1060/ 6000F7A : 2201                		mov.w	r0,@r2
(1) 1061/ 6000F7C : 7202                		add	#2,r2
(1) 1059/ 6000F7E : 6015                		mov.w	@r1+,r0
(1) 1060/ 6000F80 : 2201                		mov.w	r0,@r2
(1) 1061/ 6000F82 : 7202                		add	#2,r2
(1) 1059/ 6000F84 : 6015                		mov.w	@r1+,r0
(1) 1060/ 6000F86 : 2201                		mov.w	r0,@r2
(1) 1061/ 6000F88 : 7202                		add	#2,r2
(1) 1059/ 6000F8A : 6015                		mov.w	@r1+,r0
(1) 1060/ 6000F8C : 2201                		mov.w	r0,@r2
(1) 1061/ 6000F8E : 7202                		add	#2,r2
(1) 1059/ 6000F90 : 6015                		mov.w	@r1+,r0
(1) 1060/ 6000F92 : 2201                		mov.w	r0,@r2
(1) 1061/ 6000F94 : 7202                		add	#2,r2
(1) 1059/ 6000F96 : 6015                		mov.w	@r1+,r0
(1) 1060/ 6000F98 : 2201                		mov.w	r0,@r2
(1) 1061/ 6000F9A : 7202                		add	#2,r2
(1) 1059/ 6000F9C : 6015                		mov.w	@r1+,r0
(1) 1060/ 6000F9E : 2201                		mov.w	r0,@r2
(1) 1061/ 6000FA0 : 7202                		add	#2,r2
(1) 1059/ 6000FA2 : 6015                		mov.w	@r1+,r0
(1) 1060/ 6000FA4 : 2201                		mov.w	r0,@r2
(1) 1061/ 6000FA6 : 7202                		add	#2,r2
(1) 1059/ 6000FA8 : 6015                		mov.w	@r1+,r0
(1) 1060/ 6000FAA : 2201                		mov.w	r0,@r2
(1) 1061/ 6000FAC : 7202                		add	#2,r2
(1) 1059/ 6000FAE : 6015                		mov.w	@r1+,r0
(1) 1060/ 6000FB0 : 2201                		mov.w	r0,@r2
(1) 1061/ 6000FB2 : 7202                		add	#2,r2
(1) 1059/ 6000FB4 : 6015                		mov.w	@r1+,r0
(1) 1060/ 6000FB6 : 2201                		mov.w	r0,@r2
(1) 1061/ 6000FB8 : 7202                		add	#2,r2
(1) 1059/ 6000FBA : 6015                		mov.w	@r1+,r0
(1) 1060/ 6000FBC : 2201                		mov.w	r0,@r2
(1) 1061/ 6000FBE : 7202                		add	#2,r2
(1) 1059/ 6000FC0 : 6015                		mov.w	@r1+,r0
(1) 1060/ 6000FC2 : 2201                		mov.w	r0,@r2
(1) 1061/ 6000FC4 : 7202                		add	#2,r2
(1) 1059/ 6000FC6 : 6015                		mov.w	@r1+,r0
(1) 1060/ 6000FC8 : 2201                		mov.w	r0,@r2
(1) 1061/ 6000FCA : 7202                		add	#2,r2
(1) 1059/ 6000FCC : 6015                		mov.w	@r1+,r0
(1) 1060/ 6000FCE : 2201                		mov.w	r0,@r2
(1) 1061/ 6000FD0 : 7202                		add	#2,r2
(1) 1063/ 6000FD2 : 4310                		dt	r3
(1) 1064/ 6000FD4 : 8BCD                		bf	.copy_pal
(1) 1065/ 6000FD6 :                     
(1) 1066/ 6000FD6 :                     	; ---------------------------------------
(1) 1067/ 6000FD6 :                     	; Mode-specific VBlank changes
(1) 1068/ 6000FD6 :                     
(1) 1069/ 6000FD6 : D132                		mov	#.list+8,r1		; Point to VBLANK jumps
(1) 1070/ 6000FD8 : D232                		mov	#_sysreg+comm12,r2
(1) 1071/ 6000FDA : 6021                		mov.w	@r2,r0			; r0 - INIT bit
(1) 1072/ 6000FDC : C907                		and	#%111,r0
(1) 1073/ 6000FDE : 4008                		shll2	r0
(1) 1074/ 6000FE0 : 4008                		shll2	r0
(1) 1075/ 6000FE2 : 011E                		mov	@(r1,r0),r1
(1) 1076/ 6000FE4 : 410B                		jsr	@r1
(1) 1077/ 6000FE6 : 0009                		nop
(1) 1078/ 6000FE8 :                     
(1) 1079/ 6000FE8 :                     	; ---------------------------------------
(1) 1080/ 6000FE8 :                     
(1) 1081/ 6000FE8 : 4F07                		ldc	@r15+,sr		; Interrupts ON
(1) 1082/ 6000FEA :                     
(1) 1083/ 6000FEA :                     ; ---------------------------------------
(1) 1084/ 6000FEA :                     ; Pick graphics mode on comm12
(1) 1085/ 6000FEA :                     ; ---------------------------------------
(1) 1086/ 6000FEA :                     
(1) 1087/ 6000FEA : D32F                		mov	#.list,r3		; Default LOOP points
(1) 1088/ 6000FEC : D22D                		mov	#_sysreg+comm12,r2
(1) 1089/ 6000FEE : 6021                		mov.w	@r2,r0			; r0 - INIT bit
(1) 1090/ 6000FF0 : 6103                		mov	r0,r1			; r1 - mode
(1) 1091/ 6000FF2 : C880                		tst	#$80,r0			; First time/Full redraw?
(1) 1092/ 6000FF4 : 8902                		bt	.no_init
(1) 1093/ 6000FF6 : C97F                		and	#$7F,r0			; Reset bit after this.
(1) 1094/ 6000FF8 : 2201                		mov.w	r0,@r2
(1) 1095/ 6000FFA : 7304                		add	#4,r3			; Grab the INIT jumps
(1) 1096/ 6000FFC :                     .no_init:
(1) 1097/ 6000FFC : 6013                		mov	r1,r0
(1) 1098/ 6000FFE : C907                		and	#%111,r0
(1) 1099/ 6001000 : 4008                		shll2	r0
(1) 1100/ 6001002 : 4008                		shll2	r0
(1) 1101/ 6001004 : 033E                		mov	@(r3,r0),r3
(1) 1102/ 6001006 : 432B                		jmp	@r3
(1) 1103/ 6001008 : 0009                		nop
(1) 1104/ 600100A :                     		align 4
(1) 1105/ 600100C :                     
(1) 1106/ 600100C :                     .list:
(1) 1107/ 600100C : 0600 10BC 0600 10B6 	dc.l mstr_gfx0,mstr_gfx0_init,mstr_gfx0_vblk,mstr_gfx0_hblk
                    0600 10B2 0600 10AE 
(1) 1108/ 600101C : 0600 10CE 0600 10C8 	dc.l mstr_gfx1,mstr_gfx1_init,mstr_gfx1_vblk,mstr_gfx1_hblk
                    0600 10C4 0600 10C0 
(1) 1109/ 600102C : 0600 111E 0600 10EC 	dc.l mstr_gfx2,mstr_gfx2_init,mstr_gfx2_vblk,mstr_gfx2_hblk
                    0600 10D6 0600 10D2 
(1) 1110/ 600103C : 0600 11C6 0600 11BE 	dc.l mstr_gfx3,mstr_gfx3_init,mstr_gfx3_vblk,mstr_gfx3_hblk
                    0600 11A4 0600 11A0 
(1) 1111/ 600104C :                     
(1) 1112/ 600104C : 0600 12A8 0600 12A0 	dc.l mstr_gfx4,mstr_gfx4_init,mstr_gfx4_vblk,mstr_gfx4_hblk
                    0600 1276 0600 1272 
(1) 1113/ 600105C : 0600 10BC 0600 10B6 	dc.l mstr_gfx0,mstr_gfx0_init,mstr_gfx0_vblk,mstr_gfx0_hblk
                    0600 10B2 0600 10AE 
(1) 1114/ 600106C : 0600 10BC 0600 10B6 	dc.l mstr_gfx0,mstr_gfx0_init,mstr_gfx0_vblk,mstr_gfx0_hblk
                    0600 10B2 0600 10AE 
(1) 1115/ 600107C : 0600 10BC 0600 10B6 	dc.l mstr_gfx0,mstr_gfx0_init,mstr_gfx0_vblk,mstr_gfx0_hblk
                    0600 10B2 0600 10AE 
(1) 1116/ 600108C :                     
(1) 1117/ 600108C : 2000 4020 2000 4100 	ltorg
                    2000 4102 2600 A190 
                    2000 4200 0600 1014 
                    2000 402C 0600 100C 
                    00F0                
(1) 1118/ 60010AE :                     
(1) 1119/ 60010AE :                     ; ============================================================
(1) 1120/ 60010AE :                     ; ---------------------------------------
(1) 1121/ 60010AE :                     ; Mode 0: BLANK, nothing.
(1) 1122/ 60010AE :                     ; ---------------------------------------
(1) 1123/ 60010AE :                     
(1) 1124/ 60010AE :                     mstr_gfx0_hblk:
(1) 1125/ 60010AE : 000B                		rts
(1) 1126/ 60010B0 : 0009                		nop
(1) 1127/ 60010B2 :                     mstr_gfx0_vblk:
(1) 1128/ 60010B2 : 000B                		rts
(1) 1129/ 60010B4 : 0009                		nop
(1) 1130/ 60010B6 :                     mstr_gfx0_init:
(1) 1131/ 60010B6 : D12C                		mov 	#_vdpreg,r1
(1) 1132/ 60010B8 : E000                		mov	#0,r0
(1) 1133/ 60010BA : 8011                		mov.b	r0,@(bitmapmd,r1)
(1) 1134/ 60010BC :                     mstr_gfx0:
(1) 1135/ 60010BC : AF3B                		bra	master_loop
(1) 1136/ 60010BE : 0009                		nop
(1) 1137/ 60010C0 :                     
(1) 1138/ 60010C0 :                     ; ============================================================
(1) 1139/ 60010C0 :                     ; ---------------------------------------
(1) 1140/ 60010C0 :                     ; Mode 1:
(1) 1141/ 60010C0 :                     ; Generic static screen in any
(1) 1142/ 60010C0 :                     ; bitmap mode: Indexed, Direct or RLE
(1) 1143/ 60010C0 :                     ;
(1) 1144/ 60010C0 :                     ; Direct's HEIGHT will be limited
(1) 1145/ 60010C0 :                     ; to 200 lines.
(1) 1146/ 60010C0 :                     ; ---------------------------------------
(1) 1147/ 60010C0 :                     
(1) 1148/ 60010C0 :                     mstr_gfx1_hblk:
(1) 1149/ 60010C0 : 000B                		rts
(1) 1150/ 60010C2 : 0009                		nop
(1) 1151/ 60010C4 :                     mstr_gfx1_vblk:
(1) 1152/ 60010C4 : 000B                		rts
(1) 1153/ 60010C6 : 0009                		nop
(1) 1154/ 60010C8 :                     mstr_gfx1_init:
(1) 1155/ 60010C8 : D127                		mov 	#_vdpreg,r1
(1) 1156/ 60010CA : E000                		mov	#0,r0
(1) 1157/ 60010CC : 8011                		mov.b	r0,@(bitmapmd,r1)
(1) 1158/ 60010CE :                     mstr_gfx1:
(1) 1159/ 60010CE : AF32                		bra	master_loop
(1) 1160/ 60010D0 : 0009                		nop
(1) 1161/ 60010D2 :                     
(1) 1162/ 60010D2 :                     ; ============================================================
(1) 1163/ 60010D2 :                     ; ---------------------------------------
(1) 1164/ 60010D2 :                     ; Mode 2: 256-color scrolling image
(1) 1165/ 60010D2 :                     ;
(1) 1166/ 60010D2 :                     ; *** WAIT 2 FRAMES TO PROPERLY START
(1) 1167/ 60010D2 :                     ; THIS MODE WHEN SWITCHING ***
(1) 1168/ 60010D2 :                     ; ---------------------------------------
(1) 1169/ 60010D2 :                     
(1) 1170/ 60010D2 :                     mstr_gfx2_hblk:
(1) 1171/ 60010D2 : 000B                		rts
(1) 1172/ 60010D4 : 0009                		nop
(1) 1173/ 60010D6 :                     mstr_gfx2_vblk:
(1) 1174/ 60010D6 : C516                		mov.w	@(marsGbl_BgDrwAll,gbr),r0
(1) 1175/ 60010D8 : 2008                		tst	r0,r0
(1) 1176/ 60010DA : 8B05                		bf	.mid_draw
(1) 1177/ 60010DC : DE23                		mov	#RAM_Mars_BgBuffScrl,r14
(1) 1178/ 60010DE : DD24                		mov	#RAM_Mars_DreqRead+Dreq_BgEx_X,r13
(1) 1179/ 60010E0 : 61D6                		mov	@r13+,r1
(1) 1180/ 60010E2 : 62D6                		mov	@r13+,r2
(1) 1181/ 60010E4 : 1E1D                		mov	r1,@(mbg_xpos,r14)
(1) 1182/ 60010E6 : 1E2E                		mov	r2,@(mbg_ypos,r14)
(1) 1183/ 60010E8 :                     .mid_draw:
(1) 1184/ 60010E8 : 000B                		rts
(1) 1185/ 60010EA : 0009                		nop
(1) 1186/ 60010EC :                     mstr_gfx2_init:
(1) 1187/ 60010EC : E002                		mov	#2,r0
(1) 1188/ 60010EE : C116                		mov.w	r0,@(marsGbl_BgDrwAll,gbr)
(1) 1189/ 60010F0 : D120                		mov	#RAM_Mars_BgBuffScrl,r1
(1) 1190/ 60010F2 : 9251                		mov	#$200,r2
(1) 1191/ 60010F4 : E310                		mov	#16,r3
(1) 1192/ 60010F6 : 9450                		mov	#320,r4
(1) 1193/ 60010F8 : 9550                		mov	#256,r5
(1) 1194/ 60010FA : BE0A                		bsr	MarsVideo_MkScrlField
(1) 1195/ 60010FC : E600                		mov	#0,r6
(1) 1196/ 60010FE : D51E                		mov	#RAM_Mars_DreqRead+Dreq_BgEx_Data,r5
(1) 1197/ 6001100 : D11E                		mov	#RAM_Mars_BgBuffScrl,r1
(1) 1198/ 6001102 : 6256                		mov	@r5+,r2
(1) 1199/ 6001104 : 6356                		mov	@r5+,r3
(1) 1200/ 6001106 : 6456                		mov	@r5+,r4
(1) 1201/ 6001108 : BE18                		bsr	MarsVideo_SetBg
(1) 1202/ 600110A : 0009                		nop
(1) 1203/ 600110C : DE1C                		mov	#RAM_Mars_BgBuffScrl,r14
(1) 1204/ 600110E : DD1D                		mov	#RAM_Mars_DreqRead+Dreq_BgEx_X,r13
(1) 1205/ 6001110 : 61D6                		mov	@r13+,r1
(1) 1206/ 6001112 : 62D6                		mov	@r13+,r2
(1) 1207/ 6001114 : 1E1D                		mov	r1,@(mbg_xpos,r14)
(1) 1208/ 6001116 : 1E2E                		mov	r2,@(mbg_ypos,r14)
(1) 1209/ 6001118 : D113                		mov 	#_vdpreg,r1
(1) 1210/ 600111A : E001                		mov	#1,r0
(1) 1211/ 600111C : 8011                		mov.b	r0,@(bitmapmd,r1)
(1) 1212/ 600111E :                     
(1) 1213/ 600111E :                     mstr_gfx2:
(1) 1214/ 600111E : C516                		mov.w	@(marsGbl_BgDrwAll,gbr),r0
(1) 1215/ 6001120 : 8800                		cmp/eq	#0,r0
(1) 1216/ 6001122 : 890A                		bt	.no_redraw
(1) 1217/ 6001124 : 4010                		dt	r0
(1) 1218/ 6001126 : C116                		mov.w	r0,@(marsGbl_BgDrwAll,gbr)
(1) 1219/ 6001128 : BB12                		bsr	MarsVideo_DrawAllBg		; Process FULL image (only two times)
(1) 1220/ 600112A : 0009                		nop
(1) 1221/ 600112C : 200A                		xor	r0,r0
(1) 1222/ 600112E : C117                		mov.w	r0,@(marsGbl_BgDrwR,gbr)	; Cancel
(1) 1223/ 6001130 : C118                		mov.w	r0,@(marsGbl_BgDrwL,gbr)	; all
(1) 1224/ 6001132 : C119                		mov.w	r0,@(marsGbl_BgDrwU,gbr)	; these
(1) 1225/ 6001134 : C11A                		mov.w	r0,@(marsGbl_BgDrwD,gbr)	; draw requests
(1) 1226/ 6001136 : A00E                		bra	.from_drwall
(1) 1227/ 6001138 : 0009                		nop
(1) 1228/ 600113A :                     .no_redraw:
(1) 1229/ 600113A : DE13                		mov	#RAM_Mars_BgBuffScrl,r14
(1) 1230/ 600113C : 51ED                		mov	@(mbg_xpos,r14),r1
(1) 1231/ 600113E : 52EE                		mov	@(mbg_ypos,r14),r2
(1) 1232/ 6001140 : 6013                		mov	r1,r0
(1) 1233/ 6001142 : 4029                		shlr16	r0
(1) 1234/ 6001144 : C112                		mov.w	r0,@(marsGbl_XShift,gbr)
(1) 1235/ 6001146 : BC96                		bsr	MarsVideo_MoveBg
(1) 1236/ 6001148 : 0009                		nop
(1) 1237/ 600114A :                     
(1) 1238/ 600114A : D010                		mov	#MarsVideo_BgDrawLR,r0		; Process U/D/L/R
(1) 1239/ 600114C : 400B                		jsr	@r0
(1) 1240/ 600114E : 0009                		nop
(1) 1241/ 6001150 : D00F                		mov	#MarsVideo_BgDrawUD,r0
(1) 1242/ 6001152 : 400B                		jsr	@r0
(1) 1243/ 6001154 : 0009                		nop
(1) 1244/ 6001156 :                     .from_drwall:
(1) 1245/ 6001156 :                     
(1) 1246/ 6001156 :                     	; ---------------------------------------
(1) 1247/ 6001156 :                     	; Build linetable
(1) 1248/ 6001156 :                     	; ---------------------------------------
(1) 1249/ 6001156 : D10F                		mov	#RAM_Mars_BgBuffScrl,r1		; Make visible background
(1) 1250/ 6001158 : E200                		mov	#0,r2				; section on screen
(1) 1251/ 600115A : 9320                		mov	#224,r3
(1) 1252/ 600115C : BD88                		bsr	MarsVideo_MakeTbl
(1) 1253/ 600115E : 0009                		nop
(1) 1254/ 6001160 : BDAC                		bsr	MarsVideo_FixTblShift		; Fix those broken lines that
(1) 1255/ 6001162 : 0009                		nop					; the Xshift register can't move
(1) 1256/ 6001164 : AEE7                		bra	master_loop
(1) 1257/ 6001166 : 0009                		nop
(1) 1258/ 6001168 :                     		align 4
(1) 1259/ 6001168 : 2000 4100 2601 6C18 		ltorg
                    2600 A160 2601 6C18 
                    2600 A168 2601 6C18 
                    2601 6C18 2600 A160 
                    2601 6C18 0600 08AA 
                    0600 099C 2601 6C18 
                    0200 0140 0100 00E0 
(1) 1260/ 60011A0 :                     
(1) 1261/ 60011A0 :                     ; ============================================================
(1) 1262/ 60011A0 :                     ; ---------------------------------------
(1) 1263/ 60011A0 :                     ; Mode 3:
(1) 1264/ 60011A0 :                     ; Scalable 256-color screen, low FPS
(1) 1265/ 60011A0 :                     ; ---------------------------------------
(1) 1266/ 60011A0 :                     
(1) 1267/ 60011A0 :                     mstr_gfx3_hblk:
(1) 1268/ 60011A0 : 000B                		rts
(1) 1269/ 60011A2 : 0009                		nop
(1) 1270/ 60011A4 :                     mstr_gfx3_vblk:
(1) 1271/ 60011A4 : D169                		mov	#RAM_Mars_DreqRead+Dreq_SclData,r1	; Copy-paste scale buffer
(1) 1272/ 60011A6 : D26A                		mov	#RAM_Mars_BgBuffScale_M,r2
(1) 1273/ 60011A8 : D36A                		mov	#RAM_Mars_BgBuffScale_S,r3
(1) 1274/ 60011AA : E407                		mov	#7,r4
(1) 1275/ 60011AC :                     .copy_me:
(1) 1276/ 60011AC : 6016                		mov	@r1+,r0
(1) 1277/ 60011AE : 2202                		mov	r0,@r2
(1) 1278/ 60011B0 : 2302                		mov	r0,@r3
(1) 1279/ 60011B2 : 7204                		add	#4,r2
(1) 1280/ 60011B4 : 4410                		dt	r4
(1) 1281/ 60011B6 : 8FF9                		bf/s	.copy_me
(1) 1282/ 60011B8 : 7304                		add	#4,r3
(1) 1283/ 60011BA :                     ; 		mov.w	@r5,r0
(1) 1284/ 60011BA :                     ; 		or	#$01,r0		; Slave task $01
(1) 1285/ 60011BA :                     ; 		mov.w	r0,@r5
(1) 1286/ 60011BA : 000B                		rts
(1) 1287/ 60011BC : 0009                		nop
(1) 1288/ 60011BE :                     mstr_gfx3_init:
(1) 1289/ 60011BE : E002                		mov	#2,r0
(1) 1290/ 60011C0 : C116                		mov.w	r0,@(marsGbl_BgDrwAll,gbr)
(1) 1291/ 60011C2 : E000                		mov	#0,r0
(1) 1292/ 60011C4 : C112                		mov.w	r0,@(marsGbl_XShift,gbr)
(1) 1293/ 60011C6 :                     mstr_gfx3:
(1) 1294/ 60011C6 : C516                		mov.w	@(marsGbl_BgDrwAll,gbr),r0
(1) 1295/ 60011C8 : 8800                		cmp/eq	#0,r0
(1) 1296/ 60011CA : 890F                		bt	.no_redraw
(1) 1297/ 60011CC : 4010                		dt	r0
(1) 1298/ 60011CE : C116                		mov.w	r0,@(marsGbl_BgDrwAll,gbr)
(1) 1299/ 60011D0 : 4015                		cmp/pl	r0
(1) 1300/ 60011D2 : 8B02                		bf	.no_btmp
(1) 1301/ 60011D4 : D160                		mov 	#_vdpreg,r1
(1) 1302/ 60011D6 : E001                		mov	#1,r0
(1) 1303/ 60011D8 : 8011                		mov.b	r0,@(bitmapmd,r1)
(1) 1304/ 60011DA :                     .no_btmp:
(1) 1305/ 60011DA : D360                		mov	#_framebuffer,r3
(1) 1306/ 60011DC : 90D6                		mov	#$200/2,r0
(1) 1307/ 60011DE : 6103                		mov	r0,r1
(1) 1308/ 60011E0 : 94D5                		mov	#240,r4
(1) 1309/ 60011E2 :                     .nxt_lne:
(1) 1310/ 60011E2 : 2301                		mov.w	r0,@r3
(1) 1311/ 60011E4 :                     ; 		add	#2,r3
(1) 1312/ 60011E4 :                     ; 		mov.w	r0,@r3
(1) 1313/ 60011E4 : 301C                		add	r1,r0
(1) 1314/ 60011E6 : 4410                		dt	r4
(1) 1315/ 60011E8 : 8FFB                		bf/s	.nxt_lne
(1) 1316/ 60011EA : 7302                		add	#2,r3
(1) 1317/ 60011EC :                     .no_redraw:
(1) 1318/ 60011EC :                     
(1) 1319/ 60011EC :                     	; MAIN scaler
(1) 1320/ 60011EC :                     	; r1 - X pos xxxx.0000
(1) 1321/ 60011EC :                     	; r2 - Y pos yyyy.0000
(1) 1322/ 60011EC :                     	; r3 - X dx  xxxx.0000
(1) 1323/ 60011EC :                     	; r4 - Y dx  yyyy.0000
(1) 1324/ 60011EC :                     	; r5 - Source WIDTH
(1) 1325/ 60011EC :                     	; r6 - Source HEIGHT
(1) 1326/ 60011EC :                     	; r7 - Source DATA
(1) 1327/ 60011EC :                     	; r8 - Output
(1) 1328/ 60011EC :                     	; r9 - Loop: Line width / 2
(1) 1329/ 60011EC :                     	; r10 - Loop: Number of lines
(1) 1330/ 60011EC :                     
(1) 1331/ 60011EC : DE5C                		mov	#RAM_Mars_BgBuffScale_M,r14
(1) 1332/ 60011EE : 67E6                		mov	@r14+,r7		; r7 - Input
(1) 1333/ 60011F0 : 61E6                		mov	@r14+,r1		; r1 - X pos (2 pixels wide)
(1) 1334/ 60011F2 : 62E6                		mov	@r14+,r2		; r2 - Y pos
(1) 1335/ 60011F4 : 63E6                		mov	@r14+,r3		; r3 - DX
(1) 1336/ 60011F6 : 64E6                		mov	@r14+,r4		; r4 - DY
(1) 1337/ 60011F8 : 65E6                		mov	@r14+,r5		; r5 - X width
(1) 1338/ 60011FA : 66E6                		mov	@r14+,r6		; r6 - Y height
(1) 1339/ 60011FC : 4528                		shll16	r5
(1) 1340/ 60011FE : 4628                		shll16	r6
(1) 1341/ 6001200 : 351D                		dmuls	r1,r5			; Topleft X/Y calc
(1) 1342/ 6001202 : 000A                		sts	mach,r0
(1) 1343/ 6001204 : 011A                		sts	macl,r1
(1) 1344/ 6001206 : 210D                		xtrct	r0,r1
(1) 1345/ 6001208 : 362D                		dmuls	r2,r6
(1) 1346/ 600120A : 000A                		sts	mach,r0
(1) 1347/ 600120C : 021A                		sts	macl,r2
(1) 1348/ 600120E : 220D                		xtrct	r0,r2
(1) 1349/ 6001210 : D854                		mov	#_framebuffer+$200,r8	; r8 - Output
(1) 1350/ 6001212 : 99BD                		mov	#320/2,r9		; r9  - X loop
(1) 1351/ 6001214 : 9ABD                		mov	#224,r10		; r10 - Y loop
(1) 1352/ 6001216 :                     
(1) 1353/ 6001216 :                     .y_loop2:
(1) 1354/ 6001216 : 4111                		cmp/pz	r1
(1) 1355/ 6001218 : 8901                		bt	.y_add
(1) 1356/ 600121A : AFFC                		bra	.y_loop2
(1) 1357/ 600121C : 315C                		add	r5,r1
(1) 1358/ 600121E :                     .y_add:
(1) 1359/ 600121E :                     
(1) 1360/ 600121E :                     ; *** LOOP
(1) 1361/ 600121E :                     .y_loop:
(1) 1362/ 600121E : 4211                		cmp/pz	r2
(1) 1363/ 6001220 : 8901                		bt	.xy_set
(1) 1364/ 6001222 : AFFC                		bra	.y_loop
(1) 1365/ 6001224 : 326C                		add	r6,r2
(1) 1366/ 6001226 :                     .xy_set:
(1) 1367/ 6001226 : 3263                		cmp/ge	r6,r2
(1) 1368/ 6001228 : 8B01                		bf	.y_high
(1) 1369/ 600122A : AFF8                		bra	.y_loop
(1) 1370/ 600122C : 3268                		sub	r6,r2
(1) 1371/ 600122E :                     .y_high:
(1) 1372/ 600122E : 6B13                		mov	r1,r11
(1) 1373/ 6001230 : 4B01                		shlr	r11			; /2
(1) 1374/ 6001232 : 6023                		mov	r2,r0
(1) 1375/ 6001234 : 4029                		shlr16	r0
(1) 1376/ 6001236 : 6D53                		mov	r5,r13
(1) 1377/ 6001238 : 4D29                		shlr16	r13
(1) 1378/ 600123A : 20DF                		muls	r13,r0
(1) 1379/ 600123C : 0C1A                		sts	macl,r12
(1) 1380/ 600123E : 3C7C                		add	r7,r12
(1) 1381/ 6001240 : 6D83                		mov	r8,r13
(1) 1382/ 6001242 : 6E93                		mov	r9,r14
(1) 1383/ 6001244 :                     .x_loop:
(1) 1384/ 6001244 : 6053                		mov	r5,r0
(1) 1385/ 6001246 : 4021                		shar	r0		; /2
(1) 1386/ 6001248 : 3B03                		cmp/ge	r0,r11
(1) 1387/ 600124A : 8B01                		bf	.x_high
(1) 1388/ 600124C : AFFA                		bra	.x_loop
(1) 1389/ 600124E : 3B08                		sub	r0,r11
(1) 1390/ 6001250 :                     .x_high:
(1) 1391/ 6001250 : 60B3                		mov	r11,r0
(1) 1392/ 6001252 : 4029                		shlr16	r0
(1) 1393/ 6001254 : 600F                		exts	r0,r0
(1) 1394/ 6001256 : 4000                		shll	r0
(1) 1395/ 6001258 : 00CD                		mov.w	@(r12,r0),r0
(1) 1396/ 600125A : 3B3C                		add	r3,r11
(1) 1397/ 600125C : 2D01                		mov.w	r0,@r13
(1) 1398/ 600125E : 4E10                		dt	r14
(1) 1399/ 6001260 : 8FF0                		bf/s	.x_loop
(1) 1400/ 6001262 : 7D02                		add	#2,r13
(1) 1401/ 6001264 :                     
(1) 1402/ 6001264 : 324C                		add	r4,r2
(1) 1403/ 6001266 :                     ; 		add	r4,r2
(1) 1404/ 6001266 : 907E                		mov	#$200,r0
(1) 1405/ 6001268 : 4A10                		dt	r10
(1) 1406/ 600126A : 8FD8                		bf/s	.y_loop
(1) 1407/ 600126C : 380C                		add	r0,r8
(1) 1408/ 600126E :                     
(1) 1409/ 600126E :                     ; 		mov	#_sysreg+comm14,r5
(1) 1410/ 600126E :                     ; .wait_slv:	mov.w	@r5,r0
(1) 1411/ 600126E :                     ; 		and	#%01111111,r0
(1) 1412/ 600126E :                     ; 		tst	r0,r0
(1) 1413/ 600126E :                     ; 		bf	.wait_slv
(1) 1414/ 600126E :                     
(1) 1415/ 600126E :                     	; sprites will go here
(1) 1416/ 600126E :                     
(1) 1417/ 600126E : AE62                		bra	master_loop
(1) 1418/ 6001270 : 0009                		nop
(1) 1419/ 6001272 :                     
(1) 1420/ 6001272 :                     ; ============================================================
(1) 1421/ 6001272 :                     ; ---------------------------------------
(1) 1422/ 6001272 :                     ; Mode 4: 3D MODE Polygons-only
(1) 1423/ 6001272 :                     ; ---------------------------------------
(1) 1424/ 6001272 :                     
(1) 1425/ 6001272 :                     mstr_gfx4_hblk:
(1) 1426/ 6001272 : 000B                		rts
(1) 1427/ 6001274 : 0009                		nop
(1) 1428/ 6001276 :                     
(1) 1429/ 6001276 :                     mstr_gfx4_vblk:
(1) 1430/ 6001276 : D43C                		mov	#_sysreg+comm14,r4
(1) 1431/ 6001278 : 6041                		mov.w	@r4,r0
(1) 1432/ 600127A : C97F                		and	#%01111111,r0
(1) 1433/ 600127C : 2008                		tst	r0,r0
(1) 1434/ 600127E : 8B0D                		bf	.wait_slv
(1) 1435/ 6001280 : D13A                		mov	#RAM_Mars_DreqRead+Dreq_Objects,r1	; Copy Dreq models from here.
(1) 1436/ 6001282 : D23B                		mov	#RAM_Mars_Objects,r2
(1) 1437/ 6001284 : 9386                		mov	#(sizeof_mdlobj*MAX_MODELS)/4,r3
(1) 1438/ 6001286 :                     .copy_safe:
(1) 1439/ 6001286 : 6016                		mov	@r1+,r0
(1) 1440/ 6001288 : 2202                		mov	r0,@r2
(1) 1441/ 600128A : 4310                		dt	r3
(1) 1442/ 600128C : 8FFB                		bf/s	.copy_safe
(1) 1443/ 600128E : 7204                		add	#4,r2
(1) 1444/ 6001290 : C50F                		mov.w	@(marsGbl_PolyBuffNum,gbr),r0
(1) 1445/ 6001292 : CA01                		xor	#1,r0
(1) 1446/ 6001294 : C10F                		mov.w	r0,@(marsGbl_PolyBuffNum,gbr)
(1) 1447/ 6001296 : 6041                		mov.w	@r4,r0
(1) 1448/ 6001298 : CB02                		or	#$02,r0		; Slave task $02
(1) 1449/ 600129A : 2401                		mov.w	r0,@r4
(1) 1450/ 600129C :                     .wait_slv:
(1) 1451/ 600129C : 000B                		rts
(1) 1452/ 600129E : 0009                		nop
(1) 1453/ 60012A0 :                     
(1) 1454/ 60012A0 :                     mstr_gfx4_init:
(1) 1455/ 60012A0 : E002                		mov	#2,r0
(1) 1456/ 60012A2 : C116                		mov.w	r0,@(marsGbl_BgDrwAll,gbr)
(1) 1457/ 60012A4 : E000                		mov	#0,r0
(1) 1458/ 60012A6 : C112                		mov.w	r0,@(marsGbl_XShift,gbr)
(1) 1459/ 60012A8 :                     mstr_gfx4:
(1) 1460/ 60012A8 : C516                		mov.w	@(marsGbl_BgDrwAll,gbr),r0
(1) 1461/ 60012AA : 8800                		cmp/eq	#0,r0
(1) 1462/ 60012AC : 890F                		bt	.no_redraw
(1) 1463/ 60012AE : 4010                		dt	r0
(1) 1464/ 60012B0 : C116                		mov.w	r0,@(marsGbl_BgDrwAll,gbr)
(1) 1465/ 60012B2 : 4015                		cmp/pl	r0
(1) 1466/ 60012B4 : 8B02                		bf	.no_btmp
(1) 1467/ 60012B6 : D128                		mov 	#_vdpreg,r1
(1) 1468/ 60012B8 : E001                		mov	#1,r0
(1) 1469/ 60012BA : 8011                		mov.b	r0,@(bitmapmd,r1)
(1) 1470/ 60012BC :                     .no_btmp:
(1) 1471/ 60012BC : D327                		mov	#_framebuffer,r3
(1) 1472/ 60012BE : 9065                		mov	#$200/2,r0
(1) 1473/ 60012C0 : 6103                		mov	r0,r1
(1) 1474/ 60012C2 : 9464                		mov	#240,r4
(1) 1475/ 60012C4 :                     .nxt_lne:
(1) 1476/ 60012C4 : 2301                		mov.w	r0,@r3
(1) 1477/ 60012C6 : 301C                		add	r1,r0
(1) 1478/ 60012C8 : 4410                		dt	r4
(1) 1479/ 60012CA : 8FFB                		bf/s	.nxt_lne
(1) 1480/ 60012CC : 7302                		add	#2,r3
(1) 1481/ 60012CE :                     .no_redraw:
(1) 1482/ 60012CE :                     
(1) 1483/ 60012CE :                     	; ---------------------------------------
(1) 1484/ 60012CE :                     	; Prepare WATCHDOG interrupt
(1) 1485/ 60012CE : C50F                		mov.w   @(marsGbl_PolyBuffNum,gbr),r0
(1) 1486/ 60012D0 : C801                		tst     #1,r0
(1) 1487/ 60012D2 : 8B03                		bf	.page_2
(1) 1488/ 60012D4 : D027                		mov	#RAM_Mars_PlgnList_0,r0
(1) 1489/ 60012D6 : D128                		mov	#RAM_Mars_PlgnNum_0,r1
(1) 1490/ 60012D8 : A003                		bra	.cont_plgn
(1) 1491/ 60012DA : 0009                		nop
(1) 1492/ 60012DC :                     .page_2:
(1) 1493/ 60012DC : D027                		mov	#RAM_Mars_PlgnList_1,r0
(1) 1494/ 60012DE : D128                		mov	#RAM_Mars_PlgnNum_1,r1
(1) 1495/ 60012E0 : 0009                		nop
(1) 1496/ 60012E2 :                     .cont_plgn:
(1) 1497/ 60012E2 : C202                		mov	r0,@(marsGbl_IndxPlgn,gbr)
(1) 1498/ 60012E4 : 6012                		mov	@r1,r0
(1) 1499/ 60012E6 : C111                		mov.w	r0,@(marsGbl_PlgnCntr,gbr)
(1) 1500/ 60012E8 : D026                		mov	#RAM_Mars_VdpDrwList,r0		; Reset DDA pieces Read/Write points
(1) 1501/ 60012EA : C200                		mov	r0,@(marsGbl_PlyPzList_R,gbr)	; And counter
(1) 1502/ 60012EC : C201                		mov	r0,@(marsGbl_PlyPzList_W,gbr)
(1) 1503/ 60012EE : E000                		mov	#0,r0
(1) 1504/ 60012F0 : C110                		mov.w	r0,@(marsGbl_PlyPzCntr,gbr)
(1) 1505/ 60012F2 : C10E                		mov.w	r0,@(marsGbl_WdgMode,gbr)
(1) 1506/ 60012F4 : 0202                		stc	sr,r2
(1) 1507/ 60012F6 : 904A                		mov	#$F0,r0
(1) 1508/ 60012F8 : 400E                		ldc 	r0,sr
(1) 1509/ 60012FA : 914C                		mov	#_CCR,r1			; <-- Required for Watchdog
(1) 1510/ 60012FC : E008                		mov	#%00001000,r0			; Two-way mode
(1) 1511/ 60012FE : 2101                		mov.w	r0,@r1
(1) 1512/ 6001300 : E019                		mov	#%00011001,r0			; Cache purge / Two-way mode / Cache ON
(1) 1513/ 6001302 : 2101                		mov.w	r0,@r1
(1) 1514/ 6001304 : 9148                		mov	#$FFFFFE80,r1
(1) 1515/ 6001306 : 9048                		mov.w	#$5A10,r0			; Watchdog pre-timer
(1) 1516/ 6001308 : 2101                		mov.w	r0,@r1
(1) 1517/ 600130A : 9047                		mov.w	#$A538,r0			; Enable Watchdog
(1) 1518/ 600130C : 2101                		mov.w	r0,@r1
(1) 1519/ 600130E : 420E                		ldc	r2,sr
(1) 1520/ 6001310 :                     
(1) 1521/ 6001310 :                     	; ---------------------------------------
(1) 1522/ 6001310 :                     	; Clear screen
(1) 1523/ 6001310 :                     	; ---------------------------------------
(1) 1524/ 6001310 : D111                		mov	#_vdpreg,r1
(1) 1525/ 6001312 : 923B                		mov	#$100,r2
(1) 1526/ 6001314 : 6323                		mov	r2,r3
(1) 1527/ 6001316 : 943A                		mov	#240,r4
(1) 1528/ 6001318 : 953A                		mov	#320/2,r5
(1) 1529/ 600131A : E600                		mov	#0,r6
(1) 1530/ 600131C :                     .fb_loop:
(1) 1531/ 600131C : 6053                		mov	r5,r0
(1) 1532/ 600131E : 8112                		mov.w	r0,@(filllength,r1)
(1) 1533/ 6001320 : 6023                		mov	r2,r0
(1) 1534/ 6001322 : 8113                		mov.w	r0,@(fillstart,r1)
(1) 1535/ 6001324 : 6063                		mov	r6,r0
(1) 1536/ 6001326 : 8114                		mov.w	r0,@(filldata,r1)
(1) 1537/ 6001328 : 8515                .wait_fb2:	mov.w	@(vdpsts,r1),r0
(1) 1538/ 600132A : C802                		tst	#%10,r0
(1) 1539/ 600132C : 8BFC                		bf	.wait_fb2
(1) 1540/ 600132E : 4410                		dt	r4
(1) 1541/ 6001330 : 8FF4                		bf/s	.fb_loop
(1) 1542/ 6001332 : 323C                		add	r3,r2
(1) 1543/ 6001334 :                     
(1) 1544/ 6001334 :                     	; ---------------------------------------
(1) 1545/ 6001334 :                     
(1) 1546/ 6001334 : C510                		mov.w	@(marsGbl_PlyPzCntr,gbr),r0
(1) 1547/ 6001336 : 2008                		tst	r0,r0
(1) 1548/ 6001338 : 8905                		bt	.no_swap
(1) 1549/ 600133A : C50E                .wait_wd:	mov.w	@(marsGbl_WdgMode,gbr),r0
(1) 1550/ 600133C : 2008                		tst	r0,r0
(1) 1551/ 600133E : 89FC                		bt	.wait_wd
(1) 1552/ 6001340 : D011                		mov	#VideoMars_DrwPlgnPz,r0
(1) 1553/ 6001342 : 400B                		jsr	@r0
(1) 1554/ 6001344 : 0009                		nop
(1) 1555/ 6001346 :                     .no_swap:
(1) 1556/ 6001346 : ADF6                		bra	master_loop
(1) 1557/ 6001348 : 0009                		nop
(1) 1558/ 600134A :                     		align 4
(1) 1559/ 600134C : 2600 A174 2601 6C90 		ltorg
                    2601 6CAC 2000 4100 
                    0400 0000 2601 6C90 
                    0400 0200 2000 402E 
                    2600 A390 2601 1668 
                    2601 5C10 2601 6C10 
                    2601 6410 2601 6C14 
                    2601 1890 C000 036E 
                    0100 00F0 00A0 00E0 
                    0080 FE92 FE80 5A10 
                    A538                
(1) 1560/ 600139E :                     
(1) 1561/ 600139E :                     ; ============================================================
(1) 1562/ 600139E :                     ;
(1) 1563/ 600139E :                     ; mstr_waitdma:
(1) 1564/ 600139E :                     ; 		mov	#_DMACHANNEL0,r1
(1) 1565/ 600139E :                     ; 		mov	@r1,r0
(1) 1566/ 600139E :                     ; 		and	#%01,r0
(1) 1567/ 600139E :                     ; 		tst	r0,r0
(1) 1568/ 600139E :                     ; 		bt	.not_yet
(1) 1569/ 600139E :                     ; .wait_dma:	mov	@r1,r0
(1) 1570/ 600139E :                     ; 		tst	#%10,r0
(1) 1571/ 600139E :                     ; 		bt	.wait_dma
(1) 1572/ 600139E :                     ; .not_yet:
(1) 1573/ 600139E :                     ; 		rts
(1) 1574/ 600139E :                     ; 		nop
(1) 1575/ 600139E :                     ; 		align 4
(1) 1576/ 600139E :                     
(1) 1577/ 600139E :                     ; ====================================================================
(1) 1578/ 600139E :                     ; ----------------------------------------------------------------
(1) 1579/ 600139E :                     ; Slave entry
(1) 1580/ 600139E :                     ; ----------------------------------------------------------------
(1) 1581/ 600139E :                     
(1) 1582/ 600139E :                     		align 4
(1) 1583/ 60013A0 :                     SH2_S_Entry:
(1) 1584/ 60013A0 : 9E8E                		mov.l	#$FFFFFE10,r14
(1) 1585/ 60013A2 : E000                		mov	#0,r0
(1) 1586/ 60013A4 : 80E0                		mov.b	r0,@(0,r14)
(1) 1587/ 60013A6 : E0E2                		mov	#$FFFFFFE2, r0
(1) 1588/ 60013A8 : 80E7                		mov.b	r0,@(7,r14)
(1) 1589/ 60013AA : E000                		mov	#0,r0
(1) 1590/ 60013AC : 80E4                		mov.b	r0,@(4,r14)
(1) 1591/ 60013AE : E001                		mov	#1,r0
(1) 1592/ 60013B0 : 80E5                		mov.b	r0,@(5,r14)
(1) 1593/ 60013B2 : E000                		mov	#0,r0
(1) 1594/ 60013B4 : 80E6                		mov.b	r0,@(6,r14)
(1) 1595/ 60013B6 : E001                		mov	#1,r0
(1) 1596/ 60013B8 : 80E1                		mov.b	r0,@(1,r14)
(1) 1597/ 60013BA : E000                		mov	#0,r0
(1) 1598/ 60013BC : 80E3                		mov.b	r0,@(3,r14)
(1) 1599/ 60013BE : 80E2                		mov.b	r0,@(2,r14)
(1) 1600/ 60013C0 : 907F                		mov.l   #$FFFFFEE2,r0			; Watchdog: Set interrupt priority bits (IPRA)
(1) 1601/ 60013C2 : E150                		mov     #%0101<<4,r1
(1) 1602/ 60013C4 : 2011                		mov.w   r1,@r0
(1) 1603/ 60013C6 : 907D                		mov.l   #$FFFFFEE4,r0
(1) 1604/ 60013C8 : E148                		mov     #$120/4,r1			; Watchdog: Set jump pointer (VBR + this/4) (WITV)
(1) 1605/ 60013CA : 4118                		shll8   r1
(1) 1606/ 60013CC : 2011                		mov.w   r1,@r0
(1) 1607/ 60013CE : 917A                		mov.l	#_CCR,r1
(1) 1608/ 60013D0 : E010                		mov	#$10,r0
(1) 1609/ 60013D2 : 2101                		mov.w	r0,@r1
(1) 1610/ 60013D4 : E009                		mov	#$09,r0
(1) 1611/ 60013D6 : 2101                		mov.w	r0,@r1
(1) 1612/ 60013D8 : D12A                		mov 	#CACHE_SLAVE,r1			; Transfer Slave's fast-code to CACHE
(1) 1613/ 60013DA : D22B                		mov 	#$C0000000,r2
(1) 1614/ 60013DC : 9374                		mov 	#(CACHE_SLAVE_E-CACHE_SLAVE)/4,r3
(1) 1615/ 60013DE :                     .copy:
(1) 1616/ 60013DE : 6016                		mov 	@r1+,r0
(1) 1617/ 60013E0 : 2202                		mov 	r0,@r2
(1) 1618/ 60013E2 : 4310                		dt	r3
(1) 1619/ 60013E4 : 8FFB                		bf/s	.copy
(1) 1620/ 60013E6 : 7204                		add 	#4,r2
(1) 1621/ 60013E8 : D128                		mov	#_sysreg,r1
(1) 1622/ 60013EA : E003                		mov	#CMDIRQ_ON|PWMIRQ_ON,r0			; Enable these interrupts
(1) 1623/ 60013EC : 8011                    		mov.b	r0,@(intmask,r1)		; (Watchdog is external)
(1) 1624/ 60013EE : BCB5                		bsr	MarsSound_Init			; Init PWM
(1) 1625/ 60013F0 : 0009                		nop
(1) 1626/ 60013F2 :                     .wait_md:
(1) 1627/ 60013F2 :                     ; 		mov 	#_sysreg+comm12,r2
(1) 1628/ 60013F2 :                     ; 		mov.w	@r2,r0
(1) 1629/ 60013F2 :                     ; 		cmp/eq	#0,r0
(1) 1630/ 60013F2 :                     ; 		bf	.wait_md
(1) 1631/ 60013F2 :                     
(1) 1632/ 60013F2 :                     ; ====================================================================
(1) 1633/ 60013F2 :                     ; ----------------------------------------------------------------
(1) 1634/ 60013F2 :                     ; Slave main code
(1) 1635/ 60013F2 :                     ; ----------------------------------------------------------------
(1) 1636/ 60013F2 :                     
(1) 1637/ 60013F2 :                     SH2_S_HotStart:
(1) 1638/ 60013F2 : 906A                		mov	#$F0,r0				; Interrupts OFF
(1) 1639/ 60013F4 : 400E                		ldc	r0,sr
(1) 1640/ 60013F6 : 9169                		mov	#$FFFFFE80,r1
(1) 1641/ 60013F8 : 9069                		mov.w	#$A518,r0			; Disable Watchdog
(1) 1642/ 60013FA : 2101                		mov.w	r0,@r1
(1) 1643/ 60013FC : DF24                		mov	#CS3|$3F000,r15			; Reset stack
(1) 1644/ 60013FE : DE25                		mov	#RAM_Mars_Global,r14		; Reset gbr
(1) 1645/ 6001400 : 4E1E                		ldc	r14,gbr
(1) 1646/ 6001402 : DE22                		mov	#$20004000, r14
(1) 1647/ 6001404 : E000                		mov	#0,r0
(1) 1648/ 6001406 : 81EA                		mov.w	r0,@($14,r14)
(1) 1649/ 6001408 : 81EB                		mov.w	r0,@($16,r14)
(1) 1650/ 600140A : 81EC                		mov.w	r0,@($18,r14)
(1) 1651/ 600140C : 81ED                		mov.w	r0,@($1A,r14)
(1) 1652/ 600140E : E000                		mov	#0,r0				; Stop ALL active PWM channels
(1) 1653/ 6001410 : D121                		mov	#MarsSnd_PwmChnls,r1
(1) 1654/ 6001412 : E207                		mov	#MAX_PWMCHNL,r2
(1) 1655/ 6001414 : E328                		mov	#sizeof_sndchn,r3
(1) 1656/ 6001416 :                     .clr_enbl:
(1) 1657/ 6001416 : 1100                		mov	r0,@(mchnsnd_enbl,r1)
(1) 1658/ 6001418 : 4210                		dt	r2
(1) 1659/ 600141A : 8FFC                		bf/s	.clr_enbl
(1) 1660/ 600141C : 313C                		add	r3,r1
(1) 1661/ 600141E : E020                		mov	#$20,r0				; Interrupts ON
(1) 1662/ 6001420 : 400E                		ldc	r0,sr
(1) 1663/ 6001422 : A001                		bra	slave_loop
(1) 1664/ 6001424 : 0009                		nop
(1) 1665/ 6001426 :                     		align 4
(1) 1666/ 6001428 :                     
(1) 1667/ 6001428 :                     ; ----------------------------------------------------------------
(1) 1668/ 6001428 :                     ; SLAVE Loop
(1) 1669/ 6001428 :                     ; ----------------------------------------------------------------
(1) 1670/ 6001428 :                     
(1) 1671/ 6001428 :                     slave_loop:
(1) 1672/ 6001428 : D11C                		mov	#_sysreg+comm1,r1	; DEBUG counter
(1) 1673/ 600142A : 6010                		mov.b	@r1,r0
(1) 1674/ 600142C : 7001                		add	#1,r0
(1) 1675/ 600142E : 2100                		mov.b	r0,@r1
(1) 1676/ 6001430 : D31B                		mov	#.list,r3		; Default LOOP points
(1) 1677/ 6001432 : D21C                		mov	#_sysreg+comm14,r2
(1) 1678/ 6001434 : 6021                		mov.w	@r2,r0			; r0 - INIT bit
(1) 1679/ 6001436 : C90F                		and	#%1111,r0
(1) 1680/ 6001438 : 4008                		shll2	r0
(1) 1681/ 600143A : 033E                		mov	@(r3,r0),r3
(1) 1682/ 600143C : 432B                		jmp	@r3
(1) 1683/ 600143E : 0009                		nop
(1) 1684/ 6001440 :                     		align 4
(1) 1685/ 6001440 :                     .list:
(1) 1686/ 6001440 : 0600 1428           		dc.l slave_loop		; $00 - go back
(1) 1687/ 6001444 : 0600 1450           		dc.l .slv_task_1	; $01 - Draw BOTTOM half of Scaled BG (TODO: later...)
(1) 1688/ 6001448 : 0600 1454           		dc.l .slv_task_2	; $02 - Build 3D models
(1) 1689/ 600144C : 0600 1450           		dc.l .slv_task_1
(1) 1690/ 6001450 :                     
(1) 1691/ 6001450 :                     ; ============================================================
(1) 1692/ 6001450 :                     ; ---------------------------------------
(1) 1693/ 6001450 :                     ; Task mode 1:
(1) 1694/ 6001450 :                     ; Helps MASTER to draw the bottom half
(1) 1695/ 6001450 :                     ; of the scaled background
(1) 1696/ 6001450 :                     ; ---------------------------------------
(1) 1697/ 6001450 :                     
(1) 1698/ 6001450 :                     .slv_task_1:
(1) 1699/ 6001450 :                     
(1) 1700/ 6001450 :                     	; TODO: worked, but DY is wrong here
(1) 1701/ 6001450 :                     	; i'll check later
(1) 1702/ 6001450 :                     
(1) 1703/ 6001450 :                     	; MAIN scaler
(1) 1704/ 6001450 :                     	; r1 - X pos xxxx.0000
(1) 1705/ 6001450 :                     	; r2 - Y pos yyyy.0000
(1) 1706/ 6001450 :                     	; r3 - X dx  xxxx.0000
(1) 1707/ 6001450 :                     	; r4 - Y dx  yyyy.0000
(1) 1708/ 6001450 :                     	; r5 - Source WIDTH
(1) 1709/ 6001450 :                     	; r6 - Source HEIGHT
(1) 1710/ 6001450 :                     	; r7 - Source DATA
(1) 1711/ 6001450 :                     	; r8 - Output
(1) 1712/ 6001450 :                     	; r9 - line size / 2
(1) 1713/ 6001450 :                     	; r10 - Number of lines
(1) 1714/ 6001450 :                     
(1) 1715/ 6001450 :                     ; 		mov	#RAM_Mars_BgBuffScale_S,r14
(1) 1716/ 6001450 :                     ; 		mov	@r14+,r7		; r7 - Input
(1) 1717/ 6001450 :                     ; 		mov	@r14+,r1		; r1 - X pos (2 pixels wide)
(1) 1718/ 6001450 :                     ; 		mov	@r14+,r2		; r2 - Y pos
(1) 1719/ 6001450 :                     ; 		mov	@r14+,r3		; r3 - DX
(1) 1720/ 6001450 :                     ; 		mov	@r14+,r4		; r4 - DY
(1) 1721/ 6001450 :                     ; 		mov	@r14+,r5		; r5 - X width
(1) 1722/ 6001450 :                     ; 		mov	@r14+,r6		; r6 - Y height
(1) 1723/ 6001450 :                     ; 		shll16	r5
(1) 1724/ 6001450 :                     ; 		shll16	r6
(1) 1725/ 6001450 :                     ; 		mov	#$7800,r0
(1) 1726/ 6001450 :                     ; 		add	r0,r2
(1) 1727/ 6001450 :                     ; 		dmuls	r1,r5			; Topleft calc
(1) 1728/ 6001450 :                     ; 		sts	mach,r0
(1) 1729/ 6001450 :                     ; 		sts	macl,r1
(1) 1730/ 6001450 :                     ; 		xtrct	r0,r1
(1) 1731/ 6001450 :                     ; 		dmuls	r2,r6
(1) 1732/ 6001450 :                     ; 		sts	mach,r0
(1) 1733/ 6001450 :                     ; 		sts	macl,r2
(1) 1734/ 6001450 :                     ; 		xtrct	r0,r2
(1) 1735/ 6001450 :                     ; ; 		mov	#_framebuffer+$200,r8	; r8 - Output
(1) 1736/ 6001450 :                     ; 		mov	#(_framebuffer+$200)+($200*112),r8	; r8 - Output
(1) 1737/ 6001450 :                     ; 		mov	#320/2,r9		; r9  - X loop
(1) 1738/ 6001450 :                     ; 		mov	#224/2,r10		; r10 - Y loop
(1) 1739/ 6001450 :                     ; .y_loop:
(1) 1740/ 6001450 :                     ; 		cmp/pz	r1
(1) 1741/ 6001450 :                     ; 		bt	.y_add
(1) 1742/ 6001450 :                     ; 		bra	.y_loop
(1) 1743/ 6001450 :                     ; 		add	r5,r1
(1) 1744/ 6001450 :                     ; .y_add:
(1) 1745/ 6001450 :                     ; 		cmp/pz	r2
(1) 1746/ 6001450 :                     ; 		bt	.xy_set
(1) 1747/ 6001450 :                     ; 		bra	.y_add
(1) 1748/ 6001450 :                     ; 		add	r6,r2
(1) 1749/ 6001450 :                     ; .xy_set:
(1) 1750/ 6001450 :                     ; 		cmp/ge	r6,r2
(1) 1751/ 6001450 :                     ; 		bf	.y_high
(1) 1752/ 6001450 :                     ; 		bra	.y_loop
(1) 1753/ 6001450 :                     ; 		sub	r6,r2
(1) 1754/ 6001450 :                     ; .y_high:
(1) 1755/ 6001450 :                     ; 		mov	r1,r11
(1) 1756/ 6001450 :                     ; 		shlr	r11			; /2
(1) 1757/ 6001450 :                     ; 		mov	r2,r0
(1) 1758/ 6001450 :                     ; 		shlr16	r0
(1) 1759/ 6001450 :                     ; 		mov	r5,r13
(1) 1760/ 6001450 :                     ; 		shlr16	r13
(1) 1761/ 6001450 :                     ; 		muls	r13,r0
(1) 1762/ 6001450 :                     ; 		sts	macl,r12
(1) 1763/ 6001450 :                     ; 		add	r7,r12
(1) 1764/ 6001450 :                     ; 		mov	r8,r13
(1) 1765/ 6001450 :                     ; 		mov	r9,r14
(1) 1766/ 6001450 :                     ; .x_loop:
(1) 1767/ 6001450 :                     ; 		mov	r5,r0
(1) 1768/ 6001450 :                     ; 		shlr	r0		; /2
(1) 1769/ 6001450 :                     ; .x_loop2:
(1) 1770/ 6001450 :                     ; 		cmp/ge	r0,r11
(1) 1771/ 6001450 :                     ; 		bf	.x_high
(1) 1772/ 6001450 :                     ; 		bra	.x_loop2
(1) 1773/ 6001450 :                     ; 		sub	r0,r11
(1) 1774/ 6001450 :                     ; .x_high:
(1) 1775/ 6001450 :                     ; 		mov	r11,r0
(1) 1776/ 6001450 :                     ; 		shlr16	r0
(1) 1777/ 6001450 :                     ; 		exts	r0,r0
(1) 1778/ 6001450 :                     ; 		shll	r0
(1) 1779/ 6001450 :                     ; 		mov.w	@(r12,r0),r0
(1) 1780/ 6001450 :                     ; 		add	r3,r11
(1) 1781/ 6001450 :                     ; 		mov.w	r0,@r13
(1) 1782/ 6001450 :                     ; 		dt	r14
(1) 1783/ 6001450 :                     ; 		bf/s	.x_loop
(1) 1784/ 6001450 :                     ; 		add	#2,r13
(1) 1785/ 6001450 :                     ; 		add	r4,r2
(1) 1786/ 6001450 :                     ; 		mov	#$200,r0
(1) 1787/ 6001450 :                     ; 		dt	r10
(1) 1788/ 6001450 :                     ; 		bf/s	.y_loop
(1) 1789/ 6001450 :                     ; 		add	r0,r8
(1) 1790/ 6001450 :                     
(1) 1791/ 6001450 : A011                		bra	.slv_exit
(1) 1792/ 6001452 : 0009                		nop
(1) 1793/ 6001454 :                     
(1) 1794/ 6001454 :                     ; ============================================================
(1) 1795/ 6001454 :                     ; ---------------------------------------
(1) 1796/ 6001454 :                     ; Task mode 2: Build 3D Models
(1) 1797/ 6001454 :                     ; FOR THE NEXT FRAME (not current)
(1) 1798/ 6001454 :                     ; ---------------------------------------
(1) 1799/ 6001454 :                     
(1) 1800/ 6001454 :                     .slv_task_2:
(1) 1801/ 6001454 : E000                		mov	#0,r0
(1) 1802/ 6001456 : C10C                		mov.w	r0,@(marsGbl_CurrNumFaces,gbr)
(1) 1803/ 6001458 : D113                		mov 	#RAM_Mars_Polygons_0,r1
(1) 1804/ 600145A : D214                		mov	#RAM_Mars_PlgnList_0,r2
(1) 1805/ 600145C : C50F                		mov.w   @(marsGbl_PolyBuffNum,gbr),r0
(1) 1806/ 600145E : C801                		tst     #1,r0
(1) 1807/ 6001460 : 8B01                		bf	.go_mdl
(1) 1808/ 6001462 : D113                		mov 	#RAM_Mars_Polygons_1,r1
(1) 1809/ 6001464 : D213                		mov	#RAM_Mars_PlgnList_1,r2
(1) 1810/ 6001466 :                     .go_mdl:
(1) 1811/ 6001466 : 6013                		mov	r1,r0
(1) 1812/ 6001468 : C205                		mov	r0,@(marsGbl_CurrFacePos,gbr)
(1) 1813/ 600146A : 6023                		mov	r2,r0
(1) 1814/ 600146C : C203                		mov	r0,@(marsGbl_CurrZList,gbr)
(1) 1815/ 600146E : C204                		mov	r0,@(marsGbl_CurrZTop,gbr)
(1) 1816/ 6001470 : D011                		mov	#MarsMdl_MdlLoop,r0
(1) 1817/ 6001472 : 400B                		jsr	@r0
(1) 1818/ 6001474 : 0009                		nop
(1) 1819/ 6001476 :                     
(1) 1820/ 6001476 :                     ; ============================================================
(1) 1821/ 6001476 :                     
(1) 1822/ 6001476 :                     ; JMP only
(1) 1823/ 6001476 :                     .slv_exit:
(1) 1824/ 6001476 : D40B                		mov	#_sysreg+comm14,r4	; Finish task
(1) 1825/ 6001478 : D110                		mov	#$FF00,r1
(1) 1826/ 600147A : 6041                		mov.w	@r4,r0
(1) 1827/ 600147C : 2019                		and	r1,r0
(1) 1828/ 600147E : 2401                		mov.w	r0,@r4
(1) 1829/ 6001480 : AFD2                		bra	slave_loop
(1) 1830/ 6001482 : 0009                		nop
(1) 1831/ 6001484 :                     		align 4
(1) 1832/ 6001484 : 0600 1BA8 C000 0000 		ltorg
                    2000 4000 0603 F000 
                    2600 A590 C000 0000 
                    2000 4021 0600 1440 
                    2000 402E 2600 A668 
                    2601 5C10 2600 DE68 
                    2601 6410 C000 02B0 
                    0000 FF00 FE10 FEE2 
                    FEE4 FE92 01EC 00F0 
                    FE80 A518           
(1) 1833/ 60014D0 :                     
(1) 1834/ 60014D0 :                     ; =================================================================
(1) 1835/ 60014D0 :                     ; ------------------------------------------------
(1) 1836/ 60014D0 :                     ; Slave | Watchdog interrupt
(1) 1837/ 60014D0 :                     ; ------------------------------------------------
(1) 1838/ 60014D0 :                     
(1) 1839/ 60014D0 :                     s_irq_custom:
(1) 1840/ 60014D0 : 9012                		mov	#$F0,r0
(1) 1841/ 60014D2 : 400E                		ldc	r0,sr
(1) 1842/ 60014D4 : 2F26                		mov	r2,@-r15
(1) 1843/ 60014D6 : 9110                		mov	#_FRT,r1
(1) 1844/ 60014D8 : 8417                		mov.b   @(7,r1),r0
(1) 1845/ 60014DA : CA02                		xor     #2,r0
(1) 1846/ 60014DC : 8017                		mov.b   r0,@(7,r1)
(1) 1847/ 60014DE :                     
(1) 1848/ 60014DE : 910D                		mov	#$FFFFFE80,r1
(1) 1849/ 60014E0 : 900D                		mov.w   #$A518,r0		; Watchdog OFF
(1) 1850/ 60014E2 : 2101                		mov.w   r0,@r1
(1) 1851/ 60014E4 : CB20                		or      #$20,r0			; ON again
(1) 1852/ 60014E6 : 2101                		mov.w   r0,@r1
(1) 1853/ 60014E8 : E210                		mov	#$10,r2
(1) 1854/ 60014EA : 9009                		mov.w   #$5A00,r0		; Timer for the next one
(1) 1855/ 60014EC : 202B                		or	r2,r0
(1) 1856/ 60014EE : 2101                		mov.w	r0,@r1
(1) 1857/ 60014F0 :                     
(1) 1858/ 60014F0 : 62F6                		mov	@r15+,r2
(1) 1859/ 60014F2 : 000B                		rts
(1) 1860/ 60014F4 : 0009                		nop
(1) 1861/ 60014F6 :                     		align 4
(1) 1862/ 60014F8 : 00F0 FE10 FE80 A518 		ltorg
                    5A00                
(1) 1863/ 6001502 :                     
(1) 1864/ 6001502 :                     ; ====================================================================
(1) 1865/ 6001502 :                     ; ----------------------------------------------------------------
(1) 1866/ 6001502 :                     ; Cache routines
(1) 1867/ 6001502 :                     ; ----------------------------------------------------------------
(1) 1868/ 6001502 :                     
(1) 1869/ 6001502 :                     		include "system/mars/cache.asm"
(2)    1/ 6001502 :                     ; ====================================================================
(2)    2/ 6001502 :                     ; ----------------------------------------------------------------
(2)    3/ 6001502 :                     ; CACHE code for Master CPU
(2)    4/ 6001502 :                     ;
(2)    5/ 6001502 :                     ; LIMIT: $800 bytes for each CPU
(2)    6/ 6001502 :                     ; ----------------------------------------------------------------
(2)    7/ 6001502 :                     
(2)    8/ 6001502 :                     		align 4
(2)    9/ 6001504 :                     CACHE_MASTER:
(2)   10/FFFFFFFFC0000000 :                     		phase $C0000000
(2)   11/FFFFFFFFC0000000 :                     
(2)   12/FFFFFFFFC0000000 :                     ; ------------------------------------------------
(2)   13/FFFFFFFFC0000000 :                     ; POLYGON SLICER as Watchdog interrupt
(2)   14/FFFFFFFFC0000000 :                     ; ------------------------------------------------
(2)   15/FFFFFFFFC0000000 :                     
(2)   16/FFFFFFFFC0000000 :                     ; *** THIS USES DIVISION ***
(2)   17/FFFFFFFFC0000000 :                     
(2)   18/FFFFFFFFC0000000 :                     m_irq_custom:
(2)   19/FFFFFFFFC0000000 : 90C0                		mov	#$F0,r0
(2)   20/FFFFFFFFC0000002 : 400E                		ldc	r0,sr
(2)   21/FFFFFFFFC0000004 : 91BF                		mov	#_FRT,r1
(2)   22/FFFFFFFFC0000006 : 8417                		mov.b	@(7,r1),r0
(2)   23/FFFFFFFFC0000008 : CA02                		xor	#2,r0
(2)   24/FFFFFFFFC000000A : 8017                		mov.b	r0,@(7,r1)
(2)   25/FFFFFFFFC000000C :                     
(2)   26/FFFFFFFFC000000C : C511                		mov.w	@(marsGbl_PlgnCntr,gbr),r0
(2)   27/FFFFFFFFC000000E : 8800                		cmp/eq	#0,r0
(2)   28/FFFFFFFFC0000010 : 8B06                		bf	wdg_task_0
(2)   29/FFFFFFFFC0000012 : E001                		mov	#1,r0
(2)   30/FFFFFFFFC0000014 : C10E                		mov.w	r0,@(marsGbl_WdgMode,gbr)
(2)   31/FFFFFFFFC0000016 :                     
(2)   32/FFFFFFFFC0000016 : 91B7                		mov.l   #$FFFFFE80,r1			; Stop watchdog
(2)   33/FFFFFFFFC0000018 : 90B7                		mov.w   #$A518,r0
(2)   34/FFFFFFFFC000001A : 2101                		mov.w   r0,@r1
(2)   35/FFFFFFFFC000001C : A09F                		bra	wdm_exit
(2)   36/FFFFFFFFC000001E : 0009                		nop
(2)   37/FFFFFFFFC0000020 :                     		align 4
(2)   38/FFFFFFFFC0000020 :                     
(2)   39/FFFFFFFFC0000020 :                     wdg_task_0:
(2)   40/FFFFFFFFC0000020 : 4010                		dt	r0
(2)   41/FFFFFFFFC0000022 : C111                		mov.w	r0,@(marsGbl_PlgnCntr,gbr)
(2)   42/FFFFFFFFC0000024 : C602                		mov	@(marsGbl_IndxPlgn,gbr),r0
(2)   43/FFFFFFFFC0000026 :                     ; 		mov	r0,r1
(2)   44/FFFFFFFFC0000026 : 5E01                		mov	@(4,r0),r14
(2)   45/FFFFFFFFC0000028 :                     ; 		xor	r0,r0
(2)   46/FFFFFFFFC0000028 :                     ; 		mov	r0,@r1
(2)   47/FFFFFFFFC0000028 :                     ; 		mov	r0,@(4,r1)
(2)   48/FFFFFFFFC0000028 :                     
(2)   49/FFFFFFFFC0000028 : D04E                		mov	#Cach_Bkup_S,r0
(2)   50/FFFFFFFFC000002A : 2026                		mov	r2,@-r0
(2)   51/FFFFFFFFC000002C : 2036                		mov	r3,@-r0
(2)   52/FFFFFFFFC000002E : 2046                		mov	r4,@-r0
(2)   53/FFFFFFFFC0000030 : 2056                		mov	r5,@-r0
(2)   54/FFFFFFFFC0000032 : 2066                		mov	r6,@-r0
(2)   55/FFFFFFFFC0000034 : 2076                		mov	r7,@-r0
(2)   56/FFFFFFFFC0000036 : 2086                		mov	r8,@-r0
(2)   57/FFFFFFFFC0000038 : 2096                		mov	r9,@-r0
(2)   58/FFFFFFFFC000003A : 20A6                		mov	r10,@-r0
(2)   59/FFFFFFFFC000003C : 20B6                		mov	r11,@-r0
(2)   60/FFFFFFFFC000003E : 20C6                		mov	r12,@-r0
(2)   61/FFFFFFFFC0000040 : 20D6                		mov	r13,@-r0
(2)   62/FFFFFFFFC0000042 : 20E6                		mov	r14,@-r0
(2)   63/FFFFFFFFC0000044 : 4012                		sts	macl,@-r0
(2)   64/FFFFFFFFC0000046 : 4002                		sts	mach,@-r0
(2)   65/FFFFFFFFC0000048 : 4022                		sts	pr,@-r0
(2)   66/FFFFFFFFC000004A : DD47                		mov	#Cach_DDA_Last,r13		; r13 - DDA last point
(2)   67/FFFFFFFFC000004C : DC47                		mov	#Cach_DDA_Top,r12		; r12 - DDA first point
(2)   68/FFFFFFFFC000004E : 50E0                		mov	@(polygn_type,r14),r0		; Read type settings
(2)   69/FFFFFFFFC0000050 : 4029                		shlr16	r0
(2)   70/FFFFFFFFC0000052 : 4019                		shlr8	r0
(2)   71/FFFFFFFFC0000054 : C840                		tst	#PLGN_TRI,r0			; PLGN_TRI set?
(2)   72/FFFFFFFFC0000056 : 8B00                		bf	.tringl
(2)   73/FFFFFFFFC0000058 : 7D08                		add	#8,r13				; If quad: add 8
(2)   74/FFFFFFFFC000005A :                     .tringl:
(2)   75/FFFFFFFFC000005A : 61E3                		mov	r14,r1
(2)   76/FFFFFFFFC000005C : 62C3                		mov	r12,r2
(2)   77/FFFFFFFFC000005E : D344                		mov	#Cach_DDA_Src,r3
(2)   78/FFFFFFFFC0000060 : 7108                		add	#polygn_points,r1
(2)   79/FFFFFFFFC0000062 :                     
(2)   80/FFFFFFFFC0000062 :                     ; ----------------------------------------
(2)   81/FFFFFFFFC0000062 :                     ; Polygon points
(2)   82/FFFFFFFFC0000062 :                     ; ----------------------------------------
(2)   83/FFFFFFFFC0000062 :                     
(2)   84/FFFFFFFFC0000062 :                     	; Copy polygon points Cache's DDA
(2)   85/FFFFFFFFC0000062 : E804                		mov	#4,r8
(2)   86/FFFFFFFFC0000064 : 9692                		mov	#SCREEN_WIDTH/2,r6
(2)   87/FFFFFFFFC0000066 : E770                		mov	#SCREEN_HEIGHT/2,r7
(2)   88/FFFFFFFFC0000068 :                     .setpnts:
(2)   89/FFFFFFFFC0000068 : 6416                		mov	@r1+,r4			; Get X
(2)   90/FFFFFFFFC000006A : 6516                		mov	@r1+,r5			; Get Y
(2)   91/FFFFFFFFC000006C : 346C                		add	r6,r4			; X + width
(2)   92/FFFFFFFFC000006E : 357C                		add	r7,r5			; Y + height
(2)   93/FFFFFFFFC0000070 : 2242                		mov	r4,@r2
(2)   94/FFFFFFFFC0000072 : 1251                		mov	r5,@(4,r2)
(2)   95/FFFFFFFFC0000074 : 4810                		dt	r8
(2)   96/FFFFFFFFC0000076 : 8FF7                		bf/s	.setpnts
(2)   97/FFFFFFFFC0000078 : 7208                		add	#8,r2
(2)   98/FFFFFFFFC000007A :                     
(2)   99/FFFFFFFFC000007A :                     	; Copy texture source points
(2)  100/FFFFFFFFC000007A :                     	; to Cache
(2)  101/FFFFFFFFC000007A : E804                		mov	#4,r8
(2)  102/FFFFFFFFC000007C :                     .src_pnts:
(2)  103/FFFFFFFFC000007C : 6415                		mov.w	@r1+,r4
(2)  104/FFFFFFFFC000007E : 6515                		mov.w	@r1+,r5
(2)  105/FFFFFFFFC0000080 : 2342                		mov	r4,@r3
(2)  106/FFFFFFFFC0000082 : 1351                		mov	r5,@(4,r3)
(2)  107/FFFFFFFFC0000084 : 4810                		dt	r8
(2)  108/FFFFFFFFC0000086 : 8FF9                		bf/s	.src_pnts
(2)  109/FFFFFFFFC0000088 : 7308                		add	#8,r3
(2)  110/FFFFFFFFC000008A :                     
(2)  111/FFFFFFFFC000008A :                     	; Here we search for the lowest Y point
(2)  112/FFFFFFFFC000008A :                     	; and highest Y
(2)  113/FFFFFFFFC000008A :                     	; r10 - Top Y
(2)  114/FFFFFFFFC000008A :                     	; r11 - Bottom Y
(2)  115/FFFFFFFFC000008A :                     .start_math:
(2)  116/FFFFFFFFC000008A : E903                		mov	#3,r9
(2)  117/FFFFFFFFC000008C : C840                		tst	#PLGN_TRI,r0			; PLGN_TRI set?
(2)  118/FFFFFFFFC000008E : 8B00                		bf	.ytringl
(2)  119/FFFFFFFFC0000090 : 7901                		add	#1,r9
(2)  120/FFFFFFFFC0000092 :                     .ytringl:
(2)  121/FFFFFFFFC0000092 : DA38                		mov	#$7FFFFFFF,r10
(2)  122/FFFFFFFFC0000094 : EBFF                		mov	#$FFFFFFFF,r11
(2)  123/FFFFFFFFC0000096 : 67C3                		mov 	r12,r7
(2)  124/FFFFFFFFC0000098 : 68C3                		mov	r12,r8
(2)  125/FFFFFFFFC000009A :                     .find_top:
(2)  126/FFFFFFFFC000009A : 5071                		mov	@(4,r7),r0
(2)  127/FFFFFFFFC000009C : 30B7                		cmp/gt	r11,r0
(2)  128/FFFFFFFFC000009E : 8B00                		bf	.is_low
(2)  129/FFFFFFFFC00000A0 : 6B03                		mov 	r0,r11
(2)  130/FFFFFFFFC00000A2 :                     .is_low:
(2)  131/FFFFFFFFC00000A2 : 5081                		mov	@(4,r8),r0
(2)  132/FFFFFFFFC00000A4 : 30A7                		cmp/gt	r10,r0
(2)  133/FFFFFFFFC00000A6 : 8901                		bt	.is_high
(2)  134/FFFFFFFFC00000A8 : 6A03                		mov 	r0,r10
(2)  135/FFFFFFFFC00000AA : 6183                		mov	r8,r1
(2)  136/FFFFFFFFC00000AC :                     .is_high:
(2)  137/FFFFFFFFC00000AC : 7708                		add 	#8,r7
(2)  138/FFFFFFFFC00000AE : 4910                		dt	r9
(2)  139/FFFFFFFFC00000B0 : 8FF3                		bf/s	.find_top
(2)  140/FFFFFFFFC00000B2 : 7808                		add	#8,r8
(2)  141/FFFFFFFFC00000B4 : 3AB3                		cmp/ge	r11,r10			; Top larger than Bottom?
(2)  142/FFFFFFFFC00000B6 : 8937                		bt	.exit
(2)  143/FFFFFFFFC00000B8 : 4B15                		cmp/pl	r11			; Bottom < 0?
(2)  144/FFFFFFFFC00000BA : 8B35                		bf	.exit
(2)  145/FFFFFFFFC00000BC : 9067                		mov	#SCREEN_HEIGHT,r0	; Top > 224?
(2)  146/FFFFFFFFC00000BE : 3A03                		cmp/ge	r0,r10
(2)  147/FFFFFFFFC00000C0 : 8932                		bt	.exit
(2)  148/FFFFFFFFC00000C2 :                     
(2)  149/FFFFFFFFC00000C2 :                     	; r2 - Left DDA READ pointer
(2)  150/FFFFFFFFC00000C2 :                     	; r3 - Right DDA READ pointer
(2)  151/FFFFFFFFC00000C2 :                     	; r4 - Left X
(2)  152/FFFFFFFFC00000C2 :                     	; r5 - Left DX
(2)  153/FFFFFFFFC00000C2 :                     	; r6 - Right X
(2)  154/FFFFFFFFC00000C2 :                     	; r7 - Right DX
(2)  155/FFFFFFFFC00000C2 :                     	; r8 - Left width
(2)  156/FFFFFFFFC00000C2 :                     	; r9 - Right width
(2)  157/FFFFFFFFC00000C2 :                     	; r10 - Top Y, gets updated after calling put_piece
(2)  158/FFFFFFFFC00000C2 :                     	; r11 - Bottom Y
(2)  159/FFFFFFFFC00000C2 :                     	; r12 - First DST point
(2)  160/FFFFFFFFC00000C2 :                     	; r13 - Last DST point
(2)  161/FFFFFFFFC00000C2 : 6213                		mov	r1,r2				; r2 - X left to process
(2)  162/FFFFFFFFC00000C4 : 6313                		mov	r1,r3				; r3 - X right to process
(2)  163/FFFFFFFFC00000C6 : B064                		bsr	set_left
(2)  164/FFFFFFFFC00000C8 : 0009                		nop
(2)  165/FFFFFFFFC00000CA : B0A1                		bsr	set_right
(2)  166/FFFFFFFFC00000CC : 0009                		nop
(2)  167/FFFFFFFFC00000CE :                     .next_pz:
(2)  168/FFFFFFFFC00000CE : 905E                		mov	#SCREEN_HEIGHT,r0		; Current Y > 224?
(2)  169/FFFFFFFFC00000D0 : 3A07                		cmp/gt	r0,r10
(2)  170/FFFFFFFFC00000D2 : 8929                		bt	.exit
(2)  171/FFFFFFFFC00000D4 : 3AB3                		cmp/ge	r11,r10				; Y top => Y bottom?
(2)  172/FFFFFFFFC00000D6 : 8927                		bt	.exit
(2)  173/FFFFFFFFC00000D8 : C601                		mov	@(marsGbl_PlyPzList_W,gbr),r0	; r1 - Current piece to WRITE
(2)  174/FFFFFFFFC00000DA : 6103                		mov	r0,r1
(2)  175/FFFFFFFFC00000DC : D026                		mov	#RAM_Mars_VdpDrwList_e,r0	; pointer reached end of the list?
(2)  176/FFFFFFFFC00000DE : 3103                		cmp/ge	r0,r1
(2)  177/FFFFFFFFC00000E0 : 8B02                		bf	.dontreset
(2)  178/FFFFFFFFC00000E2 : D026                		mov	#RAM_Mars_VdpDrwList,r0		; Return WRITE pointer to the top of the list
(2)  179/FFFFFFFFC00000E4 : 6103                		mov	r0,r1
(2)  180/FFFFFFFFC00000E6 : C201                		mov	r0,@(marsGbl_PlyPzList_W,gbr)
(2)  181/FFFFFFFFC00000E8 :                     .dontreset:
(2)  182/FFFFFFFFC00000E8 : 5821                		mov	@(4,r2),r8
(2)  183/FFFFFFFFC00000EA : 5931                		mov	@(4,r3),r9
(2)  184/FFFFFFFFC00000EC : 38A8                		sub	r10,r8
(2)  185/FFFFFFFFC00000EE : 39A8                		sub	r10,r9
(2)  186/FFFFFFFFC00000F0 : 6083                		mov	r8,r0
(2)  187/FFFFFFFFC00000F2 : 3987                		cmp/gt	r8,r9
(2)  188/FFFFFFFFC00000F4 : 8900                		bt	.lefth
(2)  189/FFFFFFFFC00000F6 : 6093                		mov	r9,r0
(2)  190/FFFFFFFFC00000F8 :                     .lefth:
(2)  191/FFFFFFFFC00000F8 : 2F26                		mov	r2,@-r15
(2)  192/FFFFFFFFC00000FA : 2F36                		mov	r3,@-r15
(2)  193/FFFFFFFFC00000FC : 2F56                		mov	r5,@-r15
(2)  194/FFFFFFFFC00000FE : 2F76                		mov	r7,@-r15
(2)  195/FFFFFFFFC0000100 : 2F86                		mov	r8,@-r15
(2)  196/FFFFFFFFC0000102 : 2F96                		mov	r9,@-r15
(2)  197/FFFFFFFFC0000104 : B0C4                		bsr	put_piece
(2)  198/FFFFFFFFC0000106 : 0009                		nop
(2)  199/FFFFFFFFC0000108 : 69F6                		mov	@r15+,r9
(2)  200/FFFFFFFFC000010A : 68F6                		mov	@r15+,r8
(2)  201/FFFFFFFFC000010C : 67F6                		mov	@r15+,r7
(2)  202/FFFFFFFFC000010E : 65F6                		mov	@r15+,r5
(2)  203/FFFFFFFFC0000110 : 63F6                		mov	@r15+,r3
(2)  204/FFFFFFFFC0000112 : 62F6                		mov	@r15+,r2
(2)  205/FFFFFFFFC0000114 :                     	; X direction update
(2)  206/FFFFFFFFC0000114 : 3897                		cmp/gt	r9,r8				; Left width > Right width?
(2)  207/FFFFFFFFC0000116 : 8B03                		bf	.lefth2
(2)  208/FFFFFFFFC0000118 : B07A                		bsr	set_right
(2)  209/FFFFFFFFC000011A : 0009                		nop
(2)  210/FFFFFFFFC000011C : AFD7                		bra	.next_pz
(2)  211/FFFFFFFFC000011E : 0009                		nop
(2)  212/FFFFFFFFC0000120 :                     .lefth2:
(2)  213/FFFFFFFFC0000120 : B037                		bsr	set_left
(2)  214/FFFFFFFFC0000122 : 0009                		nop
(2)  215/FFFFFFFFC0000124 : AFD3                		bra	.next_pz
(2)  216/FFFFFFFFC0000126 : 0009                		nop
(2)  217/FFFFFFFFC0000128 :                     .exit:
(2)  218/FFFFFFFFC0000128 : D015                		mov	#Cach_Bkup_L,r0
(2)  219/FFFFFFFFC000012A : 4026                		lds	@r0+,pr
(2)  220/FFFFFFFFC000012C : 4006                		lds	@r0+,mach
(2)  221/FFFFFFFFC000012E : 4016                		lds	@r0+,macl
(2)  222/FFFFFFFFC0000130 : 6E06                		mov	@r0+,r14
(2)  223/FFFFFFFFC0000132 : 6D06                		mov	@r0+,r13
(2)  224/FFFFFFFFC0000134 : 6C06                		mov	@r0+,r12
(2)  225/FFFFFFFFC0000136 : 6B06                		mov	@r0+,r11
(2)  226/FFFFFFFFC0000138 : 6A06                		mov	@r0+,r10
(2)  227/FFFFFFFFC000013A : 6906                		mov	@r0+,r9
(2)  228/FFFFFFFFC000013C : 6806                		mov	@r0+,r8
(2)  229/FFFFFFFFC000013E : 6706                		mov	@r0+,r7
(2)  230/FFFFFFFFC0000140 : 6606                		mov	@r0+,r6
(2)  231/FFFFFFFFC0000142 : 6506                		mov	@r0+,r5
(2)  232/FFFFFFFFC0000144 : 6406                		mov	@r0+,r4
(2)  233/FFFFFFFFC0000146 : 6306                		mov	@r0+,r3
(2)  234/FFFFFFFFC0000148 : 6206                		mov	@r0+,r2
(2)  235/FFFFFFFFC000014A :                     
(2)  236/FFFFFFFFC000014A : C602                		mov	@(marsGbl_IndxPlgn,gbr),r0
(2)  237/FFFFFFFFC000014C : 7008                		add	#8,r0
(2)  238/FFFFFFFFC000014E : C202                		mov	r0,@(marsGbl_IndxPlgn,gbr)
(2)  239/FFFFFFFFC0000150 : 911A                		mov.l   #$FFFFFE80,r1
(2)  240/FFFFFFFFC0000152 : 901A                		mov.w   #$A518,r0	; OFF
(2)  241/FFFFFFFFC0000154 : 2101                		mov.w   r0,@r1
(2)  242/FFFFFFFFC0000156 : CB20                		or      #$20,r0		; ON
(2)  243/FFFFFFFFC0000158 : 2101                		mov.w   r0,@r1
(2)  244/FFFFFFFFC000015A : 9019                		mov.w   #$5A08,r0	; Timer for the next WD
(2)  245/FFFFFFFFC000015C : 2101                		mov.w   r0,@r1
(2)  246/FFFFFFFFC000015E :                     wdm_exit:
(2)  247/FFFFFFFFC000015E : 000B                		rts
(2)  248/FFFFFFFFC0000160 : 0009                		nop
(2)  249/FFFFFFFFC0000162 :                     		align 4
(2)  250/FFFFFFFFC0000164 : C000 062C C000 063C 		ltorg
                    C000 062C C000 064C 
                    7FFF FFFF 2601 5C10 
                    2601 1890 C000 05EC 
                    00F0 FE10 FE80 A518 
                    00A0 00E0 5A08      
(2)  251/FFFFFFFFC0000192 :                     
(2)  252/FFFFFFFFC0000192 :                     ; --------------------------------
(2)  253/FFFFFFFFC0000192 :                     
(2)  254/FFFFFFFFC0000192 :                     set_left:
(2)  255/FFFFFFFFC0000192 : 6823                		mov	r2,r8			; Get a copy of Xleft pointer
(2)  256/FFFFFFFFC0000194 : 7820                		add	#$20,r8			; To read Texture SRC points
(2)  257/FFFFFFFFC0000196 : 6482                		mov	@r8,r4
(2)  258/FFFFFFFFC0000198 : 5581                		mov	@(4,r8),r5
(2)  259/FFFFFFFFC000019A : D867                		mov	#Cach_DDA_Src_L,r8
(2)  260/FFFFFFFFC000019C : 6043                		mov	r4,r0
(2)  261/FFFFFFFFC000019E : 4028                		shll16	r0
(2)  262/FFFFFFFFC00001A0 : 2802                		mov	r0,@r8
(2)  263/FFFFFFFFC00001A2 : 6053                		mov	r5,r0
(2)  264/FFFFFFFFC00001A4 : 4028                		shll16	r0
(2)  265/FFFFFFFFC00001A6 : 1802                		mov	r0,@(8,r8)
(2)  266/FFFFFFFFC00001A8 : 6122                		mov	@r2,r1
(2)  267/FFFFFFFFC00001AA : 5821                		mov	@(4,r2),r8
(2)  268/FFFFFFFFC00001AC : 7208                		add	#8,r2
(2)  269/FFFFFFFFC00001AE : 32D7                		cmp/gt	r13,r2
(2)  270/FFFFFFFFC00001B0 : 8B00                		bf	.lft_ok
(2)  271/FFFFFFFFC00001B2 : 62C3                		mov 	r12,r2
(2)  272/FFFFFFFFC00001B4 :                     .lft_ok:
(2)  273/FFFFFFFFC00001B4 : 5021                		mov	@(4,r2),r0
(2)  274/FFFFFFFFC00001B6 : 3088                		sub	r8,r0
(2)  275/FFFFFFFFC00001B8 : 8800                		cmp/eq	#0,r0
(2)  276/FFFFFFFFC00001BA : 89EA                		bt	set_left
(2)  277/FFFFFFFFC00001BC : 4011                		cmp/pz	r0
(2)  278/FFFFFFFFC00001BE : 8B25                		bf	.lft_skip
(2)  279/FFFFFFFFC00001C0 :                     
(2)  280/FFFFFFFFC00001C0 : 400A                		lds	r0,mach
(2)  281/FFFFFFFFC00001C2 : 6823                		mov	r2,r8
(2)  282/FFFFFFFFC00001C4 : 7820                		add	#$20,r8
(2)  283/FFFFFFFFC00001C6 : 6082                		mov 	@r8,r0
(2)  284/FFFFFFFFC00001C8 : 3048                		sub 	r4,r0
(2)  285/FFFFFFFFC00001CA : 5481                		mov 	@(4,r8),r4
(2)  286/FFFFFFFFC00001CC : 3458                		sub 	r5,r4
(2)  287/FFFFFFFFC00001CE : 6503                		mov	r0,r5
(2)  288/FFFFFFFFC00001D0 : 4418                		shll8	r4
(2)  289/FFFFFFFFC00001D2 : 4518                		shll8	r5
(2)  290/FFFFFFFFC00001D4 : 080A                		sts	mach,r8
(2)  291/FFFFFFFFC00001D6 : 90C7                		mov	#_JR,r0
(2)  292/FFFFFFFFC00001D8 : 2082                		mov	r8,@r0
(2)  293/FFFFFFFFC00001DA : 1051                		mov	r5,@(4,r0)
(2)  294/FFFFFFFFC00001DC : 0009                		nop
(2)  295/FFFFFFFFC00001DE : 5501                		mov	@(4,r0),r5
(2)  296/FFFFFFFFC00001E0 : 90C2                		mov	#_JR,r0
(2)  297/FFFFFFFFC00001E2 : 2082                		mov	r8,@r0
(2)  298/FFFFFFFFC00001E4 : 1041                		mov	r4,@(4,r0)
(2)  299/FFFFFFFFC00001E6 : 0009                		nop
(2)  300/FFFFFFFFC00001E8 : 5401                		mov	@(4,r0),r4
(2)  301/FFFFFFFFC00001EA : 4418                		shll8	r4
(2)  302/FFFFFFFFC00001EC : 4518                		shll8	r5
(2)  303/FFFFFFFFC00001EE : D053                		mov	#Cach_DDA_Src_L+$C,r0
(2)  304/FFFFFFFFC00001F0 : 2042                		mov	r4,@r0
(2)  305/FFFFFFFFC00001F2 : D053                		mov	#Cach_DDA_Src_L+4,r0
(2)  306/FFFFFFFFC00001F4 : 2052                		mov	r5,@r0
(2)  307/FFFFFFFFC00001F6 : 6522                		mov	@r2,r5
(2)  308/FFFFFFFFC00001F8 : 3518                		sub 	r1,r5
(2)  309/FFFFFFFFC00001FA : 6413                		mov 	r1,r4
(2)  310/FFFFFFFFC00001FC : 4518                		shll8	r5
(2)  311/FFFFFFFFC00001FE : 4428                		shll16	r4
(2)  312/FFFFFFFFC0000200 : 90B2                		mov	#_JR,r0
(2)  313/FFFFFFFFC0000202 : 2082                		mov	r8,@r0
(2)  314/FFFFFFFFC0000204 : 1051                		mov	r5,@(4,r0)
(2)  315/FFFFFFFFC0000206 : 0009                		nop
(2)  316/FFFFFFFFC0000208 : 5501                		mov	@(4,r0),r5
(2)  317/FFFFFFFFC000020A : 4518                		shll8	r5
(2)  318/FFFFFFFFC000020C :                     .lft_skip:
(2)  319/FFFFFFFFC000020C : 000B                		rts
(2)  320/FFFFFFFFC000020E : 0009                		nop
(2)  321/FFFFFFFFC0000210 :                     		align 4
(2)  322/FFFFFFFFC0000210 :                     
(2)  323/FFFFFFFFC0000210 :                     ; --------------------------------
(2)  324/FFFFFFFFC0000210 :                     
(2)  325/FFFFFFFFC0000210 :                     set_right:
(2)  326/FFFFFFFFC0000210 : 6933                		mov	r3,r9
(2)  327/FFFFFFFFC0000212 : 7920                		add	#$20,r9
(2)  328/FFFFFFFFC0000214 : 6692                		mov	@r9,r6
(2)  329/FFFFFFFFC0000216 : 5791                		mov	@(4,r9),r7
(2)  330/FFFFFFFFC0000218 : D94A                		mov	#Cach_DDA_Src_R,r9
(2)  331/FFFFFFFFC000021A : 6063                		mov	r6,r0
(2)  332/FFFFFFFFC000021C : 4028                		shll16	r0
(2)  333/FFFFFFFFC000021E : 2902                		mov	r0,@r9
(2)  334/FFFFFFFFC0000220 : 6073                		mov	r7,r0
(2)  335/FFFFFFFFC0000222 : 4028                		shll16	r0
(2)  336/FFFFFFFFC0000224 : 1902                		mov	r0,@(8,r9)
(2)  337/FFFFFFFFC0000226 :                     
(2)  338/FFFFFFFFC0000226 : 6132                		mov	@r3,r1
(2)  339/FFFFFFFFC0000228 : 5931                		mov	@(4,r3),r9
(2)  340/FFFFFFFFC000022A : 73F8                		add	#-8,r3
(2)  341/FFFFFFFFC000022C : 33C3                		cmp/ge	r12,r3
(2)  342/FFFFFFFFC000022E : 8900                		bt	.rgt_ok
(2)  343/FFFFFFFFC0000230 : 63D3                		mov 	r13,r3
(2)  344/FFFFFFFFC0000232 :                     .rgt_ok:
(2)  345/FFFFFFFFC0000232 : 5031                		mov	@(4,r3),r0
(2)  346/FFFFFFFFC0000234 : 3098                		sub	r9,r0
(2)  347/FFFFFFFFC0000236 : 8800                		cmp/eq	#0,r0
(2)  348/FFFFFFFFC0000238 : 89EA                		bt	set_right
(2)  349/FFFFFFFFC000023A : 4011                		cmp/pz	r0
(2)  350/FFFFFFFFC000023C : 8B25                		bf	.rgt_skip
(2)  351/FFFFFFFFC000023E : 400A                		lds	r0,mach
(2)  352/FFFFFFFFC0000240 : 6933                		mov	r3,r9
(2)  353/FFFFFFFFC0000242 : 7920                		add	#$20,r9
(2)  354/FFFFFFFFC0000244 : 6092                		mov 	@r9,r0
(2)  355/FFFFFFFFC0000246 : 3068                		sub 	r6,r0
(2)  356/FFFFFFFFC0000248 : 5691                		mov 	@(4,r9),r6
(2)  357/FFFFFFFFC000024A : 3678                		sub 	r7,r6
(2)  358/FFFFFFFFC000024C : 6703                		mov	r0,r7
(2)  359/FFFFFFFFC000024E : 4618                		shll8	r6
(2)  360/FFFFFFFFC0000250 : 4718                		shll8	r7
(2)  361/FFFFFFFFC0000252 : 090A                		sts	mach,r9
(2)  362/FFFFFFFFC0000254 : 9088                		mov	#_JR,r0
(2)  363/FFFFFFFFC0000256 : 2092                		mov	r9,@r0
(2)  364/FFFFFFFFC0000258 : 1071                		mov	r7,@(4,r0)
(2)  365/FFFFFFFFC000025A : 0009                		nop
(2)  366/FFFFFFFFC000025C : 5701                		mov	@(4,r0),r7
(2)  367/FFFFFFFFC000025E : 9083                		mov	#_JR,r0
(2)  368/FFFFFFFFC0000260 : 2092                		mov	r9,@r0
(2)  369/FFFFFFFFC0000262 : 1061                		mov	r6,@(4,r0)
(2)  370/FFFFFFFFC0000264 : 0009                		nop
(2)  371/FFFFFFFFC0000266 : 5601                		mov	@(4,r0),r6
(2)  372/FFFFFFFFC0000268 : 4618                		shll8	r6
(2)  373/FFFFFFFFC000026A : 4718                		shll8	r7
(2)  374/FFFFFFFFC000026C : D036                		mov	#Cach_DDA_Src_R+4,r0
(2)  375/FFFFFFFFC000026E : 2072                		mov	r7,@r0
(2)  376/FFFFFFFFC0000270 : D036                		mov	#Cach_DDA_Src_R+$C,r0
(2)  377/FFFFFFFFC0000272 : 2062                		mov	r6,@r0
(2)  378/FFFFFFFFC0000274 : 6732                		mov	@r3,r7
(2)  379/FFFFFFFFC0000276 : 3718                		sub 	r1,r7
(2)  380/FFFFFFFFC0000278 : 6613                		mov 	r1,r6
(2)  381/FFFFFFFFC000027A : 4628                		shll16	r6
(2)  382/FFFFFFFFC000027C : 4718                		shll8	r7
(2)  383/FFFFFFFFC000027E : 9073                		mov	#_JR,r0
(2)  384/FFFFFFFFC0000280 : 2092                		mov	r9,@r0
(2)  385/FFFFFFFFC0000282 : 1071                		mov	r7,@(4,r0)
(2)  386/FFFFFFFFC0000284 : 0009                		nop
(2)  387/FFFFFFFFC0000286 : 5701                		mov	@(4,r0),r7
(2)  388/FFFFFFFFC0000288 : 4718                		shll8	r7
(2)  389/FFFFFFFFC000028A :                     .rgt_skip:
(2)  390/FFFFFFFFC000028A : 000B                		rts
(2)  391/FFFFFFFFC000028C : 0009                		nop
(2)  392/FFFFFFFFC000028E :                     		align 4
(2)  393/FFFFFFFFC0000290 :                     
(2)  394/FFFFFFFFC0000290 :                     ; --------------------------------
(2)  395/FFFFFFFFC0000290 :                     ; Mark piece
(2)  396/FFFFFFFFC0000290 :                     ; --------------------------------
(2)  397/FFFFFFFFC0000290 :                     
(2)  398/FFFFFFFFC0000290 :                     put_piece:
(2)  399/FFFFFFFFC0000290 : 5821                		mov	@(4,r2),r8
(2)  400/FFFFFFFFC0000292 : 5931                		mov	@(4,r3),r9
(2)  401/FFFFFFFFC0000294 : 38A8                		sub	r10,r8
(2)  402/FFFFFFFFC0000296 : 39A8                		sub	r10,r9
(2)  403/FFFFFFFFC0000298 : 6083                		mov	r8,r0
(2)  404/FFFFFFFFC000029A : 3987                		cmp/gt	r8,r9
(2)  405/FFFFFFFFC000029C : 8900                		bt	.lefth
(2)  406/FFFFFFFFC000029E : 6093                		mov	r9,r0
(2)  407/FFFFFFFFC00002A0 :                     .lefth:
(2)  408/FFFFFFFFC00002A0 : 1143                		mov 	r4,@(plypz_xl,r1)
(2)  409/FFFFFFFFC00002A2 : 1154                		mov 	r5,@(plypz_xl_dx,r1)
(2)  410/FFFFFFFFC00002A4 : 1165                		mov 	r6,@(plypz_xr,r1)
(2)  411/FFFFFFFFC00002A6 : 1176                		mov 	r7,@(plypz_xr_dx,r1)
(2)  412/FFFFFFFFC00002A8 : 350D                		dmuls	r0,r5
(2)  413/FFFFFFFFC00002AA : 021A                		sts	macl,r2
(2)  414/FFFFFFFFC00002AC : 370D                		dmuls	r0,r7
(2)  415/FFFFFFFFC00002AE : 031A                		sts	macl,r3
(2)  416/FFFFFFFFC00002B0 : 342C                		add 	r2,r4
(2)  417/FFFFFFFFC00002B2 : 363C                		add	r3,r6
(2)  418/FFFFFFFFC00002B4 : 62A3                		mov	r10,r2
(2)  419/FFFFFFFFC00002B6 : 3A0C                		add	r0,r10
(2)  420/FFFFFFFFC00002B8 : 63A3                		mov	r10,r3
(2)  421/FFFFFFFFC00002BA : 4228                		shll16	r2
(2)  422/FFFFFFFFC00002BC : 232B                		or	r2,r3
(2)  423/FFFFFFFFC00002BE : 1132                		mov	r3,@(plypz_ypos,r1)
(2)  424/FFFFFFFFC00002C0 : 2F36                		mov	r3,@-r15
(2)  425/FFFFFFFFC00002C2 : D223                		mov	#Cach_DDA_Src_L,r2
(2)  426/FFFFFFFFC00002C4 : 6522                		mov	@r2,r5
(2)  427/FFFFFFFFC00002C6 : 1157                		mov	r5,@(plypz_src_xl,r1)
(2)  428/FFFFFFFFC00002C8 : 5721                		mov	@(4,r2),r7
(2)  429/FFFFFFFFC00002CA : 1178                		mov	r7,@(plypz_src_xl_dx,r1)
(2)  430/FFFFFFFFC00002CC : 5822                		mov	@(8,r2),r8
(2)  431/FFFFFFFFC00002CE : 1189                		mov	r8,@(plypz_src_yl,r1)
(2)  432/FFFFFFFFC00002D0 : 5923                		mov	@($C,r2),r9
(2)  433/FFFFFFFFC00002D2 : 119A                		mov	r9,@(plypz_src_yl_dx,r1)
(2)  434/FFFFFFFFC00002D4 : 370D                		dmuls	r0,r7
(2)  435/FFFFFFFFC00002D6 : 021A                		sts	macl,r2
(2)  436/FFFFFFFFC00002D8 : 390D                		dmuls	r0,r9
(2)  437/FFFFFFFFC00002DA : 031A                		sts	macl,r3
(2)  438/FFFFFFFFC00002DC : 352C                		add 	r2,r5
(2)  439/FFFFFFFFC00002DE : 383C                		add	r3,r8
(2)  440/FFFFFFFFC00002E0 : D21C                		mov	#Cach_DDA_Src_L,r2
(2)  441/FFFFFFFFC00002E2 : 2252                		mov	r5,@r2
(2)  442/FFFFFFFFC00002E4 : 1282                		mov	r8,@(8,r2)
(2)  443/FFFFFFFFC00002E6 : D21C                		mov	#Cach_DDA_Src_R,r2
(2)  444/FFFFFFFFC00002E8 : 6522                		mov	@r2,r5
(2)  445/FFFFFFFFC00002EA : 115B                		mov	r5,@(plypz_src_xr,r1)
(2)  446/FFFFFFFFC00002EC : 5721                		mov	@(4,r2),r7
(2)  447/FFFFFFFFC00002EE : 117C                		mov	r7,@(plypz_src_xr_dx,r1)
(2)  448/FFFFFFFFC00002F0 : 5822                		mov	@(8,r2),r8
(2)  449/FFFFFFFFC00002F2 : 118D                		mov	r8,@(plypz_src_yr,r1)
(2)  450/FFFFFFFFC00002F4 : 5923                		mov	@($C,r2),r9
(2)  451/FFFFFFFFC00002F6 : 119E                		mov	r9,@(plypz_src_yr_dx,r1)
(2)  452/FFFFFFFFC00002F8 : 370D                		dmuls	r0,r7
(2)  453/FFFFFFFFC00002FA : 021A                		sts	macl,r2
(2)  454/FFFFFFFFC00002FC : 390D                		dmuls	r0,r9
(2)  455/FFFFFFFFC00002FE : 031A                		sts	macl,r3
(2)  456/FFFFFFFFC0000300 : 352C                		add 	r2,r5
(2)  457/FFFFFFFFC0000302 : 383C                		add	r3,r8
(2)  458/FFFFFFFFC0000304 : D215                		mov	#Cach_DDA_Src_R,r2
(2)  459/FFFFFFFFC0000306 : 2252                		mov	r5,@r2
(2)  460/FFFFFFFFC0000308 : 1282                		mov	r8,@(8,r2)
(2)  461/FFFFFFFFC000030A : 63F6                		mov	@r15+,r3
(2)  462/FFFFFFFFC000030C : 4315                		cmp/pl	r3			; TOP check, 2 steps
(2)  463/FFFFFFFFC000030E : 8902                		bt	.top_neg
(2)  464/FFFFFFFFC0000310 : 4328                		shll16	r3
(2)  465/FFFFFFFFC0000312 : 4315                		cmp/pl	r3
(2)  466/FFFFFFFFC0000314 : 8B0E                		bf	.bad_piece
(2)  467/FFFFFFFFC0000316 :                     .top_neg:
(2)  468/FFFFFFFFC0000316 : 50E1                		mov	@(polygn_mtrl,r14),r0
(2)  469/FFFFFFFFC0000318 : 1101                		mov 	r0,@(plypz_mtrl,r1)
(2)  470/FFFFFFFFC000031A : 50E0                		mov	@(polygn_type,r14),r0
(2)  471/FFFFFFFFC000031C : 1100                		mov 	r0,@(plypz_type,r1)
(2)  472/FFFFFFFFC000031E : 713C                		add	#sizeof_plypz,r1
(2)  473/FFFFFFFFC0000320 : 6013                		mov	r1,r0
(2)  474/FFFFFFFFC0000322 : D80F                		mov	#RAM_Mars_VdpDrwList_e,r8
(2)  475/FFFFFFFFC0000324 : 3083                		cmp/ge	r8,r0
(2)  476/FFFFFFFFC0000326 : 8B01                		bf	.dontreset_pz
(2)  477/FFFFFFFFC0000328 : D00E                		mov	#RAM_Mars_VdpDrwList,r0
(2)  478/FFFFFFFFC000032A : 6103                		mov	r0,r1
(2)  479/FFFFFFFFC000032C :                     .dontreset_pz:
(2)  480/FFFFFFFFC000032C : C201                		mov	r0,@(marsGbl_PlyPzList_W,gbr)
(2)  481/FFFFFFFFC000032E : C510                		mov.w	@(marsGbl_PlyPzCntr,gbr),r0
(2)  482/FFFFFFFFC0000330 : 7001                		add	#1,r0
(2)  483/FFFFFFFFC0000332 : C110                		mov.w	r0,@(marsGbl_PlyPzCntr,gbr)
(2)  484/FFFFFFFFC0000334 :                     .bad_piece:
(2)  485/FFFFFFFFC0000334 : 000B                		rts
(2)  486/FFFFFFFFC0000336 : 0009                		nop
(2)  487/FFFFFFFFC0000338 :                     		align 4
(2)  488/FFFFFFFFC0000338 : C000 066C C000 0678 		ltorg
                    C000 0670 C000 067C 
                    C000 0680 C000 0688 
                    C000 066C C000 066C 
                    C000 067C C000 067C 
                    2601 5C10 2601 1890 
                    FF00                
(2)  489/FFFFFFFFC000036A :                     
(2)  490/FFFFFFFFC000036A :                     ; ---------------------------------------
(2)  491/FFFFFFFFC000036A :                     ; Draw polygon pieces
(2)  492/FFFFFFFFC000036A :                     ; ---------------------------------------
(2)  493/FFFFFFFFC000036A :                     
(2)  494/FFFFFFFFC000036A :                     go_drwtask_exit:
(2)  495/FFFFFFFFC000036A : A12B                		bra	drwtask_exit
(2)  496/FFFFFFFFC000036C : 0009                		nop
(2)  497/FFFFFFFFC000036E :                     VideoMars_DrwPlgnPz:
(2)  498/FFFFFFFFC000036E : C510                		mov.w	@(marsGbl_PlyPzCntr,gbr),r0
(2)  499/FFFFFFFFC0000370 : 4015                		cmp/pl	r0
(2)  500/FFFFFFFFC0000372 : 8BFA                		bf	go_drwtask_exit
(2)  501/FFFFFFFFC0000374 : C600                		mov	@(marsGbl_PlyPzList_R,gbr),r0	; r14 - Current pieces pointer to READ
(2)  502/FFFFFFFFC0000376 : 6E03                		mov	r0,r14
(2)  503/FFFFFFFFC0000378 : 59E2                		mov	@(plypz_ypos,r14),r9		; Start grabbing StartY/EndY positions
(2)  504/FFFFFFFFC000037A : 6A93                		mov	r9,r10
(2)  505/FFFFFFFFC000037C : D008                		mov	#$FFFF,r0
(2)  506/FFFFFFFFC000037E : 4929                		shlr16	r9
(2)  507/FFFFFFFFC0000380 : 699F                		exts	r9,r9			;  r9 - Top
(2)  508/FFFFFFFFC0000382 : 2A09                		and	r0,r10			; r10 - Bottom
(2)  509/FFFFFFFFC0000384 : 3090                		cmp/eq	r9,r0			; if Top==Bottom, exit
(2)  510/FFFFFFFFC0000386 : 8908                		bt	.invld_y
(2)  511/FFFFFFFFC0000388 : 900C                		mov	#SCREEN_HEIGHT,r0	; if Top > 224, skip
(2)  512/FFFFFFFFC000038A : 3903                		cmp/ge	r0,r9
(2)  513/FFFFFFFFC000038C : 8905                		bt	.invld_y		; if Bottom > 224, add max limit
(2)  514/FFFFFFFFC000038E : 3A07                		cmp/gt	r0,r10
(2)  515/FFFFFFFFC0000390 : 8B00                		bf	.len_max
(2)  516/FFFFFFFFC0000392 : 6A03                		mov	r0,r10
(2)  517/FFFFFFFFC0000394 :                     .len_max:
(2)  518/FFFFFFFFC0000394 : 3A98                		sub	r9,r10			; Turn r10 into line lenght (Bottom - Top)
(2)  519/FFFFFFFFC0000396 : 4A15                		cmp/pl	r10
(2)  520/FFFFFFFFC0000398 : 8905                		bt	drwtsk1_vld_y
(2)  521/FFFFFFFFC000039A :                     .invld_y:
(2)  522/FFFFFFFFC000039A : A105                		bra	drwsld_nextpz		; if LEN < 0 then check next one instead.
(2)  523/FFFFFFFFC000039C : 0009                		nop
(2)  524/FFFFFFFFC000039E :                     		align 4
(2)  525/FFFFFFFFC00003A0 : 0000 FFFF 00E0      		ltorg
(2)  526/FFFFFFFFC00003A6 :                     
(2)  527/FFFFFFFFC00003A6 :                     ; ------------------------------------
(2)  528/FFFFFFFFC00003A6 :                     ; If Y top / Y len are valid:
(2)  529/FFFFFFFFC00003A6 :                     ; ------------------------------------
(2)  530/FFFFFFFFC00003A6 :                     
(2)  531/FFFFFFFFC00003A6 :                     drwtsk1_vld_y:
(2)  532/FFFFFFFFC00003A6 : 51E3                		mov	@(plypz_xl,r14),r1		; r1 - X left
(2)  533/FFFFFFFFC00003A8 : 52E4                		mov	@(plypz_xl_dx,r14),r2		; r2 - DX left
(2)  534/FFFFFFFFC00003AA : 53E5                		mov	@(plypz_xr,r14),r3		; r3 - X right
(2)  535/FFFFFFFFC00003AC : 54E6                		mov	@(plypz_xr_dx,r14),r4		; r4 - DX right
(2)  536/FFFFFFFFC00003AE : 50E0                		mov	@(plypz_type,r14),r0		; Check material options
(2)  537/FFFFFFFFC00003B0 : 4029                		shlr16	r0
(2)  538/FFFFFFFFC00003B2 : 4019                		shlr8	r0
(2)  539/FFFFFFFFC00003B4 : C880                 		tst	#PLGN_TEXURE,r0			; Texture mode?
(2)  540/FFFFFFFFC00003B6 : 8B05                 		bf	drwtsk_texmode
(2)  541/FFFFFFFFC00003B8 : A0AC                		bra	drwtsk_solidmode
(2)  542/FFFFFFFFC00003BA : 0009                		nop
(2)  543/FFFFFFFFC00003BC :                     
(2)  544/FFFFFFFFC00003BC :                     ; ------------------------------------
(2)  545/FFFFFFFFC00003BC :                     ; Texture mode
(2)  546/FFFFFFFFC00003BC :                     ;
(2)  547/FFFFFFFFC00003BC :                     ; r1  - XL
(2)  548/FFFFFFFFC00003BC :                     ; r2  - XL DX
(2)  549/FFFFFFFFC00003BC :                     ; r3  - XR
(2)  550/FFFFFFFFC00003BC :                     ; r4  - XR DX
(2)  551/FFFFFFFFC00003BC :                     ; r5  - SRC XL
(2)  552/FFFFFFFFC00003BC :                     ; r6  - SRC XR
(2)  553/FFFFFFFFC00003BC :                     ; r7  - SRC YL
(2)  554/FFFFFFFFC00003BC :                     ; r8  - SRC YR
(2)  555/FFFFFFFFC00003BC :                     ; r9  - Y current
(2)  556/FFFFFFFFC00003BC :                     ; r10  - Number of lines
(2)  557/FFFFFFFFC00003BC :                     ; ------------------------------------
(2)  558/FFFFFFFFC00003BC :                     
(2)  559/FFFFFFFFC00003BC :                     go_drwsld_updline_tex:
(2)  560/FFFFFFFFC00003BC : A088                		bra	drwsld_updline_tex
(2)  561/FFFFFFFFC00003BE : 0009                		nop
(2)  562/FFFFFFFFC00003C0 :                     go_drwtex_gonxtpz:
(2)  563/FFFFFFFFC00003C0 : A094                		bra	drwtex_gonxtpz
(2)  564/FFFFFFFFC00003C2 : 0009                		nop
(2)  565/FFFFFFFFC00003C4 :                     drwtsk_texmode:
(2)  566/FFFFFFFFC00003C4 : 55E7                		mov	@(plypz_src_xl,r14),r5		; Texture X left
(2)  567/FFFFFFFFC00003C6 : 56EB                		mov	@(plypz_src_xr,r14),r6		; Texture X right
(2)  568/FFFFFFFFC00003C8 : 57E9                		mov	@(plypz_src_yl,r14),r7		; Texture Y up
(2)  569/FFFFFFFFC00003CA : 58ED                		mov	@(plypz_src_yr,r14),r8		; Texture Y down
(2)  570/FFFFFFFFC00003CC :                     
(2)  571/FFFFFFFFC00003CC :                     drwsld_nxtline_tex:
(2)  572/FFFFFFFFC00003CC : 4911                		cmp/pz	r9			; Y Start below 0?
(2)  573/FFFFFFFFC00003CE : 8BF5                		bf	go_drwsld_updline_tex
(2)  574/FFFFFFFFC00003D0 : D04F                		mov	tag_yhght,r0		; Y Start after 224?
(2)  575/FFFFFFFFC00003D2 : 3903                		cmp/ge	r0,r9
(2)  576/FFFFFFFFC00003D4 : 89F4                		bt	go_drwtex_gonxtpz
(2)  577/FFFFFFFFC00003D6 : 2F26                		mov	r2,@-r15
(2)  578/FFFFFFFFC00003D8 : 2F36                		mov	r3,@-r15
(2)  579/FFFFFFFFC00003DA : 2F46                		mov	r4,@-r15
(2)  580/FFFFFFFFC00003DC : 2F56                		mov	r5,@-r15
(2)  581/FFFFFFFFC00003DE : 2F66                		mov	r6,@-r15
(2)  582/FFFFFFFFC00003E0 : 2F76                		mov	r7,@-r15
(2)  583/FFFFFFFFC00003E2 : 2F86                		mov	r8,@-r15
(2)  584/FFFFFFFFC00003E4 : 2FA6                		mov	r10,@-r15
(2)  585/FFFFFFFFC00003E6 : 2FD6                		mov	r13,@-r15
(2)  586/FFFFFFFFC00003E8 : 6B13                		mov	r1,r11			; r11 - X left copy
(2)  587/FFFFFFFFC00003EA : 6C33                		mov	r3,r12			; r12 - X right copy
(2)  588/FFFFFFFFC00003EC : 4B29                		shlr16	r11
(2)  589/FFFFFFFFC00003EE : 4C29                		shlr16	r12
(2)  590/FFFFFFFFC00003F0 : 6BBF                		exts	r11,r11
(2)  591/FFFFFFFFC00003F2 : 6CCF                		exts	r12,r12
(2)  592/FFFFFFFFC00003F4 : 60C3                		mov	r12,r0			; r0: X Right - X Left
(2)  593/FFFFFFFFC00003F6 : 30B8                		sub	r11,r0
(2)  594/FFFFFFFFC00003F8 : 4015                		cmp/pl	r0			; Line reversed?
(2)  595/FFFFFFFFC00003FA : 8908                		bt	.txrevers
(2)  596/FFFFFFFFC00003FC : 60C3                		mov	r12,r0			; Swap XL and XR values
(2)  597/FFFFFFFFC00003FE : 6CB3                		mov	r11,r12
(2)  598/FFFFFFFFC0000400 : 6B03                		mov	r0,r11
(2)  599/FFFFFFFFC0000402 : 6053                		mov	r5,r0
(2)  600/FFFFFFFFC0000404 : 6563                		mov	r6,r5
(2)  601/FFFFFFFFC0000406 : 6603                		mov	r0,r6
(2)  602/FFFFFFFFC0000408 : 6073                		mov	r7,r0
(2)  603/FFFFFFFFC000040A : 6783                		mov	r8,r7
(2)  604/FFFFFFFFC000040C : 6803                		mov	r0,r8
(2)  605/FFFFFFFFC000040E :                     .txrevers:
(2)  606/FFFFFFFFC000040E : 3CB0                		cmp/eq	r11,r12				; Same X position?
(2)  607/FFFFFFFFC0000410 : 8955                		bt	.tex_skip_line
(2)  608/FFFFFFFFC0000412 : D03E                		mov	tag_width,r0			; X right < 0?
(2)  609/FFFFFFFFC0000414 : 4C15                		cmp/pl	r12
(2)  610/FFFFFFFFC0000416 : 8B52                		bf	.tex_skip_line
(2)  611/FFFFFFFFC0000418 : 3B07                		cmp/gt	r0,r11				; X left > 320?
(2)  612/FFFFFFFFC000041A : 8950                		bt	.tex_skip_line
(2)  613/FFFFFFFFC000041C : 62C3                		mov	r12,r2
(2)  614/FFFFFFFFC000041E : 60B3                		mov 	r11,r0
(2)  615/FFFFFFFFC0000420 : 3208                		sub 	r0,r2
(2)  616/FFFFFFFFC0000422 : 3658                		sub	r5,r6
(2)  617/FFFFFFFFC0000424 : 3878                		sub	r7,r8
(2)  618/FFFFFFFFC0000426 :                     
(2)  619/FFFFFFFFC0000426 :                     	; Calculate new DX values
(2)  620/FFFFFFFFC0000426 :                     	; make sure DIV is available
(2)  621/FFFFFFFFC0000426 :                     	; (marsGbl_DivStop_M == 0)
(2)  622/FFFFFFFFC0000426 : 90DB                		mov	#_JR,r0				; r6 / r2
(2)  623/FFFFFFFFC0000428 : 2022                		mov	r2,@r0
(2)  624/FFFFFFFFC000042A : 1061                		mov	r6,@(4,r0)
(2)  625/FFFFFFFFC000042C : 0009                		nop
(2)  626/FFFFFFFFC000042E : 5601                		mov	@(4,r0),r6			; r8 / r2
(2)  627/FFFFFFFFC0000430 : 2022                		mov	r2,@r0
(2)  628/FFFFFFFFC0000432 : 1081                		mov	r8,@(4,r0)
(2)  629/FFFFFFFFC0000434 : 0009                		nop
(2)  630/FFFFFFFFC0000436 : 5801                		mov	@(4,r0),r8
(2)  631/FFFFFFFFC0000438 :                     
(2)  632/FFFFFFFFC0000438 :                     	; Limit X destination points
(2)  633/FFFFFFFFC0000438 :                     	; and correct the texture's X positions
(2)  634/FFFFFFFFC0000438 : D034                		mov	tag_width,r0		; XR point > 320?
(2)  635/FFFFFFFFC000043A : 3C07                		cmp/gt	r0,r12
(2)  636/FFFFFFFFC000043C : 8B00                		bf	.tr_fix
(2)  637/FFFFFFFFC000043E : 6C03                		mov	r0,r12				; Force XR to 320
(2)  638/FFFFFFFFC0000440 :                     .tr_fix:
(2)  639/FFFFFFFFC0000440 : 4B11                		cmp/pz	r11				; XL point < 0?
(2)  640/FFFFFFFFC0000442 : 8907                		bt	.tl_fix
(2)  641/FFFFFFFFC0000444 : 62BB                		neg	r11,r2				; Fix texture positions
(2)  642/FFFFFFFFC0000446 : 326D                		dmuls	r6,r2
(2)  643/FFFFFFFFC0000448 : 001A                		sts	macl,r0
(2)  644/FFFFFFFFC000044A : 350C                		add	r0,r5
(2)  645/FFFFFFFFC000044C : 328D                		dmuls	r8,r2
(2)  646/FFFFFFFFC000044E : 001A                		sts	macl,r0
(2)  647/FFFFFFFFC0000450 : 370C                		add	r0,r7
(2)  648/FFFFFFFFC0000452 : 2BBA                		xor	r11,r11				; And reset XL to 0
(2)  649/FFFFFFFFC0000454 :                     .tl_fix:
(2)  650/FFFFFFFFC0000454 :                     
(2)  651/FFFFFFFFC0000454 :                     	; *** WORD WRITES ***
(2)  652/FFFFFFFFC0000454 :                     	; r11 - X left
(2)  653/FFFFFFFFC0000454 :                     	; r12 - X right
(2)  654/FFFFFFFFC0000454 :                     	; r9 - Current Y line
(2)  655/FFFFFFFFC0000454 : E0FE                		mov	#-2,r0
(2)  656/FFFFFFFFC0000456 : 2B09                		and	r0,r11
(2)  657/FFFFFFFFC0000458 : 2C09                		and	r0,r12
(2)  658/FFFFFFFFC000045A : 3CB8                		sub 	r11,r12
(2)  659/FFFFFFFFC000045C : 4C21                		shar	r12
(2)  660/FFFFFFFFC000045E : 4C15                		cmp/pl	r12
(2)  661/FFFFFFFFC0000460 : 8B2D                		bf	.tex_skip_line
(2)  662/FFFFFFFFC0000462 :                     
(2)  663/FFFFFFFFC0000462 : DA59                		mov	#_overwrite+$200,r10
(2)  664/FFFFFFFFC0000464 : 6093                		mov 	r9,r0			; Y position * $200
(2)  665/FFFFFFFFC0000466 : 4018                		shll8	r0
(2)  666/FFFFFFFFC0000468 : 4000                		shll	r0
(2)  667/FFFFFFFFC000046A : 3A0C                		add 	r0,r10			; Add Y
(2)  668/FFFFFFFFC000046C : 3ABC                		add 	r11,r10			; Add X
(2)  669/FFFFFFFFC000046E :                     ; 		mov	#_vdpreg,r10
(2)  670/FFFFFFFFC000046E :                     ; .wait:	mov.w	@(10,r10),r0
(2)  671/FFFFFFFFC000046E :                     ; 		tst	#2,r0
(2)  672/FFFFFFFFC000046E :                     ; 		bf	.wait
(2)  673/FFFFFFFFC000046E :                     ; 		mov 	r9,r0		; Y position
(2)  674/FFFFFFFFC000046E :                     ; 		add	#1,r0		; move it to $200
(2)  675/FFFFFFFFC000046E :                     ; 		shll8	r0
(2)  676/FFFFFFFFC000046E :                     ; 		mov	r11,r2
(2)  677/FFFFFFFFC000046E :                     ; 		shlr	r2
(2)  678/FFFFFFFFC000046E :                     ; 		add	r2,r0
(2)  679/FFFFFFFFC000046E :                     ; 		mov.w	r0,@(6,r10)	; address
(2)  680/FFFFFFFFC000046E :                     
(2)  681/FFFFFFFFC000046E : 90B8                		mov	#$FF,r0
(2)  682/FFFFFFFFC0000470 : 54E0                		mov	@(plypz_type,r14),r4	;  r4 - texture width|palinc
(2)  683/FFFFFFFFC0000472 : 6D43                		mov	r4,r13
(2)  684/FFFFFFFFC0000474 : 4429                		shlr16	r4
(2)  685/FFFFFFFFC0000476 : 92B5                		mov	#$1FFF,r2
(2)  686/FFFFFFFFC0000478 : 5BE1                		mov	@(plypz_mtrl,r14),r11	; r11 - texture data
(2)  687/FFFFFFFFC000047A : 2429                		and	r2,r4
(2)  688/FFFFFFFFC000047C : 2D09                		and	r0,r13
(2)  689/FFFFFFFFC000047E :                     .tex_xloop:
(2)  690/FFFFFFFFC000047E : 6273                		mov	r7,r2
(2)  691/FFFFFFFFC0000480 : 4229                		shlr16	r2
(2)  692/FFFFFFFFC0000482 : 242E                		mulu	r2,r4
(2)  693/FFFFFFFFC0000484 : 6253                		mov	r5,r2	   		; Build column index
(2)  694/FFFFFFFFC0000486 : 001A                		sts	macl,r0
(2)  695/FFFFFFFFC0000488 : 4229                		shlr16	r2
(2)  696/FFFFFFFFC000048A : 302C                		add	r2,r0
(2)  697/FFFFFFFFC000048C : 00BC                		mov.b	@(r0,r11),r0		; Read texture pixel
(2)  698/FFFFFFFFC000048E : 30DC                		add	r13,r0			; Add index increment
(2)  699/FFFFFFFFC0000490 : C9FF                		and	#$FF,r0
(2)  700/FFFFFFFFC0000492 : 4018                		shll8	r0
(2)  701/FFFFFFFFC0000494 : 400A                		lds	r0,mach			; Save left pixel
(2)  702/FFFFFFFFC0000496 : 356C                		add	r6,r5			; Update X
(2)  703/FFFFFFFFC0000498 : 378C                		add	r8,r7			; Update Y
(2)  704/FFFFFFFFC000049A : 6273                		mov	r7,r2
(2)  705/FFFFFFFFC000049C : 4229                		shlr16	r2
(2)  706/FFFFFFFFC000049E : 242E                		mulu	r2,r4
(2)  707/FFFFFFFFC00004A0 : 6253                		mov	r5,r2	   		; Build column index
(2)  708/FFFFFFFFC00004A2 : 001A                		sts	macl,r0
(2)  709/FFFFFFFFC00004A4 : 4229                		shlr16	r2
(2)  710/FFFFFFFFC00004A6 : 302C                		add	r2,r0
(2)  711/FFFFFFFFC00004A8 : 00BC                		mov.b	@(r0,r11),r0		; Read texture pixel
(2)  712/FFFFFFFFC00004AA : 30DC                		add	r13,r0			; Add index increment
(2)  713/FFFFFFFFC00004AC : C9FF                		and	#$FF,r0
(2)  714/FFFFFFFFC00004AE : 4C10                		dt	r12
(2)  715/FFFFFFFFC00004B0 : 020A                		sts	mach,r2
(2)  716/FFFFFFFFC00004B2 : 202B                		or	r2,r0
(2)  717/FFFFFFFFC00004B4 :                     ; 		mov	r0,r2
(2)  718/FFFFFFFFC00004B4 :                     ; 		mov	#0,r0
(2)  719/FFFFFFFFC00004B4 :                     ; 		mov.w	r0,@(4,r10)		; length
(2)  720/FFFFFFFFC00004B4 :                     ; 		mov	r2,r0
(2)  721/FFFFFFFFC00004B4 :                     ; 		mov.w	r0,@(8,r10)		; Set data
(2)  722/FFFFFFFFC00004B4 : 2A01                		mov.w	r0,@r10
(2)  723/FFFFFFFFC00004B6 : 7A02                		add	#2,r10
(2)  724/FFFFFFFFC00004B8 : 356C                		add	r6,r5			; Update X
(2)  725/FFFFFFFFC00004BA : 8FE0                		bf/s	.tex_xloop
(2)  726/FFFFFFFFC00004BC : 378C                		add	r8,r7			; Update Y
(2)  727/FFFFFFFFC00004BE :                     	; ***END***
(2)  728/FFFFFFFFC00004BE :                     
(2)  729/FFFFFFFFC00004BE :                     ; 	; *** BYTE WRITES
(2)  730/FFFFFFFFC00004BE :                     ; 	; r11 - X left
(2)  731/FFFFFFFFC00004BE :                     ; 	; r12 - X right
(2)  732/FFFFFFFFC00004BE :                     ; 	; r9 - Current Y line
(2)  733/FFFFFFFFC00004BE :                     ; 		sub 	r11,r12
(2)  734/FFFFFFFFC00004BE :                     ; 		cmp/pl	r12
(2)  735/FFFFFFFFC00004BE :                     ; 		bf	.tex_skip_line
(2)  736/FFFFFFFFC00004BE :                     ; 		mov	#_overwrite+$200,r10
(2)  737/FFFFFFFFC00004BE :                     ; 		mov 	r9,r0			; Y position * $200
(2)  738/FFFFFFFFC00004BE :                     ; 		shll8	r0
(2)  739/FFFFFFFFC00004BE :                     ; 		shll	r0
(2)  740/FFFFFFFFC00004BE :                     ; 		add 	r0,r10			; Add Y
(2)  741/FFFFFFFFC00004BE :                     ; 		add 	r11,r10			; Add X
(2)  742/FFFFFFFFC00004BE :                     ; 		mov	#$FF,r0
(2)  743/FFFFFFFFC00004BE :                     ; 		mov	@(plypz_type,r14),r4	;  r4 - texture width|palinc
(2)  744/FFFFFFFFC00004BE :                     ; 		mov	r4,r13
(2)  745/FFFFFFFFC00004BE :                     ; 		shlr16	r4
(2)  746/FFFFFFFFC00004BE :                     ; 		mov	#$1FFF,r2
(2)  747/FFFFFFFFC00004BE :                     ; 		mov	@(plypz_mtrl,r14),r11	; r11 - texture data
(2)  748/FFFFFFFFC00004BE :                     ; 		and	r2,r4
(2)  749/FFFFFFFFC00004BE :                     ; 		and	r0,r13
(2)  750/FFFFFFFFC00004BE :                     ; .tex_xloop:
(2)  751/FFFFFFFFC00004BE :                     ; 		mov	r7,r2
(2)  752/FFFFFFFFC00004BE :                     ; 		shlr16	r2
(2)  753/FFFFFFFFC00004BE :                     ; 		mulu	r2,r4
(2)  754/FFFFFFFFC00004BE :                     ; 		mov	r5,r2	   		; Build column index
(2)  755/FFFFFFFFC00004BE :                     ; 		sts	macl,r0
(2)  756/FFFFFFFFC00004BE :                     ; 		shlr16	r2
(2)  757/FFFFFFFFC00004BE :                     ; 		add	r2,r0
(2)  758/FFFFFFFFC00004BE :                     ; 		mov.b	@(r0,r11),r0		; Read texture pixel
(2)  759/FFFFFFFFC00004BE :                     ; 		add	r13,r0			; Add index increment
(2)  760/FFFFFFFFC00004BE :                     ; 		and	#$FF,r0
(2)  761/FFFFFFFFC00004BE :                     ; 		add 	#1,r10
(2)  762/FFFFFFFFC00004BE :                     ; 		add	r6,r5			; Update X
(2)  763/FFFFFFFFC00004BE :                     ; 		dt	r12
(2)  764/FFFFFFFFC00004BE :                     ; 		mov.b	r0,@r10	   		; Write pixel to Framebuffer
(2)  765/FFFFFFFFC00004BE :                     ; 		bf/s	.tex_xloop
(2)  766/FFFFFFFFC00004BE :                     ; 		add	r8,r7			; Update Y
(2)  767/FFFFFFFFC00004BE :                     ; ; 	; ***END***
(2)  768/FFFFFFFFC00004BE :                     
(2)  769/FFFFFFFFC00004BE :                     .tex_skip_line:
(2)  770/FFFFFFFFC00004BE : 6DF6                		mov	@r15+,r13
(2)  771/FFFFFFFFC00004C0 : 6AF6                		mov	@r15+,r10
(2)  772/FFFFFFFFC00004C2 : 68F6                		mov	@r15+,r8
(2)  773/FFFFFFFFC00004C4 : 67F6                		mov	@r15+,r7
(2)  774/FFFFFFFFC00004C6 : 66F6                		mov	@r15+,r6
(2)  775/FFFFFFFFC00004C8 : 65F6                		mov	@r15+,r5
(2)  776/FFFFFFFFC00004CA : 64F6                		mov	@r15+,r4
(2)  777/FFFFFFFFC00004CC : 63F6                		mov	@r15+,r3
(2)  778/FFFFFFFFC00004CE : 62F6                		mov	@r15+,r2
(2)  779/FFFFFFFFC00004D0 :                     drwsld_updline_tex:
(2)  780/FFFFFFFFC00004D0 : 50E8                		mov	@(plypz_src_xl_dx,r14),r0	; Update DX postions
(2)  781/FFFFFFFFC00004D2 : 350C                		add	r0,r5
(2)  782/FFFFFFFFC00004D4 : 50EC                		mov	@(plypz_src_xr_dx,r14),r0
(2)  783/FFFFFFFFC00004D6 : 360C                		add	r0,r6
(2)  784/FFFFFFFFC00004D8 : 50EA                		mov	@(plypz_src_yl_dx,r14),r0
(2)  785/FFFFFFFFC00004DA : 370C                		add	r0,r7
(2)  786/FFFFFFFFC00004DC : 50EE                		mov	@(plypz_src_yr_dx,r14),r0
(2)  787/FFFFFFFFC00004DE : 380C                		add	r0,r8
(2)  788/FFFFFFFFC00004E0 : 312C                		add	r2,r1				; Update X postions
(2)  789/FFFFFFFFC00004E2 : 4A10                		dt	r10
(2)  790/FFFFFFFFC00004E4 : 8D02                		bt/s	drwtex_gonxtpz
(2)  791/FFFFFFFFC00004E6 : 334C                		add	r4,r3
(2)  792/FFFFFFFFC00004E8 : AF70                		bra	drwsld_nxtline_tex
(2)  793/FFFFFFFFC00004EA : 7901                		add	#1,r9
(2)  794/FFFFFFFFC00004EC :                     
(2)  795/FFFFFFFFC00004EC :                     drwtex_gonxtpz:
(2)  796/FFFFFFFFC00004EC : 7E3C                		add	#sizeof_plypz,r14		; And set new point
(2)  797/FFFFFFFFC00004EE : 60E3                		mov	r14,r0
(2)  798/FFFFFFFFC00004F0 : DE36                		mov	#RAM_Mars_VdpDrwList_e,r14	; End-of-list?
(2)  799/FFFFFFFFC00004F2 : 30E3                		cmp/ge	r14,r0
(2)  800/FFFFFFFFC00004F4 : 8B00                		bf	.reset_rd
(2)  801/FFFFFFFFC00004F6 : D036                		mov	#RAM_Mars_VdpDrwList,r0
(2)  802/FFFFFFFFC00004F8 :                     .reset_rd:
(2)  803/FFFFFFFFC00004F8 : C200                		mov	r0,@(marsGbl_PlyPzList_R,gbr)
(2)  804/FFFFFFFFC00004FA :                     
(2)  805/FFFFFFFFC00004FA : C510                		mov.w	@(marsGbl_PlyPzCntr,gbr),r0	; Decrement piece
(2)  806/FFFFFFFFC00004FC : 70FF                		add	#-1,r0
(2)  807/FFFFFFFFC00004FE : C110                		mov.w	r0,@(marsGbl_PlyPzCntr,gbr)
(2)  808/FFFFFFFFC0000500 : 4015                		cmp/pl	r0
(2)  809/FFFFFFFFC0000502 : 8B01                		bf	.finish_it
(2)  810/FFFFFFFFC0000504 : AF33                		bra	VideoMars_DrwPlgnPz
(2)  811/FFFFFFFFC0000506 : 0009                		nop
(2)  812/FFFFFFFFC0000508 :                     .finish_it:
(2)  813/FFFFFFFFC0000508 : A05C                		bra	drwtask_exit
(2)  814/FFFFFFFFC000050A : 0009                		nop
(2)  815/FFFFFFFFC000050C :                     		align 4
(2)  816/FFFFFFFFC000050C : 0000 0140           tag_width:	dc.l SCREEN_WIDTH
(2)  817/FFFFFFFFC0000510 : 0000 00E0           tag_yhght:	dc.l SCREEN_HEIGHT
(2)  818/FFFFFFFFC0000514 :                     
(2)  819/FFFFFFFFC0000514 :                     ; ------------------------------------
(2)  820/FFFFFFFFC0000514 :                     ; Solid Color
(2)  821/FFFFFFFFC0000514 :                     ;
(2)  822/FFFFFFFFC0000514 :                     ; r1  - XL
(2)  823/FFFFFFFFC0000514 :                     ; r2  - XL DX
(2)  824/FFFFFFFFC0000514 :                     ; r3  - XR
(2)  825/FFFFFFFFC0000514 :                     ; r4  - XR DX
(2)  826/FFFFFFFFC0000514 :                     ; r9  - Y current
(2)  827/FFFFFFFFC0000514 :                     ; r10  - Number of lines
(2)  828/FFFFFFFFC0000514 :                     ; ------------------------------------
(2)  829/FFFFFFFFC0000514 :                     
(2)  830/FFFFFFFFC0000514 :                     drwtsk_solidmode:
(2)  831/FFFFFFFFC0000514 : 9065                		mov	#$FF,r0
(2)  832/FFFFFFFFC0000516 : 56E1                		mov	@(plypz_mtrl,r14),r6
(2)  833/FFFFFFFFC0000518 : 55E0                		mov	@(plypz_type,r14),r5
(2)  834/FFFFFFFFC000051A : 2509                		and	r0,r5
(2)  835/FFFFFFFFC000051C : 2609                		and	r0,r6
(2)  836/FFFFFFFFC000051E : 365C                		add	r5,r6
(2)  837/FFFFFFFFC0000520 : DD2C                		mov	#_vdpreg,r13
(2)  838/FFFFFFFFC0000522 : 85D5                .wait:		mov.w	@(10,r13),r0
(2)  839/FFFFFFFFC0000524 : C802                		tst	#2,r0
(2)  840/FFFFFFFFC0000526 : 8BFC                		bf	.wait
(2)  841/FFFFFFFFC0000528 :                     drwsld_nxtline:
(2)  842/FFFFFFFFC0000528 : 6093                		mov	r9,r0
(2)  843/FFFFFFFFC000052A : 30AC                		add	r10,r0
(2)  844/FFFFFFFFC000052C : 4015                		cmp/pl	r0
(2)  845/FFFFFFFFC000052E : 8B3B                		bf	drwsld_nextpz
(2)  846/FFFFFFFFC0000530 : 4911                		cmp/pz	r9
(2)  847/FFFFFFFFC0000532 : 8B34                		bf	drwsld_updline
(2)  848/FFFFFFFFC0000534 : 9057                		mov	#SCREEN_HEIGHT,r0
(2)  849/FFFFFFFFC0000536 : 3907                		cmp/gt	r0,r9
(2)  850/FFFFFFFFC0000538 : 8936                		bt	drwsld_nextpz
(2)  851/FFFFFFFFC000053A :                     
(2)  852/FFFFFFFFC000053A : 6B13                		mov	r1,r11
(2)  853/FFFFFFFFC000053C : 6C33                		mov	r3,r12
(2)  854/FFFFFFFFC000053E : 4B29                		shlr16	r11
(2)  855/FFFFFFFFC0000540 : 4C29                		shlr16	r12
(2)  856/FFFFFFFFC0000542 : 6BBF                		exts	r11,r11
(2)  857/FFFFFFFFC0000544 : 6CCF                		exts	r12,r12
(2)  858/FFFFFFFFC0000546 : 60C3                		mov	r12,r0
(2)  859/FFFFFFFFC0000548 : 30B8                		sub	r11,r0
(2)  860/FFFFFFFFC000054A : 4011                		cmp/pz	r0
(2)  861/FFFFFFFFC000054C : 8902                		bt	.revers
(2)  862/FFFFFFFFC000054E : 60C3                		mov	r12,r0
(2)  863/FFFFFFFFC0000550 : 6CB3                		mov	r11,r12
(2)  864/FFFFFFFFC0000552 : 6B03                		mov	r0,r11
(2)  865/FFFFFFFFC0000554 :                     .revers:
(2)  866/FFFFFFFFC0000554 : 9048                		mov	#SCREEN_WIDTH-2,r0
(2)  867/FFFFFFFFC0000556 : 4C15                		cmp/pl	r12
(2)  868/FFFFFFFFC0000558 : 8B21                		bf	drwsld_updline
(2)  869/FFFFFFFFC000055A : 3B07                		cmp/gt	r0,r11
(2)  870/FFFFFFFFC000055C : 891F                		bt	drwsld_updline
(2)  871/FFFFFFFFC000055E : 3C07                		cmp/gt	r0,r12
(2)  872/FFFFFFFFC0000560 : 8B00                		bf	.r_fix
(2)  873/FFFFFFFFC0000562 : 6C03                		mov	r0,r12
(2)  874/FFFFFFFFC0000564 :                     .r_fix:
(2)  875/FFFFFFFFC0000564 : 4B15                		cmp/pl	r11
(2)  876/FFFFFFFFC0000566 : 8900                		bt	.l_fix
(2)  877/FFFFFFFFC0000568 : 2BBA                		xor	r11,r11
(2)  878/FFFFFFFFC000056A :                     .l_fix:
(2)  879/FFFFFFFFC000056A : E0FE                		mov	#-2,r0
(2)  880/FFFFFFFFC000056C : 2B09                		and	r0,r11
(2)  881/FFFFFFFFC000056E : 2C09                		and	r0,r12
(2)  882/FFFFFFFFC0000570 : 60C3                		mov	r12,r0
(2)  883/FFFFFFFFC0000572 : 30B8                		sub	r11,r0
(2)  884/FFFFFFFFC0000574 : 4015                		cmp/pl	r0
(2)  885/FFFFFFFFC0000576 : 8B12                		bf	drwsld_updline
(2)  886/FFFFFFFFC0000578 :                     
(2)  887/FFFFFFFFC0000578 : 85D5                .wait:		mov.w	@(10,r13),r0
(2)  888/FFFFFFFFC000057A : C802                		tst	#2,r0
(2)  889/FFFFFFFFC000057C : 8BFC                		bf	.wait
(2)  890/FFFFFFFFC000057E : 60C3                		mov	r12,r0
(2)  891/FFFFFFFFC0000580 : 30B8                		sub	r11,r0
(2)  892/FFFFFFFFC0000582 : 6C03                		mov	r0,r12
(2)  893/FFFFFFFFC0000584 : 4001                		shlr	r0
(2)  894/FFFFFFFFC0000586 : 81D2                		mov.w	r0,@(4,r13)	; length
(2)  895/FFFFFFFFC0000588 : 60B3                		mov	r11,r0
(2)  896/FFFFFFFFC000058A : 4001                		shlr	r0
(2)  897/FFFFFFFFC000058C : 6593                		mov	r9,r5
(2)  898/FFFFFFFFC000058E : 7501                		add	#1,r5
(2)  899/FFFFFFFFC0000590 : 4518                		shll8	r5
(2)  900/FFFFFFFFC0000592 : 305C                		add	r5,r0
(2)  901/FFFFFFFFC0000594 : 81D3                		mov.w	r0,@(6,r13)	; address
(2)  902/FFFFFFFFC0000596 : 6063                		mov	r6,r0
(2)  903/FFFFFFFFC0000598 : 4018                		shll8	r0
(2)  904/FFFFFFFFC000059A : 206B                		or	r6,r0
(2)  905/FFFFFFFFC000059C : 81D4                		mov.w	r0,@(8,r13)	; Set data
(2)  906/FFFFFFFFC000059E :                     ; .wait:		mov.w	@(10,r13),r0
(2)  907/FFFFFFFFC000059E :                     ; 		tst	#2,r0
(2)  908/FFFFFFFFC000059E :                     ; 		bf	.wait
(2)  909/FFFFFFFFC000059E :                     
(2)  910/FFFFFFFFC000059E :                     ; 	If the line is too large, leave it to VDP
(2)  911/FFFFFFFFC000059E :                     ; 	and exit watchdog, we will come back on
(2)  912/FFFFFFFFC000059E :                     ; 	next trigger.
(2)  913/FFFFFFFFC000059E :                     ; 		mov	#$28,r0
(2)  914/FFFFFFFFC000059E :                     ; 		cmp/gt	r0,r12
(2)  915/FFFFFFFFC000059E :                     ; 		bf	drwsld_updline
(2)  916/FFFFFFFFC000059E :                     ; 		mov	#2,r0
(2)  917/FFFFFFFFC000059E :                     ; 		mov.w	r0,@(marsGbl_DrwTask,gbr)
(2)  918/FFFFFFFFC000059E :                     ; 		mov	#Cach_Bkup_S,r0
(2)  919/FFFFFFFFC000059E :                     ; 		mov	r1,@-r0
(2)  920/FFFFFFFFC000059E :                     ; 		mov	r2,@-r0
(2)  921/FFFFFFFFC000059E :                     ; 		mov	r3,@-r0
(2)  922/FFFFFFFFC000059E :                     ; 		mov	r4,@-r0
(2)  923/FFFFFFFFC000059E :                     ; 		mov	r5,@-r0
(2)  924/FFFFFFFFC000059E :                     ; 		mov	r6,@-r0
(2)  925/FFFFFFFFC000059E :                     ; 		mov	r7,@-r0
(2)  926/FFFFFFFFC000059E :                     ; 		mov	r8,@-r0
(2)  927/FFFFFFFFC000059E :                     ; 		mov	r9,@-r0
(2)  928/FFFFFFFFC000059E :                     ; 		mov	r10,@-r0
(2)  929/FFFFFFFFC000059E :                     ; 		mov	r11,@-r0
(2)  930/FFFFFFFFC000059E :                     ; 		mov	r12,@-r0
(2)  931/FFFFFFFFC000059E :                     ; 		mov	r13,@-r0
(2)  932/FFFFFFFFC000059E :                     ; 		mov	r14,@-r0
(2)  933/FFFFFFFFC000059E :                     ; 		bra	drwtask_return
(2)  934/FFFFFFFFC000059E :                     ; 		mov	#$10,r2			; Exit and re-enter
(2)  935/FFFFFFFFC000059E :                     
(2)  936/FFFFFFFFC000059E :                     drwsld_updline:
(2)  937/FFFFFFFFC000059E : 312C                		add	r2,r1
(2)  938/FFFFFFFFC00005A0 : 334C                		add	r4,r3
(2)  939/FFFFFFFFC00005A2 : 4A10                		dt	r10
(2)  940/FFFFFFFFC00005A4 : 8FC0                		bf/s	drwsld_nxtline
(2)  941/FFFFFFFFC00005A6 : 7901                		add	#1,r9
(2)  942/FFFFFFFFC00005A8 :                     
(2)  943/FFFFFFFFC00005A8 :                     ; ------------------------------------
(2)  944/FFFFFFFFC00005A8 :                     
(2)  945/FFFFFFFFC00005A8 :                     drwsld_nextpz:
(2)  946/FFFFFFFFC00005A8 : 7E3C                		add	#sizeof_plypz,r14		; And set new point
(2)  947/FFFFFFFFC00005AA : 60E3                		mov	r14,r0
(2)  948/FFFFFFFFC00005AC : DE0A                		mov	#RAM_Mars_VdpDrwList_e,r14	; End-of-list?
(2)  949/FFFFFFFFC00005AE : 30E3                		cmp/ge	r14,r0
(2)  950/FFFFFFFFC00005B0 : 8B00                		bf	.reset_rd
(2)  951/FFFFFFFFC00005B2 : D00A                		mov	#RAM_Mars_VdpDrwList,r0
(2)  952/FFFFFFFFC00005B4 :                     .reset_rd:
(2)  953/FFFFFFFFC00005B4 : C200                		mov	r0,@(marsGbl_PlyPzList_R,gbr)
(2)  954/FFFFFFFFC00005B6 : C510                		mov.w	@(marsGbl_PlyPzCntr,gbr),r0	; Decrement piece
(2)  955/FFFFFFFFC00005B8 : 70FF                		add	#-1,r0
(2)  956/FFFFFFFFC00005BA : C110                		mov.w	r0,@(marsGbl_PlyPzCntr,gbr)
(2)  957/FFFFFFFFC00005BC : 4015                		cmp/pl	r0
(2)  958/FFFFFFFFC00005BE : 8B01                		bf	.finish_it
(2)  959/FFFFFFFFC00005C0 : AED5                		bra	VideoMars_DrwPlgnPz
(2)  960/FFFFFFFFC00005C2 : 0009                		nop
(2)  961/FFFFFFFFC00005C4 :                     .finish_it:
(2)  962/FFFFFFFFC00005C4 :                     
(2)  963/FFFFFFFFC00005C4 :                     drwtask_exit:
(2)  964/FFFFFFFFC00005C4 : 000B                		rts
(2)  965/FFFFFFFFC00005C6 : 0009                		nop
(2)  966/FFFFFFFFC00005C8 :                     		align 4
(2)  967/FFFFFFFFC00005C8 : 0402 0200 2601 5C10 		ltorg
                    2601 1890 2000 4100 
                    2601 5C10 2601 1890 
                    FF00 00FF 1FFF 00E0 
                    013E                
(2)  968/FFFFFFFFC00005EA :                     
(2)  969/FFFFFFFFC00005EA :                     ; ------------------------------------------------
(2)  970/FFFFFFFFC00005EA :                     
(2)  971/FFFFFFFFC00005EA :                     		align 4
(2)  972/FFFFFFFFC00005EC :                     Cach_Bkup_L	ds.l 16		;
(2)  973/FFFFFFFFC000062C :                     Cach_Bkup_S	ds.l 0		; <-- Reads backwards
(2)  974/FFFFFFFFC000062C :                     Cach_DDA_Top	ds.l 2*2	; First 2 points
(2)  975/FFFFFFFFC000063C :                     Cach_DDA_Last	ds.l 2*2	; Triangle or Quad (+8)
(2)  976/FFFFFFFFC000064C :                     Cach_DDA_Src	ds.l 4*2
(2)  977/FFFFFFFFC000066C :                     Cach_DDA_Src_L	ds.l 4		; X/DX/Y/DX result for textures
(2)  978/FFFFFFFFC000067C :                     Cach_DDA_Src_R	ds.l 4
(2)  979/FFFFFFFFC000068C :                     
(2)  980/FFFFFFFFC000068C :                     Cach_XHead_L	ds.l 1		; Left draw beam
(2)  981/FFFFFFFFC0000690 :                     Cach_XHead_R	ds.l 1		; Right draw beam
(2)  982/FFFFFFFFC0000694 :                     Cach_YHead_U	ds.l 1		; Top draw beam
(2)  983/FFFFFFFFC0000698 :                     Cach_YHead_D	ds.l 1		; Bottom draw beam
(2)  984/FFFFFFFFC000069C :                     Cach_BgFbPos_V	ds.l 1		; Framebuffer Y DIRECT position (then multiply with internal WIDTH externally)
(2)  985/FFFFFFFFC00006A0 :                     Cach_BgFbPos_H	ds.l 1		; Framebuffer TOPLEFT position
(2)  986/FFFFFFFFC00006A4 :                     
(2)  987/FFFFFFFFC00006A4 :                     ; ------------------------------------------------
(2)  988/ 6001BA8 :                     .end:		phase CACHE_MASTER+.end&$1FFF
(2)  989/ 6001BA8 :                     CACHE_MASTER_E:
(2)  990/ 6001BA8 :                     		align 4
(2)  994/ 6001BA8 :                     
(2)  995/ 6001BA8 :                     ; ====================================================================
(2)  996/ 6001BA8 :                     ; ----------------------------------------------------------------
(2)  997/ 6001BA8 :                     ; CACHE code for Slave CPU
(2)  998/ 6001BA8 :                     ;
(2)  999/ 6001BA8 :                     ; LIMIT: $800 bytes
(2) 1000/ 6001BA8 :                     ; ----------------------------------------------------------------
(2) 1001/ 6001BA8 :                     
(2) 1002/ 6001BA8 :                     		align 4
(2) 1003/ 6001BA8 :                     CACHE_SLAVE:
(2) 1004/FFFFFFFFC0000000 :                     		phase $C0000000
(2) 1005/FFFFFFFFC0000000 :                     
(2) 1006/FFFFFFFFC0000000 :                     ; ------------------------------------------------
(2) 1007/FFFFFFFFC0000000 :                     ; PWM channels and a copy of Z80's PWM list
(2) 1008/FFFFFFFFC0000000 :                     ; ------------------------------------------------
(2) 1009/FFFFFFFFC0000000 :                     
(2) 1010/FFFFFFFFC0000000 :                     MarsSnd_PwmChnls	ds.b sizeof_sndchn*MAX_PWMCHNL
(2) 1011/FFFFFFFFC0000118 :                     MarsSnd_PwmControl	ds.b $38	; 7 bytes per channel.
(2) 1012/FFFFFFFFC0000150 :                     
(2) 1013/FFFFFFFFC0000150 :                     ; ------------------------------------------------
(2) 1014/FFFFFFFFC0000150 :                     ; PWM Interrupt
(2) 1015/FFFFFFFFC0000150 :                     ; ------------------------------------------------
(2) 1016/FFFFFFFFC0000150 :                     
(2) 1017/FFFFFFFFC0000150 :                     ; **** MUST BE FAST ***
(2) 1018/FFFFFFFFC0000150 :                     
(2) 1019/FFFFFFFFC0000150 :                     s_irq_pwm:
(2) 1020/FFFFFFFFC0000150 : 90AA                		mov	#$F0,r0
(2) 1021/FFFFFFFFC0000152 : 400E                		ldc	r0,sr
(2) 1022/FFFFFFFFC0000154 : 91A9                		mov	#_FRT,r1
(2) 1023/FFFFFFFFC0000156 : 8417                		mov.b	@(7,r1),r0
(2) 1024/FFFFFFFFC0000158 : CA02                		xor	#2,r0
(2) 1025/FFFFFFFFC000015A : 8017                		mov.b	r0,@(7,r1)
(2) 1026/FFFFFFFFC000015C : D14A                		mov	#_sysreg+pwmintclr,r1
(2) 1027/FFFFFFFFC000015E : 2101                		mov.w	r0,@r1
(2) 1028/FFFFFFFFC0000160 :                     
(2) 1029/FFFFFFFFC0000160 :                     ; ------------------------------------------------
(2) 1030/FFFFFFFFC0000160 :                     
(2) 1031/FFFFFFFFC0000160 : 2F26                		mov	r2,@-r15
(2) 1032/FFFFFFFFC0000162 : 2F36                		mov	r3,@-r15
(2) 1033/FFFFFFFFC0000164 : 2F46                		mov	r4,@-r15
(2) 1034/FFFFFFFFC0000166 : 2F56                		mov	r5,@-r15
(2) 1035/FFFFFFFFC0000168 : 2F66                		mov	r6,@-r15
(2) 1036/FFFFFFFFC000016A : 2F76                		mov	r7,@-r15
(2) 1037/FFFFFFFFC000016C : 2F86                		mov	r8,@-r15
(2) 1038/FFFFFFFFC000016E : 2F96                		mov	r9,@-r15
(2) 1039/FFFFFFFFC0000170 : 2FA6                		mov	r10,@-r15
(2) 1040/FFFFFFFFC0000172 : 4F12                		sts	macl,@-r15
(2) 1041/FFFFFFFFC0000174 :                     
(2) 1042/FFFFFFFFC0000174 : DA45                		mov	#MarsSnd_PwmCache,r10
(2) 1043/FFFFFFFFC0000176 : D946                		mov	#MarsSnd_PwmChnls,r9	; r9 - Channel list
(2) 1044/FFFFFFFFC0000178 : E807                		mov 	#MAX_PWMCHNL,r8		; r8 - Number of channels
(2) 1045/FFFFFFFFC000017A : E700                		mov 	#0,r7			; r7 - RIGHT BASE wave
(2) 1046/FFFFFFFFC000017C : E600                		mov 	#0,r6			; r6 - LEFT BASE wave
(2) 1047/FFFFFFFFC000017E :                     .loop:
(2) 1048/FFFFFFFFC000017E : 5090                		mov	@(mchnsnd_enbl,r9),r0	; Channel enabled? (non-Zero)
(2) 1049/FFFFFFFFC0000180 : 8800                		cmp/eq	#0,r0
(2) 1050/FFFFFFFFC0000182 : 8B03                		bf	.on
(2) 1051/FFFFFFFFC0000184 :                     .silent:
(2) 1052/FFFFFFFFC0000184 : E07F                		mov	#$7F,r0
(2) 1053/FFFFFFFFC0000186 : 6203                		mov	r0,r2
(2) 1054/FFFFFFFFC0000188 : A05F                		bra	.skip
(2) 1055/FFFFFFFFC000018A : 6103                		mov	r0,r1
(2) 1056/FFFFFFFFC000018C :                     .on:
(2) 1057/FFFFFFFFC000018C : 5491                		mov 	@(mchnsnd_read,r9),r4
(2) 1058/FFFFFFFFC000018E : 6343                		mov	r4,r3
(2) 1059/FFFFFFFFC0000190 : 5095                		mov 	@(mchnsnd_end,r9),r0
(2) 1060/FFFFFFFFC0000192 : D140                		mov	#$00FFFFFF,r1
(2) 1061/FFFFFFFFC0000194 : 4319                		shlr8	r3
(2) 1062/FFFFFFFFC0000196 : 4019                		shlr8	r0
(2) 1063/FFFFFFFFC0000198 : 2319                		and	r1,r3
(2) 1064/FFFFFFFFC000019A : 2019                		and	r1,r0
(2) 1065/FFFFFFFFC000019C : 3302                		cmp/hs	r0,r3
(2) 1066/FFFFFFFFC000019E : 8B0D                		bf	.read
(2) 1067/FFFFFFFFC00001A0 : 5098                		mov 	@(mchnsnd_flags,r9),r0
(2) 1068/FFFFFFFFC00001A2 : C804                		tst	#%00000100,r0
(2) 1069/FFFFFFFFC00001A4 : 8B03                		bf	.loop_me
(2) 1070/FFFFFFFFC00001A6 : E000                		mov 	#0,r0
(2) 1071/FFFFFFFFC00001A8 : 1900                		mov 	r0,@(mchnsnd_enbl,r9)
(2) 1072/FFFFFFFFC00001AA : AFEB                		bra	.silent
(2) 1073/FFFFFFFFC00001AC : 0009                		nop
(2) 1074/FFFFFFFFC00001AE :                     .loop_me:
(2) 1075/FFFFFFFFC00001AE : 5098                		mov 	@(mchnsnd_flags,r9),r0
(2) 1076/FFFFFFFFC00001B0 : 5196                		mov	@(mchnsnd_loop,r9),r1
(2) 1077/FFFFFFFFC00001B2 : 5494                		mov 	@(mchnsnd_start,r9),r4
(2) 1078/FFFFFFFFC00001B4 : C808                		tst	#%00001000,r0
(2) 1079/FFFFFFFFC00001B6 : 8900                		bt	.mono_l
(2) 1080/FFFFFFFFC00001B8 : 4100                		shll	r1
(2) 1081/FFFFFFFFC00001BA :                     .mono_l:
(2) 1082/FFFFFFFFC00001BA : 341C                		add	r1,r4
(2) 1083/FFFFFFFFC00001BC :                     
(2) 1084/FFFFFFFFC00001BC :                     ; read wave
(2) 1085/FFFFFFFFC00001BC :                     ; r4 - WAVE READ pointer
(2) 1086/FFFFFFFFC00001BC :                     .read:
(2) 1087/FFFFFFFFC00001BC : 5597                		mov 	@(mchnsnd_pitch,r9),r5	; Check if sample is on ROM
(2) 1088/FFFFFFFFC00001BE : 5293                		mov 	@(mchnsnd_bank,r9),r2
(2) 1089/FFFFFFFFC00001C0 : D035                		mov	#CS1,r0
(2) 1090/FFFFFFFFC00001C2 : 3200                		cmp/eq	r0,r2
(2) 1091/FFFFFFFFC00001C4 : 8B11                		bf	.not_rom
(2) 1092/FFFFFFFFC00001C6 : D135                		mov	#MarsSnd_RvMode,r1
(2) 1093/FFFFFFFFC00001C8 : 6012                		mov	@r1,r0
(2) 1094/FFFFFFFFC00001CA : 8801                		cmp/eq	#1,r0
(2) 1095/FFFFFFFFC00001CC : 8B0D                		bf	.not_rom
(2) 1096/FFFFFFFFC00001CE :                     
(2) 1097/FFFFFFFFC00001CE :                     	; r1 - left WAV
(2) 1098/FFFFFFFFC00001CE :                     	; r3 - right WAV
(2) 1099/FFFFFFFFC00001CE :                     	; r4 - original READ point
(2) 1100/FFFFFFFFC00001CE :                     	; r5 - Pitch
(2) 1101/FFFFFFFFC00001CE : 5098                		mov 	@(mchnsnd_flags,r9),r0
(2) 1102/FFFFFFFFC00001D0 : 6153                		mov	r5,r1
(2) 1103/FFFFFFFFC00001D2 : C808                		tst	#%00001000,r0
(2) 1104/FFFFFFFFC00001D4 : 8900                		bt	.mono_c
(2) 1105/FFFFFFFFC00001D6 : 4100                		shll	r1
(2) 1106/FFFFFFFFC00001D8 :                     .mono_c:
(2) 1107/FFFFFFFFC00001D8 : 5292                		mov	@(mchnsnd_cchread,r9),r2
(2) 1108/FFFFFFFFC00001DA : 4219                		shlr8	r2
(2) 1109/FFFFFFFFC00001DC : E17F                		mov	#$7F,r1
(2) 1110/FFFFFFFFC00001DE : 2219                		and	r1,r2
(2) 1111/FFFFFFFFC00001E0 : 32AC                		add	r10,r2
(2) 1112/FFFFFFFFC00001E2 : 6124                		mov.b	@r2+,r1
(2) 1113/FFFFFFFFC00001E4 : 6324                		mov.b	@r2+,r3			; null in MONO samples
(2) 1114/FFFFFFFFC00001E6 : A00B                		bra	.from_rv
(2) 1115/FFFFFFFFC00001E8 : 0009                		nop
(2) 1116/FFFFFFFFC00001EA :                     
(2) 1117/FFFFFFFFC00001EA :                     ; Play as normal
(2) 1118/FFFFFFFFC00001EA :                     ; r0 - flags
(2) 1119/FFFFFFFFC00001EA :                     ; r4 - READ pointer
(2) 1120/FFFFFFFFC00001EA :                     .not_rom:
(2) 1121/FFFFFFFFC00001EA : 5098                		mov 	@(mchnsnd_flags,r9),r0
(2) 1122/FFFFFFFFC00001EC : 6343                		mov 	r4,r3
(2) 1123/FFFFFFFFC00001EE : 4319                		shlr8	r3
(2) 1124/FFFFFFFFC00001F0 : D128                		mov	#$00FFFFFF,r1
(2) 1125/FFFFFFFFC00001F2 : C808                		tst	#%00001000,r0
(2) 1126/FFFFFFFFC00001F4 : 8900                		bt	.mono_a
(2) 1127/FFFFFFFFC00001F6 : 71FF                		add	#-1,r1
(2) 1128/FFFFFFFFC00001F8 :                     .mono_a:
(2) 1129/FFFFFFFFC00001F8 : 2319                		and	r1,r3
(2) 1130/FFFFFFFFC00001FA : 232B                		or	r2,r3
(2) 1131/FFFFFFFFC00001FC : 6134                		mov.b	@r3+,r1
(2) 1132/FFFFFFFFC00001FE : 6334                		mov.b	@r3+,r3
(2) 1133/FFFFFFFFC0000200 :                     .from_rv:
(2) 1134/FFFFFFFFC0000200 : 6213                		mov	r1,r2
(2) 1135/FFFFFFFFC0000202 : C808                		tst	#%00001000,r0
(2) 1136/FFFFFFFFC0000204 : 8901                		bt	.mono
(2) 1137/FFFFFFFFC0000206 : 6233                		mov	r3,r2
(2) 1138/FFFFFFFFC0000208 : 4500                		shll	r5
(2) 1139/FFFFFFFFC000020A :                     .mono:
(2) 1140/FFFFFFFFC000020A : 345C                		add	r5,r4
(2) 1141/FFFFFFFFC000020C : 1941                		mov	r4,@(mchnsnd_read,r9)
(2) 1142/FFFFFFFFC000020E : 5392                		mov	@(mchnsnd_cchread,r9),r3
(2) 1143/FFFFFFFFC0000210 : 335C                		add	r5,r3
(2) 1144/FFFFFFFFC0000212 : 1932                		mov	r3,@(mchnsnd_cchread,r9)
(2) 1145/FFFFFFFFC0000214 : 933E                		mov	#$FF,r3
(2) 1146/FFFFFFFFC0000216 : 2139                		and	r3,r1
(2) 1147/FFFFFFFFC0000218 : 2239                		and	r3,r2
(2) 1148/FFFFFFFFC000021A : C802                		tst	#%00000010,r0	; LEFT enabled?
(2) 1149/FFFFFFFFC000021C : 8B00                		bf	.no_l
(2) 1150/FFFFFFFFC000021E : E17F                		mov	#$7F,r1		; Force LEFT off
(2) 1151/FFFFFFFFC0000220 :                     .no_l:
(2) 1152/FFFFFFFFC0000220 : C801                		tst	#%00000001,r0	; RIGHT enabled?
(2) 1153/FFFFFFFFC0000222 : 8B00                		bf	.no_r
(2) 1154/FFFFFFFFC0000224 : E27F                		mov	#$7F,r2		; Force RIGHT off
(2) 1155/FFFFFFFFC0000226 :                     .no_r:
(2) 1156/FFFFFFFFC0000226 : 5099                		mov	@(mchnsnd_vol,r9),r0
(2) 1157/FFFFFFFFC0000228 : 4015                		cmp/pl	r0
(2) 1158/FFFFFFFFC000022A : 8B0E                		bf	.skip
(2) 1159/FFFFFFFFC000022C : 7001                		add	#1,r0
(2) 1160/FFFFFFFFC000022E : 210E                		mulu	r0,r1
(2) 1161/FFFFFFFFC0000230 : 041A                		sts	macl,r4
(2) 1162/FFFFFFFFC0000232 : 4419                		shlr8	r4
(2) 1163/FFFFFFFFC0000234 : 3148                		sub	r4,r1
(2) 1164/FFFFFFFFC0000236 : 220E                		mulu	r0,r2
(2) 1165/FFFFFFFFC0000238 : 041A                		sts	macl,r4
(2) 1166/FFFFFFFFC000023A : 4419                		shlr8	r4
(2) 1167/FFFFFFFFC000023C : 3248                		sub	r4,r2
(2) 1168/FFFFFFFFC000023E : E47F                		mov	#$7F,r4
(2) 1169/FFFFFFFFC0000240 : 240E                		mulu	r0,r4
(2) 1170/FFFFFFFFC0000242 : 001A                		sts	macl,r0
(2) 1171/FFFFFFFFC0000244 : 4019                		shlr8	r0
(2) 1172/FFFFFFFFC0000246 : 310C                		add	r0,r1
(2) 1173/FFFFFFFFC0000248 : 320C                		add	r0,r2
(2) 1174/FFFFFFFFC000024A :                     .skip:
(2) 1175/FFFFFFFFC000024A : 7101                		add	#1,r1
(2) 1176/FFFFFFFFC000024C : 7201                		add	#1,r2
(2) 1177/FFFFFFFFC000024E : 361C                		add	r1,r6
(2) 1178/FFFFFFFFC0000250 : 372C                		add	r2,r7
(2) 1179/FFFFFFFFC0000252 : 902B                		mov	#$80,r0
(2) 1180/FFFFFFFFC0000254 : 3A0C                		add	r0,r10
(2) 1181/FFFFFFFFC0000256 : 4810                		dt	r8
(2) 1182/FFFFFFFFC0000258 : 8F91                		bf/s	.loop
(2) 1183/FFFFFFFFC000025A : 7928                		add	#sizeof_sndchn,r9
(2) 1184/FFFFFFFFC000025C : 9027                		mov	#$3FF,r0		; Overflow protection
(2) 1185/FFFFFFFFC000025E : 3607                		cmp/gt	r0,r6
(2) 1186/FFFFFFFFC0000260 : 8B00                		bf	.lmuch
(2) 1187/FFFFFFFFC0000262 : 6603                		mov	r0,r6
(2) 1188/FFFFFFFFC0000264 :                     .lmuch:
(2) 1189/FFFFFFFFC0000264 : 3707                		cmp/gt	r0,r7
(2) 1190/FFFFFFFFC0000266 : 8B00                		bf	.rmuch
(2) 1191/FFFFFFFFC0000268 : 6703                		mov	r0,r7
(2) 1192/FFFFFFFFC000026A :                     .rmuch:
(2) 1193/FFFFFFFFC000026A : D10D                		mov	#_sysreg+lchwidth,r1	; Write WAVE result
(2) 1194/FFFFFFFFC000026C : D20D                		mov	#_sysreg+rchwidth,r2
(2) 1195/FFFFFFFFC000026E : 2161                 		mov.w	r6,@r1
(2) 1196/FFFFFFFFC0000270 : 2271                 		mov.w	r7,@r2
(2) 1197/FFFFFFFFC0000272 :                     
(2) 1198/FFFFFFFFC0000272 : 4F16                		lds	@r15+,macl
(2) 1199/FFFFFFFFC0000274 : 6AF6                		mov	@r15+,r10
(2) 1200/FFFFFFFFC0000276 : 69F6                		mov	@r15+,r9
(2) 1201/FFFFFFFFC0000278 : 68F6                		mov	@r15+,r8
(2) 1202/FFFFFFFFC000027A : 67F6                		mov	@r15+,r7
(2) 1203/FFFFFFFFC000027C : 66F6                		mov	@r15+,r6
(2) 1204/FFFFFFFFC000027E : 65F6                		mov	@r15+,r5
(2) 1205/FFFFFFFFC0000280 : 64F6                		mov	@r15+,r4
(2) 1206/FFFFFFFFC0000282 : 63F6                		mov	@r15+,r3
(2) 1207/FFFFFFFFC0000284 : 000B                		rts
(2) 1208/FFFFFFFFC0000286 : 62F6                		mov	@r15+,r2
(2) 1209/FFFFFFFFC0000288 :                     		align 4
(2) 1210/FFFFFFFFC0000288 : 2000 401C 2601 6CC8 		ltorg
                    C000 0000 00FF FFFF 
                    0200 0000 C000 073C 
                    2000 4034 2000 4036 
                    00F0 FE10 0080 03FF 
(2) 1211/FFFFFFFFC00002B0 :                     
(2) 1212/FFFFFFFFC00002B0 :                     ; ------------------------------------------------
(2) 1213/FFFFFFFFC00002B0 :                     
(2) 1214/FFFFFFFFC00002B0 :                     MarsMdl_MdlLoop:
(2) 1215/FFFFFFFFC00002B0 : 4F22                		sts	pr,@-r15
(2) 1216/FFFFFFFFC00002B2 :                     
(2) 1217/FFFFFFFFC00002B2 : DE0D                		mov	#RAM_Mars_Objects,r14
(2) 1218/FFFFFFFFC00002B4 : ED10                		mov	#MAX_MODELS,r13
(2) 1219/FFFFFFFFC00002B6 :                     .loop:
(2) 1220/FFFFFFFFC00002B6 : 50E0                		mov	@(mdl_data,r14),r0		; Object model data == 0 or -1?
(2) 1221/FFFFFFFFC00002B8 : 4015                		cmp/pl	r0
(2) 1222/FFFFFFFFC00002BA : 8B07                		bf	.invlid
(2) 1223/FFFFFFFFC00002BC : D00B                		mov	#MarsMdl_ReadModel,r0
(2) 1224/FFFFFFFFC00002BE : 400B                		jsr	@r0
(2) 1225/FFFFFFFFC00002C0 : 2FD6                		mov	r13,@-r15
(2) 1226/FFFFFFFFC00002C2 : 6DF6                		mov	@r15+,r13
(2) 1227/FFFFFFFFC00002C4 : C50C                		mov.w	@(marsGbl_CurrNumFaces,gbr),r0	; Ran out of space to store faces?
(2) 1228/FFFFFFFFC00002C6 : 9117                		mov	#MAX_FACES,r1
(2) 1229/FFFFFFFFC00002C8 : 3013                		cmp/ge	r1,r0
(2) 1230/FFFFFFFFC00002CA : 8902                		bt	.skip
(2) 1231/FFFFFFFFC00002CC :                     .invlid:
(2) 1232/FFFFFFFFC00002CC : 4D10                		dt	r13
(2) 1233/FFFFFFFFC00002CE : 8FF2                		bf/s	.loop
(2) 1234/FFFFFFFFC00002D0 : 7E20                		add	#sizeof_mdlobj,r14
(2) 1235/FFFFFFFFC00002D2 :                     .skip:
(2) 1236/FFFFFFFFC00002D2 : D107                		mov 	#RAM_Mars_PlgnNum_0,r1
(2) 1237/FFFFFFFFC00002D4 : C50F                		mov.w   @(marsGbl_PolyBuffNum,gbr),r0
(2) 1238/FFFFFFFFC00002D6 : C801                		tst     #1,r0
(2) 1239/FFFFFFFFC00002D8 : 8B00                		bf	.page_2
(2) 1240/FFFFFFFFC00002DA : D106                		mov 	#RAM_Mars_PlgnNum_1,r1
(2) 1241/FFFFFFFFC00002DC :                     .page_2:
(2) 1242/FFFFFFFFC00002DC : C50C                		mov.w	@(marsGbl_CurrNumFaces,gbr),r0
(2) 1243/FFFFFFFFC00002DE : 2102                		mov	r0,@r1
(2) 1244/FFFFFFFFC00002E0 :                     
(2) 1245/FFFFFFFFC00002E0 : 4F26                		lds	@r15+,pr
(2) 1246/FFFFFFFFC00002E2 : 000B                		rts
(2) 1247/FFFFFFFFC00002E4 : 0009                		nop
(2) 1248/FFFFFFFFC00002E6 :                     		align 4
(2) 1249/FFFFFFFFC00002E8 : 2601 1668 C000 02FA 		ltorg
                    2601 6C10 2601 6C14 
                    0100                
(2) 1250/FFFFFFFFC00002FA :                     
(2) 1251/FFFFFFFFC00002FA :                     ; ------------------------------------------------
(2) 1252/FFFFFFFFC00002FA :                     ; Read model
(2) 1253/FFFFFFFFC00002FA :                     ; ------------------------------------------------
(2) 1254/FFFFFFFFC00002FA :                     
(2) 1255/FFFFFFFFC00002FA :                     MarsMdl_ReadModel:
(2) 1256/FFFFFFFFC00002FA : 4F22                		sts	pr,@-r15
(2) 1257/FFFFFFFFC00002FC :                     ; 		mov	@(mdl_animdata,r14),r13
(2) 1258/FFFFFFFFC00002FC :                     ; 		cmp/pl	r13
(2) 1259/FFFFFFFFC00002FC :                     ; 		bf	.no_anim
(2) 1260/FFFFFFFFC00002FC :                     ; 		mov	@(mdl_animtimer,r14),r0
(2) 1261/FFFFFFFFC00002FC :                     ; 		add	#-1,r0
(2) 1262/FFFFFFFFC00002FC :                     ; 		cmp/pl 	r0
(2) 1263/FFFFFFFFC00002FC :                     ; 		bt	.wait_camanim
(2) 1264/FFFFFFFFC00002FC :                     ; 		mov	@r13+,r2
(2) 1265/FFFFFFFFC00002FC :                     ; 		mov	@(mdl_animframe,r14),r0
(2) 1266/FFFFFFFFC00002FC :                     ; 		add	#1,r0
(2) 1267/FFFFFFFFC00002FC :                     ; 		cmp/eq	r2,r0
(2) 1268/FFFFFFFFC00002FC :                     ; 		bf	.on_frames
(2) 1269/FFFFFFFFC00002FC :                     ; 		xor	r0,r0
(2) 1270/FFFFFFFFC00002FC :                     ; .on_frames:
(2) 1271/FFFFFFFFC00002FC :                     ; 		mov	r0,r1
(2) 1272/FFFFFFFFC00002FC :                     ; 		mov	r0,@(mdl_animframe,r14)
(2) 1273/FFFFFFFFC00002FC :                     ; 		mov	#$18,r0
(2) 1274/FFFFFFFFC00002FC :                     ; 		mulu	r0,r1
(2) 1275/FFFFFFFFC00002FC :                     ; 		sts	macl,r0
(2) 1276/FFFFFFFFC00002FC :                     ; 		add	r0,r13
(2) 1277/FFFFFFFFC00002FC :                     ; 		mov	@r13+,r1
(2) 1278/FFFFFFFFC00002FC :                     ; 		mov	@r13+,r2
(2) 1279/FFFFFFFFC00002FC :                     ; 		mov	@r13+,r3
(2) 1280/FFFFFFFFC00002FC :                     ; 		mov	@r13+,r4
(2) 1281/FFFFFFFFC00002FC :                     ; 		mov	@r13+,r5
(2) 1282/FFFFFFFFC00002FC :                     ; 		mov	@r13+,r6
(2) 1283/FFFFFFFFC00002FC :                     ; ; 		neg	r4,r4
(2) 1284/FFFFFFFFC00002FC :                     ; 		mov	r1,@(mdl_x_pos,r14)
(2) 1285/FFFFFFFFC00002FC :                     ; 		mov	r2,@(mdl_y_pos,r14)
(2) 1286/FFFFFFFFC00002FC :                     ; 		mov	r3,@(mdl_z_pos,r14)
(2) 1287/FFFFFFFFC00002FC :                     ; 		mov	r4,@(mdl_x_rot,r14)
(2) 1288/FFFFFFFFC00002FC :                     ; 		mov	r5,@(mdl_y_rot,r14)
(2) 1289/FFFFFFFFC00002FC :                     ; 		mov	r6,@(mdl_z_rot,r14)
(2) 1290/FFFFFFFFC00002FC :                     ; 		mov	@(mdl_animspd,r14),r0		; TODO: make a timer setting
(2) 1291/FFFFFFFFC00002FC :                     ; .wait_camanim:
(2) 1292/FFFFFFFFC00002FC :                     ; 		mov	r0,@(mdl_animtimer,r14)
(2) 1293/FFFFFFFFC00002FC :                     ; .no_anim:
(2) 1294/FFFFFFFFC00002FC :                     	; Now start reading
(2) 1295/FFFFFFFFC00002FC : D0AB                		mov	#$3FFFFFFF,r0
(2) 1296/FFFFFFFFC00002FE : DDAC                		mov	#Cach_CurrPlygn,r13		; r13 - temporal face output
(2) 1297/FFFFFFFFC0000300 : 5CE0                		mov	@(mdl_data,r14),r12		; r12 - model header
(2) 1298/FFFFFFFFC0000302 : 2C09                		and	r0,r12
(2) 1299/FFFFFFFFC0000304 : 5BC2                		mov 	@(8,r12),r11			; r11 - face data
(2) 1300/FFFFFFFFC0000306 : 5AC1                		mov 	@(4,r12),r10			; r10 - vertice data (X,Y,Z)
(2) 1301/FFFFFFFFC0000308 : 69C1                		mov.w	@r12,r9				;  r9 - Number of faces used on model
(2) 1302/FFFFFFFFC000030A : C603                		mov	@(marsGbl_CurrZList,gbr),r0	;  r8 - Zlist for sorting
(2) 1303/FFFFFFFFC000030C : 6803                		mov	r0,r8
(2) 1304/FFFFFFFFC000030E :                     .next_face:
(2) 1305/FFFFFFFFC000030E : C50C                		mov.w	@(marsGbl_CurrNumFaces,gbr),r0	; Ran out of space to store faces?
(2) 1306/FFFFFFFFC0000310 : D102                		mov	.tag_maxfaces,r1
(2) 1307/FFFFFFFFC0000312 : 3013                		cmp/ge	r1,r0
(2) 1308/FFFFFFFFC0000314 : 8B04                		bf	.can_build
(2) 1309/FFFFFFFFC0000316 : A145                		bra	.exit_model
(2) 1310/FFFFFFFFC0000318 : 0009                		nop
(2) 1311/FFFFFFFFC000031A :                     		align 4
(2) 1312/FFFFFFFFC000031C : 0000 0100           .tag_maxfaces:	dc.l	MAX_FACES
(2) 1313/FFFFFFFFC0000320 :                     
(2) 1314/FFFFFFFFC0000320 :                     ; --------------------------------
(2) 1315/FFFFFFFFC0000320 :                     
(2) 1316/FFFFFFFFC0000320 :                     .can_build:
(2) 1317/FFFFFFFFC0000320 : 64B5                		mov.w	@r11+,r4		; Read type
(2) 1318/FFFFFFFFC0000322 : E703                		mov	#3,r7			; r7 - Current polygon type: triangle (3)
(2) 1319/FFFFFFFFC0000324 : 6043                		mov	r4,r0
(2) 1320/FFFFFFFFC0000326 : 4019                		shlr8	r0
(2) 1321/FFFFFFFFC0000328 : C840                		tst	#PLGN_TRI,r0		; Model face uses triangle?
(2) 1322/FFFFFFFFC000032A : 8B00                		bf	.set_tri
(2) 1323/FFFFFFFFC000032C : 7701                		add	#1,r7			; Face is quad, r7 = 4 points
(2) 1324/FFFFFFFFC000032E :                     .set_tri:
(2) 1325/FFFFFFFFC000032E : 4415                		cmp/pl	r4			; Faces uses texture? ($8xxx)
(2) 1326/FFFFFFFFC0000330 : 893C                		bt	.solid_type
(2) 1327/FFFFFFFFC0000332 :                     
(2) 1328/FFFFFFFFC0000332 :                     ; --------------------------------
(2) 1329/FFFFFFFFC0000332 :                     ; Set texture material
(2) 1330/FFFFFFFFC0000332 :                     ; --------------------------------
(2) 1331/FFFFFFFFC0000332 :                     
(2) 1332/FFFFFFFFC0000332 : 56C3                		mov	@($C,r12),r6		; r6 - Material data
(2) 1333/FFFFFFFFC0000334 : 65D3                		mov	r13,r5			; r5 - Go to UV section
(2) 1334/FFFFFFFFC0000336 : 7528                		add 	#polygn_srcpnts,r5
(2) 1335/FFFFFFFFC0000338 : 6373                		mov	r7,r3			; r3 - copy of current face points (3 or 4)
(2) 1336/FFFFFFFFC000033A :                     
(2) 1337/FFFFFFFFC000033A :                     	; Faster read
(2) 1338/FFFFFFFFC000033A :                     	rept 3
(2) 1339/FFFFFFFFC000033A :                     		mov.w	@r11+,r0		; Read UV index
(2) 1340/FFFFFFFFC000033A :                     		extu	r0,r0
(2) 1341/FFFFFFFFC000033A :                     		shll2	r0
(2) 1342/FFFFFFFFC000033A :                     		mov	@(r6,r0),r0
(2) 1343/FFFFFFFFC000033A :                     		mov.w	r0,@(2,r5)
(2) 1344/FFFFFFFFC000033A :                     		shlr16	r0
(2) 1345/FFFFFFFFC000033A :                     		mov.w	r0,@r5
(2) 1346/FFFFFFFFC000033A :                     		add	#4,r5
(2) 1347/FFFFFFFFC000033A :                     	endm
(2) 1339/FFFFFFFFC000033A : 60B5                		mov.w	@r11+,r0		; Read UV index
(2) 1340/FFFFFFFFC000033C : 600D                		extu	r0,r0
(2) 1341/FFFFFFFFC000033E : 4008                		shll2	r0
(2) 1342/FFFFFFFFC0000340 : 006E                		mov	@(r6,r0),r0
(2) 1343/FFFFFFFFC0000342 : 8151                		mov.w	r0,@(2,r5)
(2) 1344/FFFFFFFFC0000344 : 4029                		shlr16	r0
(2) 1345/FFFFFFFFC0000346 : 2501                		mov.w	r0,@r5
(2) 1346/FFFFFFFFC0000348 : 7504                		add	#4,r5
(2) 1339/FFFFFFFFC000034A : 60B5                		mov.w	@r11+,r0		; Read UV index
(2) 1340/FFFFFFFFC000034C : 600D                		extu	r0,r0
(2) 1341/FFFFFFFFC000034E : 4008                		shll2	r0
(2) 1342/FFFFFFFFC0000350 : 006E                		mov	@(r6,r0),r0
(2) 1343/FFFFFFFFC0000352 : 8151                		mov.w	r0,@(2,r5)
(2) 1344/FFFFFFFFC0000354 : 4029                		shlr16	r0
(2) 1345/FFFFFFFFC0000356 : 2501                		mov.w	r0,@r5
(2) 1346/FFFFFFFFC0000358 : 7504                		add	#4,r5
(2) 1339/FFFFFFFFC000035A : 60B5                		mov.w	@r11+,r0		; Read UV index
(2) 1340/FFFFFFFFC000035C : 600D                		extu	r0,r0
(2) 1341/FFFFFFFFC000035E : 4008                		shll2	r0
(2) 1342/FFFFFFFFC0000360 : 006E                		mov	@(r6,r0),r0
(2) 1343/FFFFFFFFC0000362 : 8151                		mov.w	r0,@(2,r5)
(2) 1344/FFFFFFFFC0000364 : 4029                		shlr16	r0
(2) 1345/FFFFFFFFC0000366 : 2501                		mov.w	r0,@r5
(2) 1346/FFFFFFFFC0000368 : 7504                		add	#4,r5
(2) 1348/FFFFFFFFC000036A : E003                		mov	#3,r0			; Triangle?
(2) 1349/FFFFFFFFC000036C : 3700                		cmp/eq	r0,r7
(2) 1350/FFFFFFFFC000036E : 8906                		bt	.alluvdone		; If yes, skip this
(2) 1351/FFFFFFFFC0000370 : 60B5                		mov.w	@r11+,r0		; Read extra UV index
(2) 1352/FFFFFFFFC0000372 : 600D                		extu	r0,r0
(2) 1353/FFFFFFFFC0000374 : 4008                		shll2	r0
(2) 1354/FFFFFFFFC0000376 : 006E                		mov	@(r6,r0),r0
(2) 1355/FFFFFFFFC0000378 : 8151                		mov.w	r0,@(2,r5)
(2) 1356/FFFFFFFFC000037A : 4029                		shlr16	r0
(2) 1357/FFFFFFFFC000037C : 2501                		mov.w	r0,@r5
(2) 1358/FFFFFFFFC000037E :                     .alluvdone:
(2) 1359/FFFFFFFFC000037E :                     
(2) 1360/FFFFFFFFC000037E : 50E1                		mov	@(mdl_option,r14),r0
(2) 1361/FFFFFFFFC0000380 : C9FF                		and	#$FF,r0
(2) 1362/FFFFFFFFC0000382 : 6103                		mov	r0,r1
(2) 1363/FFFFFFFFC0000384 : 6043                		mov	r4,r0
(2) 1364/FFFFFFFFC0000386 : D508                		mov	.tag_andmtrl,r5
(2) 1365/FFFFFFFFC0000388 : 2059                		and	r5,r0
(2) 1366/FFFFFFFFC000038A : 4008                		shll2	r0
(2) 1367/FFFFFFFFC000038C : 4000                		shll	r0
(2) 1368/FFFFFFFFC000038E : 56C4                		mov	@($10,r12),r6
(2) 1369/FFFFFFFFC0000390 : 360C                		add	r0,r6
(2) 1370/FFFFFFFFC0000392 : D088                		mov	#$E000,r0		; grab special bits
(2) 1371/FFFFFFFFC0000394 : 2409                		and	r0,r4
(2) 1372/FFFFFFFFC0000396 : 4428                		shll16	r4
(2) 1373/FFFFFFFFC0000398 : 5061                		mov	@(4,r6),r0
(2) 1374/FFFFFFFFC000039A : 240B                		or	r0,r4
(2) 1375/FFFFFFFFC000039C : 341C                		add	r1,r4
(2) 1376/FFFFFFFFC000039E : 1D40                		mov	r4,@(polygn_type,r13)
(2) 1377/FFFFFFFFC00003A0 : 6062                		mov	@r6,r0
(2) 1378/FFFFFFFFC00003A2 : 1D01                		mov	r0,@(polygn_mtrl,r13)
(2) 1379/FFFFFFFFC00003A4 : A00D                		bra	.go_faces
(2) 1380/FFFFFFFFC00003A6 : 0009                		nop
(2) 1381/FFFFFFFFC00003A8 :                     .tag_andmtrl:
(2) 1382/FFFFFFFFC00003A8 : 0000 1FFF           		dc.l $1FFF
(2) 1383/FFFFFFFFC00003AC :                     
(2) 1384/FFFFFFFFC00003AC :                     ; --------------------------------
(2) 1385/FFFFFFFFC00003AC :                     ; Set texture material
(2) 1386/FFFFFFFFC00003AC :                     ; --------------------------------
(2) 1387/FFFFFFFFC00003AC :                     
(2) 1388/FFFFFFFFC00003AC :                     .solid_type:
(2) 1389/FFFFFFFFC00003AC : 50E1                		mov	@(mdl_option,r14),r0
(2) 1390/FFFFFFFFC00003AE : C9FF                		and	#$FF,r0
(2) 1391/FFFFFFFFC00003B0 : 6103                		mov	r0,r1
(2) 1392/FFFFFFFFC00003B2 : 6043                		mov	r4,r0
(2) 1393/FFFFFFFFC00003B4 : D57F                		mov	#$E000,r5
(2) 1394/FFFFFFFFC00003B6 : 2459                		and	r5,r4
(2) 1395/FFFFFFFFC00003B8 : 4428                		shll16	r4
(2) 1396/FFFFFFFFC00003BA : 341C                		add	r1,r4
(2) 1397/FFFFFFFFC00003BC : 1D40                		mov	r4,@(polygn_type,r13)		; Set type 0 (tri) or quad (1)
(2) 1398/FFFFFFFFC00003BE : C9FF                		and	#$FF,r0
(2) 1399/FFFFFFFFC00003C0 : 1D01                		mov	r0,@(polygn_mtrl,r13)		; Set pixel color (0-255)
(2) 1400/FFFFFFFFC00003C2 :                     
(2) 1401/FFFFFFFFC00003C2 :                     ; --------------------------------
(2) 1402/FFFFFFFFC00003C2 :                     ; Read faces
(2) 1403/FFFFFFFFC00003C2 :                     ; --------------------------------
(2) 1404/FFFFFFFFC00003C2 :                     
(2) 1405/FFFFFFFFC00003C2 :                     .go_faces:
(2) 1406/FFFFFFFFC00003C2 : 61D3                		mov	r13,r1
(2) 1407/FFFFFFFFC00003C4 : 7108                		add 	#polygn_points,r1
(2) 1408/FFFFFFFFC00003C6 : 66B3                		mov	r11,r6
(2) 1409/FFFFFFFFC00003C8 : 6073                		mov	r7,r0
(2) 1410/FFFFFFFFC00003CA : 4000                		shll	r0
(2) 1411/FFFFFFFFC00003CC : 3B0C                		add	r0,r11
(2) 1412/FFFFFFFFC00003CE :                     
(2) 1413/FFFFFFFFC00003CE : D07A                		mov	#Cach_BkupS_S,r0
(2) 1414/FFFFFFFFC00003D0 : 2086                		mov 	r8,@-r0
(2) 1415/FFFFFFFFC00003D2 : 2096                		mov 	r9,@-r0
(2) 1416/FFFFFFFFC00003D4 : 20B6                		mov 	r11,@-r0
(2) 1417/FFFFFFFFC00003D6 : 20C6                		mov 	r12,@-r0
(2) 1418/FFFFFFFFC00003D8 : 20D6                		mov 	r13,@-r0
(2) 1419/FFFFFFFFC00003DA : D831                		mov	.tag_xl,r8
(2) 1420/FFFFFFFFC00003DC : 698B                		neg	r8,r9
(2) 1421/FFFFFFFFC00003DE : EB90                		mov	#-112,r11
(2) 1422/FFFFFFFFC00003E0 : 6CBB                		neg	r11,r12
(2) 1423/FFFFFFFFC00003E2 : D576                		mov	#$7FFFFFFF,r5
(2) 1424/FFFFFFFFC00003E4 : EDFF                		mov	#$FFFFFFFF,r13
(2) 1425/FFFFFFFFC00003E6 :                     
(2) 1426/FFFFFFFFC00003E6 :                     	; Do 3 points
(2) 1427/FFFFFFFFC00003E6 :                     	rept 3
(2) 1428/FFFFFFFFC00003E6 :                     		mov	#0,r0
(2) 1429/FFFFFFFFC00003E6 :                     		mov.w 	@r6+,r0
(2) 1430/FFFFFFFFC00003E6 :                     		mov	#$C,r4
(2) 1431/FFFFFFFFC00003E6 :                     		mulu	r4,r0
(2) 1432/FFFFFFFFC00003E6 :                     		sts	macl,r0
(2) 1433/FFFFFFFFC00003E6 :                     		mov	r10,r4
(2) 1434/FFFFFFFFC00003E6 :                     		add 	r0,r4
(2) 1435/FFFFFFFFC00003E6 :                     		mov	@r4,r2
(2) 1436/FFFFFFFFC00003E6 :                     		mov	@(4,r4),r3
(2) 1437/FFFFFFFFC00003E6 :                     		mov	@(8,r4),r4
(2) 1438/FFFFFFFFC00003E6 :                     		bsr	mdlrd_setpoint
(2) 1439/FFFFFFFFC00003E6 :                     		nop
(2) 1440/FFFFFFFFC00003E6 :                     		mov	r2,@r1
(2) 1441/FFFFFFFFC00003E6 :                     		mov	r3,@(4,r1)
(2) 1442/FFFFFFFFC00003E6 :                     		add	#8,r1
(2) 1443/FFFFFFFFC00003E6 :                     	endm
(2) 1428/FFFFFFFFC00003E6 : E000                		mov	#0,r0
(2) 1429/FFFFFFFFC00003E8 : 6065                		mov.w 	@r6+,r0
(2) 1430/FFFFFFFFC00003EA : E40C                		mov	#$C,r4
(2) 1431/FFFFFFFFC00003EC : 204E                		mulu	r4,r0
(2) 1432/FFFFFFFFC00003EE : 001A                		sts	macl,r0
(2) 1433/FFFFFFFFC00003F0 : 64A3                		mov	r10,r4
(2) 1434/FFFFFFFFC00003F2 : 340C                		add 	r0,r4
(2) 1435/FFFFFFFFC00003F4 : 6242                		mov	@r4,r2
(2) 1436/FFFFFFFFC00003F6 : 5341                		mov	@(4,r4),r3
(2) 1437/FFFFFFFFC00003F8 : 5442                		mov	@(8,r4),r4
(2) 1438/FFFFFFFFC00003FA : B0E5                		bsr	mdlrd_setpoint
(2) 1439/FFFFFFFFC00003FC : 0009                		nop
(2) 1440/FFFFFFFFC00003FE : 2122                		mov	r2,@r1
(2) 1441/FFFFFFFFC0000400 : 1131                		mov	r3,@(4,r1)
(2) 1442/FFFFFFFFC0000402 : 7108                		add	#8,r1
(2) 1428/FFFFFFFFC0000404 : E000                		mov	#0,r0
(2) 1429/FFFFFFFFC0000406 : 6065                		mov.w 	@r6+,r0
(2) 1430/FFFFFFFFC0000408 : E40C                		mov	#$C,r4
(2) 1431/FFFFFFFFC000040A : 204E                		mulu	r4,r0
(2) 1432/FFFFFFFFC000040C : 001A                		sts	macl,r0
(2) 1433/FFFFFFFFC000040E : 64A3                		mov	r10,r4
(2) 1434/FFFFFFFFC0000410 : 340C                		add 	r0,r4
(2) 1435/FFFFFFFFC0000412 : 6242                		mov	@r4,r2
(2) 1436/FFFFFFFFC0000414 : 5341                		mov	@(4,r4),r3
(2) 1437/FFFFFFFFC0000416 : 5442                		mov	@(8,r4),r4
(2) 1438/FFFFFFFFC0000418 : B0D6                		bsr	mdlrd_setpoint
(2) 1439/FFFFFFFFC000041A : 0009                		nop
(2) 1440/FFFFFFFFC000041C : 2122                		mov	r2,@r1
(2) 1441/FFFFFFFFC000041E : 1131                		mov	r3,@(4,r1)
(2) 1442/FFFFFFFFC0000420 : 7108                		add	#8,r1
(2) 1428/FFFFFFFFC0000422 : E000                		mov	#0,r0
(2) 1429/FFFFFFFFC0000424 : 6065                		mov.w 	@r6+,r0
(2) 1430/FFFFFFFFC0000426 : E40C                		mov	#$C,r4
(2) 1431/FFFFFFFFC0000428 : 204E                		mulu	r4,r0
(2) 1432/FFFFFFFFC000042A : 001A                		sts	macl,r0
(2) 1433/FFFFFFFFC000042C : 64A3                		mov	r10,r4
(2) 1434/FFFFFFFFC000042E : 340C                		add 	r0,r4
(2) 1435/FFFFFFFFC0000430 : 6242                		mov	@r4,r2
(2) 1436/FFFFFFFFC0000432 : 5341                		mov	@(4,r4),r3
(2) 1437/FFFFFFFFC0000434 : 5442                		mov	@(8,r4),r4
(2) 1438/FFFFFFFFC0000436 : B0C7                		bsr	mdlrd_setpoint
(2) 1439/FFFFFFFFC0000438 : 0009                		nop
(2) 1440/FFFFFFFFC000043A : 2122                		mov	r2,@r1
(2) 1441/FFFFFFFFC000043C : 1131                		mov	r3,@(4,r1)
(2) 1442/FFFFFFFFC000043E : 7108                		add	#8,r1
(2) 1444/FFFFFFFFC0000440 : E003                		mov	#3,r0			; Triangle?
(2) 1445/FFFFFFFFC0000442 : 3700                		cmp/eq	r0,r7
(2) 1446/FFFFFFFFC0000444 : 890D                		bt	.alldone		; If yes, skip this
(2) 1447/FFFFFFFFC0000446 : E000                		mov	#0,r0
(2) 1448/FFFFFFFFC0000448 : 6065                		mov.w 	@r6+,r0
(2) 1449/FFFFFFFFC000044A : E40C                		mov	#$C,r4
(2) 1450/FFFFFFFFC000044C : 204E                		mulu	r4,r0
(2) 1451/FFFFFFFFC000044E : 001A                		sts	macl,r0
(2) 1452/FFFFFFFFC0000450 : 64A3                		mov	r10,r4
(2) 1453/FFFFFFFFC0000452 : 340C                		add 	r0,r4
(2) 1454/FFFFFFFFC0000454 : 6242                		mov	@r4,r2
(2) 1455/FFFFFFFFC0000456 : 5341                		mov	@(4,r4),r3
(2) 1456/FFFFFFFFC0000458 : 5442                		mov	@(8,r4),r4
(2) 1457/FFFFFFFFC000045A : B0B5                		bsr	mdlrd_setpoint
(2) 1458/FFFFFFFFC000045C : 0009                		nop
(2) 1459/FFFFFFFFC000045E : 2122                		mov	r2,@r1
(2) 1460/FFFFFFFFC0000460 : 1131                		mov	r3,@(4,r1)
(2) 1461/FFFFFFFFC0000462 :                     .alldone:
(2) 1462/FFFFFFFFC0000462 : 6183                		mov	r8,r1
(2) 1463/FFFFFFFFC0000464 : 6293                		mov	r9,r2
(2) 1464/FFFFFFFFC0000466 : 63B3                		mov	r11,r3
(2) 1465/FFFFFFFFC0000468 : 64C3                		mov	r12,r4
(2) 1466/FFFFFFFFC000046A : 66D3                		mov	r13,r6
(2) 1467/FFFFFFFFC000046C :                     
(2) 1468/FFFFFFFFC000046C : D054                		mov	#Cach_BkupS_L,r0
(2) 1469/FFFFFFFFC000046E : 6D06                		mov	@r0+,r13
(2) 1470/FFFFFFFFC0000470 : 6C06                		mov	@r0+,r12
(2) 1471/FFFFFFFFC0000472 : 6B06                		mov	@r0+,r11
(2) 1472/FFFFFFFFC0000474 : 6906                		mov	@r0+,r9
(2) 1473/FFFFFFFFC0000476 : 6806                		mov	@r0+,r8
(2) 1474/FFFFFFFFC0000478 :                     
(2) 1475/FFFFFFFFC0000478 :                     	; NOTE: if you don't like how the perspective works
(2) 1476/FFFFFFFFC0000478 :                     	; change this instruction depending how you want to ignore
(2) 1477/FFFFFFFFC0000478 :                     	; faces closer to the camera:
(2) 1478/FFFFFFFFC0000478 :                     	;
(2) 1479/FFFFFFFFC0000478 :                     	; r5 - Back Z point, keep affine limitations
(2) 1480/FFFFFFFFC0000478 :                     	; r6 - Front Z point, skip face but larger faces are affected
(2) 1481/FFFFFFFFC0000478 :                     
(2) 1482/FFFFFFFFC0000478 : 4511                		cmp/pz	r5			; *** back z
(2) 1483/FFFFFFFFC000047A : 890E                		bt	.go_fout
(2) 1484/FFFFFFFFC000047C :                     ; 		cmp/pz	r6			; *** front z
(2) 1485/FFFFFFFFC000047C :                     ; 		bt	.go_fout
(2) 1486/FFFFFFFFC000047C :                     
(2) 1487/FFFFFFFFC000047C : 909B                		mov	#MAX_ZDIST,r0		; Draw distance
(2) 1488/FFFFFFFFC000047E : 3503                		cmp/ge	r0,r5
(2) 1489/FFFFFFFFC0000480 : 8B0B                		bf	.go_fout
(2) 1490/FFFFFFFFC0000482 : 909F                		mov	#-(SCREEN_WIDTH/2),r0
(2) 1491/FFFFFFFFC0000484 : 3107                		cmp/gt	r0,r1
(2) 1492/FFFFFFFFC0000486 : 8B08                		bf	.go_fout
(2) 1493/FFFFFFFFC0000488 : 600B                		neg	r0,r0
(2) 1494/FFFFFFFFC000048A : 3203                		cmp/ge	r0,r2
(2) 1495/FFFFFFFFC000048C : 8905                		bt	.go_fout
(2) 1496/FFFFFFFFC000048E : E090                		mov	#-(SCREEN_HEIGHT/2),r0
(2) 1497/FFFFFFFFC0000490 : 3307                		cmp/gt	r0,r3
(2) 1498/FFFFFFFFC0000492 : 8B02                		bf	.go_fout
(2) 1499/FFFFFFFFC0000494 : 600B                		neg	r0,r0
(2) 1500/FFFFFFFFC0000496 : 3403                		cmp/ge	r0,r4
(2) 1501/FFFFFFFFC0000498 : 8B04                		bf	.face_ok
(2) 1502/FFFFFFFFC000049A : A07D                .go_fout:	bra	.face_out
(2) 1503/FFFFFFFFC000049C : 0009                		nop
(2) 1504/FFFFFFFFC000049E :                     		align 4
(2) 1505/FFFFFFFFC00004A0 : FFFF FF60           .tag_xl:	dc.l -160
(2) 1506/FFFFFFFFC00004A4 :                     
(2) 1507/FFFFFFFFC00004A4 :                     ; --------------------------------
(2) 1508/FFFFFFFFC00004A4 :                     
(2) 1509/FFFFFFFFC00004A4 :                     .face_ok:
(2) 1510/FFFFFFFFC00004A4 : C50C                		mov.w	@(marsGbl_CurrNumFaces,gbr),r0	; Add 1 face to the list
(2) 1511/FFFFFFFFC00004A6 : 7001                		add	#1,r0
(2) 1512/FFFFFFFFC00004A8 : C10C                		mov.w	r0,@(marsGbl_CurrNumFaces,gbr)
(2) 1513/FFFFFFFFC00004AA : C605                		mov	@(marsGbl_CurrFacePos,gbr),r0
(2) 1514/FFFFFFFFC00004AC : 6103                		mov	r0,r1
(2) 1515/FFFFFFFFC00004AE : 62D3                		mov	r13,r2
(2) 1516/FFFFFFFFC00004B0 : 2852                		mov	r5,@r8				; Store current Z to Zlist
(2) 1517/FFFFFFFFC00004B2 : 1811                		mov	r1,@(4,r8)			; And it's address
(2) 1518/FFFFFFFFC00004B4 :                     
(2) 1519/FFFFFFFFC00004B4 :                     ; 	Sort this face
(2) 1520/FFFFFFFFC00004B4 :                     ; 	r7 - Curr Z
(2) 1521/FFFFFFFFC00004B4 :                     ; 	r6 - Past Z
(2) 1522/FFFFFFFFC00004B4 : C50C                		mov.w	@(marsGbl_CurrNumFaces,gbr),r0
(2) 1523/FFFFFFFFC00004B6 : 8801                		cmp/eq	#1,r0
(2) 1524/FFFFFFFFC00004B8 : 8917                		bt	.first_face
(2) 1525/FFFFFFFFC00004BA : 8802                		cmp/eq	#2,r0
(2) 1526/FFFFFFFFC00004BC : 8915                		bt	.first_face
(2) 1527/FFFFFFFFC00004BE : 6783                		mov	r8,r7
(2) 1528/FFFFFFFFC00004C0 : 77F8                		add	#-8,r7
(2) 1529/FFFFFFFFC00004C2 :                     ; 		mov	@(marsGbl_CurrZList,gbr),r0
(2) 1530/FFFFFFFFC00004C2 :                     ; 		mov	r0,r6
(2) 1531/FFFFFFFFC00004C2 : C604                		mov	@(marsGbl_CurrZTop,gbr),r0
(2) 1532/FFFFFFFFC00004C4 : 6603                		mov	r0,r6
(2) 1533/FFFFFFFFC00004C6 :                     ; 		mov	#RAM_Mars_PlgnList_0,r6
(2) 1534/FFFFFFFFC00004C6 :                     ; 		mov.w   @(marsGbl_PolyBuffNum,gbr),r0
(2) 1535/FFFFFFFFC00004C6 :                     ; 		tst     #1,r0
(2) 1536/FFFFFFFFC00004C6 :                     ; 		bf	.page_2
(2) 1537/FFFFFFFFC00004C6 :                     ; 		mov	#RAM_Mars_PlgnList_1,r6
(2) 1538/FFFFFFFFC00004C6 :                     .page_2:
(2) 1539/FFFFFFFFC00004C6 : 3763                		cmp/ge	r6,r7
(2) 1540/FFFFFFFFC00004C8 : 8B0F                		bf	.first_face
(2) 1541/FFFFFFFFC00004CA : 5472                		mov	@(8,r7),r4
(2) 1542/FFFFFFFFC00004CC : 6572                		mov	@r7,r5
(2) 1543/FFFFFFFFC00004CE : 3540                		cmp/eq	r4,r5
(2) 1544/FFFFFFFFC00004D0 : 890B                		bt	.first_face
(2) 1545/FFFFFFFFC00004D2 : 3547                		cmp/gt	r4,r5
(2) 1546/FFFFFFFFC00004D4 : 8B07                		bf	.swap_me
(2) 1547/FFFFFFFFC00004D6 : 6472                		mov	@r7,r4
(2) 1548/FFFFFFFFC00004D8 : 5572                		mov	@(8,r7),r5
(2) 1549/FFFFFFFFC00004DA : 2752                		mov	r5,@r7
(2) 1550/FFFFFFFFC00004DC : 1742                		mov	r4,@(8,r7)
(2) 1551/FFFFFFFFC00004DE : 5471                		mov	@(4,r7),r4
(2) 1552/FFFFFFFFC00004E0 : 5573                		mov	@($C,r7),r5
(2) 1553/FFFFFFFFC00004E2 : 1751                		mov	r5,@(4,r7)
(2) 1554/FFFFFFFFC00004E4 : 1743                		mov	r4,@($C,r7)
(2) 1555/FFFFFFFFC00004E6 :                     .swap_me:
(2) 1556/FFFFFFFFC00004E6 : AFEE                		bra	.page_2
(2) 1557/FFFFFFFFC00004E8 : 77F8                		add	#-8,r7
(2) 1558/FFFFFFFFC00004EA :                     
(2) 1559/FFFFFFFFC00004EA :                     .first_face:
(2) 1560/FFFFFFFFC00004EA : 7808                		add	#8,r8			; Next Zlist entry
(2) 1561/FFFFFFFFC00004EC :                     	rept sizeof_polygn/2			; Copy words manually
(2) 1562/FFFFFFFFC00004EC :                     		mov.w	@r2+,r0
(2) 1563/FFFFFFFFC00004EC :                     		mov.w	r0,@r1
(2) 1564/FFFFFFFFC00004EC :                     		add	#2,r1
(2) 1565/FFFFFFFFC00004EC :                     	endm
(2) 1562/FFFFFFFFC00004EC : 6025                		mov.w	@r2+,r0
(2) 1563/FFFFFFFFC00004EE : 2101                		mov.w	r0,@r1
(2) 1564/FFFFFFFFC00004F0 : 7102                		add	#2,r1
(2) 1562/FFFFFFFFC00004F2 : 6025                		mov.w	@r2+,r0
(2) 1563/FFFFFFFFC00004F4 : 2101                		mov.w	r0,@r1
(2) 1564/FFFFFFFFC00004F6 : 7102                		add	#2,r1
(2) 1562/FFFFFFFFC00004F8 : 6025                		mov.w	@r2+,r0
(2) 1563/FFFFFFFFC00004FA : 2101                		mov.w	r0,@r1
(2) 1564/FFFFFFFFC00004FC : 7102                		add	#2,r1
(2) 1562/FFFFFFFFC00004FE : 6025                		mov.w	@r2+,r0
(2) 1563/FFFFFFFFC0000500 : 2101                		mov.w	r0,@r1
(2) 1564/FFFFFFFFC0000502 : 7102                		add	#2,r1
(2) 1562/FFFFFFFFC0000504 : 6025                		mov.w	@r2+,r0
(2) 1563/FFFFFFFFC0000506 : 2101                		mov.w	r0,@r1
(2) 1564/FFFFFFFFC0000508 : 7102                		add	#2,r1
(2) 1562/FFFFFFFFC000050A : 6025                		mov.w	@r2+,r0
(2) 1563/FFFFFFFFC000050C : 2101                		mov.w	r0,@r1
(2) 1564/FFFFFFFFC000050E : 7102                		add	#2,r1
(2) 1562/FFFFFFFFC0000510 : 6025                		mov.w	@r2+,r0
(2) 1563/FFFFFFFFC0000512 : 2101                		mov.w	r0,@r1
(2) 1564/FFFFFFFFC0000514 : 7102                		add	#2,r1
(2) 1562/FFFFFFFFC0000516 : 6025                		mov.w	@r2+,r0
(2) 1563/FFFFFFFFC0000518 : 2101                		mov.w	r0,@r1
(2) 1564/FFFFFFFFC000051A : 7102                		add	#2,r1
(2) 1562/FFFFFFFFC000051C : 6025                		mov.w	@r2+,r0
(2) 1563/FFFFFFFFC000051E : 2101                		mov.w	r0,@r1
(2) 1564/FFFFFFFFC0000520 : 7102                		add	#2,r1
(2) 1562/FFFFFFFFC0000522 : 6025                		mov.w	@r2+,r0
(2) 1563/FFFFFFFFC0000524 : 2101                		mov.w	r0,@r1
(2) 1564/FFFFFFFFC0000526 : 7102                		add	#2,r1
(2) 1562/FFFFFFFFC0000528 : 6025                		mov.w	@r2+,r0
(2) 1563/FFFFFFFFC000052A : 2101                		mov.w	r0,@r1
(2) 1564/FFFFFFFFC000052C : 7102                		add	#2,r1
(2) 1562/FFFFFFFFC000052E : 6025                		mov.w	@r2+,r0
(2) 1563/FFFFFFFFC0000530 : 2101                		mov.w	r0,@r1
(2) 1564/FFFFFFFFC0000532 : 7102                		add	#2,r1
(2) 1562/FFFFFFFFC0000534 : 6025                		mov.w	@r2+,r0
(2) 1563/FFFFFFFFC0000536 : 2101                		mov.w	r0,@r1
(2) 1564/FFFFFFFFC0000538 : 7102                		add	#2,r1
(2) 1562/FFFFFFFFC000053A : 6025                		mov.w	@r2+,r0
(2) 1563/FFFFFFFFC000053C : 2101                		mov.w	r0,@r1
(2) 1564/FFFFFFFFC000053E : 7102                		add	#2,r1
(2) 1562/FFFFFFFFC0000540 : 6025                		mov.w	@r2+,r0
(2) 1563/FFFFFFFFC0000542 : 2101                		mov.w	r0,@r1
(2) 1564/FFFFFFFFC0000544 : 7102                		add	#2,r1
(2) 1562/FFFFFFFFC0000546 : 6025                		mov.w	@r2+,r0
(2) 1563/FFFFFFFFC0000548 : 2101                		mov.w	r0,@r1
(2) 1564/FFFFFFFFC000054A : 7102                		add	#2,r1
(2) 1562/FFFFFFFFC000054C : 6025                		mov.w	@r2+,r0
(2) 1563/FFFFFFFFC000054E : 2101                		mov.w	r0,@r1
(2) 1564/FFFFFFFFC0000550 : 7102                		add	#2,r1
(2) 1562/FFFFFFFFC0000552 : 6025                		mov.w	@r2+,r0
(2) 1563/FFFFFFFFC0000554 : 2101                		mov.w	r0,@r1
(2) 1564/FFFFFFFFC0000556 : 7102                		add	#2,r1
(2) 1562/FFFFFFFFC0000558 : 6025                		mov.w	@r2+,r0
(2) 1563/FFFFFFFFC000055A : 2101                		mov.w	r0,@r1
(2) 1564/FFFFFFFFC000055C : 7102                		add	#2,r1
(2) 1562/FFFFFFFFC000055E : 6025                		mov.w	@r2+,r0
(2) 1563/FFFFFFFFC0000560 : 2101                		mov.w	r0,@r1
(2) 1564/FFFFFFFFC0000562 : 7102                		add	#2,r1
(2) 1562/FFFFFFFFC0000564 : 6025                		mov.w	@r2+,r0
(2) 1563/FFFFFFFFC0000566 : 2101                		mov.w	r0,@r1
(2) 1564/FFFFFFFFC0000568 : 7102                		add	#2,r1
(2) 1562/FFFFFFFFC000056A : 6025                		mov.w	@r2+,r0
(2) 1563/FFFFFFFFC000056C : 2101                		mov.w	r0,@r1
(2) 1564/FFFFFFFFC000056E : 7102                		add	#2,r1
(2) 1562/FFFFFFFFC0000570 : 6025                		mov.w	@r2+,r0
(2) 1563/FFFFFFFFC0000572 : 2101                		mov.w	r0,@r1
(2) 1564/FFFFFFFFC0000574 : 7102                		add	#2,r1
(2) 1562/FFFFFFFFC0000576 : 6025                		mov.w	@r2+,r0
(2) 1563/FFFFFFFFC0000578 : 2101                		mov.w	r0,@r1
(2) 1564/FFFFFFFFC000057A : 7102                		add	#2,r1
(2) 1562/FFFFFFFFC000057C : 6025                		mov.w	@r2+,r0
(2) 1563/FFFFFFFFC000057E : 2101                		mov.w	r0,@r1
(2) 1564/FFFFFFFFC0000580 : 7102                		add	#2,r1
(2) 1562/FFFFFFFFC0000582 : 6025                		mov.w	@r2+,r0
(2) 1563/FFFFFFFFC0000584 : 2101                		mov.w	r0,@r1
(2) 1564/FFFFFFFFC0000586 : 7102                		add	#2,r1
(2) 1562/FFFFFFFFC0000588 : 6025                		mov.w	@r2+,r0
(2) 1563/FFFFFFFFC000058A : 2101                		mov.w	r0,@r1
(2) 1564/FFFFFFFFC000058C : 7102                		add	#2,r1
(2) 1562/FFFFFFFFC000058E : 6025                		mov.w	@r2+,r0
(2) 1563/FFFFFFFFC0000590 : 2101                		mov.w	r0,@r1
(2) 1564/FFFFFFFFC0000592 : 7102                		add	#2,r1
(2) 1566/FFFFFFFFC0000594 : 6013                		mov	r1,r0
(2) 1567/FFFFFFFFC0000596 : C205                		mov	r0,@(marsGbl_CurrFacePos,gbr)
(2) 1568/FFFFFFFFC0000598 :                     .face_out:
(2) 1569/FFFFFFFFC0000598 : 4910                		dt	r9
(2) 1570/FFFFFFFFC000059A : 8901                		bt	.finish_this
(2) 1571/FFFFFFFFC000059C : AEB7                		bra	.next_face
(2) 1572/FFFFFFFFC000059E : 0009                		nop
(2) 1573/FFFFFFFFC00005A0 :                     .finish_this:
(2) 1574/FFFFFFFFC00005A0 : 6083                		mov	r8,r0
(2) 1575/FFFFFFFFC00005A2 : C203                		mov	r0,@(marsGbl_CurrZList,gbr)
(2) 1576/FFFFFFFFC00005A4 :                     .exit_model:
(2) 1577/FFFFFFFFC00005A4 : 4F26                		lds	@r15+,pr
(2) 1578/FFFFFFFFC00005A6 : 000B                		rts
(2) 1579/FFFFFFFFC00005A8 : 0009                		nop
(2) 1580/FFFFFFFFC00005AA :                     		align 4
(2) 1581/FFFFFFFFC00005AC : 3FFF FFFF C000 0744 		ltorg
                    0000 E000 C000 07B0 
                    7FFF FFFF C000 079C 
                    FF60                
(2) 1582/FFFFFFFFC00005C6 :                     
(2) 1583/FFFFFFFFC00005C6 :                     ; ----------------------------------------
(2) 1584/FFFFFFFFC00005C6 :                     ; Modify position to current point
(2) 1585/FFFFFFFFC00005C6 :                     ; ----------------------------------------
(2) 1586/FFFFFFFFC00005C6 :                     
(2) 1587/FFFFFFFFC00005C6 :                     		align 4
(2) 1588/FFFFFFFFC00005C8 :                     mdlrd_setpoint:
(2) 1589/FFFFFFFFC00005C8 : D046                		mov	#Cach_BkupPnt_S,r0
(2) 1590/FFFFFFFFC00005CA : 4022                		sts	pr,@-r0
(2) 1591/FFFFFFFFC00005CC : 2056                		mov 	r5,@-r0
(2) 1592/FFFFFFFFC00005CE : 2066                		mov 	r6,@-r0
(2) 1593/FFFFFFFFC00005D0 : 2076                		mov 	r7,@-r0
(2) 1594/FFFFFFFFC00005D2 : 2086                		mov 	r8,@-r0
(2) 1595/FFFFFFFFC00005D4 : 2096                		mov 	r9,@-r0
(2) 1596/FFFFFFFFC00005D6 : 20A6                		mov 	r10,@-r0
(2) 1597/FFFFFFFFC00005D8 : 20B6                		mov 	r11,@-r0
(2) 1598/FFFFFFFFC00005DA :                     
(2) 1599/FFFFFFFFC00005DA :                     	; Object rotation
(2) 1600/FFFFFFFFC00005DA : 6523                		mov	r2,r5			; r5 - X
(2) 1601/FFFFFFFFC00005DC : 6643                		mov	r4,r6			; r6 - Z
(2) 1602/FFFFFFFFC00005DE : 50E5                  		mov 	@(mdl_x_rot,r14),r0
(2) 1603/FFFFFFFFC00005E0 : 4009                  		shlr2	r0
(2) 1604/FFFFFFFFC00005E2 : 4001                  		shlr	r0
(2) 1605/FFFFFFFFC00005E4 : B087                  		bsr	mdlrd_rotate
(2) 1606/FFFFFFFFC00005E6 : 4019                		shlr8	r0
(2) 1607/FFFFFFFFC00005E8 : 6273                   		mov	r7,r2
(2) 1608/FFFFFFFFC00005EA : 6533                   		mov	r3,r5
(2) 1609/FFFFFFFFC00005EC : 6683                  		mov	r8,r6
(2) 1610/FFFFFFFFC00005EE : 50E6                  		mov 	@(mdl_y_rot,r14),r0
(2) 1611/FFFFFFFFC00005F0 : 4009                  		shlr2	r0
(2) 1612/FFFFFFFFC00005F2 : 4001                  		shlr	r0
(2) 1613/FFFFFFFFC00005F4 : B07F                  		bsr	mdlrd_rotate
(2) 1614/FFFFFFFFC00005F6 : 4019                		shlr8	r0
(2) 1615/FFFFFFFFC00005F8 : 6483                   		mov	r8,r4
(2) 1616/FFFFFFFFC00005FA : 6523                   		mov	r2,r5
(2) 1617/FFFFFFFFC00005FC : 6673                   		mov	r7,r6
(2) 1618/FFFFFFFFC00005FE : 50E7                   		mov 	@(mdl_z_rot,r14),r0
(2) 1619/FFFFFFFFC0000600 : 4009                  		shlr2	r0
(2) 1620/FFFFFFFFC0000602 : 4001                  		shlr	r0
(2) 1621/FFFFFFFFC0000604 : B077                  		bsr	mdlrd_rotate
(2) 1622/FFFFFFFFC0000606 : 4019                		shlr8	r0
(2) 1623/FFFFFFFFC0000608 : 6273                   		mov	r7,r2
(2) 1624/FFFFFFFFC000060A : 6383                   		mov	r8,r3
(2) 1625/FFFFFFFFC000060C : 55E2                		mov	@(mdl_x_pos,r14),r5
(2) 1626/FFFFFFFFC000060E : 56E3                		mov	@(mdl_y_pos,r14),r6
(2) 1627/FFFFFFFFC0000610 : 57E4                		mov	@(mdl_z_pos,r14),r7
(2) 1628/FFFFFFFFC0000612 :                     ; 		shlr8	r5
(2) 1629/FFFFFFFFC0000612 :                     ; 		shlr8	r6
(2) 1630/FFFFFFFFC0000612 :                     ; 		shlr8	r7
(2) 1631/FFFFFFFFC0000612 : 655F                		exts	r5,r5
(2) 1632/FFFFFFFFC0000614 : 666F                		exts	r6,r6
(2) 1633/FFFFFFFFC0000616 : 677F                		exts	r7,r7
(2) 1634/FFFFFFFFC0000618 : 325C                		add 	r5,r2
(2) 1635/FFFFFFFFC000061A : 336C                		add 	r6,r3
(2) 1636/FFFFFFFFC000061C : 347C                		add 	r7,r4
(2) 1637/FFFFFFFFC000061E :                     
(2) 1638/FFFFFFFFC000061E :                     	; Include camera changes
(2) 1639/FFFFFFFFC000061E : DB32                		mov 	#RAM_Mars_ObjCamera,r11
(2) 1640/FFFFFFFFC0000620 : 55B0                		mov	@(cam_x_pos,r11),r5
(2) 1641/FFFFFFFFC0000622 : 56B1                		mov	@(cam_y_pos,r11),r6
(2) 1642/FFFFFFFFC0000624 : 57B2                		mov	@(cam_z_pos,r11),r7
(2) 1643/FFFFFFFFC0000626 :                     ; 		mov	@(mdl_data,r14),r0		; Layout object?
(2) 1644/FFFFFFFFC0000626 :                     ; 		shll	r0
(2) 1645/FFFFFFFFC0000626 :                     ; 		cmp/pl	r0
(2) 1646/FFFFFFFFC0000626 :                     ; 		bt	.lay_move
(2) 1647/FFFFFFFFC0000626 :                     ; 		mov	#$FFFFF,r0			; Limit camera movement
(2) 1648/FFFFFFFFC0000626 :                     ; 		and	r0,r5
(2) 1649/FFFFFFFFC0000626 :                     ; ; 		and	r0,r6
(2) 1650/FFFFFFFFC0000626 :                     ; 		and	r0,r7
(2) 1651/FFFFFFFFC0000626 :                     ; .lay_move:
(2) 1652/FFFFFFFFC0000626 : 4519                		shlr8	r5
(2) 1653/FFFFFFFFC0000628 : 4619                		shlr8	r6
(2) 1654/FFFFFFFFC000062A : 4719                		shlr8	r7
(2) 1655/FFFFFFFFC000062C : 655F                		exts	r5,r5
(2) 1656/FFFFFFFFC000062E : 666F                		exts	r6,r6
(2) 1657/FFFFFFFFC0000630 : 677F                		exts	r7,r7
(2) 1658/FFFFFFFFC0000632 : 3258                		sub 	r5,r2
(2) 1659/FFFFFFFFC0000634 : 3368                		sub 	r6,r3
(2) 1660/FFFFFFFFC0000636 : 347C                		add 	r7,r4
(2) 1661/FFFFFFFFC0000638 :                     
(2) 1662/FFFFFFFFC0000638 : 6523                		mov	r2,r5
(2) 1663/FFFFFFFFC000063A : 6643                		mov	r4,r6
(2) 1664/FFFFFFFFC000063C : 50B3                  		mov 	@(cam_x_rot,r11),r0
(2) 1665/FFFFFFFFC000063E : 4009                  		shlr2	r0
(2) 1666/FFFFFFFFC0000640 : 4001                  		shlr	r0
(2) 1667/FFFFFFFFC0000642 : B058                  		bsr	mdlrd_rotate
(2) 1668/FFFFFFFFC0000644 : 4019                		shlr8	r0
(2) 1669/FFFFFFFFC0000646 : 6273                   		mov	r7,r2
(2) 1670/FFFFFFFFC0000648 : 6483                   		mov	r8,r4
(2) 1671/FFFFFFFFC000064A : 6533                   		mov	r3,r5
(2) 1672/FFFFFFFFC000064C : 6683                  		mov	r8,r6
(2) 1673/FFFFFFFFC000064E : 50B4                  		mov 	@(cam_y_rot,r11),r0
(2) 1674/FFFFFFFFC0000650 : 4009                  		shlr2	r0
(2) 1675/FFFFFFFFC0000652 : 4001                  		shlr	r0
(2) 1676/FFFFFFFFC0000654 : B04F                  		bsr	mdlrd_rotate
(2) 1677/FFFFFFFFC0000656 : 4019                		shlr8	r0
(2) 1678/FFFFFFFFC0000658 : 6483                   		mov	r8,r4
(2) 1679/FFFFFFFFC000065A : 6523                   		mov	r2,r5
(2) 1680/FFFFFFFFC000065C : 6673                   		mov	r7,r6
(2) 1681/FFFFFFFFC000065E : 50B5                   		mov 	@(cam_z_rot,r11),r0
(2) 1682/FFFFFFFFC0000660 : 4009                  		shlr2	r0
(2) 1683/FFFFFFFFC0000662 : 4001                  		shlr	r0
(2) 1684/FFFFFFFFC0000664 : B047                  		bsr	mdlrd_rotate
(2) 1685/FFFFFFFFC0000666 : 4019                		shlr8	r0
(2) 1686/FFFFFFFFC0000668 : 6273                   		mov	r7,r2
(2) 1687/FFFFFFFFC000066A : 6383                   		mov	r8,r3
(2) 1688/FFFFFFFFC000066C :                     
(2) 1689/FFFFFFFFC000066C :                     	; Weak perspective projection
(2) 1690/FFFFFFFFC000066C :                     	; this is the best I got,
(2) 1691/FFFFFFFFC000066C :                     	; It breaks on large faces
(2) 1692/FFFFFFFFC000066C : 9842                		mov 	#_JR,r8
(2) 1693/FFFFFFFFC000066E : D71F                		mov	#256<<17,r7
(2) 1694/FFFFFFFFC0000670 : 604B                		neg	r4,r0		; reverse Z
(2) 1695/FFFFFFFFC0000672 : 4015                		cmp/pl	r0
(2) 1696/FFFFFFFFC0000674 : 890C                		bt	.inside
(2) 1697/FFFFFFFFC0000676 : E001                		mov	#1,r0
(2) 1698/FFFFFFFFC0000678 : 4709                		shlr2	r7
(2) 1699/FFFFFFFFC000067A : 4709                		shlr2	r7
(2) 1700/FFFFFFFFC000067C :                     ; 		shlr	r7
(2) 1701/FFFFFFFFC000067C : 327D                		dmuls	r7,r2
(2) 1702/FFFFFFFFC000067E : 000A                		sts	mach,r0
(2) 1703/FFFFFFFFC0000680 : 021A                		sts	macl,r2
(2) 1704/FFFFFFFFC0000682 : 220D                		xtrct	r0,r2
(2) 1705/FFFFFFFFC0000684 : 337D                		dmuls	r7,r3
(2) 1706/FFFFFFFFC0000686 : 000A                		sts	mach,r0
(2) 1707/FFFFFFFFC0000688 : 031A                		sts	macl,r3
(2) 1708/FFFFFFFFC000068A : 230D                		xtrct	r0,r3
(2) 1709/FFFFFFFFC000068C :                     
(2) 1710/FFFFFFFFC000068C :                     
(2) 1711/FFFFFFFFC000068C : A00C                		bra	.zmulti
(2) 1712/FFFFFFFFC000068E : 0009                		nop
(2) 1713/FFFFFFFFC0000690 :                     .inside:
(2) 1714/FFFFFFFFC0000690 : 2802                		mov 	r0,@r8
(2) 1715/FFFFFFFFC0000692 : 1871                		mov 	r7,@(4,r8)
(2) 1716/FFFFFFFFC0000694 : 0009                		nop
(2) 1717/FFFFFFFFC0000696 : 5781                		mov 	@(4,r8),r7
(2) 1718/FFFFFFFFC0000698 : 327D                		dmuls	r7,r2
(2) 1719/FFFFFFFFC000069A : 000A                		sts	mach,r0
(2) 1720/FFFFFFFFC000069C : 021A                		sts	macl,r2
(2) 1721/FFFFFFFFC000069E : 220D                		xtrct	r0,r2
(2) 1722/FFFFFFFFC00006A0 : 337D                		dmuls	r7,r3
(2) 1723/FFFFFFFFC00006A2 : 000A                		sts	mach,r0
(2) 1724/FFFFFFFFC00006A4 : 031A                		sts	macl,r3
(2) 1725/FFFFFFFFC00006A6 : 230D                		xtrct	r0,r3
(2) 1726/FFFFFFFFC00006A8 :                     .zmulti:
(2) 1727/FFFFFFFFC00006A8 : D011                		mov	#Cach_BkupPnt_L,r0
(2) 1728/FFFFFFFFC00006AA : 6B06                		mov	@r0+,r11
(2) 1729/FFFFFFFFC00006AC : 6A06                		mov	@r0+,r10
(2) 1730/FFFFFFFFC00006AE : 6906                		mov	@r0+,r9
(2) 1731/FFFFFFFFC00006B0 : 6806                		mov	@r0+,r8
(2) 1732/FFFFFFFFC00006B2 : 6706                		mov	@r0+,r7
(2) 1733/FFFFFFFFC00006B4 : 6606                		mov	@r0+,r6
(2) 1734/FFFFFFFFC00006B6 : 6506                		mov	@r0+,r5
(2) 1735/FFFFFFFFC00006B8 : 4026                		lds	@r0+,pr
(2) 1736/FFFFFFFFC00006BA :                     
(2) 1737/FFFFFFFFC00006BA :                     	; Set the most far points
(2) 1738/FFFFFFFFC00006BA :                     	; for each direction (X,Y,Z)
(2) 1739/FFFFFFFFC00006BA : 34D7                		cmp/gt	r13,r4
(2) 1740/FFFFFFFFC00006BC : 8B00                		bf	.save_z2
(2) 1741/FFFFFFFFC00006BE : 6D43                		mov	r4,r13
(2) 1742/FFFFFFFFC00006C0 :                     .save_z2:
(2) 1743/FFFFFFFFC00006C0 : 3457                		cmp/gt	r5,r4
(2) 1744/FFFFFFFFC00006C2 : 8900                		bt	.save_z
(2) 1745/FFFFFFFFC00006C4 : 6543                		mov	r4,r5
(2) 1746/FFFFFFFFC00006C6 :                     .save_z:
(2) 1747/FFFFFFFFC00006C6 : 3287                		cmp/gt	r8,r2
(2) 1748/FFFFFFFFC00006C8 : 8B00                		bf	.x_lw
(2) 1749/FFFFFFFFC00006CA : 6823                		mov	r2,r8
(2) 1750/FFFFFFFFC00006CC :                     .x_lw:
(2) 1751/FFFFFFFFC00006CC : 3297                		cmp/gt	r9,r2
(2) 1752/FFFFFFFFC00006CE : 8900                		bt	.x_rw
(2) 1753/FFFFFFFFC00006D0 : 6923                		mov	r2,r9
(2) 1754/FFFFFFFFC00006D2 :                     .x_rw:
(2) 1755/FFFFFFFFC00006D2 : 33B7                		cmp/gt	r11,r3
(2) 1756/FFFFFFFFC00006D4 : 8B00                		bf	.y_lw
(2) 1757/FFFFFFFFC00006D6 : 6B33                		mov	r3,r11
(2) 1758/FFFFFFFFC00006D8 :                     .y_lw:
(2) 1759/FFFFFFFFC00006D8 : 33C7                		cmp/gt	r12,r3
(2) 1760/FFFFFFFFC00006DA : 8900                		bt	.y_rw
(2) 1761/FFFFFFFFC00006DC : 6C33                		mov	r3,r12
(2) 1762/FFFFFFFFC00006DE :                     .y_rw:
(2) 1763/FFFFFFFFC00006DE :                     
(2) 1764/FFFFFFFFC00006DE : 000B                		rts
(2) 1765/FFFFFFFFC00006E0 : 0009                		nop
(2) 1766/FFFFFFFFC00006E2 :                     		align 4
(2) 1767/FFFFFFFFC00006E4 : C000 079C 2601 1868 		ltorg
                    0200 0000 C000 077C 
                    FF00                
(2) 1768/FFFFFFFFC00006F6 :                     
(2) 1769/FFFFFFFFC00006F6 :                     ; ------------------------------
(2) 1770/FFFFFFFFC00006F6 :                     ; Rotate point
(2) 1771/FFFFFFFFC00006F6 :                     ;
(2) 1772/FFFFFFFFC00006F6 :                     ; Entry:
(2) 1773/FFFFFFFFC00006F6 :                     ; r5: x
(2) 1774/FFFFFFFFC00006F6 :                     ; r6: y
(2) 1775/FFFFFFFFC00006F6 :                     ; r0: theta
(2) 1776/FFFFFFFFC00006F6 :                     ;
(2) 1777/FFFFFFFFC00006F6 :                     ; Returns:
(2) 1778/FFFFFFFFC00006F6 :                     ; r7: (x  cos @) + (y sin @)
(2) 1779/FFFFFFFFC00006F6 :                     ; r8: (x -sin @) + (y cos @)
(2) 1780/FFFFFFFFC00006F6 :                     ; ------------------------------
(2) 1781/FFFFFFFFC00006F6 :                     
(2) 1782/FFFFFFFFC00006F6 :                     mdlrd_rotate:
(2) 1783/FFFFFFFFC00006F6 : 971F                    		mov	#$7FF,r7
(2) 1784/FFFFFFFFC00006F8 : 2079                    		and	r7,r0
(2) 1785/FFFFFFFFC00006FA : 4008                   		shll2	r0
(2) 1786/FFFFFFFFC00006FC : D70C                		mov	#sin_table,r7
(2) 1787/FFFFFFFFC00006FE : D80D                		mov	#sin_table+$800,r8
(2) 1788/FFFFFFFFC0000700 : 097E                		mov	@(r0,r7),r9
(2) 1789/FFFFFFFFC0000702 : 0A8E                		mov	@(r0,r8),r10
(2) 1790/FFFFFFFFC0000704 :                     
(2) 1791/FFFFFFFFC0000704 : 3A5D                		dmuls	r5,r10		; x cos @
(2) 1792/FFFFFFFFC0000706 : 071A                		sts	macl,r7
(2) 1793/FFFFFFFFC0000708 : 000A                		sts	mach,r0
(2) 1794/FFFFFFFFC000070A : 270D                		xtrct	r0,r7
(2) 1795/FFFFFFFFC000070C : 396D                		dmuls	r6,r9		; y sin @
(2) 1796/FFFFFFFFC000070E : 081A                		sts	macl,r8
(2) 1797/FFFFFFFFC0000710 : 000A                		sts	mach,r0
(2) 1798/FFFFFFFFC0000712 : 280D                		xtrct	r0,r8
(2) 1799/FFFFFFFFC0000714 : 378C                		add	r8,r7
(2) 1800/FFFFFFFFC0000716 :                     
(2) 1801/FFFFFFFFC0000716 : 699B                		neg	r9,r9
(2) 1802/FFFFFFFFC0000718 : 395D                		dmuls	r5,r9		; x -sin @
(2) 1803/FFFFFFFFC000071A : 081A                		sts	macl,r8
(2) 1804/FFFFFFFFC000071C : 000A                		sts	mach,r0
(2) 1805/FFFFFFFFC000071E : 280D                		xtrct	r0,r8
(2) 1806/FFFFFFFFC0000720 : 3A6D                		dmuls	r6,r10		; y cos @
(2) 1807/FFFFFFFFC0000722 : 091A                		sts	macl,r9
(2) 1808/FFFFFFFFC0000724 : 000A                		sts	mach,r0
(2) 1809/FFFFFFFFC0000726 : 290D                		xtrct	r0,r9
(2) 1810/FFFFFFFFC0000728 : 389C                		add	r9,r8
(2) 1811/FFFFFFFFC000072A : 000B                 		rts
(2) 1812/FFFFFFFFC000072C : 0009                		nop
(2) 1813/FFFFFFFFC000072E :                     		align 4
(2) 1814/FFFFFFFFC0000730 : 0600 2358 0600 2B58 		ltorg
                    07FF                
(2) 1815/FFFFFFFFC000073A :                     
(2) 1816/FFFFFFFFC000073A :                     ; ------------------------------------------------
(2) 1817/FFFFFFFFC000073A :                     		align 4
(2) 1818/FFFFFFFFC000073C :                     MarsSnd_RvMode	ds.l 1
(2) 1819/FFFFFFFFC0000740 :                     MarsSnd_Active	ds.l 1
(2) 1820/FFFFFFFFC0000744 :                     Cach_CurrPlygn	ds.b sizeof_polygn	; Current polygon in modelread
(2) 1821/FFFFFFFFC000077C :                     Cach_BkupPnt_L	ds.l 8		;
(2) 1822/FFFFFFFFC000079C :                     Cach_BkupPnt_S	ds.l 0		; <-- Reads backwards
(2) 1823/FFFFFFFFC000079C :                     Cach_BkupS_L	ds.l 5		;
(2) 1824/FFFFFFFFC00007B0 :                     Cach_BkupS_S	ds.l 0
(2) 1825/FFFFFFFFC00007B0 :                     
(2) 1826/FFFFFFFFC00007B0 :                     ; ------------------------------------------------
(2) 1827/ 6002358 :                     .end:		phase CACHE_SLAVE+.end&$1FFF
(2) 1828/ 6002358 :                     CACHE_SLAVE_E:
(2) 1829/ 6002358 :                     		align 4
(2) 1833/ 6002358 :                     
(1) 1870/ 6002358 :                     
(1) 1871/ 6002358 :                     ; ====================================================================
(1) 1872/ 6002358 :                     ; ----------------------------------------------------------------
(1) 1873/ 6002358 :                     ; Data
(1) 1874/ 6002358 :                     ; ----------------------------------------------------------------
(1) 1875/ 6002358 :                     
(1) 1876/ 6002358 :                     		align 4
(1) 1877/ 6002358 :                     sin_table	binclude "system/mars/data/sinedata.bin"
(1) 1878/ 6004B58 :                     m_ascii		binclude "system/mars/data/m_ascii.bin"
(1) 1879/ 6006358 :                     		align 4
(1) 1880/ 6006358 :                     		include "data/mars_sdram.asm"
(2)    1/ 6006358 :                     ; ====================================================================
(2)    2/ 6006358 :                     ; ----------------------------------------------------------------
(2)    3/ 6006358 :                     ; SH2 SDRAM data
(2)    4/ 6006358 :                     ; 
(2)    5/ 6006358 :                     ; This data is stored on SDRAM, always available to use on the 32X
(2)    6/ 6006358 :                     ; side and can be rewritible, but it is smaller than ROM
(2)    7/ 6006358 :                     ;
(2)    8/ 6006358 :                     ; Your palettes, textures, models go here
(2)    9/ 6006358 :                     ; PWM samples can be used here but those take a lot of space...
(2)   10/ 6006358 :                     ; use ROM (mars_rom.asm) instead, those are RV-protected on SH2
(2)   11/ 6006358 :                     ; ----------------------------------------------------------------
(2)   12/ 6006358 :                     
(2)   13/ 6006358 :                     	align 4
(2)   14/ 6006358 :                     
(2)   15/ 6006358 :                     ; --------------------------------------------------------
(2)   16/ 6006358 :                     ; Models
(2)   17/ 6006358 :                     ; --------------------------------------------------------
(2)   18/ 6006358 :                     
(2)   19/ 6006358 :                     	include "data/mars/objects/mdl/test/head.asm"
(3)    1/ 6006358 :                     MarsObj_test:
(3)    2/ 6006358 : 00EE 02CA           		dc.w 238,714
(3)    3/ 600635C : 0600 636C 0600 84E4 		dc.l .vert,.face,.vrtx,.mtrl
                    0600 91F4 0600 9D24 
(3)    4/ 600636C :                     .vert:		binclude "data/mars/objects/mdl/test/vert.bin"
(3)    5/ 60084E4 :                     .face:		binclude "data/mars/objects/mdl/test/face.bin"
(3)    6/ 60091F4 :                     .vrtx:		binclude "data/mars/objects/mdl/test/vrtx.bin"
(3)    7/ 6009D24 :                     .mtrl:		include "data/mars/objects/mdl/test/mtrl.asm"
(4)    1/ 6009D24 : 020A 7B18           	 dc.l Textr_pecsi
(4)    2/ 6009D28 : 0100                	 dc.w 256
(4)    3/ 6009D2A : 0000                	 dc.w 0
(4)    4/ 6009D2C :                     
(3)    8/ 6009D2C :                     		align 4
(2)   20/ 6009D2C :                     
(1) 1881/ 6009D2C :                     
(1) 1882/ 6009D2C :                     ; ====================================================================
(1) 1883/ 6009D2C :                     ; ----------------------------------------------------------------
(1) 1884/ 6009D2C :                     ; MARS SH2 RAM
(1) 1885/ 6009D2C :                     ; ----------------------------------------------------------------
(1) 1886/ 6009D2C :                     
(1) 1887/ 6009D2C :                     		align $10
(1) 1888/ 6009D30 :                     SH2_RAM:
(1) 1889/ 6009D30 : (MACRO)             		struct SH2_RAM|TH
(1) 1889/ 6009D30 : =$6009D30           GLBL_LASTPC     set *
(1) 1889/   2C8B0 :                                     dephase
(1) 1889/   2C8B0 : =$2C8B0             GLBL_LASTORG    set *
(1) 1889/26009D30 :                                     phase SH2_RAM|TH
(1) 1896/26009D30 :                     MarsRam_System		ds.b (sizeof_marssys-MarsRam_System)
(1) 1897/2600A668 :                     MarsRam_Video		ds.b (sizeof_marsvid-MarsRam_Video)
(1) 1898/26016CC8 :                     MarsRam_Sound		ds.b (sizeof_marssnd-MarsRam_Sound)
(1) 1899/26017048 :                     sizeof_marsram		ds.l 0
(1) 1901/26017048 :                     
(1) 1902/26017048 :                     .here:
(1) 1906/26017048 : (MACRO)             		finish
(1) 1906/26009D30 :                                     !org GLBL_LASTORG
(1) 1906/ 6009D30 :                                     phase GLBL_LASTPC
(1) 1907/ 6009D30 :                     
(1) 1908/ 6009D30 :                     ; ====================================================================
(1) 1909/ 6009D30 :                     ; ----------------------------------------------------------------
(1) 1910/ 6009D30 :                     ; MARS Sound RAM
(1) 1911/ 6009D30 :                     ; ----------------------------------------------------------------
(1) 1912/ 6009D30 :                     
(1) 1913/ 6009D30 : (MACRO)             			struct MarsRam_Sound
(1) 1913/ 6009D30 : =$6009D30           GLBL_LASTPC     set *
(1) 1913/   2C8B0 :                                     dephase
(1) 1913/   2C8B0 : =$2C8B0             GLBL_LASTORG    set *
(1) 1913/26016CC8 :                                     phase MARSRAM_SOUND
(1) 1914/26016CC8 :                     MarsSnd_PwmCache	ds.b $80*MAX_PWMCHNL
(1) 1915/26017048 :                     sizeof_marssnd		ds.l 0
(1) 1916/26017048 : (MACRO)             			finish
(1) 1916/26016CC8 :                                     !org GLBL_LASTORG
(1) 1916/ 6009D30 :                                     phase GLBL_LASTPC
(1) 1917/ 6009D30 :                     
(1) 1918/ 6009D30 :                     ; ====================================================================
(1) 1919/ 6009D30 :                     ; ----------------------------------------------------------------
(1) 1920/ 6009D30 :                     ; MARS Video RAM
(1) 1921/ 6009D30 :                     ; ----------------------------------------------------------------
(1) 1922/ 6009D30 :                     
(1) 1923/ 6009D30 : (MACRO)             			struct MarsRam_Video
(1) 1923/ 6009D30 : =$6009D30           GLBL_LASTPC     set *
(1) 1923/   2C8B0 :                                     dephase
(1) 1923/   2C8B0 : =$2C8B0             GLBL_LASTORG    set *
(1) 1923/2600A668 :                                     phase MARSRAM_VIDEO
(1) 1924/2600A668 :                     RAM_Mars_Polygons_0	ds.b sizeof_polygn*MAX_FACES
(1) 1925/2600DE68 :                     RAM_Mars_Polygons_1	ds.b sizeof_polygn*MAX_FACES
(1) 1926/26011668 :                     RAM_Mars_Objects	ds.b sizeof_mdlobj*MAX_MODELS
(1) 1927/26011868 :                     RAM_Mars_ObjCamera	ds.b sizeof_camera		; 3D Camera buffer
(1) 1928/26011890 :                     RAM_Mars_VdpDrwList	ds.b sizeof_plypz*MAX_SVDP_PZ	; Sprites / Polygon pieces
(1) 1929/26015C10 :                     RAM_Mars_VdpDrwList_e	ds.l 0				; (END point label)
(1) 1930/26015C10 :                     RAM_Mars_PlgnList_0	ds.l 2*MAX_FACES		; polygondata, Zpos
(1) 1931/26016410 :                     RAM_Mars_PlgnList_1	ds.l 2*MAX_FACES
(1) 1932/26016C10 :                     RAM_Mars_PlgnNum_0	ds.l 1				; Number of polygons to process
(1) 1933/26016C14 :                     RAM_Mars_PlgnNum_1	ds.l 1
(1) 1934/26016C18 :                     RAM_Mars_BgBuffScrl	ds.w sizeof_marsbg
(1) 1935/26016C90 :                     RAM_Mars_BgBuffScale_M	ds.l 7
(1) 1936/26016CAC :                     RAM_Mars_BgBuffScale_S	ds.l 7
(1) 1937/26016CC8 :                     sizeof_marsvid		ds.l 0
(1) 1938/26016CC8 : (MACRO)             			finish
(1) 1938/2600A668 :                                     !org GLBL_LASTORG
(1) 1938/ 6009D30 :                                     phase GLBL_LASTPC
(1) 1939/ 6009D30 :                     
(1) 1940/ 6009D30 :                     ; ====================================================================
(1) 1941/ 6009D30 :                     ; ----------------------------------------------------------------
(1) 1942/ 6009D30 :                     ; MARS System RAM
(1) 1943/ 6009D30 :                     ; ----------------------------------------------------------------
(1) 1944/ 6009D30 :                     
(1) 1945/ 6009D30 : (MACRO)             			struct MarsRam_System
(1) 1945/ 6009D30 : =$6009D30           GLBL_LASTPC     set *
(1) 1945/   2C8B0 :                                     dephase
(1) 1945/   2C8B0 : =$2C8B0             GLBL_LASTORG    set *
(1) 1945/26009D30 :                                     phase MARSRAM_SYSTEM
(1) 1946/26009D30 :                     RAM_Mars_DreqDma	ds.b sizeof_dreq	; DREQ data recieved from Genesis in DMA ***DO NOT READ FROM HERE***
(1) 1947/2600A160 :                     RAM_Mars_DreqRead	ds.b sizeof_dreq	; Copy of DREQ for reading.
(1) 1948/2600A590 :                     RAM_Mars_Global		ds.l sizeof_MarsGbl	; gbr values go here.
(1) 1949/2600A668 :                     sizeof_marssys		ds.l 0
(1) 1950/2600A668 : (MACRO)             			finish
(1) 1950/26009D30 :                                     !org GLBL_LASTORG
(1) 1950/ 6009D30 :                                     phase GLBL_LASTPC
(1) 1951/ 6009D30 :                     
(1) 1952/ 6009D30 :                     ; ====================================================================
(1) 1953/ 6009D30 :                     
     102/ 6009D30 :                     		cpu 68000
     103/ 6009D30 :                     		padding off
     104/   2C8B0 :                     		dephase
     105/   2C8B0 :                     MARS_RAMDATA_E:
     106/   2C8B0 :                     		align 4
     107/   2C8B0 :                     
     108/   2C8B0 :                     ; ====================================================================
     109/   2C8B0 :                     ; --------------------------------------------------------
     110/   2C8B0 :                     ; MARS exclusive data for SH2's ROM view
     111/   2C8B0 :                     ; This section will be gone if RV=1
     112/   2C8B0 :                     ; --------------------------------------------------------
     113/   2C8B0 :                     
     114/ 202C8B0 :                     		phase CS1+*
     115/ 202C8B0 :                     		align 4
     116/ 202C8B0 :                     		include "data/mars_rom.asm"
(1)    1/ 202C8B0 :                     ; ====================================================================
(1)    2/ 202C8B0 :                     ; ----------------------------------------------------------------
(1)    3/ 202C8B0 :                     ; SH2 ROM data
(1)    4/ 202C8B0 :                     ;
(1)    5/ 202C8B0 :                     ; If your data is too much for SDRAM, place it here.
(1)    6/ 202C8B0 :                     ; BUT keep in mind that this entire section will be gone
(1)    7/ 202C8B0 :                     ; if the Genesis performs DMA-to-VDP Transfers
(1)    8/ 202C8B0 :                     ; which requires RV=1 (Revert ROM to original position)
(1)    9/ 202C8B0 :                     ; ***EMULATORS IGNORE THIS LIMITATION***
(1)   10/ 202C8B0 :                     ;
(1)   11/ 202C8B0 :                     ; Only access here on these conditions:
(1)   12/ 202C8B0 :                     ; - Stop all tracks that use PWM samples
(1)   13/ 202C8B0 :                     ; - If you wanna keep any tracks active: set 1 to marsBlock
(1)   14/ 202C8B0 :                     ;   in the Z80 driver, all tracks will continue playing
(1)   15/ 202C8B0 :                     ;   only with PSG and FM instruments
(1)   16/ 202C8B0 :                     ;   (TODO: check how it peforms)
(1)   17/ 202C8B0 :                     ;
(1)   18/ 202C8B0 :                     ; The PWM samples are safe to use with the implementation
(1)   19/ 202C8B0 :                     ; of a sample-backup routine that the 68K requests before
(1)   20/ 202C8B0 :                     ; doing DMA
(1)   21/ 202C8B0 :                     ; ----------------------------------------------------------------
(1)   22/ 202C8B0 :                     
(1)   23/ 202C8B0 :                     	align 4
(1)   24/ 202C8B0 :                     
(1)   25/ 202C8B0 :                     ; --------------------------------------------------------
(1)   26/ 202C8B0 :                     ; PWM samples
(1)   27/ 202C8B0 :                     ; --------------------------------------------------------
(1)   28/ 202C8B0 :                     
(1)   29/ 202C8B0 :                     SmpIns_PlusPiano_st:
(1)   30/ 202C8B0 : (MACRO)             	gSmpl "sound/instr/smpl/plus_piano_st.wav",0
(1)   30/ 202C8B0 :                     .start
(1)   30/ 202C8B0 : 6822 00                     dc.b ((.end-.start)&$FF),(((.end-.start)>>8)&$FF),(((.end-.start)>>16)&$FF)     ; length
(1)   30/ 202C8B3 : 0000 00                     dc.b ((0)&$FF),(((0)>>8)&$FF),(((0)>>16)&$FF)
(1)   30/ 202C8B6 :                             binclude "sound/instr/smpl/plus_piano_st.wav",$2C     ; actual data
(1)   30/ 202EB18 :                     .end
(1)   31/ 202EB18 :                     ; SmpIns_Vctr04:
(1)   32/ 202EB18 :                     ; 	gSmpl "sound/instr/smpl/vctr04.wav",124
(1)   33/ 202EB18 :                     ; SmpIns_VctrSnare:
(1)   34/ 202EB18 :                     ; 	gSmpl "sound/instr/smpl/vctrSnare.wav",0
(1)   35/ 202EB18 :                     ; SmpIns_VctrKick:
(1)   36/ 202EB18 :                     ; 	gSmpl "sound/instr/smpl/vctrKick.wav",0
(1)   37/ 202EB18 :                     ; SmpIns_VctrTimpani:
(1)   38/ 202EB18 :                     ; 	gSmpl "sound/instr/smpl/vctrTimpani.wav",0
(1)   39/ 202EB18 :                     ; SmpIns_VctrCrash:
(1)   40/ 202EB18 :                     ; 	gSmpl "sound/instr/smpl/vctrCrash.wav",0
(1)   41/ 202EB18 :                     ; SmpIns_VctrBrass:
(1)   42/ 202EB18 :                     ; 	gSmpl "sound/instr/smpl/vctrBrass.wav",1004
(1)   43/ 202EB18 :                     ; SmpIns_VctrAmbient:
(1)   44/ 202EB18 :                     ; 	gSmpl "sound/instr/smpl/vctrBrass.wav",124
(1)   45/ 202EB18 :                     ;
(1)   46/ 202EB18 :                     ; SmpIns_Bell_Ice:
(1)   47/ 202EB18 :                     ; 	gSmpl "sound/instr/smpl/bell_ice.wav",0
(1)   48/ 202EB18 :                     ; SmpIns_Brass1_Hi:
(1)   49/ 202EB18 :                     ; 	gSmpl "sound/instr/smpl/brass1_hi.wav",0
(1)   50/ 202EB18 :                     ; SmpIns_Brass1_Low:
(1)   51/ 202EB18 :                     ; 	gSmpl "sound/instr/smpl/brass1_low.wav",0
(1)   52/ 202EB18 :                     ; SmpIns_Forest_1:
(1)   53/ 202EB18 :                     ; 	gSmpl "sound/instr/smpl/forest1.wav",0
(1)   54/ 202EB18 :                     ; SmpIns_Kick_jam:
(1)   55/ 202EB18 :                     ; 	gSmpl "sound/instr/smpl/kick_jam.wav",0
(1)   56/ 202EB18 :                     ; SmpIns_Snare_jam:
(1)   57/ 202EB18 :                     ; 	gSmpl "sound/instr/smpl/snare_jam.wav",0
(1)   58/ 202EB18 :                     ; SmpIns_SnrTom_1:
(1)   59/ 202EB18 :                     ; 	gSmpl "sound/instr/smpl/snrtom_1.wav",0
(1)   60/ 202EB18 :                     ; SmpIns_PIANO_1:
(1)   61/ 202EB18 :                     ; 	gSmpl "sound/instr/smpl/PIANO__1.wav",0
(1)   62/ 202EB18 :                     ; SmpIns_SSTR162A:
(1)   63/ 202EB18 :                     ; 	gSmpl "sound/instr/smpl/SSTR162A.wav",0
(1)   64/ 202EB18 :                     
(1)   65/ 202EB18 :                     ; --------------------------------------------------------
(1)   66/ 202EB18 :                     ; Graphics
(1)   67/ 202EB18 :                     ; --------------------------------------------------------
(1)   68/ 202EB18 :                     
(1)   69/ 202EB18 :                     TESTMARS_BG:
(1)   70/ 202EB18 :                     	binclude "data/mars/test_art.bin"
(1)   71/ 2096318 :                     	align 4
(1)   72/ 2096318 :                     
(1)   73/ 2096318 :                     TESTMARS_BG2:
(1)   74/ 2096318 :                     	binclude "data/mars/test2_art.bin"
(1)   75/ 20A7B18 :                     	align 4
(1)   76/ 20A7B18 :                     
(1)   77/ 20A7B18 :                     ; ; --------------------------------------------------------
(1)   78/ 20A7B18 :                     ; ; Models
(1)   79/ 20A7B18 :                     ; ; --------------------------------------------------------
(1)   80/ 20A7B18 :                     ;
(1)   81/ 20A7B18 :                     ; 	include "data/mars/objects/mdl/test/head.asm"
(1)   82/ 20A7B18 :                     
(1)   83/ 20A7B18 :                     Textr_pecsi:
(1)   84/ 20A7B18 :                     	binclude "data/mars/objects/mtrl/pecsi_art.bin"
(1)   85/ 20B7B18 :                     	align 4
(1)   86/ 20B7B18 :                     
(1)   87/ 20B7B18 :                     
     117/ 20B7B18 :                     		include "sound/smpl_pwm.asm"
(1)    1/ 20B7B18 :                     ; ====================================================================
(1)    2/ 20B7B18 :                     ; PWM samples
(1)    3/ 20B7B18 :                     ;
(1)    4/ 20B7B18 :                     ; For SH2's visible areas: ROM ($02000000) or SDRAM ($06000000)
(1)    5/ 20B7B18 :                     ;
(1)    6/ 20B7B18 :                     ; SDRAM is safest but it has very low storage
(1)    7/ 20B7B18 :                     ;
(1)    8/ 20B7B18 :                     ; ROM area can use all the 4 Megabytes of storage, BUT when the
(1)    9/ 20B7B18 :                     ; RV bit is set, the sample data will be lost... but luckily
(1)   10/ 20B7B18 :                     ; a "Wave-backup" feature is implemented to copy a small
(1)   11/ 20B7B18 :                     ; amount of bytes of the sample data to a safe place for playback
(1)   12/ 20B7B18 :                     ; while RV bit is active.
(1)   13/ 20B7B18 :                     ; Do note that if the RV bit stays active too long it will cause
(1)   14/ 20B7B18 :                     ; the sample to click.
(1)   15/ 20B7B18 :                     ; ====================================================================
(1)   16/ 20B7B18 :                     
(1)   17/ 20B7B18 :                     ; Special sample data macro
(1)   18/ 20B7B18 :                     gPwm macro locate,loop
(1)   19/ 20B7B18 :                     .start
(1)   20/ 20B7B18 :                     	dc.b ((.end-.start)&$FF),(((.end-.start)>>8)&$FF),(((.end-.start)>>16)&$FF)	; length
(1)   21/ 20B7B18 :                     	dc.b ((loop)&$FF),(((loop)>>8)&$FF),(((loop)>>16)&$FF)
(1)   22/ 20B7B18 :                     	binclude locate,$2C	; actual data
(1)   23/ 20B7B18 :                     .end
(1)   24/ 20B7B18 :                     	align 4			; align 4 for pwm's
(1)   25/ 20B7B18 :                     	endm
(1)   26/ 20B7B18 :                     
(1)   27/ 20B7B18 :                     ; --------------------------------------------------------
(1)   28/ 20B7B18 :                     	align 4			; FIRST ALIGN FOR PWMs
(1)   29/ 20B7B18 :                     
(1)   30/ 20B7B18 :                     PwmIns_Test_st:
(1)   31/ 20B7B18 : (MACRO)             	gPwm "sound/instr/smpl/baila_st.wav",0
(1)   31/ 20B7B18 :                     .start
(1)   31/ 20B7B18 : 686F 02                     dc.b ((.end-.start)&$FF),(((.end-.start)>>8)&$FF),(((.end-.start)>>16)&$FF)     ; length
(1)   31/ 20B7B1B : 0000 00                     dc.b ((0)&$FF),(((0)>>8)&$FF),(((0)>>16)&$FF)
(1)   31/ 20B7B1E :                             binclude "sound/instr/smpl/baila_st.wav",$2C     ; actual data
(1)   31/ 20DEA80 :                     .end
(1)   31/ 20DEA80 :                             align 4                 ; align 4 for pwm's
(1)   32/ 20DEA80 :                     
(1)   33/ 20DEA80 :                     ; DacIns_wegot_kick:
(1)   34/ 20DEA80 :                     ; 	gSmpl "sound/instr/smpl/wegot_kick.wav",0
(1)   35/ 20DEA80 :                     ; DacIns_wegot_crash:
(1)   36/ 20DEA80 :                     ; 	gSmpl "sound/instr/smpl/wegot_crash.wav",0
(1)   37/ 20DEA80 :                     ; ; DacIns_Snare_Gem:
(1)   38/ 20DEA80 :                     ; ; 	gSmpl "sound/instr/smpl/snare_lobo.wav",0
(1)   39/ 20DEA80 :                     ; ; DacIns_CdSnare:
(1)   40/ 20DEA80 :                     ; ; 	gSmpl "sound/instr/smpl/cd_snare.wav",0
(1)   41/ 20DEA80 :                     ; ; DacIns_SaurKick:
(1)   42/ 20DEA80 :                     ; ; 	gSmpl "sound/instr/smpl/sauron_kick.wav",0
(1)   43/ 20DEA80 :                     ; ; DacIns_SaurSnare:
(1)   44/ 20DEA80 :                     ; ; 	gSmpl "sound/instr/smpl/sauron_snare.wav",0
(1)   45/ 20DEA80 :                     ; ; DacIns_String1:
(1)   46/ 20DEA80 :                     ; ; 	gSmpl "sound/instr/smpl/string_1.wav",0
(1)   47/ 20DEA80 :                     ; ; DacIns_LowString:
(1)   48/ 20DEA80 :                     ; ; 	gSmpl "sound/instr/smpl/lowstring.wav",1200
(1)   49/ 20DEA80 :                     
     118/   DEA80 :                     		dephase
     119/   DEA80 :                     
     120/   DEA80 :                     ; ====================================================================
     121/   DEA80 :                     ; ---------------------------------------------
     122/   DEA80 :                     ; End
     123/   DEA80 :                     ; ---------------------------------------------
     124/   DEA80 :                     
     125/   DEA80 :                     ROM_END:
     126/   DEA80 :                     		align $8000
     127/   E0000 :                     
 AS V1.42 Beta [Bld 118] - source file mars.asm - page 2 - 3/25/2022 5:01:36


  symbol table (* = unused):
  ------------------------

 ADAPTER :                        0 - | *ADEN :                           2 - |
 ALV :                           24 - |
*ARCHITECTURE :                                        x86_64-unknown-linux - |
 ART_BGTEST :                 187F0 C |  ART_BGTEST_E :               1B930 C |
*ART_EMI :                    20000 C | *ART_EMI_E :                  22B80 C |
 ART_FGTEST :                 16570 C |  ART_FGTEST_E :               187F0 C |
 ASCII_FONT :                 15570 C |  ASCII_FONT_E :               16570 C |
 ASCII_PAL :                 883340 C | *ASCII_PAL_E :               883360 C |
 ATK :                            8 - | *BIGENDIAN :                      0 - |
*BITCLICKL :                      1 - | *BITCLICKM :                      2 - |
*BITCLICKR :                      0 - | *BITCLICKS :                      3 - |
 BITDISPENBL :                    6 - |  BITDMA :                         1 - |
 BITDMAENBL :                     4 - | *BITHINT :                        2 - |
*BITHINTENBL :                    4 - | *BITHVSTOP :                      1 - |
*BITJOYA :                        6 - | *BITJOYB :                        4 - |
*BITJOYC :                        5 - |  BITJOYDOWN :                     1 - |
 BITJOYLEFT :                     2 - | *BITJOYMODE :                     B - |
 BITJOYRIGHT :                    3 - |  BITJOYSTART :                    7 - |
 BITJOYUP :                       0 - |  BITJOYX :                        A - |
*BITJOYY :                        9 - | *BITJOYZ :                        8 - |
 BITMAPMD :                       1 - | *BITV30 :                         3 - |
 BITVINT :                        3 - | *BITVINTENBL :                    5 - |
*BRANCHEXT :                      0 - |  CACHE_MASTER :             6001504 C |
 CACHE_MASTER_E :           6001BA8 C |  CACHE_SLAVE :              6001BA8 C |
 CACHE_SLAVE_E :            6002358 C |  CACH_BGFBPOS_H :  FFFFFFFFC00006A0 C |
 CACH_BGFBPOS_H.END :                                      FFFFFFFFC00006A4 C |
 CACH_BGFBPOS_V :  FFFFFFFFC000069C C |  CACH_BKUPPNT_L :  FFFFFFFFC000077C C |
 CACH_BKUPPNT_S :  FFFFFFFFC000079C C |  CACH_BKUPS_L :    FFFFFFFFC000079C C |
 CACH_BKUPS_S :    FFFFFFFFC00007B0 C |
 CACH_BKUPS_S.END :                                        FFFFFFFFC00007B0 C |
 CACH_BKUP_L :     FFFFFFFFC00005EC C |  CACH_BKUP_S :     FFFFFFFFC000062C C |
 CACH_CURRPLYGN :  FFFFFFFFC0000744 C |  CACH_DDA_LAST :   FFFFFFFFC000063C C |
 CACH_DDA_SRC :    FFFFFFFFC000064C C |  CACH_DDA_SRC_L :  FFFFFFFFC000066C C |
 CACH_DDA_SRC_R :  FFFFFFFFC000067C C |  CACH_DDA_TOP :    FFFFFFFFC000062C C |
 CACH_XHEAD_L :    FFFFFFFFC000068C C |  CACH_XHEAD_R :    FFFFFFFFC0000690 C |
 CACH_YHEAD_D :    FFFFFFFFC0000698 C |  CACH_YHEAD_U :    FFFFFFFFC0000694 C |
*CAM_ANIMDATA :                  18 C | *CAM_ANIMFRAME :                 1C C |
*CAM_ANIMSPD :                   24 C | *CAM_ANIMTIMER :                 20 C |
 CAM_X_POS :                      0 C |  CAM_X_ROT :                      C C |
 CAM_Y_POS :                      4 C |  CAM_Y_ROT :                     10 C |
 CAM_Z_POS :                      8 C |  CAM_Z_ROT :                     14 C |
*CART :                           1 - | *CASESENSITIVE :                  0 - |
 CHIP_ENV :                     F8E C |  CHIP_ENV.ATKEND :             1063 C |
*CHIP_ENV.ATKZERO :            1066 C |  CHIP_ENV.CHK2 :               106C C |
 CHIP_ENV.CHK4 :               10A1 C |  CHIP_ENV.CKOF :                FBC C |
 CHIP_ENV.CKON :                FD9 C |  CHIP_ENV.COPYOPS :            11C9 C |
 CHIP_ENV.COPYOPS3 :           1255 C |  CHIP_ENV.COPY_1 :             1229 C |
*CHIP_ENV.DECTMR :             1070 C |  CHIP_ENV.DKADD :              108A C |
 CHIP_ENV.DKSAV :              1092 C |  CHIP_ENV.DKYEND :             1097 C |
 CHIP_ENV.DO_VOL :             12C3 C |  CHIP_ENV.ENVPROC :            1034 C |
 CHIP_ENV.FM_CHNL :            1150 C | *CHIP_ENV.FM_CHNLVOL :         1281 C |
 CHIP_ENV.FM_INSUPD :          1218 C |  CHIP_ENV.FM_INS_EX :          127B C |
 CHIP_ENV.FM_KEYCUT :          11E3 C |  CHIP_ENV.FM_KEYOFF :          11F8 C |
*CHIP_ENV.FM_PANSET :          1205 C |  CHIP_ENV.FM_PANUPD :          11FF C |
 CHIP_ENV.FM_VOLUPD :          127D C |  CHIP_ENV.KILLENV :            10B7 C |
 CHIP_ENV.NEXTFM_1 :           10F9 C |  CHIP_ENV.NOMIDC :             110E C |
 CHIP_ENV.NOTFM3 :             11D4 C |  CHIP_ENV.NOUPD :              10E3 C |
 CHIP_ENV.NSKIP :              102B C |  CHIP_ENV.PSTEAL :             101A C |
 CHIP_ENV.REQ_DAC :            113D C |  CHIP_ENV.REQ_PITCH :          114A C |
 CHIP_ENV.SETHAT :             1025 C |  CHIP_ENV.TNMODE :             100F C |
 CHIP_ENV.VEDLP :              10BF C |  CHIP_ENV.VLMUCH :             10D4 C |
 CHIP_ENV.VLOOP :               F99 C |  CHIP_ENV.VMUCH :              12CD C |
 CHIP_ENV.WRFREQ :              FEB C |  CHNL_CHIP :                      0 - |
 CHNL_EFFARG :                    5 - |  CHNL_EFFID :                     4 - |
 CHNL_FLAGS :                     7 - |  CHNL_INS :                       2 - |
 CHNL_NOTE :                      1 - |  CHNL_TYPE :                      6 - |
 CHNL_VOL :                       3 - | *CLICKL :                         2 - |
*CLICKM :                         4 - | *CLICKR :                         1 - |
*CLICKS :                         8 - |  CMDINTCLR :                     1A - |
 CMDIRQ_ON :                      2 - |  COM :                            0 - |
 COMM0 :                         20 - |  COMM1 :                         21 - |
*COMM10 :                        2A - | *COMM11 :                        2B - |
 COMM12 :                        2C - | *COMM13 :                        2D - |
 COMM14 :                        2E - | *COMM15 :                        2F - |
*COMM2 :                         22 - | *COMM3 :                         23 - |
 COMM4 :                         24 - | *COMM5 :                         25 - |
*COMM6 :                         26 - | *COMM7 :                         27 - |
 COMM8 :                         28 - | *COMM9 :                         29 - |
 COMMZFIFO :                   1F00 C |  COMMZREAD :                     1E C |
 COMMZROMBLK :                   1C C |  COMMZROMRD :                    1D C |
 COMMZWRITE :                    1F C | *CONSTPI :        3.141592653589793 - |
 CONTROLLER_1 :    FFFFFFFFFFFFA622 - | *CONTROLLER_2 :    FFFFFFFFFFFFA632 - |
*CS0 :                            0 - |  CS1 :                      2000000 - |
 CS2 :                      4000000 - |  CS3 :                      6000000 - |
 CURRINSDATA :                 19B6 C |  CURRINSPOS :                  19BA C |
 CURRTBLPOS :                  19B8 C |  CURRTICKBITS :                  30 C |
 CURRTRKCTRL :                 19BC C |  CYCLE :                         32 - |
 DACCOM :                      1765 C | *DACINS_SNARE_LOBO :         910D54 C |
 DACINS_SNARE_MAGN :         911E7E C |  DACINS_WEGOT_CRASH :        90E08A C |
 DACINS_WEGOT_KICK :         90D910 C |  DAC_FILL :                      20 C |
 DAC_FIRSTFILL :               134B C |  DAC_ME :                         8 C |
 DAC_OFF :                     1302 C |  DAC_ON :                      12ED C |
 DAC_PLAY :                    1317 C |  DAC_REFILL :                  134F C |
 DAC_REFILL.DAC_OVER :         139D C |  DAC_REFILL.FDF7 :             140F C |
 DAC_REFILL.FDF72 :            13C8 C |  DAC_REFILL.FDFRETURN :        1412 C |
*DAC_REFILL.KEEPCNTR :         1376 C | *DATE :                   3/25/2022 - |
 DDACCNTR :                    1F43 C |  DDACFIFOMID :                 1F46 C |
 DDACPNTR :                    1F40 C | *DISPENBL :                      40 - |
 DKY :                            C - |  DMACODE_END :               883488 C |
 DMACODE_START :             883360 C | *DMAENBL :                       10 - |
*DOTTEDSTRUCTS :                  0 - | *DPLC_NICOLE :               884074 C |
 DPLC_NICOLE.DPLC :          884074 C | *DPLC_NICOLE.END :           884114 C |
 DPLC_NICOLE.FRAME_0 :       884094 C |  DPLC_NICOLE.FRAME_1 :       88409C C |
 DPLC_NICOLE.FRAME_10 :      8840E6 C |  DPLC_NICOLE.FRAME_11 :      8840EE C |
 DPLC_NICOLE.FRAME_12 :      8840F6 C |  DPLC_NICOLE.FRAME_13 :      8840FE C |
 DPLC_NICOLE.FRAME_14 :      884106 C |  DPLC_NICOLE.FRAME_15 :      88410E C |
 DPLC_NICOLE.FRAME_2 :       8840A6 C |  DPLC_NICOLE.FRAME_3 :       8840AE C |
 DPLC_NICOLE.FRAME_4 :       8840B6 C |  DPLC_NICOLE.FRAME_5 :       8840BE C |
 DPLC_NICOLE.FRAME_6 :       8840C6 C |  DPLC_NICOLE.FRAME_7 :       8840CE C |
 DPLC_NICOLE.FRAME_8 :       8840D6 C |  DPLC_NICOLE.FRAME_9 :       8840DE C |
 DREQCTL :                        6 - | *DREQDEST :                       C - |
 DREQFIFO :                      12 - |  DREQLEN :                       10 - |
*DREQSOURCE :                     8 - |  DREQ_BGEX_DATA :                 8 C |
 DREQ_BGEX_H :                   10 C |  DREQ_BGEX_W :                    C C |
 DREQ_BGEX_X :                    0 C |  DREQ_BGEX_Y :                    4 C |
 DREQ_OBJECTS :                 230 C |  DREQ_PALETTE :                  30 C |
 DREQ_SCLDATA :                  14 C |  DREQ_SCLDX :                    20 C |
 DREQ_SCLDY :                    24 C | *DREQ_SCLHEIGHT :                2C C |
*DREQ_SCLWIDTH :                 28 C |  DREQ_SCLX :                     18 C |
 DREQ_SCLY :                     1C C |  DRV_LOOP :                      42 C |
 DRV_LOOP.CMND_0 :               EA C |  DRV_LOOP.CMND_TRKPLAY :         EE C |
 DRV_LOOP.CMND_TRKRESUME :      156 C |  DRV_LOOP.CMND_TRKSTOP :        14A C |
 DRV_LOOP.CMND_TRKTEMPO :       175 C |  DRV_LOOP.CMND_TRKTICKS :       163 C |
 DRV_LOOP.LIST :                 AA C |  DRV_LOOP.NEITHER :              82 C |
 DRV_LOOP.NEXT_CMD :             89 C |  DRV_LOOP.NOBEATS :              6A C |
 DRV_LOOP.NOTICKS :              5D C |  DRWSLD_NEXTPZ :   FFFFFFFFC00005A8 C |
 DRWSLD_NEXTPZ.FINISH_IT :                                 FFFFFFFFC00005C4 C |
 DRWSLD_NEXTPZ.RESET_RD :                                  FFFFFFFFC00005B4 C |
 DRWSLD_NXTLINE :  FFFFFFFFC0000528 C |
 DRWSLD_NXTLINE.L_FIX :                                    FFFFFFFFC000056A C |
 DRWSLD_NXTLINE.REVERS :                                   FFFFFFFFC0000554 C |
 DRWSLD_NXTLINE.R_FIX :                                    FFFFFFFFC0000564 C |
 DRWSLD_NXTLINE.WAIT :                                     FFFFFFFFC0000578 C |
 DRWSLD_NXTLINE_TEX :                                      FFFFFFFFC00003CC C |
 DRWSLD_NXTLINE_TEX.TEX_SKIP_LINE :                        FFFFFFFFC00004BE C |
 DRWSLD_NXTLINE_TEX.TEX_XLOOP :                            FFFFFFFFC000047E C |
 DRWSLD_NXTLINE_TEX.TL_FIX :                               FFFFFFFFC0000454 C |
 DRWSLD_NXTLINE_TEX.TR_FIX :                               FFFFFFFFC0000440 C |
 DRWSLD_NXTLINE_TEX.TXREVERS :                             FFFFFFFFC000040E C |
 DRWSLD_UPDLINE :  FFFFFFFFC000059E C |
 DRWSLD_UPDLINE_TEX :                                      FFFFFFFFC00004D0 C |
 DRWTASK_EXIT :    FFFFFFFFC00005C4 C |  DRWTEX_GONXTPZ :  FFFFFFFFC00004EC C |
 DRWTEX_GONXTPZ.FINISH_IT :                                FFFFFFFFC0000508 C |
 DRWTEX_GONXTPZ.RESET_RD :                                 FFFFFFFFC00004F8 C |
 DRWTSK1_VLD_Y :   FFFFFFFFC00003A6 C |
 DRWTSK_SOLIDMODE :                                        FFFFFFFFC0000514 C |
 DRWTSK_SOLIDMODE.WAIT :                                   FFFFFFFFC0000522 C |
 DRWTSK_TEXMODE :  FFFFFFFFC00003C4 C |  DRW_UD_EXIT :              6000A58 C |
 DTH :                           20 - |  DTL :                           1C - |
 DTSK01_LRDRAW :            600094A C |  DTSK01_LRDRAW.INDXMODE :   6000974 C |
 DTSK01_LRDRAW.NOT_L2 :     6000982 C |  DTSK01_LRDRAW.PREFIX_R :   6000960 C |
 DTSK01_LRDRAW.XLINE :      6000958 C |  DTSK01_LRDRAW.YRES :       6000950 C |
 DWAVEBUFF :                   1C00 C | *EXTR_3 :                         A C |
*EXTR_4 :                         C C | *EXTR_5 :                         E C |
*FALSE :                          0 - |  FBVRAM_PATCH :               1E000 - |
*FEN :                            2 - |  FILLDATA :                       8 - |
 FILLLENGTH :                     4 - |  FILLSTART :                      6 - |
 FLG :                           28 - |  FM :                            80 - |
 FM3REG :                      1759 C |  FMCOM :                       1645 C |
 FMFREQ_LIST :                 1417 C |  FMFRQH :                        18 - |
 FMFRQL :                        1E - | *FMINS_BANJO_PUY :           90D8D0 C |
*FMINS_BASS_1 :              90D710 C | *FMINS_BASS_CALM :           90D6F0 C |
 FMINS_BASS_CLUB :           90D730 C | *FMINS_BASS_DONNA :          90D750 C |
 FMINS_BASS_GROOVE_2 :       90D770 C | *FMINS_BASS_GROOVE_GEM :     90D790 C |
 FMINS_BASS_ITALO :          90D7B0 C | *FMINS_BASS_OIL :            90D670 C |
 FMINS_BRASS_EUR :           90D870 C | *FMINS_BRASS_PUY :           90D890 C |
 FMINS_COM :                   1669 C |  FMINS_COM2 :                  1691 C |
 FMINS_COM3 :                  16B9 C |  FMINS_COM4 :                  16E1 C |
 FMINS_COM5 :                  1709 C |  FMINS_COM6 :                  1731 C |
*FMINS_DING_BASEBALL :       90D6B0 C |  FMINS_DING_TOY :            90D850 C |
*FMINS_DRUMKICK_GEM :        90D6D0 C | *FMINS_FLAUTE_CAVE :         90D8B0 C |
*FMINS_FM3_CLOSEDHAT :       90D620 C |  FMINS_FM3_EXPLOSION :       90D648 C |
 FMINS_FM3_OPENHAT :         90D5F8 C | *FMINS_ORGAN_ITO :           90D690 C |
 FMINS_PSYNTH_PLUS :         90D8F0 C | *FMINS_TRUMPET_1 :           90D7D0 C |
*FMINS_TRUMPET_2 :           90D7F0 C |  FMINS_TRUMPET_CARNIVAL :    90D830 C |
*FMINS_TRUMPET_KON :         90D810 C |  FMKEYS :                         6 - |
 FMPAN :                         12 - |  FMSPCMODE :                   1F48 C |
 FMVOL :                          C - |  FM_SEND_1 :                   12D7 C |
 FM_SEND_2 :                   12E2 C |  FRAMECTL :                       B - |
*FS :                             1 - | *FULLPMMU :                       1 - |
 GEMABLK_TEST :              904193 C |  GEMABLK_TEST2 :             906043 C |
 GEMABLK_TEST3 :             907D73 C |  GEMAINS_TEST :              90602F C |
 GEMAINS_TEST2 :             907D17 C |  GEMAINS_TEST3 :             90D580 C |
 GEMAPAT_TEST :              904195 C |  GEMAPAT_TEST2 :             906058 C |
 GEMAPAT_TEST3 :             907D91 C |  GEMASFXBLK_BOOM :           904120 C |
 GEMASFXINS_BOOM :           90416F C |  GEMASFXPAT_BOOM :           904123 C |
*GEMATRKDATA_SFX :           904114 C | *GEMATRKDATA_TEST :          904187 C |
*GEMATRKDATA_TEST2 :         906037 C | *GEMATRKDATA_TEST3 :         907D67 C |
 GEMA_INIT :                    E1F C |  GEMA_INIT.SET_IT :             E7A C |
 GET_CMDBYTE :                  19F C | *GET_CMDBYTE.GETCBYTEL :        1A2 C |
 GET_TICK :                     E84 C |  GET_TICK.CTNOTICK :            EA1 C |
 GET_TRKINDX :                  18A C |  GLBL_LASTORG :               2C8B0 - |
 GLBL_LASTPC :              6009D30 - |
 GO_DRWSLD_UPDLINE_TEX :                                   FFFFFFFFC00003BC C |
 GO_DRWTASK_EXIT : FFFFFFFFC000036A C |
 GO_DRWTEX_GONXTPZ :                                       FFFFFFFFC00003C0 C |
*HAS64 :                          1 - | *HASDSP :                         0 - |
*HASFPU :                         0 - | *HASPMMU :                        0 - |
*HBLK :                          40 - | *HCOUNT :                         5 - |
 HINTCLR :                       18 - | *HINTENBL :                      10 - |
 HINT_DEFAULT :              88394A C | *HIRQ_ON :                        4 - |
*HVSTOP :                         2 - | *INEXTMODE :                      0 - |
*INLWORDMODE :                    0 - | *INMAXMODE :                      0 - |
 INSDATAC_0 :                  18B6 C |  INSDATAC_1 :                  1936 C |
*INSRCMODE :                      0 - | *INSUPMODE :                      1 - |
 INTMASK :                        1 - |  INT_M_LIST :               600026C C |
 INT_S_LIST :               60002CC C | *JOYA :                          40 - |
*JOYB :                          10 - | *JOYC :                          20 - |
*JOYDOWN :                        2 - | *JOYLEFT :                        4 - |
*JOYMODE :                      800 - | *JOYRIGHT :                       8 - |
*JOYSTART :                      80 - | *JOYUP :                          1 - |
*JOYX :                         400 - | *JOYY :                         200 - |
*JOYZ :                         100 - |  LCHWIDTH :                      34 - |
 LEV :                            4 - | *LISTON :                         3 - |
 LIST_VDPREGS :              88332C C |  LITERAL_F_00000000_1 :     6000268 C |
 LITERAL_F_00000001_1 :     600041C C |  LITERAL_F_00000002_1 :     6000434 C |
 LITERAL_F_00000003_1 :     6000438 C |  LITERAL_F_00000004_1 :     600043C C |
 LITERAL_F_00000005_1 :     600044C C |  LITERAL_F_00000006_1 :     600061C C |
 LITERAL_F_00000007_1 :     6000620 C |  LITERAL_F_00000008_1 :     6000624 C |
 LITERAL_F_00000009_1 :     600062C C |  LITERAL_F_0000000A_1 :     6000630 C |
 LITERAL_F_0000000B_1 :     6000648 C |  LITERAL_F_0000000C_1 :     6000634 C |
 LITERAL_F_0000000D_1 :     6000638 C |  LITERAL_F_0000000E_1 :     600063C C |
 LITERAL_F_0000000F_1 :     6000640 C |  LITERAL_F_00000010_1 :     60006D4 C |
 LITERAL_F_00000011_1 :     6000744 C |  LITERAL_F_00000012_1 :     60008A0 C |
 LITERAL_F_00000013_1 :     600092C C |  LITERAL_F_00000014_1 :     6000930 C |
 LITERAL_F_00000015_1 :     6000934 C |  LITERAL_F_00000016_1 :     600093C C |
 LITERAL_F_00000017_1 :     6000940 C |  LITERAL_F_00000018_1 :     6000944 C |
 LITERAL_F_00000019_1 :     6000A60 C |  LITERAL_F_0000001A_1 :     6000A64 C |
 LITERAL_F_0000001B_1 :     6000A68 C |  LITERAL_F_0000001C_1 :     6000A6C C |
 LITERAL_F_0000001D_1 :     6000A70 C |  LITERAL_F_0000001E_1 :     6000C54 C |
 LITERAL_F_0000001F_1 :     6000C58 C |  LITERAL_F_00000020_1 :     6000C5C C |
 LITERAL_F_00000021_1 :     6000C60 C |  LITERAL_F_00000022_1 :     6000C64 C |
 LITERAL_F_00000023_1 :     6000C68 C |  LITERAL_F_00000024_1 :     6000C6C C |
 LITERAL_F_00000025_1 :     6000D58 C |  LITERAL_F_00000026_1 :     6000E48 C |
 LITERAL_F_00000027_1 :     6000E50 C |  LITERAL_F_00000028_1 :     6000E54 C |
 LITERAL_F_00000029_1 :     6000E58 C |  LITERAL_F_0000002A_1 :     6000E5C C |
 LITERAL_F_0000002B_1 :     6000E60 C |  LITERAL_F_0000002C_1 :     6000F08 C |
 LITERAL_F_0000002D_1 :     6000F2C C |  LITERAL_F_0000002E_1 :     6000F1C C |
 LITERAL_F_0000002F_1 :     6000F20 C |  LITERAL_F_00000030_1 :     6001098 C |
 LITERAL_F_00000031_1 :     60010A0 C |  LITERAL_F_00000032_1 :     60010A8 C |
 LITERAL_F_00000033_1 :     600116C C |  LITERAL_F_00000034_1 :     6001170 C |
 LITERAL_F_00000035_1 :     6001174 C |  LITERAL_F_00000036_1 :     6001178 C |
 LITERAL_F_00000037_1 :     600117C C |  LITERAL_F_00000038_1 :     6001180 C |
 LITERAL_F_00000039_1 :     6001184 C |  LITERAL_F_0000003A_1 :     6001188 C |
 LITERAL_F_0000003B_1 :     6001194 C |  LITERAL_F_0000003C_1 :     600134C C |
 LITERAL_F_0000003D_1 :     6001350 C |  LITERAL_F_0000003E_1 :     6001354 C |
 LITERAL_F_0000003F_1 :     6001360 C |  LITERAL_F_00000040_1 :     600136C C |
 LITERAL_F_00000041_1 :     6001370 C |  LITERAL_F_00000042_1 :     6001374 C |
 LITERAL_F_00000043_1 :     6001378 C |  LITERAL_F_00000044_1 :     600137C C |
 LITERAL_F_00000045_1 :     6001380 C |  LITERAL_F_00000046_1 :     6001384 C |
 LITERAL_F_00000047_1 :     6001388 C |  LITERAL_F_00000048_1 :     6001484 C |
 LITERAL_F_00000049_1 :     60014C8 C |  LITERAL_F_0000004A_1 :     6001494 C |
 LITERAL_F_0000004B_1 :     6001498 C |  LITERAL_F_0000004C_1 :     60014A0 C |
 LITERAL_F_0000004D_1 :     60014A8 C |  LITERAL_F_0000004E_1 :     60014AC C |
 LITERAL_F_0000004F_1 :     60014B0 C |  LITERAL_F_00000050_1 :     60014B4 C |
 LITERAL_F_00000051_1 :     60014B8 C |
 LITERAL_F_00000052_1 :                                    FFFFFFFFC0000164 C |
 LITERAL_F_00000053_1 :                                    FFFFFFFFC0000168 C |
 LITERAL_F_00000054_1 :                                    FFFFFFFFC000016C C |
 LITERAL_F_00000055_1 :                                    FFFFFFFFC0000170 C |
 LITERAL_F_00000056_1 :                                    FFFFFFFFC0000178 C |
 LITERAL_F_00000057_1 :                                    FFFFFFFFC000017C C |
 LITERAL_F_00000058_1 :                                    FFFFFFFFC0000180 C |
 LITERAL_F_00000059_1 :                                    FFFFFFFFC0000338 C |
 LITERAL_F_0000005A_1 :                                    FFFFFFFFC000033C C |
 LITERAL_F_0000005B_1 :                                    FFFFFFFFC0000340 C |
 LITERAL_F_0000005C_1 :                                    FFFFFFFFC0000344 C |
 LITERAL_F_0000005D_1 :                                    FFFFFFFFC0000348 C |
 LITERAL_F_0000005E_1 :                                    FFFFFFFFC000034C C |
 LITERAL_F_0000005F_1 :                                    FFFFFFFFC0000350 C |
 LITERAL_F_00000060_1 :                                    FFFFFFFFC0000354 C |
 LITERAL_F_00000061_1 :                                    FFFFFFFFC0000358 C |
 LITERAL_F_00000062_1 :                                    FFFFFFFFC000035C C |
 LITERAL_F_00000063_1 :                                    FFFFFFFFC0000360 C |
 LITERAL_F_00000064_1 :                                    FFFFFFFFC0000364 C |
 LITERAL_F_00000065_1 :                                    FFFFFFFFC00005CC C |
 LITERAL_F_00000066_1 :                                    FFFFFFFFC00005D0 C |
 LITERAL_F_00000067_1 :                                    FFFFFFFFC00005D8 C |
 LITERAL_F_00000068_1 :                                    FFFFFFFFC00005DC C |
 LITERAL_F_00000069_1 :                                    FFFFFFFFC000028C C |
 LITERAL_F_0000006A_1 :                                    FFFFFFFFC000029C C |
 LITERAL_F_0000006B_1 :                                    FFFFFFFFC00002E8 C |
 LITERAL_F_0000006C_1 :                                    FFFFFFFFC00002EC C |
 LITERAL_F_0000006D_1 :                                    FFFFFFFFC00002F0 C |
 LITERAL_F_0000006E_1 :                                    FFFFFFFFC00002F4 C |
 LITERAL_F_0000006F_1 :                                    FFFFFFFFC00005B0 C |
 LITERAL_F_00000070_1 :                                    FFFFFFFFC00005B8 C |
 LITERAL_F_00000071_1 :                                    FFFFFFFFC00005C0 C |
 LITERAL_F_00000072_1 :                                    FFFFFFFFC00006E4 C |
 LITERAL_F_00000073_1 :                                    FFFFFFFFC00006E8 C |
 LITERAL_F_00000074_1 :                                    FFFFFFFFC00006F0 C |
 LITERAL_F_00000075_1 :                                    FFFFFFFFC0000730 C |
 LITERAL_F_00000076_1 :                                    FFFFFFFFC0000734 C |
 LITERAL_L_0000E000_1 :                                    FFFFFFFFC00005B4 C |
 LITERAL_L_0000FEC0_1 :     6000748 C |  LITERAL_L_0000FF00_1 :     60014BC C |
 LITERAL_L_0000FFFF_1 :     6000D08 C |
 LITERAL_L_0000FFFF_2 :                                    FFFFFFFFC00003A0 C |
 LITERAL_L_00FFFFFF_1 :                                    FFFFFFFFC0000294 C |
 LITERAL_L_02000000_1 :     6000E64 C |
 LITERAL_L_02000000_2 :                                    FFFFFFFFC0000298 C |
 LITERAL_L_02000000_3 :                                    FFFFFFFFC00006EC C |
 LITERAL_L_04000000_1 :     6000740 C |  LITERAL_L_04000000_2 :     60008A4 C |
 LITERAL_L_04000000_3 :     6000938 C |  LITERAL_L_04000000_4 :     6000A5C C |
 LITERAL_L_04000000_5 :     6000D00 C |  LITERAL_L_04000000_6 :     600135C C |
 LITERAL_L_04000200_1 :     6001364 C |  LITERAL_L_0401E000_1 :     6000D04 C |
 LITERAL_L_04020200_1 :                                    FFFFFFFFC00005C8 C |
 LITERAL_L_060006DC_1 :     6000F10 C |  LITERAL_L_060008AA_1 :     600118C C |
 LITERAL_L_0600099C_1 :     6001190 C |  LITERAL_L_0603F000_1 :     6001490 C |
 LITERAL_L_06040000_1 :     6000F18 C |  LITERAL_L_20004000_1 :     6000428 C |
 LITERAL_L_20004000_2 :     60006C8 C |  LITERAL_L_20004000_3 :     6000738 C |
 LITERAL_L_20004000_4 :     6000E44 C |  LITERAL_L_20004000_5 :     6000F14 C |
 LITERAL_L_20004000_6 :     600148C C |  LITERAL_L_20004012_1 :     6000430 C |
 LITERAL_L_20004016_1 :     6000444 C |  LITERAL_L_20004016_2 :     60006C4 C |
 LITERAL_L_20004018_1 :     6000440 C |  LITERAL_L_20004018_2 :     60006C0 C |
 LITERAL_L_2000401A_1 :     6000424 C |  LITERAL_L_2000401A_2 :     6000614 C |
 LITERAL_L_2000401C_1 :     6000420 C |
 LITERAL_L_2000401C_2 :                                    FFFFFFFFC0000288 C |
 LITERAL_L_20004020_1 :     600108C C |  LITERAL_L_20004021_1 :     600149C C |
 LITERAL_L_20004028_1 :     6000628 C |  LITERAL_L_2000402C_1 :     600042C C |
 LITERAL_L_2000402C_2 :     60010A4 C |  LITERAL_L_2000402E_1 :     6000618 C |
 LITERAL_L_2000402E_2 :     6001368 C |  LITERAL_L_2000402E_3 :     60014A4 C |
 LITERAL_L_20004034_1 :                                    FFFFFFFFC00002A0 C |
 LITERAL_L_20004036_1 :                                    FFFFFFFFC00002A4 C |
 LITERAL_L_20004100_1 :     600073C C |  LITERAL_L_20004100_2 :     6001090 C |
 LITERAL_L_20004100_3 :     6001168 C |  LITERAL_L_20004100_4 :     6001358 C |
 LITERAL_L_20004100_5 :                                    FFFFFFFFC00005D4 C |
 LITERAL_L_20004102_1 :     6001094 C |  LITERAL_L_20004200_1 :     600109C C |
 LITERAL_L_3FFFFFFF_1 :                                    FFFFFFFFC00005AC C |
 LITERAL_L_4D5F4F4B_1 :     6000448 C |  LITERAL_L_4D5F4F4B_2 :     60006CC C |
 LITERAL_L_535F4F4B_1 :     60006D0 C |
 LITERAL_L_7FFFFFFF_1 :                                    FFFFFFFFC0000174 C |
 LITERAL_L_7FFFFFFF_2 :                                    FFFFFFFFC00005BC C |
 LITERAL_L_FFFFFFFFC0000000_1 :                                     6000F0C C |
 LITERAL_L_FFFFFFFFC0000000_2 :                                     6001488 C |
 LITERAL_L_FFFFFFFFC0000000_3 :                            FFFFFFFFC0000290 C |
 LITERAL_L_FFFFFFFFFF000000_1 :                                     6000E4C C |
 LITERAL_W_0080_1 :         600074C C |  LITERAL_W_0080_2 :         6000E6C C |
 LITERAL_W_0080_3 :         6001394 C |
 LITERAL_W_0080_4 :                                        FFFFFFFFC00002AC C |
 LITERAL_W_00A0_1 :         6001390 C |
 LITERAL_W_00A0_2 :                                        FFFFFFFFC000018C C |
 LITERAL_W_00A2_1 :         6000D10 C |  LITERAL_W_00E0_1 :         600119E C |
 LITERAL_W_00E0_2 :         6001392 C |
 LITERAL_W_00E0_3 :                                        FFFFFFFFC000018E C |
 LITERAL_W_00E0_4 :                                        FFFFFFFFC00003A4 C |
 LITERAL_W_00E0_5 :                                        FFFFFFFFC00005E6 C |
 LITERAL_W_00F0_1 :         6000450 C |  LITERAL_W_00F0_2 :         6000644 C |
 LITERAL_W_00F0_3 :         60006D8 C |  LITERAL_W_00F0_4 :         600074E C |
 LITERAL_W_00F0_5 :         6000D0E C |  LITERAL_W_00F0_6 :         6000F2E C |
 LITERAL_W_00F0_7 :         60010AC C |  LITERAL_W_00F0_8 :         600138E C |
 LITERAL_W_00F0_9 :         60014CA C |  LITERAL_W_00F0_A :         60014F8 C |
 LITERAL_W_00F0_B :                                        FFFFFFFFC0000184 C |
 LITERAL_W_00F0_C :                                        FFFFFFFFC00002A8 C |
 LITERAL_W_00FC_1 :         600064A C |  LITERAL_W_00FF_1 :         6000D0C C |
 LITERAL_W_00FF_2 :                                        FFFFFFFFC00005E2 C |
 LITERAL_W_0100_1 :         600119C C |  LITERAL_W_0100_2 :         600138C C |
 LITERAL_W_0100_3 :                                        FFFFFFFFC00002F8 C |
 LITERAL_W_0105_1 :         6000E68 C |  LITERAL_W_010C_1 :         6000456 C |
 LITERAL_W_010C_2 :         6000F34 C |
 LITERAL_W_013E_1 :                                        FFFFFFFFC00005E8 C |
 LITERAL_W_0140_1 :         60008A8 C |  LITERAL_W_0140_2 :         6000948 C |
 LITERAL_W_0140_3 :         6000A74 C |  LITERAL_W_0140_4 :         600119A C |
 LITERAL_W_0200_1 :         6001198 C |
 LITERAL_W_03FF_1 :                                        FFFFFFFFC00002AE C |
 LITERAL_W_0415_1 :         6000E6A C |
 LITERAL_W_07FF_1 :                                        FFFFFFFFC0000738 C |
 LITERAL_W_1FFF_1 :                                        FFFFFFFFC00005E4 C |
 LITERAL_W_44E1_1 :         6000454 C |  LITERAL_W_5A00_1 :         6001500 C |
 LITERAL_W_5A08_1 :                                        FFFFFFFFC0000190 C |
 LITERAL_W_5A10_1 :         600139A C |  LITERAL_W_A518_1 :         6000F32 C |
 LITERAL_W_A518_2 :         60014CE C |  LITERAL_W_A518_3 :         60014FE C |
 LITERAL_W_A518_4 :                                        FFFFFFFFC000018A C |
 LITERAL_W_A538_1 :         600139C C |  LITERAL_W_FE10_1 :         6000452 C |
 LITERAL_W_FE10_2 :         6000646 C |  LITERAL_W_FE10_3 :         60006DA C |
 LITERAL_W_FE10_4 :         6000F24 C |  LITERAL_W_FE10_5 :         60014C0 C |
 LITERAL_W_FE10_6 :         60014FA C |
 LITERAL_W_FE10_7 :                                        FFFFFFFFC0000186 C |
 LITERAL_W_FE10_8 :                                        FFFFFFFFC00002AA C |
 LITERAL_W_FE80_1 :         6000F30 C |  LITERAL_W_FE80_2 :         6001398 C |
 LITERAL_W_FE80_3 :         60014CC C |  LITERAL_W_FE80_4 :         60014FC C |
 LITERAL_W_FE80_5 :                                        FFFFFFFFC0000188 C |
 LITERAL_W_FE92_1 :         6000F2A C |  LITERAL_W_FE92_2 :         6001396 C |
 LITERAL_W_FE92_3 :         60014C6 C |  LITERAL_W_FEE2_1 :         6000F26 C |
 LITERAL_W_FEE2_2 :         60014C2 C |  LITERAL_W_FEE4_1 :         6000F28 C |
 LITERAL_W_FEE4_2 :         60014C4 C |
 LITERAL_W_FF00_1 :                                        FFFFFFFFC0000368 C |
 LITERAL_W_FF00_2 :                                        FFFFFFFFC00005E0 C |
 LITERAL_W_FF00_3 :                                        FFFFFFFFC00006F4 C |
 LITERAL_W_FF60_1 :                                        FFFFFFFFC00005C4 C |
*MACEXP :                         7 - |  MAP_BGTEST :                914570 C |
 MAP_FGTEST :                913570 C | *MAP_NICOLE :                883F54 C |
 MAP_NICOLE.FRAME_0 :        883F74 C |  MAP_NICOLE.FRAME_1 :        883F84 C |
 MAP_NICOLE.FRAME_10 :       884019 C |  MAP_NICOLE.FRAME_11 :       884029 C |
 MAP_NICOLE.FRAME_12 :       884039 C |  MAP_NICOLE.FRAME_13 :       884049 C |
 MAP_NICOLE.FRAME_14 :       884059 C |  MAP_NICOLE.FRAME_15 :       884069 C |
 MAP_NICOLE.FRAME_2 :        883F99 C |  MAP_NICOLE.FRAME_3 :        883FA9 C |
 MAP_NICOLE.FRAME_4 :        883FB9 C |  MAP_NICOLE.FRAME_5 :        883FC9 C |
 MAP_NICOLE.FRAME_6 :        883FD9 C |  MAP_NICOLE.FRAME_7 :        883FE9 C |
 MAP_NICOLE.FRAME_8 :        883FF9 C |  MAP_NICOLE.FRAME_9 :        884009 C |
 MAP_NICOLE.MAPPINGS :       883F54 C | *MARS :                           1 - |
 MARSBLOCK :                     32 C | *MARSCD :                         0 - |
 MARSGBL_BGDRWALL :              2C C |  MARSGBL_BGDRWD :                34 C |
 MARSGBL_BGDRWL :                30 C |  MARSGBL_BGDRWR :                2E C |
 MARSGBL_BGDRWU :                32 C |  MARSGBL_CURRFACEPOS :           14 C |
 MARSGBL_CURRFB :                26 C |  MARSGBL_CURRNUMFACES :          18 C |
 MARSGBL_CURRZLIST :              C C |  MARSGBL_CURRZTOP :              10 C |
 MARSGBL_INDXPLGN :               8 C |  MARSGBL_PLGNCNTR :              22 C |
 MARSGBL_PLYPZCNTR :             20 C |  MARSGBL_PLYPZLIST_R :            0 C |
 MARSGBL_PLYPZLIST_W :            4 C |  MARSGBL_POLYBUFFNUM :           1E C |
*MARSGBL_ROMBLKM :               28 C | *MARSGBL_ROMBLKS :               2A C |
*MARSGBL_UPDMODELS :             1A C |  MARSGBL_WDGMODE :               1C C |
 MARSGBL_XSHIFT :                24 C |  MARSMDL_MDLLOOP : FFFFFFFFC00002B0 C |
 MARSMDL_MDLLOOP.INVLID :                                  FFFFFFFFC00002CC C |
 MARSMDL_MDLLOOP.LOOP :                                    FFFFFFFFC00002B6 C |
 MARSMDL_MDLLOOP.PAGE_2 :                                  FFFFFFFFC00002DC C |
 MARSMDL_MDLLOOP.SKIP :                                    FFFFFFFFC00002D2 C |
 MARSMDL_READMODEL :                                       FFFFFFFFC00002FA C |
 MARSMDL_READMODEL.ALLDONE :                               FFFFFFFFC0000462 C |
 MARSMDL_READMODEL.ALLUVDONE :                             FFFFFFFFC000037E C |
 MARSMDL_READMODEL.CAN_BUILD :                             FFFFFFFFC0000320 C |
 MARSMDL_READMODEL.EXIT_MODEL :                            FFFFFFFFC00005A4 C |
 MARSMDL_READMODEL.FACE_OK :                               FFFFFFFFC00004A4 C |
 MARSMDL_READMODEL.FACE_OUT :                              FFFFFFFFC0000598 C |
 MARSMDL_READMODEL.FINISH_THIS :                           FFFFFFFFC00005A0 C |
 MARSMDL_READMODEL.FIRST_FACE :                            FFFFFFFFC00004EA C |
 MARSMDL_READMODEL.GO_FACES :                              FFFFFFFFC00003C2 C |
 MARSMDL_READMODEL.GO_FOUT :                               FFFFFFFFC000049A C |
 MARSMDL_READMODEL.NEXT_FACE :                             FFFFFFFFC000030E C |
 MARSMDL_READMODEL.PAGE_2 :                                FFFFFFFFC00004C6 C |
 MARSMDL_READMODEL.SET_TRI :                               FFFFFFFFC000032E C |
 MARSMDL_READMODEL.SOLID_TYPE :                            FFFFFFFFC00003AC C |
 MARSMDL_READMODEL.SWAP_ME :                               FFFFFFFFC00004E6 C |
 MARSMDL_READMODEL.TAG_ANDMTRL :                           FFFFFFFFC00003A8 C |
 MARSMDL_READMODEL.TAG_MAXFACES :                          FFFFFFFFC000031C C |
 MARSMDL_READMODEL.TAG_XL :                                FFFFFFFFC00004A0 C |
 MARSOBJ_TEST :             6006358 C |  MARSOBJ_TEST.FACE :        60084E4 C |
 MARSOBJ_TEST.MTRL :        6009D24 C |  MARSOBJ_TEST.VERT :        600636C C |
 MARSOBJ_TEST.VRTX :        60091F4 C |  MARSRAM_SOUND :           26016CC8 C |
 MARSRAM_SYSTEM :          26009D30 C |  MARSRAM_VIDEO :           2600A668 C |
*MARSSND_ACTIVE :  FFFFFFFFC0000740 C |  MARSSND_PWMCACHE :        26016CC8 C |
 MARSSND_PWMCHNLS :                                        FFFFFFFFC0000000 C |
 MARSSND_PWMCONTROL :                                      FFFFFFFFC0000118 C |
 MARSSND_REFILL :           6000DF4 C |  MARSSND_REFILL.COPY_NOW :  6000E1A C |
 MARSSND_REFILL.NEXT_ONE :  6000DFC C |  MARSSND_REFILL.NOT_ENBL :  6000E36 C |
 MARSSND_RVMODE :  FFFFFFFFC000073C C |  MARSSOUND_INIT :           6000D5C C |
 MARSSOUND_PWMENABLE :      6000DE4 C |  MARSSOUND_SETPWM :         6000D78 C |
 MARSSOUND_SETPWM.ENDMRK :  6000D9C C |  MARSSOUND_SETPWMPITCH :    6000DB4 C |
 MARSSOUND_SETPWMPITCH.OFF_1 :                                      6000DC8 C |
 MARSSOUND_SETVOLUME :      6000DCC C |
 MARSSOUND_SETVOLUME.OFF_1 :                                        6000DE0 C |
 MARSUPD :                       31 C |  MARSVIDEO_BGDRAWLR :       60008AA C |
 MARSVIDEO_BGDRAWLR.DTSK01_DLEFT :                                  6000904 C |
 MARSVIDEO_BGDRAWLR.DTSK01_DRIGHT :                                 6000910 C |
 MARSVIDEO_BGDRAWLR.INDXMODE :                                      6000920 C |
 MARSVIDEO_BGDRAWLR.NXT_DRAWUD :                                    6000900 C |
 MARSVIDEO_BGDRAWUD :       600099C C |
 MARSVIDEO_BGDRAWUD.DO_UPDOWN :                                     6000A02 C |
 MARSVIDEO_BGDRAWUD.HDNX :  6000A4A C |
 MARSVIDEO_BGDRAWUD.INDXMODE :                                      6000A3C C |
 MARSVIDEO_BGDRAWUD.LWRFB : 6000A20 C |
 MARSVIDEO_BGDRAWUD.SRCLOW :                                        6000A26 C |
*MARSVIDEO_BGDRAWUD.TSK00_DOWN :                                    60009DE C |
 MARSVIDEO_BGDRAWUD.TSK00_UP :                                      60009F2 C |
 MARSVIDEO_BGDRAWUD.UPWRP : 60009D2 C |
 MARSVIDEO_BGDRAWUD.WRPAGAIN :                                      60009CA C |
 MARSVIDEO_BGDRAWUD.X_LOOP :                                        6000A1A C |
 MARSVIDEO_BGDRAWUD.Y_LOOP :                                        6000A0E C |
 MARSVIDEO_DRAWALLBG :      6000750 C |
 MARSVIDEO_DRAWALLBG.HDNPOS :                                       600087A C |
 MARSVIDEO_DRAWALLBG.INDXMODE :                                     600079A C |
 MARSVIDEO_DRAWALLBG.LWR_XNXT :                                     60007C0 C |
 MARSVIDEO_DRAWALLBG.LWR_XVLD :                                     60007C8 C |
 MARSVIDEO_DRAWALLBG.LWR_YNXT :                                     60007D4 C |
 MARSVIDEO_DRAWALLBG.LWR_YVLD :                                     60007DC C |
 MARSVIDEO_DRAWALLBG.MK_PIECE :                                     6000834 C |
 MARSVIDEO_DRAWALLBG.NO_DATA :                                      600082E C |
 MARSVIDEO_DRAWALLBG.NXTLNG :                                       6000864 C |
 MARSVIDEO_DRAWALLBG.NXT_X :                                        6000804 C |
 MARSVIDEO_DRAWALLBG.NXT_X_L :                                      6000810 C |
 MARSVIDEO_DRAWALLBG.NXT_Y :                                        60007F0 C |
 MARSVIDEO_DRAWALLBG.NXT_Y_L :                                      60007F6 C |
 MARSVIDEO_DRAWALLBG.XBG_BACK :                                     60007A2 C |
 MARSVIDEO_DRAWALLBG.XBG_INC :                                      60007AA C |
 MARSVIDEO_DRAWALLBG.XBG_L :                                        600080A C |
 MARSVIDEO_DRAWALLBG.XINIT_L :                                      600079A C |
 MARSVIDEO_DRAWALLBG.YBG_BACK :                                     60007B2 C |
 MARSVIDEO_DRAWALLBG.YBG_INC :                                      60007BA C |
 MARSVIDEO_DRAWALLBG.YBG_L :                                        60007FC C |
*MARSVIDEO_DRAWALLBG.YBLK_EX :                                      600088A C |
 MARSVIDEO_DRAWALLBG.YBLK_LOOPN :                                   6000856 C |
 MARSVIDEO_DRAWALLBG.YMAX : 600085C C |  MARSVIDEO_FIXTBLSHIFT :    6000CBC C |
 MARSVIDEO_FIXTBLSHIFT.COPY :                                       6000CE8 C |
 MARSVIDEO_FIXTBLSHIFT.LOOP :                                       6000CD0 C |
 MARSVIDEO_FIXTBLSHIFT.PTCHSET :                                    6000CFA C |
 MARSVIDEO_FIXTBLSHIFT.TBLEXIT :                                    6000CF4 C |
 MARSVIDEO_INIT :           60006DC C |  MARSVIDEO_INIT.CLNUP :     60006FC C |
 MARSVIDEO_INIT.DEF_FB :    6000718 C |  MARSVIDEO_INIT.NXT_LNE :   600071E C |
 MARSVIDEO_INIT.WAIT_FRM :  600072E C |  MARSVIDEO_MAKETBL :        6000C70 C |
 MARSVIDEO_MAKETBL.LN_LOOP :                                        6000C94 C |
*MARSVIDEO_MAKETBL.NO_LINES :                                       6000CB6 C |
 MARSVIDEO_MAKETBL.XL_L :   6000CA2 C |  MARSVIDEO_MAKETBL.XL_R :   6000C9C C |
 MARSVIDEO_MKSCRLFIELD :    6000D12 C |
 MARSVIDEO_MKSCRLFIELD.NO_INDX :                                    6000D1C C |
 MARSVIDEO_MOVEBG :         6000A76 C |
 MARSVIDEO_MOVEBG.DONT_SNAP :                                       6000C4E C |
 MARSVIDEO_MOVEBG.HAS_SCRLDATA :                                    6000A82 C |
 MARSVIDEO_MOVEBG.INDXMODE :                                        6000C4C C |
*MARSVIDEO_MOVEBG.NO_CHNG : 6000ABE C |  MARSVIDEO_MOVEBG.REQD_B :  6000BA4 C |
 MARSVIDEO_MOVEBG.REQR_B :  6000BE6 C |  MARSVIDEO_MOVEBG.XEQU :    6000A98 C |
 MARSVIDEO_MOVEBG.XNEGTV :  6000B20 C |  MARSVIDEO_MOVEBG.XNEGTVL : 6000B36 C |
 MARSVIDEO_MOVEBG.XPOSTV :  6000B2A C |  MARSVIDEO_MOVEBG.XPOSTVL : 6000B40 C |
 MARSVIDEO_MOVEBG.X_STEND : 6000AB8 C |
 MARSVIDEO_MOVEBG.YDL_BUSY :                                        6000BFC C |
 MARSVIDEO_MOVEBG.YDR_BUSY :                                        6000BBA C |
 MARSVIDEO_MOVEBG.YEQU :    6000AAE C |  MARSVIDEO_MOVEBG.YNEGTV :  6000B4C C |
 MARSVIDEO_MOVEBG.YNEGTVL : 6000B62 C |  MARSVIDEO_MOVEBG.YPOSTV :  6000B56 C |
 MARSVIDEO_MOVEBG.YPOSTVL : 6000B6C C |
 MARSVIDEO_MOVEBG.YPU_NEGTV :                                       6000AD2 C |
 MARSVIDEO_MOVEBG.YPU_POSTV :                                       6000ADC C |
 MARSVIDEO_MOVEBG.YX_NEGTV :                                        6000AF0 C |
 MARSVIDEO_MOVEBG.YX_POSTV :                                        6000AFA C |
 MARSVIDEO_MOVEBG.Y_STEND : 6000ABE C |  MARSVIDEO_SETBG :          6000D3C C |
 MARSVIDEO_SETBG.INDXMODE : 6000D4A C |  MARS_ENTRY :                   800 C |
 MARS_ENTRY.ADAPTER_ENBL :      86C C |  MARS_ENTRY.NO_MARS :           87C C |
 MARS_ENTRY.RAM_CODE :          844 C |  MARS_ENTRY.RESTARTICD :        854 C |
 MARS_RAMDATA :               22B80 C |  MARS_RAMDATA_E :             2C8B0 C |
 MARS_SCOMM :                   4AD C |  MARS_SCOMM.BLOCKED :           530 C |
 MARS_SCOMM.CLRCOM :            535 C |  MARS_SCOMM.NEXT_COMM :         509 C |
 MARS_SCOMM.NEXT_PASS :         4FF C |  MARS_SCOMM.WAIT_CMD :          4F7 C |
 MARS_SCOMM.WAIT_ENTER :        4DD C |  MARS_SCOMM.W_PASS2 :           51F C |
 MASTERTRKLIST :             883E0C C |  MASTER_IRQ :               6000248 C |
 MASTER_LOOP :              6000F36 C |  MASTER_LOOP.COPY_PAL :     6000F72 C |
 MASTER_LOOP.LIST :         600100C C |  MASTER_LOOP.NO_INIT :      6000FFC C |
 MASTER_LOOP.WAIT :         6000F64 C |  MASTER_LOOP.WAIT_FB :      6000F40 C |
 MASTER_LOOP.WAIT_FRMSWP :  6000F4E C |  MAX_FACES :                    100 - |
 MAX_MDDMATSK :                  10 - |  MAX_MDERAM :                   800 - |
 MAX_MODELS :                    10 - |  MAX_PWMCHNL :                    7 - |
 MAX_SVDP_PZ :                  120 - |  MAX_TRKCHN :                    11 - |
*MAX_TSTENTRY :                   4 - | *MAX_TSTTRKS :                    3 - |
 MAX_ZDIST :       FFFFFFFFFFFFE000 - | *MBGSC_DATA :                     8 C |
*MBGSC_X_DX :                     4 C | *MBGSC_X_POS :                    0 C |
*MBGSC_Y_DY :                     6 C | *MBGSC_Y_POS :                    2 C |
 MBG_DATA :                      20 C |  MBG_FBDATA :                    28 C |
 MBG_FBPOS :                     24 C |  MBG_FLAGS :                      1 C |
 MBG_HEIGHT :                    12 C | *MBG_INDXINC :                   30 C |
 MBG_INTRL_BLK :                 16 C |  MBG_INTRL_H :                   1A C |
 MBG_INTRL_SIZE :                1C C |  MBG_INTRL_W :                   18 C |
*MBG_REDRAW :                     0 C | *MBG_RFILL :                     2C C |
 MBG_WIDTH :                     10 C |  MBG_XINC_L :                     8 C |
 MBG_XINC_R :                     A C |  MBG_XPOS :                      34 C |
 MBG_XPOS_OLD :                   4 C |  MBG_XSET :                       2 C |
 MBG_YFB :                       14 C |  MBG_YINC_D :                     E C |
 MBG_YINC_U :                     C C |  MBG_YPOS :                      38 C |
 MBG_YPOS_OLD :                   6 C |  MBG_YSET :                       3 C |
*MCD :                            0 - |  MCHNSND_BANK :                   C C |
 MCHNSND_CCHREAD :                8 C |  MCHNSND_ENBL :                   0 C |
 MCHNSND_END :                   14 C |  MCHNSND_FLAGS :                 20 C |
 MCHNSND_LOOP :                  18 C |  MCHNSND_PITCH :                 1C C |
 MCHNSND_READ :                   4 C |  MCHNSND_START :                 10 C |
 MCHNSND_VOL :                   24 C |  MDLDATA_PAL_TEST :          913530 C |
 MDLRD_ROTATE :    FFFFFFFFC00006F6 C |  MDLRD_SETPOINT :  FFFFFFFFC00005C8 C |
 MDLRD_SETPOINT.INSIDE :                                   FFFFFFFFC0000690 C |
 MDLRD_SETPOINT.SAVE_Z :                                   FFFFFFFFC00006C6 C |
 MDLRD_SETPOINT.SAVE_Z2 :                                  FFFFFFFFC00006C0 C |
 MDLRD_SETPOINT.X_LW :                                     FFFFFFFFC00006CC C |
 MDLRD_SETPOINT.X_RW :                                     FFFFFFFFC00006D2 C |
 MDLRD_SETPOINT.Y_LW :                                     FFFFFFFFC00006D8 C |
 MDLRD_SETPOINT.Y_RW :                                     FFFFFFFFC00006DE C |
 MDLRD_SETPOINT.ZMULTI :                                   FFFFFFFFC00006A8 C |
 MDL_DATA :                       0 C |  MDL_OPTION :                     4 C |
 MDL_X_POS :                      8 C |  MDL_X_ROT :                     14 C |
 MDL_Y_POS :                      C C |  MDL_Y_ROT :                     18 C |
 MDL_Z_POS :                     10 C |  MDL_Z_ROT :                     1C C |
*MDRAMCODE :                    940 C | *MDRAMCODE_END :               4114 C |
 MDRAM_START :             FFFF9000 - |  MDSYS_SINEDATA :            883716 C |
 MD_BANK_SRAM :              A130F1 - |  MD_ERRADDR :                   89A C |
 MD_ERRBUS :                    89A C |  MD_ERRCHK :                    89A C |
 MD_ERRILL :                    89A C |  MD_ERROREX :                   89A C |
 MD_ERRORTRAP :                 89A C |  MD_ERRPRIVL :                  89A C |
 MD_ERRTRAPV :                  89A C |  MD_ERRZDIV :                   89A C |
 MD_HOTSTART :                  8F6 C |  MD_HOTSTART.LOOP_RAM :         922 C |
 MD_HOTSTART.WAITFRAME :        908 C |  MD_INIT :                      8B2 C |
 MD_INIT.WAIT_DMA :             8B6 C |  MD_INIT.WM :                   8CE C |
 MD_INIT.WS :                   8D8 C |  MD_LINE1010 :                  89A C |
 MD_LINE1111 :                  89A C |  MD_TRACE :                     89A C |
 MODE :                          18 - |  MODE_INIT :                 88391C C |
 MODE_INIT.CLR :             88392A C |  MOMCPU :                     68000 - |
*MOMCPUNAME :                 68000 - |  MONOWIDTH :                     38 - |
 MOUSE_X :                        6 C |  MOUSE_Y :                        8 C |
 MSTR_GFX0 :                60010BC C |  MSTR_GFX0_HBLK :           60010AE C |
 MSTR_GFX0_INIT :           60010B6 C |  MSTR_GFX0_VBLK :           60010B2 C |
 MSTR_GFX1 :                60010CE C |  MSTR_GFX1_HBLK :           60010C0 C |
 MSTR_GFX1_INIT :           60010C8 C |  MSTR_GFX1_VBLK :           60010C4 C |
 MSTR_GFX2 :                600111E C |  MSTR_GFX2.FROM_DRWALL :    6001156 C |
 MSTR_GFX2.NO_REDRAW :      600113A C |  MSTR_GFX2_HBLK :           60010D2 C |
 MSTR_GFX2_INIT :           60010EC C |  MSTR_GFX2_VBLK :           60010D6 C |
 MSTR_GFX2_VBLK.MID_DRAW :  60010E8 C |  MSTR_GFX3 :                60011C6 C |
 MSTR_GFX3.NO_BTMP :        60011DA C |  MSTR_GFX3.NO_REDRAW :      60011EC C |
 MSTR_GFX3.NXT_LNE :        60011E2 C |  MSTR_GFX3.XY_SET :         6001226 C |
 MSTR_GFX3.X_HIGH :         6001250 C |  MSTR_GFX3.X_LOOP :         6001244 C |
 MSTR_GFX3.Y_ADD :          600121E C |  MSTR_GFX3.Y_HIGH :         600122E C |
 MSTR_GFX3.Y_LOOP :         600121E C |  MSTR_GFX3.Y_LOOP2 :        6001216 C |
 MSTR_GFX3_HBLK :           60011A0 C |  MSTR_GFX3_INIT :           60011BE C |
 MSTR_GFX3_VBLK :           60011A4 C |  MSTR_GFX3_VBLK.COPY_ME :   60011AC C |
 MSTR_GFX4 :                60012A8 C |  MSTR_GFX4.CONT_PLGN :      60012E2 C |
 MSTR_GFX4.FB_LOOP :        600131C C |  MSTR_GFX4.NO_BTMP :        60012BC C |
 MSTR_GFX4.NO_REDRAW :      60012CE C |  MSTR_GFX4.NO_SWAP :        6001346 C |
 MSTR_GFX4.NXT_LNE :        60012C4 C |  MSTR_GFX4.PAGE_2 :         60012DC C |
 MSTR_GFX4.WAIT_FB2 :       6001328 C |  MSTR_GFX4.WAIT_WD :        600133A C |
 MSTR_GFX4_HBLK :           6001272 C |  MSTR_GFX4_INIT :           60012A0 C |
 MSTR_GFX4_VBLK :           6001276 C |  MSTR_GFX4_VBLK.COPY_SAFE : 6001286 C |
 MSTR_GFX4_VBLK.WAIT_SLV :  600129C C | *M_ASCII :                  6004B58 C |
 M_IRQ_BAD :                600031C C |  M_IRQ_CMD :                6000340 C |
*M_IRQ_CMD.BAD_SIZE :       60003A6 C |  M_IRQ_CMD.COPY_SAFE :      600039C C |
 M_IRQ_CMD.NOT_YET :        600036C C | *M_IRQ_CMD.TIME_OUT :       6000392 C |
 M_IRQ_CMD.WAIT_DMA :       600038C C |  M_IRQ_CUSTOM :    FFFFFFFFC0000000 C |
 M_IRQ_H :                  60003B0 C |  M_IRQ_PWM :                6000320 C |
 M_IRQ_V :                  60003D0 C |  M_IRQ_VRES :               60003F0 C |
 M_IRQ_VRES.NOT_YET :       6000410 C | *NESTMAX :                      100 - |
 ON_HOLD :                        2 C |  ON_PRESS :                       4 C |
*PACKING :                        0 - | *PADDING :                        0 - |
*PADDINGSOFAR :                   0 - |  PAD_ID :                         0 C |
 PAD_VER :                        1 C |  PALDATA_MARS_TEST :         913258 C |
 PALDATA_MARS_TEST2 :        913330 C | *PALMODE :                       33 C |
*PAL_BG :                    883F34 C |  PAL_TESTBOARD :             883EF4 C |
*PEN :                           20 - |  PLGN_TEXURE :                   80 - |
 PLGN_TRI :                      40 - |  PLYPZ_MTRL :                     4 C |
 PLYPZ_SRC_XL :                  1C C |  PLYPZ_SRC_XL_DX :               20 C |
 PLYPZ_SRC_XR :                  2C C |  PLYPZ_SRC_XR_DX :               30 C |
 PLYPZ_SRC_YL :                  24 C |  PLYPZ_SRC_YL_DX :               28 C |
 PLYPZ_SRC_YR :                  34 C |  PLYPZ_SRC_YR_DX :               38 C |
 PLYPZ_TYPE :                     0 C |  PLYPZ_XL :                       C C |
 PLYPZ_XL_DX :                   10 C |  PLYPZ_XR :                      14 C |
 PLYPZ_XR_DX :                   18 C |  PLYPZ_YPOS :                     8 C |
 POLYGN_MTRL :                    4 C |  POLYGN_POINTS :                  8 C |
 POLYGN_SRCPNTS :                28 C |  POLYGN_TYPE :                    0 C |
*PSGALV :                      1635 C | *PSGATK :                      1619 C |
 PSGCOM :                      1611 C | *PSGDEC :                      161D C |
*PSGDTH :                      1631 C | *PSGDTL :                      162D C |
*PSGENV :                      1629 C |  PSGFREQ_LIST :                142F C |
 PSGHATMODE :                  1F47 C | *PSGLEV :                      1615 C |
*PSGRRT :                      1625 C | *PSGSLV :                      1621 C |
*PSGTIM :                      163D C | *PSGVOL :                      1641 C |
*PSG_CTRL :                  C00011 - |  PUT_PIECE :       FFFFFFFFC0000290 C |
 PUT_PIECE.BAD_PIECE :                                     FFFFFFFFC0000334 C |
 PUT_PIECE.DONTRESET_PZ :                                  FFFFFFFFC000032C C |
 PUT_PIECE.LEFTH : FFFFFFFFC00002A0 C |
 PUT_PIECE.TOP_NEG :                                       FFFFFFFFC0000316 C |
 PVOL :                          30 - | *PWCOM :                          0 - |
 PWINSH :                        20 - |  PWINSL :                        30 - |
 PWINSM :                        28 - |  PWMCOM :                      1A5B C |
*PWMCTL :                        31 - |  PWMINS_TEST_ST :           20B7B18 C |
 PWMINTCLR :                     1C - |  PWMIRQ_ON :                      1 - |
 PWOUTF :                        18 - |  PWPHL :                         10 - |
 PWPTH_V :                        8 - |  RAMDMA_BLAST :                  B6 C |
 RAMDMA_BLAST.END :             10E C |  RAMDMA_BLAST.EXIT :            126 C |
 RAMDMA_BLAST.NEXT :             E8 C |  RAMDMA_LOAD :                    0 C |
 RAMDMA_LOAD.FROM_RAM :          A2 C | *RAM_CURRGFX :     FFFFFFFFFFFF9002 C |
 RAM_CURRPAGE :    FFFFFFFFFFFF9000 C |  RAM_CURRSELC :    FFFFFFFFFFFF9004 C |
 RAM_DMACODE :     FFFFFFFFFFFFA862 C |
 RAM_FADEMARSDELAY :                                       FFFFFFFFFFFFA602 C |
 RAM_FADEMARSINCR :                                        FFFFFFFFFFFFA600 C |
 RAM_FADEMARSREQ : FFFFFFFFFFFFA5FE C |  RAM_FADEMARSTMR : FFFFFFFFFFFFA604 C |
 RAM_FADEMDDELAY : FFFFFFFFFFFFA5FA C |  RAM_FADEMDINCR :  FFFFFFFFFFFFA5F8 C |
 RAM_FADEMDREQ :   FFFFFFFFFFFFA5F6 C |  RAM_FADEMDTMR :   FFFFFFFFFFFFA5FC C |
 RAM_FRAMECOUNT :  FFFFFFFFFFFFA606 C |  RAM_HORSCROLL :   FFFFFFFFFFFF9820 C |
 RAM_INITFLUG :    FFFFFFFFFFFFA9EA C |  RAM_INPUTDATA :   FFFFFFFFFFFFA622 C |
 RAM_MARS_BGBUFFSCALE_M :  26016C90 C |  RAM_MARS_BGBUFFSCALE_S :  26016CAC C |
 RAM_MARS_BGBUFFSCRL :     26016C18 C |  RAM_MARS_DREQDMA :        26009D30 C |
 RAM_MARS_DREQREAD :       2600A160 C |  RAM_MARS_GLOBAL :         2600A590 C |
 RAM_MARS_OBJCAMERA :      26011868 C |  RAM_MARS_OBJECTS :        26011668 C |
 RAM_MARS_PLGNLIST_0 :     26015C10 C |  RAM_MARS_PLGNLIST_1 :     26016410 C |
 RAM_MARS_PLGNNUM_0 :      26016C10 C |  RAM_MARS_PLGNNUM_1 :      26016C14 C |
 RAM_MARS_POLYGONS_0 :     2600A668 C |  RAM_MARS_POLYGONS_1 :     2600DE68 C |
 RAM_MARS_VDPDRWLIST :     26011890 C |  RAM_MARS_VDPDRWLIST_E :   26015C10 C |
 RAM_MDDREQ :      FFFFFFFFFFFFAA00 C | *RAM_MDGLBL_NULL : FFFFFFFFFFFFA9FC C |
 RAM_MDGLOBAL :    FFFFFFFFFFFFA9FC C |  RAM_MDMARSHINT :  FFFFFFFFFFFFA9F4 C |
 RAM_MDMARSPALFD : FFFFFFFFFFFFA110 C |  RAM_MDMARSVINT :  FFFFFFFFFFFFA9EE C |
 RAM_MDSOUND :     FFFFFFFFFFFF9800 C |  RAM_MDSYSTEM :    FFFFFFFFFFFFA622 C |
 RAM_MDVIDEO :     FFFFFFFFFFFF9820 C |  RAM_MODEBUFF :    FFFFFFFFFFFF9000 C |
 RAM_PALETTE :     FFFFFFFFFFFFA090 C |  RAM_PALETTEFD :   FFFFFFFFFFFFA310 C |
*RAM_SAVEDATA :    FFFFFFFFFFFFA662 C |  RAM_SNDSAVEREG :  FFFFFFFFFFFF9800 C |
 RAM_SPRITES :     FFFFFFFFFFFF9C30 C | *RAM_SYSFLAGS :    FFFFFFFFFFFFA9FA C |
 RAM_SYSRANDSEED : FFFFFFFFFFFFA9E6 C |  RAM_SYSRANDVAL :  FFFFFFFFFFFFA9E2 C |
 RAM_VDPDMAINDX :  FFFFFFFFFFFFA5F0 C |  RAM_VDPDMALIST :  FFFFFFFFFFFFA390 C |
 RAM_VDPDMAMOD :   FFFFFFFFFFFFA5F2 C |  RAM_VDPREGS :     FFFFFFFFFFFFA60A C |
 RAM_VERSCROLL :   FFFFFFFFFFFF9BE0 C |  RAM_VIDPRNTLIST : FFFFFFFFFFFFA470 C |
 RAM_VIDPRNTVRAM : FFFFFFFFFFFFA5F4 C |  RCHWIDTH :                      36 - |
 READROMB :                     EC6 C |  READROMB.IMBACK :              ED6 C |
 READROMB.W2 :                  EE3 C |  READROMB.WAIT :                EDF C |
*RELAXED :                        0 - |  ROM_END :                    DEA80 C |
 RRT :                           14 - |  SBEATACC :                      36 C |
 SBEATPTCK :                     34 C |  SCREEN_HEIGHT :                 E0 - |
 SCREEN_WIDTH :                 140 - |  SETUPCHIP :                    53B C |
 SETUPCHIP.ALRDFND :            E02 C | *SETUPCHIP.BAD_INS :            DA7 C |
*SETUPCHIP.BUSY_S :             DBF C |  SETUPCHIP.CHECK_CHNL :         D79 C |
 SETUPCHIP.CHECK_INS :          D66 C |  SETUPCHIP.CHIP_OUT :           CB2 C |
 SETUPCHIP.CHIP_SWAP :          C76 C |  SETUPCHIP.CHKFREE :            E09 C |
 SETUPCHIP.CHK_TBL :            DC2 C |  SETUPCHIP.CHK_TBLN :           DB6 C |
 SETUPCHIP.CHNL_UNLINK :        AB6 C |  SETUPCHIP.CHP_UNLK :           D3F C |
 SETUPCHIP.CLR :                560 C |  SETUPCHIP.CONFM_RD :           705 C |
 SETUPCHIP.DAC_OUT :            CD7 C | *SETUPCHIP.DCUT :               BA1 C |
 SETUPCHIP.DIFFR :              DDB C | *SETUPCHIP.DOFF :               BA6 C |
 SETUPCHIP.DO_CHNL :            580 C |  SETUPCHIP.EFFDAC_E :           8D8 C |
 SETUPCHIP.EFFDAC_F :           907 C |  SETUPCHIP.EFFFM_D :            86E C |
 SETUPCHIP.EFFFM_E :            8CA C |  SETUPCHIP.EFFFM_F :            900 C |
 SETUPCHIP.EFFFM_X :            9DD C |  SETUPCHIP.EFFPSG_D :           840 C |
 SETUPCHIP.EFFPSG_E :           8C0 C |  SETUPCHIP.EFFPSG_F :           8F2 C |
 SETUPCHIP.EFFPWM_E :           8E5 C |  SETUPCHIP.EFFPWM_F :           90D C |
 SETUPCHIP.EFFPWM_X :           9C4 C |  SETUPCHIP.EFF_DAC :            817 C |
 SETUPCHIP.EFF_FM :             800 C |  SETUPCHIP.EFF_PSG :            7ED C |
 SETUPCHIP.EFF_PWM :            829 C |  SETUPCHIP.E_FNEGD2 :           8EF C |
 SETUPCHIP.E_GO :               9C3 C |  SETUPCHIP.E_NEG :              8D4 C |
 SETUPCHIP.E_NEGD :             8E2 C |  SETUPCHIP.E_NEGP :             8FD C |
 SETUPCHIP.E_NOEF :             9BF C |  SETUPCHIP.E_NOF :              9B5 C |
 SETUPCHIP.FM3_OUT :            CE5 C |  SETUPCHIP.FMPAN_LIST :         A17 C |
 SETUPCHIP.FMPICKINS :          718 C |  SETUPCHIP.FMSAME_INS :         716 C |
 SETUPCHIP.FM_CHNLKON :         C49 C |  SETUPCHIP.FM_KEYCUT :          C6D C |
 SETUPCHIP.FM_KEYOFF :          C72 C |  SETUPCHIP.FM_KPV :             C6C C |
 SETUPCHIP.FM_OUT :             D21 C |  SETUPCHIP.FNDLINK :            DFE C |
 SETUPCHIP.FNDSLOT :            E1C C |  SETUPCHIP.FND_OCT :            C26 C |
 SETUPCHIP.FREQINC_DAC :        945 C |  SETUPCHIP.FREQINC_FM :         955 C |
 SETUPCHIP.FREQINC_PSG :        97B C |  SETUPCHIP.FREQINC_PWM :        911 C |
 SETUPCHIP.FROM_NL :            C8F C |  SETUPCHIP.GET_OCT :            C1B C |
 SETUPCHIP.GO_DOWN :            8A7 C |  SETUPCHIP.GO_UP :              8B0 C |
 SETUPCHIP.GRAB_DVAL :          89D C |  SETUPCHIP.GRAB_PRTM :          9A5 C |
 SETUPCHIP.INS_DAC :            65E C |  SETUPCHIP.INS_FM :             6A7 C |
 SETUPCHIP.INS_FM3 :            698 C |  SETUPCHIP.INS_PSG :            62F C |
 SETUPCHIP.INS_PSGN :           629 C |  SETUPCHIP.INS_PWM :            5EE C |
 SETUPCHIP.LOWP :               865 C |  SETUPCHIP.LOWPF :              894 C |
 SETUPCHIP.MK_CHIP :            54C C | *SETUPCHIP.NEW :                DB6 C |
 SETUPCHIP.NEXT :               DC5 C |  SETUPCHIP.NODEFV :             B63 C |
 SETUPCHIP.NOTEPSG_C :          B29 C |  SETUPCHIP.NOTEPSG_FN :         B36 C |
 SETUPCHIP.NOTE_DAC :           B6E C |  SETUPCHIP.NOTE_FM :            BD5 C |
 SETUPCHIP.NOTE_FM3 :           BB1 C |  SETUPCHIP.NOTE_PSG :           B04 C |
 SETUPCHIP.NOTE_PSGN :          AD7 C |  SETUPCHIP.NOTE_PWM :           A46 C |
 SETUPCHIP.NOT_PRDAC :          6BB C |  SETUPCHIP.NO_CHNL :            5C1 C |
 SETUPCHIP.NP2_N :              B01 C |  SETUPCHIP.NXT_CHNL :           56E C |
 SETUPCHIP.PCUT :               AB4 C |  SETUPCHIP.POFF :               AB0 C |
 SETUPCHIP.PSGN_OUT :           CF3 C |  SETUPCHIP.PSG_OUT :            D01 C |
 SETUPCHIP.PVMUCH :             769 C |  SETUPCHIP.PWMN_KPV :           A91 C |
 SETUPCHIP.PWM_KEYCUT :         AAC C |  SETUPCHIP.PWM_KEYOFF :         AA8 C |
 SETUPCHIP.PWM_OUT :            CB4 C |  SETUPCHIP.P_OUT :              D1F C |
 SETUPCHIP.RAN_OUT :            5B7 C |  SETUPCHIP.RD_FMINS :           6D2 C |
 SETUPCHIP.RD_NT3 :             C10 C |  SETUPCHIP.REQ_EFF :            7BF C |
 SETUPCHIP.REQ_INS :            5C7 C |  SETUPCHIP.REQ_NOTE :           A1B C |
 SETUPCHIP.REQ_VOL :            724 C |  SETUPCHIP.TBLLIST :            DAA C |
 SETUPCHIP.VMUCH :              793 C |  SETUPCHIP.VOL_FM :             79A C |
 SETUPCHIP.VOL_PSG :            777 C |  SETUPCHIP.VOL_PWM :            744 C |
 SET_LEFT :        FFFFFFFFC0000192 C |  SET_LEFT.LFT_OK : FFFFFFFFC00001B4 C |
 SET_LEFT.LFT_SKIP :                                       FFFFFFFFC000020C C |
 SET_RIGHT :       FFFFFFFFC0000210 C |
 SET_RIGHT.RGT_OK :                                        FFFFFFFFC0000232 C |
 SET_RIGHT.RGT_SKIP :                                      FFFFFFFFC000028A C |
 SH2_MASTER :               6000000 C |  SH2_M_ENTRY :              6000E70 C |
 SH2_M_ENTRY.COPY :         6000EBE C | *SH2_M_ENTRY.WAIT_MD :      6000ED4 C |
 SH2_M_ERROR :              600030C C |  SH2_M_HOTSTART :           6000ED4 C |
 SH2_M_HOTSTART.CLRRAM :    6000EF6 C |  SH2_RAM :                  6009D30 C |
 SH2_SLAVE :                6000124 C |  SH2_S_ENTRY :              60013A0 C |
 SH2_S_ENTRY.COPY :         60013DE C | *SH2_S_ENTRY.WAIT_MD :      60013F2 C |
 SH2_S_ERROR :              6000314 C |  SH2_S_HOTSTART :           60013F2 C |
 SH2_S_HOTSTART.CLR_ENBL :  6001416 C |  SHIFT :                          2 - |
 SHOWROM :                      EA5 C |  SIN_TABLE :                6002358 C |
 SIZEOF_CAMERA :                 28 C |  SIZEOF_DREQ :                  430 C |
 SIZEOF_INPUT :                  10 C |  SIZEOF_MARSBG :                 3C C |
 SIZEOF_MARSGBL :                36 C | *SIZEOF_MARSRAM :          26017048 C |
*SIZEOF_MARSRAM.HERE :     26017048 C | *SIZEOF_MARSSCBG :                C C |
 SIZEOF_MARSSND :          26017048 C |  SIZEOF_MARSSYS :          2600A668 C |
 SIZEOF_MARSVID :          26016CC8 C |  SIZEOF_MDGLBL :   FFFFFFFFFFFFAA00 C |
 SIZEOF_MDLOBJ :                 20 C |  SIZEOF_MDRAM :    FFFFFFFFFFFFAE30 C |
 SIZEOF_MDSND :    FFFFFFFFFFFF9820 C |  SIZEOF_MDSYS :    FFFFFFFFFFFFA9FC C |
 SIZEOF_MDVID :    FFFFFFFFFFFFA622 C |  SIZEOF_PLYPZ :                  3C C |
 SIZEOF_POLYGN :                 38 C |  SIZEOF_SNDCHN :                 28 C |
 SLAVE_IRQ :                60002AC C |  SLAVE_LOOP :               6001428 C |
 SLAVE_LOOP.GO_MDL :        6001466 C |  SLAVE_LOOP.LIST :          6001440 C |
 SLAVE_LOOP.SLV_EXIT :      6001476 C |  SLAVE_LOOP.SLV_TASK_1 :    6001450 C |
 SLAVE_LOOP.SLV_TASK_2 :    6001454 C |  SLV :                           10 - |
*SMPINS_PLUSPIANO_ST :      202C8B0 C |  SNDLOCKZ80 :                8809DA C |
 SNDLOCKZ80.WAIT :           8809E2 C |  SNDREQ_ENTER :              8809F8 C |
 SNDREQ_ENTER.WAIT :         880A1E C |  SNDREQ_EXIT :               880A2E C |
 SNDREQ_SADDR :              880A56 C |  SNDREQ_SBYTE :              880A5E C |
 SNDREQ_SCMD :               880A44 C | *SNDREQ_SLONG :              880A52 C |
 SNDREQ_SWORD :              880A5A C |  SNDUNLOCKZ80 :              8809EE C |
 SOUND_DMA_PAUSE :           880A6C C |  SOUND_DMA_PAUSE.RETRY :     880A70 C |
 SOUND_DMA_PAUSE.SAFE :      880A8A C |  SOUND_DMA_PAUSE.WAIT_IN :   880A9E C |
 SOUND_DMA_PAUSE.WAIT_OUT :  880AD0 C |  SOUND_DMA_RESUME :          880AE2 C |
 SOUND_DMA_RESUME.WAIT_IN :  880AFA C |  SOUND_DMA_RESUME.WAIT_OUT : 880B2C C |
*SOUND_GLBTEMPO :            880BC4 C |  SOUND_INIT :                880980 C |
 SOUND_INIT.CLEANUP :        8809A6 C |  SOUND_INIT.COPY :           8809BC C |
 SOUND_INIT.WAIT :           880990 C |  SOUND_TRKPLAY :             880B3E C |
*SOUND_TRKRESUME :           880B92 C | *SOUND_TRKSTOP :             880B7C C |
*SOUND_TRKTICKS :            880BA8 C |  STANDBY :                        3 - |
 STR_CURSOR :                883E3C C | *STR_PAGE1 :                 883EAA C |
*STR_PAGE1_L :               883EBE C |  STR_PAGE2 :                 883ECC C |
 STR_PAGE3 :                 883EE0 C |  STR_TITLE :                 883E42 C |
*SYSMARS_ID :                A130EC - |  SYSMARS_REG :               A15100 - |
 SYSTEM_INIT :               883488 C |  SYSTEM_INIT.CLRINPUT :      8834C6 C |
 SYSTEM_INIT.WAIT :          883496 C |  SYSTEM_INPUT :              88350A C |
 SYSTEM_INPUT.EXIT :         88353C C |  SYSTEM_INPUT.ID_03 :        883562 C |
 SYSTEM_INPUT.ID_0D :        88360C C |  SYSTEM_INPUT.INVALID :      883606 C |
 SYSTEM_INPUT.LIST :         883542 C |  SYSTEM_INPUT.OLDPAD :       883684 C |
 SYSTEM_INPUT.PICK_ID :      88368A C |  SYSTEM_INPUT.READ :         8836A0 C |
 SYSTEM_INPUT.STEP_1 :       8836AC C |  SYSTEM_INPUT.STEP_2 :       8836B8 C |
 SYSTEM_INPUT.THIS_ONE :     883522 C |  SYSTEM_INPUT.X_NEG :        8835D4 C |
 SYSTEM_INPUT.Y_NEG :        883600 C | *SYSTEM_RANDOM :             8836BA C |
 SYSTEM_SENDDREQ :           88394C C |  SYSTEM_SENDDREQ.L0 :        883994 C |
*SYSTEM_SENDDREQ.RETRY :     88395C C |  SYSTEM_SENDDREQ.WAIT_BIT :  88397A C |
 SYSTEM_SETINTS :            883816 C |  SYSTEM_SETINTS.NOHINT :     88383A C |
 SYSTEM_SETINTS.NOVINT :     883828 C | *SYSTEM_SINEWAVE :           8836F8 C |
 SYSTEM_SINEWAVE.DONT_NEG :  883714 C | *SYSTEM_SINEWAVE_COS :       8836D8 C |
 SYSTEM_SINEWAVE_COS.DONT_NEG :                                      8836F2 C |
*SYSTEM_SRAMINIT :           88383C C |  SYSTEM_SRAMINIT.INITSAVE :  883850 C |
 SYSTEM_VBLANK :             883864 C |  SYSTEM_VBLANK.WAIT_VBLNK :  883864 C |
 SYS_CTRL_1 :                A10009 - |  SYS_CTRL_2 :                A1000B - |
 SYS_CTRL_3 :                A1000D - |  SYS_DATA_1 :                A10003 - |
*SYS_DATA_2 :                A10005 - | *SYS_DATA_3 :                A10007 - |
*SYS_EXRAM :                 200000 - | *SYS_IO :                    A10001 - |
*SYS_TMSS :                  A14000 - |  S_IRQ_BAD :                6000458 C |
 S_IRQ_CMD :                600045C C | *S_IRQ_CMD.COPY_1 :         60004DC C |
 S_IRQ_CMD.EXIT_C :         60004EC C |  S_IRQ_CMD.GET_OUT :        60004A6 C |
 S_IRQ_CMD.MODE_1 :         60004CC C |  S_IRQ_CMD.MODE_2 :         60004AA C |
 S_IRQ_CMD.MODE_3 :         60004BE C |  S_IRQ_CMD.NEXT_CHNL :      60004F2 C |
 S_IRQ_CMD.NO_KEYOFF :      6000516 C |  S_IRQ_CMD.NO_PITCHBND :    600053A C |
 S_IRQ_CMD.NO_REQ :         60005E8 C |  S_IRQ_CMD.NO_TRNSFREX :    60005F0 C |
 S_IRQ_CMD.NO_VOLUMEBND :   6000552 C |  S_IRQ_CMD.NO_ZTRNSFR :     6000610 C |
 S_IRQ_CMD.PWM_KEYCUT :     600050A C |  S_IRQ_CMD.WAIT_1 :         60004D2 C |
 S_IRQ_CUSTOM :             60014D0 C |  S_IRQ_H :                  600064C C |
 S_IRQ_PWM :       FFFFFFFFC0000150 C |
 S_IRQ_PWM.FROM_RV :                                       FFFFFFFFC0000200 C |
 S_IRQ_PWM.LMUCH : FFFFFFFFC0000264 C |  S_IRQ_PWM.LOOP :  FFFFFFFFC000017E C |
 S_IRQ_PWM.LOOP_ME :                                       FFFFFFFFC00001AE C |
 S_IRQ_PWM.MONO :  FFFFFFFFC000020A C |
 S_IRQ_PWM.MONO_A :                                        FFFFFFFFC00001F8 C |
 S_IRQ_PWM.MONO_C :                                        FFFFFFFFC00001D8 C |
 S_IRQ_PWM.MONO_L :                                        FFFFFFFFC00001BA C |
 S_IRQ_PWM.NOT_ROM :                                       FFFFFFFFC00001EA C |
 S_IRQ_PWM.NO_L :  FFFFFFFFC0000220 C |  S_IRQ_PWM.NO_R :  FFFFFFFFC0000226 C |
 S_IRQ_PWM.ON :    FFFFFFFFC000018C C |  S_IRQ_PWM.READ :  FFFFFFFFC00001BC C |
 S_IRQ_PWM.RMUCH : FFFFFFFFC000026A C |
 S_IRQ_PWM.SILENT :                                        FFFFFFFFC0000184 C |
 S_IRQ_PWM.SKIP :  FFFFFFFFC000024A C |  S_IRQ_V :                  600066C C |
 S_IRQ_VRES :               600068C C |  S_IRQ_VRES.NOT_YET :       60006AC C |
 S_IRQ_VRES.WAIT_M :        60006AE C |  TAG_WIDTH :       FFFFFFFFC000050C C |
 TAG_YHGHT :       FFFFFFFFC0000510 C |  TBLFM :                       19EF C |
 TBLFM3 :                      1A0F C |  TBLFM6 :                      1A17 C |
 TBLPSG :                      19CD C |  TBLPSGN :                     19E7 C |
 TBLPWM :                      1A21 C |  TESTMARS_BG :              202EB18 C |
 TESTMARS_BG2 :             2096318 C |  TEXTR_PECSI :              20A7B18 C |
 TH :                      20000000 - |  THISCODE_TOP :              8839A4 C |
 THISCODE_TOP.FADE_IN :      883D64 C |  THISCODE_TOP.FADE_OUT :     883D94 C |
 THISCODE_TOP.IND :          883DB8 C |  THISCODE_TOP.INW :          883D88 C |
 THISCODE_TOP.LIST :         883A70 C |  THISCODE_TOP.LOOP :         883A4C C |
 THISCODE_TOP.MOVE_CURSOR_UD :                                       883DD6 C |
 THISCODE_TOP.NEXT :         883C26 C |  THISCODE_TOP.NOD_M :        883BE6 C |
 THISCODE_TOP.NOL_M :        883BDE C |  THISCODE_TOP.NOR_M :        883BD6 C |
 THISCODE_TOP.NOU_M :        883BEE C |  THISCODE_TOP.NOX_X :        883CF6 C |
 THISCODE_TOP.NOZ_DOWN :     883C9E C |  THISCODE_TOP.NOZ_L :        883CC2 C |
 THISCODE_TOP.NOZ_R :        883CB6 C |  THISCODE_TOP.NOZ_UP :       883CAA C |
 THISCODE_TOP.ON_LOOP :      883A6A C |  THISCODE_TOP.P0_DOWN :      883DF0 C |
 THISCODE_TOP.P0_UP :        883E06 C |  THISCODE_TOP.PAGE0 :        883AD4 C |
 THISCODE_TOP.PAGE0_CURSOR : 883AEC C |  THISCODE_TOP.PAGE0_INIT :   883AAA C |
 THISCODE_TOP.PAGE0_JUMP :   883AF6 C |  THISCODE_TOP.PAGE0_RET :    883AA8 C |
 THISCODE_TOP.PAGE1 :        883BBA C |  THISCODE_TOP.PAGE1_INIT :   883B08 C |
 THISCODE_TOP.PAGE1_RET :    883C0A C |  THISCODE_TOP.PAGE2 :        883C6E C |
 THISCODE_TOP.PAGE2_INIT :   883C34 C |  THISCODE_TOP.PAGE2_RET :    883D0A C |
 THISCODE_TOP.PAGE3 :        883D44 C |  THISCODE_TOP.PAGE3_INIT :   883D0C C |
 THISCODE_TOP.PAGE3_RET :    883D62 C |  THISCODE_TOP.PRINT_CURSOR : 883DC4 C |
 THISCODE_TOP.THIS_BG :      883C0C C |  TICKCNT :                     19C0 C |
 TICKFLAG :                    19BE C | *TIME :                     5:01:36 - |
 TIMERCTL :                      30 - | *TMR :                           2C - |
 TRACK_OUT :                    480 C |  TRACK_OUT.CLRFE :              48F C |
 TRACK_OUT.NOCHIP :             4A3 C |  TRANSFERROM :                  EF3 C |
 TRANSFERROM.DOUBLE :           F12 C |  TRANSFERROM.TRANSFER :         F37 C |
 TRANSFERROM.X68KLAST :         F56 C |  TRANSFERROM.X68KLOOP :         F45 C |
 TRANSFERROM.X68KLPCONT :       F4E C |  TRANSFERROM.X68KLPWT :         F68 C |
 TRANSFERROM.X68KLSTCONT :      F60 C |  TRANSFERROM.X68KLSTWT :        F7B C |
 TRANSFERROM.X68KLSTWTLP :      F7F C |  TRANSFERROM.X68KNOCARRY :      F31 C |
 TRANSFERROM.X68KPWTLP :        F6C C |  TRKBUFF_0 :                   1766 C |
 TRKBUFF_1 :                   180E C |  TRKDATA_0 :                   1D00 C |
 TRKDATA_1 :                   1E00 C |  TRKHDOUT :                    1F49 C |
 TRKPOINTERS :                  19B C |  TRK_CACHNOTES :                 1A - |
 TRK_CMDREQ :                    1C - |  TRK_CURRBLK :                   11 - |
 TRK_HALFWAY :                   10 - |  TRK_READ :                       C - |
 TRK_ROMBLK :                     0 - |  TRK_ROMINS :                     6 - |
 TRK_ROMPATT :                    3 - |  TRK_ROMPATTRD :                  9 - |
 TRK_ROWPAUSE :                  17 - |  TRK_ROWS :                       E - |
 TRK_SETBLK :                    12 - |  TRK_SIZEINS :                   16 - |
 TRK_STATUS :                    13 - |  TRK_TICKSET :                   15 - |
 TRK_TICKTMR :                   14 - | *TRUE :                           1 - |
*TVMODE :                         0 - |  UPDTRACK :                     1B9 C |
 UPDTRACK.CLRF :                422 C |  UPDTRACK.DECROW :              23B C |
 UPDTRACK.DECROW_E :            23E C |  UPDTRACK.EFFECT_FILL :         402 C |
 UPDTRACK.EFF_A :               32D C |  UPDTRACK.EFF_B :               337 C |
 UPDTRACK.EFF_C :               351 C |  UPDTRACK.EXIT :                230 C |
 UPDTRACK.FIRST_FILL :          40A C |  UPDTRACK.GO_EFFECT :           440 C |
 UPDTRACK.GRAB_ASAP :           300 C |  UPDTRACK.HAS_NOTE :            247 C |
 UPDTRACK.INC_CPATT :           2E3 C |  UPDTRACK.NEXT_NOTE :           21E C |
 UPDTRACK.NEXT_TRACK :          35C C |  UPDTRACK.NOCHIP :              432 C |
 UPDTRACK.NO_EFF :              2A4 C |  UPDTRACK.NO_INS :              286 C |
 UPDTRACK.NO_NOTE :             27B C |  UPDTRACK.NO_VOL :              292 C |
 UPDTRACK.OLD_TYPE :            26F C |  UPDTRACK.READ_TRACK :          1D1 C |
*UPDTRACK.RNOUT_CHNLS :         2DF C |  UPDTRACK.SET_TRACK :           363 C |
 UPDTRACK.SFXMD :               1EB C |  UPDTRACK.SZGOOD :              3D9 C |
 UPDTRACK.SZMUCH :              3D4 C |  UPDTRACK.TRACK_END :           46D C |
 UPDTRACK.TRKEND_EFFC :         46E C |  VARNULLVRAM :                  7FF - |
*VAR_MOVESPD :                 4000 - | *VBLK :                          80 - |
 VDPSTS :                         A - |  VDP_CTRL :                  C00004 - |
 VDP_DATA :                  C00000 - | *VERSION :                     142F - |
 VIDEOMARS_DRWPLGNPZ :                                     FFFFFFFFC000036E C |
 VIDEOMARS_DRWPLGNPZ.INVLD_Y :                             FFFFFFFFC000039A C |
 VIDEOMARS_DRWPLGNPZ.LEN_MAX :                             FFFFFFFFC0000394 C |
 VIDEO_CLEAR :               882B82 C |  VIDEO_CLEARSCREEN :         882B92 C |
 VIDEO_CLEARSCREEN.XNEXT :   882BDA C |  VIDEO_CLEARSCREEN.YNEXT :   882BEA C |
*VIDEO_COPY :                883068 C |  VIDEO_COPY.DMAW :           88307C C |
 VIDEO_COPY.DMAWE :          8830D6 C |  VIDEO_DMABLAST :            883160 C |
*VIDEO_DMAMKENTRY :          8830EE C |  VIDEO_FADEPAL :             882C24 C |
 VIDEO_FADEPAL_MARS :        8831A8 C |  VIDEO_FILL :                882FF4 C |
 VIDEO_FILL.DMAW :           883008 C |  VIDEO_FILL.DMAWE :          883050 C |
 VIDEO_INIT :                882B30 C |  VIDEO_INIT.CLRRAM :         882B3A C |
 VIDEO_INIT.COPYSAFE :       882B7A C | *VIDEO_INIT.EXIT :           882B64 C |
 VIDEO_INIT.LOOP :           882B56 C |  VIDEO_LOADART :             883166 C |
 VIDEO_LOADMAP :             882D9C C |  VIDEO_LOADMAP.CONT :        882DC2 C |
 VIDEO_LOADMAP.NODBLE :      882DE2 C |  VIDEO_LOADMAP.NONULL :      882DC0 C |
 VIDEO_LOADMAP.XLOOP :       882DB2 C |  VIDEO_LOADMAP.YLOOP :       882DA8 C |
 VIDEO_LOADPAL :             882C2E C | *VIDEO_LOADPAL_MARS :        8831B2 C |
 VIDEO_MARSPALFADE :         8831DA C |  VIDEO_MARSPALFADE.ACTIVE :  8831F6 C |
 VIDEO_MARSPALFADE.FADE_DONE :                                       8831FE C |
 VIDEO_MARSPALFADE.FADE_IN : 883200 C |
 VIDEO_MARSPALFADE.FADE_LIST :                                       8831F8 C |
 VIDEO_MARSPALFADE.FADE_OUT :                                        8832AA C |
 VIDEO_MARSPALFADE.NO_BLU :  88327A C |
 VIDEO_MARSPALFADE.NO_BLU_O :                                        883306 C |
 VIDEO_MARSPALFADE.NO_FNSH : 88329A C |
 VIDEO_MARSPALFADE.NO_FNSH_O :                                       88331C C |
 VIDEO_MARSPALFADE.NO_GRN :  88325A C |
 VIDEO_MARSPALFADE.NO_GRN_O :                                        8832EE C |
 VIDEO_MARSPALFADE.NO_MOVE : 8832A8 C |
 VIDEO_MARSPALFADE.NO_MOVE_O :                                       88332A C |
 VIDEO_MARSPALFADE.NO_RED :  88323A C |
 VIDEO_MARSPALFADE.NO_RED_O :                                        8832D6 C |
 VIDEO_MARSPALFADE.NXT_PAL : 883218 C |
 VIDEO_MARSPALFADE.NXT_PAL_O :                                       8832BE C |
*VIDEO_MARSREDRAW :          88318A C |  VIDEO_MARSSETGFX :          88316C C |
 VIDEO_MARSWAIT :            88319A C |  VIDEO_PALFADE :             882C52 C |
 VIDEO_PALFADE.ACTIVE :      882C6E C |  VIDEO_PALFADE.FADE_DONE :   882C76 C |
 VIDEO_PALFADE.FADE_IN :     882C78 C |  VIDEO_PALFADE.FADE_LIST :   882C70 C |
 VIDEO_PALFADE.FADE_OUT :    882D1C C |  VIDEO_PALFADE.NO_BLU :      882CF4 C |
 VIDEO_PALFADE.NO_BLU_O :    882D78 C |  VIDEO_PALFADE.NO_FNSH :     882D0C C |
 VIDEO_PALFADE.NO_FNSH_O :   882D8C C |  VIDEO_PALFADE.NO_GRN :      882CD4 C |
 VIDEO_PALFADE.NO_GRN_O :    882D60 C |  VIDEO_PALFADE.NO_MOVE :     882D1A C |
 VIDEO_PALFADE.NO_MOVE_O :   882D9A C |  VIDEO_PALFADE.NO_RED :      882CB4 C |
 VIDEO_PALFADE.NO_RED_O :    882D48 C |  VIDEO_PALFADE.NXT_PAL :     882C92 C |
 VIDEO_PALFADE.NXT_PAL_O :   882D30 C |  VIDEO_PRINT :               882E20 C |
 VIDEO_PRINT.DONIBL :        882F3A C |  VIDEO_PRINT.EXIT :          882EAA C |
 VIDEO_PRINT.ISBYTE :        882E74 C |  VIDEO_PRINT.ISLONG :        882E98 C |
 VIDEO_PRINT.ISWORD :        882E86 C |  VIDEO_PRINT.LNGLOOP :       882F2A C |
 VIDEO_PRINT.LOOP :          882E34 C |  VIDEO_PRINT.LOWR :          882F4A C |
 VIDEO_PRINT.NEWJUMP :       882E2E C |  VIDEO_PRINT.NEXT :          882E56 C |
 VIDEO_PRINT.NEXTV :         882EB4 C |  VIDEO_PRINT.NOTHING :       882F56 C |
 VIDEO_PRINT.PUTTEXT :       882E48 C |  VIDEO_PRINT.SPECIAL :       882E5A C |
 VIDEO_PRINT.VBYTE :         882EE6 C |  VIDEO_PRINT.VLONG :         882F32 C |
 VIDEO_PRINT.VWORD :         882F08 C |  VIDEO_PRINTINIT :           882DF4 C |
 VIDEO_RUNFADE :             882C12 C |  VIDEO_UPDATE :              882BF2 C |
*VIDEO_UPDATE.EXIT :         882C10 C |  VIDEO_UPDATE.LOOP :         882C04 C |
*VIDEO_WAITFADE :            882C18 C |  VIDMARS_PAL :               8831B6 C |
 VIDMARS_PAL.LOOP :          8831CE C |  VIDMD_PAL :                 882C32 C |
 VIDMD_PAL.LOOP :            882C4A C |  VID_PICKLAYER :             882F58 C |
 VID_PICKLAYER.GOLYR :       882FA8 C |  VID_PICKLAYER.NOWD :        882F92 C |
 VID_PICKLAYER.PLAWND :      882F80 C |  VID_PICKLAYER.THISSZ :      882FC8 C |
 VID_PICKLAYER.THISSZJ :     882FF0 C |  VINTCLR :                       16 - |
*VINTENBL :                      20 - |  VINT_DEFAULT :              883932 C |
*VIRQ_ON :                        8 - |  VRESINTCLR :                    14 - |
 WAVE_FLAGS :                  19CC C |  WAVE_LEN :                    19C4 C |
 WAVE_LOOP :                   19C7 C |  WAVE_PITCH :                  19CA C |
 WAVE_START :                  19C1 C |  WAVFREQ_LIST :                1521 C |
 WDG_TASK_0 :      FFFFFFFFC0000020 C |
 WDG_TASK_0.DONTRESET :                                    FFFFFFFFC00000E8 C |
 WDG_TASK_0.EXIT : FFFFFFFFC0000128 C |
 WDG_TASK_0.FIND_TOP :                                     FFFFFFFFC000009A C |
 WDG_TASK_0.IS_HIGH :                                      FFFFFFFFC00000AC C |
 WDG_TASK_0.IS_LOW :                                       FFFFFFFFC00000A2 C |
 WDG_TASK_0.LEFTH :                                        FFFFFFFFC00000F8 C |
 WDG_TASK_0.LEFTH2 :                                       FFFFFFFFC0000120 C |
 WDG_TASK_0.NEXT_PZ :                                      FFFFFFFFC00000CE C |
 WDG_TASK_0.SETPNTS :                                      FFFFFFFFC0000068 C |
 WDG_TASK_0.SRC_PNTS :                                     FFFFFFFFC000007C C |
*WDG_TASK_0.START_MATH :                                   FFFFFFFFC000008A C |
 WDG_TASK_0.TRINGL :                                       FFFFFFFFC000005A C |
 WDG_TASK_0.YTRINGL :                                      FFFFFFFFC0000092 C |
 WDM_EXIT :        FFFFFFFFC000015E C | *WHDFLG :                      1639 C |
 X68KSRCLSB :                    2E C |  X68KSRCMID :                    2F C |
*YM_CTRL_1 :                 A04000 - | *YM_CTRL_2 :                 A04002 - |
*YM_DATA_1 :                 A04001 - | *YM_DATA_2 :                 A04003 - |
 Z80_BUS :                   A11100 - |  Z80_CODE :                  880BE0 C |
 Z80_CODE_END :              882B2F C |  Z80_CPU :                   A00000 - |
 Z80_INIT :                      3E C |  Z80_RESET :                 A11200 - |
*ZBANK :                       6000 - | *ZOPCEX :                         8 - |
 ZOPCEXX :                       D9 - | *ZOPCNOP :                        0 - |
 ZOPCPUSHAF :                    F5 - |  ZOPCRET :                       C9 - |
 ZPSG_CTRL :                   7F11 - |  ZSET_TESTME :                    0 - |
 ZSET_WTUNE :      FFFFFFFFFFFFFFE8 - |  ZYM_CTRL_1 :                  4000 - |
 ZYM_CTRL_2 :                  4002 - |  ZYM_DATA_1 :                  4001 - |
 ZYM_DATA_2 :                  4003 - |  _CCR :                    FFFFFE92 - |
*_DMACHANNEL0 :            FFFFFF8C - | *_DMACHANNEL1 :            FFFFFF9C - |
*_DMACOUNT0 :              FFFFFF88 - | *_DMACOUNT1 :              FFFFFF98 - |
*_DMADEST0 :               FFFFFF84 - | *_DMADEST1 :               FFFFFF94 - |
*_DMAOPERATION :           FFFFFFB0 - | *_DMAREQACK0 :             FFFFFFB4 - |
*_DMAREQACK1 :             FFFFFFB8 - |  _DMASOURCE0 :             FFFFFF80 - |
*_DMASOURCE1 :             FFFFFF90 - | *_DMAVECTORE0 :            FFFFFFA4 - |
*_DMAVECTORE1 :            FFFFFFAC - | *_DMAVECTORN0 :            FFFFFFA0 - |
*_DMAVECTORN1 :            FFFFFFA8 - |  _FRAMEBUFFER :             4000000 - |
*_FRC_H :                         2 - | *_FRC_L :                         3 - |
 _FRT :                    FFFFFE10 - | *_HRH :                    FFFFFF10 - |
*_HRL :                    FFFFFF14 - | *_HRL32 :                  FFFFFF04 - |
 _JR :                     FFFFFF00 - | *_OCR_H :                         4 - |
*_OCR_L :                         5 - |  _OVERWRITE :               4020000 - |
 _PALETTE :                20004200 - | *_SERIAL :                 FFFFFE00 - |
 _SYSREG :                 20004000 - | *_TCR :                           6 - |
*_TCSR :                          1 - | *_TIER :                          0 - |
*_TOCR :                          7 - |  _VDPREG :                 20004100 - |

   1771 symbols
    252 unused symbols

 AS V1.42 Beta [Bld 118] - source file mars.asm - page 3 - 3/25/2022 5:01:36


  defined macros:
  ---------------

FINISH                                | GINSDAC                              
GINSFM                                | GINSFM3                              
GINSNULL                              | GINSPSG                              
GINSPSGN                              | GINSPWM                              
GPWM                                  | GSMPL                                
ORG                                   | STRUCT                               

     12 macros

 AS V1.42 Beta [Bld 118] - source file mars.asm - page 4 - 3/25/2022 5:01:36


  defined functions:
  ------------------

NOTZ80                                | LOCATE                               
MAPSIZE                               |

 AS V1.42 Beta [Bld 118] - source file mars.asm - page 5 - 3/25/2022 5:01:36


  codepages:
  ----------

STANDARD (0 changed characters)


0.25 seconds assembly time

  15185 lines source file
  16025 lines incl. macro expansions
      7 passes
      0 errors
      0 warnings
