 AS V1.42 Beta [Bld 118] - source file mars.asm - page 1 - 10/21/2022 1:21:17


       1/       0 :                     ; ===========================================================================
       2/       0 :                     ; +-----------------------------------------------------------------+
       3/       0 :                     ; PROJECT MARSIANO
       4/       0 :                     ; +-----------------------------------------------------------------+
       5/       0 :                     
       6/       0 :                     		include	"system/macros.asm"		; Assembler macros
(1)    1/       0 :                     ; ===========================================================================
(1)    2/       0 :                     ; ----------------------------------------------------------------
(1)    3/       0 :                     ; MACROS
(1)    4/       0 :                     ;
(1)    5/       0 :                     ; Include this file FIRST
(1)    6/       0 :                     ; ----------------------------------------------------------------
(1)    7/       0 :                     
(1)    8/       0 :                     ; --------------------------------------------------------
(1)    9/       0 :                     ; AS Main settings
(1)   10/       0 :                     ; --------------------------------------------------------
(1)   11/       0 :                     
(1)   12/       0 :                     		!org 0				; Start at 0
(1)   13/       0 :                     		cpu 		68000		; Current CPU is 68k, gets changed later.
(1)   14/       0 :                     		padding		off		; Dont pad dc.b
(1)   15/       0 :                     		listing 	purecode	; Want listing file, but only the final code in expanded macros
(1)   16/       0 :                     		supmode 	on 		; Supervisor mode
(1)   17/       0 :                     		dottedstructs	off		; If needed
(1)   18/       0 :                     		page 		0
(1)   19/       0 :                     
(1)   20/       0 :                     ; ====================================================================
(1)   21/       0 :                     ; ---------------------------------------------
(1)   22/       0 :                     ; Functions
(1)   23/       0 :                     ; ---------------------------------------------
(1)   24/       0 :                     
(1)   25/       0 :                     dword 		function l,r,(l<<16&$FFFF0000|r&$FFFF)			; LLLL RRRR
(1)   26/       0 :                     mapsize		function l,r,(((l-1)/8)<<16&$FFFF0000|((r-1)/8)&$FFFF)	; Full w/h sizes, for cell sizes use doubleword
(1)   27/       0 :                     locate		function a,b,c,(c&$FF)|(b<<8&$FF00)|(a<<16&$FF0000)	; VDP locate: Layer|X pos|Y pos for some video routines
(1)   28/       0 :                     
(1)   29/       0 :                     ; ====================================================================
(1)   30/       0 :                     ; ---------------------------------------------
(1)   31/       0 :                     ; Macros
(1)   32/       0 :                     ; ---------------------------------------------
(1)   33/       0 :                     
(1)   34/       0 : =$0                 paddingSoFar set 0
(1)   35/       0 :                     notZ80 function cpu,(cpu<>128)&&(cpu<>32988)
(1)   36/       0 :                     
(1)   37/       0 :                     ; -------------------------------------
(1)   38/       0 :                     ; Reserve memory section
(1)   39/       0 :                     ;
(1)   40/       0 :                     ; NOTE: This doesn't work for Z80
(1)   41/       0 :                     ; -------------------------------------
(1)   42/       0 :                     
(1)   43/       0 :                     struct		macro thisinput			; Reserve memory address
(1)   44/       0 :                     GLBL_LASTPC	set *
(1)   45/       0 :                     		dephase
(1)   46/       0 :                     GLBL_LASTORG	set *
(1)   47/       0 :                     		phase thisinput
(1)   48/       0 :                     		endm
(1)   49/       0 :                     		
(1)   50/       0 :                     ; -------------------------------------
(1)   51/       0 :                     ; Finish struct
(1)   52/       0 :                     ; -------------------------------------
(1)   53/       0 :                     
(1)   54/       0 :                     finish		macro				; Then finish the custom struct.
(1)   55/       0 :                     		!org GLBL_LASTORG
(1)   56/       0 :                     		phase GLBL_LASTPC
(1)   57/       0 :                     		endm
(1)   58/       0 :                     
(1)   59/       0 :                     ; -------------------------------------
(1)   60/       0 :                     ; Color debug
(1)   61/       0 :                     ; -------------------------------------
(1)   62/       0 :                     
(1)   63/       0 :                     colorme		macro this
(1)   64/       0 :                     		move.l	#$C0000000,(vdp_ctrl).l
(1)   65/       0 :                     		move.w	#this,(vdp_data).l
(1)   66/       0 :                     		endm
(1)   67/       0 :                     
(1)   68/       0 :                     ; -------------------------------------
(1)   69/       0 :                     ; Custom ORG-filler
(1)   70/       0 :                     ;
(1)   71/       0 :                     ; (from s2disasm)
(1)   72/       0 :                     ; -------------------------------------
(1)   73/       0 :                     
(1)   74/       0 :                     org macro address
(1)   75/       0 :                     	if notZ80(MOMCPU)
(1)   76/       0 :                     		if address < *
(1)   77/       0 :                     			error "too much stuff before org $\{address} ($\{(*-address)} bytes)"
(1)   78/       0 :                     		elseif address > *
(1)   79/       0 :                     paddingSoFar	set paddingSoFar + address - *
(1)   80/       0 :                     			!org address
(1)   81/       0 :                     		endif
(1)   82/       0 :                     	else
(1)   83/       0 :                     		if address < $
(1)   84/       0 :                     			error "too much stuff before org 0\{address}h (0\{($-address)}h bytes)"
(1)   85/       0 :                     		else
(1)   86/       0 :                     			while address > $
(1)   87/       0 :                     				db 0
(1)   88/       0 :                     			endm
(1)   89/       0 :                     		endif
(1)   90/       0 :                     	endif
(1)   91/       0 :                         endm
(1)   92/       0 :                     
       7/       0 :                     		include	"system/shared.asm"		; Shared Genesis/32X variables
(1)    1/       0 :                     ; ====================================================================
(1)    2/       0 :                     ; ----------------------------------------------------------------
(1)    3/       0 :                     ; MD/32X shared constants and values
(1)    4/       0 :                     ; ----------------------------------------------------------------
(1)    5/       0 :                     
(1)    6/       0 :                     ; ====================================================================
(1)    7/       0 :                     ; --------------------------------------------------------
(1)    8/       0 :                     ; Settings
(1)    9/       0 :                     ; --------------------------------------------------------
(1)   10/       0 :                     
(1)   11/       0 : =$10                MAX_MODELS	equ 16		; MAX 3D Models
(1)   12/       0 : =$18                MAX_SUPERSPR	equ 24		; MAX Number of Super Sprites
(1)   13/       0 :                     
(1)   14/       0 :                     ; --------------------------------------------------------
(1)   15/       0 :                     ; Structs
(1)   16/       0 :                     ; --------------------------------------------------------
(1)   17/       0 :                     
(1)   18/       0 :                     ; 3D Models
(1)   19/       0 :                     ; RAM_MdDreq+Dreq_Objects
(1)   20/       0 : (MACRO)             		struct 0
(1)   20/       0 : =$0                 GLBL_LASTPC     set *
(1)   20/       0 :                                     dephase
(1)   20/       0 : =$0                 GLBL_LASTORG    set *
(1)   20/       0 :                                     phase 0
(1)   21/       0 :                     mdl_data	ds.l 1		; Model data pointer, if zero: no model
(1)   22/       4 :                     mdl_option	ds.l 1		; Model options: pixelvalue increment
(1)   23/       8 :                     mdl_x_pos	ds.w 1		; X position $08.00
(1)   24/       A :                     mdl_y_pos	ds.w 1		; Y position $08.00
(1)   25/       C :                     mdl_z_pos	ds.w 1		; Z position $08.00
(1)   26/       E :                     mdl_x_rot	ds.w 1		; X rotation $08.00
(1)   27/      10 :                     mdl_y_rot	ds.w 1		; Y rotation $08.00
(1)   28/      12 :                     mdl_z_rot	ds.w 1		; Z rotation $08.00
(1)   29/      14 :                     mdl_frame	ds.w 1
(1)   30/      16 :                     mdl_flags	ds.w 1
(1)   31/      18 :                     sizeof_mdlobj	ds.l 0
(1)   32/      18 : (MACRO)             		finish
(1)   32/       0 :                                     !org GLBL_LASTORG
(1)   32/       0 :                                     phase GLBL_LASTPC
(1)   33/       0 :                     
(1)   34/       0 :                     ; 3D Camera
(1)   35/       0 : (MACRO)             		struct 0
(1)   35/       0 : =$0                 GLBL_LASTPC     set *
(1)   35/       0 :                                     dephase
(1)   35/       0 : =$0                 GLBL_LASTORG    set *
(1)   35/       0 :                                     phase 0
(1)   36/       0 :                     cam_x_pos	ds.l 1		; X position $000000.00
(1)   37/       4 :                     cam_y_pos	ds.l 1		; Y position $000000.00
(1)   38/       8 :                     cam_z_pos	ds.l 1		; Z position $000000.00
(1)   39/       C :                     cam_x_rot	ds.l 1		; X rotation $000000.00
(1)   40/      10 :                     cam_y_rot	ds.l 1		; Y rotation $000000.00
(1)   41/      14 :                     cam_z_rot	ds.l 1		; Z rotation $000000.00
(1)   42/      18 :                     sizeof_camera	ds.l 0
(1)   43/      18 : (MACRO)             		finish
(1)   43/       0 :                                     !org GLBL_LASTORG
(1)   43/       0 :                                     phase GLBL_LASTPC
(1)   44/       0 :                     
(1)   45/       0 :                     ; "Super" sprites:
(1)   46/       0 :                     ; RAM_MdDreq+Dreq_SuperSpr
(1)   47/       0 :                     ;
(1)   48/       0 :                     ; ** = keep the order
(1)   49/       0 : (MACRO)             		struct 0
(1)   49/       0 : =$0                 GLBL_LASTPC     set *
(1)   49/       0 :                                     dephase
(1)   49/       0 : =$0                 GLBL_LASTORG    set *
(1)   49/       0 :                                     phase 0
(1)   50/       0 :                     marsspr_xfrm	ds.b 1		; Animation X frame pos **
(1)   51/       1 :                     marsspr_yfrm	ds.b 1		; Animation Y frame pos **
(1)   52/       2 :                     marsspr_xs	ds.b 1		; Sprite X size **
(1)   53/       3 :                     marsspr_ys	ds.b 1		; Sprite Y size **
(1)   54/       4 :                     marsspr_x	ds.w 1		; Screen X position **
(1)   55/       6 :                     marsspr_y	ds.w 1		; Screen Y position **
(1)   56/       8 :                     marsspr_dwidth	ds.w 1		; Spritesheet WIDTH
(1)   57/       A :                     marsspr_indx	ds.w 1		; Palette index base
(1)   58/       C :                     marsspr_flags	ds.w 1		; Sprite flags: %VH (flip)
(1)   59/       E :                     marsspr_fill	ds.w 1		; <-- 2 filler bytes: free to use
(1)   60/      10 :                     marsspr_data	ds.l 1		; Spritesheet DATA location in SH2 area (0 == end-of-spritelist)
(1)   61/      14 :                     marsspr_map	ds.l 1		; MAP data
(1)   62/      18 :                     sizeof_marsspr	ds.l 0
(1)   63/      18 : (MACRO)             		finish
(1)   63/       0 :                                     !org GLBL_LASTORG
(1)   63/       0 :                                     phase GLBL_LASTPC
(1)   64/       0 :                     
(1)   65/       0 :                     ; ====================================================================
(1)   66/       0 :                     ; ----------------------------------------------------------------
(1)   67/       0 :                     ; MAIN DREQ-RAM control
(1)   68/       0 :                     ;
(1)   69/       0 :                     ; To read these labels:
(1)   70/       0 :                     ;
(1)   71/       0 :                     ; On the Genesis Side:
(1)   72/       0 :                     ; 	lea	(RAM_MdDreq+DREQ_LABEL),a0
(1)   73/       0 :                     ; On the 32X Side:
(1)   74/       0 :                     ; 	mov	#RAM_Mars_DreqRead+DREQ_LABEL,r1
(1)   75/       0 :                     ;
(1)   76/       0 :                     ; Call System_MarsUpdate DURING display to transfer your
(1)   77/       0 :                     ; changes.
(1)   78/       0 :                     ; ----------------------------------------------------------------
(1)   79/       0 :                     
(1)   80/       0 :                     ; *** List MUST be aligned in 8bytes (end with 0 or 8) ***
(1)   81/       0 :                     
(1)   82/       0 : (MACRO)             		struct 0
(1)   82/       0 : =$0                 GLBL_LASTPC     set *
(1)   82/       0 :                                     dephase
(1)   82/       0 : =$0                 GLBL_LASTORG    set *
(1)   82/       0 :                                     phase 0
(1)   83/       0 :                     Dreq_Palette	ds.w 256				; 256-color palette
(1)   84/     200 :                     Dreq_BgExBuff	ds.b $80				; Buffer for current screen mode (NOTE: manual size)
(1)   85/     280 :                     Dreq_ObjCam	ds.b sizeof_camera
(1)   86/     298 :                     Dreq_Objects	ds.b sizeof_mdlobj*MAX_MODELS		; 3D Objects
(1)   87/     418 :                     Dreq_SuperSpr	ds.b sizeof_marsspr*MAX_SUPERSPR	; Super sprites
(1)   88/     658 :                     sizeof_dreq	ds.l 0
(1)   89/     658 : (MACRO)             		finish
(1)   89/       0 :                                     !org GLBL_LASTORG
(1)   89/       0 :                                     phase GLBL_LASTPC
(1)   90/       0 :                     
DREQ RAM uses: 658
(1)   92/       0 :                     		message "DREQ RAM uses: \{sizeof_dreq}"
(1)   94/       0 :                     
       8/       0 :                     		include	"system/md/map.asm"		; Genesis hardware map
(1)    1/       0 :                     ; ====================================================================
(1)    2/       0 :                     ; ----------------------------------------------------------------
(1)    3/       0 :                     ; Genesis / MegaDrive 68k map
(1)    4/       0 :                     ; ----------------------------------------------------------------
(1)    5/       0 :                     
(1)    6/       0 : =$200000            sys_exram	equ	$200000		; Second half of 4MB rom or external RAM (Normal or save data)
(1)    7/       0 : =$A00000            z80_cpu		equ	$A00000		; Z80 CPU area, size: $2000
(1)    8/       0 : =$A04000            ym_ctrl_1	equ	$A04000		; YM2612 reg 1
(1)    9/       0 : =$A04001            ym_data_1	equ	$A04001		; YM2612 reg 2
(1)   10/       0 : =$A04002            ym_ctrl_2	equ	$A04002		; YM2612 reg 1
(1)   11/       0 : =$A04003            ym_data_2	equ	$A04003		; YM2612 reg 2
(1)   12/       0 : =$A10001            sys_io		equ	$A10001		; bits: OVRSEAS(7)|PAL(6)|DISK(5)|VER(3-0)
(1)   13/       0 : =$A10003            sys_data_1	equ	$A10003		; Port 1 DATA
(1)   14/       0 : =$A10005            sys_data_2	equ	$A10005		; Port 2 DATA
(1)   15/       0 : =$A10007            sys_data_3	equ	$A10007		; Modem DATA
(1)   16/       0 : =$A10009            sys_ctrl_1	equ	$A10009		; Port 1 CTRL
(1)   17/       0 : =$A1000B            sys_ctrl_2	equ	$A1000B		; Port 2 CTRL
(1)   18/       0 : =$A1000D            sys_ctrl_3	equ	$A1000D		; Modem CTRL
(1)   19/       0 : =$A11100            z80_bus 	equ	$A11100		; only use bit 0 (bit 8 as WORD)
(1)   20/       0 : =$A11200            z80_reset	equ	$A11200		; WRITE only ($0000 reset/$0100 cancel)
(1)   21/       0 : =$A130F1            md_bank_sram	equ	$A130F1		; Make SRAM visible at $200000
(1)   22/       0 : =$A14000            sys_tmss	equ	$A14000		; write "SEGA" here for ver > 0
(1)   23/       0 : =$C00000            vdp_data	equ	$C00000		; video data port
(1)   24/       0 : =$C00004            vdp_ctrl	equ	$C00004		; video control port
(1)   25/       0 : =$C00011            psg_ctrl	equ	$C00011		; PSG control
(1)   26/       0 :                     
(1)   27/       0 :                     ; ----------------------------------------------------------------
(1)   28/       0 :                     ; Genesis / Mega drive Z80 map
(1)   29/       0 :                     ; ----------------------------------------------------------------
(1)   30/       0 :                     
(1)   31/       0 : =$4000              zym_ctrl_1	equ	$4000		; YM2612 reg 1
(1)   32/       0 : =$4001              zym_data_1	equ	$4001		; YM2612 reg 2
(1)   33/       0 : =$4002              zym_ctrl_2	equ	$4002		; YM2612 reg 1
(1)   34/       0 : =$4003              zym_data_2	equ	$4003		; YM2612 reg 2
(1)   35/       0 : =$6000              zbank		equ	$6000		; Z80 ROM BANK: %XXXXXXXX X0000000 00000000 (9-byte writes)
(1)   36/       0 :                     ; zvdp_data	equ	$7F00		; video data port
(1)   37/       0 :                     ; zvdp_ctrl	equ	$7F04		; video control port
(1)   38/       0 : =$7F11              zpsg_ctrl	equ	$7F11		; PSG control
(1)   39/       0 :                     
(1)   40/       0 :                     ; ----------------------------------------------------------------
(1)   41/       0 :                     ; 32X registers
(1)   42/       0 :                     ; ----------------------------------------------------------------
(1)   43/       0 :                     
(1)   44/       0 : =$A130EC            sysmars_id	equ	$A130EC		; 32X's ID: "MARS"
(1)   45/       0 : =$A15100            sysmars_reg	equ	$A15100		; MARS 32X registers section, see system/mars/map.asm for variables
(1)   46/       0 :                     
       9/       0 :                     		include	"system/md/const.asm"		; Genesis variables
(1)    1/       0 :                     ; ====================================================================
(1)    2/       0 :                     ; ----------------------------------------------------------------
(1)    3/       0 :                     ; Genesis side constants
(1)    4/       0 :                     ; ----------------------------------------------------------------
(1)    5/       0 :                     
(1)    6/       0 : =$10                MAX_MDDMATSK	equ 16			; MAX DMA BLAST entries
(1)    7/       0 :                     
(1)    8/       0 :                     ; ====================================================================
(1)    9/       0 :                     ; --------------------------------------------------------
(1)   10/       0 :                     ; Settings
(1)   11/       0 :                     ; --------------------------------------------------------
(1)   12/       0 :                     
(1)   13/       0 : =$FFFF9000          MDRAM_START	equ $FFFF9000		; Start of Genesis working RAM
(1)   14/       0 : =$800               MAX_MDERAM	equ $800		; Maximum RAM for current Screen mode
(1)   15/       0 :                     
(1)   16/       0 :                     ; ====================================================================
(1)   17/       0 :                     ; ----------------------------------------------------------------
(1)   18/       0 :                     ; Input
(1)   19/       0 :                     ; ----------------------------------------------------------------
(1)   20/       0 :                     
(1)   21/       0 :                     ; --------------------------------------------------------
(1)   22/       0 :                     ; Controller
(1)   23/       0 :                     ; --------------------------------------------------------
(1)   24/       0 :                     
(1)   25/       0 :                     ; Controller buffer data (after calling System_Input)
(1)   26/       0 :                     ;
(1)   27/       0 :                     ; Type/Revision byte:
(1)   28/       0 :                     ;
(1)   29/       0 :                     ; ID    |
(1)   30/       0 :                     ; $0D   | $00 - Original 3 button
(1)   31/       0 :                     ;       | $01 - 6 button version: XYZM
(1)   32/       0 :                     
(1)   33/       0 : (MACRO)             		struct 0
(1)   33/       0 : =$0                 GLBL_LASTPC     set *
(1)   33/       0 :                                     dephase
(1)   33/       0 : =$0                 GLBL_LASTORG    set *
(1)   33/       0 :                                     phase 0
(1)   34/       0 :                     pad_id		ds.b 1			; Controller ID
(1)   35/       1 :                     pad_ver		ds.b 1			; Controller type/revision
(1)   36/       2 :                     on_hold		ds.w 1			; User HOLD bits
(1)   37/       4 :                     on_press	ds.w 1			; User PRESSED bits
(1)   38/       6 :                     mouse_x		ds.w 1			; Mouse X add/sub
(1)   39/       8 :                     mouse_y		ds.w 1			; Mouse Y add/sub
(1)   40/       A :                     extr_3		ds.w 1
(1)   41/       C :                     extr_4		ds.w 1
(1)   42/       E :                     extr_5		ds.w 1
(1)   43/      10 :                     sizeof_input	ds.l 0
(1)   44/      10 : (MACRO)             		finish
(1)   44/       0 :                                     !org GLBL_LASTORG
(1)   44/       0 :                                     phase GLBL_LASTPC
(1)   45/       0 :                     
(1)   46/       0 :                     ; Read as (Controller_1) then add +on_hold or +on_press
(1)   47/       0 : =$FFFFFFFFFF..      Controller_1	equ RAM_InputData
(1)   48/       0 : =$FFFFFFFFFF..      Controller_2	equ RAM_InputData+sizeof_input
(1)   49/       0 :                     
(1)   50/       0 :                     ; Read WORD in +on_hold or +on_press
(1)   51/       0 : =$1                 JoyUp		equ $0001
(1)   52/       0 : =$2                 JoyDown		equ $0002
(1)   53/       0 : =$4                 JoyLeft		equ $0004
(1)   54/       0 : =$8                 JoyRight	equ $0008
(1)   55/       0 : =$10                JoyB		equ $0010
(1)   56/       0 : =$20                JoyC		equ $0020
(1)   57/       0 : =$40                JoyA		equ $0040
(1)   58/       0 : =$80                JoyStart	equ $0080
(1)   59/       0 : =$100               JoyZ		equ $0100
(1)   60/       0 : =$200               JoyY		equ $0200
(1)   61/       0 : =$400               JoyX		equ $0400
(1)   62/       0 : =$800               JoyMode		equ $0800
(1)   63/       0 : =$0                 bitJoyUp	equ 0		; READ THESE AS A WORD
(1)   64/       0 : =$1                 bitJoyDown	equ 1
(1)   65/       0 : =$2                 bitJoyLeft	equ 2
(1)   66/       0 : =$3                 bitJoyRight	equ 3
(1)   67/       0 : =$4                 bitJoyB		equ 4
(1)   68/       0 : =$5                 bitJoyC		equ 5
(1)   69/       0 : =$6                 bitJoyA		equ 6
(1)   70/       0 : =$7                 bitJoyStart	equ 7
(1)   71/       0 : =$8                 bitJoyZ		equ 8
(1)   72/       0 : =$9                 bitJoyY		equ 9
(1)   73/       0 : =$A                 bitJoyX		equ 10
(1)   74/       0 : =$B                 bitJoyMode	equ 11
(1)   75/       0 :                     
(1)   76/       0 :                     ; Mega Mouse
(1)   77/       0 :                     ; Read WORD in +on_hold or +on_press
(1)   78/       0 : =$1                 ClickR		equ $0001
(1)   79/       0 : =$2                 ClickL		equ $0002
(1)   80/       0 : =$4                 ClickM		equ $0004	; US MOUSE ONLY
(1)   81/       0 : =$8                 ClickS		equ $0008	; (Untested)
(1)   82/       0 : =$0                 bitClickR	equ 0
(1)   83/       0 : =$1                 bitClickL	equ 1
(1)   84/       0 : =$2                 bitClickM	equ 2
(1)   85/       0 : =$3                 bitClickS	equ 3
(1)   86/       0 :                     
(1)   87/       0 :                     ; ====================================================================
(1)   88/       0 :                     ; ----------------------------------------------------------------
(1)   89/       0 :                     ; MD RAM
(1)   90/       0 :                     ;
(1)   91/       0 :                     ; NOTE for porting this to Sega CD (or SegaCD+32X):
(1)   92/       0 :                     ; From $FFFD00 to $FFFDFF is reserved for the MAIN-CPU's vectors
(1)   93/       0 :                     ; ----------------------------------------------------------------
(1)   94/       0 :                     
(1)   95/       0 : (MACRO)             		struct MDRAM_START
(1)   95/       0 : =$0                 GLBL_LASTPC     set *
(1)   95/       0 :                                     dephase
(1)   95/       0 : =$0                 GLBL_LASTORG    set *
(1)   95/FFFFFFFFFFFF9000 :                                     phase MDRAM_START
(1)  105/FFFFFFFFFFFF9000 :                     RAM_ModeBuff	ds.b MAX_MDERAM			; Second pass: sizes are set
(1)  106/FFFFFFFFFFFF9800 :                     RAM_MdSound	ds.b sizeof_mdsnd-RAM_MdSound
(1)  107/FFFFFFFFFFFF9820 :                     RAM_MdVideo	ds.b sizeof_mdvid-RAM_MdVideo
(1)  108/FFFFFFFFFFFFA702 :                     RAM_MdSystem	ds.b sizeof_mdsys-RAM_MdSystem
(1)  109/FFFFFFFFFFFFAB5E :                     RAM_MdGlobal	ds.b sizeof_mdglbl-RAM_MdGlobal
(1)  110/FFFFFFFFFFFFAB60 :                     RAM_MdDreq	ds.b sizeof_dreq
(1)  111/FFFFFFFFFFFFB1B8 :                     sizeof_mdram	ds.l 0
(1)  113/FFFFFFFFFFFFB1B8 :                     
MD RAM: FF9000-FFB1B8
(1)  115/FFFFFFFFFFFFB1B8 :                     		message "MD RAM: \{(MDRAM_START)&$FFFFFF}-\{(sizeof_mdram)&$FFFFFF}"
(1)  117/FFFFFFFFFFFFB1B8 : (MACRO)             		finish
(1)  117/FFFFFFFFFFFF9000 :                                     !org GLBL_LASTORG
(1)  117/       0 :                                     phase GLBL_LASTPC
(1)  118/       0 :                     
(1)  119/       0 :                     
      10/       0 :                     		include	"system/mars/map.asm"		; 32X hardware map
(1)    1/       0 :                     ; ====================================================================
(1)    2/       0 :                     ; ----------------------------------------------------------------
(1)    3/       0 :                     ; SH2 MAP
(1)    4/       0 :                     ; ----------------------------------------------------------------
(1)    5/       0 :                     
(1)    6/       0 :                     ; --------------------------------------------------------
(1)    7/       0 :                     ; SH2 SIDE MAP
(1)    8/       0 :                     ; --------------------------------------------------------
(1)    9/       0 :                     
(1)   10/       0 : =$0                 CS0		equ	$00000000	; Boot ROM & System registers
(1)   11/       0 : =$2000000           CS1		equ	$02000000	; ROM data all 4MB, Gone if RV=1
(1)   12/       0 : =$4000000           CS2		equ	$04000000	; Framebuffer area
(1)   13/       0 : =$6000000           CS3		equ	$06000000	; SDRAM
(1)   14/       0 : =$20000000          TH		equ	$20000000	; OR value for CacheThru
(1)   15/       0 : =$20004000          _sysreg		equ	$00004000|TH	; MARS System registers
(1)   16/       0 : =$20004100          _vdpreg		equ	$00004100|TH	; SuperVDP registers
(1)   17/       0 : =$20004200          _palette	equ	$00004200|TH	; Palette RAM for Pixel-Packed or RLE mode
(1)   18/       0 : =$24000000          _framebuffer:	equ	CS2|TH		; Framebuffer: First 240 words are the linetable
(1)   19/       0 : =$24020000          _overwrite:	equ	CS2|TH+$20000	; Overwrite: $00 writes are ignored
(1)   20/       0 :                     
(1)   21/       0 :                     ; --------------------------------------------------------
(1)   22/       0 :                     ; Variables
(1)   23/       0 :                     ; --------------------------------------------------------
(1)   24/       0 :                     
(1)   25/       0 :                     ; ------------------------------------------------
(1)   26/       0 :                     ; System
(1)   27/       0 :                     ; ------------------------------------------------
(1)   28/       0 :                     
(1)   29/       0 :                     ; _sysreg
(1)   30/       0 : =$0                 adapter		equ	$00		; adapter control register (Read as WORD)
(1)   31/       0 : =$1                 intmask		equ	$01		; SH2 CPU ONLY: interrupts mask
(1)   32/       0 : =$3                 standby		equ	$03		; CMD interrupt request bit by MD side (slave|master) (BYTE)
(1)   33/       0 : =$5                 hcount		equ	$05		; H Counter (BYTE)
(1)   34/       0 : =$6                 dreqctl		equ	$06		; DREQ control (WORD)
(1)   35/       0 : =$8                 dreqsource	equ	$08		; DREQ source address
(1)   36/       0 : =$C                 dreqdest	equ	$0C		; DREQ destination address
(1)   37/       0 : =$10                dreqlen		equ	$10		; DREQ length
(1)   38/       0 : =$12                dreqfifo	equ	$12		; DREQ FIFO
(1)   39/       0 : =$14                vresintclr	equ	$14		; VRES interrupt clear
(1)   40/       0 : =$16                vintclr		equ	$16		; V interrupt clear
(1)   41/       0 : =$18                hintclr		equ	$18		; H interrupt clear
(1)   42/       0 : =$1A                cmdintclr	equ	$1a		; CMD interrupt clear
(1)   43/       0 : =$1C                pwmintclr	equ	$1C		; PWM interrupt clear
(1)   44/       0 : =$20                comm0		equ	$20		; Communication ports ***
(1)   45/       0 : =$21                comm1		equ	$21		; ALL CPUs can see this ports: including Z80
(1)   46/       0 : =$22                comm2		equ	$22		; only be careful with the read/write directions.
(1)   47/       0 : =$23                comm3		equ	$23		; ODD addresses (1,3,5...) are BYTE-read only.
(1)   48/       0 : =$24                comm4		equ	$24		; EVEN addresses (0,2,4...) can be read as WORDs
(1)   49/       0 : =$25                comm5		equ	$25		; Writing LONG addreses are possible depending
(1)   50/       0 : =$26                comm6		equ	$26		; of the CPU's aligment limitations.
(1)   51/       0 : =$27                comm7		equ	$27		;
(1)   52/       0 : =$28                comm8		equ	$28		;
(1)   53/       0 : =$29                comm9		equ	$29		;
(1)   54/       0 : =$2A                comm10		equ	$2A		;
(1)   55/       0 : =$2B                comm11		equ	$2B		;
(1)   56/       0 : =$2C                comm12		equ	$2C		;
(1)   57/       0 : =$2D                comm13		equ	$2D		;
(1)   58/       0 : =$2E                comm14		equ	$2E		;
(1)   59/       0 : =$2F                comm15		equ	$2F		;
(1)   60/       0 : =$30                timerctl	equ	$30		; PWM Timer Control
(1)   61/       0 : =$31                pwmctl		equ	$31		; PWM Control
(1)   62/       0 : =$32                cycle		equ	$32		; PWM Cycle
(1)   63/       0 : =$34                lchwidth	equ	$34		; PWM L ch Width
(1)   64/       0 : =$36                rchwidth	equ	$36		; PWM R ch Width
(1)   65/       0 : =$38                monowidth	equ	$38		; PWM Monaural Width
(1)   66/       0 :                     
(1)   67/       0 :                     ; _sysreg
(1)   68/       0 :                     ; adapter
(1)   69/       0 : =$1                 CART		equ	%00000001	; CD or Cartridge
(1)   70/       0 : =$2                 ADEN		equ	%00000010	; MARS Enabled: No/Yes
(1)   71/       0 : =$80                FM		equ	%10000000	; SuperVDP permission: MD or SH
(1)   72/       0 :                     ; framectl
(1)   73/       0 : =$1                 FS		equ	%00000001	; Current framebuffer DRAM pixel data
(1)   74/       0 : =$2                 FEN		equ	%00000010	; Can write to Framebuffer: Yes/No
(1)   75/       0 :                     ; vdpsts
(1)   76/       0 : =$80                VBLK		equ	%10000000	; VBlank bit
(1)   77/       0 : =$40                HBLK		equ	%01000000	; HBlank bit
(1)   78/       0 : =$20                PEN		equ	%00100000	; Can write to Palette: Yes/No
(1)   79/       0 :                     ; intmask
(1)   80/       0 : =$8                 VIRQ_ON		equ	$08		; IRQ masks for IRQ mask register
(1)   81/       0 : =$4                 HIRQ_ON		equ	$04
(1)   82/       0 : =$2                 CMDIRQ_ON	equ	$02
(1)   83/       0 : =$1                 PWMIRQ_ON	equ	$01
(1)   84/       0 :                     
(1)   85/       0 :                     ; _vdpreg
(1)   86/       0 : =$0                 tvmode		equ	$00		; TV mode
(1)   87/       0 : =$1                 bitmapmd	equ	$01		; Bitmap mode
(1)   88/       0 : =$2                 shift		equ	$02		; Lineshift bit
(1)   89/       0 : =$4                 filllength	equ	$04		; Auto Fill Length register
(1)   90/       0 : =$6                 fillstart	equ	$06		; Auto Fill Start Address register
(1)   91/       0 : =$8                 filldata	equ	$08		; Auto Fill Data register
(1)   92/       0 : =$A                 vdpsts		equ	$0A		; VDP Status register
(1)   93/       0 : =$B                 framectl	equ	$0B		; Frame Buffer Control register
(1)   94/       0 :                     
(1)   95/       0 :                     ; --------------------------------------------------------
(1)   96/       0 :                     ; SH2 Internal registers, independent for each CPU
(1)   97/       0 :                     ; --------------------------------------------------------
(1)   98/       0 :                     
(1)   99/       0 :                     ; DMA Channel 0: General data transfer
(1)  100/       0 :                     ; DMA Channel 1: PWM only
(1)  101/       0 :                     
(1)  102/       0 : =$FFFFFE00          _SERIAL		equ	$FFFFFE00	; Serial Control
(1)  103/       0 : =$FFFFFE10          _FRT		equ	$FFFFFE10	; Free run timer
(1)  104/       0 : =$0                 _TIER		equ	$00		; Timer interrupt enable register
(1)  105/       0 : =$1                 _TCSR		equ	$01		; Timer control & status register
(1)  106/       0 : =$2                 _FRC_H		equ	$02		; Free running counter High
(1)  107/       0 : =$3                 _FRC_L		equ	$03		; Free running counter Low
(1)  108/       0 : =$4                 _OCR_H		equ	$04		; Output compare register High
(1)  109/       0 : =$5                 _OCR_L		equ	$05		; Output compare register Low
(1)  110/       0 : =$6                 _TCR		equ	$06		; Timer control register
(1)  111/       0 : =$7                 _TOCR		equ	$07		; Timer output compare control register
(1)  112/       0 : =$FFFFFE92          _CCR		equ	$FFFFFE92	; Cache register (WORD)
(1)  113/       0 : =$FFFFFF00          _JR		equ	$FFFFFF00	; DIVU (--- / val)
(1)  114/       0 : =$FFFFFF04          _HRL32		equ	$FFFFFF04	; DIVU (val / ---) or RIGHT-long result if read
(1)  115/       0 : =$FFFFFF10          _HRH		equ	$FFFFFF10	; DIVU Result: LEFT long
(1)  116/       0 : =$FFFFFF14          _HRL		equ	$FFFFFF14	; DIVU Result: RIGHT long
(1)  117/       0 : =$FFFFFF80          _DMASOURCE0	equ	$FFFFFF80	; DMA source address 0
(1)  118/       0 : =$FFFFFF84          _DMADEST0	equ	$FFFFFF84	; DMA destination address 0
(1)  119/       0 : =$FFFFFF88          _DMACOUNT0	equ	$FFFFFF88	; DMA transfer count 0
(1)  120/       0 : =$FFFFFF8C          _DMACHANNEL0	equ	$FFFFFF8C	; DMA channel control 0
(1)  121/       0 : =$FFFFFF90          _DMASOURCE1	equ	$FFFFFF90	; DMA source address 1
(1)  122/       0 : =$FFFFFF94          _DMADEST1	equ	$FFFFFF94	; DMA destination address 1
(1)  123/       0 : =$FFFFFF98          _DMACOUNT1	equ	$FFFFFF98	; DMA transfer count 1
(1)  124/       0 : =$FFFFFF9C          _DMACHANNEL1	equ	$FFFFFF9C	; DMA channel control 1
(1)  125/       0 : =$FFFFFFA0          _DMAVECTORN0	equ	$FFFFFFA0	; DMA vector number N0
(1)  126/       0 : =$FFFFFFA4          _DMAVECTORE0	equ	$FFFFFFA4	; DMA vector number E0
(1)  127/       0 : =$FFFFFFA8          _DMAVECTORN1	equ	$FFFFFFA8	; DMA vector number N1
(1)  128/       0 : =$FFFFFFAC          _DMAVECTORE1	equ	$FFFFFFAC	; DMA vector number E1
(1)  129/       0 : =$FFFFFFB0          _DMAOPERATION	equ	$FFFFFFB0	; DMA operation
(1)  130/       0 : =$FFFFFFB4          _DMAREQACK0	equ	$FFFFFFB4	; DMA request/ack select control 0
(1)  131/       0 : =$FFFFFFB8          _DMAREQACK1	equ	$FFFFFFB8	; DMA request/ack select control 1
(1)  132/       0 :                     
      11/       0 :                     		include "code/global.asm"		; Global user variables on the Genesis
(1)    1/       0 :                     ; ====================================================================
(1)    2/       0 :                     ; ----------------------------------------------------------------
(1)    3/       0 :                     ; Global RAM variables on the Genesis side
(1)    4/       0 :                     ; (Score, Level, etc.)
(1)    5/       0 :                     ; ----------------------------------------------------------------
(1)    6/       0 :                     
(1)    7/       0 : (MACRO)             		struct RAM_MdGlobal
(1)    7/       0 : =$0                 GLBL_LASTPC     set *
(1)    7/       0 :                                     dephase
(1)    7/       0 : =$0                 GLBL_LASTORG    set *
(1)    7/FFFFFFFFFFFFAB5E :                                     phase RAM_MDGLOBAL
(1)    8/FFFFFFFFFFFFAB5E :                     RAM_Glbl_Scrn	ds.w 1
(1)    9/FFFFFFFFFFFFAB60 :                     sizeof_mdglbl	ds.l 0
(1)   10/FFFFFFFFFFFFAB62 : (MACRO)             		finish
(1)   10/FFFFFFFFFFFFAB5E :                                     !org GLBL_LASTORG
(1)   10/       0 :                                     phase GLBL_LASTPC
(1)   11/       0 :                     
(1)   12/       0 :                     
      12/       0 :                     		include	"system/head.asm"		; 32X header
(1)    1/       0 :                     ; ====================================================================
(1)    2/       0 :                     ; ----------------------------------------------------------------
(1)    3/       0 :                     ; 32X ROM HEADER
(1)    4/       0 :                     ; ----------------------------------------------------------------
(1)    5/       0 :                     
(1)    6/       0 : 0000 0000           		dc.l 0			; Stack point
(1)    7/       4 : 0000 03F0           		dc.l $3F0		; Entry point MUST point to $3F0
(1)    8/       8 : 0000 0820           		dc.l MD_ErrBus		; Bus error
(1)    9/       C : 0000 0820           		dc.l MD_ErrAddr		; Address error
(1)   10/      10 : 0000 0820           		dc.l MD_ErrIll		; ILLEGAL Instruction
(1)   11/      14 : 0000 0820           		dc.l MD_ErrZDiv		; Divide by 0
(1)   12/      18 : 0000 0820           		dc.l MD_ErrChk		; CHK Instruction
(1)   13/      1C : 0000 0820           		dc.l MD_ErrTrapV	; TRAPV Instruction
(1)   14/      20 : 0000 0820           		dc.l MD_ErrPrivl	; Privilege violation
(1)   15/      24 : 0000 0820           		dc.l MD_Trace		; Trace
(1)   16/      28 : 0000 0820           		dc.l MD_Line1010	; Line 1010 Emulator
(1)   17/      2C : 0000 0820           		dc.l MD_Line1111	; Line 1111 Emulator
(1)   18/      30 : 0000 0820           		dc.l MD_ErrorEx		; Error exception
(1)   19/      34 : 0000 0820           		dc.l MD_ErrorEx
(1)   20/      38 : 0000 0820           		dc.l MD_ErrorEx
(1)   21/      3C : 0000 0820           		dc.l MD_ErrorEx
(1)   22/      40 : 0000 0820           		dc.l MD_ErrorEx
(1)   23/      44 : 0000 0820           		dc.l MD_ErrorEx
(1)   24/      48 : 0000 0820           		dc.l MD_ErrorEx
(1)   25/      4C : 0000 0820           		dc.l MD_ErrorEx
(1)   26/      50 : 0000 0820           		dc.l MD_ErrorEx
(1)   27/      54 : 0000 0820           		dc.l MD_ErrorEx
(1)   28/      58 : 0000 0820           		dc.l MD_ErrorEx
(1)   29/      5C : 0000 0820           		dc.l MD_ErrorEx
(1)   30/      60 : 0000 0820           		dc.l MD_ErrorEx
(1)   31/      64 : 0000 0820           		dc.l MD_ErrorTrap
(1)   32/      68 : 0000 0820           		dc.l MD_ErrorTrap
(1)   33/      6C : 0000 0820           		dc.l MD_ErrorTrap
(1)   34/      70 : FFFF AB54           		dc.l RAM_MdMarsHInt		; RAM jump for HBlank (JMP xxxx xxxx)
(1)   35/      74 : 0000 0820           		dc.l MD_ErrorTrap
(1)   36/      78 : FFFF AB4E           		dc.l RAM_MdMarsVInt		; RAM jump for VBlank (JMP xxxx xxxx)
(1)   37/      7C : 0000 0820           		dc.l MD_ErrorTrap
(1)   38/      80 : 0000 0820           		dc.l MD_ErrorTrap
(1)   39/      84 : 0000 0820           		dc.l MD_ErrorTrap
(1)   40/      88 : 0000 0820           		dc.l MD_ErrorTrap
(1)   41/      8C : 0000 0820           		dc.l MD_ErrorTrap
(1)   42/      90 : 0000 0820           		dc.l MD_ErrorTrap
(1)   43/      94 : 0000 0820           		dc.l MD_ErrorTrap
(1)   44/      98 : 0000 0820           		dc.l MD_ErrorTrap
(1)   45/      9C : 0000 0820           		dc.l MD_ErrorTrap
(1)   46/      A0 : 0000 0820           		dc.l MD_ErrorTrap
(1)   47/      A4 : 0000 0820           		dc.l MD_ErrorTrap
(1)   48/      A8 : 0000 0820           		dc.l MD_ErrorTrap
(1)   49/      AC : 0000 0820           		dc.l MD_ErrorTrap
(1)   50/      B0 : 0000 0820           		dc.l MD_ErrorTrap
(1)   51/      B4 : 0000 0820           		dc.l MD_ErrorTrap
(1)   52/      B8 : 0000 0820           		dc.l MD_ErrorTrap
(1)   53/      BC : 0000 0820           		dc.l MD_ErrorTrap
(1)   54/      C0 : 0000 0820           		dc.l MD_ErrorTrap
(1)   55/      C4 : 0000 0820           		dc.l MD_ErrorTrap
(1)   56/      C8 : 0000 0820           		dc.l MD_ErrorTrap
(1)   57/      CC : 0000 0820           		dc.l MD_ErrorTrap
(1)   58/      D0 : 0000 0820           		dc.l MD_ErrorTrap
(1)   59/      D4 : 0000 0820           		dc.l MD_ErrorTrap
(1)   60/      D8 : 0000 0820           		dc.l MD_ErrorTrap
(1)   61/      DC : 0000 0820           		dc.l MD_ErrorTrap
(1)   62/      E0 : 0000 0820           		dc.l MD_ErrorTrap
(1)   63/      E4 : 0000 0820           		dc.l MD_ErrorTrap
(1)   64/      E8 : 0000 0820           		dc.l MD_ErrorTrap
(1)   65/      EC : 0000 0820           		dc.l MD_ErrorTrap
(1)   66/      F0 : 0000 0820           		dc.l MD_ErrorTrap
(1)   67/      F4 : 0000 0820           		dc.l MD_ErrorTrap
(1)   68/      F8 : 0000 0820           		dc.l MD_ErrorTrap
(1)   69/      FC : 0000 0820           		dc.l MD_ErrorTrap
(1)   70/     100 : 5345 4741 2033 3258 		dc.b "SEGA 32X        "
                    2020 2020 2020 2020 
(1)   71/     110 : 2843 2947 4636 3420 		dc.b "(C)GF64 2022.NOV"
                    3230 3232 2E4E 4F56 
(1)   72/     120 : 556E 2064 656D 6F20 		dc.b "Un demo chafa para el 32X llamado MARSIANO con S"
                    6368 6166 6120 7061 
                    7261 2065 6C20 3332 
                    5820 6C6C 616D 6164 
                    6F20 4D41 5253 4941 
                    4E4F 2063 6F6E 2053 
(1)   73/     150 : 5072 6F6A 6563 7420 		dc.b "Project Marsiano                                "
                    4D61 7273 6961 6E6F 
                    2020 2020 2020 2020 
                    2020 2020 2020 2020 
                    2020 2020 2020 2020 
                    2020 2020 2020 2020 
(1)   74/     180 : 474D 2054 4543 4844 		dc.b "GM TECHDEMO-00"
                    454D 4F2D 3030      
(1)   75/     18E : 0000                		dc.w 0
(1)   76/     190 : 4A36 2020 2020 2020 		dc.b "J6              "
                    2020 2020 2020 2020 
(1)   77/     1A0 : 0000 0000           		dc.l 0
(1)   78/     1A4 : 0017 E7D4           		dc.l ROM_END
(1)   79/     1A8 : 00FF 0000           		dc.l $FF0000
(1)   80/     1AC : 00FF FFFF           		dc.l $FFFFFF
(1)   81/     1B0 : 2020 2020           		dc.l $20202020		; dc.b "RA",$F8,$20
(1)   82/     1B4 : 2020 2020           		dc.l $20202020		; $200000
(1)   83/     1B8 : 2020 2020           		dc.l $20202020		; $203FFF
(1)   84/     1BC :                     		align $1F0
(1)   85/     1F0 : 4A55 2020 2020 2020 		dc.b "JU              "
                    2020 2020 2020 2020 
(1)   86/     200 :                     
(1)   87/     200 :                     ; ====================================================================
(1)   88/     200 :                     ; ----------------------------------------------------------------
(1)   89/     200 :                     ; NEW header for 32X
(1)   90/     200 :                     ;
(1)   91/     200 :                     ; These new jumps are for the 68K if
(1)   92/     200 :                     ; the 32X is currently active, must point to the $880000/$900000
(1)   93/     200 :                     ; areas
(1)   94/     200 :                     ;
(1)   95/     200 :                     ; NOTE:
(1)   96/     200 :                     ; Disable ALL interrupts if you are using the RV bit
(1)   97/     200 :                     ; ----------------------------------------------------------------
(1)   98/     200 :                     
(1)   99/     200 : 4EF9 0088 0800      		jmp	($880000|MARS_Entry).l
(1)  100/     206 : 4EF9 0088 0820      		jmp	($880000|MD_ErrBus).l		; Bus error
(1)  101/     20C : 4EF9 0088 0820      		jmp	($880000|MD_ErrAddr).l		; Address error
(1)  102/     212 : 4EF9 0088 0820      		jmp	($880000|MD_ErrIll).l		; ILLEGAL Instruction
(1)  103/     218 : 4EF9 0088 0820      		jmp	($880000|MD_ErrZDiv).l		; Divide by 0
(1)  104/     21E : 4EF9 0088 0820      		jmp	($880000|MD_ErrChk).l		; CHK Instruction
(1)  105/     224 : 4EF9 0088 0820      		jmp	($880000|MD_ErrTrapV).l		; TRAPV Instruction
(1)  106/     22A : 4EF9 0088 0820      		jmp	($880000|MD_ErrPrivl).l		; Privilege violation
(1)  107/     230 : 4EF9 0088 0820      		jmp	($880000|MD_Trace).l		; Trace
(1)  108/     236 : 4EF9 0088 0820      		jmp	($880000|MD_Line1010).l		; Line 1010 Emulator
(1)  109/     23C : 4EF9 0088 0820      		jmp	($880000|MD_Line1111).l		; Line 1111 Emulator
(1)  110/     242 : 4EF9 0088 0820      		jmp	($880000|MD_ErrorEx).l		; Error exception
(1)  111/     248 : 4EF9 0088 0820      		jmp	($880000|MD_ErrorEx).l
(1)  112/     24E : 4EF9 0088 0820      		jmp	($880000|MD_ErrorEx).l
(1)  113/     254 : 4EF9 0088 0820      		jmp	($880000|MD_ErrorEx).l
(1)  114/     25A : 4EF9 0088 0820      		jmp	($880000|MD_ErrorEx).l
(1)  115/     260 : 4EF9 0088 0820      		jmp	($880000|MD_ErrorEx).l
(1)  116/     266 : 4EF9 0088 0820      		jmp	($880000|MD_ErrorEx).l
(1)  117/     26C : 4EF9 0088 0820      		jmp	($880000|MD_ErrorEx).l
(1)  118/     272 : 4EF9 0088 0820      		jmp	($880000|MD_ErrorEx).l
(1)  119/     278 : 4EF9 0088 0820      		jmp	($880000|MD_ErrorEx).l
(1)  120/     27E : 4EF9 0088 0820      		jmp	($880000|MD_ErrorEx).l
(1)  121/     284 : 4EF9 0088 0820      		jmp	($880000|MD_ErrorEx).l
(1)  122/     28A : 4EF9 0088 0820      		jmp	($880000|MD_ErrorEx).l
(1)  123/     290 : 4EF9 0088 0820      		jmp	($880000|MD_ErrorTrap).l
(1)  124/     296 : 4EF9 0088 0820      		jmp	($880000|MD_ErrorTrap).l
(1)  125/     29C : 4EF9 0088 0820      		jmp	($880000|MD_ErrorTrap).l
(1)  126/     2A2 : 4EF9 FFFF AB54      		jmp	(RAM_MdMarsHInt).l		; RAM jump for HBlank (JMP xxxx xxxx)
(1)  127/     2A8 : 4EF9 0088 0820      		jmp	($880000|MD_ErrorTrap).l
(1)  128/     2AE : 4EF9 FFFF AB4E      		jmp	(RAM_MdMarsVInt).l		; RAM jump for VBlank (JMP xxxx xxxx)
(1)  129/     2B4 : 4EF9 0088 0820      		jmp	($880000|MD_ErrorTrap).l
(1)  130/     2BA : 4EF9 0088 0820      		jmp	($880000|MD_ErrorTrap).l
(1)  131/     2C0 : 4EF9 0088 0820      		jmp	($880000|MD_ErrorTrap).l
(1)  132/     2C6 : 4EF9 0088 0820      		jmp	($880000|MD_ErrorTrap).l
(1)  133/     2CC : 4EF9 0088 0820      		jmp	($880000|MD_ErrorTrap).l
(1)  134/     2D2 : 4EF9 0088 0820      		jmp	($880000|MD_ErrorTrap).l
(1)  135/     2D8 : 4EF9 0088 0820      		jmp	($880000|MD_ErrorTrap).l
(1)  136/     2DE : 4EF9 0088 0820      		jmp	($880000|MD_ErrorTrap).l
(1)  137/     2E4 : 4EF9 0088 0820      		jmp	($880000|MD_ErrorTrap).l
(1)  138/     2EA : 4EF9 0088 0820      		jmp	($880000|MD_ErrorTrap).l
(1)  139/     2F0 : 4EF9 0088 0820      		jmp	($880000|MD_ErrorTrap).l
(1)  140/     2F6 : 4EF9 0088 0820      		jmp	($880000|MD_ErrorTrap).l
(1)  141/     2FC : 4EF9 0088 0820      		jmp	($880000|MD_ErrorTrap).l
(1)  142/     302 : 4EF9 0088 0820      		jmp	($880000|MD_ErrorTrap).l
(1)  143/     308 : 4EF9 0088 0820      		jmp	($880000|MD_ErrorTrap).l
(1)  144/     30E : 4EF9 0088 0820      		jmp	($880000|MD_ErrorTrap).l
(1)  145/     314 : 4EF9 0088 0820      		jmp	($880000|MD_ErrorTrap).l
(1)  146/     31A : 4EF9 0088 0820      		jmp	($880000|MD_ErrorTrap).l
(1)  147/     320 : 4EF9 0088 0820      		jmp	($880000|MD_ErrorTrap).l
(1)  148/     326 : 4EF9 0088 0820      		jmp	($880000|MD_ErrorTrap).l
(1)  149/     32C : 4EF9 0088 0820      		jmp	($880000|MD_ErrorTrap).l
(1)  150/     332 : 4EF9 0088 0820      		jmp	($880000|MD_ErrorTrap).l
(1)  151/     338 : 4EF9 0088 0820      		jmp	($880000|MD_ErrorTrap).l
(1)  152/     33E : 4EF9 0088 0820      		jmp	($880000|MD_ErrorTrap).l
(1)  153/     344 : 4EF9 0088 0820      		jmp	($880000|MD_ErrorTrap).l
(1)  154/     34A : 4EF9 0088 0820      		jmp	($880000|MD_ErrorTrap).l
(1)  155/     350 : 4EF9 0088 0820      		jmp	($880000|MD_ErrorTrap).l
(1)  156/     356 : 4EF9 0088 0820      		jmp	($880000|MD_ErrorTrap).l
(1)  157/     35C : 4EF9 0088 0820      		jmp	($880000|MD_ErrorTrap).l
(1)  158/     362 : 4EF9 0088 0820      		jmp	($880000|MD_ErrorTrap).l
(1)  159/     368 : 4EF9 0088 0820      		jmp	($880000|MD_ErrorTrap).l
(1)  160/     36E : 4EF9 0088 0820      		jmp	($880000|MD_ErrorTrap).l
(1)  161/     374 : 4EF9 0088 0820      		jmp	($880000|MD_ErrorTrap).l
(1)  162/     37A :                     
(1)  163/     37A :                     ; ----------------------------------------------------------------
(1)  164/     37A :                     
(1)  165/     37A :                     		align $3C0
(1)  166/     3C0 : 4D41 5253 2043 4845 		dc.b "MARS CHECK MODE "			; Module name
                    434B 204D 4F44 4520 
(1)  167/     3D0 : 0000 0000           		dc.l 0					; Version (always 0)
(1)  168/     3D4 : 0004 93E0           		dc.l MARS_RAMDATA			; RAM-code location *Set to 0 if SH2 code points to ROM*
(1)  169/     3D8 : 0000 0000           		dc.l 0					; Zero again.
(1)  170/     3DC : 0000 6890           		dc.l MARS_RAMDATA_e-MARS_RAMDATA	; RAM-code size (END-START) *Set to 4 if SH2 code points to ROM*
(1)  171/     3E0 : 0600 127C           		dc.l SH2_M_Entry			; Master SH2 PC (SH2 map area)
(1)  172/     3E4 : 0600 17E8           		dc.l SH2_S_Entry			; Slave SH2 PC (SH2 map area)
(1)  173/     3E8 : 0600 0000           		dc.l SH2_Master				; Master SH2 default VBR
(1)  174/     3EC : 0600 0128           		dc.l SH2_Slave				; Slave SH2 default VBR
(1)  175/     3F0 :                     		binclude "system/mars/data/security.bin"; All the securty/boot code
(1)  176/     800 :                     
(1)  177/     800 :                     ; ====================================================================
(1)  178/     800 :                     ; ----------------------------------------------------------------
(1)  179/     800 :                     ; Entry point, this must be located at $800
(1)  180/     800 :                     ;
(1)  181/     800 :                     ; At this point, these registers return
(1)  182/     800 :                     ; the following bits:
(1)  183/     800 :                     ;
(1)  184/     800 :                     ; d0: %h0000000 rsc000ti
(1)  185/     800 :                     ; 	h - Cold start / Hot Start
(1)  186/     800 :                     ; 	r - SDRAM self check pass or error
(1)  187/     800 :                     ; 	s - Security check pass or error
(1)  188/     800 :                     ; 	c - Checksum pass or error
(1)  189/     800 :                     ; 	t - TV mode pass or error
(1)  190/     800 :                     ; 	i - MARS ID pass or error
(1)  191/     800 :                     ;
(1)  192/     800 :                     ; d1: %m0000000 jdk0vvv
(1)  193/     800 :                     ; 	m - MARS TV mode
(1)  194/     800 :                     ; 	j - Country: Japan / Overseas
(1)  195/     800 :                     ; 	d - MD TV mode
(1)  196/     800 :                     ; 	k - DISK connected: Yes / No
(1)  197/     800 :                     ; 	v - Version
(1)  198/     800 :                     ;
(1)  199/     800 :                     ; Carry flag: "MARS ID" and Self Check result
(1)  200/     800 :                     ; 	cc: Test passed
(1)  201/     800 :                     ; 	cs: Test failed**
(1)  202/     800 :                     ;
(1)  203/     800 :                     ; ** HARDWARE BUG: This may still trigger if pressing
(1)  204/     800 :                     ; RESET so many times. (Found this on VRDX)
(1)  205/     800 :                     ; * WORKAROUND: After jumping to the
(1)  206/     800 :                     ; "No 32X detected" loop, test the checksum bit again
(1)  207/     800 :                     ; and if it passes Init as usual.
(1)  208/     800 :                     ; ----------------------------------------------------------------
(1)  209/     800 :                     
(1)  210/     800 :                     MARS_Entry:
(1)  211/     800 : 6436                		bcc	MD_Init			; Carry clear: pass
(1)  212/     802 :                     
(1)  213/     802 :                     ; ====================================================================
(1)  214/     802 :                     ; ----------------------------------------------------------------
(1)  215/     802 :                     ; If 32X is not detected...
(1)  216/     802 :                     ;
(1)  217/     802 :                     ; This only works in emulators, though.
(1)  218/     802 :                     ; ----------------------------------------------------------------
(1)  219/     802 :                     
(1)  220/     802 :                     .no_mars:
(1)  221/     802 : 0800 0005           		btst	#5,d0			; Check the checksum AGAIN in case we got here
(1)  222/     806 : 6730                		beq.s	MD_Init			; when it was already good.
(1)  223/     808 : 46FC 2700           		move.w	#$2700,sr		; Disable interrupts
(1)  224/     80C : 23FC C000 0000 00C0 		move.l	#$C0000000,(vdp_ctrl).l	; VDP: Point to Color 0
                    0004                
(1)  225/     816 : 33FC 0E00 00C0 0000 		move.w	#$0E00,(vdp_data).l	; Write blue
(1)  226/     81E : 60FE                		bra.s	*			; Infinite loop.
(1)  227/     820 :                     
(1)  228/     820 :                     ; ====================================================================
(1)  229/     820 :                     ; ----------------------------------------------------------------
(1)  230/     820 :                     ; 68k's Error handlers
(1)  231/     820 :                     ;
(1)  232/     820 :                     ; HBlank and VBlank jump to RAM instead.
(1)  233/     820 :                     ; ----------------------------------------------------------------
(1)  234/     820 :                     
(1)  235/     820 :                     MD_ErrBus:		; Bus error
(1)  236/     820 :                     MD_ErrAddr:		; Address error
(1)  237/     820 :                     MD_ErrIll:		; ILLEGAL Instruction
(1)  238/     820 :                     MD_ErrZDiv:		; Divide by 0
(1)  239/     820 :                     MD_ErrChk:		; CHK Instruction
(1)  240/     820 :                     MD_ErrTrapV:		; TRAPV Instruction
(1)  241/     820 :                     MD_ErrPrivl:		; Privilege violation
(1)  242/     820 :                     MD_Trace:		; Trace
(1)  243/     820 :                     MD_Line1010:		; Line 1010 Emulator
(1)  244/     820 :                     MD_Line1111:		; Line 1111 Emulator
(1)  245/     820 :                     MD_ErrorEx:		; Error exception
(1)  246/     820 :                     MD_ErrorTrap:
(1)  247/     820 : 46FC 2700           		move.w	#$2700,sr			; Disable interrupts
(1)  248/     824 : 23FC C000 0000 00C0 		move.l	#$C0000000,(vdp_ctrl).l
                    0004                
(1)  249/     82E : 33FC 000E 00C0 0000 		move.w	#$000E,(vdp_data).l
(1)  250/     836 : 60FE                		bra.s	*
(1)  251/     838 :                     
(1)  252/     838 :                     ; ====================================================================
(1)  253/     838 :                     ; ----------------------------------------------------------------
(1)  254/     838 :                     ; Init
(1)  255/     838 :                     ; ----------------------------------------------------------------
(1)  256/     838 :                     
(1)  257/     838 :                     MD_Init:
(1)  258/     838 : 46FC 2700           		move.w	#$2700,sr
(1)  259/     83C : 4A79 00C0 0004      		tst.w	(vdp_ctrl).l
(1)  260/     842 : 0800 000F           		btst	#15,d0
(1)  261/     846 : 6606                		bne.s	.hotstart
(1)  262/     848 : 4BF9 00A1 5100      		lea	(sysmars_reg).l,a5
(1)  263/     84E :                     ; .wm:		cmp.l	#"M_OK",comm0(a5)	; SH2 Master active?
(1)  264/     84E :                     ; 		bne.s	.wm
(1)  265/     84E :                     ; .ws:		cmp.l	#"S_OK",comm4(a5)	; SH2 Slave active?
(1)  266/     84E :                     ; 		bne.s	.ws
(1)  267/     84E :                     .hotstart:
(1)  268/     84E : 41F9 FFFF 0000      		lea	($FFFF0000),a0		; Cleanup our RAM
(1)  269/     854 : 223C FFFF B1B8      		move.l	#sizeof_mdram,d1
(1)  270/     85A : 7000                		moveq	#0,d0
(1)  271/     85C : 30C0                .loop_ram:	move.w	d0,(a0)+
(1)  272/     85E : B1C1                		cmp.l	d1,a0
(1)  273/     860 : 65FA                		bcs.s	.loop_ram
(1)  274/     862 : 4CF9 7FFF 00FF 0000 		movem.l	($FF0000),d0-a6		; Clear registers using zeros from RAM
(1)  275/     86A : 4BF9 00A1 5100      		lea	(sysmars_reg).l,a5
(1)  276/     870 : 4DF9 00C0 0004      		lea	(vdp_ctrl).l,a6
(1)  277/     876 : 3E16                .wait_dma:	move.w	(a6),d7			; Check if our DMA is active.
(1)  278/     878 : 0807 0001           		btst	#1,d7
(1)  279/     87C : 66F8                		bne.s	.wait_dma
(1)  280/     87E : 2CBC 8004 8104      		move.l	#$80048104,(a6)		; Default top VDP regs
(1)  281/     884 : 7000                		moveq	#0,d0			; Clear both Master and Slave comm's
(1)  282/     886 : 2B40 002C           		move.l	d0,comm12(a5)
(1)  283/     88A : 223C 0000 00FF      		move.l	#$FF,d1			; Small delay.
(1)  284/     890 :                     .wait_1:
(1)  285/     890 : 203C 0000 00FF      		move.l	#$FF,d0
(1)  286/     896 :                     .wait_2:
(1)  287/     896 : 4E71                		nop
(1)  288/     898 : 51C8 FFFC           		dbf	d0,.wait_2
(1)  289/     89C : 51C9 FFF2           		dbf	d1,.wait_1
(1)  290/     8A0 :                     
      13/     8A0 :                     
      14/     8A0 :                     ; ====================================================================
      15/     8A0 :                     ; ----------------------------------------------------------------
      16/     8A0 :                     ; Main
      17/     8A0 :                     ; ----------------------------------------------------------------
      18/     8A0 :                     
      19/     8A0 : 41F9 0088 08D4      		lea	(Md_TopCode+$880000),a0		; Transfer common 68K code
      20/     8A6 : 43F9 00FF 0000      		lea	($FF0000),a1			; at the top of RAM
      21/     8AC : 303C 170B           		move.w	#((Md_TopCode_e-Md_TopCode))-1,d0
      22/     8B0 :                     .copyme:
      23/     8B0 : 12D8                		move.b	(a0)+,(a1)+
      24/     8B2 : 51C8 FFFC           		dbf	d0,.copyme
      25/     8B6 : 4EB9 00FF 002C      		jsr	(Sound_init).l
      26/     8BC : 4EB9 00FF 0268      		jsr	(Video_init).l
      27/     8C2 : 4EB9 00FF 119C      		jsr	(System_Init).l
      28/     8C8 : 31FC 0001 AB5E      		move.w	#1,(RAM_Glbl_Scrn).w		; *** TEMPORAL ***
      29/     8CE : 4EF9 00FF 16E8      		jmp	(Md_ReadModes).l
      30/     8D4 :                     
      31/     8D4 :                     ; ====================================================================
      32/     8D4 :                     ; --------------------------------------------------------
      33/     8D4 :                     ; All shared routines at the top of RAM
      34/     8D4 :                     ; --------------------------------------------------------
      35/     8D4 :                     
      36/     8D4 :                     Md_TopCode:
      37/  FF0000 :                     		phase $FF0000
      38/  FF0000 :                     minfo_ram_s:
      39/  FF0000 :                     		include	"system/md/sound.asm"
(1)    1/  FF0000 :                     ; ====================================================================
(1)    2/  FF0000 :                     ; ----------------------------------------------------------------
(1)    3/  FF0000 :                     ; Genesis sound (GEMA Sound driver)
(1)    4/  FF0000 :                     ; ----------------------------------------------------------------
(1)    5/  FF0000 :                     
(1)    6/  FF0000 :                     ; ====================================================================
(1)    7/  FF0000 :                     ; ----------------------------------------------------------------
(1)    8/  FF0000 :                     ; Sound 68k RAM
(1)    9/  FF0000 :                     ; ----------------------------------------------------------------
(1)   10/  FF0000 :                     
(1)   11/  FF0000 : (MACRO)             		struct RAM_MdSound
(1)   11/  FF0000 : =$FF0000            GLBL_LASTPC     set *
(1)   11/     8D4 :                                     dephase
(1)   11/     8D4 : =$8D4               GLBL_LASTORG    set *
(1)   11/FFFFFFFFFFFF9800 :                                     phase RAM_MDSOUND
(1)   12/FFFFFFFFFFFF9800 :                     RAM_SndSaveReg	ds.l 8			; Backup registers
(1)   13/FFFFFFFFFFFF9820 :                     sizeof_mdsnd	ds.l 0
(1)   14/FFFFFFFFFFFF9820 : (MACRO)             		finish
(1)   14/FFFFFFFFFFFF9800 :                                     !org GLBL_LASTORG
(1)   14/  FF0000 :                                     phase GLBL_LASTPC
(1)   15/  FF0000 :                     
(1)   16/  FF0000 :                     ; ====================================================================
(1)   17/  FF0000 :                     ; --------------------------------------------------------
(1)   18/  FF0000 :                     ; Initialize Sound
(1)   19/  FF0000 :                     ;
(1)   20/  FF0000 :                     ; Uses:
(1)   21/  FF0000 :                     ; a0-a1,d0-d1
(1)   22/  FF0000 :                     ; --------------------------------------------------------
(1)   23/  FF0000 :                     
(1)   24/  FF0000 :                     		align $80
(1)   25/  FF002C :                     Sound_Init:
(1)   26/  FF002C : 46FC 2700           		move.w	#$2700,sr
(1)   27/  FF0030 : 33FC 0100 00A1 1100 		move.w	#$0100,(z80_bus).l		; Get Z80 bus
(1)   28/  FF0038 : 33FC 0100 00A1 1200 		move.w	#$0100,(z80_reset).l		; Z80 reset
(1)   29/  FF0040 :                     .wait:
(1)   30/  FF0040 : 0839 0000 00A1 1100 		btst	#0,(z80_bus).l
(1)   31/  FF0048 : 66F6                		bne.s	.wait
(1)   32/  FF004A : 41F9 00A0 0000      		lea	(z80_cpu).l,a0			; Clean entire Z80 area first
(1)   33/  FF0050 : 303C 1FFF           		move.w	#$1FFF,d0
(1)   34/  FF0054 : 7200                		moveq	#0,d1
(1)   35/  FF0056 :                     .cleanup:
(1)   36/  FF0056 : 10C1                		move.b	d1,(a0)+
(1)   37/  FF0058 : 51C8 FFFC           		dbf	d0,.cleanup
(1)   38/  FF005C : 41F9 0088 8760      		lea	(Z80_CODE).l,a0			; a0 - Z80 code (on $880000)
(1)   39/  FF0062 : 43F9 00A0 0000      		lea	(z80_cpu).l,a1			; a1 - Z80 CPU area
(1)   40/  FF0068 : 303C 1E65           		move.w	#(Z80_CODE_END-Z80_CODE)-1,d0	; d0 - Size
(1)   41/  FF006C :                     .copy:
(1)   42/  FF006C : 12D8                		move.b	(a0)+,(a1)+
(1)   43/  FF006E : 51C8 FFFC           		dbf	d0,.copy
(1)   44/  FF0072 : 33FC 0000 00A1 1200 		move.w	#0,(z80_reset).l		; Reset cancel
(1)   45/  FF007A : 4E71                		nop
(1)   46/  FF007C : 4E71                		nop
(1)   47/  FF007E : 4E71                		nop
(1)   48/  FF0080 : 4E71                		nop
(1)   49/  FF0082 : 33FC 0100 00A1 1200 		move.w	#$100,(z80_reset).l
(1)   50/  FF008A : 33FC 0000 00A1 1100 		move.w	#0,(z80_bus).l			; Start Z80
(1)   51/  FF0092 : 4E75                		rts
(1)   52/  FF0094 :                     
(1)   53/  FF0094 :                     ; ====================================================================
(1)   54/  FF0094 :                     ; ----------------------------------------------------------------
(1)   55/  FF0094 :                     ; Subroutines
(1)   56/  FF0094 :                     ; ----------------------------------------------------------------
(1)   57/  FF0094 :                     
(1)   58/  FF0094 :                     ; ------------------------------------------------
(1)   59/  FF0094 :                     ; Lock Z80, get bus
(1)   60/  FF0094 :                     ; ------------------------------------------------
(1)   61/  FF0094 :                     
(1)   62/  FF0094 :                     sndLockZ80:
(1)   63/  FF0094 : 33FC 0100 00A1 1100 		move.w	#$0100,(z80_bus).l
(1)   64/  FF009C :                     .wait:
(1)   65/  FF009C : 0839 0000 00A1 1100 		btst	#0,(z80_bus).l
(1)   66/  FF00A4 : 66F6                		bne.s	.wait
(1)   67/  FF00A6 : 4E75                		rts
(1)   68/  FF00A8 :                     
(1)   69/  FF00A8 :                     ; ------------------------------------------------
(1)   70/  FF00A8 :                     ; Unlock Z80, return bus
(1)   71/  FF00A8 :                     ; ------------------------------------------------
(1)   72/  FF00A8 :                     
(1)   73/  FF00A8 :                     sndUnlockZ80:
(1)   74/  FF00A8 : 33FC 0000 00A1 1100 		move.w	#0,(z80_bus).l
(1)   75/  FF00B0 : 4E75                		rts
(1)   76/  FF00B2 :                     
(1)   77/  FF00B2 :                     ; ------------------------------------------------
(1)   78/  FF00B2 :                     ; 68k-to-z80 Sound request
(1)   79/  FF00B2 :                     ; enter/exit routines
(1)   80/  FF00B2 :                     ;
(1)   81/  FF00B2 :                     ; d6 - commFifo index
(1)   82/  FF00B2 :                     ; ------------------------------------------------
(1)   83/  FF00B2 :                     
(1)   84/  FF00B2 :                     sndReq_Enter:
(1)   85/  FF00B2 : 48F9 60C0 FFFF 9800 		movem.l	d6-d7/a5-a6,(RAM_SndSaveReg).l	; <-- stack didn't work this time
(1)   86/  FF00BA : 7C00                		moveq	#0,d6
(1)   87/  FF00BC : 33FC 0100 00A1 1100 		move.w	#$0100,(z80_bus).l		; Request Z80 Stop
(1)   88/  FF00C4 : 40C6                		move.w	sr,d6
(1)   89/  FF00C6 : 4846                		swap	d6
(1)   90/  FF00C8 : 007C 0700           		or.w	#$0700,sr			; disable ints
(1)   91/  FF00CC : 4BF9 00A0 001F      		lea	(z80_cpu+commZWrite),a5		; a5 - commZWrite
(1)   92/  FF00D2 : 4DF9 00A0 1E00      		lea	(z80_cpu+commZfifo),a6		; a6 - fifo command list
(1)   93/  FF00D8 :                     .wait:
(1)   94/  FF00D8 : 0839 0000 00A1 1100 		btst	#0,(z80_bus).l			; Wait for Z80
(1)   95/  FF00E0 : 66F6                		bne.s	.wait
(1)   96/  FF00E2 : 1C15                		move.b	(a5),d6				; d6 - index fifo position
(1)   97/  FF00E4 : 4886                		ext.w	d6				; extend to 16 bits
(1)   98/  FF00E6 : 4E75                		rts
(1)   99/  FF00E8 :                     ; JUMP ONLY
(1)  100/  FF00E8 :                     sndReq_Exit:
(1)  101/  FF00E8 : 33FC 0000 00A1 1100 		move.w	#0,(z80_bus).l
(1)  102/  FF00F0 : 4846                		swap	d6
(1)  103/  FF00F2 : 46C6                		move.w	d6,sr
(1)  104/  FF00F4 : 4CF9 60C0 FFFF 9800 		movem.l	(RAM_SndSaveReg).l,d6-d7/a5-a6
(1)  105/  FF00FC : 4E75                		rts
(1)  106/  FF00FE :                     
(1)  107/  FF00FE :                     ; ------------------------------------------------
(1)  108/  FF00FE :                     ; Send request id and arguments
(1)  109/  FF00FE :                     ;
(1)  110/  FF00FE :                     ; Input:
(1)  111/  FF00FE :                     ; d7 - byte to write
(1)  112/  FF00FE :                     ; d6 - index pointer
(1)  113/  FF00FE :                     ; a5 - commZWrite, update index
(1)  114/  FF00FE :                     ; a6 - commZfifo command list
(1)  115/  FF00FE :                     ;
(1)  116/  FF00FE :                     ; *** CALL sndReq_Enter FIRST ***
(1)  117/  FF00FE :                     ; ------------------------------------------------
(1)  118/  FF00FE :                     
(1)  119/  FF00FE :                     sndReq_scmd:
(1)  120/  FF00FE : 1DBC 00FF 6000      		move.b	#-1,(a6,d6.w)			; write command-start flag
(1)  121/  FF0104 : 5206                		addq.b	#1,d6				; next fifo pos
(1)  122/  FF0106 : 0206 003F           		andi.b	#$3F,d6
(1)  123/  FF010A : 600C                		bra.s	sndReq_sbyte
(1)  124/  FF010C :                     sndReq_slong:
(1)  125/  FF010C : 610A                		bsr	sndReq_sbyte
(1)  126/  FF010E : E09F                		ror.l	#8,d7
(1)  127/  FF0110 :                     sndReq_saddr:
(1)  128/  FF0110 : 6106                		bsr	sndReq_sbyte
(1)  129/  FF0112 : E09F                		ror.l	#8,d7
(1)  130/  FF0114 :                     sndReq_sword:
(1)  131/  FF0114 : 6102                		bsr	sndReq_sbyte
(1)  132/  FF0116 : E09F                		ror.l	#8,d7
(1)  133/  FF0118 :                     sndReq_sbyte:
(1)  134/  FF0118 : 1D87 6000           		move.b	d7,(a6,d6.w)			; write byte
(1)  135/  FF011C : 5206                		addq.b	#1,d6				; next fifo pos
(1)  136/  FF011E : 0206 003F           		andi.b	#$3F,d6
(1)  137/  FF0122 : 1A86                		move.b	d6,(a5)				; update commZWrite
(1)  138/  FF0124 : 4E75                		rts
(1)  139/  FF0126 :                     
(1)  140/  FF0126 :                     ; ------------------------------------------------
(1)  141/  FF0126 :                     ; Make CMD request
(1)  142/  FF0126 :                     ;
(1)  143/  FF0126 :                     ; d6 - command
(1)  144/  FF0126 :                     ; ------------------------------------------------
(1)  145/  FF0126 :                     
(1)  146/  FF0126 :                     sndReqCmd:
(1)  147/  FF0126 : 1E39 00A1 512E      .wait_in:	move.b	(sysmars_reg+comm14),d7
(1)  148/  FF012C : CE7C 00F0           		and.w	#%11110000,d7
(1)  149/  FF0130 : 66F4                		bne.s	.wait_in
(1)  150/  FF0132 : CC7C 000F           		and.w	#%00001111,d6
(1)  151/  FF0136 : 8E06                		or.b	d6,d7
(1)  152/  FF0138 : 13C7 00A1 512E      		move.b	d7,(sysmars_reg+comm14).l
(1)  153/  FF013E : 1E39 00A1 512E      		move.b	(sysmars_reg+comm14).l,d7
(1)  154/  FF0144 : CE7C 000F           		and.w	#%00001111,d7
(1)  155/  FF0148 : BE06                		cmp.b	d6,d7
(1)  156/  FF014A : 66DA                		bne.s	.wait_in
(1)  157/  FF014C : 08F9 0007 00A1 512E 		bset	#7,(sysmars_reg+comm14).l
(1)  158/  FF0154 : 08F9 0001 00A1 5103 		bset	#1,(sysmars_reg+standby).l	; Request Slave CMD
(1)  159/  FF015C :                     ; .wait_cmd:	btst	#1,(sysmars_reg+standby).l
(1)  160/  FF015C :                     ; 		bne.s	.wait_cmd
(1)  161/  FF015C : 1E39 00A1 512E      .wait_out:	move.b	(sysmars_reg+comm14),d7
(1)  162/  FF0162 : CE7C 00F0           		and.w	#%11110000,d7
(1)  163/  FF0166 : 66F4                		bne.s	.wait_out
(1)  164/  FF0168 : 4E75                		rts
(1)  165/  FF016A :                     
(1)  166/  FF016A :                     ; --------------------------------------------------------
(1)  167/  FF016A :                     ; Sound_DMA_Pause
(1)  168/  FF016A :                     ;
(1)  169/  FF016A :                     ; Call this BEFORE making any DMA task
(1)  170/  FF016A :                     ;
(1)  171/  FF016A :                     ; Uses:
(1)  172/  FF016A :                     ; d6,d7
(1)  173/  FF016A :                     ; --------------------------------------------------------
(1)  174/  FF016A :                     
(1)  175/  FF016A :                     Sound_DMA_Pause:
(1)  176/  FF016A : 4847                		swap	d7
(1)  177/  FF016C : 4846                		swap	d6
(1)  178/  FF016E :                     .retry:
(1)  179/  FF016E : 6100 FF24           		bsr	sndLockZ80
(1)  180/  FF0172 : 1E39 00A0 001D      		move.b	(z80_cpu+commZRomRd),d7		; Get mid-read bit
(1)  181/  FF0178 : 6100 FF2E           		bsr	sndUnlockZ80
(1)  182/  FF017C : 4A07                		tst.b	d7
(1)  183/  FF017E : 6708                		beq.s	.safe
(1)  184/  FF0180 : 7E44                		moveq	#68,d7
(1)  185/  FF0182 : 51CF FFFE           		dbf	d7,*
(1)  186/  FF0186 : 60E6                		bra.s	.retry
(1)  187/  FF0188 :                     .safe:
(1)  188/  FF0188 : 6100 FF0A           		bsr	sndLockZ80
(1)  189/  FF018C : 13FC 0001 00A0 001C 		move.b	#1,(z80_cpu+commZRomBlk)	; Block flag for Z80
(1)  190/  FF0194 : 6100 FF12           		bsr	sndUnlockZ80
(1)  191/  FF0198 : 3C3C 0002           		move.w	#2,d6
(1)  192/  FF019C : 6188                		bsr	sndReqCmd
(1)  193/  FF019E : 4846                		swap	d6
(1)  194/  FF01A0 : 4847                		swap	d7
(1)  195/  FF01A2 : 4E75                		rts
(1)  196/  FF01A4 :                     
(1)  197/  FF01A4 :                     ; --------------------------------------------------------
(1)  198/  FF01A4 :                     ; Sound_DMA_Resume
(1)  199/  FF01A4 :                     ;
(1)  200/  FF01A4 :                     ; Call this AFTER finishing DMA
(1)  201/  FF01A4 :                     ; --------------------------------------------------------
(1)  202/  FF01A4 :                     
(1)  203/  FF01A4 :                     Sound_DMA_Resume:
(1)  204/  FF01A4 : 4847                		swap	d7
(1)  205/  FF01A6 : 4846                		swap	d6
(1)  206/  FF01A8 : 6100 FEEA           		bsr	sndLockZ80
(1)  207/  FF01AC : 13FC 0000 00A0 001C 		move.b	#0,(z80_cpu+commZRomBlk)
(1)  208/  FF01B4 : 6100 FEF2           		bsr	sndUnlockZ80
(1)  209/  FF01B8 : 3C3C 0003           		move.w	#3,d6
(1)  210/  FF01BC : 6100 FF68           		bsr	sndReqCmd
(1)  211/  FF01C0 : 4846                		swap	d6
(1)  212/  FF01C2 : 4847                		swap	d7
(1)  213/  FF01C4 : 4E75                		rts
(1)  214/  FF01C6 :                     
(1)  215/  FF01C6 :                     ; --------------------------------------------------------
(1)  216/  FF01C6 :                     ; SoundReq_SetTrack
(1)  217/  FF01C6 :                     ;
(1)  218/  FF01C6 :                     ; a0 | Pointer to Pattern, Blocks and Instruments list
(1)  219/  FF01C6 :                     ;      in this order:
(1)  220/  FF01C6 :                     ;  	dc.l pattern_data
(1)  221/  FF01C6 :                     ;  	dc.l block_data
(1)  222/  FF01C6 :                     ;  	dc.l instrument_data
(1)  223/  FF01C6 :                     ;  	(Pointers should be in the
(1)  224/  FF01C6 :                     ;  	$880000/$900000 areas)
(1)  225/  FF01C6 :                     ;
(1)  226/  FF01C6 :                     ; d0 | BYTE - Track slot
(1)  227/  FF01C6 :                     ; d1 | BYTE - Ticks
(1)  228/  FF01C6 :                     ; d2 | BYTE - Start from this block position
(1)  229/  FF01C6 :                     ; d3 | BYTE - Flags: %00004321
(1)  230/  FF01C6 :                     ; 	      4321 - Use global tempos: 1,2,3 or 4
(1)  231/  FF01C6 :                     ;
(1)  232/  FF01C6 :                     ; Breaks:
(1)  233/  FF01C6 :                     ; d6-d7,a5-a6
(1)  234/  FF01C6 :                     ; --------------------------------------------------------
(1)  235/  FF01C6 :                     
(1)  236/  FF01C6 :                     ; ***
(1)  237/  FF01C6 :                     Sound_TrkPlay:
(1)  238/  FF01C6 : 6100 FEEA           		bsr	sndReq_Enter
(1)  239/  FF01CA : 3E3C 0000           		move.w	#$00,d7		; Command $00
(1)  240/  FF01CE : 6100 FF2E           		bsr	sndReq_scmd
(1)  241/  FF01D2 : 1E00                		move.b	d0,d7		; d0 - Slot
(1)  242/  FF01D4 : 6100 FF42           		bsr	sndReq_sbyte
(1)  243/  FF01D8 : 1E01                		move.b	d1,d7		; d1 - Ticks
(1)  244/  FF01DA : 6100 FF3C           		bsr	sndReq_sbyte
(1)  245/  FF01DE : 1E02                		move.b	d2,d7		; d2 - Start block
(1)  246/  FF01E0 : 6100 FF36           		bsr	sndReq_sbyte
(1)  247/  FF01E4 : 1E03                		move.b	d3,d7		; d3 - Flags (%321 enable these timers)
(1)  248/  FF01E6 : CE7C 0007           		and.w	#%111,d7
(1)  249/  FF01EA : 6100 FF2C           		bsr	sndReq_sbyte
(1)  250/  FF01EE : 2E18                		move.l	(a0)+,d7	; Patt data point
(1)  251/  FF01F0 : 6100 FF1E           		bsr	sndReq_saddr
(1)  252/  FF01F4 : 2E18                		move.l	(a0)+,d7	; Block data point
(1)  253/  FF01F6 : 6100 FF18           		bsr	sndReq_saddr
(1)  254/  FF01FA : 2E18                		move.l	(a0)+,d7	; Intrument data
(1)  255/  FF01FC : 6100 FF12           		bsr	sndReq_saddr
(1)  256/  FF0200 : 6000 FEE6           		bra 	sndReq_Exit
(1)  257/  FF0204 :                     
(1)  258/  FF0204 :                     ; --------------------------------------------------------
(1)  259/  FF0204 :                     ; Sound_TrkStop (and pause)
(1)  260/  FF0204 :                     ;
(1)  261/  FF0204 :                     ; Stops OR Pauses current track
(1)  262/  FF0204 :                     ;
(1)  263/  FF0204 :                     ; Input:
(1)  264/  FF0204 :                     ; d0 | BYTE - Track slot
(1)  265/  FF0204 :                     ;
(1)  266/  FF0204 :                     ; Breaks:
(1)  267/  FF0204 :                     ; d6-d7,a5-a6
(1)  268/  FF0204 :                     ; --------------------------------------------------------
(1)  269/  FF0204 :                     
(1)  270/  FF0204 :                     Sound_TrkStop:
(1)  271/  FF0204 : 6100 FEAC           		bsr	sndReq_Enter
(1)  272/  FF0208 : 3E3C 0001           		move.w	#$01,d7		; Command $01
(1)  273/  FF020C : 6100 FEF0           		bsr	sndReq_scmd
(1)  274/  FF0210 : 1E00                		move.b	d0,d7		; d0 - Slot
(1)  275/  FF0212 : 6100 FF04           		bsr	sndReq_sbyte
(1)  276/  FF0216 : 6000 FED0           		bra 	sndReq_Exit
(1)  277/  FF021A :                     
(1)  278/  FF021A :                     ; --------------------------------------------------------
(1)  279/  FF021A :                     ; Sound_TrkResume
(1)  280/  FF021A :                     ;
(1)  281/  FF021A :                     ; Resumes Stopped/Paused track
(1)  282/  FF021A :                     ;
(1)  283/  FF021A :                     ; Input:
(1)  284/  FF021A :                     ; d0 | BYTE - Track slot
(1)  285/  FF021A :                     ;
(1)  286/  FF021A :                     ; Breaks:
(1)  287/  FF021A :                     ; d6-d7,a5-a6
(1)  288/  FF021A :                     ; --------------------------------------------------------
(1)  289/  FF021A :                     
(1)  290/  FF021A :                     Sound_TrkResume:
(1)  291/  FF021A : 6100 FE96           		bsr	sndReq_Enter
(1)  292/  FF021E : 3E3C 0002           		move.w	#$02,d7		; Command $01
(1)  293/  FF0222 : 6100 FEDA           		bsr	sndReq_scmd
(1)  294/  FF0226 : 1E00                		move.b	d0,d7		; d0 - Slot
(1)  295/  FF0228 : 6100 FEEE           		bsr	sndReq_sbyte
(1)  296/  FF022C : 6000 FEBA           		bra 	sndReq_Exit
(1)  297/  FF0230 :                     
(1)  298/  FF0230 :                     ; --------------------------------------------------------
(1)  299/  FF0230 :                     ; Sound_TrkTicks
(1)  300/  FF0230 :                     ;
(1)  301/  FF0230 :                     ; Set ticks for the current track
(1)  302/  FF0230 :                     ; (NTSC: 150/tick, PAL: 120/tick)
(1)  303/  FF0230 :                     ;
(1)  304/  FF0230 :                     ; Input:
(1)  305/  FF0230 :                     ; d0 | BYTE - Track slot
(1)  306/  FF0230 :                     ; d1 | BYTE - Ticks
(1)  307/  FF0230 :                     ;
(1)  308/  FF0230 :                     ; Breaks:
(1)  309/  FF0230 :                     ; d6-d7,a5-a6
(1)  310/  FF0230 :                     ; --------------------------------------------------------
(1)  311/  FF0230 :                     
(1)  312/  FF0230 :                     Sound_TrkTicks:
(1)  313/  FF0230 : 6100 FE80           		bsr	sndReq_Enter
(1)  314/  FF0234 : 3E3C 0008           		move.w	#$08,d7		; Command $08
(1)  315/  FF0238 : 6100 FEC4           		bsr	sndReq_scmd
(1)  316/  FF023C : 1E00                		move.b	d0,d7		; d0 - Slot
(1)  317/  FF023E : 6100 FED8           		bsr	sndReq_sbyte
(1)  318/  FF0242 : 1E01                		move.b	d1,d7		; d1 - Ticks
(1)  319/  FF0244 : 6100 FED2           		bsr	sndReq_sbyte
(1)  320/  FF0248 : 6000 FE9E           		bra 	sndReq_Exit
(1)  321/  FF024C :                     
(1)  322/  FF024C :                     ; --------------------------------------------------------
(1)  323/  FF024C :                     ; Sound_GlbBeats
(1)  324/  FF024C :                     ;
(1)  325/  FF024C :                     ; Set GLOBAL Sub-beats (different from a tempo...)
(1)  326/  FF024C :                     ;
(1)  327/  FF024C :                     ; Input:
(1)  328/  FF024C :                     ; d0 | BYTE - Track slot
(1)  329/  FF024C :                     ; d1 | WORD - Ticks
(1)  330/  FF024C :                     ;
(1)  331/  FF024C :                     ; Breaks:
(1)  332/  FF024C :                     ; d6-d7,a5-a6
(1)  333/  FF024C :                     ; --------------------------------------------------------
(1)  334/  FF024C :                     
(1)  335/  FF024C :                     Sound_GlbBeats:
(1)  336/  FF024C : 6100 FE64           		bsr	sndReq_Enter
(1)  337/  FF0250 : 3E3C 0010           		move.w	#$10,d7		; Command $10
(1)  338/  FF0254 : 6100 FEA8           		bsr	sndReq_scmd
(1)  339/  FF0258 : 1E00                		move.b	d0,d7		; d0 - Slot
(1)  340/  FF025A : 6100 FEBC           		bsr	sndReq_sbyte
(1)  341/  FF025E : 3E01                		move.w	d1,d7		; d1 - Subbeats
(1)  342/  FF0260 : 6100 FEB2           		bsr	sndReq_sword
(1)  343/  FF0264 : 6000 FE82           		bra 	sndReq_Exit
(1)  344/  FF0268 :                     
(1)  345/  FF0268 :                     ; --------------------------------------------------------
(1)  346/  FF0268 :                     
(1)  347/  FF0268 :                     ; Z80 code is located on the $880000 area
(1)  348/  FF0268 :                     
(1)  349/  FF0268 :                     
      40/  FF0268 :                     		include	"system/md/video.asm"
(1)    1/  FF0268 :                     ; ====================================================================
(1)    2/  FF0268 :                     ; ----------------------------------------------------------------
(1)    3/  FF0268 :                     ; Genesis Video
(1)    4/  FF0268 :                     ; ----------------------------------------------------------------
(1)    5/  FF0268 :                     
(1)    6/  FF0268 : =$FFFFFFFFFF..      RAM_BgBufferM	equ	RAM_MdDreq+Dreq_BgExBuff	; Relocate MARS layer control
(1)    7/  FF0268 :                     
(1)    8/  FF0268 :                     ; ====================================================================
(1)    9/  FF0268 :                     ; --------------------------------------------------------
(1)   10/  FF0268 :                     ; Settings
(1)   11/  FF0268 :                     ; --------------------------------------------------------
(1)   12/  FF0268 :                     
(1)   13/  FF0268 : =$7FF               varNullVram	equ $7FF	; Default Blank cell for some video routines
(1)   14/  FF0268 : =$580               varPrintVram	equ $580	; Location of the PRINT text graphics
(1)   15/  FF0268 : =$3                 varPrintPal	equ 3		; Palette to use for the printable text
(1)   16/  FF0268 :                     
(1)   17/  FF0268 :                     ; --------------------------------------------------------
(1)   18/  FF0268 :                     ; Variables
(1)   19/  FF0268 :                     ; --------------------------------------------------------
(1)   20/  FF0268 :                     
(1)   21/  FF0268 :                     ; VDP Register $80
(1)   22/  FF0268 : =$2                 HVStop		equ $02
(1)   23/  FF0268 : =$10                HintEnbl	equ $10
(1)   24/  FF0268 : =$1                 bitHVStop	equ 1
(1)   25/  FF0268 : =$4                 bitHintEnbl	equ 4
(1)   26/  FF0268 :                     
(1)   27/  FF0268 :                     ; VDP Register $81
(1)   28/  FF0268 : =$40                DispEnbl 	equ $40
(1)   29/  FF0268 : =$20                VintEnbl 	equ $20
(1)   30/  FF0268 : =$10                DmaEnbl		equ $10
(1)   31/  FF0268 : =$6                 bitDispEnbl	equ 6
(1)   32/  FF0268 : =$5                 bitVintEnbl	equ 5
(1)   33/  FF0268 : =$4                 bitDmaEnbl	equ 4
(1)   34/  FF0268 : =$3                 bitV30		equ 3
(1)   35/  FF0268 :                     
(1)   36/  FF0268 :                     ; vdp_ctrl READ bits (full WORD)
(1)   37/  FF0268 : =$9                 bitFifoE	equ 9		; DMA FIFO empty
(1)   38/  FF0268 : =$8                 bitFifoF	equ 8		; DMA FIFO full
(1)   39/  FF0268 : =$7                 bitVInt		equ 7		; Vertical interrupt
(1)   40/  FF0268 : =$6                 bitSprOvr	equ 6		; Sprite overflow
(1)   41/  FF0268 : =$5                 bitSprCol	equ 5		; Sprite collision
(1)   42/  FF0268 : =$4                 bitOdd		equ 4		; EVEN or ODD frame displayed on interlace mode
(1)   43/  FF0268 : =$3                 bitVBlk		equ 3		; Inside VBlank
(1)   44/  FF0268 : =$2                 bitHBlk		equ 2		; Inside HBlank
(1)   45/  FF0268 : =$1                 bitDma		equ 1		; Only works for FILL and COPY
(1)   46/  FF0268 : =$0                 bitPal		equ 0
(1)   47/  FF0268 :                     
(1)   48/  FF0268 :                     ; md_bg_flags
(1)   49/  FF0268 : =$0                 bitDrwR		equ 0
(1)   50/  FF0268 : =$1                 bitDrwL		equ 1
(1)   51/  FF0268 : =$2                 bitDrwD		equ 2
(1)   52/  FF0268 : =$3                 bitDrwU		equ 3
(1)   53/  FF0268 : =$7                 bitBgOn		equ 7
(1)   54/  FF0268 : =$6                 bitMarsBg	equ 6
(1)   55/  FF0268 :                     
(1)   56/  FF0268 :                     ; ====================================================================
(1)   57/  FF0268 :                     ; ----------------------------------------------------------------
(1)   58/  FF0268 :                     ; Structs
(1)   59/  FF0268 :                     ; ----------------------------------------------------------------
(1)   60/  FF0268 :                     
(1)   61/  FF0268 :                     ; IN SH2 ORDER
(1)   62/  FF0268 :                     ; still works fine on this side.
(1)   63/  FF0268 :                     
(1)   64/  FF0268 : (MACRO)             		struct 0
(1)   64/  FF0268 : =$FF0268            GLBL_LASTPC     set *
(1)   64/     B3C :                                     dephase
(1)   64/     B3C : =$B3C               GLBL_LASTORG    set *
(1)   64/       0 :                                     phase 0
(1)   65/       0 :                     md_bg_bw	ds.b 1		; Block Width
(1)   66/       1 :                     md_bg_bh	ds.b 1		; Block Height
(1)   67/       2 :                     md_bg_blkw	ds.b 1		; Bitshift block size (LSL)
(1)   68/       3 :                     md_bg_flags	ds.b 1		; Drawing flags: %EM00UDLR
(1)   69/       4 :                     md_bg_xset	ds.b 1		; X-counter
(1)   70/       5 :                     md_bg_yset	ds.b 1		; Y-counter
(1)   71/       6 :                     md_bg_movex	ds.b 1		; *** ALIGNMENT, FREE TO USE
(1)   72/       7 :                     md_bg_movey	ds.b 1		; ***
(1)   73/       8 :                     md_bg_w		ds.w 1		; Width in blocks
(1)   74/       A :                     md_bg_h		ds.w 1		; Height in blocks
(1)   75/       C :                     md_bg_wf	ds.w 1		; FULL Width in pixels
(1)   76/       E :                     md_bg_hf	ds.w 1		; FULL Height in pixels
(1)   77/      10 :                     md_bg_xinc_l	ds.w 1		; Layout draw-beams L/R/U/D
(1)   78/      12 :                     md_bg_xinc_r	ds.w 1
(1)   79/      14 :                     md_bg_yinc_u	ds.w 1
(1)   80/      16 :                     md_bg_yinc_d	ds.w 1
(1)   81/      18 :                     md_bg_x_old	ds.w 1		; OLD X position
(1)   82/      1A :                     md_bg_y_old	ds.w 1		; OLD Y position
(1)   83/      1C :                     md_bg_vpos	ds.w 1		; VRAM output for map
(1)   84/      1E :                     md_bg_vram	ds.w 1		; VRAM start for cells
(1)   85/      20 :                     md_bg_low	ds.l 1		; MAIN layout data
(1)   86/      24 :                     md_bg_hi	ds.l 1		; HI layout data
(1)   87/      28 :                     md_bg_blk	ds.l 1		; Block data
(1)   88/      2C :                     md_bg_col	ds.l 1		; Collision data (if needed)
(1)   89/      30 :                     md_bg_x		ds.l 1		; X pos 0000.0000
(1)   90/      34 :                     md_bg_y		ds.l 1		; Y pos 0000.0000
(1)   91/      38 :                     sizeof_mdbg	ds.l 0
(1)   92/      38 : (MACRO)             		finish
(1)   92/       0 :                                     !org GLBL_LASTORG
(1)   92/  FF0268 :                                     phase GLBL_LASTPC
(1)   93/  FF0268 :                     
(1)   94/  FF0268 :                     ; md_bg_flags: %EM..UDLR
(1)   95/  FF0268 :                     ; UDLR - off-screen update bits
(1)   96/  FF0268 :                     ;    M - Map belongs to Genesis or 32X
(1)   97/  FF0268 :                     ;    E - Enable this map
(1)   98/  FF0268 :                     
(1)   99/  FF0268 :                     ; ====================================================================
(1)  100/  FF0268 :                     ; ----------------------------------------------------------------
(1)  101/  FF0268 :                     ; Video RAM
(1)  102/  FF0268 :                     ; ----------------------------------------------------------------
(1)  103/  FF0268 :                     
(1)  104/  FF0268 : (MACRO)             			struct RAM_MdVideo
(1)  104/  FF0268 : =$FF0268            GLBL_LASTPC     set *
(1)  104/     B3C :                                     dephase
(1)  104/     B3C : =$B3C               GLBL_LASTORG    set *
(1)  104/FFFFFFFFFFFF9820 :                                     phase RAM_MDVIDEO
(1)  105/FFFFFFFFFFFF9820 :                     RAM_BgBuffer		ds.b sizeof_mdbg*4	; Map backgrounds, back to front.
(1)  106/FFFFFFFFFFFF9900 :                     RAM_FrameCount		ds.l 1			; Frames counter
(1)  107/FFFFFFFFFFFF9904 :                     RAM_HorScroll		ds.l 240		; DMA Horizontal scroll data
(1)  108/FFFFFFFFFFFF9CC4 :                     RAM_VerScroll		ds.l 320/16		; DMA Vertical scroll data
(1)  109/FFFFFFFFFFFF9D14 :                     RAM_Sprites		ds.w 8*70		; DMA Sprites
(1)  110/FFFFFFFFFFFFA174 :                     RAM_Palette		ds.w 64			; DMA palette
(1)  111/FFFFFFFFFFFFA1F4 :                     RAM_PaletteFd		ds.w 64			; Target MD palette for FadeIn/Out
(1)  112/FFFFFFFFFFFFA274 :                     RAM_MdMarsPalFd		ds.w 256		; Target 32X palette for FadeIn/Out (NOTE: it's slow)
(1)  113/FFFFFFFFFFFFA474 :                     RAM_VdpDmaList		ds.w 7*MAX_MDDMATSK	; DMA BLAST list for VBlank
(1)  114/FFFFFFFFFFFFA554 :                     RAM_VidPrntList		ds.w 3*64		; Video_Print list: Address, Type
(1)  115/FFFFFFFFFFFFA6D4 :                     RAM_VdpDmaIndx		ds.w 1			; Current index in DMA BLAST list
(1)  116/FFFFFFFFFFFFA6D6 :                     RAM_VdpDmaMod		ds.w 1			; Mid-write flag (just to be safe)
(1)  117/FFFFFFFFFFFFA6D8 :                     RAM_VidPrntVram		ds.w 1			; Default VRAM location for ASCII text used by Video_Print
(1)  118/FFFFFFFFFFFFA6DA :                     RAM_FadeMdReq		ds.w 1			; FadeIn/Out request for Genesis palette (01-FadeIn 02-FadeOut)
(1)  119/FFFFFFFFFFFFA6DC :                     RAM_FadeMdIncr		ds.w 1			; Fading increment count
(1)  120/FFFFFFFFFFFFA6DE :                     RAM_FadeMdDelay		ds.w 1			; Fading delay
(1)  121/FFFFFFFFFFFFA6E0 :                     RAM_FadeMdTmr		ds.w 1			; Fading delay timer
(1)  122/FFFFFFFFFFFFA6E2 :                     RAM_FadeMarsReq		ds.w 1			; Same thing but for 32X's 256-color (01-FadeIn 02-FadeOut)
(1)  123/FFFFFFFFFFFFA6E4 :                     RAM_FadeMarsIncr	ds.w 1			; (Hint: Set to 4 to syncronize with Genesis' FadeIn/Out)
(1)  124/FFFFFFFFFFFFA6E6 :                     RAM_FadeMarsDelay	ds.w 1
(1)  125/FFFFFFFFFFFFA6E8 :                     RAM_FadeMarsTmr		ds.w 1
(1)  126/FFFFFFFFFFFFA6EA :                     RAM_VdpRegs		ds.b 24			; VDP Register cache
(1)  127/FFFFFFFFFFFFA702 :                     sizeof_mdvid		ds.l 0
(1)  128/FFFFFFFFFFFFA704 : (MACRO)             			finish
(1)  128/FFFFFFFFFFFF9820 :                                     !org GLBL_LASTORG
(1)  128/  FF0268 :                                     phase GLBL_LASTPC
(1)  129/  FF0268 :                     
(1)  130/  FF0268 :                     ; ====================================================================
(1)  131/  FF0268 :                     ; --------------------------------------------------------
(1)  132/  FF0268 :                     ; Init Genesis video
(1)  133/  FF0268 :                     ; --------------------------------------------------------
(1)  134/  FF0268 :                     
(1)  135/  FF0268 :                     Video_Init:		
(1)  136/  FF0268 : 4DF8 9820           		lea	(RAM_MdVideo),a6	; Clear RAM
(1)  137/  FF026C : 7C00                		moveq	#0,d6
(1)  138/  FF026E : 3E3C 0EE1           		move.w	#(sizeof_mdvid-RAM_MdVideo)-1,d7
(1)  139/  FF0272 :                     .clrram:
(1)  140/  FF0272 : 1CC6                		move.b	d6,(a6)+
(1)  141/  FF0274 : 51CF FFFC           		dbf	d7,.clrram
(1)  142/  FF0278 : 4DFA 0042           		lea	list_vdpregs(pc),a6
(1)  143/  FF027C : 4BF8 A6EA           		lea	(RAM_VdpRegs).w,a5
(1)  144/  FF0280 : 49F9 00C0 0004      		lea	(vdp_ctrl),a4
(1)  145/  FF0286 : 3C3C 8000           		move.w	#$8000,d6
(1)  146/  FF028A : 3E3C 0012           		move.w	#19-1,d7
(1)  147/  FF028E :                     .loop:
(1)  148/  FF028E : 1C1E                		move.b	(a6)+,d6
(1)  149/  FF0290 : 1AC6                		move.b	d6,(a5)+
(1)  150/  FF0292 : 3886                		move.w	d6,(a4)
(1)  151/  FF0294 : DC7C 0100           		add.w	#$100,d6
(1)  152/  FF0298 : 51CF FFF4           		dbf	d7,.loop
(1)  153/  FF029C :                     .exit:
(1)  154/  FF029C :                     
(1)  155/  FF029C :                     ; --------------------------------------------------------
(1)  156/  FF029C :                     ; Video_Update
(1)  157/  FF029C :                     ;
(1)  158/  FF029C :                     ; Writes register data stored in RAM to VDP
(1)  159/  FF029C :                     ; from Registers $80 to $90, WINDOW registers
(1)  160/  FF029C :                     ; $91 and $92 can be written manually.
(1)  161/  FF029C :                     ;
(1)  162/  FF029C :                     ; Breaks:
(1)  163/  FF029C :                     ; d6-d7,a5-a6
(1)  164/  FF029C :                     ; --------------------------------------------------------
(1)  165/  FF029C :                     
(1)  166/  FF029C :                     Video_Update:
(1)  167/  FF029C : 4DF8 A6EA           		lea	(RAM_VdpRegs).w,a6
(1)  168/  FF02A0 : 4BF9 00C0 0004      		lea	(vdp_ctrl),a5
(1)  169/  FF02A6 : 3C3C 8000           		move.w	#$8000,d6
(1)  170/  FF02AA : 3E3C 0010           		move.w	#17-1,d7
(1)  171/  FF02AE :                     .loop:
(1)  172/  FF02AE : 1C1E                		move.b	(a6)+,d6
(1)  173/  FF02B0 : 3A86                		move.w	d6,(a5)
(1)  174/  FF02B2 : DC7C 0100           		add.w	#$100,d6
(1)  175/  FF02B6 : 51CF FFF6           		dbf	d7,.loop
(1)  176/  FF02BA :                     .exit:
(1)  177/  FF02BA : 4E75                		rts
(1)  178/  FF02BC :                     
(1)  179/  FF02BC :                     ; --------------------------------------------------------
(1)  180/  FF02BC :                     
(1)  181/  FF02BC :                     list_vdpregs:
(1)  182/  FF02BC : 04                  		dc.b $04			; No HBlank interrupt, HV Counter on
(1)  183/  FF02BD : 04                  		dc.b $04			; Display ON, No VBlank interrupt
(1)  184/  FF02BE : 30                  		dc.b (($C000)>>10)		; Layer A at VRAM $C000 (%00xxx000)
(1)  185/  FF02BF : 34                  		dc.b (($D000)>>10)		; Window  at VRAM $D000 (%00xxxxy0)
(1)  186/  FF02C0 : 07                  		dc.b (($E000)>>13)		; Layer B at VRAM $E000 (%00000xxx)
(1)  187/  FF02C1 : 7C                  		dc.b (($F800)>>9)		; Sprites at VRAM $F800 (%0xxxxxxy)
(1)  188/  FF02C2 : 00                  		dc.b $00			; Unused
(1)  189/  FF02C3 : 00                  		dc.b $00			; Background color: 0
(1)  190/  FF02C4 : 00                  		dc.b $00			; Unused
(1)  191/  FF02C5 : 00                  		dc.b $00			; Unused
(1)  192/  FF02C6 : 00                  		dc.b $00			; HInt value
(1)  193/  FF02C7 : 00                  		dc.b (%000|%00)			; No ExtInt, Scroll: VSCR:full HSCR:full
(1)  194/  FF02C8 : 81                  		dc.b $81			; H40, No shadow mode, Normal resolution
(1)  195/  FF02C9 : 3F                  		dc.b (($FC00)>>10)		; HScroll at VRAM $FC00 (%00xxxxxx)
(1)  196/  FF02CA : 00                  		dc.b $00			; Unused
(1)  197/  FF02CB : 02                  		dc.b $02			; VDP Auto increment: $02
(1)  198/  FF02CC : 01                  		dc.b (%00<<4)|%01		; Layer size: V32 H64
(1)  199/  FF02CD : 00                  		dc.b $00
(1)  200/  FF02CE : 00                  		dc.b $00
(1)  201/  FF02CF :                     		align 2
(1)  202/  FF02D0 :                     
(1)  203/  FF02D0 : 0000 0EEE 0CCC 0AAA ASCII_PAL:	dc.w $0000,$0EEE,$0CCC,$0AAA,$0888,$0444,$000E,$0008
                    0888 0444 000E 0008 
(1)  204/  FF02E0 : 00EE 0088 00E0 0080 		dc.w $00EE,$0088,$00E0,$0080,$0E00,$0800,$0000,$0000
                    0E00 0800 0000 0000 
(1)  205/  FF02F0 :                     ASCII_PAL_e:
(1)  206/  FF02F0 :                     		align 2
(1)  207/  FF02F0 :                     
(1)  208/  FF02F0 :                     ; --------------------------------------------------------
(1)  209/  FF02F0 :                     ; Video_Clear
(1)  210/  FF02F0 :                     ;
(1)  211/  FF02F0 :                     ; Clear all video data from VRAM
(1)  212/  FF02F0 :                     ; --------------------------------------------------------
(1)  213/  FF02F0 :                     
(1)  214/  FF02F0 :                     Video_Clear:
(1)  215/  FF02F0 :                     ; 		move.w	#0,d0			; Clears until $57F
(1)  216/  FF02F0 :                     ; 		move.w	#0,d1
(1)  217/  FF02F0 :                     ; 		move.w	#$57F*$20,d2
(1)  218/  FF02F0 :                     ; 		bsr	Video_Fill
(1)  219/  FF02F0 :                     
(1)  220/  FF02F0 :                     Video_ClearScreen:
(1)  221/  FF02F0 : 7000                		moveq	#0,d0
(1)  222/  FF02F2 : 343C 0FFF           		move.w	#$FFF,d2		; FG/BG size
(1)  223/  FF02F6 : 1239 FFFF A6EC      		move.b	(RAM_VdpRegs+2).l,d1	; FG
(1)  224/  FF02FC : 0241 0038           		andi.w	#%111000,d1
(1)  225/  FF0300 : E149                		lsl.w	#8,d1
(1)  226/  FF0302 : E549                		lsl.w	#2,d1
(1)  227/  FF0304 : 6100 04D6           		bsr	Video_Fill
(1)  228/  FF0308 : 1239 FFFF A6EE      		move.b	(RAM_VdpRegs+4).l,d1	; BG
(1)  229/  FF030E : 0241 0007           		andi.w	#%000111,d1
(1)  230/  FF0312 : E149                		lsl.w	#8,d1
(1)  231/  FF0314 : EB49                		lsl.w	#5,d1
(1)  232/  FF0316 : 6100 04C4           		bsr	Video_Fill
(1)  233/  FF031A : 343C 0FFF           		move.w	#$FFF,d2		; WD Size
(1)  234/  FF031E : 1239 FFFF A6ED      		move.b	(RAM_VdpRegs+3).l,d1	; Window
(1)  235/  FF0324 : 0241 003E           		andi.w	#%111110,d1
(1)  236/  FF0328 : E149                		lsl.w	#8,d1
(1)  237/  FF032A : E549                		lsl.w	#2,d1
(1)  238/  FF032C : 6100 04AE           		bsr	Video_Fill
(1)  239/  FF0330 : 41F8 9904           		lea	(RAM_HorScroll),a0
(1)  240/  FF0334 : 3E3C 00EF           		move.w	#240-1,d7
(1)  241/  FF0338 : 7000                		moveq	#0,d0
(1)  242/  FF033A :                     .xnext:
(1)  243/  FF033A : 20C0                		move.l	d0,(a0)+
(1)  244/  FF033C : 51CF FFFC           		dbf	d7,.xnext
(1)  245/  FF0340 : 41F8 9CC4           		lea	(RAM_VerScroll),a0
(1)  246/  FF0344 : 3E3C 0013           		move.w	#(320/16)-1,d7
(1)  247/  FF0348 : 7000                		moveq	#0,d0
(1)  248/  FF034A :                     .ynext:
(1)  249/  FF034A : 20C0                		move.l	d0,(a0)+
(1)  250/  FF034C : 51CF FFFC           		dbf	d7,.ynext
(1)  251/  FF0350 : 41F8 9D14           		lea	(RAM_Sprites),a0
(1)  252/  FF0354 : 3E3C 008B           		move.w	#((70*8)/4)-1,d7
(1)  253/  FF0358 : 7000                		moveq	#0,d0
(1)  254/  FF035A :                     .snext:
(1)  255/  FF035A : 20C0                		move.l	d0,(a0)+
(1)  256/  FF035C : 51CF FFFC           		dbf	d7,.snext
(1)  257/  FF0360 :                     
(1)  258/  FF0360 : 41F8 A174           		lea	(RAM_Palette),a0
(1)  259/  FF0364 : 43F8 A1F4           		lea	(RAM_PaletteFd),a1
(1)  260/  FF0368 : 3E3C 001F           		move.w	#(64/2)-1,d7
(1)  261/  FF036C : 7000                		moveq	#0,d0
(1)  262/  FF036E :                     .pnext:
(1)  263/  FF036E : 20C0                		move.l	d0,(a0)+
(1)  264/  FF0370 : 22C0                		move.l	d0,(a1)+
(1)  265/  FF0372 : 51CF FFFA           		dbf	d7,.pnext
(1)  266/  FF0376 :                     	; Only the 256-color's fade...
(1)  267/  FF0376 : 41F8 A274           		lea	(RAM_MdMarsPalFd),a0
(1)  268/  FF037A : 3E3C 007F           		move.w	#(256/2)-1,d7
(1)  269/  FF037E : 7000                		moveq	#0,d0
(1)  270/  FF0380 :                     .pmnext:
(1)  271/  FF0380 : 20C0                		move.l	d0,(a0)+
(1)  272/  FF0382 : 51CF FFFC           		dbf	d7,.pmnext
(1)  273/  FF0386 : 4E75                		rts
(1)  274/  FF0388 :                     
(1)  275/  FF0388 :                     ; ====================================================================
(1)  276/  FF0388 :                     ; ----------------------------------------------------------------
(1)  277/  FF0388 :                     ; Generic screen-drawing routines
(1)  278/  FF0388 :                     ; ----------------------------------------------------------------
(1)  279/  FF0388 :                     
(1)  280/  FF0388 :                     ; --------------------------------------------------------
(1)  281/  FF0388 :                     ; Video_LoadMap
(1)  282/  FF0388 :                     ;
(1)  283/  FF0388 :                     ; Loads map data, in Horizontal order
(1)  284/  FF0388 :                     ; Can autodetect layer width, height and
(1)  285/  FF0388 :                     ; double interlace mode
(1)  286/  FF0388 :                     ;
(1)  287/  FF0388 :                     ; Input:
(1)  288/  FF0388 :                     ; a0 - Map data
(1)  289/  FF0388 :                     ;
(1)  290/  FF0388 :                     ; d0 | LONG - locate(lyr,x,y) / 00|Layer|X|Y
(1)  291/  FF0388 :                     ; d1 | LONG - mapsize(x,y) / Width|Height (in cells)
(1)  292/  FF0388 :                     ; d2 | WORD - VRAM
(1)  293/  FF0388 :                     ;
(1)  294/  FF0388 :                     ; Breaks:
(1)  295/  FF0388 :                     ; d4-d7,a6
(1)  296/  FF0388 :                     ; --------------------------------------------------------
(1)  297/  FF0388 :                     
(1)  298/  FF0388 :                     Video_LoadMap:
(1)  299/  FF0388 : 4DF9 00C0 0000      		lea	(vdp_data),a6
(1)  300/  FF038E : 6100 01B4           		bsr	vid_PickLayer
(1)  301/  FF0392 : 3A01                		move.w	d1,d5		; Start here
(1)  302/  FF0394 :                     .yloop:
(1)  303/  FF0394 : 4845                		swap	d5
(1)  304/  FF0396 : 2D44 0004           		move.l	d4,4(a6)
(1)  305/  FF039A : 2E01                		move.l	d1,d7
(1)  306/  FF039C : 4847                		swap	d7
(1)  307/  FF039E :                     .xloop:
(1)  308/  FF039E : 3A18                		move.w	(a0)+,d5
(1)  309/  FF03A0 : BA7C FFFF           		cmp.w	#-1,d5		; -1 ?
(1)  310/  FF03A4 : 6606                		bne.s	.nonull
(1)  311/  FF03A6 : 3A3C 07FF           		move.w	#varNullVram,d5	; Replace with custom blank tile
(1)  312/  FF03AA : 6002                		bra.s	.cont
(1)  313/  FF03AC :                     .nonull:
(1)  314/  FF03AC : DA42                		add.w	d2,d5
(1)  315/  FF03AE :                     .cont:
(1)  316/  FF03AE :                     
(1)  317/  FF03AE :                     	; Check for double interlace
(1)  318/  FF03AE : 4847                		swap	d7
(1)  319/  FF03B0 : 1E39 FFFF A6F6      		move.b	(RAM_VdpRegs+$C).l,d7
(1)  320/  FF03B6 : CE7C 0006           		and.w	#%110,d7
(1)  321/  FF03BA : BE7C 0006           		cmp.w	#%110,d7
(1)  322/  FF03BE : 660E                		bne.s	.nodble
(1)  323/  FF03C0 : 3E05                		move.w	d5,d7
(1)  324/  FF03C2 : E24F                		lsr.w	#1,d7
(1)  325/  FF03C4 : CE7C 07FF           		and.w	#$7FF,d7
(1)  326/  FF03C8 : CA7C F800           		and.w	#$F800,d5
(1)  327/  FF03CC : 8A47                		or.w	d7,d5
(1)  328/  FF03CE :                     .nodble:
(1)  329/  FF03CE : 4847                		swap	d7
(1)  330/  FF03D0 : 3C85                		move.w	d5,(a6)
(1)  331/  FF03D2 : 51CF FFCA           		dbf	d7,.xloop
(1)  332/  FF03D6 : D886                		add.l	d6,d4
(1)  333/  FF03D8 : 4845                		swap	d5
(1)  334/  FF03DA : 51CD FFB8           		dbf	d5,.yloop
(1)  335/  FF03DE : 4E75                		rts
(1)  336/  FF03E0 :                     
(1)  337/  FF03E0 :                     ; ; --------------------------------------------------------
(1)  338/  FF03E0 :                     ; ; Video_LoadMap_Vert
(1)  339/  FF03E0 :                     ; ;
(1)  340/  FF03E0 :                     ; ; Load map data, Vertical order
(1)  341/  FF03E0 :                     ; ;
(1)  342/  FF03E0 :                     ; ; a0 - Map data
(1)  343/  FF03E0 :                     ; ; d0 | LONG - 00|Lyr|X|Y,  locate(lyr,x,y)
(1)  344/  FF03E0 :                     ; ; d1 | LONG - Width|Height (cells),  mapsize(x,y)
(1)  345/  FF03E0 :                     ; ; d2 | WORD - VRAM
(1)  346/  FF03E0 :                     ;
(1)  347/  FF03E0 :                     ; ; Breaks:
(1)  348/  FF03E0 :                     ; ; a4-a5,d4-d7
(1)  349/  FF03E0 :                     ; ; --------------------------------------------------------
(1)  350/  FF03E0 :                     ;
(1)  351/  FF03E0 :                     ; Video_LoadMap_Vert:
(1)  352/  FF03E0 :                     ; 		lea	(vdp_data),a4
(1)  353/  FF03E0 :                     ; 		bsr	vid_PickLayer
(1)  354/  FF03E0 :                     ; 		move.l	d1,d5		; Start here
(1)  355/  FF03E0 :                     ; 		swap	d5
(1)  356/  FF03E0 :                     ; .xloop:
(1)  357/  FF03E0 :                     ; 		swap	d5
(1)  358/  FF03E0 :                     ; 		move.l	d4,-(sp)
(1)  359/  FF03E0 :                     ; 		move.w	d1,d7
(1)  360/  FF03E0 :                     ; 		btst	#2,(RAM_VdpRegs+$C).l
(1)  361/  FF03E0 :                     ; 		beq.s	.yloop
(1)  362/  FF03E0 :                     ; 		lsr.w	#1,d7
(1)  363/  FF03E0 :                     ; .yloop:
(1)  364/  FF03E0 :                     ; 		move.l	d4,4(a4)
(1)  365/  FF03E0 :                     ; 		move.w	(a0),d5
(1)  366/  FF03E0 :                     ; 		cmp.w	#-1,d5
(1)  367/  FF03E0 :                     ; 		bne.s	.nonull
(1)  368/  FF03E0 :                     ; 		move.w	#varNullVram,d5
(1)  369/  FF03E0 :                     ; 		bra.s	.cont
(1)  370/  FF03E0 :                     ; .nonull:
(1)  371/  FF03E0 :                     ; 		add.w	d2,d5
(1)  372/  FF03E0 :                     ; .cont:
(1)  373/  FF03E0 :                     ; 		swap	d7
(1)  374/  FF03E0 :                     ; 		adda	#2,a0
(1)  375/  FF03E0 :                     ; 		btst	#2,(RAM_VdpRegs+$C).l
(1)  376/  FF03E0 :                     ; 		beq.s	.nodble
(1)  377/  FF03E0 :                     ; 		adda	#2,a0
(1)  378/  FF03E0 :                     ; 		move.w	d5,d7
(1)  379/  FF03E0 :                     ; 		lsr.w	#1,d7
(1)  380/  FF03E0 :                     ; 		and.w	#$7FF,d7
(1)  381/  FF03E0 :                     ; 		and.w	#$F800,d5
(1)  382/  FF03E0 :                     ; 		or.w	d7,d5
(1)  383/  FF03E0 :                     ; .nodble:
(1)  384/  FF03E0 :                     ; 		swap	d7
(1)  385/  FF03E0 :                     ; 		move.w	d5,(a4)
(1)  386/  FF03E0 :                     ; 		add.l	d6,d4
(1)  387/  FF03E0 :                     ; 		dbf	d7,.yloop
(1)  388/  FF03E0 :                     ; .outdbl:
(1)  389/  FF03E0 :                     ; 		move.l	(sp)+,d4
(1)  390/  FF03E0 :                     ; 		add.l	#$20000,d4
(1)  391/  FF03E0 :                     ; 		swap	d5
(1)  392/  FF03E0 :                     ; 		dbf	d5,.xloop
(1)  393/  FF03E0 :                     ; 		rts
(1)  394/  FF03E0 :                     
(1)  395/  FF03E0 :                     ; ; --------------------------------------------------------
(1)  396/  FF03E0 :                     ; ; Video_AutoMap_Vert
(1)  397/  FF03E0 :                     ; ;
(1)  398/  FF03E0 :                     ; ; Make automatic map, Vertical order
(1)  399/  FF03E0 :                     ; ;
(1)  400/  FF03E0 :                     ; ; MCD: Use this to make a virtual screen
(1)  401/  FF03E0 :                     ; ; for Stamps
(1)  402/  FF03E0 :                     ; ;
(1)  403/  FF03E0 :                     ; ; d0 | LONG - 00|Lyr|X|Y,  locate(lyr,x,y)
(1)  404/  FF03E0 :                     ; ; d1 | LONG - Width|Height (cells),  mapsize(x,y)
(1)  405/  FF03E0 :                     ; ; d2 | WORD - VRAM
(1)  406/  FF03E0 :                     ;
(1)  407/  FF03E0 :                     ; ; Breaks:
(1)  408/  FF03E0 :                     ; ; a4-a5,d4-d7
(1)  409/  FF03E0 :                     ; ; --------------------------------------------------------
(1)  410/  FF03E0 :                     ;
(1)  411/  FF03E0 :                     ; ; TODO: double interlace
(1)  412/  FF03E0 :                     ; Video_AutoMap_Vert:
(1)  413/  FF03E0 :                     ; 		lea	(vdp_data),a4
(1)  414/  FF03E0 :                     ; 		bsr	vid_PickLayer
(1)  415/  FF03E0 :                     ; 		move.w	d2,d7		; Start here
(1)  416/  FF03E0 :                     ; 		move.l	d1,d5
(1)  417/  FF03E0 :                     ; 		swap	d5
(1)  418/  FF03E0 :                     ; .xloop:
(1)  419/  FF03E0 :                     ; 		swap	d5
(1)  420/  FF03E0 :                     ; 		move.l	d4,-(sp)
(1)  421/  FF03E0 :                     ; 		move.w	d1,d5
(1)  422/  FF03E0 :                     ; 		btst	#2,(RAM_VdpRegs+$C).l
(1)  423/  FF03E0 :                     ; 		beq.s	.yloop
(1)  424/  FF03E0 :                     ; 		lsr.w	#1,d5
(1)  425/  FF03E0 :                     ; .yloop:
(1)  426/  FF03E0 :                     ; 		move.l	d4,4(a4)
(1)  427/  FF03E0 :                     ; 		move.w	d7,(a4)
(1)  428/  FF03E0 :                     ; 		add.w	#1,d7
(1)  429/  FF03E0 :                     ; 		add.l	d6,d4
(1)  430/  FF03E0 :                     ; 		dbf	d5,.yloop
(1)  431/  FF03E0 :                     ;
(1)  432/  FF03E0 :                     ; 		move.l	(sp)+,d4
(1)  433/  FF03E0 :                     ; 		add.l	#$20000,d4
(1)  434/  FF03E0 :                     ; 		swap	d5
(1)  435/  FF03E0 :                     ; 		dbf	d5,.xloop
(1)  436/  FF03E0 :                     ; 		rts
(1)  437/  FF03E0 :                     
(1)  438/  FF03E0 :                     ; ====================================================================
(1)  439/  FF03E0 :                     ; ----------------------------------------------------------------
(1)  440/  FF03E0 :                     ; Custom "PRINT" system, for debugging or quick texts.
(1)  441/  FF03E0 :                     ; ----------------------------------------------------------------
(1)  442/  FF03E0 :                     
(1)  443/  FF03E0 :                     ; --------------------------------------------------------
(1)  444/  FF03E0 :                     ; Video_PrintInit
(1)  445/  FF03E0 :                     ;
(1)  446/  FF03E0 :                     ; Initializes the default Graphics and Palette
(1)  447/  FF03E0 :                     ; for the font.
(1)  448/  FF03E0 :                     ;
(1)  449/  FF03E0 :                     ; *** ON VBLANK OR DISPLAY OFF ONLY ***
(1)  450/  FF03E0 :                     ; *** MAKE SURE SH2 IS NOT READING ROM DATA ***
(1)  451/  FF03E0 :                     ; --------------------------------------------------------
(1)  452/  FF03E0 :                     
(1)  453/  FF03E0 :                     Video_PrintInit:
(1)  454/  FF03E0 : 203C 0003 8000      		move.l	#ASCII_FONT,d0
(1)  455/  FF03E6 : 323C B000           		move.w	#varPrintVram*$20,d1
(1)  456/  FF03EA : 343C 1000           		move.w	#ASCII_FONT_e-ASCII_FONT,d2
(1)  457/  FF03EE : 363C 6580           		move.w	#varPrintVram|(varPrintPal<<13),d3
(1)  458/  FF03F2 : 31C3 A6D8           		move.w	d3,(RAM_VidPrntVram).w
(1)  459/  FF03F6 : 6100 04DA           		bsr	Video_LoadArt
(1)  460/  FF03FA :                     Video_PrintPal:
(1)  461/  FF03FA : 41FA FED4           		lea	ASCII_PAL(pc),a0
(1)  462/  FF03FE : 7030                		moveq	#(varPrintPal<<4),d0
(1)  463/  FF0400 : 323C 000F           		move.w	#$F,d1
(1)  464/  FF0404 : 6100 01F6           		bsr	Video_LoadPal	; Write to both palette buffers
(1)  465/  FF0408 : 6000 01E8           		bra	Video_FadePal
(1)  466/  FF040C :                     
(1)  467/  FF040C :                     ; --------------------------------------------------------
(1)  468/  FF040C :                     ; Video_Print
(1)  469/  FF040C :                     ;
(1)  470/  FF040C :                     ; Prints string to layer
(1)  471/  FF040C :                     ; requires ASCII font
(1)  472/  FF040C :                     ;
(1)  473/  FF040C :                     ; a0 | DATA - String data w/special characters +
(1)  474/  FF040C :                     ;             list of RAM locations to read
(1)  475/  FF040C :                     ; d0 | LONG - Print location on-screen:
(1)  476/  FF040C :                     ;             00|Lyr|X|Y or locate(layer,x,y)
(1)  477/  FF040C :                     ;
(1)  478/  FF040C :                     ; Special characters:
(1)  479/  FF040C :                     ; "//b" - Shows BYTE value
(1)  480/  FF040C :                     ; "//w" - Shows WORD value
(1)  481/  FF040C :                     ; "//l" - Shows LONG value
(1)  482/  FF040C :                     ;   $0A - Next line
(1)  483/  FF040C :                     ;   $00 - End of line
(1)  484/  FF040C :                     ;
(1)  485/  FF040C :                     ; After $00, put your RAM addresses in LONGS
(1)  486/  FF040C :                     ; don't forget to put align 2 at the end.
(1)  487/  FF040C :                     ;
(1)  488/  FF040C :                     ; CALL Video_PrintInit FIRST before using this.
(1)  489/  FF040C :                     ;
(1)  490/  FF040C :                     ; Breaks:
(1)  491/  FF040C :                     ; d4-d7,a4-a6
(1)  492/  FF040C :                     ; --------------------------------------------------------
(1)  493/  FF040C :                     
(1)  494/  FF040C :                     Video_Print:
(1)  495/  FF040C :                     ; 		movem.l	d3-d7,-(sp)
(1)  496/  FF040C :                     ; 		movem.l	a4-a6,-(sp)
(1)  497/  FF040C :                     
(1)  498/  FF040C : 4DF9 00C0 0000      		lea	(vdp_data),a6
(1)  499/  FF0412 : 6100 0130           		bsr	vid_PickLayer
(1)  500/  FF0416 : 4BF8 A554           		lea	(RAM_VidPrntList),a5
(1)  501/  FF041A :                     .newjump:
(1)  502/  FF041A : 2D44 0004           		move.l	d4,4(a6)
(1)  503/  FF041E : 2A04                		move.l	d4,d5
(1)  504/  FF0420 :                     .loop:
(1)  505/  FF0420 : 1E18                		move.b	(a0)+,d7
(1)  506/  FF0422 : 6772                		beq	.exit
(1)  507/  FF0424 : 0C07 000A           		cmpi.b	#$A,d7			; $A - next line?
(1)  508/  FF0428 : 6718                		beq.s	.next
(1)  509/  FF042A : 0C07 005C           		cmpi.b	#$5C,d7			; $27 ("\") special?
(1)  510/  FF042E : 6716                		beq.s	.special
(1)  511/  FF0430 : 0247 00FF           		andi.w	#$FF,d7
(1)  512/  FF0434 :                     .puttext:
(1)  513/  FF0434 : DE78 A6D8           		add.w	(RAM_VidPrntVram).w,d7	; VRAM add
(1)  514/  FF0438 : 3C87                		move.w	d7,(a6)
(1)  515/  FF043A : DABC 0002 0000      		add.l	#$20000,d5
(1)  516/  FF0440 : 60DE                		bra.s	.loop
(1)  517/  FF0442 :                     ; Next line
(1)  518/  FF0442 :                     .next:
(1)  519/  FF0442 : D886                		add.l	d6,d4
(1)  520/  FF0444 : 60D4                		bra.s	.newjump
(1)  521/  FF0446 :                     
(1)  522/  FF0446 :                     ; Specials
(1)  523/  FF0446 :                     .special:
(1)  524/  FF0446 : 1E18                		move.b	(a0)+,d7
(1)  525/  FF0448 : 0C07 0062           		cmpi.b	#"b",d7
(1)  526/  FF044C : 6712                		beq.s	.isbyte
(1)  527/  FF044E : 0C07 0077           		cmpi.b	#"w",d7
(1)  528/  FF0452 : 671E                		beq.s	.isword
(1)  529/  FF0454 : 0C07 006C           		cmpi.b	#"l",d7
(1)  530/  FF0458 : 672A                		beq.s	.islong
(1)  531/  FF045A : 3E3C 005C           		move.w	#"\\",d7		; normal " \ "
(1)  532/  FF045E : 60D4                		bra.s	.puttext
(1)  533/  FF0460 :                     
(1)  534/  FF0460 :                     	; TEMPORAL VALUES
(1)  535/  FF0460 :                     .isbyte:
(1)  536/  FF0460 : 2AC5                		move.l	d5,(a5)+
(1)  537/  FF0462 : 3AFC 0001           		move.w	#1,(a5)+
(1)  538/  FF0466 : DABC 0004 0000      		add.l	#$40000,d5
(1)  539/  FF046C : 2D45 0004           		move.l	d5,4(a6)
(1)  540/  FF0470 : 60AE                		bra	.loop
(1)  541/  FF0472 :                     .isword:
(1)  542/  FF0472 : 2AC5                		move.l	d5,(a5)+
(1)  543/  FF0474 : 3AFC 0002           		move.w	#2,(a5)+
(1)  544/  FF0478 : DABC 0008 0000      		add.l	#$80000,d5
(1)  545/  FF047E : 2D45 0004           		move.l	d5,4(a6)
(1)  546/  FF0482 : 609C                		bra	.loop
(1)  547/  FF0484 :                     .islong:
(1)  548/  FF0484 : 2AC5                		move.l	d5,(a5)+
(1)  549/  FF0486 : 3AFC 0003           		move.w	#3,(a5)+
(1)  550/  FF048A : DABC 0010 0000      		add.l	#$100000,d5
(1)  551/  FF0490 : 2D45 0004           		move.l	d5,4(a6)
(1)  552/  FF0494 : 608A                		bra	.loop
(1)  553/  FF0496 :                     .exit:
(1)  554/  FF0496 :                     
(1)  555/  FF0496 :                     	; ----------------------------------------
(1)  556/  FF0496 :                     	; Print values
(1)  557/  FF0496 :                     	;
(1)  558/  FF0496 :                     	; vvvv vvvv tttt
(1)  559/  FF0496 :                     	; v - vdp pos
(1)  560/  FF0496 :                     	; t - value type
(1)  561/  FF0496 :                     	; ----------------------------------------
(1)  562/  FF0496 :                     
(1)  563/  FF0496 :                     	; reading byte by byte because longs doesn't get
(1)  564/  FF0496 :                     	; aligned after $00...
(1)  565/  FF0496 :                     
(1)  566/  FF0496 : 7800                		moveq	#0,d4
(1)  567/  FF0498 : 7A00                		moveq	#0,d5
(1)  568/  FF049A : 7C00                		moveq	#0,d6
(1)  569/  FF049C : 4BF8 A554           		lea	(RAM_VidPrntList),a5
(1)  570/  FF04A0 :                     .nextv:
(1)  571/  FF04A0 : 4A95                		tst.l	(a5)
(1)  572/  FF04A2 : 6700 009E           		beq	.nothing
(1)  573/  FF04A6 :                     
(1)  574/  FF04A6 :                     	; grab value
(1)  575/  FF04A6 : 7800                		moveq	#0,d4
(1)  576/  FF04A8 : 1818                		move.b	(a0)+,d4
(1)  577/  FF04AA : E19C                		rol.l	#8,d4
(1)  578/  FF04AC : 1818                		move.b	(a0)+,d4
(1)  579/  FF04AE : E19C                		rol.l	#8,d4
(1)  580/  FF04B0 : 1818                		move.b	(a0)+,d4
(1)  581/  FF04B2 : E19C                		rol.l	#8,d4
(1)  582/  FF04B4 : 1818                		move.b	(a0)+,d4
(1)  583/  FF04B6 : 2844                		movea.l	d4,a4
(1)  584/  FF04B8 : 7800                		moveq	#0,d4
(1)  585/  FF04BA :                     
(1)  586/  FF04BA :                     	; get value
(1)  587/  FF04BA : 3C2D 0004           		move.w	4(a5),d6
(1)  588/  FF04BE : BC7C 0001           		cmp.w	#1,d6		; byte?
(1)  589/  FF04C2 : 660E                		bne.s	.vbyte
(1)  590/  FF04C4 : 1814                		move.b	(a4),d4
(1)  591/  FF04C6 : 2D55 0004           		move.l	(a5),4(a6)
(1)  592/  FF04CA : E91C                		rol.b	#4,d4
(1)  593/  FF04CC : 6158                		bsr.s	.donibl
(1)  594/  FF04CE : E91C                		rol.b	#4,d4
(1)  595/  FF04D0 : 6154                		bsr.s	.donibl
(1)  596/  FF04D2 :                     .vbyte:
(1)  597/  FF04D2 : BC7C 0002           		cmp.w	#2,d6		; word?
(1)  598/  FF04D6 : 661C                		bne.s	.vword
(1)  599/  FF04D8 : 1814                		move.b	(a4),d4
(1)  600/  FF04DA : E15C                		rol.w	#8,d4
(1)  601/  FF04DC : 182C 0001           		move.b	1(a4),d4
(1)  602/  FF04E0 : 2D55 0004           		move.l	(a5),4(a6)
(1)  603/  FF04E4 : E95C                		rol.w	#4,d4
(1)  604/  FF04E6 : 613E                		bsr.s	.donibl
(1)  605/  FF04E8 : E95C                		rol.w	#4,d4
(1)  606/  FF04EA : 613A                		bsr.s	.donibl
(1)  607/  FF04EC : E95C                		rol.w	#4,d4
(1)  608/  FF04EE : 6136                		bsr.s	.donibl
(1)  609/  FF04F0 : E95C                		rol.w	#4,d4
(1)  610/  FF04F2 : 6132                		bsr.s	.donibl
(1)  611/  FF04F4 :                     .vword:
(1)  612/  FF04F4 :                     
(1)  613/  FF04F4 :                     	; TODO: might break on negative values
(1)  614/  FF04F4 : BC7C 0003           		cmp.w	#3,d6		; long?
(1)  615/  FF04F8 : 6624                		bne.s	.vlong
(1)  616/  FF04FA : 1814                		move.b	(a4),d4
(1)  617/  FF04FC : E19C                		rol.l	#8,d4
(1)  618/  FF04FE : 182C 0001           		move.b	1(a4),d4
(1)  619/  FF0502 : E19C                		rol.l	#8,d4
(1)  620/  FF0504 : 182C 0002           		move.b	2(a4),d4
(1)  621/  FF0508 : E19C                		rol.l	#8,d4
(1)  622/  FF050A : 182C 0003           		move.b	3(a4),d4
(1)  623/  FF050E : 2D55 0004           		move.l	(a5),4(a6)
(1)  624/  FF0512 : 3C3C 0007           		move.w	#7,d6
(1)  625/  FF0516 : E99C                .lngloop:	rol.l	#4,d4
(1)  626/  FF0518 : 610C                		bsr.s	.donibl
(1)  627/  FF051A : 51CE FFFA           		dbf	d6,.lngloop
(1)  628/  FF051E :                     .vlong:
(1)  629/  FF051E : 429D                		clr.l	(a5)+
(1)  630/  FF0520 : 425D                		clr.w	(a5)+
(1)  631/  FF0522 : 6000 FF7C           		bra	.nextv
(1)  632/  FF0526 :                     
(1)  633/  FF0526 :                     ; make nibble byte
(1)  634/  FF0526 :                     .donibl:
(1)  635/  FF0526 : 3A04                		move.w	d4,d5
(1)  636/  FF0528 : 0245 000F           		andi.w	#%1111,d5
(1)  637/  FF052C : BA3C 000A           		cmp.b	#$A,d5
(1)  638/  FF0530 : 6D04                		blt.s	.lowr
(1)  639/  FF0532 : DA3C 0007           		add.b	#7,d5
(1)  640/  FF0536 :                     .lowr:
(1)  641/  FF0536 : DA7C 0030           		add.w	#"0",d5
(1)  642/  FF053A : DA78 A6D8           		add.w	(RAM_VidPrntVram),d5
(1)  643/  FF053E : 3C85                		move.w	d5,(a6)
(1)  644/  FF0540 : 4E75                		rts
(1)  645/  FF0542 :                     ; exit
(1)  646/  FF0542 :                     .nothing:
(1)  647/  FF0542 :                     ; 		movem.l	(sp)+,a4-a6
(1)  648/  FF0542 :                     ; 		movem.l	(sp)+,d3-d7
(1)  649/  FF0542 : 4E75                		rts
(1)  650/  FF0544 :                     
(1)  651/  FF0544 :                     ; --------------------------------------------------------
(1)  652/  FF0544 :                     ; Shared: pick layer / x pos / y pos and set size
(1)  653/  FF0544 :                     ; --------------------------------------------------------
(1)  654/  FF0544 :                     
(1)  655/  FF0544 :                     vid_PickLayer:
(1)  656/  FF0544 : 2C00                		move.l	d0,d6			; Pick layer
(1)  657/  FF0546 : 4846                		swap	d6
(1)  658/  FF0548 : 0806 0000           		btst	#0,d6
(1)  659/  FF054C : 671E                		beq.s	.plawnd
(1)  660/  FF054E : 1839 FFFF A6EE      		move.b	(RAM_VdpRegs+4).l,d4	; BG
(1)  661/  FF0554 : 3A04                		move.w	d4,d5
(1)  662/  FF0556 : E24D                		lsr.w	#1,d5
(1)  663/  FF0558 : 0245 0003           		andi.w	#%11,d5
(1)  664/  FF055C : 4844                		swap	d4
(1)  665/  FF055E : 3805                		move.w	d5,d4
(1)  666/  FF0560 : 4844                		swap	d4
(1)  667/  FF0562 : 0244 0001           		andi.w	#1,d4
(1)  668/  FF0566 : E14C                		lsl.w	#8,d4
(1)  669/  FF0568 : EB4C                		lsl.w	#5,d4
(1)  670/  FF056A : 6028                		bra.s	.golyr
(1)  671/  FF056C :                     .plawnd:
(1)  672/  FF056C : 1839 FFFF A6EC      		move.b	(RAM_VdpRegs+2).l,d4	; FG
(1)  673/  FF0572 : 0806 0001           		btst	#1,d6
(1)  674/  FF0576 : 6706                		beq.s	.nowd
(1)  675/  FF0578 : 1839 FFFF A6ED      		move.b	(RAM_VdpRegs+3).l,d4	; WINDOW
(1)  676/  FF057E :                     .nowd:
(1)  677/  FF057E : 3A04                		move.w	d4,d5
(1)  678/  FF0580 : E84D                		lsr.w	#4,d5
(1)  679/  FF0582 : 0245 0003           		andi.w	#%11,d5
(1)  680/  FF0586 : 4844                		swap	d4
(1)  681/  FF0588 : 3805                		move.w	d5,d4
(1)  682/  FF058A : 4844                		swap	d4
(1)  683/  FF058C : 0244 000E           		andi.w	#%00001110,d4
(1)  684/  FF0590 : E14C                		lsl.w	#8,d4
(1)  685/  FF0592 : E54C                		lsl.w	#2,d4
(1)  686/  FF0594 :                     .golyr:
(1)  687/  FF0594 : 0044 4000           		ori.w	#$4000,d4
(1)  688/  FF0598 : 3A00                		move.w	d0,d5			; Y start pos
(1)  689/  FF059A : 0245 00FF           		andi.w	#$FF,d5			; Y only
(1)  690/  FF059E : ED4D                		lsl.w	#6,d5
(1)  691/  FF05A0 : 1C38 A6FA           		move.b	(RAM_VdpRegs+$10).w,d6
(1)  692/  FF05A4 : 0246 0003           		andi.w	#%11,d6
(1)  693/  FF05A8 : 670A                		beq.s	.thissz
(1)  694/  FF05AA : DA45                		add.w	d5,d5			; H64
(1)  695/  FF05AC : 0246 0002           		andi.w	#%10,d6
(1)  696/  FF05B0 : 6702                		beq.s	.thissz
(1)  697/  FF05B2 : DA45                		add.w	d5,d5			; H128
(1)  698/  FF05B4 :                     .thissz:
(1)  699/  FF05B4 : D845                		add.w	d5,d4
(1)  700/  FF05B6 : 3A00                		move.w	d0,d5
(1)  701/  FF05B8 : 0245 FF00           		andi.w	#$FF00,d5		; X only
(1)  702/  FF05BC : EE4D                		lsr.w	#7,d5
(1)  703/  FF05BE : D845                		add.w	d5,d4			; X add
(1)  704/  FF05C0 : 4844                		swap	d4
(1)  705/  FF05C2 : 7C00                		moveq	#0,d6
(1)  706/  FF05C4 : 3C3C 0040           		move.w	#$40,d6			; Set jump size
(1)  707/  FF05C8 : 1A38 A6FA           		move.b	(RAM_VdpRegs+$10).w,d5
(1)  708/  FF05CC : 0245 0003           		andi.w	#%11,d5
(1)  709/  FF05D0 : 670A                		beq.s	.thisszj
(1)  710/  FF05D2 : DC46                		add.w	d6,d6			; H64
(1)  711/  FF05D4 : 0245 0002           		andi.w	#%10,d5
(1)  712/  FF05D8 : 6702                		beq.s	.thisszj
(1)  713/  FF05DA : DC46                		add.w	d6,d6			; H128
(1)  714/  FF05DC :                     .thisszj:
(1)  715/  FF05DC : 4846                		swap	d6
(1)  716/  FF05DE : 4E75                		rts
(1)  717/  FF05E0 :                     
(1)  718/  FF05E0 :                     ; ====================================================================
(1)  719/  FF05E0 :                     ; ----------------------------------------------------------------
(1)  720/  FF05E0 :                     ; Palette fade system, Genesis side
(1)  721/  FF05E0 :                     ; ----------------------------------------------------------------
(1)  722/  FF05E0 :                     
(1)  723/  FF05E0 :                     ; --------------------------------------------------------
(1)  724/  FF05E0 :                     ; Video_RunFade
(1)  725/  FF05E0 :                     ;
(1)  726/  FF05E0 :                     ; Processes palette fading and reports if requests
(1)  727/  FF05E0 :                     ; finished on exit.
(1)  728/  FF05E0 :                     ;
(1)  729/  FF05E0 :                     ; Returns:
(1)  730/  FF05E0 :                     ; bne - Still active
(1)  731/  FF05E0 :                     ; beq - Finished
(1)  732/  FF05E0 :                     ;
(1)  733/  FF05E0 :                     ; *** CALL System_WaitFrame FIRST ***
(1)  734/  FF05E0 :                     ; --------------------------------------------------------
(1)  735/  FF05E0 :                     
(1)  736/  FF05E0 :                     Video_RunFade:
(1)  737/  FF05E0 : 613E                		bsr	Video_DoPalFade
(1)  738/  FF05E2 : 6100 0488           		bsr	Video_MarsPalFade
(1)  739/  FF05E6 : 3E38 A6E2           		move.w	(RAM_FadeMarsReq),d7
(1)  740/  FF05EA : 3C38 A6DA           		move.w	(RAM_FadeMdReq),d6
(1)  741/  FF05EE : 8E46                		or.w	d6,d7
(1)  742/  FF05F0 : 4E75                		rts
(1)  743/  FF05F2 :                     
(1)  744/  FF05F2 :                     ; --------------------------------------------------------
(1)  745/  FF05F2 :                     ; Video_LoadPal
(1)  746/  FF05F2 :                     ; 
(1)  747/  FF05F2 :                     ; Input:
(1)  748/  FF05F2 :                     ; a0 - Palette data
(1)  749/  FF05F2 :                     ; d0 - Start position
(1)  750/  FF05F2 :                     ; d1 - Number of colors
(1)  751/  FF05F2 :                     ; 
(1)  752/  FF05F2 :                     ; Breaks:
(1)  753/  FF05F2 :                     ; d5-d7,a6
(1)  754/  FF05F2 :                     ; --------------------------------------------------------
(1)  755/  FF05F2 :                     
(1)  756/  FF05F2 :                     Video_FadePal:
(1)  757/  FF05F2 : 4DF8 A1F4           		lea	(RAM_PaletteFd),a6
(1)  758/  FF05F6 : 4278 A6E0           		clr.w	(RAM_FadeMdTmr).w
(1)  759/  FF05FA : 6004                		bra.s	vidMd_Pal
(1)  760/  FF05FC :                     Video_LoadPal:
(1)  761/  FF05FC : 4DF8 A174           		lea	(RAM_Palette),a6
(1)  762/  FF0600 :                     vidMd_Pal:
(1)  763/  FF0600 : 2A48                		move.l	a0,a5
(1)  764/  FF0602 : 7E00                		moveq	#0,d7
(1)  765/  FF0604 : 3E00                		move.w	d0,d7
(1)  766/  FF0606 : DE47                		add.w	d7,d7
(1)  767/  FF0608 : DCC7                		adda	d7,a6
(1)  768/  FF060A : 3E01                		move.w	d1,d7
(1)  769/  FF060C : 9E7C 0001           		sub.w	#1,d7
(1)  770/  FF0610 : 3C02                		move.w	d2,d6
(1)  771/  FF0612 : CC7C 0001           		and.w	#1,d6
(1)  772/  FF0616 : E25E                		ror.w	#1,d6
(1)  773/  FF0618 :                     .loop:
(1)  774/  FF0618 : 3CDD                		move.w	(a5)+,(a6)+
(1)  775/  FF061A : 51CF FFFC           		dbf	d7,.loop
(1)  776/  FF061E : 4E75                		rts
(1)  777/  FF0620 :                     
(1)  778/  FF0620 :                     ; --------------------------------------------------------
(1)  779/  FF0620 :                     ; Video_DoPalFade
(1)  780/  FF0620 :                     ;
(1)  781/  FF0620 :                     ; RAM_ReqFadeMars: (WORD)
(1)  782/  FF0620 :                     ; $00 - No task or finished.
(1)  783/  FF0620 :                     ; $01 - Fade in
(1)  784/  FF0620 :                     ; $02 - Fade out to black
(1)  785/  FF0620 :                     ;
(1)  786/  FF0620 :                     ; NOTE: ONLY CALL THIS OUTSIDE OF VBLANK
(1)  787/  FF0620 :                     ; --------------------------------------------------------
(1)  788/  FF0620 :                     
(1)  789/  FF0620 :                     Video_DoPalFade:
(1)  790/  FF0620 : 0478 0001 A6E0      		sub.w	#1,(RAM_FadeMdTmr).w
(1)  791/  FF0626 : 6A14                		bpl.s	.active
(1)  792/  FF0628 : 31F8 A6DE A6E0      		move.w	(RAM_FadeMdDelay).w,(RAM_FadeMdTmr).w
(1)  793/  FF062E : 3E38 A6DA           		move.w	(RAM_FadeMdReq).w,d7
(1)  794/  FF0632 : DE47                		add.w	d7,d7
(1)  795/  FF0634 : 3E3B 7008           		move.w	.fade_list(pc,d7.w),d7
(1)  796/  FF0638 : 4EFB 7004           		jmp	.fade_list(pc,d7.w)
(1)  797/  FF063C :                     .active:
(1)  798/  FF063C : 4E75                		rts
(1)  799/  FF063E :                     
(1)  800/  FF063E :                     ; --------------------------------------------
(1)  801/  FF063E :                     
(1)  802/  FF063E :                     .fade_list:
(1)  803/  FF063E : 0006                		dc.w .fade_done-.fade_list
(1)  804/  FF0640 : 0008                		dc.w .fade_in-.fade_list
(1)  805/  FF0642 : 00AC                		dc.w .fade_out-.fade_list
(1)  806/  FF0644 :                     
(1)  807/  FF0644 :                     ; --------------------------------------------
(1)  808/  FF0644 :                     ; No fade or finished.
(1)  809/  FF0644 :                     ; --------------------------------------------
(1)  810/  FF0644 :                     
(1)  811/  FF0644 :                     .fade_done:
(1)  812/  FF0644 : 4E75                		rts
(1)  813/  FF0646 :                     
(1)  814/  FF0646 :                     ; --------------------------------------------
(1)  815/  FF0646 :                     ; Fade in
(1)  816/  FF0646 :                     ; --------------------------------------------
(1)  817/  FF0646 :                     
(1)  818/  FF0646 :                     .fade_in:
(1)  819/  FF0646 : 4DF8 A1F4           		lea	(RAM_PaletteFd),a6
(1)  820/  FF064A : 4BF8 A174           		lea	(RAM_Palette),a5
(1)  821/  FF064E : 303C 0040           		move.w	#64,d0				; Num of colors
(1)  822/  FF0652 : 3238 A6DC           		move.w	(RAM_FadeMdIncr).w,d1		; Speed
(1)  823/  FF0656 : D241                		add.w	d1,d1
(1)  824/  FF0658 : 3C00                		move.w	d0,d6
(1)  825/  FF065A : 4846                		swap	d6
(1)  826/  FF065C : 907C 0001           		sub.w	#1,d0
(1)  827/  FF0660 :                     .nxt_pal:
(1)  828/  FF0660 : 4242                		clr.w	d2		; Reset finished colorbits
(1)  829/  FF0662 : 3E16                		move.w	(a6),d7		; d7 - Input
(1)  830/  FF0664 : 3C15                		move.w	(a5),d6		; d6 - Output
(1)  831/  FF0666 : 3607                		move.w	d7,d3		; RED
(1)  832/  FF0668 : 3806                		move.w	d6,d4
(1)  833/  FF066A : CC7C 0EE0           		and.w	#%0000111011100000,d6
(1)  834/  FF066E : C87C 000E           		and.w	#%0000000000001110,d4
(1)  835/  FF0672 : C67C 000E           		and.w	#%0000000000001110,d3
(1)  836/  FF0676 : D841                		add.w	d1,d4
(1)  837/  FF0678 : B843                		cmp.w	d3,d4
(1)  838/  FF067A : 6506                		bcs.s	.no_red
(1)  839/  FF067C : 3803                		move.w	d3,d4
(1)  840/  FF067E : 847C 0001           		or.w	#%001,d2	; RED is ready
(1)  841/  FF0682 :                     .no_red:
(1)  842/  FF0682 : 8C44                		or.w	d4,d6
(1)  843/  FF0684 : E949                		lsl.w	#4,d1
(1)  844/  FF0686 : 3607                		move.w	d7,d3		; GREEN
(1)  845/  FF0688 : 3806                		move.w	d6,d4
(1)  846/  FF068A : CC7C 0E0E           		and.w	#%0000111000001110,d6
(1)  847/  FF068E : C87C 00E0           		and.w	#%0000000011100000,d4
(1)  848/  FF0692 : C67C 00E0           		and.w	#%0000000011100000,d3
(1)  849/  FF0696 : D841                		add.w	d1,d4
(1)  850/  FF0698 : B843                		cmp.w	d3,d4
(1)  851/  FF069A : 6506                		bcs.s	.no_grn
(1)  852/  FF069C : 3803                		move.w	d3,d4
(1)  853/  FF069E : 847C 0002           		or.w	#%010,d2	; GREEN is ready
(1)  854/  FF06A2 :                     .no_grn:
(1)  855/  FF06A2 : 8C44                		or.w	d4,d6
(1)  856/  FF06A4 : E949                		lsl.w	#4,d1
(1)  857/  FF06A6 : 3607                		move.w	d7,d3		; BLUE
(1)  858/  FF06A8 : 3806                		move.w	d6,d4
(1)  859/  FF06AA : CC7C 00EE           		and.w	#%0000000011101110,d6
(1)  860/  FF06AE : C87C 0E00           		and.w	#%0000111000000000,d4
(1)  861/  FF06B2 : C67C 0E00           		and.w	#%0000111000000000,d3
(1)  862/  FF06B6 : D841                		add.w	d1,d4
(1)  863/  FF06B8 : B843                		cmp.w	d3,d4
(1)  864/  FF06BA : 6506                		bcs.s	.no_blu
(1)  865/  FF06BC : 3803                		move.w	d3,d4
(1)  866/  FF06BE : 847C 0004           		or.w	#%100,d2	; BLUE is ready
(1)  867/  FF06C2 :                     .no_blu:
(1)  868/  FF06C2 : 8C44                		or.w	d4,d6
(1)  869/  FF06C4 : E049                		lsr.w	#8,d1
(1)  870/  FF06C6 : 3AC6                		move.w	d6,(a5)+
(1)  871/  FF06C8 : DCFC 0002           		adda	#2,a6
(1)  872/  FF06CC : B47C 0007           		cmp.w	#%111,d2
(1)  873/  FF06D0 : 6608                		bne.s	.no_fnsh
(1)  874/  FF06D2 : 4846                		swap	d6
(1)  875/  FF06D4 : 9C7C 0001           		sub.w	#1,d6
(1)  876/  FF06D8 : 4846                		swap	d6
(1)  877/  FF06DA :                     .no_fnsh:
(1)  878/  FF06DA : 51C8 FF84           		dbf	d0,.nxt_pal
(1)  879/  FF06DE : 4846                		swap	d6
(1)  880/  FF06E0 : 4A46                		tst.w	d6
(1)  881/  FF06E2 : 6604                		bne.s	.no_move
(1)  882/  FF06E4 : 4278 A6DA           		clr.w	(RAM_FadeMdReq).w
(1)  883/  FF06E8 :                     .no_move:
(1)  884/  FF06E8 : 4E75                		rts
(1)  885/  FF06EA :                     
(1)  886/  FF06EA :                     ; --------------------------------------------
(1)  887/  FF06EA :                     ; Fade out
(1)  888/  FF06EA :                     ; --------------------------------------------
(1)  889/  FF06EA :                     
(1)  890/  FF06EA :                     .fade_out:
(1)  891/  FF06EA : 4DF8 A174           		lea	(RAM_Palette),a6
(1)  892/  FF06EE : 303C 0040           		move.w	#64,d0				; Num of colors
(1)  893/  FF06F2 : 3238 A6DC           		move.w	(RAM_FadeMdIncr).w,d1		; Speed
(1)  894/  FF06F6 : 3C00                		move.w	d0,d6
(1)  895/  FF06F8 : 4846                		swap	d6
(1)  896/  FF06FA : 907C 0001           		sub.w	#1,d0
(1)  897/  FF06FE :                     .nxt_pal_o:
(1)  898/  FF06FE : 4242                		clr.w	d2			; Reset finished colorbits
(1)  899/  FF0700 : 3E16                		move.w	(a6),d7			; d7 - Input
(1)  900/  FF0702 : 3C07                		move.w	d7,d6
(1)  901/  FF0704 : CE7C 0EE0           		and.w	#%0000111011100000,d7
(1)  902/  FF0708 : CC7C 000E           		and.w	#%0000000000001110,d6
(1)  903/  FF070C : 9C41                		sub.w	d1,d6
(1)  904/  FF070E : 6A06                		bpl.s	.no_red_o
(1)  905/  FF0710 : 4246                		clr.w	d6
(1)  906/  FF0712 : 847C 0001           		or.w	#%001,d2		; RED is ready
(1)  907/  FF0716 :                     .no_red_o:
(1)  908/  FF0716 : 8E46                		or.w	d6,d7
(1)  909/  FF0718 : E949                		lsl.w	#4,d1
(1)  910/  FF071A : 3C07                		move.w	d7,d6
(1)  911/  FF071C : CE7C 0E0E           		and.w	#%0000111000001110,d7
(1)  912/  FF0720 : CC7C 00E0           		and.w	#%0000000011100000,d6
(1)  913/  FF0724 : 9C41                		sub.w	d1,d6
(1)  914/  FF0726 : 6A06                		bpl.s	.no_grn_o
(1)  915/  FF0728 : 4246                		clr.w	d6
(1)  916/  FF072A : 847C 0002           		or.w	#%010,d2		; GREEN is ready
(1)  917/  FF072E :                     .no_grn_o:
(1)  918/  FF072E : 8E46                		or.w	d6,d7
(1)  919/  FF0730 : E949                		lsl.w	#4,d1
(1)  920/  FF0732 : 3C07                		move.w	d7,d6
(1)  921/  FF0734 : CE7C 00EE           		and.w	#%0000000011101110,d7
(1)  922/  FF0738 : CC7C 0E00           		and.w	#%0000111000000000,d6
(1)  923/  FF073C : 9C41                		sub.w	d1,d6
(1)  924/  FF073E : 6A06                		bpl.s	.no_blu_o
(1)  925/  FF0740 : 4246                		clr.w	d6
(1)  926/  FF0742 : 847C 0004           		or.w	#%100,d2		; BLUE is ready
(1)  927/  FF0746 :                     .no_blu_o:
(1)  928/  FF0746 : 8E46                		or.w	d6,d7
(1)  929/  FF0748 : E049                		lsr.w	#8,d1
(1)  930/  FF074A : 3CC7                		move.w	d7,(a6)+
(1)  931/  FF074C : B47C 0007           		cmp.w	#%111,d2
(1)  932/  FF0750 : 6608                		bne.s	.no_fnsh_o
(1)  933/  FF0752 : 4846                		swap	d6
(1)  934/  FF0754 : 9C7C 0001           		sub.w	#1,d6
(1)  935/  FF0758 : 4846                		swap	d6
(1)  936/  FF075A :                     .no_fnsh_o:
(1)  937/  FF075A : 51C8 FFA2           		dbf	d0,.nxt_pal_o
(1)  938/  FF075E : 4846                		swap	d6
(1)  939/  FF0760 : 4A46                		tst.w	d6
(1)  940/  FF0762 : 6604                		bne.s	.no_move_o
(1)  941/  FF0764 : 4278 A6DA           		clr.w	(RAM_FadeMdReq).w
(1)  942/  FF0768 :                     .no_move_o:
(1)  943/  FF0768 : 4E75                		rts
(1)  944/  FF076A :                     
(1)  945/  FF076A :                     ; ====================================================================
(1)  946/  FF076A :                     ; --------------------------------------------------------
(1)  947/  FF076A :                     ; Genesis DMA
(1)  948/  FF076A :                     ; --------------------------------------------------------
(1)  949/  FF076A :                     
(1)  950/  FF076A :                     ; --------------------------------------------------------
(1)  951/  FF076A :                     ; Video_DmaMkEntry
(1)  952/  FF076A :                     ;
(1)  953/  FF076A :                     ; Sets a new DMA transfer task to the Blast list
(1)  954/  FF076A :                     ;
(1)  955/  FF076A :                     ; *** ONLY CALL THIS OUTSIDE OF VBLANK ***
(1)  956/  FF076A :                     ;
(1)  957/  FF076A :                     ; d0 | LONG - Art data
(1)  958/  FF076A :                     ; d1 | WORD - VRAM location
(1)  959/  FF076A :                     ; d2 | WORD - Size
(1)  960/  FF076A :                     ;
(1)  961/  FF076A :                     ; Breaks:
(1)  962/  FF076A :                     ; d6-d7,a6
(1)  963/  FF076A :                     ; --------------------------------------------------------
(1)  964/  FF076A :                     
(1)  965/  FF076A :                     Video_DmaMkEntry:
(1)  966/  FF076A : 31FC 0001 A6D6      		move.w	#1,(RAM_VdpDmaMod).w
(1)  967/  FF0770 : 4DF8 A474           		lea	(RAM_VdpDmaList).w,a6
(1)  968/  FF0774 : 3E38 A6D4           		move.w	(RAM_VdpDmaIndx).w,d7
(1)  969/  FF0778 : DCC7                		adda	d7,a6
(1)  970/  FF077A : DE7C 000E           		add.w	#7*2,d7
(1)  971/  FF077E : 31C7 A6D4           		move.w	d7,(RAM_VdpDmaIndx).w
(1)  972/  FF0782 : 3E02                		move.w	d2,d7			; Length
(1)  973/  FF0784 : 2C3C 9400 9300      		move.l	#$94009300,d6
(1)  974/  FF078A : E24F                		lsr.w	#1,d7
(1)  975/  FF078C : 1C07                		move.b	d7,d6
(1)  976/  FF078E : 4846                		swap	d6
(1)  977/  FF0790 : E04F                		lsr.w	#8,d7
(1)  978/  FF0792 : 1C07                		move.b	d7,d6
(1)  979/  FF0794 : 4846                		swap	d6
(1)  980/  FF0796 : 2CC6                		move.l	d6,(a6)+
(1)  981/  FF0798 : 2E00                		move.l	d0,d7			; Source
(1)  982/  FF079A : E28F                  		lsr.l	#1,d7
(1)  983/  FF079C : 2C3C 9600 9500       		move.l	#$96009500,d6
(1)  984/  FF07A2 : 1C07                 		move.b	d7,d6
(1)  985/  FF07A4 : E08F                 		lsr.l	#8,d7
(1)  986/  FF07A6 : 4846                 		swap	d6
(1)  987/  FF07A8 : 1C07                 		move.b	d7,d6
(1)  988/  FF07AA : 2CC6                 		move.l	d6,(a6)+
(1)  989/  FF07AC : 3C3C 9700            		move.w	#$9700,d6
(1)  990/  FF07B0 : E08F                 		lsr.l	#8,d7
(1)  991/  FF07B2 : 1C07                 		move.b	d7,d6
(1)  992/  FF07B4 : 3CC6                 		move.w	d6,(a6)+
(1)  993/  FF07B6 : 3E01                		move.w	d1,d7			; Destination
(1)  994/  FF07B8 :                     ; 		and.w	#$7FF,d7
(1)  995/  FF07B8 :                     ; 		lsl.w	#5,d7
(1)  996/  FF07B8 : 3C07                		move.w	d7,d6
(1)  997/  FF07BA : CEBC 0000 3FE0      		and.l	#$3FE0,d7
(1)  998/  FF07C0 : 0047 4000           		ori.w	#$4000,d7
(1)  999/  FF07C4 : E04E                		lsr.w	#8,d6
(1) 1000/  FF07C6 : EC4E                		lsr.w	#6,d6
(1) 1001/  FF07C8 : 0246 0003           		andi.w	#%11,d6
(1) 1002/  FF07CC : 0046 0080           		ori.w	#$80,d6
(1) 1003/  FF07D0 : 3CC7                		move.w	d7,(a6)+
(1) 1004/  FF07D2 : 3CC6                		move.w	d6,(a6)+
(1) 1005/  FF07D4 : 31FC 0000 A6D6      		move.w	#0,(RAM_VdpDmaMod).w
(1) 1006/  FF07DA : 4E75                		rts
(1) 1007/  FF07DC :                     
(1) 1008/  FF07DC :                     ; --------------------------------------------------------
(1) 1009/  FF07DC :                     ; Video_Fill
(1) 1010/  FF07DC :                     ;
(1) 1011/  FF07DC :                     ; Fill data to VRAM
(1) 1012/  FF07DC :                     ;
(1) 1013/  FF07DC :                     ; d0 | WORD - Bytes to fill
(1) 1014/  FF07DC :                     ; d1 | WORD - VRAM position
(1) 1015/  FF07DC :                     ; d2 | WORD - Size (WORDS)
(1) 1016/  FF07DC :                     ;
(1) 1017/  FF07DC :                     ; Breaks:
(1) 1018/  FF07DC :                     ; d6-d7,a6
(1) 1019/  FF07DC :                     ; --------------------------------------------------------
(1) 1020/  FF07DC :                     
(1) 1021/  FF07DC :                     Video_Fill:
(1) 1022/  FF07DC : 4DF9 00C0 0004      		lea	(vdp_ctrl),a6
(1) 1023/  FF07E2 : 3E3C 8100           		move.w	#$8100,d7
(1) 1024/  FF07E6 : 1E38 A6EB           		move.b	(RAM_VdpRegs+1),d7
(1) 1025/  FF07EA : 08C7 0004           		bset	#bitDmaEnbl,d7
(1) 1026/  FF07EE : 3C87                		move.w	d7,(a6)
(1) 1027/  FF07F0 : 3E16                .dmaw:		move.w	(a6),d7
(1) 1028/  FF07F2 : 0807 0001           		btst	#bitDma,d7
(1) 1029/  FF07F6 : 66F8                		bne.s	.dmaw
(1) 1030/  FF07F8 : 3CBC 8F01           		move.w	#$8F01,(a6)	; Increment $01
(1) 1031/  FF07FC : 3E02                		move.w	d2,d7		; d2 - Size
(1) 1032/  FF07FE : 2C3C 9400 9300      		move.l	#$94009300,d6
(1) 1033/  FF0804 : 1C07                		move.b	d7,d6
(1) 1034/  FF0806 : 4846                		swap	d6
(1) 1035/  FF0808 : E04F                		lsr.w	#8,d7
(1) 1036/  FF080A : 1C07                		move.b	d7,d6
(1) 1037/  FF080C : 4846                		swap	d6
(1) 1038/  FF080E : 2C86                		move.l	d6,(a6)
(1) 1039/  FF0810 : 3CBC 9780           		move.w	#$9780,(a6)	; DMA Fill mode
(1) 1040/  FF0814 : 3E01                		move.w	d1,d7		; d1 - Destination
(1) 1041/  FF0816 :                     ; 		lsl.w	#5,d7
(1) 1042/  FF0816 : 3C07                		move.w	d7,d6
(1) 1043/  FF0818 : 0246 3FFF           		andi.w	#$3FFF,d6
(1) 1044/  FF081C : 0046 4000           		ori.w	#$4000,d6
(1) 1045/  FF0820 : 4846                		swap	d6
(1) 1046/  FF0822 : 3C07                		move.w	d7,d6
(1) 1047/  FF0824 : E04E                		lsr.w	#8,d6
(1) 1048/  FF0826 : EC4E                		lsr.w	#6,d6
(1) 1049/  FF0828 : 0246 0003           		andi.w	#%11,d6
(1) 1050/  FF082C : 0046 0080           		ori.w	#$80,d6
(1) 1051/  FF0830 : 2C86                		move.l	d6,(a6)
(1) 1052/  FF0832 : 3D40 FFFC           		move.w	d0,-4(a6)
(1) 1053/  FF0836 : 3E16                .dmawe:		move.w	(a6),d7
(1) 1054/  FF0838 : 0807 0001           		btst	#bitDma,d7
(1) 1055/  FF083C : 66F8                		bne.s	.dmawe
(1) 1056/  FF083E : 3CBC 8F02           		move.w	#$8F02,(a6)	; Increment $02
(1) 1057/  FF0842 : 3E3C 8100           		move.w	#$8100,d7
(1) 1058/  FF0846 : 1E38 A6EB           		move.b	(RAM_VdpRegs+1),d7
(1) 1059/  FF084A : 3C87                		move.w	d7,(a6)
(1) 1060/  FF084C : 4E75                		rts
(1) 1061/  FF084E :                     
(1) 1062/  FF084E :                     ; --------------------------------------------------------
(1) 1063/  FF084E :                     ; Video_Copy
(1) 1064/  FF084E :                     ;
(1) 1065/  FF084E :                     ; Copy VRAM data to another location
(1) 1066/  FF084E :                     ;
(1) 1067/  FF084E :                     ; d0 | WORD - VRAM Source
(1) 1068/  FF084E :                     ; d1 | WORD - VRAM Destination
(1) 1069/  FF084E :                     ; d2 | WORD - Size
(1) 1070/  FF084E :                     ;
(1) 1071/  FF084E :                     ; Breaks:
(1) 1072/  FF084E :                     ; d6-d7,a6
(1) 1073/  FF084E :                     ; --------------------------------------------------------
(1) 1074/  FF084E :                     
(1) 1075/  FF084E :                     ; TODO: test if this works again...
(1) 1076/  FF084E :                     
(1) 1077/  FF084E :                     Video_Copy:
(1) 1078/  FF084E : 4DF9 00C0 0004      		lea	(vdp_ctrl),a6
(1) 1079/  FF0854 : 3E3C 8100           		move.w	#$8100,d7
(1) 1080/  FF0858 : 1E38 A6EB           		move.b	(RAM_VdpRegs+1),d7
(1) 1081/  FF085C : 08C7 0004           		bset	#bitDmaEnbl,d7
(1) 1082/  FF0860 : 3C87                		move.w	d7,(a6)
(1) 1083/  FF0862 : 3E16                .dmaw:		move.w	(a6),d7
(1) 1084/  FF0864 : 0807 0001           		btst	#bitDma,d7
(1) 1085/  FF0868 : 66F8                		bne.s	.dmaw
(1) 1086/  FF086A : 3CBC 8F01           		move.w	#$8F01,(a6)		; Increment $01
(1) 1087/  FF086E : 3E02                		move.w	d2,d7			; SIZE
(1) 1088/  FF0870 : 2C3C 9400 9300      		move.l	#$94009300,d6
(1) 1089/  FF0876 :                     ; 		lsr.w	#1,d7
(1) 1090/  FF0876 : 1C07                		move.b	d7,d6
(1) 1091/  FF0878 : 4846                		swap	d6
(1) 1092/  FF087A : E04F                		lsr.w	#8,d7
(1) 1093/  FF087C : 1C07                		move.b	d7,d6
(1) 1094/  FF087E : 4846                		swap	d6
(1) 1095/  FF0880 : 2C86                		move.l	d6,(a6)
(1) 1096/  FF0882 : 2C3C 9600 9500      		move.l	#$96009500,d6		; SOURCE
(1) 1097/  FF0888 : 3E00                		move.w	d0,d7
(1) 1098/  FF088A : 1C07                		move.b	d7,d6
(1) 1099/  FF088C : 4846                		swap	d6
(1) 1100/  FF088E : E04F                		lsr.w	#8,d7
(1) 1101/  FF0890 : 1C07                		move.b	d7,d6
(1) 1102/  FF0892 : 2C86                		move.l	d6,(a6)
(1) 1103/  FF0894 : 3CBC 97C0           		move.w	#$97C0,(a6)		; DMA Copy mode
(1) 1104/  FF0898 : 2E02                		move.l	d2,d7			; DESTINATION
(1) 1105/  FF089A :                     ; 		lsl.w	#5,d7
(1) 1106/  FF089A : 3C07                		move.w	d7,d6
(1) 1107/  FF089C : 0246 3FFF           		andi.w	#$3FFF,d6
(1) 1108/  FF08A0 : 0046 4000           		ori.w	#$4000,d6
(1) 1109/  FF08A4 : 4846                		swap	d6
(1) 1110/  FF08A6 : 3C07                		move.w	d7,d6
(1) 1111/  FF08A8 : E04E                		lsr.w	#8,d6
(1) 1112/  FF08AA : EC4E                		lsr.w	#6,d6
(1) 1113/  FF08AC : 0246 0003           		andi.w	#%11,d6
(1) 1114/  FF08B0 : 0046 00C0           		ori.w	#$C0,d6
(1) 1115/  FF08B4 : 2C86                		move.l	d6,(a6)
(1) 1116/  FF08B6 : 3D41 FFFC           		move.w	d1,-4(a6)
(1) 1117/  FF08BA : 3E16                .dmawe:		move.w	(a6),d7
(1) 1118/  FF08BC : 0807 0001           		btst	#bitDma,d7
(1) 1119/  FF08C0 : 66F8                		bne.s	.dmawe
(1) 1120/  FF08C2 : 3CBC 8F02           		move.w	#$8F02,(a6)		; Increment $02
(1) 1121/  FF08C6 : 3E3C 8100           		move.w	#$8100,d7
(1) 1122/  FF08CA : 1E38 A6EB           		move.b	(RAM_VdpRegs+1),d7
(1) 1123/  FF08CE : 3C87                		move.w	d7,(a6)
(1) 1124/  FF08D0 : 4E75                		rts
(1) 1125/  FF08D2 :                     
(1) 1126/  FF08D2 :                     ; --------------------------------------------------------
(1) 1127/  FF08D2 :                     ; Load graphics using DMA, direct
(1) 1128/  FF08D2 :                     ;
(1) 1129/  FF08D2 :                     ; d0 | LONG - Art data
(1) 1130/  FF08D2 :                     ; d1 | WORD - VRAM location
(1) 1131/  FF08D2 :                     ; d2 | WORD - Size
(1) 1132/  FF08D2 :                     ;
(1) 1133/  FF08D2 :                     ; Breaks:
(1) 1134/  FF08D2 :                     ; d5-d7,a4-a6
(1) 1135/  FF08D2 :                     ;
(1) 1136/  FF08D2 :                     ; *** For faster transfers call this during VBlank ***
(1) 1137/  FF08D2 :                     ; *** MAKE SURE SH2 IS NOT IN THE MIDDLE OF READING
(1) 1138/  FF08D2 :                     ; ROM ***
(1) 1139/  FF08D2 :                     ; --------------------------------------------------------
(1) 1140/  FF08D2 :                     
(1) 1141/  FF08D2 :                     Video_LoadArt:
(1) 1142/  FF08D2 : 40E7                		move.w	sr,-(sp)
(1) 1143/  FF08D4 : 007C 0700           		or	#$700,sr
(1) 1144/  FF08D8 : 49F9 00C0 0004      		lea	(vdp_ctrl),a4
(1) 1145/  FF08DE : 3C3C 8100           		move.w	#$8100,d6		; DMA ON
(1) 1146/  FF08E2 : 1C38 A6EB           		move.b	(RAM_VdpRegs+1),d6
(1) 1147/  FF08E6 : 08C6 0004           		bset	#bitDmaEnbl,d6
(1) 1148/  FF08EA : 3886                		move.w	d6,(a4)
(1) 1149/  FF08EC : 3C02                		move.w	d2,d6			; Length
(1) 1150/  FF08EE : 2A3C 9400 9300      		move.l	#$94009300,d5
(1) 1151/  FF08F4 : E24E                		lsr.w	#1,d6
(1) 1152/  FF08F6 : 1A06                		move.b	d6,d5
(1) 1153/  FF08F8 : 4845                		swap	d5
(1) 1154/  FF08FA : E04E                		lsr.w	#8,d6
(1) 1155/  FF08FC : 1A06                		move.b	d6,d5
(1) 1156/  FF08FE : 4845                		swap	d5
(1) 1157/  FF0900 : 2885                		move.l	d5,(a4)
(1) 1158/  FF0902 : 2C00                		move.l	d0,d6			; Source
(1) 1159/  FF0904 : E28E                  		lsr.l	#1,d6
(1) 1160/  FF0906 : 2A3C 9600 9500       		move.l	#$96009500,d5
(1) 1161/  FF090C : 1A06                 		move.b	d6,d5
(1) 1162/  FF090E : E08E                 		lsr.l	#8,d6
(1) 1163/  FF0910 : 4845                 		swap	d5
(1) 1164/  FF0912 : 1A06                 		move.b	d6,d5
(1) 1165/  FF0914 : 2885                 		move.l	d5,(a4)
(1) 1166/  FF0916 : 3A3C 9700            		move.w	#$9700,d5
(1) 1167/  FF091A : E08E                 		lsr.l	#8,d6
(1) 1168/  FF091C : 1A06                 		move.b	d6,d5
(1) 1169/  FF091E : 3885                 		move.w	d5,(a4)
(1) 1170/  FF0920 : 3C01                		move.w	d1,d6			; Destination
(1) 1171/  FF0922 : 3A06                		move.w	d6,d5
(1) 1172/  FF0924 : CCBC 0000 3FE0      		and.l	#$3FE0,d6
(1) 1173/  FF092A : 0046 4000           		ori.w	#$4000,d6
(1) 1174/  FF092E : E04D                		lsr.w	#8,d5
(1) 1175/  FF0930 : EC4D                		lsr.w	#6,d5
(1) 1176/  FF0932 : 0245 0003           		andi.w	#%11,d5
(1) 1177/  FF0936 : 0045 0080           		ori.w	#$80,d5
(1) 1178/  FF093A : 2E00                		move.l	d0,d7
(1) 1179/  FF093C : 4847                		swap	d7
(1) 1180/  FF093E : E04F                		lsr.w	#8,d7
(1) 1181/  FF0940 : BE3C 00FF           		cmp.b	#$FF,d7
(1) 1182/  FF0944 : 672E                		beq.s	.from_ram
(1) 1183/  FF0946 : 4EB9 00FF 12D8      		jsr	System_Dma_Enter
(1) 1184/  FF094C : 08F9 0000 00A1 5107 		bset	#0,(sysmars_reg+dreqctl+1).l	; Set RV=1
(1) 1185/  FF0954 : 3F05                 		move.w	d5,-(sp)
(1) 1186/  FF0956 : 3886                		move.w	d6,(a4)				; d6 - First word
(1) 1187/  FF0958 : 389F                		move.w	(sp)+,(a4)			; *** Second write, 68k freezes until DMA ends
(1) 1188/  FF095A : 08B9 0000 00A1 5107 		bclr	#0,(sysmars_reg+dreqctl+1).l	; Set RV=0
(1) 1189/  FF0962 : 3C3C 8100           		move.w	#$8100,d6			; DMA OFF
(1) 1190/  FF0966 : 1C38 A6EB           		move.b	(RAM_VdpRegs+1),d6
(1) 1191/  FF096A : 3886                		move.w	d6,(a4)
(1) 1192/  FF096C : 46DF                		move.w	(sp)+,sr
(1) 1193/  FF096E : 4EF9 00FF 12E0      		jmp	System_Dma_Exit
(1) 1194/  FF0974 :                     .from_ram:
(1) 1195/  FF0974 : 3887                		move.w	d7,(a4)
(1) 1196/  FF0976 : 3F05                 		move.w	d5,-(sp)
(1) 1197/  FF0978 : 389F                		move.w	(sp)+,(a4)			; Second write
(1) 1198/  FF097A : 3E3C 8100           		move.w	#$8100,d7
(1) 1199/  FF097E : 1E38 A6EB           		move.b	(RAM_VdpRegs+1),d7
(1) 1200/  FF0982 : 3887                		move.w	d7,(a4)
(1) 1201/  FF0984 : 46DF                		move.w	(sp)+,sr
(1) 1202/  FF0986 : 4E75                		rts
(1) 1203/  FF0988 :                     
(1) 1204/  FF0988 :                     ; --------------------------------------------------------
(1) 1205/  FF0988 :                     ; Video_DmaBlast
(1) 1206/  FF0988 :                     ;
(1) 1207/  FF0988 :                     ; Process DMA tasks from a predefined list in RAM
(1) 1208/  FF0988 :                     ; **CALL THIS DURING VBLANK ONLY**
(1) 1209/  FF0988 :                     ;
(1) 1210/  FF0988 :                     ; Breaks:
(1) 1211/  FF0988 :                     ; d5-d7,a3-a4
(1) 1212/  FF0988 :                     ; --------------------------------------------------------
(1) 1213/  FF0988 :                     
(1) 1214/  FF0988 :                     ; Entry format:
(1) 1215/  FF0988 :                     ; $94xx,$93xx,$96xx,$95xx,$97xx (SIZE,SOURCE)
(1) 1216/  FF0988 :                     ; $40000080 (vdp destination + dma bit)
(1) 1217/  FF0988 :                     
(1) 1218/  FF0988 :                     Video_DmaBlast:
(1) 1219/  FF0988 : 4A78 A6D6           		tst.w	(RAM_VdpDmaMod).w		; Got mid-write?
(1) 1220/  FF098C : 666A                		bne.s	.exit
(1) 1221/  FF098E : 4A78 A6D4           		tst.w	(RAM_VdpDmaIndx).w		; Any requests?
(1) 1222/  FF0992 : 6764                		beq.s	.exit
(1) 1223/  FF0994 : 49F9 00C0 0004      		lea	(vdp_ctrl),a4			; Enter processing loop
(1) 1224/  FF099A : 47F8 A474           		lea	(RAM_VdpDmaList).w,a3
(1) 1225/  FF099E : 3E3C 8100           		move.w	#$8100,d7			; DMA ON
(1) 1226/  FF09A2 : 1E38 A6EB           		move.b	(RAM_VdpRegs+1),d7
(1) 1227/  FF09A6 : 08C7 0004           		bset	#bitDmaEnbl,d7
(1) 1228/  FF09AA : 3887                		move.w	d7,(a4)
(1) 1229/  FF09AC : 4EB9 00FF 12D8      		jsr	System_Dma_Enter		; Request Z80 stop and SH2 backup
(1) 1230/  FF09B2 : 08F9 0000 00A1 5107 		bset	#0,(sysmars_reg+dreqctl+1).l	; Set RV=1
(1) 1231/  FF09BA : 4A78 A6D4           .next:		tst.w	(RAM_VdpDmaIndx).w
(1) 1232/  FF09BE : 6720                		beq.s	.end
(1) 1233/  FF09C0 : 2893                		move.l	(a3),(a4)			; Size
(1) 1234/  FF09C2 : 429B                		clr.l	(a3)+
(1) 1235/  FF09C4 : 2893                		move.l	(a3),(a4)			; Source
(1) 1236/  FF09C6 : 429B                		clr.l	(a3)+
(1) 1237/  FF09C8 : 3893                		move.w	(a3),(a4)
(1) 1238/  FF09CA : 425B                		clr.w	(a3)+
(1) 1239/  FF09CC : 3C13                		move.w	(a3),d6				; Destination
(1) 1240/  FF09CE : 425B                		clr.w	(a3)+
(1) 1241/  FF09D0 : 3A13                		move.w	(a3),d5
(1) 1242/  FF09D2 : 425B                		clr.w	(a3)+
(1) 1243/  FF09D4 : 3886                		move.w	d6,(a4)
(1) 1244/  FF09D6 : 3885                		move.w	d5,(a4)
(1) 1245/  FF09D8 : 0478 000E A6D4      		sub.w	#7*2,(RAM_VdpDmaIndx).w
(1) 1246/  FF09DE : 60DA                		bra.s	.next
(1) 1247/  FF09E0 :                     .end:
(1) 1248/  FF09E0 : 08B9 0000 00A1 5107 		bclr	#0,(sysmars_reg+dreqctl+1).l	; Set RV=0
(1) 1249/  FF09E8 : 4EB9 00FF 12E0      		jsr	System_Dma_Exit			; Resume Z80 and SH2 direct
(1) 1250/  FF09EE : 3E3C 8100           		move.w	#$8100,d7			; DMA OFF
(1) 1251/  FF09F2 : 1E38 A6EB           		move.b	(RAM_VdpRegs+1).w,d7
(1) 1252/  FF09F6 : 3887                		move.w	d7,(a4)
(1) 1253/  FF09F8 :                     .exit:
(1) 1254/  FF09F8 : 4E75                		rts
(1) 1255/  FF09FA :                     
(1) 1256/  FF09FA :                     ; ====================================================================
(1) 1257/  FF09FA :                     ; ----------------------------------------------------------------
(1) 1258/  FF09FA :                     ; Video routines for 32X
(1) 1259/  FF09FA :                     ; ----------------------------------------------------------------
(1) 1260/  FF09FA :                     
(1) 1261/  FF09FA :                     ; --------------------------------------------------------
(1) 1262/  FF09FA :                     ; Video_Mars_GfxMode
(1) 1263/  FF09FA :                     ; Sets graphics mode on the 32X side
(1) 1264/  FF09FA :                     ;
(1) 1265/  FF09FA :                     ; Input:
(1) 1266/  FF09FA :                     ; d0 - Graphics mode
(1) 1267/  FF09FA :                     ; --------------------------------------------------------
(1) 1268/  FF09FA :                     
(1) 1269/  FF09FA :                     Video_Mars_GfxMode:
(1) 1270/  FF09FA : 3E00                		move.w	d0,d7
(1) 1271/  FF09FC : CE7C 0007           		and.w	#%00000111,d7			; Current limit: 8 Master modes
(1) 1272/  FF0A00 : 8E7C 00C0           		or.w	#$C0,d7
(1) 1273/  FF0A04 : 13C7 00A1 512D      		move.b	d7,(sysmars_reg+comm12+1).l
(1) 1274/  FF0A0A : 3E39 00A1 512E      .wait_slv:	move.w	(sysmars_reg+comm14).l,d7	; Wait for Slave
(1) 1275/  FF0A10 : CE7C 000F           		and.w	#%00001111,d7
(1) 1276/  FF0A14 : 66F4                		bne.s	.wait_slv
(1) 1277/  FF0A16 : 3E39 00A1 512C      .wait:		move.w	(sysmars_reg+comm12).l,d7	; Wait for Master
(1) 1278/  FF0A1C : CE7C 00C0           		and.w	#%11000000,d7
(1) 1279/  FF0A20 : 66F4                		bne.s	.wait
(1) 1280/  FF0A22 : 4E75                		rts
(1) 1281/  FF0A24 :                     
(1) 1282/  FF0A24 :                     ; --------------------------------------------------------
(1) 1283/  FF0A24 :                     ; Video_Mars_WaitFrame
(1) 1284/  FF0A24 :                     ; --------------------------------------------------------
(1) 1285/  FF0A24 :                     
(1) 1286/  FF0A24 :                     Video_Mars_WaitFrame:
(1) 1287/  FF0A24 : 08F9 0005 00A1 512D 		bset	#5,(sysmars_reg+comm12+1).l	; Set R bit
(1) 1288/  FF0A2C :                     .wait:
(1) 1289/  FF0A2C :                     ; 		move.w	(vdp_ctrl),d7
(1) 1290/  FF0A2C :                     ; 		btst	#bitVBlk,d7
(1) 1291/  FF0A2C :                     ; 		bne.s	.late
(1) 1292/  FF0A2C : 3E39 00A1 512C      		move.w	(sysmars_reg+comm12).l,d7
(1) 1293/  FF0A32 : 0807 0005           		btst	#5,d7
(1) 1294/  FF0A36 : 66F4                		bne.s	.wait
(1) 1295/  FF0A38 :                     .late:
(1) 1296/  FF0A38 : 4E75                		rts
(1) 1297/  FF0A3A :                     
(1) 1298/  FF0A3A :                     ; --------------------------------------------------------
(1) 1299/  FF0A3A :                     ; Video_LoadPal_Mars
(1) 1300/  FF0A3A :                     ;
(1) 1301/  FF0A3A :                     ; Load Indexed palette directly to Buffer
(1) 1302/  FF0A3A :                     ;
(1) 1303/  FF0A3A :                     ; d0 - Start at
(1) 1304/  FF0A3A :                     ; d1 - Number of colors
(1) 1305/  FF0A3A :                     ; d2 - Priority bit OFF/ON
(1) 1306/  FF0A3A :                     ; --------------------------------------------------------
(1) 1307/  FF0A3A :                     
(1) 1308/  FF0A3A :                     Video_FadePal_Mars:
(1) 1309/  FF0A3A : 4DF8 A274           		lea	(RAM_MdMarsPalFd),a6
(1) 1310/  FF0A3E : 4278 A6E8           		clr.w	(RAM_FadeMarsTmr).w
(1) 1311/  FF0A42 : 6004                		bra.s	vidMars_Pal
(1) 1312/  FF0A44 :                     Video_LoadPal_Mars:
(1) 1313/  FF0A44 : 4DF8 AB60           		lea	(RAM_MdDreq+Dreq_Palette).w,a6
(1) 1314/  FF0A48 :                     vidMars_Pal:
(1) 1315/  FF0A48 : 2A48                		move.l	a0,a5
(1) 1316/  FF0A4A : 7E00                		moveq	#0,d7
(1) 1317/  FF0A4C : 3E00                		move.w	d0,d7
(1) 1318/  FF0A4E : DE47                		add.w	d7,d7
(1) 1319/  FF0A50 : DCC7                		adda	d7,a6
(1) 1320/  FF0A52 : 3E01                		move.w	d1,d7
(1) 1321/  FF0A54 : 9E7C 0001           		sub.w	#1,d7
(1) 1322/  FF0A58 : 3C02                		move.w	d2,d6
(1) 1323/  FF0A5A : CC7C 0001           		and.w	#1,d6
(1) 1324/  FF0A5E : E25E                		ror.w	#1,d6
(1) 1325/  FF0A60 :                     .loop:
(1) 1326/  FF0A60 : 3A1D                		move.w	(a5)+,d5
(1) 1327/  FF0A62 : 8A46                		or.w	d6,d5
(1) 1328/  FF0A64 : 3CC5                		move.w	d5,(a6)+
(1) 1329/  FF0A66 : 51CF FFF8           		dbf	d7,.loop
(1) 1330/  FF0A6A : 4E75                		rts
(1) 1331/  FF0A6C :                     
(1) 1332/  FF0A6C :                     ; --------------------------------------------------------
(1) 1333/  FF0A6C :                     ; Video_MarsPalFade
(1) 1334/  FF0A6C :                     ;
(1) 1335/  FF0A6C :                     ; a0 - Palette data
(1) 1336/  FF0A6C :                     ; d0 - Number of colors
(1) 1337/  FF0A6C :                     ; d1 - Speed
(1) 1338/  FF0A6C :                     ;
(1) 1339/  FF0A6C :                     ; RAM_ReqFadeMars: (WORD)
(1) 1340/  FF0A6C :                     ; $00 - No task (or finished)
(1) 1341/  FF0A6C :                     ; $01 - Fade in
(1) 1342/  FF0A6C :                     ; $02 - Fade out to black
(1) 1343/  FF0A6C :                     ;
(1) 1344/  FF0A6C :                     ; CALL THIS OUTSIDE OF VBLANK
(1) 1345/  FF0A6C :                     ; --------------------------------------------------------
(1) 1346/  FF0A6C :                     
(1) 1347/  FF0A6C :                     ; TODO: luego ver que hago con el priority bit
(1) 1348/  FF0A6C :                     
(1) 1349/  FF0A6C :                     Video_MarsPalFade:
(1) 1350/  FF0A6C : 0478 0001 A6E8      		sub.w	#1,(RAM_FadeMarsTmr).w
(1) 1351/  FF0A72 : 6A14                		bpl.s	.active
(1) 1352/  FF0A74 : 31F8 A6E6 A6E8      		move.w	(RAM_FadeMarsDelay).w,(RAM_FadeMarsTmr).w
(1) 1353/  FF0A7A : 3E38 A6E2           		move.w	(RAM_FadeMarsReq).w,d7
(1) 1354/  FF0A7E : DE47                		add.w	d7,d7
(1) 1355/  FF0A80 : 3E3B 7008           		move.w	.fade_list(pc,d7.w),d7
(1) 1356/  FF0A84 : 4EFB 7004           		jmp	.fade_list(pc,d7.w)
(1) 1357/  FF0A88 :                     .active:
(1) 1358/  FF0A88 : 4E75                		rts
(1) 1359/  FF0A8A :                     
(1) 1360/  FF0A8A :                     ; --------------------------------------------
(1) 1361/  FF0A8A :                     
(1) 1362/  FF0A8A :                     .fade_list:
(1) 1363/  FF0A8A : 0006                		dc.w .fade_done-.fade_list
(1) 1364/  FF0A8C : 0008                		dc.w .fade_in-.fade_list
(1) 1365/  FF0A8E : 00B2                		dc.w .fade_out-.fade_list
(1) 1366/  FF0A90 :                     
(1) 1367/  FF0A90 :                     ; --------------------------------------------
(1) 1368/  FF0A90 :                     ; No fade or finished.
(1) 1369/  FF0A90 :                     ; --------------------------------------------
(1) 1370/  FF0A90 :                     
(1) 1371/  FF0A90 :                     .fade_done:
(1) 1372/  FF0A90 : 4E75                		rts
(1) 1373/  FF0A92 :                     
(1) 1374/  FF0A92 :                     ; --------------------------------------------
(1) 1375/  FF0A92 :                     ; Fade in
(1) 1376/  FF0A92 :                     ; --------------------------------------------
(1) 1377/  FF0A92 :                     
(1) 1378/  FF0A92 :                     .fade_in:
(1) 1379/  FF0A92 : 4DF8 A274           		lea	(RAM_MdMarsPalFd),a6
(1) 1380/  FF0A96 : 4BF8 AB60           		lea	(RAM_MdDreq+Dreq_Palette).w,a5
(1) 1381/  FF0A9A : 303C 0100           		move.w	#256,d0				; Num of colors
(1) 1382/  FF0A9E : 3238 A6E4           		move.w	(RAM_FadeMarsIncr).w,d1		; Speed
(1) 1383/  FF0AA2 : 3C00                		move.w	d0,d6
(1) 1384/  FF0AA4 : 4846                		swap	d6
(1) 1385/  FF0AA6 : 907C 0001           		sub.w	#1,d0
(1) 1386/  FF0AAA :                     .nxt_pal:
(1) 1387/  FF0AAA : 4242                		clr.w	d2		; Reset finished colorbits
(1) 1388/  FF0AAC : 3E16                		move.w	(a6),d7		; d7 - Input
(1) 1389/  FF0AAE : 3C15                		move.w	(a5),d6		; d6 - Output
(1) 1390/  FF0AB0 : 3607                		move.w	d7,d3		; RED
(1) 1391/  FF0AB2 : 3806                		move.w	d6,d4
(1) 1392/  FF0AB4 : CC7C FFE0           		and.w	#%1111111111100000,d6
(1) 1393/  FF0AB8 : C87C 001F           		and.w	#%0000000000011111,d4
(1) 1394/  FF0ABC : C67C 001F           		and.w	#%0000000000011111,d3
(1) 1395/  FF0AC0 : D841                		add.w	d1,d4
(1) 1396/  FF0AC2 : B843                		cmp.w	d3,d4
(1) 1397/  FF0AC4 : 6506                		bcs.s	.no_red
(1) 1398/  FF0AC6 : 3803                		move.w	d3,d4
(1) 1399/  FF0AC8 : 847C 0001           		or.w	#%001,d2	; RED is ready
(1) 1400/  FF0ACC :                     .no_red:
(1) 1401/  FF0ACC : 8C44                		or.w	d4,d6
(1) 1402/  FF0ACE : EB49                		lsl.w	#5,d1
(1) 1403/  FF0AD0 : 3607                		move.w	d7,d3		; GREEN
(1) 1404/  FF0AD2 : 3806                		move.w	d6,d4
(1) 1405/  FF0AD4 : CC7C FC1F           		and.w	#%1111110000011111,d6
(1) 1406/  FF0AD8 : C87C 03E0           		and.w	#%0000001111100000,d4
(1) 1407/  FF0ADC : C67C 03E0           		and.w	#%0000001111100000,d3
(1) 1408/  FF0AE0 : D841                		add.w	d1,d4
(1) 1409/  FF0AE2 : B843                		cmp.w	d3,d4
(1) 1410/  FF0AE4 : 6506                		bcs.s	.no_grn
(1) 1411/  FF0AE6 : 3803                		move.w	d3,d4
(1) 1412/  FF0AE8 : 847C 0002           		or.w	#%010,d2	; GREEN is ready
(1) 1413/  FF0AEC :                     .no_grn:
(1) 1414/  FF0AEC : 8C44                		or.w	d4,d6
(1) 1415/  FF0AEE : EB49                		lsl.w	#5,d1
(1) 1416/  FF0AF0 : 3607                		move.w	d7,d3		; BLUE
(1) 1417/  FF0AF2 : 3806                		move.w	d6,d4
(1) 1418/  FF0AF4 : CC7C 83FF           		and.w	#%1000001111111111,d6
(1) 1419/  FF0AF8 : C87C 7C00           		and.w	#%0111110000000000,d4
(1) 1420/  FF0AFC : C67C 7C00           		and.w	#%0111110000000000,d3
(1) 1421/  FF0B00 : D841                		add.w	d1,d4
(1) 1422/  FF0B02 : B843                		cmp.w	d3,d4
(1) 1423/  FF0B04 : 6506                		bcs.s	.no_blu
(1) 1424/  FF0B06 : 3803                		move.w	d3,d4
(1) 1425/  FF0B08 : 847C 0004           		or.w	#%100,d2	; BLUE is ready
(1) 1426/  FF0B0C :                     .no_blu:
(1) 1427/  FF0B0C : 8C44                		or.w	d4,d6
(1) 1428/  FF0B0E : E049                		lsr.w	#8,d1
(1) 1429/  FF0B10 : E449                		lsr.w	#2,d1
(1) 1430/  FF0B12 : CE7C 8000           		and.w	#$8000,d7	; Keep priority bit
(1) 1431/  FF0B16 : 8C47                		or.w	d7,d6
(1) 1432/  FF0B18 : 3AC6                		move.w	d6,(a5)+
(1) 1433/  FF0B1A : DCFC 0002           		adda	#2,a6
(1) 1434/  FF0B1E : B47C 0007           		cmp.w	#%111,d2
(1) 1435/  FF0B22 : 6608                		bne.s	.no_fnsh
(1) 1436/  FF0B24 : 4846                		swap	d6
(1) 1437/  FF0B26 : 9C7C 0001           		sub.w	#1,d6
(1) 1438/  FF0B2A : 4846                		swap	d6
(1) 1439/  FF0B2C :                     .no_fnsh:
(1) 1440/  FF0B2C : 51C8 FF7C           		dbf	d0,.nxt_pal
(1) 1441/  FF0B30 : 4846                		swap	d6
(1) 1442/  FF0B32 : 4A46                		tst.w	d6
(1) 1443/  FF0B34 : 6604                		bne.s	.no_move
(1) 1444/  FF0B36 : 4278 A6E2           		clr.w	(RAM_FadeMarsReq).w
(1) 1445/  FF0B3A :                     .no_move:
(1) 1446/  FF0B3A : 4E75                		rts
(1) 1447/  FF0B3C :                     
(1) 1448/  FF0B3C :                     ; --------------------------------------------
(1) 1449/  FF0B3C :                     ; Fade out
(1) 1450/  FF0B3C :                     ; --------------------------------------------
(1) 1451/  FF0B3C :                     
(1) 1452/  FF0B3C :                     .fade_out:
(1) 1453/  FF0B3C : 4DF8 AB60           		lea	(RAM_MdDreq+Dreq_Palette).w,a6
(1) 1454/  FF0B40 : 303C 0100           		move.w	#256,d0				; Num of colors
(1) 1455/  FF0B44 : 3238 A6E4           		move.w	(RAM_FadeMarsIncr).w,d1		; Speed
(1) 1456/  FF0B48 : 3C00                		move.w	d0,d6
(1) 1457/  FF0B4A : 4846                		swap	d6
(1) 1458/  FF0B4C : 907C 0001           		sub.w	#1,d0
(1) 1459/  FF0B50 :                     .nxt_pal_o:
(1) 1460/  FF0B50 : 4242                		clr.w	d2		; Reset finished colorbits
(1) 1461/  FF0B52 : 3E16                		move.w	(a6),d7		; d7 - Input
(1) 1462/  FF0B54 : 3C07                		move.w	d7,d6
(1) 1463/  FF0B56 : CE7C FFE0           		and.w	#%1111111111100000,d7
(1) 1464/  FF0B5A : CC7C 001F           		and.w	#%0000000000011111,d6
(1) 1465/  FF0B5E : 9C41                		sub.w	d1,d6
(1) 1466/  FF0B60 : 6A06                		bpl.s	.no_red_o
(1) 1467/  FF0B62 : 4246                		clr.w	d6
(1) 1468/  FF0B64 : 847C 0001           		or.w	#%001,d2	; RED is ready
(1) 1469/  FF0B68 :                     .no_red_o:
(1) 1470/  FF0B68 : 8E46                		or.w	d6,d7
(1) 1471/  FF0B6A : EB49                		lsl.w	#5,d1
(1) 1472/  FF0B6C : 3C07                		move.w	d7,d6
(1) 1473/  FF0B6E : CE7C FC1F           		and.w	#%1111110000011111,d7
(1) 1474/  FF0B72 : CC7C 03E0           		and.w	#%0000001111100000,d6
(1) 1475/  FF0B76 : 9C41                		sub.w	d1,d6
(1) 1476/  FF0B78 : 6A06                		bpl.s	.no_grn_o
(1) 1477/  FF0B7A : 4246                		clr.w	d6
(1) 1478/  FF0B7C : 847C 0002           		or.w	#%010,d2	; GREEN is ready
(1) 1479/  FF0B80 :                     .no_grn_o:
(1) 1480/  FF0B80 : 8E46                		or.w	d6,d7
(1) 1481/  FF0B82 : EB49                		lsl.w	#5,d1
(1) 1482/  FF0B84 : 3C07                		move.w	d7,d6
(1) 1483/  FF0B86 : CE7C 83FF           		and.w	#%1000001111111111,d7
(1) 1484/  FF0B8A : CC7C 7C00           		and.w	#%0111110000000000,d6
(1) 1485/  FF0B8E : 9C41                		sub.w	d1,d6
(1) 1486/  FF0B90 : 6A06                		bpl.s	.no_blu_o
(1) 1487/  FF0B92 : 4246                		clr.w	d6
(1) 1488/  FF0B94 : 847C 0004           		or.w	#%100,d2	; BLUE is ready
(1) 1489/  FF0B98 :                     .no_blu_o:
(1) 1490/  FF0B98 : 8E46                		or.w	d6,d7
(1) 1491/  FF0B9A : E049                		lsr.w	#8,d1
(1) 1492/  FF0B9C : E449                		lsr.w	#2,d1
(1) 1493/  FF0B9E : 3CC7                		move.w	d7,(a6)+
(1) 1494/  FF0BA0 : B47C 0007           		cmp.w	#%111,d2
(1) 1495/  FF0BA4 : 6608                		bne.s	.no_fnsh_o
(1) 1496/  FF0BA6 : 4846                		swap	d6
(1) 1497/  FF0BA8 : 9C7C 0001           		sub.w	#1,d6
(1) 1498/  FF0BAC : 4846                		swap	d6
(1) 1499/  FF0BAE :                     .no_fnsh_o:
(1) 1500/  FF0BAE : 51C8 FFA0           		dbf	d0,.nxt_pal_o
(1) 1501/  FF0BB2 : 4846                		swap	d6
(1) 1502/  FF0BB4 : 4A46                		tst.w	d6
(1) 1503/  FF0BB6 : 6604                		bne.s	.no_move_o
(1) 1504/  FF0BB8 : 4278 A6E2           		clr.w	(RAM_FadeMarsReq).w
(1) 1505/  FF0BBC :                     .no_move_o:
(1) 1506/  FF0BBC : 4E75                		rts
(1) 1507/  FF0BBE :                     
(1) 1508/  FF0BBE :                     ; ====================================================================
(1) 1509/  FF0BBE :                     ; ----------------------------------------------------------------
(1) 1510/  FF0BBE :                     ; MAP layout system
(1) 1511/  FF0BBE :                     ;
(1) 1512/  FF0BBE :                     ; Note: uses some RAM'd video registers.
(1) 1513/  FF0BBE :                     ; ----------------------------------------------------------------
(1) 1514/  FF0BBE :                     
(1) 1515/  FF0BBE :                     ; --------------------------------------------------------
(1) 1516/  FF0BBE :                     ; MdMap_Init
(1) 1517/  FF0BBE :                     ;
(1) 1518/  FF0BBE :                     ; Initializes all BG buffers
(1) 1519/  FF0BBE :                     ; --------------------------------------------------------
(1) 1520/  FF0BBE :                     
(1) 1521/  FF0BBE :                     MdMap_Init:
(1) 1522/  FF0BBE : 41F8 9820           		lea	(RAM_BgBuffer),a0
(1) 1523/  FF0BC2 : 323C 0037           		move.w	#((sizeof_mdbg*4)/4)-1,d1
(1) 1524/  FF0BC6 : 7000                		moveq	#0,d0
(1) 1525/  FF0BC8 :                     .clr:
(1) 1526/  FF0BC8 : 20C0                		move.l	d0,(a0)+
(1) 1527/  FF0BCA : 51C9 FFFC           		dbf	d1,.clr
(1) 1528/  FF0BCE : 4E75                		rts
(1) 1529/  FF0BD0 :                     
(1) 1530/  FF0BD0 :                     ; --------------------------------------------------------
(1) 1531/  FF0BD0 :                     ; MdMap_Set
(1) 1532/  FF0BD0 :                     ;
(1) 1533/  FF0BD0 :                     ; Sets a new scrolling section to use.
(1) 1534/  FF0BD0 :                     ;
(1) 1535/  FF0BD0 :                     ; **SET YOUR X and Y COORDS EXTERNALLY
(1) 1536/  FF0BD0 :                     ; BEFORE GETTING HERE**
(1) 1537/  FF0BD0 :                     ;
(1) 1538/  FF0BD0 :                     ; Input:
(1) 1539/  FF0BD0 :                     ; ** Genesis side **
(1) 1540/  FF0BD0 :                     ; d0 | WORD - BG internal slot (-1: 32X only)
(1) 1541/  FF0BD0 :                     ; d1 | WORD - VRAM location for map data
(1) 1542/  FF0BD0 :                     ; d2 | WORD - VRAM add + palette
(1) 1543/  FF0BD0 :                     ; a0 - Level header data:
(1) 1544/  FF0BD0 :                     ; 	dc.w width,height
(1) 1545/  FF0BD0 :                     ; 	dc.b blkwidth,blkheight
(1) 1546/  FF0BD0 :                     ; a1 - Block data
(1) 1547/  FF0BD0 :                     ; a2 - LOW priority layout data
(1) 1548/  FF0BD0 :                     ; a3 - HIGH priority layout data
(1) 1549/  FF0BD0 :                     ; d4 - Collision data
(1) 1550/  FF0BD0 :                     ;
(1) 1551/  FF0BD0 :                     ; Then load the graphics externally at the same
(1) 1552/  FF0BD0 :                     ; VRAM location set in d2
(1) 1553/  FF0BD0 :                     ;
(1) 1554/  FF0BD0 :                     ; ** 32X side **
(1) 1555/  FF0BD0 :                     ; d0 | WORD - Write as -1
(1) 1556/  FF0BD0 :                     ; d1 | WORD - Scroll buffer to use on the 32X side (0 - default)
(1) 1557/  FF0BD0 :                     ; d2 | WORD - Index-palette increment
(1) 1558/  FF0BD0 :                     ; a0 - Level header data: (68K AREA)
(1) 1559/  FF0BD0 :                     ; 	dc.w width,height
(1) 1560/  FF0BD0 :                     ; 	dc.b blkwidth,blkheight
(1) 1561/  FF0BD0 :                     ; a1 - Graphics data stored as blocks (SH2 AREA)
(1) 1562/  FF0BD0 :                     ; a2 - MAIN layout (SH2 AREA)
(1) 1563/  FF0BD0 :                     ; a3 - SUB layout (**If needed later, set to 0)
(1) 1564/  FF0BD0 :                     ; a4 - Collision data (68K AREA)
(1) 1565/  FF0BD0 :                     ;
(1) 1566/  FF0BD0 :                     ; Uses:
(1) 1567/  FF0BD0 :                     ; d0,d6-d7
(1) 1568/  FF0BD0 :                     ; --------------------------------------------------------
(1) 1569/  FF0BD0 :                     
(1) 1570/  FF0BD0 :                     MdMap_Set:
(1) 1571/  FF0BD0 : 4A40                		tst.w	d0
(1) 1572/  FF0BD2 : 6A0C                		bpl.s	.md_side
(1) 1573/  FF0BD4 : 4DF8 AD60           		lea	(RAM_BgBufferM),a6
(1) 1574/  FF0BD8 : 08EE 0006 0003      		bset	#bitMarsBg,md_bg_flags(a6)
(1) 1575/  FF0BDE : 6010                		bra.s	.mars_side
(1) 1576/  FF0BE0 :                     .md_side:
(1) 1577/  FF0BE0 : 4DF8 9820           		lea	(RAM_BgBuffer),a6
(1) 1578/  FF0BE4 : C0FC 0038           		mulu.w	#sizeof_mdbg,d0
(1) 1579/  FF0BE8 : DCC0                		adda	d0,a6
(1) 1580/  FF0BEA : 08AE 0006 0003      		bclr	#bitMarsBg,md_bg_flags(a6)
(1) 1581/  FF0BF0 :                     .mars_side:
(1) 1582/  FF0BF0 : 3D41 001C           		move.w	d1,md_bg_vpos(a6)
(1) 1583/  FF0BF4 : 3D42 001E           		move.w	d2,md_bg_vram(a6)
(1) 1584/  FF0BF8 :                     
(1) 1585/  FF0BF8 : 7E00                		moveq	#0,d7
(1) 1586/  FF0BFA : 3E2E 0030           		move.w	md_bg_x(a6),d7
(1) 1587/  FF0BFE : 1D47 0004           		move.b	d7,md_bg_xset(a6)
(1) 1588/  FF0C02 : 3D47 0018           		move.w	d7,md_bg_x_old(a6)
(1) 1589/  FF0C06 : 4847                		swap	d7
(1) 1590/  FF0C08 : 2D47 0030           		move.l	d7,md_bg_x(a6)
(1) 1591/  FF0C0C : 7E00                		moveq	#0,d7
(1) 1592/  FF0C0E : 3E2E 0034           		move.w	md_bg_y(a6),d7
(1) 1593/  FF0C12 : 1D47 0005           		move.b	d7,md_bg_yset(a6)
(1) 1594/  FF0C16 : 3D47 001A           		move.w	d7,md_bg_y_old(a6)
(1) 1595/  FF0C1A : 4847                		swap	d7
(1) 1596/  FF0C1C : 2D47 0034           		move.l	d7,md_bg_y(a6)
(1) 1597/  FF0C20 : C67C 000F           		and.w	#$F,d3
(1) 1598/  FF0C24 : C87C 000F           		and.w	#$F,d4
(1) 1599/  FF0C28 :                     
(1) 1600/  FF0C28 : 4843                		swap	d3
(1) 1601/  FF0C2A : 4844                		swap	d4
(1) 1602/  FF0C2C : 2D49 0028           		move.l	a1,md_bg_blk(a6)
(1) 1603/  FF0C30 : 2D4A 0020           		move.l	a2,md_bg_low(a6)
(1) 1604/  FF0C34 : 2D4B 0024           		move.l	a3,md_bg_hi(a6)
(1) 1605/  FF0C38 : 2D4C 002C           		move.l	a4,md_bg_col(a6)
(1) 1606/  FF0C3C : 2A48                		move.l	a0,a5
(1) 1607/  FF0C3E : 3E1D                		move.w	(a5)+,d7	; Layout Width (blocks)
(1) 1608/  FF0C40 : 3C1D                		move.w	(a5)+,d6	; Layout Height (blocks)
(1) 1609/  FF0C42 : 181D                		move.b	(a5)+,d4	; BLOCK width
(1) 1610/  FF0C44 : 161D                		move.b	(a5)+,d3	; BLOCK height
(1) 1611/  FF0C46 : C87C 00FF           		and.w	#$FF,d4
(1) 1612/  FF0C4A : C67C 00FF           		and.w	#$FF,d3
(1) 1613/  FF0C4E : 3D47 0008           		move.w	d7,md_bg_w(a6)
(1) 1614/  FF0C52 : 3D46 000A           		move.w	d6,md_bg_h(a6)
(1) 1615/  FF0C56 : 1C84                		move.b	d4,md_bg_bw(a6)
(1) 1616/  FF0C58 : 1D43 0001           		move.b	d3,md_bg_bh(a6)
(1) 1617/  FF0C5C : CEC4                		mulu.w	d4,d7
(1) 1618/  FF0C5E : CCC3                		mulu.w	d3,d6
(1) 1619/  FF0C60 : 3D47 000C           		move.w	d7,md_bg_wf(a6)
(1) 1620/  FF0C64 : 3D46 000E           		move.w	d6,md_bg_hf(a6)
(1) 1621/  FF0C68 : 987C 0001           		sub.w	#1,d4
(1) 1622/  FF0C6C : 967C 0001           		sub.w	#1,d3
(1) 1623/  FF0C70 : C92E 0004           		and.b	d4,md_bg_xset(a6)
(1) 1624/  FF0C74 : C72E 0005           		and.b	d3,md_bg_yset(a6)
(1) 1625/  FF0C78 : 4843                		swap	d3
(1) 1626/  FF0C7A : 4844                		swap	d4
(1) 1627/  FF0C7C :                     
(1) 1628/  FF0C7C :                     	; TODO: improve this...
(1) 1629/  FF0C7C : 362E 0030           		move.w	md_bg_x(a6),d3
(1) 1630/  FF0C80 : 382E 0034           		move.w	md_bg_y(a6),d4
(1) 1631/  FF0C84 :                     	; X beams
(1) 1632/  FF0C84 : B647                .xl_l:		cmp.w	d7,d3
(1) 1633/  FF0C86 : 6D04                		blt.s	.xl_g
(1) 1634/  FF0C88 : 9647                		sub.w	d7,d3
(1) 1635/  FF0C8A : 60F8                		bra.s	.xl_l
(1) 1636/  FF0C8C :                     .xl_g:
(1) 1637/  FF0C8C : 3D43 0010           		move.w	d3,md_bg_xinc_l(a6)
(1) 1638/  FF0C90 : D67C 0140           		add.w	#320,d3				; <-- X resolution R
(1) 1639/  FF0C94 : B647                .xr_l:		cmp.w	d7,d3
(1) 1640/  FF0C96 : 6D04                		blt.s	.xr_g
(1) 1641/  FF0C98 : 9647                		sub.w	d7,d3
(1) 1642/  FF0C9A : 60F8                		bra.s	.xr_l
(1) 1643/  FF0C9C :                     .xr_g:
(1) 1644/  FF0C9C : 3D43 0012           		move.w	d3,md_bg_xinc_r(a6)
(1) 1645/  FF0CA0 :                     
(1) 1646/  FF0CA0 :                     	; Y beams
(1) 1647/  FF0CA0 : B846                .yt_l:		cmp.w	d6,d4
(1) 1648/  FF0CA2 : 6D04                		blt.s	.yt_g
(1) 1649/  FF0CA4 : 9846                		sub.w	d6,d4
(1) 1650/  FF0CA6 : 60F8                		bra.s	.yt_l
(1) 1651/  FF0CA8 :                     .yt_g:
(1) 1652/  FF0CA8 : 3D44 0014           		move.w	d4,md_bg_yinc_u(a6)
(1) 1653/  FF0CAC : D87C 00E0           		add.w	#224,d4				; <-- Y resolution B
(1) 1654/  FF0CB0 : B846                .yb_l:		cmp.w	d6,d4
(1) 1655/  FF0CB2 : 6D04                		blt.s	.yb_g
(1) 1656/  FF0CB4 : 9846                		sub.w	d6,d4
(1) 1657/  FF0CB6 : 60F8                		bra.s	.yb_l
(1) 1658/  FF0CB8 :                     .yb_g:
(1) 1659/  FF0CB8 : 3D44 0016           		move.w	d4,md_bg_yinc_d(a6)
(1) 1660/  FF0CBC :                     
(1) 1661/  FF0CBC : 08EE 0007 0003      		bset	#bitBgOn,md_bg_flags(a6)	; Enable this BG
(1) 1662/  FF0CC2 : 4E75                		rts
(1) 1663/  FF0CC4 :                     
(1) 1664/  FF0CC4 :                     ; --------------------------------------------------------
(1) 1665/  FF0CC4 :                     ; MdMap_Move
(1) 1666/  FF0CC4 :                     ;
(1) 1667/  FF0CC4 :                     ; Moves the current background/foreground
(1) 1668/  FF0CC4 :                     ; and checks for overflow.
(1) 1669/  FF0CC4 :                     ;
(1) 1670/  FF0CC4 :                     ; Input:
(1) 1671/  FF0CC4 :                     ; d0 | WORD - Background slot, if -1 32X's
(1) 1672/  FF0CC4 :                     ; d1 | WORD - Current X position
(1) 1673/  FF0CC4 :                     ; d2 | WORD - Current Y position
(1) 1674/  FF0CC4 :                     ; a0 - Background to move and check.
(1) 1675/  FF0CC4 :                     ;
(1) 1676/  FF0CC4 :                     ; Uses:
(1) 1677/  FF0CC4 :                     ; d6-d7
(1) 1678/  FF0CC4 :                     ; --------------------------------------------------------
(1) 1679/  FF0CC4 :                     
(1) 1680/  FF0CC4 :                     MdMap_Move:
(1) 1681/  FF0CC4 : 4DF8 AD60           		lea	(RAM_BgBufferM),a6
(1) 1682/  FF0CC8 : 4A40                		tst.w	d0
(1) 1683/  FF0CCA : 6B0A                		bmi.s	.mars_side
(1) 1684/  FF0CCC : 4DF8 9820           		lea	(RAM_BgBuffer),a6
(1) 1685/  FF0CD0 : C0FC 0038           		mulu.w	#sizeof_mdbg,d0
(1) 1686/  FF0CD4 : DCC0                		adda	d0,a6
(1) 1687/  FF0CD6 :                     .mars_side:
(1) 1688/  FF0CD6 :                     ; 		btst	#bitBgOn,md_bg_flags(a6)
(1) 1689/  FF0CD6 :                     ; 		beq	.not_enabld
(1) 1690/  FF0CD6 : 302E 000C           		move.w	md_bg_wf(a6),d0
(1) 1691/  FF0CDA : 4A41                		tst.w	d1
(1) 1692/  FF0CDC : 6A02                		bpl.s	.x_left
(1) 1693/  FF0CDE : 4241                		clr.w	d1
(1) 1694/  FF0CE0 :                     .x_left:
(1) 1695/  FF0CE0 : 907C 0140           		sub.w	#320,d0
(1) 1696/  FF0CE4 : B240                		cmp.w	d0,d1
(1) 1697/  FF0CE6 : 6502                		bcs.s	.x_right
(1) 1698/  FF0CE8 : 3200                		move.w	d0,d1
(1) 1699/  FF0CEA :                     .x_right:
(1) 1700/  FF0CEA : 302E 000E           		move.w	md_bg_hf(a6),d0
(1) 1701/  FF0CEE : 4A42                		tst.w	d2
(1) 1702/  FF0CF0 : 6A02                		bpl.s	.y_left
(1) 1703/  FF0CF2 : 4242                		clr.w	d2
(1) 1704/  FF0CF4 :                     .y_left:
(1) 1705/  FF0CF4 : 907C 00E0           		sub.w	#224,d0
(1) 1706/  FF0CF8 : B440                		cmp.w	d0,d2
(1) 1707/  FF0CFA : 6502                		bcs.s	.y_right
(1) 1708/  FF0CFC : 3400                		move.w	d0,d2
(1) 1709/  FF0CFE :                     .y_right:
(1) 1710/  FF0CFE : 3D41 0030           		move.w	d1,md_bg_x(a6)
(1) 1711/  FF0D02 : 3D42 0034           		move.w	d2,md_bg_y(a6)
(1) 1712/  FF0D06 :                     .not_enabld:
(1) 1713/  FF0D06 : 4E75                		rts
(1) 1714/  FF0D08 :                     
(1) 1715/  FF0D08 :                     ; --------------------------------------------------------
(1) 1716/  FF0D08 :                     ; MdMap_Update
(1) 1717/  FF0D08 :                     ;
(1) 1718/  FF0D08 :                     ; Updates backgrounds internally, call this
(1) 1719/  FF0D08 :                     ; BEFORE going into VBlank.
(1) 1720/  FF0D08 :                     ;
(1) 1721/  FF0D08 :                     ; Then later call MdMap_DrawScrl on VBlank,
(1) 1722/  FF0D08 :                     ; this also applies for the 32X as this routine also
(1) 1723/  FF0D08 :                     ; resets the drawing bits.
(1) 1724/  FF0D08 :                     ;
(1) 1725/  FF0D08 :                     ; For the 32X:
(1) 1726/  FF0D08 :                     ; Call System_MarsUpdate AFTER this.
(1) 1727/  FF0D08 :                     ; --------------------------------------------------------
(1) 1728/  FF0D08 :                     
(1) 1729/  FF0D08 :                     MdMap_Update:
(1) 1730/  FF0D08 : 4DF8 AD60           		lea	(RAM_BgBufferM),a6
(1) 1731/  FF0D0C : 610A                		bsr.s	.this_bg
(1) 1732/  FF0D0E : 4DF8 9820           		lea	(RAM_BgBuffer),a6
(1) 1733/  FF0D12 : 6104                		bsr.s	.this_bg
(1) 1734/  FF0D14 : DCFC 0038           		adda	#sizeof_mdbg,a6
(1) 1735/  FF0D18 :                     .this_bg:
(1) 1736/  FF0D18 : 082E 0007 0003      		btst	#bitBgOn,md_bg_flags(a6)
(1) 1737/  FF0D1E : 6700 00AE           		beq	.no_bg
(1) 1738/  FF0D22 : 7200                		moveq	#0,d1
(1) 1739/  FF0D24 : 7400                		moveq	#0,d2
(1) 1740/  FF0D26 : 362E 0030           		move.w	md_bg_x(a6),d3
(1) 1741/  FF0D2A : 302E 0018           		move.w	md_bg_x_old(a6),d0
(1) 1742/  FF0D2E : B640                		cmp.w	d0,d3
(1) 1743/  FF0D30 : 6708                		beq.s	.xequ
(1) 1744/  FF0D32 : 3203                		move.w	d3,d1
(1) 1745/  FF0D34 : 9240                		sub.w	d0,d1
(1) 1746/  FF0D36 : 3D43 0018           		move.w	d3,md_bg_x_old(a6)
(1) 1747/  FF0D3A :                     .xequ:
(1) 1748/  FF0D3A : 362E 0034           		move.w	md_bg_y(a6),d3
(1) 1749/  FF0D3E : 302E 001A           		move.w	md_bg_y_old(a6),d0
(1) 1750/  FF0D42 : B640                		cmp.w	d0,d3
(1) 1751/  FF0D44 : 6708                		beq.s	.yequ
(1) 1752/  FF0D46 : 3403                		move.w	d3,d2
(1) 1753/  FF0D48 : 9440                		sub.w	d0,d2
(1) 1754/  FF0D4A : 3D43 001A           		move.w	d3,md_bg_y_old(a6)
(1) 1755/  FF0D4E :                     .yequ:
(1) 1756/  FF0D4E :                     
(1) 1757/  FF0D4E :                     	; Increment drawing beams
(1) 1758/  FF0D4E : 3001                		move.w	d1,d0
(1) 1759/  FF0D50 : 3A2E 000C           		move.w	md_bg_wf(a6),d5
(1) 1760/  FF0D54 : 382E 0010           		move.w	md_bg_xinc_l(a6),d4
(1) 1761/  FF0D58 : 6176                		bsr.s	.beam_incr
(1) 1762/  FF0D5A : 3D44 0010           		move.w	d4,md_bg_xinc_l(a6)
(1) 1763/  FF0D5E : 382E 0012           		move.w	md_bg_xinc_r(a6),d4
(1) 1764/  FF0D62 : 616C                		bsr.s	.beam_incr
(1) 1765/  FF0D64 : 3D44 0012           		move.w	d4,md_bg_xinc_r(a6)
(1) 1766/  FF0D68 : 3002                		move.w	d2,d0
(1) 1767/  FF0D6A : 3A2E 000E           		move.w	md_bg_hf(a6),d5
(1) 1768/  FF0D6E : 382E 0014           		move.w	md_bg_yinc_u(a6),d4
(1) 1769/  FF0D72 : 615C                		bsr.s	.beam_incr
(1) 1770/  FF0D74 : 3D44 0014           		move.w	d4,md_bg_yinc_u(a6)
(1) 1771/  FF0D78 : 382E 0016           		move.w	md_bg_yinc_d(a6),d4
(1) 1772/  FF0D7C : 6152                		bsr.s	.beam_incr
(1) 1773/  FF0D7E : 3D44 0016           		move.w	d4,md_bg_yinc_d(a6)
(1) 1774/  FF0D82 :                     
(1) 1775/  FF0D82 :                     	; Update internal counters
(1) 1776/  FF0D82 : 7600                		moveq	#0,d3
(1) 1777/  FF0D84 : 1616                		move.b	md_bg_bw(a6),d3		; X set
(1) 1778/  FF0D86 : 102E 0004           		move.b	md_bg_xset(a6),d0
(1) 1779/  FF0D8A : D001                		add.b	d1,d0
(1) 1780/  FF0D8C : 1800                		move.b	d0,d4
(1) 1781/  FF0D8E : C843                		and.w	d3,d4
(1) 1782/  FF0D90 : 670C                		beq.s	.x_k
(1) 1783/  FF0D92 : 7800                		moveq	#bitDrwR,d4
(1) 1784/  FF0D94 : 4A41                		tst.w	d1
(1) 1785/  FF0D96 : 6A02                		bpl.s	.x_r
(1) 1786/  FF0D98 : 7801                		moveq	#bitDrwL,d4
(1) 1787/  FF0D9A :                     .x_r:
(1) 1788/  FF0D9A : 09EE 0003           		bset	d4,md_bg_flags(a6)
(1) 1789/  FF0D9E :                     .x_k:
(1) 1790/  FF0D9E : 967C 0001           		sub.w	#1,d3
(1) 1791/  FF0DA2 : C003                		and.b	d3,d0
(1) 1792/  FF0DA4 : 1D40 0004           		move.b	d0,md_bg_xset(a6)
(1) 1793/  FF0DA8 : 162E 0001           		move.b	md_bg_bh(a6),d3		; Y set
(1) 1794/  FF0DAC : 102E 0005           		move.b	md_bg_yset(a6),d0
(1) 1795/  FF0DB0 : D002                		add.b	d2,d0
(1) 1796/  FF0DB2 : 1800                		move.b	d0,d4
(1) 1797/  FF0DB4 : C843                		and.w	d3,d4
(1) 1798/  FF0DB6 : 670C                		beq.s	.y_k
(1) 1799/  FF0DB8 : 7802                		moveq	#bitDrwD,d4
(1) 1800/  FF0DBA : 4A42                		tst.w	d2
(1) 1801/  FF0DBC : 6A02                		bpl.s	.y_d
(1) 1802/  FF0DBE : 7803                		moveq	#bitDrwU,d4
(1) 1803/  FF0DC0 :                     .y_d:
(1) 1804/  FF0DC0 : 09EE 0003           		bset	d4,md_bg_flags(a6)
(1) 1805/  FF0DC4 :                     .y_k:
(1) 1806/  FF0DC4 : 967C 0001           		sub.w	#1,d3
(1) 1807/  FF0DC8 : C003                		and.b	d3,d0
(1) 1808/  FF0DCA : 1D40 0005           		move.b	d0,md_bg_yset(a6)
(1) 1809/  FF0DCE :                     .no_bg:
(1) 1810/  FF0DCE : 4E75                		rts
(1) 1811/  FF0DD0 :                     
(1) 1812/  FF0DD0 :                     ; d0 - Increment by
(1) 1813/  FF0DD0 :                     ; d4 - X/Y beam
(1) 1814/  FF0DD0 :                     ; d5 - Max Width/Height
(1) 1815/  FF0DD0 :                     .beam_incr:
(1) 1816/  FF0DD0 : D840                		add.w	d0,d4
(1) 1817/  FF0DD2 : 4A44                .xd_l:		tst.w	d4
(1) 1818/  FF0DD4 : 6A04                		bpl.s	.xd_g
(1) 1819/  FF0DD6 : D845                		add.w	d5,d4
(1) 1820/  FF0DD8 : 60F8                		bra.s	.xd_l
(1) 1821/  FF0DDA : B845                .xd_g:		cmp.w	d5,d4
(1) 1822/  FF0DDC : 6D04                		blt.s	.val_h
(1) 1823/  FF0DDE : 9845                		sub.w	d5,d4
(1) 1824/  FF0DE0 : 60F8                		bra.s	.xd_g
(1) 1825/  FF0DE2 :                     .val_h:
(1) 1826/  FF0DE2 : 4E75                		rts
(1) 1827/  FF0DE4 :                     
(1) 1828/  FF0DE4 :                     ; --------------------------------------------------------
(1) 1829/  FF0DE4 :                     ; MdMap_DrawAll
(1) 1830/  FF0DE4 :                     ;
(1) 1831/  FF0DE4 :                     ; Call this only if DISPLAY is OFF or in VBlank
(1) 1832/  FF0DE4 :                     ;
(1) 1833/  FF0DE4 :                     ; Notes:
(1) 1834/  FF0DE4 :                     ; - Does NOT check for off-bounds blocks
(1) 1835/  FF0DE4 :                     ; - Blocks with ID $00 are skipped.
(1) 1836/  FF0DE4 :                     ; --------------------------------------------------------
(1) 1837/  FF0DE4 :                     
(1) 1838/  FF0DE4 :                     MdMap_DrawAll:
(1) 1839/  FF0DE4 : 4DF8 9820           		lea	(RAM_BgBuffer),a6
(1) 1840/  FF0DE8 : 6104                		bsr	.this_bg
(1) 1841/  FF0DEA : DCFC 0038           		adda	#sizeof_mdbg,a6
(1) 1842/  FF0DEE :                     .this_bg:
(1) 1843/  FF0DEE : 082E 0007 0003      		btst	#bitBgOn,md_bg_flags(a6)
(1) 1844/  FF0DF4 : 6700 00E8           		beq	.no_bg
(1) 1845/  FF0DF8 : 2A6E 0028           		move.l	md_bg_blk(a6),a5
(1) 1846/  FF0DFC : 286E 0020           		move.l	md_bg_low(a6),a4
(1) 1847/  FF0E00 : 266E 0024           		move.l	md_bg_hi(a6),a3
(1) 1848/  FF0E04 : 302E 0030           		move.w	md_bg_x(a6),d0		; X start
(1) 1849/  FF0E08 : 322E 0034           		move.w	md_bg_y(a6),d1		; Y start
(1) 1850/  FF0E0C : 1416                		move.b	md_bg_bw(a6),d2
(1) 1851/  FF0E0E : 162E 0001           		move.b	md_bg_bh(a6),d3
(1) 1852/  FF0E12 : 382E 0008           		move.w	md_bg_w(a6),d4
(1) 1853/  FF0E16 :                     ; 		move.w	md_bg_wf(a6),d5
(1) 1854/  FF0E16 :                     ; 		move.w	md_bg_hf(a6),d6
(1) 1855/  FF0E16 :                     
(1) 1856/  FF0E16 : 7C00                		moveq	#0,d6
(1) 1857/  FF0E18 : 3C00                		move.w	d0,d6
(1) 1858/  FF0E1A : CC7C FFF0           		and.w	#-$10,d6
(1) 1859/  FF0E1E : E44E                		lsr.w	#2,d6
(1) 1860/  FF0E20 : CC7C 007F           		and.w	#$7F,d6
(1) 1861/  FF0E24 :                     
(1) 1862/  FF0E24 : 7A00                		moveq	#0,d5
(1) 1863/  FF0E26 : 3A01                		move.w	d1,d5
(1) 1864/  FF0E28 : CA7C FFF0           		and.w	#-$10,d5
(1) 1865/  FF0E2C : E94D                		lsl.w	#4,d5
(1) 1866/  FF0E2E : CA7C 0F00           		and.w	#$F00,d5
(1) 1867/  FF0E32 :                     
(1) 1868/  FF0E32 : DC45                		add.w	d5,d6
(1) 1869/  FF0E34 : DC6E 001C           		add.w	md_bg_vpos(a6),d6
(1) 1870/  FF0E38 : 3A06                		move.w	d6,d5
(1) 1871/  FF0E3A : E55E                		rol.w	#2,d6
(1) 1872/  FF0E3C : CC7C 0003           		and.w	#%11,d6
(1) 1873/  FF0E40 : 4846                		swap	d6
(1) 1874/  FF0E42 : CA7C 3FFF           		and.w	#$3FFF,d5
(1) 1875/  FF0E46 : 3C05                		move.w	d5,d6			; d6 - VDP 2nd|1st writes
(1) 1876/  FF0E48 :                     
(1) 1877/  FF0E48 : C47C 00FF           		and.w	#$FF,d2
(1) 1878/  FF0E4C : C1C2                		muls.w	d2,d0
(1) 1879/  FF0E4E : E048                		lsr.w	#8,d0
(1) 1880/  FF0E50 : C67C 00FF           		and.w	#$FF,d3
(1) 1881/  FF0E54 : C3C3                		muls.w	d3,d1
(1) 1882/  FF0E56 : E049                		lsr.w	#8,d1
(1) 1883/  FF0E58 : C3C4                		muls.w	d4,d1
(1) 1884/  FF0E5A : D081                		add.l	d1,d0
(1) 1885/  FF0E5C : D9C0                		add.l	d0,a4
(1) 1886/  FF0E5E : D7C0                		add.l	d0,a3
(1) 1887/  FF0E60 : 323C 0080           		move.w	#$80,d1
(1) 1888/  FF0E64 : 3601                		move.w	d1,d3
(1) 1889/  FF0E66 : 4841                		swap	d1
(1) 1890/  FF0E68 : 967C 0001           		sub.w	#1,d3
(1) 1891/  FF0E6C : 7400                		moveq	#0,d2
(1) 1892/  FF0E6E : 342E 001E           		move.w	md_bg_vram(a6),d2	; d2 - VRAM cell pos
(1) 1893/  FF0E72 : 4843                		swap	d3
(1) 1894/  FF0E74 : 363C 0004           		move.w	#4,d3			; d3 - X wrap | X next block
(1) 1895/  FF0E78 : 383C 0FFF           		move.w	#$0FFF,d4		; d4 - Y wrap | Y next block + bits
(1) 1896/  FF0E7C : 4844                		swap	d4
(1) 1897/  FF0E7E : 383C 0100           		move.w	#$100,d4
(1) 1898/  FF0E82 : 3005                		move.w	d5,d0
(1) 1899/  FF0E84 : 7A00                		moveq	#0,d5			; d5 - temporal | X-add read
(1) 1900/  FF0E86 : 3E3C 001F           		move.w	#(512/16)-1,d7		; d7 - X cells | Y cells
(1) 1901/  FF0E8A : 4847                		swap	d7
(1) 1902/  FF0E8C : 3E3C 000F           		move.w	#(256/16)-1,d7
(1) 1903/  FF0E90 :                     
(1) 1904/  FF0E90 :                     	; a6 - Current BG buffer
(1) 1905/  FF0E90 :                     	; a5 - Block-data base
(1) 1906/  FF0E90 :                     	; a4 - LOW layout data Y
(1) 1907/  FF0E90 :                     	; a3 - HI layout data Y
(1) 1908/  FF0E90 :                     	; a2 - a4 current
(1) 1909/  FF0E90 :                     	; a1 - a3 current
(1) 1910/  FF0E90 :                     	; a0 - Block-data read
(1) 1911/  FF0E90 :                     
(1) 1912/  FF0E90 :                     	; d7 - X loop        | Y loop
(1) 1913/  FF0E90 :                     	; d6 - VDP 2nd Write | X/Y VDP pos + addr bits
(1) 1914/  FF0E90 :                     	; d5 - X loop-save   | X VDP current
(1) 1915/  FF0E90 :                     	; d4 - Y wrap        | Y next block pos
(1) 1916/  FF0E90 :                     	; d3 - X wrap        | X next block pos
(1) 1917/  FF0E90 :                     	; d2 - Y block size  | VRAM-cell base
(1) 1918/  FF0E90 :                     	; d1 - Y-next line   | VRAM-cell read + prio
(1) 1919/  FF0E90 :                     	; d0 -    ---        | ---
(1) 1920/  FF0E90 :                     
(1) 1921/  FF0E90 :                     .y_loop:
(1) 1922/  FF0E90 : 4847                		swap	d7
(1) 1923/  FF0E92 : 244C                		move.l	a4,a2		; a2 - LOW line
(1) 1924/  FF0E94 : 224B                		move.l	a3,a1		; a1 - HI line
(1) 1925/  FF0E96 : 3A07                		move.w	d7,d5
(1) 1926/  FF0E98 :                     .x_loop:
(1) 1927/  FF0E98 : 4845                		swap	d5
(1) 1928/  FF0E9A : 3202                		move.w	d2,d1
(1) 1929/  FF0E9C : 1012                		move.b	(a2),d0		; HI block?
(1) 1930/  FF0E9E : 6608                		bne.s	.got_blk
(1) 1931/  FF0EA0 : D27C 8000           		add.w	#$8000,d1
(1) 1932/  FF0EA4 : 1011                		move.b	(a1),d0
(1) 1933/  FF0EA6 : 6702                		beq.s	.blank
(1) 1934/  FF0EA8 :                     .got_blk:
(1) 1935/  FF0EA8 : 6136                		bsr	.mk_block
(1) 1936/  FF0EAA :                     .blank:
(1) 1937/  FF0EAA : 2003                		move.l	d3,d0
(1) 1938/  FF0EAC : 4840                		swap	d0
(1) 1939/  FF0EAE : DA43                		add.w	d3,d5		; next VDP X pos
(1) 1940/  FF0EB0 : CA40                		and.w	d0,d5
(1) 1941/  FF0EB2 : D4FC 0001           		adda	#1,a2
(1) 1942/  FF0EB6 : D2FC 0001           		adda	#1,a1
(1) 1943/  FF0EBA : 4845                		swap	d5
(1) 1944/  FF0EBC : 51CD FFDA           		dbf	d5,.x_loop
(1) 1945/  FF0EC0 :                     
(1) 1946/  FF0EC0 : 3006                		move.w	d6,d0
(1) 1947/  FF0EC2 : C07C 3000           		and.w	#$3000,d0
(1) 1948/  FF0EC6 : DC44                		add.w	d4,d6		; <-- next VDP Y block
(1) 1949/  FF0EC8 : 4844                		swap	d4
(1) 1950/  FF0ECA : CC44                		and.w	d4,d6
(1) 1951/  FF0ECC : 8C40                		or.w	d0,d6
(1) 1952/  FF0ECE : 4844                		swap	d4
(1) 1953/  FF0ED0 :                     
(1) 1954/  FF0ED0 : 302E 0008           		move.w	md_bg_w(a6),d0 ; ***
(1) 1955/  FF0ED4 : D8C0                		adda	d0,a4
(1) 1956/  FF0ED6 : D6C0                		adda	d0,a3
(1) 1957/  FF0ED8 : 4847                		swap	d7
(1) 1958/  FF0EDA : 51CF FFB4           		dbf	d7,.y_loop
(1) 1959/  FF0EDE :                     .no_bg:
(1) 1960/  FF0EDE : 4E75                		rts
(1) 1961/  FF0EE0 :                     
(1) 1962/  FF0EE0 :                     ; barely got free regs without using stack
(1) 1963/  FF0EE0 :                     .mk_block:
(1) 1964/  FF0EE0 : 4842                		swap	d2
(1) 1965/  FF0EE2 : 204D                		move.l	a5,a0
(1) 1966/  FF0EE4 : C07C 00FF           		and.w	#$FF,d0
(1) 1967/  FF0EE8 : E748                		lsl.w	#3,d0		; * 8 bytes
(1) 1968/  FF0EEA : D0C0                		adda	d0,a0		; a0 - cell word data
(1) 1969/  FF0EEC : 3006                		move.w	d6,d0
(1) 1970/  FF0EEE : D045                		add.w	d5,d0
(1) 1971/  FF0EF0 : 807C 4000           		or.w	#$4000,d0
(1) 1972/  FF0EF4 : 4846                		swap	d6
(1) 1973/  FF0EF6 :                     
(1) 1974/  FF0EF6 :                     	; d0 - topleft VDP write | $4000
(1) 1975/  FF0EF6 :                     	; d6 - right VDP write
(1) 1976/  FF0EF6 :                     	; d2 is free
(1) 1977/  FF0EF6 :                     	;
(1) 1978/  FF0EF6 :                     	; currently working: 16x16
(1) 1979/  FF0EF6 : 610C                		bsr.s	.drwy_16	; 1-
(1) 1980/  FF0EF8 : D07C 0002           		add.w	#2,d0		; 2-
(1) 1981/  FF0EFC : 6106                		bsr.s	.drwy_16	; -3
(1) 1982/  FF0EFE :                     					; -4
(1) 1983/  FF0EFE : 4846                		swap	d6
(1) 1984/  FF0F00 : 4842                		swap	d2
(1) 1985/  FF0F02 : 4E75                		rts
(1) 1986/  FF0F04 :                     
(1) 1987/  FF0F04 :                     ; d0 - left vdp
(1) 1988/  FF0F04 :                     ; d6 - right vdp
(1) 1989/  FF0F04 :                     .drwy_16:
(1) 1990/  FF0F04 : 3400                		move.w	d0,d2
(1) 1991/  FF0F06 : 4840                		swap	d0
(1) 1992/  FF0F08 : 3018                		move.w	(a0)+,d0
(1) 1993/  FF0F0A : D041                		add.w	d1,d0
(1) 1994/  FF0F0C : 33C2 00C0 0004      		move.w	d2,(vdp_ctrl).l
(1) 1995/  FF0F12 : 33C6 00C0 0004      		move.w	d6,(vdp_ctrl).l
(1) 1996/  FF0F18 : 33C0 00C0 0000      		move.w	d0,(vdp_data).l
(1) 1997/  FF0F1E : 4841                		swap	d1
(1) 1998/  FF0F20 : D441                		add.w	d1,d2		; Next line
(1) 1999/  FF0F22 : 4841                		swap	d1
(1) 2000/  FF0F24 : 3018                		move.w	(a0)+,d0
(1) 2001/  FF0F26 : D041                		add.w	d1,d0
(1) 2002/  FF0F28 : 33C2 00C0 0004      		move.w	d2,(vdp_ctrl).l
(1) 2003/  FF0F2E : 33C6 00C0 0004      		move.w	d6,(vdp_ctrl).l
(1) 2004/  FF0F34 : 33C0 00C0 0000      		move.w	d0,(vdp_data).l
(1) 2005/  FF0F3A : 4840                		swap	d0
(1) 2006/  FF0F3C : 4E75                		rts
(1) 2007/  FF0F3E :                     
(1) 2008/  FF0F3E :                     	; Block: 16x16 as 13
(1) 2009/  FF0F3E :                     	;                 24
(1) 2010/  FF0F3E :                     	; d0 - block ID
(1) 2011/  FF0F3E :                     	; d1 - VRAM-add base
(1) 2012/  FF0F3E :                     	; d6 - VDP out R | VDP out L
(1) 2013/  FF0F3E :                     ; 		and.w	#$FF,d0
(1) 2014/  FF0F3E :                     ; 		lsl.w	#3,d0		; * 8 bytes
(1) 2015/  FF0F3E :                     ; 		move.l	(a5,d0.w),d2
(1) 2016/  FF0F3E :                     ; 		add.l	d1,d2
(1) 2017/  FF0F3E :                     ; 		swap	d2
(1) 2018/  FF0F3E :                     ; 		move.l	4(a5,d0.w),d3
(1) 2019/  FF0F3E :                     ; 		add.l	d1,d3
(1) 2020/  FF0F3E :                     ; 		swap	d3
(1) 2021/  FF0F3E :                     ; 		move.w	d6,d0
(1) 2022/  FF0F3E :                     ; 		swap	d5
(1) 2023/  FF0F3E :                     ; 		add.w	d5,d0
(1) 2024/  FF0F3E :                     ; 		or.w	#$4000,d0
(1) 2025/  FF0F3E :                     ; 		swap	d5
(1) 2026/  FF0F3E :                     ; 		move.l	a0,d1
(1) 2027/  FF0F3E :                     ; 		and.w	d1,d5
(1) 2028/  FF0F3E :                     ; 		add.w	d5,d0
(1) 2029/  FF0F3E :                     ; 		swap	d6
(1) 2030/  FF0F3E :                     ; 		move.w	d0,(vdp_ctrl).l
(1) 2031/  FF0F3E :                     ; 		move.w	d6,(vdp_ctrl).l
(1) 2032/  FF0F3E :                     ; 		move.w	d2,(vdp_data).l
(1) 2033/  FF0F3E :                     ; 		move.w	d3,(vdp_data).l
(1) 2034/  FF0F3E :                     ; 		swap	d2
(1) 2035/  FF0F3E :                     ; 		swap	d3
(1) 2036/  FF0F3E :                     ; 		add.w	#$80,d0		; line add
(1) 2037/  FF0F3E :                     ; 		move.w	d0,(vdp_ctrl).l
(1) 2038/  FF0F3E :                     ; 		move.w	d6,(vdp_ctrl).l
(1) 2039/  FF0F3E :                     ; 		move.w	d2,(vdp_data).l
(1) 2040/  FF0F3E :                     ; 		move.w	d3,(vdp_data).l
(1) 2041/  FF0F3E :                     ; 		swap	d6
(1) 2042/  FF0F3E :                     ; 		rts
(1) 2043/  FF0F3E :                     
(1) 2044/  FF0F3E :                     ; --------------------------------------------------------
(1) 2045/  FF0F3E :                     ; MdMap_DrawScrl
(1) 2046/  FF0F3E :                     ;
(1) 2047/  FF0F3E :                     ; Draw off-screen changes
(1) 2048/  FF0F3E :                     ; CALL THIS ON VBLANK ONLY, MUST BE QUICK.
(1) 2049/  FF0F3E :                     ; --------------------------------------------------------
(1) 2050/  FF0F3E :                     
(1) 2051/  FF0F3E :                     MdMap_DrawScrl:
(1) 2052/  FF0F3E :                     ; 		lea	(RAM_BgBufferM),a6	; <-- SH2 updates bits now.
(1) 2053/  FF0F3E :                     ; 		bsr	.this_bg
(1) 2054/  FF0F3E : 4DF8 9820           		lea	(RAM_BgBuffer),a6
(1) 2055/  FF0F42 : 4BF9 00C0 0000      		lea	(vdp_data),a5
(1) 2056/  FF0F48 : 6104                		bsr.s	.this_bg
(1) 2057/  FF0F4A : DCFC 0038           		adda	#sizeof_mdbg,a6
(1) 2058/  FF0F4E :                     .this_bg:
(1) 2059/  FF0F4E : 1E2E 0003           		move.b	md_bg_flags(a6),d7
(1) 2060/  FF0F52 : 0807 0007           		btst	#bitBgOn,d7
(1) 2061/  FF0F56 : 6758                		beq	.no_bg
(1) 2062/  FF0F58 : 302E 0030           		move.w	md_bg_x(a6),d0		; X start
(1) 2063/  FF0F5C : 322E 0034           		move.w	md_bg_y(a6),d1		; Y start
(1) 2064/  FF0F60 : 342E 0010           		move.w	md_bg_xinc_l(a6),d2
(1) 2065/  FF0F64 : 362E 0014           		move.w	md_bg_yinc_u(a6),d3
(1) 2066/  FF0F68 : 0887 0003           		bclr	#bitDrwU,d7
(1) 2067/  FF0F6C : 6704                		beq.s	.no_u
(1) 2068/  FF0F6E : 6100 00F4           		bsr	.mk_row
(1) 2069/  FF0F72 :                     .no_u:
(1) 2070/  FF0F72 : 0887 0002           		bclr	#bitDrwD,d7
(1) 2071/  FF0F76 : 670C                		beq.s	.no_d
(1) 2072/  FF0F78 : 362E 0016           		move.w	md_bg_yinc_d(a6),d3
(1) 2073/  FF0F7C : D27C 00E0           		add.w	#224,d1			; X add
(1) 2074/  FF0F80 : 6100 00E2           		bsr	.mk_row
(1) 2075/  FF0F84 :                     .no_d:
(1) 2076/  FF0F84 : 302E 0030           		move.w	md_bg_x(a6),d0		; X start
(1) 2077/  FF0F88 : 322E 0034           		move.w	md_bg_y(a6),d1		; Y start
(1) 2078/  FF0F8C : 342E 0010           		move.w	md_bg_xinc_l(a6),d2
(1) 2079/  FF0F90 : 362E 0014           		move.w	md_bg_yinc_u(a6),d3
(1) 2080/  FF0F94 : 0887 0001           		bclr	#bitDrwL,d7
(1) 2081/  FF0F98 : 6702                		beq.s	.no_l
(1) 2082/  FF0F9A : 6116                		bsr.s	.mk_clmn
(1) 2083/  FF0F9C :                     .no_l:
(1) 2084/  FF0F9C : 0887 0000           		bclr	#bitDrwR,d7
(1) 2085/  FF0FA0 : 670A                		beq.s	.no_r
(1) 2086/  FF0FA2 : 342E 0012           		move.w	md_bg_xinc_r(a6),d2
(1) 2087/  FF0FA6 : D07C 0140           		add.w	#320,d0			; X add
(1) 2088/  FF0FAA : 6106                		bsr.s	.mk_clmn
(1) 2089/  FF0FAC :                     .no_r:
(1) 2090/  FF0FAC :                     
(1) 2091/  FF0FAC : 1D47 0003           		move.b	d7,md_bg_flags(a6)
(1) 2092/  FF0FB0 :                     .no_bg:
(1) 2093/  FF0FB0 : 4E75                		rts
(1) 2094/  FF0FB2 :                     
(1) 2095/  FF0FB2 :                     ; ------------------------------------------------
(1) 2096/  FF0FB2 :                     ; Make column
(1) 2097/  FF0FB2 :                     ; d0 - X
(1) 2098/  FF0FB2 :                     ; d1 - Y
(1) 2099/  FF0FB2 :                     ; d2 - X increment
(1) 2100/  FF0FB2 :                     ; d3 - Y increment
(1) 2101/  FF0FB2 :                     ; ------------------------------------------------
(1) 2102/  FF0FB2 :                     
(1) 2103/  FF0FB2 :                     .mk_clmn:
(1) 2104/  FF0FB2 :                     ; 		btst	#bitMarsBg,d7
(1) 2105/  FF0FB2 :                     ; 		bne	.mars_ret_c
(1) 2106/  FF0FB2 : 4847                		swap	d7
(1) 2107/  FF0FB4 : 6100 016A           		bsr	.get_coords
(1) 2108/  FF0FB8 : 4840                		swap	d0
(1) 2109/  FF0FBA : 3004                		move.w	d4,d0
(1) 2110/  FF0FBC : 4840                		swap	d0
(1) 2111/  FF0FBE : 363C 0FFF           		move.w	#$FFF,d3
(1) 2112/  FF0FC2 : 4843                		swap	d3
(1) 2113/  FF0FC4 : 363C 0100           		move.w	#$100,d3
(1) 2114/  FF0FC8 :                     
(1) 2115/  FF0FC8 :                     	; d0 -    X curr | Current cell X/Y (1st)
(1) 2116/  FF0FC8 :                     	; d1 -    Y curr | VDP 1st write
(1) 2117/  FF0FC8 :                     	; d2 - Cell VRAM | VDP 2nd write
(1) 2118/  FF0FC8 :                     	; d3 -    Y wrap | Y add
(1) 2119/  FF0FC8 :                     	; d4 -         *****
(1) 2120/  FF0FC8 :                     	; d5 -         *****
(1) 2121/  FF0FC8 :                     	; d6 -         *****
(1) 2122/  FF0FC8 :                     	; d7 - lastflags | loop blocks
(1) 2123/  FF0FC8 :                     
(1) 2124/  FF0FC8 : 3E3C 000F           		move.w	#(256/16)-1,d7
(1) 2125/  FF0FCC :                     .y_blk:
(1) 2126/  FF0FCC : 7800                		moveq	#0,d4
(1) 2127/  FF0FCE : 7A00                		moveq	#0,d5
(1) 2128/  FF0FD0 : 1C13                		move.b	(a3),d6
(1) 2129/  FF0FD2 : 6616                		bne.s	.vld
(1) 2130/  FF0FD4 : 1C12                		move.b	(a2),d6
(1) 2131/  FF0FD6 : 6606                		bne.s	.prio
(1) 2132/  FF0FD8 :                     .blnk:
(1) 2133/  FF0FD8 : 7800                		moveq	#0,d4
(1) 2134/  FF0FDA : 7A00                		moveq	#0,d5
(1) 2135/  FF0FDC : 602E                		bra.s	.frce
(1) 2136/  FF0FDE :                     .prio:
(1) 2137/  FF0FDE : 283C 8000 8000      		move.l	#$80008000,d4
(1) 2138/  FF0FE4 : 2A3C 8000 8000      		move.l	#$80008000,d5
(1) 2139/  FF0FEA :                     .vld:
(1) 2140/  FF0FEA : 204C                		move.l	a4,a0
(1) 2141/  FF0FEC : CC7C 00FF           		and.w	#$FF,d6
(1) 2142/  FF0FF0 : E74E                		lsl.w	#3,d6
(1) 2143/  FF0FF2 : D0C6                		adda	d6,a0
(1) 2144/  FF0FF4 : 4842                		swap	d2
(1) 2145/  FF0FF6 : D858                		add.w	(a0)+,d4
(1) 2146/  FF0FF8 : DA58                		add.w	(a0)+,d5
(1) 2147/  FF0FFA : D842                		add.w	d2,d4
(1) 2148/  FF0FFC : DA42                		add.w	d2,d5
(1) 2149/  FF0FFE : 4844                		swap	d4
(1) 2150/  FF1000 : 4845                		swap	d5
(1) 2151/  FF1002 : D858                		add.w	(a0)+,d4
(1) 2152/  FF1004 : DA58                		add.w	(a0)+,d5
(1) 2153/  FF1006 : D842                		add.w	d2,d4
(1) 2154/  FF1008 : DA42                		add.w	d2,d5
(1) 2155/  FF100A : 4842                		swap	d2
(1) 2156/  FF100C :                     .frce:
(1) 2157/  FF100C : 3C00                		move.w	d0,d6
(1) 2158/  FF100E : DC41                		add.w	d1,d6
(1) 2159/  FF1010 : 8C7C 4000           		or.w	#$4000,d6
(1) 2160/  FF1014 : 3B46 0004           		move.w	d6,4(a5)
(1) 2161/  FF1018 : 3B42 0004           		move.w	d2,4(a5)
(1) 2162/  FF101C : 2A84                		move.l	d4,(a5)
(1) 2163/  FF101E : DC7C 0080           		add.w	#$80,d6
(1) 2164/  FF1022 : 3B46 0004           		move.w	d6,4(a5)
(1) 2165/  FF1026 : 3B42 0004           		move.w	d2,4(a5)
(1) 2166/  FF102A : 2A85                		move.l	d5,(a5)
(1) 2167/  FF102C : 2803                		move.l	d3,d4		; Next Y block
(1) 2168/  FF102E : 4844                		swap	d4
(1) 2169/  FF1030 : D043                		add.w	d3,d0
(1) 2170/  FF1032 : C044                		and.w	d4,d0
(1) 2171/  FF1034 : 3C2E 0008           		move.w	md_bg_w(a6),d6
(1) 2172/  FF1038 : D6C6                		adda	d6,a3
(1) 2173/  FF103A : D4C6                		adda	d6,a2
(1) 2174/  FF103C : 4841                		swap	d1		; <-- TODO: improve this later.
(1) 2175/  FF103E : D27C 0010           		add.w	#$10,d1
(1) 2176/  FF1042 : B26E 000E           		cmp.w	md_bg_hf(a6),d1
(1) 2177/  FF1046 : 6D12                		blt.s	.y_low
(1) 2178/  FF1048 : 4840                		swap	d0
(1) 2179/  FF104A : 4241                		clr.w	d1
(1) 2180/  FF104C : 266E 0020           		move.l	md_bg_low(a6),a3
(1) 2181/  FF1050 : 246E 0024           		move.l	md_bg_hi(a6),a2
(1) 2182/  FF1054 : D4C0                		adda	d0,a2
(1) 2183/  FF1056 : D6C0                		adda	d0,a3
(1) 2184/  FF1058 : 4840                		swap	d0
(1) 2185/  FF105A :                     .y_low:
(1) 2186/  FF105A : 4841                		swap	d1
(1) 2187/  FF105C :                     
(1) 2188/  FF105C : 51CF FF6E           		dbf	d7,.y_blk
(1) 2189/  FF1060 : 4847                		swap	d7
(1) 2190/  FF1062 :                     .mars_ret_c:
(1) 2191/  FF1062 : 4E75                		rts
(1) 2192/  FF1064 :                     
(1) 2193/  FF1064 :                     ; ------------------------------------------------
(1) 2194/  FF1064 :                     ; Make row
(1) 2195/  FF1064 :                     ; d0 - X
(1) 2196/  FF1064 :                     ; d1 - Y
(1) 2197/  FF1064 :                     ; d2 - X increment
(1) 2198/  FF1064 :                     ; d3 - Y increment
(1) 2199/  FF1064 :                     ; ------------------------------------------------
(1) 2200/  FF1064 :                     
(1) 2201/  FF1064 :                     .mk_row:
(1) 2202/  FF1064 :                     ; 		btst	#bitMarsBg,d7
(1) 2203/  FF1064 :                     ; 		bne.s	.mars_ret_c
(1) 2204/  FF1064 : 4847                		swap	d7
(1) 2205/  FF1066 : 6100 00B8           		bsr	.get_coords
(1) 2206/  FF106A : 4841                		swap	d1
(1) 2207/  FF106C : 3205                		move.w	d5,d1
(1) 2208/  FF106E : 4841                		swap	d1
(1) 2209/  FF1070 : 363C 007F           		move.w	#$7F,d3
(1) 2210/  FF1074 : 4843                		swap	d3
(1) 2211/  FF1076 : 363C 0004           		move.w	#4,d3
(1) 2212/  FF107A :                     
(1) 2213/  FF107A :                     	; d0 -    X curr | Current cell X/Y (1st)
(1) 2214/  FF107A :                     	; d1 -    Y curr | VDP 1st write
(1) 2215/  FF107A :                     	; d2 - Cell VRAM | VDP 2nd write
(1) 2216/  FF107A :                     	; d3 -    X wrap | X add
(1) 2217/  FF107A :                     	; d4 -         *****
(1) 2218/  FF107A :                     	; d5 -         *****
(1) 2219/  FF107A :                     	; d6 - loopflags | *****
(1) 2220/  FF107A :                     	; d7 - lastflags | loop blocks
(1) 2221/  FF107A :                     
(1) 2222/  FF107A : 3C00                		move.w	d0,d6
(1) 2223/  FF107C : CC7C FF00           		and.w	#-$100,d6	; Merge d1
(1) 2224/  FF1080 : D246                		add.w	d6,d1
(1) 2225/  FF1082 : 2A03                		move.l	d3,d5
(1) 2226/  FF1084 : 4845                		swap	d5
(1) 2227/  FF1086 : C045                		and.w	d5,d0
(1) 2228/  FF1088 : 3E3C 0014           		move.w	#((320+16)/16)-1,d7
(1) 2229/  FF108C :                     .x_blk:
(1) 2230/  FF108C : 7800                		moveq	#0,d4
(1) 2231/  FF108E : 7A00                		moveq	#0,d5
(1) 2232/  FF1090 : 1C13                		move.b	(a3),d6
(1) 2233/  FF1092 : 6616                		bne.s	.xvld
(1) 2234/  FF1094 : 1C12                		move.b	(a2),d6
(1) 2235/  FF1096 : 6606                		bne.s	.xprio
(1) 2236/  FF1098 :                     .xblnk:
(1) 2237/  FF1098 : 7800                		moveq	#0,d4
(1) 2238/  FF109A : 7A00                		moveq	#0,d5
(1) 2239/  FF109C : 602E                		bra.s	.xfrce
(1) 2240/  FF109E :                     .xprio:
(1) 2241/  FF109E : 283C 8000 8000      		move.l	#$80008000,d4
(1) 2242/  FF10A4 : 2A3C 8000 8000      		move.l	#$80008000,d5
(1) 2243/  FF10AA :                     .xvld:
(1) 2244/  FF10AA : 204C                		move.l	a4,a0
(1) 2245/  FF10AC : CC7C 00FF           		and.w	#$FF,d6
(1) 2246/  FF10B0 : E74E                		lsl.w	#3,d6
(1) 2247/  FF10B2 : D0C6                		adda	d6,a0
(1) 2248/  FF10B4 : 4842                		swap	d2
(1) 2249/  FF10B6 : D858                		add.w	(a0)+,d4
(1) 2250/  FF10B8 : DA58                		add.w	(a0)+,d5
(1) 2251/  FF10BA : D842                		add.w	d2,d4
(1) 2252/  FF10BC : DA42                		add.w	d2,d5
(1) 2253/  FF10BE : 4844                		swap	d4
(1) 2254/  FF10C0 : 4845                		swap	d5
(1) 2255/  FF10C2 : D858                		add.w	(a0)+,d4
(1) 2256/  FF10C4 : DA58                		add.w	(a0)+,d5
(1) 2257/  FF10C6 : D842                		add.w	d2,d4
(1) 2258/  FF10C8 : DA42                		add.w	d2,d5
(1) 2259/  FF10CA : 4842                		swap	d2
(1) 2260/  FF10CC :                     .xfrce:
(1) 2261/  FF10CC : 3C00                		move.w	d0,d6
(1) 2262/  FF10CE : DC41                		add.w	d1,d6
(1) 2263/  FF10D0 : 8C7C 4000           		or.w	#$4000,d6
(1) 2264/  FF10D4 : 3B46 0004           		move.w	d6,4(a5)
(1) 2265/  FF10D8 : 3B42 0004           		move.w	d2,4(a5)
(1) 2266/  FF10DC : 2A84                		move.l	d4,(a5)
(1) 2267/  FF10DE : DC7C 0080           		add.w	#$80,d6
(1) 2268/  FF10E2 : 3B46 0004           		move.w	d6,4(a5)
(1) 2269/  FF10E6 : 3B42 0004           		move.w	d2,4(a5)
(1) 2270/  FF10EA : 2A85                		move.l	d5,(a5)
(1) 2271/  FF10EC : D043                		add.w	d3,d0
(1) 2272/  FF10EE : 4843                		swap	d3
(1) 2273/  FF10F0 : C043                		and.w	d3,d0
(1) 2274/  FF10F2 : 4843                		swap	d3
(1) 2275/  FF10F4 :                     
(1) 2276/  FF10F4 :                     	; X wrap
(1) 2277/  FF10F4 : 4840                		swap	d0
(1) 2278/  FF10F6 : D07C 0010           		add.w	#$10,d0
(1) 2279/  FF10FA : B06E 000C           		cmp.w	md_bg_wf(a6),d0
(1) 2280/  FF10FE : 6D0E                		blt.s	.x_low
(1) 2281/  FF1100 : 906E 000C           		sub.w	md_bg_wf(a6),d0
(1) 2282/  FF1104 : 7800                		moveq	#0,d4
(1) 2283/  FF1106 : 382E 0008           		move.w	md_bg_w(a6),d4
(1) 2284/  FF110A : 95C4                		sub.l	d4,a2
(1) 2285/  FF110C : 97C4                		sub.l	d4,a3
(1) 2286/  FF110E :                     .x_low:
(1) 2287/  FF110E : D6FC 0001           		adda	#1,a3
(1) 2288/  FF1112 : D4FC 0001           		adda	#1,a2
(1) 2289/  FF1116 :                     .x_new:
(1) 2290/  FF1116 : 4840                		swap	d0
(1) 2291/  FF1118 :                     
(1) 2292/  FF1118 : 51CF FF72           		dbf	d7,.x_blk
(1) 2293/  FF111C : 4847                		swap	d7
(1) 2294/  FF111E : 4E75                		rts
(1) 2295/  FF1120 :                     
(1) 2296/  FF1120 :                     ; ------------------------------------------------
(1) 2297/  FF1120 :                     ; Input
(1) 2298/  FF1120 :                     ; d0 - X position
(1) 2299/  FF1120 :                     ; d1 - Y position
(1) 2300/  FF1120 :                     ; d2 - X increment beam
(1) 2301/  FF1120 :                     ; d3 - Y increment beam
(1) 2302/  FF1120 :                     ;
(1) 2303/  FF1120 :                     ; Out:
(1) 2304/  FF1120 :                     ; d4 - X LEFT increment
(1) 2305/  FF1120 :                     ; d5 - Y TOP increment
(1) 2306/  FF1120 :                     
(1) 2307/  FF1120 :                     .get_coords:
(1) 2308/  FF1120 : 286E 0028           		move.l	md_bg_blk(a6),a4
(1) 2309/  FF1124 : 266E 0020           		move.l	md_bg_low(a6),a3
(1) 2310/  FF1128 : 246E 0024           		move.l	md_bg_hi(a6),a2
(1) 2311/  FF112C : C07C FFF0           		and.w	#-$10,d0		; block X/Y limit
(1) 2312/  FF1130 : C27C FFF0           		and.w	#-$10,d1
(1) 2313/  FF1134 : C47C FFF0           		and.w	#-$10,d2
(1) 2314/  FF1138 : C67C FFF0           		and.w	#-$10,d3
(1) 2315/  FF113C : 4840                		swap	d0
(1) 2316/  FF113E : 4841                		swap	d1
(1) 2317/  FF1140 : 3002                		move.w	d2,d0
(1) 2318/  FF1142 : 3203                		move.w	d3,d1
(1) 2319/  FF1144 : 4840                		swap	d0
(1) 2320/  FF1146 : 4841                		swap	d1
(1) 2321/  FF1148 :                     
(1) 2322/  FF1148 : 7800                		moveq	#0,d4
(1) 2323/  FF114A : 7A00                		moveq	#0,d5
(1) 2324/  FF114C : 1C16                		move.b	md_bg_bw(a6),d6
(1) 2325/  FF114E : 1E2E 0001           		move.b	md_bg_bh(a6),d7
(1) 2326/  FF1152 : CC7C 00FF           		and.w	#$FF,d6
(1) 2327/  FF1156 : CE7C 00FF           		and.w	#$FF,d7
(1) 2328/  FF115A :                     
(1) 2329/  FF115A : 3802                		move.w	d2,d4
(1) 2330/  FF115C : C9C6                		muls.w	d6,d4
(1) 2331/  FF115E : E044                		asr.w	#8,d4
(1) 2332/  FF1160 : 3A03                		move.w	d3,d5
(1) 2333/  FF1162 : CBC7                		muls.w	d7,d5
(1) 2334/  FF1164 : E045                		asr.w	#8,d5
(1) 2335/  FF1166 : CBEE 0008           		muls.w	md_bg_w(a6),d5
(1) 2336/  FF116A : 7600                		moveq	#0,d3
(1) 2337/  FF116C : 2604                		move.l	d4,d3
(1) 2338/  FF116E : D685                		add.l	d5,d3
(1) 2339/  FF1170 : D7C3                		add.l	d3,a3
(1) 2340/  FF1172 : D5C3                		add.l	d3,a2
(1) 2341/  FF1174 :                     
(1) 2342/  FF1174 : 342E 001E           		move.w	md_bg_vram(a6),d2
(1) 2343/  FF1178 : 4842                		swap	d2
(1) 2344/  FF117A : E449                		lsr.w	#2,d1			; Y >> 2
(1) 2345/  FF117C : ED49                		lsl.w	#6,d1			; Y * $40
(1) 2346/  FF117E : E448                		lsr.w	#2,d0			; X >> 2
(1) 2347/  FF1180 : C27C 0FFF           		and.w	#$FFF,d1
(1) 2348/  FF1184 : C07C 007C           		and.w	#$7C,d0
(1) 2349/  FF1188 : D041                		add.w	d1,d0
(1) 2350/  FF118A : 322E 001C           		move.w	md_bg_vpos(a6),d1
(1) 2351/  FF118E : 3401                		move.w	d1,d2
(1) 2352/  FF1190 : C27C 3FFF           		and.w	#$3FFF,d1
(1) 2353/  FF1194 : E55A                		rol.w	#2,d2
(1) 2354/  FF1196 : C47C 0003           		and.w	#%11,d2
(1) 2355/  FF119A : 4E75                		rts
(1) 2356/  FF119C :                     
      41/  FF119C :                     		include	"system/md/system.asm"
(1)    1/  FF119C :                     ; ====================================================================
(1)    2/  FF119C :                     ; ----------------------------------------------------------------
(1)    3/  FF119C :                     ; Genesis system routines
(1)    4/  FF119C :                     ; ----------------------------------------------------------------
(1)    5/  FF119C :                     
(1)    6/  FF119C :                     ; ====================================================================
(1)    7/  FF119C :                     ; ----------------------------------------------------------------
(1)    8/  FF119C :                     ; RAM section
(1)    9/  FF119C :                     ; ----------------------------------------------------------------
(1)   10/  FF119C :                     
(1)   11/  FF119C : (MACRO)             		struct RAM_MdSystem
(1)   11/  FF119C : =$FF119C            GLBL_LASTPC     set *
(1)   11/    1A70 :                                     dephase
(1)   11/    1A70 : =$1A70              GLBL_LASTORG    set *
(1)   11/FFFFFFFFFFFFA702 :                                     phase RAM_MDSYSTEM
(1)   12/FFFFFFFFFFFFA702 :                     RAM_InputData	ds.b sizeof_input*4		; Input data section
(1)   13/FFFFFFFFFFFFA742 :                     RAM_SaveData	ds.b $200			; SRAM data cache
(1)   14/FFFFFFFFFFFFA942 :                     RAM_DmaCode	ds.b $200
(1)   15/FFFFFFFFFFFFAB42 :                     RAM_SysRandVal	ds.l 1				; Random value
(1)   16/FFFFFFFFFFFFAB46 :                     RAM_SysRandSeed	ds.l 1				; Randomness seed
(1)   17/FFFFFFFFFFFFAB4A :                     RAM_initflug	ds.l 1				; "INIT" flag
(1)   18/FFFFFFFFFFFFAB4E :                     RAM_MdMarsVInt	ds.w 3				; VBlank jump (JMP xxxx xxxx)
(1)   19/FFFFFFFFFFFFAB54 :                     RAM_MdMarsHint	ds.w 3				; HBlank jump (JMP xxxx xxxx)
(1)   20/FFFFFFFFFFFFAB5A :                     RAM_MdVBlkWait	ds.w 1
(1)   21/FFFFFFFFFFFFAB5C :                     RAM_SysFlags	ds.w 1				; Game engine flags (note: it's a byte)
(1)   22/FFFFFFFFFFFFAB5E :                     sizeof_mdsys	ds.l 0
(1)   23/FFFFFFFFFFFFAB5E : (MACRO)             		finish
(1)   23/FFFFFFFFFFFFA702 :                                     !org GLBL_LASTORG
(1)   23/  FF119C :                                     phase GLBL_LASTPC
(1)   24/  FF119C :                     
(1)   25/  FF119C :                     ; ====================================================================
(1)   26/  FF119C :                     ; --------------------------------------------------------
(1)   27/  FF119C :                     ; Init System
(1)   28/  FF119C :                     ; 
(1)   29/  FF119C :                     ; Uses:
(1)   30/  FF119C :                     ; a0-a2,d0-d1
(1)   31/  FF119C :                     ; --------------------------------------------------------
(1)   32/  FF119C :                     
(1)   33/  FF119C :                     System_Init:
(1)   34/  FF119C : 46FC 2700           		move.w	#$2700,sr		; Disable interrupts
(1)   35/  FF11A0 : 40E7                		move.w	sr,-(sp)
(1)   36/  FF11A2 : 33FC 0100 00A1 1100 		move.w	#$0100,(z80_bus).l	; Stop Z80
(1)   37/  FF11AA :                     .wait:
(1)   38/  FF11AA : 0839 0000 00A1 1100 		btst	#0,(z80_bus).l		; Wait for it
(1)   39/  FF11B2 : 66F6                		bne.s	.wait
(1)   40/  FF11B4 : 7040                		moveq	#%01000000,d0		; Init ports, TH=1
(1)   41/  FF11B6 : 13C0 00A1 0009      		move.b	d0,(sys_ctrl_1).l	; Controller 1
(1)   42/  FF11BC : 13C0 00A1 000B      		move.b	d0,(sys_ctrl_2).l	; Controller 2
(1)   43/  FF11C2 : 13C0 00A1 000D      		move.b	d0,(sys_ctrl_3).l	; Modem
(1)   44/  FF11C8 : 33FC 0000 00A1 1100 		move.w	#0,(z80_bus).l		; Enable Z80
(1)   45/  FF11D0 : 303C 4EF9           		move.w	#$4EF9,d0		; Set JMP opcode for the Hblank/VBlank jumps
(1)   46/  FF11D4 : 33C0 FFFF AB4E       		move.w	d0,(RAM_MdMarsVInt).l
(1)   47/  FF11DA : 33C0 FFFF AB54      		move.w	d0,(RAM_MdMarsHInt).l
(1)   48/  FF11E0 : 203C 5625 5769      		move.l	#$56255769,d0		; Set these random values
(1)   49/  FF11E6 : 223C 9511 6102      		move.l	#$95116102,d1
(1)   50/  FF11EC : 23C0 FFFF AB42      		move.l	d0,(RAM_SysRandVal).l
(1)   51/  FF11F2 : 23C1 FFFF AB46      		move.l	d1,(RAM_SysRandSeed).l
(1)   52/  FF11F8 : 203C 00FF 16CE      		move.l	#VInt_Default,d0	; Set default ints
(1)   53/  FF11FE : 223C 00FF 16E6      		move.l	#Hint_Default,d1
(1)   54/  FF1204 : 6100 0416           		bsr	System_SetInts
(1)   55/  FF1208 : 41F8 A702           		lea	(RAM_InputData),a0	; Clear input data buffer
(1)   56/  FF120C : 323C 0010           		move.w	#sizeof_input-1/2,d1
(1)   57/  FF1210 : 7000                		moveq	#0,d0
(1)   58/  FF1212 :                     .clrinput:
(1)   59/  FF1212 : 30FC 0000           		move.w	#0,(a0)+
(1)   60/  FF1216 : 51C9 FFFA           		dbf	d1,.clrinput
(1)   61/  FF121A : 46DF                		move.w	(sp)+,sr
(1)   62/  FF121C : 4E75                		rts
(1)   63/  FF121E :                     
(1)   64/  FF121E :                     ; 		lea	(vdp_ctrl),a6
(1)   65/  FF121E :                     ; .wait_in:	move.w	(a6),d4
(1)   66/  FF121E :                     ; 		btst	#bitVBlk,d4
(1)   67/  FF121E :                     ; 		beq.s	.wait_in
(1)   68/  FF121E :                     ; .wait_out:	move.w	(a6),d4
(1)   69/  FF121E :                     ; 		btst	#bitVBlk,d4
(1)   70/  FF121E :                     ; 		bne.s	.wait_out
(1)   71/  FF121E :                     ; 		bra	System_MarsUpdate
(1)   72/  FF121E :                     
(1)   73/  FF121E :                     ; --------------------------------------------------------
(1)   74/  FF121E :                     ; System_WaitFrame
(1)   75/  FF121E :                     ;
(1)   76/  FF121E :                     ; Call this to wait until the next frame.
(1)   77/  FF121E :                     ;
(1)   78/  FF121E :                     ; Before entering VBlank:
(1)   79/  FF121E :                     ; - The DREQ section from here will be transfered
(1)   80/  FF121E :                     ; to the 32X side then processed on the next
(1)   81/  FF121E :                     ; frame.
(1)   82/  FF121E :                     ;
(1)   83/  FF121E :                     ; Inside VBlank this will:
(1)   84/  FF121E :                     ; - Update the controller inputs
(1)   85/  FF121E :                     ; - Transfer the Genesis palette, sprites and scroll
(1)   86/  FF121E :                     ;   data from from RAM to VDP
(1)   87/  FF121E :                     ;   (Doesn't require the RV bit)
(1)   88/  FF121E :                     ; --------------------------------------------------------
(1)   89/  FF121E :                     
(1)   90/  FF121E :                     System_WaitFrame:
(1)   91/  FF121E : 4DF9 00C0 0004      		lea	(vdp_ctrl),a6
(1)   92/  FF1224 : 3816                .wait_lag:	move.w	(a6),d4
(1)   93/  FF1226 : 0804 0003           		btst	#bitVBlk,d4
(1)   94/  FF122A : 66F8                		bne.s	.wait_lag
(1)   95/  FF122C :                     ; 		bsr	Video_Mars_WaitFrame
(1)   96/  FF122C : 6100 00BA           		bsr	System_MarsUpdate
(1)   97/  FF1230 : 4DF9 00C0 0004      		lea	(vdp_ctrl),a6
(1)   98/  FF1236 : 3816                .wait_in:	move.w	(a6),d4			; We are on DISPLAY, wait for VBlank
(1)   99/  FF1238 : 0804 0003           		btst	#bitVBlk,d4
(1)  100/  FF123C : 67F8                		beq.s	.wait_in
(1)  101/  FF123E : 6100 00D4           		bsr	System_Input		; Read inputs FIRST
(1)  102/  FF1242 : 4DF9 00C0 0004      		lea	(vdp_ctrl),a6		; *** DMA'd Scroll and Palette
(1)  103/  FF1248 : 3E3C 8100           		move.w	#$8100,d7		; DMA ON
(1)  104/  FF124C : 1E38 A6EB           		move.b	(RAM_VdpRegs+1),d7
(1)  105/  FF1250 : 08C7 0004           		bset	#bitDmaEnbl,d7
(1)  106/  FF1254 : 3C87                		move.w	d7,(a6)
(1)  107/  FF1256 : 2CBC 9400 9328      		move.l	#$94009328,(a6)
(1)  108/  FF125C : 2CBC 96CE 9562      		move.l	#$96009500|(RAM_VerScroll<<7&$FF0000)|(RAM_VerScroll>>1&$FF),(a6)
(1)  109/  FF1262 : 3CBC 977F           		move.w	#$9700|(RAM_VerScroll>>17&$7F),(a6)
(1)  110/  FF1266 : 3CBC 4000           		move.w	#$4000,(a6)
(1)  111/  FF126A : 3F3C 0090           		move.w	#$0010|$80,-(sp)
(1)  112/  FF126E : 3C9F                		move.w	(sp)+,(a6)
(1)  113/  FF1270 : 2CBC 9401 93E0      		move.l	#$940193E0,(a6)
(1)  114/  FF1276 : 2CBC 96CC 9582      		move.l	#$96009500|(RAM_HorScroll<<7&$FF0000)|(RAM_HorScroll>>1&$FF),(a6)
(1)  115/  FF127C : 3CBC 977F           		move.w	#$9700|(RAM_HorScroll>>17&$7F),(a6)
(1)  116/  FF1280 : 3CBC 7C00           		move.w	#$7C00,(a6)
(1)  117/  FF1284 : 3F3C 0083           		move.w	#$0003|$80,-(sp)
(1)  118/  FF1288 : 3C9F                		move.w	(sp)+,(a6)
(1)  119/  FF128A : 2CBC 9401 93C0      		move.l	#$940193C0,(a6)
(1)  120/  FF1290 : 2CBC 96CE 958A      		move.l	#$96009500|(RAM_Sprites<<7&$FF0000)|(RAM_Sprites>>1&$FF),(a6)
(1)  121/  FF1296 : 3CBC 977F           		move.w	#$9700|(RAM_Sprites>>17&$7F),(a6)
(1)  122/  FF129A : 3CBC 7800           		move.w	#$7800,(a6)
(1)  123/  FF129E : 3F3C 0083           		move.w	#$0003|$80,-(sp)
(1)  124/  FF12A2 : 3C9F                		move.w	(sp)+,(a6)
(1)  125/  FF12A4 : 2CBC 9400 9340      		move.l	#$94009340,(a6)
(1)  126/  FF12AA : 2CBC 96D0 95BA      		move.l	#$96009500|(RAM_Palette<<7&$FF0000)|(RAM_Palette>>1&$FF),(a6)
(1)  127/  FF12B0 : 3CBC 977F           		move.w	#$9700|(RAM_Palette>>17&$7F),(a6)
(1)  128/  FF12B4 : 3CBC C000           		move.w	#$C000,(a6)
(1)  129/  FF12B8 : 3F3C 0080           		move.w	#$0000|$80,-(sp)
(1)  130/  FF12BC : 3C9F                		move.w	(sp)+,(a6)
(1)  131/  FF12BE : 3E3C 8100           		move.w	#$8100,d7
(1)  132/  FF12C2 : 1E38 A6EB           		move.b	(RAM_VdpRegs+1).w,d7
(1)  133/  FF12C6 : 3C87                		move.w	d7,(a6)
(1)  134/  FF12C8 :                     ; 		jsr	(Video_DmaBlast).l
(1)  135/  FF12C8 : 6100 FC74           		bsr	MdMap_DrawScrl
(1)  136/  FF12CC : 06B9 0000 0001 FFFF 		add.l	#1,(RAM_Framecount).l
                    9900                
(1)  137/  FF12D6 :                     
(1)  138/  FF12D6 :                     ; 		lea	(vdp_ctrl),a6
(1)  139/  FF12D6 :                     ; ; .wait_in:	move.w	(a6),d4
(1)  140/  FF12D6 :                     ; ; 		btst	#bitVBlk,d4
(1)  141/  FF12D6 :                     ; ; 		beq.s	.wait_in
(1)  142/  FF12D6 :                     ; .wait_out:	move.w	(a6),d4
(1)  143/  FF12D6 :                     ; 		btst	#bitVBlk,d4
(1)  144/  FF12D6 :                     ; 		bne.s	.wait_out
(1)  145/  FF12D6 :                     
(1)  146/  FF12D6 : 4E75                		rts
(1)  147/  FF12D8 :                     
(1)  148/  FF12D8 :                     ; --------------------------------------------------------
(1)  149/  FF12D8 :                     ; System_Dma_Enter, System_Dma_Exit
(1)  150/  FF12D8 :                     ;
(1)  151/  FF12D8 :                     ; Call these before entering or exiting any
(1)  152/  FF12D8 :                     ; DMA ROM-to-VDP transfer
(1)  153/  FF12D8 :                     ;
(1)  154/  FF12D8 :                     ; Your Sound driver's Z80 pause calls go here
(1)  155/  FF12D8 :                     ; --------------------------------------------------------
(1)  156/  FF12D8 :                     
(1)  157/  FF12D8 :                     System_Dma_Enter:
(1)  158/  FF12D8 : 4EB9 00FF 016A      		jsr	(Sound_DMA_Pause).l
(1)  159/  FF12DE : 4E75                		rts
(1)  160/  FF12E0 :                     
(1)  161/  FF12E0 :                     System_Dma_Exit:
(1)  162/  FF12E0 : 4EB9 00FF 01A4      		jsr	(Sound_DMA_Resume).l
(1)  163/  FF12E6 : 4E75                		rts
(1)  164/  FF12E8 :                     
(1)  165/  FF12E8 :                     ; ====================================================================
(1)  166/  FF12E8 :                     ; ----------------------------------------------------------------
(1)  167/  FF12E8 :                     ; 32X ONLY
(1)  168/  FF12E8 :                     ; ----------------------------------------------------------------
(1)  169/  FF12E8 :                     
(1)  170/  FF12E8 :                     ; --------------------------------------------------------
(1)  171/  FF12E8 :                     ; System_MarsUpdate
(1)  172/  FF12E8 :                     ; --------------------------------------------------------
(1)  173/  FF12E8 :                     
(1)  174/  FF12E8 :                     System_MarsUpdate:
(1)  175/  FF12E8 : 41F8 AB60           		lea	(RAM_MdDreq),a0		; Send DREQ
(1)  176/  FF12EC : 303C 0658           		move.w	#sizeof_dreq,d0
(1)  177/  FF12F0 : 4EF9 0088 A5C6      		jmp	(System_RomSendDreq).l	; <-- external jump
(1)  178/  FF12F6 :                     
(1)  179/  FF12F6 :                     ; --------------------------------------------------------
(1)  180/  FF12F6 :                     ; System_JumpRamCode
(1)  181/  FF12F6 :                     ;
(1)  182/  FF12F6 :                     ; Send new code to the USER side of RAM and
(1)  183/  FF12F6 :                     ; jump into it.
(1)  184/  FF12F6 :                     ;
(1)  185/  FF12F6 :                     ; Input:
(1)  186/  FF12F6 :                     ; d0 - Location of the RAM code to copy
(1)  187/  FF12F6 :                     ;      in the 880000/900000 areas
(1)  188/  FF12F6 :                     ; --------------------------------------------------------
(1)  189/  FF12F6 :                     
(1)  190/  FF12F6 :                     System_JumpRamCode:
(1)  191/  FF12F6 : 80BC 0088 0000      		or.l	#$880000,d0
(1)  192/  FF12FC : 2040                		move.l	d0,a0
(1)  193/  FF12FE : 43F9 00FF 170C      		lea	(RAMCODE_USER),a1
(1)  194/  FF1304 : 3E3C 4FFF           		move.w	#$5000-1,d7	; TODO: make custom sizes.
(1)  195/  FF1308 :                     .copyme2:
(1)  196/  FF1308 : 12D8                		move.b	(a0)+,(a1)+
(1)  197/  FF130A : 51CF FFFC           		dbf	d7,.copyme2
(1)  198/  FF130E : 4EF9 00FF 170C      		jmp	(RAMCODE_USER).l
(1)  199/  FF1314 :                     
(1)  200/  FF1314 :                     ; ====================================================================
(1)  201/  FF1314 :                     ; ----------------------------------------------------------------
(1)  202/  FF1314 :                     ; Subroutines
(1)  203/  FF1314 :                     ; ----------------------------------------------------------------
(1)  204/  FF1314 :                     
(1)  205/  FF1314 :                     ; --------------------------------------------------------
(1)  206/  FF1314 :                     ; System_Input
(1)  207/  FF1314 :                     ;
(1)  208/  FF1314 :                     ; Reads data from the Controller ports
(1)  209/  FF1314 :                     ; *** CALL THIS ON VBLANK ONLY ***
(1)  210/  FF1314 :                     ; 
(1)  211/  FF1314 :                     ; Uses:
(1)  212/  FF1314 :                     ; d4-d6,a4-a6
(1)  213/  FF1314 :                     ; --------------------------------------------------------
(1)  214/  FF1314 :                     
(1)  215/  FF1314 :                     System_Input:
(1)  216/  FF1314 :                     ; 		move.w	#$0100,(z80_bus).l
(1)  217/  FF1314 :                     .wait:
(1)  218/  FF1314 :                     ; 		btst	#0,(z80_bus).l
(1)  219/  FF1314 :                     ; 		bne.s	.wait
(1)  220/  FF1314 : 4BF9 00A1 0003      		lea	(sys_data_1),a5		; a5 - BASE Genesis Input regs area
(1)  221/  FF131A : 4DF8 A702           		lea	(RAM_InputData),a6	; a6 - Output
(1)  222/  FF131E : 6108                		bsr.s	.this_one
(1)  223/  FF1320 : DAFC 0002           		adda	#2,a5
(1)  224/  FF1324 : DCFC 0010           		adda	#sizeof_input,a6
(1)  225/  FF1328 :                     ; 		bsr.s	.this_one
(1)  226/  FF1328 :                     ; ; 		move.w	#0,(z80_bus).l
(1)  227/  FF1328 :                     ; 		rts
(1)  228/  FF1328 :                     
(1)  229/  FF1328 :                     ; --------------------------------------------------------	
(1)  230/  FF1328 :                     ; Read port
(1)  231/  FF1328 :                     ; 
(1)  232/  FF1328 :                     ; a5 - Current port
(1)  233/  FF1328 :                     ; a6 - Output data
(1)  234/  FF1328 :                     ; --------------------------------------------------------
(1)  235/  FF1328 :                     
(1)  236/  FF1328 :                     .this_one:
(1)  237/  FF1328 : 6100 0166           		bsr	.pick_id
(1)  238/  FF132C : 1C84                		move.b	d4,pad_id(a6)
(1)  239/  FF132E : B87C 000F           		cmp.w	#$F,d4
(1)  240/  FF1332 : 670E                		beq.s	.exit
(1)  241/  FF1334 : C87C 000F           		and.w	#$F,d4
(1)  242/  FF1338 : D844                		add.w	d4,d4
(1)  243/  FF133A : 3A3B 400C           		move.w	.list(pc,d4.w),d5
(1)  244/  FF133E : 4EFB 5008           		jmp	.list(pc,d5.w)
(1)  245/  FF1342 :                     .exit:
(1)  246/  FF1342 : 422E 0001           		clr.b	pad_ver(a6)
(1)  247/  FF1346 : 4E75                		rts
(1)  248/  FF1348 :                     
(1)  249/  FF1348 :                     ; --------------------------------------------------------
(1)  250/  FF1348 :                     ; Grab ID
(1)  251/  FF1348 :                     ; --------------------------------------------------------
(1)  252/  FF1348 :                     
(1)  253/  FF1348 :                     .list:
(1)  254/  FF1348 : FFFA                		dc.w .exit-.list	; $00
(1)  255/  FF134A : FFFA                		dc.w .exit-.list
(1)  256/  FF134C : FFFA                		dc.w .exit-.list
(1)  257/  FF134E : 0020                		dc.w .id_03-.list	; $03 - Mega mouse
(1)  258/  FF1350 : FFFA                		dc.w .exit-.list	; $04
(1)  259/  FF1352 : FFFA                		dc.w .exit-.list
(1)  260/  FF1354 : FFFA                		dc.w .exit-.list
(1)  261/  FF1356 : FFFA                		dc.w .exit-.list
(1)  262/  FF1358 : FFFA                		dc.w .exit-.list	; $08
(1)  263/  FF135A : FFFA                		dc.w .exit-.list
(1)  264/  FF135C : FFFA                		dc.w .exit-.list
(1)  265/  FF135E : FFFA                		dc.w .exit-.list
(1)  266/  FF1360 : FFFA                		dc.w .exit-.list	; $0C
(1)  267/  FF1362 : 00CA                		dc.w .id_0D-.list	; $0D - Genesis controller (3 or 6 button)
(1)  268/  FF1364 : FFFA                		dc.w .exit-.list
(1)  269/  FF1366 : FFFA                		dc.w .exit-.list	; $0F - No controller OR Master System controller (2 Buttons: 1(B),2(C))
(1)  270/  FF1368 :                     
(1)  271/  FF1368 :                     ; --------------------------------------------------------
(1)  272/  FF1368 :                     ; ID $03
(1)  273/  FF1368 :                     ;
(1)  274/  FF1368 :                     ; Mega Mouse
(1)  275/  FF1368 :                     ; --------------------------------------------------------
(1)  276/  FF1368 :                     
(1)  277/  FF1368 :                     ; *** NOT TESTED ON HARDWARE ***
(1)  278/  FF1368 :                     .id_03:
(1)  279/  FF1368 : 1ABC 0020           		move.b	#$20,(a5)
(1)  280/  FF136C : 1B7C 0060 0006      		move.b	#$60,6(a5)
(1)  281/  FF1372 : 0815 0004           		btst	#4,(a5)
(1)  282/  FF1376 : 6700 0094           		beq.w	.invalid
(1)  283/  FF137A : 1ABC 0000           		move.b	#$00,(a5)	; $0F
(1)  284/  FF137E : 4E71                		nop
(1)  285/  FF1380 : 4E71                		nop
(1)  286/  FF1382 : 1ABC 0020           		move.b	#$20,(a5)	; $0F
(1)  287/  FF1386 : 4E71                		nop
(1)  288/  FF1388 : 4E71                		nop
(1)  289/  FF138A : 1ABC 0000           		move.b	#$00,(a5)	; Yo | Xo | Ys | Xs
(1)  290/  FF138E : 4E71                		nop
(1)  291/  FF1390 : 4E71                		nop
(1)  292/  FF1392 : 1A15                		move.b	(a5),d5		; d5 - X/Y direction bits (Ys Xs)
(1)  293/  FF1394 : 1ABC 0020           		move.b	#$20,(a5)	; C | M | R | L
(1)  294/  FF1398 : 4E71                		nop
(1)  295/  FF139A : 4E71                		nop
(1)  296/  FF139C : 1E15                		move.b	(a5),d7
(1)  297/  FF139E : CE7C 000F            		and.w	#%1111,d7
(1)  298/  FF13A2 : 3C2E 0002           		move.w	on_hold(a6),d6
(1)  299/  FF13A6 : BF46                		eor.w	d7,d6
(1)  300/  FF13A8 : 3D47 0002           		move.w	d7,on_hold(a6)
(1)  301/  FF13AC : CC47                		and.w	d7,d6
(1)  302/  FF13AE : 3D46 0004           		move.w	d6,on_press(a6)
(1)  303/  FF13B2 : 1ABC 0000           		move.b	#$00,(a5)	; X7 | X6 | X5 | X4
(1)  304/  FF13B6 : 4E71                		nop
(1)  305/  FF13B8 : 4E71                		nop
(1)  306/  FF13BA : 1E15                		move.b	(a5),d7
(1)  307/  FF13BC : 1ABC 0020           		move.b	#$20,(a5)	; X3 | X2 | X1 | X0
(1)  308/  FF13C0 : CE7C 000F           		and.w	#%1111,d7
(1)  309/  FF13C4 : E94F                		lsl.w	#4,d7
(1)  310/  FF13C6 : 4E71                		nop
(1)  311/  FF13C8 : 1C15                		move.b	(a5),d6
(1)  312/  FF13CA : CC7C 000F           		and.w	#%1111,d6
(1)  313/  FF13CE : 8E46                		or.w	d6,d7
(1)  314/  FF13D0 : 0805 0000           		btst    #0,d5
(1)  315/  FF13D4 : 6704                		beq.s	.x_neg
(1)  316/  FF13D6 : 4407                		neg.b	d7
(1)  317/  FF13D8 : 4447                		neg.w	d7
(1)  318/  FF13DA :                     .x_neg:
(1)  319/  FF13DA : 3D47 0006           		move.w	d7,mouse_x(a6)
(1)  320/  FF13DE : 1ABC 0000           		move.b	#$00,(a5)	; Y7 | Y6 | Y5 | Y4
(1)  321/  FF13E2 : 4E71                		nop
(1)  322/  FF13E4 : 4E71                		nop
(1)  323/  FF13E6 : 1E15                		move.b	(a5),d7
(1)  324/  FF13E8 : 1ABC 0020           		move.b	#$20,(a5)	; Y3 | Y2 | Y1 | Y0
(1)  325/  FF13EC : CE7C 000F           		and.w	#%1111,d7
(1)  326/  FF13F0 : E94F                		lsl.w	#4,d7
(1)  327/  FF13F2 : 4E71                		nop
(1)  328/  FF13F4 : 1C15                		move.b	(a5),d6
(1)  329/  FF13F6 : CC7C 000F           		and.w	#%1111,d6
(1)  330/  FF13FA : 8E46                		or.w	d6,d7
(1)  331/  FF13FC : 0805 0001           		btst    #1,d5
(1)  332/  FF1400 : 6704                		beq.s	.y_neg
(1)  333/  FF1402 : 4407                		neg.b	d7
(1)  334/  FF1404 : 4447                		neg.w	d7
(1)  335/  FF1406 :                     .y_neg:
(1)  336/  FF1406 : 4447                		neg.w	d7		; Reverse Y
(1)  337/  FF1408 : 3D47 0008           		move.w	d7,mouse_y(a6)
(1)  338/  FF140C :                     
(1)  339/  FF140C :                     .invalid:
(1)  340/  FF140C : 1ABC 0060           		move.b	#$60,(a5)
(1)  341/  FF1410 : 4E75                		rts
(1)  342/  FF1412 :                     
(1)  343/  FF1412 :                     ; --------------------------------------------------------
(1)  344/  FF1412 :                     ; ID $0D
(1)  345/  FF1412 :                     ; 
(1)  346/  FF1412 :                     ; Normal controller: 3 button or 6 button.
(1)  347/  FF1412 :                     ; --------------------------------------------------------
(1)  348/  FF1412 :                     
(1)  349/  FF1412 :                     .id_0D:
(1)  350/  FF1412 : 1ABC 0040           		move.b	#$40,(a5)	; Show CB|RLDU
(1)  351/  FF1416 : 4E71                		nop
(1)  352/  FF1418 : 4E71                		nop
(1)  353/  FF141A : 1A15                		move.b	(a5),d5
(1)  354/  FF141C : CA7C 003F           		and.w	#%00111111,d5
(1)  355/  FF1420 : 1ABC 0000           		move.b	#$00,(a5)	; Show SA|RLDU
(1)  356/  FF1424 : 4E71                		nop
(1)  357/  FF1426 : 4E71                		nop
(1)  358/  FF1428 : 1815                		move.b	(a5),d4		; The following flips are for
(1)  359/  FF142A : E54C                		lsl.w	#2,d4		; the 6pad's internal counter:
(1)  360/  FF142C : C87C 00C0           		and.w	#%11000000,d4
(1)  361/  FF1430 : 8845                		or.w	d5,d4
(1)  362/  FF1432 : 1ABC 0040           		move.b	#$40,(a5)	; Show CB|RLDU (2)
(1)  363/  FF1436 : 4644                		not.w	d4
(1)  364/  FF1438 : 1A2E 0003           		move.b	on_hold+1(a6),d5
(1)  365/  FF143C : B905                		eor.b	d4,d5
(1)  366/  FF143E : 1ABC 0000           		move.b	#$00,(a5)	; Show SA|RLDU (3)
(1)  367/  FF1442 : 1D44 0003           		move.b	d4,on_hold+1(a6)
(1)  368/  FF1446 : CA04                		and.b	d4,d5
(1)  369/  FF1448 : 1D45 0005           		move.b	d5,on_press+1(a6)
(1)  370/  FF144C : 1ABC 0040           		move.b	#$40,(a5)	; 6 button responds (4)
(1)  371/  FF1450 : 4E71                		nop
(1)  372/  FF1452 : 4E71                		nop
(1)  373/  FF1454 : 1815                		move.b	(a5),d4		; Grab ??|MXYZ
(1)  374/  FF1456 : 1ABC 0000            		move.b	#$00,(a5)	; (5)
(1)  375/  FF145A : 4E71                  		nop
(1)  376/  FF145C : 4E71                  		nop
(1)  377/  FF145E : 1C15                 		move.b	(a5),d6		; Type: $03 old, $0F new
(1)  378/  FF1460 : 1ABC 0040            		move.b	#$40,(a5)	; (6)
(1)  379/  FF1464 : 4E71                 		nop
(1)  380/  FF1466 : 4E71                 		nop
(1)  381/  FF1468 : CC7C 000F           		and.w	#$F,d6
(1)  382/  FF146C : E44E                		lsr.w	#2,d6
(1)  383/  FF146E : CC7C 0001           		and.w	#1,d6
(1)  384/  FF1472 : 6716                		beq.s	.oldpad
(1)  385/  FF1474 : 4604                		not.b	d4
(1)  386/  FF1476 : C87C 000F            		and.w	#%1111,d4
(1)  387/  FF147A : 1A2E 0002           		move.b	on_hold(a6),d5
(1)  388/  FF147E : B905                		eor.b	d4,d5
(1)  389/  FF1480 : 1D44 0002           		move.b	d4,on_hold(a6)
(1)  390/  FF1484 : CA04                		and.b	d4,d5
(1)  391/  FF1486 : 1D45 0004           		move.b	d5,on_press(a6)
(1)  392/  FF148A :                     .oldpad:
(1)  393/  FF148A : 1D46 0001           		move.b	d6,pad_ver(a6)
(1)  394/  FF148E : 4E75                		rts
(1)  395/  FF1490 :                     		
(1)  396/  FF1490 :                     ; --------------------------------------------------------
(1)  397/  FF1490 :                     ; Grab ID
(1)  398/  FF1490 :                     ; --------------------------------------------------------
(1)  399/  FF1490 :                     
(1)  400/  FF1490 :                     .pick_id:
(1)  401/  FF1490 : 7800                		moveq	#0,d4
(1)  402/  FF1492 : 1ABC 0070           		move.b	#%01110000,(a5)		; TH=1,TR=1,TL=1
(1)  403/  FF1496 : 4E71                		nop
(1)  404/  FF1498 : 4E71                		nop
(1)  405/  FF149A : 610A                		bsr	.read
(1)  406/  FF149C : 1ABC 0030           		move.b	#%00110000,(a5)		; TH=0,TR=1,TL=1
(1)  407/  FF14A0 : 4E71                		nop
(1)  408/  FF14A2 : 4E71                		nop
(1)  409/  FF14A4 : D844                		add.w	d4,d4
(1)  410/  FF14A6 :                     .read:
(1)  411/  FF14A6 : 1A15                		move.b	(a5),d5
(1)  412/  FF14A8 : 1C05                		move.b	d5,d6
(1)  413/  FF14AA : CC3C 000C           		and.b	#$C,d6
(1)  414/  FF14AE : 6702                		beq.s	.step_1
(1)  415/  FF14B0 : 5244                		addq.w	#1,d4
(1)  416/  FF14B2 :                     .step_1:
(1)  417/  FF14B2 : D844                		add.w	d4,d4
(1)  418/  FF14B4 : 1C05                		move.b	d5,d6
(1)  419/  FF14B6 : CC7C 0003           		and.w	#3,d6
(1)  420/  FF14BA : 6702                		beq.s	.step_2
(1)  421/  FF14BC : 5244                		addq.w	#1,d4
(1)  422/  FF14BE :                     .step_2:
(1)  423/  FF14BE : 4E75                		rts
(1)  424/  FF14C0 :                     
(1)  425/  FF14C0 :                     ; --------------------------------------------------------
(1)  426/  FF14C0 :                     ; System_Random
(1)  427/  FF14C0 :                     ; 
(1)  428/  FF14C0 :                     ; Picks a random value
(1)  429/  FF14C0 :                     ; 
(1)  430/  FF14C0 :                     ; Output:
(1)  431/  FF14C0 :                     ; d0 | LONG
(1)  432/  FF14C0 :                     ; --------------------------------------------------------
(1)  433/  FF14C0 :                     
(1)  434/  FF14C0 :                     ; TODO: rewrite this
(1)  435/  FF14C0 :                     System_Random:
(1)  436/  FF14C0 : 2A38 AB46           		move.l	(RAM_SysRandSeed),d5
(1)  437/  FF14C4 : 2838 AB42           		move.l	(RAM_SysRandVal),d4
(1)  438/  FF14C8 : E39D                		rol.l	#1,d5
(1)  439/  FF14CA : EAA4                		asr.l	d5,d4
(1)  440/  FF14CC : D885                		add.l	d5,d4
(1)  441/  FF14CE : 23C5 FFFF AB46      		move.l	d5,(RAM_SysRandSeed).l
(1)  442/  FF14D4 : 23C4 FFFF AB42      		move.l	d4,(RAM_SysRandVal).l
(1)  443/  FF14DA : 2004                		move.l	d4,d0
(1)  444/  FF14DC : 4E75                		rts
(1)  445/  FF14DE :                     
(1)  446/  FF14DE :                     ; --------------------------------------------------------
(1)  447/  FF14DE :                     ; System_SineWave_Cos / System_SineWave
(1)  448/  FF14DE :                     ;
(1)  449/  FF14DE :                     ; Get sinewave value
(1)  450/  FF14DE :                     ;
(1)  451/  FF14DE :                     ; Input:
(1)  452/  FF14DE :                     ; d0 | WORD - Tan
(1)  453/  FF14DE :                     ; d1 | WORD - Multiply
(1)  454/  FF14DE :                     ;
(1)  455/  FF14DE :                     ; Output:
(1)  456/  FF14DE :                     ; d2 | LONG - Result (as 0000.0000)
(1)  457/  FF14DE :                     ; --------------------------------------------------------
(1)  458/  FF14DE :                     
(1)  459/  FF14DE :                     ; TODO: improve this.
(1)  460/  FF14DE :                     System_SineWave_Cos:
(1)  461/  FF14DE : 48A7 8000           		movem.w	d0,-(sp)
(1)  462/  FF14E2 : 7400                		moveq	#0,d2
(1)  463/  FF14E4 : D03C 0040           		add.b	#$40,d0
(1)  464/  FF14E8 : 1400                		move.b	d0,d2
(1)  465/  FF14EA : E302                		asl.b	#1,d2
(1)  466/  FF14EC : 343B 202E           		move.w	MdSys_SineData(pc,d2.w),d2
(1)  467/  FF14F0 : C4C1                		mulu.w	d1,d2
(1)  468/  FF14F2 : 8000                		or.b	d0,d0
(1)  469/  FF14F4 : 6A02                		bpl.s	.dont_neg
(1)  470/  FF14F6 : 4482                		neg.l	d2
(1)  471/  FF14F8 :                     .dont_neg:
(1)  472/  FF14F8 : 4C9F 0001           		movem.w	(sp)+,d0
(1)  473/  FF14FC : 4E75                		rts
(1)  474/  FF14FE :                     
(1)  475/  FF14FE :                     System_SineWave:
(1)  476/  FF14FE : 48A7 8000           		movem.w	d0,-(sp)
(1)  477/  FF1502 : C07C 007F           		and.w	#$7F,d0
(1)  478/  FF1506 : E340                		asl.w	#1,d0
(1)  479/  FF1508 : 343B 0012           		move.w	MdSys_SineData(pc,d0.w),d2
(1)  480/  FF150C : C4C1                		mulu.w	d1,d2
(1)  481/  FF150E : 4C9F 0001           		movem.w	(sp)+,d0
(1)  482/  FF1512 : 5182                		subq.l	#8,d2
(1)  483/  FF1514 : 8000                		or.b	d0,d0
(1)  484/  FF1516 : 6A02                		bpl.s	.dont_neg
(1)  485/  FF1518 : 4482                		neg.l	d2
(1)  486/  FF151A :                     .dont_neg:
(1)  487/  FF151A : 4E75                		rts
(1)  488/  FF151C :                     
(1)  489/  FF151C : 0000 0006 000D 0013 MdSys_SineData:	dc.w 0,	6, $D, $13, $19, $1F, $26, $2C,	$32, $38, $3E
                    0019 001F 0026 002C 
                    0032 0038 003E      
(1)  490/  FF1532 : 0044 004A 0050 0056 		dc.w $44, $4A, $50, $56, $5C, $62, $68,	$6D, $73, $79
                    005C 0062 0068 006D 
                    0073 0079           
(1)  491/  FF1546 : 007E 0084 0089 008E 		dc.w $7E, $84, $89, $8E, $93, $98, $9D,	$A2, $A7, $AC
                    0093 0098 009D 00A2 
                    00A7 00AC           
(1)  492/  FF155A : 00B1 00B5 00B9 00BE 		dc.w $B1, $B5, $B9, $BE, $C2, $C6, $CA,	$CE, $D1, $D5
                    00C2 00C6 00CA 00CE 
                    00D1 00D5           
(1)  493/  FF156E : 00D8 00DC 00DF 00E2 		dc.w $D8, $DC, $DF, $E2, $E5, $E7, $EA,	$ED, $EF, $F1
                    00E5 00E7 00EA 00ED 
                    00EF 00F1           
(1)  494/  FF1582 : 00F3 00F5 00F7 00F8 		dc.w $F3, $F5, $F7, $F8, $FA, $FB, $FC,	$FD, $FE, $FF
                    00FA 00FB 00FC 00FD 
                    00FE 00FF           
(1)  495/  FF1596 : 00FF 0100 0100 0100 		dc.w $FF, $100,	$100, $100, $100, $100,	$FF, $FF, $FE
                    0100 0100 00FF 00FF 
                    00FE                
(1)  496/  FF15A8 : 00FD 00FC 00FB 00FA 		dc.w $FD, $FC, $FB, $FA, $F8, $F7, $F5,	$F3, $F1, $EF
                    00F8 00F7 00F5 00F3 
                    00F1 00EF           
(1)  497/  FF15BC : 00ED 00EA 00E7 00E5 		dc.w $ED, $EA, $E7, $E5, $E2, $DF, $DC,	$D8, $D5, $D1
                    00E2 00DF 00DC 00D8 
                    00D5 00D1           
(1)  498/  FF15D0 : 00CE 00CA 00C6 00C2 		dc.w $CE, $CA, $C6, $C2, $BE, $B9, $B5,	$B1, $AC, $A7
                    00BE 00B9 00B5 00B1 
                    00AC 00A7           
(1)  499/  FF15E4 : 00A2 009D 0098 0093 		dc.w $A2, $9D, $98, $93, $8E, $89, $84,	$7E, $79, $73
                    008E 0089 0084 007E 
                    0079 0073           
(1)  500/  FF15F8 : 006D 0068 0062 005C 		dc.w $6D, $68, $62, $5C, $56, $50, $4A,	$44, $3E, $38
                    0056 0050 004A 0044 
                    003E 0038           
(1)  501/  FF160C : 0032 002C 0026 001F 		dc.w $32, $2C, $26, $1F, $19, $13, $D, 6
                    0019 0013 000D 0006 
(1)  502/  FF161C :                     
(1)  503/  FF161C :                     ; --------------------------------------------------------
(1)  504/  FF161C :                     ; System_SetInts
(1)  505/  FF161C :                     ;
(1)  506/  FF161C :                     ; Set new interrputs
(1)  507/  FF161C :                     ;
(1)  508/  FF161C :                     ; d0 | LONG - VBlank
(1)  509/  FF161C :                     ; d1 | LONG - HBlank
(1)  510/  FF161C :                     ;
(1)  511/  FF161C :                     ; Uses:
(1)  512/  FF161C :                     ; d4
(1)  513/  FF161C :                     ;
(1)  514/  FF161C :                     ; Notes:
(1)  515/  FF161C :                     ; Writing 0 or a negative number will skip change
(1)  516/  FF161C :                     ; to the interrupt pointer
(1)  517/  FF161C :                     ; --------------------------------------------------------
(1)  518/  FF161C :                     
(1)  519/  FF161C :                     System_SetInts:
(1)  520/  FF161C : 2800                		move.l	d0,d4
(1)  521/  FF161E : 670E                		beq.s	.novint
(1)  522/  FF1620 : 6B0C                		bmi.s	.novint
(1)  523/  FF1622 : 88BC 0088 0000      		or.l	#$880000,d4
(1)  524/  FF1628 : 23C4 FFFF AB50       		move.l	d4,(RAM_MdMarsVInt+2).l
(1)  525/  FF162E :                     .novint:
(1)  526/  FF162E : 2801                		move.l	d1,d4
(1)  527/  FF1630 : 670E                		beq.s	.nohint
(1)  528/  FF1632 : 6B0C                		bmi.s	.nohint
(1)  529/  FF1634 : 88BC 0088 0000      		or.l	#$880000,d4
(1)  530/  FF163A : 23C4 FFFF AB56      		move.l	d4,(RAM_MdMarsHInt+2).l
(1)  531/  FF1640 :                     .nohint:
(1)  532/  FF1640 : 4E75                		rts
(1)  533/  FF1642 :                     
(1)  534/  FF1642 :                     ; --------------------------------------------------------
(1)  535/  FF1642 :                     ; System_SramInit
(1)  536/  FF1642 :                     ; 
(1)  537/  FF1642 :                     ; Init save data
(1)  538/  FF1642 :                     ; 
(1)  539/  FF1642 :                     ; Uses:
(1)  540/  FF1642 :                     ; a4,d4-d5
(1)  541/  FF1642 :                     ; --------------------------------------------------------
(1)  542/  FF1642 :                     
(1)  543/  FF1642 :                     ; TODO: Check if RV bit is needed here...
(1)  544/  FF1642 :                     System_SramInit:
(1)  545/  FF1642 : 13FC 0001 00A1 30F1 		move.b	#1,(md_bank_sram).l
(1)  546/  FF164A : 49F9 0020 0001      		lea	($200001).l,a4
(1)  547/  FF1650 : 7800                		moveq	#0,d4
(1)  548/  FF1652 : 3A3C 1FFF           		move.w	#($4000/2)-1,d5
(1)  549/  FF1656 :                     .initsave:
(1)  550/  FF1656 : 1884                		move.b	d4,(a4)
(1)  551/  FF1658 : D8FC 0002           		adda	#2,a4
(1)  552/  FF165C : 51CD FFF8           		dbf	d5,.initsave
(1)  553/  FF1660 : 13FC 0000 00A1 30F1 		move.b	#0,(md_bank_sram).l
(1)  554/  FF1668 : 4E75                		rts
(1)  555/  FF166A :                     
(1)  556/  FF166A :                     ; ====================================================================
(1)  557/  FF166A :                     ; ----------------------------------------------------------------
(1)  558/  FF166A :                     ; Screen mode subroutines
(1)  559/  FF166A :                     ; ----------------------------------------------------------------
(1)  560/  FF166A :                     
(1)  561/  FF166A :                     ; --------------------------------------------------------
(1)  562/  FF166A :                     ; Initialize current screen mode
(1)  563/  FF166A :                     ; --------------------------------------------------------
(1)  564/  FF166A :                     
(1)  565/  FF166A :                     Mode_Init:
(1)  566/  FF166A : 4EB9 00FF 02F0      		jsr	(Video_Clear).l
(1)  567/  FF1670 : 49F8 9000           		lea	(RAM_ModeBuff),a4
(1)  568/  FF1674 : 3A3C 03FF           		move.w	#(MAX_MDERAM/2)-1,d5
(1)  569/  FF1678 : 7800                		moveq	#0,d4
(1)  570/  FF167A :                     .clr:
(1)  571/  FF167A : 38C4                		move.w	d4,(a4)+
(1)  572/  FF167C : 51CD FFFC           		dbf	d5,.clr
(1)  573/  FF1680 :                     
(1)  574/  FF1680 : 49F8 ADF8           		lea	(RAM_MdDreq+Dreq_Objects),a4	; Patch
(1)  575/  FF1684 : 3A3C 000F           		move.w	#MAX_MODELS-1,d5
(1)  576/  FF1688 :                     .clr_mdls:
(1)  577/  FF1688 : 2884                		move.l	d4,mdl_data(a4)
(1)  578/  FF168A : D8FC 0018           		adda	#sizeof_mdlobj,a4
(1)  579/  FF168E : 51CD FFF8           		dbf	d5,.clr_mdls
(1)  580/  FF1692 :                     
(1)  581/  FF1692 : 303C 0000           		move.w	#0,d0
(1)  582/  FF1696 : 6100 F362           		bsr	Video_Mars_GfxMode
(1)  583/  FF169A : 4E75                		rts
(1)  584/  FF169C :                     
(1)  585/  FF169C :                     ; --------------------------------------------------------
(1)  586/  FF169C :                     
(1)  587/  FF169C :                     Mode_FadeOut:
(1)  588/  FF169C : 31FC 0002 A6DA      		move.w	#2,(RAM_FadeMdReq).w
(1)  589/  FF16A2 : 31FC 0002 A6E2      		move.w	#2,(RAM_FadeMarsReq).w
(1)  590/  FF16A8 : 31FC 0001 A6DC      		move.w	#1,(RAM_FadeMdIncr).w
(1)  591/  FF16AE : 31FC 0004 A6E4      		move.w	#4,(RAM_FadeMarsIncr).w
(1)  592/  FF16B4 : 31FC 0000 A6DE      		move.w	#0,(RAM_FadeMdDelay).w
(1)  593/  FF16BA : 31FC 0000 A6E6      		move.w	#0,(RAM_FadeMarsDelay).w
(1)  594/  FF16C0 :                     .loopw:
(1)  595/  FF16C0 : 6100 FB5C           		bsr	System_WaitFrame
(1)  596/  FF16C4 : 4EB9 00FF 05E0      		jsr	(Video_RunFade).l
(1)  597/  FF16CA : 66F4                		bne.s	.loopw
(1)  598/  FF16CC : 4E75                		rts
(1)  599/  FF16CE :                     
(1)  600/  FF16CE :                     ; ====================================================================
(1)  601/  FF16CE :                     ; ----------------------------------------------------------------
(1)  602/  FF16CE :                     ; Default interrupts
(1)  603/  FF16CE :                     ; ----------------------------------------------------------------
(1)  604/  FF16CE :                     
(1)  605/  FF16CE :                     ; --------------------------------------------------------
(1)  606/  FF16CE :                     ; VBlank
(1)  607/  FF16CE :                     ; --------------------------------------------------------
(1)  608/  FF16CE :                     
(1)  609/  FF16CE :                     VInt_Default:
(1)  610/  FF16CE : 48E7 FFFE           		movem.l	d0-a6,-(sp)
(1)  611/  FF16D2 : 6100 FC40           		bsr	System_Input
(1)  612/  FF16D6 : 06B9 0000 0001 FFFF 		add.l	#1,(RAM_FrameCount).l
                    9900                
(1)  613/  FF16E0 : 4CDF 7FFF           		movem.l	(sp)+,d0-a6		
(1)  614/  FF16E4 : 4E73                		rte
(1)  615/  FF16E6 :                     
(1)  616/  FF16E6 :                     ; --------------------------------------------------------
(1)  617/  FF16E6 :                     ; HBlank
(1)  618/  FF16E6 :                     ; --------------------------------------------------------
(1)  619/  FF16E6 :                     
(1)  620/  FF16E6 :                     HInt_Default:
(1)  621/  FF16E6 : 4E73                		rte
(1)  622/  FF16E8 :                     
(1)  623/  FF16E8 :                     ; ====================================================================
(1)  624/  FF16E8 :                     ; ----------------------------------------------------------------
(1)  625/  FF16E8 :                     ; System data
(1)  626/  FF16E8 :                     ; ----------------------------------------------------------------
(1)  627/  FF16E8 :                     
      42/  FF16E8 :                     Md_ReadModes:
      43/  FF16E8 : 7000                		moveq	#0,d0
      44/  FF16EA : 3038 AB5E           		move.w	(RAM_Glbl_Scrn).w,d0
      45/  FF16EE : E548                		lsl.w	#2,d0
      46/  FF16F0 : 203B 000A           		move.l	.pick_boot(pc,d0.w),d0
      47/  FF16F4 : 4EB9 00FF 12F6      		jsr	(System_JumpRamCode).l
      48/  FF16FA : 60EC                		bra.s	Md_ReadModes
      49/  FF16FC :                     .pick_boot:
      50/  FF16FC : 0000 1FE0           		dc.l RamCode_Scrn1
      51/  FF1700 : 0000 23D8           		dc.l RamCode_Scrn2
      52/  FF1704 : 0000 7BD8           		dc.l RamCode_Debug
      53/  FF1708 : 0000 1FE0           		dc.l RamCode_Scrn1
      54/  FF170C :                     
      58/  FF170C :                     RAMCODE_USER:
      59/    1FE0 :                     		dephase
      60/    1FE0 :                     Md_TopCode_e:
      61/    1FE0 :                     		align 2
      62/    1FE0 :                     
      63/    1FE0 :                     ; ====================================================================
      64/    1FE0 :                     ; --------------------------------------------------------
      65/    1FE0 :                     ; RAM code sections for 68K
      66/    1FE0 :                     ; --------------------------------------------------------
      67/    1FE0 :                     
      68/    1FE0 :                     RamCode_Scrn1:
      69/    1FE0 :                     		include "code/screen_1.asm"
(1)    1/    1FE0 :                     ; ====================================================================
(1)    2/    1FE0 :                     ; ----------------------------------------------------------------
(1)    3/    1FE0 :                     ; 2D Part
(1)    4/    1FE0 :                     ; ----------------------------------------------------------------
(1)    5/    1FE0 :                     
(1)    6/  FF170C :                     		phase RAMCODE_USER
(1)    7/  FF170C :                     
(1)    8/  FF170C :                     ; ====================================================================
(1)    9/  FF170C :                     ; ------------------------------------------------------
(1)   10/  FF170C :                     ; Settings
(1)   11/  FF170C :                     ; ------------------------------------------------------
(1)   12/  FF170C :                     
(1)   13/  FF170C : =$4                 TEST_MAINSPD	equ $04
(1)   14/  FF170C :                     
(1)   15/  FF170C :                     ; ====================================================================
(1)   16/  FF170C :                     ; ------------------------------------------------------
(1)   17/  FF170C :                     ; Structs
(1)   18/  FF170C :                     ; ------------------------------------------------------
(1)   19/  FF170C :                     
(1)   20/  FF170C :                     ; 		struct 0
(1)   21/  FF170C :                     ; strc_xpos	ds.w 1
(1)   22/  FF170C :                     ; strc_ypos	ds.w 1
(1)   23/  FF170C :                     ; 		finish
(1)   24/  FF170C :                     
(1)   25/  FF170C :                     ; ====================================================================
(1)   26/  FF170C :                     ; ------------------------------------------------------
(1)   27/  FF170C :                     ; This screen's RAM
(1)   28/  FF170C :                     ; ------------------------------------------------------
(1)   29/  FF170C :                     
(1)   30/  FF170C : (MACRO)             		struct RAM_ModeBuff
(1)   30/  FF170C : =$FF170C            GLBL_LASTPC     set *
(1)   30/    1FE0 :                                     dephase
(1)   30/    1FE0 : =$1FE0              GLBL_LASTORG    set *
(1)   30/FFFFFFFFFFFF9000 :                                     phase RAM_MODEBUFF
(1)   31/FFFFFFFFFFFF9000 :                     RAM_MapX	ds.l 1
(1)   32/FFFFFFFFFFFF9004 :                     RAM_MapY	ds.l 1
(1)   33/FFFFFFFFFFFF9008 :                     RAM_ThisSpeed	ds.l 1
(1)   34/FFFFFFFFFFFF900C :                     RAM_EmiFrame	ds.w 1
(1)   35/FFFFFFFFFFFF900E :                     RAM_EmiAnim	ds.w 1
(1)   36/FFFFFFFFFFFF9010 :                     RAM_EmiTimer	ds.w 1
(1)   37/FFFFFFFFFFFF9012 :                     RAM_KeepSong	ds.w 1
(1)   38/FFFFFFFFFFFF9014 : (MACRO)             		finish
(1)   38/FFFFFFFFFFFF9000 :                                     !org GLBL_LASTORG
(1)   38/  FF170C :                                     phase GLBL_LASTPC
(1)   39/  FF170C :                     
(1)   40/  FF170C :                     ; ====================================================================
(1)   41/  FF170C :                     ; ------------------------------------------------------
(1)   42/  FF170C :                     ; Code start
(1)   43/  FF170C :                     ; ------------------------------------------------------
(1)   44/  FF170C :                     
(1)   45/  FF170C :                     MD_2DMODE:
(1)   46/  FF170C : 46FC 2700           		move.w	#$2700,sr
(1)   47/  FF1710 : 08B9 0006 FFFF A6EB 		bclr	#bitDispEnbl,(RAM_VdpRegs+1).l
(1)   48/  FF1718 : 6100 EB82           		bsr	Video_Update
(1)   49/  FF171C : 6100 FF4C           		bsr	Mode_Init
(1)   50/  FF1720 : 6100 ECBE           		bsr	Video_PrintInit
(1)   51/  FF1724 :                     
(1)   52/  FF1724 :                     	; MAP TESTING
(1)   53/  FF1724 : 203C 0004 8000      		move.l	#Art_level0,d0			; Genesis VDP graphics
(1)   54/  FF172A : 323C 0001           		move.w	#1,d1
(1)   55/  FF172E : 343C 13E0           		move.w	#Art_level0_e-Art_level0,d2
(1)   56/  FF1732 : 6100 F19E           		bsr	Video_LoadArt
(1)   57/  FF1736 : 41F9 0092 F062      		lea	(Pal_level0),a0			; 16-color palette
(1)   58/  FF173C : 7010                		moveq	#$10,d0
(1)   59/  FF173E : 323C 0020           		move.w	#32,d1
(1)   60/  FF1742 : 6100 EEAE           		bsr	Video_FadePal
(1)   61/  FF1746 : 41F9 0092 EEF4      		lea	(MapPal_M),a0			; index-color palette
(1)   62/  FF174C : 7000                		moveq	#0,d0
(1)   63/  FF174E : 323C 0080           		move.w	#128,d1
(1)   64/  FF1752 : 7401                		moveq	#1,d2
(1)   65/  FF1754 : 6100 F2E4           		bsr	Video_FadePal_Mars
(1)   66/  FF1758 : 41F9 0092 EFF4      		lea	(TestSupSpr_Pal),a0
(1)   67/  FF175E : 303C 0080           		move.w	#128,d0
(1)   68/  FF1762 : 323C 0080           		move.w	#128,d1
(1)   69/  FF1766 : 7401                		moveq	#1,d2
(1)   70/  FF1768 : 6100 F2D0           		bsr	Video_FadePal_Mars
(1)   71/  FF176C : 4278 A1F4           		clr.w	(RAM_PaletteFd).w		; <-- quick patch
(1)   72/  FF1770 : 0278 7FFF A274      		and.w	#$7FFF,(RAM_MdMarsPalFd).w
(1)   73/  FF1776 : 23FC 0001 0000 FFFF 		move.l	#$10000,(RAM_ThisSpeed).l
                    9008                
(1)   74/  FF1780 : 33FC 0000 FFFF 9000 		move.w	#0,(RAM_MapX).l
(1)   75/  FF1788 : 33FC 009C FFFF 9004 		move.w	#$9C,(RAM_MapY).l
(1)   76/  FF1790 :                     
(1)   77/  FF1790 : 6100 F42C           		bsr	MdMap_Init
(1)   78/  FF1794 : 6100 0172           		bsr	.update_pos
(1)   79/  FF1798 : 6100 02E8           		bsr	Level_PickMap
(1)   80/  FF179C : 6100 01F8           		bsr	SuperSpr_Init
(1)   81/  FF17A0 : 6100 F642           		bsr	MdMap_DrawAll
(1)   82/  FF17A4 :                     
(1)   83/  FF17A4 :                     ; 		lea	(RAM_Sprites),a0
(1)   84/  FF17A4 :                     ; 		move.w	#$80+$30,(a0)+
(1)   85/  FF17A4 :                     ; 		move.w	#$0F00,(a0)+
(1)   86/  FF17A4 :                     ; 		move.w	#$2000|$50,(a0)+
(1)   87/  FF17A4 :                     ; 		move.w	#$80+$50,(a0)+
(1)   88/  FF17A4 :                     
(1)   89/  FF17A4 :                     	; Set Fade-in settings
(1)   90/  FF17A4 : 31FC 0001 A6DC      		move.w	#1,(RAM_FadeMdIncr).w
(1)   91/  FF17AA : 31FC 0002 A6E4      		move.w	#2,(RAM_FadeMarsIncr).w
(1)   92/  FF17B0 : 31FC 0001 A6DE      		move.w	#1,(RAM_FadeMdDelay).w
(1)   93/  FF17B6 : 31FC 0000 A6E6      		move.w	#0,(RAM_FadeMarsDelay).w
(1)   94/  FF17BC : 31FC 0001 A6DA      		move.w	#1,(RAM_FadeMdReq).w
(1)   95/  FF17C2 : 31FC 0001 A6E2      		move.w	#1,(RAM_FadeMarsReq).w
(1)   96/  FF17C8 : 13FC 0000 FFFF A6F5 		move.b	#%000,(RAM_VdpRegs+$B).l
(1)   97/  FF17D0 : 13FC 0000 FFFF A6F1 		move.b	#0,(RAM_VdpRegs+7).l
(1)   98/  FF17D8 : 08F9 0006 FFFF A6EB 		bset	#bitDispEnbl,(RAM_VdpRegs+1).l
(1)   99/  FF17E0 : 6100 EABA           		bsr	Video_Update
(1)  100/  FF17E4 : 6100 FA38           		bsr 	System_WaitFrame	; Send first DREQ
(1)  101/  FF17E8 :                     
(1)  102/  FF17E8 :                     	; Testing track
(1)  103/  FF17E8 :                     ; 		tst.w	(RAM_KeepSong).w
(1)  104/  FF17E8 :                     ; 		bne.s	.oof
(1)  105/  FF17E8 :                     ; 		move.w	#1,(RAM_KeepSong).w
(1)  106/  FF17E8 : 7000                		moveq	#0,d0
(1)  107/  FF17EA : 6100 EA18           		bsr	Sound_TrkStop
(1)  108/  FF17EE : 323C 00E8           		move.w	#200+32,d1
(1)  109/  FF17F2 : 6100 EA58           		bsr	Sound_GlbBeats
(1)  110/  FF17F6 : 41F9 0088 A696      		lea	(GemaTrkData_MOVEME),a0
(1)  111/  FF17FC :                     ; 		lea	(GemaTrkData_Nadie_MD),a0
(1)  112/  FF17FC : 7000                		moveq	#0,d0
(1)  113/  FF17FE : 7207                		moveq	#7,d1
(1)  114/  FF1800 : 7400                		moveq	#0,d2
(1)  115/  FF1802 : 7600                		moveq	#0,d3
(1)  116/  FF1804 : 6100 E9C0           		bsr	Sound_TrkPlay
(1)  117/  FF1808 :                     ; .oof:
(1)  118/  FF1808 :                     
(1)  119/  FF1808 : 7002                		moveq	#2,d0			; and set this psd-graphics mode
(1)  120/  FF180A : 6100 F1EE           		bsr	Video_Mars_GfxMode
(1)  121/  FF180E :                     
(1)  122/  FF180E :                     ; ====================================================================
(1)  123/  FF180E :                     ; ------------------------------------------------------
(1)  124/  FF180E :                     ; Loop
(1)  125/  FF180E :                     ; ------------------------------------------------------
(1)  126/  FF180E :                     
(1)  127/  FF180E :                     .loop:
(1)  128/  FF180E : 6100 F4F8           		bsr	MdMap_Update
(1)  129/  FF1812 : 6100 FA0A           .ploop:		bsr	System_WaitFrame
(1)  130/  FF1816 : 6100 EDC8           		bsr	Video_RunFade
(1)  131/  FF181A : 66F6                		bne.s	.ploop
(1)  132/  FF181C :                     
(1)  133/  FF181C :                     ; 		lea	str_Stats3(pc),a0
(1)  134/  FF181C :                     ; 		move.l	#locate(0,0,10),d0
(1)  135/  FF181C :                     ; 		bsr	Video_Print
(1)  136/  FF181C :                     
(1)  137/  FF181C : 3E38 A704           		move.w	(Controller_1+on_hold),d7
(1)  138/  FF1820 : 0807 000B           		btst	#bitJoyMode,d7
(1)  139/  FF1824 : 670C                		beq.s	.not_mode
(1)  140/  FF1826 : 6100 013E           		bsr	.fade_out
(1)  141/  FF182A : 31FC 0001 AB5E      		move.w	#1,(RAM_Glbl_Scrn).w
(1)  142/  FF1830 : 4E75                		rts
(1)  143/  FF1832 :                     .not_mode:
(1)  144/  FF1832 :                     
(1)  145/  FF1832 : 3E38 A704           		move.w	(Controller_1+on_hold),d7
(1)  146/  FF1836 : 0807 0000           		btst	#bitJoyUp,d7
(1)  147/  FF183A : 6706                		beq.s	.z_up2
(1)  148/  FF183C : 0468 0010 000C      		sub.w	#$10,mdl_z_pos(a0)
(1)  149/  FF1842 :                     .z_up2:
(1)  150/  FF1842 : 0807 0001           		btst	#bitJoyDown,d7
(1)  151/  FF1846 : 6706                		beq.s	.z_dw2
(1)  152/  FF1848 : 0668 0010 000C      		add.w	#$10,mdl_z_pos(a0)
(1)  153/  FF184E :                     .z_dw2:
(1)  154/  FF184E :                     
(1)  155/  FF184E :                     
(1)  156/  FF184E : 6100 0196           		bsr	SuperSpr_Main
(1)  157/  FF1852 : 3E38 A706           		move.w	(Controller_1+on_press),d7
(1)  158/  FF1856 : 0807 0005           		btst	#bitJoyC,d7
(1)  159/  FF185A : 6720                		beq.s	.z_up
(1)  160/  FF185C : 06B9 0001 0000 FFFF 		add.l	#$10000,(RAM_ThisSpeed).l
                    9008                
(1)  161/  FF1866 : 0CB9 0004 0000 FFFF 		cmp.l	#TEST_MAINSPD<<16,(RAM_ThisSpeed).l
                    9008                
(1)  162/  FF1870 : 6F0A                		ble.s	.z_up
(1)  163/  FF1872 : 23FC 0001 0000 FFFF 		move.l	#$10000,(RAM_ThisSpeed).l
                    9008                
(1)  164/  FF187C :                     .z_up:
(1)  165/  FF187C :                     
(1)  166/  FF187C : 3E38 A704           		move.w	(Controller_1+on_hold),d7
(1)  167/  FF1880 : 0807 0004           		btst	#bitJoyB,d7
(1)  168/  FF1884 : 666E                		bne.s	.not_hold3
(1)  169/  FF1886 :                     
(1)  170/  FF1886 : 2038 9008           		move.l	(RAM_ThisSpeed),d0
(1)  171/  FF188A : 2238 9008           		move.l	(RAM_ThisSpeed),d1
(1)  172/  FF188E : 3E38 A704           		move.w	(Controller_1+on_hold),d7
(1)  173/  FF1892 : 3C07                		move.w	d7,d6
(1)  174/  FF1894 : 0807 0001           		btst	#bitJoyDown,d7
(1)  175/  FF1898 : 6710                		beq.s	.noz_down
(1)  176/  FF189A : 31FC 0000 900C      		move.w	#0,(RAM_EmiFrame).w
(1)  177/  FF18A0 : 0678 0001 900E      		add.w	#1,(RAM_EmiAnim).w
(1)  178/  FF18A6 : D3B8 9004           		add.l	d1,(RAM_MapY).w
(1)  179/  FF18AA :                     .noz_down:
(1)  180/  FF18AA : 3C07                		move.w	d7,d6
(1)  181/  FF18AC : 0806 0000           		btst	#bitJoyUp,d6
(1)  182/  FF18B0 : 6710                		beq.s	.noz_up
(1)  183/  FF18B2 : 31FC 0004 900C      		move.w	#4,(RAM_EmiFrame).w
(1)  184/  FF18B8 : 0678 0001 900E      		add.w	#1,(RAM_EmiAnim).w
(1)  185/  FF18BE : 93B8 9004           		sub.l	d1,(RAM_MapY).w
(1)  186/  FF18C2 :                     .noz_up:
(1)  187/  FF18C2 : 3C07                		move.w	d7,d6
(1)  188/  FF18C4 : 0806 0003           		btst	#bitJoyRight,d6
(1)  189/  FF18C8 : 6710                		beq.s	.noz_r
(1)  190/  FF18CA : 31FC 0008 900C      		move.w	#8,(RAM_EmiFrame).w
(1)  191/  FF18D0 : 0678 0001 900E      		add.w	#1,(RAM_EmiAnim).w
(1)  192/  FF18D6 : D1B8 9000           		add.l	d0,(RAM_MapX).w
(1)  193/  FF18DA :                     .noz_r:
(1)  194/  FF18DA : 3C07                		move.w	d7,d6
(1)  195/  FF18DC : 0806 0002           		btst	#bitJoyLeft,d6
(1)  196/  FF18E0 : 6710                		beq.s	.noz_l
(1)  197/  FF18E2 : 31FC 000C 900C      		move.w	#$C,(RAM_EmiFrame).w
(1)  198/  FF18E8 : 0678 0001 900E      		add.w	#1,(RAM_EmiAnim).w
(1)  199/  FF18EE : 91B8 9000           		sub.l	d0,(RAM_MapX).w
(1)  200/  FF18F2 :                     .noz_l:
(1)  201/  FF18F2 :                     
(1)  202/  FF18F2 : 6114                		bsr.s	.update_pos
(1)  203/  FF18F4 :                     .not_hold3:
(1)  204/  FF18F4 : 3E38 A706           		move.w	(Controller_1+on_press),d7
(1)  205/  FF18F8 : 0807 0007           		btst	#bitJoyStart,d7
(1)  206/  FF18FC : 6700 FF10           		beq	.loop
(1)  207/  FF1900 : 31FC 0002 AB5E      		move.w	#2,(RAM_Glbl_Scrn).w
(1)  208/  FF1906 : 4E75                		rts
(1)  209/  FF1908 :                     
(1)  210/  FF1908 :                     
(1)  211/  FF1908 :                     .update_pos:
(1)  212/  FF1908 : 70FF                		moveq	#-1,d0
(1)  213/  FF190A : 3238 9000           		move.w	(RAM_MapX),d1
(1)  214/  FF190E : 3438 9004           		move.w	(RAM_MapY),d2
(1)  215/  FF1912 : 6100 F3B0           		bsr	MdMap_Move
(1)  216/  FF1916 : 7000                		moveq	#0,d0
(1)  217/  FF1918 : E241                		asr.w	#1,d1
(1)  218/  FF191A : E242                		asr.w	#1,d2
(1)  219/  FF191C : 31C1 9904           		move.w	d1,(RAM_HorScroll).w
(1)  220/  FF1920 : 31C2 9CC4           		move.w	d2,(RAM_VerScroll).w
(1)  221/  FF1924 : 6100 F39E           		bsr	MdMap_Move
(1)  222/  FF1928 : 7001                		moveq	#1,d0
(1)  223/  FF192A : E241                		asr.w	#1,d1
(1)  224/  FF192C : E242                		asr.w	#1,d2
(1)  225/  FF192E : 31C1 9906           		move.w	d1,(RAM_HorScroll+2).w
(1)  226/  FF1932 : 31C2 9CC6           		move.w	d2,(RAM_VerScroll+2).w
(1)  227/  FF1936 : 6100 F38C           		bsr	MdMap_Move
(1)  228/  FF193A : 44B8 9904           		neg.l	(RAM_HorScroll).w
(1)  229/  FF193E :                     
(1)  230/  FF193E :                     ; 		move.w	(RAM_MapX),d0
(1)  231/  FF193E :                     ; 		move.w	(RAM_MapY),d1
(1)  232/  FF193E :                     ; 		lea	(RAM_BgBufferM),a0
(1)  233/  FF193E :                     ; 		move.w	d0,md_bg_x(a0)
(1)  234/  FF193E :                     ; 		move.w	d1,md_bg_y(a0)
(1)  235/  FF193E :                     ; 		lea	(RAM_BgBuffer),a0
(1)  236/  FF193E :                     ; 		asr.w	#1,d0
(1)  237/  FF193E :                     ; 		asr.w	#1,d1
(1)  238/  FF193E :                     ; 		move.w	d0,md_bg_x(a0)
(1)  239/  FF193E :                     ; 		move.w	d1,md_bg_y(a0)
(1)  240/  FF193E :                     ; 		move.w	d0,(RAM_HorScroll).w
(1)  241/  FF193E :                     ; 		move.w	d1,(RAM_VerScroll).w
(1)  242/  FF193E :                     ; 		adda	#sizeof_mdbg,a0
(1)  243/  FF193E :                     ; 		asr.w	#1,d0
(1)  244/  FF193E :                     ; 		asr.w	#1,d1
(1)  245/  FF193E :                     ; 		move.w	d0,md_bg_x(a0)
(1)  246/  FF193E :                     ; 		move.w	d1,md_bg_y(a0)
(1)  247/  FF193E :                     ; 		move.w	d0,(RAM_HorScroll+2).w
(1)  248/  FF193E :                     ; 		move.w	d1,(RAM_VerScroll+2).w
(1)  249/  FF193E :                     ; 		neg.l	(RAM_HorScroll).w
(1)  250/  FF193E : 4E75                		rts
(1)  251/  FF1940 :                     
(1)  252/  FF1940 :                     ; ====================================================================
(1)  253/  FF1940 :                     ; ----------------------------------------------
(1)  254/  FF1940 :                     ; common subs
(1)  255/  FF1940 :                     ; ----------------------------------------------
(1)  256/  FF1940 :                     
(1)  257/  FF1940 :                     .fade_in:
(1)  258/  FF1940 : 31FC 0001 A6DA      		move.w	#1,(RAM_FadeMdReq).w
(1)  259/  FF1946 : 31FC 0001 A6E2      		move.w	#1,(RAM_FadeMarsReq).w
(1)  260/  FF194C : 31FC 0001 A6DC      		move.w	#1,(RAM_FadeMdIncr).w
(1)  261/  FF1952 : 31FC 0001 A6E4      		move.w	#1,(RAM_FadeMarsIncr).w
(1)  262/  FF1958 : 31FC 0004 A6DE      		move.w	#4,(RAM_FadeMdDelay).w
(1)  263/  FF195E : 31FC 0000 A6E6      		move.w	#0,(RAM_FadeMarsDelay).w
(1)  264/  FF1964 : 6024                		bra.s	.loop2
(1)  265/  FF1966 :                     
(1)  266/  FF1966 :                     .fade_out:
(1)  267/  FF1966 : 31FC 0002 A6DA      		move.w	#2,(RAM_FadeMdReq).w
(1)  268/  FF196C : 31FC 0002 A6E2      		move.w	#2,(RAM_FadeMarsReq).w
(1)  269/  FF1972 : 31FC 0001 A6DC      		move.w	#1,(RAM_FadeMdIncr).w
(1)  270/  FF1978 : 31FC 0001 A6E4      		move.w	#1,(RAM_FadeMarsIncr).w
(1)  271/  FF197E : 31FC 0004 A6DE      		move.w	#4,(RAM_FadeMdDelay).w
(1)  272/  FF1984 : 31FC 0000 A6E6      		move.w	#0,(RAM_FadeMarsDelay).w
(1)  273/  FF198A :                     .loop2:
(1)  274/  FF198A : 6100 F892           		bsr	System_WaitFrame
(1)  275/  FF198E : 6100 EC50           		bsr	Video_RunFade
(1)  276/  FF1992 : 66F6                		bne.s	.loop2
(1)  277/  FF1994 : 4E75                		rts
(1)  278/  FF1996 :                     
(1)  279/  FF1996 :                     ; ====================================================================
(1)  280/  FF1996 :                     ; ------------------------------------------------------
(1)  281/  FF1996 :                     ; Subroutines
(1)  282/  FF1996 :                     ; ------------------------------------------------------
(1)  283/  FF1996 :                     
(1)  284/  FF1996 :                     ; Emilie_MkSprite:
(1)  285/  FF1996 :                     ; 		lea	(RAM_Sprites),a6
(1)  286/  FF1996 :                     ; 		move.l	(RAM_EmiPosY),d0
(1)  287/  FF1996 :                     ; 		move.l	(RAM_EmiPosX),d1
(1)  288/  FF1996 :                     ; 		swap	d0
(1)  289/  FF1996 :                     ; 		swap	d1
(1)  290/  FF1996 :                     ; 		add.w	#$80+32,d0
(1)  291/  FF1996 :                     ; 		add.w	#$80+32,d1
(1)  292/  FF1996 :                     ; 		move.w	(RAM_EmiAnim),d2
(1)  293/  FF1996 :                     ; 		lsr.w	#3,d2
(1)  294/  FF1996 :                     ; 		and.w	#%11,d2
(1)  295/  FF1996 :                     ; 		move.w	(RAM_EmiFrame),d3
(1)  296/  FF1996 :                     ; 		add.w	d3,d2
(1)  297/  FF1996 :                     ; 		add.w	d2,d2
(1)  298/  FF1996 :                     ; 		lea	Map_Nicole(pc),a0
(1)  299/  FF1996 :                     ; 		move.w	(a0,d2.w),d2
(1)  300/  FF1996 :                     ; 		adda	d2,a0
(1)  301/  FF1996 :                     ; 		move.b	(a0)+,d4
(1)  302/  FF1996 :                     ; 		and.w	#$FF,d4
(1)  303/  FF1996 :                     ; 		sub.w	#1,d4
(1)  304/  FF1996 :                     ; 		move.w	#$0001,d5
(1)  305/  FF1996 :                     ; 		move.w	#emily_VRAM,d6
(1)  306/  FF1996 :                     ; .nxt_pz:
(1)  307/  FF1996 :                     ; 		move.b	(a0)+,d3
(1)  308/  FF1996 :                     ; 		ext.w	d3
(1)  309/  FF1996 :                     ; 		add.w	d0,d3
(1)  310/  FF1996 :                     ; 		move.w	d3,(a6)+
(1)  311/  FF1996 :                     ;
(1)  312/  FF1996 :                     ; 		move.b	(a0)+,d3
(1)  313/  FF1996 :                     ; 		lsl.w	#8,d3
(1)  314/  FF1996 :                     ; 		add.w	d5,d3
(1)  315/  FF1996 :                     ; 		move.w	d3,(a6)+
(1)  316/  FF1996 :                     ;
(1)  317/  FF1996 :                     ; 		move.b	(a0)+,d3
(1)  318/  FF1996 :                     ; 		lsl.w	#8,d3
(1)  319/  FF1996 :                     ; 		move.b	(a0)+,d2
(1)  320/  FF1996 :                     ; 		and.w	#$FF,d2
(1)  321/  FF1996 :                     ; 		add.w	d3,d2
(1)  322/  FF1996 :                     ; 		add.w	d6,d2
(1)  323/  FF1996 :                     ; 		move.w	d2,(a6)+
(1)  324/  FF1996 :                     ;
(1)  325/  FF1996 :                     ; 		move.b	(a0)+,d3
(1)  326/  FF1996 :                     ; 		ext.w	d3
(1)  327/  FF1996 :                     ; 		add.w	d1,d3
(1)  328/  FF1996 :                     ; 		move.w	d3,(a6)+
(1)  329/  FF1996 :                     ; 		add.w	#1,d5
(1)  330/  FF1996 :                     ; 		dbf	d4,.nxt_pz
(1)  331/  FF1996 :                     ; 		clr.l	(a6)+
(1)  332/  FF1996 :                     ; 		clr.l	(a6)+
(1)  333/  FF1996 :                     ;
(1)  334/  FF1996 :                     ; 	; DPLC
(1)  335/  FF1996 :                     ; 		move.w	(RAM_EmiAnim),d2
(1)  336/  FF1996 :                     ; 		lsr.w	#3,d2
(1)  337/  FF1996 :                     ; 		and.w	#%11,d2
(1)  338/  FF1996 :                     ; 		move.w	(RAM_EmiFrame),d3
(1)  339/  FF1996 :                     ; 		add.w	d3,d2
(1)  340/  FF1996 :                     ; 		add.w	d2,d2
(1)  341/  FF1996 :                     ; 		lea	Dplc_Nicole(pc),a0
(1)  342/  FF1996 :                     ; 		move.w	(a0,d2.w),d2
(1)  343/  FF1996 :                     ; 		adda	d2,a0
(1)  344/  FF1996 :                     ; 		move.w	(a0)+,d4
(1)  345/  FF1996 :                     ; 		and.w	#$FF,d4
(1)  346/  FF1996 :                     ; 		sub.w	#1,d4
(1)  347/  FF1996 :                     ; 		move.w	#emily_VRAM,d5
(1)  348/  FF1996 :                     ;
(1)  349/  FF1996 :                     ;
(1)  350/  FF1996 :                     ; 	; d0 - graphics
(1)  351/  FF1996 :                     ; 	; d5 - VRAM OUTPUT
(1)  352/  FF1996 :                     ; 		lsl.w	#5,d5
(1)  353/  FF1996 :                     ; 		moveq	#0,d1
(1)  354/  FF1996 :                     ; .nxt_dpz:
(1)  355/  FF1996 :                     ; 		move.l	#ART_EMI,d0
(1)  356/  FF1996 :                     ; 		move.w	(a0)+,d1
(1)  357/  FF1996 :                     ; 		move.w	d1,d2
(1)  358/  FF1996 :                     ; 		and.w	#$7FF,d1
(1)  359/  FF1996 :                     ; 		lsl.w	#5,d1
(1)  360/  FF1996 :                     ; 		add.l	d1,d0
(1)  361/  FF1996 :                     ; 		move.w	d5,d1
(1)  362/  FF1996 :                     ; 		lsr.w	#7,d2
(1)  363/  FF1996 :                     ; 		add.w	#$20,d2
(1)  364/  FF1996 :                     ; 		move.w	d2,d3
(1)  365/  FF1996 :                     ; 		bsr	Video_DmaMkEntry
(1)  366/  FF1996 :                     ; 		add.w	d3,d5
(1)  367/  FF1996 :                     ; 		dbf	d4,.nxt_dpz
(1)  368/  FF1996 :                     ; .no_upd:
(1)  369/  FF1996 :                     ; 		rts
(1)  370/  FF1996 :                     
(1)  371/  FF1996 :                     ; ====================================================================
(1)  372/  FF1996 :                     ; ------------------------------------------------------
(1)  373/  FF1996 :                     ; Subroutines
(1)  374/  FF1996 :                     ; ------------------------------------------------------
(1)  375/  FF1996 :                     
(1)  376/  FF1996 :                     SuperSpr_Init:
(1)  377/  FF1996 : 41F8 AF78           		lea	(RAM_MdDreq+Dreq_SuperSpr),a0
(1)  378/  FF199A : 203C 0215 367C      		move.l	#SuperSpr_Test,d0
(1)  379/  FF19A0 : 2200                		move.l	d0,d1
(1)  380/  FF19A2 : 82BC 2000 0000      		or.l	#TH,d1
(1)  381/  FF19A8 : 2141 0010           		move.l	d1,marsspr_data(a0)
(1)  382/  FF19AC : 317C 0200 0008      		move.w	#512,marsspr_dwidth(a0)
(1)  383/  FF19B2 : 317C 0080 0004      		move.w	#(320/2)-(64/2),marsspr_x(a0)
(1)  384/  FF19B8 : 317C 004C 0006      		move.w	#(224/2)-(72/2),marsspr_y(a0)
(1)  385/  FF19BE : 117C 0040 0002      		move.b	#64,marsspr_xs(a0)
(1)  386/  FF19C4 : 117C 0048 0003      		move.b	#72,marsspr_ys(a0)
(1)  387/  FF19CA : 317C 0080 000A      		move.w	#$80,marsspr_indx(a0)
(1)  388/  FF19D0 : 10BC 0000           		move.b	#0,marsspr_xfrm(a0)
(1)  389/  FF19D4 : 117C 0000 0001      		move.b	#0,marsspr_yfrm(a0)
(1)  390/  FF19DA :                     
(1)  391/  FF19DA :                     ; 		move.l	#SuperSpr_Test,d0
(1)  392/  FF19DA :                     ; 		move.l	d0,d1
(1)  393/  FF19DA :                     ; 		or.l	#TH,d1
(1)  394/  FF19DA :                     ; 		adda	#sizeof_marsspr,a0
(1)  395/  FF19DA :                     ; 		move.l	d1,marsspr_data(a0)
(1)  396/  FF19DA :                     ; 		move.w	#64,marsspr_dwidth(a0)
(1)  397/  FF19DA :                     ; 		move.w	#$60,marsspr_x(a0)
(1)  398/  FF19DA :                     ; 		move.w	#$50,marsspr_y(a0)
(1)  399/  FF19DA :                     ; 		move.b	#32,marsspr_xs(a0)
(1)  400/  FF19DA :                     ; 		move.b	#48,marsspr_ys(a0)
(1)  401/  FF19DA :                     ; 		move.w	#$80,marsspr_indx(a0)
(1)  402/  FF19DA :                     
(1)  403/  FF19DA :                     ; 		move.l	#SuperSpr_Test,d0
(1)  404/  FF19DA :                     ; 		move.l	d0,d1
(1)  405/  FF19DA :                     ; 		or.l	#TH,d1
(1)  406/  FF19DA :                     ; 		adda	#sizeof_marsspr,a0
(1)  407/  FF19DA :                     ; 		move.l	d1,marsspr_data(a0)
(1)  408/  FF19DA :                     ; 		move.w	#64,marsspr_dwidth(a0)
(1)  409/  FF19DA :                     ; 		move.w	#$10,marsspr_x(a0)
(1)  410/  FF19DA :                     ; 		move.w	#$10,marsspr_y(a0)
(1)  411/  FF19DA :                     ; 		move.b	#32,marsspr_xs(a0)
(1)  412/  FF19DA :                     ; 		move.b	#48,marsspr_ys(a0)
(1)  413/  FF19DA :                     ; 		move.w	#$80,marsspr_indx(a0)
(1)  414/  FF19DA :                     ; 		move.b	#1,marsspr_yfrm(a0)
(1)  415/  FF19DA :                     
(1)  416/  FF19DA :                     ; 		move.l	#SuperSpr_Test,d0
(1)  417/  FF19DA :                     ; 		move.l	d0,d1
(1)  418/  FF19DA :                     ; ; 		or.l	#TH,d1
(1)  419/  FF19DA :                     ; 		adda	#sizeof_marsspr,a0
(1)  420/  FF19DA :                     ; 		move.l	d1,marsspr_data(a0)
(1)  421/  FF19DA :                     ; 		move.w	#64,marsspr_dwidth(a0)
(1)  422/  FF19DA :                     ; 		move.w	#$110,marsspr_x(a0)
(1)  423/  FF19DA :                     ; 		move.w	#$80,marsspr_y(a0)
(1)  424/  FF19DA :                     ; 		move.b	#32,marsspr_xs(a0)
(1)  425/  FF19DA :                     ; 		move.b	#48,marsspr_ys(a0)
(1)  426/  FF19DA :                     ; 		move.w	#$80,marsspr_indx(a0)
(1)  427/  FF19DA :                     ; 		move.b	#3,marsspr_yfrm(a0)
(1)  428/  FF19DA :                     
(1)  429/  FF19DA :                     ; 		move.l	#SuperSpr_Test,d0
(1)  430/  FF19DA :                     ; 		move.l	d0,d1
(1)  431/  FF19DA :                     ; ; 		or.l	#TH,d1
(1)  432/  FF19DA :                     ; 		adda	#sizeof_marsspr,a0
(1)  433/  FF19DA :                     ; 		move.l	d1,marsspr_data(a0)
(1)  434/  FF19DA :                     ; 		move.w	#64,marsspr_dwidth(a0)
(1)  435/  FF19DA :                     ; 		move.w	#$30,marsspr_x(a0)
(1)  436/  FF19DA :                     ; 		move.w	#$70,marsspr_y(a0)
(1)  437/  FF19DA :                     ; 		move.b	#32,marsspr_xs(a0)
(1)  438/  FF19DA :                     ; 		move.b	#48,marsspr_ys(a0)
(1)  439/  FF19DA :                     ; 		move.w	#$80,marsspr_indx(a0)
(1)  440/  FF19DA :                     ; 		move.b	#2,marsspr_yfrm(a0)
(1)  441/  FF19DA :                     
(1)  442/  FF19DA : D0FC 0018           		adda	#sizeof_marsspr,a0
(1)  443/  FF19DE : 217C 0000 0000 0010 		move.l	#0,marsspr_data(a0)
(1)  444/  FF19E6 :                     
(1)  445/  FF19E6 :                     SuperSpr_Main:
(1)  446/  FF19E6 : 41F8 AF78           		lea	(RAM_MdDreq+Dreq_SuperSpr),a0
(1)  447/  FF19EA :                     
(1)  448/  FF19EA :                     ; 		sub.w	#1,(RAM_EmiTimer).w
(1)  449/  FF19EA :                     ; 		bpl.s	.wspr
(1)  450/  FF19EA :                     ; 		move.w	#6,(RAM_EmiTimer).w
(1)  451/  FF19EA :                     ; 		move.b	marsspr_xfrm(a0),d0
(1)  452/  FF19EA :                     ; 		add.w	#1,d0
(1)  453/  FF19EA :                     ; 		and.w	#%111,d0
(1)  454/  FF19EA :                     ; 		move.b	d0,marsspr_xfrm(a0)
(1)  455/  FF19EA :                     ; 		adda	#sizeof_marsspr,a0
(1)  456/  FF19EA :                     ; 		move.b	marsspr_yfrm(a0),d0
(1)  457/  FF19EA :                     ; 		add.w	#1,d0
(1)  458/  FF19EA :                     ; 		and.w	#%11,d0
(1)  459/  FF19EA :                     ; 		move.b	d0,marsspr_yfrm(a0)
(1)  460/  FF19EA :                     ; .wspr:
(1)  461/  FF19EA : 3E38 A706           		move.w	(Controller_1+on_press),d7
(1)  462/  FF19EE : 0807 000A           		btst	#bitJoyX,d7
(1)  463/  FF19F2 : 6710                		beq	.not_hold3
(1)  464/  FF19F4 : 41F8 AF78           		lea	(RAM_MdDreq+Dreq_SuperSpr),a0
(1)  465/  FF19F8 : 0668 0001 000C      		add.w	#1,marsspr_flags(a0)
(1)  466/  FF19FE : 0268 0003 000C      		and.w	#%11,marsspr_flags(a0)
(1)  467/  FF1A04 :                     .not_hold3:
(1)  468/  FF1A04 : 3E38 A706           		move.w	(Controller_1+on_press),d7
(1)  469/  FF1A08 : 0807 0008           		btst	#bitJoyZ,d7
(1)  470/  FF1A0C : 670C                		beq	.not_hold4
(1)  471/  FF1A0E : 41F8 AF78           		lea	(RAM_MdDreq+Dreq_SuperSpr),a0
(1)  472/  FF1A12 : 0610 0001           		add.b	#1,marsspr_xfrm(a0)
(1)  473/  FF1A16 : 0210 0007           		and.b	#%111,marsspr_xfrm(a0)
(1)  474/  FF1A1A :                     .not_hold4:
(1)  475/  FF1A1A : 3E38 A706           		move.w	(Controller_1+on_press),d7
(1)  476/  FF1A1E : 0807 0009           		btst	#bitJoyY,d7
(1)  477/  FF1A22 : 6710                		beq	.not_hold5
(1)  478/  FF1A24 : 41F8 AF78           		lea	(RAM_MdDreq+Dreq_SuperSpr),a0
(1)  479/  FF1A28 : 0628 0001 0001      		add.b	#1,marsspr_yfrm(a0)
(1)  480/  FF1A2E : 0228 0007 0001      		and.b	#%111,marsspr_yfrm(a0)
(1)  481/  FF1A34 :                     .not_hold5:
(1)  482/  FF1A34 :                     
(1)  483/  FF1A34 : 3E38 A704           		move.w	(Controller_1+on_hold),d7
(1)  484/  FF1A38 : 0807 0004           		btst	#bitJoyB,d7
(1)  485/  FF1A3C : 673C                		beq	.not_hold2
(1)  486/  FF1A3E : 41F8 AF78           		lea	(RAM_MdDreq+Dreq_SuperSpr),a0
(1)  487/  FF1A42 : 3028 0004           		move.w	marsspr_x(a0),d0
(1)  488/  FF1A46 : 3228 0006           		move.w	marsspr_y(a0),d1
(1)  489/  FF1A4A : 7404                		moveq	#TEST_MAINSPD,d2
(1)  490/  FF1A4C : 7604                		moveq	#TEST_MAINSPD,d3
(1)  491/  FF1A4E : 3E38 A704           		move.w	(Controller_1+on_hold),d7
(1)  492/  FF1A52 : 0807 0003           		btst	#bitJoyRight,d7
(1)  493/  FF1A56 : 6702                		beq.s	.nor_s
(1)  494/  FF1A58 : D042                		add.w	d2,d0
(1)  495/  FF1A5A :                     .nor_s:
(1)  496/  FF1A5A : 0807 0002           		btst	#bitJoyLeft,d7
(1)  497/  FF1A5E : 6702                		beq.s	.nol_s
(1)  498/  FF1A60 : 9042                		sub.w	d2,d0
(1)  499/  FF1A62 :                     .nol_s:
(1)  500/  FF1A62 : 0807 0001           		btst	#bitJoyDown,d7
(1)  501/  FF1A66 : 6702                		beq.s	.nod_s
(1)  502/  FF1A68 : D243                		add.w	d3,d1
(1)  503/  FF1A6A :                     .nod_s:
(1)  504/  FF1A6A : 0807 0000           		btst	#bitJoyUp,d7
(1)  505/  FF1A6E : 6702                		beq.s	.nou_s
(1)  506/  FF1A70 : 9243                		sub.w	d3,d1
(1)  507/  FF1A72 :                     .nou_s:
(1)  508/  FF1A72 : 3140 0004           		move.w	d0,marsspr_x(a0)
(1)  509/  FF1A76 : 3141 0006           		move.w	d1,marsspr_y(a0)
(1)  510/  FF1A7A :                     
(1)  511/  FF1A7A :                     ; 		add.w	#$80,d0
(1)  512/  FF1A7A :                     ; 		add.w	#$80,d1
(1)  513/  FF1A7A :                     ; 		lea	(RAM_Sprites),a0
(1)  514/  FF1A7A :                     ; 		move.w	d1,(a0)+
(1)  515/  FF1A7A :                     ; 		move.w	#$0F00,(a0)+
(1)  516/  FF1A7A :                     ; 		move.w	#$2000|$50,(a0)+
(1)  517/  FF1A7A :                     ; 		move.w	d0,(a0)+
(1)  518/  FF1A7A :                     
(1)  519/  FF1A7A :                     .not_hold2:
(1)  520/  FF1A7A :                     
(1)  521/  FF1A7A :                     ; 		move.w	(Controller_1+on_hold),d7
(1)  522/  FF1A7A :                     ; 		btst	#bitJoyA,d7
(1)  523/  FF1A7A :                     ; 		beq.s	.not_hold
(1)  524/  FF1A7A :                     ; 		lea	(RAM_MdDreq+Dreq_SuperSpr),a0
(1)  525/  FF1A7A :                     ; 		move.w	marsspr_xs(a0),d0
(1)  526/  FF1A7A :                     ; 		move.w	marsspr_ys(a0),d1
(1)  527/  FF1A7A :                     ; 		moveq	#TEST_MAINSPD,d2
(1)  528/  FF1A7A :                     ; 		moveq	#TEST_MAINSPD,d3
(1)  529/  FF1A7A :                     ; 		move.w	(Controller_1+on_hold),d7
(1)  530/  FF1A7A :                     ; 		btst	#bitJoyRight,d7
(1)  531/  FF1A7A :                     ; 		beq.s	.nor_s2
(1)  532/  FF1A7A :                     ; 		add.w	d2,d0
(1)  533/  FF1A7A :                     ; .nor_s2:
(1)  534/  FF1A7A :                     ; 		btst	#bitJoyLeft,d7
(1)  535/  FF1A7A :                     ; 		beq.s	.nol_s2
(1)  536/  FF1A7A :                     ; 		sub.w	d2,d0
(1)  537/  FF1A7A :                     ; .nol_s2:
(1)  538/  FF1A7A :                     ; 		btst	#bitJoyDown,d7
(1)  539/  FF1A7A :                     ; 		beq.s	.nod_s2
(1)  540/  FF1A7A :                     ; 		add.w	d3,d1
(1)  541/  FF1A7A :                     ; .nod_s2:
(1)  542/  FF1A7A :                     ; 		btst	#bitJoyUp,d7
(1)  543/  FF1A7A :                     ; 		beq.s	.nou_s2
(1)  544/  FF1A7A :                     ; 		sub.w	d3,d1
(1)  545/  FF1A7A :                     ; .nou_s2:
(1)  546/  FF1A7A :                     ; 		move.w	d0,marsspr_xs(a0)
(1)  547/  FF1A7A :                     ; 		move.w	d1,marsspr_ys(a0)
(1)  548/  FF1A7A :                     .not_hold:
(1)  549/  FF1A7A :                     
(1)  550/  FF1A7A : 0678 0001 900C      		add.w	#1,(RAM_EmiFrame).w
(1)  551/  FF1A80 : 4E75                		rts
(1)  552/  FF1A82 :                     
(1)  553/  FF1A82 :                     ; ====================================================================
(1)  554/  FF1A82 :                     ; ------------------------------------------------------
(1)  555/  FF1A82 :                     ; Pick map
(1)  556/  FF1A82 :                     ; ------------------------------------------------------
(1)  557/  FF1A82 :                     
(1)  558/  FF1A82 :                     Level_PickMap:
(1)  559/  FF1A82 : 207C 0093 4484      		move.l	#MapHead_M,a0
(1)  560/  FF1A88 : 227C 220C 297C      		move.l	#MapBlk_M|TH,a1
(1)  561/  FF1A8E : 247C 220D 2A7C      		move.l	#MapFg_M|TH,a2
(1)  562/  FF1A94 : 267C 0000 0000      		move.l	#0,a3
(1)  563/  FF1A9A : 287C 0000 0000      		move.l	#0,a4
(1)  564/  FF1AA0 : 70FF                		moveq	#-1,d0
(1)  565/  FF1AA2 : 7200                		moveq	#0,d1
(1)  566/  FF1AA4 : 7400                		moveq	#0,d2
(1)  567/  FF1AA6 : 6100 F128           		bsr	MdMap_Set
(1)  568/  FF1AAA :                     
(1)  569/  FF1AAA : 207C 0092 FE92      		move.l	#MapHead_0,a0
(1)  570/  FF1AB0 : 227C 0092 FE9C      		move.l	#MapBlk_0,a1
(1)  571/  FF1AB6 : 247C 0093 06A4      		move.l	#MapFgL_0,a2
(1)  572/  FF1ABC : 267C 0093 1304      		move.l	#MapFgH_0,a3
(1)  573/  FF1AC2 : 287C 0093 1F64      		move.l	#MapFgC_0,a4
(1)  574/  FF1AC8 : 7000                		moveq	#0,d0
(1)  575/  FF1ACA : 323C C000           		move.w	#$C000,d1
(1)  576/  FF1ACE : 343C 2000           		move.w	#$2000,d2
(1)  577/  FF1AD2 : 6100 F0FC           		bsr	MdMap_Set
(1)  578/  FF1AD6 :                     
(1)  579/  FF1AD6 : 207C 0092 FE92      		move.l	#MapHead_0,a0
(1)  580/  FF1ADC : 227C 0092 FE9C      		move.l	#MapBlk_0,a1
(1)  581/  FF1AE2 : 247C 0093 2BC4      		move.l	#MapBgL_0,a2
(1)  582/  FF1AE8 : 267C 0093 3824      		move.l	#MapBgH_0,a3
(1)  583/  FF1AEE : 287C 0000 0000      		move.l	#0,a4
(1)  584/  FF1AF4 : 7001                		moveq	#1,d0
(1)  585/  FF1AF6 : 323C E000           		move.w	#$E000,d1
(1)  586/  FF1AFA : 343C 2000           		move.w	#$2000,d2
(1)  587/  FF1AFE : 6100 F0D0           		bsr	MdMap_Set
(1)  588/  FF1B02 :                     
(1)  589/  FF1B02 : 4E75                		rts
(1)  590/  FF1B04 :                     
(1)  591/  FF1B04 :                     ; 		lea	(RAM_MdDreq+Dreq_ScrnBuff),a0
(1)  592/  FF1B04 :                     ; 		move.l	#TESTMARS_BG,scrlbg_Data(a0)
(1)  593/  FF1B04 :                     ; 		move.l	#512,scrlbg_W(a0)
(1)  594/  FF1B04 :                     ; 		move.l	#256,scrlbg_H(a0)
(1)  595/  FF1B04 :                     ; 		move.l	#$00000000,scrlbg_X(a0)
(1)  596/  FF1B04 :                     ; 		move.l	#$00000000,scrlbg_Y(a0)
(1)  597/  FF1B04 :                     
(1)  598/  FF1B04 :                     ; ====================================================================
(1)  599/  FF1B04 :                     ; ------------------------------------------------------
(1)  600/  FF1B04 :                     ; VBlank
(1)  601/  FF1B04 :                     ; ------------------------------------------------------
(1)  602/  FF1B04 :                     
(1)  603/  FF1B04 :                     ; ------------------------------------------------------
(1)  604/  FF1B04 :                     ; HBlank
(1)  605/  FF1B04 :                     ; ------------------------------------------------------
(1)  606/  FF1B04 :                     
(1)  607/  FF1B04 :                     ; ====================================================================
(1)  608/  FF1B04 :                     ; ------------------------------------------------------
(1)  609/  FF1B04 :                     ; DATA
(1)  610/  FF1B04 :                     ;
(1)  611/  FF1B04 :                     ; Small stuff goes here
(1)  612/  FF1B04 :                     ; ------------------------------------------------------
(1)  613/  FF1B04 :                     
(1)  614/  FF1B04 :                     ; str_Stats3:
(1)  615/  FF1B04 :                     ; 		dc.b "\\w \\w \\w \\w",$A
(1)  616/  FF1B04 :                     ; 		dc.b "\\w \\w \\w \\w",$A,$A
(1)  617/  FF1B04 :                     ; 		dc.b "\\l",0
(1)  618/  FF1B04 :                     ; 		dc.l sysmars_reg+comm0
(1)  619/  FF1B04 :                     ; 		dc.l sysmars_reg+comm2
(1)  620/  FF1B04 :                     ; 		dc.l sysmars_reg+comm4
(1)  621/  FF1B04 :                     ; 		dc.l sysmars_reg+comm6
(1)  622/  FF1B04 :                     ; 		dc.l sysmars_reg+comm8
(1)  623/  FF1B04 :                     ; 		dc.l sysmars_reg+comm10
(1)  624/  FF1B04 :                     ; 		dc.l sysmars_reg+comm12
(1)  625/  FF1B04 :                     ; 		dc.l sysmars_reg+comm14
(1)  626/  FF1B04 :                     ; 		dc.l RAM_Framecount
(1)  627/  FF1B04 :                     ; 		align 2
(1)  628/  FF1B04 :                     
(1)  629/  FF1B04 :                     ; Pal_Emily:
(1)  630/  FF1B04 :                     ; 		dc.w 0
(1)  631/  FF1B04 :                     ; 		binclude "data/md/sprites/emi_pal.bin",2
(1)  632/  FF1B04 :                     ; 		align 2
(1)  633/  FF1B04 :                     ; Map_Nicole:
(1)  634/  FF1B04 :                     ; 		include "data/md/sprites/emi_map.asm"
(1)  635/  FF1B04 :                     ; 		align 2
(1)  636/  FF1B04 :                     ; Dplc_Nicole:
(1)  637/  FF1B04 :                     ; 		include "data/md/sprites/emi_plc.asm"
(1)  638/  FF1B04 :                     ; 		align 2
(1)  639/  FF1B04 :                     
(1)  640/  FF1B04 :                     ; ====================================================================
(1)  641/  FF1B04 :                     
(1)  642/  FF1B04 :                     .here:
(1)  646/    23D8 :                     		dephase
(1)  647/    23D8 :                     
      70/    23D8 :                     RamCode_Scrn2:
      71/    23D8 :                     		include "code/screen_2.asm"
(1)    1/    23D8 :                     ; ====================================================================
(1)    2/    23D8 :                     ; ----------------------------------------------------------------
(1)    3/    23D8 :                     ; 3D Part
(1)    4/    23D8 :                     ; ----------------------------------------------------------------
(1)    5/    23D8 :                     
(1)    6/  FF170C :                     		phase RAMCODE_USER
(1)    7/  FF170C :                     
(1)    8/  FF170C :                     ; ====================================================================
(1)    9/  FF170C :                     ; ------------------------------------------------------
(1)   10/  FF170C :                     ; Settings
(1)   11/  FF170C :                     ; ------------------------------------------------------
(1)   12/  FF170C :                     
(1)   13/  FF170C : =$1000              MAPPZ_SIZE	equ $1000
(1)   14/  FF170C : =$10                SET_MAPSPD	equ $10
(1)   15/  FF170C :                     
(1)   16/  FF170C :                     ; ====================================================================
(1)   17/  FF170C :                     ; ------------------------------------------------------
(1)   18/  FF170C :                     ; Structs
(1)   19/  FF170C :                     ; ------------------------------------------------------
(1)   20/  FF170C :                     
(1)   21/  FF170C : (MACRO)             		struct 0
(1)   21/  FF170C : =$FF170C            GLBL_LASTPC     set *
(1)   21/    23D8 :                                     dephase
(1)   21/    23D8 : =$23D8              GLBL_LASTORG    set *
(1)   21/       0 :                                     phase 0
(1)   22/       0 :                     field_data	ds.l 1
(1)   23/       4 :                     ; field_x		ds.w 1
(1)   24/       4 :                     ; field_z		ds.w 1
(1)   25/       4 :                     sizeof_mdfield	ds.l 0
(1)   26/       4 : (MACRO)             		finish
(1)   26/       0 :                                     !org GLBL_LASTORG
(1)   26/  FF170C :                                     phase GLBL_LASTPC
(1)   27/  FF170C :                     
(1)   28/  FF170C :                     ; ====================================================================
(1)   29/  FF170C :                     ; ------------------------------------------------------
(1)   30/  FF170C :                     ; This screen's RAM
(1)   31/  FF170C :                     ; ------------------------------------------------------
(1)   32/  FF170C :                     
(1)   33/  FF170C : (MACRO)             		struct RAM_ModeBuff
(1)   33/  FF170C : =$FF170C            GLBL_LASTPC     set *
(1)   33/    23D8 :                                     dephase
(1)   33/    23D8 : =$23D8              GLBL_LASTORG    set *
(1)   33/FFFFFFFFFFFF9000 :                                     phase RAM_MODEBUFF
(1)   34/FFFFFFFFFFFF9000 :                     RAM_FieldBuff	ds.b sizeof_mdfield
(1)   35/FFFFFFFFFFFF9004 :                     RAM_HorCopy	ds.w 1
(1)   36/FFFFFFFFFFFF9006 :                     RAM_CamData	ds.l 1
(1)   37/FFFFFFFFFFFF900A :                     RAM_CamFrame	ds.l 1
(1)   38/FFFFFFFFFFFF900E :                     RAM_CamTimer	ds.l 1
(1)   39/FFFFFFFFFFFF9012 :                     RAM_CamSpeed	ds.l 1
(1)   40/FFFFFFFFFFFF9016 :                     RAM_Cam_Xpos	ds.l 1
(1)   41/FFFFFFFFFFFF901A :                     RAM_Cam_Ypos	ds.l 1
(1)   42/FFFFFFFFFFFF901E :                     RAM_Cam_Zpos	ds.l 1
(1)   43/FFFFFFFFFFFF9022 : (MACRO)             		finish
(1)   43/FFFFFFFFFFFF9000 :                                     !org GLBL_LASTORG
(1)   43/  FF170C :                                     phase GLBL_LASTPC
(1)   44/  FF170C :                     
(1)   45/  FF170C :                     ; ====================================================================
(1)   46/  FF170C :                     ; ------------------------------------------------------
(1)   47/  FF170C :                     ; Code start
(1)   48/  FF170C :                     ; ------------------------------------------------------
(1)   49/  FF170C :                     
(1)   50/  FF170C :                     MD_3DMODE:
(1)   51/  FF170C : 46FC 2700           		move.w	#$2700,sr
(1)   52/  FF1710 : 08B9 0006 FFFF A6EB 		bclr	#bitDispEnbl,(RAM_VdpRegs+1).l
(1)   53/  FF1718 : 6100 EB82           		bsr	Video_Update
(1)   54/  FF171C : 6100 FF4C           		bsr	Mode_Init
(1)   55/  FF1720 : 6100 ECBE           		bsr	Video_PrintInit
(1)   56/  FF1724 :                     
(1)   57/  FF1724 :                     ; 	3D TEST
(1)   58/  FF1724 : 203C 0004 0000      		move.l	#Art_Test3D,d0			; Genesis VDP graphics
(1)   59/  FF172A : 323C 0020           		move.w	#$20,d1
(1)   60/  FF172E : 343C 1D20           		move.w	#Art_Test3D_e-Art_Test3D,d2
(1)   61/  FF1732 : 6100 F19E           		bsr	Video_LoadArt
(1)   62/  FF1736 : 41F9 0092 F092      		lea	(Map_Test3D),a0			; 16-color palette
(1)   63/  FF173C : 203C 0001 0000      		move.l	#locate(1,0,0),d0
(1)   64/  FF1742 : 223C 003F 001B      		move.l	#mapsize(512,224),d1
(1)   65/  FF1748 : 7401                		moveq	#1,d2
(1)   66/  FF174A : 6100 EC3C           		bsr	Video_LoadMap
(1)   67/  FF174E : 41F9 0092 F082      		lea	(Pal_Test3D),a0			; 16-color palette
(1)   68/  FF1754 : 7000                		moveq	#0,d0
(1)   69/  FF1756 : 323C 0010           		move.w	#16,d1
(1)   70/  FF175A : 6100 EE96           		bsr	Video_FadePal
(1)   71/  FF175E : 41F9 0092 ECF4      		lea	(MDLDATA_PAL_TEST),a0
(1)   72/  FF1764 : 7000                		moveq	#0,d0
(1)   73/  FF1766 : 323C 0100           		move.w	#256,d1
(1)   74/  FF176A : 7401                		moveq	#1,d2
(1)   75/  FF176C : 6100 F2CC           		bsr	Video_FadePal_Mars
(1)   76/  FF1770 : 4278 A1F4           		clr.w	(RAM_PaletteFd).w		; <-- quick patch
(1)   77/  FF1774 : 4278 A274           		clr.w	(RAM_MdMarsPalFd).w
(1)   78/  FF1778 : 0278 7FFF A274      		and.w	#$7FFF,(RAM_MdMarsPalFd).w
(1)   79/  FF177E :                     
(1)   80/  FF177E :                     	; Read MAP
(1)   81/  FF177E : 203C 00FF 2408      		move.l	#MapCamera_0,d0			; Animation
(1)   82/  FF1784 : 7201                		moveq	#1,d1
(1)   83/  FF1786 : 6100 02B0           		bsr	MdMdl_SetNewCamera
(1)   84/  FF178A : 6100 0114           		bsr	MdlMap_Init
(1)   85/  FF178E :                     
(1)   86/  FF178E :                     
(1)   87/  FF178E :                     ; 		lea	(RAM_MdDreq+Dreq_Objects),a0
(1)   88/  FF178E :                     ; 		move.l	#MarsObj_test|TH,mdl_data(a0)
(1)   89/  FF178E :                     ; 		move.w	#-$800,mdl_z_pos(a0)
(1)   90/  FF178E :                     ; 		move.w	#0,mdl_y_pos(a0)
(1)   91/  FF178E :                     
(1)   92/  FF178E :                     ; 	; Testing track
(1)   93/  FF178E : 7000                		moveq	#0,d0
(1)   94/  FF1790 : 6100 EA72           		bsr	Sound_TrkStop
(1)   95/  FF1794 : 323C 00E8           		move.w	#200+32,d1
(1)   96/  FF1798 : 6100 EAB2           		bsr	Sound_GlbBeats
(1)   97/  FF179C : 41F9 0088 A696      		lea	(GemaTrkData_MOVEME),a0
(1)   98/  FF17A2 :                     ; 		lea	(GemaTrkData_Nadie_MD),a0
(1)   99/  FF17A2 : 7000                		moveq	#0,d0
(1)  100/  FF17A4 : 323C 0007           		move.w	#7,d1
(1)  101/  FF17A8 : 7400                		moveq	#0,d2
(1)  102/  FF17AA : 363C 0000           		move.w	#0,d3
(1)  103/  FF17AE : 6100 EA16           		bsr	Sound_TrkPlay
(1)  104/  FF17B2 :                     
(1)  105/  FF17B2 :                     	; Set Fade-in settings
(1)  106/  FF17B2 : 31FC 0001 A6DC      		move.w	#1,(RAM_FadeMdIncr).w
(1)  107/  FF17B8 : 31FC 0002 A6E4      		move.w	#2,(RAM_FadeMarsIncr).w
(1)  108/  FF17BE : 31FC 0001 A6DE      		move.w	#1,(RAM_FadeMdDelay).w
(1)  109/  FF17C4 : 31FC 0000 A6E6      		move.w	#0,(RAM_FadeMarsDelay).w
(1)  110/  FF17CA : 31FC 0001 A6DA      		move.w	#1,(RAM_FadeMdReq).w
(1)  111/  FF17D0 : 31FC 0001 A6E2      		move.w	#1,(RAM_FadeMarsReq).w
(1)  112/  FF17D6 : 13FC 0000 FFFF A6F5 		move.b	#%000,(RAM_VdpRegs+$B).l
(1)  113/  FF17DE : 13FC 0010 FFFF A6F1 		move.b	#$10,(RAM_VdpRegs+7).l
(1)  114/  FF17E6 : 08F9 0006 FFFF A6EB 		bset	#bitDispEnbl,(RAM_VdpRegs+1).l
(1)  115/  FF17EE : 6100 EAAC           		bsr	Video_Update
(1)  116/  FF17F2 : 7003                		moveq	#3,d0			; and set this psd-graphics mode
(1)  117/  FF17F4 : 6100 F204           		bsr	Video_Mars_GfxMode
(1)  118/  FF17F8 : 6100 FA24           		bsr	System_WaitFrame	; Wait first frames...
(1)  119/  FF17FC : 7E01                		moveq	#2-1,d7
(1)  120/  FF17FE :                     .pre_w:
(1)  121/  FF17FE : 08F9 0005 00A1 512D 		bset	#5,(sysmars_reg+comm12+1).l
(1)  122/  FF1806 :                     .pre_wl:
(1)  123/  FF1806 : 0839 0005 00A1 512D 		btst	#5,(sysmars_reg+comm12+1).l
(1)  124/  FF180E : 66F6                		bne.s	.pre_wl
(1)  125/  FF1810 : 51CF FFEC           		dbf	d7,.pre_w
(1)  126/  FF1814 :                     
(1)  127/  FF1814 :                     ; ====================================================================
(1)  128/  FF1814 :                     ; ------------------------------------------------------
(1)  129/  FF1814 :                     ; Loop
(1)  130/  FF1814 :                     ; ------------------------------------------------------
(1)  131/  FF1814 :                     
(1)  132/  FF1814 :                     .loop:
(1)  133/  FF1814 : 6100 F4F2           		bsr	MdMap_Update
(1)  134/  FF1818 : 6100 FA04           		bsr	System_WaitFrame
(1)  135/  FF181C : 6100 EDC2           		bsr	Video_RunFade
(1)  136/  FF1820 : 66F2                		bne.s	.loop
(1)  137/  FF1822 :                     
(1)  138/  FF1822 : 3E38 A704           		move.w	(Controller_1+on_hold),d7
(1)  139/  FF1826 : 0807 000B           		btst	#bitJoyMode,d7
(1)  140/  FF182A : 670A                		beq.s	.not_mode
(1)  141/  FF182C : 6142                		bsr	.fade_out
(1)  142/  FF182E : 31FC 0000 AB5E      		move.w	#0,(RAM_Glbl_Scrn).w
(1)  143/  FF1834 : 4E75                		rts
(1)  144/  FF1836 :                     .not_mode:
(1)  145/  FF1836 :                     
(1)  146/  FF1836 : 41FA 028E           		lea	str_Stats2(pc),a0
(1)  147/  FF183A : 203C 0000 0202      		move.l	#locate(0,2,2),d0
(1)  148/  FF1840 : 6100 EBCA           		bsr	Video_Print
(1)  149/  FF1844 : 6100 0090           		bsr	MdlMap_Loop
(1)  150/  FF1848 :                     
(1)  151/  FF1848 :                     
(1)  152/  FF1848 : 60CA                		bra	.loop
(1)  153/  FF184A :                     ; 		move.w	(Controller_1+on_press),d7
(1)  154/  FF184A :                     ; 		btst	#bitJoyStart,d7
(1)  155/  FF184A :                     ; 		beq	.loop
(1)  156/  FF184A :                     ; 		bra	MD_DebugMenu
(1)  157/  FF184A :                     
(1)  158/  FF184A :                     ; ====================================================================
(1)  159/  FF184A :                     ; ----------------------------------------------
(1)  160/  FF184A :                     ; common subs
(1)  161/  FF184A :                     ; ----------------------------------------------
(1)  162/  FF184A :                     
(1)  163/  FF184A :                     .fade_in:
(1)  164/  FF184A : 31FC 0001 A6DA      		move.w	#1,(RAM_FadeMdReq).w
(1)  165/  FF1850 : 31FC 0001 A6E2      		move.w	#1,(RAM_FadeMarsReq).w
(1)  166/  FF1856 : 31FC 0001 A6DC      		move.w	#1,(RAM_FadeMdIncr).w
(1)  167/  FF185C : 31FC 0001 A6E4      		move.w	#1,(RAM_FadeMarsIncr).w
(1)  168/  FF1862 : 31FC 0004 A6DE      		move.w	#4,(RAM_FadeMdDelay).w
(1)  169/  FF1868 : 31FC 0000 A6E6      		move.w	#0,(RAM_FadeMarsDelay).w
(1)  170/  FF186E : 6024                		bra.s	.loop2
(1)  171/  FF1870 :                     
(1)  172/  FF1870 :                     .fade_out:
(1)  173/  FF1870 : 31FC 0002 A6DA      		move.w	#2,(RAM_FadeMdReq).w
(1)  174/  FF1876 : 31FC 0002 A6E2      		move.w	#2,(RAM_FadeMarsReq).w
(1)  175/  FF187C : 31FC 0001 A6DC      		move.w	#1,(RAM_FadeMdIncr).w
(1)  176/  FF1882 : 31FC 0001 A6E4      		move.w	#1,(RAM_FadeMarsIncr).w
(1)  177/  FF1888 : 31FC 0004 A6DE      		move.w	#4,(RAM_FadeMdDelay).w
(1)  178/  FF188E : 31FC 0000 A6E6      		move.w	#0,(RAM_FadeMarsDelay).w
(1)  179/  FF1894 :                     .loop2:
(1)  180/  FF1894 : 6100 F988           		bsr	System_WaitFrame
(1)  181/  FF1898 : 6100 ED46           		bsr	Video_RunFade
(1)  182/  FF189C : 66F6                		bne.s	.loop2
(1)  183/  FF189E : 4E75                		rts
(1)  184/  FF18A0 :                     
(1)  185/  FF18A0 :                     ; ====================================================================
(1)  186/  FF18A0 :                     ; ------------------------------------------------------
(1)  187/  FF18A0 :                     ; Subroutines
(1)  188/  FF18A0 :                     ; ------------------------------------------------------
(1)  189/  FF18A0 :                     
(1)  190/  FF18A0 :                     MdlMap_Init:
(1)  191/  FF18A0 : 4DF8 ADE0           		lea	(RAM_MdDreq+Dreq_ObjCam),a6
(1)  192/  FF18A4 : 4BF8 9000           		lea	(RAM_FieldBuff),a5
(1)  193/  FF18A8 : 2ABC 00FF 1AE4      		move.l	#MarsMap_00,field_data(a5)
(1)  194/  FF18AE : 6100 0102           		bsr	MdlMap_Build
(1)  195/  FF18B2 : 6100 01A0           		bsr	MdMdl_CamAnimate
(1)  196/  FF18B6 : 6A1E                		bpl.s	MdlMap_Loop
(1)  197/  FF18B8 : 42B9 FFFF 9016      		clr.l	(RAM_Cam_Xpos).l
(1)  198/  FF18BE : 42B9 FFFF 901A      		clr.l	(RAM_Cam_Ypos).l
(1)  199/  FF18C4 : 42B9 FFFF 901E      		clr.l	(RAM_Cam_Zpos).l
(1)  200/  FF18CA : 42AE 000C           		clr.l	cam_x_rot(a6)
(1)  201/  FF18CE : 42AE 0010           		clr.l	cam_y_rot(a6)
(1)  202/  FF18D2 : 42AE 0014           		clr.l	cam_z_rot(a6)
(1)  203/  FF18D6 :                     MdlMap_Loop:
(1)  204/  FF18D6 :                     ; 		lea	(RAM_MdDreq+Dreq_Objects),a6
(1)  205/  FF18D6 :                     ; 		add.w	#8*4,mdl_x_rot(a6)
(1)  206/  FF18D6 :                     
(1)  207/  FF18D6 : 4DF8 ADE0           		lea	(RAM_MdDreq+Dreq_ObjCam),a6
(1)  208/  FF18DA : 4BF8 9000           		lea	(RAM_FieldBuff),a5
(1)  209/  FF18DE : 3E38 A704           		move.w	(Controller_1+on_hold),d7
(1)  210/  FF18E2 : 2C3C 0000 0010      		move.l	#SET_MAPSPD,d6
(1)  211/  FF18E8 : 2A06                		move.l	d6,d5
(1)  212/  FF18EA : E48D                		lsr.l	#2,d5
(1)  213/  FF18EC : 3839 FFFF 9004      		move.w	(RAM_HorCopy).l,d4
(1)  214/  FF18F2 : 0807 0000           		btst	#bitJoyUp,d7
(1)  215/  FF18F6 : 6706                		beq.s	.z_up2
(1)  216/  FF18F8 : DDB9 FFFF 901E      		add.l	d6,(RAM_Cam_Zpos).l;cam_z_pos(a6)
(1)  217/  FF18FE :                     .z_up2:
(1)  218/  FF18FE : 0807 0001           		btst	#bitJoyDown,d7
(1)  219/  FF1902 : 6706                		beq.s	.z_dw2
(1)  220/  FF1904 : 9DB9 FFFF 901E      		sub.l	d6,(RAM_Cam_Zpos).l;cam_z_pos(a6)
(1)  221/  FF190A :                     .z_dw2:
(1)  222/  FF190A : 3E38 A704           		move.w	(Controller_1+on_hold),d7
(1)  223/  FF190E : 0807 0002           		btst	#bitJoyLeft,d7
(1)  224/  FF1912 : 6706                		beq.s	.z_up3
(1)  225/  FF1914 : 9DB9 FFFF 9016      		sub.l	d6,(RAM_Cam_Xpos).l;cam_X_pos(a6)
(1)  226/  FF191A :                     .z_up3:
(1)  227/  FF191A : 0807 0003           		btst	#bitJoyRight,d7
(1)  228/  FF191E : 6706                		beq.s	.z_dw3
(1)  229/  FF1920 : DDB9 FFFF 9016      		add.l	d6,(RAM_Cam_Xpos).l;cam_X_pos(a6)
(1)  230/  FF1926 :                     .z_dw3:
(1)  231/  FF1926 : 0807 0006           		btst	#bitJoyA,d7
(1)  232/  FF192A : 6706                		beq.s	.z_rl
(1)  233/  FF192C : 9DAE 000C           		sub.l	d6,cam_x_rot(a6)
(1)  234/  FF1930 : D845                		add.w	d5,d4
(1)  235/  FF1932 :                     .z_rl:
(1)  236/  FF1932 : 0807 0004           		btst	#bitJoyB,d7
(1)  237/  FF1936 : 6706                		beq.s	.z_rr
(1)  238/  FF1938 : DDAE 000C           		add.l	d6,cam_x_rot(a6)
(1)  239/  FF193C : 9845                		sub.w	d5,d4
(1)  240/  FF193E :                     .z_rr:
(1)  241/  FF193E : 0807 000A           		btst	#bitJoyX,d7
(1)  242/  FF1942 : 6704                		beq.s	.z2_rl
(1)  243/  FF1944 : DDAE 0010           		add.l	d6,cam_y_rot(a6)
(1)  244/  FF1948 :                     .z2_rl:
(1)  245/  FF1948 : 0807 0009           		btst	#bitJoyY,d7
(1)  246/  FF194C : 6704                		beq.s	.z2_rr
(1)  247/  FF194E : 9DAE 0010           		sub.l	d6,cam_y_rot(a6)
(1)  248/  FF1952 :                     .z2_rr:
(1)  249/  FF1952 :                     
(1)  250/  FF1952 : 0807 0008           		btst	#bitJoyZ,d7
(1)  251/  FF1956 : 6706                		beq.s	.z_rld
(1)  252/  FF1958 : 9DB9 FFFF 901A      		sub.l	d6,(RAM_Cam_Ypos).l
(1)  253/  FF195E :                     .z_rld:
(1)  254/  FF195E : 0807 0005           		btst	#bitJoyC,d7
(1)  255/  FF1962 : 6706                		beq.s	.z_rrd
(1)  256/  FF1964 : DDB9 FFFF 901A      		add.l	d6,(RAM_Cam_Ypos).l
(1)  257/  FF196A :                     .z_rrd:
(1)  258/  FF196A : 33C4 FFFF 9004      		move.w	d4,(RAM_HorCopy).l
(1)  259/  FF1970 : 0839 0005 00A1 512D 		btst	#5,(sysmars_reg+comm12+1).l
(1)  260/  FF1978 : 6612                		bne.s	.busy
(1)  261/  FF197A : 33F9 FFFF 9004 FFFF 		move.w	(RAM_HorCopy).l,(RAM_HorScroll+2).l
                    9906                
(1)  262/  FF1984 : 08F9 0005 00A1 512D 		bset	#5,(sysmars_reg+comm12+1).l
(1)  263/  FF198C :                     .busy:
(1)  264/  FF198C : 6100 00C6           		bsr	MdMdl_CamAnimate
(1)  265/  FF1990 :                     
(1)  266/  FF1990 :                     ; 		move.l	cam_z_pos(a6),d7
(1)  267/  FF1990 :                     ; 		and.w	#-MAPPZ_SIZE,d7
(1)  268/  FF1990 :                     ; 		beq.s	.z_upd
(1)  269/  FF1990 :                     ; 		moveq	#1,d0
(1)  270/  FF1990 :                     ; 		tst.w	d7
(1)  271/  FF1990 :                     ; 		bmi.s	.z_up
(1)  272/  FF1990 :                     ; 		neg.w	d0
(1)  273/  FF1990 :                     ; .z_up:
(1)  274/  FF1990 :                     ; 		add.w	d0,field_z(a5)
(1)  275/  FF1990 :                     ; .z_upd:
(1)  276/  FF1990 :                     ; 		move.l	cam_x_pos(a6),d7
(1)  277/  FF1990 :                     ; ; 		add.w	#MAPPZ_SIZE/2,d7
(1)  278/  FF1990 :                     ; 		and.w	#-MAPPZ_SIZE,d7
(1)  279/  FF1990 :                     ; 		beq.s	.x_upd
(1)  280/  FF1990 :                     ; 		moveq	#1,d0
(1)  281/  FF1990 :                     ; 		tst.w	d7
(1)  282/  FF1990 :                     ; 		bpl.s	.x_up
(1)  283/  FF1990 :                     ; 		neg.w	d0
(1)  284/  FF1990 :                     ; .x_up:
(1)  285/  FF1990 :                     ; 		add.w	d0,field_x(a5)
(1)  286/  FF1990 :                     ;
(1)  287/  FF1990 :                     ;
(1)  288/  FF1990 :                     ; .x_upd:
(1)  289/  FF1990 :                     
(1)  290/  FF1990 : 2038 9016           		move.l	(RAM_Cam_Xpos).w,d0
(1)  291/  FF1994 : 2238 901E           		move.l	(RAM_Cam_Zpos).w,d1
(1)  292/  FF1998 : C0BC 0000 0FFF      		and.l	#MAPPZ_SIZE-1,d0
(1)  293/  FF199E : C2BC 0000 0FFF      		and.l	#MAPPZ_SIZE-1,d1
(1)  294/  FF19A4 : 2C80                		move.l	d0,cam_x_pos(a6)
(1)  295/  FF19A6 : 2D41 0008           		move.l	d1,cam_z_pos(a6)
(1)  296/  FF19AA :                     
(1)  297/  FF19AA : 2038 901A           		move.l	(RAM_Cam_Ypos).w,d0
(1)  298/  FF19AE : 2D40 0004           		move.l	d0,cam_y_pos(a6)
(1)  299/  FF19B2 :                     
(1)  300/  FF19B2 :                     ; 		rts
(1)  301/  FF19B2 :                     
(1)  302/  FF19B2 :                     ; a6 - camera
(1)  303/  FF19B2 :                     ; a5 - field buffer
(1)  304/  FF19B2 :                     MdlMap_Build:
(1)  305/  FF19B2 :                     ;  rts
(1)  306/  FF19B2 : 49F8 ADF8           		lea	(RAM_MdDreq+Dreq_Objects),a4
(1)  307/  FF19B6 : 2655                		move.l	field_data(a5),a3
(1)  308/  FF19B8 : 225B                		move.l	(a3)+,a1
(1)  309/  FF19BA :                     
(1)  310/  FF19BA : 2238 901E           		move.l	(RAM_Cam_Zpos),d1
(1)  311/  FF19BE : 2038 9016           		move.l	(RAM_Cam_Xpos),d0
(1)  312/  FF19C2 : E088                		lsr.l	#8,d0
(1)  313/  FF19C4 : E089                		lsr.l	#8,d1
(1)  314/  FF19C6 : E888                		lsr.l	#4,d0
(1)  315/  FF19C8 : E889                		lsr.l	#4,d1
(1)  316/  FF19CA :                     ; 		neg.w	d0
(1)  317/  FF19CA : 4441                		neg.w	d1
(1)  318/  FF19CC : D07C 000D           		add.w	#$0D,d0
(1)  319/  FF19D0 : D27C 000E           		add.w	#$0D+1,d1
(1)  320/  FF19D4 :                     ; 		move.w	field_z(a5),d1
(1)  321/  FF19D4 :                     ; 		move.w	field_x(a5),d0
(1)  322/  FF19D4 : ED49                		lsl.w	#6,d1
(1)  323/  FF19D6 : D040                		add.w	d0,d0
(1)  324/  FF19D8 : D6C1                		adda	d1,a3
(1)  325/  FF19DA : D6C0                		adda	d0,a3
(1)  326/  FF19DC :                     
(1)  327/  FF19DC : 202E 000C           		move.l	cam_x_rot(a6),d0
(1)  328/  FF19E0 : E048                		lsr.w	#8,d0
(1)  329/  FF19E2 : E448                		lsr.w	#2,d0
(1)  330/  FF19E4 : C07C 0006           		and.w	#%110,d0
(1)  331/  FF19E8 : 303B 0006           		move.w	.views(pc,d0.w),d0
(1)  332/  FF19EC : 4EFB 0002           		jmp	.views(pc,d0.w)
(1)  333/  FF19F0 :                     .views:
(1)  334/  FF19F0 : 0008                		dc.w .front_r-.views
(1)  335/  FF19F2 : 0008                		dc.w .front_r-.views
(1)  336/  FF19F4 : 0008                		dc.w .front_r-.views
(1)  337/  FF19F6 : 0008                		dc.w .front_r-.views
(1)  338/  FF19F8 :                     
(1)  339/  FF19F8 :                     ; X X X
(1)  340/  FF19F8 :                     ; X X X
(1)  341/  FF19F8 :                     ; X X X
(1)  342/  FF19F8 :                     ; - - -
(1)  343/  FF19F8 :                     ; - - -
(1)  344/  FF19F8 :                     .front_r:
(1)  345/  FF19F8 : 363C F000           		move.w	#-(MAPPZ_SIZE),d3
(1)  346/  FF19FC : 323C F000           		move.w	#-MAPPZ_SIZE,d1
(1)  347/  FF1A00 : 6112                		bsr.s	.do_clmn
(1)  348/  FF1A02 : D6FC 0002           		adda	#2,a3
(1)  349/  FF1A06 : D27C 1000           		add.w	#MAPPZ_SIZE,d1
(1)  350/  FF1A0A : 6108                		bsr.s	.do_clmn
(1)  351/  FF1A0C : D6FC 0002           		adda	#2,a3
(1)  352/  FF1A10 : D27C 1000           		add.w	#MAPPZ_SIZE,d1
(1)  353/  FF1A14 :                     ; 		bsr.s	.do_clmn
(1)  354/  FF1A14 :                     
(1)  355/  FF1A14 :                     ; 		rts
(1)  356/  FF1A14 :                     .do_clmn:
(1)  357/  FF1A14 : 244B                		move.l	a3,a2
(1)  358/  FF1A16 : 3403                		move.w	d3,d2
(1)  359/  FF1A18 : 6108                		bsr	.mk_pz
(1)  360/  FF1A1A : D47C 1000           		add.w	#MAPPZ_SIZE,d2
(1)  361/  FF1A1E : D4FC 0040           		adda	#$40,a2
(1)  362/  FF1A22 :                     ; 		bsr	.mk_pz
(1)  363/  FF1A22 :                     ; 		add.w	#MAPPZ_SIZE,d2
(1)  364/  FF1A22 :                     ; 		adda	#$40,a2
(1)  365/  FF1A22 :                     ; 		bra	.mk_pz
(1)  366/  FF1A22 :                     
(1)  367/  FF1A22 :                     ; d1 - X pos
(1)  368/  FF1A22 :                     ; d2 - Z pos
(1)  369/  FF1A22 :                     ; (a2) - Piece id
(1)  370/  FF1A22 :                     .mk_pz:
(1)  371/  FF1A22 : 3012                		move.w	(a2),d0
(1)  372/  FF1A24 : E548                		lsl.w	#2,d0
(1)  373/  FF1A26 : 28B1 0000           		move.l	(a1,d0.w),mdl_data(a4)
(1)  374/  FF1A2A : 3941 0008           		move.w	d1,mdl_x_pos(a4)
(1)  375/  FF1A2E : 3942 000C           		move.w	d2,mdl_z_pos(a4)
(1)  376/  FF1A32 : D8FC 0018           		adda	#sizeof_mdlobj,a4
(1)  377/  FF1A36 : 4E75                		rts
(1)  378/  FF1A38 :                     
(1)  379/  FF1A38 :                     ; 		move.w	#-MAPPZ_SIZE,d1
(1)  380/  FF1A38 :                     ; 		move.l	a3,a2
(1)  381/  FF1A38 :                     ; ; 		adda	#2,a2
(1)  382/  FF1A38 :                     ; 		bsr	.mk_pz
(1)  383/  FF1A38 :                     ; 		adda	#2,a2
(1)  384/  FF1A38 :                     ; 		add.w	#MAPPZ_SIZE,d1
(1)  385/  FF1A38 :                     ; 		bsr	.mk_pz
(1)  386/  FF1A38 :                     ; 		adda	#2,a2
(1)  387/  FF1A38 :                     ; 		add.w	#MAPPZ_SIZE,d1
(1)  388/  FF1A38 :                     ; 		bsr	.mk_pz
(1)  389/  FF1A38 :                     ;
(1)  390/  FF1A38 :                     ; 		adda	#$40,a3
(1)  391/  FF1A38 :                     ; 		add.w	#MAPPZ_SIZE,d2
(1)  392/  FF1A38 :                     ; 		dbf	d3,.next_m
(1)  393/  FF1A38 :                     ; 		rts
(1)  394/  FF1A38 :                     
(1)  395/  FF1A38 :                     ; ; - - -
(1)  396/  FF1A38 :                     ; ; - X X
(1)  397/  FF1A38 :                     ; ; - X X
(1)  398/  FF1A38 :                     ; .front_d:
(1)  399/  FF1A38 :                     ; 		move.w	#0,d2
(1)  400/  FF1A38 :                     ; 		adda	#$40,a3
(1)  401/  FF1A38 :                     ; 		moveq	#2-1,d3
(1)  402/  FF1A38 :                     ; .next_dm:
(1)  403/  FF1A38 :                     ; 		move.w	#0,d1
(1)  404/  FF1A38 :                     ; 		move.l	a3,a2
(1)  405/  FF1A38 :                     ; 		adda	#2,a2
(1)  406/  FF1A38 :                     ; 		bsr	.mk_pz
(1)  407/  FF1A38 :                     ; 		adda	#2,a2
(1)  408/  FF1A38 :                     ; 		add.w	#MAPPZ_SIZE,d1
(1)  409/  FF1A38 :                     ; 		bsr	.mk_pz
(1)  410/  FF1A38 :                     ; 		adda	#$40,a3
(1)  411/  FF1A38 :                     ;
(1)  412/  FF1A38 :                     ; 		add.w	#MAPPZ_SIZE,d2
(1)  413/  FF1A38 :                     ; 		dbf	d3,.next_dm
(1)  414/  FF1A38 :                     ; 		rts
(1)  415/  FF1A38 :                     
(1)  416/  FF1A38 :                     ; 		move.l	a2,a3
(1)  417/  FF1A38 :                     ; 		adda	#$40+$02,a3
(1)  418/  FF1A38 :                     ; 		moveq	#0,d1
(1)  419/  FF1A38 :                     ; 		move.w	#-(MAPPZ_SIZE),d2
(1)  420/  FF1A38 :                     ; 		bsr	.mk_pz
(1)  421/  FF1A38 :                     ; 		adda	#2,a3
(1)  422/  FF1A38 :                     ; 		add.w	#MAPPZ_SIZE,d1
(1)  423/  FF1A38 :                     ; 		bsr	.mk_pz
(1)  424/  FF1A38 :                     ; 		move.l	a2,a3
(1)  425/  FF1A38 :                     ; 		adda	#$40+$02,a3
(1)  426/  FF1A38 :                     ; 		moveq	#0,d1
(1)  427/  FF1A38 :                     ; 		move.w	#-(MAPPZ_SIZE),d2
(1)  428/  FF1A38 :                     ; 		bsr	.mk_pz
(1)  429/  FF1A38 :                     ; 		adda	#2,a3
(1)  430/  FF1A38 :                     ; 		add.w	#MAPPZ_SIZE,d1
(1)  431/  FF1A38 :                     ; 		bsr	.mk_pz
(1)  432/  FF1A38 :                     
(1)  433/  FF1A38 :                     ; ------------------------------------------------------
(1)  434/  FF1A38 :                     ; Camera
(1)  435/  FF1A38 :                     ; ------------------------------------------------------
(1)  436/  FF1A38 :                     
(1)  437/  FF1A38 :                     MdMdl_SetNewCamera:
(1)  438/  FF1A38 :                     ; 		clr.l	(RAM_Cam_Xpos).l
(1)  439/  FF1A38 :                     ; 		clr.l	(RAM_Cam_Ypos).l
(1)  440/  FF1A38 :                     ; 		clr.l	(RAM_Cam_Zpos).l
(1)  441/  FF1A38 :                     ; 		clr.l	(RAM_Cam_Xrot).l
(1)  442/  FF1A38 :                     ; 		clr.l	(RAM_Cam_Yrot).l
(1)  443/  FF1A38 :                     ; 		clr.l	(RAM_Cam_Zrot).l
(1)  444/  FF1A38 : 7800                		moveq	#0,d4
(1)  445/  FF1A3A : 23C4 FFFF 900A      		move.l	d4,(RAM_CamFrame).l
(1)  446/  FF1A40 : 23C4 FFFF 900E      		move.l	d4,(RAM_CamTimer).l
(1)  447/  FF1A46 : 23C1 FFFF 9012      		move.l	d1,(RAM_CamSpeed).l
(1)  448/  FF1A4C : 23C0 FFFF 9006      		move.l	d0,(RAM_CamData).l
(1)  449/  FF1A52 : 4E75                		rts
(1)  450/  FF1A54 :                     
(1)  451/  FF1A54 :                     MdMdl_CamAnimate:
(1)  452/  FF1A54 : 4DF8 ADE0           		lea	(RAM_MdDreq+Dreq_ObjCam),a6
(1)  453/  FF1A58 : 2039 FFFF 9006      		move.l	(RAM_CamData).l,d0			; If 0 == No animation
(1)  454/  FF1A5E : 6762                		beq.s	.no_camanim
(1)  455/  FF1A60 : 04B9 0000 0001 FFFF 		sub.l	#1,(RAM_CamTimer).l
                    900E                
(1)  456/  FF1A6A : 6A56                		bpl.s	.no_camanim
(1)  457/  FF1A6C : 23F9 FFFF 9012 FFFF 		move.l	(RAM_CamSpeed).l,(RAM_CamTimer).l	; TEMPORAL timer
                    900E                
(1)  458/  FF1A76 : 2240                		move.l	d0,a1
(1)  459/  FF1A78 : 2219                		move.l	(a1)+,d1
(1)  460/  FF1A7A : 2039 FFFF 900A      		move.l	(RAM_CamFrame).l,d0
(1)  461/  FF1A80 : D0BC 0000 0001      		add.l	#1,d0
(1)  462/  FF1A86 : B081                		cmp.l	d1,d0
(1)  463/  FF1A88 : 6604                		bne.s	.on_frames
(1)  464/  FF1A8A : 70FF                		moveq	#-1,d0
(1)  465/  FF1A8C : 4E75                		rts
(1)  466/  FF1A8E :                     .on_frames:
(1)  467/  FF1A8E : 23C0 FFFF 900A      		move.l	d0,(RAM_CamFrame).l
(1)  468/  FF1A94 : C0FC 0018           		mulu.w	#$18,d0
(1)  469/  FF1A98 : D2C0                		adda	d0,a1
(1)  470/  FF1A9A : 23D9 FFFF 9016      		move.l	(a1)+,(RAM_Cam_Xpos).l
(1)  471/  FF1AA0 : 23D9 FFFF 901A      		move.l	(a1)+,(RAM_Cam_Ypos).l
(1)  472/  FF1AA6 : 23D9 FFFF 901E      		move.l	(a1)+,(RAM_Cam_Zpos).l
(1)  473/  FF1AAC : 2D59 000C           		move.l	(a1)+,cam_x_rot(a6)
(1)  474/  FF1AB0 : 2D59 0010           		move.l	(a1)+,cam_y_rot(a6)
(1)  475/  FF1AB4 : 2D59 0014           		move.l	(a1)+,cam_z_rot(a6)
(1)  476/  FF1AB8 : EE89                		lsr.l	#7,d1
(1)  477/  FF1ABA : 4441                		neg.w	d1
(1)  478/  FF1ABC : 33C1 FFFF 9004      		move.w	d1,(RAM_HorCopy).l
(1)  479/  FF1AC2 :                     .no_camanim:
(1)  480/  FF1AC2 : 7000                		moveq	#0,d0
(1)  481/  FF1AC4 : 4E75                		rts
(1)  482/  FF1AC6 :                     
(1)  483/  FF1AC6 :                     ; ====================================================================
(1)  484/  FF1AC6 :                     ; ------------------------------------------------------
(1)  485/  FF1AC6 :                     ; VBlank
(1)  486/  FF1AC6 :                     ; ------------------------------------------------------
(1)  487/  FF1AC6 :                     
(1)  488/  FF1AC6 :                     ; ------------------------------------------------------
(1)  489/  FF1AC6 :                     ; HBlank
(1)  490/  FF1AC6 :                     ; ------------------------------------------------------
(1)  491/  FF1AC6 :                     
(1)  492/  FF1AC6 :                     ; ====================================================================
(1)  493/  FF1AC6 :                     ; ------------------------------------------------------
(1)  494/  FF1AC6 :                     ; DATA
(1)  495/  FF1AC6 :                     ;
(1)  496/  FF1AC6 :                     ; Small stuff goes here
(1)  497/  FF1AC6 :                     ; ------------------------------------------------------
(1)  498/  FF1AC6 :                     
(1)  499/  FF1AC6 :                     ; Pal_Emily:
(1)  500/  FF1AC6 :                     ; 		dc.w 0
(1)  501/  FF1AC6 :                     ; 		binclude "data/md/sprites/emi_pal.bin",2
(1)  502/  FF1AC6 :                     ; 		align 2
(1)  503/  FF1AC6 :                     ; Map_Nicole:
(1)  504/  FF1AC6 :                     ; 		include "data/md/sprites/emi_map.asm"
(1)  505/  FF1AC6 :                     ; 		align 2
(1)  506/  FF1AC6 :                     ; Dplc_Nicole:
(1)  507/  FF1AC6 :                     ; 		include "data/md/sprites/emi_plc.asm"
(1)  508/  FF1AC6 :                     ; 		align 2
(1)  509/  FF1AC6 :                     
(1)  510/  FF1AC6 :                     str_Stats2:
(1)  511/  FF1AC6 :                     ; 		dc.b "\\w \\w \\w \\w",$A
(1)  512/  FF1AC6 :                     ; 		dc.b "\\w \\w \\w \\w",$A,$A
(1)  513/  FF1AC6 :                     ; 		dc.b "\\l",0
(1)  514/  FF1AC6 :                     ; 		dc.l sysmars_reg+comm0
(1)  515/  FF1AC6 :                     ; 		dc.l sysmars_reg+comm2
(1)  516/  FF1AC6 :                     ; 		dc.l sysmars_reg+comm4
(1)  517/  FF1AC6 :                     ; 		dc.l sysmars_reg+comm6
(1)  518/  FF1AC6 :                     ; 		dc.l sysmars_reg+comm8
(1)  519/  FF1AC6 :                     ; 		dc.l sysmars_reg+comm10
(1)  520/  FF1AC6 :                     ; 		dc.l sysmars_reg+comm12
(1)  521/  FF1AC6 :                     ; 		dc.l sysmars_reg+comm14
(1)  522/  FF1AC6 :                     ; 		dc.l RAM_Framecount
(1)  523/  FF1AC6 :                     ; 		align 2
(1)  524/  FF1AC6 :                     
(1)  525/  FF1AC6 :                     ; str_Stats2:
(1)  526/  FF1AC6 : 5C6C 0A             		dc.b "\\l",$A
(1)  527/  FF1AC9 : 5C6C 0A             		dc.b "\\l",$A
(1)  528/  FF1ACC : 5C6C 205C 7700      		dc.b "\\l \\w",0
(1)  529/  FF1AD2 : FFFF ADEC           		dc.l RAM_MdDreq+Dreq_ObjCam+cam_x_rot
(1)  530/  FF1AD6 : FFFF ADF0           		dc.l RAM_MdDreq+Dreq_ObjCam+cam_y_rot
(1)  531/  FF1ADA : FFFF ADF4           		dc.l RAM_MdDreq+Dreq_ObjCam+cam_z_rot
(1)  532/  FF1ADE : 00A1 5120           		dc.l sysmars_reg+comm0
(1)  533/  FF1AE2 :                     		align 2
(1)  534/  FF1AE2 :                     
(1)  535/  FF1AE2 :                     		align 4
(1)  536/  FF1AE4 :                     MarsMap_00:
(1)  537/  FF1AE4 :                     		include "data/maps/mars/mcity/map_data.asm"
(2)    1/  FF1AE4 : 00FF 22E8           		dc.l .blocks
(2)    2/  FF1AE8 :                     		binclude "data/maps/mars/mcity/map_lay.bin"
(2)    3/  FF22E8 :                     		align 4
(2)    4/  FF22E8 :                     .blocks:
(2)    5/  FF22E8 : 0000 0000           		dc.l 0
(2)    6/  FF22EC : 2216 E67C           		dc.l MarsMapPz_01_main|TH
(2)    7/  FF22F0 : 2217 0610           		dc.l MarsMapPz_02_refsep_n|TH
(2)    8/  FF22F4 : 2217 7D3C           		dc.l MarsMapPz_03_kfc|TH
(2)    9/  FF22F8 : 2217 9118           		dc.l MarsMapPz_04_sept_r|TH
(2)   10/  FF22FC : 2217 97E0           		dc.l MarsMapPz_05_carls_n|TH
(2)   11/  FF2300 : 2217 A2BC           		dc.l MarsMapPz_06_carls_s|TH
(2)   12/  FF2304 : 2217 BED8           		dc.l MarsMapPz_07_carls_hut|TH
(2)   13/  FF2308 : 2217 C484           		dc.l MarsMapPz_08_sept_r|TH
(2)   14/  FF230C : 2217 CB0C           		dc.l MarsMapPz_09_phut_n|TH
(2)   15/  FF2310 : 2217 DFFC           		dc.l MarsMapPz_0A_phut_s|TH
(2)   16/  FF2314 :                     
(1)  538/  FF2314 : 0000 0000           		dc.l 0
(1)  539/  FF2318 : 0000 0000           		dc.l 0
(1)  540/  FF231C : 0000 0000           		dc.l 0
(1)  541/  FF2320 : 0000 0000           		dc.l 0
(1)  542/  FF2324 : 0000 0000           		dc.l 0
(1)  543/  FF2328 : 0000 0000           		dc.l 0
(1)  544/  FF232C : 0000 0000           		dc.l 0
(1)  545/  FF2330 : 0000 0000           		dc.l 0
(1)  546/  FF2334 : 0000 0000           		dc.l 0
(1)  547/  FF2338 : 0000 0000           		dc.l 0
(1)  548/  FF233C : 0000 0000           		dc.l 0
(1)  549/  FF2340 : 0000 0000           		dc.l 0
(1)  550/  FF2344 : 0000 0000           		dc.l 0
(1)  551/  FF2348 : 0000 0000           		dc.l 0
(1)  552/  FF234C : 0000 0000           		dc.l 0
(1)  553/  FF2350 : 0000 0000           		dc.l 0
(1)  554/  FF2354 : 0000 0000           		dc.l 0
(1)  555/  FF2358 : 0000 0000           		dc.l 0
(1)  556/  FF235C : 0000 0000           		dc.l 0
(1)  557/  FF2360 : 0000 0000           		dc.l 0
(1)  558/  FF2364 : 0000 0000           		dc.l 0
(1)  559/  FF2368 : 0000 0000           		dc.l 0
(1)  560/  FF236C : 0000 0000           		dc.l 0
(1)  561/  FF2370 : 0000 0000           		dc.l 0
(1)  562/  FF2374 : 0000 0000           		dc.l 0
(1)  563/  FF2378 : 0000 0000           		dc.l 0
(1)  564/  FF237C : 0000 0000           		dc.l 0
(1)  565/  FF2380 : 0000 0000           		dc.l 0
(1)  566/  FF2384 : 0000 0000           		dc.l 0
(1)  567/  FF2388 : 0000 0000           		dc.l 0
(1)  568/  FF238C : 0000 0000           		dc.l 0
(1)  569/  FF2390 : 0000 0000           		dc.l 0
(1)  570/  FF2394 : 0000 0000           		dc.l 0
(1)  571/  FF2398 : 0000 0000           		dc.l 0
(1)  572/  FF239C : 0000 0000           		dc.l 0
(1)  573/  FF23A0 : 0000 0000           		dc.l 0
(1)  574/  FF23A4 : 0000 0000           		dc.l 0
(1)  575/  FF23A8 : 0000 0000           		dc.l 0
(1)  576/  FF23AC : 0000 0000           		dc.l 0
(1)  577/  FF23B0 : 0000 0000           		dc.l 0
(1)  578/  FF23B4 : 0000 0000           		dc.l 0
(1)  579/  FF23B8 : 0000 0000           		dc.l 0
(1)  580/  FF23BC : 0000 0000           		dc.l 0
(1)  581/  FF23C0 : 0000 0000           		dc.l 0
(1)  582/  FF23C4 : 0000 0000           		dc.l 0
(1)  583/  FF23C8 : 0000 0000           		dc.l 0
(1)  584/  FF23CC : 0000 0000           		dc.l 0
(1)  585/  FF23D0 : 0000 0000           		dc.l 0
(1)  586/  FF23D4 : 0000 0000           		dc.l 0
(1)  587/  FF23D8 : 0000 0000           		dc.l 0
(1)  588/  FF23DC : 0000 0000           		dc.l 0
(1)  589/  FF23E0 : 0000 0000           		dc.l 0
(1)  590/  FF23E4 : 0000 0000           		dc.l 0
(1)  591/  FF23E8 : 0000 0000           		dc.l 0
(1)  592/  FF23EC : 0000 0000           		dc.l 0
(1)  593/  FF23F0 : 0000 0000           		dc.l 0
(1)  594/  FF23F4 : 0000 0000           		dc.l 0
(1)  595/  FF23F8 : 0000 0000           		dc.l 0
(1)  596/  FF23FC : 0000 0000           		dc.l 0
(1)  597/  FF2400 : 0000 0000           		dc.l 0
(1)  598/  FF2404 : 0000 0000           		dc.l 0
(1)  599/  FF2408 :                     		align 2
(1)  600/  FF2408 :                     
(1)  601/  FF2408 :                     MapCamera_0:
(1)  602/  FF2408 :                     		binclude "data/maps/mars/mcity/anim/mcity_anim.bin"
(1)  603/  FF6F0C :                     		align 4
(1)  604/  FF6F0C :                     
(1)  605/  FF6F0C :                     ; ====================================================================
(1)  606/  FF6F0C :                     
(1)  607/  FF6F0C :                     .here:
(1)  611/    7BD8 :                     		dephase
(1)  612/    7BD8 :                     
      72/    7BD8 :                     RamCode_Debug:
      73/    7BD8 :                     		include "code/debug.asm"
(1)    1/    7BD8 :                     ; ====================================================================
(1)    2/    7BD8 :                     ; ----------------------------------------------------------------
(1)    3/    7BD8 :                     ; 2D Part
(1)    4/    7BD8 :                     ; ----------------------------------------------------------------
(1)    5/    7BD8 :                     
(1)    6/  FF170C :                     		phase RAMCODE_USER
(1)    7/  FF170C :                     ; ====================================================================
(1)    8/  FF170C :                     ; ------------------------------------------------------
(1)    9/  FF170C :                     ; Settings
(1)   10/  FF170C :                     ; ------------------------------------------------------
(1)   11/  FF170C :                     
(1)   12/  FF170C : =$20000             TEST_SPEED	equ	$02<<16
(1)   13/  FF170C : =$2                 TEST_SPRSPD	equ	$02
(1)   14/  FF170C :                     
(1)   15/  FF170C :                     ; ====================================================================
(1)   16/  FF170C :                     ; ------------------------------------------------------
(1)   17/  FF170C :                     ; Variables
(1)   18/  FF170C :                     ; ------------------------------------------------------
(1)   19/  FF170C :                     
(1)   20/  FF170C : =$0                 set_StartPage	equ	0
(1)   21/  FF170C : =$4                 MAX_PAGE0_EN	equ	4
(1)   22/  FF170C : =$4                 MAX_GEMAENTRY	equ	4
(1)   23/  FF170C : =$8                 SCN0_TIMER	equ	8
(1)   24/  FF170C :                     
(1)   25/  FF170C :                     ; ====================================================================
(1)   26/  FF170C :                     ; ------------------------------------------------------
(1)   27/  FF170C :                     ; Structs
(1)   28/  FF170C :                     ; ------------------------------------------------------
(1)   29/  FF170C :                     
(1)   30/  FF170C :                     ; 		struct 0
(1)   31/  FF170C :                     ; strc_xpos	ds.w 1
(1)   32/  FF170C :                     ; strc_ypos	ds.w 1
(1)   33/  FF170C :                     ; 		finish
(1)   34/  FF170C :                     
(1)   35/  FF170C :                     ; ====================================================================
(1)   36/  FF170C :                     ; ------------------------------------------------------
(1)   37/  FF170C :                     ; This mode's RAM
(1)   38/  FF170C :                     ; ------------------------------------------------------
(1)   39/  FF170C :                     
(1)   40/  FF170C : (MACRO)             		struct RAM_ModeBuff
(1)   40/  FF170C : =$FF170C            GLBL_LASTPC     set *
(1)   40/    7BD8 :                                     dephase
(1)   40/    7BD8 : =$7BD8              GLBL_LASTORG    set *
(1)   40/FFFFFFFFFFFF9000 :                                     phase RAM_MODEBUFF
(1)   41/FFFFFFFFFFFF9000 :                     RAM_CurrPage	ds.w 1
(1)   42/FFFFFFFFFFFF9002 :                     RAM_CurrGfx	ds.w 1
(1)   43/FFFFFFFFFFFF9004 :                     RAM_CurrSelc	ds.w 1
(1)   44/FFFFFFFFFFFF9006 :                     RAM_CurrIndx	ds.w 1
(1)   45/FFFFFFFFFFFF9008 :                     RAM_CurrTrack	ds.w 1
(1)   46/FFFFFFFFFFFF900A :                     RAM_CurrTicks	ds.w 1
(1)   47/FFFFFFFFFFFF900C :                     RAM_CurrTempo	ds.w 1
(1)   48/FFFFFFFFFFFF900E :                     RAM_Scrn0_Frame	ds.w 1
(1)   49/FFFFFFFFFFFF9010 :                     RAM_Scrn0_Timer	ds.w 1
(1)   50/FFFFFFFFFFFF9012 :                     RAM_GemaUpd	ds.w 1
(1)   51/FFFFFFFFFFFF9014 :                     RAM_GemaList	ds.w 4
(1)   52/FFFFFFFFFFFF901C :                     RAM_GemaListFM	ds.w 6
(1)   53/FFFFFFFFFFFF9028 :                     RAM_GemaListPWM	ds.w 7
(1)   54/FFFFFFFFFFFF9036 :                     RAM_SprTimer	ds.w 1
(1)   55/FFFFFFFFFFFF9038 :                     RAM_SprFrame	ds.w 1
(1)   56/FFFFFFFFFFFF903A : (MACRO)             		finish
(1)   56/FFFFFFFFFFFF9000 :                                     !org GLBL_LASTORG
(1)   56/  FF170C :                                     phase GLBL_LASTPC
(1)   57/  FF170C :                     
(1)   58/  FF170C :                     ; ====================================================================
(1)   59/  FF170C :                     ; ------------------------------------------------------
(1)   60/  FF170C :                     ; Code start
(1)   61/  FF170C :                     ; ------------------------------------------------------
(1)   62/  FF170C :                     
(1)   63/  FF170C :                     MD_DebugMenu:
(1)   64/  FF170C : 46FC 2700           		move.w	#$2700,sr
(1)   65/  FF1710 : 08B9 0006 FFFF A6EB 		bclr	#bitDispEnbl,(RAM_VdpRegs+1).l
(1)   66/  FF1718 : 6100 EB82           		bsr	Video_Update
(1)   67/  FF171C : 6100 FF4C           		bsr	Mode_Init
(1)   68/  FF1720 : 6100 ECBE           		bsr	Video_PrintInit
(1)   69/  FF1724 : 7000                		moveq	#0,d0
(1)   70/  FF1726 : 6100 EADC           		bsr	Sound_TrkStop
(1)   71/  FF172A : 7001                		moveq	#1,d0
(1)   72/  FF172C : 6100 EAD6           		bsr	Sound_TrkStop
(1)   73/  FF1730 : 4278 A1F4           		clr.w	(RAM_PaletteFd).w
(1)   74/  FF1734 : 31FC 0000 9000      		move.w	#set_StartPage,(RAM_CurrPage).w
(1)   75/  FF173A : 08F9 0006 FFFF A6EB 		bset	#bitDispEnbl,(RAM_VdpRegs+1).l
(1)   76/  FF1742 : 13FC 0000 FFFF A6F5 		move.b	#%000,(RAM_VdpRegs+$B).l
(1)   77/  FF174A : 13FC 0000 FFFF A6F1 		move.b	#0,(RAM_VdpRegs+7).l
(1)   78/  FF1752 : 6100 EB48           		bsr	Video_Update
(1)   79/  FF1756 :                     
(1)   80/  FF1756 :                     
(1)   81/  FF1756 :                     ; ====================================================================
(1)   82/  FF1756 :                     ; ------------------------------------------------------
(1)   83/  FF1756 :                     ; Loop
(1)   84/  FF1756 :                     ; ------------------------------------------------------
(1)   85/  FF1756 :                     
(1)   86/  FF1756 :                     .loop:
(1)   87/  FF1756 : 6100 FAC6           		bsr	System_WaitFrame
(1)   88/  FF175A : 6100 EE84           		bsr	Video_RunFade
(1)   89/  FF175E : 66F6                		bne.s	.loop
(1)   90/  FF1760 : 3038 9000           		move.w	(RAM_CurrPage).w,d0
(1)   91/  FF1764 : C07C 001F           		and.w	#%11111,d0
(1)   92/  FF1768 : D040                		add.w	d0,d0
(1)   93/  FF176A : D040                		add.w	d0,d0
(1)   94/  FF176C : D040                		add.w	d0,d0
(1)   95/  FF176E : 4A78 9000           		tst.w	(RAM_CurrPage).w
(1)   96/  FF1772 : 6B06                		bmi.s	.on_loop
(1)   97/  FF1774 : D0BC 0000 0004      		add.l	#4,d0
(1)   98/  FF177A :                     .on_loop:
(1)   99/  FF177A : 4EBB 0004           		jsr	.list(pc,d0.w)
(1)  100/  FF177E : 60D6                		bra	.loop
(1)  101/  FF1780 :                     
(1)  102/  FF1780 :                     ; ====================================================================
(1)  103/  FF1780 :                     ; ------------------------------------------------------
(1)  104/  FF1780 :                     ; Mode sections
(1)  105/  FF1780 :                     ; ------------------------------------------------------
(1)  106/  FF1780 :                     
(1)  107/  FF1780 :                     .list:
(1)  108/  FF1780 : 6000 008E           		bra.w	.page0
(1)  109/  FF1784 : 6000 0034           		bra.w	.page0_init
(1)  110/  FF1788 :                     
(1)  111/  FF1788 : 6000 00F4           		bra.w	.page1
(1)  112/  FF178C : 6000 00B0           		bra.w	.page1_init
(1)  113/  FF1790 :                     
(1)  114/  FF1790 : 6000 0158           		bra.w	.page2
(1)  115/  FF1794 : 6000 0102           		bra.w	.page2_init
(1)  116/  FF1798 :                     
(1)  117/  FF1798 : 6000 01AE           		bra.w	.page3
(1)  118/  FF179C : 6000 0166           		bra.w	.page3_init
(1)  119/  FF17A0 :                     
(1)  120/  FF17A0 : 6000 0218           		bra.w	.page4
(1)  121/  FF17A4 : 6000 01CE           		bra.w	.page4_init
(1)  122/  FF17A8 :                     
(1)  123/  FF17A8 : 6000 02A4           		bra.w	.page5
(1)  124/  FF17AC : 6000 0262           		bra.w	.page5_init
(1)  125/  FF17B0 :                     
(1)  126/  FF17B0 : 6000 005E           		bra.w	.page0
(1)  127/  FF17B4 : 6000 0004           		bra.w	.page0_init
(1)  128/  FF17B8 :                     
(1)  129/  FF17B8 :                     ; ====================================================================
(1)  130/  FF17B8 :                     ; --------------------------------------------------
(1)  131/  FF17B8 :                     ; Page 0
(1)  132/  FF17B8 :                     ; --------------------------------------------------
(1)  133/  FF17B8 :                     
(1)  134/  FF17B8 :                     .page0_ret:
(1)  135/  FF17B8 : 4E75                		rts
(1)  136/  FF17BA :                     .page0_init:
(1)  137/  FF17BA : 08B9 0006 FFFF A6EB 		bclr	#bitDispEnbl,(RAM_VdpRegs+1).l
(1)  138/  FF17C2 : 6100 EAD8           		bsr	Video_Update
(1)  139/  FF17C6 :                     
(1)  140/  FF17C6 : 6100 EB28           		bsr	Video_ClearScreen
(1)  141/  FF17CA : 6100 EC2E           		bsr	Video_PrintPal
(1)  142/  FF17CE : 0078 8000 9000      		or.w	#$8000,(RAM_CurrPage).w
(1)  143/  FF17D4 : 4278 9004           		clr.w	(RAM_CurrSelc).w
(1)  144/  FF17D8 : 303C 0000           		move.w	#0,d0
(1)  145/  FF17DC : 6100 F21C           		bsr	Video_Mars_GfxMode
(1)  146/  FF17E0 : 41FA 070A           		lea	str_Title(pc),a0	; Print menu
(1)  147/  FF17E4 : 203C 0000 0202      		move.l	#locate(0,2,2),d0
(1)  148/  FF17EA : 6100 EC20           		bsr	Video_Print
(1)  149/  FF17EE : 6132                		bsr	.page0_cursor
(1)  150/  FF17F0 : 6100 049E           		bsr	.fade_in
(1)  151/  FF17F4 :                     
(1)  152/  FF17F4 : 13FC 0081 FFFF A6F6 		move.b	#$81,(RAM_VdpRegs+$C).l
(1)  153/  FF17FC : 13FC 0000 FFFF A6F1 		move.b	#0,(RAM_VdpRegs+7).l
(1)  154/  FF1804 : 08F9 0006 FFFF A6EB 		bset	#bitDispEnbl,(RAM_VdpRegs+1).l
(1)  155/  FF180C : 6100 EA8E           		bsr	Video_Update
(1)  156/  FF1810 :                     .page0:
(1)  157/  FF1810 :                     ; 		lea	str_Stats(pc),a0
(1)  158/  FF1810 :                     ; 		move.l	#locate(0,2,10),d0
(1)  159/  FF1810 :                     ; 		bsr	Video_Print
(1)  160/  FF1810 :                     
(1)  161/  FF1810 : 3E38 A706           		move.w	(Controller_1+on_press),d7
(1)  162/  FF1814 : 0807 0007           		btst	#bitJoyStart,d7
(1)  163/  FF1818 : 6612                		bne.s	.page0_jump
(1)  164/  FF181A : 7004                		moveq	#MAX_PAGE0_EN,d0			; Numof entries
(1)  165/  FF181C : 6100 04D0           		bsr	.move_cursor_ud		; Move U/D
(1)  166/  FF1820 : 6796                		beq	.page0_ret
(1)  167/  FF1822 :                     .page0_cursor:
(1)  168/  FF1822 : 223C 0000 0203      		move.l	#locate(0,2,3),d1
(1)  169/  FF1828 : 6000 04B2           		bra	.print_cursor
(1)  170/  FF182C :                     .page0_jump:
(1)  171/  FF182C : 6100 0488           		bsr	.fade_out
(1)  172/  FF1830 : 3038 9004           		move.w	(RAM_CurrSelc).w,d0
(1)  173/  FF1834 : D07C 0001           		add.w	#1,d0
(1)  174/  FF1838 : 31C0 9000           		move.w	d0,(RAM_CurrPage).w
(1)  175/  FF183C : 4E75                		rts
(1)  176/  FF183E :                     
(1)  177/  FF183E :                     ; ====================================================================
(1)  178/  FF183E :                     ; --------------------------------------------------
(1)  179/  FF183E :                     ; Page 1, Screen 00
(1)  180/  FF183E :                     ; --------------------------------------------------
(1)  181/  FF183E :                     
(1)  182/  FF183E :                     .page1_init:
(1)  183/  FF183E : 6100 EAB0           		bsr	Video_ClearScreen
(1)  184/  FF1842 : 6100 EBB6           		bsr	Video_PrintPal
(1)  185/  FF1846 : 0078 8000 9000      		or.w	#$8000,(RAM_CurrPage).w
(1)  186/  FF184C : 4278 9004           		clr.w	(RAM_CurrSelc).w
(1)  187/  FF1850 : 303C 0000           		move.w	#0,d0
(1)  188/  FF1854 : 6100 F1A4           		bsr	Video_Mars_GfxMode
(1)  189/  FF1858 : 41FA 0730           		lea	str_Page1(pc),a0
(1)  190/  FF185C : 203C 0000 0202      		move.l	#locate(0,2,2),d0
(1)  191/  FF1862 : 6100 EBA8           		bsr	Video_Print
(1)  192/  FF1866 : 13FC 0000 FFFF A6F6 		move.b	#0,(RAM_VdpRegs+$C).l
(1)  193/  FF186E : 6100 EA2C           		bsr	Video_Update
(1)  194/  FF1872 :                     
(1)  195/  FF1872 :                     ; 		lea	(PalData_Mars_Test2),a0
(1)  196/  FF1872 :                     ; 		moveq	#0,d0
(1)  197/  FF1872 :                     ; 		move.w	#256,d1
(1)  198/  FF1872 :                     ; 		moveq	#0,d2
(1)  199/  FF1872 :                     ; 		bsr	Video_FadePal_Mars
(1)  200/  FF1872 : 4278 A274           		clr.w	(RAM_MdMarsPalFd).w
(1)  201/  FF1876 : 4278 AB60           		clr.w	(RAM_MdDreq+Dreq_Palette).w
(1)  202/  FF187A : 6100 0414           		bsr	.fade_in
(1)  203/  FF187E :                     
(1)  204/  FF187E :                     
(1)  205/  FF187E :                     .page1:
(1)  206/  FF187E :                     
(1)  207/  FF187E : 6100 056C           		bsr	SuperSprite_Test
(1)  208/  FF1882 :                     	; Start-button exit
(1)  209/  FF1882 : 3E38 A706           		move.w	(Controller_1+on_press),d7
(1)  210/  FF1886 : 0807 0007           		btst	#bitJoyStart,d7
(1)  211/  FF188A : 670A                		beq.s	.page1_ret
(1)  212/  FF188C : 31FC 0000 9000      		move.w	#0,(RAM_CurrPage).w
(1)  213/  FF1892 : 6100 0422           		bsr	.fade_out
(1)  214/  FF1896 :                     .page1_ret:
(1)  215/  FF1896 : 4E75                		rts
(1)  216/  FF1898 :                     
(1)  217/  FF1898 :                     ; .page1_init:
(1)  218/  FF1898 :                     ; 		bsr	Video_ClearScreen
(1)  219/  FF1898 :                     ; 		bsr	Video_PrintPal
(1)  220/  FF1898 :                     ; 		or.w	#$8000,(RAM_CurrPage).w
(1)  221/  FF1898 :                     ; 		clr.w	(RAM_CurrSelc).w
(1)  222/  FF1898 :                     ; 		bsr.s	.make_frame
(1)  223/  FF1898 :                     ;
(1)  224/  FF1898 :                     ; 		lea	(RAM_MdDreq+Dreq_ScrnBuff),a1
(1)  225/  FF1898 :                     ; 		move.l	#2,Dreq_Scrn_Type(a1)
(1)  226/  FF1898 :                     ; 		bsr	System_MarsUpdate
(1)  227/  FF1898 :                     ;
(1)  228/  FF1898 :                     ; 		lea	str_Page1(pc),a0
(1)  229/  FF1898 :                     ; 		move.l	#locate(0,2,2),d0
(1)  230/  FF1898 :                     ; 		bsr	Video_Print
(1)  231/  FF1898 :                     ; 		move.w	#1,d0
(1)  232/  FF1898 :                     ; 		bsr	Video_Mars_GfxMode
(1)  233/  FF1898 :                     ; 		bsr	.fade_in
(1)  234/  FF1898 :                     ; .page1:
(1)  235/  FF1898 :                     ; 		sub.w	#1,(RAM_Scrn0_Timer).w
(1)  236/  FF1898 :                     ; 		bpl.s	.keep
(1)  237/  FF1898 :                     ; 		move.w	#SCN0_TIMER,(RAM_Scrn0_Timer).w
(1)  238/  FF1898 :                     ; 		bsr.s	.make_frame
(1)  239/  FF1898 :                     ; 		bsr	Video_Mars_WaitFrame
(1)  240/  FF1898 :                     ; 		add.w	#1,(RAM_Scrn0_Frame).w
(1)  241/  FF1898 :                     ; 		and.w	#%11,(RAM_Scrn0_Frame).w
(1)  242/  FF1898 :                     ; .keep:
(1)  243/  FF1898 :                     ; 		lea	str_Page1_info(pc),a0
(1)  244/  FF1898 :                     ; 		move.l	#locate(0,2,4),d0
(1)  245/  FF1898 :                     ; 		bsr	Video_Print
(1)  246/  FF1898 :                     ; 		move.w	(Controller_1+on_press),d7
(1)  247/  FF1898 :                     ; 		btst	#bitJoyStart,d7
(1)  248/  FF1898 :                     ; 		beq.s	.page1_ret
(1)  249/  FF1898 :                     ; 		move.w	#0,(RAM_CurrPage).w
(1)  250/  FF1898 :                     ; 		bsr	.fade_out
(1)  251/  FF1898 :                     ; .page1_ret:
(1)  252/  FF1898 :                     ; 		rts
(1)  253/  FF1898 :                     ;
(1)  254/  FF1898 :                     ; .make_frame:
(1)  255/  FF1898 :                     ; 		move.w	(RAM_Scrn0_Frame).w,d0
(1)  256/  FF1898 :                     ; 		lsl.w	#2,d0
(1)  257/  FF1898 :                     ; 		lea	.frames(pc),a0
(1)  258/  FF1898 :                     ; 		lea	(RAM_MdDreq+Dreq_ScrnBuff),a1
(1)  259/  FF1898 :                     ; 		move.l	(a0,d0.w),d0
(1)  260/  FF1898 :                     ; 		add.l	#TH,d0
(1)  261/  FF1898 :                     ; 		move.l	d0,Dreq_Scrn_Data(a1)
(1)  262/  FF1898 :                     ; 		rts
(1)  263/  FF1898 :                     ; .frames:
(1)  264/  FF1898 :                     ; 		dc.l TESTMARS_DIRECT_1
(1)  265/  FF1898 :                     ; 		dc.l TESTMARS_DIRECT_2
(1)  266/  FF1898 :                     ; 		dc.l TESTMARS_DIRECT_3
(1)  267/  FF1898 :                     ; 		dc.l TESTMARS_DIRECT_2
(1)  268/  FF1898 :                     
(1)  269/  FF1898 :                     ; ====================================================================
(1)  270/  FF1898 :                     ; --------------------------------------------------
(1)  271/  FF1898 :                     ; Page 2
(1)  272/  FF1898 :                     ; --------------------------------------------------
(1)  273/  FF1898 :                     
(1)  274/  FF1898 :                     .page2_init:
(1)  275/  FF1898 : 6100 EA56           		bsr	Video_ClearScreen
(1)  276/  FF189C : 6100 EB5C           		bsr	Video_PrintPal
(1)  277/  FF18A0 : 0078 8000 9000      		or.w	#$8000,(RAM_CurrPage).w
(1)  278/  FF18A6 : 4278 9004           		clr.w	(RAM_CurrSelc).w
(1)  279/  FF18AA :                     
(1)  280/  FF18AA :                     ; 		lea	(RAM_MdDreq+Dreq_ScrnBuff),a0
(1)  281/  FF18AA :                     ; 		move.l	#TESTMARS_BG2|TH,Dreq_SclData(a0)
(1)  282/  FF18AA :                     ; 		move.l	#$00000000,Dreq_SclX(a0)	; X pos
(1)  283/  FF18AA :                     ; 		move.l	#$00000000,Dreq_SclY(a0)	; Y pos
(1)  284/  FF18AA :                     ; 		move.l	#$00010000,Dreq_SclDX(a0)	; DX
(1)  285/  FF18AA :                     ; 		move.l	#$00010000,Dreq_SclDY(a0)	; DY
(1)  286/  FF18AA :                     ; 		move.l	#320,Dreq_SclWidth(a0)
(1)  287/  FF18AA :                     ; 		move.l	#224,Dreq_SclHeight(a0)
(1)  288/  FF18AA :                     ; 		move.l	#1,Dreq_SclMode(a0)		;
(1)  289/  FF18AA :                     ; 		bsr	System_MarsUpdate
(1)  290/  FF18AA :                     
(1)  291/  FF18AA : 6100 04C0           		bsr	SuperSprite_Test_init
(1)  292/  FF18AE : 6100 FA38           		bsr	System_MarsUpdate
(1)  293/  FF18B2 : 6100 0538           		bsr	SuperSprite_Test
(1)  294/  FF18B6 :                     
(1)  295/  FF18B6 : 41FA 0702           		lea	str_Page2(pc),a0	; Print text
(1)  296/  FF18BA : 203C 0000 0202      		move.l	#locate(0,2,2),d0
(1)  297/  FF18C0 : 6100 EB4A           		bsr	Video_Print
(1)  298/  FF18C4 : 303C 0001           		move.w	#1,d0
(1)  299/  FF18C8 : 6100 F130           		bsr	Video_Mars_GfxMode
(1)  300/  FF18CC : 41F9 0092 EAF4      		lea	(PalData_Mars_Test),a0
(1)  301/  FF18D2 : 7000                		moveq	#0,d0
(1)  302/  FF18D4 : 323C 0100           		move.w	#256,d1
(1)  303/  FF18D8 : 7400                		moveq	#0,d2
(1)  304/  FF18DA : 6100 F15E           		bsr	Video_FadePal_Mars
(1)  305/  FF18DE : 4278 A274           		clr.w	(RAM_MdMarsPalFd).w
(1)  306/  FF18E2 : 4278 AB60           		clr.w	(RAM_MdDreq+Dreq_Palette).w
(1)  307/  FF18E6 : 6100 03A8           		bsr	.fade_in
(1)  308/  FF18EA :                     .page2:
(1)  309/  FF18EA :                     
(1)  310/  FF18EA : 6100 0500           		bsr	SuperSprite_Test
(1)  311/  FF18EE : 3E38 A706           		move.w	(Controller_1+on_press),d7
(1)  312/  FF18F2 : 0807 0007           		btst	#bitJoyStart,d7
(1)  313/  FF18F6 : 670A                		beq.s	.page2_ret
(1)  314/  FF18F8 : 31FC 0000 9000      		move.w	#0,(RAM_CurrPage).w
(1)  315/  FF18FE : 6100 03B6           		bsr	.fade_out
(1)  316/  FF1902 :                     .page2_ret:
(1)  317/  FF1902 : 4E75                		rts
(1)  318/  FF1904 :                     
(1)  319/  FF1904 :                     ; ====================================================================
(1)  320/  FF1904 :                     ; --------------------------------------------------
(1)  321/  FF1904 :                     ; Page 3
(1)  322/  FF1904 :                     ; --------------------------------------------------
(1)  323/  FF1904 :                     
(1)  324/  FF1904 :                     .page3_init:
(1)  325/  FF1904 : 6100 E9EA           		bsr	Video_ClearScreen
(1)  326/  FF1908 : 6100 EAF0           		bsr	Video_PrintPal
(1)  327/  FF190C : 0078 8000 9000      		or.w	#$8000,(RAM_CurrPage).w
(1)  328/  FF1912 : 4278 9004           		clr.w	(RAM_CurrSelc).w
(1)  329/  FF1916 :                     
(1)  330/  FF1916 :                     ; 		lea	str_Page2(pc),a0
(1)  331/  FF1916 :                     ; 		move.l	#locate(0,10,2),d0
(1)  332/  FF1916 :                     ; 		bsr	Video_Print
(1)  333/  FF1916 :                     
(1)  334/  FF1916 : 6100 0454           		bsr	SuperSprite_Test_init
(1)  335/  FF191A :                     
(1)  336/  FF191A : 41FA 06BE           		lea	str_Page3_bg(pc),a0
(1)  337/  FF191E : 203C 0001 0808      		move.l	#locate(1,8,8),d0
(1)  338/  FF1924 : 6100 EAE6           		bsr	Video_Print
(1)  339/  FF1928 :                     
(1)  340/  FF1928 :                     ; 		move.w	#$100,marsspr_dx(a0)
(1)  341/  FF1928 :                     ; 		move.w	#$100,marsspr_dy(a0)
(1)  342/  FF1928 :                     ; 		move.l	#$00000000,marsspr_t_x(a0)
(1)  343/  FF1928 :                     ; 		move.l	#$00000000,marsspr_b_x(a0)
(1)  344/  FF1928 :                     
(1)  345/  FF1928 :                     ; 		lea	str_Page2(pc),a0	; Print text
(1)  346/  FF1928 :                     ; 		move.l	#locate(0,2,2),d0
(1)  347/  FF1928 :                     ; 		bsr	Video_Print
(1)  348/  FF1928 :                     ; 		move.l	#ART_FGTEST,d0
(1)  349/  FF1928 :                     ; 		move.w	#$280*$20,d1
(1)  350/  FF1928 :                     ; 		move.w	#ART_FGTEST_e-ART_FGTEST,d2
(1)  351/  FF1928 :                     ; 		bsr	Video_LoadArt
(1)  352/  FF1928 :                     ; 		move.l	#ART_BGTEST,d0
(1)  353/  FF1928 :                     ; 		move.w	#1*$20,d1
(1)  354/  FF1928 :                     ; 		move.w	#ART_BGTEST_e-ART_BGTEST,d2
(1)  355/  FF1928 :                     ; 		bsr	Video_LoadArt
(1)  356/  FF1928 :                     ; 		lea	(MAP_FGTEST),a0
(1)  357/  FF1928 :                     ; 		move.l	#locate(0,0,0),d0
(1)  358/  FF1928 :                     ; 		move.l	#mapsize(512,256),d1
(1)  359/  FF1928 :                     ; 		move.w	#$2000+$0280,d2
(1)  360/  FF1928 :                     ; 		bsr	Video_LoadMap
(1)  361/  FF1928 :                     ; 		lea	(MAP_BGTEST),a0
(1)  362/  FF1928 :                     ; 		move.l	#locate(1,0,0),d0
(1)  363/  FF1928 :                     ; 		move.l	#mapsize(512,256),d1
(1)  364/  FF1928 :                     ; 		move.w	#$0001,d2
(1)  365/  FF1928 :                     ; 		bsr	Video_LoadMap
(1)  366/  FF1928 :                     
(1)  367/  FF1928 :                     ; 		lea	(RAM_MdDreq+Dreq_ScrnBuff),a0
(1)  368/  FF1928 :                     ; 		move.l	#TESTMARS_BG,scrlbg_Data(a0)
(1)  369/  FF1928 :                     ; 		move.l	#512,scrlbg_W(a0)
(1)  370/  FF1928 :                     ; 		move.l	#256,scrlbg_H(a0)
(1)  371/  FF1928 :                     ; 		move.l	#$00000000,scrlbg_X(a0)
(1)  372/  FF1928 :                     ; 		move.l	#$00000000,scrlbg_Y(a0)
(1)  373/  FF1928 :                     ; 		bsr	System_MarsUpdate
(1)  374/  FF1928 : 303C 0002           		move.w	#2,d0
(1)  375/  FF192C : 6100 F0CC           		bsr	Video_Mars_GfxMode
(1)  376/  FF1930 : 41F9 0092 EAF4      		lea	(PalData_Mars_Test),a0
(1)  377/  FF1936 : 7000                		moveq	#0,d0
(1)  378/  FF1938 : 323C 0100           		move.w	#256,d1
(1)  379/  FF193C : 7400                		moveq	#0,d2
(1)  380/  FF193E : 6100 F0FA           		bsr	Video_FadePal_Mars
(1)  381/  FF1942 :                     ; 		lea	PAL_TESTBOARD(pc),a0
(1)  382/  FF1942 :                     ; 		moveq	#0,d0
(1)  383/  FF1942 :                     ; 		move.w	#$20,d1
(1)  384/  FF1942 :                     ; 		bsr	Video_FadePal
(1)  385/  FF1942 :                     ; 		clr.w	(RAM_MdMarsPalFd).w
(1)  386/  FF1942 :                     ; 		clr.w	(RAM_MdDreq+Dreq_Palette).w
(1)  387/  FF1942 : 612E                		bsr	.this_bg
(1)  388/  FF1944 : 6100 034A           		bsr	.fade_in
(1)  389/  FF1948 :                     .page3:
(1)  390/  FF1948 : 41FA 06AC           		lea	str_Page3(pc),a0
(1)  391/  FF194C : 203C 0000 0202      		move.l	#locate(0,2,2),d0
(1)  392/  FF1952 : 6100 EAB8           		bsr	Video_Print
(1)  393/  FF1956 : 611A                		bsr	.this_bg
(1)  394/  FF1958 :                     
(1)  395/  FF1958 :                     ; 		move.w	(Controller_1+on_hold),d7
(1)  396/  FF1958 :                     ; 		and.w	#JoyB+JoyA,d7
(1)  397/  FF1958 :                     ; 		bne.s	.stayoff
(1)  398/  FF1958 :                     ; 		move.l	(RAM_MdDreq+Dreq_ScrnBuff+scrlbg_X).w,d0
(1)  399/  FF1958 :                     ; 		move.l	(RAM_MdDreq+Dreq_ScrnBuff+scrlbg_Y).w,d1
(1)  400/  FF1958 :                     ; 		move.l	#TEST_SPEED,d5
(1)  401/  FF1958 :                     ; 		move.w	(Controller_1+on_hold),d7
(1)  402/  FF1958 :                     ; 		btst	#bitJoyRight,d7
(1)  403/  FF1958 :                     ; 		beq.s	.nor_m
(1)  404/  FF1958 :                     ; 		add.l	d5,d0
(1)  405/  FF1958 :                     ; .nor_m:
(1)  406/  FF1958 :                     ; 		btst	#bitJoyLeft,d7
(1)  407/  FF1958 :                     ; 		beq.s	.nol_m
(1)  408/  FF1958 :                     ; 		sub.l	d5,d0
(1)  409/  FF1958 :                     ; .nol_m:
(1)  410/  FF1958 :                     ; 		btst	#bitJoyDown,d7
(1)  411/  FF1958 :                     ; 		beq.s	.nod_m
(1)  412/  FF1958 :                     ; 		add.l	d5,d1
(1)  413/  FF1958 :                     ; .nod_m:
(1)  414/  FF1958 :                     ; 		btst	#bitJoyUp,d7
(1)  415/  FF1958 :                     ; 		beq.s	.nou_m
(1)  416/  FF1958 :                     ; 		sub.l	d5,d1
(1)  417/  FF1958 :                     ; .nou_m:
(1)  418/  FF1958 :                     ; 		move.l	d0,(RAM_MdDreq+Dreq_ScrnBuff+scrlbg_X).w
(1)  419/  FF1958 :                     ; 		move.l	d1,(RAM_MdDreq+Dreq_ScrnBuff+scrlbg_Y).w
(1)  420/  FF1958 :                     ; 		swap	d0
(1)  421/  FF1958 :                     ; 		swap	d1
(1)  422/  FF1958 :                     ; 		neg.w	d0
(1)  423/  FF1958 :                     ; 		move.w	d0,(RAM_HorScroll+2).w
(1)  424/  FF1958 :                     ; 		move.w	d1,(RAM_VerScroll+2).w
(1)  425/  FF1958 :                     ; .stayoff:
(1)  426/  FF1958 :                     
(1)  427/  FF1958 : 6100 0492           		bsr	SuperSprite_Test
(1)  428/  FF195C : 3E38 A706           		move.w	(Controller_1+on_press),d7
(1)  429/  FF1960 : 0807 0007           		btst	#bitJoyStart,d7
(1)  430/  FF1964 : 670A                		beq.s	.page3_ret
(1)  431/  FF1966 : 31FC 0000 9000      		move.w	#0,(RAM_CurrPage).w
(1)  432/  FF196C : 6100 0348           		bsr	.fade_out
(1)  433/  FF1970 :                     .page3_ret:
(1)  434/  FF1970 : 4E75                		rts
(1)  435/  FF1972 :                     
(1)  436/  FF1972 :                     .this_bg:
(1)  437/  FF1972 :                     ; 		move.l	(RAM_MdDreq+scrlbg_X).w,d0
(1)  438/  FF1972 :                     ; 		move.l	d0,d1
(1)  439/  FF1972 :                     ; 		swap	d0
(1)  440/  FF1972 :                     ; 		swap	d1
(1)  441/  FF1972 :                     ; 		lsr.l	#1,d0
(1)  442/  FF1972 :                     ; 		lsr.l	#2,d1
(1)  443/  FF1972 :                     ; 		neg.w	d0
(1)  444/  FF1972 :                     ; 		neg.w	d1
(1)  445/  FF1972 :                     ; 		lea	(RAM_HorScroll),a0
(1)  446/  FF1972 :                     ; 		move.w	#(224/2)-1,d7
(1)  447/  FF1972 :                     ; .next:
(1)  448/  FF1972 :                     ; 		move.w	d0,(a0)+
(1)  449/  FF1972 :                     ; 		move.w	d1,(a0)+
(1)  450/  FF1972 :                     ; 		move.w	d0,(a0)+
(1)  451/  FF1972 :                     ; 		move.w	d1,(a0)+
(1)  452/  FF1972 :                     ; 		dbf	d7,.next
(1)  453/  FF1972 : 4E75                		rts
(1)  454/  FF1974 :                     
(1)  455/  FF1974 :                     ; ====================================================================
(1)  456/  FF1974 :                     ; --------------------------------------------------
(1)  457/  FF1974 :                     ; Page 4
(1)  458/  FF1974 :                     ; --------------------------------------------------
(1)  459/  FF1974 :                     
(1)  460/  FF1974 :                     .page4_init:
(1)  461/  FF1974 : 6100 E97A           		bsr	Video_ClearScreen
(1)  462/  FF1978 : 6100 EA80           		bsr	Video_PrintPal
(1)  463/  FF197C : 0078 8000 9000      		or.w	#$8000,(RAM_CurrPage).w
(1)  464/  FF1982 : 4278 9004           		clr.w	(RAM_CurrSelc).w
(1)  465/  FF1986 :                     
(1)  466/  FF1986 :                     ; 		lea	(RAM_MdDreq+Dreq_Objects),a0
(1)  467/  FF1986 :                     ; 		move.l	#MarsObj_test|TH,mdl_data(a0)
(1)  468/  FF1986 :                     ; 		move.w	#-$800,mdl_z_pos(a0)
(1)  469/  FF1986 :                     ; 		move.w	#$4000,mdl_y_pos(a0)
(1)  470/  FF1986 : 41FA 068A           		lea	str_Page4(pc),a0	; Print text
(1)  471/  FF198A : 203C 0000 0202      		move.l	#locate(0,2,2),d0
(1)  472/  FF1990 : 6100 EA7A           		bsr	Video_Print
(1)  473/  FF1994 :                     
(1)  474/  FF1994 : 6100 F952           		bsr	System_MarsUpdate
(1)  475/  FF1998 :                     
(1)  476/  FF1998 : 41F9 0092 ECF4      		lea	(MDLDATA_PAL_TEST),a0
(1)  477/  FF199E : 7000                		moveq	#0,d0
(1)  478/  FF19A0 : 323C 0100           		move.w	#256,d1
(1)  479/  FF19A4 : 7400                		moveq	#0,d2
(1)  480/  FF19A6 : 6100 F092           		bsr	Video_FadePal_Mars
(1)  481/  FF19AA : 303C 0003           		move.w	#3,d0
(1)  482/  FF19AE : 6100 F04A           		bsr	Video_Mars_GfxMode
(1)  483/  FF19B2 : 6100 F070           		bsr	Video_Mars_WaitFrame
(1)  484/  FF19B6 : 6100 02D8           		bsr	.fade_in
(1)  485/  FF19BA :                     .page4:
(1)  486/  FF19BA : 41FA 0896           		lea	str_Stats(pc),a0
(1)  487/  FF19BE : 203C 0000 0204      		move.l	#locate(0,2,4),d0
(1)  488/  FF19C4 : 6100 EA46           		bsr	Video_Print
(1)  489/  FF19C8 : 41F8 ADF8           		lea	(RAM_MdDreq+Dreq_Objects),a0
(1)  490/  FF19CC : 0668 0010 000E      		add.w	#8*2,mdl_x_rot(a0)
(1)  491/  FF19D2 : 0668 0010 0010      		add.w	#8*2,mdl_y_rot(a0)
(1)  492/  FF19D8 : 0668 0028 0012      		add.w	#8*5,mdl_z_rot(a0)
(1)  493/  FF19DE :                     
(1)  494/  FF19DE : 3E38 A704           		move.w	(Controller_1+on_hold),d7
(1)  495/  FF19E2 : 0807 0000           		btst	#bitJoyUp,d7
(1)  496/  FF19E6 : 6706                		beq.s	.z_up
(1)  497/  FF19E8 : 0468 0010 000C      		sub.w	#$10,mdl_z_pos(a0)
(1)  498/  FF19EE :                     .z_up:
(1)  499/  FF19EE : 0807 0001           		btst	#bitJoyDown,d7
(1)  500/  FF19F2 : 6706                		beq.s	.z_dw
(1)  501/  FF19F4 : 0668 0010 000C      		add.w	#$10,mdl_z_pos(a0)
(1)  502/  FF19FA :                     .z_dw:
(1)  503/  FF19FA :                     
(1)  504/  FF19FA : 3E38 A706           		move.w	(Controller_1+on_press),d7
(1)  505/  FF19FE : 0807 0007           		btst	#bitJoyStart,d7
(1)  506/  FF1A02 : 670A                		beq.s	.page4_ret
(1)  507/  FF1A04 : 31FC 0000 9000      		move.w	#0,(RAM_CurrPage).w
(1)  508/  FF1A0A : 6100 02AA           		bsr	.fade_out
(1)  509/  FF1A0E :                     .page4_ret:
(1)  510/  FF1A0E : 4E75                		rts
(1)  511/  FF1A10 :                     
(1)  512/  FF1A10 :                     ; ====================================================================
(1)  513/  FF1A10 :                     ; --------------------------------------------------
(1)  514/  FF1A10 :                     ; Page 5
(1)  515/  FF1A10 :                     ; --------------------------------------------------
(1)  516/  FF1A10 :                     
(1)  517/  FF1A10 :                     .page5_init:
(1)  518/  FF1A10 : 6100 E8DE           		bsr	Video_ClearScreen
(1)  519/  FF1A14 : 6100 E9E4           		bsr	Video_PrintPal
(1)  520/  FF1A18 : 0078 8000 9000      		or.w	#$8000,(RAM_CurrPage).w
(1)  521/  FF1A1E : 4278 9004           		clr.w	(RAM_CurrSelc).w
(1)  522/  FF1A22 :                     
(1)  523/  FF1A22 :                     ; 		move.l	#ART_FGTEST,d0
(1)  524/  FF1A22 :                     ; 		move.w	#$280*$20,d1
(1)  525/  FF1A22 :                     ; 		move.w	#ART_FGTEST_e-ART_FGTEST,d2
(1)  526/  FF1A22 :                     ; 		bsr	Video_LoadArt
(1)  527/  FF1A22 :                     ; 		move.l	#ART_BGTEST,d0
(1)  528/  FF1A22 :                     ; 		move.w	#1*$20,d1
(1)  529/  FF1A22 :                     ; 		move.w	#ART_BGTEST_e-ART_BGTEST,d2
(1)  530/  FF1A22 :                     ; 		bsr	Video_LoadArt
(1)  531/  FF1A22 :                     ; 		lea	(MAP_FGTEST),a0
(1)  532/  FF1A22 :                     ; 		move.l	#locate(0,0,0),d0
(1)  533/  FF1A22 :                     ; 		move.l	#mapsize(512,256),d1
(1)  534/  FF1A22 :                     ; 		move.w	#$2000+$0280,d2
(1)  535/  FF1A22 :                     ; 		bsr	Video_LoadMap
(1)  536/  FF1A22 :                     ; 		lea	(MAP_BGTEST),a0
(1)  537/  FF1A22 :                     ; 		move.l	#locate(1,0,0),d0
(1)  538/  FF1A22 :                     ; 		move.l	#mapsize(512,256),d1
(1)  539/  FF1A22 :                     ; 		move.w	#$0001,d2
(1)  540/  FF1A22 :                     ; 		bsr	Video_LoadMap
(1)  541/  FF1A22 :                     
(1)  542/  FF1A22 : 41FA 0628           		lea	str_Gema(pc),a0
(1)  543/  FF1A26 : 203C 0000 0202      		move.l	#locate(0,2,2),d0
(1)  544/  FF1A2C : 6100 E9DE           		bsr	Video_Print
(1)  545/  FF1A30 : 41FA 069C           		lea	str_GemaStatus(pc),a0
(1)  546/  FF1A34 : 203C 0000 050C      		move.l	#locate(0,5,12),d0
(1)  547/  FF1A3A : 6100 E9D0           		bsr	Video_Print
(1)  548/  FF1A3E :                     
(1)  549/  FF1A3E : 303C 0000           		move.w	#0,d0
(1)  550/  FF1A42 : 6100 EFB6           		bsr	Video_Mars_GfxMode
(1)  551/  FF1A46 : 6100 00FA           		bsr	.page5_update
(1)  552/  FF1A4A : 6100 0244           		bsr	.fade_in
(1)  553/  FF1A4E :                     .page5:
(1)  554/  FF1A4E : 6100 0116           		bsr	.page5_updvars
(1)  555/  FF1A52 :                     
(1)  556/  FF1A52 :                     	; Controller
(1)  557/  FF1A52 : 3E38 A706           		move.w	(Controller_1+on_press),d7
(1)  558/  FF1A56 : 0807 0009           		btst	#bitJoyY,d7
(1)  559/  FF1A5A : 6712                		beq.s	.noy2
(1)  560/  FF1A5C : 0C78 0001 9006      		cmp.w	#1,(RAM_CurrIndx).w
(1)  561/  FF1A62 : 670A                		beq.	.noy2
(1)  562/  FF1A64 : 0678 0001 9006      		add.w	#1,(RAM_CurrIndx).w
(1)  563/  FF1A6A : 6100 00D6           		bsr	.page5_update
(1)  564/  FF1A6E :                     .noy2:
(1)  565/  FF1A6E : 3E38 A704           		move.w	(Controller_1+on_hold),d7
(1)  566/  FF1A72 : 0807 000A           		btst	#bitJoyX,d7
(1)  567/  FF1A76 : 6710                		beq.s	.nox2
(1)  568/  FF1A78 : 4A78 9006           		tst.w	(RAM_CurrIndx).w
(1)  569/  FF1A7C : 670A                		beq.s	.nox2
(1)  570/  FF1A7E : 0478 0001 9006      		sub.w	#1,(RAM_CurrIndx).w
(1)  571/  FF1A84 : 6100 00BC           		bsr	.page5_update
(1)  572/  FF1A88 :                     .nox2:
(1)  573/  FF1A88 :                     
(1)  574/  FF1A88 :                     	; UP/DOWN
(1)  575/  FF1A88 : 3E38 A706           		move.w	(Controller_1+on_press),d7
(1)  576/  FF1A8C : 0807 0000           		btst	#bitJoyUp,d7
(1)  577/  FF1A90 : 6710                		beq.s	.nou2
(1)  578/  FF1A92 : 4A78 9004           		tst.w	(RAM_CurrSelc).w
(1)  579/  FF1A96 : 670A                		beq.s	.nou2
(1)  580/  FF1A98 : 0478 0001 9004      		sub.w	#1,(RAM_CurrSelc).w
(1)  581/  FF1A9E : 6100 00A2           		bsr	.page5_update
(1)  582/  FF1AA2 :                     .nou2:
(1)  583/  FF1AA2 : 3E38 A706           		move.w	(Controller_1+on_press),d7
(1)  584/  FF1AA6 : 0807 0001           		btst	#bitJoyDown,d7
(1)  585/  FF1AAA : 6712                		beq.s	.nod2
(1)  586/  FF1AAC : 0C78 0004 9004      		cmp.w	#MAX_GEMAENTRY,(RAM_CurrSelc).w
(1)  587/  FF1AB2 : 6C0A                		bge.s	.nod2
(1)  588/  FF1AB4 : 0678 0001 9004      		add.w	#1,(RAM_CurrSelc).w
(1)  589/  FF1ABA : 6100 0086           		bsr	.page5_update
(1)  590/  FF1ABE :                     .nod2:
(1)  591/  FF1ABE :                     
(1)  592/  FF1ABE :                     ; 	; LEFT/RIGHT
(1)  593/  FF1ABE : 43F8 9008           		lea	(RAM_CurrTrack),a1
(1)  594/  FF1AC2 : 0C78 0003 9004      		cmp.w	#3,(RAM_CurrSelc).w
(1)  595/  FF1AC8 : 6604                		bne.s	.toptrk
(1)  596/  FF1ACA : D2FC 0002           		add	#2,a1
(1)  597/  FF1ACE :                     .toptrk:
(1)  598/  FF1ACE : 0C78 0004 9004      		cmp.w	#4,(RAM_CurrSelc).w
(1)  599/  FF1AD4 : 6604                		bne.s	.toptrk2
(1)  600/  FF1AD6 : D2FC 0004           		add	#2*2,a1
(1)  601/  FF1ADA :                     .toptrk2:
(1)  602/  FF1ADA : 3E38 A704           		move.w	(Controller_1+on_hold),d7
(1)  603/  FF1ADE : CE7C 0010           		and.w	#JoyB,d7
(1)  604/  FF1AE2 : 6706                		beq.s	.noba
(1)  605/  FF1AE4 : 0651 0001           		add.w	#1,(a1)
(1)  606/  FF1AE8 : 6158                		bsr	.page5_update
(1)  607/  FF1AEA :                     .noba:
(1)  608/  FF1AEA : 3E38 A704           		move.w	(Controller_1+on_hold),d7
(1)  609/  FF1AEE : CE7C 0040           		and.w	#JoyA,d7
(1)  610/  FF1AF2 : 6706                		beq.s	.noaa
(1)  611/  FF1AF4 : 0451 0001           		sub.w	#1,(a1)
(1)  612/  FF1AF8 : 6148                		bsr	.page5_update
(1)  613/  FF1AFA :                     .noaa:
(1)  614/  FF1AFA :                     
(1)  615/  FF1AFA : 3E38 A706           		move.w	(Controller_1+on_press),d7
(1)  616/  FF1AFE : 0807 0002           		btst	#bitJoyLeft,d7
(1)  617/  FF1B02 : 6706                		beq.s	.nol
(1)  618/  FF1B04 :                     ; 		tst.w	(a1)
(1)  619/  FF1B04 :                     ; 		beq.s	.nol
(1)  620/  FF1B04 : 0451 0001           		sub.w	#1,(a1)
(1)  621/  FF1B08 : 6138                		bsr	.page5_update
(1)  622/  FF1B0A :                     .nol:
(1)  623/  FF1B0A : 3E38 A706           		move.w	(Controller_1+on_press),d7
(1)  624/  FF1B0E : 0807 0003           		btst	#bitJoyRight,d7
(1)  625/  FF1B12 : 6706                		beq.s	.nor
(1)  626/  FF1B14 :                     ; 		cmp.w	#MAX_TSTTRKS,(a1)
(1)  627/  FF1B14 :                     ; 		bge.s	.nor
(1)  628/  FF1B14 : 0651 0001           		add.w	#1,(a1)
(1)  629/  FF1B18 : 6128                		bsr	.page5_update
(1)  630/  FF1B1A :                     .nor:
(1)  631/  FF1B1A :                     
(1)  632/  FF1B1A : 3E38 A706           		move.w	(Controller_1+on_press),d7
(1)  633/  FF1B1E : CE7C 0020           		and.w	#JoyC,d7
(1)  634/  FF1B22 : 6708                		beq.s	.noc_c
(1)  635/  FF1B24 : 3038 9006           		move.w	(RAM_CurrIndx).w,d0
(1)  636/  FF1B28 : 6100 00E6           		bsr	.procs_task
(1)  637/  FF1B2C :                     .noc_c:
(1)  638/  FF1B2C :                     
(1)  639/  FF1B2C : 3E38 A706           		move.w	(Controller_1+on_press),d7
(1)  640/  FF1B30 : 0807 0007           		btst	#bitJoyStart,d7
(1)  641/  FF1B34 : 670A                		beq.s	.page5_ret
(1)  642/  FF1B36 : 31FC 0000 9000      		move.w	#0,(RAM_CurrPage).w
(1)  643/  FF1B3C : 6100 0178           		bsr	.fade_out
(1)  644/  FF1B40 :                     .page5_ret:
(1)  645/  FF1B40 : 4E75                		rts
(1)  646/  FF1B42 :                     .page5_update:
(1)  647/  FF1B42 : 41FA 04E8           		lea	str_Status(pc),a0
(1)  648/  FF1B46 : 203C 0000 1404      		move.l	#locate(0,20,4),d0
(1)  649/  FF1B4C : 6100 E8BE           		bsr	Video_Print
(1)  650/  FF1B50 : 41FA 0394           		lea	str_Cursor(pc),a0
(1)  651/  FF1B54 : 7000                		moveq	#0,d0
(1)  652/  FF1B56 : 3038 9004           		move.w	(RAM_CurrSelc).w,d0
(1)  653/  FF1B5A : D0BC 0000 0205      		add.l	#locate(0,2,5),d0
(1)  654/  FF1B60 : 6000 E8AA           		bra	Video_Print
(1)  655/  FF1B64 : 4E75                		rts
(1)  656/  FF1B66 :                     .page5_updvars:
(1)  657/  FF1B66 : 4A78 9012           		tst.w	(RAM_GemaUpd).w
(1)  658/  FF1B6A : 6770                		beq	.no_upd2
(1)  659/  FF1B6C : 33FC 0100 00A1 1100 		move.w	#$0100,(z80_bus).l
(1)  660/  FF1B74 :                     .wait:
(1)  661/  FF1B74 : 0839 0000 00A1 1100 		btst	#0,(z80_bus).l
(1)  662/  FF1B7C : 66F6                		bne.s	.wait
(1)  663/  FF1B7E : 4DF8 9014           		lea	(RAM_GemaList),a6
(1)  664/  FF1B82 : 49F9 00A0 169C      		lea	(z80_cpu+(psgcom)).l,a4
(1)  665/  FF1B88 : 4BF9 00A0 16B8      		lea	(z80_cpu+(psgdtl)).l,a5
(1)  666/  FF1B8E : 323C 0003           		move.w	#4-1,d1
(1)  667/  FF1B92 :                     .copy_1:
(1)  668/  FF1B92 : 303C FFFF           		move.w	#-1,d0
(1)  669/  FF1B96 : 102D 0006           		move.b	6(a5),d0
(1)  670/  FF1B9A : E148                		lsl.w	#8,d0
(1)  671/  FF1B9C : 101D                		move.b	(a5)+,d0
(1)  672/  FF1B9E : 3CC0                		move.w	d0,(a6)+
(1)  673/  FF1BA0 : 51C9 FFF0           		dbf	d1,.copy_1
(1)  674/  FF1BA4 :                     
(1)  675/  FF1BA4 : 4BF9 00A0 1690      		lea	(z80_cpu+(fmcom+24)).l,a5
(1)  676/  FF1BAA : 323C 0005           		move.w	#6-1,d1
(1)  677/  FF1BAE :                     .copy_2:
(1)  678/  FF1BAE : 102D 0006           		move.b	6(a5),d0
(1)  679/  FF1BB2 : E148                		lsl.w	#8,d0
(1)  680/  FF1BB4 : 101D                		move.b	(a5)+,d0
(1)  681/  FF1BB6 : E058                		ror.w	#8,d0
(1)  682/  FF1BB8 : 3CC0                		move.w	d0,(a6)+
(1)  683/  FF1BBA : 51C9 FFF2           		dbf	d1,.copy_2
(1)  684/  FF1BBE :                     
(1)  685/  FF1BBE : 4BF9 00A0 1648      		lea	(z80_cpu+(pwmcom+8)).l,a5
(1)  686/  FF1BC4 : 323C 0006           		move.w	#7-1,d1
(1)  687/  FF1BC8 :                     .copy_3:
(1)  688/  FF1BC8 : 102D 0008           		move.b	8(a5),d0
(1)  689/  FF1BCC : E148                		lsl.w	#8,d0
(1)  690/  FF1BCE : 101D                		move.b	(a5)+,d0
(1)  691/  FF1BD0 : E058                		ror.w	#8,d0
(1)  692/  FF1BD2 : C07C 03FF           		and.w	#$3FF,d0
(1)  693/  FF1BD6 : 3CC0                		move.w	d0,(a6)+
(1)  694/  FF1BD8 : 51C9 FFEE           		dbf	d1,.copy_3
(1)  695/  FF1BDC :                     
(1)  696/  FF1BDC :                     
(1)  697/  FF1BDC :                     .no_upd2:
(1)  698/  FF1BDC : 33FC 0000 00A1 1100 		move.w	#0,(z80_bus).l
(1)  699/  FF1BE4 :                     	; ****
(1)  700/  FF1BE4 :                     
(1)  701/  FF1BE4 : 41FA 05E4           		lea	str_GemaPsg(pc),a0
(1)  702/  FF1BE8 : 203C 0000 0A0E      		move.l	#locate(0,10,14),d0
(1)  703/  FF1BEE : 6100 E81C           		bsr	Video_Print
(1)  704/  FF1BF2 : 41FA 05F6           		lea	str_GemaFm(pc),a0
(1)  705/  FF1BF6 : 203C 0000 140E      		move.l	#locate(0,20,14),d0
(1)  706/  FF1BFC : 6100 E80E           		bsr	Video_Print
(1)  707/  FF1C00 : 41FA 0618           		lea	str_GemaPwm(pc),a0
(1)  708/  FF1C04 : 203C 0000 1F0E      		move.l	#locate(0,31,14),d0
(1)  709/  FF1C0A : 6000 E800           		bra	Video_Print
(1)  710/  FF1C0E : 4E75                		rts
(1)  711/  FF1C10 :                     
(1)  712/  FF1C10 :                     ; d1 - Track slot
(1)  713/  FF1C10 :                     .procs_task:
(1)  714/  FF1C10 : 3E38 9004           		move.w	(RAM_CurrSelc).w,d7
(1)  715/  FF1C14 : DE47                		add.w	d7,d7
(1)  716/  FF1C16 : 3E3B 7006           		move.w	.tasklist(pc,d7.w),d7
(1)  717/  FF1C1A : 4EFB 7002           		jmp	.tasklist(pc,d7.w)
(1)  718/  FF1C1E :                     .tasklist:
(1)  719/  FF1C1E : 000A                		dc.w .task_00-.tasklist
(1)  720/  FF1C20 : 0040                		dc.w .task_01-.tasklist
(1)  721/  FF1C22 : 004C                		dc.w .task_02-.tasklist
(1)  722/  FF1C24 : 0050                		dc.w .task_03-.tasklist
(1)  723/  FF1C26 : 0058                		dc.w .task_04-.tasklist
(1)  724/  FF1C28 :                     ; 		dc.w .task_05-.tasklist
(1)  725/  FF1C28 :                     
(1)  726/  FF1C28 :                     ; d0 - Track slot
(1)  727/  FF1C28 :                     .task_00:
(1)  728/  FF1C28 : 3E38 9008           		move.w	(RAM_CurrTrack).w,d7
(1)  729/  FF1C2C : DE47                		add.w	d7,d7
(1)  730/  FF1C2E : 41FA 00F4           		lea	MasterTrkBeats(pc),a0
(1)  731/  FF1C32 : 3230 7000           		move.w	(a0,d7.w),d1
(1)  732/  FF1C36 : 6100 E614           		bsr	Sound_GlbBeats
(1)  733/  FF1C3A :                     
(1)  734/  FF1C3A : 41FA 0100           		lea	MasterTrkList(pc),a0
(1)  735/  FF1C3E : 3E38 9008           		move.w	(RAM_CurrTrack).w,d7
(1)  736/  FF1C42 : E74F                		lsl.w	#3,d7
(1)  737/  FF1C44 : 3230 7004           		move.w	4(a0,d7.w),d1
(1)  738/  FF1C48 : 7400                		moveq	#0,d2
(1)  739/  FF1C4A : 3630 7006           		move.w	6(a0,d7.w),d3
(1)  740/  FF1C4E : 2070 7000           		move.l	(a0,d7.w),a0
(1)  741/  FF1C52 : 6100 E572           		bsr	Sound_TrkPlay
(1)  742/  FF1C56 : 31FC 0001 9012      		move.w	#1,(RAM_GemaUpd).w
(1)  743/  FF1C5C : 6020                		bra.s	.cleanup
(1)  744/  FF1C5E :                     .task_01:
(1)  745/  FF1C5E : 31FC 0000 9012      		move.w	#0,(RAM_GemaUpd).w
(1)  746/  FF1C64 : 6100 E59E           		bsr	Sound_TrkStop
(1)  747/  FF1C68 : 6014                		bra.s	.cleanup
(1)  748/  FF1C6A :                     .task_02:
(1)  749/  FF1C6A : 6000 E5AE           		bra	Sound_TrkResume
(1)  750/  FF1C6E :                     .task_03:
(1)  751/  FF1C6E : 3238 900A           		move.w	(RAM_CurrTicks).w,d1
(1)  752/  FF1C72 : 6000 E5BC           		bra	Sound_TrkTicks
(1)  753/  FF1C76 :                     .task_04:
(1)  754/  FF1C76 : 3238 900C           		move.w	(RAM_CurrTempo).w,d1
(1)  755/  FF1C7A : 6000 E5D0           		bra	Sound_GlbBeats
(1)  756/  FF1C7E :                     
(1)  757/  FF1C7E :                     .cleanup:
(1)  758/  FF1C7E : 41F8 9014           		lea	(RAM_GemaList),a0
(1)  759/  FF1C82 : 7000                		moveq	#0,d0
(1)  760/  FF1C84 : 323C 0010           		move.w	#17-1,d1
(1)  761/  FF1C88 :                     .clnup:
(1)  762/  FF1C88 : 30C0                		move.w	d0,(a0)+
(1)  763/  FF1C8A : 51C9 FFFC           		dbf	d1,.clnup
(1)  764/  FF1C8E : 4E75                		rts
(1)  765/  FF1C90 :                     
(1)  766/  FF1C90 :                     ; ====================================================================
(1)  767/  FF1C90 :                     ; ----------------------------------------------
(1)  768/  FF1C90 :                     ; common subs
(1)  769/  FF1C90 :                     ; ----------------------------------------------
(1)  770/  FF1C90 :                     
(1)  771/  FF1C90 :                     .fade_in:
(1)  772/  FF1C90 : 31FC 0001 A6DA      		move.w	#1,(RAM_FadeMdReq).w
(1)  773/  FF1C96 : 31FC 0001 A6E2      		move.w	#1,(RAM_FadeMarsReq).w
(1)  774/  FF1C9C : 31FC 0001 A6DC      		move.w	#1,(RAM_FadeMdIncr).w
(1)  775/  FF1CA2 : 31FC 0004 A6E4      		move.w	#4,(RAM_FadeMarsIncr).w
(1)  776/  FF1CA8 : 31FC 0000 A6DE      		move.w	#0,(RAM_FadeMdDelay).w
(1)  777/  FF1CAE : 31FC 0000 A6E6      		move.w	#0,(RAM_FadeMarsDelay).w
(1)  778/  FF1CB4 : 4E75                		rts
(1)  779/  FF1CB6 :                     
(1)  780/  FF1CB6 :                     .fade_out:
(1)  781/  FF1CB6 : 31FC 0002 A6DA      		move.w	#2,(RAM_FadeMdReq).w
(1)  782/  FF1CBC : 31FC 0002 A6E2      		move.w	#2,(RAM_FadeMarsReq).w
(1)  783/  FF1CC2 : 31FC 0001 A6DC      		move.w	#1,(RAM_FadeMdIncr).w
(1)  784/  FF1CC8 : 31FC 0004 A6E4      		move.w	#4,(RAM_FadeMarsIncr).w
(1)  785/  FF1CCE : 31FC 0000 A6DE      		move.w	#0,(RAM_FadeMdDelay).w
(1)  786/  FF1CD4 : 31FC 0000 A6E6      		move.w	#0,(RAM_FadeMarsDelay).w
(1)  787/  FF1CDA : 4E75                		rts
(1)  788/  FF1CDC :                     
(1)  789/  FF1CDC :                     .print_cursor:
(1)  790/  FF1CDC : 41FA 0208           		lea	str_Cursor(pc),a0
(1)  791/  FF1CE0 : 7000                		moveq	#0,d0
(1)  792/  FF1CE2 : 3038 9004           		move.w	(RAM_CurrSelc).w,d0
(1)  793/  FF1CE6 : D081                		add.l	d1,d0
(1)  794/  FF1CE8 : 6100 E722           		bsr	Video_Print
(1)  795/  FF1CEC : 4E75                		rts
(1)  796/  FF1CEE :                     
(1)  797/  FF1CEE :                     .move_cursor_ud:
(1)  798/  FF1CEE : 7E00                		moveq	#0,d7
(1)  799/  FF1CF0 : 3C38 A706           		move.w	(Controller_1+on_press),d6
(1)  800/  FF1CF4 : 0806 0000           		btst	#bitJoyUp,d6
(1)  801/  FF1CF8 : 670E                		beq.s	.p0_down
(1)  802/  FF1CFA : 4A78 9004           		tst.w	(RAM_CurrSelc).w
(1)  803/  FF1CFE : 6708                		beq.s	.p0_down
(1)  804/  FF1D00 : 0478 0001 9004      		sub.w	#1,(RAM_CurrSelc).w
(1)  805/  FF1D06 : 7E01                		moveq	#1,d7
(1)  806/  FF1D08 :                     .p0_down:
(1)  807/  FF1D08 : 0806 0001           		btst	#bitJoyDown,d6
(1)  808/  FF1D0C : 6710                		beq.s	.p0_up
(1)  809/  FF1D0E : 3E38 9004           		move.w	(RAM_CurrSelc).w,d7
(1)  810/  FF1D12 : BE40                		cmp.w	d0,d7
(1)  811/  FF1D14 : 6C08                		bge.s	.p0_up
(1)  812/  FF1D16 : 0678 0001 9004      		add.w	#1,(RAM_CurrSelc).w
(1)  813/  FF1D1C : 7E01                		moveq	#1,d7
(1)  814/  FF1D1E :                     .p0_up:
(1)  815/  FF1D1E : 4A47                		tst.w	d7
(1)  816/  FF1D20 : 4E75                		rts
(1)  817/  FF1D22 :                     
(1)  818/  FF1D22 :                     ; 		lea	(MDLDATA_PAL_TEST),a0
(1)  819/  FF1D22 :                     ; 		cmp.w	#4,(RAM_CurrGfx).w
(1)  820/  FF1D22 :                     ; 		beq.s	.thispal
(1)  821/  FF1D22 :                     ; 		lea	(PalData_Mars_Test2),a0
(1)  822/  FF1D22 :                     ; 		cmp.w	#3,(RAM_CurrGfx).w
(1)  823/  FF1D22 :                     ; 		beq.s	.thispal
(1)  824/  FF1D22 :                     ; 		lea	(PalData_Mars_Test),a0
(1)  825/  FF1D22 :                     ; .thispal:
(1)  826/  FF1D22 :                     ; 		moveq	#0,d0
(1)  827/  FF1D22 :                     ; 		move.w	#256,d1
(1)  828/  FF1D22 :                     ; 		moveq	#0,d2
(1)  829/  FF1D22 :                     ; 		bsr	Video_FadePal_Mars
(1)  830/  FF1D22 :                     ; 		move.w	#1,(RAM_FadeMdReq).w		; FadeIn request on both sides
(1)  831/  FF1D22 :                     ; 		move.w	#1,(RAM_FadeMarsReq).w
(1)  832/  FF1D22 :                     ; 		move.w	#1,(RAM_FadeMdIncr).w
(1)  833/  FF1D22 :                     ; 		move.w	#4,(RAM_FadeMarsIncr).w
(1)  834/  FF1D22 :                     ; 		move.w	#2,(RAM_FadeMdDelay).w
(1)  835/  FF1D22 :                     ; 		move.w	#2,(RAM_FadeMarsDelay).w
(1)  836/  FF1D22 :                     ; 		move.w	(RAM_CurrGfx).w,d0
(1)  837/  FF1D22 :                     ; 		bsr	Video_Mars_GfxMode
(1)  838/  FF1D22 :                     ; .page0_loop:
(1)  839/  FF1D22 :                     ; ; 		bsr	Emilie_MkSprite
(1)  840/  FF1D22 :                     ; 		bsr	Video_RunFade
(1)  841/  FF1D22 :                     ; 		bne	.loop
(1)  842/  FF1D22 :                     ; 		move.w	(Controller_1+on_press),d7
(1)  843/  FF1D22 :                     ; 		btst	#bitJoyStart,d7
(1)  844/  FF1D22 :                     ; 		beq.s	.no_mode0
(1)  845/  FF1D22 :                     ; 		move.w	#1,(RAM_CurrPage).w
(1)  846/  FF1D22 :                     ; 		move.w	#$920D,(RAM_WindowNew).w
(1)  847/  FF1D22 :                     ; .no_mode0:
(1)  848/  FF1D22 :                     ; 		move.w	(Controller_1+on_press),d7
(1)  849/  FF1D22 :                     ; 		btst	#bitJoyZ,d7
(1)  850/  FF1D22 :                     ; 		beq.s	.noah
(1)  851/  FF1D22 :                     ; 		moveq	#0,d2
(1)  852/  FF1D22 :                     ; 		bsr	PlayThisSfx
(1)  853/  FF1D22 :                     ; .noah:
(1)  854/  FF1D22 :                     ;
(1)  855/  FF1D22 :                     ; 		move.l	(RAM_MdDreq+scrlbg_X).w,d0
(1)  856/  FF1D22 :                     ; 		move.l	(RAM_MdDreq+scrlbg_Y).w,d1
(1)  857/  FF1D22 :                     ; 		move.l	#$10000,d5
(1)  858/  FF1D22 :                     ; 		move.l	#1,d6
(1)  859/  FF1D22 :                     ; 		move.w	(Controller_1+on_hold),d7
(1)  860/  FF1D22 :                     ; 		btst	#bitJoyRight,d7
(1)  861/  FF1D22 :                     ; 		beq.s	.nor_m
(1)  862/  FF1D22 :                     ; 		add.l	d5,d0
(1)  863/  FF1D22 :                     ; 		sub.w	d6,d2
(1)  864/  FF1D22 :                     ; .nor_m:
(1)  865/  FF1D22 :                     ; 		btst	#bitJoyLeft,d7
(1)  866/  FF1D22 :                     ; 		beq.s	.nol_m
(1)  867/  FF1D22 :                     ; 		sub.l	d5,d0
(1)  868/  FF1D22 :                     ; 		add.w	d6,d2
(1)  869/  FF1D22 :                     ; .nol_m:
(1)  870/  FF1D22 :                     ; 		btst	#bitJoyDown,d7
(1)  871/  FF1D22 :                     ; 		beq.s	.nod_m
(1)  872/  FF1D22 :                     ; 		add.l	d5,d1
(1)  873/  FF1D22 :                     ; 		add.w	d6,d3
(1)  874/  FF1D22 :                     ; .nod_m:
(1)  875/  FF1D22 :                     ; 		btst	#bitJoyUp,d7
(1)  876/  FF1D22 :                     ; 		beq.s	.nou_m
(1)  877/  FF1D22 :                     ; 		sub.l	d5,d1
(1)  878/  FF1D22 :                     ; 		sub.w	d6,d3
(1)  879/  FF1D22 :                     ; .nou_m:
(1)  880/  FF1D22 :                     ; 		move.l	d0,(RAM_MdDreq+scrlbg_X).w
(1)  881/  FF1D22 :                     ; 		move.l	d1,(RAM_MdDreq+scrlbg_Y).w
(1)  882/  FF1D22 :                     ;
(1)  883/  FF1D22 :                     ; 		move.l	#0,d0
(1)  884/  FF1D22 :                     ; 		move.l	#0,d1
(1)  885/  FF1D22 :                     ; 		moveq	#0,d2
(1)  886/  FF1D22 :                     ; 		move.w	(Controller_1+on_press),d7
(1)  887/  FF1D22 :                     ; 		btst	#bitJoyB,d7
(1)  888/  FF1D22 :                     ; 		beq.s	.nor_m2
(1)  889/  FF1D22 :                     ; 		add.w	#1,(RAM_CurrGfx).w
(1)  890/  FF1D22 :                     ; 		moveq	#1,d2
(1)  891/  FF1D22 :                     ; .nor_m2:
(1)  892/  FF1D22 :                     ; 		btst	#bitJoyA,d7
(1)  893/  FF1D22 :                     ; 		beq.s	.nol_m2
(1)  894/  FF1D22 :                     ; 		sub.w	#1,(RAM_CurrGfx).w
(1)  895/  FF1D22 :                     ; 		moveq	#1,d2
(1)  896/  FF1D22 :                     ; .nol_m2:
(1)  897/  FF1D22 :                     ;
(1)  898/  FF1D22 :                     ; 		tst.w	d2
(1)  899/  FF1D22 :                     ; 		beq.s	.no_chng
(1)  900/  FF1D22 :                     ;
(1)  901/  FF1D22 :                     ; 		move.w	#2,(RAM_FadeMdReq).w		; FadeIn request on both sides
(1)  902/  FF1D22 :                     ; 		move.w	#2,(RAM_FadeMarsReq).w
(1)  903/  FF1D22 :                     ; 		move.w	#1,(RAM_FadeMdIncr).w
(1)  904/  FF1D22 :                     ; 		move.w	#4,(RAM_FadeMarsIncr).w
(1)  905/  FF1D22 :                     ; 		move.w	#2,(RAM_FadeMdDelay).w
(1)  906/  FF1D22 :                     ; 		move.w	#2,(RAM_FadeMarsDelay).w
(1)  907/  FF1D22 :                     ; .fadeout:
(1)  908/  FF1D22 :                     ; 		bsr	Video_RunFade
(1)  909/  FF1D22 :                     ; 		beq.s	.exit
(1)  910/  FF1D22 :                     ; 		bsr	System_WaitFrame
(1)  911/  FF1D22 :                     ; 		lea	(RAM_MdDreq),a0
(1)  912/  FF1D22 :                     ; 		move.w	#sizeof_dreq,d0
(1)  913/  FF1D22 :                     ; 		bsr	System_SendDreq
(1)  914/  FF1D22 :                     ; 		bra.s	.fadeout
(1)  915/  FF1D22 :                     ; .exit
(1)  916/  FF1D22 :                     ; 		move.w	#0,(RAM_CurrPage).w
(1)  917/  FF1D22 :                     ; ; .thispal:
(1)  918/  FF1D22 :                     ; ; 		moveq	#0,d2
(1)  919/  FF1D22 :                     ; ; 		moveq	#0,d0
(1)  920/  FF1D22 :                     ; ; 		move.w	#256,d1
(1)  921/  FF1D22 :                     ; ; 		bsr	Video_LoadPal_Mars
(1)  922/  FF1D22 :                     ; ; 		clr.w	(RAM_MdDreq+Dreq_Palette).w
(1)  923/  FF1D22 :                     ; .no_chng:
(1)  924/  FF1D22 :                     ; 		bsr	.move_model
(1)  925/  FF1D22 :                     
(1)  926/  FF1D22 :                     ; 	; Move Emily Fujiwara
(1)  927/  FF1D22 :                     ; 	; UDLR
(1)  928/  FF1D22 :                     ; 		move.w	(Controller_1+on_hold),d7
(1)  929/  FF1D22 :                     ; 		move.w	d7,d6
(1)  930/  FF1D22 :                     ; 		btst	#bitJoyDown,d7
(1)  931/  FF1D22 :                     ; 		beq.s	.noz_down
(1)  932/  FF1D22 :                     ; 		move.w	#0,(RAM_EmiFrame).w
(1)  933/  FF1D22 :                     ; 		add.w	#1,(RAM_EmiAnim).w
(1)  934/  FF1D22 :                     ; 		add.w	#1,(RAM_EmiPosY).w
(1)  935/  FF1D22 :                     ; .noz_down:
(1)  936/  FF1D22 :                     ; 		move.w	d7,d6
(1)  937/  FF1D22 :                     ; 		btst	#bitJoyUp,d6
(1)  938/  FF1D22 :                     ; 		beq.s	.noz_up
(1)  939/  FF1D22 :                     ; 		move.w	#4,(RAM_EmiFrame).w
(1)  940/  FF1D22 :                     ; 		add.w	#1,(RAM_EmiAnim).w
(1)  941/  FF1D22 :                     ; 		add.w	#-1,(RAM_EmiPosY).w
(1)  942/  FF1D22 :                     ; .noz_up:
(1)  943/  FF1D22 :                     ; 		move.w	d7,d6
(1)  944/  FF1D22 :                     ; 		btst	#bitJoyRight,d6
(1)  945/  FF1D22 :                     ; 		beq.s	.noz_r
(1)  946/  FF1D22 :                     ; 		move.w	#8,(RAM_EmiFrame).w
(1)  947/  FF1D22 :                     ; 		add.w	#1,(RAM_EmiAnim).w
(1)  948/  FF1D22 :                     ; 		add.w	#1,(RAM_EmiPosX).w
(1)  949/  FF1D22 :                     ; .noz_r:
(1)  950/  FF1D22 :                     ; 		move.w	d7,d6
(1)  951/  FF1D22 :                     ; 		btst	#bitJoyLeft,d6
(1)  952/  FF1D22 :                     ; 		beq.s	.noz_l
(1)  953/  FF1D22 :                     ; 		move.w	#$C,(RAM_EmiFrame).w
(1)  954/  FF1D22 :                     ; 		add.w	#1,(RAM_EmiAnim).w
(1)  955/  FF1D22 :                     ; 		add.w	#-1,(RAM_EmiPosX).w
(1)  956/  FF1D22 :                     ; .noz_l:
(1)  957/  FF1D22 :                     
(1)  958/  FF1D22 :                     ; 		lea	(RAM_MdDreq),a0
(1)  959/  FF1D22 :                     ; 		move.l	Dreq_SclX(a0),d0
(1)  960/  FF1D22 :                     ; 		move.l	Dreq_SclY(a0),d1
(1)  961/  FF1D22 :                     ; 		move.l	Dreq_SclDX(a0),d2
(1)  962/  FF1D22 :                     ; 		move.l	Dreq_SclDY(a0),d3
(1)  963/  FF1D22 :                     ; 		move.l	#$100,d4
(1)  964/  FF1D22 :                     ; 		move.l	#$200,d5
(1)  965/  FF1D22 :                     ;
(1)  966/  FF1D22 :                     ; 		move.w	(Controller_1+on_hold),d7
(1)  967/  FF1D22 :                     ; 		move.w	d7,d6
(1)  968/  FF1D22 :                     ; 		btst	#bitJoyDown,d7
(1)  969/  FF1D22 :                     ; 		beq.s	.noz_down
(1)  970/  FF1D22 :                     ; 		add.l	d4,d1
(1)  971/  FF1D22 :                     ; 		sub.l	d5,d3
(1)  972/  FF1D22 :                     ; .noz_down:
(1)  973/  FF1D22 :                     ; 		move.w	d7,d6
(1)  974/  FF1D22 :                     ; 		btst	#bitJoyUp,d6
(1)  975/  FF1D22 :                     ; 		beq.s	.noz_up
(1)  976/  FF1D22 :                     ; 		sub.l	d4,d1
(1)  977/  FF1D22 :                     ; 		add.l	d5,d3
(1)  978/  FF1D22 :                     ; .noz_up:
(1)  979/  FF1D22 :                     ; 		move.w	d7,d6
(1)  980/  FF1D22 :                     ; 		btst	#bitJoyRight,d6
(1)  981/  FF1D22 :                     ; 		beq.s	.noz_r
(1)  982/  FF1D22 :                     ; 		add.l	d4,d0
(1)  983/  FF1D22 :                     ; 		sub.l	d5,d2
(1)  984/  FF1D22 :                     ; .noz_r:
(1)  985/  FF1D22 :                     ; 		move.w	d7,d6
(1)  986/  FF1D22 :                     ; 		btst	#bitJoyLeft,d6
(1)  987/  FF1D22 :                     ; 		beq.s	.noz_l
(1)  988/  FF1D22 :                     ; 		sub.l	d4,d0
(1)  989/  FF1D22 :                     ; 		add.l	d5,d2
(1)  990/  FF1D22 :                     ; .noz_l:
(1)  991/  FF1D22 :                     ; 		move.l	d0,Dreq_SclX(a0)
(1)  992/  FF1D22 :                     ; 		move.l	d1,Dreq_SclY(a0)
(1)  993/  FF1D22 :                     ; 		move.l	d2,Dreq_SclDX(a0)
(1)  994/  FF1D22 :                     ; 		move.l	d3,Dreq_SclDY(a0)
(1)  995/  FF1D22 :                     ;
(1)  996/  FF1D22 :                     ; 		move.w	d7,d6
(1)  997/  FF1D22 :                     ; 		btst	#bitJoyX,d6
(1)  998/  FF1D22 :                     ; 		beq.s	.nox_x
(1)  999/  FF1D22 :                     ; 		lea	(RAM_MdDreq+Dreq_SclX),a0
(1) 1000/  FF1D22 :                     ; 		move.l	#$00000000,(a0)+	; X pos
(1) 1001/  FF1D22 :                     ; 		move.l	#$00000000,(a0)+	; Y pos
(1) 1002/  FF1D22 :                     ; 		move.l	#$00010000,(a0)+	; DX
(1) 1003/  FF1D22 :                     ; 		move.l	#$00010000,(a0)+	; DY
(1) 1004/  FF1D22 :                     ; .nox_x:
(1) 1005/  FF1D22 :                     
(1) 1006/  FF1D22 :                     
(1) 1007/  FF1D22 :                     ; 		move.w	d7,d6
(1) 1008/  FF1D22 :                     ; 		btst	#bitJoyY,d6
(1) 1009/  FF1D22 :                     ; 		beq.s	.noy
(1) 1010/  FF1D22 :                     ; 		move.l	Dreq_SclDX(a0),d0
(1) 1011/  FF1D22 :                     ; 		move.l	Dreq_SclDY(a0),d1
(1) 1012/  FF1D22 :                     ; 		move.l	#$100,d2
(1) 1013/  FF1D22 :                     ; 		add.l	d2,d0
(1) 1014/  FF1D22 :                     ; 		add.l	d2,d1
(1) 1015/  FF1D22 :                     ; 		move.l	d0,Dreq_SclDX(a0)
(1) 1016/  FF1D22 :                     ; 		move.l	d1,Dreq_SclDY(a0)
(1) 1017/  FF1D22 :                     ; .noy:
(1) 1018/  FF1D22 :                     
(1) 1019/  FF1D22 :                     ; 		bsr	Emilie_Move
(1) 1020/  FF1D22 :                     ; 		bsr	.wave_backgrnd
(1) 1021/  FF1D22 : 4E75                		rts
(1) 1022/  FF1D24 :                     
(1) 1023/  FF1D24 :                     ; .wave_backgrnd:
(1) 1024/  FF1D24 :                     ; 	; wave background
(1) 1025/  FF1D24 :                     ; 		lea	(RAM_HorScroll),a0
(1) 1026/  FF1D24 :                     ; 		moveq	#112-1,d7
(1) 1027/  FF1D24 :                     ; 		move.w	(RAM_WaveTmr),d0
(1) 1028/  FF1D24 :                     ; 		move.w	#8,d1
(1) 1029/  FF1D24 :                     ; .next:
(1) 1030/  FF1D24 :                     ; 		bsr	System_SineWave
(1) 1031/  FF1D24 :                     ; 		lsr.l	#8,d2
(1) 1032/  FF1D24 :                     ; 		move.w	d2,2(a0)
(1) 1033/  FF1D24 :                     ; 		adda	#4,a0
(1) 1034/  FF1D24 :                     ; 		add.w	#1,d0
(1) 1035/  FF1D24 :                     ; 		bsr	System_SineWave
(1) 1036/  FF1D24 :                     ; 		lsr.l	#8,d2
(1) 1037/  FF1D24 :                     ; 		move.w	d2,2(a0)
(1) 1038/  FF1D24 :                     ; 		adda	#4,a0
(1) 1039/  FF1D24 :                     ; 		add.w	#1,d0
(1) 1040/  FF1D24 :                     ; 		dbf	d7,.next
(1) 1041/  FF1D24 :                     ; 		add.w	#1,(RAM_WaveTmr).w
(1) 1042/  FF1D24 :                     ;
(1) 1043/  FF1D24 :                     ; 		lea	(RAM_VerScroll),a0
(1) 1044/  FF1D24 :                     ; 		moveq	#(320/16)-1,d7
(1) 1045/  FF1D24 :                     ; 		move.w	(RAM_WaveTmr),d0
(1) 1046/  FF1D24 :                     ; 		move.w	#6,d1
(1) 1047/  FF1D24 :                     ; .next2:
(1) 1048/  FF1D24 :                     ; 		bsr	System_SineWave_Cos
(1) 1049/  FF1D24 :                     ; 		lsr.l	#8,d2
(1) 1050/  FF1D24 :                     ; 		move.w	d2,2(a0)
(1) 1051/  FF1D24 :                     ; 		adda	#4,a0
(1) 1052/  FF1D24 :                     ; 		add.w	#4,d0
(1) 1053/  FF1D24 :                     ; 		dbf	d7,.next2
(1) 1054/  FF1D24 :                     ; 		add.w	#1,(RAM_WaveTmr2).w
(1) 1055/  FF1D24 :                     ;
(1) 1056/  FF1D24 :                     ; ; 		bsr	Emilie_Move
(1) 1057/  FF1D24 :                     ; ; 		bsr	Emilie_MkSprite
(1) 1058/  FF1D24 :                     ; 		rts
(1) 1059/  FF1D24 :                     ;
(1) 1060/  FF1D24 :                     ; ; --------------------------------------------------
(1) 1061/  FF1D24 :                     ; ; Mode 1
(1) 1062/  FF1D24 :                     ; ; --------------------------------------------------
(1) 1063/  FF1D24 :                     ;
(1) 1064/  FF1D24 :                     ; .mode1:
(1) 1065/  FF1D24 :                     ; 		tst.w	(RAM_CurrPage).w
(1) 1066/  FF1D24 :                     ; 		bmi	.mode1_loop
(1) 1067/  FF1D24 :                     ; 		or.w	#$8000,(RAM_CurrPage).w
(1) 1068/  FF1D24 :                     ; 		bsr	.print_cursor
(1) 1069/  FF1D24 :                     ; ; 		move.w	#1,(RAM_EmiHide).w
(1) 1070/  FF1D24 :                     ; ; 		move.w	#1,(RAM_EmiUpd).w
(1) 1071/  FF1D24 :                     ;
(1) 1072/  FF1D24 :                     ; .mode1_loop:
(1) 1073/  FF1D24 :                     ; 		move.w	(Controller_1+on_press),d7
(1) 1074/  FF1D24 :                     ; 		btst	#bitJoyStart,d7
(1) 1075/  FF1D24 :                     ; 		beq.s	.no_mode1
(1) 1076/  FF1D24 :                     ; 		move.w	#0,(RAM_CurrPage).w
(1) 1077/  FF1D24 :                     ; 		move.w	#$9200,(RAM_WindowNew).w
(1) 1078/  FF1D24 :                     ; .no_mode1:
(1) 1079/  FF1D24 :                     ; 		move.w	(Controller_1+on_press),d7
(1) 1080/  FF1D24 :                     ; 		btst	#bitJoyY,d7
(1) 1081/  FF1D24 :                     ; 		beq.s	.noy2
(1) 1082/  FF1D24 :                     ; 		cmp.w	#1,(RAM_CurrIndx).w
(1) 1083/  FF1D24 :                     ; 		beq.	.noy2
(1) 1084/  FF1D24 :                     ; 		add.w	#1,(RAM_CurrIndx).w
(1) 1085/  FF1D24 :                     ; 		bsr	.print_cursor
(1) 1086/  FF1D24 :                     ; .noy2:
(1) 1087/  FF1D24 :                     ; 		move.w	(Controller_1+on_hold),d7
(1) 1088/  FF1D24 :                     ; 		btst	#bitJoyX,d7
(1) 1089/  FF1D24 :                     ; 		beq.s	.nox2
(1) 1090/  FF1D24 :                     ; 		tst.w	(RAM_CurrIndx).w
(1) 1091/  FF1D24 :                     ; 		beq.s	.nox2
(1) 1092/  FF1D24 :                     ; 		sub.w	#1,(RAM_CurrIndx).w
(1) 1093/  FF1D24 :                     ; 		bsr	.print_cursor
(1) 1094/  FF1D24 :                     ; .nox2:
(1) 1095/  FF1D24 :                     ; 		move.w	(Controller_1+on_press),d7
(1) 1096/  FF1D24 :                     ; 		btst	#bitJoyUp,d7
(1) 1097/  FF1D24 :                     ; 		beq.s	.nou2
(1) 1098/  FF1D24 :                     ; 		tst.w	(RAM_CurrSelc).w
(1) 1099/  FF1D24 :                     ; 		beq.s	.nou2
(1) 1100/  FF1D24 :                     ; 		sub.w	#1,(RAM_CurrSelc).w
(1) 1101/  FF1D24 :                     ; 		bsr	.print_cursor
(1) 1102/  FF1D24 :                     ; .nou2:
(1) 1103/  FF1D24 :                     ; 		move.w	(Controller_1+on_press),d7
(1) 1104/  FF1D24 :                     ; 		btst	#bitJoyDown,d7
(1) 1105/  FF1D24 :                     ; 		beq.s	.nod2
(1) 1106/  FF1D24 :                     ; 		cmp.w	#MAX_GEMAENTRY,(RAM_CurrSelc).w
(1) 1107/  FF1D24 :                     ; 		bge.s	.nod2
(1) 1108/  FF1D24 :                     ; 		add.w	#1,(RAM_CurrSelc).w
(1) 1109/  FF1D24 :                     ; 		bsr	.print_cursor
(1) 1110/  FF1D24 :                     ; .nod2:
(1) 1111/  FF1D24 :                     ;
(1) 1112/  FF1D24 :                     ; 	; LEFT/RIGHT
(1) 1113/  FF1D24 :                     ; 		lea	(RAM_CurrTrack),a1
(1) 1114/  FF1D24 :                     ; 		cmp.w	#3,(RAM_CurrSelc).w
(1) 1115/  FF1D24 :                     ; 		bne.s	.toptrk
(1) 1116/  FF1D24 :                     ; 		add	#2,a1
(1) 1117/  FF1D24 :                     ; .toptrk:
(1) 1118/  FF1D24 :                     ; 		cmp.w	#4,(RAM_CurrSelc).w
(1) 1119/  FF1D24 :                     ; 		bne.s	.toptrk2
(1) 1120/  FF1D24 :                     ; 		add	#2*2,a1
(1) 1121/  FF1D24 :                     ; .toptrk2:
(1) 1122/  FF1D24 :                     ;
(1) 1123/  FF1D24 :                     ; 		move.w	(Controller_1+on_hold),d7
(1) 1124/  FF1D24 :                     ; 		and.w	#JoyB,d7
(1) 1125/  FF1D24 :                     ; 		beq.s	.noba
(1) 1126/  FF1D24 :                     ; 		add.w	#1,(a1)
(1) 1127/  FF1D24 :                     ; 		bsr	.print_cursor
(1) 1128/  FF1D24 :                     ; .noba:
(1) 1129/  FF1D24 :                     ; 		move.w	(Controller_1+on_hold),d7
(1) 1130/  FF1D24 :                     ; 		and.w	#JoyA,d7
(1) 1131/  FF1D24 :                     ; 		beq.s	.noaa
(1) 1132/  FF1D24 :                     ; 		sub.w	#1,(a1)
(1) 1133/  FF1D24 :                     ; 		bsr	.print_cursor
(1) 1134/  FF1D24 :                     ; .noaa:
(1) 1135/  FF1D24 :                     ;
(1) 1136/  FF1D24 :                     ;
(1) 1137/  FF1D24 :                     ;
(1) 1138/  FF1D24 :                     ; 		move.w	(Controller_1+on_press),d7
(1) 1139/  FF1D24 :                     ; 		btst	#bitJoyLeft,d7
(1) 1140/  FF1D24 :                     ; 		beq.s	.nol
(1) 1141/  FF1D24 :                     ; ; 		tst.w	(a1)
(1) 1142/  FF1D24 :                     ; ; 		beq.s	.nol
(1) 1143/  FF1D24 :                     ; 		sub.w	#1,(a1)
(1) 1144/  FF1D24 :                     ; 		bsr	.print_cursor
(1) 1145/  FF1D24 :                     ; .nol:
(1) 1146/  FF1D24 :                     ; 		move.w	(Controller_1+on_press),d7
(1) 1147/  FF1D24 :                     ; 		btst	#bitJoyRight,d7
(1) 1148/  FF1D24 :                     ; 		beq.s	.nor
(1) 1149/  FF1D24 :                     ; ; 		cmp.w	#MAX_TSTTRKS,(a1)
(1) 1150/  FF1D24 :                     ; ; 		bge.s	.nor
(1) 1151/  FF1D24 :                     ; 		add.w	#1,(a1)
(1) 1152/  FF1D24 :                     ; 		bsr	.print_cursor
(1) 1153/  FF1D24 :                     ; .nor:
(1) 1154/  FF1D24 :                     ;
(1) 1155/  FF1D24 :                     ; 		move.w	(Controller_1+on_press),d7
(1) 1156/  FF1D24 :                     ; 		and.w	#JoyC,d7
(1) 1157/  FF1D24 :                     ; 		beq.s	.noc_c
(1) 1158/  FF1D24 :                     ; 		move.w	(RAM_CurrIndx).w,d0
(1) 1159/  FF1D24 :                     ; 		bsr	.procs_task
(1) 1160/  FF1D24 :                     ; .noc_c:
(1) 1161/  FF1D24 :                     ;
(1) 1162/  FF1D24 :                     ; ; 		bsr	.wave_backgrnd
(1) 1163/  FF1D24 :                     ; ; 		lea	str_COMM(pc),a0
(1) 1164/  FF1D24 :                     ; ; 		move.l	#locate(0,2,9),d0
(1) 1165/  FF1D24 :                     ; ; 		bsr	Video_Print
(1) 1166/  FF1D24 :                     ; ; 		rts
(1) 1167/  FF1D24 :                     ;
(1) 1168/  FF1D24 :                     ; .move_model:
(1) 1169/  FF1D24 :                     ; 		lea	(RAM_MdDreq+Dreq_Objects),a0
(1) 1170/  FF1D24 :                     ; 		add.l	#$4000,mdl_x_rot(a0)
(1) 1171/  FF1D24 :                     ; ; 		add.l	#$1000,mdl_z_rot(a0)
(1) 1172/  FF1D24 :                     ; 		rts
(1) 1173/  FF1D24 :                     ;
(1) 1174/  FF1D24 :                     ; ; --------------------------------------------------
(1) 1175/  FF1D24 :                     ;
(1) 1176/  FF1D24 :                     ; .print_cursor:
(1) 1177/  FF1D24 :                     ; ; 		lea	str_Status(pc),a0
(1) 1178/  FF1D24 :                     ; ; 		move.l	#locate(2,20,4),d0
(1) 1179/  FF1D24 :                     ; ; 		bsr	Video_Print
(1) 1180/  FF1D24 :                     ; 		lea	str_Cursor(pc),a0
(1) 1181/  FF1D24 :                     ; 		moveq	#0,d0
(1) 1182/  FF1D24 :                     ; 		move.w	(RAM_CurrSelc).w,d0
(1) 1183/  FF1D24 :                     ; 		add.l	#locate(2,2,5),d0
(1) 1184/  FF1D24 :                     ; 		bsr	Video_Print
(1) 1185/  FF1D24 :                     ; 		rts
(1) 1186/  FF1D24 :                     ;
(1) 1187/  FF1D24 :                     ; ; d1 - Track slot
(1) 1188/  FF1D24 :                     ; .procs_task:
(1) 1189/  FF1D24 :                     ; 		move.w	(RAM_CurrSelc).w,d7
(1) 1190/  FF1D24 :                     ; 		add.w	d7,d7
(1) 1191/  FF1D24 :                     ; 		move.w	.tasklist(pc,d7.w),d7
(1) 1192/  FF1D24 :                     ; 		jmp	.tasklist(pc,d7.w)
(1) 1193/  FF1D24 :                     ; .tasklist:
(1) 1194/  FF1D24 :                     ; 		dc.w .task_00-.tasklist
(1) 1195/  FF1D24 :                     ; 		dc.w .task_01-.tasklist
(1) 1196/  FF1D24 :                     ; 		dc.w .task_02-.tasklist
(1) 1197/  FF1D24 :                     ; 		dc.w .task_03-.tasklist
(1) 1198/  FF1D24 :                     ; 		dc.w .task_04-.tasklist
(1) 1199/  FF1D24 :                     ; ; 		dc.w .task_05-.tasklist
(1) 1200/  FF1D24 :                     ;
(1) 1201/  FF1D24 :                     ; ; d0 - Track slot
(1) 1202/  FF1D24 :                     ; .task_00:
(1) 1203/  FF1D24 :                     ; 		lea	MasterTrkList(pc),a0
(1) 1204/  FF1D24 :                     ; 		move.w	(RAM_CurrTrack).w,d7
(1) 1205/  FF1D24 :                     ; 		lsl.w	#4,d7
(1) 1206/  FF1D24 :                     ; 		lea	(a0,d7.w),a0
(1) 1207/  FF1D24 :                     ; 		move.w	$C(a0),d1
(1) 1208/  FF1D24 :                     ; 		moveq	#0,d2
(1) 1209/  FF1D24 :                     ; 		move.w	$E(a0),d3
(1) 1210/  FF1D24 :                     ; 		bra	Sound_TrkPlay
(1) 1211/  FF1D24 :                     ; .task_01:
(1) 1212/  FF1D24 :                     ; 		bra	Sound_TrkStop
(1) 1213/  FF1D24 :                     ; .task_02:
(1) 1214/  FF1D24 :                     ; 		bra	Sound_TrkResume
(1) 1215/  FF1D24 :                     ; .task_03:
(1) 1216/  FF1D24 :                     ; 		move.w	(RAM_CurrTicks).w,d1
(1) 1217/  FF1D24 :                     ; 		bra	Sound_TrkTicks
(1) 1218/  FF1D24 :                     ; .task_04:
(1) 1219/  FF1D24 :                     ; 		move.w	(RAM_CurrTempo).w,d1
(1) 1220/  FF1D24 :                     ; 		bra	Sound_GlbBeats
(1) 1221/  FF1D24 :                     ;
(1) 1222/  FF1D24 :                     ; ; test playlist
(1) 1223/  FF1D24 :                     
(1) 1224/  FF1D24 :                     
(1) 1225/  FF1D24 :                     MasterTrkBeats:
(1) 1226/  FF1D24 : 00E8                	dc.w 200+32
(1) 1227/  FF1D26 : 00E8                	dc.w 200+32
(1) 1228/  FF1D28 : 00E8                	dc.w 200+32
(1) 1229/  FF1D2A : 00E8                	dc.w 200+32
(1) 1230/  FF1D2C : 00DC                	dc.w 200+20
(1) 1231/  FF1D2E : 00E8                	dc.w 200+32
(1) 1232/  FF1D30 : 00E8                	dc.w 200+32
(1) 1233/  FF1D32 : 00E8                	dc.w 200+32
(1) 1234/  FF1D34 : 00E8                	dc.w 200+32
(1) 1235/  FF1D36 : 00E8                	dc.w 200+32
(1) 1236/  FF1D38 : 00E8                	dc.w 200+32
(1) 1237/  FF1D3A : 00E8                	dc.w 200+32
(1) 1238/  FF1D3C :                     
(1) 1239/  FF1D3C :                     MasterTrkList:
(1) 1240/  FF1D3C : 0088 A696           	dc.l GemaTrkData_MOVEME
(1) 1241/  FF1D40 : 0007 0000           	dc.w 7,%000
(1) 1242/  FF1D44 : 0088 B5CA           	dc.l GemaTrkData_Nadie_MARS
(1) 1243/  FF1D48 : 0006 0001           	dc.w 6,%001
(1) 1244/  FF1D4C : 0088 C838           	dc.l GemaTrkData_BeMine
(1) 1245/  FF1D50 : 000A 0000           	dc.w $A,%000
(1) 1246/  FF1D54 : 0088 E1E0           	dc.l GemaTrkData_Nadie_MD
(1) 1247/  FF1D58 : 0006 0001           	dc.w 6,%001
(1) 1248/  FF1D5C : 0088 F4CE           	dc.l GemaTrkData_WeGot
(1) 1249/  FF1D60 : 0003 0001           	dc.w 3,%001
(1) 1250/  FF1D64 : 0089 1170           	dc.l GemaTrkData_Mecano
(1) 1251/  FF1D68 : 0003 0000           	dc.w 3,0
(1) 1252/  FF1D6C :                     
(1) 1253/  FF1D6C :                     ; 	dc.l GemaPat_Test3,GemaBlk_Test3,GemaIns_Test3
(1) 1254/  FF1D6C :                     ; 	dc.w 2,%001
(1) 1255/  FF1D6C :                     
(1) 1256/  FF1D6C :                     ; 	dc.w
(1) 1257/  FF1D6C :                     ; 	dc.l GemaPat_Test,GemaBlk_Test,GemaIns_Test
(1) 1258/  FF1D6C :                     ; 	dc.w 6,%001
(1) 1259/  FF1D6C :                     
(1) 1260/  FF1D6C :                     
(1) 1261/  FF1D6C :                     
(1) 1262/  FF1D6C :                     	align 2
(1) 1263/  FF1D6C :                     
(1) 1264/  FF1D6C :                     ; ====================================================================
(1) 1265/  FF1D6C :                     ; ------------------------------------------------------
(1) 1266/  FF1D6C :                     ; Subroutines
(1) 1267/  FF1D6C :                     ; ------------------------------------------------------
(1) 1268/  FF1D6C :                     
(1) 1269/  FF1D6C :                     SuperSprite_Test_init:
(1) 1270/  FF1D6C : 41F8 AF78           		lea	(RAM_MdDreq+Dreq_SuperSpr),a0
(1) 1271/  FF1D70 : 203C 0215 367C      		move.l	#SuperSpr_Test,d0
(1) 1272/  FF1D76 : 2200                		move.l	d0,d1
(1) 1273/  FF1D78 : 82BC 2000 0000      		or.l	#TH,d1
(1) 1274/  FF1D7E : 2141 0010           		move.l	d1,marsspr_data(a0)
(1) 1275/  FF1D82 : 317C 0040 0008      		move.w	#64,marsspr_dwidth(a0)
(1) 1276/  FF1D88 : 317C 00B0 0004      		move.w	#$B0,marsspr_x(a0)
(1) 1277/  FF1D8E : 317C 0060 0006      		move.w	#$60,marsspr_y(a0)
(1) 1278/  FF1D94 : 117C 0020 0002      		move.b	#32,marsspr_xs(a0)
(1) 1279/  FF1D9A : 117C 0030 0003      		move.b	#48,marsspr_ys(a0)
(1) 1280/  FF1DA0 : 317C 0080 000A      		move.w	#$80,marsspr_indx(a0)
(1) 1281/  FF1DA6 : 203C 0215 367C      		move.l	#SuperSpr_Test,d0
(1) 1282/  FF1DAC : 2200                		move.l	d0,d1
(1) 1283/  FF1DAE : 82BC 2000 0000      		or.l	#TH,d1
(1) 1284/  FF1DB4 : D0FC 0018           		adda	#sizeof_marsspr,a0
(1) 1285/  FF1DB8 : 2141 0010           		move.l	d1,marsspr_data(a0)
(1) 1286/  FF1DBC : 317C 0040 0008      		move.w	#64,marsspr_dwidth(a0)
(1) 1287/  FF1DC2 : 317C 0060 0004      		move.w	#$60,marsspr_x(a0)
(1) 1288/  FF1DC8 : 317C 0050 0006      		move.w	#$50,marsspr_y(a0)
(1) 1289/  FF1DCE : 117C 0020 0002      		move.b	#32,marsspr_xs(a0)
(1) 1290/  FF1DD4 : 117C 0030 0003      		move.b	#48,marsspr_ys(a0)
(1) 1291/  FF1DDA : 317C 0080 000A      		move.w	#$80,marsspr_indx(a0)
(1) 1292/  FF1DE0 : D0FC 0018           		adda	#sizeof_marsspr,a0
(1) 1293/  FF1DE4 : 217C 0000 0000 0010 		move.l	#0,marsspr_data(a0)
(1) 1294/  FF1DEC :                     
(1) 1295/  FF1DEC :                     SuperSprite_Test:
(1) 1296/  FF1DEC :                     	; SUPER SPRITE MOVE
(1) 1297/  FF1DEC : 41F8 AF78           		lea	(RAM_MdDreq+Dreq_SuperSpr),a0
(1) 1298/  FF1DF0 : 0478 0001 9036      		sub.w	#1,(RAM_SprTimer).w
(1) 1299/  FF1DF6 : 6A26                		bpl.s	.wspr
(1) 1300/  FF1DF8 : 31FC 000E 9036      		move.w	#14,(RAM_SprTimer).w
(1) 1301/  FF1DFE :                     
(1) 1302/  FF1DFE : 1010                		move.b	marsspr_xfrm(a0),d0
(1) 1303/  FF1E00 : D07C 0001           		add.w	#1,d0
(1) 1304/  FF1E04 : C07C 0001           		and.w	#1,d0
(1) 1305/  FF1E08 : 1080                		move.b	d0,marsspr_xfrm(a0)
(1) 1306/  FF1E0A : D0FC 0018           		adda	#sizeof_marsspr,a0
(1) 1307/  FF1E0E : 1028 0001           		move.b	marsspr_yfrm(a0),d0
(1) 1308/  FF1E12 : D07C 0001           		add.w	#1,d0
(1) 1309/  FF1E16 : C07C 0003           		and.w	#%11,d0
(1) 1310/  FF1E1A : 1140 0001           		move.b	d0,marsspr_yfrm(a0)
(1) 1311/  FF1E1E :                     .wspr:
(1) 1312/  FF1E1E : 3E38 A706           		move.w	(Controller_1+on_press),d7
(1) 1313/  FF1E22 : 0807 000A           		btst	#bitJoyX,d7
(1) 1314/  FF1E26 : 6710                		beq	.not_hold3
(1) 1315/  FF1E28 : 41F8 AF78           		lea	(RAM_MdDreq+Dreq_SuperSpr),a0
(1) 1316/  FF1E2C : 0668 0001 000C      		add.w	#1,marsspr_flags(a0)
(1) 1317/  FF1E32 : 0268 0003 000C      		and.w	#%11,marsspr_flags(a0)
(1) 1318/  FF1E38 :                     .not_hold3:
(1) 1319/  FF1E38 : 3E38 A706           		move.w	(Controller_1+on_press),d7
(1) 1320/  FF1E3C : 0807 0009           		btst	#bitJoyY,d7
(1) 1321/  FF1E40 : 6710                		beq	.not_hold4
(1) 1322/  FF1E42 : 41F8 AF78           		lea	(RAM_MdDreq+Dreq_SuperSpr),a0
(1) 1323/  FF1E46 : 0628 0001 0001      		add.b	#1,marsspr_yfrm(a0)
(1) 1324/  FF1E4C : 0228 0003 0001      		and.b	#%11,marsspr_yfrm(a0)
(1) 1325/  FF1E52 :                     .not_hold4:
(1) 1326/  FF1E52 :                     
(1) 1327/  FF1E52 : 3E38 A704           		move.w	(Controller_1+on_hold),d7
(1) 1328/  FF1E56 : 0807 0004           		btst	#bitJoyB,d7
(1) 1329/  FF1E5A : 673C                		beq	.not_hold2
(1) 1330/  FF1E5C : 41F8 AF78           		lea	(RAM_MdDreq+Dreq_SuperSpr),a0
(1) 1331/  FF1E60 : 3028 0004           		move.w	marsspr_x(a0),d0
(1) 1332/  FF1E64 : 3228 0006           		move.w	marsspr_y(a0),d1
(1) 1333/  FF1E68 : 7402                		moveq	#TEST_SPRSPD,d2
(1) 1334/  FF1E6A : 7602                		moveq	#TEST_SPRSPD,d3
(1) 1335/  FF1E6C : 3E38 A704           		move.w	(Controller_1+on_hold),d7
(1) 1336/  FF1E70 : 0807 0003           		btst	#bitJoyRight,d7
(1) 1337/  FF1E74 : 6702                		beq.s	.nor_s
(1) 1338/  FF1E76 : D042                		add.w	d2,d0
(1) 1339/  FF1E78 :                     .nor_s:
(1) 1340/  FF1E78 : 0807 0002           		btst	#bitJoyLeft,d7
(1) 1341/  FF1E7C : 6702                		beq.s	.nol_s
(1) 1342/  FF1E7E : 9042                		sub.w	d2,d0
(1) 1343/  FF1E80 :                     .nol_s:
(1) 1344/  FF1E80 : 0807 0001           		btst	#bitJoyDown,d7
(1) 1345/  FF1E84 : 6702                		beq.s	.nod_s
(1) 1346/  FF1E86 : D243                		add.w	d3,d1
(1) 1347/  FF1E88 :                     .nod_s:
(1) 1348/  FF1E88 : 0807 0000           		btst	#bitJoyUp,d7
(1) 1349/  FF1E8C : 6702                		beq.s	.nou_s
(1) 1350/  FF1E8E : 9243                		sub.w	d3,d1
(1) 1351/  FF1E90 :                     .nou_s:
(1) 1352/  FF1E90 : 3140 0004           		move.w	d0,marsspr_x(a0)
(1) 1353/  FF1E94 : 3141 0006           		move.w	d1,marsspr_y(a0)
(1) 1354/  FF1E98 :                     .not_hold2:
(1) 1355/  FF1E98 :                     
(1) 1356/  FF1E98 : 3E38 A704           		move.w	(Controller_1+on_hold),d7
(1) 1357/  FF1E9C : 0807 0006           		btst	#bitJoyA,d7
(1) 1358/  FF1EA0 : 673C                		beq.s	.not_hold
(1) 1359/  FF1EA2 : 41F8 AF78           		lea	(RAM_MdDreq+Dreq_SuperSpr),a0
(1) 1360/  FF1EA6 : 3028 0002           		move.w	marsspr_xs(a0),d0
(1) 1361/  FF1EAA : 3228 0003           		move.w	marsspr_ys(a0),d1
(1) 1362/  FF1EAE : 7402                		moveq	#TEST_SPRSPD,d2
(1) 1363/  FF1EB0 : 7602                		moveq	#TEST_SPRSPD,d3
(1) 1364/  FF1EB2 : 3E38 A704           		move.w	(Controller_1+on_hold),d7
(1) 1365/  FF1EB6 : 0807 0003           		btst	#bitJoyRight,d7
(1) 1366/  FF1EBA : 6702                		beq.s	.nor_s2
(1) 1367/  FF1EBC : D042                		add.w	d2,d0
(1) 1368/  FF1EBE :                     .nor_s2:
(1) 1369/  FF1EBE : 0807 0002           		btst	#bitJoyLeft,d7
(1) 1370/  FF1EC2 : 6702                		beq.s	.nol_s2
(1) 1371/  FF1EC4 : 9042                		sub.w	d2,d0
(1) 1372/  FF1EC6 :                     .nol_s2:
(1) 1373/  FF1EC6 : 0807 0001           		btst	#bitJoyDown,d7
(1) 1374/  FF1ECA : 6702                		beq.s	.nod_s2
(1) 1375/  FF1ECC : D243                		add.w	d3,d1
(1) 1376/  FF1ECE :                     .nod_s2:
(1) 1377/  FF1ECE : 0807 0000           		btst	#bitJoyUp,d7
(1) 1378/  FF1ED2 : 6702                		beq.s	.nou_s2
(1) 1379/  FF1ED4 : 9243                		sub.w	d3,d1
(1) 1380/  FF1ED6 :                     .nou_s2:
(1) 1381/  FF1ED6 : 3140 0002           		move.w	d0,marsspr_xs(a0)
(1) 1382/  FF1EDA : 3141 0003           		move.w	d1,marsspr_ys(a0)
(1) 1383/  FF1EDE :                     .not_hold:
(1) 1384/  FF1EDE :                     
(1) 1385/  FF1EDE : 0678 0001 9038      		add.w	#1,(RAM_SprFrame).w
(1) 1386/  FF1EE4 : 4E75                		rts
(1) 1387/  FF1EE6 :                     
(1) 1388/  FF1EE6 :                     ; ====================================================================
(1) 1389/  FF1EE6 :                     ; ------------------------------------------------------
(1) 1390/  FF1EE6 :                     ; VBlank
(1) 1391/  FF1EE6 :                     ; ------------------------------------------------------
(1) 1392/  FF1EE6 :                     
(1) 1393/  FF1EE6 :                     ; ------------------------------------------------------
(1) 1394/  FF1EE6 :                     ; HBlank
(1) 1395/  FF1EE6 :                     ; ------------------------------------------------------
(1) 1396/  FF1EE6 :                     
(1) 1397/  FF1EE6 :                     ; ====================================================================
(1) 1398/  FF1EE6 :                     ; ------------------------------------------------------
(1) 1399/  FF1EE6 :                     ; DATA
(1) 1400/  FF1EE6 :                     ;
(1) 1401/  FF1EE6 :                     ; Small stuff goes here
(1) 1402/  FF1EE6 :                     ; ------------------------------------------------------
(1) 1403/  FF1EE6 :                     
(1) 1404/  FF1EE6 : 200A                str_Cursor:	dc.b " ",$A
(1) 1405/  FF1EE8 : 3E0A                		dc.b ">",$A
(1) 1406/  FF1EEA : 2000                		dc.b " ",0
(1) 1407/  FF1EEC :                     		align 2
(1) 1408/  FF1EEC :                     str_Title:
(1) 1409/  FF1EEC : 5072 6F6A 6563 7420 		dc.b "Project MARSIANO tester",$A
                    4D41 5253 4941 4E4F 
                    2074 6573 7465 720A 
(1) 1410/  FF1F04 : 0A                  		dc.b $A
(1) 1411/  FF1F05 : 2020 5363 7265 656E 		dc.b "  Screen 00 BLANK",$A
                    2030 3020 424C 414E 
                    4B0A                
(1) 1412/  FF1F17 : 2020 5363 7265 656E 		dc.b "  Screen 01 256-SuperSprites w/scale",$A
                    2030 3120 3235 362D 
                    5375 7065 7253 7072 
                    6974 6573 2077 2F73 
                    6361 6C65 0A        
(1) 1413/  FF1F3C : 2020 5363 7265 656E 		dc.b "  Screen 02 256-Scroll+SuperSprites",$A
                    2030 3220 3235 362D 
                    5363 726F 6C6C 2B53 
                    7570 6572 5370 7269 
                    7465 730A           
(1) 1414/  FF1F60 : 2020 5363 7265 656E 		dc.b "  Screen 03 3D objects",$A
                    2030 3320 3344 206F 
                    626A 6563 7473 0A   
(1) 1415/  FF1F77 : 2020 4745 4D41 2073 		dc.b "  GEMA sound test",0
                    6F75 6E64 2074 6573 
                    7400                
(1) 1416/  FF1F89 :                     		align 2
(1) 1417/  FF1F8A :                     
(1) 1418/  FF1F8A :                     ; str_Page1:
(1) 1419/  FF1F8A :                     ; 		dc.b "Testing GfxMode 01",0
(1) 1420/  FF1F8A :                     ; 		align 2
(1) 1421/  FF1F8A :                     ; str_Page1_l:
(1) 1422/  FF1F8A :                     ; 		dc.b "\\l \\l",0
(1) 1423/  FF1F8A :                     ; 		dc.l RAM_MdDreq+scrlbg_X
(1) 1424/  FF1F8A :                     ; 		dc.l RAM_MdDreq+scrlbg_Y
(1) 1425/  FF1F8A :                     ; 		align 2
(1) 1426/  FF1F8A :                     
(1) 1427/  FF1F8A :                     str_Page1:
(1) 1428/  FF1F8A : 4766 784D 6F64 6520 		dc.b "GfxMode 00 - BLANK",$A
                    3030 202D 2042 4C41 
                    4E4B 0A             
(1) 1429/  FF1F9D : 0A                  		dc.b $A
(1) 1430/  FF1F9E : 5465 7374 696E 6720 		dc.b "Testing MD's H32 resolution",0
                    4D44 2773 2048 3332 
                    2072 6573 6F6C 7574 
                    696F 6E00           
(1) 1431/  FF1FBA :                     		align 2
(1) 1432/  FF1FBA :                     str_Page2:
(1) 1433/  FF1FBA : 4766 784D 6F64 6520 		dc.b "GfxMode 01 - Super Sprites only",0
                    3031 202D 2053 7570 
                    6572 2053 7072 6974 
                    6573 206F 6E6C 7900 
(1) 1434/  FF1FDA :                     		align 2
(1) 1435/  FF1FDA :                     
(1) 1436/  FF1FDA :                     str_Page3_bg:
(1) 1437/  FF1FDA : 2A2A 2A20 4766 784D 		dc.b "*** GfxMode 02, LAYER B ***",0
                    6F64 6520 3032 2C20 
                    4C41 5945 5220 4220 
                    2A2A 2A00           
(1) 1438/  FF1FF6 :                     		align 2
(1) 1439/  FF1FF6 :                     str_Page3:
(1) 1440/  FF1FF6 : 2A2A 2A20 4766 784D 		dc.b "*** GfxMode 02, LAYER A ***",0;$A,$A
                    6F64 6520 3032 2C20 
                    4C41 5945 5220 4120 
                    2A2A 2A00           
(1) 1441/  FF2012 :                     ; 		dc.b "X/Y: \\l \\l",0
(1) 1442/  FF2012 :                     ; 		dc.l RAM_MdDreq+Dreq_ScrnBuff+scrlbg_X
(1) 1443/  FF2012 :                     ; 		dc.l RAM_MdDreq+Dreq_ScrnBuff+scrlbg_Y
(1) 1444/  FF2012 :                     		align 2
(1) 1445/  FF2012 :                     str_Page4:
(1) 1446/  FF2012 : 4766 784D 6F64 6520 		dc.b "GfxMode 03",0
                    3033 00             
(1) 1447/  FF201D :                     		align 2
(1) 1448/  FF201E :                     str_Page1_info:
(1) 1449/  FF201E : 5C77 205C 7700      		dc.b "\\w \\w",0
(1) 1450/  FF2024 : FFFF 900E FFFF 9010 		dc.l RAM_Scrn0_Frame,RAM_Scrn0_Timer
(1) 1451/  FF202C :                     		align 2
(1) 1452/  FF202C :                     
(1) 1453/  FF202C :                     str_Status:
(1) 1454/  FF202C : 5C77 0A0A           		dc.b "\\w",$A,$A
(1) 1455/  FF2030 : 5C77 0A0A 0A        		dc.b "\\w",$A,$A,$A
(1) 1456/  FF2035 : 5C77 0A             		dc.b "\\w",$A
(1) 1457/  FF2038 : 5C77 00             		dc.b "\\w",0
(1) 1458/  FF203B : FFFF 9006           		dc.l RAM_CurrIndx
(1) 1459/  FF203F : FFFF 9008           		dc.l RAM_CurrTrack
(1) 1460/  FF2043 : FFFF 900A           		dc.l RAM_CurrTicks
(1) 1461/  FF2047 : FFFF 900C           		dc.l RAM_CurrTempo
(1) 1462/  FF204B :                     		align 2
(1) 1463/  FF204C :                     str_Gema:
(1) 1464/  FF204C : 4745 4D41 2053 4F55 		dc.b "GEMA SOUND DRIVER MD+32X",$A
                    4E44 2044 5249 5645 
                    5220 4D44 2B33 3258 
                    0A                  
(1) 1465/  FF2065 : 0A                  		dc.b $A
(1) 1466/  FF2066 : 5472 6163 6B20 696E 		dc.b "Track index -----",$A,$A
                    6465 7820 2D2D 2D2D 
                    2D0A 0A             
(1) 1467/  FF2079 : 2020 536F 756E 645F 		dc.b "  Sound_TrkPlay",$A
                    5472 6B50 6C61 790A 
(1) 1468/  FF2089 : 2020 536F 756E 645F 		dc.b "  Sound_TrkStop",$A
                    5472 6B53 746F 700A 
(1) 1469/  FF2099 : 2020 536F 756E 645F 		dc.b "  Sound_TrkResume",$A
                    5472 6B52 6573 756D 
                    650A                
(1) 1470/  FF20AB : 2020 536F 756E 645F 		dc.b "  Sound_TrkTicks",$A
                    5472 6B54 6963 6B73 
                    0A                  
(1) 1471/  FF20BC : 2020 536F 756E 645F 		dc.b "  Sound_GlbBeats",0
                    476C 6242 6561 7473 
                    00                  
(1) 1472/  FF20CD :                     		align 2
(1) 1473/  FF20CE :                     str_GemaStatus:
(1) 1474/  FF20CE : 2020 2020 202A 2A2A 		dc.b "     *** Channel freqs ***",$A
                    2043 6861 6E6E 656C 
                    2066 7265 7173 202A 
                    2A2A 0A             
(1) 1475/  FF20E9 : 0A                  		dc.b $A
(1) 1476/  FF20EA : 5053 4731 2020 2020 		dc.b "PSG1       FM1       PWM1     ",$A,$A
                    2020 2046 4D31 2020 
                    2020 2020 2050 574D 
                    3120 2020 2020 0A0A 
(1) 1477/  FF210A : 5053 4732 2020 2020 		dc.b "PSG2       FM2       PWM2     ",$A,$A
                    2020 2046 4D32 2020 
                    2020 2020 2050 574D 
                    3220 2020 2020 0A0A 
(1) 1478/  FF212A : 5053 4733 2020 2020 		dc.b "PSG3       FM3       PWM3     ",$A,$A
                    2020 2046 4D33 2020 
                    2020 2020 2050 574D 
                    3320 2020 2020 0A0A 
(1) 1479/  FF214A : 5048 4154 2020 2020 		dc.b "PHAT       FM4       PWM4     ",$A,$A
                    2020 2046 4D34 2020 
                    2020 2020 2050 574D 
                    3420 2020 2020 0A0A 
(1) 1480/  FF216A : 2020 2020 2020 2020 		dc.b "           FM5       PWM5     ",$A,$A
                    2020 2046 4D35 2020 
                    2020 2020 2050 574D 
                    3520 2020 2020 0A0A 
(1) 1481/  FF218A : 2020 2020 2020 2020 		dc.b "           FM6       PWM6     ",$A,$A
                    2020 2046 4D36 2020 
                    2020 2020 2050 574D 
                    3620 2020 2020 0A0A 
(1) 1482/  FF21AA : 2020 2020 2020 2020 		dc.b "                     PWM7     ",0
                    2020 2020 2020 2020 
                    2020 2020 2050 574D 
                    3720 2020 2020 00   
(1) 1483/  FF21C9 :                     		align 2
(1) 1484/  FF21CA :                     str_GemaPsg:
(1) 1485/  FF21CA : 5C77 0A0A           		dc.b "\\w",$A,$A
(1) 1486/  FF21CE : 5C77 0A0A           		dc.b "\\w",$A,$A
(1) 1487/  FF21D2 : 5C77 0A0A           		dc.b "\\w",$A,$A
(1) 1488/  FF21D6 : 5C77 00             		dc.b "\\w",0
(1) 1489/  FF21D9 : FFFF 9014           		dc.l RAM_GemaList
(1) 1490/  FF21DD : FFFF 9016           		dc.l RAM_GemaList+2
(1) 1491/  FF21E1 : FFFF 9018           		dc.l RAM_GemaList+4
(1) 1492/  FF21E5 : FFFF 901A           		dc.l RAM_GemaList+6
(1) 1493/  FF21E9 :                     		align 2
(1) 1494/  FF21EA :                     str_GemaFm:
(1) 1495/  FF21EA : 5C77 0A0A           		dc.b "\\w",$A,$A
(1) 1496/  FF21EE : 5C77 0A0A           		dc.b "\\w",$A,$A
(1) 1497/  FF21F2 : 5C77 0A0A           		dc.b "\\w",$A,$A
(1) 1498/  FF21F6 : 5C77 0A0A           		dc.b "\\w",$A,$A
(1) 1499/  FF21FA : 5C77 0A0A           		dc.b "\\w",$A,$A
(1) 1500/  FF21FE : 5C77 00             		dc.b "\\w",0
(1) 1501/  FF2201 : FFFF 901C           		dc.l RAM_GemaListFM
(1) 1502/  FF2205 : FFFF 901E           		dc.l RAM_GemaListFM+2
(1) 1503/  FF2209 : FFFF 9020           		dc.l RAM_GemaListFM+4
(1) 1504/  FF220D : FFFF 9022           		dc.l RAM_GemaListFM+6
(1) 1505/  FF2211 : FFFF 9024           		dc.l RAM_GemaListFM+8
(1) 1506/  FF2215 : FFFF 9026           		dc.l RAM_GemaListFM+10
(1) 1507/  FF2219 :                     		align 2
(1) 1508/  FF221A :                     str_GemaPwm:
(1) 1509/  FF221A : 5C77 0A0A           		dc.b "\\w",$A,$A
(1) 1510/  FF221E : 5C77 0A0A           		dc.b "\\w",$A,$A
(1) 1511/  FF2222 : 5C77 0A0A           		dc.b "\\w",$A,$A
(1) 1512/  FF2226 : 5C77 0A0A           		dc.b "\\w",$A,$A
(1) 1513/  FF222A : 5C77 0A0A           		dc.b "\\w",$A,$A
(1) 1514/  FF222E : 5C77 0A0A           		dc.b "\\w",$A,$A
(1) 1515/  FF2232 : 5C77 00             		dc.b "\\w",0
(1) 1516/  FF2235 : FFFF 9028           		dc.l RAM_GemaListPWM
(1) 1517/  FF2239 : FFFF 902A           		dc.l RAM_GemaListPWM+2
(1) 1518/  FF223D : FFFF 902C           		dc.l RAM_GemaListPWM+4
(1) 1519/  FF2241 : FFFF 902E           		dc.l RAM_GemaListPWM+6
(1) 1520/  FF2245 : FFFF 9030           		dc.l RAM_GemaListPWM+8
(1) 1521/  FF2249 : FFFF 9032           		dc.l RAM_GemaListPWM+10
(1) 1522/  FF224D : FFFF 9034           		dc.l RAM_GemaListPWM+12
(1) 1523/  FF2251 :                     		align 2
(1) 1524/  FF2252 :                     
(1) 1525/  FF2252 :                     str_Stats:
(1) 1526/  FF2252 : 5C77 205C 7720 5C77 		dc.b "\\w \\w \\w \\w",$A
                    205C 770A           
(1) 1527/  FF225E : 5C77 205C 7720 5C77 		dc.b "\\w \\w \\w \\w",$A,$A
                    205C 770A 0A        
(1) 1528/  FF226B : 5C6C 00             		dc.b "\\l",0
(1) 1529/  FF226E : 00A1 5120           		dc.l sysmars_reg+comm0
(1) 1530/  FF2272 : 00A1 5122           		dc.l sysmars_reg+comm2
(1) 1531/  FF2276 : 00A1 5124           		dc.l sysmars_reg+comm4
(1) 1532/  FF227A : 00A1 5126           		dc.l sysmars_reg+comm6
(1) 1533/  FF227E : 00A1 5128           		dc.l sysmars_reg+comm8
(1) 1534/  FF2282 : 00A1 512A           		dc.l sysmars_reg+comm10
(1) 1535/  FF2286 : 00A1 512C           		dc.l sysmars_reg+comm12
(1) 1536/  FF228A : 00A1 512E           		dc.l sysmars_reg+comm14
(1) 1537/  FF228E : FFFF 9900           		dc.l RAM_Framecount
(1) 1538/  FF2292 :                     		align 2
(1) 1539/  FF2292 :                     
(1) 1540/  FF2292 :                     ; str_StatsPage4:
(1) 1541/  FF2292 :                     ; 		dc.b "\\l \\l \\l",0
(1) 1542/  FF2292 :                     ; 		dc.l RAM_MdDreq+Dreq_Objects+mdl_x_pos
(1) 1543/  FF2292 :                     ; 		dc.l RAM_MdDreq+Dreq_Objects+mdl_y_pos
(1) 1544/  FF2292 :                     ; 		dc.l RAM_MdDreq+Dreq_Objects+mdl_z_pos
(1) 1545/  FF2292 :                     ; 		align 2
(1) 1546/  FF2292 :                     
(1) 1547/  FF2292 :                     ; str_InfoMouse:
(1) 1548/  FF2292 :                     ; 		dc.b "comm0: \\w",$A
(1) 1549/  FF2292 :                     ; 		dc.b "comm12: \\w comm14: \\w",$A,$A
(1) 1550/  FF2292 :                     ; ; 		dc.b "MD Framecount: \\l",$A
(1) 1551/  FF2292 :                     ; 		dc.b "\\l \\l",$A
(1) 1552/  FF2292 :                     ; 		dc.b "\\l \\l",0
(1) 1553/  FF2292 :                     ; 		dc.l sysmars_reg+comm0
(1) 1554/  FF2292 :                     ; 		dc.l sysmars_reg+comm12
(1) 1555/  FF2292 :                     ; 		dc.l sysmars_reg+comm14
(1) 1556/  FF2292 :                     ; ; 		dc.l RAM_Framecount
(1) 1557/  FF2292 :                     ; 		dc.l RAM_MdDreq+Dreq_SclX
(1) 1558/  FF2292 :                     ; 		dc.l RAM_MdDreq+Dreq_SclY
(1) 1559/  FF2292 :                     ; 		dc.l RAM_MdDreq+Dreq_SclDX
(1) 1560/  FF2292 :                     ; 		dc.l RAM_MdDreq+Dreq_SclDY
(1) 1561/  FF2292 :                     ;
(1) 1562/  FF2292 :                     ; ; 		dc.l RAM_MdDreq+Dreq_Objects+mdl_x_pos
(1) 1563/  FF2292 :                     ; ; 		dc.l RAM_MdDreq+Dreq_Objects+mdl_y_pos
(1) 1564/  FF2292 :                     ; ; 		dc.l RAM_MdDreq+Dreq_Objects+mdl_z_pos
(1) 1565/  FF2292 :                     ; 		align 2
(1) 1566/  FF2292 :                     
(1) 1567/  FF2292 :                     ; PAL_TESTBOARD:
(1) 1568/  FF2292 :                     ; 		binclude "data/md/bg/bg_pal.bin"
(1) 1569/  FF2292 :                     ; 		binclude "data/md/bg/fg_pal.bin"
(1) 1570/  FF2292 :                     ; 		align 2
(1) 1571/  FF2292 :                     ; PAL_BG:
(1) 1572/  FF2292 :                     ; 		binclude "data/md/bg/bg_pal.bin"
(1) 1573/  FF2292 :                     ; 		align 2
(1) 1574/  FF2292 :                     
(1) 1575/  FF2292 :                     ; Map_Nicole:
(1) 1576/  FF2292 :                     ; 		include "data/md/sprites/emi_map.asm"
(1) 1577/  FF2292 :                     ; 		align 2
(1) 1578/  FF2292 :                     ; Dplc_Nicole:
(1) 1579/  FF2292 :                     ; 		include "data/md/sprites/emi_plc.asm"
(1) 1580/  FF2292 :                     ; 		align 2
(1) 1581/  FF2292 :                     
(1) 1582/  FF2292 :                     ; ====================================================================
(1) 1583/  FF2292 :                     
(1) 1584/  FF2292 :                     .here:
(1) 1588/    875E :                     		dephase
(1) 1589/    875E :                     
      74/    875E :                     
      75/    875E :                     ; ====================================================================
      76/    875E :                     ; --------------------------------------------------------
      77/    875E :                     ; Stuff stored on the 880000+ ROM area
      78/    875E :                     ; --------------------------------------------------------
      79/    875E :                     
      80/    875E :                     		align 4
      81/  888760 :                     		phase $880000+*
      82/  888760 :                     Z80_CODE:	include "system/md/z_driver.asm"	; Called once
(1)    1/  888760 :                     ; --------------------------------------------------------
(1)    2/  888760 :                     ; GEMA sound driver
(1)    3/  888760 :                     ;
(1)    4/  888760 :                     ; Reads custom miniature versions of Impulsetracker
(1)    5/  888760 :                     ; files, has automatic detection of soundchips for each
(1)    6/  888760 :                     ; instrument it uses.
(1)    7/  888760 :                     ;
(1)    8/  888760 :                     ; Features:
(1)    9/  888760 :                     ; - Support for 32X but needs specific sound driver code
(1)   10/  888760 :                     ; on the SH2 side, and requires the CMD interrupt.
(1)   11/  888760 :                     ; - All 10 FM+PSG channels can be used, 7 PWMs
(1)   12/  888760 :                     ; - Two playable track slots: BGM(0) and SFX(1)
(1)   13/  888760 :                     ;   Slot 1 can either overwrite chip channels or
(1)   14/  888760 :                     ;   if possible grab unused slots
(1)   15/  888760 :                     ; - Supports FM/PSG effects
(1)   16/  888760 :                     ;
(1)   17/  888760 :                     ; ...TODO...
(1)   18/  888760 :                     ; --------------------------------------------------------
(1)   19/  888760 :                     
(1)   20/  888760 :                     ; NOTE: DAC sample playback has to be sync'd manually
(1)   21/  888760 :                     ; on every code change.
(1)   22/  888760 :                     ; Sample rate is at the 18000hz+ range
(1)   23/  888760 :                     
(1)   24/  888760 :                     Z80_TOP:
(1)   25/  888760 :                     		cpu Z80			; Enter Z80
(1)   26/       0 :                     		phase 0			; And set PC to 0
(1)   27/       0 :                     
(1)   28/       0 :                     ; --------------------------------------------------------
(1)   29/       0 :                     ; User settings
(1)   30/       0 :                     ; --------------------------------------------------------
(1)   31/       0 :                     
(1)   32/       0 : =11H                MAX_TRKCHN	equ 17		; Max internal tracker channels (4PSG + 6FM + 7PWM)
(1)   33/       0 : =FFFFFFFFFFF..      ZSET_WTUNE	equ -25		; Manual frequency adjustment for DAC WAVE playback
(1)   34/       0 : =0H                 ZSET_TESTME	equ 0		; Set to 1 to "hear"-test the DAC playback
(1)   35/       0 : =10H                MAX_INS		equ 16		; Max usable instruments for EACH track slot
(1)   36/       0 :                     
(1)   37/       0 :                     ; --------------------------------------------------------
(1)   38/       0 :                     ; Structs
(1)   39/       0 :                     ; --------------------------------------------------------
(1)   40/       0 :                     
(1)   41/       0 :                     ; NOTE: struct doesn't work here, use equs instead.
(1)   42/       0 :                     
(1)   43/       0 :                     ; trkBuff struct
(1)   44/       0 :                     ; LIMIT: 20h (32) bytes
(1)   45/       0 : =0H                 trk_romBlk	equ 00h	; 24-bit base block data
(1)   46/       0 : =3H                 trk_romPatt	equ 03h	; 24-bit base patt data
(1)   47/       0 : =6H                 trk_romIns	equ 06h	; 24-bit ROM instrument pointers
(1)   48/       0 : =9H                 trk_romPattRd	equ 09h	; same but for reading
(1)   49/       0 : =CH                 trk_Read	equ 0Ch	; Current track position (in our storage)
(1)   50/       0 : =EH                 trk_Rows	equ 0Eh	; Current track length
(1)   51/       0 : =10H                trk_Halfway	equ 10h	; Only 00h or 80h
(1)   52/       0 : =11H                trk_currBlk	equ 11h	; Current block
(1)   53/       0 : =12H                trk_setBlk	equ 12h	; Start on this block
(1)   54/       0 : =13H                trk_status	equ 13h	; %ERPB Sxxx | E-enabled / R-Init|Restart track / P-refill-on-playback / B-use global beats / S-silence
(1)   55/       0 : =14H                trk_tickTmr	equ 14h	; Ticks timer
(1)   56/       0 : =15H                trk_tickSet	equ 15h	; Ticks set for this track
(1)   57/       0 : =16H                trk_sizeIns	equ 16h	; Max instrument storage
(1)   58/       0 : =17H                trk_rowPause	equ 17h	; Row pause timer
(1)   59/       0 : =18H                trk_CachNotes	equ 18h	; Pointer to track storage (100h bytes long and aligned)
(1)   60/       0 : =1AH                trk_CmdReq	equ 1Ah	; Track command requests
(1)   61/       0 :                     
(1)   62/       0 :                     ; Tracker channel data, 8 bytes each.
(1)   63/       0 : =0H                 chnl_Chip	equ 0		; *** MUST BE AT 0 ***
(1)   64/       0 : =1H                 chnl_Flags	equ 1		; playback requests and other specific bits
(1)   65/       0 : =2H                 chnl_Note	equ 2
(1)   66/       0 : =3H                 chnl_Ins	equ 3
(1)   67/       0 : =4H                 chnl_Vol	equ 4
(1)   68/       0 : =5H                 chnl_EffId	equ 5
(1)   69/       0 : =6H                 chnl_EffArg	equ 6
(1)   70/       0 : =7H                 chnl_Type	equ 7		; Impulse-note bits
(1)   71/       0 :                     
(1)   72/       0 :                     ; --------------------------------------------------------
(1)   73/       0 :                     ; Variables
(1)   74/       0 :                     ; --------------------------------------------------------
(1)   75/       0 :                     
(1)   76/       0 :                     ; To brute force DAC playback
(1)   77/       0 :                     ; on or off
(1)   78/       0 : =0H                 zopcNop		equ	00h
(1)   79/       0 : =8H                 zopcEx		equ	08h
(1)   80/       0 : =C9H                zopcRet		equ 	0C9h
(1)   81/       0 : =D9H                zopcExx		equ	0D9h		; (dac_me ONLY)
(1)   82/       0 : =F5H                zopcPushAf	equ	0F5h		; (dac_fill ONLY)
(1)   83/       0 :                     
(1)   84/       0 :                     ; PSG external control
(1)   85/       0 : =0H                 COM		equ	0
(1)   86/       0 : =4H                 LEV		equ	4
(1)   87/       0 : =8H                 ATK		equ	8
(1)   88/       0 : =CH                 DKY		equ	12
(1)   89/       0 : =10H                SLV		equ	16
(1)   90/       0 : =14H                RRT		equ	20
(1)   91/       0 : =18H                MODE		equ	24
(1)   92/       0 : =1CH                DTL		equ	28
(1)   93/       0 : =20H                DTH		equ	32
(1)   94/       0 : =24H                ALV		equ	36
(1)   95/       0 : =28H                FLG		equ	40
(1)   96/       0 : =2CH                TMR		equ	44
(1)   97/       0 : =30H                PVOL		equ	48
(1)   98/       0 :                     
(1)   99/       0 :                     ; FMCOM		equ	0
(1)  100/       0 : =6H                 FMKEYS		equ	6
(1)  101/       0 : =CH                 FMVOL		equ	12
(1)  102/       0 : =12H                FMPAN 		equ	18
(1)  103/       0 : =18H                FMFRQH		equ	24
(1)  104/       0 : =1EH                FMFRQL		equ	30
(1)  105/       0 :                     
(1)  106/       0 : =0H                 PWCOM		equ	0
(1)  107/       0 : =8H                 PWPTH_V		equ	8	; Volume | Pitch MSB (%VVVVVVPP)
(1)  108/       0 : =10H                PWPHL		equ	16	; Pitch LSB
(1)  109/       0 : =18H                PWOUTF		equ	24	; Output mode/bits + SH2 section (ROM $02 or SDRAM $06)
(1)  110/       0 : =20H                PWINSH		equ	32	; 24-bit sample address
(1)  111/       0 : =28H                PWINSM		equ	40
(1)  112/       0 : =30H                PWINSL		equ	48
(1)  113/       0 :                     
(1)  114/       0 :                     ; ====================================================================
(1)  115/       0 :                     ; --------------------------------------------------------
(1)  116/       0 :                     ; Code starts here
(1)  117/       0 :                     ; --------------------------------------------------------
(1)  118/       0 :                     
(1)  119/       0 : F3                  		di			; Disable interrputs
(1)  120/       1 : ED 56               		im	1		; Interrupt mode 1
(1)  121/       3 : 31 00 20            		ld	sp,2000h	; Set stack at the end of Z80
(1)  122/       6 : 18 36               		jr	z80_init	; Jump to z80_init
(1)  123/       8 :                     
(1)  124/       8 :                     ; --------------------------------------------------------
(1)  125/       8 :                     ; RST 8 (dac_me)
(1)  126/       8 :                     ; *** self-modifiable code ***
(1)  127/       8 :                     ;
(1)  128/       8 :                     ; Writes wave data to DAC using the data stored
(1)  129/       8 :                     ; on the wave buffer. call this routine every 6
(1)  130/       8 :                     ; or more lines of code to keep playing the sample
(1)  131/       8 :                     ; at the desired sample rate while processing code
(1)  132/       8 :                     ;
(1)  133/       8 :                     ; Input (EXX):
(1)  134/       8 :                     ;  c - WAVE buffer MSB
(1)  135/       8 :                     ; de - Pitch (xx.00)
(1)  136/       8 :                     ; h  - WAVE buffer LSB (as xx.00)
(1)  137/       8 :                     ;
(1)  138/       8 :                     ; Uses (EXX):
(1)  139/       8 :                     ; b
(1)  140/       8 :                     ;
(1)  141/       8 :                     ; Notes:
(1)  142/       8 :                     ; call dac_on to enable WAVE playback
(1)  143/       8 :                     ; or
(1)  144/       8 :                     ; call dac_off to disable it (check for FM6 manually)
(1)  145/       8 :                     ; --------------------------------------------------------
(1)  146/       8 :                     
(1)  147/       8 :                     ; NOTE: This plays at 18000hz but I'm using
(1)  148/       8 :                     ; 16000hz as the "center" note (C-5)
(1)  149/       8 :                     ; check ZSET_WTUNE if you want change the
(1)  150/       8 :                     ; "center" frequency.
(1)  151/       8 :                     
(1)  152/       8 : (MACRO)             		org 8
(1)  153/       8 : D9                  dac_me:		exx			; <-- this changes between EXX(play) and RET(stop)
(1)  154/       9 : 08                  		ex	af,af'		; Swap af
(1)  155/       A : 45                  		ld	b,l		; Save pitch's .00 to b
(1)  156/       B : 3E 2A               		ld	a,2Ah		; YM register command 2Ah
(1)  157/       D : 32 00 40            		ld	(Zym_ctrl_1),a
(1)  158/      10 : 6C                  		ld	l,h		; L - xx.00 to 00xx
(1)  159/      11 : 61                  		ld	h,c		; H - Wave buffer MSB | 00xx
(1)  160/      12 : 7E                  		ld	a,(hl)		; Now read byte from the wave buffer
(1)  161/      13 : 32 01 40            		ld	(Zym_data_1),a	; and write it to DAC
(1)  162/      16 : 65                  		ld	h,l		; get hl back
(1)  163/      17 : 68                  		ld	l,b		; Get .00 back from b to l
(1)  164/      18 : 19                  		add	hl,de		; Pitch increment hl
(1)  165/      19 : 08                  		ex	af,af'		; return af
(1)  166/      1A : D9                  		exx
(1)  167/      1B : C9                  		ret
(1)  168/      1C :                     
(1)  169/      1C :                     ; --------------------------------------------------------
(1)  170/      1C :                     
(1)  171/      1C : 00                  commZRomBlk	db 0			; 68k ROM block flag
(1)  172/      1D : 00                  commZRomRd	db 0			; Z80 ROM reading flag
(1)  173/      1E : 00                  commZRead	db 0			; cmd read pointer (here)
(1)  174/      1F : 00                  commZWrite	db 0			; cmd fifo wptr (from 68k)
(1)  175/      20 :                     
(1)  176/      20 :                     ; --------------------------------------------------------
(1)  177/      20 :                     ; RST 20h (dac_me)
(1)  178/      20 :                     ; *** self-modifiable code ***
(1)  179/      20 :                     ;
(1)  180/      20 :                     ; Checks if the WAVE cache needs refilling to keep
(1)  181/      20 :                     ; it playing.
(1)  182/      20 :                     ; *** THIS BREAKS ALL REGISTERS IF REFILL IS REQUESTED ***
(1)  183/      20 :                     ; --------------------------------------------------------
(1)  184/      20 :                     
(1)  185/      20 :                     ; TODO: might slow down the entire driver.
(1)  186/      20 :                     
(1)  187/      20 : (MACRO)             		org 20h
(1)  188/      20 : F5                  dac_fill:	push	af		; <-- this changes between PUSH AF(playing) and RET(stopped)
(1)  189/      21 : 3A 5D 1E            		ld	a,(dDacFifoMid)	; a - Get current wavebuffer LSB (00h or 80h)
(1)  190/      24 : D9                  		exx
(1)  191/      25 : AC                  		xor	h		; 00xx.00
(1)  192/      26 : D9                  		exx
(1)  193/      27 : E6 80               		and	80h		; Check if bit changed
(1)  194/      29 : C2 7B 13            		jp	nz,dac_refill	; If it did, refill and update LSB to check
(1)  195/      2C : F1                  		pop	af
(1)  196/      2D : C9                  		ret
(1)  197/      2E :                     
(1)  198/      2E :                     ; --------------------------------------------------------
(1)  199/      2E :                     ; 02Eh
(1)  200/      2E : 00                  marsBlock	db 0		; flag to temporally disable PWM communication
(1)  201/      2F : 00                  marsUpd		db 0		; flag to request a PWM transfer
(1)  202/      30 : 00                  currTickBits	db 0		; Current Tick/Tempo bitflags (000000BTb B-beat, T-tick)
(1)  203/      31 : 00                  palMode		db 0		; PAL speed flag (TODO)
(1)  204/      32 : 90 00               sbeatPtck_1	dw 200-56	; Global tempo (sub beats) (-32 for PAL)
(1)  205/      34 : 00 00               sbeatAcc	dw 0		; Accumulates on each tick to trigger the sub beats
(1)  206/      36 : 00                  x68ksrclsb	db 0		; transferRom temporal LSB
(1)  207/      37 : 00                  x68ksrcmid	db 0		; transferRom temporal MID
(1)  208/      38 :                     
(1)  209/      38 :                     ; --------------------------------------------------------
(1)  210/      38 :                     ; Z80 Interrupt at 0038h
(1)  211/      38 :                     ; --------------------------------------------------------
(1)  212/      38 :                     
(1)  213/      38 : (MACRO)             		org 38h				; Align 38h
(1)  214/      38 : ED 73 48 1E         		ld	(tickFlag),sp		; Grab the sp to as the TICK flag (xx1F, read as tickFlag+1)
(1)  215/      3C : F3                  		di				; Disable interrupt
(1)  216/      3D : C9                  		ret
(1)  217/      3E :                     
(1)  218/      3E :                     ; --------------------------------------------------------
(1)  219/      3E :                     ; Initilize
(1)  220/      3E :                     ; --------------------------------------------------------
(1)  221/      3E :                     
(1)  222/      3E :                     z80_init:
(1)  223/      3E : CD 35 0E            		call	gema_init		; Init values
(1)  224/      41 : FB                  		ei
(1)  225/      42 :                     
(1)  226/      42 :                     ; --------------------------------------------------------
(1)  227/      42 :                     ; MAIN LOOP
(1)  228/      42 :                     ; --------------------------------------------------------
(1)  229/      42 :                     
(1)  230/      42 :                     drv_loop:
(1)  231/      42 : CF                  		rst	8
(1)  232/      43 : CD B0 0E            		call	get_tick		; Check for Tick on VBlank
(1)  233/      46 : E7                  		rst	20h			; first dacfill
(1)  234/      47 : CF                  		rst	8
(1)  235/      48 : 06 00               		ld	b,0			; b - Reset current flags (beat|tick)
(1)  236/      4A : 3A 4A 1E            		ld	a,(tickCnt)
(1)  237/      4D : D6 01               		sub	1
(1)  238/      4F : 38 0C               		jr	c,.noticks
(1)  239/      51 : 32 4A 1E            		ld	(tickCnt),a
(1)  240/      54 : CF                  		rst	8
(1)  241/      55 : CD BA 0F            		call	chip_env		; Process PSG volume and freqs manually
(1)  242/      58 : CD B0 0E            		call	get_tick		; Check for another tick
(1)  243/      5B : 06 01               		ld 	b,01b			; Set TICK (01b) flag, and clear BEAT
(1)  244/      5D :                     .noticks:
(1)  245/      5D : 3A 35 00            		ld	a,(sbeatAcc+1)		; check beat counter (scaled by tempo)
(1)  246/      60 : D6 01               		sub	1
(1)  247/      62 : 38 06               		jr	c,.nobeats
(1)  248/      64 : 32 35 00            		ld	(sbeatAcc+1),a		; 1/24 beat passed.
(1)  249/      67 : CB C8               		set	1,b			; Set BEAT (10b) flag
(1)  250/      69 : CF                  		rst	8
(1)  251/      6A :                     .nobeats:
(1)  252/      6A : CF                  		rst	8
(1)  253/      6B : 78                  		ld	a,b			; Any beat/tick change?
(1)  254/      6C : B7                  		or	a
(1)  255/      6D : 28 13               		jr	z,.neither
(1)  256/      6F : 32 30 00            		ld	(currTickBits),a	; Save BEAT/TICK bits
(1)  257/      72 : CD B0 0E            		call	get_tick
(1)  258/      75 : CD 52 05            		call	setupchip		; Send changes to sound chips
(1)  259/      78 : CD B0 0E            		call	get_tick
(1)  260/      7B : CD DA 01            		call	updtrack		; Update track data
(1)  261/      7E : CD B0 0E            		call	get_tick
(1)  262/      81 : CF                  		rst	8
(1)  263/      82 :                     .neither:
(1)  264/      82 : CD C3 04            		call	mars_scomm		; 32X communication for PWM playback
(1)  265/      85 : CD B0 0E            		call	get_tick
(1)  266/      88 : CF                  		rst	8
(1)  267/      89 :                     .next_cmd:
(1)  268/      89 : 3A 1F 00            		ld	a,(commZWrite)		; Check command READ and WRITE indexes
(1)  269/      8C : 47                  		ld	b,a
(1)  270/      8D : 3A 1E 00            		ld	a,(commZRead)
(1)  271/      90 : B8                  		cp	b
(1)  272/      91 : 28 AF               		jr	z,drv_loop		; If both are equal: no requests
(1)  273/      93 : E7                  		rst	20h			; First dacfill
(1)  274/      94 : CF                  		rst	8
(1)  275/      95 : CD B9 01            		call	get_cmdbyte
(1)  276/      98 : FE FF               		cp	-1			; Got -1? (Start of command)
(1)  277/      9A : 20 A6               		jr	nz,drv_loop
(1)  278/      9C : CD B9 01            		call	get_cmdbyte		; Read command number
(1)  279/      9F : 87                  		add	a,a			; * 2
(1)  280/      A0 : 21 AE 00            		ld	hl,.list		; Then jump to one of these...
(1)  281/      A3 : CF                  		rst	8
(1)  282/      A4 : 16 00               		ld	d,0
(1)  283/      A6 : 5F                  		ld	e,a
(1)  284/      A7 : 19                  		add	hl,de
(1)  285/      A8 : 7E                  		ld	a,(hl)
(1)  286/      A9 : CF                  		rst	8
(1)  287/      AA : 23                  		inc	hl
(1)  288/      AB : 66                  		ld	h,(hl)
(1)  289/      AC : 6F                  		ld	l,a
(1)  290/      AD : E9                  		jp	(hl)
(1)  291/      AE :                     .list:
(1)  292/      AE : F2 00               		dw .cmnd_trkplay		; $00 - Play
(1)  293/      B0 : 55 01               		dw .cmnd_trkstop		; $01 - Stop/Pause
(1)  294/      B2 : 70 01               		dw .cmnd_trkresume		; $02 - Resume
(1)  295/      B4 : EE 00               		dw .cmnd_0			; $03 -
(1)  296/      B6 : EE 00               		dw .cmnd_0			; $04 -
(1)  297/      B8 : EE 00               		dw .cmnd_0			; $05 -
(1)  298/      BA : EE 00               		dw .cmnd_0			; $06 -
(1)  299/      BC : EE 00               		dw .cmnd_0			; $07 -
(1)  300/      BE : 7D 01               		dw .cmnd_trkticks		; $08 - Set ticks
(1)  301/      C0 : EE 00               		dw .cmnd_0			; $09 -
(1)  302/      C2 : EE 00               		dw .cmnd_0			; $0A -
(1)  303/      C4 : EE 00               		dw .cmnd_0			; $0B -
(1)  304/      C6 : EE 00               		dw .cmnd_0			; $0C -
(1)  305/      C8 : EE 00               		dw .cmnd_0			; $0D -
(1)  306/      CA : EE 00               		dw .cmnd_0			; $0E -
(1)  307/      CC : EE 00               		dw .cmnd_0			; $0F -
(1)  308/      CE : 8F 01               		dw .cmnd_trktempo		; $10 - Set global subbeats
(1)  309/      D0 : EE 00               		dw .cmnd_0
(1)  310/      D2 : EE 00               		dw .cmnd_0
(1)  311/      D4 : EE 00               		dw .cmnd_0
(1)  312/      D6 : EE 00               		dw .cmnd_0			; $14
(1)  313/      D8 : EE 00               		dw .cmnd_0
(1)  314/      DA : EE 00               		dw .cmnd_0
(1)  315/      DC : EE 00               		dw .cmnd_0
(1)  316/      DE : EE 00               		dw .cmnd_0			; $18
(1)  317/      E0 : EE 00               		dw .cmnd_0
(1)  318/      E2 : EE 00               		dw .cmnd_0
(1)  319/      E4 : EE 00               		dw .cmnd_0
(1)  320/      E6 : EE 00               		dw .cmnd_0			; $1C
(1)  321/      E8 : EE 00               		dw .cmnd_0
(1)  322/      EA : EE 00               		dw .cmnd_0
(1)  323/      EC : EE 00               		dw .cmnd_0
(1)  324/      EE :                     
(1)  325/      EE :                     ; --------------------------------------------------------
(1)  326/      EE :                     ; Command list
(1)  327/      EE :                     ; --------------------------------------------------------
(1)  328/      EE :                     
(1)  329/      EE :                     .cmnd_0:
(1)  330/      EE : 18 FE               		jr	$			; BAD COMMAND
(1)  331/      F0 : 18 97               		jr	.next_cmd
(1)  332/      F2 :                     
(1)  333/      F2 :                     ; --------------------------------------------------------
(1)  334/      F2 :                     ; $01 - Set NEW track
(1)  335/      F2 :                     ; --------------------------------------------------------
(1)  336/      F2 :                     
(1)  337/      F2 :                     ; Slot
(1)  338/      F2 :                     ; Ticks
(1)  339/      F2 :                     ; 24-bit patt data
(1)  340/      F2 :                     ; 24-bit block data
(1)  341/      F2 :                     .cmnd_trkplay:
(1)  342/      F2 : CD B9 01            		call	get_cmdbyte		; Get track slot
(1)  343/      F5 : CD A4 01            		call	get_trkindx		; and read index iy
(1)  344/      F8 : CD 99 04            		call	track_out		; track out.
(1)  345/      FB : FD 36 1A FE         		ld	(iy+trk_CmdReq),-2
(1)  346/      FF : CD B9 01            		call	get_cmdbyte		; Get ticks
(1)  347/     102 : FD 77 15            		ld	(iy+trk_tickSet),a
(1)  348/     105 : CD B9 01            		call	get_cmdbyte		; Start block
(1)  349/     108 : FD 77 12            		ld	(iy+trk_setBlk),a
(1)  350/     10B : CD B9 01            		call	get_cmdbyte		; Flag bits
(1)  351/     10E : F6 C0               		or	11000000b		; Enable + First fill bits
(1)  352/     110 : FD 77 13            		ld	(iy+trk_status),a
(1)  353/     113 : CD B9 01            		call	get_cmdbyte		; Pattern data
(1)  354/     116 : FD 77 03            		ld	(iy+trk_romPatt),a
(1)  355/     119 : CD B9 01            		call	get_cmdbyte
(1)  356/     11C : FD 77 04            		ld	(iy+(trk_romPatt+1)),a
(1)  357/     11F : CD B9 01            		call	get_cmdbyte
(1)  358/     122 : FD 77 05            		ld	(iy+(trk_romPatt+2)),a
(1)  359/     125 : CD B9 01            		call	get_cmdbyte		; Block data
(1)  360/     128 : FD 77 00            		ld	(iy+trk_romBlk),a
(1)  361/     12B : CD B9 01            		call	get_cmdbyte
(1)  362/     12E : FD 77 01            		ld	(iy+(trk_romBlk+1)),a
(1)  363/     131 : CD B9 01            		call	get_cmdbyte
(1)  364/     134 : CD B0 0E            		call	get_tick
(1)  365/     137 : FD 77 02            		ld	(iy+(trk_romBlk+2)),a
(1)  366/     13A : CD B9 01            		call	get_cmdbyte		; Instrument data
(1)  367/     13D : FD 77 06            		ld	(iy+trk_romIns),a
(1)  368/     140 : CD B9 01            		call	get_cmdbyte
(1)  369/     143 : FD 77 07            		ld	(iy+(trk_romIns+1)),a
(1)  370/     146 : CD B9 01            		call	get_cmdbyte
(1)  371/     149 : FD 77 08            		ld	(iy+(trk_romIns+2)),a
(1)  372/     14C : 3E 01               		ld	a,1
(1)  373/     14E : FD 77 14            		ld	(iy+trk_tickTmr),a
(1)  374/     151 : CF                  		rst	8
(1)  375/     152 : C3 89 00            		jp	.next_cmd
(1)  376/     155 :                     
(1)  377/     155 :                     ; --------------------------------------------------------
(1)  378/     155 :                     ; $02 - Stop/Pause track
(1)  379/     155 :                     ; --------------------------------------------------------
(1)  380/     155 :                     
(1)  381/     155 :                     .cmnd_trkstop:
(1)  382/     155 : CD B9 01            		call	get_cmdbyte		; Get track slot
(1)  383/     158 : CD A4 01            		call	get_trkindx		; and read index iy
(1)  384/     15B : FD CB 13 7E         		bit	7,(iy+trk_status)	; This track is active?
(1)  385/     15F : CA 89 00            		jp	z,.next_cmd
(1)  386/     162 : CD 99 04            		call	track_out		; track out.
(1)  387/     165 : FD 36 1A FF         		ld	(iy+trk_CmdReq),-1
(1)  388/     169 : FD CB 13 FE         		set	7,(iy+trk_status)
(1)  389/     16D : C3 89 00            		jp	.next_cmd
(1)  390/     170 :                     
(1)  391/     170 :                     ; --------------------------------------------------------
(1)  392/     170 :                     ; $03 - Resume track
(1)  393/     170 :                     ;
(1)  394/     170 :                     ; TODO: This doesn't work right, but I'm leaving
(1)  395/     170 :                     ; it here just in case.
(1)  396/     170 :                     ; --------------------------------------------------------
(1)  397/     170 :                     
(1)  398/     170 :                     .cmnd_trkresume:
(1)  399/     170 : CD B9 01            		call	get_cmdbyte		; Get track slot
(1)  400/     173 : CD A4 01            		call	get_trkindx		; and read index iy
(1)  401/     176 : FD CB 13 FE         		set	7,(iy+trk_status)	; Slot ON
(1)  402/     17A : C3 89 00            		jp	.next_cmd
(1)  403/     17D :                     
(1)  404/     17D :                     ; --------------------------------------------------------
(1)  405/     17D :                     ; $08 - Set track's ticks
(1)  406/     17D :                     ; --------------------------------------------------------
(1)  407/     17D :                     
(1)  408/     17D :                     .cmnd_trkticks:
(1)  409/     17D : CD B9 01            		call	get_cmdbyte		; Get track slot
(1)  410/     180 : CD A4 01            		call	get_trkindx		; and read index iyc
(1)  411/     183 : CD B9 01            		call	get_cmdbyte
(1)  412/     186 : FD 77 15            		ld	(iy+trk_tickSet),a
(1)  413/     189 : FD 77 14            		ld	(iy+trk_tickTmr),a
(1)  414/     18C : C3 89 00            		jp	.next_cmd
(1)  415/     18F :                     
(1)  416/     18F :                     ; --------------------------------------------------------
(1)  417/     18F :                     ; $10 - Set global tempo
(1)  418/     18F :                     ; --------------------------------------------------------
(1)  419/     18F :                     
(1)  420/     18F :                     .cmnd_trktempo:
(1)  421/     18F : CD B9 01            		call	get_cmdbyte		; Get track slot
(1)  422/     192 : CD A4 01            		call	get_trkindx		; and read index iyc
(1)  423/     195 : CD B9 01            		call	get_cmdbyte
(1)  424/     198 : 32 32 00            		ld	(sbeatPtck_1),a
(1)  425/     19B : CD B9 01            		call	get_cmdbyte
(1)  426/     19E : 32 33 00            		ld	(sbeatPtck_1+1),a
(1)  427/     1A1 : C3 89 00            		jp	.next_cmd
(1)  428/     1A4 :                     
(1)  429/     1A4 :                     ; --------------------------------------------------------
(1)  430/     1A4 :                     ; Pick track buffer
(1)  431/     1A4 :                     ;
(1)  432/     1A4 :                     ; a - track index
(1)  433/     1A4 :                     ; --------------------------------------------------------
(1)  434/     1A4 :                     
(1)  435/     1A4 :                     ; NOTE: manual pointers
(1)  436/     1A4 :                     
(1)  437/     1A4 :                     get_trkindx:
(1)  438/     1A4 : 21 B5 01            		ld	hl,trkPointers
(1)  439/     1A7 : 87                  		add	a,a
(1)  440/     1A8 : 16 00               		ld	d,0
(1)  441/     1AA : 5F                  		ld	e,a
(1)  442/     1AB : CF                  		rst	8
(1)  443/     1AC : 19                  		add	hl,de
(1)  444/     1AD : 7E                  		ld	a,(hl)
(1)  445/     1AE : 23                  		inc	hl
(1)  446/     1AF : 66                  		ld	h,(hl)
(1)  447/     1B0 : 6F                  		ld	l,a
(1)  448/     1B1 : E5                  		push	hl
(1)  449/     1B2 : FD E1               		pop	iy
(1)  450/     1B4 : C9                  		ret
(1)  451/     1B5 :                     trkPointers:
(1)  452/     1B5 : 60 19               		dw trkBuff_0
(1)  453/     1B7 : 08 1A               		dw trkBuff_1
(1)  454/     1B9 :                     
(1)  455/     1B9 :                     ; --------------------------------------------------------
(1)  456/     1B9 :                     ; Read cmd byte, auto re-aligns to 3Fh
(1)  457/     1B9 :                     ; --------------------------------------------------------
(1)  458/     1B9 :                     
(1)  459/     1B9 :                     get_cmdbyte:
(1)  460/     1B9 : C5                  		push	bc
(1)  461/     1BA : D5                  		push	de
(1)  462/     1BB : E5                  		push	hl
(1)  463/     1BC :                     .getcbytel:
(1)  464/     1BC : 3A 1F 00            		ld	a,(commZWrite)
(1)  465/     1BF : 47                  		ld	b,a
(1)  466/     1C0 : 3A 1E 00            		ld	a,(commZRead)
(1)  467/     1C3 : B8                  		cp	b
(1)  468/     1C4 : 28 F6               		jr	z,.getcbytel	; wait for a command from 68k
(1)  469/     1C6 : CF                  		rst	8
(1)  470/     1C7 : 06 00               		ld	b,0
(1)  471/     1C9 : 4F                  		ld	c,a
(1)  472/     1CA : 21 00 1E            		ld	hl,commZfifo
(1)  473/     1CD : 09                  		add	hl,bc
(1)  474/     1CE : 3C                  		inc	a
(1)  475/     1CF : E6 3F               		and	3Fh		; command list limit
(1)  476/     1D1 : CF                  		rst	8
(1)  477/     1D2 : 32 1E 00            		ld	(commZRead),a
(1)  478/     1D5 : 7E                  		ld	a,(hl)		; a - the byte we got
(1)  479/     1D6 : E1                  		pop	hl
(1)  480/     1D7 : D1                  		pop	de
(1)  481/     1D8 : C1                  		pop	bc
(1)  482/     1D9 : C9                  		ret
(1)  483/     1DA :                     
(1)  484/     1DA :                     ; ====================================================================
(1)  485/     1DA :                     ; ----------------------------------------------------------------
(1)  486/     1DA :                     ; Sound playback code
(1)  487/     1DA :                     ; ----------------------------------------------------------------
(1)  488/     1DA :                     
(1)  489/     1DA :                     ; --------------------------------------------------------
(1)  490/     1DA :                     ; Read track data
(1)  491/     1DA :                     ; --------------------------------------------------------
(1)  492/     1DA :                     
(1)  493/     1DA :                     updtrack:
(1)  494/     1DA : E7                  		rst	20h
(1)  495/     1DB : FD 21 60 19         		ld	iy,trkBuff_0		; BGM
(1)  496/     1DF : CF                  		rst	8
(1)  497/     1E0 : 11 5B 18            		ld	de,insDataC_0
(1)  498/     1E3 : CD F2 01            		call	.read_track
(1)  499/     1E6 : FD 21 08 1A         		ld	iy,trkBuff_1		; SFX
(1)  500/     1EA : 11 DB 18            		ld	de,insDataC_1
(1)  501/     1ED : CF                  		rst	8
(1)  502/     1EE : CD F2 01            		call	.read_track
(1)  503/     1F1 : C9                  		ret
(1)  504/     1F2 :                     
(1)  505/     1F2 :                     ; ----------------------------------------
(1)  506/     1F2 :                     ; Read track data
(1)  507/     1F2 :                     ;
(1)  508/     1F2 :                     ; iy - Track control
(1)  509/     1F2 :                     ; ix - Track channels
(1)  510/     1F2 :                     ; de - Instrument CACHE point
(1)  511/     1F2 :                     ; ----------------------------------------
(1)  512/     1F2 :                     
(1)  513/     1F2 :                     .read_track:
(1)  514/     1F2 : FD 46 13            		ld	b,(iy+trk_status)	; b - Track status
(1)  515/     1F5 : CB 78               		bit	7,b			; Active?
(1)  516/     1F7 : C8                  		ret	z
(1)  517/     1F8 : FD 7E 1A            		ld	a,(iy+trk_CmdReq)	; Any mid-request?
(1)  518/     1FB : B7                  		or	a
(1)  519/     1FC : C0                  		ret	nz
(1)  520/     1FD : ED 53 40 1E         		ld	(currInsData),de	; save temporal InsData
(1)  521/     201 : CF                  		rst	8
(1)  522/     202 : 3A 30 00            		ld	a,(currTickBits)	; a - Tick/Beat bits
(1)  523/     205 : CB 40               		bit	0,b			; This track uses Beats?
(1)  524/     207 : 28 03               		jr	z,.sfxmd		; Nope
(1)  525/     209 : CB 4F               		bit	1,a			; BEAT passed?
(1)  526/     20B : C8                  		ret	z
(1)  527/     20C :                     .sfxmd:
(1)  528/     20C : CB 47               		bit	0,a			; TICK passed?
(1)  529/     20E : C8                  		ret	z
(1)  530/     20F : FD 7E 14            		ld	a,(iy+trk_tickTmr)	; TICK timer for this track
(1)  531/     212 : 3D                  		dec	a
(1)  532/     213 : FD 77 14            		ld	(iy+trk_tickTmr),a
(1)  533/     216 : CF                  		rst	8
(1)  534/     217 : B7                  		or	a
(1)  535/     218 : C0                  		ret	nz			; If != 0, exit
(1)  536/     219 : CB 68               		bit	5,b			; Effect-requested track set?
(1)  537/     21B : C4 1B 04            		call	nz,.effect_fill
(1)  538/     21E : CB 70               		bit	6,b			; Restart/First time?
(1)  539/     220 : C4 23 04            		call	nz,.first_fill
(1)  540/     223 : FD 7E 15            		ld	a,(iy+trk_tickSet)	; Set new tick timer
(1)  541/     226 : FD 77 14            		ld	(iy+trk_tickTmr),a
(1)  542/     229 : CF                  		rst	8
(1)  543/     22A : FD 6E 0C            		ld	l,(iy+trk_Read)		; hl - Pattern data to read in cache
(1)  544/     22D : FD 66 0D            		ld	h,(iy+((trk_Read+1)))
(1)  545/     230 : FD 4E 0E            		ld	c,(iy+trk_Rows)		; bc - Set row counter
(1)  546/     233 : FD 46 0F            		ld	b,(iy+(trk_Rows+1))
(1)  547/     236 : 79                  		ld	a,c
(1)  548/     237 : B0                  		or	b
(1)  549/     238 : CC 75 03            		call	z,.next_track		; If rowtimer == 0, get next track data
(1)  550/     23B :                     ; 		cp	-1
(1)  551/     23B :                     ; 		ret	z
(1)  552/     23B :                     ; 		rst	8
(1)  553/     23B :                     
(1)  554/     23B :                     ; --------------------------------
(1)  555/     23B :                     ; Main reading loop
(1)  556/     23B :                     ; --------------------------------
(1)  557/     23B :                     
(1)  558/     23B :                     .next_note:
(1)  559/     23B : FD 7E 17            		ld	a,(iy+trk_rowPause)	; Check rowtimer
(1)  560/     23E : B7                  		or	a
(1)  561/     23F : 20 17               		jr	nz,.decrow
(1)  562/     241 : 7E                  		ld	a,(hl)			; Check if timer or note
(1)  563/     242 : B7                  		or	a
(1)  564/     243 : 28 08               		jr	z,.exit			; If == 00h: exit
(1)  565/     245 : FA 64 02            		jp	m,.has_note		; 80h-0FFh: note data
(1)  566/     248 : FD 77 17            		ld	(iy+trk_rowPause),a
(1)  567/     24B : 18 00               		jr	.exit			; make row-timer, set hl+1
(1)  568/     24D :                     
(1)  569/     24D :                     ; --------------------------------
(1)  570/     24D :                     ; Exit
(1)  571/     24D :                     ; --------------------------------
(1)  572/     24D :                     
(1)  573/     24D :                     .exit:
(1)  574/     24D : CD FC 02            		call	.inc_cpatt
(1)  575/     250 : FD 75 0C            		ld	(iy+trk_Read),l		; Update read location
(1)  576/     253 : FD 74 0D            		ld	(iy+((trk_Read+1))),h
(1)  577/     256 : 18 03               		jr	.decrow_e
(1)  578/     258 :                     .decrow:
(1)  579/     258 : FD 35 17            		dec	(iy+trk_rowPause)
(1)  580/     25B :                     .decrow_e:
(1)  581/     25B : CF                  		rst	8
(1)  582/     25C : 0B                  		dec	bc			; Decrement this row
(1)  583/     25D : FD 71 0E            		ld	(iy+trk_Rows),c		; And update it
(1)  584/     260 : FD 70 0F            		ld	(iy+(trk_Rows+1)),b
(1)  585/     263 : C9                  		ret
(1)  586/     264 :                     
(1)  587/     264 :                     ; --------------------------------
(1)  588/     264 :                     ; New note request
(1)  589/     264 :                     ; --------------------------------
(1)  590/     264 :                     
(1)  591/     264 :                     .has_note:
(1)  592/     264 : C5                  		push	bc			; Save rowcount
(1)  593/     265 : 4F                  		ld	c,a			; c - Copy of control+channel
(1)  594/     266 : CD FC 02            		call	.inc_cpatt
(1)  595/     269 : 79                  		ld	a,c
(1)  596/     26A : FD E5               		push	iy
(1)  597/     26C : DD E1               		pop	ix
(1)  598/     26E : 11 20 00            		ld	de,20h			; Point to track-data
(1)  599/     271 : DD 19               		add	ix,de
(1)  600/     273 : CF                  		rst	8
(1)  601/     274 : E6 3F               		and	00111111b
(1)  602/     276 :                     ; 		cp	(iy+trk_numChnls)
(1)  603/     276 :                     ; 		jp	nc,.rnout_chnls
(1)  604/     276 : 87                  		add	a,a			; * 8
(1)  605/     277 : 87                  		add	a,a
(1)  606/     278 : 87                  		add	a,a
(1)  607/     279 : 16 00               		ld 	d,0
(1)  608/     27B : 5F                  		ld	e,a
(1)  609/     27C : DD 19               		add	ix,de
(1)  610/     27E : CF                  		rst	8
(1)  611/     27F : DD 46 07            		ld	b,(ix+chnl_Type)	; b - last Note type
(1)  612/     282 : CB 71               		bit	6,c			; Next byte is new type?
(1)  613/     284 : 28 06               		jr	z,.old_type
(1)  614/     286 : 7E                  		ld	a,(hl)
(1)  615/     287 : DD 77 07            		ld	(ix+chnl_Type),a
(1)  616/     28A : 47                  		ld	b,a
(1)  617/     28B : 2C                  		inc 	l
(1)  618/     28C :                     .old_type:
(1)  619/     28C :                     	; b - evinEVIN
(1)  620/     28C :                     	;     E-effect/V-volume/I-instrument/N-note
(1)  621/     28C :                     	;     evin: byte is already stored on track-channel buffer
(1)  622/     28C :                     	;     EVIN: next byte(s) contain a new value, for eff:2 bytes
(1)  623/     28C : CF                  		rst	8
(1)  624/     28D : CB 40               		bit	0,b
(1)  625/     28F : 28 07               		jr	z,.no_note
(1)  626/     291 : 7E                  		ld	a,(hl)
(1)  627/     292 : DD 77 02            		ld	(ix+chnl_Note),a
(1)  628/     295 : CD FC 02            		call	.inc_cpatt
(1)  629/     298 :                     .no_note:
(1)  630/     298 : CB 48               		bit	1,b
(1)  631/     29A : 28 07               		jr	z,.no_ins
(1)  632/     29C : 7E                  		ld	a,(hl)
(1)  633/     29D : DD 77 03            		ld	(ix+chnl_Ins),a
(1)  634/     2A0 : CD FC 02            		call	.inc_cpatt
(1)  635/     2A3 :                     .no_ins:
(1)  636/     2A3 : CF                  		rst	8
(1)  637/     2A4 : CB 50               		bit	2,b
(1)  638/     2A6 : 28 07               		jr	z,.no_vol
(1)  639/     2A8 : 7E                  		ld	a,(hl)
(1)  640/     2A9 : DD 77 04            		ld	(ix+chnl_Vol),a
(1)  641/     2AC : CD FC 02            		call	.inc_cpatt
(1)  642/     2AF :                     .no_vol:
(1)  643/     2AF : CB 58               		bit	3,b
(1)  644/     2B1 : 28 0E               		jr	z,.no_eff
(1)  645/     2B3 : 7E                  		ld	a,(hl)
(1)  646/     2B4 : DD 77 05            		ld	(ix+chnl_EffId),a
(1)  647/     2B7 : CD FC 02            		call	.inc_cpatt
(1)  648/     2BA : 7E                  		ld	a,(hl)
(1)  649/     2BB : DD 77 06            		ld	(ix+chnl_EffArg),a
(1)  650/     2BE : CD FC 02            		call	.inc_cpatt
(1)  651/     2C1 :                     .no_eff:
(1)  652/     2C1 : CF                  		rst	8
(1)  653/     2C2 : 78                  		ld	a,b		; Merge the Impulse recycle bits into main bits
(1)  654/     2C3 : CB 3F               		srl	a
(1)  655/     2C5 : CB 3F               		srl	a
(1)  656/     2C7 : CB 3F               		srl	a
(1)  657/     2C9 : CB 3F               		srl	a
(1)  658/     2CB : E6 0F               		and	00001111b
(1)  659/     2CD : 4F                  		ld	c,a
(1)  660/     2CE : CF                  		rst	8
(1)  661/     2CF : 78                  		ld	a,b
(1)  662/     2D0 : E6 0F               		and	00001111b
(1)  663/     2D2 : B1                  		or	c
(1)  664/     2D3 : 4F                  		ld	c,a
(1)  665/     2D4 : DD 7E 01            		ld	a,(ix+chnl_Flags)
(1)  666/     2D7 : B1                  		or	c
(1)  667/     2D8 : DD 77 01            		ld	(ix+chnl_Flags),a
(1)  668/     2DB : CF                  		rst	8
(1)  669/     2DC : C1                  		pop	bc		; Restore rowcount
(1)  670/     2DD :                     
(1)  671/     2DD :                     	; Check for effects that change things
(1)  672/     2DD :                     	; to internal playback (jump, tempo, etc.)
(1)  673/     2DD : E6 08               		and	1000b		; Only check for the EFFECT bit
(1)  674/     2DF : B7                  		or	a
(1)  675/     2E0 : CA 3B 02            		jp	z,.next_note
(1)  676/     2E3 : DD 7E 05            		ld	a,(ix+chnl_EffId)
(1)  677/     2E6 : B7                  		or	a		; 00h = invalid effect
(1)  678/     2E7 : CA 3B 02            		jp	z,.next_note
(1)  679/     2EA : FE 01               		cp	1		; Effect A: Tick set
(1)  680/     2EC : CC 46 03            		call	z,.eff_A
(1)  681/     2EF : FE 02               		cp	2		; Effect B: Position Jump
(1)  682/     2F1 : CC 50 03            		call	z,.eff_B
(1)  683/     2F4 : FE 03               		cp	3		; Effect C: Pattern break
(1)  684/     2F6 : CC 6A 03            		call	z,.eff_C
(1)  685/     2F9 : C3 3B 02            		jp	.next_note
(1)  686/     2FC :                     ; .rnout_chnls:
(1)  687/     2FC :                     ; 		pop	bc
(1)  688/     2FC :                     ; 		jp	.next_note
(1)  689/     2FC :                     
(1)  690/     2FC :                     ; ----------------------------------------
(1)  691/     2FC :                     ; Call this to increment the
(1)  692/     2FC :                     ; cache pattern read pointer (iy+trk_Read)
(1)  693/     2FC :                     ; it also refills the next section to
(1)  694/     2FC :                     ; read if needed.
(1)  695/     2FC :                     ;
(1)  696/     2FC :                     ; NOTE: breaks A
(1)  697/     2FC :                     ; ----------------------------------------
(1)  698/     2FC :                     
(1)  699/     2FC :                     .inc_cpatt:
(1)  700/     2FC : 2C                  		inc	l
(1)  701/     2FD : FD 7E 13            		ld	a,(iy+trk_status)	; Increment-fill enabled?
(1)  702/     300 : E6 10               		and	00010000b
(1)  703/     302 : B7                  		or	a
(1)  704/     303 : C8                  		ret	z
(1)  705/     304 : CF                  		rst	8
(1)  706/     305 : FD 7E 10            		ld	a,(iy+trk_Halfway)
(1)  707/     308 : AD                  		xor	l
(1)  708/     309 : E6 80               		and	080h			; Check for 00h/80h
(1)  709/     30B : C8                  		ret	z
(1)  710/     30C : CF                  		rst	8
(1)  711/     30D : 3A 1C 00            		ld	a,(commZRomBlk)		; Got mid-DMA?
(1)  712/     310 : B7                  		or	a
(1)  713/     311 : 28 06               		jr	z,.grab_asap
(1)  714/     313 : 7D                  		ld	a,l			; Last chance
(1)  715/     314 : E6 7F               		and	07Fh
(1)  716/     316 : FE 70               		cp	070h
(1)  717/     318 : D8                  		ret	c
(1)  718/     319 :                     .grab_asap:
(1)  719/     319 : E7                  		rst	20h			; refill request
(1)  720/     31A : FD 7E 10            		ld	a,(iy+trk_Halfway)	; +80h to halfway
(1)  721/     31D : 54                  		ld	d,h
(1)  722/     31E : 5F                  		ld	e,a
(1)  723/     31F : CF                  		rst	8
(1)  724/     320 : C6 80               		add 	a,080h
(1)  725/     322 : FD 77 10            		ld	(iy+trk_Halfway),a
(1)  726/     325 : E5                  		push	hl
(1)  727/     326 : C5                  		push	bc
(1)  728/     327 : 01 80 00            		ld	bc,80h			; 80h size + increment value
(1)  729/     32A : FD 6E 09            		ld	l,(iy+trk_romPattRd)
(1)  730/     32D : FD 66 0A            		ld	h,(iy+(trk_romPattRd+1))
(1)  731/     330 : CF                  		rst	8
(1)  732/     331 : FD 7E 0B            		ld	a,(iy+(trk_romPattRd+2))
(1)  733/     334 : 09                  		add	hl,bc
(1)  734/     335 : CE 00               		adc	a,0
(1)  735/     337 : FD 75 09            		ld	(iy+trk_romPattRd),l
(1)  736/     33A : FD 74 0A            		ld	(iy+(trk_romPattRd+1)),h
(1)  737/     33D : FD 77 0B            		ld	(iy+(trk_romPattRd+2)),a
(1)  738/     340 : CD 1F 0F            		call	transferRom
(1)  739/     343 : C1                  		pop	bc
(1)  740/     344 : E1                  		pop	hl
(1)  741/     345 : C9                  		ret
(1)  742/     346 :                     
(1)  743/     346 :                     ; ----------------------------------------
(1)  744/     346 :                     ; Effect A: Set ticks
(1)  745/     346 :                     ; ----------------------------------------
(1)  746/     346 :                     
(1)  747/     346 :                     .eff_A:
(1)  748/     346 : DD 5E 06            		ld	e,(ix+chnl_EffArg)	; e - ticks number
(1)  749/     349 : FD 73 15            		ld	(iy+trk_tickSet),e	; set for both Set and Timer.
(1)  750/     34C : FD 73 14            		ld	(iy+trk_tickTmr),e
(1)  751/     34F : C9                  		ret
(1)  752/     350 :                     
(1)  753/     350 :                     ; ----------------------------------------
(1)  754/     350 :                     ; Effect B: jump to a new block
(1)  755/     350 :                     ; ----------------------------------------
(1)  756/     350 :                     
(1)  757/     350 :                     .eff_B:
(1)  758/     350 : F5                  		push	af
(1)  759/     351 : DD 5E 06            		ld	e,(ix+chnl_EffArg)	; e - Block SLOT to jump
(1)  760/     354 : FD 73 11            		ld 	(iy+trk_currBlk),e
(1)  761/     357 : CF                  		rst	8
(1)  762/     358 : FD 36 17 00         		ld	(iy+trk_rowPause),0	; Reset rowpause
(1)  763/     35C : DD 36 05 00         		ld	(ix+chnl_EffId),0	; (failsafe)
(1)  764/     360 : DD 36 06 00         		ld	(ix+chnl_EffArg),0
(1)  765/     364 : FD CB 13 EE         		set	5,(iy+trk_status)	; set fill-from-effect flag on exit
(1)  766/     368 : F1                  		pop	af
(1)  767/     369 : C9                  		ret
(1)  768/     36A :                     
(1)  769/     36A :                     ; ----------------------------------------
(1)  770/     36A :                     ; Effect C: Pattern break/exit
(1)  771/     36A :                     ; ***Not exactly as in Impulse but
(1)  772/     36A :                     ; jumps to the next block
(1)  773/     36A :                     ;
(1)  774/     36A :                     ; If set to -1 it will end the track,
(1)  775/     36A :                     ; so you can put multiple SFX into the
(1)  776/     36A :                     ; track file and call them by block.
(1)  777/     36A :                     ; ----------------------------------------
(1)  778/     36A :                     
(1)  779/     36A :                     .eff_C:
(1)  780/     36A : 01 00 00            		ld	bc,0			; clear rowcount
(1)  781/     36D : DD 7E 06            		ld	a,(ix+chnl_EffArg)
(1)  782/     370 : FE FF               		cp	-1			; EffArg == -1?
(1)  783/     372 : CA 87 04            		jp	z,.trkend_effC		; Use it as track-end (for SFX)
(1)  784/     375 :                     
(1)  785/     375 :                     ; ----------------------------------------
(1)  786/     375 :                     ; If pattern finished, load the next one
(1)  787/     375 :                     ; ----------------------------------------
(1)  788/     375 :                     
(1)  789/     375 :                     .next_track:
(1)  790/     375 : FD 7E 11            		ld	a,(iy+trk_currBlk)	; Increment next block
(1)  791/     378 : 3C                  		inc	a
(1)  792/     379 : FD 77 11            		ld 	(iy+trk_currBlk),a
(1)  793/     37C :                     
(1)  794/     37C :                     ; Load track data to cache
(1)  795/     37C :                     ; a - Block
(1)  796/     37C :                     ;
(1)  797/     37C :                     ; hl - trk_read on halfway
(1)  798/     37C :                     .set_track:
(1)  799/     37C : CF                  		rst	8
(1)  800/     37D : FD 36 10 80         		ld	(iy+trk_Halfway),80h	; Reset halfway
(1)  801/     381 :                     ; 		ld	l,(iy+trk_CachNotes)	; Set trk_read point on halfway
(1)  802/     381 :                     ; 		ld	h,(iy+(trk_CachNotes+1))
(1)  803/     381 :                     ; 		ld	de,80h
(1)  804/     381 :                     ; 		add	hl,de
(1)  805/     381 : 2E 00               		ld	l,0			; quick reset trk_read
(1)  806/     383 : FD 75 0C            		ld	(iy+trk_Read),l
(1)  807/     386 : FD 74 0D            		ld	(iy+((trk_Read+1))),h
(1)  808/     389 :                     
(1)  809/     389 : E5                  		push	hl			; Save hl
(1)  810/     38A : 11 00 00            		ld	de,0
(1)  811/     38D : 5F                  		ld	e,a
(1)  812/     38E : CF                  		rst	8
(1)  813/     38F : FD 6E 00            		ld	l,(iy+trk_romBlk)	; Get block position
(1)  814/     392 : FD 66 01            		ld	h,(iy+(trk_romBlk+1))	; directly from ROM
(1)  815/     395 : FD 7E 02            		ld	a,(iy+(trk_romBlk+2))
(1)  816/     398 : 19                  		add	hl,de
(1)  817/     399 : CE 00               		adc	a,0
(1)  818/     39B : 47                  		ld	b,a
(1)  819/     39C : CF                  		rst	8
(1)  820/     39D : CD D1 0E            		call	showRom
(1)  821/     3A0 : CD F2 0E            		call	readRomB
(1)  822/     3A3 : FE FF               		cp	-1			; if block == -1, end
(1)  823/     3A5 : CA 86 04            		jp	z,.track_end
(1)  824/     3A8 :                     
(1)  825/     3A8 :                     	; a - head index
(1)  826/     3A8 : 87                  		add	a,a
(1)  827/     3A9 : 87                  		add	a,a
(1)  828/     3AA : 16 00               		ld	d,0
(1)  829/     3AC : 5F                  		ld	e,a
(1)  830/     3AD : FD 6E 03            		ld	l,(iy+trk_romPatt)
(1)  831/     3B0 : CF                  		rst	8
(1)  832/     3B1 : FD 66 04            		ld	h,(iy+(trk_romPatt+1))
(1)  833/     3B4 : FD 7E 05            		ld	a,(iy+(trk_romPatt+2))
(1)  834/     3B7 : 19                  		add	hl,de
(1)  835/     3B8 : CE 00               		adc	a,0
(1)  836/     3BA : 11 60 1E            		ld	de,trkHdOut
(1)  837/     3BD : D5                  		push	de
(1)  838/     3BE : 01 06 00            		ld	bc,6			; thispoint, rowcount, nextpoint
(1)  839/     3C1 : CD 1F 0F            		call	transferRom
(1)  840/     3C4 : E1                  		pop	hl
(1)  841/     3C5 : 5E                  		ld	e,(hl)			; de - pointer increment
(1)  842/     3C6 : 23                  		inc	hl
(1)  843/     3C7 : 56                  		ld	d,(hl)
(1)  844/     3C8 : 23                  		inc	hl
(1)  845/     3C9 : 4E                  		ld	c,(hl)			; bc - row count
(1)  846/     3CA : 23                  		inc	hl
(1)  847/     3CB : 46                  		ld	b,(hl)
(1)  848/     3CC : CF                  		rst	8
(1)  849/     3CD : FD 71 0E            		ld	(iy+trk_Rows),c		; Save this number of rows to buffer
(1)  850/     3D0 : FD 70 0F            		ld	(iy+(trk_Rows+1)),b	; on Tick pauses
(1)  851/     3D3 : C5                  		push	bc			; Save bc
(1)  852/     3D4 : E7                  		rst	20h			; refill wave
(1)  853/     3D5 :                     
(1)  854/     3D5 :                     	; Detect pattern size... last moment addition
(1)  855/     3D5 :                     	; for patterns lower than 80h.
(1)  856/     3D5 :                     	; This saves cycles if using SFX
(1)  857/     3D5 :                     	; hl - next pattern point (includes final)
(1)  858/     3D5 :                     	; de - this pattern
(1)  859/     3D5 :                     	; bc - final size for transferRom
(1)  860/     3D5 : 3A 64 1E            		ld	a,(trkHdOut+4)	; hl - de
(1)  861/     3D8 : 6F                  		ld	l,a
(1)  862/     3D9 : 3A 65 1E            		ld	a,(trkHdOut+5)
(1)  863/     3DC : 67                  		ld	h,a
(1)  864/     3DD : 3F                  		ccf			; remove carry first
(1)  865/     3DE : ED 52               		sbc	hl,de
(1)  866/     3E0 : FD 4E 13            		ld	c,(iy+trk_status)
(1)  867/     3E3 : CB A1               		res	4,c
(1)  868/     3E5 : 7C                  		ld	a,h		; h == 0?
(1)  869/     3E6 : B7                  		or	a
(1)  870/     3E7 :                     ; 		jp	m,$
(1)  871/     3E7 : 20 04               		jr	nz,.szmuch
(1)  872/     3E9 : CB 7D               		bit	7,l
(1)  873/     3EB : 28 05               		jr	z,.szgood
(1)  874/     3ED :                     .szmuch:
(1)  875/     3ED : 21 80 00            		ld	hl,080h			; bc - max transfer size 080h
(1)  876/     3F0 : CB E1               		set	4,c
(1)  877/     3F2 :                     .szgood:
(1)  878/     3F2 : FD 71 13            		ld	(iy+trk_status),c
(1)  879/     3F5 : 44                  		ld	b,h
(1)  880/     3F6 : 4D                  		ld	c,l
(1)  881/     3F7 : FD 6E 03            		ld	l,(iy+trk_romPatt)	; hl - ROM pattern data pointer
(1)  882/     3FA : FD 66 04            		ld	h,(iy+(trk_romPatt+1))
(1)  883/     3FD : FD 7E 05            		ld	a,(iy+(trk_romPatt+2))
(1)  884/     400 : 19                  		add	hl,de			; hl + de
(1)  885/     401 : CE 00               		adc	a,0			; and highest byte too.
(1)  886/     403 : CF                  		rst	8
(1)  887/     404 : FD 75 09            		ld	(iy+trk_romPattRd),l	; Save copy of the pointer for READ
(1)  888/     407 : FD 74 0A            		ld	(iy+(trk_romPattRd+1)),h
(1)  889/     40A : FD 77 0B            		ld	(iy+(trk_romPattRd+2)),a
(1)  890/     40D : FD 56 0D            		ld	d,(iy+(trk_Read+1))	; de - destination to data CACHE
(1)  891/     410 : FD 5E 0C            		ld	e,(iy+trk_Read)
(1)  892/     413 :                     ; 		ld	bc,080h			; bc - 080h
(1)  893/     413 : CD 1F 0F            		call	transferRom
(1)  894/     416 : CF                  		rst	8
(1)  895/     417 : C1                  		pop	bc			; Get bc back
(1)  896/     418 : E1                  		pop	hl			; hl too.
(1)  897/     419 : AF                  		xor	a			; return 0
(1)  898/     41A : C9                  		ret
(1)  899/     41B :                     
(1)  900/     41B :                     ; ----------------------------------------
(1)  901/     41B :                     ; First time playing or moving
(1)  902/     41B :                     ; to next track.
(1)  903/     41B :                     ; ----------------------------------------
(1)  904/     41B :                     
(1)  905/     41B :                     .effect_fill:
(1)  906/     41B : E7                  		rst	20h			; Refill wave data
(1)  907/     41C : CB A8               		res	5,b			; Reset refill-from-effect flag
(1)  908/     41E : FD 70 13            		ld	(iy+trk_status),b
(1)  909/     421 : 18 36               		jr	.go_effect
(1)  910/     423 :                     ; 		call	.go_effect
(1)  911/     423 :                     ; 		ret
(1)  912/     423 :                     
(1)  913/     423 :                     ; returns bc as row counter
(1)  914/     423 :                     .first_fill:
(1)  915/     423 : E7                  		rst	20h
(1)  916/     424 : CB B0               		res	6,b			; Reset FILL flag
(1)  917/     426 : FD 70 13            		ld	(iy+trk_status),b
(1)  918/     429 : FD E5               		push	iy
(1)  919/     42B : DD E1               		pop	ix			; copy iy to ix
(1)  920/     42D : 11 20 00            		ld	de,20h			; go to channel data
(1)  921/     430 : DD 19               		add	ix,de
(1)  922/     432 : CF                  		rst	8
(1)  923/     433 : 01 00 00            		ld	bc,0
(1)  924/     436 : 11 08 00            		ld	de,8
(1)  925/     439 : 06 11               		ld	b,MAX_TRKCHN
(1)  926/     43B :                     .clrf:
(1)  927/     43B : CF                  		rst	8
(1)  928/     43C : DD 7E 00            		ld	a,(ix+chnl_Chip)
(1)  929/     43F : B7                  		or	a
(1)  930/     440 : 28 09               		jr	z,.nochip
(1)  931/     442 : DD 36 02 FE         		ld	(ix+chnl_Note),-2
(1)  932/     446 : DD 36 01 01         		ld	(ix+chnl_Flags),1
(1)  933/     44A : CF                  		rst	8
(1)  934/     44B :                     .nochip:
(1)  935/     44B : DD 19               		add	ix,de
(1)  936/     44D : 10 EC               		djnz	.clrf
(1)  937/     44F : FD 36 17 00         		ld	(iy+trk_rowPause),0	; Reset row timer
(1)  938/     453 : FD 7E 12            		ld	a,(iy+trk_setBlk)	; Set current block
(1)  939/     456 : FD 77 11            		ld 	(iy+trk_currBlk),a
(1)  940/     459 :                     .go_effect:
(1)  941/     459 : CF                  		rst	8			; First cache fills
(1)  942/     45A : FD 6E 06            		ld	l,(iy+trk_romIns)	; Recieve almost 100h of instrument pointers
(1)  943/     45D : FD 66 07            		ld	h,(iy+(trk_romIns+1))	; NOTE: transferRom can't do 100h
(1)  944/     460 : FD 7E 08            		ld	a,(iy+(trk_romIns+2))
(1)  945/     463 : ED 5B 40 1E         		ld	de,(currInsData)
(1)  946/     467 : 06 00               		ld	b,0
(1)  947/     469 : FD 4E 16            		ld	c,(iy+trk_sizeIns)
(1)  948/     46C : CD 1F 0F            		call	transferRom
(1)  949/     46F : CF                  		rst	8
(1)  950/     470 : FD 6E 18            		ld	l,(iy+trk_CachNotes)	; Read first cache notes
(1)  951/     473 : FD 66 19            		ld	h,(iy+(trk_CachNotes+1))
(1)  952/     476 : 11 80 00            		ld	de,80h
(1)  953/     479 : 19                  		add	hl,de
(1)  954/     47A : FD 75 0C            		ld	(iy+trk_Read),l
(1)  955/     47D : FD 74 0D            		ld	(iy+((trk_Read+1))),h
(1)  956/     480 : FD 7E 11            		ld	a,(iy+trk_currBlk)
(1)  957/     483 : C3 7C 03            		jp	.set_track
(1)  958/     486 :                     
(1)  959/     486 :                     ; If -1, track ends
(1)  960/     486 :                     ; Automutes channels too.
(1)  961/     486 :                     .track_end:
(1)  962/     486 : E1                  		pop	hl			; Get hl back
(1)  963/     487 :                     .trkend_effC:
(1)  964/     487 : CD 99 04            		call	track_out
(1)  965/     48A :                     ; 		ld	(iy+trk_CmdReq),-1
(1)  966/     48A : CF                  		rst	8
(1)  967/     48B : FD 36 17 00         		ld	(iy+trk_rowPause),0
(1)  968/     48F : FD 36 14 00         		ld	(iy+trk_tickTmr),0
(1)  969/     493 : 01 00 00            		ld	bc,0			; Set bc rowcount to 0
(1)  970/     496 : 3E FF               		ld	a,-1			; Return -1
(1)  971/     498 : C9                  		ret
(1)  972/     499 :                     
(1)  973/     499 :                     ; ----------------------------------------
(1)  974/     499 :                     ; Delete all track data
(1)  975/     499 :                     ; ----------------------------------------
(1)  976/     499 :                     
(1)  977/     499 :                     track_out:
(1)  978/     499 : FD E5               		push	iy
(1)  979/     49B : DD E1               		pop	ix
(1)  980/     49D : 11 20 00            		ld	de,20h
(1)  981/     4A0 : DD 19               		add	ix,de
(1)  982/     4A2 : CF                  		rst	8
(1)  983/     4A3 : 11 08 00            		ld	de,8
(1)  984/     4A6 : 06 11               		ld	b,MAX_TRKCHN
(1)  985/     4A8 :                     .clrfe:
(1)  986/     4A8 : DD 7E 00            		ld	a,(ix+chnl_Chip)
(1)  987/     4AB : B7                  		or	a
(1)  988/     4AC : 28 10               		jr	z,.nochip
(1)  989/     4AE : DD 36 02 FE         		ld	(ix+chnl_Note),-2
(1)  990/     4B2 : DD 36 04 40         		ld	(ix+chnl_Vol),64
(1)  991/     4B6 : DD 7E 01            		ld	a,(ix+chnl_Flags)
(1)  992/     4B9 : 3E 01               		ld	a,1
(1)  993/     4BB : DD 77 01            		ld	(ix+chnl_Flags),a
(1)  994/     4BE :                     .nochip:
(1)  995/     4BE : DD 19               		add	ix,de
(1)  996/     4C0 : 10 E6               		djnz	.clrfe
(1)  997/     4C2 :                     ; 		ld	a,1
(1)  998/     4C2 :                     ; 		ld	(marsUpd),a
(1)  999/     4C2 : C9                  		ret
(1) 1000/     4C3 :                     
(1) 1001/     4C3 :                     ; --------------------------------------------------------
(1) 1002/     4C3 :                     ; ** 32X ***
(1) 1003/     4C3 :                     ; Communicate with the Slave CPU to send the table
(1) 1004/     4C3 :                     ; of PWM's to play.
(1) 1005/     4C3 :                     ; --------------------------------------------------------
(1) 1006/     4C3 :                     
(1) 1007/     4C3 :                     mars_scomm:
(1) 1008/     4C3 : 21 00 60            		ld	hl,6000h	; Point BANK closely
(1) 1009/     4C6 : CF                  		rst	8		; to the 32X area ($A10000)
(1) 1010/     4C7 : 36 00               		ld	(hl),0
(1) 1011/     4C9 : 36 01               		ld	(hl),1
(1) 1012/     4CB : 36 00               		ld	(hl),0
(1) 1013/     4CD : 36 00               		ld	(hl),0
(1) 1014/     4CF : CF                  		rst	8
(1) 1015/     4D0 : 36 00               		ld	(hl),0
(1) 1016/     4D2 : 36 00               		ld	(hl),0
(1) 1017/     4D4 : 36 01               		ld	(hl),1
(1) 1018/     4D6 : 36 00               		ld	(hl),0
(1) 1019/     4D8 : CF                  		rst	8
(1) 1020/     4D9 : 36 01               		ld	(hl),1
(1) 1021/     4DB : FD 21 00 D1         		ld	iy,8000h|5100h	; iy - mars sysreg (now $A15100)
(1) 1022/     4DF : DD 21 40 16         		ld	ix,pwmcom
(1) 1023/     4E3 : 3A 2E 00            		ld	a,(marsBlock)	; block MARS requests?
(1) 1024/     4E6 : B7                  		or	a
(1) 1025/     4E7 : 20 5E               		jr	nz,.blocked
(1) 1026/     4E9 : 3A 2F 00            		ld	a,(marsUpd)	; update?
(1) 1027/     4EC : B7                  		or	a
(1) 1028/     4ED : C8                  		ret	z
(1) 1029/     4EE : CF                  		rst	8
(1) 1030/     4EF : AF                  		xor	a
(1) 1031/     4F0 : 32 2F 00            		ld	(marsUpd),a
(1) 1032/     4F3 :                     .wait_enter:
(1) 1033/     4F3 : 00                  		nop
(1) 1034/     4F4 : FD 7E 2E            		ld	a,(iy+comm14)	; check if 68k got first.
(1) 1035/     4F7 : CB 7F               		bit	7,a
(1) 1036/     4F9 : 20 F8               		jr	nz,.wait_enter
(1) 1037/     4FB : E6 F0               		and	11110000b
(1) 1038/     4FD : F6 01               		or	1		; Set CMD task mode $01
(1) 1039/     4FF : FD 77 2E            		ld	(iy+comm14),a
(1) 1040/     502 : CF                  		rst	8
(1) 1041/     503 : E6 0F               		and	00001111b	; Did it write?
(1) 1042/     505 : FE 01               		cp	1
(1) 1043/     507 : 20 EA               		jr	nz,.wait_enter	; If not, retry.
(1) 1044/     509 : FD CB 2E FE         		set	7,(iy+comm14)	; Lock bit
(1) 1045/     50D : FD CB 03 CE         		set	1,(iy+standby)	; Request Slave CMD
(1) 1046/     511 : CF                  		rst	8
(1) 1047/     512 :                     .wait_cmd:
(1) 1048/     512 :                     ; 		bit	1,(iy+standby)	; <-- not needed
(1) 1049/     512 :                     ; 		jr	nz,.wait_cmd
(1) 1050/     512 : 0E 0E               		ld	c,14		; c - 14 words 2-byte
(1) 1051/     514 :                     .next_pass:
(1) 1052/     514 : FD E5               		push	iy
(1) 1053/     516 : E1                  		pop	hl
(1) 1054/     517 : CF                  		rst	8
(1) 1055/     518 : 11 28 00            		ld	de,comm8	; hl - comm8
(1) 1056/     51B : 19                  		add	hl,de
(1) 1057/     51C : 06 02               		ld	b,2
(1) 1058/     51E :                     .next_comm:
(1) 1059/     51E : DD 56 00            		ld	d,(ix)
(1) 1060/     521 : DD 5E 01            		ld	e,(ix+1)
(1) 1061/     524 : DD 23               		inc	ix
(1) 1062/     526 : DD 23               		inc	ix
(1) 1063/     528 : CF                  		rst	8
(1) 1064/     529 : 72                  		ld	(hl),d
(1) 1065/     52A : 23                  		inc	hl
(1) 1066/     52B : 73                  		ld	(hl),e
(1) 1067/     52C : 23                  		inc	hl
(1) 1068/     52D : 10 EF               		djnz	.next_comm
(1) 1069/     52F : FD CB 2E F6         		set	6,(iy+comm14)	; PASS data bit
(1) 1070/     533 : CF                  		rst	8
(1) 1071/     534 :                     .w_pass2:
(1) 1072/     534 : 00                  		nop
(1) 1073/     535 : FD CB 2E 76         		bit	6,(iy+comm14)	; PASS cleared?
(1) 1074/     539 : 20 F9               		jr	nz,.w_pass2
(1) 1075/     53B : 0D                  		dec	c
(1) 1076/     53C : 20 D6               		jr	nz,.next_pass
(1) 1077/     53E : FD CB 2E BE         		res	7,(iy+comm14)	; Break transfer loop
(1) 1078/     542 : FD CB 2E B6         		res	6,(iy+comm14)	; Clear CLK
(1) 1079/     546 : CF                  		rst	8
(1) 1080/     547 :                     .blocked:
(1) 1081/     547 : 21 40 16            		ld	hl,pwmcom
(1) 1082/     54A : 06 07               		ld	b,7		; MAX PWM channels
(1) 1083/     54C : AF                  		xor	a
(1) 1084/     54D :                     .clrcom:
(1) 1085/     54D : 77                  		ld	(hl),a		; Reset our COM bytes
(1) 1086/     54E : 23                  		inc	hl
(1) 1087/     54F : 10 FC               		djnz	.clrcom
(1) 1088/     551 : C9                  		ret
(1) 1089/     552 :                     
(1) 1090/     552 :                     ; --------------------------------------------------------
(1) 1091/     552 :                     ; Set and play instruments in their respective channels
(1) 1092/     552 :                     ; --------------------------------------------------------
(1) 1093/     552 :                     
(1) 1094/     552 :                     setupchip:
(1) 1095/     552 : 21 5B 18            		ld	hl,insDataC_0
(1) 1096/     555 : FD 21 60 19         		ld	iy,trkBuff_0		; iy - Tracker channels
(1) 1097/     559 : CD 63 05            		call	.mk_chip
(1) 1098/     55C : 21 DB 18            		ld	hl,insDataC_1
(1) 1099/     55F : FD 21 08 1A         		ld	iy,trkBuff_1
(1) 1100/     563 :                     .mk_chip:
(1) 1101/     563 : FD 7E 13            		ld	a,(iy+trk_status)	; enable bit? (as plus/minus test)
(1) 1102/     566 : B7                  		or	a
(1) 1103/     567 : F0                  		ret	p
(1) 1104/     568 :                     
(1) 1105/     568 : FD 7E 1A            		ld	a,(iy+trk_CmdReq)
(1) 1106/     56B : FD 36 1A 00         		ld	(iy+trk_CmdReq),0
(1) 1107/     56F : FE FF               		cp	-1
(1) 1108/     571 : 20 04               		jr	nz,.clr
(1) 1109/     573 : FD CB 13 BE         		res	7,(iy+trk_status)
(1) 1110/     577 :                     .clr:
(1) 1111/     577 :                     
(1) 1112/     577 : 22 40 1E            		ld	(currInsData),hl
(1) 1113/     57A : FD 22 46 1E         		ld	(currTrkCtrl),iy
(1) 1114/     57E :                     ; 		rst	8
(1) 1115/     57E : 11 20 00            		ld	de,20h
(1) 1116/     581 : FD 19               		add	iy,de
(1) 1117/     583 : 06 11               		ld	b,MAX_TRKCHN
(1) 1118/     585 :                     .nxt_chnl:
(1) 1119/     585 : FD 7E 01            		ld	a,(iy+chnl_Flags)	; Get status bits
(1) 1120/     588 : E6 0F               		and	00001111b
(1) 1121/     58A : B7                  		or	a			; Check for non-zero
(1) 1122/     58B : C4 97 05            		call	nz,.do_chnl
(1) 1123/     58E : CF                  		rst	8
(1) 1124/     58F : 11 08 00            		ld	de,8			; Next CHANNEL
(1) 1125/     592 : FD 19               		add	iy,de
(1) 1126/     594 : 10 EF               		djnz	.nxt_chnl
(1) 1127/     596 : C9                  		ret
(1) 1128/     597 :                     
(1) 1129/     597 :                     ; ----------------------------------------
(1) 1130/     597 :                     ; Channel requested update
(1) 1131/     597 :                     ;
(1) 1132/     597 :                     ; iy - Current channel
(1) 1133/     597 :                     ; ----------------------------------------
(1) 1134/     597 :                     
(1) 1135/     597 :                     .do_chnl:
(1) 1136/     597 : C5                  		push	bc
(1) 1137/     598 : CD 7D 0D            		call	.check_ins
(1) 1138/     59B : FE FF               		cp	-1			; NULL instrument?
(1) 1139/     59D : 28 39               		jr	z,.no_chnl
(1) 1140/     59F : CD 8D 0C            		call	.chip_swap		; check if this channel switched chip
(1) 1141/     5A2 : CD 90 0D            		call	.check_chnl		; a - chip requested
(1) 1142/     5A5 : FE FF               		cp	-1
(1) 1143/     5A7 : 28 25               		jr	z,.ran_out
(1) 1144/     5A9 : 22 44 1E            		ld	(currInsPos),hl
(1) 1145/     5AC : DD 22 42 1E         		ld	(currTblPos),ix
(1) 1146/     5B0 : E7                  		rst	20h
(1) 1147/     5B1 : FD CB 01 4E         		bit	1,(iy+chnl_Flags)
(1) 1148/     5B5 : C4 DE 05            		call	nz,.req_ins
(1) 1149/     5B8 : FD CB 01 56         		bit	2,(iy+chnl_Flags)
(1) 1150/     5BC : C4 3B 07            		call	nz,.req_vol
(1) 1151/     5BF : CF                  		rst	8
(1) 1152/     5C0 : FD CB 01 5E         		bit	3,(iy+chnl_Flags)
(1) 1153/     5C4 : C4 D6 07            		call	nz,.req_eff
(1) 1154/     5C7 : FD CB 01 46         		bit	0,(iy+chnl_Flags)
(1) 1155/     5CB : C4 32 0A            		call	nz,.req_note
(1) 1156/     5CE :                     ; 		ld	a,(iy+chnl_Flags)
(1) 1157/     5CE :                     ; 		and	1010b
(1) 1158/     5CE :                     ; 		or	a
(1) 1159/     5CE :                     ; 		call	nz,.req_note
(1) 1160/     5CE :                     
(1) 1161/     5CE :                     .ran_out:
(1) 1162/     5CE : FD 7E 01            		ld	a,(iy+chnl_Flags)	; Clear status bits
(1) 1163/     5D1 : E6 F0               		and	11110000b
(1) 1164/     5D3 : FD 77 01            		ld	(iy+chnl_Flags),a
(1) 1165/     5D6 : C1                  		pop	bc
(1) 1166/     5D7 : C9                  		ret
(1) 1167/     5D8 :                     .no_chnl:
(1) 1168/     5D8 :                     ; 		call	.chip_swap
(1) 1169/     5D8 : FD 36 00 00         		ld	(iy+chnl_Chip),0
(1) 1170/     5DC :                     ; 		ld	(ix+chnl_Flags),0
(1) 1171/     5DC : C1                  		pop	bc
(1) 1172/     5DD : C9                  		ret
(1) 1173/     5DE :                     
(1) 1174/     5DE :                     ; ----------------------------------------
(1) 1175/     5DE :                     ; bit 1: Intrument
(1) 1176/     5DE :                     ; ----------------------------------------
(1) 1177/     5DE :                     
(1) 1178/     5DE :                     .req_ins:
(1) 1179/     5DE : 2A 44 1E            		ld	hl,(currInsPos)
(1) 1180/     5E1 : DD 2A 42 1E         		ld	ix,(currTblPos)
(1) 1181/     5E5 : 7E                  		ld	a,(hl)
(1) 1182/     5E6 : E6 F0               		and	11110000b
(1) 1183/     5E8 : FE 80               		cp	80h		; PSG normal
(1) 1184/     5EA : 28 5A               		jr	z,.ins_psg
(1) 1185/     5EC : FE 90               		cp	90h		; PSG noise
(1) 1186/     5EE : 28 50               		jr	z,.ins_psgn
(1) 1187/     5F0 : CF                  		rst	8
(1) 1188/     5F1 : FE A0               		cp	0A0h		; FM normal
(1) 1189/     5F3 : CA BE 06            		jp	z,.ins_fm
(1) 1190/     5F6 : FE B0               		cp	0B0h		; FM special
(1) 1191/     5F8 : CA AF 06            		jp	z,.ins_fm3
(1) 1192/     5FB : FE C0               		cp	0C0h		; DAC
(1) 1193/     5FD : 28 76               		jr	z,.ins_dac
(1) 1194/     5FF : FE D0               		cp	0D0h		; PWM
(1) 1195/     601 : CA 05 06            		jp	z,.ins_pwm
(1) 1196/     604 : C9                  		ret
(1) 1197/     605 :                     
(1) 1198/     605 :                     ; --------------------------------
(1) 1199/     605 :                     ; FM,FM3,FM6
(1) 1200/     605 :                     ; --------------------------------
(1) 1201/     605 :                     
(1) 1202/     605 :                     .ins_pwm:
(1) 1203/     605 : 56                  		ld	d,(hl)		; d - Flags
(1) 1204/     606 : 23                  		inc	hl
(1) 1205/     607 : 7E                  		ld	a,(hl)		; Save pitch
(1) 1206/     608 : 23                  		inc	hl
(1) 1207/     609 : DD 77 03            		ld	(ix+3),a
(1) 1208/     60C : DD 7E 02            		ld	a,(ix+2)
(1) 1209/     60F : DD 21 40 16         		ld	ix,pwmcom	; ix - pwmcom
(1) 1210/     613 : E6 07               		and	000111b
(1) 1211/     615 : 06 00               		ld	b,0
(1) 1212/     617 : 4F                  		ld	c,a
(1) 1213/     618 : DD 09               		add	ix,bc
(1) 1214/     61A : 7E                  		ld	a,(hl)		; SH2 BANK
(1) 1215/     61B : 23                  		inc	hl
(1) 1216/     61C : E6 0F               		and	00001111b
(1) 1217/     61E : 47                  		ld	b,a		; b - Section, ROM or SDRAM
(1) 1218/     61F : DD 7E 18            		ld	a,(ix+PWOUTF)
(1) 1219/     622 : E6 30               		and	00110000b	; keep flag LR
(1) 1220/     624 : 4F                  		ld	c,a		; save them as C
(1) 1221/     625 : 7A                  		ld	a,d
(1) 1222/     626 : E6 03               		and	00000011b	; Stereo|Loop bits
(1) 1223/     628 : 0F                  		rrca			; carry...
(1) 1224/     629 : 0F                  		rrca
(1) 1225/     62A : B1                  		or	c
(1) 1226/     62B : B0                  		or	b
(1) 1227/     62C : DD 77 18            		ld	(ix+PWOUTF),a
(1) 1228/     62F : 7E                  		ld	a,(hl)		; Grab the 24-bit address (BIG endian)
(1) 1229/     630 : 23                  		inc	hl
(1) 1230/     631 : DD 77 20            		ld	(ix+PWINSH),a
(1) 1231/     634 : CF                  		rst	8
(1) 1232/     635 : 7E                  		ld	a,(hl)
(1) 1233/     636 : 23                  		inc	hl
(1) 1234/     637 : DD 77 28            		ld	(ix+PWINSM),a
(1) 1235/     63A : 7E                  		ld	a,(hl)
(1) 1236/     63B : 23                  		inc	hl
(1) 1237/     63C : DD 77 30            		ld	(ix+PWINSL),a
(1) 1238/     63F : C9                  		ret
(1) 1239/     640 :                     
(1) 1240/     640 :                     ; --------------------------------
(1) 1241/     640 :                     ; PSG1-3,PSGN
(1) 1242/     640 :                     ; --------------------------------
(1) 1243/     640 :                     
(1) 1244/     640 :                     .ins_psgn:
(1) 1245/     640 : 7E                  		ld	a,(hl)		; Extra bits for NOISE
(1) 1246/     641 : E6 07               		and	111b
(1) 1247/     643 : DD 77 04            		ld	(ix+4),a
(1) 1248/     646 :                     .ins_psg:
(1) 1249/     646 : CF                  		rst	8
(1) 1250/     647 : 23                  		inc	hl		; Skip ID
(1) 1251/     648 : 7E                  		ld	a,(hl)
(1) 1252/     649 : DD 77 03            		ld	(ix+3),a	; Save pitch
(1) 1253/     64C : 23                  		inc	hl
(1) 1254/     64D : DD 7E 02            		ld	a,(ix+2)
(1) 1255/     650 : E6 03               		and	11b
(1) 1256/     652 : 16 00               		ld	d,0
(1) 1257/     654 : 5F                  		ld	e,a
(1) 1258/     655 : DD 21 9C 16         		ld	ix,psgcom
(1) 1259/     659 : DD 19               		add	ix,de
(1) 1260/     65B : 7E                  		ld	a,(hl)
(1) 1261/     65C :                     
(1) 1262/     65C :                     	; TODO: ponerlos en un buffer separado
(1) 1263/     65C : DD 77 24            		ld	(ix+ALV),a	; ALV
(1) 1264/     65F : 23                  		inc	hl
(1) 1265/     660 : 7E                  		ld	a,(hl)
(1) 1266/     661 : DD 77 08            		ld	(ix+ATK),a	; ATK
(1) 1267/     664 : 23                  		inc	hl
(1) 1268/     665 : CF                  		rst	8
(1) 1269/     666 : 7E                  		ld	a,(hl)
(1) 1270/     667 : DD 77 10            		ld	(ix+SLV),a	; SLV
(1) 1271/     66A : 23                  		inc	hl
(1) 1272/     66B : 7E                  		ld	a,(hl)
(1) 1273/     66C : DD 77 0C            		ld	(ix+DKY),a	; DKY
(1) 1274/     66F : 23                  		inc	hl
(1) 1275/     670 : 7E                  		ld	a,(hl)
(1) 1276/     671 : DD 77 14            		ld	(ix+RRT),a	; RRT
(1) 1277/     674 : C9                  		ret
(1) 1278/     675 :                     
(1) 1279/     675 :                     ; --------------------------------
(1) 1280/     675 :                     ; FM,FM3,FM6
(1) 1281/     675 :                     ; --------------------------------
(1) 1282/     675 :                     
(1) 1283/     675 :                     .ins_dac:
(1) 1284/     675 : DD 36 04 01         		ld	(ix+4),1	; e - alternate mode flag (FM6 as DAC)
(1) 1285/     679 : 7E                  		ld	a,(hl)		; Grab flags from ID
(1) 1286/     67A : E6 01               		and	001b
(1) 1287/     67C : 32 56 1E            		ld	(wave_Flags),a
(1) 1288/     67F : 23                  		inc	hl
(1) 1289/     680 : 7E                  		ld	a,(hl)		; Save pitch
(1) 1290/     681 : DD 77 03            		ld	(ix+3),a
(1) 1291/     684 : 23                  		inc	hl
(1) 1292/     685 : 4E                  		ld	c,(hl)		; Grab the 24-bit address
(1) 1293/     686 : 23                  		inc	hl		; big endian this time.
(1) 1294/     687 : CF                  		rst	8
(1) 1295/     688 : 56                  		ld	d,(hl)
(1) 1296/     689 : 23                  		inc	hl
(1) 1297/     68A : 5E                  		ld	e,(hl)
(1) 1298/     68B :                     
(1) 1299/     68B : CF                  		rst	8
(1) 1300/     68C : 6B                  		ld	l,e
(1) 1301/     68D : 62                  		ld	h,d
(1) 1302/     68E : 79                  		ld	a,c
(1) 1303/     68F : E5                  		push	hl		; Recieve LEN and LOOP
(1) 1304/     690 : F5                  		push	af		; from the WAVE itself
(1) 1305/     691 : 11 4E 1E            		ld	de,wave_Len
(1) 1306/     694 : 01 06 00            		ld	bc,6
(1) 1307/     697 : CF                  		rst	8
(1) 1308/     698 : CD 1F 0F            		call	transferRom
(1) 1309/     69B : F1                  		pop	af
(1) 1310/     69C : E1                  		pop	hl
(1) 1311/     69D : 01 06 00            		ld	bc,6		; skip LEN point
(1) 1312/     6A0 : 09                  		add	hl,bc
(1) 1313/     6A1 : CE 00               		adc	a,0
(1) 1314/     6A3 : 22 4B 1E            		ld	(wave_Start),hl	; save START point
(1) 1315/     6A6 : 32 4D 1E            		ld	(wave_Start+2),a
(1) 1316/     6A9 : 3E 04               		ld	a,100b		; Force FM6 off
(1) 1317/     6AB : 32 7D 16            		ld	(fmcom+5),a
(1) 1318/     6AE : C9                  		ret
(1) 1319/     6AF :                     
(1) 1320/     6AF :                     ; FM3 special mode
(1) 1321/     6AF :                     .ins_fm3:
(1) 1322/     6AF : 3E 02               		ld	a,2		; manual index
(1) 1323/     6B1 : 1E 01               		ld	e,1		; set as alternate FM
(1) 1324/     6B3 : CD E9 06            		call	.rd_fmins
(1) 1325/     6B6 : 21 7A 16            		ld	hl,fmcom+2
(1) 1326/     6B9 : 7E                  		ld	a,(hl)		; instrument update bit
(1) 1327/     6BA : F6 10               		or	00010000b	; flag
(1) 1328/     6BC : 77                  		ld	(hl),a
(1) 1329/     6BD : C9                  		ret
(1) 1330/     6BE :                     ; Regular FM
(1) 1331/     6BE :                     .ins_fm:
(1) 1332/     6BE : CF                  		rst	8
(1) 1333/     6BF : 1E 00               		ld	e,0		; Set as normal FM
(1) 1334/     6C1 : DD 7E 02            		ld	a,(ix+2)
(1) 1335/     6C4 : E6 07               		and	00000111b
(1) 1336/     6C6 : FE 05               		cp	5		; Check if we are on FM6
(1) 1337/     6C8 : 20 08               		jr	nz,.not_prdac
(1) 1338/     6CA : 57                  		ld	d,a
(1) 1339/     6CB : 3E 04               		ld	a,100b		; Force DAC stop
(1) 1340/     6CD : CF                  		rst	8
(1) 1341/     6CE : 32 CC 17            		ld	(daccom),a
(1) 1342/     6D1 : 7A                  		ld	a,d
(1) 1343/     6D2 :                     .not_prdac:
(1) 1344/     6D2 : 1E 00               		ld	e,0		; Set as Normal
(1) 1345/     6D4 : CD E9 06            		call	.rd_fmins
(1) 1346/     6D7 : DD 7E 02            		ld	a,(ix+2)
(1) 1347/     6DA : E6 07               		and	00000111b
(1) 1348/     6DC : 16 00               		ld	d,0
(1) 1349/     6DE : CF                  		rst	8
(1) 1350/     6DF : 5F                  		ld	e,a
(1) 1351/     6E0 : 21 78 16            		ld	hl,fmcom
(1) 1352/     6E3 : 19                  		add	hl,de
(1) 1353/     6E4 : 7E                  		ld	a,(hl)		; instrument update bit
(1) 1354/     6E5 : F6 10               		or	00010000b	; flag
(1) 1355/     6E7 : 77                  		ld	(hl),a
(1) 1356/     6E8 : C9                  		ret
(1) 1357/     6E9 :                     
(1) 1358/     6E9 :                     ; Read FM instrument
(1) 1359/     6E9 :                     ;
(1) 1360/     6E9 :                     ; e - alternate mode flag
(1) 1361/     6E9 :                     .rd_fmins:
(1) 1362/     6E9 : DD 73 04            		ld	(ix+4),e	; e - alternate mode flag
(1) 1363/     6EC : 23                  		inc	hl		; skip ID and pitch
(1) 1364/     6ED : 5E                  		ld	e,(hl)
(1) 1365/     6EE : DD 73 03            		ld	(ix+3),e	; save pitch
(1) 1366/     6F1 : 23                  		inc	hl
(1) 1367/     6F2 : 87                  		add	a,a
(1) 1368/     6F3 : 16 00               		ld	d,0
(1) 1369/     6F5 : 5F                  		ld	e,a
(1) 1370/     6F6 : CF                  		rst	8
(1) 1371/     6F7 : E5                  		push	hl		; save ins hl
(1) 1372/     6F8 : 21 2F 07            		ld	hl,.fmpickins
(1) 1373/     6FB : 19                  		add	hl,de
(1) 1374/     6FC : 5E                  		ld	e,(hl)		; get output location
(1) 1375/     6FD : 23                  		inc	hl		; from list
(1) 1376/     6FE : 56                  		ld	d,(hl)
(1) 1377/     6FF : CF                  		rst	8
(1) 1378/     700 : E1                  		pop	hl
(1) 1379/     701 : 7E                  		ld	a,(hl)		; a - xx0000
(1) 1380/     702 : 23                  		inc	hl
(1) 1381/     703 : 4E                  		ld	c,(hl)		; c - 00xx00
(1) 1382/     704 : 23                  		inc	hl
(1) 1383/     705 : 6E                  		ld	l,(hl)		; l - 0000xx
(1) 1384/     706 : 61                  		ld	h,c		; c to h
(1) 1385/     707 : D5                  		push	de
(1) 1386/     708 : CF                  		rst	8
(1) 1387/     709 : 4F                  		ld	c,a
(1) 1388/     70A : DD 7E 07            		ld	a,(ix+7)
(1) 1389/     70D : B9                  		cp	c
(1) 1390/     70E : 20 0C               		jr	nz,.confm_rd
(1) 1391/     710 : DD 7E 06            		ld	a,(ix+6)
(1) 1392/     713 : BC                  		cp	h
(1) 1393/     714 : 20 06               		jr	nz,.confm_rd
(1) 1394/     716 : DD 7E 05            		ld	a,(ix+5)
(1) 1395/     719 : BD                  		cp	l
(1) 1396/     71A : 28 11               		jr	z,.fmsame_ins
(1) 1397/     71C :                     .confm_rd:
(1) 1398/     71C : CF                  		rst	8
(1) 1399/     71D : DD 75 05            		ld	(ix+5),l
(1) 1400/     720 : DD 74 06            		ld	(ix+6),h
(1) 1401/     723 : DD 71 07            		ld	(ix+7),c
(1) 1402/     726 : 79                  		ld	a,c
(1) 1403/     727 : 01 28 00            		ld	bc,028h		; 28h bytes
(1) 1404/     72A : CD 1F 0F            		call	transferRom	; Transfer instrument data from ROM
(1) 1405/     72D :                     .fmsame_ins:
(1) 1406/     72D : E1                  		pop	hl
(1) 1407/     72E : C9                  		ret
(1) 1408/     72F :                     
(1) 1409/     72F :                     ; manual location for each instr cache
(1) 1410/     72F :                     ; 28h bytes each
(1) 1411/     72F :                     .fmpickins:
(1) 1412/     72F : D0 16               		dw fmins_com
(1) 1413/     731 : F8 16               		dw fmins_com2
(1) 1414/     733 : 20 17               		dw fmins_com3
(1) 1415/     735 : 48 17               		dw fmins_com4
(1) 1416/     737 : 70 17               		dw fmins_com5
(1) 1417/     739 : 98 17               		dw fmins_com6
(1) 1418/     73B :                     
(1) 1419/     73B :                     ; ----------------------------------------
(1) 1420/     73B :                     ; bit 2
(1) 1421/     73B :                     ; ----------------------------------------
(1) 1422/     73B :                     
(1) 1423/     73B :                     .req_vol:
(1) 1424/     73B : 2A 44 1E            		ld	hl,(currInsPos)
(1) 1425/     73E : DD 2A 42 1E         		ld	ix,(currTblPos)
(1) 1426/     742 : 7E                  		ld	a,(hl)
(1) 1427/     743 : E6 F0               		and	11110000b
(1) 1428/     745 : FE 80               		cp	80h		; PSG normal
(1) 1429/     747 : 28 45               		jr	z,.vol_psg
(1) 1430/     749 : FE 90               		cp	90h		; PSG noise
(1) 1431/     74B : 28 41               		jr	z,.vol_psg
(1) 1432/     74D : CF                  		rst	8
(1) 1433/     74E : FE A0               		cp	0A0h		; FM normal
(1) 1434/     750 : 28 5F               		jr	z,.vol_fm
(1) 1435/     752 : FE B0               		cp	0B0h		; FM special (same thing)
(1) 1436/     754 : 28 5B               		jr	z,.vol_fm
(1) 1437/     756 :                     ; 		cp	0C0h		; DAC
(1) 1438/     756 :                     ; 		jr	z,.vol_dac
(1) 1439/     756 : FE D0               		cp	0D0h		; PWM
(1) 1440/     758 : 28 01               		jr	z,.vol_pwm
(1) 1441/     75A : C9                  		ret
(1) 1442/     75B :                     
(1) 1443/     75B :                     ; --------------------------------
(1) 1444/     75B :                     ; FM,FM3,FM6
(1) 1445/     75B :                     .vol_pwm:
(1) 1446/     75B : 01 00 00            		ld	bc,0
(1) 1447/     75E : DD 7E 02            		ld	a,(ix+2)
(1) 1448/     761 : E6 07               		and	00000111b
(1) 1449/     763 : 4F                  		ld	c,a
(1) 1450/     764 : CF                  		rst	8
(1) 1451/     765 : DD 21 40 16         		ld	ix,pwmcom
(1) 1452/     769 : DD 09               		add	ix,bc
(1) 1453/     76B : DD 7E 08            		ld	a,(ix+PWPTH_V)
(1) 1454/     76E : E6 03               		and	00000011b
(1) 1455/     770 : 4F                  		ld	c,a		; c - MSB Pitch bits
(1) 1456/     771 : FD 7E 04            		ld	a,(iy+chnl_Vol)
(1) 1457/     774 : D6 40               		sub	a,40h
(1) 1458/     776 : CF                  		rst	8
(1) 1459/     777 : ED 44               		neg	a		; reverse impulse volume
(1) 1460/     779 : 87                  		add	a,a
(1) 1461/     77A : 87                  		add	a,a
(1) 1462/     77B : 30 03               		jr	nc,.pvmuch
(1) 1463/     77D : 3E FF               		ld	a,-1
(1) 1464/     77F : CF                  		rst	8
(1) 1465/     780 :                     .pvmuch:
(1) 1466/     780 : B1                  		or	c
(1) 1467/     781 : DD 77 08            		ld	(ix+PWPTH_V),a
(1) 1468/     784 : DD CB 00 EE         		set	5,(ix)		; set volume update bit
(1) 1469/     788 : 3E 01               		ld	a,1
(1) 1470/     78A : 32 2F 00            		ld	(marsUpd),a
(1) 1471/     78D : C9                  		ret
(1) 1472/     78E :                     
(1) 1473/     78E :                     ; --------------------------------
(1) 1474/     78E :                     ; PSG1-3,PSGN
(1) 1475/     78E :                     
(1) 1476/     78E :                     .vol_psg:
(1) 1477/     78E : DD 7E 02            		ld	a,(ix+2)
(1) 1478/     791 : DD 21 9C 16         		ld	ix,psgcom
(1) 1479/     795 : E6 03               		and	11b
(1) 1480/     797 : 16 00               		ld	d,0
(1) 1481/     799 : 5F                  		ld	e,a
(1) 1482/     79A : DD 19               		add	ix,de
(1) 1483/     79C : FD 7E 04            		ld	a,(iy+chnl_Vol)
(1) 1484/     79F : D6 40               		sub	a,40h
(1) 1485/     7A1 : ED 44               		neg	a
(1) 1486/     7A3 : 4F                  		ld	c,a
(1) 1487/     7A4 : FE 40               		cp	40h
(1) 1488/     7A6 : 20 02               		jr	nz,.vmuch
(1) 1489/     7A8 : 0E FF               		ld	c,-1
(1) 1490/     7AA :                     .vmuch:
(1) 1491/     7AA : 79                  		ld	a,c
(1) 1492/     7AB : 87                  		add	a,a
(1) 1493/     7AC : 87                  		add	a,a
(1) 1494/     7AD : DD 77 30            		ld	(ix+PVOL),a
(1) 1495/     7B0 :                     ; 		ld	a,(ix)
(1) 1496/     7B0 :                     ; 		or	00100000b	; Set volume
(1) 1497/     7B0 :                     ; 		ld	(ix),a		; update flag
(1) 1498/     7B0 : C9                  		ret
(1) 1499/     7B1 :                     
(1) 1500/     7B1 :                     ; --------------------------------
(1) 1501/     7B1 :                     ; FM,FM3,FM6
(1) 1502/     7B1 :                     .vol_fm:
(1) 1503/     7B1 : 01 00 00            		ld	bc,0
(1) 1504/     7B4 : DD 7E 02            		ld	a,(ix+2)
(1) 1505/     7B7 : E6 07               		and	00000111b
(1) 1506/     7B9 : 4F                  		ld	c,a
(1) 1507/     7BA : DD 21 78 16         		ld	ix,fmcom
(1) 1508/     7BE : DD 09               		add	ix,bc
(1) 1509/     7C0 : FD 7E 04            		ld	a,(iy+chnl_Vol)
(1) 1510/     7C3 : D6 40               		sub	a,40h
(1) 1511/     7C5 : CF                  		rst	8
(1) 1512/     7C6 : ED 44               		neg	a		; reverse impulse volume
(1) 1513/     7C8 : CB 3F               		srl	a		; /2
(1) 1514/     7CA : DD 77 0C            		ld	(ix+FMVOL),a
(1) 1515/     7CD : DD 7E 00            		ld	a,(ix)		; volume update
(1) 1516/     7D0 : F6 20               		or	00100000b	; flag, plus keyon
(1) 1517/     7D2 : DD 77 00            		ld	(ix),a
(1) 1518/     7D5 : C9                  		ret
(1) 1519/     7D6 :                     
(1) 1520/     7D6 :                     ; ----------------------------------------
(1) 1521/     7D6 :                     ; bit 3
(1) 1522/     7D6 :                     ; ----------------------------------------
(1) 1523/     7D6 :                     
(1) 1524/     7D6 :                     .req_eff:
(1) 1525/     7D6 : 2A 44 1E            		ld	hl,(currInsPos)
(1) 1526/     7D9 : DD 2A 42 1E         		ld	ix,(currTblPos)
(1) 1527/     7DD : FD 7E 05            		ld	a,(iy+chnl_EffId)	; effect id == 0?
(1) 1528/     7E0 : B7                  		or	a
(1) 1529/     7E1 : C8                  		ret	z
(1) 1530/     7E2 : 57                  		ld	d,a
(1) 1531/     7E3 : 7E                  		ld	a,(hl)
(1) 1532/     7E4 : E6 F0               		and	11110000b
(1) 1533/     7E6 : FD 5E 06            		ld	e,(iy+chnl_EffArg)
(1) 1534/     7E9 : CF                  		rst	8
(1) 1535/     7EA : FE 80               		cp	80h			; PSG normal
(1) 1536/     7EC : 28 16               		jr	z,.eff_psg
(1) 1537/     7EE : FE 90               		cp	90h			; PSG noise
(1) 1538/     7F0 : 28 12               		jr	z,.eff_psg
(1) 1539/     7F2 : FE A0               		cp	0A0h			; FM Normal
(1) 1540/     7F4 : 28 21               		jr	z,.eff_fm
(1) 1541/     7F6 : CF                  		rst	8
(1) 1542/     7F7 : FE B0               		cp	0B0h			; FM Special
(1) 1543/     7F9 : 28 1C               		jr	z,.eff_fm
(1) 1544/     7FB : FE C0               		cp	0C0h			; DAC
(1) 1545/     7FD : 28 2F               		jr	z,.eff_dac
(1) 1546/     7FF : FE D0               		cp	0D0h			; PWM
(1) 1547/     801 : 28 3D               		jr	z,.eff_pwm
(1) 1548/     803 : C9                  		ret
(1) 1549/     804 :                     
(1) 1550/     804 :                     ; --------------------------------
(1) 1551/     804 :                     
(1) 1552/     804 :                     .eff_psg:
(1) 1553/     804 : 7A                  		ld	a,d
(1) 1554/     805 : FE 04               		cp	4		; Effect D?
(1) 1555/     807 : CA 57 08            		jp	z,.effPsg_D
(1) 1556/     80A : FE 05               		cp	5		; Effect E?
(1) 1557/     80C : CA D7 08            		jp	z,.effPsg_E
(1) 1558/     80F : CF                  		rst	8
(1) 1559/     810 : FE 06               		cp	6		; Effect F?
(1) 1560/     812 : CA 09 09            		jp	z,.effPsg_F
(1) 1561/     815 : CF                  		rst	8
(1) 1562/     816 : C9                  		ret
(1) 1563/     817 :                     .eff_fm:
(1) 1564/     817 : 7A                  		ld	a,d
(1) 1565/     818 : FE 04               		cp	4		; Effect D?
(1) 1566/     81A : CA 85 08            		jp	z,.effFm_D
(1) 1567/     81D : FE 05               		cp	5		; Effect E?
(1) 1568/     81F : CA E1 08            		jp	z,.effFm_E
(1) 1569/     822 : CF                  		rst	8
(1) 1570/     823 : FE 06               		cp	6		; Effect F?
(1) 1571/     825 : CA 17 09            		jp	z,.effFm_F
(1) 1572/     828 : FE 18               		cp	24		; Effect X?
(1) 1573/     82A : CA F4 09            		jp	z,.effFm_X
(1) 1574/     82D : C9                  		ret
(1) 1575/     82E :                     .eff_dac:
(1) 1576/     82E : 7A                  		ld	a,d
(1) 1577/     82F : FE 05               		cp	5		; Effect E?
(1) 1578/     831 : CA EF 08            		jp	z,.effDac_E
(1) 1579/     834 : FE 06               		cp	6		; Effect F?
(1) 1580/     836 : CA 1E 09            		jp	z,.effDac_F
(1) 1581/     839 : CF                  		rst	8
(1) 1582/     83A : FE 18               		cp	24		; Effect X?
(1) 1583/     83C : CA F4 09            		jp	z,.effFm_X
(1) 1584/     83F : C9                  		ret
(1) 1585/     840 :                     .eff_pwm:
(1) 1586/     840 : 3E 01               		ld	a,1
(1) 1587/     842 : 32 2F 00            		ld	(marsUpd),a
(1) 1588/     845 : 7A                  		ld	a,d
(1) 1589/     846 :                     ; 		cp	4		; Effect D?
(1) 1590/     846 :                     ; 		jp	z,.effFm_D
(1) 1591/     846 : FE 05               		cp	5		; Effect E?
(1) 1592/     848 : CA FC 08            		jp	z,.effPwm_E
(1) 1593/     84B : CF                  		rst	8
(1) 1594/     84C : FE 06               		cp	6		; Effect F?
(1) 1595/     84E : CA 24 09            		jp	z,.effPwm_F
(1) 1596/     851 : FE 18               		cp	24		; Effect X?
(1) 1597/     853 : CA DB 09            		jp	z,.effPwm_X	; recycle FM's panning
(1) 1598/     856 : C9                  		ret
(1) 1599/     857 :                     
(1) 1600/     857 :                     ; --------------------------------
(1) 1601/     857 :                     ; Effect D
(1) 1602/     857 :                     ; --------------------------------
(1) 1603/     857 :                     
(1) 1604/     857 :                     .effPsg_D:
(1) 1605/     857 : 7B                  		ld	a,e
(1) 1606/     858 : B7                  		or	a
(1) 1607/     859 : C8                  		ret	z
(1) 1608/     85A : 06 00               		ld	b,0
(1) 1609/     85C : DD 7E 02            		ld	a,(ix+2)
(1) 1610/     85F : E6 03               		and	011b
(1) 1611/     861 : 4F                  		ld	c,a
(1) 1612/     862 : DD 21 9C 16         		ld	ix,psgcom
(1) 1613/     866 : DD 09               		add	ix,bc
(1) 1614/     868 : CD B4 08            		call	.grab_dval
(1) 1615/     86B : 87                  		add	a,a
(1) 1616/     86C : 87                  		add	a,a
(1) 1617/     86D : 87                  		add	a,a
(1) 1618/     86E : 4F                  		ld	c,a
(1) 1619/     86F : CB 79               		bit	7,c
(1) 1620/     871 : 20 09               		jr	nz,.lowp
(1) 1621/     873 : DD 7E 30            		ld	a,(ix+PVOL)
(1) 1622/     876 : 81                  		add	a,c
(1) 1623/     877 : D8                  		ret	c
(1) 1624/     878 : DD 77 30            		ld	(ix+PVOL),a
(1) 1625/     87B : C9                  		ret
(1) 1626/     87C :                     .lowp:
(1) 1627/     87C : DD 7E 30            		ld	a,(ix+PVOL)
(1) 1628/     87F : 81                  		add	a,c
(1) 1629/     880 : D0                  		ret	nc
(1) 1630/     881 : DD 77 30            		ld	(ix+PVOL),a
(1) 1631/     884 : C9                  		ret
(1) 1632/     885 :                     .effFm_D:
(1) 1633/     885 : 7B                  		ld	a,e
(1) 1634/     886 : B7                  		or	a
(1) 1635/     887 : C8                  		ret	z
(1) 1636/     888 : 06 00               		ld	b,0
(1) 1637/     88A : DD 7E 02            		ld	a,(ix+2)
(1) 1638/     88D : E6 07               		and	111b
(1) 1639/     88F : 4F                  		ld	c,a
(1) 1640/     890 : DD 21 78 16         		ld	ix,fmcom
(1) 1641/     894 : DD 09               		add	ix,bc
(1) 1642/     896 : CD B4 08            		call	.grab_dval
(1) 1643/     899 :                     ; 		srl	a		; TODO: checar que tanto
(1) 1644/     899 :                     ; 		srl	a		; shifteo esto
(1) 1645/     899 : 4F                  		ld	c,a
(1) 1646/     89A : DD CB 00 EE         		set	5,(ix)
(1) 1647/     89E : CB 79               		bit	7,c
(1) 1648/     8A0 : 20 09               		jr	nz,.lowpf
(1) 1649/     8A2 : DD 7E 0C            		ld	a,(ix+FMVOL)
(1) 1650/     8A5 : 81                  		add	a,c
(1) 1651/     8A6 : D8                  		ret	c
(1) 1652/     8A7 : DD 77 0C            		ld	(ix+FMVOL),a
(1) 1653/     8AA : C9                  		ret
(1) 1654/     8AB :                     .lowpf:
(1) 1655/     8AB : DD 7E 0C            		ld	a,(ix+FMVOL)
(1) 1656/     8AE : 81                  		add	a,c
(1) 1657/     8AF : D0                  		ret	nc
(1) 1658/     8B0 : DD 77 0C            		ld	(ix+FMVOL),a
(1) 1659/     8B3 : C9                  		ret
(1) 1660/     8B4 :                     
(1) 1661/     8B4 :                     ; a - increment/decrement value
(1) 1662/     8B4 :                     .grab_dval:
(1) 1663/     8B4 : 7B                  		ld	a,e
(1) 1664/     8B5 : E6 F0               		and	11110000b
(1) 1665/     8B7 : FE F0               		cp	11110000b
(1) 1666/     8B9 : 28 03               		jr	z,.go_down
(1) 1667/     8BB : B7                  		or	a
(1) 1668/     8BC : 20 09               		jr	nz,.go_up
(1) 1669/     8BE :                     .go_down:
(1) 1670/     8BE : 7B                  		ld	a,e
(1) 1671/     8BF : E6 0F               		and	00001111b
(1) 1672/     8C1 : CB 7B               		bit	7,e
(1) 1673/     8C3 : C0                  		ret	nz
(1) 1674/     8C4 : 87                  		add	a,a
(1) 1675/     8C5 : CF                  		rst	8
(1) 1676/     8C6 : C9                  		ret
(1) 1677/     8C7 :                     .go_up:
(1) 1678/     8C7 : 7B                  		ld	a,e
(1) 1679/     8C8 : 0F                  		rrca
(1) 1680/     8C9 : 0F                  		rrca
(1) 1681/     8CA : 0F                  		rrca
(1) 1682/     8CB : 0F                  		rrca
(1) 1683/     8CC : CF                  		rst	8
(1) 1684/     8CD : E6 0F               		and	00001111b
(1) 1685/     8CF : ED 44               		neg	a
(1) 1686/     8D1 : CB 5B               		bit	3,e
(1) 1687/     8D3 : C0                  		ret	nz
(1) 1688/     8D4 : 87                  		add	a,a
(1) 1689/     8D5 : CF                  		rst	8
(1) 1690/     8D6 : C9                  		ret
(1) 1691/     8D7 :                     
(1) 1692/     8D7 :                     ; --------------------------------
(1) 1693/     8D7 :                     ; Effect E
(1) 1694/     8D7 :                     ; --------------------------------
(1) 1695/     8D7 :                     
(1) 1696/     8D7 :                     .effPsg_E:
(1) 1697/     8D7 : CD BC 09            		call	.grab_prtm
(1) 1698/     8DA : 16 00               		ld	d,0
(1) 1699/     8DC : 87                  		add	a,a
(1) 1700/     8DD : 5F                  		ld	e,a
(1) 1701/     8DE : C3 92 09            		jp	.freqinc_psg
(1) 1702/     8E1 :                     .effFm_E:
(1) 1703/     8E1 : CD BC 09            		call	.grab_prtm
(1) 1704/     8E4 : ED 44               		neg	a
(1) 1705/     8E6 : B7                  		or	a
(1) 1706/     8E7 : 28 02               		jr	z,.e_neg
(1) 1707/     8E9 : 16 FF               		ld	d,-1
(1) 1708/     8EB :                     .e_neg:
(1) 1709/     8EB : 5F                  		ld	e,a
(1) 1710/     8EC : C3 6C 09            		jp	.freqinc_fm
(1) 1711/     8EF :                     .effDac_E:
(1) 1712/     8EF : CD BC 09            		call	.grab_prtm
(1) 1713/     8F2 : ED 44               		neg	a
(1) 1714/     8F4 : B7                  		or	a
(1) 1715/     8F5 : 28 02               		jr	z,.e_negd
(1) 1716/     8F7 : 16 FF               		ld	d,-1
(1) 1717/     8F9 :                     .e_negd:
(1) 1718/     8F9 : 5F                  		ld	e,a
(1) 1719/     8FA : 18 60               		jr	.freqinc_dac
(1) 1720/     8FC :                     
(1) 1721/     8FC :                     .effPwm_E:
(1) 1722/     8FC : CD BC 09            		call	.grab_prtm
(1) 1723/     8FF :                     ; 		sra	a
(1) 1724/     8FF :                     ; 		sra	a
(1) 1725/     8FF : ED 44               		neg	a
(1) 1726/     901 : B7                  		or	a
(1) 1727/     902 : 28 02               		jr	z,.e_fnegd2
(1) 1728/     904 : 16 FF               		ld	d,-1
(1) 1729/     906 :                     .e_fnegd2:
(1) 1730/     906 : 5F                  		ld	e,a
(1) 1731/     907 : 18 1F               		jr	.freqinc_pwm
(1) 1732/     909 :                     
(1) 1733/     909 :                     ; --------------------------------
(1) 1734/     909 :                     ; Effect F
(1) 1735/     909 :                     ; --------------------------------
(1) 1736/     909 :                     
(1) 1737/     909 :                     ; PSG
(1) 1738/     909 :                     .effPsg_F:
(1) 1739/     909 : CD BC 09            		call	.grab_prtm
(1) 1740/     90C : 87                  		add	a,a
(1) 1741/     90D : ED 44               		neg	a
(1) 1742/     90F : B7                  		or	a
(1) 1743/     910 : 28 02               		jr	z,.e_negp
(1) 1744/     912 : 16 FF               		ld	d,-1
(1) 1745/     914 :                     .e_negp:
(1) 1746/     914 : 5F                  		ld	e,a
(1) 1747/     915 : 18 7B               		jr	.freqinc_psg
(1) 1748/     917 :                     .effFm_F:
(1) 1749/     917 : CD BC 09            		call	.grab_prtm
(1) 1750/     91A : 87                  		add	a,a
(1) 1751/     91B : 5F                  		ld	e,a
(1) 1752/     91C : 18 4E               		jr	.freqinc_fm
(1) 1753/     91E :                     .effDac_F:
(1) 1754/     91E : CD BC 09            		call	.grab_prtm
(1) 1755/     921 : 5F                  		ld	e,a
(1) 1756/     922 : 18 38               		jr	.freqinc_dac
(1) 1757/     924 :                     .effPwm_F:
(1) 1758/     924 : CD BC 09            		call	.grab_prtm
(1) 1759/     927 :                     ; 		sra	a
(1) 1760/     927 :                     ; 		sra	a
(1) 1761/     927 : 5F                  		ld	e,a
(1) 1762/     928 :                     
(1) 1763/     928 :                     ; --------------------------------
(1) 1764/     928 :                     ; For effects E and F:
(1) 1765/     928 :                     ;
(1) 1766/     928 :                     ; de - freq incr/decr
(1) 1767/     928 :                     
(1) 1768/     928 :                     .freqinc_pwm:
(1) 1769/     928 : DD 7E 02            		ld	a,(ix+2)
(1) 1770/     92B : E6 07               		and	111b
(1) 1771/     92D : DD 21 40 16         		ld	ix,pwmcom
(1) 1772/     931 : 06 00               		ld	b,0
(1) 1773/     933 : 4F                  		ld	c,a
(1) 1774/     934 : CF                  		rst	8
(1) 1775/     935 : DD 09               		add	ix,bc
(1) 1776/     937 : DD 7E 08            		ld	a,(ix+PWPTH_V)
(1) 1777/     93A : E6 03               		and	00000011b
(1) 1778/     93C : 67                  		ld	h,a
(1) 1779/     93D : DD 6E 10            		ld	l,(ix+PWPHL)
(1) 1780/     940 : 19                  		add	hl,de
(1) 1781/     941 : DD 7E 08            		ld	a,(ix+PWPTH_V)
(1) 1782/     944 : E6 FC               		and	11111100b
(1) 1783/     946 : CF                  		rst	8
(1) 1784/     947 : B4                  		or	h
(1) 1785/     948 : DD 77 08            		ld	(ix+PWPTH_V),a
(1) 1786/     94B : DD 75 10            		ld	(ix+PWPHL),l
(1) 1787/     94E : DD 7E 00            		ld	a,(ix)			; pitch bend request
(1) 1788/     951 : F6 10               		or	00010000b
(1) 1789/     953 : DD 77 00            		ld	(ix),a
(1) 1790/     956 : 3E 01               		ld	a,1
(1) 1791/     958 : 32 2F 00            		ld	(marsUpd),a
(1) 1792/     95B : C9                  		ret
(1) 1793/     95C :                     
(1) 1794/     95C :                     .freqinc_dac:
(1) 1795/     95C : 2A 54 1E            		ld	hl,(wave_Pitch)		; tricky one...
(1) 1796/     95F : 19                  		add	hl,de
(1) 1797/     960 : 22 54 1E            		ld	(wave_Pitch),hl
(1) 1798/     963 : 3A CC 17            		ld	a,(daccom)
(1) 1799/     966 : F6 10               		or	00010000b
(1) 1800/     968 : 32 CC 17            		ld	(daccom),a
(1) 1801/     96B : C9                  		ret
(1) 1802/     96C :                     
(1) 1803/     96C :                     .freqinc_fm:
(1) 1804/     96C : DD 7E 02            		ld	a,(ix+2)
(1) 1805/     96F : E6 07               		and	111b
(1) 1806/     971 : DD 21 78 16         		ld	ix,fmcom
(1) 1807/     975 : 06 00               		ld	b,0
(1) 1808/     977 : 4F                  		ld	c,a
(1) 1809/     978 : CF                  		rst	8
(1) 1810/     979 : DD 09               		add	ix,bc
(1) 1811/     97B : DD 66 18            		ld	h,(ix+FMFRQH)
(1) 1812/     97E : DD 6E 1E            		ld	l,(ix+FMFRQL)
(1) 1813/     981 : 19                  		add	hl,de
(1) 1814/     982 : DD 74 18            		ld	(ix+FMFRQH),h
(1) 1815/     985 : CF                  		rst	8
(1) 1816/     986 : DD 75 1E            		ld	(ix+FMFRQL),l
(1) 1817/     989 : DD 7E 00            		ld	a,(ix)
(1) 1818/     98C : F6 01               		or	00000001b
(1) 1819/     98E : DD 77 00            		ld	(ix),a
(1) 1820/     991 : C9                  		ret
(1) 1821/     992 :                     .freqinc_psg:
(1) 1822/     992 : DD 7E 02            		ld	a,(ix+2)
(1) 1823/     995 : E6 03               		and	011b
(1) 1824/     997 : DD 21 9C 16         		ld	ix,psgcom
(1) 1825/     99B : 06 00               		ld	b,0
(1) 1826/     99D : 4F                  		ld	c,a
(1) 1827/     99E : DD 09               		add	ix,bc
(1) 1828/     9A0 : CF                  		rst	8
(1) 1829/     9A1 : DD 66 20            		ld	h,(ix+DTH)
(1) 1830/     9A4 : DD 6E 1C            		ld	l,(ix+DTL)
(1) 1831/     9A7 : 19                  		add	hl,de
(1) 1832/     9A8 : 7C                  		ld	a,h
(1) 1833/     9A9 : E6 07               		and	00000111b
(1) 1834/     9AB : 67                  		ld	h,a
(1) 1835/     9AC : CF                  		rst	8
(1) 1836/     9AD : DD 74 20            		ld	(ix+DTH),h
(1) 1837/     9B0 : DD 75 1C            		ld	(ix+DTL),l
(1) 1838/     9B3 : DD 7E 00            		ld	a,(ix)
(1) 1839/     9B6 : F6 01               		or	00000001b
(1) 1840/     9B8 : DD 77 00            		ld	(ix),a
(1) 1841/     9BB : C9                  		ret
(1) 1842/     9BC :                     ; grab portametro value
(1) 1843/     9BC :                     .grab_prtm:
(1) 1844/     9BC : 16 00               		ld	d,0
(1) 1845/     9BE : 7B                  		ld	a,e
(1) 1846/     9BF : E6 F0               		and	11110000b
(1) 1847/     9C1 : FE F0               		cp	0F0h
(1) 1848/     9C3 : 20 07               		jr	nz,.e_nof
(1) 1849/     9C5 : CF                  		rst	8
(1) 1850/     9C6 : 7B                  		ld	a,e
(1) 1851/     9C7 : E6 0F               		and	0Fh
(1) 1852/     9C9 : 87                  		add	a,a
(1) 1853/     9CA : 18 0E               		jr	.e_go
(1) 1854/     9CC :                     .e_nof:
(1) 1855/     9CC : CF                  		rst	8
(1) 1856/     9CD : FE E0               		cp	0E0h
(1) 1857/     9CF : 20 05               		jr	nz,.e_noef
(1) 1858/     9D1 : 7B                  		ld	a,e
(1) 1859/     9D2 : E6 0F               		and	0Fh
(1) 1860/     9D4 : 18 04               		jr	.e_go
(1) 1861/     9D6 :                     .e_noef:
(1) 1862/     9D6 : CF                  		rst	8
(1) 1863/     9D7 : 7B                  		ld	a,e
(1) 1864/     9D8 : 87                  		add	a,a
(1) 1865/     9D9 : 87                  		add	a,a
(1) 1866/     9DA :                     .e_go:
(1) 1867/     9DA : C9                  		ret
(1) 1868/     9DB :                     
(1) 1869/     9DB :                     ; --------------------------------
(1) 1870/     9DB :                     ; Effect X: Panning
(1) 1871/     9DB :                     ; --------------------------------
(1) 1872/     9DB :                     
(1) 1873/     9DB :                     ; PWM points here too.
(1) 1874/     9DB :                     .effPwm_X:
(1) 1875/     9DB : 7B                  		ld	a,e
(1) 1876/     9DC : 07                  		rlca
(1) 1877/     9DD : 07                  		rlca
(1) 1878/     9DE : E6 03               		and	00000011b
(1) 1879/     9E0 : 21 2E 0A            		ld	hl,.fmpan_list
(1) 1880/     9E3 : 11 00 00            		ld	de,0
(1) 1881/     9E6 : 5F                  		ld	e,a
(1) 1882/     9E7 : CF                  		rst	8
(1) 1883/     9E8 : 19                  		add	hl,de
(1) 1884/     9E9 : 5E                  		ld	e,(hl)
(1) 1885/     9EA : FD 7E 01            		ld	a,(iy+chnl_Flags)
(1) 1886/     9ED : E6 CF               		and	11001111b
(1) 1887/     9EF : B3                  		or	e
(1) 1888/     9F0 : FD 77 01            		ld	(iy+chnl_Flags),a
(1) 1889/     9F3 : C9                  		ret
(1) 1890/     9F4 :                     
(1) 1891/     9F4 :                     ; PWM points here too.
(1) 1892/     9F4 :                     .effFm_X:
(1) 1893/     9F4 : DD 7E 02            		ld	a,(ix+2)
(1) 1894/     9F7 : E6 07               		and	111b
(1) 1895/     9F9 : 06 00               		ld	b,0
(1) 1896/     9FB : 4F                  		ld	c,a
(1) 1897/     9FC : DD 21 78 16         		ld	ix,fmcom
(1) 1898/     A00 : DD 09               		add	ix,bc
(1) 1899/     A02 : 7B                  		ld	a,e
(1) 1900/     A03 : 07                  		rlca
(1) 1901/     A04 : 07                  		rlca
(1) 1902/     A05 : E6 03               		and	00000011b
(1) 1903/     A07 : 21 2E 0A            		ld	hl,.fmpan_list
(1) 1904/     A0A : 11 00 00            		ld	de,0
(1) 1905/     A0D : 5F                  		ld	e,a
(1) 1906/     A0E : CF                  		rst	8
(1) 1907/     A0F : 19                  		add	hl,de
(1) 1908/     A10 : 5E                  		ld	e,(hl)
(1) 1909/     A11 : FD 7E 01            		ld	a,(iy+chnl_Flags)
(1) 1910/     A14 : E6 CF               		and	11001111b
(1) 1911/     A16 : B3                  		or	e
(1) 1912/     A17 : FD 77 01            		ld	(iy+chnl_Flags),a
(1) 1913/     A1A : FD 7E 01            		ld	a,(iy+chnl_Flags)
(1) 1914/     A1D : 87                  		add	a,a		; move LR bits
(1) 1915/     A1E : 87                  		add	a,a
(1) 1916/     A1F : 2F                  		cpl
(1) 1917/     A20 : E6 C0               		and	11000000b	; Set Panning ENABLE bits
(1) 1918/     A22 : DD 77 12            		ld	(ix+FMPAN),a
(1) 1919/     A25 :                     
(1) 1920/     A25 :                     ; 		ld	a,(iy+chnl_Flags)
(1) 1921/     A25 :                     ; 		add	a,a		; move LR bits
(1) 1922/     A25 :                     ; 		add	a,a
(1) 1923/     A25 :                     ; 		cpl
(1) 1924/     A25 :                     ; 		and	11000000b	; Set Panning ENABLE bits
(1) 1925/     A25 :                     ; 		ld	(ix+FMPAN),a
(1) 1926/     A25 :                     ; 		ld	e,11110000b	; ALLOWED keys (TEMPORAL)
(1) 1927/     A25 :                     ; 		rst	8
(1) 1928/     A25 :                     ; 		ld	(ix+FMKEYS),e
(1) 1929/     A25 : DD 7E 00            		ld	a,(ix)		; key on
(1) 1930/     A28 : F6 40               		or	01000000b
(1) 1931/     A2A : DD 77 00            		ld	(ix),a
(1) 1932/     A2D :                     
(1) 1933/     A2D : C9                  		ret
(1) 1934/     A2E :                     .fmpan_list:
(1) 1935/     A2E : 10                  		db 00010000b	; 000h
(1) 1936/     A2F : 10                  		db 00010000b	; 040h
(1) 1937/     A30 : 00                  		db 00000000b	; 080h
(1) 1938/     A31 : 20                  		db 00100000b	; 0C0h
(1) 1939/     A32 :                     
(1) 1940/     A32 :                     ; ----------------------------------------
(1) 1941/     A32 :                     ; bit 0
(1) 1942/     A32 :                     ; ----------------------------------------
(1) 1943/     A32 :                     
(1) 1944/     A32 :                     .req_note:
(1) 1945/     A32 : 2A 44 1E            		ld	hl,(currInsPos)
(1) 1946/     A35 : DD 2A 42 1E         		ld	ix,(currTblPos)
(1) 1947/     A39 : 7E                  		ld	a,(hl)
(1) 1948/     A3A : 4F                  		ld	c,a		; special copy
(1) 1949/     A3B : E6 F0               		and	11110000b
(1) 1950/     A3D : FE 80               		cp	80h		; PSG normal
(1) 1951/     A3F : CA 1B 0B            		jp	z,.note_psg
(1) 1952/     A42 : FE 90               		cp	90h		; PSG noise
(1) 1953/     A44 : CA EE 0A            		jp	z,.note_psgn
(1) 1954/     A47 : FE A0               		cp	0A0h
(1) 1955/     A49 : CA EC 0B            		jp	z,.note_fm
(1) 1956/     A4C : CF                  		rst	8
(1) 1957/     A4D : FE B0               		cp	0B0h
(1) 1958/     A4F : CA C8 0B            		jp	z,.note_fm3
(1) 1959/     A52 : FE C0               		cp	0C0h
(1) 1960/     A54 : CA 85 0B            		jp	z,.note_dac
(1) 1961/     A57 : FE D0               		cp	0D0h
(1) 1962/     A59 : CA 5D 0A            		jp	z,.note_pwm
(1) 1963/     A5C : C9                  		ret
(1) 1964/     A5D :                     
(1) 1965/     A5D :                     ; --------------------------------
(1) 1966/     A5D :                     ; Note: PWM
(1) 1967/     A5D :                     ; --------------------------------
(1) 1968/     A5D :                     
(1) 1969/     A5D :                     .note_pwm:
(1) 1970/     A5D : 3E 01               		ld	a,1			; Send MARS request
(1) 1971/     A5F : 32 2F 00            		ld	(marsUpd),a
(1) 1972/     A62 : 21 40 16            		ld	hl,pwmcom
(1) 1973/     A65 : DD 7E 02            		ld	a,(ix+2)
(1) 1974/     A68 : E6 07               		and	000111b
(1) 1975/     A6A : 06 00               		ld	b,0
(1) 1976/     A6C : 4F                  		ld	c,a
(1) 1977/     A6D : 09                  		add	hl,bc
(1) 1978/     A6E : CF                  		rst	8
(1) 1979/     A6F : FD 7E 02            		ld	a,(iy+chnl_Note)
(1) 1980/     A72 : FE FF               		cp	-1
(1) 1981/     A74 : CA BF 0A            		jp	z,.pwm_keyoff
(1) 1982/     A77 : FE FE               		cp	-2
(1) 1983/     A79 : CA C3 0A            		jp	z,.pwm_keycut
(1) 1984/     A7C : 11 00 00            		ld	de,0
(1) 1985/     A7F : DD 5E 03            		ld	e,(ix+3)		; Get pitch
(1) 1986/     A82 : 83                  		add	a,e
(1) 1987/     A83 : 87                  		add	a,a
(1) 1988/     A84 : CF                  		rst	8
(1) 1989/     A85 : 5F                  		ld	e,a
(1) 1990/     A86 : 79                  		ld	a,c
(1) 1991/     A87 : F6 D0               		or	0D0h
(1) 1992/     A89 : FD 77 00            		ld	(iy+chnl_Chip),a	; Set as PWM
(1) 1993/     A8C : E5                  		push	hl
(1) 1994/     A8D : DD E1               		pop	ix
(1) 1995/     A8F : 21 4D 15            		ld	hl,wavFreq_List
(1) 1996/     A92 : 19                  		add	hl,de
(1) 1997/     A93 : 5E                  		ld	e,(hl)
(1) 1998/     A94 : 23                  		inc	hl
(1) 1999/     A95 : 56                  		ld	d,(hl)			; note: max 111b
(1) 2000/     A96 : CF                  		rst	8
(1) 2001/     A97 : DD CB 00 C6         		set	0,(ix)			; Note-on
(1) 2002/     A9B : 7A                  		ld	a,d
(1) 2003/     A9C : FD CB 01 56         		bit	2,(iy+chnl_Flags)	; check if volume is being used
(1) 2004/     AA0 : 28 06               		jr	z,.pwmn_kpv
(1) 2005/     AA2 : DD 7E 08            		ld	a,(ix+PWPTH_V)
(1) 2006/     AA5 : E6 FC               		and	11111100b
(1) 2007/     AA7 : B2                  		or	d
(1) 2008/     AA8 :                     .pwmn_kpv:
(1) 2009/     AA8 : DD 77 08            		ld	(ix+PWPTH_V),a
(1) 2010/     AAB : DD 73 10            		ld	(ix+PWPHL),e
(1) 2011/     AAE : DD 7E 18            		ld	a,(ix+PWOUTF)
(1) 2012/     AB1 : E6 CF               		and	11001111b		; Keep other bits
(1) 2013/     AB3 : 4F                  		ld	c,a
(1) 2014/     AB4 : FD 7E 01            		ld	a,(iy+chnl_Flags)	; 00LR 0000
(1) 2015/     AB7 : 2F                  		cpl
(1) 2016/     AB8 : E6 30               		and	00110000b
(1) 2017/     ABA : B1                  		or	c
(1) 2018/     ABB : DD 77 18            		ld	(ix+PWOUTF),a
(1) 2019/     ABE : C9                  		ret
(1) 2020/     ABF :                     
(1) 2021/     ABF :                     ; PSG Keyoff
(1) 2022/     ABF :                     .pwm_keyoff:
(1) 2023/     ABF : 0E 02               		ld	c,010b
(1) 2024/     AC1 : 71                  		ld	(hl),c
(1) 2025/     AC2 : C9                  		ret
(1) 2026/     AC3 :                     .pwm_keycut:
(1) 2027/     AC3 : 0E 04               		ld	c,100b
(1) 2028/     AC5 : 18 06               		jr	.chnl_unlink
(1) 2029/     AC7 :                     
(1) 2030/     AC7 :                     ; 		ld	a,100b			; Request DAC stop
(1) 2031/     AC7 :                     ; 		ld	(daccom),a
(1) 2032/     AC7 :                     ; .doff:
(1) 2033/     AC7 :                     ; 		ld	hl,0
(1) 2034/     AC7 :                     ; 		ld	(tblFM6),hl
(1) 2035/     AC7 :                     ; 		ld	(iy+chnl_Chip),0
(1) 2036/     AC7 :                     ; 		ret
(1) 2037/     AC7 :                     
(1) 2038/     AC7 :                     ; --------------------------------
(1) 2039/     AC7 :                     ; Note: PSG1-3,PSGN
(1) 2040/     AC7 :                     ; --------------------------------
(1) 2041/     AC7 :                     
(1) 2042/     AC7 :                     ; PSG Keyoff
(1) 2043/     AC7 :                     .poff:
(1) 2044/     AC7 : 0E 02               		ld	c,010b
(1) 2045/     AC9 : 71                  		ld	(hl),c
(1) 2046/     ACA : C9                  		ret
(1) 2047/     ACB :                     ; PSG Keycut
(1) 2048/     ACB :                     .pcut:
(1) 2049/     ACB : 0E 04               		ld	c,100b
(1) 2050/     ACD :                     .chnl_unlink:
(1) 2051/     ACD : CF                  		rst	8
(1) 2052/     ACE : FD E5               		push	iy
(1) 2053/     AD0 : D1                  		pop	de
(1) 2054/     AD1 : DD 7E 00            		ld	a,(ix)
(1) 2055/     AD4 : BB                  		cp	e
(1) 2056/     AD5 : C0                  		ret	nz
(1) 2057/     AD6 : DD 7E 01            		ld	a,(ix+1)
(1) 2058/     AD9 : BA                  		cp	d
(1) 2059/     ADA : C0                  		ret	nz
(1) 2060/     ADB : CF                  		rst	8
(1) 2061/     ADC : 71                  		ld	(hl),c
(1) 2062/     ADD : DD 36 00 00         		ld	(ix),0
(1) 2063/     AE1 : DD 36 01 00         		ld	(ix+1),0
(1) 2064/     AE5 : DD 36 03 00         		ld	(ix+3),0	; pitch zero
(1) 2065/     AE9 : FD 36 00 00         		ld	(iy+chnl_Chip),0
(1) 2066/     AED : C9                  		ret
(1) 2067/     AEE :                     
(1) 2068/     AEE :                     ; Play PSG note
(1) 2069/     AEE :                     .note_psgn:
(1) 2070/     AEE : DD 7E 02            		ld	a,(ix+2)
(1) 2071/     AF1 : F6 90               		or	90h
(1) 2072/     AF3 : FD 77 00            		ld	(iy+chnl_Chip),a
(1) 2073/     AF6 : 21 9F 16            		ld 	hl,psgcom+3
(1) 2074/     AF9 : FD 7E 02            		ld	a,(iy+chnl_Note)
(1) 2075/     AFC : FE FE               		cp	-2
(1) 2076/     AFE : CA CB 0A            		jp	z,.pcut
(1) 2077/     B01 : FE FF               		cp	-1
(1) 2078/     B03 : CA C7 0A            		jp	z,.poff
(1) 2079/     B06 : 5F                  		ld	e,a
(1) 2080/     B07 : DD 7E 04            		ld 	a,(ix+4)
(1) 2081/     B0A : 32 5E 1E            		ld	(psgHatMode),a
(1) 2082/     B0D : E6 03               		and	011b
(1) 2083/     B0F : FE 03               		cp	011b
(1) 2084/     B11 : 20 05               		jr	nz,.np2_n
(1) 2085/     B13 : 3E 04               		ld	a,100b
(1) 2086/     B15 : 32 9E 16            		ld	(psgcom+2),a
(1) 2087/     B18 :                     .np2_n:
(1) 2088/     B18 : 7B                  		ld	a,e
(1) 2089/     B19 : 18 32               		jr	.notepsg_fn
(1) 2090/     B1B :                     .note_psg:
(1) 2091/     B1B : DD 7E 02            		ld	a,(ix+2)
(1) 2092/     B1E : F6 80               		or	80h
(1) 2093/     B20 : FD 77 00            		ld	(iy+chnl_Chip),a
(1) 2094/     B23 : DD 7E 02            		ld	a,(ix+2)
(1) 2095/     B26 : CF                  		rst	8
(1) 2096/     B27 : E6 03               		and	11b
(1) 2097/     B29 : 16 00               		ld	d,0
(1) 2098/     B2B : 5F                  		ld	e,a
(1) 2099/     B2C : 21 9C 16            		ld 	hl,psgcom
(1) 2100/     B2F : 19                  		add	hl,de
(1) 2101/     B30 : FE 02               		cp	2
(1) 2102/     B32 : 20 0C               		jr	nz,.notepsg_c
(1) 2103/     B34 : 3A 5E 1E            		ld	a,(psgHatMode)
(1) 2104/     B37 : E6 03               		and	011b
(1) 2105/     B39 : FE 03               		cp	011b
(1) 2106/     B3B : 20 03               		jr	nz,.notepsg_c
(1) 2107/     B3D : 36 04               		ld	(hl),100b	; key-cut PSG3 but dont unlink
(1) 2108/     B3F : C9                  		ret
(1) 2109/     B40 :                     .notepsg_c:
(1) 2110/     B40 : FD 7E 02            		ld	a,(iy+chnl_Note)
(1) 2111/     B43 : FE FE               		cp	-2
(1) 2112/     B45 : CA CB 0A            		jp	z,.pcut
(1) 2113/     B48 : FE FF               		cp	-1
(1) 2114/     B4A : CA C7 0A            		jp	z,.poff
(1) 2115/     B4D :                     .notepsg_fn:
(1) 2116/     B4D : CF                  		rst	8
(1) 2117/     B4E : E5                  		push	hl		; save psgcom
(1) 2118/     B4F : 21 5B 14            		ld	hl,psgFreq_List
(1) 2119/     B52 : DD 4E 03            		ld	c,(ix+3)
(1) 2120/     B55 : 81                  		add	a,c
(1) 2121/     B56 : 87                  		add	a,a
(1) 2122/     B57 : 11 00 00            		ld	de,0
(1) 2123/     B5A : 5F                  		ld	e,a
(1) 2124/     B5B : 19                  		add	hl,de
(1) 2125/     B5C : 5E                  		ld	e,(hl)
(1) 2126/     B5D : 23                  		inc	hl
(1) 2127/     B5E : 56                  		ld	d,(hl)
(1) 2128/     B5F : 01 00 00            		ld	bc,0
(1) 2129/     B62 : E6 03               		and	11b
(1) 2130/     B64 : 4F                  		ld	c,a
(1) 2131/     B65 : DD E5               		push	ix		; swap ix to hl
(1) 2132/     B67 : E1                  		pop	hl
(1) 2133/     B68 : CF                  		rst	8
(1) 2134/     B69 : 23                  		inc	hl		; skip link
(1) 2135/     B6A : 23                  		inc	hl
(1) 2136/     B6B : 23                  		inc 	hl		; channel id
(1) 2137/     B6C : 23                  		inc	hl		; pitch
(1) 2138/     B6D :                     ; 		ld	a,c
(1) 2139/     B6D :                     ; 		cp	3
(1) 2140/     B6D :                     ; 		jr	nz,.npsg2
(1) 2141/     B6D :                     ; 		ld 	a,(ix+4)
(1) 2142/     B6D :                     ; 		ld	(psgHatMode),a
(1) 2143/     B6D :                     ; .npsg2:
(1) 2144/     B6D : DD E1               		pop	ix			; restore psgcom as ix
(1) 2145/     B6F : FD 7E 01            		ld	a,(iy+chnl_Flags)	; Check is volume bit
(1) 2146/     B72 : CB 57               		bit	2,a			; is being used
(1) 2147/     B74 : 20 04               		jr	nz,.nodefv
(1) 2148/     B76 : DD 36 30 00         		ld	(ix+PVOL),0		; if not, set max volume
(1) 2149/     B7A :                     .nodefv:
(1) 2150/     B7A : DD 73 1C            		ld	(ix+DTL),e
(1) 2151/     B7D : DD 72 20            		ld	(ix+DTH),d
(1) 2152/     B80 : DD 36 00 01         		ld	(ix+COM),001b	; Key ON
(1) 2153/     B84 : C9                  		ret
(1) 2154/     B85 :                     
(1) 2155/     B85 :                     ; --------------------------------
(1) 2156/     B85 :                     ; Note: FM,FM3,FM6
(1) 2157/     B85 :                     ; --------------------------------
(1) 2158/     B85 :                     
(1) 2159/     B85 :                     .note_dac:
(1) 2160/     B85 : 21 CC 17            		ld	hl,daccom
(1) 2161/     B88 : FD 7E 02            		ld	a,(iy+chnl_Note)
(1) 2162/     B8B : FE FF               		cp	-1
(1) 2163/     B8D : CA 89 0C            		jp	z,.fm_keyoff
(1) 2164/     B90 : FE FE               		cp	-2
(1) 2165/     B92 : CA 84 0C            		jp	z,.fm_keycut
(1) 2166/     B95 : FD 36 00 C0         		ld	(iy+chnl_Chip),0C0h	; Set as DAC
(1) 2167/     B99 : 11 00 00            		ld	de,0
(1) 2168/     B9C : DD 5E 03            		ld	e,(ix+3)		; Get pitch
(1) 2169/     B9F : 83                  		add	a,e
(1) 2170/     BA0 : 87                  		add	a,a
(1) 2171/     BA1 : 5F                  		ld	e,a
(1) 2172/     BA2 : 21 4D 15            		ld	hl,wavFreq_List
(1) 2173/     BA5 : 19                  		add	hl,de
(1) 2174/     BA6 : 7E                  		ld	a,(hl)
(1) 2175/     BA7 : 23                  		inc	hl
(1) 2176/     BA8 : 66                  		ld	h,(hl)
(1) 2177/     BA9 : CF                  		rst	8
(1) 2178/     BAA : 6F                  		ld	l,a
(1) 2179/     BAB : 11 E7 FF            		ld	de,ZSET_WTUNE		; Fine-tune to desired
(1) 2180/     BAE : 19                  		add	hl,de			; WAVE frequency
(1) 2181/     BAF : 22 54 1E            		ld	(wave_Pitch),hl
(1) 2182/     BB2 :                     ; 		ld	a,1
(1) 2183/     BB2 :                     ; 		and	001b
(1) 2184/     BB2 :                     ; 		ld	(wave_Flags),a
(1) 2185/     BB2 : 3E 01               		ld	a,001b			; Request DAC play
(1) 2186/     BB4 : 32 CC 17            		ld	(daccom),a
(1) 2187/     BB7 : C9                  		ret
(1) 2188/     BB8 :                     .dcut:
(1) 2189/     BB8 : 3E 04               		ld	a,100b			; Request DAC stop
(1) 2190/     BBA : 32 CC 17            		ld	(daccom),a
(1) 2191/     BBD :                     .doff:
(1) 2192/     BBD : 21 00 00            		ld	hl,0
(1) 2193/     BC0 : 22 17 18            		ld	(tblFM6),hl
(1) 2194/     BC3 : FD 36 00 00         		ld	(iy+chnl_Chip),0
(1) 2195/     BC7 : C9                  		ret
(1) 2196/     BC8 :                     ; FM3 special
(1) 2197/     BC8 :                     .note_fm3:
(1) 2198/     BC8 : 21 7A 16            		ld	hl,fmcom+2		; Channel 3 fmcom
(1) 2199/     BCB : FD 7E 02            		ld	a,(iy+chnl_Note)
(1) 2200/     BCE : FE FF               		cp	-1
(1) 2201/     BD0 : CA 89 0C            		jp	z,.fm_keyoff
(1) 2202/     BD3 : FE FE               		cp	-2
(1) 2203/     BD5 : CA 84 0C            		jp	z,.fm_keycut
(1) 2204/     BD8 : FD 36 00 B0         		ld	(iy+chnl_Chip),0B0h	; Set as FM3 special
(1) 2205/     BDC : 16 27               		ld	d,27h
(1) 2206/     BDE : 3E 40               		ld	a,01000000b
(1) 2207/     BE0 : 32 5F 1E            		ld	(fmSpcMode),a
(1) 2208/     BE3 : 5F                  		ld	e,a
(1) 2209/     BE4 : CD 03 13            		call	fm_send_1
(1) 2210/     BE7 : E5                  		push	hl
(1) 2211/     BE8 : DD E1               		pop	ix
(1) 2212/     BEA : 18 74               		jr	.fm_chnlkon
(1) 2213/     BEC :                     ; Normal FM
(1) 2214/     BEC :                     .note_fm:
(1) 2215/     BEC : FD 7E 02            		ld	a,(iy+chnl_Note)
(1) 2216/     BEF : 57                  		ld	d,a
(1) 2217/     BF0 : DD 5E 03            		ld	e,(ix+3)
(1) 2218/     BF3 : 83                  		add	a,e
(1) 2219/     BF4 : CF                  		rst	8
(1) 2220/     BF5 : 4F                  		ld	c,a			; c - Note+pitch
(1) 2221/     BF6 : DD 7E 02            		ld	a,(ix+2)
(1) 2222/     BF9 : 47                  		ld	b,a
(1) 2223/     BFA : E6 07               		and	00000111b
(1) 2224/     BFC : 21 78 16            		ld	hl,fmcom		; hl - fmcom list
(1) 2225/     BFF : 11 00 00            		ld	de,0
(1) 2226/     C02 : E6 07               		and	111b
(1) 2227/     C04 : 5F                  		ld	e,a
(1) 2228/     C05 : 19                  		add	hl,de
(1) 2229/     C06 : CF                  		rst	8
(1) 2230/     C07 : FD 7E 02            		ld	a,(iy+chnl_Note)
(1) 2231/     C0A : FE FF               		cp	-1
(1) 2232/     C0C : 28 7B               		jr	z,.fm_keyoff
(1) 2233/     C0E : FE FE               		cp	-2
(1) 2234/     C10 : 28 72               		jr	z,.fm_keycut
(1) 2235/     C12 : 78                  		ld	a,b			; Set chip as FM
(1) 2236/     C13 : E6 07               		and	111b
(1) 2237/     C15 : FE 02               		cp	2			; Check if we got into channel 3
(1) 2238/     C17 : 20 0E               		jr	nz,.rd_nt3
(1) 2239/     C19 : 47                  		ld	b,a
(1) 2240/     C1A : 16 27               		ld	d,27h			; Disable CH3 special mode
(1) 2241/     C1C : 3E 00               		ld	a,00000000b
(1) 2242/     C1E : 32 5F 1E            		ld	(fmSpcMode),a
(1) 2243/     C21 : CF                  		rst	8
(1) 2244/     C22 : 5F                  		ld	e,a
(1) 2245/     C23 : CD 03 13            		call	fm_send_1
(1) 2246/     C26 : 78                  		ld	a,b
(1) 2247/     C27 :                     .rd_nt3:
(1) 2248/     C27 : F6 A0               		or	0A0h
(1) 2249/     C29 : FD 77 00            		ld	(iy+chnl_Chip),a
(1) 2250/     C2C : 79                  		ld	a,c
(1) 2251/     C2D : CF                  		rst	8
(1) 2252/     C2E : 06 00               		ld	b,0			; b - octave
(1) 2253/     C30 : 1E 07               		ld	e,7
(1) 2254/     C32 :                     .get_oct:
(1) 2255/     C32 : 4F                  		ld	c,a
(1) 2256/     C33 : D6 0C               		sub	12
(1) 2257/     C35 : B7                  		or	a
(1) 2258/     C36 : FA 3D 0C            		jp	m,.fnd_oct
(1) 2259/     C39 : 04                  		inc	b
(1) 2260/     C3A : 1D                  		dec	e
(1) 2261/     C3B : 20 F5               		jr	nz,.get_oct
(1) 2262/     C3D :                     .fnd_oct:
(1) 2263/     C3D :                     	; b - octave / c - note
(1) 2264/     C3D : D5                  		push	de
(1) 2265/     C3E : CF                  		rst	8		; ix - current fmcom
(1) 2266/     C3F : 79                  		ld	a,c
(1) 2267/     C40 : 87                  		add	a,a
(1) 2268/     C41 : 4F                  		ld	c,a		; c - freq word
(1) 2269/     C42 : 78                  		ld	a,b
(1) 2270/     C43 : 87                  		add	a,a
(1) 2271/     C44 : 87                  		add	a,a
(1) 2272/     C45 : 87                  		add	a,a
(1) 2273/     C46 : 06 00               		ld	b,0
(1) 2274/     C48 : E5                  		push	hl
(1) 2275/     C49 : CF                  		rst	8
(1) 2276/     C4A : DD E1               		pop	ix
(1) 2277/     C4C : 21 43 14            		ld	hl,fmFreq_List
(1) 2278/     C4F : 09                  		add	hl,bc
(1) 2279/     C50 : 23                  		inc	hl
(1) 2280/     C51 : 4F                  		ld	c,a		; c - octave << 3
(1) 2281/     C52 : 7E                  		ld	a,(hl)		; Note MSB
(1) 2282/     C53 : B1                  		or	c		; add octave
(1) 2283/     C54 : 57                  		ld	d,a
(1) 2284/     C55 : 2B                  		dec	hl
(1) 2285/     C56 : CF                  		rst	8
(1) 2286/     C57 : 7E                  		ld	a,(hl)
(1) 2287/     C58 : 5F                  		ld	e,a
(1) 2288/     C59 : DD 72 18            		ld	(ix+FMFRQH),d	; Save freq MSB
(1) 2289/     C5C : DD 73 1E            		ld	(ix+FMFRQL),e	; Save freq LSB
(1) 2290/     C5F : D1                  		pop	de
(1) 2291/     C60 :                     .fm_chnlkon:
(1) 2292/     C60 : FD 7E 01            		ld	a,(iy+chnl_Flags)
(1) 2293/     C63 : 87                  		add	a,a		; move LR bits
(1) 2294/     C64 : 87                  		add	a,a
(1) 2295/     C65 : 2F                  		cpl
(1) 2296/     C66 : E6 C0               		and	11000000b	; Set Panning ENABLE bits
(1) 2297/     C68 : DD 77 12            		ld	(ix+FMPAN),a
(1) 2298/     C6B : 1E F0               		ld	e,11110000b	; ALLOWED keys (TEMPORAL)
(1) 2299/     C6D : CF                  		rst	8
(1) 2300/     C6E : DD 73 06            		ld	(ix+FMKEYS),e
(1) 2301/     C71 : DD 7E 00            		ld	a,(ix)		; key on
(1) 2302/     C74 : F6 41               		or	01000001b
(1) 2303/     C76 : DD 77 00            		ld	(ix),a
(1) 2304/     C79 : FD CB 01 56         		bit	2,(iy+chnl_Flags)	; check if volume is being used
(1) 2305/     C7D : 20 04               		jr	nz,.fm_kpv
(1) 2306/     C7F : DD 36 0C 00         		ld	(ix+FMVOL),0
(1) 2307/     C83 :                     .fm_kpv:
(1) 2308/     C83 : C9                  		ret
(1) 2309/     C84 :                     
(1) 2310/     C84 :                     ; keyoff/cut
(1) 2311/     C84 :                     .fm_keycut:
(1) 2312/     C84 : 0E 04               		ld	c,100b
(1) 2313/     C86 : C3 CD 0A            		jp	.chnl_unlink
(1) 2314/     C89 :                     .fm_keyoff:
(1) 2315/     C89 : 0E 02               		ld	c,010b
(1) 2316/     C8B : 71                  		ld	(hl),c
(1) 2317/     C8C : C9                  		ret
(1) 2318/     C8D :                     
(1) 2319/     C8D :                     ; ----------------------------------------
(1) 2320/     C8D :                     ; Channel chip swap
(1) 2321/     C8D :                     ; ----------------------------------------
(1) 2322/     C8D :                     
(1) 2323/     C8D :                     .chip_swap:
(1) 2324/     C8D : 4F                  		ld	c,a		; c - New chip ID
(1) 2325/     C8E : E6 F0               		and	11110000b
(1) 2326/     C90 : 47                  		ld	b,a
(1) 2327/     C91 : FD 7E 00            		ld	a,(iy+chnl_Chip)
(1) 2328/     C94 : CF                  		rst	8
(1) 2329/     C95 : 5F                  		ld	e,a		; e - Old chip ID
(1) 2330/     C96 : E6 F0               		and	11110000b
(1) 2331/     C98 : B8                  		cp	b
(1) 2332/     C99 : 28 2E               		jr	z,.chip_out
(1) 2333/     C9B : 57                  		ld	d,a		; d - reuse last ID
(1) 2334/     C9C : 79                  		ld	a,c		; New chip-ins is null?
(1) 2335/     C9D : FE FF               		cp	-1
(1) 2336/     C9F : 20 05               		jr	nz,.from_nl
(1) 2337/     CA1 : 7B                  		ld	a,e		; Reuse OLD ID
(1) 2338/     CA2 : CF                  		rst	8
(1) 2339/     CA3 : E6 F0               		and	11110000b
(1) 2340/     CA5 : 57                  		ld	d,a		; new id to check
(1) 2341/     CA6 :                     .from_nl:
(1) 2342/     CA6 : 7A                  		ld	a,d
(1) 2343/     CA7 : 16 00               		ld	d,0
(1) 2344/     CA9 : FE 80               		cp	80h
(1) 2345/     CAB : CC 18 0D            		call	z,.psg_out
(1) 2346/     CAE : FE 90               		cp	90h
(1) 2347/     CB0 : CC 0A 0D            		call	z,.psgn_out
(1) 2348/     CB3 : CF                  		rst	8
(1) 2349/     CB4 : FE A0               		cp	0A0h
(1) 2350/     CB6 : CC 38 0D            		call	z,.fm_out
(1) 2351/     CB9 : FE B0               		cp	0B0h
(1) 2352/     CBB : CC FC 0C            		call	z,.fm3_out
(1) 2353/     CBE : FE C0               		cp	0C0h
(1) 2354/     CC0 : CC EE 0C            		call	z,.dac_out
(1) 2355/     CC3 : FE D0               		cp	0D0h
(1) 2356/     CC5 : CC CB 0C            		call	z,.pwm_out
(1) 2357/     CC8 : CF                  		rst	8
(1) 2358/     CC9 :                     .chip_out:
(1) 2359/     CC9 : 79                  		ld	a,c
(1) 2360/     CCA : C9                  		ret
(1) 2361/     CCB :                     
(1) 2362/     CCB :                     .pwm_out:
(1) 2363/     CCB : E5                  		push	hl
(1) 2364/     CCC : 7B                  		ld	a,e
(1) 2365/     CCD : E6 07               		and	111b
(1) 2366/     CCF : 47                  		ld	b,a
(1) 2367/     CD0 : 5F                  		ld	e,a
(1) 2368/     CD1 : CF                  		rst	8
(1) 2369/     CD2 : 87                  		add	a,a
(1) 2370/     CD3 : 87                  		add	a,a
(1) 2371/     CD4 : 87                  		add	a,a
(1) 2372/     CD5 : 5F                  		ld	e,a
(1) 2373/     CD6 : 21 21 18            		ld	hl,tblPWM
(1) 2374/     CD9 : 19                  		add	hl,de
(1) 2375/     CDA : CD 56 0D            		call	.chp_unlk
(1) 2376/     CDD : CF                  		rst	8
(1) 2377/     CDE : 16 00               		ld	d,0
(1) 2378/     CE0 : 58                  		ld	e,b
(1) 2379/     CE1 : 21 40 16            		ld	hl,pwmcom
(1) 2380/     CE4 : 19                  		add	hl,de
(1) 2381/     CE5 : 36 04               		ld	(hl),100b
(1) 2382/     CE7 : 3E 01               		ld	a,1
(1) 2383/     CE9 : 32 2F 00            		ld	(marsUpd),a
(1) 2384/     CEC : 18 48               		jr	.p_out
(1) 2385/     CEE :                     
(1) 2386/     CEE :                     .dac_out:
(1) 2387/     CEE : E5                  		push	hl
(1) 2388/     CEF : 21 17 18            		ld	hl,tblFM6
(1) 2389/     CF2 : CD 56 0D            		call	.chp_unlk
(1) 2390/     CF5 : 21 CC 17            		ld	hl,daccom
(1) 2391/     CF8 : 36 04               		ld	(hl),100b
(1) 2392/     CFA : E1                  		pop	hl
(1) 2393/     CFB : C9                  		ret
(1) 2394/     CFC :                     .fm3_out:
(1) 2395/     CFC : E5                  		push	hl
(1) 2396/     CFD : 21 0F 18            		ld	hl,tblFM3
(1) 2397/     D00 : CD 56 0D            		call	.chp_unlk
(1) 2398/     D03 : 21 7A 16            		ld	hl,fmcom+2
(1) 2399/     D06 : 36 04               		ld	(hl),100b
(1) 2400/     D08 : E1                  		pop	hl
(1) 2401/     D09 : C9                  		ret
(1) 2402/     D0A :                     .psgn_out:
(1) 2403/     D0A : E5                  		push	hl
(1) 2404/     D0B : 21 E7 17            		ld	hl,tblPSGN
(1) 2405/     D0E : CD 56 0D            		call	.chp_unlk
(1) 2406/     D11 : 21 9F 16            		ld	hl,psgcom+3
(1) 2407/     D14 : 36 04               		ld	(hl),100b
(1) 2408/     D16 : E1                  		pop	hl
(1) 2409/     D17 : C9                  		ret
(1) 2410/     D18 :                     .psg_out:
(1) 2411/     D18 : E5                  		push	hl
(1) 2412/     D19 : 7B                  		ld	a,e
(1) 2413/     D1A : E6 03               		and	011b
(1) 2414/     D1C : 47                  		ld	b,a
(1) 2415/     D1D : 5F                  		ld	e,a
(1) 2416/     D1E : 87                  		add	a,a
(1) 2417/     D1F : CF                  		rst	8
(1) 2418/     D20 : 87                  		add	a,a
(1) 2419/     D21 : 87                  		add	a,a
(1) 2420/     D22 : 5F                  		ld	e,a
(1) 2421/     D23 : 21 CD 17            		ld	hl,tblPSG
(1) 2422/     D26 : 19                  		add	hl,de
(1) 2423/     D27 : CD 56 0D            		call	.chp_unlk
(1) 2424/     D2A : 20 0A               		jr	nz,.p_out
(1) 2425/     D2C : CF                  		rst	8
(1) 2426/     D2D : 16 00               		ld	d,0
(1) 2427/     D2F : 58                  		ld	e,b
(1) 2428/     D30 : 21 9C 16            		ld	hl,psgcom
(1) 2429/     D33 : 19                  		add	hl,de
(1) 2430/     D34 : 36 04               		ld	(hl),100b
(1) 2431/     D36 :                     .p_out:
(1) 2432/     D36 : E1                  		pop	hl
(1) 2433/     D37 : C9                  		ret
(1) 2434/     D38 :                     .fm_out:
(1) 2435/     D38 : E5                  		push	hl
(1) 2436/     D39 : 7B                  		ld	a,e
(1) 2437/     D3A : E6 07               		and	111b
(1) 2438/     D3C : 47                  		ld	b,a
(1) 2439/     D3D : 5F                  		ld	e,a
(1) 2440/     D3E : CF                  		rst	8
(1) 2441/     D3F : 87                  		add	a,a
(1) 2442/     D40 : 87                  		add	a,a
(1) 2443/     D41 : 87                  		add	a,a
(1) 2444/     D42 : 5F                  		ld	e,a
(1) 2445/     D43 : 21 EF 17            		ld	hl,tblFM
(1) 2446/     D46 : 19                  		add	hl,de
(1) 2447/     D47 : CD 56 0D            		call	.chp_unlk
(1) 2448/     D4A : CF                  		rst	8
(1) 2449/     D4B : 16 00               		ld	d,0
(1) 2450/     D4D : 58                  		ld	e,b
(1) 2451/     D4E : 21 78 16            		ld	hl,fmcom
(1) 2452/     D51 : 19                  		add	hl,de
(1) 2453/     D52 : 36 04               		ld	(hl),100b
(1) 2454/     D54 : 18 E0               		jr	.p_out
(1) 2455/     D56 :                     
(1) 2456/     D56 :                     .chp_unlk:
(1) 2457/     D56 : FD E5               		push	iy
(1) 2458/     D58 : D1                  		pop	de
(1) 2459/     D59 : CF                  		rst	8
(1) 2460/     D5A : 7E                  		ld	a,(hl)
(1) 2461/     D5B : BB                  		cp	e
(1) 2462/     D5C : C0                  		ret	nz
(1) 2463/     D5D : 23                  		inc	hl
(1) 2464/     D5E : 7E                  		ld	a,(hl)
(1) 2465/     D5F : BA                  		cp	d
(1) 2466/     D60 : C0                  		ret	nz
(1) 2467/     D61 : 2B                  		dec	hl
(1) 2468/     D62 : CF                  		rst	8
(1) 2469/     D63 : 36 00               		ld	(hl),0
(1) 2470/     D65 : 23                  		inc	hl
(1) 2471/     D66 : 36 00               		ld	(hl),0
(1) 2472/     D68 : 23                  		inc	hl
(1) 2473/     D69 : 5E                  		ld	e,(hl)	; c - ID
(1) 2474/     D6A : 23                  		inc	hl
(1) 2475/     D6B : 36 00               		ld	(hl),0	; reset 5 bytes of settings
(1) 2476/     D6D : CF                  		rst	8
(1) 2477/     D6E : 23                  		inc	hl
(1) 2478/     D6F : 36 00               		ld	(hl),0
(1) 2479/     D71 : 23                  		inc	hl
(1) 2480/     D72 : 36 00               		ld	(hl),0
(1) 2481/     D74 : 23                  		inc	hl
(1) 2482/     D75 : 36 00               		ld	(hl),0
(1) 2483/     D77 : 23                  		inc	hl
(1) 2484/     D78 : 36 00               		ld	(hl),0
(1) 2485/     D7A : AF                  		xor	a
(1) 2486/     D7B : B7                  		or	a
(1) 2487/     D7C : C9                  		ret
(1) 2488/     D7D :                     
(1) 2489/     D7D :                     ; ----------------------------------------
(1) 2490/     D7D :                     ; Sets current instrument data
(1) 2491/     D7D :                     ;
(1) 2492/     D7D :                     ;   -1 - Null instrument
(1) 2493/     D7D :                     ;  80h - PSG
(1) 2494/     D7D :                     ;  90h - PSG Noise
(1) 2495/     D7D :                     ; 0A0h - FM
(1) 2496/     D7D :                     ; 0B0h - FM3 Special
(1) 2497/     D7D :                     ; 0C0h - FM6 Sample
(1) 2498/     D7D :                     ; 0D0h - PWM (or extra)
(1) 2499/     D7D :                     ; ----------------------------------------
(1) 2500/     D7D :                     
(1) 2501/     D7D :                     .check_ins:
(1) 2502/     D7D : FD 7E 03            		ld	a,(iy+chnl_Ins)
(1) 2503/     D80 : 3D                  		dec	a		; minus 1
(1) 2504/     D81 : F8                  		ret	m		; return as -1 if no ins is used.
(1) 2505/     D82 : 87                  		add	a,a		; * 08h
(1) 2506/     D83 : 87                  		add	a,a
(1) 2507/     D84 : CF                  		rst	8
(1) 2508/     D85 : 87                  		add	a,a
(1) 2509/     D86 : 2A 40 1E            		ld	hl,(currInsData)
(1) 2510/     D89 : 11 00 00            		ld	de,0
(1) 2511/     D8C : 5F                  		ld	e,a
(1) 2512/     D8D : 19                  		add	hl,de
(1) 2513/     D8E : 7E                  		ld	a,(hl)
(1) 2514/     D8F : C9                  		ret
(1) 2515/     D90 :                     
(1) 2516/     D90 :                     ; ----------------------------------------
(1) 2517/     D90 :                     ; Checks which channel type is using
(1) 2518/     D90 :                     ; auto-set channel
(1) 2519/     D90 :                     ;
(1) 2520/     D90 :                     ; a - sound chip
(1) 2521/     D90 :                     ; ----------------------------------------
(1) 2522/     D90 :                     
(1) 2523/     D90 :                     .check_chnl:
(1) 2524/     D90 : FE FF               		cp	-1		; if -1: Null
(1) 2525/     D92 : C8                  		ret	z
(1) 2526/     D93 : CF                  		rst	8
(1) 2527/     D94 : 4F                  		ld	c,a		; save copy to c
(1) 2528/     D95 : 87                  		add	a,a		; * 2
(1) 2529/     D96 : 16 00               		ld	d,0
(1) 2530/     D98 : 0F                  		rrca
(1) 2531/     D99 : 0F                  		rrca
(1) 2532/     D9A : 0F                  		rrca
(1) 2533/     D9B : 0F                  		rrca
(1) 2534/     D9C : E6 0F               		and	00001111b
(1) 2535/     D9E : 5F                  		ld	e,a
(1) 2536/     D9F : DD 21 C1 0D         		ld	ix,.tbllist	; get table from list
(1) 2537/     DA3 : DD 19               		add	ix,de
(1) 2538/     DA5 : DD 5E 00            		ld	e,(ix)
(1) 2539/     DA8 : DD 56 01            		ld	d,(ix+1)
(1) 2540/     DAB : CF                  		rst	8
(1) 2541/     DAC : D5                  		push	de
(1) 2542/     DAD : DD E1               		pop	ix
(1) 2543/     DAF : 79                  		ld	a,c		; restore from c
(1) 2544/     DB0 : FE 90               		cp	90h		; type PSGN?
(1) 2545/     DB2 : 28 19               		jr	z,.chk_tbln
(1) 2546/     DB4 : FE B0               		cp	0B0h		; type FM3?
(1) 2547/     DB6 : 28 15               		jr	z,.chk_tbln
(1) 2548/     DB8 : FE C0               		cp	0C0h		; type DAC?
(1) 2549/     DBA : 28 11               		jr	z,.chk_tbln
(1) 2550/     DBC : 18 2D               		jr	.chk_tbl
(1) 2551/     DBE :                     .bad_ins:
(1) 2552/     DBE : 3E FF               		ld	a,-1
(1) 2553/     DC0 : C9                  		ret
(1) 2554/     DC1 :                     
(1) 2555/     DC1 :                     ; --------------------------------------------
(1) 2556/     DC1 :                     
(1) 2557/     DC1 :                     .tbllist:
(1) 2558/     DC1 : CD 17               		dw tblPSG	;  80h
(1) 2559/     DC3 : E7 17               		dw tblPSGN	;  90h
(1) 2560/     DC5 : EF 17               		dw tblFM	; 0A0h
(1) 2561/     DC7 : 0F 18               		dw tblFM3	; 0B0h
(1) 2562/     DC9 : 17 18               		dw tblFM6	; 0C0h
(1) 2563/     DCB : 21 18               		dw tblPWM	; 0D0h
(1) 2564/     DCD :                     
(1) 2565/     DCD :                     ; --------------------------------------------
(1) 2566/     DCD :                     ; Check SINGLE channel table
(1) 2567/     DCD :                     ; (FM3,FM6,PSGN)
(1) 2568/     DCD :                     ; --------------------------------------------
(1) 2569/     DCD :                     
(1) 2570/     DCD :                     ; This auto-replaces the LINKED channel
(1) 2571/     DCD :                     .chk_tbln:
(1) 2572/     DCD : FD E5               		push	iy
(1) 2573/     DCF : D1                  		pop	de		; de - Copy of curr track-channel
(1) 2574/     DD0 :                     
(1) 2575/     DD0 :                     	; **** MSB priority overwrite
(1) 2576/     DD0 : CF                  		rst	8
(1) 2577/     DD1 : DD 7E 01            		ld	a,(ix+1)	; MSB | LSB
(1) 2578/     DD4 : DD B6 00            		or	(ix)		; Check if blank
(1) 2579/     DD7 : 28 06               		jr	z,.new
(1) 2580/     DD9 : DD 7E 01            		ld	a,(ix+1)
(1) 2581/     DDC : BA                  		cp	d
(1) 2582/     DDD : 38 09               		jr	c,.busy_s
(1) 2583/     DDF :                     .new:
(1) 2584/     DDF : CF                  		rst	8
(1) 2585/     DE0 : DD 73 00            		ld	(ix),e		; NEW slot
(1) 2586/     DE3 : DD 72 01            		ld	(ix+1),d
(1) 2587/     DE6 : AF                  		xor	a		; Found free slot, pick it.
(1) 2588/     DE7 : C9                  		ret
(1) 2589/     DE8 :                     .busy_s:
(1) 2590/     DE8 : 3E FF               		ld	a,-1
(1) 2591/     DEA : C9                  		ret
(1) 2592/     DEB :                     
(1) 2593/     DEB :                     ; --------------------------------------------
(1) 2594/     DEB :                     ; Check available channel slot from list
(1) 2595/     DEB :                     ; --------------------------------------------
(1) 2596/     DEB :                     
(1) 2597/     DEB :                     .chk_tbl:
(1) 2598/     DEB : 01 00 00            		ld	bc,0		; bc - Free slot point
(1) 2599/     DEE :                     .next:
(1) 2600/     DEE : DD 7E 01            		ld	a,(ix+1)	; Check MSB first
(1) 2601/     DF1 : FE FF               		cp	-1		; End of list? (as WORD: 0FFxxh)
(1) 2602/     DF3 : 28 2A               		jr	z,.chkfree
(1) 2603/     DF5 : FD E5               		push	iy
(1) 2604/     DF7 : D1                  		pop	de		; de - Copy of curr track-channel
(1) 2605/     DF8 : CF                  		rst	8
(1) 2606/     DF9 : BA                  		cp	d		; check if link matches
(1) 2607/     DFA : 20 08               		jr	nz,.diffr
(1) 2608/     DFC : DD 7E 00            		ld	a,(ix)
(1) 2609/     DFF : BB                  		cp	e
(1) 2610/     E00 : 20 02               		jr	nz,.diffr
(1) 2611/     E02 : AF                  		xor	a		; return 0
(1) 2612/     E03 : C9                  		ret
(1) 2613/     E04 :                     .diffr:
(1) 2614/     E04 : 79                  		ld	a,c		; bc link already set?
(1) 2615/     E05 : B0                  		or	b
(1) 2616/     E06 : 20 10               		jr	nz,.alrdfnd
(1) 2617/     E08 : CF                  		rst	8
(1) 2618/     E09 : DD 5E 01            		ld	e,(ix+1)	; Check if this link == 0
(1) 2619/     E0C : DD 7E 00            		ld	a,(ix)
(1) 2620/     E0F : B3                  		or	e
(1) 2621/     E10 : 28 02               		jr	z,.fndlink
(1) 2622/     E12 :                     
(1) 2623/     E12 :                     	; priority
(1) 2624/     E12 :                     
(1) 2625/     E12 : 18 04               		jr	.alrdfnd
(1) 2626/     E14 :                     
(1) 2627/     E14 :                     ; 		push	de		; Check if this link is
(1) 2628/     E14 :                     ; 		ld	d,(ix+1)	; floating.
(1) 2629/     E14 :                     ; 		ld	e,(ix)
(1) 2630/     E14 :                     ; 		inc	de
(1) 2631/     E14 :                     ; 		rst	8
(1) 2632/     E14 :                     ; 		ld	a,(de)
(1) 2633/     E14 :                     ; 		pop	de
(1) 2634/     E14 :                     ; 		cp	-2
(1) 2635/     E14 :                     ; 		jr	z,.fndlink
(1) 2636/     E14 :                     ; 		cp	-1
(1) 2637/     E14 :                     ; 		jr	z,.fndlink
(1) 2638/     E14 :                     
(1) 2639/     E14 :                     ; 		jr	.alrdfnd
(1) 2640/     E14 :                     	; **** MSB priority overwrite
(1) 2641/     E14 :                     ; 		ld	a,e
(1) 2642/     E14 :                     ; 		cp	d
(1) 2643/     E14 :                     ; 		jr	nc,.alrdfnd
(1) 2644/     E14 :                     	; ****
(1) 2645/     E14 :                     
(1) 2646/     E14 :                     .fndlink:
(1) 2647/     E14 : DD E5               		push	ix		; bc - got new link
(1) 2648/     E16 : C1                  		pop	bc
(1) 2649/     E17 : CF                  		rst	8
(1) 2650/     E18 :                     .alrdfnd:
(1) 2651/     E18 : 11 08 00            		ld	de,8		; Next channel table
(1) 2652/     E1B : DD 19               		add	ix,de
(1) 2653/     E1D : 18 CF               		jr	.next
(1) 2654/     E1F :                     
(1) 2655/     E1F :                     ; free link slot
(1) 2656/     E1F :                     .chkfree:
(1) 2657/     E1F : 79                  		ld	a,c		; found free link?
(1) 2658/     E20 : B0                  		or	b
(1) 2659/     E21 : 28 0F               		jr	z,.fndslot
(1) 2660/     E23 : C5                  		push	bc
(1) 2661/     E24 : DD E1               		pop	ix		; tell ix is the new slot
(1) 2662/     E26 : FD E5               		push	iy
(1) 2663/     E28 : D1                  		pop	de		; and mark it on buffer
(1) 2664/     E29 : CF                  		rst	8
(1) 2665/     E2A : DD 73 00            		ld	(ix),e
(1) 2666/     E2D : DD 72 01            		ld	(ix+1),d
(1) 2667/     E30 : AF                  		xor	a
(1) 2668/     E31 : C9                  		ret
(1) 2669/     E32 :                     .fndslot:
(1) 2670/     E32 : 3E FF               		ld	a,-1		; linksteal check goes here
(1) 2671/     E34 : C9                  		ret
(1) 2672/     E35 :                     
(1) 2673/     E35 :                     ; ====================================================================
(1) 2674/     E35 :                     ; ----------------------------------------------------------------
(1) 2675/     E35 :                     ; Subroutines
(1) 2676/     E35 :                     ; ----------------------------------------------------------------
(1) 2677/     E35 :                     
(1) 2678/     E35 :                     ; --------------------------------------------------------
(1) 2679/     E35 :                     ; Init sound engine
(1) 2680/     E35 :                     ; --------------------------------------------------------
(1) 2681/     E35 :                     
(1) 2682/     E35 :                     gema_init:
(1) 2683/     E35 : CD 2E 13            		call	dac_off
(1) 2684/     E38 : 3E 00               		ld	a,0
(1) 2685/     E3A : 32 2F 00            		ld	(marsUpd),a
(1) 2686/     E3D : 21 00 1B            		ld	hl,dWaveBuff	; hl - Wave buffer START
(1) 2687/     E40 : 11 01 1B            		ld	de,dWaveBuff+1	; de - Wave next byte
(1) 2688/     E43 : 01 FF 00            		ld	bc,100h-1	; bc - length for copying
(1) 2689/     E46 : 36 80               		ld	(hl),80h	; Set first byte
(1) 2690/     E48 : ED B0               		ldir			; Start copying
(1) 2691/     E4A : 21 11 7F            		ld	hl,Zpsg_ctrl	; Silence PSG channels
(1) 2692/     E4D : 36 9F               		ld	(hl),09Fh
(1) 2693/     E4F : 36 BF               		ld	(hl),0BFh
(1) 2694/     E51 : 36 DF               		ld	(hl),0DFh
(1) 2695/     E53 : 36 FF               		ld	(hl),0FFh
(1) 2696/     E55 : 11 0B 22            		ld	de,2208h|3	; Set default LFO
(1) 2697/     E58 : CD 03 13            		call	fm_send_1
(1) 2698/     E5B : 11 00 27            		ld	de,2700h	; CH3 special and timers off
(1) 2699/     E5E : CD 03 13            		call	fm_send_1
(1) 2700/     E61 : 11 00 28            		ld	de,2800h	; FM KEYS off
(1) 2701/     E64 : CD 03 13            		call	fm_send_1
(1) 2702/     E67 : 1C                  		inc	e
(1) 2703/     E68 : CD 03 13            		call	fm_send_1
(1) 2704/     E6B : 1C                  		inc	e
(1) 2705/     E6C : CD 03 13            		call	fm_send_1
(1) 2706/     E6F : 1C                  		inc	e
(1) 2707/     E70 : 1C                  		inc	e
(1) 2708/     E71 : CD 03 13            		call	fm_send_1
(1) 2709/     E74 : 1C                  		inc	e
(1) 2710/     E75 : CD 03 13            		call	fm_send_1
(1) 2711/     E78 : 1C                  		inc	e
(1) 2712/     E79 : CD 03 13            		call	fm_send_1
(1) 2713/     E7C : 21 00 60            		ld	hl,6000h
(1) 2714/     E7F : 3E 01               		ld	a,1
(1) 2715/     E81 : 77                  		ld	(hl),a
(1) 2716/     E82 : 77                  		ld	(hl),a
(1) 2717/     E83 : 77                  		ld	(hl),a
(1) 2718/     E84 : 77                  		ld	(hl),a
(1) 2719/     E85 : 77                  		ld	(hl),a
(1) 2720/     E86 : 77                  		ld	(hl),a
(1) 2721/     E87 : 77                  		ld	(hl),a
(1) 2722/     E88 : 77                  		ld	(hl),a
(1) 2723/     E89 : 77                  		ld	(hl),a
(1) 2724/     E8A :                     
(1) 2725/     E8A :                     	; set each tracks' settings
(1) 2726/     E8A : FD 21 60 19         		ld	iy,trkBuff_0
(1) 2727/     E8E : 21 00 1C            		ld	hl,trkData_0
(1) 2728/     E91 : 1E 11               		ld	e,MAX_TRKCHN
(1) 2729/     E93 : 16 80               		ld	d,8*16			; maximum size
(1) 2730/     E95 : CD A6 0E            		call	.set_it
(1) 2731/     E98 : FD 21 08 1A         		ld	iy,trkBuff_1
(1) 2732/     E9C : 21 00 1D            		ld	hl,trkData_1
(1) 2733/     E9F : 1E 11               		ld	e,MAX_TRKCHN
(1) 2734/     EA1 : 16 80               		ld	d,8*16
(1) 2735/     EA3 : CD A6 0E            		call	.set_it
(1) 2736/     EA6 :                     .set_it:
(1) 2737/     EA6 : FD 75 18            		ld	(iy+trk_CachNotes),l
(1) 2738/     EA9 : FD 74 19            		ld	(iy+(trk_CachNotes+1)),h
(1) 2739/     EAC :                     ; 		ld	(iy+trk_numChnls),e
(1) 2740/     EAC : FD 72 16            		ld	(iy+trk_sizeIns),d
(1) 2741/     EAF : C9                  		ret
(1) 2742/     EB0 :                     
(1) 2743/     EB0 :                     ; --------------------------------------------------------
(1) 2744/     EB0 :                     ; get_tick
(1) 2745/     EB0 :                     ;
(1) 2746/     EB0 :                     ; Checks if VBlank triggred a TICK
(1) 2747/     EB0 :                     ; (1/150 NTSC, 1/120 PAL)
(1) 2748/     EB0 :                     ; --------------------------------------------------------
(1) 2749/     EB0 :                     
(1) 2750/     EB0 :                     get_tick:
(1) 2751/     EB0 : F3                  		di				; Disable ints
(1) 2752/     EB1 : F5                  		push	af
(1) 2753/     EB2 : E5                  		push	hl
(1) 2754/     EB3 : 21 49 1E            		ld	hl,tickFlag+1		; read last TICK flag
(1) 2755/     EB6 : 7E                  		ld	a,(hl)			; non-zero value (1Fh)?
(1) 2756/     EB7 : B7                  		or 	a
(1) 2757/     EB8 : 28 13               		jr	z,.ctnotick
(1) 2758/     EBA : 36 00               		ld	(hl),0			; Reset TICK flag
(1) 2759/     EBC : 23                  		inc	hl			; Move to tickCnt
(1) 2760/     EBD : 34                  		inc	(hl)			; and increment
(1) 2761/     EBE : CF                  		rst	8
(1) 2762/     EBF : D5                  		push	de
(1) 2763/     EC0 : 2A 34 00            		ld	hl,(sbeatAcc)		; Increment subbeats
(1) 2764/     EC3 : ED 5B 32 00         		ld	de,(sbeatPtck_1)
(1) 2765/     EC7 : CF                  		rst	8
(1) 2766/     EC8 : 19                  		add	hl,de
(1) 2767/     EC9 : 22 34 00            		ld	(sbeatAcc),hl
(1) 2768/     ECC : D1                  		pop	de
(1) 2769/     ECD :                     .ctnotick:
(1) 2770/     ECD : E1                  		pop	hl
(1) 2771/     ECE : F1                  		pop	af
(1) 2772/     ECF : FB                  		ei				; Enable ints again
(1) 2773/     ED0 : C9                  		ret
(1) 2774/     ED1 :                     
(1) 2775/     ED1 :                     ; --------------------------------------------------------
(1) 2776/     ED1 :                     ; showRom:
(1) 2777/     ED1 :                     ; Get ROM position visible for reading
(1) 2778/     ED1 :                     ;
(1) 2779/     ED1 :                     ; Input:
(1) 2780/     ED1 :                     ;  b - ROM address $xx0000
(1) 2781/     ED1 :                     ; hl - ROM address $00xxxx
(1) 2782/     ED1 :                     ;
(1) 2783/     ED1 :                     ; Output:
(1) 2784/     ED1 :                     ; hl - ROM position ready to use for reading
(1) 2785/     ED1 :                     ; --------------------------------------------------------
(1) 2786/     ED1 :                     
(1) 2787/     ED1 :                     showRom:
(1) 2788/     ED1 : CF                  		rst	8
(1) 2789/     ED2 : D5                  		push	de
(1) 2790/     ED3 : C5                  		push	bc
(1) 2791/     ED4 : 11 00 60            		ld	de,6000h
(1) 2792/     ED7 : 7C                  		ld	a,h
(1) 2793/     ED8 : 07                  		rlca
(1) 2794/     ED9 : CF                  		rst	8
(1) 2795/     EDA : 12                  		ld	(de),a
(1) 2796/     EDB : 78                  		ld	a,b
(1) 2797/     EDC : 12                  		ld	(de),a
(1) 2798/     EDD : 1F                  		rra
(1) 2799/     EDE : 12                  		ld	(de),a
(1) 2800/     EDF : 1F                  		rra
(1) 2801/     EE0 : 12                  		ld	(de),a
(1) 2802/     EE1 : 1F                  		rra
(1) 2803/     EE2 : CF                  		rst	8
(1) 2804/     EE3 : 12                  		ld	(de),a
(1) 2805/     EE4 : 1F                  		rra
(1) 2806/     EE5 : 12                  		ld	(de),a
(1) 2807/     EE6 : 1F                  		rra
(1) 2808/     EE7 : 12                  		ld	(de),a
(1) 2809/     EE8 : 1F                  		rra
(1) 2810/     EE9 : 12                  		ld	(de),a
(1) 2811/     EEA : 1F                  		rra
(1) 2812/     EEB : 12                  		ld	(de),a
(1) 2813/     EEC : CF                  		rst	8
(1) 2814/     EED : C1                  		pop	bc
(1) 2815/     EEE : D1                  		pop	de
(1) 2816/     EEF : CB FC               		set	7,h
(1) 2817/     EF1 : C9                  		ret
(1) 2818/     EF2 :                     
(1) 2819/     EF2 :                     ; --------------------------------------------------------
(1) 2820/     EF2 :                     ; readRomB:
(1) 2821/     EF2 :                     ; Reads a byte from ROM safetly, for a single and quick
(1) 2822/     EF2 :                     ; byte-read only, NOT autoswitchable.
(1) 2823/     EF2 :                     ; CALL showRom FIRST, DO NOT CALL RST 20h (dac_fill)
(1) 2824/     EF2 :                     ; BEFORE GETTING HERE
(1) 2825/     EF2 :                     ;
(1) 2826/     EF2 :                     ; Input:
(1) 2827/     EF2 :                     ; hl - ROM position in Z80's area
(1) 2828/     EF2 :                     ;      (BANK must be set first)
(1) 2829/     EF2 :                     ;
(1) 2830/     EF2 :                     ; Output:
(1) 2831/     EF2 :                     ; a - byte recieved
(1) 2832/     EF2 :                     ; --------------------------------------------------------
(1) 2833/     EF2 :                     
(1) 2834/     EF2 :                     ; ALL this code just to read one byte without bothering
(1) 2835/     EF2 :                     ; the DMA from the 68k side
(1) 2836/     EF2 :                     
(1) 2837/     EF2 :                     readRomB:
(1) 2838/     EF2 : DD E5               		push	ix
(1) 2839/     EF4 : DD 21 1C 00         		ld	ix,commZRomBlk
(1) 2840/     EF8 : DD CB 01 C6         		set	0,(ix+1)	; ROM read request
(1) 2841/     EFC : DD CB 00 46         		bit	0,(ix)		; 68k is on DMA?
(1) 2842/     F00 : 20 09               		jr	nz,.wait
(1) 2843/     F02 : 7E                  .imback:	ld	a,(hl)		; Read the byte.
(1) 2844/     F03 : DD CB 01 86         		res	0,(ix+1)
(1) 2845/     F07 : CF                  		rst	8
(1) 2846/     F08 : DD E1               		pop	ix
(1) 2847/     F0A : C9                  		ret
(1) 2848/     F0B :                     .wait:
(1) 2849/     F0B : DD CB 01 86         		res	0,(ix+1)	; Not reading ROM
(1) 2850/     F0F :                     .w2:
(1) 2851/     F0F : CF                  		rst	8
(1) 2852/     F10 : 00                  		nop
(1) 2853/     F11 : 00                  		nop
(1) 2854/     F12 : CF                  		rst	8
(1) 2855/     F13 : DD CB 00 46         		bit	0,(ix)		; Is ROM free from 68K?
(1) 2856/     F17 : 20 F6               		jr	nz,.w2
(1) 2857/     F19 : DD CB 01 C6         		set	0,(ix+1)	; Reading ROM again.
(1) 2858/     F1D : 18 E3               		jr	.imback
(1) 2859/     F1F :                     
(1) 2860/     F1F :                     ; --------------------------------------------------------
(1) 2861/     F1F :                     ; transferRom
(1) 2862/     F1F :                     ;
(1) 2863/     F1F :                     ; Transfer bytes from ROM to Z80, this also tells
(1) 2864/     F1F :                     ; to 68k that we are reading fom ROM
(1) 2865/     F1F :                     ;
(1) 2866/     F1F :                     ; Input:
(1) 2867/     F1F :                     ; a  - Source ROM address $xx0000
(1) 2868/     F1F :                     ;  c - Byte count (size 0 NOT allowed, MAX: 0FFh)
(1) 2869/     F1F :                     ; hl - Source ROM address $00xxxx
(1) 2870/     F1F :                     ; de - Destination address
(1) 2871/     F1F :                     ;
(1) 2872/     F1F :                     ; Uses:
(1) 2873/     F1F :                     ; b, ix
(1) 2874/     F1F :                     ;
(1) 2875/     F1F :                     ; Notes:
(1) 2876/     F1F :                     ; call dac_fill first if transfering anything other than
(1) 2877/     F1F :                     ; sample data, just to be safe
(1) 2878/     F1F :                     ; --------------------------------------------------------
(1) 2879/     F1F :                     
(1) 2880/     F1F :                     ; Note: got this from GEMS...
(1) 2881/     F1F :                     
(1) 2882/     F1F :                     transferRom:
(1) 2883/     F1F : CF                  		rst	8
(1) 2884/     F20 : DD E5               		push	ix
(1) 2885/     F22 : DD 21 1C 00         		ld	ix,commZRomBlk	; ix - rom read/block flags
(1) 2886/     F26 : 22 36 00            		ld	(x68ksrclsb),hl	; save hl copy
(1) 2887/     F29 : CB BC               		res	7,h
(1) 2888/     F2B : 06 00               		ld	b,0
(1) 2889/     F2D : 0B                  		dec	bc
(1) 2890/     F2E : 09                  		add	hl,bc
(1) 2891/     F2F : CB 7C               		bit	7,h
(1) 2892/     F31 : 20 0B               		jr	nz,.double
(1) 2893/     F33 : 2A 36 00            		ld	hl,(x68ksrclsb)	; single transfer
(1) 2894/     F36 : 0C                  		inc	c
(1) 2895/     F37 : 47                  		ld	b,a
(1) 2896/     F38 : CD 63 0F            		call	.transfer
(1) 2897/     F3B : DD E1               		pop	ix
(1) 2898/     F3D : C9                  		ret
(1) 2899/     F3E :                     .double:
(1) 2900/     F3E : CF                  		rst	8
(1) 2901/     F3F : 47                  		ld	b,a		; double transfer
(1) 2902/     F40 : C5                  		push	bc
(1) 2903/     F41 : E5                  		push	hl
(1) 2904/     F42 : 79                  		ld	a,c
(1) 2905/     F43 : 95                  		sub	a,l
(1) 2906/     F44 : 4F                  		ld	c,a
(1) 2907/     F45 : 2A 36 00            		ld	hl,(x68ksrclsb)
(1) 2908/     F48 : CD 63 0F            		call	.transfer
(1) 2909/     F4B : E1                  		pop	hl
(1) 2910/     F4C : C1                  		pop	bc
(1) 2911/     F4D : CF                  		rst	8
(1) 2912/     F4E : 4D                  		ld	c,l
(1) 2913/     F4F : 0C                  		inc	c
(1) 2914/     F50 : 3A 37 00            		ld	a,(x68ksrcmid)
(1) 2915/     F53 : E6 80               		and	80h
(1) 2916/     F55 : C6 80               		add	a,80h
(1) 2917/     F57 : 67                  		ld	h,a
(1) 2918/     F58 : 2E 00               		ld	l,0
(1) 2919/     F5A : 30 01               		jr	nc,.x68knocarry
(1) 2920/     F5C : 04                  		inc	b
(1) 2921/     F5D :                     .x68knocarry:
(1) 2922/     F5D : CD 63 0F            		call	.transfer
(1) 2923/     F60 : DD E1               		pop	ix
(1) 2924/     F62 : C9                  		ret
(1) 2925/     F63 :                     
(1) 2926/     F63 :                     ; ------------------------------------------------
(1) 2927/     F63 :                     ; b  - Source ROM xx0000
(1) 2928/     F63 :                     ;  c - Bytes to transfer (00h not allowed)
(1) 2929/     F63 :                     ; hl - Source ROM 00xxxx (OR'd with 8000h)
(1) 2930/     F63 :                     ; de - Destination address
(1) 2931/     F63 :                     ;
(1) 2932/     F63 :                     ; Uses:
(1) 2933/     F63 :                     ; a
(1) 2934/     F63 :                     ; ------------------------------------------------
(1) 2935/     F63 :                     
(1) 2936/     F63 :                     .transfer:
(1) 2937/     F63 : CD D1 0E            		call	showRom
(1) 2938/     F66 :                     
(1) 2939/     F66 :                     	; Transfer data in packs of bytes
(1) 2940/     F66 :                     	; while playing cache WAV in the process
(1) 2941/     F66 :                     	; *** CRITICAL PROCESS FOR WAV PLAYBACK ***
(1) 2942/     F66 :                     	;
(1) 2943/     F66 :                     	; pseudo-ref for ldir:
(1) 2944/     F66 :                     	; ld (de),(hl)
(1) 2945/     F66 :                     	; inc de
(1) 2946/     F66 :                     	; inc hl
(1) 2947/     F66 :                     	; dec bc
(1) 2948/     F66 :                     	;
(1) 2949/     F66 : 06 00               		ld	b,0
(1) 2950/     F68 : 79                  		ld	a,c		; a - pieces counter
(1) 2951/     F69 : DD CB 01 C6         		set	0,(ix+1)	; Tell to 68k that we are reading from ROM
(1) 2952/     F6D : D6 06               		sub	6		; LENGHT lower than 6?
(1) 2953/     F6F : 38 11               		jr	c,.x68klast	; Process single piece only
(1) 2954/     F71 :                     .x68kloop:
(1) 2955/     F71 : CF                  		rst	8
(1) 2956/     F72 : 0E 05               		ld	c,6-1
(1) 2957/     F74 : DD CB 00 46         		bit	0,(ix)		; If 68k requested ROM block from here
(1) 2958/     F78 : 20 1A               		jr	nz,.x68klpwt
(1) 2959/     F7A :                     .x68klpcont:
(1) 2960/     F7A : CF                  		rst	8
(1) 2961/     F7B : ED B0               		ldir			; (de) to (hl) until bc==0
(1) 2962/     F7D : D6 05               		sub	a,6-1
(1) 2963/     F7F : D2 71 0F            		jp	nc,.x68kloop
(1) 2964/     F82 :                     ; last block
(1) 2965/     F82 :                     .x68klast:
(1) 2966/     F82 : C6 06               		add	a,6
(1) 2967/     F84 : 4F                  		ld	c,a
(1) 2968/     F85 : DD CB 00 46         		bit	0,(ix)		; If 68k requested ROM block from here
(1) 2969/     F89 : C2 A7 0F            		jp	nz,.x68klstwt
(1) 2970/     F8C :                     .x68klstcont:
(1) 2971/     F8C : CF                  		rst	8
(1) 2972/     F8D : ED B0               		ldir
(1) 2973/     F8F : DD CB 01 86         		res	0,(ix+1)	; Tell 68k we are done reading
(1) 2974/     F93 : C9                  		ret
(1) 2975/     F94 :                     
(1) 2976/     F94 :                     ; If Genesis wants to do DMA, wait here until it finishes.
(1) 2977/     F94 :                     .x68klpwt:
(1) 2978/     F94 : DD CB 01 86         		res	0,(ix+1)	; Tell 68k we are out, waiting.
(1) 2979/     F98 :                     .x68kpwtlp:
(1) 2980/     F98 : CF                  		rst	8
(1) 2981/     F99 : 00                  		nop
(1) 2982/     F9A : CF                  		rst	8
(1) 2983/     F9B : DD CB 00 46         		bit	0,(ix)		; 68k finished?
(1) 2984/     F9F : 20 F7               		jr	nz,.x68kpwtlp
(1) 2985/     FA1 : DD CB 01 C6         		set	0,(ix+1)	; Set Z80 read flag again, and return
(1) 2986/     FA5 : 18 D3               		jr	.x68klpcont
(1) 2987/     FA7 :                     
(1) 2988/     FA7 :                     ; or in the last piece
(1) 2989/     FA7 :                     .x68klstwt:
(1) 2990/     FA7 : DD CB 01 86         		res	0,(ix+1)	; Tell 68k we are out, waiting.
(1) 2991/     FAB :                     .x68klstwtlp:
(1) 2992/     FAB : CF                  		rst	8
(1) 2993/     FAC : 00                  		nop
(1) 2994/     FAD : CF                  		rst	8
(1) 2995/     FAE : DD CB 00 46         		bit	0,(ix)		; 68k finished?
(1) 2996/     FB2 : 20 F7               		jr	nz,.x68klstwtlp
(1) 2997/     FB4 : DD CB 01 C6         		set	0,(ix+1)	; Set Z80 read flag again, and return
(1) 2998/     FB8 : 18 D2               		jr	.x68klstcont
(1) 2999/     FBA :                     
(1) 3000/     FBA :                     ; ====================================================================
(1) 3001/     FBA :                     ; ----------------------------------------------------------------
(1) 3002/     FBA :                     ; Sound chip routines
(1) 3003/     FBA :                     ; ----------------------------------------------------------------
(1) 3004/     FBA :                     
(1) 3005/     FBA :                     ; --------------------------------------------------------
(1) 3006/     FBA :                     ; chip_env
(1) 3007/     FBA :                     ;
(1) 3008/     FBA :                     ; Process PSG and FM
(1) 3009/     FBA :                     ; --------------------------------------------------------
(1) 3010/     FBA :                     
(1) 3011/     FBA :                     ; Read PSG list backwards so it autodetects
(1) 3012/     FBA :                     ; Tone3 mode
(1) 3013/     FBA :                     
(1) 3014/     FBA :                     chip_env:
(1) 3015/     FBA : FD 21 9F 16         		ld	iy,psgcom+3		; Start from NOISE first
(1) 3016/     FBE : 21 11 7F            		ld	hl,Zpsg_ctrl
(1) 3017/     FC1 : 16 E0               		ld	d,0E0h			; PSG first ctrl command
(1) 3018/     FC3 : 1E 04               		ld	e,4			; 4 channels
(1) 3019/     FC5 :                     .vloop:
(1) 3020/     FC5 : CF                  		rst	8
(1) 3021/     FC6 : FD 4E 00            		ld	c,(iy+COM)		; c - current command
(1) 3022/     FC9 : FD 36 00 00         		ld	(iy+COM),0
(1) 3023/     FCD : CB 51               		bit	2,c			; bit 2 - stop sound
(1) 3024/     FCF : 28 17               		jr	z,.ckof
(1) 3025/     FD1 : FD 36 04 FF         		ld	(iy+LEV),-1		; reset level
(1) 3026/     FD5 : FD 36 28 01         		ld	(iy+FLG),1		; and update
(1) 3027/     FD9 : FD 36 18 00         		ld	(iy+MODE),0		; envelope off
(1) 3028/     FDD : 7B                  		ld	a,e
(1) 3029/     FDE : FE 04               		cp	4
(1) 3030/     FE0 : 20 06               		jr	nz,.ckof
(1) 3031/     FE2 : 3E 00               		ld	a,0
(1) 3032/     FE4 : 32 5E 1E            		ld	(psgHatMode),a
(1) 3033/     FE7 : CF                  		rst	8
(1) 3034/     FE8 :                     .ckof:
(1) 3035/     FE8 : CB 49               		bit	1,c			; bit 1 - key off
(1) 3036/     FEA : 28 19               		jr      z,.ckon
(1) 3037/     FEC : FD 7E 18            		ld	a,(iy+MODE)		; mode 0?
(1) 3038/     FEF : B7                  		or	a
(1) 3039/     FF0 : 28 13               		jr	z,.ckon
(1) 3040/     FF2 : FD 36 28 01         		ld	(iy+FLG),1		; psg update flag
(1) 3041/     FF6 : FD 36 18 04         		ld	(iy+MODE),100b		; set envelope mode 100b
(1) 3042/     FFA : 7B                  		ld	a,e
(1) 3043/     FFB : FE 04               		cp	4
(1) 3044/     FFD : 20 06               		jr	nz,.ckon
(1) 3045/     FFF : 3E 00               		ld	a,0
(1) 3046/    1001 : 32 5E 1E            		ld	(psgHatMode),a
(1) 3047/    1004 : CF                  		rst	8
(1) 3048/    1005 :                     .ckon:
(1) 3049/    1005 : CB 41               		bit	0,c			; bit 0 - key on
(1) 3050/    1007 : 28 57               		jr	z,.envproc
(1) 3051/    1009 : FD 36 04 FF         		ld	(iy+LEV),-1		; reset level
(1) 3052/    100D : 3A 5E 1E            		ld	a,(psgHatMode)		; check if using tone3 mode.
(1) 3053/    1010 : 4F                  		ld	c,a
(1) 3054/    1011 : E6 03               		and	11b
(1) 3055/    1013 : FE 03               		cp	11b
(1) 3056/    1015 : 28 24               		jr	z,.tnmode
(1) 3057/    1017 :                     .wrfreq:
(1) 3058/    1017 : 7B                  		ld	a,e
(1) 3059/    1018 : FE 04               		cp	4
(1) 3060/    101A : 28 35               		jr	z,.sethat
(1) 3061/    101C : CF                  		rst	8
(1) 3062/    101D :                     
(1) 3063/    101D : FD 7E 1C            		ld	a,(iy+DTL)	; Grab LSB 4 right bits
(1) 3064/    1020 : E6 0F               		and	00001111b
(1) 3065/    1022 : B2                  		or	d		; OR with current channel
(1) 3066/    1023 : 77                  		ld	(hl),a		; write it
(1) 3067/    1024 : FD 7E 1C            		ld	a,(iy+DTL)	; Grab LSB 4 left bits
(1) 3068/    1027 : 0F                  		rrca
(1) 3069/    1028 : 0F                  		rrca
(1) 3070/    1029 : 0F                  		rrca
(1) 3071/    102A : 0F                  		rrca
(1) 3072/    102B : E6 0F               		and	00001111b
(1) 3073/    102D : 4F                  		ld	c,a
(1) 3074/    102E : FD 7E 20            		ld	a,(iy+DTH)	; Grab MSB bits
(1) 3075/    1031 : 07                  		rlca
(1) 3076/    1032 : 07                  		rlca
(1) 3077/    1033 : 07                  		rlca
(1) 3078/    1034 : 07                  		rlca
(1) 3079/    1035 : E6 30               		and	00110000b
(1) 3080/    1037 : B1                  		or	c
(1) 3081/    1038 : 77                  		ld	(hl),a
(1) 3082/    1039 :                     
(1) 3083/    1039 : 18 1C               		jr	.nskip
(1) 3084/    103B :                     ; Tone3 mode
(1) 3085/    103B :                     .tnmode:
(1) 3086/    103B : 7B                  		ld	a,e
(1) 3087/    103C : FE 04               		cp	4			; NOISE
(1) 3088/    103E : 28 06               		jr	z,.psteal
(1) 3089/    1040 : FE 03               		cp	3			; PSG3, can't play
(1) 3090/    1042 : 28 13               		jr	z,.nskip
(1) 3091/    1044 : 18 D1               		jr	.wrfreq
(1) 3092/    1046 :                     .psteal:
(1) 3093/    1046 : CF                  		rst	8
(1) 3094/    1047 : FD 7E 1C            		ld	a,(iy+DTL)		; Steal PSG3's freq
(1) 3095/    104A : F6 C0               		or	0C0h
(1) 3096/    104C : 77                  		ld	(hl),a
(1) 3097/    104D : FD 7E 20            		ld	a,(iy+DTH)
(1) 3098/    1050 : 77                  		ld	(hl),a
(1) 3099/    1051 :                     .sethat:
(1) 3100/    1051 : CF                  		rst	8
(1) 3101/    1052 : 3A 5E 1E            		ld	a,(psgHatMode)		; write hat mode only.
(1) 3102/    1055 : B2                  		or	d
(1) 3103/    1056 : 77                  		ld	(hl),a
(1) 3104/    1057 :                     .nskip:
(1) 3105/    1057 : FD 36 28 01         		ld	(iy+FLG),1		; psg update flag
(1) 3106/    105B : FD 36 18 01         		ld	(iy+MODE),001b		; set to attack mode
(1) 3107/    105F : CF                  		rst	8
(1) 3108/    1060 :                     
(1) 3109/    1060 :                     ; ----------------------------
(1) 3110/    1060 :                     ; Process effects
(1) 3111/    1060 :                     ; ----------------------------
(1) 3112/    1060 :                     
(1) 3113/    1060 :                     .envproc:
(1) 3114/    1060 : CF                  		rst	8
(1) 3115/    1061 : FD 7E 18            		ld	a,(iy+MODE)
(1) 3116/    1064 : B7                  		or	a			; no modes
(1) 3117/    1065 : CA EB 10            		jp	z,.vedlp
(1) 3118/    1068 : FE 01               		cp 	001b			; Attack mode
(1) 3119/    106A : 20 2C               		jr	nz,.chk2
(1) 3120/    106C : FD 36 28 01         		ld	(iy+FLG),1		; psg update flag
(1) 3121/    1070 : FD 46 24            		ld	b,(iy+ALV)
(1) 3122/    1073 : FD 7E 08            		ld	a,(iy+ATK)		; if ATK == 0, don't use
(1) 3123/    1076 : B7                  		or	a
(1) 3124/    1077 : 28 16               		jr	z,.atkend
(1) 3125/    1079 : 4F                  		ld	c,a			; c - attack rate
(1) 3126/    107A : 78                  		ld	a,b			; a - attack level
(1) 3127/    107B : CF                  		rst	8
(1) 3128/    107C : FD 46 24            		ld	b,(iy+ALV)		; b - OLD attack level
(1) 3129/    107F : 91                  		sub	a,c			; (attack rate) - (level)
(1) 3130/    1080 : 38 0D               		jr	c,.atkend		; if carry: already finished
(1) 3131/    1082 : 28 0B               		jr	z,.atkend		; if zero: no attack rate
(1) 3132/    1084 : B8                  		cp	b			; attack rate == level?
(1) 3133/    1085 : 38 08               		jr	c,.atkend
(1) 3134/    1087 : 28 06               		jr	z,.atkend
(1) 3135/    1089 : FD 77 04            		ld	(iy+LEV),a		; set new level
(1) 3136/    108C : CF                  		rst	8
(1) 3137/    108D : 18 5C               		jr	.vedlp
(1) 3138/    108F :                     .atkend:
(1) 3139/    108F : FD 70 04            		ld	(iy+LEV),b		; attack level = new level
(1) 3140/    1092 :                     .atkzero:
(1) 3141/    1092 : FD 36 18 02         		ld	(iy+MODE),010b		; set to decay mode
(1) 3142/    1096 : 18 53               		jr	.vedlp
(1) 3143/    1098 :                     .chk2:
(1) 3144/    1098 :                     
(1) 3145/    1098 : FE 02               		cp	010b			; Decay mode
(1) 3146/    109A : 20 31               		jr	nz,.chk4
(1) 3147/    109C :                     .dectmr:
(1) 3148/    109C : FD 36 28 01         		ld	(iy+FLG),1		; psg update flag
(1) 3149/    10A0 : FD 7E 04            		ld	a,(iy+LEV)		; a - Level
(1) 3150/    10A3 : FD 46 10            		ld	b,(iy+SLV)		; b - Sustain
(1) 3151/    10A6 : B8                  		cp	b
(1) 3152/    10A7 : 38 0D               		jr	c,.dkadd		; if carry: add
(1) 3153/    10A9 : 28 18               		jr	z,.dkyend		; if zero:  finish
(1) 3154/    10AB : CF                  		rst	8
(1) 3155/    10AC : FD 96 0C            		sub	(iy+DKY)		; substract decay rate
(1) 3156/    10AF : 38 12               		jr	c,.dkyend		; finish if wraped.
(1) 3157/    10B1 : B8                  		cp	b			; compare level
(1) 3158/    10B2 : 38 0F               		jr	c,.dkyend		; and finish
(1) 3159/    10B4 : 18 08               		jr	.dksav
(1) 3160/    10B6 :                     .dkadd:
(1) 3161/    10B6 : FD 86 0C            		add	a,(iy+DKY)		;  (level) + (decay rate)
(1) 3162/    10B9 : 38 08               		jr	c,.dkyend		; finish if wraped.
(1) 3163/    10BB : B8                  		cp	b			; compare level
(1) 3164/    10BC : 30 05               		jr	nc,.dkyend
(1) 3165/    10BE :                     .dksav:
(1) 3166/    10BE : FD 77 04            		ld	(iy+LEV),a		; save new level
(1) 3167/    10C1 : 18 28               		jr	.vedlp
(1) 3168/    10C3 :                     .dkyend:
(1) 3169/    10C3 : CF                  		rst	8
(1) 3170/    10C4 : FD 70 04            		ld	(iy+LEV),b		; save last attack
(1) 3171/    10C7 : FD 36 18 04         		ld	(iy+MODE),100b		; and set to sustain
(1) 3172/    10CB : 18 1E               		jr	.vedlp
(1) 3173/    10CD :                     .chk4:
(1) 3174/    10CD : FE 04               		cp	100b			; Sustain phase
(1) 3175/    10CF : 20 1A               		jr	nz,.vedlp
(1) 3176/    10D1 : FD 36 28 01         		ld	(iy+FLG),1		; psg update flag
(1) 3177/    10D5 : FD 7E 04            		ld	a,(iy+LEV)		; a - Level
(1) 3178/    10D8 : CF                  		rst	8
(1) 3179/    10D9 : FD 86 14            		add 	a,(iy+RRT)		; add Release Rate
(1) 3180/    10DC : 38 05               		jr	c,.killenv		; release done
(1) 3181/    10DE : FD 77 04            		ld	(iy+LEV),a		; set new Level
(1) 3182/    10E1 : 18 08               		jr	.vedlp
(1) 3183/    10E3 :                     .killenv:
(1) 3184/    10E3 : FD 36 04 FF         		ld	(iy+LEV),-1		; Silence this channel
(1) 3185/    10E7 : FD 36 18 00         		ld	(iy+MODE),0		; Reset mode
(1) 3186/    10EB :                     .vedlp:
(1) 3187/    10EB : FD 7E 28            		ld	a,(iy+FLG)
(1) 3188/    10EE : B7                  		or	a
(1) 3189/    10EF : 28 1E               		jr	z,.noupd
(1) 3190/    10F1 : FD 36 28 00         		ld	(iy+FLG),0	; Reset until next one
(1) 3191/    10F5 : CF                  		rst	8
(1) 3192/    10F6 : FD 7E 04            		ld	a,(iy+LEV)	; a - Level
(1) 3193/    10F9 : FD 86 30            		add	a,(iy+PVOL)	; Level + master volume
(1) 3194/    10FC : 30 02               		jr	nc,.vlmuch
(1) 3195/    10FE : 3E FF               		ld	a,-1
(1) 3196/    1100 :                     .vlmuch:
(1) 3197/    1100 : CB 3F               		srl	a		; (Level >> 4)
(1) 3198/    1102 : CB 3F               		srl	a
(1) 3199/    1104 : CB 3F               		srl	a
(1) 3200/    1106 : CF                  		rst	8
(1) 3201/    1107 : CB 3F               		srl	a
(1) 3202/    1109 : E6 0F               		and	00001111b
(1) 3203/    110B : F6 90               		or	90h		; Set volume-set mode
(1) 3204/    110D : B2                  		or	d		; add current channel
(1) 3206/    110E : 77                  		ld	(hl),a		; Write volume
(1) 3208/    110F :                     
(1) 3209/    110F :                     .noupd:
(1) 3210/    110F : FD 2B               		dec	iy		; next COM to check
(1) 3211/    1111 : 7A                  		ld	a,d
(1) 3212/    1112 : CF                  		rst	8
(1) 3213/    1113 : D6 20               		sub	a,20h		; next PSG (backwards)
(1) 3214/    1115 : 57                  		ld	d,a
(1) 3215/    1116 : 1D                  		dec	e
(1) 3216/    1117 : C2 C5 0F            		jp	nz,.vloop
(1) 3217/    111A :                     
(1) 3218/    111A :                     ; ----------------------------
(1) 3219/    111A :                     ; FM section
(1) 3220/    111A :                     ; ----------------------------
(1) 3221/    111A :                     
(1) 3222/    111A :                     	; Read FM channels
(1) 3223/    111A :                     	; iy - FM com
(1) 3224/    111A :                     	; ix - FM current instrument data
(1) 3225/    111A :                     	;  c - FM channel ID
(1) 3226/    111A : FD 21 78 16         		ld	iy,fmcom
(1) 3227/    111E : DD 21 D0 16         		ld	ix,fmins_com
(1) 3228/    1122 : 01 00 05            		ld	bc,0500h
(1) 3229/    1125 : C5                  .nextfm_1:	push	bc
(1) 3230/    1126 : CD 7C 11            		call	.fm_chnl	; Channel 1
(1) 3231/    1129 : C1                  		pop	bc
(1) 3232/    112A : 11 28 00            		ld	de,28h
(1) 3233/    112D : DD 19               		add	ix,de
(1) 3234/    112F : FD 23               		inc	iy
(1) 3235/    1131 : CF                  		rst	8
(1) 3236/    1132 : 0C                  		inc	c
(1) 3237/    1133 : 79                  		ld	a,c
(1) 3238/    1134 : FE 03               		cp	3		; c == 3?
(1) 3239/    1136 : 20 02               		jr	nz,.nomidc
(1) 3240/    1138 : 0C                  		inc	c
(1) 3241/    1139 : CF                  		rst	8
(1) 3242/    113A :                     .nomidc:
(1) 3243/    113A : 10 E9               		djnz	.nextfm_1
(1) 3244/    113C :                     
(1) 3245/    113C :                     	; Special check for Channel 6
(1) 3246/    113C : 3A CC 17            		ld	a,(daccom)	; Channel 6 / DAC
(1) 3247/    113F : 5F                  		ld	e,a
(1) 3248/    1140 : AF                  		xor	a
(1) 3249/    1141 : 32 CC 17            		ld	(daccom),a
(1) 3250/    1144 : CB 43               		bit	0,e		; WAVE sample request
(1) 3251/    1146 : 20 21               		jr	nz,.req_dac
(1) 3252/    1148 : CB 63               		bit	4,e
(1) 3253/    114A : 20 2A               		jr	nz,.req_pitch
(1) 3254/    114C : CF                  		rst	8
(1) 3255/    114D : CB 53               		bit	2,e		; key-cut?
(1) 3256/    114F : C2 2E 13            		jp	nz,dac_off
(1) 3257/    1152 : CB 4B               		bit	1,e		; key-off?
(1) 3258/    1154 : C0                  		ret	nz
(1) 3259/    1155 : 3A 08 00            		ld 	a,(dac_me)	; manually check if
(1) 3260/    1158 : FE D9               		cp	zopcExx		; WAVE playback is active
(1) 3261/    115A : C8                  		ret	z
(1) 3262/    115B : 11 28 00            		ld	de,28h
(1) 3263/    115E : DD 19               		add	ix,de
(1) 3264/    1160 : CF                  		rst	8
(1) 3265/    1161 : DD 7E 00            		ld	a,(ix)
(1) 3266/    1164 : FD 23               		inc	iy
(1) 3267/    1166 : 0C                  		inc	c
(1) 3268/    1167 : 18 13               		jr	.fm_chnl			; Channel 6 (normal)
(1) 3269/    1169 :                     .req_dac:
(1) 3270/    1169 : 16 B6               		ld	d,0B6h			; Panning for DAC
(1) 3271/    116B : 3A 8F 16            		ld	a,((fmcom+5)+FMPAN)	; Reuse FM6's panning
(1) 3272/    116E : 1E C0               		ld	e,11000000b
(1) 3273/    1170 : CD 0E 13            		call	fm_send_2
(1) 3274/    1173 : C3 43 13            		jp	dac_play		; Set playback
(1) 3275/    1176 :                     .req_pitch:
(1) 3276/    1176 : D9                  		exx
(1) 3277/    1177 : 2A 54 1E            		ld	hl,(wave_Pitch)
(1) 3278/    117A : D9                  		exx
(1) 3279/    117B :                     ; 		bit	4,c
(1) 3280/    117B :                     ; 		ret	nz
(1) 3281/    117B :                     ; 		exx
(1) 3282/    117B :                     ; 		push	de
(1) 3283/    117B :                     ; 		exx
(1) 3284/    117B :                     ; 		pop	hl
(1) 3285/    117B :                     ; 		rst	8
(1) 3286/    117B :                     ; 		add	hl,de
(1) 3287/    117B :                     ; 		push	hl
(1) 3288/    117B :                     ; 		exx
(1) 3289/    117B :                     ; 		pop	de
(1) 3290/    117B :                     ; 		exx
(1) 3291/    117B : C9                  		ret
(1) 3292/    117C :                     
(1) 3293/    117C :                     ; ----------------------------------------
(1) 3294/    117C :                     ; Control current FM channel
(1) 3295/    117C :                     ;
(1) 3296/    117C :                     ; iy - fmcom
(1) 3297/    117C :                     ; ix - Instrument data pointer
(1) 3298/    117C :                     ;  c - FM chip ID
(1) 3299/    117C :                     ; ----------------------------------------
(1) 3300/    117C :                     
(1) 3301/    117C :                     	; 0pvi 0cop
(1) 3302/    117C :                     	; pvi - update bits:
(1) 3303/    117C :                     	;      volume(v)
(1) 3304/    117C :                     	;      instrument(i)
(1) 3305/    117C :                     	;      panning(p)
(1) 3306/    117C :                     	;
(1) 3307/    117C :                     	; c/o/p key cut, key off, key on
(1) 3308/    117C :                     .fm_chnl:
(1) 3309/    117C : FD 7E 00            		ld	a,(iy)		; Get comm bits
(1) 3310/    117F : B7                  		or	a
(1) 3311/    1180 : C8                  		ret	z
(1) 3312/    1181 : FD 36 00 00         		ld	(iy),0		; Reset
(1) 3313/    1185 : CB 57               		bit	2,a		; Key-cut (010b) bit?
(1) 3314/    1187 : C2 0F 12            		jp	nz,.fm_keycut
(1) 3315/    118A : CB 4F               		bit	1,a		; Key-off (100b) bit?
(1) 3316/    118C : C2 24 12            		jp	nz,.fm_keyoff
(1) 3317/    118F : 47                  		ld	b,a		; b - other update bits
(1) 3318/    1190 : 79                  		ld	a,c		; check for Channel 6
(1) 3319/    1191 : FE 06               		cp	6
(1) 3320/    1193 : CC 2E 13            		call	z,dac_off	; auto-mute WAVE playback
(1) 3321/    1196 : CF                  		rst	8
(1) 3322/    1197 : CB 60               		bit	4,b		; Instrument-update bit?  (%0001xxxx)
(1) 3323/    1199 : C4 44 12            		call	nz,.fm_insupd
(1) 3324/    119C : CB 68               		bit	5,b		; Volume-update bit? (%0010xxxx)
(1) 3325/    119E : C4 A9 12            		call	nz,.fm_volupd	;
(1) 3326/    11A1 : CB 70               		bit	6,b		; Panning update bit? (%0100xxxx)
(1) 3327/    11A3 : C4 2B 12            		call	nz,.fm_panupd
(1) 3328/    11A6 : CB 40               		bit	0,b		; Key-on (001b) bit?
(1) 3329/    11A8 : C8                  		ret	z
(1) 3330/    11A9 :                     	; freq update
(1) 3331/    11A9 :                     	; all this code is for OP4 (if FM3 is in special)
(1) 3332/    11A9 : CF                  		rst	8
(1) 3333/    11AA : 79                  		ld	a,c
(1) 3334/    11AB : E6 03               		and	11b
(1) 3335/    11AD : F6 A4               		or	0A4h
(1) 3336/    11AF : 57                  		ld	d,a
(1) 3337/    11B0 : FD 5E 18            		ld	e,(iy+FMFRQH)
(1) 3338/    11B3 : CB 51               		bit	2,c
(1) 3339/    11B5 : C4 0E 13            		call	nz,fm_send_2
(1) 3340/    11B8 : CC 03 13            		call	z,fm_send_1
(1) 3341/    11BB : CF                  		rst	8
(1) 3342/    11BC : 15                  		dec	d
(1) 3343/    11BD : 15                  		dec	d
(1) 3344/    11BE : 15                  		dec	d
(1) 3345/    11BF : 15                  		dec	d
(1) 3346/    11C0 : FD 5E 1E            		ld	e,(iy+FMFRQL)
(1) 3347/    11C3 : CB 51               		bit	2,c
(1) 3348/    11C5 : C4 0E 13            		call	nz,fm_send_2
(1) 3349/    11C8 : CC 03 13            		call	z,fm_send_1
(1) 3350/    11CB : CF                  		rst	8
(1) 3351/    11CC :                     
(1) 3352/    11CC : 79                  		ld	a,c
(1) 3353/    11CD : E6 03               		and	11b
(1) 3354/    11CF : F6 B0               		or	0B0h
(1) 3355/    11D1 : 57                  		ld	d,a
(1) 3356/    11D2 : DD 5E 1C            		ld	e,(ix+1Ch)
(1) 3357/    11D5 : CB 51               		bit	2,c
(1) 3358/    11D7 : C4 0E 13            		call	nz,fm_send_2
(1) 3359/    11DA : CC 03 13            		call	z,fm_send_1
(1) 3360/    11DD : 14                  		inc	d
(1) 3361/    11DE : 14                  		inc	d
(1) 3362/    11DF : CF                  		rst	8
(1) 3363/    11E0 : 14                  		inc	d
(1) 3364/    11E1 : 14                  		inc	d
(1) 3365/    11E2 :                     ; 		call	.fm_panset
(1) 3366/    11E2 :                     
(1) 3367/    11E2 :                     	; For Special FM3 mode it just copy-pastes regs
(1) 3368/    11E2 :                     	; from a separate list
(1) 3369/    11E2 : 79                  		ld	a,c		; FM3 special check
(1) 3370/    11E3 : FE 02               		cp	2
(1) 3371/    11E5 : 20 19               		jr	nz,.notfm3
(1) 3372/    11E7 : 3A 5F 1E            		ld	a,(fmSpcMode)
(1) 3373/    11EA : E6 40               		and	01000000b
(1) 3374/    11EC : B7                  		or	a
(1) 3375/    11ED : 28 11               		jr	z,.notfm3
(1) 3376/    11EF : CF                  		rst	8
(1) 3377/    11F0 : 21 C0 17            		ld	hl,fm3reg
(1) 3378/    11F3 : 06 06               		ld	b,3*2
(1) 3379/    11F5 :                     .copyops:
(1) 3380/    11F5 : 5E                  		ld	e,(hl)
(1) 3381/    11F6 : 23                  		inc	hl
(1) 3382/    11F7 : 56                  		ld	d,(hl)
(1) 3383/    11F8 : 23                  		inc	hl
(1) 3384/    11F9 : 00                  		nop
(1) 3385/    11FA : CF                  		rst	8
(1) 3386/    11FB : CD 03 13            		call	fm_send_1
(1) 3387/    11FE : 10 F5               		djnz	.copyops
(1) 3388/    1200 :                     .notfm3:
(1) 3389/    1200 :                     
(1) 3390/    1200 : CF                  		rst	8
(1) 3391/    1201 : 16 28               		ld	d,28h		; Keys
(1) 3392/    1203 : DD 7E 1F            		ld	a,(ix+01Fh)	; a - Read this ins keys
(1) 3393/    1206 : FD 46 06            		ld	b,(iy+FMKEYS)	; b - ALLOWED bits from fmcom
(1) 3394/    1209 : A0                  		and	b
(1) 3395/    120A : B1                  		or	c
(1) 3396/    120B : 5F                  		ld	e,a
(1) 3400/    120C : C3 03 13            		jp	fm_send_1
(1) 3401/    120F :                     
(1) 3402/    120F :                     .fm_keycut:
(1) 3403/    120F : 79                  		ld	a,c
(1) 3404/    1210 : E6 03               		and	11b
(1) 3405/    1212 : F6 B4               		or	0B4h
(1) 3406/    1214 : 57                  		ld	d,a
(1) 3407/    1215 : CF                  		rst	8
(1) 3408/    1216 : DD 7E 1D            		ld	a,(ix+1Dh)
(1) 3409/    1219 : E6 07               		and	00000111b
(1) 3410/    121B : 5F                  		ld	e,a
(1) 3411/    121C : CB 51               		bit	2,c
(1) 3412/    121E : CC 03 13            		call	z,fm_send_1
(1) 3413/    1221 : C4 0E 13            		call	nz,fm_send_2
(1) 3414/    1224 :                     .fm_keyoff:
(1) 3415/    1224 : CF                  		rst	8
(1) 3416/    1225 : 59                  		ld	e,c
(1) 3417/    1226 : 16 28               		ld	d,28h
(1) 3418/    1228 : C3 03 13            		jp	fm_send_1
(1) 3419/    122B :                     ; d - 0B4h+
(1) 3420/    122B :                     .fm_panupd:
(1) 3421/    122B : 79                  		ld	a,c
(1) 3422/    122C : E6 03               		and	11b
(1) 3423/    122E : F6 B4               		or	0B4h
(1) 3424/    1230 : 57                  		ld	d,a
(1) 3425/    1231 :                     .fm_panset:
(1) 3426/    1231 : DD 5E 1D            		ld	e,(ix+1Dh)
(1) 3427/    1234 : FD 7E 12            		ld	a,(iy+FMPAN)
(1) 3428/    1237 : E6 C0               		and	11000000b
(1) 3429/    1239 : B3                  		or	e
(1) 3430/    123A : 5F                  		ld	e,a
(1) 3431/    123B : CB 51               		bit	2,c
(1) 3432/    123D : C4 0E 13            		call	nz,fm_send_2
(1) 3433/    1240 : CC 03 13            		call	z,fm_send_1
(1) 3434/    1243 : C9                  		ret
(1) 3435/    1244 :                     
(1) 3436/    1244 :                     ; CPU-intense
(1) 3437/    1244 :                     ; only call this if needed
(1) 3438/    1244 :                     .fm_insupd:
(1) 3439/    1244 : C5                  		push	bc
(1) 3440/    1245 : CD 24 12            		call	.fm_keyoff		; restart chip channel
(1) 3441/    1248 : E7                  		rst	20h			; <--- TODO: si se pone lento, quitarlo
(1) 3442/    1249 : DD E5               		push	ix			; copy ix to hl
(1) 3443/    124B : E1                  		pop	hl
(1) 3444/    124C : 79                  		ld	a,c
(1) 3445/    124D : E6 03               		and	011b
(1) 3446/    124F : F6 30               		or	30h
(1) 3447/    1251 : CF                  		rst	8
(1) 3448/    1252 : 57                  		ld	d,a
(1) 3449/    1253 : 06 1C               		ld	b,4*7
(1) 3450/    1255 :                     .copy_1:
(1) 3451/    1255 : CF                  		rst	8
(1) 3452/    1256 : 5E                  		ld	e,(hl)
(1) 3453/    1257 : CB 51               		bit	2,c
(1) 3454/    1259 : CC 03 13            		call	z,fm_send_1
(1) 3455/    125C : C4 0E 13            		call	nz,fm_send_2
(1) 3456/    125F : 23                  		inc	hl
(1) 3457/    1260 : 14                  		inc	d
(1) 3458/    1261 : CF                  		rst	8
(1) 3459/    1262 : 00                  		nop
(1) 3460/    1263 : 14                  		inc	d
(1) 3461/    1264 : 14                  		inc	d
(1) 3462/    1265 : 14                  		inc	d
(1) 3463/    1266 : 10 ED               		djnz	.copy_1
(1) 3464/    1268 : 11 04 00            		ld	de,4		; skip AMS, FMS,
(1) 3465/    126B : 19                  		add	hl,de		; old FM3 check (oops) and keys
(1) 3466/    126C : 79                  		ld	a,c		; check for Channel 3
(1) 3467/    126D : FE 02               		cp	2
(1) 3468/    126F : 20 36               		jr	nz,.fm_ins_ex
(1) 3469/    1271 : CF                  		rst	8
(1) 3470/    1272 : 3A 5F 1E            		ld	a,(fmSpcMode)	; Is it in special mode?
(1) 3471/    1275 : CB 77               		bit	6,a
(1) 3472/    1277 : 28 2E               		jr	z,.fm_ins_ex
(1) 3473/    1279 : DD E5               		push	ix
(1) 3474/    127B : DD 21 C0 17         		ld	ix,fm3reg
(1) 3475/    127F : 06 03               		ld	b,3
(1) 3476/    1281 :                     .copyops3:
(1) 3477/    1281 : 56                  		ld	d,(hl)		; Read OP1-3 freqs
(1) 3478/    1282 : 23                  		inc	hl
(1) 3479/    1283 : CF                  		rst	8
(1) 3480/    1284 : 5E                  		ld	e,(hl)
(1) 3481/    1285 : 23                  		inc	hl
(1) 3482/    1286 : DD 72 00            		ld	(ix),d
(1) 3483/    1289 : DD 73 02            		ld	(ix+2),e
(1) 3484/    128C : DD 23               		inc	ix
(1) 3485/    128E : CF                  		rst	8
(1) 3486/    128F : DD 23               		inc	ix
(1) 3487/    1291 : DD 23               		inc	ix
(1) 3488/    1293 : DD 23               		inc	ix
(1) 3489/    1295 : 10 EA               		djnz	.copyops3
(1) 3490/    1297 : DD 21 7A 16         		ld	ix,fmcom+2	; Read OP4 freq
(1) 3491/    129B : 56                  		ld	d,(hl)
(1) 3492/    129C : 23                  		inc	hl
(1) 3493/    129D : CF                  		rst	8
(1) 3494/    129E : 5E                  		ld	e,(hl)
(1) 3495/    129F : DD 72 18            		ld	(ix+FMFRQH),d
(1) 3496/    12A2 : DD 73 1E            		ld	(ix+FMFRQL),e
(1) 3497/    12A5 : DD E1               		pop	ix
(1) 3498/    12A7 :                     .fm_ins_ex:
(1) 3499/    12A7 : C1                  		pop	bc
(1) 3500/    12A8 : C9                  		ret
(1) 3501/    12A9 :                     
(1) 3502/    12A9 :                     ; b - Volume decrement
(1) 3503/    12A9 :                     ; c - Channel id
(1) 3504/    12A9 :                     ; d - 40h+ base reg
(1) 3505/    12A9 :                     ; h - Algorithm
(1) 3506/    12A9 :                     .fm_volupd:
(1) 3507/    12A9 : C5                  		push	bc
(1) 3508/    12AA : FD 46 0C            		ld	b,(iy+FMVOL)
(1) 3509/    12AD :                     .fm_chnlvol:
(1) 3510/    12AD : DD E5               		push	ix
(1) 3511/    12AF : DD 7E 1C            		ld	a,(ix+1Ch)
(1) 3512/    12B2 : E6 07               		and	111b
(1) 3513/    12B4 : 67                  		ld	h,a
(1) 3514/    12B5 : 11 04 00            		ld	de,4
(1) 3515/    12B8 : DD 19               		add	ix,de
(1) 3516/    12BA : 79                  		ld	a,c
(1) 3517/    12BB : E6 03               		and	11b
(1) 3518/    12BD : CF                  		rst	8
(1) 3519/    12BE : F6 40               		or	40h
(1) 3520/    12C0 : 57                  		ld	d,a
(1) 3521/    12C1 : 7C                  		ld	a,h		; Check 40h
(1) 3522/    12C2 : FE 07               		cp	7		; Algorithm == 07h?
(1) 3523/    12C4 : CC EF 12            		call	z,.do_vol
(1) 3524/    12C7 : 7A                  		ld	a,d
(1) 3525/    12C8 : C6 04               		add	a,4
(1) 3526/    12CA : CF                  		rst	8
(1) 3527/    12CB : 57                  		ld	d,a
(1) 3528/    12CC : DD 23               		inc	ix
(1) 3529/    12CE : 7C                  		ld	a,h		; Check 44h
(1) 3530/    12CF : FE 05               		cp	5		; Algorithm > 05h?
(1) 3531/    12D1 : D4 EF 12            		call	nc,.do_vol
(1) 3532/    12D4 : 7A                  		ld	a,d
(1) 3533/    12D5 : C6 04               		add	a,4
(1) 3534/    12D7 : 57                  		ld	d,a
(1) 3535/    12D8 : DD 23               		inc	ix
(1) 3536/    12DA : CF                  		rst	8
(1) 3537/    12DB : 7C                  		ld	a,h		; Check 48h
(1) 3538/    12DC : FE 04               		cp	4		; Algorithm > 04h?
(1) 3539/    12DE : D4 EF 12            		call	nc,.do_vol
(1) 3540/    12E1 : 7A                  		ld	a,d
(1) 3541/    12E2 : C6 04               		add	a,4
(1) 3542/    12E4 : 57                  		ld	d,a
(1) 3543/    12E5 : DD 23               		inc	ix
(1) 3544/    12E7 : CD EF 12            		call	.do_vol		; Do 4Ch
(1) 3545/    12EA : DD E1               		pop	ix
(1) 3546/    12EC : C1                  		pop	bc
(1) 3547/    12ED : CF                  		rst	8
(1) 3548/    12EE : C9                  		ret
(1) 3549/    12EF :                     .do_vol:
(1) 3550/    12EF : DD 7E 00            		ld	a,(ix)
(1) 3551/    12F2 : 80                  		add	a,b
(1) 3552/    12F3 : FE 7F               		cp	7Fh
(1) 3553/    12F5 : 38 02               		jr	c,.vmuch
(1) 3554/    12F7 : 3E 7F               		ld	a,7Fh
(1) 3555/    12F9 :                     .vmuch:
(1) 3556/    12F9 : 5F                  		ld	e,a
(1) 3557/    12FA : CB 51               		bit	2,c
(1) 3558/    12FC : CC 03 13            		call	z,fm_send_1
(1) 3559/    12FF : C4 0E 13            		call	nz,fm_send_2
(1) 3560/    1302 : C9                  		ret
(1) 3561/    1303 :                     
(1) 3562/    1303 :                     ; ---------------------------------------------
(1) 3563/    1303 :                     ; FM send registers
(1) 3564/    1303 :                     ;
(1) 3565/    1303 :                     ; Input:
(1) 3566/    1303 :                     ; d - ctrl
(1) 3567/    1303 :                     ; e - data
(1) 3568/    1303 :                     ; ---------------------------------------------
(1) 3569/    1303 :                     
(1) 3570/    1303 :                     ; Channels 1-3 and global registers
(1) 3571/    1303 :                     fm_send_1:
(1) 3572/    1303 : 7A                  		ld	a,d
(1) 3573/    1304 : 32 00 40            		ld	(Zym_ctrl_1),a
(1) 3574/    1307 : 00                  		nop
(1) 3575/    1308 : 7B                  		ld	a,e
(1) 3576/    1309 : 32 01 40            		ld	(Zym_data_1),a
(1) 3577/    130C : 00                  		nop
(1) 3578/    130D : C9                  		ret
(1) 3579/    130E :                     ; Channels 4-6
(1) 3580/    130E :                     fm_send_2:
(1) 3581/    130E : 7A                  		ld	a,d
(1) 3582/    130F : 32 02 40            		ld	(Zym_ctrl_2),a
(1) 3583/    1312 : 00                  		nop
(1) 3584/    1313 : 7B                  		ld	a,e
(1) 3585/    1314 : 32 03 40            		ld	(Zym_data_2),a
(1) 3586/    1317 : 00                  		nop
(1) 3587/    1318 : C9                  		ret
(1) 3588/    1319 :                     
(1) 3589/    1319 :                     ; --------------------------------------------------------
(1) 3590/    1319 :                     ; brute-force WAVE ON/OFF playback
(1) 3591/    1319 :                     ; --------------------------------------------------------
(1) 3592/    1319 :                     
(1) 3593/    1319 :                     dac_on:
(1) 3594/    1319 : 3E 2B               		ld	a,2Bh
(1) 3595/    131B : 32 00 40            		ld	(Zym_ctrl_1),a
(1) 3596/    131E : 3E 80               		ld	a,80h
(1) 3597/    1320 : 32 01 40            		ld	(Zym_data_1),a
(1) 3598/    1323 : 3E D9               		ld 	a,zopcExx
(1) 3599/    1325 : 32 08 00            		ld	(dac_me),a
(1) 3600/    1328 : 3E F5               		ld 	a,zopcPushAf
(1) 3601/    132A : 32 20 00            		ld	(dac_fill),a
(1) 3602/    132D : C9                  		ret
(1) 3603/    132E :                     dac_off:
(1) 3604/    132E : 3E 2B               		ld	a,2Bh
(1) 3605/    1330 : 32 00 40            		ld	(Zym_ctrl_1),a
(1) 3606/    1333 : 3E 00               		ld	a,00h
(1) 3607/    1335 : 32 01 40            		ld	(Zym_data_1),a
(1) 3608/    1338 : 3E C9               		ld 	a,zopcRet
(1) 3609/    133A : 32 08 00            		ld	(dac_me),a
(1) 3610/    133D : 3E C9               		ld 	a,zopcRet
(1) 3611/    133F : 32 20 00            		ld	(dac_fill),a
(1) 3612/    1342 : C9                  		ret
(1) 3613/    1343 :                     
(1) 3614/    1343 :                     ; --------------------------------------------------------
(1) 3615/    1343 :                     ; dac_play
(1) 3616/    1343 :                     ;
(1) 3617/    1343 :                     ; Plays a new sample
(1) 3618/    1343 :                     ; --------------------------------------------------------
(1) 3619/    1343 :                     
(1) 3620/    1343 :                     dac_play:
(1) 3621/    1343 : F3                  		di
(1) 3622/    1344 : CD 2E 13            		call	dac_off
(1) 3623/    1347 : D9                  		exx				; get exx regs
(1) 3624/    1348 : 01 1B 00            		ld	bc,dWaveBuff>>8		; bc - WAVFIFO MSB
(1) 3625/    134B : ED 5B 54 1E         		ld	de,(wave_Pitch)		; de - Pitch
(1) 3626/    134F : 21 00 00            		ld	hl,(dWaveBuff&0FFh)<<8	; hl - WAVFIFO LSB pointer (xx.00)
(1) 3627/    1352 : D9                  		exx				; move them back
(1) 3628/    1353 : 2A 4B 1E            		ld	hl,(wave_Start)
(1) 3629/    1356 : 3A 4D 1E            		ld 	a,(wave_Start+2)
(1) 3630/    1359 : 22 57 1E            		ld	(dDacPntr),hl
(1) 3631/    135C : 32 59 1E            		ld	(dDacPntr+2),a
(1) 3632/    135F : 2A 4E 1E            		ld	hl,(wave_Len)
(1) 3633/    1362 : 3A 50 1E            		ld 	a,(wave_Len+2)
(1) 3634/    1365 : 22 5A 1E            		ld	(dDacCntr),hl
(1) 3635/    1368 : 32 5C 1E            		ld	(dDacCntr+2),a
(1) 3636/    136B : AF                  		xor	a
(1) 3637/    136C : 32 5D 1E            		ld	(dDacFifoMid),a
(1) 3638/    136F : CD 77 13            		call	dac_firstfill
(1) 3639/    1372 : CD 19 13            		call	dac_on
(1) 3640/    1375 : FB                  		ei
(1) 3641/    1376 : C9                  		ret
(1) 3642/    1377 :                     
(1) 3643/    1377 :                     ; --------------------------------------------------------
(1) 3644/    1377 :                     
(1) 3645/    1377 :                     ; First wave fill
(1) 3646/    1377 :                     dac_firstfill:
(1) 3647/    1377 : CD B0 0E            		call	get_tick
(1) 3648/    137A : F5                  		push	af
(1) 3649/    137B :                     
(1) 3650/    137B :                     ; Wave refill request
(1) 3651/    137B :                     ; Got this from GEMS, but I changed it to play
(1) 3652/    137B :                     ; larger samples (7FFFFFh maximum)
(1) 3653/    137B :                     dac_refill:
(1) 3654/    137B : CF                  		rst	8
(1) 3655/    137C : C5                  		push	bc
(1) 3656/    137D : D5                  		push	de
(1) 3657/    137E : E5                  		push	hl
(1) 3658/    137F : 3A 56 1E            		ld	a,(wave_Flags)
(1) 3659/    1382 : FE 07               		cp	111b
(1) 3660/    1384 : D2 3B 14            		jp	nc,.FDF7
(1) 3661/    1387 : 3A 5C 1E            		ld	a,(dDacCntr+2)	; Last bytes
(1) 3662/    138A : 2A 5A 1E            		ld	hl,(dDacCntr)
(1) 3663/    138D : 01 80 00            		ld	bc,80h
(1) 3664/    1390 : 37                  		scf
(1) 3665/    1391 : 3F                  		ccf
(1) 3666/    1392 : ED 42               		sbc	hl,bc
(1) 3667/    1394 : DE 00               		sbc	a,0
(1) 3668/    1396 : 32 5C 1E            		ld	(dDacCntr+2),a
(1) 3669/    1399 : 22 5A 1E            		ld	(dDacCntr),hl
(1) 3670/    139C : 16 1B               		ld	d,dWaveBuff>>8
(1) 3671/    139E : B7                  		or	a
(1) 3672/    139F : FA C9 13            		jp	m,.dac_over
(1) 3673/    13A2 :                     .keepcntr:
(1) 3674/    13A2 : 3A 5D 1E            		ld	a,(dDacFifoMid)
(1) 3675/    13A5 : 5F                  		ld	e,a
(1) 3676/    13A6 : C6 80               		add 	a,80h
(1) 3677/    13A8 : 32 5D 1E            		ld	(dDacFifoMid),a
(1) 3678/    13AB : 2A 57 1E            		ld	hl,(dDacPntr)
(1) 3679/    13AE : 3A 59 1E            		ld	a,(dDacPntr+2)
(1) 3680/    13B1 : CD 1F 0F            		call	transferRom
(1) 3681/    13B4 : 2A 57 1E            		ld	hl,(dDacPntr)
(1) 3682/    13B7 : 3A 59 1E            		ld	a,(dDacPntr+2)
(1) 3683/    13BA : 01 80 00            		ld	bc,80h
(1) 3684/    13BD : 09                  		add	hl,bc
(1) 3685/    13BE : CE 00               		adc	a,0
(1) 3686/    13C0 : 22 57 1E            		ld	(dDacPntr),hl
(1) 3687/    13C3 : 32 59 1E            		ld	(dDacPntr+2),a
(1) 3688/    13C6 : C3 3E 14            		jp	.FDFreturn
(1) 3689/    13C9 :                     
(1) 3690/    13C9 :                     ; if wav's len-timer finished:
(1) 3691/    13C9 :                     .dac_over:
(1) 3692/    13C9 : 16 1B               		ld	d,dWaveBuff>>8
(1) 3693/    13CB : 3A 56 1E            		ld	a,(wave_Flags)
(1) 3694/    13CE : E6 01               		and	01b
(1) 3695/    13D0 : B7                  		or	a
(1) 3696/    13D1 : C2 F4 13            		jp	nz,.FDF72
(1) 3697/    13D4 : 7D                  		ld	a,l
(1) 3698/    13D5 : C6 80               		add	a,80h
(1) 3699/    13D7 : 4F                  		ld	c,a
(1) 3700/    13D8 : 06 00               		ld	b,0
(1) 3701/    13DA : C5                  		push	bc
(1) 3702/    13DB : 3A 5D 1E            		ld	a,(dDacFifoMid)
(1) 3703/    13DE : 5F                  		ld	e,a
(1) 3704/    13DF : C6 80               		add	a,80h
(1) 3705/    13E1 : 32 5D 1E            		ld	(dDacFifoMid),a
(1) 3706/    13E4 : C1                  		pop	bc			; C <- # just xfered
(1) 3707/    13E5 : 79                  		ld	a,c
(1) 3708/    13E6 : B0                  		or	b
(1) 3709/    13E7 : 28 52               		jr	z,.FDF7
(1) 3710/    13E9 : 2A 57 1E            		ld	hl,(dDacPntr)
(1) 3711/    13EC : 3A 59 1E            		ld	a,(dDacPntr+2)
(1) 3712/    13EF : CD 1F 0F            		call	transferRom
(1) 3713/    13F2 : 18 47               		jr	.FDF7
(1) 3714/    13F4 :                     .FDF72:
(1) 3715/    13F4 :                     
(1) 3716/    13F4 :                     	; loop sample
(1) 3717/    13F4 : C5                  		push	bc
(1) 3718/    13F5 : D5                  		push	de
(1) 3719/    13F6 : 3A 53 1E            		ld	a,(wave_Loop+2)
(1) 3720/    13F9 : 4F                  		ld	c,a
(1) 3721/    13FA : ED 5B 51 1E         		ld	de,(wave_Loop)
(1) 3722/    13FE : 2A 4B 1E            		ld	hl,(wave_Start)
(1) 3723/    1401 : 3A 4D 1E            		ld 	a,(wave_Start+2)
(1) 3724/    1404 : 81                  		add	a,c
(1) 3725/    1405 : 19                  		add	hl,de
(1) 3726/    1406 : CE 00               		adc	a,0
(1) 3727/    1408 : 22 57 1E            		ld	(dDacPntr),hl
(1) 3728/    140B : 32 59 1E            		ld	(dDacPntr+2),a
(1) 3729/    140E : 2A 4E 1E            		ld	hl,(wave_Len)
(1) 3730/    1411 : 3A 50 1E            		ld 	a,(wave_Len+2)
(1) 3731/    1414 : 91                  		sub	a,c
(1) 3732/    1415 : 37                  		scf
(1) 3733/    1416 : 3F                  		ccf
(1) 3734/    1417 : ED 52               		sbc	hl,de
(1) 3735/    1419 : DE 00               		sbc	a,0
(1) 3736/    141B : 22 5A 1E            		ld	(dDacCntr),hl
(1) 3737/    141E : 32 5C 1E            		ld	(dDacCntr+2),a
(1) 3738/    1421 : D1                  		pop	de
(1) 3739/    1422 : C1                  		pop	bc
(1) 3740/    1423 : 78                  		ld	a,b
(1) 3741/    1424 : B1                  		or	c
(1) 3742/    1425 : 28 17               		jr	z,.FDFreturn
(1) 3743/    1427 : 3A 5D 1E            		ld	a,(dDacFifoMid)
(1) 3744/    142A : 5F                  		ld	e,a
(1) 3745/    142B : C6 80               		add	a,80h
(1) 3746/    142D : 32 5D 1E            		ld	(dDacFifoMid),a
(1) 3747/    1430 : 2A 57 1E            		ld	hl,(dDacPntr)
(1) 3748/    1433 : 3A 59 1E            		ld	a,(dDacPntr+2)
(1) 3749/    1436 : CD 1F 0F            		call	transferRom
(1) 3750/    1439 : 18 03               		jr	.FDFreturn
(1) 3751/    143B :                     .FDF7:
(1) 3752/    143B : CD 2E 13            		call	dac_off		; DAC finished
(1) 3753/    143E :                     .FDFreturn:
(1) 3754/    143E : E1                  		pop	hl
(1) 3755/    143F : D1                  		pop	de
(1) 3756/    1440 : C1                  		pop	bc
(1) 3757/    1441 : F1                  		pop	af
(1) 3758/    1442 : C9                  		ret
(1) 3759/    1443 :                     
(1) 3760/    1443 :                     ; ====================================================================
(1) 3761/    1443 :                     ; ----------------------------------------------------------------
(1) 3762/    1443 :                     ; Tables
(1) 3763/    1443 :                     ; ----------------------------------------------------------------
(1) 3764/    1443 :                     
(1) 3765/    1443 : 84 02               fmFreq_List:	dw 644
(1) 3766/    1445 : A9 02               		dw 681
(1) 3767/    1447 : D2 02               		dw 722
(1) 3768/    1449 : FD 02               		dw 765
(1) 3769/    144B : 2A 03               		dw 810
(1) 3770/    144D : 5A 03               		dw 858
(1) 3771/    144F : 8E 03               		dw 910
(1) 3772/    1451 : C4 03               		dw 964
(1) 3773/    1453 : FD 03               		dw 1021
(1) 3774/    1455 : 39 04               		dw 1081
(1) 3775/    1457 : 7A 04               		dw 1146
(1) 3776/    1459 : BE 04               		dw 1214
(1) 3777/    145B :                     psgFreq_List:
(1) 3778/    145B : FF FF               		dw -1		; C-0 $0
(1) 3779/    145D : FF FF               		dw -1
(1) 3780/    145F : FF FF               		dw -1
(1) 3781/    1461 : FF FF               		dw -1
(1) 3782/    1463 : FF FF               		dw -1
(1) 3783/    1465 : FF FF               		dw -1
(1) 3784/    1467 : FF FF               		dw -1
(1) 3785/    1469 : FF FF               		dw -1
(1) 3786/    146B : FF FF               		dw -1
(1) 3787/    146D : FF FF               		dw -1
(1) 3788/    146F : FF FF               		dw -1
(1) 3789/    1471 : FF FF               		dw -1
(1) 3790/    1473 : FF FF               		dw -1		; C-1 $C
(1) 3791/    1475 : FF FF               		dw -1
(1) 3792/    1477 : FF FF               		dw -1
(1) 3793/    1479 : FF FF               		dw -1
(1) 3794/    147B : FF FF               		dw -1
(1) 3795/    147D : FF FF               		dw -1
(1) 3796/    147F : FF FF               		dw -1
(1) 3797/    1481 : FF FF               		dw -1
(1) 3798/    1483 : FF FF               		dw -1
(1) 3799/    1485 : FF FF               		dw -1
(1) 3800/    1487 : FF FF               		dw -1
(1) 3801/    1489 : FF FF               		dw -1
(1) 3802/    148B : FF FF               		dw -1		; C-2 $18
(1) 3803/    148D : FF FF               		dw -1
(1) 3804/    148F : FF FF               		dw -1
(1) 3805/    1491 : FF FF               		dw -1
(1) 3806/    1493 : FF FF               		dw -1
(1) 3807/    1495 : FF FF               		dw -1
(1) 3808/    1497 : FF FF               		dw -1
(1) 3809/    1499 : FF FF               		dw -1
(1) 3810/    149B : FF FF               		dw -1
(1) 3811/    149D : FF FF               		dw -1
(1) 3812/    149F : FF FF               		dw -1
(1) 3813/    14A1 : FF FF               		dw -1
(1) 3814/    14A3 : FF FF               		dw -1		; C-3 $24
(1) 3815/    14A5 : FF FF               		dw -1
(1) 3816/    14A7 : FF FF               		dw -1
(1) 3817/    14A9 : FF FF               		dw -1
(1) 3818/    14AB : FF FF               		dw -1
(1) 3819/    14AD : FF FF               		dw -1
(1) 3820/    14AF : FF FF               		dw -1
(1) 3821/    14B1 : FF FF               		dw -1
(1) 3822/    14B3 : FF FF               		dw -1
(1) 3823/    14B5 : F8 03               		dw 3F8h
(1) 3824/    14B7 : BF 03               		dw 3BFh
(1) 3825/    14B9 : 89 03               		dw 389h
(1) 3826/    14BB : 56 03               		dw 356h		;C-4 30
(1) 3827/    14BD : 26 03               		dw 326h
(1) 3828/    14BF : F9 02               		dw 2F9h
(1) 3829/    14C1 : CE 02               		dw 2CEh
(1) 3830/    14C3 : A5 02               		dw 2A5h
(1) 3831/    14C5 : 80 02               		dw 280h
(1) 3832/    14C7 : 5C 02               		dw 25Ch
(1) 3833/    14C9 : 3A 02               		dw 23Ah
(1) 3834/    14CB : 1A 02               		dw 21Ah
(1) 3835/    14CD : FB 01               		dw 1FBh
(1) 3836/    14CF : DF 01               		dw 1DFh
(1) 3837/    14D1 : C4 01               		dw 1C4h
(1) 3838/    14D3 : AB 01               		dw 1ABh		;C-5 3C
(1) 3839/    14D5 : 93 01               		dw 193h
(1) 3840/    14D7 : 7D 01               		dw 17Dh
(1) 3841/    14D9 : 67 01               		dw 167h
(1) 3842/    14DB : 53 01               		dw 153h
(1) 3843/    14DD : 40 01               		dw 140h
(1) 3844/    14DF : 2E 01               		dw 12Eh
(1) 3845/    14E1 : 1D 01               		dw 11Dh
(1) 3846/    14E3 : 0D 01               		dw 10Dh
(1) 3847/    14E5 : FE 00               		dw 0FEh
(1) 3848/    14E7 : EF 00               		dw 0EFh
(1) 3849/    14E9 : E2 00               		dw 0E2h
(1) 3850/    14EB : D6 00               		dw 0D6h		;C-6 48
(1) 3851/    14ED : C9 00               		dw 0C9h
(1) 3852/    14EF : BE 00               		dw 0BEh
(1) 3853/    14F1 : B4 00               		dw 0B4h
(1) 3854/    14F3 : A9 00               		dw 0A9h
(1) 3855/    14F5 : A0 00               		dw 0A0h
(1) 3856/    14F7 : 97 00               		dw 97h
(1) 3857/    14F9 : 8F 00               		dw 8Fh
(1) 3858/    14FB : 87 00               		dw 87h
(1) 3859/    14FD : 7F 00               		dw 7Fh
(1) 3860/    14FF : 78 00               		dw 78h
(1) 3861/    1501 : 71 00               		dw 71h
(1) 3862/    1503 : 6B 00               		dw 6Bh		; C-7 54
(1) 3863/    1505 : 65 00               		dw 65h
(1) 3864/    1507 : 5F 00               		dw 5Fh
(1) 3865/    1509 : 5A 00               		dw 5Ah
(1) 3866/    150B : 55 00               		dw 55h
(1) 3867/    150D : 50 00               		dw 50h
(1) 3868/    150F : 4B 00               		dw 4Bh
(1) 3869/    1511 : 47 00               		dw 47h
(1) 3870/    1513 : 43 00               		dw 43h
(1) 3871/    1515 : 40 00               		dw 40h
(1) 3872/    1517 : 3C 00               		dw 3Ch
(1) 3873/    1519 : 39 00               		dw 39h
(1) 3874/    151B : 36 00               		dw 36h		; C-8 $60
(1) 3875/    151D : 33 00               		dw 33h
(1) 3876/    151F : 30 00               		dw 30h
(1) 3877/    1521 : 2D 00               		dw 2Dh
(1) 3878/    1523 : 2B 00               		dw 2Bh
(1) 3879/    1525 : 28 00               		dw 28h
(1) 3880/    1527 : 26 00               		dw 26h
(1) 3881/    1529 : 24 00               		dw 24h
(1) 3882/    152B : 22 00               		dw 22h
(1) 3883/    152D : 20 00               		dw 20h
(1) 3884/    152F : 1F 00               		dw 1Fh
(1) 3885/    1531 : 1D 00               		dw 1Dh
(1) 3886/    1533 : 1B 00               		dw 1Bh		; C-9 $6C
(1) 3887/    1535 : 1A 00               		dw 1Ah
(1) 3888/    1537 : 18 00               		dw 18h
(1) 3889/    1539 : 17 00               		dw 17h
(1) 3890/    153B : 16 00               		dw 16h
(1) 3891/    153D : 15 00               		dw 15h
(1) 3892/    153F : 13 00               		dw 13h
(1) 3893/    1541 : 12 00               		dw 12h
(1) 3894/    1543 : 11 00               		dw 11h
(1) 3895/    1545 : 10 00                		dw 10h
(1) 3896/    1547 : 09 00                		dw 9h
(1) 3897/    1549 : 08 00                		dw 8h
(1) 3898/    154B : 00 00               		dw 0
(1) 3899/    154D :                     
(1) 3900/    154D :                     ; TODO: some of these freqs need checking
(1) 3901/    154D : 00 01               wavFreq_List:	dw 100h		; C-0
(1) 3902/    154F : 00 01               		dw 100h
(1) 3903/    1551 : 00 01               		dw 100h
(1) 3904/    1553 : 00 01               		dw 100h
(1) 3905/    1555 : 00 01               		dw 100h
(1) 3906/    1557 : 00 01               		dw 100h
(1) 3907/    1559 : 00 01               		dw 100h
(1) 3908/    155B : 00 01               		dw 100h
(1) 3909/    155D : 00 01               		dw 100h
(1) 3910/    155F : 00 01               		dw 100h
(1) 3911/    1561 : 00 01               		dw 100h
(1) 3912/    1563 : 00 01               		dw 100h
(1) 3913/    1565 : 00 01               		dw 100h		; C-1
(1) 3914/    1567 : 00 01               		dw 100h
(1) 3915/    1569 : 00 01               		dw 100h
(1) 3916/    156B : 00 01               		dw 100h
(1) 3917/    156D : 00 01               		dw 100h
(1) 3918/    156F : 00 01               		dw 100h
(1) 3919/    1571 : 00 01               		dw 100h
(1) 3920/    1573 : 00 01               		dw 100h
(1) 3921/    1575 : 00 01               		dw 100h
(1) 3922/    1577 : 00 01               		dw 100h
(1) 3923/    1579 : 00 01               		dw 100h
(1) 3924/    157B : 00 01               		dw 100h
(1) 3925/    157D : 00 01               		dw 100h		; C-2
(1) 3926/    157F : 00 01               		dw 100h
(1) 3927/    1581 : 00 01               		dw 100h
(1) 3928/    1583 : 00 01               		dw 100h
(1) 3929/    1585 : 00 01               		dw 100h
(1) 3930/    1587 : 00 01               		dw 100h
(1) 3931/    1589 : 00 01               		dw 100h
(1) 3932/    158B : 00 01               		dw 100h
(1) 3933/    158D : 00 01               		dw 100h
(1) 3934/    158F : 00 01               		dw 100h
(1) 3935/    1591 : 36 00               		dw 036h
(1) 3936/    1593 : 3B 00               		dw 03Bh
(1) 3937/    1595 : 3E 00               		dw 03Eh		; C-3 5512
(1) 3938/    1597 : 43 00               		dw 043h		; C#3
(1) 3939/    1599 : 46 00               		dw 046h		; D-3
(1) 3940/    159B : 49 00               		dw 049h		; D#3
(1) 3941/    159D : 4E 00               		dw 04Eh		; E-3
(1) 3942/    159F : 54 00               		dw 054h		; F-3
(1) 3943/    15A1 : 58 00               		dw 058h		; F#3
(1) 3944/    15A3 : 5E 00               		dw 05Eh		; G-3 8363 -17
(1) 3945/    15A5 : 63 00               		dw 063h		; G#3
(1) 3946/    15A7 : 68 00               		dw 068h		; A-3
(1) 3947/    15A9 : 70 00               		dw 070h		; A#3
(1) 3948/    15AB : 75 00               		dw 075h		; B-3
(1) 3949/    15AD : 85 00               		dw 085h		; C-4 11025 -12
(1) 3950/    15AF : 87 00               		dw 087h		; C#4
(1) 3951/    15B1 : 8C 00               		dw 08Ch		; D-4
(1) 3952/    15B3 : 9A 00               		dw 09Ah		; D#4
(1) 3953/    15B5 : 9E 00               		dw 09Eh		; E-4
(1) 3954/    15B7 : AD 00               		dw 0ADh		; F-4
(1) 3955/    15B9 : B2 00               		dw 0B2h		; F#4
(1) 3956/    15BB : C0 00               		dw 0C0h		; G-4
(1) 3957/    15BD : CC 00               		dw 0CCh		; G#4
(1) 3958/    15BF : D7 00               		dw 0D7h		; A-4
(1) 3959/    15C1 : E6 00               		dw 0E6h		; A#4
(1) 3960/    15C3 : F0 00               		dw 0F0h		; B-4
(1) 3961/    15C5 : 00 01               		dw 100h		; C-5 22050
(1) 3962/    15C7 : 10 01               		dw 110h		; C#5
(1) 3963/    15C9 : 20 01               		dw 120h		; D-5
(1) 3964/    15CB : 2E 01               		dw 12Eh		; D#5
(1) 3965/    15CD : 42 01               		dw 142h		; E-5
(1) 3966/    15CF : 5A 01               		dw 15Ah		; F-5
(1) 3967/    15D1 : 6A 01               		dw 16Ah		; F#5 32000 +6
(1) 3968/    15D3 : 7F 01               		dw 17Fh		; G-5
(1) 3969/    15D5 : 91 01               		dw 191h		; G#5
(1) 3970/    15D7 : AC 01               		dw 1ACh		; A-5
(1) 3971/    15D9 : C2 01               		dw 1C2h		; A#5
(1) 3972/    15DB : E0 01               		dw 1E0h		; B-5
(1) 3973/    15DD : F8 01               		dw 1F8h		; C-6 44100 +12
(1) 3974/    15DF : 10 02               		dw 210h		; C#6
(1) 3975/    15E1 : 40 02               		dw 240h		; D-6
(1) 3976/    15E3 : 60 02               		dw 260h		; D#6
(1) 3977/    15E5 : 80 02               		dw 280h		; E-6
(1) 3978/    15E7 : A0 02               		dw 2A0h		; F-6
(1) 3979/    15E9 : D0 02               		dw 2D0h		; F#6
(1) 3980/    15EB : F8 02               		dw 2F8h		; G-6
(1) 3981/    15ED : 20 03               		dw 320h		; G#6
(1) 3982/    15EF : 50 03               		dw 350h		; A-6
(1) 3983/    15F1 : 80 03               		dw 380h		; A#6
(1) 3984/    15F3 : C0 03               		dw 3C0h		; B-6
(1) 3985/    15F5 : 00 04               		dw 400h		; C-7 88200
(1) 3986/    15F7 : 00 01               		dw 100h
(1) 3987/    15F9 : 00 01               		dw 100h
(1) 3988/    15FB : 00 01               		dw 100h
(1) 3989/    15FD : 00 01               		dw 100h
(1) 3990/    15FF : 00 01               		dw 100h
(1) 3991/    1601 : 00 01               		dw 100h
(1) 3992/    1603 : 00 01               		dw 100h
(1) 3993/    1605 : 00 01               		dw 100h
(1) 3994/    1607 : 00 01               		dw 100h
(1) 3995/    1609 : 00 01               		dw 100h
(1) 3996/    160B : 00 01               		dw 100h
(1) 3997/    160D : 00 01               		dw 100h		; C-8
(1) 3998/    160F : 00 01               		dw 100h
(1) 3999/    1611 : 00 01               		dw 100h
(1) 4000/    1613 : 00 01               		dw 100h
(1) 4001/    1615 : 00 01               		dw 100h
(1) 4002/    1617 : 00 01               		dw 100h
(1) 4003/    1619 : 00 01               		dw 100h
(1) 4004/    161B : 00 01               		dw 100h
(1) 4005/    161D : 00 01               		dw 100h
(1) 4006/    161F : 00 01               		dw 100h
(1) 4007/    1621 : 00 01               		dw 100h
(1) 4008/    1623 : 00 01               		dw 100h
(1) 4009/    1625 : 00 01               		dw 100h		; C-9
(1) 4010/    1627 : 00 01               		dw 100h
(1) 4011/    1629 : 00 01               		dw 100h
(1) 4012/    162B : 00 01               		dw 100h
(1) 4013/    162D : 00 01               		dw 100h
(1) 4014/    162F : 00 01               		dw 100h
(1) 4015/    1631 : 00 01               		dw 100h
(1) 4016/    1633 : 00 01               		dw 100h
(1) 4017/    1635 : 00 01               		dw 100h
(1) 4018/    1637 : 00 01               		dw 100h
(1) 4019/    1639 : 00 01               		dw 100h
(1) 4020/    163B : 00 01               		dw 100h
(1) 4021/    163D :                     
(1) 4022/    163D :                     ; ====================================================================
(1) 4023/    163D :                     ; ----------------------------------------------------------------
(1) 4024/    163D :                     ; Z80 RAM
(1) 4025/    163D :                     ; ----------------------------------------------------------------
(1) 4026/    163D :                     
(1) 4027/    163D :                     		align 10h
(1) 4028/    1640 : 00 00 00 00 00 00   pwmcom:		db 00h,00h,00h,00h,00h,00h,00h,00h	; 0 - Playback bits: KeyOn/KeyOff/KeyCut/other update bits
                    00 00 
(1) 4029/    1648 : 00 00 00 00 00 00   		db 00h,00h,00h,00h,00h,00h,00h,00h	; 8 - Volume | Pitch MSB
                    00 00 
(1) 4030/    1650 : 00 00 00 00 00 00   		db 00h,00h,00h,00h,00h,00h,00h,00h	; 16 - Pitch LSB
                    00 00 
(1) 4031/    1658 : 00 00 00 00 00 00   		db 00h,00h,00h,00h,00h,00h,00h,00h	; 24 - Playback flags: Loop/Stereo/Left/Right | 32-bit
                    00 00 
(1) 4032/    1660 : 00 00 00 00 00 00   		db 00h,00h,00h,00h,00h,00h,00h,00h	; 32 - sample location
                    00 00 
(1) 4033/    1668 : 00 00 00 00 00 00   		db 00h,00h,00h,00h,00h,00h,00h,00h
                    00 00 
(1) 4034/    1670 : 00 00 00 00 00 00   		db 00h,00h,00h,00h,00h,00h,00h,00h
                    00 00 
(1) 4035/    1678 : 00 00 00 00 00 00   fmcom:		db 00h,00h,00h,00h,00h,00h	;  0 - play bits: 2-cut 1-off 0-play
(1) 4036/    167E : 00 00 00 00 00 00   		db 00h,00h,00h,00h,00h,00h	;  6 - keys xxxx0000b
(1) 4037/    1684 : 00 00 00 00 00 00   		db 00h,00h,00h,00h,00h,00h	; 12 - volume (for 40h+)
(1) 4038/    168A : 00 00 00 00 00 00   		db 00h,00h,00h,00h,00h,00h	; 18 - panning (%LR000000)
(1) 4039/    1690 : 00 00 00 00 00 00   		db 00h,00h,00h,00h,00h,00h	; 24 - A4h+ (MSB FIRST)
(1) 4040/    1696 : 00 00 00 00 00 00   		db 00h,00h,00h,00h,00h,00h	; 30 - A0h+
(1) 4041/    169C : 00 00 00 00         psgcom		db 00h,00h,00h,00h		;  0 command 1 = key on, 2 = key off, 4 = stop snd
(1) 4042/    16A0 : FF FF FF FF         psglev		db -1, -1, -1, -1		;  4 output level attenuation (%llll.0000, -1 = silent)
(1) 4043/    16A4 : 00 00 00 00         psgatk		db 00h,00h,00h,00h		;  8 attack rate
(1) 4044/    16A8 : 00 00 00 00         psgdec		db 00h,00h,00h,00h		; 12 decay rate
(1) 4045/    16AC : 00 00 00 00         psgslv		db 00h,00h,00h,00h		; 16 sustain level attenuation
(1) 4046/    16B0 : 00 00 00 00         psgrrt		db 00h,00h,00h,00h		; 20 release rate
(1) 4047/    16B4 : 00 00 00 00         psgenv		db 00h,00h,00h,00h		; 24 envelope mode 0 = off, 1 = attack, 2 = decay, 3 = sustain, 4
(1) 4048/    16B8 : 00 00 00 00         psgdtl		db 00h,00h,00h,00h		; 28 tone bottom 4 bits
(1) 4049/    16BC : 00 00 00 00         psgdth		db 00h,00h,00h,00h		; 32 tone upper 6 bits
(1) 4050/    16C0 : 00 00 00 00         psgalv		db 00h,00h,00h,00h		; 36 attack level attenuation
(1) 4051/    16C4 : 00 00 00 00         whdflg		db 00h,00h,00h,00h		; 40 flags to indicate hardware should be updated
(1) 4052/    16C8 : 00 00 00 00         psgtim		db 00h,00h,00h,00h		; 44 timer for sustain
(1) 4053/    16CC : 00 00 00 00         psgvol		db 00h,00h,00h,00h
(1) 4054/    16D0 :                     fmins_com:	ds 028h				; Current instrument data for each FM
(1) 4055/    16F8 :                     fmins_com2:	ds 028h
(1) 4056/    1720 :                     fmins_com3:	ds 028h
(1) 4057/    1748 :                     fmins_com4:	ds 028h
(1) 4058/    1770 :                     fmins_com5:	ds 028h
(1) 4059/    1798 :                     fmins_com6:	ds 028h
(1) 4060/    17C0 : 00 AC 00 A8         fm3reg:		dw 0AC00h,0A800h		; S3-S1, S4 is at A6/A2
(1) 4061/    17C4 : 00 AD 00 A9         		dw 0AD00h,0A900h
(1) 4062/    17C8 : 00 AE 00 AA         		dw 0AE00h,0AA00h
(1) 4063/    17CC : 00                  daccom:		db 0				; single byte for key on, off and cut
(1) 4064/    17CD :                     
(1) 4065/    17CD :                     	; Channel tables: 10h bytes
(1) 4066/    17CD :                     	; 0  - Link addr (0000h = free, used chnls start from +0020h)
(1) 4067/    17CD :                     	; 2  - Channel index (ID is set extrenally)
(1) 4068/    17CD :                     	; 3  - Pitch
(1) 4069/    17CD :                     	; 4+ - Channel specific...
(1) 4070/    17CD :                     
(1) 4071/    17CD :                     	; PSG (80h+)
(1) 4072/    17CD :                     	;  4 - psgNoise mode
(1) 4073/    17CD : 00 00 00 00 00 00   tblPSG:		db 00h,00h,00h,00h,00h,00h,00h,00h	; Channel 1
                    00 00 
(1) 4074/    17D5 : 00 00 01 00 00 00   		db 00h,00h,01h,00h,00h,00h,00h,00h	; Channel 2
                    00 00 
(1) 4075/    17DD : 00 00 02 00 00 00   		db 00h,00h,02h,00h,00h,00h,00h,00h	; Channel 3
                    00 00 
(1) 4076/    17E5 : FF FF               		dw -1	; end-of-list
(1) 4077/    17E7 : 00 00 03 00 00 00   tblPSGN:	db 00h,00h,03h,00h,00h,00h,00h,00h	; Noise (DIRECT CHECK only)
                    00 00 
(1) 4078/    17EF :                     
(1) 4079/    17EF :                     	; FM: 90h+ FM3: 0A0h DAC: 0B0h
(1) 4080/    17EF :                     	;  4 - Special mode (FM3: Special, FM6: DAC)
(1) 4081/    17EF :                     	;  5 - 24-bit copy of ROM instrument pointer
(1) 4082/    17EF : 00 00 00 00 00 00   tblFM:		db 00h,00h,00h,00h,00h,00h,00h,00h	; Channel 1
                    00 00 
(1) 4083/    17F7 : 00 00 01 00 00 00   		db 00h,00h,01h,00h,00h,00h,00h,00h	; Channel 2
                    00 00 
(1) 4084/    17FF : 00 00 03 00 00 00   		db 00h,00h,03h,00h,00h,00h,00h,00h	; Channel 4
                    00 00 
(1) 4085/    1807 : 00 00 04 00 00 00   		db 00h,00h,04h,00h,00h,00h,00h,00h	; Channel 5
                    00 00 
(1) 4086/    180F : 00 00 02 00 00 00   tblFM3:		db 00h,00h,02h,00h,00h,00h,00h,00h	; Channel 3
                    00 00 
(1) 4087/    1817 : 00 00 05 00 00 00   tblFM6:		db 00h,00h,05h,00h,00h,00h,00h,00h	; Channel 6
                    00 00 
(1) 4088/    181F : FF FF               		dw -1	; end-of-list
(1) 4089/    1821 :                     
(1) 4090/    1821 : 00 00 00 00 00 00   tblPWM:		db 00h,00h,00h,00h,00h,00h,00h,00h	; Channel 1
                    00 00 
(1) 4091/    1829 : 00 00 01 00 00 00   		db 00h,00h,01h,00h,00h,00h,00h,00h	; Channel 2
                    00 00 
(1) 4092/    1831 : 00 00 02 00 00 00   		db 00h,00h,02h,00h,00h,00h,00h,00h	; Channel 3
                    00 00 
(1) 4093/    1839 : 00 00 03 00 00 00   		db 00h,00h,03h,00h,00h,00h,00h,00h	; Channel 4
                    00 00 
(1) 4094/    1841 : 00 00 04 00 00 00   		db 00h,00h,04h,00h,00h,00h,00h,00h	; Channel 5
                    00 00 
(1) 4095/    1849 : 00 00 05 00 00 00   		db 00h,00h,05h,00h,00h,00h,00h,00h	; Channel 6
                    00 00 
(1) 4096/    1851 : 00 00 06 00 00 00   		db 00h,00h,06h,00h,00h,00h,00h,00h	; Channel 7
                    00 00 
(1) 4097/    1859 : FF FF               		dw -1
(1) 4098/    185B :                     
(1) 4099/    185B :                     insDataC_0	ds 8*MAX_INS	; Instrument data for each Track slot
(1) 4100/    18DB :                     insDataC_1	ds 8*MAX_INS	; 8*MAX_INS
(1) 4101/    195B :                     
(1) 4102/    195B :                     		align 10h
(1) 4103/    1960 :                     ; NOTE: MSB is used as the priority.
(1) 4104/    1960 :                     trkBuff_0	ds 20h+(MAX_TRKCHN*8)	;  *** TRACK BUFFER 0****
(1) 4105/    1A08 :                     trkBuff_1	ds 20h+(MAX_TRKCHN*8)	;  *** TRACK BUFFER 1****
(1) 4106/    1AB0 :                     
(1) 4107/    1AB0 : (MACRO)             		org 1B00h
(1) 4107/    1AB0 : 00                                                  db 0
(1) 4107/    1AB1 : 00                                                  db 0
(1) 4107/    1AB2 : 00                                                  db 0
(1) 4107/    1AB3 : 00                                                  db 0
(1) 4107/    1AB4 : 00                                                  db 0
(1) 4107/    1AB5 : 00                                                  db 0
(1) 4107/    1AB6 : 00                                                  db 0
(1) 4107/    1AB7 : 00                                                  db 0
(1) 4107/    1AB8 : 00                                                  db 0
(1) 4107/    1AB9 : 00                                                  db 0
(1) 4107/    1ABA : 00                                                  db 0
(1) 4107/    1ABB : 00                                                  db 0
(1) 4107/    1ABC : 00                                                  db 0
(1) 4107/    1ABD : 00                                                  db 0
(1) 4107/    1ABE : 00                                                  db 0
(1) 4107/    1ABF : 00                                                  db 0
(1) 4107/    1AC0 : 00                                                  db 0
(1) 4107/    1AC1 : 00                                                  db 0
(1) 4107/    1AC2 : 00                                                  db 0
(1) 4107/    1AC3 : 00                                                  db 0
(1) 4107/    1AC4 : 00                                                  db 0
(1) 4107/    1AC5 : 00                                                  db 0
(1) 4107/    1AC6 : 00                                                  db 0
(1) 4107/    1AC7 : 00                                                  db 0
(1) 4107/    1AC8 : 00                                                  db 0
(1) 4107/    1AC9 : 00                                                  db 0
(1) 4107/    1ACA : 00                                                  db 0
(1) 4107/    1ACB : 00                                                  db 0
(1) 4107/    1ACC : 00                                                  db 0
(1) 4107/    1ACD : 00                                                  db 0
(1) 4107/    1ACE : 00                                                  db 0
(1) 4107/    1ACF : 00                                                  db 0
(1) 4107/    1AD0 : 00                                                  db 0
(1) 4107/    1AD1 : 00                                                  db 0
(1) 4107/    1AD2 : 00                                                  db 0
(1) 4107/    1AD3 : 00                                                  db 0
(1) 4107/    1AD4 : 00                                                  db 0
(1) 4107/    1AD5 : 00                                                  db 0
(1) 4107/    1AD6 : 00                                                  db 0
(1) 4107/    1AD7 : 00                                                  db 0
(1) 4107/    1AD8 : 00                                                  db 0
(1) 4107/    1AD9 : 00                                                  db 0
(1) 4107/    1ADA : 00                                                  db 0
(1) 4107/    1ADB : 00                                                  db 0
(1) 4107/    1ADC : 00                                                  db 0
(1) 4107/    1ADD : 00                                                  db 0
(1) 4107/    1ADE : 00                                                  db 0
(1) 4107/    1ADF : 00                                                  db 0
(1) 4107/    1AE0 : 00                                                  db 0
(1) 4107/    1AE1 : 00                                                  db 0
(1) 4107/    1AE2 : 00                                                  db 0
(1) 4107/    1AE3 : 00                                                  db 0
(1) 4107/    1AE4 : 00                                                  db 0
(1) 4107/    1AE5 : 00                                                  db 0
(1) 4107/    1AE6 : 00                                                  db 0
(1) 4107/    1AE7 : 00                                                  db 0
(1) 4107/    1AE8 : 00                                                  db 0
(1) 4107/    1AE9 : 00                                                  db 0
(1) 4107/    1AEA : 00                                                  db 0
(1) 4107/    1AEB : 00                                                  db 0
(1) 4107/    1AEC : 00                                                  db 0
(1) 4107/    1AED : 00                                                  db 0
(1) 4107/    1AEE : 00                                                  db 0
(1) 4107/    1AEF : 00                                                  db 0
(1) 4107/    1AF0 : 00                                                  db 0
(1) 4107/    1AF1 : 00                                                  db 0
(1) 4107/    1AF2 : 00                                                  db 0
(1) 4107/    1AF3 : 00                                                  db 0
(1) 4107/    1AF4 : 00                                                  db 0
(1) 4107/    1AF5 : 00                                                  db 0
(1) 4107/    1AF6 : 00                                                  db 0
(1) 4107/    1AF7 : 00                                                  db 0
(1) 4107/    1AF8 : 00                                                  db 0
(1) 4107/    1AF9 : 00                                                  db 0
(1) 4107/    1AFA : 00                                                  db 0
(1) 4107/    1AFB : 00                                                  db 0
(1) 4107/    1AFC : 00                                                  db 0
(1) 4107/    1AFD : 00                                                  db 0
(1) 4107/    1AFE : 00                                                  db 0
(1) 4107/    1AFF : 00                                                  db 0
(1) 4107/    1B00 :                     
(1) 4108/    1B00 :                     dWaveBuff	ds 100h			; WAVE data buffer: 100h bytes, updates every 80h
(1) 4109/    1C00 :                     trkData_0	ds 100h			; Track note-cache buffers: 100h bytes, updates every 80h
(1) 4110/    1D00 :                     trkData_1	ds 100h
(1) 4111/    1E00 :                     
(1) 4112/    1E00 :                     ; very last variables...
(1) 4113/    1E00 :                     commZfifo	ds 40h			; Buffer for command requests from 68k (40h bytes, loops)
(1) 4114/    1E40 : 00 00               currInsData	dw 0
(1) 4115/    1E42 : 00 00               currTblPos	dw 0
(1) 4116/    1E44 : 00 00               currInsPos	dw 0
(1) 4117/    1E46 : 00 00               currTrkCtrl	dw 0
(1) 4118/    1E48 : 00 00               tickFlag	dw 0		; Tick flag from VBlank, Read as (tickFlag+1) for reading/reseting
(1) 4119/    1E4A : 00                  tickCnt		db 0		; Tick counter (PUT THIS TAG AFTER tickFlag)
(1) 4120/    1E4B : 00 00               wave_Start	dw 0		; START: 68k 24-bit pointer
(1) 4121/    1E4D : 00                  		db 0
(1) 4122/    1E4E : 00 00               wave_Len	dw 0		; LENGTH 24-bit
(1) 4123/    1E50 : 00                  		db 0
(1) 4124/    1E51 : 00 00               wave_Loop	dw 0		; LOOP POINT 24-bit (MUST BE BELOW wave_Len)
(1) 4125/    1E53 : 00                  		db 0
(1) 4126/    1E54 : 00 01               wave_Pitch	dw 0100h	; 01.00h
(1) 4127/    1E56 : 00                  wave_Flags	db 0		; WAVE playback flags (%10x: 1 loop / 0 no loop)
(1) 4128/    1E57 : 00 00 00            dDacPntr	db 0,0,0		; WAVE play current ROM position
(1) 4129/    1E5A : 00 00 00            dDacCntr	db 0,0,0		; WAVE play length counter
(1) 4130/    1E5D : 00                  dDacFifoMid	db 0			; WAVE play halfway refill flag (00h/80h)
(1) 4131/    1E5E : 00                  psgHatMode	db 0
(1) 4132/    1E5F : 00                  fmSpcMode	db 0
(1) 4133/    1E60 :                     trkHdOut	ds 6			; temporal Header for reading Track position/row count
(1) 4134/    1E66 :                     
(1) 4135/    1E66 :                     ; Stack area
(1) 4136/    1E66 :                     
(1) 4137/    1E66 :                     	; EXIT Z80
(1) 4138/    1E66 :                     		cpu 68000
(1) 4139/    1E66 :                     		padding off
(1) 4140/  88A5C6 :                     		phase Z80_TOP+*
(1) 4141/  88A5C6 :                     
      83/  88A5C6 :                     Z80_CODE_END:
      84/  88A5C6 :                     		include "system/md/sub_dreq.asm"	; DREQ transfer only works on 880000
(1)    1/  88A5C6 :                     ; --------------------------------------------------------
(1)    2/  88A5C6 :                     ; System_RomSendDreq
(1)    3/  88A5C6 :                     ;
(1)    4/  88A5C6 :                     ; Send data to the 32X using DREQ and
(1)    5/  88A5C6 :                     ; the CMD interrupt
(1)    6/  88A5C6 :                     ;
(1)    7/  88A5C6 :                     ; Input:
(1)    8/  88A5C6 :                     ; a0 - LONG | Source data to transfer
(1)    9/  88A5C6 :                     ; d0 - WORD | Size (aligned by 8, MUST end with 0 or 8)
(1)   10/  88A5C6 :                     ;
(1)   11/  88A5C6 :                     ; CALL THIS OUTSIDE OF VBLANK ONLY.
(1)   12/  88A5C6 :                     ;
(1)   13/  88A5C6 :                     ; NOTE:
(1)   14/  88A5C6 :                     ; THIS CODE ONLY WORKS PROPERLY ON THE
(1)   15/  88A5C6 :                     ; $880000/$900000 AREAS. (FOR real hardware)
(1)   16/  88A5C6 :                     ; --------------------------------------------------------
(1)   17/  88A5C6 :                     
(1)   18/  88A5C6 :                     System_RomSendDreq:
(1)   19/  88A5C6 : 40C7                		move.w	sr,d7
(1)   20/  88A5C8 : 46FC 2700           		move.w	#$2700,sr
(1)   21/  88A5CC : 4BF9 00A1 5100      		lea	(sysmars_reg).l,a5
(1)   22/  88A5D2 : 49F9 00A1 5112      		lea	($A15112).l,a4
(1)   23/  88A5D8 :                     ; 		btst	#7,comm12(a5)
(1)   24/  88A5D8 :                     ; 		bne.s	.bad
(1)   25/  88A5D8 :                     ; 		btst	#7,dreqctl+1(a5)	; If FIFO got full, skip.
(1)   26/  88A5D8 :                     ; 		bne.s	.bad
(1)   27/  88A5D8 : 3B7C 0000 0006      		move.w	#%000,dreqctl(a5)	; Set 68S
(1)   28/  88A5DE : 3C00                		move.w	d0,d6			; Length in bytes
(1)   29/  88A5E0 : E24E                		lsr.w	#1,d6			; d6 - (length/2)
(1)   30/  88A5E2 : 3B46 0010           		move.w	d6,dreqlen(a5)		; Set transfer length (size/2)
(1)   31/  88A5E6 : 3A06                		move.w	d6,d5			; d5 - (length/2)/4
(1)   32/  88A5E8 : E44D                		lsr.w	#2,d5
(1)   33/  88A5EA : 9A7C 0001           		sub.w	#1,d5
(1)   34/  88A5EE : 08ED 0000 0003      		bset	#0,standby(a5)
(1)   35/  88A5F4 : 082D 0006 002C      .wait_bit:	btst	#6,comm12(a5)
(1)   36/  88A5FA : 67F8                		beq.s	.wait_bit
(1)   37/  88A5FC : 08AD 0006 002C      		bclr	#6,comm12(a5)
(1)   38/  88A602 : 3B7C 0004 0006      		move.w	#%100,dreqctl(a5)	; Set 68S
(1)   39/  88A608 : 3898                .l0:		move.w  (a0)+,(a4)		; *** CRITICAL PART***
(1)   40/  88A60A : 3898                		move.w  (a0)+,(a4)
(1)   41/  88A60C : 3898                		move.w  (a0)+,(a4)
(1)   42/  88A60E : 3898                		move.w  (a0)+,(a4)
(1)   43/  88A610 : 51CD FFF6           		dbf	d5,.l0
(1)   44/  88A614 : 3B7C 0000 0006      		move.w	#%000,dreqctl(a5)	; Set 68S
(1)   45/  88A61A : 46C7                		move.w	d7,sr
(1)   46/  88A61C : 4E75                		rts
(1)   47/  88A61E :                     .bad:
(1)   48/  88A61E :                     ; 		move.w	#%000,dreqctl(a5)
(1)   49/  88A61E : 46C7                		move.w	d7,sr
(1)   50/  88A620 : 4E75                		rts
(1)   51/  88A622 :                     
(1)   52/  88A622 :                     ; OLD, STABLE
(1)   53/  88A622 :                     ; System_SendDreq:
(1)   54/  88A622 :                     ; 		move.w	sr,d7
(1)   55/  88A622 :                     ; 		move.w	#$2700,sr
(1)   56/  88A622 :                     ; .l1:		btst	#2,(sysmars_reg+dreqctl+1).l	; Wait until 68S finishes.
(1)   57/  88A622 :                     ; 		bne.s	.l1
(1)   58/  88A622 :                     ; 		lea	($A15112).l,a5			; a5 - DREQ FIFO port
(1)   59/  88A622 :                     ; 		move.w	d0,d6				; Length in bytes
(1)   60/  88A622 :                     ; 		lsr.w	#1,d6				; d6 - (length/2)
(1)   61/  88A622 :                     ; 		move.w	#0,(sysmars_reg+dreqctl).l	; Clear both 68S and RV
(1)   62/  88A622 :                     ; 		move.w	d6,(sysmars_reg+dreqlen).l	; Set transfer length (size/2)
(1)   63/  88A622 :                     ; 		bset	#2,(sysmars_reg+dreqctl+1).l	; Set 68S bit
(1)   64/  88A622 :                     ; 		bset	#0,(sysmars_reg+standby).l	; Request Master CMD
(1)   65/  88A622 :                     ; ; .wait_cmd:	btst	#0,(sysmars_reg+standby).l	; <-- not needed, we'll use this bit instead:
(1)   66/  88A622 :                     ; ; 		bne.s	.wait_cmd
(1)   67/  88A622 :                     ; .wait_bit:	btst	#6,(sysmars_reg+comm12).l	; Wait comm bit signal from SH2 to fill the first words.
(1)   68/  88A622 :                     ; 		beq.s	.wait_bit
(1)   69/  88A622 :                     ; 		bclr	#6,(sysmars_reg+comm12).l	; Clear it afterwards.
(1)   70/  88A622 :                     ; 		move.w	d6,d5				; (length/2)/4
(1)   71/  88A622 :                     ; 		lsr.w	#2,d5
(1)   72/  88A622 :                     ; 		sub.w	#1,d5				; minus 1 for the loop
(1)   73/  88A622 :                     ; .l0:		move.w  (a0)+,(a5)
(1)   74/  88A622 :                     ; 		move.w  (a0)+,(a5)
(1)   75/  88A622 :                     ; 		move.w  (a0)+,(a5)
(1)   76/  88A622 :                     ; 		move.w  (a0)+,(a5)			; FIFO-FULL check not needed.
(1)   77/  88A622 :                     ; 		dbf	d5,.l0
(1)   78/  88A622 :                     ; .bad_trnsfr:
(1)   79/  88A622 :                     ; 		move.w	d7,sr
(1)   80/  88A622 :                     ; 		rts
(1)   81/  88A622 :                     
      85/  88A622 :                     		include "sound/tracks.asm"		; GEMA: Track data
(1)    1/  88A622 :                     ; ================================================================
(1)    2/  88A622 :                     ; ------------------------------------------------------------
(1)    3/  88A622 :                     ; DATA SECTION
(1)    4/  88A622 :                     ;
(1)    5/  88A622 :                     ; SOUND
(1)    6/  88A622 :                     ; ------------------------------------------------------------
(1)    7/  88A622 :                     
(1)    8/  88A622 :                     ; PWM pitches:
(1)    9/  88A622 :                     ; -17 - 8000
(1)   10/  88A622 :                     
(1)   11/  88A622 :                     ; NORMAL FM TL LEVEL: $0E AVERAGE
(1)   12/  88A622 :                     
(1)   13/  88A622 :                     ; Instrument macros
(1)   14/  88A622 :                     ; do note that some 24-bit pointers add 90h to the MSB automaticly.
(1)   15/  88A622 :                     ;
(1)   16/  88A622 :                     ; TODO: this might fail to work.
(1)   17/  88A622 :                     gInsNull macro
(1)   18/  88A622 :                     	dc.b  -1,$00,$00,$00
(1)   19/  88A622 :                     	dc.b $00,$00,$00,$00
(1)   20/  88A622 :                     	endm
(1)   21/  88A622 :                     
(1)   22/  88A622 :                     ; alv: attack level (00=high)
(1)   23/  88A622 :                     ; atk: attack rate
(1)   24/  88A622 :                     ; slv: sustain (00=high)
(1)   25/  88A622 :                     ; dky: decay rate (up)
(1)   26/  88A622 :                     ; rrt: release rate (down)
(1)   27/  88A622 :                     gInsPsg	macro pitch,alv,atk,slv,dky,rrt
(1)   28/  88A622 :                     	dc.b $80,pitch,alv,atk
(1)   29/  88A622 :                     	dc.b slv,dky,rrt,$00
(1)   30/  88A622 :                     	endm
(1)   31/  88A622 :                     
(1)   32/  88A622 :                     ; same arguments as gInsPsg, but for the last one:
(1)   33/  88A622 :                     ; mode: noise mode %tmm (PSGN only) t-Bass(0)|Noise(1) mm-Clock(0)|Clock/2(1)|Clock/4(2)|Tone3(3)
(1)   34/  88A622 :                     gInsPsgN macro pitch,alv,atk,slv,dky,rrt,mode
(1)   35/  88A622 :                     	dc.b $90|mode,pitch,alv,atk
(1)   36/  88A622 :                     	dc.b slv,dky,rrt,0
(1)   37/  88A622 :                     	endm
(1)   38/  88A622 :                     
(1)   39/  88A622 :                     ; fmins - 24-bit ROM pointer to patch data
(1)   40/  88A622 :                     gInsFm macro pitch,fmins
(1)   41/  88A622 :                     	dc.b $A0,pitch,((fmins>>16)&$FF),((fmins>>8)&$FF)
(1)   42/  88A622 :                     	dc.b fmins&$FF,$00,$00,$00
(1)   43/  88A622 :                     	endm
(1)   44/  88A622 :                     
(1)   45/  88A622 :                     ; Same as gInsFm
(1)   46/  88A622 :                     ; But the last 4 words on the patch data are the custom frequencies
(1)   47/  88A622 :                     ; for each operator in this order: OP1 OP2 OP3 OP4
(1)   48/  88A622 :                     gInsFm3	macro pitch,fmins
(1)   49/  88A622 :                     	dc.b $B0,pitch,((fmins>>16)&$FF),((fmins>>8)&$FF)
(1)   50/  88A622 :                     	dc.b fmins&$FF,$00,$00,$00
(1)   51/  88A622 :                     	endm
(1)   52/  88A622 :                     
(1)   53/  88A622 :                     ; start: Pointer to sample data:
(1)   54/  88A622 :                     ;        dc.b end,end,end	; 24-bit LENGTH of the sample
(1)   55/  88A622 :                     ;        dc.b loop,loop,loop	; 24-bit Loop point
(1)   56/  88A622 :                     ;        dc.b (sound data)	; Then the actual sound data
(1)   57/  88A622 :                     ; flags: %0-don't loop
(1)   58/  88A622 :                     ; 	 %1-loop
(1)   59/  88A622 :                     gInsDac	macro pitch,start,flags
(1)   60/  88A622 :                     	dc.b $C0|flags,pitch,((start>>16)&$FF),((start>>8)&$FF)
(1)   61/  88A622 :                     	dc.b start&$FF,0,0,0
(1)   62/  88A622 :                     	endm
(1)   63/  88A622 :                     
(1)   64/  88A622 :                     ; start: Pointer to sample data:
(1)   65/  88A622 :                     ;        dc.b end,end,end	; 24-bit LENGTH of the sample
(1)   66/  88A622 :                     ;        dc.b loop,loop,loop	; 24-bit Loop point
(1)   67/  88A622 :                     ;        dc.b (data)		; Then the actual sound data
(1)   68/  88A622 :                     ; flags: %00SL
(1)   69/  88A622 :                     ;        L - Loop sample No/Yes
(1)   70/  88A622 :                     ;        S - Sample data is in stereo
(1)   71/  88A622 :                     gInsPwm	macro pitch,start,flags
(1)   72/  88A622 :                     	dc.b $D0|flags,pitch,((start>>24)&$FF),((start>>16)&$FF)
(1)   73/  88A622 :                     	dc.b ((start>>8)&$FF),start&$FF,0,0
(1)   74/  88A622 :                     	endm
(1)   75/  88A622 :                     
(1)   76/  88A622 :                     ; ------------------------------------------------------------
(1)   77/  88A622 :                     ; SFX tracks
(1)   78/  88A622 :                     ; ------------------------------------------------------------
(1)   79/  88A622 :                     
(1)   80/  88A622 :                     GemaTrkData_Sfx:
(1)   81/  88A622 : 0088 A632           	dc.l GemaSfxPat_Boom
(1)   82/  88A626 : 0088 A62E           	dc.l GemaSfxBlk_Boom
(1)   83/  88A62A : 0088 A67E           	dc.l GemaSfxIns_Boom
(1)   84/  88A62E :                     GemaSfxBlk_Boom:
(1)   85/  88A62E :                     	binclude "sound/tracks/sfxpack_blk.bin"
(1)   86/  88A631 :                     	align 2
(1)   87/  88A632 :                     GemaSfxPat_Boom:
(1)   88/  88A632 :                     	binclude "sound/tracks/sfxpack_patt.bin"
(1)   89/  88A67E :                     	align 2
(1)   90/  88A67E :                     GemaSfxIns_Boom:
(1)   91/  88A67E : (MACRO)             	gInsFm3 0,FmIns3_Explosion
(1)   91/  88A67E : B000 893F                   dc.b $B0,0,((FMINS3_EXPLOSION>>16)&$FF),((FMINS3_EXPLOSION>>8)&$FF)
(1)   91/  88A682 : 9400 0000                   dc.b FMINS3_EXPLOSION&$FF,$00,$00,$00
(1)   92/  88A686 : (MACRO)             	gInsPsgN 0,$00,$00,$00,$00,$02,%110
(1)   92/  88A686 : 9600 0000                   dc.b $90|%110,0,$00,$00
(1)   92/  88A68A : 0000 0200                   dc.b $00,$00,$02,0
(1)   93/  88A68E : (MACRO)             	gInsFm 0,FmIns_Ding_toy
(1)   93/  88A68E : A000 8943                   dc.b $A0,0,((FMINS_DING_TOY>>16)&$FF),((FMINS_DING_TOY>>8)&$FF)
(1)   93/  88A692 : 2C00 0000                   dc.b FMINS_DING_TOY&$FF,$00,$00,$00
(1)   94/  88A696 :                     
(1)   95/  88A696 :                     ; ------------------------------------------------------------
(1)   96/  88A696 :                     ; BGM tracks
(1)   97/  88A696 :                     ; ------------------------------------------------------------
(1)   98/  88A696 :                     
(1)   99/  88A696 :                     GemaTrkData_MOVEME:
(1)  100/  88A696 : 0088 A6BA           	dc.l .pat
(1)  101/  88A69A : 0088 A6A2           	dc.l .blk
(1)  102/  88A69E : 0088 B532           	dc.l .ins
(1)  103/  88A6A2 :                     .blk:
(1)  104/  88A6A2 :                     	binclude "sound/tracks/moveme_blk.bin"
(1)  105/  88A6B9 :                     	align 2
(1)  106/  88A6BA :                     .pat:
(1)  107/  88A6BA :                     	binclude "sound/tracks/moveme_patt.bin"
(1)  108/  88B531 :                     	align 2
(1)  109/  88B532 :                     .ins:
(1)  110/  88B532 : (MACRO)             	gInsPwm 0,SmpIns_MoveMe_Hit,%10
(1)  110/  88B532 : D200 0209                   dc.b $D0|%10,0,((SMPINS_MOVEME_HIT>>24)&$FF),((SMPINS_MOVEME_HIT>>16)&$FF)
(1)  110/  88B536 : ED3C 0000                   dc.b ((SMPINS_MOVEME_HIT>>8)&$FF),SMPINS_MOVEME_HIT&$FF,0,0
(1)  111/  88B53A : (MACRO)             	gInsFm 0,FmIns_Bass_Duck
(1)  111/  88B53A : A000 8941                   dc.b $A0,0,((FMINS_BASS_DUCK>>16)&$FF),((FMINS_BASS_DUCK>>8)&$FF)
(1)  111/  88B53E : EC00 0000                   dc.b FMINS_BASS_DUCK&$FF,$00,$00,$00
(1)  112/  88B542 : (MACRO)             	gInsPwm 0,SmpIns_MoveMe_Brass,%11
(1)  112/  88B542 : D300 020A                   dc.b $D0|%11,0,((SMPINS_MOVEME_BRASS>>24)&$FF),((SMPINS_MOVEME_BRASS>>16)&$FF)
(1)  112/  88B546 : 1BF8 0000                   dc.b ((SMPINS_MOVEME_BRASS>>8)&$FF),SMPINS_MOVEME_BRASS&$FF,0,0
(1)  113/  88B54A : (MACRO)             	gInsFm 0,FmIns_ClosedHat
(1)  113/  88B54A : A000 8940                   dc.b $A0,0,((FMINS_CLOSEDHAT>>16)&$FF),((FMINS_CLOSEDHAT>>8)&$FF)
(1)  113/  88B54E : 8C00 0000                   dc.b FMINS_CLOSEDHAT&$FF,$00,$00,$00
(1)  114/  88B552 : (MACRO)             	gInsPsgN 0,$00,$00,$00,$00,$04,%110
(1)  114/  88B552 : 9600 0000                   dc.b $90|%110,0,$00,$00
(1)  114/  88B556 : 0000 0400                   dc.b $00,$00,$04,0
(1)  115/  88B55A : (MACRO)             	gInsFm -12,FmIns_HBeat_tom
(1)  115/  88B55A : A0F4 8944                   dc.b $A0,-12,((FMINS_HBEAT_TOM>>16)&$FF),((FMINS_HBEAT_TOM>>8)&$FF)
(1)  115/  88B55E : 2C00 0000                   dc.b FMINS_HBEAT_TOM&$FF,$00,$00,$00
(1)  116/  88B562 : (MACRO)             	gInsPwm 0,SmpIns_Snare,%10
(1)  116/  88B562 : D200 020B                   dc.b $D0|%10,0,((SMPINS_SNARE>>24)&$FF),((SMPINS_SNARE>>16)&$FF)
(1)  116/  88B566 : 5F64 0000                   dc.b ((SMPINS_SNARE>>8)&$FF),SMPINS_SNARE&$FF,0,0
(1)  117/  88B56A : (MACRO)             	gInsPwm 0,SmpIns_Kick,%10;gInsFm -38,FmIns_DrumKick_gem
(1)  117/  88B56A : D200 020B                   dc.b $D0|%10,0,((SMPINS_KICK>>24)&$FF),((SMPINS_KICK>>16)&$FF)
(1)  117/  88B56E : 4564 0000                   dc.b ((SMPINS_KICK>>8)&$FF),SMPINS_KICK&$FF,0,0
(1)  118/  88B572 : (MACRO)             	gInsFm -12,FmIns_Trumpet_carnival;FmIns_Trumpet_2
(1)  118/  88B572 : A0F4 8942                   dc.b $A0,-12,((FMINS_TRUMPET_CARNIVAL>>16)&$FF),((FMINS_TRUMPET_CARNIVAL>>8)&$FF)
(1)  118/  88B576 : 8C00 0000                   dc.b FMINS_TRUMPET_CARNIVAL&$FF,$00,$00,$00
(1)  119/  88B57A : (MACRO)             	gInsPsg 0,$20,$20,$10,$01,$08;gInsFm -12,FmIns_Ding_Baseball;
(1)  119/  88B57A : 8000 2020                   dc.b $80,0,$20,$20
(1)  119/  88B57E : 1001 0800                   dc.b $10,$01,$08,$00
(1)  120/  88B582 : (MACRO)             	gInsFm3 0,FmIns3_OpenHat
(1)  120/  88B582 : B000 893F                   dc.b $B0,0,((FMINS3_OPENHAT>>16)&$FF),((FMINS3_OPENHAT>>8)&$FF)
(1)  120/  88B586 : 4400 0000                   dc.b FMINS3_OPENHAT&$FF,$00,$00,$00
(1)  121/  88B58A : (MACRO)             	gInsPwm -17,SmpIns_MyTime,%10
(1)  121/  88B58A : D2EF 020B                   dc.b $D0|%10,-17,((SMPINS_MYTIME>>24)&$FF),((SMPINS_MYTIME>>16)&$FF)
(1)  121/  88B58E : 79A0 0000                   dc.b ((SMPINS_MYTIME>>8)&$FF),SMPINS_MYTIME&$FF,0,0
(1)  122/  88B592 : (MACRO)             	gInsPsg +12,$20,$10,$10,$0C,$0C
(1)  122/  88B592 : 800C 2010                   dc.b $80,+12,$20,$10
(1)  122/  88B596 : 100C 0C00                   dc.b $10,$0C,$0C,$00
(1)  123/  88B59A : (MACRO)             	gInsPsg 0,$00,$00,$00,$00,$06
(1)  123/  88B59A : 8000 0000                   dc.b $80,0,$00,$00
(1)  123/  88B59E : 0000 0600                   dc.b $00,$00,$06,$00
(1)  124/  88B5A2 : (MACRO)             	gInsNull
(1)  124/  88B5A2 : FF00 0000                   dc.b  -1,$00,$00,$00
(1)  124/  88B5A6 : 0000 0000                   dc.b $00,$00,$00,$00
(1)  125/  88B5AA : (MACRO)             	gInsNull
(1)  125/  88B5AA : FF00 0000                   dc.b  -1,$00,$00,$00
(1)  125/  88B5AE : 0000 0000                   dc.b $00,$00,$00,$00
(1)  126/  88B5B2 : (MACRO)             	gInsNull
(1)  126/  88B5B2 : FF00 0000                   dc.b  -1,$00,$00,$00
(1)  126/  88B5B6 : 0000 0000                   dc.b $00,$00,$00,$00
(1)  127/  88B5BA : (MACRO)             	gInsNull
(1)  127/  88B5BA : FF00 0000                   dc.b  -1,$00,$00,$00
(1)  127/  88B5BE : 0000 0000                   dc.b $00,$00,$00,$00
(1)  128/  88B5C2 : (MACRO)             	gInsNull
(1)  128/  88B5C2 : FF00 0000                   dc.b  -1,$00,$00,$00
(1)  128/  88B5C6 : 0000 0000                   dc.b $00,$00,$00,$00
(1)  129/  88B5CA :                     
(1)  130/  88B5CA :                     GemaTrkData_Nadie_MARS:
(1)  131/  88B5CA : 0088 B5DE           	dc.l .pat
(1)  132/  88B5CE : 0088 B5D6           	dc.l .blk
(1)  133/  88B5D2 : 0088 C7F0           	dc.l .ins
(1)  134/  88B5D6 :                     .blk:
(1)  135/  88B5D6 :                     	binclude "sound/tracks/nadie_blk.bin"
(1)  136/  88B5DD :                     	align 2
(1)  137/  88B5DE :                     .pat:
(1)  138/  88B5DE :                     	binclude "sound/tracks/nadie_patt.bin"
(1)  139/  88C7F0 :                     	align 2
(1)  140/  88C7F0 :                     .ins:
(1)  141/  88C7F0 : (MACRO)             	gInsPwm 0,SmpIns_Nadie,%10
(1)  141/  88C7F0 : D200 0207                   dc.b $D0|%10,0,((SMPINS_NADIE>>24)&$FF),((SMPINS_NADIE>>16)&$FF)
(1)  141/  88C7F4 : 0F88 0000                   dc.b ((SMPINS_NADIE>>8)&$FF),SMPINS_NADIE&$FF,0,0
(1)  142/  88C7F8 : (MACRO)             	gInsFm -36,FmIns_Piano_Aqua
(1)  142/  88C7F8 : A0DC 8942                   dc.b $A0,-36,((FMINS_PIANO_AQUA>>16)&$FF),((FMINS_PIANO_AQUA>>8)&$FF)
(1)  142/  88C7FC : 0C00 0000                   dc.b FMINS_PIANO_AQUA&$FF,$00,$00,$00
(1)  143/  88C800 : (MACRO)             	gInsFm -12,FmIns_HBeat_tom
(1)  143/  88C800 : A0F4 8944                   dc.b $A0,-12,((FMINS_HBEAT_TOM>>16)&$FF),((FMINS_HBEAT_TOM>>8)&$FF)
(1)  143/  88C804 : 2C00 0000                   dc.b FMINS_HBEAT_TOM&$FF,$00,$00,$00
(1)  144/  88C808 : (MACRO)             	gInsPwm -12,SmpIns_PKick,%00
(1)  144/  88C808 : D0F4 0209                   dc.b $D0|%00,-12,((SMPINS_PKICK>>24)&$FF),((SMPINS_PKICK>>16)&$FF)
(1)  144/  88C80C : 7804 0000                   dc.b ((SMPINS_PKICK>>8)&$FF),SMPINS_PKICK&$FF,0,0
(1)  145/  88C810 : (MACRO)             	gInsPsg 0,$50,$70,$00,$06,$08
(1)  145/  88C810 : 8000 5070                   dc.b $80,0,$50,$70
(1)  145/  88C814 : 0006 0800                   dc.b $00,$06,$08,$00
(1)  146/  88C818 : (MACRO)             	gInsFm 0,FmIns_Trumpet_1
(1)  146/  88C818 : A000 8942                   dc.b $A0,0,((FMINS_TRUMPET_1>>16)&$FF),((FMINS_TRUMPET_1>>8)&$FF)
(1)  146/  88C81C : 2C00 0000                   dc.b FMINS_TRUMPET_1&$FF,$00,$00,$00
(1)  147/  88C820 : (MACRO)             	gInsPwm 0,SmpIns_Piano,%00
(1)  147/  88C820 : D000 0209                   dc.b $D0|%00,0,((SMPINS_PIANO>>24)&$FF),((SMPINS_PIANO>>16)&$FF)
(1)  147/  88C824 : 8B40 0000                   dc.b ((SMPINS_PIANO>>8)&$FF),SMPINS_PIANO&$FF,0,0
(1)  148/  88C828 : (MACRO)             	gInsPwm -12,SmpIns_PTom,%00
(1)  148/  88C828 : D0F4 0209                   dc.b $D0|%00,-12,((SMPINS_PTOM>>24)&$FF),((SMPINS_PTOM>>16)&$FF)
(1)  148/  88C82C : 7F80 0000                   dc.b ((SMPINS_PTOM>>8)&$FF),SMPINS_PTOM&$FF,0,0
(1)  149/  88C830 : (MACRO)             	gInsNull
(1)  149/  88C830 : FF00 0000                   dc.b  -1,$00,$00,$00
(1)  149/  88C834 : 0000 0000                   dc.b $00,$00,$00,$00
(1)  150/  88C838 :                     
(1)  151/  88C838 :                     GemaTrkData_BeMine:
(1)  152/  88C838 : 0088 C855           	dc.l GemaPat_BeMine
(1)  153/  88C83C : 0088 C844           	dc.l GemaBlk_BeMine
(1)  154/  88C840 : 0088 E118           	dc.l GemaIns_BeMine
(1)  155/  88C844 :                     GemaBlk_BeMine:
(1)  156/  88C844 :                     	binclude "sound/tracks/bemine_blk.bin"
(1)  157/  88C855 :                     GemaPat_BeMine:
(1)  158/  88C855 :                     	binclude "sound/tracks/bemine_patt.bin"
(1)  159/  88E118 :                     GemaIns_BeMine:
(1)  160/  88E118 : (MACRO)             	gInsPwm -17,SmpIns_Bell_Ice,0
(1)  160/  88E118 : D0EF 0204                   dc.b $D0|0,-17,((SMPINS_BELL_ICE>>24)&$FF),((SMPINS_BELL_ICE>>16)&$FF)
(1)  160/  88E11C : FC70 0000                   dc.b ((SMPINS_BELL_ICE>>8)&$FF),SMPINS_BELL_ICE&$FF,0,0
(1)  161/  88E120 : (MACRO)             	gInsPwm -17,SmpIns_Brass1_Hi,%01
(1)  161/  88E120 : D1EF 0205                   dc.b $D0|%01,-17,((SMPINS_BRASS1_HI>>24)&$FF),((SMPINS_BRASS1_HI>>16)&$FF)
(1)  161/  88E124 : 379C 0000                   dc.b ((SMPINS_BRASS1_HI>>8)&$FF),SMPINS_BRASS1_HI&$FF,0,0
(1)  162/  88E128 : (MACRO)             	gInsPwm -17,SmpIns_Brass1_Low,%01
(1)  162/  88E128 : D1EF 0205                   dc.b $D0|%01,-17,((SMPINS_BRASS1_LOW>>24)&$FF),((SMPINS_BRASS1_LOW>>16)&$FF)
(1)  162/  88E12C : B368 0000                   dc.b ((SMPINS_BRASS1_LOW>>8)&$FF),SMPINS_BRASS1_LOW&$FF,0,0
(1)  163/  88E130 : (MACRO)             	gInsFm  -24,FmIns_Bass_groove
(1)  163/  88E130 : A0E8 8941                   dc.b $A0,-24,((FMINS_BASS_GROOVE>>16)&$FF),((FMINS_BASS_GROOVE>>8)&$FF)
(1)  163/  88E134 : 6C00 0000                   dc.b FMINS_BASS_GROOVE&$FF,$00,$00,$00
(1)  164/  88E138 : (MACRO)             	gInsFm3   0,FmIns3_OpenHat
(1)  164/  88E138 : B000 893F                   dc.b $B0,0,((FMINS3_OPENHAT>>16)&$FF),((FMINS3_OPENHAT>>8)&$FF)
(1)  164/  88E13C : 4400 0000                   dc.b FMINS3_OPENHAT&$FF,$00,$00,$00
(1)  165/  88E140 : (MACRO)             	gInsPwm -17,SmpIns_Snare_jam,0
(1)  165/  88E140 : D0EF 0206                   dc.b $D0|0,-17,((SMPINS_SNARE_JAM>>24)&$FF),((SMPINS_SNARE_JAM>>16)&$FF)
(1)  165/  88E144 : 82EC 0000                   dc.b ((SMPINS_SNARE_JAM>>8)&$FF),SMPINS_SNARE_JAM&$FF,0,0
(1)  166/  88E148 : (MACRO)             	gInsPwm -17,SmpIns_Kick_jam,0
(1)  166/  88E148 : D0EF 0206                   dc.b $D0|0,-17,((SMPINS_KICK_JAM>>24)&$FF),((SMPINS_KICK_JAM>>16)&$FF)
(1)  166/  88E14C : 7820 0000                   dc.b ((SMPINS_KICK_JAM>>8)&$FF),SMPINS_KICK_JAM&$FF,0,0
(1)  167/  88E150 : (MACRO)             	gInsPwm -17,SmpIns_SnrTom_1,0
(1)  167/  88E150 : D0EF 0206                   dc.b $D0|0,-17,((SMPINS_SNRTOM_1>>24)&$FF),((SMPINS_SNRTOM_1>>16)&$FF)
(1)  167/  88E154 : 8C58 0000                   dc.b ((SMPINS_SNRTOM_1>>8)&$FF),SMPINS_SNRTOM_1&$FF,0,0
(1)  168/  88E158 : (MACRO)             	gInsPwm -17,SmpIns_Forest_1,0
(1)  168/  88E158 : D0EF 0206                   dc.b $D0|0,-17,((SMPINS_FOREST_1>>24)&$FF),((SMPINS_FOREST_1>>16)&$FF)
(1)  168/  88E15C : 2F34 0000                   dc.b ((SMPINS_FOREST_1>>8)&$FF),SMPINS_FOREST_1&$FF,0,0
(1)  169/  88E160 : (MACRO)             	gInsFm -36,FmIns_Ambient_dark
(1)  169/  88E160 : A0DC 8942                   dc.b $A0,-36,((FMINS_AMBIENT_DARK>>16)&$FF),((FMINS_AMBIENT_DARK>>8)&$FF)
(1)  169/  88E164 : CC00 0000                   dc.b FMINS_AMBIENT_DARK&$FF,$00,$00,$00
(1)  170/  88E168 : (MACRO)             	gInsPsg +12,$00,$00,$00,$08,$04
(1)  170/  88E168 : 800C 0000                   dc.b $80,+12,$00,$00
(1)  170/  88E16C : 0008 0400                   dc.b $00,$08,$04,$00
(1)  171/  88E170 : (MACRO)             	gInsNull
(1)  171/  88E170 : FF00 0000                   dc.b  -1,$00,$00,$00
(1)  171/  88E174 : 0000 0000                   dc.b $00,$00,$00,$00
(1)  172/  88E178 : (MACRO)             	gInsNull
(1)  172/  88E178 : FF00 0000                   dc.b  -1,$00,$00,$00
(1)  172/  88E17C : 0000 0000                   dc.b $00,$00,$00,$00
(1)  173/  88E180 : (MACRO)             	gInsNull
(1)  173/  88E180 : FF00 0000                   dc.b  -1,$00,$00,$00
(1)  173/  88E184 : 0000 0000                   dc.b $00,$00,$00,$00
(1)  174/  88E188 : (MACRO)             	gInsNull
(1)  174/  88E188 : FF00 0000                   dc.b  -1,$00,$00,$00
(1)  174/  88E18C : 0000 0000                   dc.b $00,$00,$00,$00
(1)  175/  88E190 : (MACRO)             	gInsNull
(1)  175/  88E190 : FF00 0000                   dc.b  -1,$00,$00,$00
(1)  175/  88E194 : 0000 0000                   dc.b $00,$00,$00,$00
(1)  176/  88E198 : (MACRO)             	gInsNull
(1)  176/  88E198 : FF00 0000                   dc.b  -1,$00,$00,$00
(1)  176/  88E19C : 0000 0000                   dc.b $00,$00,$00,$00
(1)  177/  88E1A0 : (MACRO)             	gInsNull
(1)  177/  88E1A0 : FF00 0000                   dc.b  -1,$00,$00,$00
(1)  177/  88E1A4 : 0000 0000                   dc.b $00,$00,$00,$00
(1)  178/  88E1A8 : (MACRO)             	gInsNull
(1)  178/  88E1A8 : FF00 0000                   dc.b  -1,$00,$00,$00
(1)  178/  88E1AC : 0000 0000                   dc.b $00,$00,$00,$00
(1)  179/  88E1B0 : (MACRO)             	gInsNull
(1)  179/  88E1B0 : FF00 0000                   dc.b  -1,$00,$00,$00
(1)  179/  88E1B4 : 0000 0000                   dc.b $00,$00,$00,$00
(1)  180/  88E1B8 : (MACRO)             	gInsNull
(1)  180/  88E1B8 : FF00 0000                   dc.b  -1,$00,$00,$00
(1)  180/  88E1BC : 0000 0000                   dc.b $00,$00,$00,$00
(1)  181/  88E1C0 : (MACRO)             	gInsNull
(1)  181/  88E1C0 : FF00 0000                   dc.b  -1,$00,$00,$00
(1)  181/  88E1C4 : 0000 0000                   dc.b $00,$00,$00,$00
(1)  182/  88E1C8 : (MACRO)             	gInsNull
(1)  182/  88E1C8 : FF00 0000                   dc.b  -1,$00,$00,$00
(1)  182/  88E1CC : 0000 0000                   dc.b $00,$00,$00,$00
(1)  183/  88E1D0 : (MACRO)             	gInsNull
(1)  183/  88E1D0 : FF00 0000                   dc.b  -1,$00,$00,$00
(1)  183/  88E1D4 : 0000 0000                   dc.b $00,$00,$00,$00
(1)  184/  88E1D8 : (MACRO)             	gInsNull
(1)  184/  88E1D8 : FF00 0000                   dc.b  -1,$00,$00,$00
(1)  184/  88E1DC : 0000 0000                   dc.b $00,$00,$00,$00
(1)  185/  88E1E0 :                     
(1)  186/  88E1E0 :                     GemaTrkData_Nadie_MD:
(1)  187/  88E1E0 : 0088 E1F4           	dc.l .patt
(1)  188/  88E1E4 : 0088 E1EC           	dc.l .blk
(1)  189/  88E1E8 : 0088 F486           	dc.l .inst
(1)  190/  88E1EC :                     .blk:
(1)  191/  88E1EC :                     	binclude "sound/tracks/nadie_md_blk.bin"
(1)  192/  88E1F3 :                     	align 2
(1)  193/  88E1F4 :                     .patt:
(1)  194/  88E1F4 :                     	binclude "sound/tracks/nadie_md_patt.bin"
(1)  195/  88F486 :                     	align 2
(1)  196/  88F486 :                     .inst:
(1)  197/  88F486 : (MACRO)             	gInsDac 0,DacIns_Nadie,0
(1)  197/  88F486 : C000 8A03                   dc.b $C0|0,0,((DACINS_NADIE>>16)&$FF),((DACINS_NADIE>>8)&$FF)
(1)  197/  88F48A : 3000 0000                   dc.b DACINS_NADIE&$FF,0,0,0
(1)  198/  88F48E : (MACRO)             	gInsFm -36,FmIns_Piano_Aqua
(1)  198/  88F48E : A0DC 8942                   dc.b $A0,-36,((FMINS_PIANO_AQUA>>16)&$FF),((FMINS_PIANO_AQUA>>8)&$FF)
(1)  198/  88F492 : 0C00 0000                   dc.b FMINS_PIANO_AQUA&$FF,$00,$00,$00
(1)  199/  88F496 : (MACRO)             	gInsFm -12,FmIns_HBeat_tom
(1)  199/  88F496 : A0F4 8944                   dc.b $A0,-12,((FMINS_HBEAT_TOM>>16)&$FF),((FMINS_HBEAT_TOM>>8)&$FF)
(1)  199/  88F49A : 2C00 0000                   dc.b FMINS_HBEAT_TOM&$FF,$00,$00,$00
(1)  200/  88F49E : (MACRO)             	gInsFm -37,FmIns_DrumKick_gem
(1)  200/  88F49E : A0DB 8940                   dc.b $A0,-37,((FMINS_DRUMKICK_GEM>>16)&$FF),((FMINS_DRUMKICK_GEM>>8)&$FF)
(1)  200/  88F4A2 : 6C00 0000                   dc.b FMINS_DRUMKICK_GEM&$FF,$00,$00,$00
(1)  201/  88F4A6 : (MACRO)             	gInsPsg 0,$50,$70,$00,$06,$08
(1)  201/  88F4A6 : 8000 5070                   dc.b $80,0,$50,$70
(1)  201/  88F4AA : 0006 0800                   dc.b $00,$06,$08,$00
(1)  202/  88F4AE : (MACRO)             	gInsFm 0,FmIns_Trumpet_1
(1)  202/  88F4AE : A000 8942                   dc.b $A0,0,((FMINS_TRUMPET_1>>16)&$FF),((FMINS_TRUMPET_1>>8)&$FF)
(1)  202/  88F4B2 : 2C00 0000                   dc.b FMINS_TRUMPET_1&$FF,$00,$00,$00
(1)  203/  88F4B6 : (MACRO)             	gInsNull
(1)  203/  88F4B6 : FF00 0000                   dc.b  -1,$00,$00,$00
(1)  203/  88F4BA : 0000 0000                   dc.b $00,$00,$00,$00
(1)  204/  88F4BE : (MACRO)             	gInsFm3 0,FmIns3_ClosedHat
(1)  204/  88F4BE : B000 893F                   dc.b $B0,0,((FMINS3_CLOSEDHAT>>16)&$FF),((FMINS3_CLOSEDHAT>>8)&$FF)
(1)  204/  88F4C2 : 6C00 0000                   dc.b FMINS3_CLOSEDHAT&$FF,$00,$00,$00
(1)  205/  88F4C6 : (MACRO)             	gInsFm3 0,FmIns3_OpenHat
(1)  205/  88F4C6 : B000 893F                   dc.b $B0,0,((FMINS3_OPENHAT>>16)&$FF),((FMINS3_OPENHAT>>8)&$FF)
(1)  205/  88F4CA : 4400 0000                   dc.b FMINS3_OPENHAT&$FF,$00,$00,$00
(1)  206/  88F4CE :                     
(1)  207/  88F4CE :                     GemaTrkData_WeGot:
(1)  208/  88F4CE : 0088 F4F0           	dc.l GemaPat_WeGot
(1)  209/  88F4D2 : 0088 F4DA           	dc.l GemaBlk_WeGot
(1)  210/  88F4D6 : 0089 1120           	dc.l GemaIns_WeGot
(1)  211/  88F4DA :                     GemaBlk_WeGot:
(1)  212/  88F4DA :                     	binclude "sound/tracks/wegot_blk.bin"
(1)  213/  88F4EF :                     	align 2
(1)  214/  88F4F0 :                     GemaPat_WeGot:
(1)  215/  88F4F0 :                     	binclude "sound/tracks/wegot_patt.bin"
(1)  216/  891120 :                     	align 2
(1)  217/  891120 :                     GemaIns_WeGot:
(1)  218/  891120 : (MACRO)             	gInsFm 0,FmIns_PSynth_plus
(1)  218/  891120 : A000 8943                   dc.b $A0,0,((FMINS_PSYNTH_PLUS>>16)&$FF),((FMINS_PSYNTH_PLUS>>8)&$FF)
(1)  218/  891124 : CC00 0000                   dc.b FMINS_PSYNTH_PLUS&$FF,$00,$00,$00
(1)  219/  891128 : (MACRO)             	gInsFm 0,FmIns_Bass_groove_2
(1)  219/  891128 : A000 8941                   dc.b $A0,0,((FMINS_BASS_GROOVE_2>>16)&$FF),((FMINS_BASS_GROOVE_2>>8)&$FF)
(1)  219/  89112C : 8C00 0000                   dc.b FMINS_BASS_GROOVE_2&$FF,$00,$00,$00
(1)  220/  891130 : (MACRO)             	gInsDac -36,DacIns_wegot_kick,0
(1)  220/  891130 : C0DC 8980                   dc.b $C0|0,-36,((DACINS_WEGOT_KICK>>16)&$FF),((DACINS_WEGOT_KICK>>8)&$FF)
(1)  220/  891134 : 0000 0000                   dc.b DACINS_WEGOT_KICK&$FF,0,0,0
(1)  221/  891138 : (MACRO)             	gInsFm 0,FmIns_Bass_club
(1)  221/  891138 : A000 8941                   dc.b $A0,0,((FMINS_BASS_CLUB>>16)&$FF),((FMINS_BASS_CLUB>>8)&$FF)
(1)  221/  89113C : 2C00 0000                   dc.b FMINS_BASS_CLUB&$FF,$00,$00,$00
(1)  222/  891140 : (MACRO)             	gInsFm3 0,FmIns3_OpenHat
(1)  222/  891140 : B000 893F                   dc.b $B0,0,((FMINS3_OPENHAT>>16)&$FF),((FMINS3_OPENHAT>>8)&$FF)
(1)  222/  891144 : 4400 0000                   dc.b FMINS3_OPENHAT&$FF,$00,$00,$00
(1)  223/  891148 : (MACRO)             	gInsPsg 0,$20,$40,$10,$01,$04
(1)  223/  891148 : 8000 2040                   dc.b $80,0,$20,$40
(1)  223/  89114C : 1001 0400                   dc.b $10,$01,$04,$00
(1)  224/  891150 : (MACRO)             	gInsDac -36,DacIns_wegot_crash,0
(1)  224/  891150 : C0DC 8998                   dc.b $C0|0,-36,((DACINS_WEGOT_CRASH>>16)&$FF),((DACINS_WEGOT_CRASH>>8)&$FF)
(1)  224/  891154 : A400 0000                   dc.b DACINS_WEGOT_CRASH&$FF,0,0,0
(1)  225/  891158 : (MACRO)             	gInsPsgN 0,$00,$00,$00,$00,$10,%100
(1)  225/  891158 : 9400 0000                   dc.b $90|%100,0,$00,$00
(1)  225/  89115C : 0000 1000                   dc.b $00,$00,$10,0
(1)  226/  891160 : (MACRO)             	gInsNull
(1)  226/  891160 : FF00 0000                   dc.b  -1,$00,$00,$00
(1)  226/  891164 : 0000 0000                   dc.b $00,$00,$00,$00
(1)  227/  891168 : (MACRO)             	gInsNull
(1)  227/  891168 : FF00 0000                   dc.b  -1,$00,$00,$00
(1)  227/  89116C : 0000 0000                   dc.b $00,$00,$00,$00
(1)  228/  891170 :                     
(1)  229/  891170 :                     GemaTrkData_Mecano:
(1)  230/  891170 : 0089 118A           	dc.l GemaPat_Mecano
(1)  231/  891174 : 0089 117C           	dc.l GemaBlk_Mecano
(1)  232/  891178 : 0089 3EA4           	dc.l GemaIns_Mecano
(1)  233/  89117C :                     GemaBlk_Mecano:
(1)  234/  89117C :                     	binclude "sound/tracks/mecano_blk.bin"
(1)  235/  891189 :                     	align 2
(1)  236/  89118A :                     GemaPat_Mecano:
(1)  237/  89118A :                     	binclude "sound/tracks/mecano_patt.bin"
(1)  238/  893EA4 :                     	align 2
(1)  239/  893EA4 :                     GemaIns_Mecano:
(1)  240/  893EA4 : (MACRO)             	gInsNull
(1)  240/  893EA4 : FF00 0000                   dc.b  -1,$00,$00,$00
(1)  240/  893EA8 : 0000 0000                   dc.b $00,$00,$00,$00
(1)  241/  893EAC : (MACRO)             	gInsPsgN 0,$00,$00,$00,$00,$0C,%100
(1)  241/  893EAC : 9400 0000                   dc.b $90|%100,0,$00,$00
(1)  241/  893EB0 : 0000 0C00                   dc.b $00,$00,$0C,0
(1)  242/  893EB4 : (MACRO)             	gInsFm 0,FmIns_PianoM1
(1)  242/  893EB4 : A000 8940                   dc.b $A0,0,((FMINS_PIANOM1>>16)&$FF),((FMINS_PIANOM1>>8)&$FF)
(1)  242/  893EB8 : AC00 0000                   dc.b FMINS_PIANOM1&$FF,$00,$00,$00
(1)  243/  893EBC : (MACRO)             	gInsFm -12,FmIns_Trumpet_carnival
(1)  243/  893EBC : A0F4 8942                   dc.b $A0,-12,((FMINS_TRUMPET_CARNIVAL>>16)&$FF),((FMINS_TRUMPET_CARNIVAL>>8)&$FF)
(1)  243/  893EC0 : 8C00 0000                   dc.b FMINS_TRUMPET_CARNIVAL&$FF,$00,$00,$00
(1)  244/  893EC4 : (MACRO)             	gInsFm 0,FmIns_Bass_italo
(1)  244/  893EC4 : A000 8941                   dc.b $A0,0,((FMINS_BASS_ITALO>>16)&$FF),((FMINS_BASS_ITALO>>8)&$FF)
(1)  244/  893EC8 : CC00 0000                   dc.b FMINS_BASS_ITALO&$FF,$00,$00,$00
(1)  245/  893ECC : (MACRO)             	gInsDac 0,DacIns_wegot_kick,0
(1)  245/  893ECC : C000 8980                   dc.b $C0|0,0,((DACINS_WEGOT_KICK>>16)&$FF),((DACINS_WEGOT_KICK>>8)&$FF)
(1)  245/  893ED0 : 0000 0000                   dc.b DACINS_WEGOT_KICK&$FF,0,0,0
(1)  246/  893ED4 : (MACRO)             	gInsPsgN 0,$00,$00,$00,$00,$08,%110
(1)  246/  893ED4 : 9600 0000                   dc.b $90|%110,0,$00,$00
(1)  246/  893ED8 : 0000 0800                   dc.b $00,$00,$08,0
(1)  247/  893EDC : (MACRO)             	gInsDac -12,DacIns_snare_lobo,0
(1)  247/  893EDC : C0F4 8987                   dc.b $C0|0,-12,((DACINS_SNARE_LOBO>>16)&$FF),((DACINS_SNARE_LOBO>>8)&$FF)
(1)  247/  893EE0 : 7A00 0000                   dc.b DACINS_SNARE_LOBO&$FF,0,0,0
(1)  248/  893EE4 : (MACRO)             	gInsNull
(1)  248/  893EE4 : FF00 0000                   dc.b  -1,$00,$00,$00
(1)  248/  893EE8 : 0000 0000                   dc.b $00,$00,$00,$00
(1)  249/  893EEC : (MACRO)             	gInsNull
(1)  249/  893EEC : FF00 0000                   dc.b  -1,$00,$00,$00
(1)  249/  893EF0 : 0000 0000                   dc.b $00,$00,$00,$00
(1)  250/  893EF4 : (MACRO)             	gInsNull
(1)  250/  893EF4 : FF00 0000                   dc.b  -1,$00,$00,$00
(1)  250/  893EF8 : 0000 0000                   dc.b $00,$00,$00,$00
(1)  251/  893EFC : (MACRO)             	gInsNull
(1)  251/  893EFC : FF00 0000                   dc.b  -1,$00,$00,$00
(1)  251/  893F00 : 0000 0000                   dc.b $00,$00,$00,$00
(1)  252/  893F04 : (MACRO)             	gInsNull
(1)  252/  893F04 : FF00 0000                   dc.b  -1,$00,$00,$00
(1)  252/  893F08 : 0000 0000                   dc.b $00,$00,$00,$00
(1)  253/  893F0C : (MACRO)             	gInsFm 0,FmIns_Bass_2
(1)  253/  893F0C : A000 8941                   dc.b $A0,0,((FMINS_BASS_2>>16)&$FF),((FMINS_BASS_2>>8)&$FF)
(1)  253/  893F10 : 0C00 0000                   dc.b FMINS_BASS_2&$FF,$00,$00,$00
(1)  254/  893F14 : (MACRO)             	gInsNull
(1)  254/  893F14 : FF00 0000                   dc.b  -1,$00,$00,$00
(1)  254/  893F18 : 0000 0000                   dc.b $00,$00,$00,$00
(1)  255/  893F1C : (MACRO)             	gInsNull
(1)  255/  893F1C : FF00 0000                   dc.b  -1,$00,$00,$00
(1)  255/  893F20 : 0000 0000                   dc.b $00,$00,$00,$00
(1)  256/  893F24 : (MACRO)             	gInsNull
(1)  256/  893F24 : FF00 0000                   dc.b  -1,$00,$00,$00
(1)  256/  893F28 : 0000 0000                   dc.b $00,$00,$00,$00
(1)  257/  893F2C : (MACRO)             	gInsNull
(1)  257/  893F2C : FF00 0000                   dc.b  -1,$00,$00,$00
(1)  257/  893F30 : 0000 0000                   dc.b $00,$00,$00,$00
(1)  258/  893F34 : (MACRO)             	gInsNull
(1)  258/  893F34 : FF00 0000                   dc.b  -1,$00,$00,$00
(1)  258/  893F38 : 0000 0000                   dc.b $00,$00,$00,$00
(1)  259/  893F3C : (MACRO)             	gInsNull
(1)  259/  893F3C : FF00 0000                   dc.b  -1,$00,$00,$00
(1)  259/  893F40 : 0000 0000                   dc.b $00,$00,$00,$00
(1)  260/  893F44 :                     
(1)  261/  893F44 :                     ; GemaTrkData_Test3:
(1)  262/  893F44 :                     ; 	dc.l GemaPat_Test3
(1)  263/  893F44 :                     ; 	dc.l GemaBlk_Test3
(1)  264/  893F44 :                     ; 	dc.l GemaIns_Test3
(1)  265/  893F44 :                     ; GemaBlk_Test3:
(1)  266/  893F44 :                     ; 	binclude "sound/tracks/vuela_blk.bin"
(1)  267/  893F44 :                     ; 	align 2
(1)  268/  893F44 :                     ; GemaPat_Test3:
(1)  269/  893F44 :                     ; 	binclude "sound/tracks/vuela_patt.bin"
(1)  270/  893F44 :                     ; 	align 2
(1)  271/  893F44 :                     ; GemaIns_Test3:
(1)  272/  893F44 :                     ; 	gInsFm -12,FmIns_Brass_Eur
(1)  273/  893F44 :                     ; 	gInsFm 0,FmIns_Bass_italo
(1)  274/  893F44 :                     ; 	gInsDac -36,DacIns_wegot_kick,0
(1)  275/  893F44 :                     ; 	gInsPsgN 0,$00,$00,$00,$00,$0E,%100
(1)  276/  893F44 :                     ; 	gInsNull
(1)  277/  893F44 :                     ; 	gInsPsg 0,$20,$40,$10,$06,$08
(1)  278/  893F44 :                     ; 	gInsDac +16,DacIns_snare_magn,0
(1)  279/  893F44 :                     ; 	gInsFm -24,FmIns_Brass_Eur
(1)  280/  893F44 :                     ; 	gInsNull
(1)  281/  893F44 :                     ; 	gInsNull
(1)  282/  893F44 :                     ; 	gInsNull
(1)  283/  893F44 :                     ; 	gInsNull
(1)  284/  893F44 :                     ; 	gInsFm -24,FmIns_Trumpet_carnival
(1)  285/  893F44 :                     ; 	gInsFm -12,FmIns_Ding_toy
(1)  286/  893F44 :                     ; 	gInsNull
(1)  287/  893F44 :                     
      86/  893F44 :                     		include "sound/instr.asm"		; GEMA: FM instruments
(1)    1/  893F44 :                     ; ====================================================================
(1)    2/  893F44 :                     ; FM instrument patches
(1)    3/  893F44 :                     ;
(1)    4/  893F44 :                     ; This must be located at the 880000 area.
(1)    5/  893F44 :                     ; 68K BANK 0 only
(1)    6/  893F44 :                     ; ====================================================================
(1)    7/  893F44 :                     
(1)    8/  893F44 :                     ; Savestate FM data is located at: $2478
(1)    9/  893F44 :                     ;
(1)   10/  893F44 :                     ; Sizes:
(1)   11/  893F44 :                     ; Normal FM ins: $20
(1)   12/  893F44 :                     ; Special FM ins: $28
(1)   13/  893F44 :                     
(1)   14/  893F44 :                     ; FM3 Special
(1)   15/  893F44 :                     FmIns3_OpenHat:
(1)   16/  893F44 :                     		binclude "sound/instr/fm/fm3_openhat.gsx",$2478,$28
(1)   17/  893F6C :                     FmIns3_ClosedHat:
(1)   18/  893F6C :                     		binclude "sound/instr/fm/fm3_closedhat.gsx",$2478,$28
(1)   19/  893F94 :                     FmIns3_Explosion:
(1)   20/  893F94 :                     		binclude "sound/instr/fm/fm3_sfx_boomworm.gsx",$2478,$28
(1)   21/  893FBC :                     
(1)   22/  893FBC :                     FmIns3_Snare_Alien:
(1)   23/  893FBC :                     		binclude "sound/instr/fm/fm3_drumsnare_alien.gsx",$2478,$28
(1)   24/  893FE4 :                     FmIns3_Kick_Alien:
(1)   25/  893FE4 :                     		binclude "sound/instr/fm/fm3_drumkick_alien.gsx",$2478,$28
(1)   26/  89400C :                     
(1)   27/  89400C :                     FmIns_Bass_Oil:
(1)   28/  89400C :                     		binclude "sound/instr/fm/bass_oil.gsx",$2478,$20
(1)   29/  89402C :                     FmIns_Organ_Ito:
(1)   30/  89402C :                     		binclude "sound/instr/fm/organ_ito.gsx",$2478,$20
(1)   31/  89404C :                     FmIns_Ding_Baseball:
(1)   32/  89404C :                     		binclude "sound/instr/fm/ding_baseball.gsx",$2478,$20
(1)   33/  89406C :                     
(1)   34/  89406C :                     ; FmIns_Guitar_gem:
(1)   35/  89406C :                     ; 		binclude "sound/instr/fm/guitar_gem.gsx",$2478,$20
(1)   36/  89406C :                     ; Fmins_Guitar_Heavy:
(1)   37/  89406C :                     ; 		binclude "sound/instr/fm/guitar_heavy.gsx",$2478,$20
(1)   38/  89406C :                     ; Fmins_Guitar_puy:
(1)   39/  89406C :                     ; 		binclude "sound/instr/fm/guitar_puy.gsx",$2478,$20
(1)   40/  89406C :                     ; Fmins_Guitar_puy_2:
(1)   41/  89406C :                     ; 		binclude "sound/instr/fm/guitar_puy_2.gsx",$2478,$20
(1)   42/  89406C :                     FmIns_DrumKick_gem:
(1)   43/  89406C :                     		binclude "sound/instr/fm/drum_kick_gem.gsx",$2478,$20
(1)   44/  89408C :                     ;
(1)   45/  89408C :                     ; ; FmIns_DrumKick:
(1)   46/  89408C :                     ; ; 		binclude "sound/instr/fm/drum_kick.gsx",$2478,$20
(1)   47/  89408C :                     ; ; FmIns_DrumSnare:
(1)   48/  89408C :                     ; ; 		binclude "sound/instr/fm/drum_snare.gsx",$2478,$20
(1)   49/  89408C :                     FmIns_ClosedHat:
(1)   50/  89408C :                     		binclude "sound/instr/fm/hats_closed.gsx",$2478,$20
(1)   51/  8940AC :                     FmIns_PianoM1:
(1)   52/  8940AC :                     		binclude "sound/instr/fm/piano_m1.gsx",$2478,$20
(1)   53/  8940CC :                     ; ; FmIns_PianoM116:
(1)   54/  8940CC :                     ; ; 		binclude "sound/instr/fm/piano_m116.gsx",$2478,$20
(1)   55/  8940CC :                     ;
(1)   56/  8940CC :                     ; ; ;
(1)   57/  8940CC :                     ; ; ; ; FmIns_Bass_gum:
(1)   58/  8940CC :                     ; ; ; ; 		binclude "sound/instr/fm/bass_gum.gsx",$2478,$20
(1)   59/  8940CC :                     FmIns_Bass_calm:
(1)   60/  8940CC :                     		binclude "sound/instr/fm/bass_calm.gsx",$2478,$20
(1)   61/  8940EC :                     ; FmIns_Bass_heavy:
(1)   62/  8940EC :                     ; 		binclude "sound/instr/fm/bass_heavy.gsx",$2478,$20
(1)   63/  8940EC :                     ; FmIns_Bass_ambient:
(1)   64/  8940EC :                     ; 		binclude "sound/instr/fm/bass_ambient.gsx",$2478,$20
(1)   65/  8940EC :                     ; ; ; FmIns_Brass_gummy:
(1)   66/  8940EC :                     ; ; ; 		binclude "sound/instr/fm/brass_gummy.gsx",$2478,$20
(1)   67/  8940EC :                     ; FmIns_Flaute_1:
(1)   68/  8940EC :                     ; 		binclude "sound/instr/fm/flaute_1.gsx",$2478,$20
(1)   69/  8940EC :                     FmIns_Bass_1:
(1)   70/  8940EC :                     		binclude "sound/instr/fm/bass_low.gsx",$2478,$20
(1)   71/  89410C :                     FmIns_Bass_2:
(1)   72/  89410C :                     		binclude "sound/instr/fm/bass_strong.gsx",$2478,$20
(1)   73/  89412C :                     ; FmIns_Bass_3:
(1)   74/  89412C :                     ; 		binclude "sound/instr/fm/bass_3.gsx",$2478,$20
(1)   75/  89412C :                     ; FmIns_Bass_4:
(1)   76/  89412C :                     ; 		binclude "sound/instr/fm/bass_4.gsx",$2478,$20
(1)   77/  89412C :                     ; FmIns_Bass_5:
(1)   78/  89412C :                     ; 		binclude "sound/instr/fm/bass_5.gsx",$2478,$20
(1)   79/  89412C :                     FmIns_Bass_club:
(1)   80/  89412C :                     		binclude "sound/instr/fm/bass_club.gsx",$2478,$20
(1)   81/  89414C :                     FmIns_Bass_donna:
(1)   82/  89414C :                     		binclude "sound/instr/fm/bass_feellove.gsx",$2478,$20
(1)   83/  89416C :                     FmIns_Bass_groove:
(1)   84/  89416C :                     		binclude "sound/instr/fm/bass_groove.gsx",$2478,$20
(1)   85/  89418C :                     FmIns_Bass_groove_2:
(1)   86/  89418C :                     		binclude "sound/instr/fm/bass_groove_2.gsx",$2478,$20
(1)   87/  8941AC :                     FmIns_Bass_groove_gem:
(1)   88/  8941AC :                     		binclude "sound/instr/fm/bass_groove_gem.gsx",$2478,$20
(1)   89/  8941CC :                     FmIns_Bass_italo:
(1)   90/  8941CC :                     		binclude "sound/instr/fm/bass_italo.gsx",$2478,$20
(1)   91/  8941EC :                     FmIns_Bass_duck:
(1)   92/  8941EC :                     		binclude "sound/instr/fm/bass_duck.gsx",$2478,$20
(1)   93/  89420C :                     
(1)   94/  89420C :                     ; FmIns_Bass_kon:
(1)   95/  89420C :                     ; 		binclude "sound/instr/fm/bass_kon.gsx",$2478,$20
(1)   96/  89420C :                     
(1)   97/  89420C :                     ; FmIns_Bass_mecan:
(1)   98/  89420C :                     ; 		binclude "sound/instr/fm/bass_mecan.gsx",$2478,$20
(1)   99/  89420C :                     ;
(1)  100/  89420C :                     ; ; ; FmIns_Bass_heavy:
(1)  101/  89420C :                     ; ; ; 		binclude "sound/instr/fm/bass_heavy.gsx",$2478,$20
(1)  102/  89420C :                     ; ; ; FmIns_Bass_metal:
(1)  103/  89420C :                     ; ; ; 		binclude "sound/instr/fm/bass_metal.gsx",$2478,$20
(1)  104/  89420C :                     ; FmIns_Bass_synth:
(1)  105/  89420C :                     ; 		binclude "sound/instr/fm/bass_synth_1.gsx",$2478,$20
(1)  106/  89420C :                     ; FmIns_Guitar_1:
(1)  107/  89420C :                     ; 		binclude "sound/instr/fm/guitar_1.gsx",$2478,$20
(1)  108/  89420C :                     ; ; ; FmIns_Horn_1:
(1)  109/  89420C :                     ; ; ; 		binclude "sound/instr/fm/horn_1.gsx",$2478,$20
(1)  110/  89420C :                     ; FmIns_Organ_M1:
(1)  111/  89420C :                     ; 		binclude "sound/instr/fm/organ_m1.gsx",$2478,$20
(1)  112/  89420C :                     ; ; ; FmIns_Bass_Beach:
(1)  113/  89420C :                     ; ; ; 		binclude "sound/instr/fm/bass_beach.gsx",$2478,$20
(1)  114/  89420C :                     ; ; ; FmIns_Bass_Beach_2:
(1)  115/  89420C :                     ; ; ; 		binclude "sound/instr/fm/bass_beach_2.gsx",$2478,$20
(1)  116/  89420C :                     ; ; ; FmIns_Brass_Cave:
(1)  117/  89420C :                     ; ; ; 		binclude "sound/instr/fm/brass_cave.gsx",$2478,$20
(1)  118/  89420C :                     ; ; FmIns_Brass_Gem:
(1)  119/  89420C :                     ; ; 		binclude "sound/instr/fm/brass_gem.gsx",$2478,$20
(1)  120/  89420C :                     ; ; FmIns_Piano_Small:
(1)  121/  89420C :                     ; ; 		binclude "sound/instr/fm/piano_small.gsx",$2478,$20
(1)  122/  89420C :                     FmIns_Piano_Aqua:
(1)  123/  89420C :                     		binclude "sound/instr/fm/piano_aqua.gsx",$2478,$20
(1)  124/  89422C :                     
(1)  125/  89422C :                     FmIns_Trumpet_1:
(1)  126/  89422C :                     		binclude "sound/instr/fm/trumpet_1.gsx",$2478,$20
(1)  127/  89424C :                     FmIns_Trumpet_2:
(1)  128/  89424C :                     		binclude "sound/instr/fm/trumpet_2.gsx",$2478,$20
(1)  129/  89426C :                     ; FmIns_Trumpet_kon:
(1)  130/  89426C :                     ; 		binclude "sound/instr/fm/trumpet_kon.gsx",$2478,$20
(1)  131/  89426C :                     FmIns_Trumpet_puy:
(1)  132/  89426C :                     		binclude "sound/instr/fm/trumpet_puy.gsx",$2478,$20
(1)  133/  89428C :                     FmIns_Trumpet_carnival:
(1)  134/  89428C :                     		binclude "sound/instr/fm/trumpet_carnivl.gsx",$2478,$20
(1)  135/  8942AC :                     
(1)  136/  8942AC :                     ; FmIns_Bell_Glass:
(1)  137/  8942AC :                     ; 		binclude "sound/instr/fm/bell_glass.gsx",$2478,$20
(1)  138/  8942AC :                     FmIns_Marimba:
(1)  139/  8942AC :                     		binclude "sound/instr/fm/marimba.gsx",$2478,$20
(1)  140/  8942CC :                     
(1)  141/  8942CC :                     FmIns_Ambient_dark:
(1)  142/  8942CC :                     		binclude "sound/instr/fm/ambient_dark.gsx",$2478,$20
(1)  143/  8942EC :                     FmIns_Ambient_spook:
(1)  144/  8942EC :                     		binclude "sound/instr/fm/ambient_spook.gsx",$2478,$20
(1)  145/  89430C :                     FmIns_Ambient_3:
(1)  146/  89430C :                     		binclude "sound/instr/fm/ambient_3.gsx",$2478,$20
(1)  147/  89432C :                     FmIns_Ding_toy:
(1)  148/  89432C :                     		binclude "sound/instr/fm/ding_toy.gsx",$2478,$20
(1)  149/  89434C :                     ; FmIns_Bell_China:
(1)  150/  89434C :                     ; 		binclude "sound/instr/fm/bell_china.gsx",$2478,$20
(1)  151/  89434C :                     FmIns_Brass_Eur:
(1)  152/  89434C :                     		binclude "sound/instr/fm/brass_eur.gsx",$2478,$20
(1)  153/  89436C :                     FmIns_Brass_Puy:
(1)  154/  89436C :                     		binclude "sound/instr/fm/brass_puy.gsx",$2478,$20
(1)  155/  89438C :                     FmIns_Flaute_cave:
(1)  156/  89438C :                     		binclude "sound/instr/fm/flaute_sea.gsx",$2478,$20
(1)  157/  8943AC :                     FmIns_Banjo_puy:
(1)  158/  8943AC :                     		binclude "sound/instr/fm/banjo_puy.gsx",$2478,$20
(1)  159/  8943CC :                     ; FmIns_Violin_gem:
(1)  160/  8943CC :                     ; 		binclude "sound/instr/fm/violin_gem.gsx",$2478,$20
(1)  161/  8943CC :                     
(1)  162/  8943CC :                     FmIns_PSynth_plus:
(1)  163/  8943CC :                     		binclude "sound/instr/fm/psynth_plus.gsx",$2478,$20
(1)  164/  8943EC :                     FmIns_Ding_1:
(1)  165/  8943EC :                     		binclude "sound/instr/fm/ding_gem.gsx",$2478,$20
(1)  166/  89440C :                     FmIns_Trombone_gem:
(1)  167/  89440C :                     		binclude "sound/instr/fm/trombone_gem.gsx",$2478,$20
(1)  168/  89442C :                     
(1)  169/  89442C :                     FmIns_HBeat_tom:
(1)  170/  89442C :                     		binclude "sound/instr/fm/nadia_tom.gsx",$2478,$20
(1)  171/  89444C :                     
      87/  89444C :                     		include "sound/smpl_dac.asm"		; GEMA: DAC samples
(1)    1/  89444C :                     ; ====================================================================
(1)    2/  89444C :                     ; DAC samples
(1)    3/  89444C :                     ;
(1)    4/  89444C :                     ; This must be located at the 900000 area.
(1)    5/  89444C :                     ; ====================================================================
(1)    6/  89444C :                     
(1)    7/  89444C :                     ; Special sample data macro
(1)    8/  89444C :                     gSmpHead macro len,loop
(1)    9/  89444C :                     	dc.b ((len)&$FF),(((len)>>8)&$FF),(((len)>>16)&$FF)	; length
(1)   10/  89444C :                     	dc.b ((loop)&$FF),(((loop)>>8)&$FF),(((loop)>>16)&$FF)
(1)   11/  89444C :                     	endm
(1)   12/  89444C :                     
(1)   13/  89444C :                     	align $8000
(1)   14/  898000 :                     DacIns_wegot_kick:
(1)   15/  898000 : (MACRO)             	gSmpHead .end-.start,0
(1)   15/  898000 : 7407 00                     dc.b ((.END-.START)&$FF),(((.END-.START)>>8)&$FF),(((.END-.START)>>16)&$FF)     ; length
(1)   15/  898003 : 0000 00                     dc.b ((0)&$FF),(((0)>>8)&$FF),(((0)>>16)&$FF)
(1)   16/  898006 :                     .start:	binclude "sound/instr/smpl/wegot_kick.wav",$2C
(1)   17/  89877A :                     .end:
(1)   18/  89877A :                     DacIns_snare_lobo:
(1)   19/  89877A : (MACRO)             	gSmpHead .end-.start,0
(1)   19/  89877A : 2411 00                     dc.b ((.END-.START)&$FF),(((.END-.START)>>8)&$FF),(((.END-.START)>>16)&$FF)     ; length
(1)   19/  89877D : 0000 00                     dc.b ((0)&$FF),(((0)>>8)&$FF),(((0)>>16)&$FF)
(1)   20/  898780 :                     .start:	binclude "sound/instr/smpl/snare_lobo.wav",$2C
(1)   21/  8998A4 :                     .end:
(1)   22/  8998A4 :                     
(1)   23/  8998A4 :                     
(1)   24/  8998A4 :                     DacIns_wegot_crash:
(1)   25/  8998A4 : (MACRO)             	gSmpHead .end-.start,0
(1)   25/  8998A4 : C42C 00                     dc.b ((.END-.START)&$FF),(((.END-.START)>>8)&$FF),(((.END-.START)>>16)&$FF)     ; length
(1)   25/  8998A7 : 0000 00                     dc.b ((0)&$FF),(((0)>>8)&$FF),(((0)>>16)&$FF)
(1)   26/  8998AA :                     .start:	binclude "sound/instr/smpl/wegot_crash.wav",$2C
(1)   27/  89C56E :                     .end:
(1)   28/  89C56E :                     
(1)   29/  89C56E :                     
(1)   30/  89C56E :                     DacIns_snare_scd:
(1)   31/  89C56E : (MACRO)             	gSmpHead .end-.start,0
(1)   31/  89C56E : F419 00                     dc.b ((.END-.START)&$FF),(((.END-.START)>>8)&$FF),(((.END-.START)>>16)&$FF)     ; length
(1)   31/  89C571 : 0000 00                     dc.b ((0)&$FF),(((0)>>8)&$FF),(((0)>>16)&$FF)
(1)   32/  89C574 :                     .start:	binclude "sound/instr/smpl/snare_scd.wav",$2C
(1)   33/  89DF68 :                     .end:
(1)   34/  89DF68 :                     DacIns_snare_magn:
(1)   35/  89DF68 : (MACRO)             	gSmpHead .end-.start,0
(1)   35/  89DF68 : D413 00                     dc.b ((.END-.START)&$FF),(((.END-.START)>>8)&$FF),(((.END-.START)>>16)&$FF)     ; length
(1)   35/  89DF6B : 0000 00                     dc.b ((0)&$FF),(((0)>>8)&$FF),(((0)>>16)&$FF)
(1)   36/  89DF6E :                     .start:	binclude "sound/instr/smpl/snare_magn.wav",$2C
(1)   37/  89F342 :                     .end:
(1)   38/  89F342 :                     DacIns_kick:
(1)   39/  89F342 : (MACRO)             	gSmpHead .end-.start,0
(1)   39/  89F342 : E80F 00                     dc.b ((.END-.START)&$FF),(((.END-.START)>>8)&$FF),(((.END-.START)>>16)&$FF)     ; length
(1)   39/  89F345 : 0000 00                     dc.b ((0)&$FF),(((0)>>8)&$FF),(((0)>>16)&$FF)
(1)   40/  89F348 :                     .start:	binclude "sound/instr/smpl/stKick.wav",$2C
(1)   41/  8A0330 :                     .end:
(1)   42/  8A0330 :                     
(1)   43/  8A0330 :                     DacIns_Nadie:
(1)   44/  8A0330 : (MACRO)             	gSmpHead .end-.start,0
(1)   44/  8A0330 : BEE7 00                     dc.b ((.END-.START)&$FF),(((.END-.START)>>8)&$FF),(((.END-.START)>>16)&$FF)     ; length
(1)   44/  8A0333 : 0000 00                     dc.b ((0)&$FF),(((0)>>8)&$FF),(((0)>>16)&$FF)
(1)   45/  8A0336 :                     .start:	binclude "sound/instr/smpl/nadie.wav",$2C
(1)   46/  8AEAF2 :                     	align 4
(1)   47/  8AEAF4 :                     .end:
(1)   48/  8AEAF4 :                     
(1)   49/  8AEAF4 :                     
      88/   2EAF4 :                     		dephase
      89/   2EAF4 :                     		align 2
      90/   2EAF4 :                     
      91/   2EAF4 :                     ; ====================================================================
      92/   2EAF4 :                     ; ----------------------------------------------------------------
      93/   2EAF4 :                     ; 68K DATA BANKs at $900000 1MB max
      94/   2EAF4 :                     ; ----------------------------------------------------------------
      95/   2EAF4 :                     
      96/   2EAF4 :                     ; ---------------------------------------------
      97/   2EAF4 :                     ; BANK 0
      98/   2EAF4 :                     ; ---------------------------------------------
      99/   2EAF4 :                     
     100/  92EAF4 :                     		phase $900000+*			; Currently only this one.
     101/  92EAF4 :                     MDBNK0_START:
     102/  92EAF4 :                     		include "data/md_bank0.asm"	; <-- 68K banked data
(1)    1/  92EAF4 :                     ; ====================================================================
(1)    2/  92EAF4 :                     ; ----------------------------------------------------------------
(1)    3/  92EAF4 :                     ; BANK 0 of 68k data ($900000-$9FFFFF)
(1)    4/  92EAF4 :                     ; for big stuff like maps, levels, etc.
(1)    5/  92EAF4 :                     ;
(1)    6/  92EAF4 :                     ; For graphics use DMA and place your files at
(1)    7/  92EAF4 :                     ; md_dma.asm (Watch out for the $20000 limit.)
(1)    8/  92EAF4 :                     ;
(1)    9/  92EAF4 :                     ; Maximum size: $0FFFFF bytes per bank
(1)   10/  92EAF4 :                     ; ----------------------------------------------------------------
(1)   11/  92EAF4 :                     
(1)   12/  92EAF4 :                     		include "data/mars/palettes.asm"	; All 32X palettes will be here.
(2)    1/  92EAF4 :                     ; ====================================================================
(2)    2/  92EAF4 :                     ; ----------------------------------------------------------------
(2)    3/  92EAF4 :                     ; Put your 32X palettes here
(2)    4/  92EAF4 :                     ;
(2)    5/  92EAF4 :                     ; These are located on a single 68K $900000+ bank
(2)    6/  92EAF4 :                     ;
(2)    7/  92EAF4 :                     ; Labels MUST be aligned by 2
(2)    8/  92EAF4 :                     ; ----------------------------------------------------------------
(2)    9/  92EAF4 :                     
(2)   10/  92EAF4 :                     		align 2
(2)   11/  92EAF4 :                     PalData_Mars_Test:
(2)   12/  92EAF4 :                     		binclude "data/mars/tests/test_pal.bin"
(2)   13/  92ECF4 :                     		align 2
(2)   14/  92ECF4 :                     MDLDATA_PAL_TEST:
(2)   15/  92ECF4 :                     		binclude "data/maps/mars/mcity/mtrl/marscity_pal.bin"
(2)   16/  92EEF4 :                     		align 2
(2)   17/  92EEF4 :                     ; TestMars_YuiP:
(2)   18/  92EEF4 :                     ; 		binclude "data/mars/tests/yui_mars_pal.bin"
(2)   19/  92EEF4 :                     ; 		align 2
(2)   20/  92EEF4 :                     
(2)   21/  92EEF4 :                     MapPal_M:	binclude "data/maps/level0/pal_m.bin"
(2)   22/  92EFF4 :                     		align 2
(2)   23/  92EFF4 :                     
(2)   24/  92EFF4 :                     TestSupSpr_Pal:
(2)   25/  92EFF4 :                     		binclude "data/sprites/mars/nicole/sprites_pal.bin"
(2)   26/  92F062 :                     		align 2
(2)   27/  92F062 :                     
(1)   13/  92F062 :                     
(1)   14/  92F062 :                     		align 2
(1)   15/  92F062 :                     Pal_level0:	binclude "data/maps/level0/pal.bin"
(1)   16/  92F082 :                     		align 2
(1)   17/  92F082 :                     Pal_Test3D:	binclude "data/bg/md/test_3d/md_bg_pal.bin"
(1)   18/  92F092 :                     		align 2
(1)   19/  92F092 :                     Map_Test3D:	binclude "data/bg/md/test_3d/md_bg_map.bin"
(1)   20/  92FE92 :                     		align 2
(1)   21/  92FE92 :                     
(1)   22/  92FE92 :                     ; ----------------------------------------------------------------
(1)   23/  92FE92 :                     
(1)   24/  92FE92 :                     		align 2
(1)   25/  92FE92 :                     MapHead_0:	binclude "data/maps/level0/head.bin"
(1)   26/  92FE9C :                     MapBlk_0:	binclude "data/maps/level0/blocks.bin"
(1)   27/  9306A4 :                     		align 2
(1)   28/  9306A4 :                     MapFgL_0:	binclude "data/maps/level0/fg_low.bin"
(1)   29/  931304 :                     		align 2
(1)   30/  931304 :                     MapFgH_0:	binclude "data/maps/level0/fg_hi.bin"
(1)   31/  931F64 :                     		align 2
(1)   32/  931F64 :                     MapFgC_0:	binclude "data/maps/level0/fg_col.bin"
(1)   33/  932BC4 :                     		align 2
(1)   34/  932BC4 :                     MapBgL_0:	binclude "data/maps/level0/bg_low.bin"
(1)   35/  933824 :                     		align 2
(1)   36/  933824 :                     MapBgH_0:	binclude "data/maps/level0/bg_hi.bin"
(1)   37/  934484 :                     		align 2
(1)   38/  934484 :                     
(1)   39/  934484 :                     ; ----------------------------------------------------------------
(1)   40/  934484 :                     ; HEADERS for 32X maps go here...
(1)   41/  934484 :                     
(1)   42/  934484 :                     		align 2
(1)   43/  934484 :                     MapHead_M:	binclude "data/maps/level0/head_m.bin"
(1)   44/  93448A :                     		align 2
(1)   45/  93448A :                     
     103/  93448A :                     MDBNK0_END:
     104/   3448A :                     		dephase
     105/   3448A :                     ; 		org $100000-4			; Fill this bank and
     106/   3448A :                     ; 		dc.b "BNK0"			; add a tag at the end
     107/   3448A :                     
     112/   3448A :                     
     113/   3448A :                     ; ---------------------------------------------
     114/   3448A :                     ; BANK 1
     115/   3448A :                     ; ---------------------------------------------
     116/   3448A :                     
     117/   3448A :                     ; 		phase $900000
     118/   3448A :                     ; 		include "data/md_bank1.asm"
     119/   3448A :                     ; 		dephase
     120/   3448A :                     ; 		org $200000-4
     121/   3448A :                     ; 		dc.b "BNK1"
     122/   3448A :                     
     123/   3448A :                     ; ---------------------------------------------
     124/   3448A :                     ; BANK 2
     125/   3448A :                     ; ---------------------------------------------
     126/   3448A :                     
     127/   3448A :                     ; 		phase $900000
     128/   3448A :                     ; 		include "data/md_bank2.asm"
     129/   3448A :                     ; 		dephase
     130/   3448A :                     ; 		org $300000-4
     131/   3448A :                     ; 		dc.b "BNK2"
     132/   3448A :                     
     133/   3448A :                     ; ---------------------------------------------
     134/   3448A :                     ; BANK 3
     135/   3448A :                     ; ---------------------------------------------
     136/   3448A :                     
     137/   3448A :                     ; 		phase $900000
     138/   3448A :                     ; 		include "data/md_bank3.asm"
     139/   3448A :                     ; 		dephase
     140/   3448A :                     ; 		org $400000-4
     141/   3448A :                     ; 		dc.b "BNK3"
     142/   3448A :                     
     143/   3448A :                     ; ====================================================================
     144/   3448A :                     ; ----------------------------------------------------------------
     145/   3448A :                     ; MD DMA data: BANK-free but requres RV=1
     146/   3448A :                     ; ----------------------------------------------------------------
     147/   3448A :                     
     148/   3448A :                     		align 4
     149/   3448C :                     		include "data/md_dma.asm"
(1)    1/   3448C :                     ; ====================================================================
(1)    2/   3448C :                     ; ----------------------------------------------------------------
(1)    3/   3448C :                     ; DMA ROM-DATA Transfer section
(1)    4/   3448C :                     ; 
(1)    5/   3448C :                     ; RV bit must be enabled to read from here
(1)    6/   3448C :                     ; ----------------------------------------------------------------
(1)    7/   3448C :                     
(1)    8/   3448C :                     		align $8000
(1)    9/   38000 :                     ASCII_FONT:	binclude "system/md/data/font.bin"
(1)   10/   39000 :                     ASCII_FONT_e:
(1)   11/   39000 :                     
(1)   12/   39000 :                     		align $8000
(1)   13/   40000 :                     ART_TEST3D:	binclude "data/bg/md/test_3d/md_bg_art.bin"
(1)   14/   41D20 :                     ART_TEST3D_e:
(1)   15/   41D20 :                     
(1)   16/   41D20 :                     		align $8000
(1)   17/   48000 :                     Art_level0:	binclude "data/maps/level0/art.bin"
(1)   18/   493E0 :                     Art_level0_e:
(1)   19/   493E0 :                     
(1)   20/   493E0 :                     
(1)   21/   493E0 :                     
(1)   22/   493E0 :                     
(1)   23/   493E0 :                     
     150/   493E0 :                     
     151/   493E0 :                     ; ====================================================================
     152/   493E0 :                     ; ----------------------------------------------------------------
     153/   493E0 :                     ; SH2 RAM CODE
     154/   493E0 :                     ; ----------------------------------------------------------------
     155/   493E0 :                     
     156/   493E0 :                     		align 4
     157/   493E0 :                     MARS_RAMDATA:
     158/   493E0 :                     		include "system/mars/code.asm"
(1)    1/   493E0 :                     ; ====================================================================
(1)    2/   493E0 :                     ; ----------------------------------------------------------------
(1)    3/   493E0 :                     ; MARS SH2 SDRAM section, shared for both CPUs
(1)    4/   493E0 :                     ;
(1)    5/   493E0 :                     ; Do note that both CPUs doesn't like each other, if both
(1)    6/   493E0 :                     ; CPUs read/write the same place it will trigger a crash.
(1)    7/   493E0 :                     ; ----------------------------------------------------------------
(1)    8/   493E0 :                     
(1)    9/   493E0 :                     ; *************************************************
(1)   10/   493E0 :                     ; communication setup:
(1)   11/   493E0 :                     ;
(1)   12/   493E0 :                     ; comm0-comm7  - ** FREE ***
(1)   13/   493E0 :                     ; comm8-comm11 - Used to transfer data manually
(1)   14/   493E0 :                     ;                from Z80 to SH2 side, 68k uses DREQ.
(1)   15/   493E0 :                     ; comm12       - Master CPU control
(1)   16/   493E0 :                     ; comm14       - Slave CPU control
(1)   17/   493E0 :                     ; *************************************************
(1)   18/   493E0 :                     
(1)   19/ 6000000 :                     		phase CS3	; Now we are at SDRAM
(1)   20/ 6000000 :                     		cpu SH7600	; Should be SH7095 but this CPU mode works.
(1)   21/ 6000000 :                     
(1)   22/ 6000000 :                     ; CPU METER MACRO
(1)   23/ 6000000 :                     testme macro color
(1)   24/ 6000000 :                     		mov	#color,r1
(1)   25/ 6000000 :                     		mov	#_vdpreg,r2
(1)   26/ 6000000 :                     		mov	#_vdpreg+bitmapmd,r3
(1)   27/ 6000000 :                     -		mov.b	@(vdpsts,r2),r0
(1)   28/ 6000000 :                     		tst	#HBLK,r0
(1)   29/ 6000000 :                     		bt	-
(1)   30/ 6000000 :                     		mov.b	r1,@r3
(1)   31/ 6000000 :                     	endm
(1)   32/ 6000000 :                     
(1)   33/ 6000000 :                     ; ====================================================================
(1)   34/ 6000000 :                     ; ----------------------------------------------------------------
(1)   35/ 6000000 :                     ; Settings
(1)   36/ 6000000 :                     ; ----------------------------------------------------------------
(1)   37/ 6000000 :                     
(1)   38/ 6000000 : =$1                 SH2_DEBUG	equ 1			; Set to 1 too see if CPUs are active using comm counters (0 and 1)
(1)   39/ 6000000 : =$6040000           STACK_MSTR	equ CS3|$40000
(1)   40/ 6000000 : =$603F000           STACK_SLV	equ CS3|$3F000
(1)   41/ 6000000 :                     
(1)   42/ 6000000 :                     ; ====================================================================
(1)   43/ 6000000 :                     ; ----------------------------------------------------------------
(1)   44/ 6000000 :                     ; MARS GLOBAL gbr variables for both SH2
(1)   45/ 6000000 :                     ; ----------------------------------------------------------------
(1)   46/ 6000000 :                     
(1)   47/ 6000000 : (MACRO)             			struct 0
(1)   47/ 6000000 : =$6000000           GLBL_LASTPC     set *
(1)   47/   493E0 :                                     dephase
(1)   47/   493E0 : =$493E0             GLBL_LASTORG    set *
(1)   47/       0 :                                     phase 0
(1)   48/       0 :                     marsGbl_PlyPzList_R	ds.l 1	; Current graphic piece to draw
(1)   49/       4 :                     marsGbl_PlyPzList_W	ds.l 1	; Current graphic piece to write
(1)   50/       8 :                     marsGbl_PlyPzList_Start	ds.l 1	; Polygon pieces list Start point
(1)   51/       C :                     marsGbl_PlyPzList_End	ds.l 1	; Polygon pieces list End point
(1)   52/      10 :                     marsGbl_WdgMode		ds.w 1	; Current watchdog task
(1)   53/      12 :                     marsGbl_WdgHold		ds.w 1	; Watchdog pause
(1)   54/      14 :                     marsGbl_WdgReady	ds.w 1
(1)   55/      16 :                     marsGbl_WdgDivLock	ds.w 1	; Tell Watchdog we are mid-division.
(1)   56/      18 :                     marsGbl_PolyBuffNum	ds.w 1	; Polygon-list swap number
(1)   57/      1A :                     marsGbl_PlyPzCntr	ds.w 1	; Number of graphic pieces to draw
(1)   58/      1C :                     marsGbl_CntrRdPlgn	ds.w 1	; Number of polygons to slice
(1)   59/      1E :                     marsGbl_CntrRdSpr	ds.w 1	; Number of sprites to read
(1)   60/      20 :                     marsGbl_XShift		ds.w 1	; Xshift bit at the start of master_loop (TODO: a HBlank list)
(1)   61/      22 :                     marsGbl_MdDrawTmr	ds.w 1	; Screen init counter for redrawing the entire screen (Write $02)
(1)   62/      24 :                     marsGbl_WaveEnable	ds.w 1	; General linetable wave effect: Disable/Enable
(1)   63/      26 :                     marsGbl_WaveSpd		ds.w 1	; Linetable wave speed
(1)   64/      28 :                     marsGbl_WaveMax		ds.w 1	; Maximum wave
(1)   65/      2A :                     marsGbl_WaveDeform	ds.w 1	; Wave increment value
(1)   66/      2C :                     marsGbl_WaveTan		ds.w 1	; Linetable wave tan
(1)   67/      2E :                     marsGbl_GotDreq		ds.w 1
(1)   68/      30 :                     sizeof_MarsGbl		ds.l 0
(1)   69/      30 : (MACRO)             			finish
(1)   69/       0 :                                     !org GLBL_LASTORG
(1)   69/ 6000000 :                                     phase GLBL_LASTPC
(1)   70/ 6000000 :                     
(1)   71/ 6000000 :                     ; ====================================================================
(1)   72/ 6000000 :                     ; ----------------------------------------------------------------
(1)   73/ 6000000 :                     ; MASTER CPU VECTOR LIST (vbr)
(1)   74/ 6000000 :                     ; ----------------------------------------------------------------
(1)   75/ 6000000 :                     
(1)   76/ 6000000 :                     		align 4
(1)   77/ 6000000 :                     SH2_Master:
(1)   78/ 6000000 : 0600 127C 0604 0000 		dc.l SH2_M_Entry,STACK_MSTR	; Power PC, Stack
(1)   79/ 6000008 : 0600 127C 0604 0000 		dc.l SH2_M_Entry,STACK_MSTR	; Reset PC, Stack
(1)   80/ 6000010 : 0600 0330           		dc.l SH2_M_ErrIllg		; Illegal instruction
(1)   81/ 6000014 : 0000 0000           		dc.l 0				; reserved
(1)   82/ 6000018 : 0600 0334           		dc.l SH2_M_ErrInvl		; Invalid slot instruction
(1)   83/ 600001C : 2010 0400           		dc.l $20100400			; reserved
(1)   84/ 6000020 : 2010 0420           		dc.l $20100420			; reserved
(1)   85/ 6000024 : 0600 0338           		dc.l SH2_M_ErrAddr		; CPU address error
(1)   86/ 6000028 : 0600 033C           		dc.l SH2_M_ErrDma		; DMA address error
(1)   87/ 600002C : 0600 0340           		dc.l SH2_M_ErrNmi		; NMI vector
(1)   88/ 6000030 : 0600 0344           		dc.l SH2_M_ErrUser		; User break vector
(1)   89/ 6000034 : 0000 0000 0000 0000 		dc.l 0,0,0,0,0,0,0,0,0		; reserved
                    0000 0000 0000 0000 
                    0000 0000 0000 0000 
                    0000 0000 0000 0000 
                    0000 0000           
(1)   90/ 6000058 : 0000 0000 0000 0000 		dc.l 0,0,0,0,0,0,0,0,0
                    0000 0000 0000 0000 
                    0000 0000 0000 0000 
                    0000 0000 0000 0000 
                    0000 0000           
(1)   91/ 600007C : 0000 0000           		dc.l 0
(1)   92/ 6000080 : 0600 032C           		dc.l SH2_M_Error		; Trap user vectors
(1)   93/ 6000084 : 0600 032C           		dc.l SH2_M_Error
(1)   94/ 6000088 : 0600 032C           		dc.l SH2_M_Error
(1)   95/ 600008C : 0600 032C           		dc.l SH2_M_Error
(1)   96/ 6000090 : 0600 032C           		dc.l SH2_M_Error
(1)   97/ 6000094 : 0600 032C           		dc.l SH2_M_Error
(1)   98/ 6000098 : 0600 032C           		dc.l SH2_M_Error
(1)   99/ 600009C : 0600 032C           		dc.l SH2_M_Error
(1)  100/ 60000A0 : 0600 032C           		dc.l SH2_M_Error
(1)  101/ 60000A4 : 0600 032C           		dc.l SH2_M_Error
(1)  102/ 60000A8 : 0600 032C           		dc.l SH2_M_Error
(1)  103/ 60000AC : 0600 032C           		dc.l SH2_M_Error
(1)  104/ 60000B0 : 0600 032C           		dc.l SH2_M_Error
(1)  105/ 60000B4 : 0600 032C           		dc.l SH2_M_Error
(1)  106/ 60000B8 : 0600 032C           		dc.l SH2_M_Error
(1)  107/ 60000BC : 0600 032C           		dc.l SH2_M_Error
(1)  108/ 60000C0 : 0600 032C           		dc.l SH2_M_Error
(1)  109/ 60000C4 : 0600 032C           		dc.l SH2_M_Error
(1)  110/ 60000C8 : 0600 032C           		dc.l SH2_M_Error
(1)  111/ 60000CC : 0600 032C           		dc.l SH2_M_Error
(1)  112/ 60000D0 : 0600 032C           		dc.l SH2_M_Error
(1)  113/ 60000D4 : 0600 032C           		dc.l SH2_M_Error
(1)  114/ 60000D8 : 0600 032C           		dc.l SH2_M_Error
(1)  115/ 60000DC : 0600 032C           		dc.l SH2_M_Error
(1)  116/ 60000E0 : 0600 032C           		dc.l SH2_M_Error
(1)  117/ 60000E4 : 0600 032C           		dc.l SH2_M_Error
(1)  118/ 60000E8 : 0600 032C           		dc.l SH2_M_Error
(1)  119/ 60000EC : 0600 032C           		dc.l SH2_M_Error
(1)  120/ 60000F0 : 0600 032C           		dc.l SH2_M_Error
(1)  121/ 60000F4 : 0600 032C           		dc.l SH2_M_Error
(1)  122/ 60000F8 : 0600 032C           		dc.l SH2_M_Error
(1)  123/ 60000FC : 0600 032C           		dc.l SH2_M_Error
(1)  124/ 6000100 : 0600 0250            		dc.l master_irq		; Level 1 IRQ
(1)  125/ 6000104 : 0600 0250           		dc.l master_irq		; Level 2 & 3 IRQ
(1)  126/ 6000108 : 0600 0250           		dc.l master_irq		; Level 4 & 5 IRQ
(1)  127/ 600010C : 0600 0250           		dc.l master_irq		; Level 6 & 7 IRQ: PWM interupt
(1)  128/ 6000110 : 0600 0250           		dc.l master_irq		; Level 8 & 9 IRQ: Command interupt
(1)  129/ 6000114 : 0600 0250           		dc.l master_irq		; Level 10 & 11 IRQ: H Blank interupt
(1)  130/ 6000118 : 0600 0250           		dc.l master_irq		; Level 12 & 13 IRQ: V Blank interupt
(1)  131/ 600011C : 0600 0250           		dc.l master_irq		; Level 14 & 15 IRQ: Reset Button
(1)  132/ 6000120 :                     	; ON-chip interrupts go here (vbr+$120)
(1)  133/ 6000120 : 0600 0250           		dc.l master_irq		; Watchdog (custom)
(1)  134/ 6000124 : 0600 0250           		dc.l master_irq		; DMA
(1)  135/ 6000128 :                     
(1)  136/ 6000128 :                     ; ====================================================================
(1)  137/ 6000128 :                     ; ----------------------------------------------------------------
(1)  138/ 6000128 :                     ; SLAVE CPU VECTOR LIST (vbr)
(1)  139/ 6000128 :                     ; ----------------------------------------------------------------
(1)  140/ 6000128 :                     
(1)  141/ 6000128 :                     		align 4
(1)  142/ 6000128 :                     SH2_Slave:
(1)  143/ 6000128 : 0600 17E8 0603 F000 		dc.l SH2_S_Entry,STACK_SLV	; Cold PC,SP
(1)  144/ 6000130 : 0600 17E8 0603 F000 		dc.l SH2_S_Entry,STACK_SLV	; Manual PC,SP
(1)  145/ 6000138 : 0600 035C           		dc.l SH2_S_ErrIllg		; Illegal instruction
(1)  146/ 600013C : 0000 0000           		dc.l 0				; reserved
(1)  147/ 6000140 : 0600 0360           		dc.l SH2_S_ErrInvl		; Invalid slot instruction
(1)  148/ 6000144 : 2010 0400           		dc.l $20100400			; reserved
(1)  149/ 6000148 : 2010 0420           		dc.l $20100420			; reserved
(1)  150/ 600014C : 0600 0364           		dc.l SH2_S_ErrAddr		; CPU address error
(1)  151/ 6000150 : 0600 0368           		dc.l SH2_S_ErrDma		; DMA address error
(1)  152/ 6000154 : 0600 036C           		dc.l SH2_S_ErrNmi		; NMI vector
(1)  153/ 6000158 : 0600 0370           		dc.l SH2_S_ErrUser		; User break vector
(1)  154/ 600015C : 0000 0000 0000 0000 		dc.l 0,0,0,0,0,0,0,0,0		; reserved
                    0000 0000 0000 0000 
                    0000 0000 0000 0000 
                    0000 0000 0000 0000 
                    0000 0000           
(1)  155/ 6000180 : 0000 0000 0000 0000 		dc.l 0,0,0,0,0,0,0,0,0
                    0000 0000 0000 0000 
                    0000 0000 0000 0000 
                    0000 0000 0000 0000 
                    0000 0000           
(1)  156/ 60001A4 : 0000 0000           		dc.l 0
(1)  157/ 60001A8 : 0600 0358           		dc.l SH2_S_Error		; Trap user vectors
(1)  158/ 60001AC : 0600 0358           		dc.l SH2_S_Error
(1)  159/ 60001B0 : 0600 0358           		dc.l SH2_S_Error
(1)  160/ 60001B4 : 0600 0358           		dc.l SH2_S_Error
(1)  161/ 60001B8 : 0600 0358           		dc.l SH2_S_Error
(1)  162/ 60001BC : 0600 0358           		dc.l SH2_S_Error
(1)  163/ 60001C0 : 0600 0358           		dc.l SH2_S_Error
(1)  164/ 60001C4 : 0600 0358           		dc.l SH2_S_Error
(1)  165/ 60001C8 : 0600 0358           		dc.l SH2_S_Error
(1)  166/ 60001CC : 0600 0358           		dc.l SH2_S_Error
(1)  167/ 60001D0 : 0600 0358           		dc.l SH2_S_Error
(1)  168/ 60001D4 : 0600 0358           		dc.l SH2_S_Error
(1)  169/ 60001D8 : 0600 0358           		dc.l SH2_S_Error
(1)  170/ 60001DC : 0600 0358           		dc.l SH2_S_Error
(1)  171/ 60001E0 : 0600 0358           		dc.l SH2_S_Error
(1)  172/ 60001E4 : 0600 0358           		dc.l SH2_S_Error
(1)  173/ 60001E8 : 0600 0358           		dc.l SH2_S_Error
(1)  174/ 60001EC : 0600 0358           		dc.l SH2_S_Error
(1)  175/ 60001F0 : 0600 0358           		dc.l SH2_S_Error
(1)  176/ 60001F4 : 0600 0358           		dc.l SH2_S_Error
(1)  177/ 60001F8 : 0600 0358           		dc.l SH2_S_Error
(1)  178/ 60001FC : 0600 0358           		dc.l SH2_S_Error
(1)  179/ 6000200 : 0600 0358           		dc.l SH2_S_Error
(1)  180/ 6000204 : 0600 0358           		dc.l SH2_S_Error
(1)  181/ 6000208 : 0600 0358           		dc.l SH2_S_Error
(1)  182/ 600020C : 0600 0358           		dc.l SH2_S_Error
(1)  183/ 6000210 : 0600 0358           		dc.l SH2_S_Error
(1)  184/ 6000214 : 0600 0358           		dc.l SH2_S_Error
(1)  185/ 6000218 : 0600 0358           		dc.l SH2_S_Error
(1)  186/ 600021C : 0600 0358           		dc.l SH2_S_Error
(1)  187/ 6000220 : 0600 0358           		dc.l SH2_S_Error
(1)  188/ 6000224 : 0600 0358           		dc.l SH2_S_Error
(1)  189/ 6000228 : 0600 0278            		dc.l slave_irq			; Level 1 IRQ
(1)  190/ 600022C : 0600 0278           		dc.l slave_irq			; Level 2 & 3 IRQ
(1)  191/ 6000230 : 0600 0278           		dc.l slave_irq			; Level 4 & 5 IRQ
(1)  192/ 6000234 : 0600 0278           		dc.l slave_irq			; Level 6 & 7 IRQ: PWM interupt
(1)  193/ 6000238 : 0600 0278           		dc.l slave_irq			; Level 8 & 9 IRQ: Command interupt
(1)  194/ 600023C : 0600 0278           		dc.l slave_irq			; Level 10 & 11 IRQ: H Blank interupt
(1)  195/ 6000240 : 0600 0278           		dc.l slave_irq			; Level 12 & 13 IRQ: V Blank interupt
(1)  196/ 6000244 : 0600 0278           		dc.l slave_irq			; Level 14 & 15 IRQ: Reset Button
(1)  197/ 6000248 :                     	; ON-chip interrupts go here (vbr+$120)
(1)  198/ 6000248 : 0600 0278           		dc.l slave_irq			; Watchdog
(1)  199/ 600024C : 0600 0278           		dc.l slave_irq			; DMA
(1)  200/ 6000250 :                     
(1)  201/ 6000250 :                     ; ====================================================================
(1)  202/ 6000250 :                     ; ----------------------------------------------------------------
(1)  203/ 6000250 :                     ; IRQ
(1)  204/ 6000250 :                     ;
(1)  205/ 6000250 :                     ; r0-r1 are saved first.
(1)  206/ 6000250 :                     ; ----------------------------------------------------------------
(1)  207/ 6000250 :                     
(1)  208/ 6000250 :                     		align 4
(1)  209/ 6000250 :                     master_irq:
(1)  210/ 6000250 : 2F06                		mov.l	r0,@-r15
(1)  211/ 6000252 : 2F16                		mov.l	r1,@-r15
(1)  212/ 6000254 : 4F22                		sts.l	pr,@-r15
(1)  213/ 6000256 : 0002                		stc	sr,r0
(1)  214/ 6000258 : 4009                		shlr2	r0
(1)  215/ 600025A : C93C                		and	#$3C,r0
(1)  216/ 600025C : 6103                		mov	r0,r1
(1)  217/ 600025E : 9023                		mov	#$F0,r0
(1)  218/ 6000260 : 400E                		ldc	r0,sr
(1)  219/ 6000262 : D00F                		mov	#int_m_list,r0
(1)  220/ 6000264 : 301C                		add	r1,r0
(1)  221/ 6000266 : 6102                		mov	@r0,r1
(1)  222/ 6000268 : 410B                		jsr	@r1
(1)  223/ 600026A : 0009                		nop
(1)  224/ 600026C : 4F26                		lds.l	@r15+,pr
(1)  225/ 600026E : 61F6                		mov.l	@r15+,r1
(1)  226/ 6000270 : 60F6                		mov.l	@r15+,r0
(1)  227/ 6000272 : 002B                		rte
(1)  228/ 6000274 : 0009                		nop
(1)  229/ 6000276 :                     		align 4
(1)  230/ 6000278 :                     
(1)  231/ 6000278 :                     ; ====================================================================
(1)  232/ 6000278 :                     ; ----------------------------------------------------------------
(1)  233/ 6000278 :                     ; IRQ
(1)  234/ 6000278 :                     ;
(1)  235/ 6000278 :                     ; r0-r1 are saved first
(1)  236/ 6000278 :                     ; ----------------------------------------------------------------
(1)  237/ 6000278 :                     
(1)  238/ 6000278 :                     slave_irq:
(1)  239/ 6000278 : 2F06                		mov.l	r0,@-r15
(1)  240/ 600027A : 2F16                		mov.l	r1,@-r15
(1)  241/ 600027C : 4F22                		sts.l	pr,@-r15
(1)  242/ 600027E : 0002                		stc	sr,r0
(1)  243/ 6000280 : 4009                		shlr2	r0
(1)  244/ 6000282 : C93C                		and	#$3C,r0
(1)  245/ 6000284 : 6103                		mov	r0,r1
(1)  246/ 6000286 : 900F                		mov	#$F0,r0
(1)  247/ 6000288 : 400E                		ldc	r0,sr
(1)  248/ 600028A : D006                		mov	#int_s_list,r0
(1)  249/ 600028C : 301C                		add	r1,r0
(1)  250/ 600028E : 6102                		mov	@r0,r1
(1)  251/ 6000290 : 410B                		jsr	@r1
(1)  252/ 6000292 : 0009                		nop
(1)  253/ 6000294 : 4F26                		lds.l	@r15+,pr
(1)  254/ 6000296 : 61F6                		mov.l	@r15+,r1
(1)  255/ 6000298 : 60F6                		mov.l	@r15+,r0
(1)  256/ 600029A : 002B                		rte
(1)  257/ 600029C : 0009                		nop
(1)  258/ 600029E :                     		align 4
(1)  259/ 60002A0 : 0600 02AC 0600 02EC 		ltorg
                    00F0                
(1)  260/ 60002AA :                     
(1)  261/ 60002AA :                     ; ------------------------------------------------
(1)  262/ 60002AA :                     ; irq list
(1)  263/ 60002AA :                     ; ------------------------------------------------
(1)  264/ 60002AA :                     
(1)  265/ 60002AA :                     		align 4
(1)  266/ 60002AC :                     ;				Level
(1)  267/ 60002AC :                     int_m_list:
(1)  268/ 60002AC : 0600 038C           		dc.l m_irq_bad	; 0
(1)  269/ 60002B0 : 0600 038C           		dc.l m_irq_bad	; 1
(1)  270/ 60002B4 : 0600 038C           		dc.l m_irq_bad	; 2
(1)  271/ 60002B8 : C000 0000           		dc.l $C0000000	; 3 Watchdog (TOP code on Cache)
(1)  272/ 60002BC : 0600 038C           		dc.l m_irq_bad	; 4
(1)  273/ 60002C0 : 0600 03FC           		dc.l m_irq_dma	; 5 DMA
(1)  274/ 60002C4 : 0600 0390           		dc.l m_irq_pwm	; 6
(1)  275/ 60002C8 : 0600 0390           		dc.l m_irq_pwm	; 7
(1)  276/ 60002CC : 0600 03A8           		dc.l m_irq_cmd	; 8
(1)  277/ 60002D0 : 0600 03A8           		dc.l m_irq_cmd	; 9
(1)  278/ 60002D4 : 0600 0418           		dc.l m_irq_h	; A
(1)  279/ 60002D8 : 0600 0418           		dc.l m_irq_h	; B
(1)  280/ 60002DC : 0600 0430           		dc.l m_irq_v	; C
(1)  281/ 60002E0 : 0600 0430           		dc.l m_irq_v	; D
(1)  282/ 60002E4 : 0600 0440           		dc.l m_irq_vres	; E
(1)  283/ 60002E8 : 0600 0440           		dc.l m_irq_vres	; F
(1)  284/ 60002EC :                     int_s_list:
(1)  285/ 60002EC : 0600 04C0           		dc.l s_irq_bad	; 0
(1)  286/ 60002F0 : 0600 04C0           		dc.l s_irq_bad	; 1
(1)  287/ 60002F4 : 0600 04C0           		dc.l s_irq_bad	; 2
(1)  288/ 60002F8 : C000 0000           		dc.l $C0000000	; 3 Watchdog (TOP code on Cache)
(1)  289/ 60002FC : 0600 04C0           		dc.l s_irq_bad	; 4
(1)  290/ 6000300 : 0600 04C0           		dc.l s_irq_bad	; 5 DMA
(1)  291/ 6000304 : C000 0014           		dc.l s_irq_pwm	; 6
(1)  292/ 6000308 : C000 0014           		dc.l s_irq_pwm	; 7
(1)  293/ 600030C : 0600 04C4           		dc.l s_irq_cmd	; 8
(1)  294/ 6000310 : 0600 04C4           		dc.l s_irq_cmd	; 9
(1)  295/ 6000314 : 0600 0724           		dc.l s_irq_h	; A
(1)  296/ 6000318 : 0600 0724           		dc.l s_irq_h	; B
(1)  297/ 600031C : 0600 0740           		dc.l s_irq_v	; C
(1)  298/ 6000320 : 0600 0740           		dc.l s_irq_v	; D
(1)  299/ 6000324 : 0600 075C           		dc.l s_irq_vres	; E
(1)  300/ 6000328 : 0600 075C           		dc.l s_irq_vres	; F
(1)  301/ 600032C :                     
(1)  302/ 600032C :                     ; ====================================================================
(1)  303/ 600032C :                     ; ----------------------------------------------------------------
(1)  304/ 600032C :                     ; Error handler
(1)  305/ 600032C :                     ; ----------------------------------------------------------------
(1)  306/ 600032C :                     
(1)  307/ 600032C :                     ; *** Only works on HARDWARE ***
(1)  308/ 600032C :                     ;
(1)  309/ 600032C :                     ; comm2: (CPU)(CODE)
(1)  310/ 600032C :                     ; comm4: PC counter
(1)  311/ 600032C :                     ;
(1)  312/ 600032C :                     ;  CPU | The CPU who got the error:
(1)  313/ 600032C :                     ;        $00 - Master
(1)  314/ 600032C :                     ;        $01 - Slave
(1)  315/ 600032C :                     ;
(1)  316/ 600032C :                     ; CODE | Error type:
(1)  317/ 600032C :                     ;	  -1: Unknown error
(1)  318/ 600032C :                     ;	 $01: Illegal instruction
(1)  319/ 600032C :                     ;	 $02: Invalid slot instruction
(1)  320/ 600032C :                     ;	 $03: Address error
(1)  321/ 600032C :                     ;	 $04: DMA error
(1)  322/ 600032C :                     ;	 $05: NMI vector
(1)  323/ 600032C :                     ;	 $06: User break
(1)  324/ 600032C :                     
(1)  325/ 600032C :                     SH2_M_Error:
(1)  326/ 600032C : A00C                		bra	SH2_M_ErrCode
(1)  327/ 600032E : E000                		mov	#0,r0
(1)  328/ 6000330 :                     SH2_M_ErrIllg:
(1)  329/ 6000330 : A00A                		bra	SH2_M_ErrCode
(1)  330/ 6000332 : E001                		mov	#1,r0
(1)  331/ 6000334 :                     SH2_M_ErrInvl:
(1)  332/ 6000334 : A008                		bra	SH2_M_ErrCode
(1)  333/ 6000336 : E002                		mov	#2,r0
(1)  334/ 6000338 :                     SH2_M_ErrAddr:
(1)  335/ 6000338 : A006                		bra	SH2_M_ErrCode
(1)  336/ 600033A : E003                		mov	#3,r0
(1)  337/ 600033C :                     SH2_M_ErrDma:
(1)  338/ 600033C : A004                		bra	SH2_M_ErrCode
(1)  339/ 600033E : E004                		mov	#4,r0
(1)  340/ 6000340 :                     SH2_M_ErrNmi:
(1)  341/ 6000340 : A002                		bra	SH2_M_ErrCode
(1)  342/ 6000342 : E005                		mov	#5,r0
(1)  343/ 6000344 :                     SH2_M_ErrUser:
(1)  344/ 6000344 : A000                		bra	SH2_M_ErrCode
(1)  345/ 6000346 : E006                		mov	#6,r0
(1)  346/ 6000348 :                     ; r0 - value
(1)  347/ 6000348 :                     SH2_M_ErrCode:
(1)  348/ 6000348 : D10E                		mov	#_sysreg+comm2,r1
(1)  349/ 600034A : 2101                		mov.w	r0,@r1
(1)  350/ 600034C : D10E                		mov	#_sysreg+comm4,r1
(1)  351/ 600034E : 60F2                		mov	@r15,r0
(1)  352/ 6000350 : 2102                		mov	r0,@r1
(1)  353/ 6000352 : AFFE                		bra	*
(1)  354/ 6000354 : 0009                		nop
(1)  355/ 6000356 :                     		align 4
(1)  356/ 6000358 :                     
(1)  357/ 6000358 :                     ; ----------------------------------------------------
(1)  358/ 6000358 :                     
(1)  359/ 6000358 :                     SH2_S_Error:
(1)  360/ 6000358 : A00C                		bra	SH2_S_ErrCode
(1)  361/ 600035A : E000                		mov	#0,r0
(1)  362/ 600035C :                     SH2_S_ErrIllg:
(1)  363/ 600035C : A00A                		bra	SH2_S_ErrCode
(1)  364/ 600035E : E0FF                		mov	#-1,r0
(1)  365/ 6000360 :                     SH2_S_ErrInvl:
(1)  366/ 6000360 : A008                		bra	SH2_S_ErrCode
(1)  367/ 6000362 : E0FE                		mov	#-2,r0
(1)  368/ 6000364 :                     SH2_S_ErrAddr:
(1)  369/ 6000364 : A006                		bra	SH2_S_ErrCode
(1)  370/ 6000366 : E0FD                		mov	#-3,r0
(1)  371/ 6000368 :                     SH2_S_ErrDma:
(1)  372/ 6000368 : A004                		bra	SH2_S_ErrCode
(1)  373/ 600036A : E0FC                		mov	#-4,r0
(1)  374/ 600036C :                     SH2_S_ErrNmi:
(1)  375/ 600036C : A002                		bra	SH2_S_ErrCode
(1)  376/ 600036E : E0FB                		mov	#-5,r0
(1)  377/ 6000370 :                     SH2_S_ErrUser:
(1)  378/ 6000370 : A000                		bra	SH2_S_ErrCode
(1)  379/ 6000372 : E0FA                		mov	#-6,r0
(1)  380/ 6000374 :                     ; r0 - value
(1)  381/ 6000374 :                     SH2_S_ErrCode:
(1)  382/ 6000374 : D103                		mov	#_sysreg+comm2,r1
(1)  383/ 6000376 : 2101                		mov.w	r0,@r1
(1)  384/ 6000378 : D103                		mov	#_sysreg+comm4,r1
(1)  385/ 600037A : 60F2                		mov	@r15,r0
(1)  386/ 600037C : 2102                		mov	r0,@r1
(1)  387/ 600037E : AFFE                		bra	*
(1)  388/ 6000380 : 0009                		nop
(1)  389/ 6000382 :                     		align 4
(1)  390/ 6000384 : 2000 4022 2000 4024 		ltorg
(1)  391/ 600038C :                     
(1)  392/ 600038C :                     ; ====================================================================
(1)  393/ 600038C :                     ; ----------------------------------------------------------------
(1)  394/ 600038C :                     ; Interrupts
(1)  395/ 600038C :                     ; ----------------------------------------------------------------
(1)  396/ 600038C :                     
(1)  397/ 600038C :                     ; =================================================================
(1)  398/ 600038C :                     ; ------------------------------------------------
(1)  399/ 600038C :                     ; Master | Unused interrupt
(1)  400/ 600038C :                     ; ------------------------------------------------
(1)  401/ 600038C :                     
(1)  402/ 600038C :                     		align 4
(1)  403/ 600038C :                     m_irq_bad:
(1)  404/ 600038C : 000B                		rts
(1)  405/ 600038E : 0009                		nop
(1)  406/ 6000390 :                     		align 4
(1)  407/ 6000390 :                     
(1)  408/ 6000390 :                     ; =================================================================
(1)  409/ 6000390 :                     ; ------------------------------------------------
(1)  410/ 6000390 :                     ; Master | PWM Interrupt
(1)  411/ 6000390 :                     ; ------------------------------------------------
(1)  412/ 6000390 :                     
(1)  413/ 6000390 :                     m_irq_pwm:
(1)  414/ 6000390 : 9192                		mov	#_FRT,r1
(1)  415/ 6000392 : 8417                		mov.b	@(7,r1),r0
(1)  416/ 6000394 : CA02                		xor	#2,r0
(1)  417/ 6000396 : 8017                		mov.b	r0,@(7,r1)
(1)  418/ 6000398 : D13C                		mov	#_sysreg+pwmintclr,r1
(1)  419/ 600039A : 2101                		mov.w	r0,@r1
(1)  420/ 600039C : 0009                		nop
(1)  421/ 600039E : 0009                		nop
(1)  422/ 60003A0 : 0009                		nop
(1)  423/ 60003A2 : 0009                		nop
(1)  424/ 60003A4 : 000B                		rts
(1)  425/ 60003A6 : 0009                		nop
(1)  426/ 60003A8 :                     		align 4
(1)  427/ 60003A8 :                     
(1)  428/ 60003A8 :                     ; =================================================================
(1)  429/ 60003A8 :                     ; ------------------------------------------------
(1)  430/ 60003A8 :                     ; Master | CMD Interrupt
(1)  431/ 60003A8 :                     ; ------------------------------------------------
(1)  432/ 60003A8 :                     
(1)  433/ 60003A8 :                     	; *** HARDWARE NOTE ***
(1)  434/ 60003A8 :                     	; DMA takes a little to start properly:
(1)  435/ 60003A8 :                     	; after writing _DMAOPERATION = 1 put
(1)  436/ 60003A8 :                     	; 2 instructions (or 2 nops) in case
(1)  437/ 60003A8 :                     	; you need to manually check if the
(1)  438/ 60003A8 :                     	; DMA it's active.
(1)  439/ 60003A8 :                     	;
(1)  440/ 60003A8 :                     	; On Emulators it just starts right away.
(1)  441/ 60003A8 :                     m_irq_cmd:
(1)  442/ 60003A8 : 9186                		mov	#_FRT,r1
(1)  443/ 60003AA : 8417                		mov.b	@(7,r1),r0
(1)  444/ 60003AC : CA02                		xor	#2,r0
(1)  445/ 60003AE : 8017                		mov.b	r0,@(7,r1)
(1)  446/ 60003B0 : D137                		mov	#_sysreg+cmdintclr,r1	; Clear CMD flag
(1)  447/ 60003B2 : 2101                		mov.w	r0,@r1
(1)  448/ 60003B4 : 6011                		mov.w	@r1,r0
(1)  449/ 60003B6 : 2F26                		mov	r2,@-r15
(1)  450/ 60003B8 : 2F36                		mov	r3,@-r15
(1)  451/ 60003BA : 2F46                		mov	r4,@-r15
(1)  452/ 60003BC : D435                		mov	#_sysreg,r4		; r4 - sysreg base
(1)  453/ 60003BE : E380                		mov	#_DMASOURCE0,r3		; r3 - DMA base register
(1)  454/ 60003C0 : D235                		mov	#_sysreg+comm12,r2	; r2 - comm to write the signal
(1)  455/ 60003C2 : D136                		mov	#_sysreg+dreqfifo,r1	; r1 - Source point: DREQ FIFO
(1)  456/ 60003C4 : E000                		mov	#0,r0			; _DMAOPERATION = 0
(1)  457/ 60003C6 : 130C                		mov	r0,@($30,r3)
(1)  458/ 60003C8 : 9077                		mov	#%0100010011100000,r0	; Transfer mode + DMA enable bit OFF
(1)  459/ 60003CA : 1303                		mov	r0,@($C,r3)
(1)  460/ 60003CC : D034                		mov	#RAM_Mars_DreqDma,r0
(1)  461/ 60003CE : 1301                		mov	r0,@(4,r3)		; Destination
(1)  462/ 60003D0 : 8548                		mov.w	@(dreqlen,r4),r0	; TODO: needs a 0-size check.
(1)  463/ 60003D2 : 600D                		extu.w	r0,r0
(1)  464/ 60003D4 : 1302                		mov	r0,@(8,r3)		; Length (set by 68k)
(1)  465/ 60003D6 : 2312                		mov	r1,@r3			; Source
(1)  466/ 60003D8 : 9070                		mov	#%0100010011100101,r0	; Transfer mode + DMA enable bit ON + Enable interrupt
(1)  467/ 60003DA : 1303                		mov	r0,@($C,r3)		; Dest:Incr(01) Src:Keep(00) Size:Word(01)
(1)  468/ 60003DC : E001                		mov	#1,r0			; _DMAOPERATION = 1
(1)  469/ 60003DE : 130C                		mov	r0,@($30,r3)
(1)  470/ 60003E0 : 6020                		mov.b	@r2,r0			; Tell Genesis we can recieve DREQ data
(1)  471/ 60003E2 : CB40                		or	#%01000000,r0
(1)  472/ 60003E4 : 2200                		mov.b	r0,@r2
(1)  473/ 60003E6 :                     ; .wait_dma:	mov	@($C,r3),r0		; Still on DMA?
(1)  474/ 60003E6 :                     ; 		tst	#%10,r0
(1)  475/ 60003E6 :                     ; 		bt	.wait_dma
(1)  476/ 60003E6 :                     ; 		mov	#0,r0			; _DMAOPERATION = 0
(1)  477/ 60003E6 :                     ; 		mov	r0,@($30,r3)
(1)  478/ 60003E6 :                     ; 		mov	#%0100010011100000,r0	; Transfer mode + DMA enable = 0
(1)  479/ 60003E6 :                     ; 		mov	r0,@($C,r3)
(1)  480/ 60003E6 :                     ; .wait_dis:
(1)  481/ 60003E6 : 64F6                		mov	@r15+,r4
(1)  482/ 60003E8 : 63F6                		mov	@r15+,r3
(1)  483/ 60003EA : 62F6                		mov	@r15+,r2
(1)  484/ 60003EC : 0009                		nop
(1)  485/ 60003EE : 0009                		nop
(1)  486/ 60003F0 : 0009                		nop
(1)  487/ 60003F2 : 0009                		nop
(1)  488/ 60003F4 : 0009                		nop
(1)  489/ 60003F6 : 000B                		rts
(1)  490/ 60003F8 : 0009                		nop
(1)  491/ 60003FA :                     		align 4
(1)  492/ 60003FC :                     
(1)  493/ 60003FC :                     ; ------------------------------------------------
(1)  494/ 60003FC :                     ; Master | DMA Exit
(1)  495/ 60003FC :                     ; ------------------------------------------------
(1)  496/ 60003FC :                     
(1)  497/ 60003FC :                     		align 4
(1)  498/ 60003FC :                     m_irq_dma:
(1)  499/ 60003FC : 915C                		mov	#_FRT,r1
(1)  500/ 60003FE : 8417                		mov.b	@(7,r1),r0
(1)  501/ 6000400 : CA02                		xor	#2,r0
(1)  502/ 6000402 : 8017                		mov.b	r0,@(7,r1)
(1)  503/ 6000404 : E180                		mov	#_DMASOURCE0,r1
(1)  504/ 6000406 : 5013                .wait_dma:	mov	@($C,r1),r0		; Still on DMA?
(1)  505/ 6000408 : C802                		tst	#%10,r0
(1)  506/ 600040A : 89FC                		bt	.wait_dma
(1)  507/ 600040C : E000                		mov	#0,r0			; _DMAOPERATION = 0
(1)  508/ 600040E : 110C                		mov	r0,@($30,r1)
(1)  509/ 6000410 : 9053                		mov	#%0100010011100000,r0	; Transfer mode but DMA enable OFF
(1)  510/ 6000412 : 1103                		mov	r0,@($C,r1)
(1)  511/ 6000414 : 000B                		rts
(1)  512/ 6000416 : 0009                		nop
(1)  513/ 6000418 :                     		align 4
(1)  514/ 6000418 :                     
(1)  515/ 6000418 :                     ; =================================================================
(1)  516/ 6000418 :                     ; ------------------------------------------------
(1)  517/ 6000418 :                     ; Master | HBlank
(1)  518/ 6000418 :                     ; ------------------------------------------------
(1)  519/ 6000418 :                     
(1)  520/ 6000418 :                     m_irq_h:
(1)  521/ 6000418 : 914E                		mov	#_FRT,r1
(1)  522/ 600041A : 8417                		mov.b	@(7,r1),r0
(1)  523/ 600041C : CA02                		xor	#2,r0
(1)  524/ 600041E : 8017                		mov.b	r0,@(7,r1)
(1)  525/ 6000420 : D120                		mov	#_sysreg+hintclr,r1
(1)  526/ 6000422 : 2101                		mov.w	r0,@r1
(1)  527/ 6000424 : 0009                		nop
(1)  528/ 6000426 : 0009                		nop
(1)  529/ 6000428 : 0009                		nop
(1)  530/ 600042A : 0009                		nop
(1)  531/ 600042C : 000B                		rts
(1)  532/ 600042E : 0009                		nop
(1)  533/ 6000430 :                     		align 4
(1)  534/ 6000430 :                     
(1)  535/ 6000430 :                     ; =================================================================
(1)  536/ 6000430 :                     ; ------------------------------------------------
(1)  537/ 6000430 :                     ; Master | VBlank
(1)  538/ 6000430 :                     ; ------------------------------------------------
(1)  539/ 6000430 :                     
(1)  540/ 6000430 :                     m_irq_v:
(1)  541/ 6000430 : 9142                		mov	#_FRT,r1
(1)  542/ 6000432 : 8417                		mov.b	@(7,r1),r0
(1)  543/ 6000434 : CA02                		xor	#2,r0
(1)  544/ 6000436 : 8017                		mov.b	r0,@(7,r1)
(1)  545/ 6000438 : D11B                		mov	#_sysreg+vintclr,r1
(1)  546/ 600043A : 2101                		mov.w	r0,@r1
(1)  547/ 600043C :                     
(1)  548/ 600043C :                     ; 		mov	#_vdpreg,r1			; Check if we got here
(1)  549/ 600043C :                     ; -		mov.b	@(vdpsts,r1),r0			; too late.
(1)  550/ 600043C :                     ; 		tst	#VBLK,r0
(1)  551/ 600043C :                     ; 		bt	-
(1)  552/ 600043C :                     ; 		xor	r0,r0
(1)  553/ 600043C :                     ; 		mov.w	r0,@(marsGbl_FrameReady,gbr)
(1)  554/ 600043C :                     ; 		mov	r2,@-r15
(1)  555/ 600043C :                     ; 		mov	r3,@-r15
(1)  556/ 600043C :                     ; 		mov	r4,@-r15
(1)  557/ 600043C :                     ;  		mov.w	@(marsGbl_XShift,gbr),r0	; Set SHIFT bit first
(1)  558/ 600043C :                     ; 		mov	#_vdpreg+shift,r1		; For the indexed-scrolling mode.
(1)  559/ 600043C :                     ; 		and	#1,r0
(1)  560/ 600043C :                     ; 		mov.w	r0,@r1
(1)  561/ 600043C :                     ; 		mov	#RAM_Mars_DreqRead+Dreq_Palette,r1
(1)  562/ 600043C :                     ; 		mov	#_palette,r2
(1)  563/ 600043C :                     ;  		mov	#(256/8),r3
(1)  564/ 600043C :                     ; .copy_pal:
(1)  565/ 600043C :                     ; 	rept 4
(1)  566/ 600043C :                     ; 		mov	@r1+,r0				; Copy as LONGs, works on HW
(1)  567/ 600043C :                     ; 		mov	r0,@r2
(1)  568/ 600043C :                     ; 		add	#4,r2
(1)  569/ 600043C :                     ; 	endm
(1)  570/ 600043C :                     ; 		dt	r3
(1)  571/ 600043C :                     ; 		bf	.copy_pal
(1)  572/ 600043C :                     ; .not_ready:
(1)  573/ 600043C :                     ; 		mov	#_sysreg+comm12+1,r1		; Clear comm R bit
(1)  574/ 600043C :                     ; 		mov.b	@r1,r0				; this tells to 68k that the frame is ready.
(1)  575/ 600043C :                     ; 		and	#%10111111,r0
(1)  576/ 600043C :                     ; 		mov.b	r0,@r1
(1)  577/ 600043C :                     
(1)  578/ 600043C : 000B                		rts
(1)  579/ 600043E : 0009                		nop
(1)  580/ 6000440 :                     		align 4
(1)  581/ 6000440 :                     
(1)  582/ 6000440 :                     ; =================================================================
(1)  583/ 6000440 :                     ; ------------------------------------------------
(1)  584/ 6000440 :                     ; Master | VRES Interrupt (RESET button on Genesis)
(1)  585/ 6000440 :                     ; ------------------------------------------------
(1)  586/ 6000440 :                     
(1)  587/ 6000440 :                     m_irq_vres:
(1)  588/ 6000440 : D114                		mov	#_sysreg,r1
(1)  589/ 6000442 : 60F3                		mov	r15,r0
(1)  590/ 6000444 : 811A                		mov.w	r0,@(vresintclr,r1)
(1)  591/ 6000446 : E180                		mov	#_DMASOURCE0,r1
(1)  592/ 6000448 : E000                		mov	#0,r0
(1)  593/ 600044A : 110C                		mov	r0,@($30,r1)
(1)  594/ 600044C : 9035                		mov	#%0100010011100000,r0
(1)  595/ 600044E : 1103                		mov	r0,@($C,r1)
(1)  596/ 6000450 : E190                		mov	#_DMASOURCE1,r1
(1)  597/ 6000452 : E000                		mov	#0,r0
(1)  598/ 6000454 : 110C                		mov	r0,@($30,r1)
(1)  599/ 6000456 : 9030                		mov	#%0100010011100000,r0
(1)  600/ 6000458 : 1103                		mov	r0,@($C,r1)
(1)  601/ 600045A :                     
(1)  602/ 600045A : D10E                		mov	#_sysreg,r1
(1)  603/ 600045C : 8513                		mov.w	@(dreqctl,r1),r0
(1)  604/ 600045E : C801                		tst	#1,r0
(1)  605/ 6000460 : 8B0E                		bf	.rv_busy
(1)  606/ 6000462 : DF12                		mov	#(CS3|$40000)-8,r15
(1)  607/ 6000464 : D012                		mov	#SH2_M_HotStart,r0
(1)  608/ 6000466 : 2F02                		mov	r0,@r15
(1)  609/ 6000468 : 9029                		mov.w   #$F0,r0
(1)  610/ 600046A : 1F01                		mov	r0,@(4,r15)
(1)  611/ 600046C : D109                		mov	#_sysreg,r1
(1)  612/ 600046E : D011                		mov	#"M_OK",r0
(1)  613/ 6000470 : 1108                		mov	r0,@(comm0,r1)
(1)  614/ 6000472 : 0009                		nop
(1)  615/ 6000474 : 0009                		nop
(1)  616/ 6000476 : 0009                		nop
(1)  617/ 6000478 : 0009                		nop
(1)  618/ 600047A : 0009                		nop
(1)  619/ 600047C : 002B                		rte
(1)  620/ 600047E : 0009                		nop
(1)  621/ 6000480 :                     		align 4
(1)  622/ 6000480 :                     .rv_busy:
(1)  623/ 6000480 : 911A                		mov	#_FRT,r1
(1)  624/ 6000482 : 8417                		mov.b	@(7,r1),r0
(1)  625/ 6000484 : CA02                		xor	#2,r0
(1)  626/ 6000486 : 8017                		mov.b	r0,@(7,r1)
(1)  627/ 6000488 : AFFE                		bra	*
(1)  628/ 600048A : 0009                		nop
(1)  629/ 600048C :                     		align 4
(1)  630/ 600048C : 2000 401C 2000 401A 		ltorg		; Save literals
                    2000 4000 2000 402C 
                    2000 4012 2600 6890 
                    2000 4018 2000 4016 
                    0603 FFF8 0600 12BE 
                    4D5F 4F4B FE10 44E0 
                    44E5 00F0           
(1)  631/ 60004C0 :                     
(1)  632/ 60004C0 :                     ; =================================================================
(1)  633/ 60004C0 :                     ; ------------------------------------------------
(1)  634/ 60004C0 :                     ; Slave | Unused Interrupt
(1)  635/ 60004C0 :                     ; ------------------------------------------------
(1)  636/ 60004C0 :                     
(1)  637/ 60004C0 :                     		align 4
(1)  638/ 60004C0 :                     s_irq_bad:
(1)  639/ 60004C0 : 000B                		rts
(1)  640/ 60004C2 : 0009                		nop
(1)  641/ 60004C4 :                     		align 4
(1)  642/ 60004C4 :                     
(1)  643/ 60004C4 :                     ; =================================================================
(1)  644/ 60004C4 :                     ; ------------------------------------------------
(1)  645/ 60004C4 :                     ; Slave | PWM Interrupt
(1)  646/ 60004C4 :                     ; ------------------------------------------------
(1)  647/ 60004C4 :                     
(1)  648/ 60004C4 :                     ; check cache_slv.asm
(1)  649/ 60004C4 :                     ; s_irq_pwm:
(1)  650/ 60004C4 :                     
(1)  651/ 60004C4 :                     ; =================================================================
(1)  652/ 60004C4 :                     ; ------------------------------------------------
(1)  653/ 60004C4 :                     ; Slave | CMD Interrupt
(1)  654/ 60004C4 :                     ; ------------------------------------------------
(1)  655/ 60004C4 :                     
(1)  656/ 60004C4 :                     		align 4
(1)  657/ 60004C4 :                     s_irq_cmd:
(1)  658/ 60004C4 : D112                		mov	.tag_FRT,r1
(1)  659/ 60004C6 : 8417                		mov.b	@(7,r1),r0
(1)  660/ 60004C8 : CA02                		xor	#2,r0
(1)  661/ 60004CA : 8017                		mov.b	r0,@(7,r1)
(1)  662/ 60004CC : D186                		mov	#_sysreg+cmdintclr,r1	; Clear CMD flag
(1)  663/ 60004CE : 2101                		mov.w	r0,@r1
(1)  664/ 60004D0 : 6011                		mov.w	@r1,r0
(1)  665/ 60004D2 :                     
(1)  666/ 60004D2 :                     	; ---------------------------------
(1)  667/ 60004D2 : D186                		mov	#_sysreg+comm14,r1
(1)  668/ 60004D4 : 6010                		mov.b	@r1,r0			; MSB only
(1)  669/ 60004D6 : C90F                		and	#%00001111,r0
(1)  670/ 60004D8 : 2008                		tst	r0,r0
(1)  671/ 60004DA : 8915                		bt	.go_exit
(1)  672/ 60004DC : 2F26                		mov	r2,@-r15
(1)  673/ 60004DE : 2F36                		mov	r3,@-r15
(1)  674/ 60004E0 : 2F46                		mov	r4,@-r15
(1)  675/ 60004E2 : 2F56                		mov	r5,@-r15
(1)  676/ 60004E4 : 2F66                		mov	r6,@-r15
(1)  677/ 60004E6 : 2F76                		mov	r7,@-r15
(1)  678/ 60004E8 : 2F86                		mov	r8,@-r15
(1)  679/ 60004EA : 2F96                		mov	r9,@-r15
(1)  680/ 60004EC : 2FA6                		mov	r10,@-r15
(1)  681/ 60004EE : 2FB6                		mov	r11,@-r15
(1)  682/ 60004F0 : 2FC6                		mov	r12,@-r15
(1)  683/ 60004F2 : 2FD6                		mov	r13,@-r15
(1)  684/ 60004F4 : 2FE6                		mov	r14,@-r15
(1)  685/ 60004F6 : 4F12                		sts	macl,@-r15
(1)  686/ 60004F8 : 4F02                		sts	mach,@-r15
(1)  687/ 60004FA : 4F22                		sts	pr,@-r15
(1)  688/ 60004FC : 4008                		shll2	r0
(1)  689/ 60004FE : D17C                		mov	#.list,r1
(1)  690/ 6000500 : 310C                		add	r0,r1
(1)  691/ 6000502 : 6012                		mov	@r1,r0
(1)  692/ 6000504 : 402B                		jmp	@r0
(1)  693/ 6000506 : 0009                		nop
(1)  694/ 6000508 :                     		align 4
(1)  695/ 6000508 :                     .go_exit:
(1)  696/ 6000508 : A0E7                		bra	.no_cmdtask
(1)  697/ 600050A : 0009                		nop
(1)  698/ 600050C :                     		align 4
(1)  699/ 600050C : 0000 00F0           .tag_F0:	dc.l $F0
(1)  700/ 6000510 : FFFF FE10           .tag_FRT:	dc.l _FRT
(1)  701/ 6000514 :                     
(1)  702/ 6000514 :                     ; ---------------------------------
(1)  703/ 6000514 :                     
(1)  704/ 6000514 :                     .list:
(1)  705/ 6000514 : 0600 06BA           		dc.l .no_trnsfrex
(1)  706/ 6000518 : 0600 0578           		dc.l .mode_1		; PWM transfer from Z80
(1)  707/ 600051C : 0600 0554           		dc.l .mode_2		; PWM backup enter
(1)  708/ 6000520 : 0600 0568           		dc.l .mode_3		; PWM backup exit
(1)  709/ 6000524 : 0600 06BA           		dc.l .no_trnsfrex
(1)  710/ 6000528 : 0600 06BA           		dc.l .no_trnsfrex
(1)  711/ 600052C : 0600 06BA           		dc.l .no_trnsfrex
(1)  712/ 6000530 : 0600 06BA           		dc.l .no_trnsfrex
(1)  713/ 6000534 : 0600 06BA           		dc.l .no_trnsfrex
(1)  714/ 6000538 : 0600 06BA           		dc.l .no_trnsfrex
(1)  715/ 600053C : 0600 06BA           		dc.l .no_trnsfrex
(1)  716/ 6000540 : 0600 06BA           		dc.l .no_trnsfrex
(1)  717/ 6000544 : 0600 06BA           		dc.l .no_trnsfrex
(1)  718/ 6000548 : 0600 06BA           		dc.l .no_trnsfrex
(1)  719/ 600054C : 0600 06BA           		dc.l .no_trnsfrex
(1)  720/ 6000550 : 0600 06BA           		dc.l .no_trnsfrex
(1)  721/ 6000554 :                     
(1)  722/ 6000554 :                     ; ---------------------------------
(1)  723/ 6000554 :                     ; CMD Mode 2: PWM Backup enter
(1)  724/ 6000554 :                     ; ---------------------------------
(1)  725/ 6000554 :                     
(1)  726/ 6000554 :                     .mode_2:
(1)  727/ 6000554 : D067                		mov	#MarsSnd_Refill,r0
(1)  728/ 6000556 : 400B                		jsr	@r0
(1)  729/ 6000558 : 0009                		nop
(1)  730/ 600055A : D167                		mov	#MarsSnd_RvMode,r1	; Set backup-playback flag
(1)  731/ 600055C : E001                		mov	#1,r0
(1)  732/ 600055E : 2102                		mov	r0,@r1
(1)  733/ 6000560 : D162                		mov	#_sysreg+comm14,r1
(1)  734/ 6000562 : E000                		mov	#0,r0
(1)  735/ 6000564 : A0A9                		bra	.no_trnsfrex
(1)  736/ 6000566 : 2100                		mov.b	r0,@r1
(1)  737/ 6000568 :                     		align 4
(1)  738/ 6000568 :                     
(1)  739/ 6000568 :                     ; ---------------------------------
(1)  740/ 6000568 :                     ; CMD Mode 3: PWM Backup exit
(1)  741/ 6000568 :                     ; ---------------------------------
(1)  742/ 6000568 :                     
(1)  743/ 6000568 :                     .mode_3:
(1)  744/ 6000568 : D164                		mov	#MarsSnd_RvMode,r1	; Clear backup-playback flag
(1)  745/ 600056A : E000                		mov	#0,r0
(1)  746/ 600056C : 2102                		mov	r0,@r1
(1)  747/ 600056E : D15F                		mov	#_sysreg+comm14,r1
(1)  748/ 6000570 : E000                		mov	#0,r0
(1)  749/ 6000572 : A0A2                		bra	.no_trnsfrex
(1)  750/ 6000574 : 2100                		mov.b	r0,@r1
(1)  751/ 6000576 :                     		align 4
(1)  752/ 6000578 :                     
(1)  753/ 6000578 :                     ; ---------------------------------
(1)  754/ 6000578 :                     ; CMD Mode 1:
(1)  755/ 6000578 :                     ; Z80 transfer AND process
(1)  756/ 6000578 :                     ; new PWM's
(1)  757/ 6000578 :                     ; ---------------------------------
(1)  758/ 6000578 :                     
(1)  759/ 6000578 :                     .mode_1:
(1)  760/ 6000578 :                     	; First we recieve changes from Z80
(1)  761/ 6000578 :                     	; using comm8  for data
(1)  762/ 6000578 :                     	;  and  comm14 for busy/clock bits (bits 7,6)
(1)  763/ 6000578 :                     
(1)  764/ 6000578 : D161                		mov	#_sysreg+comm8,r1	; Input
(1)  765/ 600057A : D262                		mov	#MarsSnd_PwmControl,r2	; Output
(1)  766/ 600057C : D35B                		mov	#_sysreg+comm14,r3	; control comm
(1)  767/ 600057E : 0009                		nop
(1)  768/ 6000580 :                     .wait_1:
(1)  769/ 6000580 : 6030                		mov.b	@r3,r0
(1)  770/ 6000582 : C9F0                		and	#%11110000,r0
(1)  771/ 6000584 : C880                		tst	#%10000000,r0		; Chain exit?
(1)  772/ 6000586 : 8908                		bt	.exit_c
(1)  773/ 6000588 : C840                		tst	#%01000000,r0		; Wait PASS
(1)  774/ 600058A : 89F9                		bt	.wait_1
(1)  775/ 600058C :                     .copy_1:
(1)  776/ 600058C : 6012                		mov	@r1,r0
(1)  777/ 600058E : 2202                		mov	r0,@r2
(1)  778/ 6000590 : 7204                		add	#4,r2
(1)  779/ 6000592 : 6030                		mov.b	@r3,r0			; PASSed.
(1)  780/ 6000594 : C9BF                		and	#%10111111,r0
(1)  781/ 6000596 : AFF3                		bra	.wait_1
(1)  782/ 6000598 : 2300                		mov.b	r0,@r3
(1)  783/ 600059A :                     .exit_c:
(1)  784/ 600059A :                     
(1)  785/ 600059A :                     	; ***
(1)  786/ 600059A :                     	; Now update the PWM's
(1)  787/ 600059A : E100                		mov	#0,r1				; r1 - Current PWM slot
(1)  788/ 600059C : DE5A                		mov	#MarsSnd_PwmControl,r14
(1)  789/ 600059E : 9ABF                		mov	#MAX_PWMCHNL,r10
(1)  790/ 60005A0 :                     .next_chnl:
(1)  791/ 60005A0 : 60E0                		mov.b	@r14,r0
(1)  792/ 60005A2 : C9FF                		and	#$FF,r0
(1)  793/ 60005A4 : 8800                		cmp/eq	#0,r0
(1)  794/ 60005A6 : 890F                		bt	.no_req2
(1)  795/ 60005A8 : 2DDA                		xor	r13,r13
(1)  796/ 60005AA : 2ED0                		mov.b	r13,@r14
(1)  797/ 60005AC : 6703                		mov	r0,r7
(1)  798/ 60005AE : C907                		and	#%111,r0
(1)  799/ 60005B0 : 8801                		cmp/eq	#%001,r0
(1)  800/ 60005B2 : 8911                		bt	.no_keyoff
(1)  801/ 60005B4 : 8802                		cmp/eq	#%010,r0
(1)  802/ 60005B6 : 8903                		bt	.pwm_keyoff
(1)  803/ 60005B8 : 8804                		cmp/eq	#%100,r0
(1)  804/ 60005BA : 8907                		bt	.pwm_keycut
(1)  805/ 60005BC : A075                		bra	.no_req
(1)  806/ 60005BE : 0009                		nop
(1)  807/ 60005C0 :                     .pwm_keyoff:
(1)  808/ 60005C0 : E240                		mov	#$40,r2
(1)  809/ 60005C2 : D052                		mov	#MarsSound_SetVolume,r0
(1)  810/ 60005C4 : 400B                		jsr	@r0
(1)  811/ 60005C6 : 0009                		nop
(1)  812/ 60005C8 :                     .no_req2:
(1)  813/ 60005C8 : A06F                		bra	.no_req
(1)  814/ 60005CA : 0009                		nop
(1)  815/ 60005CC :                     .pwm_keycut:
(1)  816/ 60005CC : E200                		mov	#0,r2
(1)  817/ 60005CE : D050                		mov	#MarsSound_PwmEnable,r0
(1)  818/ 60005D0 : 400B                		jsr	@r0
(1)  819/ 60005D2 : 0009                		nop
(1)  820/ 60005D4 : A069                		bra	.no_req
(1)  821/ 60005D6 : 0009                		nop
(1)  822/ 60005D8 :                     		align 4
(1)  823/ 60005D8 :                     	; Normal playback
(1)  824/ 60005D8 :                     .no_keyoff:
(1)  825/ 60005D8 : 6073                		mov	r7,r0
(1)  826/ 60005DA : C810                		tst	#$10,r0
(1)  827/ 60005DC : 890E                		bt	.no_pitchbnd
(1)  828/ 60005DE : 6DE3                		mov	r14,r13
(1)  829/ 60005E0 : 7D08                		add	#8,r13		; skip COM
(1)  830/ 60005E2 : 60D0                		mov.b	@r13,r0		; r2 - Get pitch MSB bits
(1)  831/ 60005E4 : 7D08                		add	#8,r13
(1)  832/ 60005E6 : C903                		and	#%11,r0
(1)  833/ 60005E8 : 4018                		shll8	r0
(1)  834/ 60005EA : 6203                		mov	r0,r2
(1)  835/ 60005EC : 60D0                		mov.b	@r13,r0		; Pitch LSB
(1)  836/ 60005EE : 7D08                		add	#8,r13
(1)  837/ 60005F0 : C9FF                		and	#$FF,r0
(1)  838/ 60005F2 : 202B                		or	r2,r0
(1)  839/ 60005F4 : 6203                		mov	r0,r2
(1)  840/ 60005F6 : D047                		mov	#MarsSound_SetPwmPitch,r0
(1)  841/ 60005F8 : 400B                		jsr	@r0
(1)  842/ 60005FA : 0009                		nop
(1)  843/ 60005FC :                     .no_pitchbnd:
(1)  844/ 60005FC : 6073                		mov	r7,r0
(1)  845/ 60005FE : C820                		tst	#$20,r0
(1)  846/ 6000600 : 8908                		bt	.no_volumebnd
(1)  847/ 6000602 : 6703                		mov	r0,r7
(1)  848/ 6000604 : 6DE3                		mov	r14,r13
(1)  849/ 6000606 : 7D08                		add	#8,r13		; point to volume values
(1)  850/ 6000608 : 60D0                		mov.b	@r13,r0
(1)  851/ 600060A : C9FC                		and	#%11111100,r0	; skip MSB pitch bits
(1)  852/ 600060C : 6203                		mov	r0,r2
(1)  853/ 600060E : D042                		mov	#MarsSound_SetVolume,r0
(1)  854/ 6000610 : 400B                		jsr	@r0
(1)  855/ 6000612 : 0009                		nop
(1)  856/ 6000614 :                     .no_volumebnd:
(1)  857/ 6000614 : 6073                		mov	r7,r0
(1)  858/ 6000616 : C801                		tst	#$01,r0		; key-on?
(1)  859/ 6000618 : 8947                		bt	.no_req
(1)  860/ 600061A : 6DE3                		mov	r14,r13
(1)  861/ 600061C : 7D08                		add	#8,r13		; skip COM
(1)  862/ 600061E : 60D0                		mov.b	@r13,r0
(1)  863/ 6000620 : 7D08                		add	#8,r13
(1)  864/ 6000622 : 6503                		mov	r0,r5
(1)  865/ 6000624 : C9FC                		and	#%11111100,r0	; skip MSB pitch bits
(1)  866/ 6000626 : 6603                		mov	r0,r6		; r6 - Volume
(1)  867/ 6000628 : 6053                		mov	r5,r0		; r5 - Get pitch MSB bits
(1)  868/ 600062A : C903                		and	#%00000011,r0
(1)  869/ 600062C : 4018                		shll8	r0
(1)  870/ 600062E : 6503                		mov	r0,r5
(1)  871/ 6000630 : 60D0                		mov.b	@r13,r0		; Pitch LSB
(1)  872/ 6000632 : 7D08                		add	#8,r13
(1)  873/ 6000634 : C9FF                		and	#$FF,r0
(1)  874/ 6000636 : 205B                		or	r5,r0
(1)  875/ 6000638 : 6503                		mov	r0,r5
(1)  876/ 600063A : 60D0                		mov.b	@r13,r0		; flags | SH2 BANK
(1)  877/ 600063C : 7D08                		add	#8,r13
(1)  878/ 600063E : 6703                		mov	r0,r7		; r7 - Flags
(1)  879/ 6000640 : C90F                		and	#%1111,r0
(1)  880/ 6000642 : 6803                		mov	r0,r8		; r8 - SH2 section (ROM or SDRAM)
(1)  881/ 6000644 : 4828                		shll16	r8
(1)  882/ 6000646 : 4818                		shll8	r8
(1)  883/ 6000648 : 4709                		shlr2	r7
(1)  884/ 600064A : 4709                		shlr2	r7
(1)  885/ 600064C : 60D0                		mov.b	@r13,r0		; r2 - START point
(1)  886/ 600064E : 7D08                		add	#8,r13
(1)  887/ 6000650 : C9FF                		and	#$FF,r0
(1)  888/ 6000652 : 4028                		shll16	r0
(1)  889/ 6000654 : 6303                		mov	r0,r3
(1)  890/ 6000656 : 60D0                		mov.b	@r13,r0
(1)  891/ 6000658 : 7D08                		add	#8,r13
(1)  892/ 600065A : C9FF                		and	#$FF,r0
(1)  893/ 600065C : 4018                		shll8	r0
(1)  894/ 600065E : 6203                		mov	r0,r2
(1)  895/ 6000660 : 60D0                		mov.b	@r13,r0
(1)  896/ 6000662 : 7D08                		add	#8,r13
(1)  897/ 6000664 : C9FF                		and	#$FF,r0
(1)  898/ 6000666 : 203B                		or	r3,r0
(1)  899/ 6000668 : 202B                		or	r2,r0
(1)  900/ 600066A : 6203                		mov	r0,r2
(1)  901/ 600066C : 6423                		mov	r2,r4		; r4 - START copy
(1)  902/ 600066E : 228B                		or	r8,r2		; add CS2
(1)  903/ 6000670 : 6024                		mov.b	@r2+,r0		; r3 - Length
(1)  904/ 6000672 : C9FF                		and	#$FF,r0
(1)  905/ 6000674 : 6303                		mov	r0,r3
(1)  906/ 6000676 : 6024                		mov.b	@r2+,r0
(1)  907/ 6000678 : C9FF                		and	#$FF,r0
(1)  908/ 600067A : 4018                		shll8	r0
(1)  909/ 600067C : 230B                		or	r0,r3
(1)  910/ 600067E : 6024                		mov.b	@r2+,r0
(1)  911/ 6000680 : C9FF                		and	#$FF,r0
(1)  912/ 6000682 : 4028                		shll16	r0
(1)  913/ 6000684 : 230B                		or	r0,r3
(1)  914/ 6000686 : 334C                		add	r4,r3		; add end+start
(1)  915/ 6000688 : 238B                		or	r8,r3		; add CS2
(1)  916/ 600068A : 6024                		mov.b	@r2+,r0		; get loop point
(1)  917/ 600068C : C9FF                		and	#$FF,r0
(1)  918/ 600068E : 6403                		mov	r0,r4
(1)  919/ 6000690 : 6024                		mov.b	@r2+,r0
(1)  920/ 6000692 : C9FF                		and	#$FF,r0
(1)  921/ 6000694 : 4018                		shll8	r0
(1)  922/ 6000696 : 240B                		or	r0,r4
(1)  923/ 6000698 : 6024                		mov.b	@r2+,r0
(1)  924/ 600069A : C9FF                		and	#$FF,r0
(1)  925/ 600069C : 4028                		shll16	r0
(1)  926/ 600069E : 240B                		or	r0,r4
(1)  927/ 60006A0 : 903F                		mov	#%11111100,r0
(1)  928/ 60006A2 : 2809                		and	r0,r8
(1)  929/ 60006A4 : D01D                		mov	#MarsSound_SetPwm,r0
(1)  930/ 60006A6 : 400B                		jsr	@r0
(1)  931/ 60006A8 : 0009                		nop
(1)  932/ 60006AA :                     .no_req:
(1)  933/ 60006AA : 7101                		add	#1,r1		; next PWM slot
(1)  934/ 60006AC : 4A10                		dt	r10
(1)  935/ 60006AE : 8901                		bt	.end_chnls
(1)  936/ 60006B0 : AF76                		bra	.next_chnl
(1)  937/ 60006B2 : 7E01                		add	#1,r14		; next PWM entry
(1)  938/ 60006B4 :                     .end_chnls:
(1)  939/ 60006B4 : D10D                		mov	#_sysreg+comm14,r1
(1)  940/ 60006B6 : 200A                		xor	r0,r0
(1)  941/ 60006B8 : 2100                		mov.b	r0,@r1
(1)  942/ 60006BA :                     	; ---------------------------------
(1)  943/ 60006BA :                     	; *** END of PWM driver for GEMA
(1)  944/ 60006BA :                     	; ---------------------------------
(1)  945/ 60006BA :                     
(1)  946/ 60006BA :                     .no_trnsfrex:
(1)  947/ 60006BA : 4F26                		lds	@r15+,pr
(1)  948/ 60006BC : 4F06                		lds	@r15+,mach
(1)  949/ 60006BE : 4F16                		lds	@r15+,macl
(1)  950/ 60006C0 : 6EF6                		mov	@r15+,r14
(1)  951/ 60006C2 : 6DF6                		mov	@r15+,r13
(1)  952/ 60006C4 : 6CF6                		mov	@r15+,r12
(1)  953/ 60006C6 : 6BF6                		mov	@r15+,r11
(1)  954/ 60006C8 : 6AF6                		mov	@r15+,r10
(1)  955/ 60006CA : 69F6                		mov	@r15+,r9
(1)  956/ 60006CC : 68F6                		mov	@r15+,r8
(1)  957/ 60006CE : 67F6                		mov	@r15+,r7
(1)  958/ 60006D0 : 66F6                		mov	@r15+,r6
(1)  959/ 60006D2 : 65F6                		mov	@r15+,r5
(1)  960/ 60006D4 : 64F6                		mov	@r15+,r4
(1)  961/ 60006D6 : 63F6                		mov	@r15+,r3
(1)  962/ 60006D8 : 62F6                		mov	@r15+,r2
(1)  963/ 60006DA :                     .no_cmdtask:
(1)  964/ 60006DA : 0009                		nop
(1)  965/ 60006DC : 0009                		nop
(1)  966/ 60006DE : 0009                		nop
(1)  967/ 60006E0 : 0009                		nop
(1)  968/ 60006E2 : 0009                		nop
(1)  969/ 60006E4 : 000B                		rts
(1)  970/ 60006E6 : 0009                		nop
(1)  971/ 60006E8 :                     		align 4
(1)  972/ 60006E8 : 2000 401A 2000 402E 		ltorg
                    0600 0514 0600 1204 
                    C000 01BC C000 01BC 
                    2000 4028 C000 01C0 
                    C000 01C0 0600 11DC 
                    0600 11F4 0600 11C4 
                    0600 11DC 0600 1184 
                    0007 00FC           
(1)  973/ 6000724 :                     
(1)  974/ 6000724 :                     ; =================================================================
(1)  975/ 6000724 :                     ; ------------------------------------------------
(1)  976/ 6000724 :                     ; Slave | HBlank
(1)  977/ 6000724 :                     ; ------------------------------------------------
(1)  978/ 6000724 :                     
(1)  979/ 6000724 :                     s_irq_h:
(1)  980/ 6000724 : 914C                		mov	#_FRT,r1
(1)  981/ 6000726 : 8417                		mov.b	@(7,r1),r0
(1)  982/ 6000728 : CA02                		xor	#2,r0
(1)  983/ 600072A : 8017                		mov.b	r0,@(7,r1)
(1)  984/ 600072C : D11E                		mov	#_sysreg+hintclr,r1
(1)  985/ 600072E : 2101                		mov.w	r0,@r1
(1)  986/ 6000730 : 0009                		nop
(1)  987/ 6000732 : 0009                		nop
(1)  988/ 6000734 : 0009                		nop
(1)  989/ 6000736 : 0009                		nop
(1)  990/ 6000738 : 0009                		nop
(1)  991/ 600073A : 000B                		rts
(1)  992/ 600073C : 0009                		nop
(1)  993/ 600073E :                     		align 4
(1)  994/ 6000740 :                     
(1)  995/ 6000740 :                     ; =================================================================
(1)  996/ 6000740 :                     ; ------------------------------------------------
(1)  997/ 6000740 :                     ; Slave | VBlank
(1)  998/ 6000740 :                     ; ------------------------------------------------
(1)  999/ 6000740 :                     
(1) 1000/ 6000740 :                     s_irq_v:
(1) 1001/ 6000740 : 913E                		mov	#_FRT,r1
(1) 1002/ 6000742 : 8417                		mov.b	@(7,r1),r0
(1) 1003/ 6000744 : CA02                		xor	#2,r0
(1) 1004/ 6000746 : 8017                		mov.b	r0,@(7,r1)
(1) 1005/ 6000748 : D118                		mov	#_sysreg+vintclr,r1
(1) 1006/ 600074A : 2101                		mov.w	r0,@r1
(1) 1007/ 600074C : 0009                		nop
(1) 1008/ 600074E : 0009                		nop
(1) 1009/ 6000750 : 0009                		nop
(1) 1010/ 6000752 : 0009                		nop
(1) 1011/ 6000754 : 0009                		nop
(1) 1012/ 6000756 : 000B                		rts
(1) 1013/ 6000758 : 0009                		nop
(1) 1014/ 600075A :                     		align 4
(1) 1015/ 600075C :                     
(1) 1016/ 600075C :                     ; =================================================================
(1) 1017/ 600075C :                     ; ------------------------------------------------
(1) 1018/ 600075C :                     ; Slave | VRES Interrupt (RESET button on Genesis)
(1) 1019/ 600075C :                     ; ------------------------------------------------
(1) 1020/ 600075C :                     
(1) 1021/ 600075C :                     s_irq_vres:
(1) 1022/ 600075C : D114                		mov	#_sysreg,r1
(1) 1023/ 600075E : 60F3                		mov	r15,r0
(1) 1024/ 6000760 : 811A                		mov.w	r0,@(vresintclr,r1)
(1) 1025/ 6000762 : E180                		mov	#_DMASOURCE0,r1
(1) 1026/ 6000764 : E000                		mov	#0,r0
(1) 1027/ 6000766 : 110C                		mov	r0,@($30,r1)
(1) 1028/ 6000768 : 902B                		mov	#%0100010011100000,r0
(1) 1029/ 600076A : 1103                		mov	r0,@($C,r1)
(1) 1030/ 600076C : E190                		mov	#_DMASOURCE1,r1
(1) 1031/ 600076E : E000                		mov	#0,r0
(1) 1032/ 6000770 : 110C                		mov	r0,@($30,r1)
(1) 1033/ 6000772 : 9026                		mov	#%0100010011100000,r0
(1) 1034/ 6000774 : 1103                		mov	r0,@($C,r1)
(1) 1035/ 6000776 :                     
(1) 1036/ 6000776 : D10E                		mov	#_sysreg,r1
(1) 1037/ 6000778 : 8513                		mov.w	@(dreqctl,r1),r0
(1) 1038/ 600077A : C801                		tst	#1,r0
(1) 1039/ 600077C : 8B0E                		bf	.rv_busy
(1) 1040/ 600077E : DF0D                		mov	#(CS3|$3F000)-8,r15
(1) 1041/ 6000780 : D00D                		mov	#SH2_S_HotStart,r0
(1) 1042/ 6000782 : 2F02                		mov	r0,@r15
(1) 1043/ 6000784 : 901E                		mov.w   #$F0,r0
(1) 1044/ 6000786 : 1F01                		mov	r0,@(4,r15)
(1) 1045/ 6000788 : D109                		mov	#_sysreg,r1
(1) 1046/ 600078A : D00C                		mov	#"S_OK",r0
(1) 1047/ 600078C : 1109                		mov	r0,@(comm4,r1)
(1) 1048/ 600078E : 0009                		nop
(1) 1049/ 6000790 : 0009                		nop
(1) 1050/ 6000792 : 0009                		nop
(1) 1051/ 6000794 : 0009                		nop
(1) 1052/ 6000796 : 0009                		nop
(1) 1053/ 6000798 : 002B                		rte
(1) 1054/ 600079A : 0009                		nop
(1) 1055/ 600079C :                     		align 4
(1) 1056/ 600079C :                     .rv_busy:
(1) 1057/ 600079C : 9110                		mov	#_FRT,r1
(1) 1058/ 600079E : 8417                		mov.b	@(7,r1),r0
(1) 1059/ 60007A0 : CA02                		xor	#2,r0
(1) 1060/ 60007A2 : 8017                		mov.b	r0,@(7,r1)
(1) 1061/ 60007A4 : AFFE                		bra	*
(1) 1062/ 60007A6 : 0009                		nop
(1) 1063/ 60007A8 :                     		align 4
(1) 1064/ 60007A8 : 2000 4018 2000 4016 		ltorg		; Save literals
                    2000 4000 0603 EFF8 
                    0600 1838 535F 4F4B 
                    FE10 44E0 00F0      
(1) 1065/ 60007C6 :                     
(1) 1066/ 60007C6 :                     ; ; =================================================================
(1) 1067/ 60007C6 :                     ; ; ------------------------------------------------
(1) 1068/ 60007C6 :                     ; ; Master | Watchdog interrupt
(1) 1069/ 60007C6 :                     ; ; ------------------------------------------------
(1) 1070/ 60007C6 :                     ;
(1) 1071/ 60007C6 :                     ; ; m_irq_wdg:
(1) 1072/ 60007C6 :                     ; ; check cache_m_plgn.asm
(1) 1073/ 60007C6 :                     ;
(1) 1074/ 60007C6 :                     ; ; =================================================================
(1) 1075/ 60007C6 :                     ; ; ------------------------------------------------
(1) 1076/ 60007C6 :                     ; ; Slave | Watchdog interrupt
(1) 1077/ 60007C6 :                     ; ; ------------------------------------------------
(1) 1078/ 60007C6 :                     ;
(1) 1079/ 60007C6 :                     ; 		align 4
(1) 1080/ 60007C6 :                     ; s_irq_wdg:
(1) 1081/ 60007C6 :                     ; ; 		mov	#$F0,r0
(1) 1082/ 60007C6 :                     ; ; 		ldc	r0,sr
(1) 1083/ 60007C6 :                     ; 		mov	r2,@-r15
(1) 1084/ 60007C6 :                     ; 		mov	#_FRT,r1
(1) 1085/ 60007C6 :                     ; 		mov.b   @(7,r1),r0
(1) 1086/ 60007C6 :                     ; 		xor     #2,r0
(1) 1087/ 60007C6 :                     ; 		mov.b   r0,@(7,r1)
(1) 1088/ 60007C6 :                     ;
(1) 1089/ 60007C6 :                     ; 		mov	#$FFFFFE80,r1
(1) 1090/ 60007C6 :                     ; 		mov.w   #$A518,r0		; Watchdog OFF
(1) 1091/ 60007C6 :                     ; 		mov.w   r0,@r1
(1) 1092/ 60007C6 :                     ; 		or      #$20,r0			; ON again
(1) 1093/ 60007C6 :                     ; 		mov.w   r0,@r1
(1) 1094/ 60007C6 :                     ; 		mov	#$10,r2
(1) 1095/ 60007C6 :                     ; 		mov.w   #$5A00,r0		; Timer for the next one
(1) 1096/ 60007C6 :                     ; 		or	r2,r0
(1) 1097/ 60007C6 :                     ; 		mov.w	r0,@r1
(1) 1098/ 60007C6 :                     ;
(1) 1099/ 60007C6 :                     ; 		mov	@r15+,r2
(1) 1100/ 60007C6 :                     ; 		rts
(1) 1101/ 60007C6 :                     ; 		nop
(1) 1102/ 60007C6 :                     ; 		align 4
(1) 1103/ 60007C6 :                     ; 		ltorg
(1) 1104/ 60007C6 :                     
(1) 1105/ 60007C6 :                     ; ====================================================================
(1) 1106/ 60007C6 :                     ; ----------------------------------------------------------------
(1) 1107/ 60007C6 :                     ; Mars_ClearCacheRam
(1) 1108/ 60007C6 :                     ;
(1) 1109/ 60007C6 :                     ; Clear the entire "fast code" section for the current CPU
(1) 1110/ 60007C6 :                     ; ----------------------------------------------------------------
(1) 1111/ 60007C6 :                     
(1) 1112/ 60007C6 :                     		align 4
(1) 1113/ 60007C8 :                     Mars_ClearCacheRam:
(1) 1114/ 60007C8 : D111                		mov.l	#$C0000000+$800,r1
(1) 1115/ 60007CA : E000                		mov	#0,r0
(1) 1116/ 60007CC : 9224                		mov.w	#$80,r2
(1) 1117/ 60007CE :                     .loop:
(1) 1118/ 60007CE : 2106                		mov	r0,@-r1
(1) 1119/ 60007D0 : 2106                		mov	r0,@-r1
(1) 1120/ 60007D2 : 2106                		mov	r0,@-r1
(1) 1121/ 60007D4 : 2106                		mov	r0,@-r1
(1) 1122/ 60007D6 : 4210                		dt	r2
(1) 1123/ 60007D8 : 8BF9                		bf	.loop
(1) 1124/ 60007DA : 000B                		rts
(1) 1125/ 60007DC : 0009                		nop
(1) 1126/ 60007DE :                     		align 4
(1) 1127/ 60007E0 :                     
(1) 1128/ 60007E0 :                     ; ----------------------------------------------------------------
(1) 1129/ 60007E0 :                     ; Mars_LoadCacheRam
(1) 1130/ 60007E0 :                     ;
(1) 1131/ 60007E0 :                     ; Loads "fast code" into the SH2's cache, $800 bytes maximum.
(1) 1132/ 60007E0 :                     ;
(1) 1133/ 60007E0 :                     ; Input:
(1) 1134/ 60007E0 :                     ; r1 - CACHE Code to send
(1) 1135/ 60007E0 :                     ; r2 - Size/4
(1) 1136/ 60007E0 :                     ;
(1) 1137/ 60007E0 :                     ; Breaks:
(1) 1138/ 60007E0 :                     ; r3
(1) 1139/ 60007E0 :                     ; ----------------------------------------------------------------
(1) 1140/ 60007E0 :                     
(1) 1141/ 60007E0 :                     		align 4
(1) 1142/ 60007E0 :                     Mars_LoadCacheRam:
(1) 1143/ 60007E0 : 4F03                		stc	sr,@-r15	; Interrupts OFF
(1) 1144/ 60007E2 : 901A                		mov	#$F0,r0
(1) 1145/ 60007E4 : 400E                		ldc	r0,sr
(1) 1146/ 60007E6 : 9319                		mov	#_CCR,r3
(1) 1147/ 60007E8 : E010                		mov	#%00010000,r0	; Cache purge + Disable
(1) 1148/ 60007EA : 2301                		mov.w	r0,@r3
(1) 1149/ 60007EC : 0009                		nop
(1) 1150/ 60007EE : 0009                		nop
(1) 1151/ 60007F0 : 0009                		nop
(1) 1152/ 60007F2 : 0009                		nop
(1) 1153/ 60007F4 : 0009                		nop
(1) 1154/ 60007F6 : 0009                		nop
(1) 1155/ 60007F8 : 0009                		nop
(1) 1156/ 60007FA : 0009                		nop
(1) 1157/ 60007FC : E009                		mov	#%00001001,r0	; Cache two-way mode + Enable
(1) 1158/ 60007FE : 2301                		mov.w	r0,@r3
(1) 1159/ 6000800 : D304                		mov 	#$C0000000,r3
(1) 1160/ 6000802 :                     .copy:
(1) 1161/ 6000802 : 6016                		mov 	@r1+,r0
(1) 1162/ 6000804 : 2302                		mov 	r0,@r3
(1) 1163/ 6000806 : 4210                		dt	r2
(1) 1164/ 6000808 : 8FFB                		bf/s	.copy
(1) 1165/ 600080A : 7304                		add 	#4,r3
(1) 1166/ 600080C : 000B                		rts
(1) 1167/ 600080E : 4F07                		ldc	@r15+,sr
(1) 1168/ 6000810 :                     		align 4
(1) 1169/ 6000810 : C000 0800 C000 0000 		ltorg
                    0080 00F0 FE92      
(1) 1170/ 600081E :                     
(1) 1171/ 600081E :                     ; --------------------------------------------------------
(1) 1172/ 600081E :                     ; Mars_SetWatchdog
(1) 1173/ 600081E :                     ;
(1) 1174/ 600081E :                     ; Prepares watchdog interrupt
(1) 1175/ 600081E :                     ;
(1) 1176/ 600081E :                     ; Input:
(1) 1177/ 600081E :                     ; r1 - Watchdog CPU clock divider
(1) 1178/ 600081E :                     ; r2 - Watchdog Pre-timer
(1) 1179/ 600081E :                     ; --------------------------------------------------------
(1) 1180/ 600081E :                     
(1) 1181/ 600081E :                     		align 4
(1) 1182/ 6000820 :                     Mars_SetWatchdog:
(1) 1183/ 6000820 : 0402                		stc	sr,r4
(1) 1184/ 6000822 : 900F                		mov	#$F0,r0
(1) 1185/ 6000824 : 400E                		ldc 	r0,sr
(1) 1186/ 6000826 : 930E                		mov.l	#_CCR,r3		; Refresh Cache
(1) 1187/ 6000828 : E008                		mov	#%00001000,r0		; Two-way mode
(1) 1188/ 600082A : 2301                		mov.w	r0,@r3
(1) 1189/ 600082C : E019                		mov	#%00011001,r0		; Cache purge / Two-way mode / Cache ON
(1) 1190/ 600082E : 2301                		mov.w	r0,@r3
(1) 1191/ 6000830 : 930A                		mov.w	#$FE80,r3		; $FFFFFE80
(1) 1192/ 6000832 : 900A                		mov.w	#$5A00,r0		; Watchdog pre-timer
(1) 1193/ 6000834 : 202B                		or	r2,r0
(1) 1194/ 6000836 : 2301                		mov.w	r0,@r3
(1) 1195/ 6000838 : 9008                		mov.w	#$A538,r0		; Enable Watchdog
(1) 1196/ 600083A : 201B                		or	r1,r0
(1) 1197/ 600083C : 2301                		mov.w	r0,@r3
(1) 1198/ 600083E : 440E                		ldc	r4,sr
(1) 1199/ 6000840 : 000B                		rts
(1) 1200/ 6000842 : 0009                		nop
(1) 1201/ 6000844 :                     		align 4
(1) 1202/ 6000844 : 00F0 FE92 FE80 5A00 		ltorg
                    A538                
(1) 1203/ 600084E :                     
(1) 1204/ 600084E :                     ; ====================================================================
(1) 1205/ 600084E :                     ; ----------------------------------------------------------------
(1) 1206/ 600084E :                     ; MARS System features
(1) 1207/ 600084E :                     ; ----------------------------------------------------------------
(1) 1208/ 600084E :                     
(1) 1209/ 600084E :                     		include "system/mars/video.asm"
(2)    1/ 600084E :                     ; ====================================================================
(2)    2/ 600084E :                     ; ----------------------------------------------------------------
(2)    3/ 600084E :                     ; 32X Video
(2)    4/ 600084E :                     ;
(2)    5/ 600084E :                     ; Some routines are located on the cache folder for
(2)    6/ 600084E :                     ; speed reasons.
(2)    7/ 600084E :                     ; ----------------------------------------------------------------
(2)    8/ 600084E :                     
(2)    9/ 600084E :                     ; --------------------------------------------------------
(2)   10/ 600084E :                     ; Settings
(2)   11/ 600084E :                     ; --------------------------------------------------------
(2)   12/ 600084E :                     
(2)   13/ 600084E :                     ; SDRAM
(2)   14/ 600084E : =$2C000             MAX_SCRNBUFF	equ $2C000	; MAX SDRAM for each Screen mode
(2)   15/ 600084E : =$4                 MAX_SSPRSPD	equ 4		; Supersprite box increment: Size+this (maximum SuSprites speed)
(2)   16/ 600084E : =$3D4               MAX_FACES	equ 980		; MAX polygon faces for 3D models
(2)   17/ 600084E : =$434               MAX_SVDP_PZ	equ 980+96	; MAX polygon pieces to draw
(2)   18/ 600084E : =$FFFFFFFFFF..      MAX_ZDIST	equ -$1C00	; Maximum 3D field distance (-Z)
(2)   19/ 600084E :                     
(2)   20/ 600084E :                     ; FRAMEBUFFER
(2)   21/ 600084E : =$1F800             FBVRAM_BLANK	equ $1F800	; Location for the BLANK line
(2)   22/ 600084E : =$1D000             FBVRAM_PATCH	equ $1D000	; Framebuffer location for the affected XShift lines
(2)   23/ 600084E :                     
(2)   24/ 600084E :                     ; --------------------------------------------------------
(2)   25/ 600084E :                     ; Variables
(2)   26/ 600084E :                     ; --------------------------------------------------------
(2)   27/ 600084E :                     
(2)   28/ 600084E :                     ; Variables for 3D mode.
(2)   29/ 600084E : =$140               SCREEN_WIDTH	equ 320		; Screen width and height positions used
(2)   30/ 600084E : =$E0                SCREEN_HEIGHT	equ 224		; by 3D object rendering
(2)   31/ 600084E : =$80                PLGN_TEXURE	equ %10000000	; plypz_type (MSB)
(2)   32/ 600084E : =$40                PLGN_TRI	equ %01000000
(2)   33/ 600084E :                     
(2)   34/ 600084E :                     ; --------------------------------------------------------
(2)   35/ 600084E :                     ; Structs
(2)   36/ 600084E :                     ; --------------------------------------------------------
(2)   37/ 600084E :                     
(2)   38/ 600084E : (MACRO)             		struct 0
(2)   38/ 600084E : =$600084E           GLBL_LASTPC     set *
(2)   38/   49C2E :                                     dephase
(2)   38/   49C2E : =$49C2E             GLBL_LASTORG    set *
(2)   38/       0 :                                     phase 0
(2)   39/       0 :                     scrl_xpos_old	ds.l 1		; OLD Xpos position
(2)   40/       4 :                     scrl_ypos_old	ds.l 1		; OLD Ypos position
(2)   41/       8 :                     scrl_xset	ds.l 1		; Scroll X counter
(2)   42/       C :                     scrl_yset	ds.l 1		; Scroll Y counter
(2)   43/      10 :                     scrl_blksize	ds.l 1		; Block size for scrolling
(2)   44/      14 :                     scrl_intrl_size	ds.l 1		; Internal scroll FULL size (scrl_intrl_w*scrl_intrl_h)
(2)   45/      18 :                     scrl_intrl_w	ds.l 1		; Internal scroll Width (MUST be larger than 320)
(2)   46/      1C :                     scrl_intrl_h	ds.l 1		; Internal scroll Height
(2)   47/      20 :                     scrl_fbpos_y	ds.l 1		; Screen's Y position
(2)   48/      24 :                     scrl_fbpos	ds.l 1		; Screen's TOP-LEFT position
(2)   49/      28 :                     scrl_fbdata	ds.l 1		; Screen data location on framebuffer
(2)   50/      2C :                     scrl_xpos	ds.l 1		; $0000.0000
(2)   51/      30 :                     scrl_ypos	ds.l 1		; $0000.0000
(2)   52/      34 :                     sizeof_mscrl	ds.l 0
(2)   53/      36 : (MACRO)             		finish
(2)   53/       0 :                                     !org GLBL_LASTORG
(2)   53/ 600084E :                                     phase GLBL_LASTPC
(2)   54/ 600084E :                     
(2)   55/ 600084E : (MACRO)             		struct 0
(2)   55/ 600084E : =$600084E           GLBL_LASTPC     set *
(2)   55/   49C2E :                                     dephase
(2)   55/   49C2E : =$49C2E             GLBL_LASTORG    set *
(2)   55/       0 :                                     phase 0
(2)   56/       0 :                     plypz_type	ds.l 1		; Type + Material settings (width + index add)
(2)   57/       4 :                     plypz_mtrl	ds.l 1		; Material data (ROM or SDRAM)
(2)   58/       8 :                     plypz_ytb	ds.l 1		; Ytop | Ybottom
(2)   59/       C :                     plypz_xl	ds.l 1		;  Screen X-Left | X-Right  16-bit
(2)   60/      10 :                     plypz_src_xl	ds.l 1		; Texture X-Left | X-Right  16-bit
(2)   61/      14 :                     plypz_src_yl	ds.l 1		; Texture Y-Top  | Y-Bottom 16-bit
(2)   62/      18 :                     plypz_xl_dx	ds.l 1		; 0000.0000
(2)   63/      1C :                     plypz_xr_dx	ds.l 1		; 0000.0000
(2)   64/      20 :                     plypz_src_xl_dx	ds.l 1
(2)   65/      24 :                     plypz_src_xr_dx	ds.l 1
(2)   66/      28 :                     plypz_src_yl_dx	ds.l 1
(2)   67/      2C :                     plypz_src_yr_dx	ds.l 1
(2)   68/      30 :                     sizeof_plypz	ds.l 0
(2)   69/      32 : (MACRO)             		finish
(2)   69/       0 :                                     !org GLBL_LASTORG
(2)   69/ 600084E :                                     phase GLBL_LASTPC
(2)   70/ 600084E :                     
(2)   71/ 600084E :                     ; Polygon data
(2)   72/ 600084E :                     ; Size: $38
(2)   73/ 600084E : (MACRO)             		struct 0
(2)   73/ 600084E : =$600084E           GLBL_LASTPC     set *
(2)   73/   49C2E :                                     dephase
(2)   73/   49C2E : =$49C2E             GLBL_LASTORG    set *
(2)   73/       0 :                                     phase 0
(2)   74/       0 :                     polygn_type	ds.l 1		; %MSww wwww aaaa aaaa | %MS w-Texture width, a-Pixel increment
(2)   75/       4 :                     polygn_mtrl	ds.l 1		; Material Type: Color (0-255) or Texture data address
(2)   76/       8 :                     polygn_points	ds.l 4*2	; X/Y positions
(2)   77/      28 :                     polygn_srcpnts	ds.w 4*2	; X/Y texture points 16-bit, Ignored on solid color.
(2)   78/      38 :                     sizeof_polygn	ds.l 0
(2)   79/      3A : (MACRO)             		finish
(2)   79/       0 :                                     !org GLBL_LASTORG
(2)   79/ 600084E :                                     phase GLBL_LASTPC
(2)   80/ 600084E :                     
(2)   81/ 600084E :                     ; ====================================================================
(2)   82/ 600084E :                     ; ----------------------------------------------------------------
(2)   83/ 600084E :                     ; Init MARS Video
(2)   84/ 600084E :                     ;
(2)   85/ 600084E :                     ; Breaks:
(2)   86/ 600084E :                     ; r1-r4
(2)   87/ 600084E :                     ; ----------------------------------------------------------------
(2)   88/ 600084E :                     
(2)   89/ 600084E :                     		align 4
(2)   90/ 6000850 :                     MarsVideo_Init:
(2)   91/ 6000850 : 4F22                		sts	pr,@-r15
(2)   92/ 6000852 : D10F                		mov	#_sysreg,r1
(2)   93/ 6000854 : 9024                		mov 	#FM,r0			; Set SVDP permission to SH2.
(2)   94/ 6000856 : 8010                  		mov.b	r0,@(adapter,r1)	; * The Genesis side will still control the
(2)   95/ 6000858 : D10E                		mov 	#_vdpreg,r1		; 256-color palette using DREQ *
(2)   96/ 600085A : E000                		mov	#0,r0			; Start at BLANK
(2)   97/ 600085C : 8011                		mov.b	r0,@(bitmapmd,r1)
(2)   98/ 600085E : D20E                		mov	#_framebuffer,r2	; Make default nametables
(2)   99/ 6000860 : B006                		bsr	.def_fb
(2)  100/ 6000862 : 0009                		nop
(2)  101/ 6000864 : B004                		bsr	.def_fb
(2)  102/ 6000866 : 0009                		nop
(2)  103/ 6000868 : 4F26                		lds	@r15+,pr
(2)  104/ 600086A : 000B                		rts
(2)  105/ 600086C : 0009                		nop
(2)  106/ 600086E :                     		align 4
(2)  107/ 6000870 :                     .def_fb:
(2)  108/ 6000870 : 6323                		mov	r2,r3
(2)  109/ 6000872 : D00A                		mov	#FBVRAM_BLANK/2,r0	; The very last usable (blank) line.
(2)  110/ 6000874 : 9415                		mov	#240,r4
(2)  111/ 6000876 :                     .nxt_lne:
(2)  112/ 6000876 : 2301                		mov.w	r0,@r3
(2)  113/ 6000878 : 4410                		dt	r4
(2)  114/ 600087A : 8FFC                		bf/s	.nxt_lne
(2)  115/ 600087C : 7302                		add	#2,r3
(2)  116/ 600087E : 841B                		mov.b	@(framectl,r1),r0	; Frameswap request
(2)  117/ 6000880 : CA01                		xor	#1,r0
(2)  118/ 6000882 : 6303                		mov	r0,r3
(2)  119/ 6000884 : 801B                		mov.b	r0,@(framectl,r1)
(2)  120/ 6000886 : 841B                .wait_frm:	mov.b	@(framectl,r1),r0	; And wait until it flips
(2)  121/ 6000888 : 3300                		cmp/eq	r0,r3
(2)  122/ 600088A : 8BFC                		bf	.wait_frm
(2)  123/ 600088C : 000B                		rts
(2)  124/ 600088E : 0009                		nop
(2)  125/ 6000890 :                     		align 4
(2)  126/ 6000890 : 2000 4000 2000 4100 		ltorg
                    2400 0000 0000 FC00 
                    0080 00F0           
(2)  127/ 60008A4 :                     
(2)  128/ 60008A4 :                     ; ====================================================================
(2)  129/ 60008A4 :                     ; ----------------------------------------------------------------
(2)  130/ 60008A4 :                     ; Subroutines
(2)  131/ 60008A4 :                     ; ----------------------------------------------------------------
(2)  132/ 60008A4 :                     
(2)  133/ 60008A4 :                     ; --------------------------------------------------------
(2)  134/ 60008A4 :                     ; VideoMars_ClearScreen
(2)  135/ 60008A4 :                     ;
(2)  136/ 60008A4 :                     ; Clears screen using VDPFILL
(2)  137/ 60008A4 :                     ;
(2)  138/ 60008A4 :                     ; Input:
(2)  139/ 60008A4 :                     ; r1 | Framebuffer VRAM location
(2)  140/ 60008A4 :                     ; r2 | Width/2
(2)  141/ 60008A4 :                     ; r3 | Height
(2)  142/ 60008A4 :                     ; r4 | Pixel(s) to write
(2)  143/ 60008A4 :                     ;
(2)  144/ 60008A4 :                     ; Uses:
(2)  145/ 60008A4 :                     ; r5-r6
(2)  146/ 60008A4 :                     ; --------------------------------------------------------
(2)  147/ 60008A4 :                     
(2)  148/ 60008A4 :                     ; TODO: Fix this.
(2)  149/ 60008A4 :                     
(2)  150/ 60008A4 :                     		align 4
(2)  151/ 60008A4 :                     MarsVideo_ClearScreen:
(2)  152/ 60008A4 : 4101                		shlr	r1
(2)  153/ 60008A6 : 6513                		mov	r1,r5
(2)  154/ 60008A8 : D63E                		mov	#_vdpreg,r6
(2)  155/ 60008AA :                     .fb_loop:
(2)  156/ 60008AA : 6023                		mov	r2,r0
(2)  157/ 60008AC : 8162                		mov.w	r0,@(filllength,r6)
(2)  158/ 60008AE : 6013                		mov	r1,r0
(2)  159/ 60008B0 : 8163                		mov.w	r0,@(fillstart,r6)
(2)  160/ 60008B2 : 6043                		mov	r4,r0
(2)  161/ 60008B4 : 8164                		mov.w	r0,@(filldata,r6)
(2)  162/ 60008B6 : 8565                .wait_fb2:	mov.w	@(vdpsts,r6),r0
(2)  163/ 60008B8 : C802                		tst	#%10,r0
(2)  164/ 60008BA : 8BFC                		bf	.wait_fb2
(2)  165/ 60008BC : 4310                		dt	r3
(2)  166/ 60008BE : 8FF4                		bf/s	.fb_loop
(2)  167/ 60008C0 : 315C                		add	r5,r1
(2)  168/ 60008C2 :                     .no_redraw_2:
(2)  169/ 60008C2 : 000B                		rts
(2)  170/ 60008C4 : 0009                		nop
(2)  171/ 60008C6 :                     		align 4
(2)  172/ 60008C8 :                     
(2)  173/ 60008C8 :                     ; --------------------------------------------------------
(2)  174/ 60008C8 :                     ; MarsVideo_ResetNameTbl
(2)  175/ 60008C8 :                     ;
(2)  176/ 60008C8 :                     ; Reset the nametable, points all lines into a blank
(2)  177/ 60008C8 :                     ; line (FBVRAM_BLANK)
(2)  178/ 60008C8 :                     ;
(2)  179/ 60008C8 :                     ; Breaks:
(2)  180/ 60008C8 :                     ; r1-r2
(2)  181/ 60008C8 :                     ; --------------------------------------------------------
(2)  182/ 60008C8 :                     
(2)  183/ 60008C8 :                     MarsVideo_ResetNameTbl:
(2)  184/ 60008C8 : D137                		mov	#_framebuffer,r1
(2)  185/ 60008CA : D038                		mov	#FBVRAM_BLANK,r0
(2)  186/ 60008CC : 9272                		mov	#240,r2
(2)  187/ 60008CE :                     .nxt_lne2:
(2)  188/ 60008CE : 2101                		mov.w	r0,@r1
(2)  189/ 60008D0 : 4210                		dt	r2
(2)  190/ 60008D2 : 8FFC                		bf/s	.nxt_lne2
(2)  191/ 60008D4 : 7102                		add	#2,r1
(2)  192/ 60008D6 : 000B                		rts
(2)  193/ 60008D8 : 0009                		nop
(2)  194/ 60008DA :                     		align 4
(2)  195/ 60008DC :                     
(2)  196/ 60008DC :                     ; --------------------------------------------------------
(2)  197/ 60008DC :                     ; MarsVideo_MakeNameTbl
(2)  198/ 60008DC :                     ;
(2)  199/ 60008DC :                     ; Builds the nametable for a normal screen, if
(2)  200/ 60008DC :                     ; marsGbl_WaveEnable is set, it will add a
(2)  201/ 60008DC :                     ; wave effect to the linetable (in WORDS)
(2)  202/ 60008DC :                     ;
(2)  203/ 60008DC :                     ; Input:
(2)  204/ 60008DC :                     ; r1 | Framebuffer position
(2)  205/ 60008DC :                     ; r2 | Width (Width*2 for Direct color)
(2)  206/ 60008DC :                     ; r3 | Height
(2)  207/ 60008DC :                     ; r4 | Y line position
(2)  208/ 60008DC :                     ;
(2)  209/ 60008DC :                     ; Uses:
(2)  210/ 60008DC :                     ; r1-r11
(2)  211/ 60008DC :                     ; --------------------------------------------------------
(2)  212/ 60008DC :                     
(2)  213/ 60008DC :                     MarsVideo_MakeNameTbl:
(2)  214/ 60008DC : DA32                		mov	#_framebuffer,r10
(2)  215/ 60008DE : 4400                		shll	r4
(2)  216/ 60008E0 : 3A4C                		add	r4,r10
(2)  217/ 60008E2 : D530                		mov 	#_vdpreg,r5
(2)  218/ 60008E4 : 8451                		mov.b	@(bitmapmd,r5),r0
(2)  219/ 60008E6 : C903                		and	#%11,r0
(2)  220/ 60008E8 : 8803                		cmp/eq	#3,r0			; Don't mess with the RLE lines.
(2)  221/ 60008EA : 892C                		bt	.cant_use
(2)  222/ 60008EC : C512                		mov.w	@(marsGbl_WaveEnable,gbr),r0
(2)  223/ 60008EE : 2008                		tst	r0,r0
(2)  224/ 60008F0 : 8922                		bt	.linetbl_normal
(2)  225/ 60008F2 :                     
(2)  226/ 60008F2 :                     	; Special linetable with
(2)  227/ 60008F2 :                     	; wave deformation.
(2)  228/ 60008F2 : C513                		mov.w	@(marsGbl_WaveSpd,gbr),r0
(2)  229/ 60008F4 : 6403                		mov	r0,r4
(2)  230/ 60008F6 : C516                		mov.w	@(marsGbl_WaveTan,gbr),r0
(2)  231/ 60008F8 : 955D                		mov	#$7FF,r5
(2)  232/ 60008FA : 304C                		add	r4,r0			; wave speed
(2)  233/ 60008FC : 2059                		and	r5,r0
(2)  234/ 60008FE : C116                		mov.w	r0,@(marsGbl_WaveTan,gbr)
(2)  235/ 6000900 : 6703                		mov	r0,r7
(2)  236/ 6000902 : C514                		mov.w	@(marsGbl_WaveMax,gbr),r0
(2)  237/ 6000904 : 6503                		mov	r0,r5
(2)  238/ 6000906 : C515                		mov.w	@(marsGbl_WaveDeform,gbr),r0
(2)  239/ 6000908 : 6403                		mov	r0,r4
(2)  240/ 600090A : E600                		mov	#0,r6
(2)  241/ 600090C : 9B53                		mov	#$7FF,r11
(2)  242/ 600090E : DC28                		mov	#sin_table,r12
(2)  243/ 6000910 :                     .nxt_lne:
(2)  244/ 6000910 : 6073                		mov	r7,r0
(2)  245/ 6000912 : 374C                		add	r4,r7			; wave distord
(2)  246/ 6000914 : 27B9                		and	r11,r7
(2)  247/ 6000916 : 4008                		shll2	r0
(2)  248/ 6000918 : 09CE                		mov	@(r0,r12),r9
(2)  249/ 600091A : 395D                		dmuls	r5,r9
(2)  250/ 600091C : 091A                		sts	macl,r9
(2)  251/ 600091E : 4929                		shlr16	r9
(2)  252/ 6000920 : 699F                		exts.w	r9,r9
(2)  253/ 6000922 : 6013                		mov	r1,r0
(2)  254/ 6000924 : 306C                		add	r6,r0
(2)  255/ 6000926 : 309C                		add	r9,r0
(2)  256/ 6000928 : 4001                		shlr	r0
(2)  257/ 600092A : 2A01                		mov.w	r0,@r10
(2)  258/ 600092C : 362C                		add	r2,r6
(2)  259/ 600092E : 4310                		dt	r3
(2)  260/ 6000930 : 8FEE                		bf/s	.nxt_lne
(2)  261/ 6000932 : 7A02                		add	#2,r10
(2)  262/ 6000934 : 000B                		rts
(2)  263/ 6000936 : 0009                		nop
(2)  264/ 6000938 :                     		align 4
(2)  265/ 6000938 :                     
(2)  266/ 6000938 :                     .linetbl_normal:
(2)  267/ 6000938 : 4101                		shlr	r1
(2)  268/ 600093A : 4201                		shlr	r2
(2)  269/ 600093C :                     .nxt_lne2:
(2)  270/ 600093C : 2A11                		mov.w	r1,@r10
(2)  271/ 600093E : 312C                		add	r2,r1
(2)  272/ 6000940 : 4310                		dt	r3
(2)  273/ 6000942 : 8FFB                		bf/s	.nxt_lne2
(2)  274/ 6000944 : 7A02                		add	#2,r10
(2)  275/ 6000946 :                     .cant_use:
(2)  276/ 6000946 : 000B                		rts
(2)  277/ 6000948 : 0009                		nop
(2)  278/ 600094A :                     		align 4
(2)  279/ 600094C :                     
(2)  280/ 600094C :                     ; --------------------------------------------------------
(2)  281/ 600094C :                     ; MarsVideo_FixTblShift
(2)  282/ 600094C :                     ;
(2)  283/ 600094C :                     ; Fix the affected $xxFF lines
(2)  284/ 600094C :                     ;
(2)  285/ 600094C :                     ; Input:
(2)  286/ 600094C :                     ; r1 | Start line
(2)  287/ 600094C :                     ; r2 | Number of lines
(2)  288/ 600094C :                     ; r3 | Location for the fixed lines
(2)  289/ 600094C :                     ;
(2)  290/ 600094C :                     ; Break:
(2)  291/ 600094C :                     ; r7-r14
(2)  292/ 600094C :                     ; --------------------------------------------------------
(2)  293/ 600094C :                     
(2)  294/ 600094C :                     ; TODO: Check this later.
(2)  295/ 600094C :                     
(2)  296/ 600094C :                     MarsVideo_FixTblShift:
(2)  297/ 600094C : DE15                		mov	#_vdpreg,r14
(2)  298/ 600094E : 84E1                		mov.b	@(bitmapmd,r14),r0	; Check if we are on indexed mode
(2)  299/ 6000950 : C903                		and	#%11,r0
(2)  300/ 6000952 : 8801                		cmp/eq	#1,r0
(2)  301/ 6000954 : 8B23                		bf	.ptchset
(2)  302/ 6000956 : C510                		mov.w	@(marsGbl_XShift,gbr),r0	; XShift is set?
(2)  303/ 6000958 : C901                		and	#1,r0
(2)  304/ 600095A : 2008                		tst	r0,r0
(2)  305/ 600095C : 891F                		bt	.ptchset
(2)  306/ 600095E :                     
(2)  307/ 600095E : DE12                		mov	#_framebuffer,r14	; r14 - Framebuffer BASE
(2)  308/ 6000960 : 6CE3                		mov	r14,r12			; r12 - Framebuffer output for the patched pixel lines
(2)  309/ 6000962 : 3C3C                		add	r3,r12
(2)  310/ 6000964 : 6013                		mov	r1,r0
(2)  311/ 6000966 : 4008                		shll2	r0
(2)  312/ 6000968 : 3E0C                		add	r0,r14
(2)  313/ 600096A : 6DE3                		mov	r14,r13			; r13 - Framebuffer lines to check
(2)  314/ 600096C : 6B23                		mov	r2,r11			; r11 - Lines to check
(2)  315/ 600096E : E0FF                		mov	#-1,r0
(2)  316/ 6000970 : 6A0C                		extu.b	r0,r10			; r10 - AND byte to check ($FF)
(2)  317/ 6000972 : 690D                		extu.w	r0,r9			;  r9 - AND word limit ($FFFF)
(2)  318/ 6000974 :                     .loop:
(2)  319/ 6000974 : 60D1                		mov.w	@r13,r0
(2)  320/ 6000976 : 2099                		and	r9,r0
(2)  321/ 6000978 : 6703                		mov	r0,r7
(2)  322/ 600097A : 20A9                		and	r10,r0
(2)  323/ 600097C : 30A0                		cmp/eq	r10,r0
(2)  324/ 600097E : 8B0B                		bf	.tblexit
(2)  325/ 6000980 : 4700                		shll	r7
(2)  326/ 6000982 : 37EC                		add	r14,r7
(2)  327/ 6000984 : 60C3                		mov	r12,r0
(2)  328/ 6000986 : 4001                		shlr	r0
(2)  329/ 6000988 : 2D01                		mov.w	r0,@r13
(2)  330/ 600098A : 9315                		mov	#(320+4)/2,r3
(2)  331/ 600098C :                     .copy:
(2)  332/ 600098C : 6071                		mov.w	@r7,r0
(2)  333/ 600098E : 2C01                		mov.w	r0,@r12
(2)  334/ 6000990 : 7702                		add	#2,r7
(2)  335/ 6000992 : 4310                		dt	r3
(2)  336/ 6000994 : 8FFA                		bf/s	.copy
(2)  337/ 6000996 : 7C02                		add	#2,r12
(2)  338/ 6000998 :                     .tblexit:
(2)  339/ 6000998 : 4B10                		dt	r11
(2)  340/ 600099A : 8FEB                		bf/s	.loop
(2)  341/ 600099C : 7D02                		add	#2,r13
(2)  342/ 600099E :                     .ptchset:
(2)  343/ 600099E : 000B                		rts
(2)  344/ 60009A0 : 0009                		nop
(2)  345/ 60009A2 :                     		align 4
(2)  346/ 60009A4 : 2000 4100 2400 0000 		ltorg
                    0001 F800 0600 288C 
                    00F0 07FF 00A2      
(2)  347/ 60009BA :                     
(2)  348/ 60009BA :                     ; ====================================================================
(2)  349/ 60009BA :                     ; ----------------------------------------------------------------
(2)  350/ 60009BA :                     ; 2D Section
(2)  351/ 60009BA :                     ;
(2)  352/ 60009BA :                     ; Routines that write to the framebuffer are
(2)  353/ 60009BA :                     ; located at cache_m_2D.asm
(2)  354/ 60009BA :                     ; ----------------------------------------------------------------
(2)  355/ 60009BA :                     
(2)  356/ 60009BA :                     ; --------------------------------------------------------
(2)  357/ 60009BA :                     ; MarsVideo_MkScrlField
(2)  358/ 60009BA :                     ;
(2)  359/ 60009BA :                     ; This builds a new internal scrolling background
(2)  360/ 60009BA :                     ;
(2)  361/ 60009BA :                     ; Input:
(2)  362/ 60009BA :                     ; r1 | Background buffer to initialize
(2)  363/ 60009BA :                     ; r2 | Framebuffer VRAM position
(2)  364/ 60009BA :                     ; r3 | Scroll Width (320 or large)
(2)  365/ 60009BA :                     ; r4 | Scroll Height
(2)  366/ 60009BA :                     ; r5 | Scroll block size (4 pixels minimum)
(2)  367/ 60009BA :                     ; r6 | X start
(2)  368/ 60009BA :                     ; r7 | Y start
(2)  369/ 60009BA :                     ;
(2)  370/ 60009BA :                     ; NOTE:
(2)  371/ 60009BA :                     ; At the very last scrollable line: The next 320
(2)  372/ 60009BA :                     ; pixels will be visible until that line resets
(2)  373/ 60009BA :                     ; into 0 again.
(2)  374/ 60009BA :                     ; When you write pixels in in the range of 0-320,
(2)  375/ 60009BA :                     ; write the same pixels at the very end of
(2)  376/ 60009BA :                     ; the scrolling area (add width*height)
(2)  377/ 60009BA :                     ;
(2)  378/ 60009BA :                     ; Breaks:
(2)  379/ 60009BA :                     ; r3-r5,macl
(2)  380/ 60009BA :                     ; --------------------------------------------------------
(2)  381/ 60009BA :                     
(2)  382/ 60009BA :                     		align 4
(2)  383/ 60009BC :                     MarsVideo_MkScrlField:
(2)  384/ 60009BC : E034                		mov	#sizeof_mscrl,r0
(2)  385/ 60009BE : 210E                		mulu	r0,r1
(2)  386/ 60009C0 : 011A                		sts	macl,r1
(2)  387/ 60009C2 : D033                		mov	#RAM_Mars_ScrlBuff,r0
(2)  388/ 60009C4 : 310C                		add	r0,r1
(2)  389/ 60009C6 :                     
(2)  390/ 60009C6 : 1154                		mov	r5,@(scrl_blksize,r1)
(2)  391/ 60009C8 : 335C                		add	r5,r3	; add "block"
(2)  392/ 60009CA : 112A                		mov	r2,@(scrl_fbdata,r1)
(2)  393/ 60009CC : 345C                		add	r5,r4
(2)  394/ 60009CE : 1136                		mov	r3,@(scrl_intrl_w,r1)
(2)  395/ 60009D0 : 243E                		mulu	r3,r4
(2)  396/ 60009D2 : 1147                		mov	r4,@(scrl_intrl_h,r1)
(2)  397/ 60009D4 : 001A                		sts	macl,r0
(2)  398/ 60009D6 : 1105                		mov	r0,@(scrl_intrl_size,r1)
(2)  399/ 60009D8 : 200A                		xor	r0,r0
(2)  400/ 60009DA : 1100                		mov	r0,@(scrl_xpos_old,r1)
(2)  401/ 60009DC : 1101                		mov	r0,@(scrl_ypos_old,r1)
(2)  402/ 60009DE : 1109                		mov	r0,@(scrl_fbpos,r1)
(2)  403/ 60009E0 : 1108                		mov	r0,@(scrl_fbpos_y,r1)
(2)  404/ 60009E2 : 1102                		mov	r0,@(scrl_xset,r1)
(2)  405/ 60009E4 : 1103                		mov	r0,@(scrl_yset,r1)
(2)  406/ 60009E6 : 000B                		rts
(2)  407/ 60009E8 : 0009                		nop
(2)  408/ 60009EA :                     		align 4
(2)  409/ 60009EC :                     
(2)  410/ 60009EC :                     ; --------------------------------------------------------
(2)  411/ 60009EC :                     ; MarsVideo_ShowScrlBg
(2)  412/ 60009EC :                     ;
(2)  413/ 60009EC :                     ; Make a visible section of any scrolling area
(2)  414/ 60009EC :                     ; into the current framebuffer.
(2)  415/ 60009EC :                     ;
(2)  416/ 60009EC :                     ; Input:
(2)  417/ 60009EC :                     ; r1 | Background buffer
(2)  418/ 60009EC :                     ; r2 | Top Y
(2)  419/ 60009EC :                     ; r3 | Bottom Y
(2)  420/ 60009EC :                     ;
(2)  421/ 60009EC :                     ; Breaks:
(2)  422/ 60009EC :                     ; r4-r14
(2)  423/ 60009EC :                     ;
(2)  424/ 60009EC :                     ; NOTE:
(2)  425/ 60009EC :                     ; After finishing all your screens call
(2)  426/ 60009EC :                     ; MarsVideo_FixTblShift before doing frameswap
(2)  427/ 60009EC :                     ; --------------------------------------------------------
(2)  428/ 60009EC :                     
(2)  429/ 60009EC :                     		align 4
(2)  430/ 60009EC :                     MarsVideo_ShowScrlBg:
(2)  431/ 60009EC : DE29                		mov	#_framebuffer,r14		; r14 - Framebuffer BASE
(2)  432/ 60009EE : EB00                		mov	#0,r11				; r11 - line counter
(2)  433/ 60009F0 : 5D1A                		mov	@(scrl_fbdata,r1),r13		; r13 - Framebuffer pixeldata position
(2)  434/ 60009F2 : 6623                		mov	r2,r6
(2)  435/ 60009F4 : 5C15                		mov	@(scrl_intrl_size,r1),r12	; r12 - Full size of screen-scroll
(2)  436/ 60009F6 : 6023                		mov	r2,r0
(2)  437/ 60009F8 : 5A16                		mov	@(scrl_intrl_w,r1),r10		; r10 - Next line to add
(2)  438/ 60009FA : 4000                		shll	r0
(2)  439/ 60009FC : 5719                		mov	@(scrl_fbpos,r1),r7
(2)  440/ 60009FE : 3E0C                		add	r0,r14
(2)  441/ 6000A00 : 5018                		mov	@(scrl_fbpos_y,r1),r0
(2)  442/ 6000A02 : 20AE                		mulu	r10,r0
(2)  443/ 6000A04 : 001A                		sts	macl,r0
(2)  444/ 6000A06 : 370C                		add	r0,r7
(2)  445/ 6000A08 : C512                		mov.w	@(marsGbl_WaveEnable,gbr),r0
(2)  446/ 6000A0A : 2008                		tst	r0,r0
(2)  447/ 6000A0C : 8B12                		bf	.ln_wavy
(2)  448/ 6000A0E :                     .ln_loop:
(2)  449/ 6000A0E : 6873                		mov	r7,r8
(2)  450/ 6000A10 : 38C3                		cmp/ge	r12,r8
(2)  451/ 6000A12 : 8B00                		bf	.xl_r
(2)  452/ 6000A14 : 38C8                		sub	r12,r8
(2)  453/ 6000A16 :                     .xl_r:
(2)  454/ 6000A16 : 4811                		cmp/pz	r8
(2)  455/ 6000A18 : 8900                		bt	.xl_l
(2)  456/ 6000A1A : 38CC                		add	r12,r8
(2)  457/ 6000A1C :                     .xl_l:
(2)  458/ 6000A1C : 6783                		mov	r8,r7
(2)  459/ 6000A1E : 37AC                		add	r10,r7			; Add Y
(2)  460/ 6000A20 : 38DC                		add	r13,r8			; Add Framebuffer position
(2)  461/ 6000A22 : 4801                		shlr	r8			; Divide by 2, use Xshift for the missing bit
(2)  462/ 6000A24 : 2E81                		mov.w	r8,@r14			; Send to FB's table
(2)  463/ 6000A26 : 7E02                		add	#2,r14
(2)  464/ 6000A28 : 7B02                		add	#2,r11
(2)  465/ 6000A2A : 3630                		cmp/eq	r3,r6
(2)  466/ 6000A2C : 8FEF                		bf/s	.ln_loop
(2)  467/ 6000A2E : 7601                		add	#1,r6
(2)  468/ 6000A30 : 000B                		rts
(2)  469/ 6000A32 : 0009                		nop
(2)  470/ 6000A34 :                     		align 4
(2)  471/ 6000A34 :                     .ln_wavy:
(2)  472/ 6000A34 : C513                		mov.w	@(marsGbl_WaveSpd,gbr),r0
(2)  473/ 6000A36 : 6403                		mov	r0,r4
(2)  474/ 6000A38 : C516                		mov.w	@(marsGbl_WaveTan,gbr),r0
(2)  475/ 6000A3A : 952F                		mov	#$7FF,r5
(2)  476/ 6000A3C : 304C                		add	r4,r0			; wave speed
(2)  477/ 6000A3E : 2059                		and	r5,r0
(2)  478/ 6000A40 : C116                		mov.w	r0,@(marsGbl_WaveTan,gbr)
(2)  479/ 6000A42 : 6903                		mov	r0,r9
(2)  480/ 6000A44 : C514                		mov.w	@(marsGbl_WaveMax,gbr),r0
(2)  481/ 6000A46 : 6503                		mov	r0,r5
(2)  482/ 6000A48 : C515                		mov.w	@(marsGbl_WaveDeform,gbr),r0
(2)  483/ 6000A4A : 6403                		mov	r0,r4
(2)  484/ 6000A4C :                     .ln_loop_w:
(2)  485/ 6000A4C : 9826                		mov	#$7FF,r8
(2)  486/ 6000A4E : 6093                		mov	r9,r0
(2)  487/ 6000A50 : 394C                		add	r4,r9		; wave distord
(2)  488/ 6000A52 : 2989                		and	r8,r9
(2)  489/ 6000A54 : 4008                		shll2	r0
(2)  490/ 6000A56 : D810                		mov	#sin_table,r8
(2)  491/ 6000A58 : 008E                		mov	@(r0,r8),r0
(2)  492/ 6000A5A : 305D                		dmuls	r5,r0
(2)  493/ 6000A5C : 001A                		sts	macl,r0
(2)  494/ 6000A5E : 4029                		shlr16	r0
(2)  495/ 6000A60 : 600F                		exts.w	r0,r0
(2)  496/ 6000A62 : 6873                		mov	r7,r8
(2)  497/ 6000A64 : 38C3                		cmp/ge	r12,r8
(2)  498/ 6000A66 : 8B00                		bf	.wxl_r
(2)  499/ 6000A68 : 38C8                		sub	r12,r8
(2)  500/ 6000A6A :                     .wxl_r:
(2)  501/ 6000A6A : 4811                		cmp/pz	r8
(2)  502/ 6000A6C : 8900                		bt	.wxl_l
(2)  503/ 6000A6E : 38CC                		add	r12,r8
(2)  504/ 6000A70 :                     .wxl_l:
(2)  505/ 6000A70 : 6783                		mov	r8,r7
(2)  506/ 6000A72 : 37AC                		add	r10,r7		; Add Y
(2)  507/ 6000A74 : 38DC                		add	r13,r8		; Add Framebuffer position
(2)  508/ 6000A76 : 380C                		add	r0,r8
(2)  509/ 6000A78 : 4801                		shlr	r8		; divide by 2 (shift reg does the missing bit 0)
(2)  510/ 6000A7A : 2E81                		mov.w	r8,@r14		; send to FB's table
(2)  511/ 6000A7C : 7E02                		add	#2,r14
(2)  512/ 6000A7E : 7B02                		add	#2,r11
(2)  513/ 6000A80 : 3630                		cmp/eq	r3,r6
(2)  514/ 6000A82 : 8FE3                		bf/s	.ln_loop_w
(2)  515/ 6000A84 : 7601                		add	#1,r6
(2)  516/ 6000A86 : 000B                		rts
(2)  517/ 6000A88 : 0009                		nop
(2)  518/ 6000A8A :                     		align 4
(2)  519/ 6000A8C :                     .no_lines:
(2)  520/ 6000A8C : 000B                		rts
(2)  521/ 6000A8E : 0009                		nop
(2)  522/ 6000A90 :                     		align 4
(2)  523/ 6000A90 : 2600 7990 2400 0000 		ltorg
                    0600 288C 07FF      
(2)  524/ 6000A9E :                     
(2)  525/ 6000A9E :                     ; --------------------------------------------------------
(2)  526/ 6000A9E :                     ; MarsVideo_Bg_UpdPos
(2)  527/ 6000A9E :                     ;
(2)  528/ 6000A9E :                     ; Moves the scrolling area using X/Y values from
(2)  529/ 6000A9E :                     ; the Genesis side.
(2)  530/ 6000A9E :                     ;
(2)  531/ 6000A9E :                     ; Input:
(2)  532/ 6000A9E :                     ; r14 | Genesis background buffer
(2)  533/ 6000A9E :                     ; r13 | Scrolling-area buffer
(2)  534/ 6000A9E :                     ;
(2)  535/ 6000A9E :                     ; Breaks:
(2)  536/ 6000A9E :                     ; ALL
(2)  537/ 6000A9E :                     ; --------------------------------------------------------
(2)  538/ 6000A9E :                     
(2)  539/ 6000A9E :                     		align 4
(2)  540/ 6000AA0 :                     MarsVideo_Bg_UpdPos:
(2)  541/ 6000AA0 : E100                		mov	#0,r1
(2)  542/ 6000AA2 : E200                		mov	#0,r2
(2)  543/ 6000AA4 : 50DB                		mov	@(scrl_xpos,r13),r0		; 0000.0000
(2)  544/ 6000AA6 : 4029                		shlr16	r0				; **
(2)  545/ 6000AA8 : C110                		mov.w	r0,@(marsGbl_XShift,gbr)	; ** Grab missing bit for xshift
(2)  546/ 6000AAA : 600F                		exts.w	r0,r0
(2)  547/ 6000AAC : 6303                		mov	r0,r3
(2)  548/ 6000AAE : 50D0                		mov	@(scrl_xpos_old,r13),r0
(2)  549/ 6000AB0 : 3300                		cmp/eq	r0,r3
(2)  550/ 6000AB2 : 8901                		bt	.xequ
(2)  551/ 6000AB4 : 6133                		mov	r3,r1
(2)  552/ 6000AB6 : 3108                		sub	r0,r1
(2)  553/ 6000AB8 :                     .xequ:
(2)  554/ 6000AB8 : 6033                		mov	r3,r0
(2)  555/ 6000ABA : 1D00                		mov	r0,@(scrl_xpos_old,r13)
(2)  556/ 6000ABC : 50DC                		mov	@(scrl_ypos,r13),r0	; 0000.0000
(2)  557/ 6000ABE : 4029                		shlr16	r0
(2)  558/ 6000AC0 : 600F                		exts.w	r0,r0
(2)  559/ 6000AC2 : 6303                		mov	r0,r3
(2)  560/ 6000AC4 : 50D1                		mov	@(scrl_ypos_old,r13),r0
(2)  561/ 6000AC6 : 3300                		cmp/eq	r0,r3
(2)  562/ 6000AC8 : 8901                		bt	.yequ
(2)  563/ 6000ACA : 6233                		mov	r3,r2
(2)  564/ 6000ACC : 3208                		sub	r0,r2
(2)  565/ 6000ACE :                     .yequ:
(2)  566/ 6000ACE : 6033                		mov	r3,r0
(2)  567/ 6000AD0 : 1D01                		mov	r0,@(scrl_ypos_old,r13)
(2)  568/ 6000AD2 : 611F                		exts.w	r1,r1			; r1 - X increment
(2)  569/ 6000AD4 : 622F                		exts.w	r2,r2			; r2 - Y increment
(2)  570/ 6000AD6 :                     
(2)  571/ 6000AD6 :                     	; ---------------------------------------
(2)  572/ 6000AD6 :                     	; Increment Y pos (REAL)
(2)  573/ 6000AD6 :                     	; ---------------------------------------
(2)  574/ 6000AD6 :                     
(2)  575/ 6000AD6 : 54D8                		mov	@(scrl_fbpos_y,r13),r4
(2)  576/ 6000AD8 : 342C                		add	r2,r4
(2)  577/ 6000ADA : 53D7                		mov	@(scrl_intrl_h,r13),r3
(2)  578/ 6000ADC : 4215                		cmp/pl	r2
(2)  579/ 6000ADE : 8B02                		bf	.ypu_negtv
(2)  580/ 6000AE0 : 3433                		cmp/ge	r3,r4
(2)  581/ 6000AE2 : 8B00                		bf	.ypu_negtv
(2)  582/ 6000AE4 : 3438                		sub	r3,r4
(2)  583/ 6000AE6 :                     .ypu_negtv:
(2)  584/ 6000AE6 : 4211                		cmp/pz	r2
(2)  585/ 6000AE8 : 8902                		bt	.ypu_postv
(2)  586/ 6000AEA : 4411                		cmp/pz	r4
(2)  587/ 6000AEC : 8900                		bt	.ypu_postv
(2)  588/ 6000AEE : 343C                		add	r3,r4
(2)  589/ 6000AF0 :                     .ypu_postv:
(2)  590/ 6000AF0 : 1D48                		mov	r4,@(scrl_fbpos_y,r13)
(2)  591/ 6000AF2 :                     
(2)  592/ 6000AF2 :                     	; ---------------------------------------
(2)  593/ 6000AF2 :                     	; Update Framebuffer top-left position
(2)  594/ 6000AF2 :                     	; ---------------------------------------
(2)  595/ 6000AF2 :                     
(2)  596/ 6000AF2 : 53D5                		mov	@(scrl_intrl_size,r13),r3
(2)  597/ 6000AF4 : 50D9                		mov	@(scrl_fbpos,r13),r0
(2)  598/ 6000AF6 : 301C                		add	r1,r0
(2)  599/ 6000AF8 : 4115                		cmp/pl	r1
(2)  600/ 6000AFA : 8B02                		bf	.yx_negtv
(2)  601/ 6000AFC : 3033                		cmp/ge	r3,r0
(2)  602/ 6000AFE : 8B00                		bf	.yx_negtv
(2)  603/ 6000B00 : 3038                		sub	r3,r0
(2)  604/ 6000B02 :                     .yx_negtv:
(2)  605/ 6000B02 : 4111                		cmp/pz	r1
(2)  606/ 6000B04 : 8902                		bt	.yx_postv
(2)  607/ 6000B06 : 4011                		cmp/pz	r0
(2)  608/ 6000B08 : 8900                		bt	.yx_postv
(2)  609/ 6000B0A : 303C                		add	r3,r0
(2)  610/ 6000B0C :                     .yx_postv:
(2)  611/ 6000B0C : 1D09                		mov	r0,@(scrl_fbpos,r13)
(2)  612/ 6000B0E : 000B                		rts
(2)  613/ 6000B10 : 0009                		nop
(2)  614/ 6000B12 :                     		align 4
(2)  615/ 6000B14 :                     
(2)  616/ 6000B14 :                     ; --------------------------------------------------------
(2)  617/ 6000B14 :                     ; MarsVideo_Bg_MdReq
(2)  618/ 6000B14 :                     ;
(2)  619/ 6000B14 :                     ; Input:
(2)  620/ 6000B14 :                     ;  r1 | X increment
(2)  621/ 6000B14 :                     ;  r2 | Y increment
(2)  622/ 6000B14 :                     ; r14 | Genesis background buffer
(2)  623/ 6000B14 :                     ; r13 | Scrolling-area buffer
(2)  624/ 6000B14 :                     ;
(2)  625/ 6000B14 :                     ; Breaks:
(2)  626/ 6000B14 :                     ; ALL
(2)  627/ 6000B14 :                     ; --------------------------------------------------------
(2)  628/ 6000B14 :                     
(2)  629/ 6000B14 :                     		align 4
(2)  630/ 6000B14 :                     MarsVideo_Bg_DrawReq:
(2)  631/ 6000B14 :                     ; 		sts	pr,@-r15
(2)  632/ 6000B14 :                     
(2)  633/ 6000B14 :                     	; ---------------------------------------
(2)  634/ 6000B14 :                     	; Set block update timers
(2)  635/ 6000B14 :                     	; ---------------------------------------
(2)  636/ 6000B14 :                     
(2)  637/ 6000B14 :                     	; X timers
(2)  638/ 6000B14 : E702                		mov	#2,r7
(2)  639/ 6000B16 : D81E                		mov	#Cach_DrawTimers,r8
(2)  640/ 6000B18 : 6583                		mov	r8,r5
(2)  641/ 6000B1A : 56D4                		mov	@(scrl_blksize,r13),r6
(2)  642/ 6000B1C : 6463                		mov	r6,r4
(2)  643/ 6000B1E : 4410                		dt	r4
(2)  644/ 6000B20 : 666B                		neg	r6,r6
(2)  645/ 6000B22 : 53D2                		mov	@(scrl_xset,r13),r3
(2)  646/ 6000B24 : 331C                		add	r1,r3
(2)  647/ 6000B26 : 6033                		mov	r3,r0
(2)  648/ 6000B28 : 2069                		and	r6,r0
(2)  649/ 6000B2A : 2008                		tst	r0,r0
(2)  650/ 6000B2C : 8904                		bt	.x_k
(2)  651/ 6000B2E : 4111                		cmp/pz	r1
(2)  652/ 6000B30 : 8900                		bt	.x_r
(2)  653/ 6000B32 : 7504                		add	#4,r5
(2)  654/ 6000B34 :                     .x_r:
(2)  655/ 6000B34 : 2572                		mov	r7,@r5
(2)  656/ 6000B36 : 2349                		and	r4,r3
(2)  657/ 6000B38 :                     .x_k:
(2)  658/ 6000B38 : 1D32                		mov	r3,@(scrl_xset,r13)
(2)  659/ 6000B3A :                     	; Y timers
(2)  660/ 6000B3A : 7808                		add	#8,r8
(2)  661/ 6000B3C : 6583                		mov	r8,r5
(2)  662/ 6000B3E : 53D3                		mov	@(scrl_yset,r13),r3
(2)  663/ 6000B40 : 332C                		add	r2,r3
(2)  664/ 6000B42 : 6033                		mov	r3,r0
(2)  665/ 6000B44 : 2069                		and	r6,r0
(2)  666/ 6000B46 : 2008                		tst	r0,r0
(2)  667/ 6000B48 : 8904                		bt	.y_k
(2)  668/ 6000B4A : 4211                		cmp/pz	r2
(2)  669/ 6000B4C : 8900                		bt	.y_r
(2)  670/ 6000B4E : 7504                		add	#4,r5
(2)  671/ 6000B50 :                     .y_r:
(2)  672/ 6000B50 : 2572                		mov	r7,@r5
(2)  673/ 6000B52 : 2349                		and	r4,r3
(2)  674/ 6000B54 :                     .y_k:
(2)  675/ 6000B54 : 1D33                		mov	r3,@(scrl_yset,r13)
(2)  676/ 6000B56 :                     
(2)  677/ 6000B56 : 000B                		rts
(2)  678/ 6000B58 : 0009                		nop
(2)  679/ 6000B5A :                     		align 4
(2)  680/ 6000B5C :                     
(2)  681/ 6000B5C :                     
(2)  682/ 6000B5C :                     ; 		mov	#Cach_DrawTimers,r2
(2)  683/ 6000B5C :                     ; 		mov.b	@(md_bg_flags,r14),r0
(2)  684/ 6000B5C :                     ; 		extu.b	r0,r0
(2)  685/ 6000B5C :                     ; ; 		and	#$FF,r0
(2)  686/ 6000B5C :                     ; 		mov	r2,r1			; Set NEW screen timers ($02)
(2)  687/ 6000B5C :                     ; 		mov	#2,r3
(2)  688/ 6000B5C :                     ; 		tst	#%00000001,r0		; bitDrwR
(2)  689/ 6000B5C :                     ; 		bt	.no_r
(2)  690/ 6000B5C :                     ; 		mov	r3,@r1
(2)  691/ 6000B5C :                     ; .no_r:
(2)  692/ 6000B5C :                     ; 		add	#4,r1
(2)  693/ 6000B5C :                     ; 		tst	#%00000010,r0		; bitDrwL
(2)  694/ 6000B5C :                     ; 		bt	.no_l
(2)  695/ 6000B5C :                     ; 		mov	r3,@r1
(2)  696/ 6000B5C :                     ; .no_l:
(2)  697/ 6000B5C :                     ; 		add	#4,r1
(2)  698/ 6000B5C :                     ; 		tst	#%00000100,r0		; bitDrwD
(2)  699/ 6000B5C :                     ; 		bt	.no_d
(2)  700/ 6000B5C :                     ; 		mov	r3,@r1
(2)  701/ 6000B5C :                     ; .no_d:
(2)  702/ 6000B5C :                     ; 		add	#4,r1
(2)  703/ 6000B5C :                     ; 		tst	#%00001000,r0		; bitDrwU
(2)  704/ 6000B5C :                     ; 		bt	.no_upd
(2)  705/ 6000B5C :                     ; 		mov	r3,@r1
(2)  706/ 6000B5C :                     ; .no_upd:
(2)  707/ 6000B5C :                     ; 		nop
(2)  708/ 6000B5C :                     
(2)  709/ 6000B5C :                     	; mach - Watchdog settings
(2)  710/ 6000B5C :                     	;  r14 - Background buffer
(2)  711/ 6000B5C :                     	;  r13 - Scroll area buffer
(2)  712/ 6000B5C :                     	;  r12 - Layout data
(2)  713/ 6000B5C :                     	;  r11 - Framebuffer X/Y pos
(2)  714/ 6000B5C :                     	;  r10 - Layout width
(2)  715/ 6000B5C :                     	;   r9 - Scroll width (next line)
(2)  716/ 6000B5C :                     	;   r8 - Scroll FULL size (w*h)
(2)  717/ 6000B5C :                     	;   r7 - Framebuffer BASE
(2)  718/ 6000B5C :                     	;   r6 - Block data
(2)  719/ 6000B5C :                     	;   r5 - Block timer
(2)  720/ 6000B5C :                     	;   r4 - X or Y increment
(2)  721/ 6000B5C :                     	;   r3 - Layout increment
(2)  722/ 6000B5C :                     	;   r2 - Screen timers RLDU
(2)  723/ 6000B5C :                     
(2)  724/ 6000B5C :                     ; 		mov	@(md_bg_low,r14),r12
(2)  725/ 6000B5C :                     ; 		mov	#Cach_WdgBuffWr,r3
(2)  726/ 6000B5C :                     ; 		mov	@(scrl_fbpos,r13),r11
(2)  727/ 6000B5C :                     ; 		mov	#-16,r1				; <-- (-)manual block size
(2)  728/ 6000B5C :                     ; 		mov.w	@(md_bg_w,r14),r0
(2)  729/ 6000B5C :                     ; 		extu.w	r0,r10
(2)  730/ 6000B5C :                     ; 		mov	@(scrl_intrl_w,r13),r9
(2)  731/ 6000B5C :                     ; 		mov	#((224+16)/16),r5		; Timer for L/R
(2)  732/ 6000B5C :                     ; 		mov	@(scrl_intrl_size,r13),r8
(2)  733/ 6000B5C :                     ; 		mov	@(md_bg_blk,r14),r6
(2)  734/ 6000B5C :                     ; 		and	r1,r11
(2)  735/ 6000B5C :                     ; 		mov	@(scrl_fbpos_y,r13),r0
(2)  736/ 6000B5C :                     ; 		and	r1,r0
(2)  737/ 6000B5C :                     ; 		mov	@(scrl_fbdata,r13),r7
(2)  738/ 6000B5C :                     ; 		mulu	r0,r9
(2)  739/ 6000B5C :                     ; 		sts	macl,r0
(2)  740/ 6000B5C :                     ; 		add	r0,r11
(2)  741/ 6000B5C :                     ; 		lds	r3,mach
(2)  742/ 6000B5C :                     ;
(2)  743/ 6000B5C :                     ; 	; L/R columns
(2)  744/ 6000B5C :                     ; 		mov	r12,r13				; <-- copy layout
(2)  745/ 6000B5C :                     ; 		mov.w	@(md_bg_yinc_u,r14),r0		; Move top Y
(2)  746/ 6000B5C :                     ; 		exts.w	r0,r0
(2)  747/ 6000B5C :                     ; 		mov	#16,r1				; <-- manual block size
(2)  748/ 6000B5C :                     ; 		muls	r1,r0
(2)  749/ 6000B5C :                     ; 		sts	macl,r0
(2)  750/ 6000B5C :                     ; 		shlr8	r0
(2)  751/ 6000B5C :                     ; 		exts.w	r0,r0
(2)  752/ 6000B5C :                     ; 		muls	r10,r0
(2)  753/ 6000B5C :                     ; 		sts	macl,r0
(2)  754/ 6000B5C :                     ; 		add	r0,r12
(2)  755/ 6000B5C :                     ; 		mov.w	@(md_bg_xinc_r,r14),r0
(2)  756/ 6000B5C :                     ; 		mov	#320,r4				; r4 - X increment
(2)  757/ 6000B5C :                     ; 		bsr	.x_draw
(2)  758/ 6000B5C :                     ; 		exts.w	r0,r3
(2)  759/ 6000B5C :                     ; 		mov.w	@(md_bg_xinc_l,r14),r0
(2)  760/ 6000B5C :                     ; 		exts.w	r0,r3
(2)  761/ 6000B5C :                     ; 		mov	#0,r4
(2)  762/ 6000B5C :                     ; 		bsr	.x_draw
(2)  763/ 6000B5C :                     ; 		add	#4,r2
(2)  764/ 6000B5C :                     ;
(2)  765/ 6000B5C :                     ; 	; U/D rows
(2)  766/ 6000B5C :                     ; 		mov	#((320+16)/16),r5		; Timer for U/D
(2)  767/ 6000B5C :                     ; 		mov	r13,r12
(2)  768/ 6000B5C :                     ; 		add	#4,r2				; Now check D/U timers
(2)  769/ 6000B5C :                     ; 		sts	mach,r0
(2)  770/ 6000B5C :                     ; 		add	#$20,r0
(2)  771/ 6000B5C :                     ; 		lds	r0,mach
(2)  772/ 6000B5C :                     ; 		mov.w	@(md_bg_xinc_l,r14),r0		; Move left
(2)  773/ 6000B5C :                     ; 		exts.w	r0,r0
(2)  774/ 6000B5C :                     ; 		mov	#16,r1				; <-- manual block size
(2)  775/ 6000B5C :                     ; 		muls	r1,r0
(2)  776/ 6000B5C :                     ; 		sts	macl,r0
(2)  777/ 6000B5C :                     ; 		shlr8	r0
(2)  778/ 6000B5C :                     ; 		exts.w	r0,r0
(2)  779/ 6000B5C :                     ; 		add	r0,r12
(2)  780/ 6000B5C :                     ; 		mov.w	@(md_bg_yinc_d,r14),r0
(2)  781/ 6000B5C :                     ; 		mov	#224,r4
(2)  782/ 6000B5C :                     ; 		bsr	.y_draw
(2)  783/ 6000B5C :                     ; 		exts.w	r0,r3
(2)  784/ 6000B5C :                     ; 		mov.w	@(md_bg_yinc_u,r14),r0
(2)  785/ 6000B5C :                     ; 		extu.w	r0,r3
(2)  786/ 6000B5C :                     ; 		mov	#0,r4
(2)  787/ 6000B5C :                     ; 		bsr	.y_draw
(2)  788/ 6000B5C :                     ; 		add	#4,r2
(2)  789/ 6000B5C :                     ;
(2)  790/ 6000B5C :                     ; 		lds	@r15+,pr
(2)  791/ 6000B5C :                     ; 		rts
(2)  792/ 6000B5C :                     ; 		nop
(2)  793/ 6000B5C :                     ; 		align 4
(2)  794/ 6000B5C :                     
(2)  795/ 6000B5C :                     ; ----------------------------------------
(2)  796/ 6000B5C :                     
(2)  797/ 6000B5C :                     ; ; r3 - layout X increment
(2)  798/ 6000B5C :                     ; ; r4 - framebuffer X increment
(2)  799/ 6000B5C :                     ; ; mach - Cach_WdgBuffWr
(2)  800/ 6000B5C :                     ;
(2)  801/ 6000B5C :                     ; .x_draw:
(2)  802/ 6000B5C :                     ; 		mov	@r2,r0
(2)  803/ 6000B5C :                     ; 		tst	r0,r0
(2)  804/ 6000B5C :                     ; 		bt	.no_timer
(2)  805/ 6000B5C :                     ; 		dt	r0
(2)  806/ 6000B5C :                     ; 		mov	r0,@r2
(2)  807/ 6000B5C :                     ;
(2)  808/ 6000B5C :                     ; 		mov	#16,r1		; <-- manual block size
(2)  809/ 6000B5C :                     ; 		muls	r1,r3		; r3 - layout increment
(2)  810/ 6000B5C :                     ; 		sts	macl,r3
(2)  811/ 6000B5C :                     ; 		shlr8	r3
(2)  812/ 6000B5C :                     ; 		mov	r11,r1
(2)  813/ 6000B5C :                     ; 		add	r4,r1
(2)  814/ 6000B5C :                     ; 		cmp/ge	r8,r1
(2)  815/ 6000B5C :                     ; 		bf	.sz_safe
(2)  816/ 6000B5C :                     ; 		sub	r8,r1
(2)  817/ 6000B5C :                     ; .sz_safe:
(2)  818/ 6000B5C :                     ; 		sts	mach,r0
(2)  819/ 6000B5C :                     ; 		mov	r5,@-r0
(2)  820/ 6000B5C :                     ; 		mov	r6,@-r0
(2)  821/ 6000B5C :                     ; 		mov	r7,@-r0
(2)  822/ 6000B5C :                     ; 		mov	r8,@-r0
(2)  823/ 6000B5C :                     ; 		mov	r9,@-r0
(2)  824/ 6000B5C :                     ; 		mov	r10,@-r0
(2)  825/ 6000B5C :                     ; 		mov	 r1,@-r0	; <-- copy of r11
(2)  826/ 6000B5C :                     ; 		mov	r12,r1		; <-- layout + X pos
(2)  827/ 6000B5C :                     ; 		add	 r3,r1
(2)  828/ 6000B5C :                     ; 		mov	 r1,@-r0
(2)  829/ 6000B5C :                     ; .no_timer:
(2)  830/ 6000B5C :                     ; 		rts
(2)  831/ 6000B5C :                     ; 		nop
(2)  832/ 6000B5C :                     ; 		align 4
(2)  833/ 6000B5C :                     ;
(2)  834/ 6000B5C :                     ; ; ----------------------------------------
(2)  835/ 6000B5C :                     ;
(2)  836/ 6000B5C :                     ; ; r3 - layout Y increment
(2)  837/ 6000B5C :                     ; ; r4 - framebuffer Y increment
(2)  838/ 6000B5C :                     ; ; mach - Cach_WdgBuffWr_UD
(2)  839/ 6000B5C :                     ;
(2)  840/ 6000B5C :                     ; .y_draw:
(2)  841/ 6000B5C :                     ; 		mov	@r2,r0
(2)  842/ 6000B5C :                     ; 		tst	r0,r0
(2)  843/ 6000B5C :                     ; 		bt	.no_timer
(2)  844/ 6000B5C :                     ; 		dt	r0
(2)  845/ 6000B5C :                     ; 		mov	r0,@r2
(2)  846/ 6000B5C :                     ;
(2)  847/ 6000B5C :                     ; 		mov	#16,r1		; <-- manual block size
(2)  848/ 6000B5C :                     ; 		muls	r1,r3		; r3 - layout increment
(2)  849/ 6000B5C :                     ; 		sts	macl,r3
(2)  850/ 6000B5C :                     ; 		shlr8	r3
(2)  851/ 6000B5C :                     ; 		mulu	r10,r3
(2)  852/ 6000B5C :                     ; 		sts	macl,r3
(2)  853/ 6000B5C :                     ;
(2)  854/ 6000B5C :                     ; 		mov	r11,r1
(2)  855/ 6000B5C :                     ; 		mulu	r9,r4
(2)  856/ 6000B5C :                     ; 		sts	macl,r0
(2)  857/ 6000B5C :                     ; 		add	r0,r1
(2)  858/ 6000B5C :                     ; 		cmp/ge	r8,r1
(2)  859/ 6000B5C :                     ; 		bf	.sz_safey
(2)  860/ 6000B5C :                     ; 		sub	r8,r1
(2)  861/ 6000B5C :                     ; .sz_safey:
(2)  862/ 6000B5C :                     ; 		sts	mach,r0
(2)  863/ 6000B5C :                     ; 		mov	r5,@-r0
(2)  864/ 6000B5C :                     ; 		mov	r6,@-r0
(2)  865/ 6000B5C :                     ; 		mov	r7,@-r0
(2)  866/ 6000B5C :                     ; 		mov	r8,@-r0
(2)  867/ 6000B5C :                     ; 		mov	r9,@-r0
(2)  868/ 6000B5C :                     ; 		mov	r10,@-r0
(2)  869/ 6000B5C :                     ; 		mov	 r1,@-r0	; <-- copy of r11
(2)  870/ 6000B5C :                     ; 		mov	r12,r1		; <-- layout + Y pos
(2)  871/ 6000B5C :                     ; 		add	 r3,r1
(2)  872/ 6000B5C :                     ; 		mov	 r1,@-r0
(2)  873/ 6000B5C :                     ; 		rts
(2)  874/ 6000B5C :                     ; 		nop
(2)  875/ 6000B5C :                     ; 		align 4
(2)  876/ 6000B5C :                     ; 		ltorg
(2)  877/ 6000B5C :                     
(2)  878/ 6000B5C :                     ; --------------------------------------------------------
(2)  879/ 6000B5C :                     ; MarsVideo_DmaDraw
(2)  880/ 6000B5C :                     ;
(2)  881/ 6000B5C :                     ; Input:
(2)  882/ 6000B5C :                     ; r1 - Source
(2)  883/ 6000B5C :                     ; r2 - Destination
(2)  884/ 6000B5C :                     ; r3 - Size / 4
(2)  885/ 6000B5C :                     ; --------------------------------------------------------
(2)  886/ 6000B5C :                     
(2)  887/ 6000B5C :                     		align 4
(2)  888/ 6000B5C :                     MarsVideo_DmaDraw:
(2)  889/ 6000B5C : E5B0                		mov	#_DMAOPERATION,r5
(2)  890/ 6000B5E : E490                		mov	#_DMASOURCE1,r4
(2)  891/ 6000B60 : E000                		mov	#0,r0
(2)  892/ 6000B62 : 2502                		mov	r0,@r5
(2)  893/ 6000B64 : 9016                		mov	#%0101101011100000,r0
(2)  894/ 6000B66 : 1403                		mov	r0,@($0C,r4)
(2)  895/ 6000B68 : 6013                		mov	r1,r0
(2)  896/ 6000B6A : 2402                		mov	r0,@r4
(2)  897/ 6000B6C : 6023                		mov	r2,r0			; <-- point fbdata here
(2)  898/ 6000B6E : 1401                		mov	r0,@($04,r4)
(2)  899/ 6000B70 : 6033                		mov	r3,r0
(2)  900/ 6000B72 : 1402                		mov	r0,@($08,r4)
(2)  901/ 6000B74 : 900F                		mov	#%0101101011100001,r0
(2)  902/ 6000B76 : 1403                		mov	r0,@($0C,r4)
(2)  903/ 6000B78 : E001                		mov	#1,r0
(2)  904/ 6000B7A : 2502                		mov	r0,@r5
(2)  905/ 6000B7C : 5043                .wait_dma:	mov	@($C,r4),r0		; Still on DMA?
(2)  906/ 6000B7E : C802                		tst	#%10,r0
(2)  907/ 6000B80 : 89FC                		bt	.wait_dma
(2)  908/ 6000B82 : E000                		mov	#0,r0
(2)  909/ 6000B84 : 2502                		mov	r0,@r5
(2)  910/ 6000B86 : 9005                		mov	#%0101101011100000,r0
(2)  911/ 6000B88 : 1403                		mov	r0,@($C,r4)
(2)  912/ 6000B8A : 000B                		rts
(2)  913/ 6000B8C : 0009                		nop
(2)  914/ 6000B8E :                     		align 4
(2)  915/ 6000B90 : 2600 7980 5AE0 5AE1 		ltorg
(2)  916/ 6000B98 :                     
(2)  917/ 6000B98 :                     ; --------------------------------------------------------
(2)  918/ 6000B98 :                     ; MarsVideo_Bg_DrawScrl
(2)  919/ 6000B98 :                     ;
(2)  920/ 6000B98 :                     ; Input:
(2)  921/ 6000B98 :                     ; r14 | Background buffer
(2)  922/ 6000B98 :                     ; r13 | Scrolling-area buffer
(2)  923/ 6000B98 :                     ; r12 | Draw timers
(2)  924/ 6000B98 :                     ;
(2)  925/ 6000B98 :                     ; Breaks:
(2)  926/ 6000B98 :                     ; ALL
(2)  927/ 6000B98 :                     ; --------------------------------------------------------
(2)  928/ 6000B98 :                     
(2)  929/ 6000B98 :                     		align 4
(2)  930/ 6000B98 :                     MarsVideo_Bg_DrawScrl:
(2)  931/ 6000B98 : 4F22                		sts	pr,@-r15
(2)  932/ 6000B9A :                     
(2)  933/ 6000B9A : D065                		mov	#_framebuffer,r0
(2)  934/ 6000B9C : 51DA                		mov	@(scrl_fbdata,r13),r1
(2)  935/ 6000B9E : 310C                		add	r0,r1
(2)  936/ 6000BA0 : 5BD6                		mov	@(scrl_intrl_w,r13),r11		; r11 - FB width
(2)  937/ 6000BA2 : 410A                		lds	r1,mach				; mach - FB base
(2)  938/ 6000BA4 : 50D8                		mov	@(scrl_fbpos_y,r13),r0
(2)  939/ 6000BA6 : E1F0                		mov	#-$10,r1			; <-- CUSTOM BLOCK SIZE
(2)  940/ 6000BA8 : 5AD9                		mov	@(scrl_fbpos,r13),r10		; r10 - FB x/y pos
(2)  941/ 6000BAA : 2019                		and	r1,r0
(2)  942/ 6000BAC : 59EA                		mov	@(md_bg_blk,r14),r9		; r9 - Block data
(2)  943/ 6000BAE : 2B0E                		mulu	r0,r11
(2)  944/ 6000BB0 : 85E4                		mov.w	@(md_bg_w,r14),r0		; r7 - Layout increment
(2)  945/ 6000BB2 : 670D                		extu.w	r0,r7
(2)  946/ 6000BB4 : 5CD5                		mov	@(scrl_intrl_size,r13),r12	; r12 - FB full size
(2)  947/ 6000BB6 : 001A                		sts	macl,r0
(2)  948/ 6000BB8 : 3A0C                		add	r0,r10
(2)  949/ 6000BBA : 2A19                		and	r1,r10
(2)  950/ 6000BBC : 58E8                		mov	@(md_bg_low,r14),r8		; r8 - Layout data
(2)  951/ 6000BBE : DD5D                		mov	#RAM_Mars_ScrlData,r13
(2)  952/ 6000BC0 : 3AC3                		cmp/ge	r12,r10
(2)  953/ 6000BC2 : 8B00                		bf	.fb_y
(2)  954/ 6000BC4 : 3AC8                		sub	r12,r10
(2)  955/ 6000BC6 :                     .fb_y:
(2)  956/ 6000BC6 : D15C                		mov	#Cach_DrawTimers,r1
(2)  957/ 6000BC8 : 6012                		mov	@r1,r0
(2)  958/ 6000BCA : 2008                		tst	r0,r0
(2)  959/ 6000BCC : 8901                		bt	.no_r
(2)  960/ 6000BCE : B015                		bsr	.draw_r
(2)  961/ 6000BD0 : 0009                		nop
(2)  962/ 6000BD2 :                     .no_r:
(2)  963/ 6000BD2 : D15A                		mov	#Cach_DrawTimers+4,r1
(2)  964/ 6000BD4 : 6012                		mov	@r1,r0
(2)  965/ 6000BD6 : 2008                		tst	r0,r0
(2)  966/ 6000BD8 : 8901                		bt	.no_l
(2)  967/ 6000BDA : B016                		bsr	.draw_l
(2)  968/ 6000BDC : 0009                		nop
(2)  969/ 6000BDE :                     .no_l:
(2)  970/ 6000BDE : D158                		mov	#Cach_DrawTimers+8,r1
(2)  971/ 6000BE0 : 6012                		mov	@r1,r0
(2)  972/ 6000BE2 : 2008                		tst	r0,r0
(2)  973/ 6000BE4 : 8901                		bt	.no_d
(2)  974/ 6000BE6 : B053                		bsr	.draw_d
(2)  975/ 6000BE8 : 0009                		nop
(2)  976/ 6000BEA :                     .no_d:
(2)  977/ 6000BEA : D156                		mov	#Cach_DrawTimers+$C,r1
(2)  978/ 6000BEC : 6012                		mov	@r1,r0
(2)  979/ 6000BEE : 2008                		tst	r0,r0
(2)  980/ 6000BF0 : 8901                		bt	.no_u
(2)  981/ 6000BF2 : B054                		bsr	.draw_u
(2)  982/ 6000BF4 : 0009                		nop
(2)  983/ 6000BF6 :                     .no_u:
(2)  984/ 6000BF6 :                     
(2)  985/ 6000BF6 : 4F26                		lds	@r15+,pr
(2)  986/ 6000BF8 : 000B                		rts
(2)  987/ 6000BFA : 0009                		nop
(2)  988/ 6000BFC :                     
(2)  989/ 6000BFC :                     ; mach - FB base
(2)  990/ 6000BFC :                     ; r13 - Background copy
(2)  991/ 6000BFC :                     ; r12 - FB full size
(2)  992/ 6000BFC :                     ; r11 - FB width
(2)  993/ 6000BFC :                     ; r10 - FB x/y pos
(2)  994/ 6000BFC :                     ; r9 - Block data
(2)  995/ 6000BFC :                     ; r8 - Layout data
(2)  996/ 6000BFC :                     ; r7 - Layout increment
(2)  997/ 6000BFC :                     
(2)  998/ 6000BFC :                     ; RIGHT/LEFT
(2)  999/ 6000BFC :                     .draw_r:
(2) 1000/ 6000BFC : 4010                		dt	r0
(2) 1001/ 6000BFE : 2102                		mov	r0,@r1
(2) 1002/ 6000C00 : 85E9                		mov.w	@(md_bg_xinc_r,r14),r0		; r7 - Layout increment
(2) 1003/ 6000C02 : 620F                		exts.w	r0,r2
(2) 1004/ 6000C04 : 91A0                		mov	#320,r1
(2) 1005/ 6000C06 : A005                		bra	.go_lr
(2) 1006/ 6000C08 : 0009                		nop
(2) 1007/ 6000C0A :                     .draw_l:
(2) 1008/ 6000C0A : 4010                		dt	r0
(2) 1009/ 6000C0C : 2102                		mov	r0,@r1
(2) 1010/ 6000C0E : 85E8                		mov.w	@(md_bg_xinc_l,r14),r0		; r7 - Layout increment
(2) 1011/ 6000C10 : 620F                		exts.w	r0,r2
(2) 1012/ 6000C12 : E100                		mov	#0,r1
(2) 1013/ 6000C14 :                     .go_lr:
(2) 1014/ 6000C14 : 66A3                		mov	r10,r6
(2) 1015/ 6000C16 : 361C                		add	r1,r6
(2) 1016/ 6000C18 :                     ; 		mov	#-$10,r0
(2) 1017/ 6000C18 :                     ; 		and	r0,r6		; r6 - curr out pos
(2) 1018/ 6000C18 : 2F86                		mov	r8,@-r15
(2) 1019/ 6000C1A : 85EA                		mov.w	@(md_bg_yinc_u,r14),r0		; r7 - Layout increment
(2) 1020/ 6000C1C : 610F                		exts.w	r0,r1
(2) 1021/ 6000C1E : E310                		mov	#16,r3		; <-- MANUAL BLOCK SIZE
(2) 1022/ 6000C20 : 213E                		mulu	r3,r1
(2) 1023/ 6000C22 : 001A                		sts	macl,r0
(2) 1024/ 6000C24 : 4019                		shlr8	r0
(2) 1025/ 6000C26 : 207E                		mulu	r7,r0
(2) 1026/ 6000C28 : 001A                		sts	macl,r0
(2) 1027/ 6000C2A : 380C                		add	r0,r8
(2) 1028/ 6000C2C : 223E                		mulu	r3,r2
(2) 1029/ 6000C2E : 001A                		sts	macl,r0
(2) 1030/ 6000C30 : 4019                		shlr8	r0
(2) 1031/ 6000C32 : 380C                		add	r0,r8
(2) 1032/ 6000C34 : E10F                		mov	#((224+16)/16),r1
(2) 1033/ 6000C36 :                     .y_blk:
(2) 1034/ 6000C36 : 2F16                		mov	r1,@-r15
(2) 1035/ 6000C38 : 6593                		mov	r9,r5
(2) 1036/ 6000C3A : 6080                		mov.b	@r8,r0
(2) 1037/ 6000C3C : 600C                		extu.b	r0,r0		; BYTE
(2) 1038/ 6000C3E : 9384                		mov	#16*16,r3
(2) 1039/ 6000C40 : 203E                		mulu	r3,r0
(2) 1040/ 6000C42 : 001A                		sts	macl,r0
(2) 1041/ 6000C44 : 6593                		mov	r9,r5
(2) 1042/ 6000C46 : 350C                		add	r0,r5
(2) 1043/ 6000C48 :                     
(2) 1044/ 6000C48 : E310                		mov	#16,r3
(2) 1045/ 6000C4A :                     .y_lne:
(2) 1046/ 6000C4A : 36C3                		cmp/ge	r12,r6
(2) 1047/ 6000C4C : 8B00                		bf	.y_res
(2) 1048/ 6000C4E : 36C8                		sub	r12,r6
(2) 1049/ 6000C50 :                     .y_res:
(2) 1050/ 6000C50 : E404                		mov	#16/4,r4
(2) 1051/ 6000C52 :                     .x_lne:
(2) 1052/ 6000C52 : 6056                		mov	@r5+,r0
(2) 1053/ 6000C54 : 401A                		lds	r0,macl
(2) 1054/ 6000C56 : 010A                		sts	mach,r1
(2) 1055/ 6000C58 : 316C                		add	r6,r1
(2) 1056/ 6000C5A : 62D3                		mov	r13,r2
(2) 1057/ 6000C5C : 326C                		add	r6,r2
(2) 1058/ 6000C5E : 2102                		mov	r0,@r1
(2) 1059/ 6000C60 : 7604                		add	#4,r6
(2) 1060/ 6000C62 : 2202                		mov	r0,@r2
(2) 1061/ 6000C64 : 9070                		mov	#320,r0
(2) 1062/ 6000C66 : 3603                		cmp/ge	r0,r6
(2) 1063/ 6000C68 : 8905                		bt	.x_ex
(2) 1064/ 6000C6A : 001A                		sts	macl,r0
(2) 1065/ 6000C6C : 31CC                		add	r12,r1
(2) 1066/ 6000C6E : 2102                		mov	r0,@r1
(2) 1067/ 6000C70 : 32CC                		add	r12,r2
(2) 1068/ 6000C72 : 2202                		mov	r0,@r2
(2) 1069/ 6000C74 : 0009                		nop
(2) 1070/ 6000C76 :                     .x_ex:
(2) 1071/ 6000C76 : 4410                		dt	r4
(2) 1072/ 6000C78 : 8BEB                		bf	.x_lne
(2) 1073/ 6000C7A : 76F0                		add	#-16,r6	; bring point back
(2) 1074/ 6000C7C : 4310                		dt	r3
(2) 1075/ 6000C7E : 8FE4                		bf/s	.y_lne
(2) 1076/ 6000C80 : 36BC                		add	r11,r6
(2) 1077/ 6000C82 : 61F6                		mov	@r15+,r1
(2) 1078/ 6000C84 : 4110                		dt	r1
(2) 1079/ 6000C86 : 8FD6                		bf/s	.y_blk
(2) 1080/ 6000C88 : 387C                		add	r7,r8
(2) 1081/ 6000C8A : 68F6                		mov	@r15+,r8
(2) 1082/ 6000C8C : 000B                		rts
(2) 1083/ 6000C8E : 0009                		nop
(2) 1084/ 6000C90 :                     
(2) 1085/ 6000C90 :                     ; DOWN/UP
(2) 1086/ 6000C90 :                     .draw_d:
(2) 1087/ 6000C90 : 4010                		dt	r0
(2) 1088/ 6000C92 : 2102                		mov	r0,@r1
(2) 1089/ 6000C94 : 85EB                		mov.w	@(md_bg_yinc_d,r14),r0		; r7 - Layout increment
(2) 1090/ 6000C96 : 620F                		exts.w	r0,r2
(2) 1091/ 6000C98 : 9158                		mov	#224,r1
(2) 1092/ 6000C9A : A005                		bra	.go_du
(2) 1093/ 6000C9C : 0009                		nop
(2) 1094/ 6000C9E :                     .draw_u:
(2) 1095/ 6000C9E : 4010                		dt	r0
(2) 1096/ 6000CA0 : 2102                		mov	r0,@r1
(2) 1097/ 6000CA2 : 85EA                		mov.w	@(md_bg_yinc_u,r14),r0		; r7 - Layout increment
(2) 1098/ 6000CA4 : 620F                		exts.w	r0,r2
(2) 1099/ 6000CA6 : E100                		mov	#0,r1
(2) 1100/ 6000CA8 :                     .go_du:
(2) 1101/ 6000CA8 : 2B1E                		mulu	r1,r11
(2) 1102/ 6000CAA : 001A                		sts	macl,r0
(2) 1103/ 6000CAC : 66A3                		mov	r10,r6
(2) 1104/ 6000CAE : 360C                		add	r0,r6
(2) 1105/ 6000CB0 :                     ; 		mov	#-$10,r0
(2) 1106/ 6000CB0 :                     ; 		and	r0,r6			; r6 - curr out pos
(2) 1107/ 6000CB0 : 2F86                		mov	r8,@-r15
(2) 1108/ 6000CB2 : 85E8                		mov.w	@(md_bg_xinc_l,r14),r0		; r7 - Layout increment
(2) 1109/ 6000CB4 : 610F                		exts.w	r0,r1
(2) 1110/ 6000CB6 : E310                		mov	#16,r3		; <-- MANUAL BLOCK SIZE
(2) 1111/ 6000CB8 : 213E                		mulu	r3,r1
(2) 1112/ 6000CBA : 001A                		sts	macl,r0
(2) 1113/ 6000CBC : 4019                		shlr8	r0
(2) 1114/ 6000CBE : 380C                		add	r0,r8
(2) 1115/ 6000CC0 : 223E                		mulu	r3,r2
(2) 1116/ 6000CC2 : 001A                		sts	macl,r0
(2) 1117/ 6000CC4 : 4019                		shlr8	r0
(2) 1118/ 6000CC6 : 207E                		mulu	r7,r0
(2) 1119/ 6000CC8 : 001A                		sts	macl,r0
(2) 1120/ 6000CCA : 380C                		add	r0,r8
(2) 1121/ 6000CCC : E115                		mov	#((320+16)/16),r1
(2) 1122/ 6000CCE :                     .yd_blk:
(2) 1123/ 6000CCE : 2F66                		mov	r6,@-r15
(2) 1124/ 6000CD0 : 2F16                		mov	r1,@-r15
(2) 1125/ 6000CD2 : 6593                		mov	r9,r5
(2) 1126/ 6000CD4 : 6080                		mov.b	@r8,r0
(2) 1127/ 6000CD6 : 600C                		extu.b	r0,r0		; BYTE
(2) 1128/ 6000CD8 : 9337                		mov	#16*16,r3
(2) 1129/ 6000CDA : 203E                		mulu	r3,r0
(2) 1130/ 6000CDC : 001A                		sts	macl,r0
(2) 1131/ 6000CDE : 6593                		mov	r9,r5
(2) 1132/ 6000CE0 : 350C                		add	r0,r5
(2) 1133/ 6000CE2 :                     ;
(2) 1134/ 6000CE2 : E310                		mov	#16,r3
(2) 1135/ 6000CE4 :                     .yd_lne:
(2) 1136/ 6000CE4 : 36C3                		cmp/ge	r12,r6
(2) 1137/ 6000CE6 : 8B00                		bf	.yd_res
(2) 1138/ 6000CE8 : 36C8                		sub	r12,r6
(2) 1139/ 6000CEA :                     .yd_res:
(2) 1140/ 6000CEA : E404                		mov	#16/4,r4
(2) 1141/ 6000CEC :                     .xd_lne:
(2) 1142/ 6000CEC : 6056                		mov	@r5+,r0
(2) 1143/ 6000CEE : 401A                		lds	r0,macl
(2) 1144/ 6000CF0 : 010A                		sts	mach,r1
(2) 1145/ 6000CF2 : 316C                		add	r6,r1
(2) 1146/ 6000CF4 : 62D3                		mov	r13,r2
(2) 1147/ 6000CF6 : 326C                		add	r6,r2
(2) 1148/ 6000CF8 : 2102                		mov	r0,@r1
(2) 1149/ 6000CFA : 7604                		add	#4,r6
(2) 1150/ 6000CFC : 2202                		mov	r0,@r2
(2) 1151/ 6000CFE : 9023                		mov	#320,r0
(2) 1152/ 6000D00 : 3603                		cmp/ge	r0,r6
(2) 1153/ 6000D02 : 8905                		bt	.xd_ex
(2) 1154/ 6000D04 : 001A                		sts	macl,r0
(2) 1155/ 6000D06 : 31CC                		add	r12,r1
(2) 1156/ 6000D08 : 2102                		mov	r0,@r1
(2) 1157/ 6000D0A : 32CC                		add	r12,r2
(2) 1158/ 6000D0C : 2202                		mov	r0,@r2
(2) 1159/ 6000D0E : 0009                		nop
(2) 1160/ 6000D10 :                     .xd_ex:
(2) 1161/ 6000D10 : 4410                		dt	r4
(2) 1162/ 6000D12 : 8BEB                		bf	.xd_lne
(2) 1163/ 6000D14 : 76F0                		add	#-16,r6	; bring point back
(2) 1164/ 6000D16 : 4310                		dt	r3
(2) 1165/ 6000D18 : 8FE4                		bf/s	.yd_lne
(2) 1166/ 6000D1A : 36BC                		add	r11,r6
(2) 1167/ 6000D1C :                     
(2) 1168/ 6000D1C : 61F6                		mov	@r15+,r1
(2) 1169/ 6000D1E : 66F6                		mov	@r15+,r6
(2) 1170/ 6000D20 : E010                		mov	#16,r0
(2) 1171/ 6000D22 : 360C                		add	r0,r6
(2) 1172/ 6000D24 : 4110                		dt	r1
(2) 1173/ 6000D26 : 8FD2                		bf/s	.yd_blk
(2) 1174/ 6000D28 : 7801                		add	#1,r8
(2) 1175/ 6000D2A : 68F6                		mov	@r15+,r8
(2) 1176/ 6000D2C : 000B                		rts
(2) 1177/ 6000D2E : 0009                		nop
(2) 1178/ 6000D30 :                     
(2) 1179/ 6000D30 :                     		align 4
(2) 1180/ 6000D30 : 2400 0000 2600 79F8 		ltorg
                    2600 7980 2600 7984 
                    2600 7988 2600 798C 
                    0140 0100 00E0      
(2) 1181/ 6000D4E :                     
(2) 1182/ 6000D4E :                     ; ; --------------------------------------------------------
(2) 1183/ 6000D4E :                     ; ; MarsVideo_Bg_DrawScrl_UD
(2) 1184/ 6000D4E :                     ; ;
(2) 1185/ 6000D4E :                     ; ; Input:
(2) 1186/ 6000D4E :                     ; ; r14 | Background buffer
(2) 1187/ 6000D4E :                     ; ; r13 | Scrolling-area buffer
(2) 1188/ 6000D4E :                     ; ; r12 | Draw timers
(2) 1189/ 6000D4E :                     ; ;
(2) 1190/ 6000D4E :                     ; ; Breaks:
(2) 1191/ 6000D4E :                     ; ; ALL
(2) 1192/ 6000D4E :                     ; ; --------------------------------------------------------
(2) 1193/ 6000D4E :                     ;
(2) 1194/ 6000D4E :                     ; 		align 4
(2) 1195/ 6000D4E :                     ; MarsVideo_Bg_DrawScrl_UD:
(2) 1196/ 6000D4E :                     ; 		sts	pr,@-r15
(2) 1197/ 6000D4E :                     ;
(2) 1198/ 6000D4E :                     ; 		mov	#_framebuffer,r0
(2) 1199/ 6000D4E :                     ; 		mov	@(scrl_fbdata,r13),r1
(2) 1200/ 6000D4E :                     ; 		add	r0,r1
(2) 1201/ 6000D4E :                     ; 		mov	@(scrl_intrl_w,r13),r11		; r11 - FB width
(2) 1202/ 6000D4E :                     ; 		lds	r1,mach				; mach - FB base
(2) 1203/ 6000D4E :                     ; 		mov	@(scrl_fbpos_y,r13),r0
(2) 1204/ 6000D4E :                     ; 		mov	#-$10,r1			; <-- CUSTOM BLOCK SIZE
(2) 1205/ 6000D4E :                     ; 		mov	@(scrl_fbpos,r13),r10		; r10 - FB x/y pos
(2) 1206/ 6000D4E :                     ; 		and	r1,r0
(2) 1207/ 6000D4E :                     ; 		mov	@(md_bg_blk,r14),r9		; r9 - Block data
(2) 1208/ 6000D4E :                     ; 		mulu	r0,r11
(2) 1209/ 6000D4E :                     ; 		mov.w	@(md_bg_w,r14),r0		; r7 - Layout increment
(2) 1210/ 6000D4E :                     ; 		extu.w	r0,r7
(2) 1211/ 6000D4E :                     ; 		mov	@(scrl_intrl_size,r13),r12	; r12 - FB full size
(2) 1212/ 6000D4E :                     ; 		sts	macl,r0
(2) 1213/ 6000D4E :                     ; 		add	r0,r10
(2) 1214/ 6000D4E :                     ; 		and	r1,r10
(2) 1215/ 6000D4E :                     ; 		mov	@(md_bg_low,r14),r8		; r8 - Layout data
(2) 1216/ 6000D4E :                     ; 		mov	#RAM_Mars_ScrlData,r13
(2) 1217/ 6000D4E :                     ; 		cmp/ge	r12,r10
(2) 1218/ 6000D4E :                     ; 		bf	.fb_y
(2) 1219/ 6000D4E :                     ; 		sub	r12,r10
(2) 1220/ 6000D4E :                     ; .fb_y:
(2) 1221/ 6000D4E :                     ; 		mov	#Cach_DrawTimers+8,r1
(2) 1222/ 6000D4E :                     ; 		mov	@r1,r0
(2) 1223/ 6000D4E :                     ; 		tst	r0,r0
(2) 1224/ 6000D4E :                     ; 		bt	.no_d
(2) 1225/ 6000D4E :                     ; 		bsr	.draw_d
(2) 1226/ 6000D4E :                     ; 		nop
(2) 1227/ 6000D4E :                     ; .no_d:
(2) 1228/ 6000D4E :                     ; 		mov	#Cach_DrawTimers+$C,r1
(2) 1229/ 6000D4E :                     ; 		mov	@r1,r0
(2) 1230/ 6000D4E :                     ; 		tst	r0,r0
(2) 1231/ 6000D4E :                     ; 		bt	.no_u
(2) 1232/ 6000D4E :                     ; 		bsr	.draw_u
(2) 1233/ 6000D4E :                     ; 		nop
(2) 1234/ 6000D4E :                     ; .no_u:
(2) 1235/ 6000D4E :                     ; 		lds	@r15+,pr
(2) 1236/ 6000D4E :                     ; 		rts
(2) 1237/ 6000D4E :                     ; 		nop
(2) 1238/ 6000D4E :                     ; ; DOWN/UP
(2) 1239/ 6000D4E :                     ; .draw_d:
(2) 1240/ 6000D4E :                     ; 		dt	r0
(2) 1241/ 6000D4E :                     ; 		mov	r0,@r1
(2) 1242/ 6000D4E :                     ; 		mov.w	@(md_bg_yinc_d,r14),r0		; r7 - Layout increment
(2) 1243/ 6000D4E :                     ; 		exts.w	r0,r2
(2) 1244/ 6000D4E :                     ; 		mov	#224,r1
(2) 1245/ 6000D4E :                     ; 		bra	.go_du
(2) 1246/ 6000D4E :                     ; 		nop
(2) 1247/ 6000D4E :                     ; .draw_u:
(2) 1248/ 6000D4E :                     ; 		dt	r0
(2) 1249/ 6000D4E :                     ; 		mov	r0,@r1
(2) 1250/ 6000D4E :                     ; 		mov.w	@(md_bg_yinc_u,r14),r0		; r7 - Layout increment
(2) 1251/ 6000D4E :                     ; 		exts.w	r0,r2
(2) 1252/ 6000D4E :                     ; 		mov	#0,r1
(2) 1253/ 6000D4E :                     ; .go_du:
(2) 1254/ 6000D4E :                     ; 		mulu	r1,r11
(2) 1255/ 6000D4E :                     ; 		sts	macl,r0
(2) 1256/ 6000D4E :                     ; 		mov	r10,r6
(2) 1257/ 6000D4E :                     ; 		add	r0,r6
(2) 1258/ 6000D4E :                     ; ; 		mov	#-$10,r0
(2) 1259/ 6000D4E :                     ; ; 		and	r0,r6			; r6 - curr out pos
(2) 1260/ 6000D4E :                     ; 		mov	r8,@-r15
(2) 1261/ 6000D4E :                     ; 		mov.w	@(md_bg_xinc_l,r14),r0		; r7 - Layout increment
(2) 1262/ 6000D4E :                     ; 		exts.w	r0,r1
(2) 1263/ 6000D4E :                     ; 		mov	#16,r3		; <-- MANUAL BLOCK SIZE
(2) 1264/ 6000D4E :                     ; 		mulu	r3,r1
(2) 1265/ 6000D4E :                     ; 		sts	macl,r0
(2) 1266/ 6000D4E :                     ; 		shlr8	r0
(2) 1267/ 6000D4E :                     ; 		add	r0,r8
(2) 1268/ 6000D4E :                     ; 		mulu	r3,r2
(2) 1269/ 6000D4E :                     ; 		sts	macl,r0
(2) 1270/ 6000D4E :                     ; 		shlr8	r0
(2) 1271/ 6000D4E :                     ; 		mulu	r7,r0
(2) 1272/ 6000D4E :                     ; 		sts	macl,r0
(2) 1273/ 6000D4E :                     ; 		add	r0,r8
(2) 1274/ 6000D4E :                     ; 		mov	#((320+16)/16),r1
(2) 1275/ 6000D4E :                     ; .yd_blk:
(2) 1276/ 6000D4E :                     ; 		mov	r6,@-r15
(2) 1277/ 6000D4E :                     ; 		mov	r1,@-r15
(2) 1278/ 6000D4E :                     ; 		mov	r9,r5
(2) 1279/ 6000D4E :                     ; 		mov.b	@r8,r0
(2) 1280/ 6000D4E :                     ; 		extu.b	r0,r0		; BYTE
(2) 1281/ 6000D4E :                     ; 		mov	#16*16,r3
(2) 1282/ 6000D4E :                     ; 		mulu	r3,r0
(2) 1283/ 6000D4E :                     ; 		sts	macl,r0
(2) 1284/ 6000D4E :                     ; 		mov	r9,r5
(2) 1285/ 6000D4E :                     ; 		add	r0,r5
(2) 1286/ 6000D4E :                     ; ;
(2) 1287/ 6000D4E :                     ; 		mov	#16,r3
(2) 1288/ 6000D4E :                     ; .yd_lne:
(2) 1289/ 6000D4E :                     ; 		cmp/ge	r12,r6
(2) 1290/ 6000D4E :                     ; 		bf	.yd_res
(2) 1291/ 6000D4E :                     ; 		sub	r12,r6
(2) 1292/ 6000D4E :                     ; .yd_res:
(2) 1293/ 6000D4E :                     ; 		mov	#16/4,r4
(2) 1294/ 6000D4E :                     ; .xd_lne:
(2) 1295/ 6000D4E :                     ; 		mov	@r5+,r0
(2) 1296/ 6000D4E :                     ; 		lds	r0,macl
(2) 1297/ 6000D4E :                     ; 		sts	mach,r1
(2) 1298/ 6000D4E :                     ; 		add	r6,r1
(2) 1299/ 6000D4E :                     ; 		mov	r13,r2
(2) 1300/ 6000D4E :                     ; 		add	r6,r2
(2) 1301/ 6000D4E :                     ; 		mov	r0,@r1
(2) 1302/ 6000D4E :                     ; 		add	#4,r6
(2) 1303/ 6000D4E :                     ; 		mov	r0,@r2
(2) 1304/ 6000D4E :                     ; 		mov	#320,r0
(2) 1305/ 6000D4E :                     ; 		cmp/ge	r0,r6
(2) 1306/ 6000D4E :                     ; 		bt	.xd_ex
(2) 1307/ 6000D4E :                     ; 		sts	macl,r0
(2) 1308/ 6000D4E :                     ; 		add	r12,r1
(2) 1309/ 6000D4E :                     ; 		mov	r0,@r1
(2) 1310/ 6000D4E :                     ; 		add	r12,r2
(2) 1311/ 6000D4E :                     ; 		mov	r0,@r2
(2) 1312/ 6000D4E :                     ; 		nop
(2) 1313/ 6000D4E :                     ; .xd_ex:
(2) 1314/ 6000D4E :                     ; 		dt	r4
(2) 1315/ 6000D4E :                     ; 		bf	.xd_lne
(2) 1316/ 6000D4E :                     ; 		add	#-16,r6	; bring point back
(2) 1317/ 6000D4E :                     ; 		dt	r3
(2) 1318/ 6000D4E :                     ; 		bf/s	.yd_lne
(2) 1319/ 6000D4E :                     ; 		add	r11,r6
(2) 1320/ 6000D4E :                     ;
(2) 1321/ 6000D4E :                     ; 		mov	@r15+,r1
(2) 1322/ 6000D4E :                     ; 		mov	@r15+,r6
(2) 1323/ 6000D4E :                     ; 		mov	#16,r0
(2) 1324/ 6000D4E :                     ; 		add	r0,r6
(2) 1325/ 6000D4E :                     ; 		dt	r1
(2) 1326/ 6000D4E :                     ; 		bf/s	.yd_blk
(2) 1327/ 6000D4E :                     ; 		add	#1,r8
(2) 1328/ 6000D4E :                     ; 		mov	@r15+,r8
(2) 1329/ 6000D4E :                     ; 		rts
(2) 1330/ 6000D4E :                     ; 		nop
(2) 1331/ 6000D4E :                     ; 		align 4
(2) 1332/ 6000D4E :                     ; 		ltorg
(2) 1333/ 6000D4E :                     
(2) 1334/ 6000D4E :                     ; ----------------------------------------------------------------
(2) 1335/ 6000D4E :                     ; Super Sprites
(2) 1336/ 6000D4E :                     ; ----------------------------------------------------------------
(2) 1337/ 6000D4E :                     
(2) 1338/ 6000D4E :                     ; --------------------------------------------------------
(2) 1339/ 6000D4E :                     ; MarsVideo_MkSprCoords
(2) 1340/ 6000D4E :                     ;
(2) 1341/ 6000D4E :                     ; This creates a backup of the screen's position for
(2) 1342/ 6000D4E :                     ; the sprite-refill boxes
(2) 1343/ 6000D4E :                     ;
(2) 1344/ 6000D4E :                     ; Input:
(2) 1345/ 6000D4E :                     ; r1 - VRAM base
(2) 1346/ 6000D4E :                     ; r2 - X Top-Left position
(2) 1347/ 6000D4E :                     ; r3 - Y (real) position
(2) 1348/ 6000D4E :                     ; r4 - Scrolling area Width
(2) 1349/ 6000D4E :                     ; r5 - Scrolling area Height
(2) 1350/ 6000D4E :                     ; r6 - Scroll area size
(2) 1351/ 6000D4E :                     ; r7 - Output settings to this area
(2) 1352/ 6000D4E :                     ;
(2) 1353/ 6000D4E :                     ; Breaks:
(2) 1354/ 6000D4E :                     ; r7
(2) 1355/ 6000D4E :                     ; --------------------------------------------------------
(2) 1356/ 6000D4E :                     
(2) 1357/ 6000D4E :                     		align 4
(2) 1358/ 6000D50 :                     MarsVideo_MkSprCoords:
(2) 1359/ 6000D50 : 7704                		add	#4,r7
(2) 1360/ 6000D52 : 2766                		mov	r6,@-r7
(2) 1361/ 6000D54 : 2756                		mov	r5,@-r7
(2) 1362/ 6000D56 : 2746                		mov	r4,@-r7
(2) 1363/ 6000D58 : 2736                		mov	r3,@-r7
(2) 1364/ 6000D5A : 2726                		mov	r2,@-r7
(2) 1365/ 6000D5C : 2716                		mov	r1,@-r7
(2) 1366/ 6000D5E : 000B                		rts
(2) 1367/ 6000D60 : 0009                		nop
(2) 1368/ 6000D62 :                     		align 4
(2) 1369/ 6000D64 :                     		ltorg
(2) 1370/ 6000D64 :                     
(2) 1371/ 6000D64 :                     ; --------------------------------------------------------
(2) 1372/ 6000D64 :                     ; MarsVideo_MkSprBoxes
(2) 1373/ 6000D64 :                     ; --------------------------------------------------------
(2) 1374/ 6000D64 :                     
(2) 1375/ 6000D64 :                     		align 4
(2) 1376/ 6000D64 :                     MarsVideo_MkSprBoxes:
(2) 1377/ 6000D64 : DE26                 		mov	#RAM_Mars_DreqRead+Dreq_SuperSpr,r14
(2) 1378/ 6000D66 : DD27                		mov	#Cach_SprBoxList,r13
(2) 1379/ 6000D68 :                     .next_save:
(2) 1380/ 6000D68 : 50E4                		mov	@(marsspr_data,r14),r0
(2) 1381/ 6000D6A : 2008                		tst	r0,r0
(2) 1382/ 6000D6C : 8946                		bt	.last
(2) 1383/ 6000D6E : E004                		mov	#MAX_SSPRSPD,r0		; expand box (max speed)
(2) 1384/ 6000D70 : 55E1                		mov	@(marsspr_x,r14),r5	; XXXX YYYY
(2) 1385/ 6000D72 : 665F                		exts.w	r5,r6
(2) 1386/ 6000D74 : 57E0                		mov	@(marsspr_xfrm,r14),r7	; ?? ?? XX YY
(2) 1387/ 6000D76 : 4529                		shlr16	r5
(2) 1388/ 6000D78 : 655F                		exts.w	r5,r5
(2) 1389/ 6000D7A : 687C                		extu.b	r7,r8
(2) 1390/ 6000D7C : 4719                		shlr8	r7
(2) 1391/ 6000D7E : 677C                		extu.b	r7,r7
(2) 1392/ 6000D80 : 375C                		add	r5,r7
(2) 1393/ 6000D82 : 386C                		add	r6,r8
(2) 1394/ 6000D84 :                     ; 		mov.w	@(marsspr_x,r14),r0
(2) 1395/ 6000D84 :                     ; 		exts.w	r0,r5
(2) 1396/ 6000D84 :                     ; 		mov.w	@(marsspr_y,r14),r0
(2) 1397/ 6000D84 :                     ; 		exts.w	r0,r6
(2) 1398/ 6000D84 :                     ; 		mov.b	@(marsspr_xs,r14),r0
(2) 1399/ 6000D84 :                     ; 		exts.b	r0,r7
(2) 1400/ 6000D84 :                     ; 		mov.b	@(marsspr_ys,r14),r0
(2) 1401/ 6000D84 :                     ; 		exts.b	r0,r8
(2) 1402/ 6000D84 :                     ; 		add	r5,r7
(2) 1403/ 6000D84 :                     ; 		add	r6,r8
(2) 1404/ 6000D84 :                     
(2) 1405/ 6000D84 : 3508                		sub	r0,r5	; expand box
(2) 1406/ 6000D86 : 3608                		sub	r0,r6
(2) 1407/ 6000D88 : 370C                		add	r0,r7
(2) 1408/ 6000D8A : 380C                		add	r0,r8
(2) 1409/ 6000D8C :                     ; 		shlr	r0
(2) 1410/ 6000D8C : 370C                		add	r0,r7
(2) 1411/ 6000D8E :                     ; 		add	r0,r8
(2) 1412/ 6000D8E : E0FC                		mov	#-4,r0	; align by 4
(2) 1413/ 6000D90 : 2509                		and	r0,r5
(2) 1414/ 6000D92 : 2709                		and	r0,r7
(2) 1415/ 6000D94 : 2609                		and	r0,r6
(2) 1416/ 6000D96 : 2809                		and	r0,r8
(2) 1417/ 6000D98 : 9136                		mov	#320+16,r1
(2) 1418/ 6000D9A : 9236                		mov	#224+16,r2
(2) 1419/ 6000D9C : 4715                		cmp/pl	r7
(2) 1420/ 6000D9E : 8B2B                		bf	.spr_out
(2) 1421/ 6000DA0 : 4815                		cmp/pl	r8
(2) 1422/ 6000DA2 : 8B29                		bf	.spr_out
(2) 1423/ 6000DA4 : 3513                		cmp/ge	r1,r5
(2) 1424/ 6000DA6 : 8927                		bt	.spr_out
(2) 1425/ 6000DA8 : 3623                		cmp/ge	r2,r6
(2) 1426/ 6000DAA : 8925                		bt	.spr_out
(2) 1427/ 6000DAC : 4511                		cmp/pz	r5
(2) 1428/ 6000DAE : 8900                		bt	.xl_l
(2) 1429/ 6000DB0 : 255A                		xor	r5,r5
(2) 1430/ 6000DB2 :                     .xl_l:
(2) 1431/ 6000DB2 : 4611                		cmp/pz	r6
(2) 1432/ 6000DB4 : 8900                		bt	.yl_l
(2) 1433/ 6000DB6 : 266A                		xor	r6,r6
(2) 1434/ 6000DB8 :                     .yl_l:
(2) 1435/ 6000DB8 : 3717                		cmp/gt	r1,r7
(2) 1436/ 6000DBA : 8B00                		bf	.xr_l
(2) 1437/ 6000DBC : 6713                		mov	r1,r7
(2) 1438/ 6000DBE :                     .xr_l:
(2) 1439/ 6000DBE : 3827                		cmp/gt	r2,r8
(2) 1440/ 6000DC0 : 8B00                		bf	.yr_l
(2) 1441/ 6000DC2 : 6823                		mov	r2,r8
(2) 1442/ 6000DC4 :                     .yr_l:
(2) 1443/ 6000DC4 : 26BE                		mulu	r11,r6
(2) 1444/ 6000DC6 : 001A                		sts	macl,r0
(2) 1445/ 6000DC8 : 340C                		add	r0,r4
(2) 1446/ 6000DCA :                     .y_lp:
(2) 1447/ 6000DCA : 34C7                		cmp/gt	r12,r4
(2) 1448/ 6000DCC : 8B00                		bf	.y_keep
(2) 1449/ 6000DCE : 34C8                		sub	r12,r4
(2) 1450/ 6000DD0 :                     .y_keep:
(2) 1451/ 6000DD0 :                     
(2) 1452/ 6000DD0 :                     	; r5 - X left
(2) 1453/ 6000DD0 :                     	; r6 - Y top
(2) 1454/ 6000DD0 :                     	; r7 - X right
(2) 1455/ 6000DD0 :                     	; r8 - Y bottom
(2) 1456/ 6000DD0 :                     	;
(2) 1457/ 6000DD0 :                     	; (Xend>>2)|$80,(Xstart>>2),Ybottom,Ytop
(2) 1458/ 6000DD0 : 6073                		mov	r7,r0
(2) 1459/ 6000DD2 : 4009                		shlr2	r0
(2) 1460/ 6000DD4 : 600C                		extu.b	r0,r0
(2) 1461/ 6000DD6 : CB80                		or	#$80,r0
(2) 1462/ 6000DD8 : 4028                		shll16	r0
(2) 1463/ 6000DDA : 4018                		shll8	r0
(2) 1464/ 6000DDC : 6253                		mov	r5,r2
(2) 1465/ 6000DDE : 4228                		shll16	r2
(2) 1466/ 6000DE0 : 4209                		shlr2	r2
(2) 1467/ 6000DE2 : 6303                		mov	r0,r3
(2) 1468/ 6000DE4 : 6063                		mov	r6,r0
(2) 1469/ 6000DE6 : 6183                		mov	r8,r1
(2) 1470/ 6000DE8 : 611C                		extu.b	r1,r1
(2) 1471/ 6000DEA : 4118                		shll8	r1
(2) 1472/ 6000DEC : C9FF                		and	#$FF,r0
(2) 1473/ 6000DEE : 203B                		or	r3,r0
(2) 1474/ 6000DF0 : 202B                		or	r2,r0
(2) 1475/ 6000DF2 : 201B                		or	r1,r0
(2) 1476/ 6000DF4 : 2D02                		mov	r0,@r13
(2) 1477/ 6000DF6 : 7D04                		add	#4,r13
(2) 1478/ 6000DF8 :                     .spr_out:
(2) 1479/ 6000DF8 : AFB6                		bra	.next_save
(2) 1480/ 6000DFA : 7E18                		add 	#sizeof_marsspr,r14
(2) 1481/ 6000DFC :                     .last:
(2) 1482/ 6000DFC : 000B                		rts
(2) 1483/ 6000DFE : 0009                		nop
(2) 1484/ 6000E00 :                     		align 4
(2) 1485/ 6000E00 : 2600 7300 C000 0438 		ltorg
                    0150 00F0           
(2) 1486/ 6000E0C :                     
(2) 1487/ 6000E0C :                     ; ; --------------------------------------------------------
(2) 1488/ 6000E0C :                     ; ; MarsVideo_DrawSuperSpr_M
(2) 1489/ 6000E0C :                     ; ;
(2) 1490/ 6000E0C :                     ; ; Draws the Super-sprites directly recieved on DREQ
(2) 1491/ 6000E0C :                     ; ;
(2) 1492/ 6000E0C :                     ; ; Call MarsVideo_MkSprCoords FIRST to setup the
(2) 1493/ 6000E0C :                     ; ; screen coordinates
(2) 1494/ 6000E0C :                     ; ;
(2) 1495/ 6000E0C :                     ; ; ** ONLY DRAWS THE TOP OF THE SCREEN, USE SLAVE
(2) 1496/ 6000E0C :                     ; ; SH2 TO DRAW FOR THE BOTTOM **
(2) 1497/ 6000E0C :                     ; ;
(2) 1498/ 6000E0C :                     ; ; Input:
(2) 1499/ 6000E0C :                     ; ; r14 - Super sprites data
(2) 1500/ 6000E0C :                     ; ;
(2) 1501/ 6000E0C :                     ; ; Breaks:
(2) 1502/ 6000E0C :                     ; ; ALL
(2) 1503/ 6000E0C :                     ; ; --------------------------------------------------------
(2) 1504/ 6000E0C :                     ;
(2) 1505/ 6000E0C :                     ; 		align 4
(2) 1506/ 6000E0C :                     ; MarsVideo_DrawSuperSpr_M:
(2) 1507/ 6000E0C :                     ; 		mov	#RAM_Mars_DreqRead+Dreq_SuperSpr,r14
(2) 1508/ 6000E0C :                     ; 		mov	#Cach_Intrl_W,r11
(2) 1509/ 6000E0C :                     ; 		mov	@r11,r11
(2) 1510/ 6000E0C :                     ; 		mov	#Cach_Intrl_Size,r10
(2) 1511/ 6000E0C :                     ; 		mov	@r10,r10
(2) 1512/ 6000E0C :                     ; 		nop
(2) 1513/ 6000E0C :                     ; MarsVideo_NxtSuprSpr:
(2) 1514/ 6000E0C :                     ; 		mov	@(marsspr_data,r14),r0
(2) 1515/ 6000E0C :                     ; 		tst	r0,r0
(2) 1516/ 6000E0C :                     ; 		bf	.valid
(2) 1517/ 6000E0C :                     ; 		rts
(2) 1518/ 6000E0C :                     ; 		nop
(2) 1519/ 6000E0C :                     ; 		align 4
(2) 1520/ 6000E0C :                     ; .valid:
(2) 1521/ 6000E0C :                     ; 		mov.w	@(marsspr_indx,r14),r0
(2) 1522/ 6000E0C :                     ; 		mov	r0,r12
(2) 1523/ 6000E0C :                     ; 		mov	@(marsspr_x,r14),r5	; XXXX YYYY
(2) 1524/ 6000E0C :                     ; 		exts.w	r5,r6
(2) 1525/ 6000E0C :                     ; 		mov	@(marsspr_xfrm,r14),r7	; ?? ?? XX YY
(2) 1526/ 6000E0C :                     ; 		shlr16	r5
(2) 1527/ 6000E0C :                     ; 		exts.w	r5,r5
(2) 1528/ 6000E0C :                     ; 		extu.b	r7,r8
(2) 1529/ 6000E0C :                     ; 		shlr8	r7
(2) 1530/ 6000E0C :                     ; 		extu.b	r7,r7
(2) 1531/ 6000E0C :                     ; ; 		mov.w	@(marsspr_x,r14),r0
(2) 1532/ 6000E0C :                     ; ; 		exts.w	r0,r5
(2) 1533/ 6000E0C :                     ; ; 		mov.w	@(marsspr_y,r14),r0
(2) 1534/ 6000E0C :                     ; ; 		exts.w	r0,r6
(2) 1535/ 6000E0C :                     ; ; 		mov.b	@(marsspr_xs,r14),r0
(2) 1536/ 6000E0C :                     ; ; 		exts.b	r0,r7
(2) 1537/ 6000E0C :                     ; ; 		mov.b	@(marsspr_ys,r14),r0
(2) 1538/ 6000E0C :                     ; ; 		exts.b	r0,r8
(2) 1539/ 6000E0C :                     ; 		mov	r7,r3			; Copy old XS / YS
(2) 1540/ 6000E0C :                     ; 		mov	r8,r4
(2) 1541/ 6000E0C :                     ; 		add	r5,r7
(2) 1542/ 6000E0C :                     ; 		add	r6,r8
(2) 1543/ 6000E0C :                     ;
(2) 1544/ 6000E0C :                     ; 		mov	#Cach_Intrl_H,r0
(2) 1545/ 6000E0C :                     ; 		mov	@r0,r0
(2) 1546/ 6000E0C :                     ; 		mov	#224,r0
(2) 1547/ 6000E0C :                     ; 		cmp/pl	r8
(2) 1548/ 6000E0C :                     ; 		bf	.spr_out
(2) 1549/ 6000E0C :                     ; 		cmp/pl	r7
(2) 1550/ 6000E0C :                     ; 		bf	.spr_out
(2) 1551/ 6000E0C :                     ; 		cmp/ge	r11,r5
(2) 1552/ 6000E0C :                     ; 		bt	.spr_out
(2) 1553/ 6000E0C :                     ; 		cmp/ge	r0,r6
(2) 1554/ 6000E0C :                     ; 		bt	.spr_out
(2) 1555/ 6000E0C :                     ; 	; XR / YB
(2) 1556/ 6000E0C :                     ; ; 		mov	#224,r0
(2) 1557/ 6000E0C :                     ; 		cmp/ge	r0,r8
(2) 1558/ 6000E0C :                     ; 		bf	.yb_e
(2) 1559/ 6000E0C :                     ; 		mov	r0,r8
(2) 1560/ 6000E0C :                     ; .yb_e:
(2) 1561/ 6000E0C :                     ; 		mov	#320,r0
(2) 1562/ 6000E0C :                     ; 		cmp/ge	r0,r7
(2) 1563/ 6000E0C :                     ; 		bf	.xb_e
(2) 1564/ 6000E0C :                     ; 		mov	r0,r7
(2) 1565/ 6000E0C :                     ; .xb_e:
(2) 1566/ 6000E0C :                     ;
(2) 1567/ 6000E0C :                     ; 		mov.w	@(marsspr_dwidth,r14),r0
(2) 1568/ 6000E0C :                     ; 		mov	r0,r1
(2) 1569/ 6000E0C :                     ; 		mov.w	@(marsspr_xfrm,r14),r0	; X frame
(2) 1570/ 6000E0C :                     ; 		mov	r0,r2
(2) 1571/ 6000E0C :                     ; 		mov	@(marsspr_data,r14),r13
(2) 1572/ 6000E0C :                     ; 		mulu	r1,r4
(2) 1573/ 6000E0C :                     ; 		sts	macl,r4
(2) 1574/ 6000E0C :                     ; 		extu.b	r0,r0
(2) 1575/ 6000E0C :                     ; 		mulu	r4,r0
(2) 1576/ 6000E0C :                     ; 		sts	macl,r0
(2) 1577/ 6000E0C :                     ; 		add	r0,r13
(2) 1578/ 6000E0C :                     ; 		mov	r2,r0
(2) 1579/ 6000E0C :                     ; 		shlr8	r0
(2) 1580/ 6000E0C :                     ; 		extu.b	r0,r0
(2) 1581/ 6000E0C :                     ; 		mulu	r3,r0
(2) 1582/ 6000E0C :                     ; 		sts	macl,r0
(2) 1583/ 6000E0C :                     ; 		add	r0,r13
(2) 1584/ 6000E0C :                     ;
(2) 1585/ 6000E0C :                     ; ; 		mov	#Cach_FbData,r2
(2) 1586/ 6000E0C :                     ; ; 		mov	@r2,r2
(2) 1587/ 6000E0C :                     ; ; 		mov	#_framebuffer,r0
(2) 1588/ 6000E0C :                     ; ; 		add	r2,r0
(2) 1589/ 6000E0C :                     ;
(2) 1590/ 6000E0C :                     ; 		mov	#RAM_Mars_SprData,r0
(2) 1591/ 6000E0C :                     ; 		lds	r0,mach
(2) 1592/ 6000E0C :                     ; 		mov.w	@(marsspr_dwidth,r14),r0
(2) 1593/ 6000E0C :                     ; 		extu.w	r0,r2
(2) 1594/ 6000E0C :                     ; 		mov.w	@(marsspr_flags,r14),r0
(2) 1595/ 6000E0C :                     ; 		tst	#%10,r0		; Y flip?
(2) 1596/ 6000E0C :                     ; 		bt	.flp_v
(2) 1597/ 6000E0C :                     ; 		add	r4,r13
(2) 1598/ 6000E0C :                     ; 		sub	r2,r13
(2) 1599/ 6000E0C :                     ; 		neg	r2,r2
(2) 1600/ 6000E0C :                     ; .flp_v:
(2) 1601/ 6000E0C :                     ; 		mov	#1,r4
(2) 1602/ 6000E0C :                     ; 		tst	#%01,r0		; X flip?
(2) 1603/ 6000E0C :                     ; 		bt	.flp_h
(2) 1604/ 6000E0C :                     ; 		add	r3,r13		; move beam
(2) 1605/ 6000E0C :                     ; 		mov	#-1,r4		; decrement line
(2) 1606/ 6000E0C :                     ; .flp_h:
(2) 1607/ 6000E0C :                     ; 		cmp/pz	r6
(2) 1608/ 6000E0C :                     ; 		bt	.yt_e
(2) 1609/ 6000E0C :                     ; 		neg	r6,r0
(2) 1610/ 6000E0C :                     ; 		xor	r6,r6
(2) 1611/ 6000E0C :                     ; 		muls	r0,r1
(2) 1612/ 6000E0C :                     ; 		sts	macl,r0
(2) 1613/ 6000E0C :                     ; 		cmp/pz	r2
(2) 1614/ 6000E0C :                     ; 		bt	.yfinc
(2) 1615/ 6000E0C :                     ; 		neg	r0,r0
(2) 1616/ 6000E0C :                     ; .yfinc:
(2) 1617/ 6000E0C :                     ; 		add	r0,r13
(2) 1618/ 6000E0C :                     ; .yt_e:
(2) 1619/ 6000E0C :                     ; 		cmp/pz	r5
(2) 1620/ 6000E0C :                     ; 		bt	.xt_e
(2) 1621/ 6000E0C :                     ; 		mov	r5,r9
(2) 1622/ 6000E0C :                     ; 		cmp/pz	r4
(2) 1623/ 6000E0C :                     ; 		bt	.xfinc
(2) 1624/ 6000E0C :                     ; 		neg	r9,r9
(2) 1625/ 6000E0C :                     ; .xfinc:
(2) 1626/ 6000E0C :                     ; 		sub	r9,r13
(2) 1627/ 6000E0C :                     ; 		xor	r5,r5
(2) 1628/ 6000E0C :                     ; .xt_e:
(2) 1629/ 6000E0C :                     ; 		extu.w	r4,r9
(2) 1630/ 6000E0C :                     ; 		shll16	r2
(2) 1631/ 6000E0C :                     ; 		or	r2,r9
(2) 1632/ 6000E0C :                     ; 		mov	#Cach_FbPos_Y,r4
(2) 1633/ 6000E0C :                     ; 		mov	#Cach_FbPos,r2
(2) 1634/ 6000E0C :                     ; 		mov	@r4,r4
(2) 1635/ 6000E0C :                     ; 		add	r6,r4
(2) 1636/ 6000E0C :                     ; ; 		cmp/ge	r10,r4
(2) 1637/ 6000E0C :                     ; ; 		bf	.y_snap
(2) 1638/ 6000E0C :                     ; ; 		sub	r10,r4
(2) 1639/ 6000E0C :                     ; ; .y_snap:
(2) 1640/ 6000E0C :                     ; 		mulu	r11,r4
(2) 1641/ 6000E0C :                     ; 		mov	@r2,r2
(2) 1642/ 6000E0C :                     ; 		sts	macl,r4
(2) 1643/ 6000E0C :                     ; 		add	r2,r4
(2) 1644/ 6000E0C :                     ;
(2) 1645/ 6000E0C :                     ; 	; mach - _framebuffer + base
(2) 1646/ 6000E0C :                     ; 	;  r14 - Sprite data
(2) 1647/ 6000E0C :                     ; 	;  r13 - Texture data
(2) 1648/ 6000E0C :                     ; 	;  r12 - Texture index
(2) 1649/ 6000E0C :                     ; 	;  r11 - Internal WIDTH
(2) 1650/ 6000E0C :                     ; 	;  r10 - Internal WIDTH+HEIGHT
(2) 1651/ 6000E0C :                     ; 	;   r9 - Spritesheet Ydraw direction | Xdraw direction
(2) 1652/ 6000E0C :                     ; 	;   r8 - Y End
(2) 1653/ 6000E0C :                     ; 	;   r7 - X End
(2) 1654/ 6000E0C :                     ; 	;   r6 - Y Start
(2) 1655/ 6000E0C :                     ; 	;   r5 - X Start
(2) 1656/ 6000E0C :                     ; 	;   r4 - FB output position
(2) 1657/ 6000E0C :                     ; 	;
(2) 1658/ 6000E0C :                     ; 	; *** start ***
(2) 1659/ 6000E0C :                     ; .y_loop:
(2) 1660/ 6000E0C :                     ; 		cmp/ge	r10,r4			; Wrap FB output
(2) 1661/ 6000E0C :                     ; 		bf	.y_max
(2) 1662/ 6000E0C :                     ; 		sub	r10,r4
(2) 1663/ 6000E0C :                     ; .y_max:
(2) 1664/ 6000E0C :                     ; 		mov	r13,r1			; r1 - Texture IN
(2) 1665/ 6000E0C :                     ; 		mov	r5,r2			; r2 - X counter
(2) 1666/ 6000E0C :                     ; .x_loop:
(2) 1667/ 6000E0C :                     ; 		sts	mach,r3			; r3 - Framebuffer + FbData
(2) 1668/ 6000E0C :                     ; 		add	r4,r3			; add top-left position
(2) 1669/ 6000E0C :                     ; 		add	r2,r3			; add X position
(2) 1670/ 6000E0C :                     ;
(2) 1671/ 6000E0C :                     ; 		mov.b	@r1,r0			; r0 - pixel
(2) 1672/ 6000E0C :                     ; 		tst	r0,r0			; blank pixel 0?
(2) 1673/ 6000E0C :                     ; 		bt	.blnk
(2) 1674/ 6000E0C :                     ; 		add	r12,r0			; add pixel increment
(2) 1675/ 6000E0C :                     ; .blnk:
(2) 1676/ 6000E0C :                     ; 		mov.b	r0,@r3			; Write pixel
(2) 1677/ 6000E0C :                     ; 		mov	#320,r0			; Check for hidden line (X < 320)
(2) 1678/ 6000E0C :                     ; 		cmp/ge	r2,r0
(2) 1679/ 6000E0C :                     ; 		bt	.ex_line
(2) 1680/ 6000E0C :                     ; 		mov.b	@r1,r0			; Repeat same thing but
(2) 1681/ 6000E0C :                     ; 		tst	r0,r0			; but add r12 to the
(2) 1682/ 6000E0C :                     ; 		bt	.blnk2			; destination
(2) 1683/ 6000E0C :                     ; 		add	r12,r0
(2) 1684/ 6000E0C :                     ; .blnk2:
(2) 1685/ 6000E0C :                     ; 		add	r10,r3
(2) 1686/ 6000E0C :                     ; 		mov.b	r0,@r3
(2) 1687/ 6000E0C :                     ; .ex_line:
(2) 1688/ 6000E0C :                     ; 		add	#1,r2			; Increment X pos
(2) 1689/ 6000E0C :                     ;
(2) 1690/ 6000E0C :                     ; 		mov	r9,r0
(2) 1691/ 6000E0C :                     ; 		exts.w	r0,r0
(2) 1692/ 6000E0C :                     ; 		cmp/ge	r7,r2
(2) 1693/ 6000E0C :                     ; 		bf/s	.x_loop
(2) 1694/ 6000E0C :                     ; 		add	r0,r1			; Increment texture pos
(2) 1695/ 6000E0C :                     ;
(2) 1696/ 6000E0C :                     ; 		mov	r9,r0
(2) 1697/ 6000E0C :                     ; 		shlr16	r0
(2) 1698/ 6000E0C :                     ; 		exts.w	r0,r0
(2) 1699/ 6000E0C :                     ; 		add	r0,r13			; Next texture line
(2) 1700/ 6000E0C :                     ; 		add	#1,r6			; Increment loop Y
(2) 1701/ 6000E0C :                     ; 		cmp/ge	r8,r6			; Y start > Y end?
(2) 1702/ 6000E0C :                     ; 		bf/s	.y_loop
(2) 1703/ 6000E0C :                     ; 		add	r11,r4			; Next FB top-left line
(2) 1704/ 6000E0C :                     ; .spr_out:
(2) 1705/ 6000E0C :                     ; 		bra	MarsVideo_NxtSuprSpr
(2) 1706/ 6000E0C :                     ; 		add 	#sizeof_marsspr,r14
(2) 1707/ 6000E0C :                     ; 		align 4
(2) 1708/ 6000E0C :                     ; 		ltorg
(2) 1709/ 6000E0C :                     ;
(2) 1710/ 6000E0C :                     ; ; --------------------------------------------------------
(2) 1711/ 6000E0C :                     ; ; MarsVideo_DrawBgSSpr
(2) 1712/ 6000E0C :                     ; ;
(2) 1713/ 6000E0C :                     ; ; Call this BEFORE updating Sprite info
(2) 1714/ 6000E0C :                     ; ; --------------------------------------------------------
(2) 1715/ 6000E0C :                     ;
(2) 1716/ 6000E0C :                     ; 		align 4
(2) 1717/ 6000E0C :                     ; MarsVideo_DrawBgSSpr:
(2) 1718/ 6000E0C :                     ; 		mov	#Cach_SprBoxList,r14
(2) 1719/ 6000E0C :                     ;
(2) 1720/ 6000E0C :                     ; 		mov	#Cach_Intrl_Size,r12
(2) 1721/ 6000E0C :                     ; 		mov	#Cach_FbPos,r10
(2) 1722/ 6000E0C :                     ; 		mov	#Cach_Intrl_W,r11
(2) 1723/ 6000E0C :                     ; 		mov	#Cach_FbPos_Y,r0
(2) 1724/ 6000E0C :                     ; 		mov	@r0,r0
(2) 1725/ 6000E0C :                     ; 		mov	#Cach_FbData,r9
(2) 1726/ 6000E0C :                     ; 		mov	@r9,r9
(2) 1727/ 6000E0C :                     ; 		mov	#_framebuffer,r1
(2) 1728/ 6000E0C :                     ; 		mov	@r11,r11
(2) 1729/ 6000E0C :                     ; 		mov	#-4,r2
(2) 1730/ 6000E0C :                     ; 		mov	@r10,r10
(2) 1731/ 6000E0C :                     ; 		add	r1,r9
(2) 1732/ 6000E0C :                     ; 		mov	@r12,r12
(2) 1733/ 6000E0C :                     ;
(2) 1734/ 6000E0C :                     ; ; 		mov	#RAM_Mars_ScrlBuff,r13
(2) 1735/ 6000E0C :                     ; ; 		mov	@(scrl_fbpos_y,r13),r0
(2) 1736/ 6000E0C :                     ; ; 		mov	#_framebuffer,r1
(2) 1737/ 6000E0C :                     ; ; 		mov	@(scrl_fbdata,r13),r9
(2) 1738/ 6000E0C :                     ; ; 		add	r1,r9
(2) 1739/ 6000E0C :                     ; ; 		mov	@(scrl_intrl_w,r13),r11
(2) 1740/ 6000E0C :                     ; ; 		mov	#-4,r2
(2) 1741/ 6000E0C :                     ; ; 		mov	@(scrl_fbpos,r13),r10
(2) 1742/ 6000E0C :                     ; ; 		and	r2,r0
(2) 1743/ 6000E0C :                     ; ; 		mov	@(scrl_intrl_size,r13),r12
(2) 1744/ 6000E0C :                     ;
(2) 1745/ 6000E0C :                     ; 		mulu	r0,r11
(2) 1746/ 6000E0C :                     ; 		sts	macl,r1
(2) 1747/ 6000E0C :                     ; 		mov	#RAM_Mars_ScrlData,r0
(2) 1748/ 6000E0C :                     ; 		add	r1,r10
(2) 1749/ 6000E0C :                     ; 		cmp/ge	r12,r10
(2) 1750/ 6000E0C :                     ; 		bf	.ygood
(2) 1751/ 6000E0C :                     ; 		sub	r12,r10
(2) 1752/ 6000E0C :                     ; .ygood:
(2) 1753/ 6000E0C :                     ; 		and	r2,r10
(2) 1754/ 6000E0C :                     ; 		lds	r0,mach
(2) 1755/ 6000E0C :                     ;
(2) 1756/ 6000E0C :                     ; .next_save:
(2) 1757/ 6000E0C :                     ; 		mov	@r14,r0
(2) 1758/ 6000E0C :                     ; 		cmp/pl	r0
(2) 1759/ 6000E0C :                     ; 		bt	.last
(2) 1760/ 6000E0C :                     ; 		mov	r10,r4
(2) 1761/ 6000E0C :                     ; 		mov	r0,r5
(2) 1762/ 6000E0C :                     ; 		mov	r0,r6
(2) 1763/ 6000E0C :                     ; 		mov	r0,r7
(2) 1764/ 6000E0C :                     ; 		mov	r0,r8
(2) 1765/ 6000E0C :                     ; 		xor	r0,r0
(2) 1766/ 6000E0C :                     ; 		mov	r0,@r14
(2) 1767/ 6000E0C :                     ; 		mov	#$7F,r0
(2) 1768/ 6000E0C :                     ; 		shlr16	r5
(2) 1769/ 6000E0C :                     ; 		shlr16	r7
(2) 1770/ 6000E0C :                     ; 		shlr8	r7
(2) 1771/ 6000E0C :                     ; 		and	r0,r5
(2) 1772/ 6000E0C :                     ; 		and	r0,r7
(2) 1773/ 6000E0C :                     ; 		shll2	r5
(2) 1774/ 6000E0C :                     ; 		shll2	r7
(2) 1775/ 6000E0C :                     ; 		shlr8	r8
(2) 1776/ 6000E0C :                     ; 		mov	#$FF,r0
(2) 1777/ 6000E0C :                     ; 		and	r0,r6
(2) 1778/ 6000E0C :                     ; 		and	r0,r8
(2) 1779/ 6000E0C :                     ; 		sub	r6,r8
(2) 1780/ 6000E0C :                     ; 		cmp/pl	r8
(2) 1781/ 6000E0C :                     ; 		bf	.spr_out
(2) 1782/ 6000E0C :                     ; 		mulu	r11,r6
(2) 1783/ 6000E0C :                     ; 		sts	macl,r0
(2) 1784/ 6000E0C :                     ; 		add	r0,r4
(2) 1785/ 6000E0C :                     ;
(2) 1786/ 6000E0C :                     ; 		mov	#320,r6
(2) 1787/ 6000E0C :                     ; .y_lp:
(2) 1788/ 6000E0C :                     ; 		mov	r5,r1
(2) 1789/ 6000E0C :                     ; 		mov	r4,r2
(2) 1790/ 6000E0C :                     ; 		add	r5,r2
(2) 1791/ 6000E0C :                     ; .x_lp:
(2) 1792/ 6000E0C :                     ; 		cmp/gt	r12,r2
(2) 1793/ 6000E0C :                     ; 		bf	.x_keep
(2) 1794/ 6000E0C :                     ; 		sub	r12,r2
(2) 1795/ 6000E0C :                     ; .x_keep:
(2) 1796/ 6000E0C :                     ; 		sts	mach,r13
(2) 1797/ 6000E0C :                     ; 		add	r2,r13
(2) 1798/ 6000E0C :                     ; 		mov	@r13+,r0
(2) 1799/ 6000E0C :                     ; ; 		or	r13,r0
(2) 1800/ 6000E0C :                     ;
(2) 1801/ 6000E0C :                     ; 		mov	r9,r3
(2) 1802/ 6000E0C :                     ; 		add	r2,r3
(2) 1803/ 6000E0C :                     ; 		mov	r0,@r3
(2) 1804/ 6000E0C :                     ; 		cmp/ge	r6,r2
(2) 1805/ 6000E0C :                     ; 		bt	.x_lrg
(2) 1806/ 6000E0C :                     ; 		add	r12,r3
(2) 1807/ 6000E0C :                     ; 		add	r12,r13
(2) 1808/ 6000E0C :                     ; 		mov	r0,@r3
(2) 1809/ 6000E0C :                     ; 		mov	r0,@r13
(2) 1810/ 6000E0C :                     ; .x_lrg:
(2) 1811/ 6000E0C :                     ; 		add	#4,r1
(2) 1812/ 6000E0C :                     ; 		cmp/ge	r7,r1
(2) 1813/ 6000E0C :                     ; 		bf/s	.x_lp
(2) 1814/ 6000E0C :                     ; 		add	#4,r2
(2) 1815/ 6000E0C :                     ; 		dt	r8
(2) 1816/ 6000E0C :                     ; 		bf/s	.y_lp
(2) 1817/ 6000E0C :                     ; 		add	r11,r4
(2) 1818/ 6000E0C :                     ; .spr_out:
(2) 1819/ 6000E0C :                     ; 		bra	.next_save
(2) 1820/ 6000E0C :                     ; 		add 	#4,r14
(2) 1821/ 6000E0C :                     ; .last:
(2) 1822/ 6000E0C :                     ; 		rts
(2) 1823/ 6000E0C :                     ; 		nop
(2) 1824/ 6000E0C :                     ; 		align 4
(2) 1825/ 6000E0C :                     ; 		ltorg
(2) 1826/ 6000E0C :                     
(2) 1827/ 6000E0C :                     ; ====================================================================
(2) 1828/ 6000E0C :                     ; ----------------------------------------------------------------
(2) 1829/ 6000E0C :                     ; 3D Section
(2) 1830/ 6000E0C :                     ;
(2) 1831/ 6000E0C :                     ; Nothing to see here (yet), all stuff is
(2) 1832/ 6000E0C :                     ; located at cache_m_3D.asm
(2) 1833/ 6000E0C :                     ; ----------------------------------------------------------------
(2) 1834/ 6000E0C :                     
(2) 1835/ 6000E0C :                     ; --------------------------------------------------------
(2) 1836/ 6000E0C :                     ; MarsMdl_MdlLoop
(2) 1837/ 6000E0C :                     ;
(2) 1838/ 6000E0C :                     ; Call this to start building the 3D objects
(2) 1839/ 6000E0C :                     ; --------------------------------------------------------
(2) 1840/ 6000E0C :                     
(2) 1841/ 6000E0C :                     		align 4
(2) 1842/ 6000E0C :                     MarsMdl_MdlLoop:
(2) 1843/ 6000E0C : 4F22                		sts	pr,@-r15
(2) 1844/ 6000E0E : EB00                		mov	#0,r11
(2) 1845/ 6000E10 : DD11                		mov 	#RAM_Mars_Polygons_0,r13
(2) 1846/ 6000E12 : DC12                		mov	#RAM_Mars_PlgnList_0,r12
(2) 1847/ 6000E14 : C50C                		mov.w   @(marsGbl_PolyBuffNum,gbr),r0
(2) 1848/ 6000E16 : C801                		tst     #1,r0
(2) 1849/ 6000E18 : 8901                		bt	.go_mdl
(2) 1850/ 6000E1A : DD11                		mov 	#RAM_Mars_Polygons_1,r13
(2) 1851/ 6000E1C : DC11                		mov	#RAM_Mars_PlgnList_1,r12
(2) 1852/ 6000E1E :                     .go_mdl:
(2) 1853/ 6000E1E : DE12                		mov	#RAM_Mars_Objects,r14
(2) 1854/ 6000E20 : EA10                		mov	#MAX_MODELS,r10
(2) 1855/ 6000E22 :                     .loop:
(2) 1856/ 6000E22 : 50E0                		mov	@(mdl_data,r14),r0		; Object model data == 0 or -1?
(2) 1857/ 6000E24 : 4015                		cmp/pl	r0
(2) 1858/ 6000E26 : 8B06                		bf	.invlid
(2) 1859/ 6000E28 : 902E                		mov	#MAX_FACES,r0
(2) 1860/ 6000E2A : 3B03                		cmp/ge	r0,r11
(2) 1861/ 6000E2C : 8903                		bt	.invlid
(2) 1862/ 6000E2E : D00F                		mov	#MarsMdl_ReadModel,r0
(2) 1863/ 6000E30 : 400B                		jsr	@r0
(2) 1864/ 6000E32 : 2FA6                		mov	r10,@-r15
(2) 1865/ 6000E34 : 6AF6                		mov	@r15+,r10
(2) 1866/ 6000E36 :                     .invlid:
(2) 1867/ 6000E36 : 4A10                		dt	r10
(2) 1868/ 6000E38 : 8FF3                		bf/s	.loop
(2) 1869/ 6000E3A : 7E18                		add	#sizeof_mdlobj,r14
(2) 1870/ 6000E3C :                     .skip:
(2) 1871/ 6000E3C : DE0C                		mov	#RAM_Mars_Polygons_0,r14
(2) 1872/ 6000E3E : DD0D                		mov	#RAM_Mars_PlgnList_0,r13
(2) 1873/ 6000E40 : DC0D                		mov 	#RAM_Mars_PlgnNum_0,r12
(2) 1874/ 6000E42 : C50C                		mov.w   @(marsGbl_PolyBuffNum,gbr),r0
(2) 1875/ 6000E44 : C801                		tst     #1,r0
(2) 1876/ 6000E46 : 8902                		bt	.page_2
(2) 1877/ 6000E48 : DE0C                		mov	#RAM_Mars_Polygons_1,r14
(2) 1878/ 6000E4A : DD0D                		mov	#RAM_Mars_PlgnList_1,r13
(2) 1879/ 6000E4C : DC0D                		mov 	#RAM_Mars_PlgnNum_1,r12
(2) 1880/ 6000E4E :                     .page_2:
(2) 1881/ 6000E4E : 2CB2                		mov	r11,@r12	; Save faces counter
(2) 1882/ 6000E50 :                     
(2) 1883/ 6000E50 :                     ; *** MOVED SORTING TO MASTER
(2) 1884/ 6000E50 :                     
(2) 1885/ 6000E50 :                     ; ; SELECTION SORT
(2) 1886/ 6000E50 :                     ; ; r14 - Polygon LIST temporal
(2) 1887/ 6000E50 :                     ; ; r13 - Polygon LIST top
(2) 1888/ 6000E50 :                     ; ; r12 - **
(2) 1889/ 6000E50 :                     ; ; r11 - Number of faces (MAIN)
(2) 1890/ 6000E50 :                     ; ; r10 - **
(2) 1891/ 6000E50 :                     ;
(2) 1892/ 6000E50 :                     ; 		cmp/pl	r11
(2) 1893/ 6000E50 :                     ; 		bf	.exit
(2) 1894/ 6000E50 :                     ; .roll:
(2) 1895/ 6000E50 :                     ; 		mov	r11,r10
(2) 1896/ 6000E50 :                     ; 		mov	r13,r14
(2) 1897/ 6000E50 :                     ; 		mov	@r14,r1		; r1 - Start value
(2) 1898/ 6000E50 :                     ; .srch:
(2) 1899/ 6000E50 :                     ; 		mov	@r14,r0
(2) 1900/ 6000E50 :                     ; 		cmp/gt	r1,r0
(2) 1901/ 6000E50 :                     ; 		bt	.higher
(2) 1902/ 6000E50 :                     ; 		mov	r0,r1		; Update LOW r1 value
(2) 1903/ 6000E50 :                     ; 		mov	r14,r5		; Save LOWER pointer
(2) 1904/ 6000E50 :                     ; .higher:
(2) 1905/ 6000E50 :                     ; 		dt	r10
(2) 1906/ 6000E50 :                     ; 		bf/s	.srch
(2) 1907/ 6000E50 :                     ; 		add	#8,r14
(2) 1908/ 6000E50 :                     ;
(2) 1909/ 6000E50 :                     ; ; 		mov	r13,r6
(2) 1910/ 6000E50 :                     ; 		mov	@r5+,r1		; Swap Z and pointers
(2) 1911/ 6000E50 :                     ; 		mov	@r5+,r2
(2) 1912/ 6000E50 :                     ; 		mov	@r13+,r3
(2) 1913/ 6000E50 :                     ; 		mov	@r13+,r4
(2) 1914/ 6000E50 :                     ; 		mov	r2,@-r13
(2) 1915/ 6000E50 :                     ; 		mov	r1,@-r13
(2) 1916/ 6000E50 :                     ; 		mov	r4,@-r5
(2) 1917/ 6000E50 :                     ; 		mov	r3,@-r5
(2) 1918/ 6000E50 :                     ; 		dt	r11
(2) 1919/ 6000E50 :                     ; 		bf/s	.roll
(2) 1920/ 6000E50 :                     ; 		add	#8,r13
(2) 1921/ 6000E50 :                     ; .exit:
(2) 1922/ 6000E50 :                     
(2) 1923/ 6000E50 : 4F26                		lds	@r15+,pr
(2) 1924/ 6000E52 : 000B                		rts
(2) 1925/ 6000E54 : 0009                		nop
(2) 1926/ 6000E56 :                     		align 4
(2) 1927/ 6000E58 : 2601 4340 2602 F000 		ltorg
                    2602 19A0 2603 0EA0 
                    2603 2D48 0600 0E8C 
                    2601 4340 2602 F000 
                    2603 2D40 2602 19A0 
                    2603 0EA0 2603 2D44 
                    03D4                
(2) 1928/ 6000E8A :                     
(2) 1929/ 6000E8A :                     ; ------------------------------------------------
(2) 1930/ 6000E8A :                     ; Read model
(2) 1931/ 6000E8A :                     ;
(2) 1932/ 6000E8A :                     ; r14 - Current model data
(2) 1933/ 6000E8A :                     ; r13 - Current polygon
(2) 1934/ 6000E8A :                     ; r12 - Z storage
(2) 1935/ 6000E8A :                     ; r11 - Used faces counter
(2) 1936/ 6000E8A :                     ; ------------------------------------------------
(2) 1937/ 6000E8A :                     
(2) 1938/ 6000E8A :                     ; 		dc.w 1,4
(2) 1939/ 6000E8A :                     ; 		dc.l .vert,.face,.vrtx,.mtrl
(2) 1940/ 6000E8A :                     ; .vert:	binclude "data/mars/objects/mdl/test/vert.bin"
(2) 1941/ 6000E8A :                     ; .face:	binclude "data/mars/objects/mdl/test/face.bin"
(2) 1942/ 6000E8A :                     ; .vrtx:	binclude "data/mars/objects/mdl/test/vrtx.bin"
(2) 1943/ 6000E8A :                     ; .mtrl:	include "data/mars/objects/mdl/test/mtrl.asm"
(2) 1944/ 6000E8A :                     ;
(2) 1945/ 6000E8A :                     		align 4
(2) 1946/ 6000E8C :                     MarsMdl_ReadModel:
(2) 1947/ 6000E8C : 4F22                		sts	pr,@-r15
(2) 1948/ 6000E8E :                     ; 		mov	#RAM_Mars_ObjCamera,r4
(2) 1949/ 6000E8E :                     ;
(2) 1950/ 6000E8E :                     ; 		mov	@(mdl_x_pos,r14),r0
(2) 1951/ 6000E8E :                     ; 		mov	@(cam_x_pos,r14),r4
(2) 1952/ 6000E8E :                     ; 		mov	#$1000*2,r1
(2) 1953/ 6000E8E :                     ; 		add	r4,r0
(2) 1954/ 6000E8E :                     ; 		cmp/ge	r1,r0
(2) 1955/ 6000E8E :                     ; 		bt	.dont_bld
(2) 1956/ 6000E8E :                     
(2) 1957/ 6000E8E :                     
(2) 1958/ 6000E8E : 5AE0                		mov	@(mdl_data,r14),r10	; r10 - Model header
(2) 1959/ 6000E90 : 0009                		nop
(2) 1960/ 6000E92 : 69A1                		mov.w	@r10,r9			;  r9 - Number of polygons of this model
(2) 1961/ 6000E94 : 699D                		extu.w	r9,r9
(2) 1962/ 6000E96 : 58A2                		mov 	@(8,r10),r8		;  r8 - face data
(2) 1963/ 6000E98 : 57A1                		mov	@(4,r10),r7		;  r7 - Vertex data
(2) 1964/ 6000E9A : 0009                		nop
(2) 1965/ 6000E9C :                     .next_face:
(2) 1966/ 6000E9C : 90DA                		mov	#MAX_FACES,r0
(2) 1967/ 6000E9E : 3B03                		cmp/ge	r0,r11
(2) 1968/ 6000EA0 : 8B02                		bf	.valid
(2) 1969/ 6000EA2 :                     .dont_bld:
(2) 1970/ 6000EA2 : 000B                		rts
(2) 1971/ 6000EA4 : 0009                		nop
(2) 1972/ 6000EA6 :                     		align 4
(2) 1973/ 6000EA8 :                     .valid:
(2) 1974/ 6000EA8 : 6085                		mov.w	@r8+,r0
(2) 1975/ 6000EAA : 6503                		mov	r0,r5			; r5 - Face type
(2) 1976/ 6000EAC : E604                		mov	#4,r6			; r6 - number of vertex (quad or tri)
(2) 1977/ 6000EAE : 4019                		shlr8	r0			;
(2) 1978/ 6000EB0 : C840                		tst	#PLGN_TRI,r0
(2) 1979/ 6000EB2 : 8900                		bt	.quad			; bit 0 = quad
(2) 1980/ 6000EB4 : 4610                		dt	r6
(2) 1981/ 6000EB6 :                     .quad:
(2) 1982/ 6000EB6 : 64D3                		mov	r13,r4
(2) 1983/ 6000EB8 : 4515                		cmp/pl	r5			; Solid or texture? ($8xxx)
(2) 1984/ 6000EBA : 8B0B                		bf	.has_uv
(2) 1985/ 6000EBC :                     
(2) 1986/ 6000EBC :                     ; --------------------------------
(2) 1987/ 6000EBC :                     ; Face is solid color
(2) 1988/ 6000EBC : 6053                		mov	r5,r0
(2) 1989/ 6000EBE : C9FF                		and	#$FF,r0
(2) 1990/ 6000EC0 : E360                		mov	#%01100000,r3
(2) 1991/ 6000EC2 : 4300                		shll	r3
(2) 1992/ 6000EC4 : 4318                		shll8	r3			; r1 - AND $C0 value
(2) 1993/ 6000EC6 : 2539                		and	r3,r5			; r0 - Grab settings, move to long MSB
(2) 1994/ 6000EC8 : 4528                		shll16	r5
(2) 1995/ 6000ECA : 1401                		mov	r0,@(polygn_mtrl,r4)
(2) 1996/ 6000ECC : 1450                		mov	r5,@(polygn_type,r4)
(2) 1997/ 6000ECE : A033                		bra	.mk_face
(2) 1998/ 6000ED0 : 0009                		nop
(2) 1999/ 6000ED2 :                     		align 4
(2) 2000/ 6000ED4 :                     
(2) 2001/ 6000ED4 :                     ; --------------------------------
(2) 2002/ 6000ED4 :                     ; Face has UV settings
(2) 2003/ 6000ED4 :                     
(2) 2004/ 6000ED4 :                     .has_uv:
(2) 2005/ 6000ED4 : 51A3                		mov	@($C,r10),r1		; r1 - Grab UV points
(2) 2006/ 6000ED6 : 6063                		mov	r6,r0
(2) 2007/ 6000ED8 : 62D3                		mov	r13,r2			; r2 - Output to polygon
(2) 2008/ 6000EDA : 7228                		add	#polygn_srcpnts,r2
(2) 2009/ 6000EDC : 8803                		cmp/eq	#3,r0			; Polygon is tri?
(2) 2010/ 6000EDE : 8905                		bt	.uv_tri
(2) 2011/ 6000EE0 : 6085                		mov.w	@r8+,r0			; Do extra quad point
(2) 2012/ 6000EE2 : 600D                		extu.w	r0,r0
(2) 2013/ 6000EE4 : 4008                		shll2	r0
(2) 2014/ 6000EE6 : 001E                		mov	@(r1,r0),r0
(2) 2015/ 6000EE8 : 2202                		mov	r0,@r2
(2) 2016/ 6000EEA : 7204                		add	#4,r2
(2) 2017/ 6000EEC :                     .uv_tri:
(2) 2018/ 6000EEC :                     	rept 3					; Grab UV points 3 times
(2) 2019/ 6000EEC :                     		mov.w	@r8+,r0
(2) 2020/ 6000EEC :                     		extu.w	r0,r0
(2) 2021/ 6000EEC :                     		shll2	r0
(2) 2022/ 6000EEC :                     		mov	@(r1,r0),r0
(2) 2023/ 6000EEC :                     		mov	r0,@r2
(2) 2024/ 6000EEC :                     		add	#4,r2
(2) 2025/ 6000EEC :                     	endm
(2) 2019/ 6000EEC : 6085                		mov.w	@r8+,r0
(2) 2020/ 6000EEE : 600D                		extu.w	r0,r0
(2) 2021/ 6000EF0 : 4008                		shll2	r0
(2) 2022/ 6000EF2 : 001E                		mov	@(r1,r0),r0
(2) 2023/ 6000EF4 : 2202                		mov	r0,@r2
(2) 2024/ 6000EF6 : 7204                		add	#4,r2
(2) 2019/ 6000EF8 : 6085                		mov.w	@r8+,r0
(2) 2020/ 6000EFA : 600D                		extu.w	r0,r0
(2) 2021/ 6000EFC : 4008                		shll2	r0
(2) 2022/ 6000EFE : 001E                		mov	@(r1,r0),r0
(2) 2023/ 6000F00 : 2202                		mov	r0,@r2
(2) 2024/ 6000F02 : 7204                		add	#4,r2
(2) 2019/ 6000F04 : 6085                		mov.w	@r8+,r0
(2) 2020/ 6000F06 : 600D                		extu.w	r0,r0
(2) 2021/ 6000F08 : 4008                		shll2	r0
(2) 2022/ 6000F0A : 001E                		mov	@(r1,r0),r0
(2) 2023/ 6000F0C : 2202                		mov	r0,@r2
(2) 2024/ 6000F0E : 7204                		add	#4,r2
(2) 2026/ 6000F10 : 51A4                		mov	@($10,r10),r1		; r1 - Read material list
(2) 2027/ 6000F12 : 6053                		mov	r5,r0			; r0 - Material slot
(2) 2028/ 6000F14 : C9FF                		and	#$FF,r0
(2) 2029/ 6000F16 : 4008                		shll2	r0			; *8
(2) 2030/ 6000F18 : 4000                		shll	r0
(2) 2031/ 6000F1A : 310C                		add	r0,r1			; Increment r1 into mtrl slot
(2) 2032/ 6000F1C : E360                		mov	#%01100000,r3
(2) 2033/ 6000F1E : 4300                		shll	r3
(2) 2034/ 6000F20 : 4318                		shll8	r3			; r1 - AND $C0 value
(2) 2035/ 6000F22 : 2539                		and	r3,r5			; r0 - Grab settings, move to long MSB
(2) 2036/ 6000F24 : 8512                		mov.w	@(4,r1),r0		; r0 - Texture
(2) 2037/ 6000F26 : 250B                		or	r0,r5
(2) 2038/ 6000F28 : 6312                		mov	@r1,r3			; r3 - Texture ROM pointer
(2) 2039/ 6000F2A : 4528                		shll16	r5
(2) 2040/ 6000F2C : 50E1                		mov	@(mdl_option,r14),r0
(2) 2041/ 6000F2E : 600C                		extu.b	r0,r0
(2) 2042/ 6000F30 : 1431                		mov	r3,@(polygn_mtrl,r4)
(2) 2043/ 6000F32 : 250B                		or	r0,r5
(2) 2044/ 6000F34 : 1450                		mov	r5,@(polygn_type,r4)
(2) 2045/ 6000F36 : 0009                		nop
(2) 2046/ 6000F38 :                     .mk_face:
(2) 2047/ 6000F38 : 200A                		xor	r0,r0
(2) 2048/ 6000F3A : 2C02                		mov	r0,@r12
(2) 2049/ 6000F3C : 1C01                		mov	r0,@(4,r12)
(2) 2050/ 6000F3E : 6143                		mov	r4,r1			; r1 - OUTPUT face (X/Y) points
(2) 2051/ 6000F40 : 7108                		add 	#polygn_points,r1
(2) 2052/ 6000F42 : 6063                		mov	r6,r0
(2) 2053/ 6000F44 : 8803                		cmp/eq	#3,r0			; Polygon is tri?
(2) 2054/ 6000F46 : 8912                		bt	.fc_tri
(2) 2055/ 6000F48 : 6085                		mov.w 	@r8+,r0
(2) 2056/ 6000F4A : E40C                		mov	#$C,r4
(2) 2057/ 6000F4C : 204E                		mulu	r4,r0
(2) 2058/ 6000F4E : 001A                		sts	macl,r0
(2) 2059/ 6000F50 : 6473                		mov	r7,r4
(2) 2060/ 6000F52 : 340C                		add 	r0,r4
(2) 2061/ 6000F54 : 6242                		mov	@r4,r2
(2) 2062/ 6000F56 : 0009                		nop
(2) 2063/ 6000F58 : 5341                		mov	@(4,r4),r3
(2) 2064/ 6000F5A : 5442                		mov	@(8,r4),r4
(2) 2065/ 6000F5C : B07C                		bsr	mdlrd_setpoint
(2) 2066/ 6000F5E : 0009                		nop
(2) 2067/ 6000F60 : 2122                		mov	r2,@r1
(2) 2068/ 6000F62 : 1131                		mov	r3,@(4,r1)
(2) 2069/ 6000F64 : 7108                		add	#8,r1
(2) 2070/ 6000F66 : 60C2                		mov	@r12,r0
(2) 2071/ 6000F68 : 3403                		cmp/ge	r0,r4
(2) 2072/ 6000F6A : 8900                		bt	.fc_tri	; ** bt .higher
(2) 2073/ 6000F6C : 2C42                		mov	r4,@r12
(2) 2074/ 6000F6E :                     .fc_tri:
(2) 2075/ 6000F6E :                     	rept 3
(2) 2076/ 6000F6E :                     		mov.w 	@r8+,r0			; Grab face index
(2) 2077/ 6000F6E :                     		mov	#$C,r4			; *** TODO: muliply on script later
(2) 2078/ 6000F6E :                     		mulu	r4,r0
(2) 2079/ 6000F6E :                     		sts	macl,r0
(2) 2080/ 6000F6E :                     		mov	r7,r4			; r2 - vertex data + index
(2) 2081/ 6000F6E :                     		add 	r0,r4
(2) 2082/ 6000F6E :                     		mov	@r4,r2
(2) 2083/ 6000F6E :                     		mov	@(4,r4),r3
(2) 2084/ 6000F6E :                     		mov	@(8,r4),r4
(2) 2085/ 6000F6E :                     		bsr	mdlrd_setpoint
(2) 2086/ 6000F6E :                     		nop
(2) 2087/ 6000F6E :                     		mov	r2,@r1			; Save X/Y into polygon
(2) 2088/ 6000F6E :                     		mov	r3,@(4,r1)
(2) 2089/ 6000F6E :                     		add	#8,r1
(2) 2090/ 6000F6E :                     		mov	@r12,r0
(2) 2091/ 6000F6E :                     		cmp/ge	r0,r4
(2) 2092/ 6000F6E :                     		dc.w $8900	; ** bt .higher
(2) 2093/ 6000F6E :                     		mov	r4,@r12
(2) 2094/ 6000F6E :                     ;.higher:
(2) 2095/ 6000F6E :                     	endm
(2) 2076/ 6000F6E : 6085                		mov.w 	@r8+,r0			; Grab face index
(2) 2077/ 6000F70 : E40C                		mov	#$C,r4			; *** TODO: muliply on script later
(2) 2078/ 6000F72 : 204E                		mulu	r4,r0
(2) 2079/ 6000F74 : 001A                		sts	macl,r0
(2) 2080/ 6000F76 : 6473                		mov	r7,r4			; r2 - vertex data + index
(2) 2081/ 6000F78 : 340C                		add 	r0,r4
(2) 2082/ 6000F7A : 6242                		mov	@r4,r2
(2) 2083/ 6000F7C : 5341                		mov	@(4,r4),r3
(2) 2084/ 6000F7E : 5442                		mov	@(8,r4),r4
(2) 2085/ 6000F80 : B06A                		bsr	mdlrd_setpoint
(2) 2086/ 6000F82 : 0009                		nop
(2) 2087/ 6000F84 : 2122                		mov	r2,@r1			; Save X/Y into polygon
(2) 2088/ 6000F86 : 1131                		mov	r3,@(4,r1)
(2) 2089/ 6000F88 : 7108                		add	#8,r1
(2) 2090/ 6000F8A : 60C2                		mov	@r12,r0
(2) 2091/ 6000F8C : 3403                		cmp/ge	r0,r4
(2) 2092/ 6000F8E : 8900                		dc.w $8900	; ** bt .higher
(2) 2093/ 6000F90 : 2C42                		mov	r4,@r12
(2) 2094/ 6000F92 :                     ;.higher:
(2) 2076/ 6000F92 : 6085                		mov.w 	@r8+,r0			; Grab face index
(2) 2077/ 6000F94 : E40C                		mov	#$C,r4			; *** TODO: muliply on script later
(2) 2078/ 6000F96 : 204E                		mulu	r4,r0
(2) 2079/ 6000F98 : 001A                		sts	macl,r0
(2) 2080/ 6000F9A : 6473                		mov	r7,r4			; r2 - vertex data + index
(2) 2081/ 6000F9C : 340C                		add 	r0,r4
(2) 2082/ 6000F9E : 6242                		mov	@r4,r2
(2) 2083/ 6000FA0 : 5341                		mov	@(4,r4),r3
(2) 2084/ 6000FA2 : 5442                		mov	@(8,r4),r4
(2) 2085/ 6000FA4 : B058                		bsr	mdlrd_setpoint
(2) 2086/ 6000FA6 : 0009                		nop
(2) 2087/ 6000FA8 : 2122                		mov	r2,@r1			; Save X/Y into polygon
(2) 2088/ 6000FAA : 1131                		mov	r3,@(4,r1)
(2) 2089/ 6000FAC : 7108                		add	#8,r1
(2) 2090/ 6000FAE : 60C2                		mov	@r12,r0
(2) 2091/ 6000FB0 : 3403                		cmp/ge	r0,r4
(2) 2092/ 6000FB2 : 8900                		dc.w $8900	; ** bt .higher
(2) 2093/ 6000FB4 : 2C42                		mov	r4,@r12
(2) 2094/ 6000FB6 :                     ;.higher:
(2) 2076/ 6000FB6 : 6085                		mov.w 	@r8+,r0			; Grab face index
(2) 2077/ 6000FB8 : E40C                		mov	#$C,r4			; *** TODO: muliply on script later
(2) 2078/ 6000FBA : 204E                		mulu	r4,r0
(2) 2079/ 6000FBC : 001A                		sts	macl,r0
(2) 2080/ 6000FBE : 6473                		mov	r7,r4			; r2 - vertex data + index
(2) 2081/ 6000FC0 : 340C                		add 	r0,r4
(2) 2082/ 6000FC2 : 6242                		mov	@r4,r2
(2) 2083/ 6000FC4 : 5341                		mov	@(4,r4),r3
(2) 2084/ 6000FC6 : 5442                		mov	@(8,r4),r4
(2) 2085/ 6000FC8 : B046                		bsr	mdlrd_setpoint
(2) 2086/ 6000FCA : 0009                		nop
(2) 2087/ 6000FCC : 2122                		mov	r2,@r1			; Save X/Y into polygon
(2) 2088/ 6000FCE : 1131                		mov	r3,@(4,r1)
(2) 2089/ 6000FD0 : 7108                		add	#8,r1
(2) 2090/ 6000FD2 : 60C2                		mov	@r12,r0
(2) 2091/ 6000FD4 : 3403                		cmp/ge	r0,r4
(2) 2092/ 6000FD6 : 8900                		dc.w $8900	; ** bt .higher
(2) 2093/ 6000FD8 : 2C42                		mov	r4,@r12
(2) 2094/ 6000FDA :                     ;.higher:
(2) 2096/ 6000FDA :                     
(2) 2097/ 6000FDA :                     	; *** Z-offscreen check***
(2) 2098/ 6000FDA : E1E4                		mov	#MAX_ZDIST>>8,r1
(2) 2099/ 6000FDC : 4118                		shll8	r1
(2) 2100/ 6000FDE : 4011                		cmp/pz	r0
(2) 2101/ 6000FE0 : 8930                		bt	.bad_face
(2) 2102/ 6000FE2 : 3013                		cmp/ge	r1,r0
(2) 2103/ 6000FE4 : 8B2E                		bf	.bad_face
(2) 2104/ 6000FE6 : 1CD1                		mov	r13,@(4,r12)
(2) 2105/ 6000FE8 :                     
(2) 2106/ 6000FE8 :                     ; 	; *** X/Y-offscreen check***
(2) 2107/ 6000FE8 : 460A                		lds	r6,mach
(2) 2108/ 6000FEA : 61D3                		mov	r13,r1
(2) 2109/ 6000FEC : 7108                		add	#polygn_points,r1
(2) 2110/ 6000FEE : 6212                		mov	@r1,r2
(2) 2111/ 6000FF0 : 6323                		mov	r2,r3
(2) 2112/ 6000FF2 : 9430                		mov	#-(320/2),r4
(2) 2113/ 6000FF4 : 654B                		neg	r4,r5
(2) 2114/ 6000FF6 :                     .nxt_x:
(2) 2115/ 6000FF6 : 6012                		mov	@r1,r0
(2) 2116/ 6000FF8 : 3043                		cmp/ge	r4,r0
(2) 2117/ 6000FFA : 8B00                		bf	.x_l
(2) 2118/ 6000FFC : 6203                		mov	r0,r2
(2) 2119/ 6000FFE :                     .x_l:
(2) 2120/ 6000FFE : 3053                		cmp/ge	r5,r0
(2) 2121/ 6001000 : 8900                		bt	.x_r
(2) 2122/ 6001002 : 6303                		mov	r0,r3
(2) 2123/ 6001004 :                     .x_r:
(2) 2124/ 6001004 : 4610                		dt	r6
(2) 2125/ 6001006 : 8FF6                		bf/s	.nxt_x
(2) 2126/ 6001008 : 7108                		add	#8,r1
(2) 2127/ 600100A : 060A                		sts	mach,r6
(2) 2128/ 600100C : 3243                		cmp/ge	r4,r2
(2) 2129/ 600100E : 8B19                		bf	.bad_face
(2) 2130/ 6001010 : 3353                		cmp/ge	r5,r3
(2) 2131/ 6001012 : 8917                		bt	.bad_face
(2) 2132/ 6001014 :                     
(2) 2133/ 6001014 :                     
(2) 2134/ 6001014 : 61D3                		mov	r13,r1
(2) 2135/ 6001016 : 710C                		add	#polygn_points+4,r1
(2) 2136/ 6001018 : 6212                		mov	@r1,r2
(2) 2137/ 600101A : 6323                		mov	r2,r3
(2) 2138/ 600101C : E490                		mov	#-(224/2),r4
(2) 2139/ 600101E : 654B                		neg	r4,r5
(2) 2140/ 6001020 :                     .nxt_y:
(2) 2141/ 6001020 : 6012                		mov	@r1,r0
(2) 2142/ 6001022 : 3043                		cmp/ge	r4,r0
(2) 2143/ 6001024 : 8B00                		bf	.y_l
(2) 2144/ 6001026 : 6203                		mov	r0,r2
(2) 2145/ 6001028 :                     .y_l:
(2) 2146/ 6001028 : 3053                		cmp/ge	r5,r0
(2) 2147/ 600102A : 8900                		bt	.y_r
(2) 2148/ 600102C : 6303                		mov	r0,r3
(2) 2149/ 600102E :                     .y_r:
(2) 2150/ 600102E : 4610                		dt	r6
(2) 2151/ 6001030 : 8FF6                		bf/s	.nxt_y
(2) 2152/ 6001032 : 7108                		add	#8,r1
(2) 2153/ 6001034 : 3243                		cmp/ge	r4,r2
(2) 2154/ 6001036 : 8B05                		bf	.bad_face
(2) 2155/ 6001038 : 3353                		cmp/ge	r5,r3
(2) 2156/ 600103A : 8903                		bt	.bad_face
(2) 2157/ 600103C :                     
(2) 2158/ 600103C :                     	; *** Validate face
(2) 2159/ 600103C : 7D38                		add	#sizeof_polygn,r13	; Next X/Y polygon
(2) 2160/ 600103E : 7C08                		add	#8,r12			; Next Z storage
(2) 2161/ 6001040 : 7B01                		add	#1,r11			; Mark as a valid face
(2) 2162/ 6001042 : 0009                		nop
(2) 2163/ 6001044 :                     .bad_face:
(2) 2164/ 6001044 : 4910                		dt	r9
(2) 2165/ 6001046 : 8901                		bt	.exit
(2) 2166/ 6001048 : AF28                		bra	.next_face
(2) 2167/ 600104A : 0009                		nop
(2) 2168/ 600104C :                     .exit:
(2) 2169/ 600104C :                     ; 		mov.w	@r10,r9			;  r9 - Number of polygons of this model
(2) 2170/ 600104C :                     ; 		extu.w	r9,r9
(2) 2171/ 600104C :                     ;
(2) 2172/ 600104C :                     ; 		dt	r9
(2) 2173/ 600104C :                     ; 		cmp/pl	r9
(2) 2174/ 600104C :                     ; 		bf	.exitn
(2) 2175/ 600104C :                     ; .roll:
(2) 2176/ 600104C :                     ; 		xor	r8,r8
(2) 2177/ 600104C :                     ; 		mov	r12,r7
(2) 2178/ 600104C :                     ; 		mov	r9,r10
(2) 2179/ 600104C :                     ; .next:
(2) 2180/ 600104C :                     ; 		mov	r7,r0
(2) 2181/ 600104C :                     ; 		mov	@r0+,r1		; Z top
(2) 2182/ 600104C :                     ; 		mov	@r0+,r2
(2) 2183/ 600104C :                     ; 		mov	@r0+,r3		; Z bottom
(2) 2184/ 600104C :                     ; 		mov	@r0+,r4
(2) 2185/ 600104C :                     ; 		cmp/gt	r3,r1
(2) 2186/ 600104C :                     ; 		bf	.higher
(2) 2187/ 600104C :                     ; 		mov	r2,@-r0
(2) 2188/ 600104C :                     ; 		mov	r1,@-r0
(2) 2189/ 600104C :                     ; 		mov	r4,@-r0
(2) 2190/ 600104C :                     ; 		mov	r3,@-r0
(2) 2191/ 600104C :                     ; 		add	#1,r8
(2) 2192/ 600104C :                     ; .higher:
(2) 2193/ 600104C :                     ; 		dt	r10
(2) 2194/ 600104C :                     ; 		bf/s	.next
(2) 2195/ 600104C :                     ; 		add	#8,r7
(2) 2196/ 600104C :                     ; 		tst	r8,r8
(2) 2197/ 600104C :                     ; 		bf	.roll
(2) 2198/ 600104C :                     ; .exitn:
(2) 2199/ 600104C :                     
(2) 2200/ 600104C : 4F26                		lds	@r15+,pr
(2) 2201/ 600104E : 000B                		rts
(2) 2202/ 6001050 : 0009                		nop
(2) 2203/ 6001052 :                     		align 4
(2) 2204/ 6001054 : 03D4 FF60           		ltorg
(2) 2205/ 6001058 :                     
(2) 2206/ 6001058 :                     ; ----------------------------------------
(2) 2207/ 6001058 :                     ; Modify position to current point
(2) 2208/ 6001058 :                     ; ----------------------------------------
(2) 2209/ 6001058 :                     
(2) 2210/ 6001058 :                     ; r2 - X
(2) 2211/ 6001058 :                     ; r3 - Y
(2) 2212/ 6001058 :                     ; r4 - Z
(2) 2213/ 6001058 :                     mdlrd_setpoint:
(2) 2214/ 6001058 :                     ; 		mov	#Cach_BkupPnt_S,r0
(2) 2215/ 6001058 : 4F22                		sts	pr,@-r15
(2) 2216/ 600105A : 2F56                		mov 	r5,@-r15
(2) 2217/ 600105C : 2F66                		mov 	r6,@-r15
(2) 2218/ 600105E : 2F76                		mov 	r7,@-r15
(2) 2219/ 6001060 : 2F86                		mov 	r8,@-r15
(2) 2220/ 6001062 : 2F96                		mov 	r9,@-r15
(2) 2221/ 6001064 : 2FA6                		mov 	r10,@-r15
(2) 2222/ 6001066 : 2FB6                		mov 	r11,@-r15
(2) 2223/ 6001068 :                     
(2) 2224/ 6001068 :                     	; Object rotation
(2) 2225/ 6001068 : 6523                		mov	r2,r5			; r5 - X
(2) 2226/ 600106A : 6643                		mov	r4,r6			; r6 - Z
(2) 2227/ 600106C : 85E7                  		mov.w 	@(mdl_x_rot,r14),r0
(2) 2228/ 600106E : B055                  		bsr	mdlrd_rotate
(2) 2229/ 6001070 : 4009                  		shlr2	r0
(2) 2230/ 6001072 : 6273                   		mov	r7,r2
(2) 2231/ 6001074 : 6533                   		mov	r3,r5
(2) 2232/ 6001076 : 6683                  		mov	r8,r6
(2) 2233/ 6001078 : 85E9                  		mov.w	@(mdl_z_rot,r14),r0
(2) 2234/ 600107A : 4001                  		shlr	r0
(2) 2235/ 600107C : B04E                  		bsr	mdlrd_rotate
(2) 2236/ 600107E : 4009                  		shlr2	r0
(2) 2237/ 6001080 : 6483                   		mov	r8,r4
(2) 2238/ 6001082 : 6523                   		mov	r2,r5
(2) 2239/ 6001084 : 6673                   		mov	r7,r6
(2) 2240/ 6001086 : 85E8                   		mov.w	@(mdl_y_rot,r14),r0
(2) 2241/ 6001088 : 4001                  		shlr	r0
(2) 2242/ 600108A : B047                  		bsr	mdlrd_rotate
(2) 2243/ 600108C : 4009                  		shlr2	r0
(2) 2244/ 600108E : 6273                   		mov	r7,r2
(2) 2245/ 6001090 : 6383                   		mov	r8,r3
(2) 2246/ 6001092 : 85E4                		mov.w	@(mdl_x_pos,r14),r0
(2) 2247/ 6001094 : 650F                		exts.w	r0,r5
(2) 2248/ 6001096 : 85E5                		mov.w	@(mdl_y_pos,r14),r0
(2) 2249/ 6001098 : 660F                		exts.w	r0,r6
(2) 2250/ 600109A : 85E6                		mov.w	@(mdl_z_pos,r14),r0
(2) 2251/ 600109C : 670F                		exts.w	r0,r7
(2) 2252/ 600109E :                     ;  		shar	r5
(2) 2253/ 600109E :                     ;  		shar	r6
(2) 2254/ 600109E :                     ;  		shar	r7
(2) 2255/ 600109E : 325C                		add 	r5,r2
(2) 2256/ 60010A0 : 336C                		add 	r6,r3
(2) 2257/ 60010A2 : 347C                		add 	r7,r4
(2) 2258/ 60010A4 :                     
(2) 2259/ 60010A4 :                     	; Include camera changes
(2) 2260/ 60010A4 :                     ; 		mov 	#RAM_Mars_DreqRead+Dreq_ObjCam,r11
(2) 2261/ 60010A4 : DB2B                		mov	#RAM_Mars_ObjCamera,r11
(2) 2262/ 60010A6 : 55B0                		mov	@(cam_x_pos,r11),r5
(2) 2263/ 60010A8 : 56B1                		mov	@(cam_y_pos,r11),r6
(2) 2264/ 60010AA : 57B2                		mov	@(cam_z_pos,r11),r7
(2) 2265/ 60010AC :                     ; 		shlr	r5
(2) 2266/ 60010AC :                     ; 		shlr	r6
(2) 2267/ 60010AC :                     ; 		shlr	r7
(2) 2268/ 60010AC : 655F                		exts	r5,r5
(2) 2269/ 60010AE : 666F                		exts	r6,r6
(2) 2270/ 60010B0 : 677F                		exts	r7,r7
(2) 2271/ 60010B2 : 3258                		sub 	r5,r2
(2) 2272/ 60010B4 : 3368                		sub 	r6,r3
(2) 2273/ 60010B6 : 347C                		add 	r7,r4
(2) 2274/ 60010B8 :                     
(2) 2275/ 60010B8 : 6523                		mov	r2,r5
(2) 2276/ 60010BA : 6643                		mov	r4,r6
(2) 2277/ 60010BC : 50B3                  		mov 	@(cam_x_rot,r11),r0
(2) 2278/ 60010BE : B02D                  		bsr	mdlrd_rotate
(2) 2279/ 60010C0 : 4009                		shlr2	r0
(2) 2280/ 60010C2 : 6273                   		mov	r7,r2
(2) 2281/ 60010C4 : 6483                   		mov	r8,r4
(2) 2282/ 60010C6 : 6533                   		mov	r3,r5
(2) 2283/ 60010C8 : 6683                  		mov	r8,r6
(2) 2284/ 60010CA : 50B4                  		mov 	@(cam_y_rot,r11),r0
(2) 2285/ 60010CC : B026                  		bsr	mdlrd_rotate
(2) 2286/ 60010CE : 4009                		shlr2	r0
(2) 2287/ 60010D0 : 6483                   		mov	r8,r4
(2) 2288/ 60010D2 : 6523                   		mov	r2,r5
(2) 2289/ 60010D4 : 6673                   		mov	r7,r6
(2) 2290/ 60010D6 : 50B5                   		mov 	@(cam_z_rot,r11),r0
(2) 2291/ 60010D8 : B020                  		bsr	mdlrd_rotate
(2) 2292/ 60010DA : 4009                		shlr2	r0
(2) 2293/ 60010DC : 6273                   		mov	r7,r2
(2) 2294/ 60010DE : 6383                   		mov	r8,r3
(2) 2295/ 60010E0 :                     
(2) 2296/ 60010E0 :                     	; Weak perspective projection
(2) 2297/ 60010E0 :                     	; this is the best I got,
(2) 2298/ 60010E0 :                     	; It breaks on large faces
(2) 2299/ 60010E0 : D71D                		mov	#320<<16,r7
(2) 2300/ 60010E2 : 684B                		neg	r4,r8		; reverse Z
(2) 2301/ 60010E4 : 4815                		cmp/pl	r8
(2) 2302/ 60010E6 : 8902                		bt	.inside
(2) 2303/ 60010E8 : 4709                		shlr2	r7
(2) 2304/ 60010EA : A005                		bra	.zmulti
(2) 2305/ 60010EC : 4709                		shlr2	r7
(2) 2306/ 60010EE :                     .inside:
(2) 2307/ 60010EE :                     ; 		mov	#1,r0	; *** MASTER ONLY
(2) 2308/ 60010EE :                     ; 		mov.w	r0,@(marsGbl_WdgDivLock,gbr)
(2) 2309/ 60010EE : 9939                		mov 	#_JR,r9
(2) 2310/ 60010F0 : 2982                		mov 	r8,@r9
(2) 2311/ 60010F2 : 1971                		mov 	r7,@(4,r9)
(2) 2312/ 60010F4 : 0009                		nop
(2) 2313/ 60010F6 : 5791                		mov 	@(4,r9),r7
(2) 2314/ 60010F8 :                     ; 		xor	r0,r0	; *** MASTER ONLY
(2) 2315/ 60010F8 :                     ; 		mov.w	r0,@(marsGbl_WdgDivLock,gbr)
(2) 2316/ 60010F8 :                     .zmulti:
(2) 2317/ 60010F8 : 327D                		dmuls	r7,r2
(2) 2318/ 60010FA : 000A                		sts	mach,r0
(2) 2319/ 60010FC : 021A                		sts	macl,r2
(2) 2320/ 60010FE : 220D                		xtrct	r0,r2
(2) 2321/ 6001100 : 337D                		dmuls	r7,r3
(2) 2322/ 6001102 : 000A                		sts	mach,r0
(2) 2323/ 6001104 : 031A                		sts	macl,r3
(2) 2324/ 6001106 : 230D                		xtrct	r0,r3
(2) 2325/ 6001108 :                     
(2) 2326/ 6001108 :                     ; 		mov	#Cach_BkupPnt_L,r0
(2) 2327/ 6001108 : 6BF6                		mov	@r15+,r11
(2) 2328/ 600110A : 6AF6                		mov	@r15+,r10
(2) 2329/ 600110C : 69F6                		mov	@r15+,r9
(2) 2330/ 600110E : 68F6                		mov	@r15+,r8
(2) 2331/ 6001110 : 67F6                		mov	@r15+,r7
(2) 2332/ 6001112 : 66F6                		mov	@r15+,r6
(2) 2333/ 6001114 : 65F6                		mov	@r15+,r5
(2) 2334/ 6001116 : 4F26                		lds	@r15+,pr
(2) 2335/ 6001118 :                     
(2) 2336/ 6001118 :                     ; 	; Set the most far points
(2) 2337/ 6001118 :                     ; 	; for each direction (X,Y,Z)
(2) 2338/ 6001118 :                     ; 		cmp/gt	r13,r4
(2) 2339/ 6001118 :                     ; 		bf	.save_z2
(2) 2340/ 6001118 :                     ; 		mov	r4,r13
(2) 2341/ 6001118 :                     ; .save_z2:
(2) 2342/ 6001118 :                     ; 		cmp/gt	r5,r4
(2) 2343/ 6001118 :                     ; 		bt	.save_z
(2) 2344/ 6001118 :                     ; 		mov	r4,r5
(2) 2345/ 6001118 :                     ; .save_z:
(2) 2346/ 6001118 :                     ; 		cmp/gt	r8,r2
(2) 2347/ 6001118 :                     ; 		bf	.x_lw
(2) 2348/ 6001118 :                     ; 		mov	r2,r8
(2) 2349/ 6001118 :                     ; .x_lw:
(2) 2350/ 6001118 :                     ; 		cmp/gt	r9,r2
(2) 2351/ 6001118 :                     ; 		bt	.x_rw
(2) 2352/ 6001118 :                     ; 		mov	r2,r9
(2) 2353/ 6001118 :                     ; .x_rw:
(2) 2354/ 6001118 :                     ; 		cmp/gt	r11,r3
(2) 2355/ 6001118 :                     ; 		bf	.y_lw
(2) 2356/ 6001118 :                     ; 		mov	r3,r11
(2) 2357/ 6001118 :                     ; .y_lw:
(2) 2358/ 6001118 :                     ; 		cmp/gt	r12,r3
(2) 2359/ 6001118 :                     ; 		bt	.y_rw
(2) 2360/ 6001118 :                     ; 		mov	r3,r12
(2) 2361/ 6001118 :                     ; .y_rw:
(2) 2362/ 6001118 : 000B                		rts
(2) 2363/ 600111A : 0009                		nop
(2) 2364/ 600111C :                     		align 4
(2) 2365/ 600111C :                     
(2) 2366/ 600111C :                     ; ------------------------------
(2) 2367/ 600111C :                     ; Rotate point
(2) 2368/ 600111C :                     ;
(2) 2369/ 600111C :                     ; Entry:
(2) 2370/ 600111C :                     ; r5: x
(2) 2371/ 600111C :                     ; r6: y
(2) 2372/ 600111C :                     ; r0: theta
(2) 2373/ 600111C :                     ;
(2) 2374/ 600111C :                     ; Returns:
(2) 2375/ 600111C :                     ; r7: (x  cos @) + (y sin @)
(2) 2376/ 600111C :                     ; r8: (x -sin @) + (y cos @)
(2) 2377/ 600111C :                     ; ------------------------------
(2) 2378/ 600111C :                     
(2) 2379/ 600111C :                     		align 4
(2) 2380/ 600111C :                     mdlrd_rotate:
(2) 2381/ 600111C : 9723                    		mov	#$7FF,r7
(2) 2382/ 600111E : 2079                    		and	r7,r0
(2) 2383/ 6001120 : 4008                   		shll2	r0
(2) 2384/ 6001122 : D70E                		mov	#sin_table,r7
(2) 2385/ 6001124 : D80E                		mov	#sin_table+$800,r8
(2) 2386/ 6001126 : 097E                		mov	@(r0,r7),r9
(2) 2387/ 6001128 : 0A8E                		mov	@(r0,r8),r10
(2) 2388/ 600112A :                     
(2) 2389/ 600112A : 3A5D                		dmuls	r5,r10		; x cos @
(2) 2390/ 600112C : 071A                		sts	macl,r7
(2) 2391/ 600112E : 000A                		sts	mach,r0
(2) 2392/ 6001130 : 270D                		xtrct	r0,r7
(2) 2393/ 6001132 : 396D                		dmuls	r6,r9		; y sin @
(2) 2394/ 6001134 : 081A                		sts	macl,r8
(2) 2395/ 6001136 : 000A                		sts	mach,r0
(2) 2396/ 6001138 : 280D                		xtrct	r0,r8
(2) 2397/ 600113A : 378C                		add	r8,r7
(2) 2398/ 600113C :                     
(2) 2399/ 600113C : 699B                		neg	r9,r9
(2) 2400/ 600113E : 395D                		dmuls	r5,r9		; x -sin @
(2) 2401/ 6001140 : 081A                		sts	macl,r8
(2) 2402/ 6001142 : 000A                		sts	mach,r0
(2) 2403/ 6001144 : 280D                		xtrct	r0,r8
(2) 2404/ 6001146 : 3A6D                		dmuls	r6,r10		; y cos @
(2) 2405/ 6001148 : 091A                		sts	macl,r9
(2) 2406/ 600114A : 000A                		sts	mach,r0
(2) 2407/ 600114C : 290D                		xtrct	r0,r9
(2) 2408/ 600114E : 389C                		add	r9,r8
(2) 2409/ 6001150 : 000B                 		rts
(2) 2410/ 6001152 : 0009                		nop
(2) 2411/ 6001154 :                     		align 4
(2) 2412/ 6001154 : 2603 2EC8 0140 0000 		ltorg
                    0600 288C 0600 308C 
                    FF00 07FF           
(2) 2413/ 6001168 :                     
(2) 2414/ 6001168 :                     ; ; ------------------------------------------------
(2) 2415/ 6001168 :                     ; ; Read model OLD
(2) 2416/ 6001168 :                     ; ; ------------------------------------------------
(2) 2417/ 6001168 :                     ;
(2) 2418/ 6001168 :                     ; 		align 4
(2) 2419/ 6001168 :                     ; MarsMdl_ReadModel:
(2) 2420/ 6001168 :                     ; 		sts	pr,@-r15
(2) 2421/ 6001168 :                     ;
(2) 2422/ 6001168 :                     ; 		mov	#Cach_CurrPlygn,r13		; r13 - temporal face output
(2) 2423/ 6001168 :                     ; 		mov	@(mdl_data,r14),r12		; r12 - model header
(2) 2424/ 6001168 :                     ; 		mov 	@(8,r12),r11			; r11 - face data
(2) 2425/ 6001168 :                     ; 		mov 	@(4,r12),r10			; r10 - vertice data (X,Y,Z)
(2) 2426/ 6001168 :                     ; 		mov.w	@r12,r9				;  r9 - Number of faces used on model
(2) 2427/ 6001168 :                     ; 		mov	@(marsGbl_CurrZList,gbr),r0	;  r8 - Zlist for sorting
(2) 2428/ 6001168 :                     ; 		mov	r0,r8
(2) 2429/ 6001168 :                     ; .next_face:
(2) 2430/ 6001168 :                     ; 		mov.w	@(marsGbl_CurrNumFaces,gbr),r0	; Ran out of face storage?
(2) 2431/ 6001168 :                     ; 		mov	.tag_maxfaces,r1
(2) 2432/ 6001168 :                     ; 		cmp/gt	r1,r0
(2) 2433/ 6001168 :                     ; 		bf	.can_build
(2) 2434/ 6001168 :                     ; .no_model:
(2) 2435/ 6001168 :                     ; 		bra	.exit_model
(2) 2436/ 6001168 :                     ; 		nop
(2) 2437/ 6001168 :                     ; 		align 4
(2) 2438/ 6001168 :                     ; .tag_maxfaces:	dc.l	MAX_FACES
(2) 2439/ 6001168 :                     ;
(2) 2440/ 6001168 :                     ; ; --------------------------------
(2) 2441/ 6001168 :                     ;
(2) 2442/ 6001168 :                     ; .can_build:
(2) 2443/ 6001168 :                     ; 		mov.w	@r11+,r4		; Read type
(2) 2444/ 6001168 :                     ; 		nop
(2) 2445/ 6001168 :                     ; 		mov	#3,r7			; r7 - Current polygon type: triangle (3)
(2) 2446/ 6001168 :                     ; 		mov	r4,r0
(2) 2447/ 6001168 :                     ; 		shlr8	r0
(2) 2448/ 6001168 :                     ; 		tst	#PLGN_TRI,r0		; Model face uses triangle?
(2) 2449/ 6001168 :                     ; 		bf	.set_tri
(2) 2450/ 6001168 :                     ; 		add	#1,r7			; Face is quad, r7 = 4 points
(2) 2451/ 6001168 :                     ; .set_tri:
(2) 2452/ 6001168 :                     ; 		cmp/pl	r4			; Faces uses texture? ($8xxx)
(2) 2453/ 6001168 :                     ; 		bt	.solid_type
(2) 2454/ 6001168 :                     ;
(2) 2455/ 6001168 :                     ; ; --------------------------------
(2) 2456/ 6001168 :                     ; ; Set texture material
(2) 2457/ 6001168 :                     ; ; --------------------------------
(2) 2458/ 6001168 :                     ;
(2) 2459/ 6001168 :                     ; 		mov	@($C,r12),r6		; r6 - Material data
(2) 2460/ 6001168 :                     ; 		mov	r13,r5			; r5 - Go to UV section
(2) 2461/ 6001168 :                     ; 		add 	#polygn_srcpnts,r5
(2) 2462/ 6001168 :                     ; 	rept 3
(2) 2463/ 6001168 :                     ; 		mov.w	@r11+,r0		; Read UV index
(2) 2464/ 6001168 :                     ; 		extu.w	r0,r0
(2) 2465/ 6001168 :                     ; 		shll2	r0
(2) 2466/ 6001168 :                     ; 		mov	@(r6,r0),r0
(2) 2467/ 6001168 :                     ; 		mov.w	r0,@(2,r5)
(2) 2468/ 6001168 :                     ; 		shlr16	r0
(2) 2469/ 6001168 :                     ; 		mov.w	r0,@r5
(2) 2470/ 6001168 :                     ; 		add	#4,r5
(2) 2471/ 6001168 :                     ; 	endm
(2) 2472/ 6001168 :                     ; 		mov	r7,r0			; Triangle?
(2) 2473/ 6001168 :                     ; 		cmp/eq	#3,r0
(2) 2474/ 6001168 :                     ; 		bt	.alluvdone		; If yes, skip this
(2) 2475/ 6001168 :                     ; 		nop
(2) 2476/ 6001168 :                     ; 		mov.w	@r11+,r0		; Read extra UV index
(2) 2477/ 6001168 :                     ; 		extu.w	r0,r0
(2) 2478/ 6001168 :                     ; 		shll2	r0
(2) 2479/ 6001168 :                     ; 		mov	@(r6,r0),r0
(2) 2480/ 6001168 :                     ; 		mov.w	r0,@(2,r5)
(2) 2481/ 6001168 :                     ; 		shlr16	r0
(2) 2482/ 6001168 :                     ; 		mov.w	r0,@r5
(2) 2483/ 6001168 :                     ; .alluvdone:
(2) 2484/ 6001168 :                     ; 		mov	#-1,r5
(2) 2485/ 6001168 :                     ; 		extu.b	r5,r5			; $FF
(2) 2486/ 6001168 :                     ; 		mov	@(mdl_option,r14),r0
(2) 2487/ 6001168 :                     ; 		extu.b	r0,r0
(2) 2488/ 6001168 :                     ; 		mov	r0,r1
(2) 2489/ 6001168 :                     ; 		mov	r4,r0
(2) 2490/ 6001168 :                     ; 		and	r5,r0
(2) 2491/ 6001168 :                     ; 		shll2	r0
(2) 2492/ 6001168 :                     ; 		mov	@($10,r12),r6
(2) 2493/ 6001168 :                     ; 		shll	r0
(2) 2494/ 6001168 :                     ; 		add	r0,r6
(2) 2495/ 6001168 :                     ; ; 		mov	#$C000,r0
(2) 2496/ 6001168 :                     ; 		mov	#$60,r0		; grab special bits ($C000)
(2) 2497/ 6001168 :                     ; 		shll	r0
(2) 2498/ 6001168 :                     ; 		shll8	r0
(2) 2499/ 6001168 :                     ; 		and	r0,r4
(2) 2500/ 6001168 :                     ; 		shll16	r4
(2) 2501/ 6001168 :                     ; 		mov	@(4,r6),r0
(2) 2502/ 6001168 :                     ; 		or	r0,r4
(2) 2503/ 6001168 :                     ; 		add	r1,r4
(2) 2504/ 6001168 :                     ; 		mov	r4,@(polygn_type,r13)
(2) 2505/ 6001168 :                     ; 		mov	@r6,r0
(2) 2506/ 6001168 :                     ; 		mov	r0,@(polygn_mtrl,r13)
(2) 2507/ 6001168 :                     ; 		bra	.go_faces
(2) 2508/ 6001168 :                     ; 		nop
(2) 2509/ 6001168 :                     ; 		align 4
(2) 2510/ 6001168 :                     ;
(2) 2511/ 6001168 :                     ; ; --------------------------------
(2) 2512/ 6001168 :                     ; ; Set texture material
(2) 2513/ 6001168 :                     ; ; --------------------------------
(2) 2514/ 6001168 :                     ;
(2) 2515/ 6001168 :                     ; .solid_type:
(2) 2516/ 6001168 :                     ; 		mov	@(mdl_option,r14),r0
(2) 2517/ 6001168 :                     ; 		extu.b	r0,r0
(2) 2518/ 6001168 :                     ; ; 		and	#$FF,r0
(2) 2519/ 6001168 :                     ; 		mov	r0,r1
(2) 2520/ 6001168 :                     ; 		mov	r4,r0
(2) 2521/ 6001168 :                     ; ; 		mov	#$E000,r5
(2) 2522/ 6001168 :                     ; 		mov	#$70,r5		; $E000
(2) 2523/ 6001168 :                     ; 		shll	r5
(2) 2524/ 6001168 :                     ; 		shll8	r5
(2) 2525/ 6001168 :                     ; 		and	r5,r4
(2) 2526/ 6001168 :                     ; 		shll16	r4
(2) 2527/ 6001168 :                     ; 		add	r1,r4
(2) 2528/ 6001168 :                     ; 		mov	r4,@(polygn_type,r13)		; Set type 0 (tri) or quad (1)
(2) 2529/ 6001168 :                     ; 		extu.b	r0,r0
(2) 2530/ 6001168 :                     ; ; 		and	#$FF,r0
(2) 2531/ 6001168 :                     ; 		mov	r0,@(polygn_mtrl,r13)		; Set pixel color (0-255)
(2) 2532/ 6001168 :                     ;
(2) 2533/ 6001168 :                     ; ; --------------------------------
(2) 2534/ 6001168 :                     ; ; Read faces
(2) 2535/ 6001168 :                     ; ; --------------------------------
(2) 2536/ 6001168 :                     ;
(2) 2537/ 6001168 :                     ; .go_faces:
(2) 2538/ 6001168 :                     ; 		mov	r13,r1
(2) 2539/ 6001168 :                     ; 		add 	#polygn_points,r1
(2) 2540/ 6001168 :                     ; 		mov	r11,r6
(2) 2541/ 6001168 :                     ; 		mov	r7,r0
(2) 2542/ 6001168 :                     ; 		shll	r0
(2) 2543/ 6001168 :                     ; 		add	r0,r11
(2) 2544/ 6001168 :                     ;
(2) 2545/ 6001168 :                     ; 		mov	#Cach_BkupS_S,r0
(2) 2546/ 6001168 :                     ; 		mov 	r8,@-r0
(2) 2547/ 6001168 :                     ; 		mov 	r9,@-r0
(2) 2548/ 6001168 :                     ; 		mov 	r11,@-r0
(2) 2549/ 6001168 :                     ; 		mov 	r12,@-r0
(2) 2550/ 6001168 :                     ; 		mov 	r13,@-r0
(2) 2551/ 6001168 :                     ; 		mov	#-(320/2)>>1,r8
(2) 2552/ 6001168 :                     ; 		shll	r8
(2) 2553/ 6001168 :                     ; 		mov	#-(224/2),r11
(2) 2554/ 6001168 :                     ; 		neg	r8,r9
(2) 2555/ 6001168 :                     ; 		neg	r11,r12
(2) 2556/ 6001168 :                     ; 		mov	#-1,r13		; $FFFFFFFF
(2) 2557/ 6001168 :                     ;
(2) 2558/ 6001168 :                     ; 	; Do 3 points
(2) 2559/ 6001168 :                     ; 	rept 3
(2) 2560/ 6001168 :                     ; 		mov	#0,r0
(2) 2561/ 6001168 :                     ; 		mov.w 	@r6+,r0
(2) 2562/ 6001168 :                     ; 		mov	#$C,r4
(2) 2563/ 6001168 :                     ; 		mulu	r4,r0
(2) 2564/ 6001168 :                     ; 		sts	macl,r0
(2) 2565/ 6001168 :                     ; 		mov	r10,r4
(2) 2566/ 6001168 :                     ; 		add 	r0,r4
(2) 2567/ 6001168 :                     ; 		mov	@r4,r2
(2) 2568/ 6001168 :                     ; 		mov	@(4,r4),r3
(2) 2569/ 6001168 :                     ; 		mov	@(8,r4),r4
(2) 2570/ 6001168 :                     ; 		bsr	mdlrd_setpoint
(2) 2571/ 6001168 :                     ; 		nop
(2) 2572/ 6001168 :                     ; 		mov	r2,@r1
(2) 2573/ 6001168 :                     ; 		mov	r3,@(4,r1)
(2) 2574/ 6001168 :                     ; 		add	#8,r1
(2) 2575/ 6001168 :                     ; 		nop
(2) 2576/ 6001168 :                     ; 	endm
(2) 2577/ 6001168 :                     ; 		mov	#3,r0			; Triangle?
(2) 2578/ 6001168 :                     ; 		cmp/eq	r0,r7
(2) 2579/ 6001168 :                     ; 		bt	.alldone		; If yes, skip this
(2) 2580/ 6001168 :                     ; 		nop
(2) 2581/ 6001168 :                     ; 		mov	#0,r0
(2) 2582/ 6001168 :                     ; 		mov.w 	@r6+,r0
(2) 2583/ 6001168 :                     ; 		mov	#$C,r4
(2) 2584/ 6001168 :                     ; 		mulu	r4,r0
(2) 2585/ 6001168 :                     ; 		sts	macl,r0
(2) 2586/ 6001168 :                     ; 		mov	r10,r4
(2) 2587/ 6001168 :                     ; 		add 	r0,r4
(2) 2588/ 6001168 :                     ; 		mov	@r4,r2
(2) 2589/ 6001168 :                     ; 		mov	@(4,r4),r3
(2) 2590/ 6001168 :                     ; 		mov	@(8,r4),r4
(2) 2591/ 6001168 :                     ; 		bsr	mdlrd_setpoint
(2) 2592/ 6001168 :                     ; 		nop
(2) 2593/ 6001168 :                     ; 		mov	r2,@r1
(2) 2594/ 6001168 :                     ; 		mov	r3,@(4,r1)
(2) 2595/ 6001168 :                     ; .alldone:
(2) 2596/ 6001168 :                     ; 		mov	r8,r1
(2) 2597/ 6001168 :                     ; 		mov	r9,r2
(2) 2598/ 6001168 :                     ; 		mov	r11,r3
(2) 2599/ 6001168 :                     ; 		mov	r12,r4
(2) 2600/ 6001168 :                     ; 		mov	r13,r6
(2) 2601/ 6001168 :                     ;
(2) 2602/ 6001168 :                     ; 		mov	#Cach_BkupS_L,r0
(2) 2603/ 6001168 :                     ; 		mov	@r0+,r13
(2) 2604/ 6001168 :                     ; 		mov	@r0+,r12
(2) 2605/ 6001168 :                     ; 		mov	@r0+,r11
(2) 2606/ 6001168 :                     ; 		mov	@r0+,r9
(2) 2607/ 6001168 :                     ; 		mov	@r0+,r8
(2) 2608/ 6001168 :                     ;
(2) 2609/ 6001168 :                     ; 	; NOTE: if you don't like how the perspective works
(2) 2610/ 6001168 :                     ; 	; change this instruction depending how you want to ignore
(2) 2611/ 6001168 :                     ; 	; faces closer to the camera:
(2) 2612/ 6001168 :                     ; 	;
(2) 2613/ 6001168 :                     ; 	; r5 - Back Z point, keep affine limitations
(2) 2614/ 6001168 :                     ; 	; r6 - Front Z point, skip face but larger faces are affected
(2) 2615/ 6001168 :                     ;
(2) 2616/ 6001168 :                     ; 		cmp/pz	r5			; *** back z
(2) 2617/ 6001168 :                     ; 		bt	.go_fout
(2) 2618/ 6001168 :                     ; ; 		cmp/pz	r6			; *** front z
(2) 2619/ 6001168 :                     ; ; 		bt	.go_fout
(2) 2620/ 6001168 :                     ; 		mov	#MAX_ZDIST>>8,r0	; Draw distance
(2) 2621/ 6001168 :                     ; 		shll8	r0
(2) 2622/ 6001168 :                     ; 		cmp/ge	r0,r5
(2) 2623/ 6001168 :                     ; 		bf	.go_fout
(2) 2624/ 6001168 :                     ; 		mov	#-(SCREEN_WIDTH/2),r0
(2) 2625/ 6001168 :                     ; 		cmp/gt	r0,r1
(2) 2626/ 6001168 :                     ; 		bf	.go_fout
(2) 2627/ 6001168 :                     ; 		neg	r0,r0
(2) 2628/ 6001168 :                     ; 		cmp/ge	r0,r2
(2) 2629/ 6001168 :                     ; 		bt	.go_fout
(2) 2630/ 6001168 :                     ; 		mov	#-(SCREEN_HEIGHT/2),r0
(2) 2631/ 6001168 :                     ; 		cmp/gt	r0,r3
(2) 2632/ 6001168 :                     ; 		bf	.go_fout
(2) 2633/ 6001168 :                     ; 		neg	r0,r0
(2) 2634/ 6001168 :                     ; 		cmp/ge	r0,r4
(2) 2635/ 6001168 :                     ; 		bf	.face_ok
(2) 2636/ 6001168 :                     ; .go_fout:	bra	.face_out
(2) 2637/ 6001168 :                     ; 		nop
(2) 2638/ 6001168 :                     ; 		align 4
(2) 2639/ 6001168 :                     ;
(2) 2640/ 6001168 :                     ; ; --------------------------------
(2) 2641/ 6001168 :                     ;
(2) 2642/ 6001168 :                     ; .face_ok:
(2) 2643/ 6001168 :                     ; 		mov.w	@(marsGbl_CurrNumFaces,gbr),r0	; Add 1 face to the list
(2) 2644/ 6001168 :                     ; 		add	#1,r0
(2) 2645/ 6001168 :                     ; 		mov.w	r0,@(marsGbl_CurrNumFaces,gbr)
(2) 2646/ 6001168 :                     ; 		mov	@(marsGbl_CurrFacePos,gbr),r0
(2) 2647/ 6001168 :                     ; 		mov	r0,r1
(2) 2648/ 6001168 :                     ; 		mov	r13,r2
(2) 2649/ 6001168 :                     ; 		mov	r5,@r8				; Store current Z to Zlist
(2) 2650/ 6001168 :                     ; 		mov	r1,@(4,r8)			; And it's address
(2) 2651/ 6001168 :                     ;
(2) 2652/ 6001168 :                     ; ; ****
(2) 2653/ 6001168 :                     ; ; 	Sort this face
(2) 2654/ 6001168 :                     ; ; 	r7 - Curr Z
(2) 2655/ 6001168 :                     ; ; 	r6 - Past Z
(2) 2656/ 6001168 :                     ; 		mov.w	@(marsGbl_CurrNumFaces,gbr),r0
(2) 2657/ 6001168 :                     ; 		cmp/eq	#1,r0
(2) 2658/ 6001168 :                     ; 		bt	.first_face
(2) 2659/ 6001168 :                     ; 		cmp/eq	#2,r0
(2) 2660/ 6001168 :                     ; 		bt	.first_face
(2) 2661/ 6001168 :                     ; 		mov	r8,r7
(2) 2662/ 6001168 :                     ; 		add	#-8,r7
(2) 2663/ 6001168 :                     ; 		mov	@(marsGbl_CurrZTop,gbr),r0
(2) 2664/ 6001168 :                     ; 		mov	r0,r6
(2) 2665/ 6001168 :                     ; .page_2:
(2) 2666/ 6001168 :                     ; 		cmp/ge	r6,r7
(2) 2667/ 6001168 :                     ; 		bf	.first_face
(2) 2668/ 6001168 :                     ; 		mov	@(8,r7),r4
(2) 2669/ 6001168 :                     ; 		mov	@r7,r5
(2) 2670/ 6001168 :                     ; 		cmp/eq	r4,r5
(2) 2671/ 6001168 :                     ; 		bt	.first_face
(2) 2672/ 6001168 :                     ; 		cmp/gt	r4,r5
(2) 2673/ 6001168 :                     ; 		bf	.swap_me
(2) 2674/ 6001168 :                     ; 		mov	@r7,r4
(2) 2675/ 6001168 :                     ; 		mov	@(8,r7),r5
(2) 2676/ 6001168 :                     ; 		mov	r5,@r7
(2) 2677/ 6001168 :                     ; 		mov	r4,@(8,r7)
(2) 2678/ 6001168 :                     ; 		mov	@(4,r7),r4
(2) 2679/ 6001168 :                     ; 		mov	@($C,r7),r5
(2) 2680/ 6001168 :                     ; 		mov	r5,@(4,r7)
(2) 2681/ 6001168 :                     ; 		mov	r4,@($C,r7)
(2) 2682/ 6001168 :                     ; .swap_me:
(2) 2683/ 6001168 :                     ; 		bra	.page_2
(2) 2684/ 6001168 :                     ; 		add	#-8,r7
(2) 2685/ 6001168 :                     ; .first_face:
(2) 2686/ 6001168 :                     ; ; ****
(2) 2687/ 6001168 :                     ;
(2) 2688/ 6001168 :                     ; 		add	#8,r8			; Next Zlist entry
(2) 2689/ 6001168 :                     ; 	rept sizeof_polygn/4			; Copy words manually
(2) 2690/ 6001168 :                     ; 		mov	@r2+,r0
(2) 2691/ 6001168 :                     ; 		mov	r0,@r1
(2) 2692/ 6001168 :                     ; 		add	#4,r1
(2) 2693/ 6001168 :                     ; 	endm
(2) 2694/ 6001168 :                     ; 		mov	r1,r0
(2) 2695/ 6001168 :                     ; 		mov	r0,@(marsGbl_CurrFacePos,gbr)
(2) 2696/ 6001168 :                     ; .face_out:
(2) 2697/ 6001168 :                     ; 		dt	r9
(2) 2698/ 6001168 :                     ; 		bt	.finish_this
(2) 2699/ 6001168 :                     ; 		bra	.next_face
(2) 2700/ 6001168 :                     ; 		nop
(2) 2701/ 6001168 :                     ; .finish_this:
(2) 2702/ 6001168 :                     ; 		mov	r8,r0
(2) 2703/ 6001168 :                     ; 		mov	r0,@(marsGbl_CurrZList,gbr)
(2) 2704/ 6001168 :                     ; .exit_model:
(2) 2705/ 6001168 :                     ; 		lds	@r15+,pr
(2) 2706/ 6001168 :                     ; 		rts
(2) 2707/ 6001168 :                     ; 		nop
(2) 2708/ 6001168 :                     ; 		align 4
(2) 2709/ 6001168 :                     ; ; 		ltorg
(2) 2710/ 6001168 :                     ;
(2) 2711/ 6001168 :                     ; ; ----------------------------------------
(2) 2712/ 6001168 :                     ; ; Modify position to current point
(2) 2713/ 6001168 :                     ; ; ----------------------------------------
(2) 2714/ 6001168 :                     ;
(2) 2715/ 6001168 :                     ; 		align 4
(2) 2716/ 6001168 :                     ; mdlrd_setpoint:
(2) 2717/ 6001168 :                     ; 		mov	#Cach_BkupPnt_S,r0
(2) 2718/ 6001168 :                     ; 		sts	pr,@-r0
(2) 2719/ 6001168 :                     ; 		mov 	r5,@-r0
(2) 2720/ 6001168 :                     ; 		mov 	r6,@-r0
(2) 2721/ 6001168 :                     ; 		mov 	r7,@-r0
(2) 2722/ 6001168 :                     ; 		mov 	r8,@-r0
(2) 2723/ 6001168 :                     ; 		mov 	r9,@-r0
(2) 2724/ 6001168 :                     ; 		mov 	r10,@-r0
(2) 2725/ 6001168 :                     ; 		mov 	r11,@-r0
(2) 2726/ 6001168 :                     ;
(2) 2727/ 6001168 :                     ; 	; Object rotation
(2) 2728/ 6001168 :                     ; 		mov	r2,r5			; r5 - X
(2) 2729/ 6001168 :                     ; 		mov	r4,r6			; r6 - Z
(2) 2730/ 6001168 :                     ;   		mov.w 	@(mdl_x_rot,r14),r0
(2) 2731/ 6001168 :                     ;   		bsr	mdlrd_rotate
(2) 2732/ 6001168 :                     ;   		shlr2	r0
(2) 2733/ 6001168 :                     ;    		mov	r7,r2
(2) 2734/ 6001168 :                     ;    		mov	r3,r5
(2) 2735/ 6001168 :                     ;   		mov	r8,r6
(2) 2736/ 6001168 :                     ;   		mov.w	@(mdl_z_rot,r14),r0
(2) 2737/ 6001168 :                     ;   		shlr	r0
(2) 2738/ 6001168 :                     ;   		bsr	mdlrd_rotate
(2) 2739/ 6001168 :                     ;   		shlr2	r0
(2) 2740/ 6001168 :                     ;    		mov	r8,r4
(2) 2741/ 6001168 :                     ;    		mov	r2,r5
(2) 2742/ 6001168 :                     ;    		mov	r7,r6
(2) 2743/ 6001168 :                     ;    		mov.w	@(mdl_y_rot,r14),r0
(2) 2744/ 6001168 :                     ;   		shlr	r0
(2) 2745/ 6001168 :                     ;   		bsr	mdlrd_rotate
(2) 2746/ 6001168 :                     ;   		shlr2	r0
(2) 2747/ 6001168 :                     ;    		mov	r7,r2
(2) 2748/ 6001168 :                     ;    		mov	r8,r3
(2) 2749/ 6001168 :                     ; 		mov.w	@(mdl_x_pos,r14),r0
(2) 2750/ 6001168 :                     ; 		exts.w	r0,r5
(2) 2751/ 6001168 :                     ; 		mov.w	@(mdl_y_pos,r14),r0
(2) 2752/ 6001168 :                     ; 		exts.w	r0,r6
(2) 2753/ 6001168 :                     ; 		mov.w	@(mdl_z_pos,r14),r0
(2) 2754/ 6001168 :                     ; 		exts.w	r0,r7
(2) 2755/ 6001168 :                     ; ;  		shar	r5
(2) 2756/ 6001168 :                     ; ;  		shar	r6
(2) 2757/ 6001168 :                     ; ;  		shar	r7
(2) 2758/ 6001168 :                     ; 		add 	r5,r2
(2) 2759/ 6001168 :                     ; 		add 	r6,r3
(2) 2760/ 6001168 :                     ; 		add 	r7,r4
(2) 2761/ 6001168 :                     ;
(2) 2762/ 6001168 :                     ; 	; Include camera changes
(2) 2763/ 6001168 :                     ; 		mov 	#RAM_Mars_DreqRead+Dreq_ObjCam,r11
(2) 2764/ 6001168 :                     ; 		mov	@(cam_x_pos,r11),r5
(2) 2765/ 6001168 :                     ; 		mov	@(cam_y_pos,r11),r6
(2) 2766/ 6001168 :                     ; 		mov	@(cam_z_pos,r11),r7
(2) 2767/ 6001168 :                     ; ; 		shlr	r5
(2) 2768/ 6001168 :                     ; ; 		shlr	r6
(2) 2769/ 6001168 :                     ; ; 		shlr	r7
(2) 2770/ 6001168 :                     ; 		exts	r5,r5
(2) 2771/ 6001168 :                     ; 		exts	r6,r6
(2) 2772/ 6001168 :                     ; 		exts	r7,r7
(2) 2773/ 6001168 :                     ; 		sub 	r5,r2
(2) 2774/ 6001168 :                     ; 		sub 	r6,r3
(2) 2775/ 6001168 :                     ; 		add 	r7,r4
(2) 2776/ 6001168 :                     ;
(2) 2777/ 6001168 :                     ; 		mov	r2,r5
(2) 2778/ 6001168 :                     ; 		mov	r4,r6
(2) 2779/ 6001168 :                     ;   		mov 	@(cam_x_rot,r11),r0
(2) 2780/ 6001168 :                     ; ;   		shlr2	r0
(2) 2781/ 6001168 :                     ; ;   		shlr	r0
(2) 2782/ 6001168 :                     ;   		bsr	mdlrd_rotate
(2) 2783/ 6001168 :                     ; 		shlr2	r0
(2) 2784/ 6001168 :                     ;    		mov	r7,r2
(2) 2785/ 6001168 :                     ;    		mov	r8,r4
(2) 2786/ 6001168 :                     ;    		mov	r3,r5
(2) 2787/ 6001168 :                     ;   		mov	r8,r6
(2) 2788/ 6001168 :                     ;   		mov 	@(cam_y_rot,r11),r0
(2) 2789/ 6001168 :                     ; ;   		shlr2	r0
(2) 2790/ 6001168 :                     ; ;   		shlr	r0
(2) 2791/ 6001168 :                     ;   		bsr	mdlrd_rotate
(2) 2792/ 6001168 :                     ; 		shlr2	r0
(2) 2793/ 6001168 :                     ;    		mov	r8,r4
(2) 2794/ 6001168 :                     ;    		mov	r2,r5
(2) 2795/ 6001168 :                     ;    		mov	r7,r6
(2) 2796/ 6001168 :                     ;    		mov 	@(cam_z_rot,r11),r0
(2) 2797/ 6001168 :                     ; ;   		shlr2	r0
(2) 2798/ 6001168 :                     ; ;   		shlr	r0
(2) 2799/ 6001168 :                     ;   		bsr	mdlrd_rotate
(2) 2800/ 6001168 :                     ; 		shlr2	r0
(2) 2801/ 6001168 :                     ;    		mov	r7,r2
(2) 2802/ 6001168 :                     ;    		mov	r8,r3
(2) 2803/ 6001168 :                     ;
(2) 2804/ 6001168 :                     ; 	; Weak perspective projection
(2) 2805/ 6001168 :                     ; 	; this is the best I got,
(2) 2806/ 6001168 :                     ; 	; It breaks on large faces
(2) 2807/ 6001168 :                     ; 		mov	#320<<16,r7
(2) 2808/ 6001168 :                     ; 		neg	r4,r0		; reverse Z
(2) 2809/ 6001168 :                     ; 		cmp/pl	r0
(2) 2810/ 6001168 :                     ; 		bt	.inside
(2) 2811/ 6001168 :                     ; 		mov	#1,r0
(2) 2812/ 6001168 :                     ; 		shlr2	r7
(2) 2813/ 6001168 :                     ; 		shlr2	r7
(2) 2814/ 6001168 :                     ; ; 		shlr	r7
(2) 2815/ 6001168 :                     ; ; 		dmuls	r7,r2
(2) 2816/ 6001168 :                     ; ; 		sts	mach,r0
(2) 2817/ 6001168 :                     ; ; 		sts	macl,r2
(2) 2818/ 6001168 :                     ; ; 		xtrct	r0,r2
(2) 2819/ 6001168 :                     ; ; 		dmuls	r7,r3
(2) 2820/ 6001168 :                     ; ; 		sts	mach,r0
(2) 2821/ 6001168 :                     ; ; 		sts	macl,r3
(2) 2822/ 6001168 :                     ; ; 		xtrct	r0,r3
(2) 2823/ 6001168 :                     ; 		bra	.zmulti
(2) 2824/ 6001168 :                     ; 		nop
(2) 2825/ 6001168 :                     ; .inside:
(2) 2826/ 6001168 :                     ; 		mov 	#_JR,r9
(2) 2827/ 6001168 :                     ; 		mov 	r0,@r9
(2) 2828/ 6001168 :                     ; 		mov 	r7,@(4,r9)
(2) 2829/ 6001168 :                     ; 		nop
(2) 2830/ 6001168 :                     ; 		mov 	@(4,r9),r7
(2) 2831/ 6001168 :                     ; .zmulti:
(2) 2832/ 6001168 :                     ; 		dmuls	r7,r2
(2) 2833/ 6001168 :                     ; 		sts	mach,r0
(2) 2834/ 6001168 :                     ; 		sts	macl,r2
(2) 2835/ 6001168 :                     ; 		xtrct	r0,r2
(2) 2836/ 6001168 :                     ; 		dmuls	r7,r3
(2) 2837/ 6001168 :                     ; 		sts	mach,r0
(2) 2838/ 6001168 :                     ; 		sts	macl,r3
(2) 2839/ 6001168 :                     ; 		xtrct	r0,r3
(2) 2840/ 6001168 :                     ;
(2) 2841/ 6001168 :                     ; 		mov	#Cach_BkupPnt_L,r0
(2) 2842/ 6001168 :                     ; 		mov	@r0+,r11
(2) 2843/ 6001168 :                     ; 		mov	@r0+,r10
(2) 2844/ 6001168 :                     ; 		mov	@r0+,r9
(2) 2845/ 6001168 :                     ; 		mov	@r0+,r8
(2) 2846/ 6001168 :                     ; 		mov	@r0+,r7
(2) 2847/ 6001168 :                     ; 		mov	@r0+,r6
(2) 2848/ 6001168 :                     ; 		mov	@r0+,r5
(2) 2849/ 6001168 :                     ; 		lds	@r0+,pr
(2) 2850/ 6001168 :                     ;
(2) 2851/ 6001168 :                     ; 	; Set the most far points
(2) 2852/ 6001168 :                     ; 	; for each direction (X,Y,Z)
(2) 2853/ 6001168 :                     ; 		cmp/gt	r13,r4
(2) 2854/ 6001168 :                     ; 		bf	.save_z2
(2) 2855/ 6001168 :                     ; 		mov	r4,r13
(2) 2856/ 6001168 :                     ; .save_z2:
(2) 2857/ 6001168 :                     ; 		cmp/gt	r5,r4
(2) 2858/ 6001168 :                     ; 		bt	.save_z
(2) 2859/ 6001168 :                     ; 		mov	r4,r5
(2) 2860/ 6001168 :                     ; .save_z:
(2) 2861/ 6001168 :                     ; 		cmp/gt	r8,r2
(2) 2862/ 6001168 :                     ; 		bf	.x_lw
(2) 2863/ 6001168 :                     ; 		mov	r2,r8
(2) 2864/ 6001168 :                     ; .x_lw:
(2) 2865/ 6001168 :                     ; 		cmp/gt	r9,r2
(2) 2866/ 6001168 :                     ; 		bt	.x_rw
(2) 2867/ 6001168 :                     ; 		mov	r2,r9
(2) 2868/ 6001168 :                     ; .x_rw:
(2) 2869/ 6001168 :                     ; 		cmp/gt	r11,r3
(2) 2870/ 6001168 :                     ; 		bf	.y_lw
(2) 2871/ 6001168 :                     ; 		mov	r3,r11
(2) 2872/ 6001168 :                     ; .y_lw:
(2) 2873/ 6001168 :                     ; 		cmp/gt	r12,r3
(2) 2874/ 6001168 :                     ; 		bt	.y_rw
(2) 2875/ 6001168 :                     ; 		mov	r3,r12
(2) 2876/ 6001168 :                     ; .y_rw:
(2) 2877/ 6001168 :                     ; 		rts
(2) 2878/ 6001168 :                     ; 		nop
(2) 2879/ 6001168 :                     ; 		align 4
(2) 2880/ 6001168 :                     ; 		ltorg
(2) 2881/ 6001168 :                     ;
(2) 2882/ 6001168 :                     ; ; ------------------------------
(2) 2883/ 6001168 :                     ; ; Rotate point
(2) 2884/ 6001168 :                     ; ;
(2) 2885/ 6001168 :                     ; ; Entry:
(2) 2886/ 6001168 :                     ; ; r5: x
(2) 2887/ 6001168 :                     ; ; r6: y
(2) 2888/ 6001168 :                     ; ; r0: theta
(2) 2889/ 6001168 :                     ; ;
(2) 2890/ 6001168 :                     ; ; Returns:
(2) 2891/ 6001168 :                     ; ; r7: (x  cos @) + (y sin @)
(2) 2892/ 6001168 :                     ; ; r8: (x -sin @) + (y cos @)
(2) 2893/ 6001168 :                     ; ; ------------------------------
(2) 2894/ 6001168 :                     ;
(2) 2895/ 6001168 :                     ; 		align 4
(2) 2896/ 6001168 :                     ; mdlrd_rotate:
(2) 2897/ 6001168 :                     ;     		mov	#$7FF,r7
(2) 2898/ 6001168 :                     ;     		and	r7,r0
(2) 2899/ 6001168 :                     ;    		shll2	r0
(2) 2900/ 6001168 :                     ; 		mov	#sin_table,r7
(2) 2901/ 6001168 :                     ; 		mov	#sin_table+$800,r8
(2) 2902/ 6001168 :                     ; 		mov	@(r0,r7),r9
(2) 2903/ 6001168 :                     ; 		mov	@(r0,r8),r10
(2) 2904/ 6001168 :                     ;
(2) 2905/ 6001168 :                     ; 		dmuls	r5,r10		; x cos @
(2) 2906/ 6001168 :                     ; 		sts	macl,r7
(2) 2907/ 6001168 :                     ; 		sts	mach,r0
(2) 2908/ 6001168 :                     ; 		xtrct	r0,r7
(2) 2909/ 6001168 :                     ; 		dmuls	r6,r9		; y sin @
(2) 2910/ 6001168 :                     ; 		sts	macl,r8
(2) 2911/ 6001168 :                     ; 		sts	mach,r0
(2) 2912/ 6001168 :                     ; 		xtrct	r0,r8
(2) 2913/ 6001168 :                     ; 		add	r8,r7
(2) 2914/ 6001168 :                     ;
(2) 2915/ 6001168 :                     ; 		neg	r9,r9
(2) 2916/ 6001168 :                     ; 		dmuls	r5,r9		; x -sin @
(2) 2917/ 6001168 :                     ; 		sts	macl,r8
(2) 2918/ 6001168 :                     ; 		sts	mach,r0
(2) 2919/ 6001168 :                     ; 		xtrct	r0,r8
(2) 2920/ 6001168 :                     ; 		dmuls	r6,r10		; y cos @
(2) 2921/ 6001168 :                     ; 		sts	macl,r9
(2) 2922/ 6001168 :                     ; 		sts	mach,r0
(2) 2923/ 6001168 :                     ; 		xtrct	r0,r9
(2) 2924/ 6001168 :                     ; 		add	r9,r8
(2) 2925/ 6001168 :                     ;  		rts
(2) 2926/ 6001168 :                     ; 		nop
(2) 2927/ 6001168 :                     ; 		align 4
(2) 2928/ 6001168 :                     ; 		ltorg
(2) 2929/ 6001168 :                     ;
(2) 2930/ 6001168 :                     
(2) 2931/ 6001168 :                     ; moved to cache_slv.asm
(2) 2932/ 6001168 :                     ; 		align 4
(2) 2933/ 6001168 :                     ; Cach_CurrPlygn		ds.b sizeof_polygn		; Current reading polygon
(2) 2934/ 6001168 :                     ; Cach_BkupPnt_L		ds.l 8				; **
(2) 2935/ 6001168 :                     ; Cach_BkupPnt_S		ds.l 0				; <-- Reads backwards
(2) 2936/ 6001168 :                     
(1) 1210/ 6001168 :                     		include "system/mars/sound.asm"
(2)    1/ 6001168 :                     ; ====================================================================
(2)    2/ 6001168 :                     ; ----------------------------------------------------------------
(2)    3/ 6001168 :                     ; 32X Sound (For SLAVE CPU ONLY)
(2)    4/ 6001168 :                     ;
(2)    5/ 6001168 :                     ; Playback code (the PWM interrupt) is located at cache_slv.asm
(2)    6/ 6001168 :                     ; ----------------------------------------------------------------
(2)    7/ 6001168 :                     
(2)    8/ 6001168 :                     ; --------------------------------------------------------
(2)    9/ 6001168 :                     ; Settings
(2)   10/ 6001168 :                     ; --------------------------------------------------------
(2)   11/ 6001168 :                     
(2)   12/ 6001168 : =$7                 MAX_PWMCHNL	equ 7		; MAXIMUM usable PWM channels (TODO: keep it like this)
(2)   13/ 6001168 : =$80                MAX_PWMBACKUP	equ $80		; 1-bit sizes only: $40,$80,$100...
(2)   14/ 6001168 : =$5622              SAMPLE_RATE	equ 22050
(2)   15/ 6001168 :                     
(2)   16/ 6001168 :                     ; --------------------------------------------------------
(2)   17/ 6001168 :                     ; Structs
(2)   18/ 6001168 :                     ; --------------------------------------------------------
(2)   19/ 6001168 :                     
(2)   20/ 6001168 :                     ; 32X sound channel
(2)   21/ 6001168 : (MACRO)             		struct 0
(2)   21/ 6001168 : =$6001168           GLBL_LASTPC     set *
(2)   21/   4A548 :                                     dephase
(2)   21/   4A548 : =$4A548             GLBL_LASTORG    set *
(2)   21/       0 :                                     phase 0
(2)   22/       0 :                     mchnsnd_enbl	ds.l 1
(2)   23/       4 :                     mchnsnd_read	ds.l 1		; 0 - off
(2)   24/       8 :                     mchnsnd_cchread	ds.l 1
(2)   25/       C :                     mchnsnd_bank	ds.l 1		; CS0-3 OR value
(2)   26/      10 :                     mchnsnd_start	ds.l 1
(2)   27/      14 :                     mchnsnd_end	ds.l 1
(2)   28/      18 :                     mchnsnd_loop	ds.l 1
(2)   29/      1C :                     mchnsnd_pitch	ds.l 1
(2)   30/      20 :                     mchnsnd_flags	ds.l 1		; %SLR S-wave format mono/stereo | LR-wave output bits
(2)   31/      24 :                     mchnsnd_vol	ds.l 1
(2)   32/      28 :                     sizeof_sndchn	ds.l 0
(2)   33/      28 : (MACRO)             		finish
(2)   33/       0 :                                     !org GLBL_LASTORG
(2)   33/ 6001168 :                                     phase GLBL_LASTPC
(2)   34/ 6001168 :                     
(2)   35/ 6001168 :                     ; ====================================================================
(2)   36/ 6001168 :                     ; --------------------------------------------------------
(2)   37/ 6001168 :                     ; Init Sound PWM
(2)   38/ 6001168 :                     ;
(2)   39/ 6001168 :                     ; Cycle register formulas:
(2)   40/ 6001168 :                     ; NTSC ((((23011361<<1)/SAMPLE_RATE+1)>>1)+1)
(2)   41/ 6001168 :                     ; PAL  ((((22801467<<1)/SAMPLE_RATE+1)>>1)+1)
(2)   42/ 6001168 :                     ;
(2)   43/ 6001168 :                     ; NOTE: The CLICK sound after calling this is normal.
(2)   44/ 6001168 :                     ; --------------------------------------------------------
(2)   45/ 6001168 :                     
(2)   46/ 6001168 :                     		align 4
(2)   47/ 6001168 :                     MarsSound_Init:
(2)   48/ 6001168 : 4F13                		stc	gbr,@-r15
(2)   49/ 600116A : D03A                		mov	#_sysreg,r0
(2)   50/ 600116C : 401E                		ldc	r0,gbr
(2)   51/ 600116E : 9081                		mov	#$0105,r0					; Timing interval $01, output L/R
(2)   52/ 6001170 : C118                		mov.w	r0,@(timerctl,gbr)
(2)   53/ 6001172 : 9080                		mov	#((((23011361<<1)/SAMPLE_RATE+1)>>1)+1),r0	; Samplerate
(2)   54/ 6001174 : C119                		mov.w	r0,@(cycle,gbr)
(2)   55/ 6001176 : E001                		mov	#1,r0
(2)   56/ 6001178 : C11C                		mov.w	r0,@(monowidth,gbr)
(2)   57/ 600117A : C11C                		mov.w	r0,@(monowidth,gbr)
(2)   58/ 600117C : C11C                		mov.w	r0,@(monowidth,gbr)
(2)   59/ 600117E : 4F17                		ldc	@r15+,gbr
(2)   60/ 6001180 : 000B                		rts
(2)   61/ 6001182 : 0009                		nop
(2)   62/ 6001184 :                     		align 4
(2)   63/ 6001184 :                     
(2)   64/ 6001184 :                     ; ====================================================================
(2)   65/ 6001184 :                     ; ----------------------------------------------------------------
(2)   66/ 6001184 :                     ; Subroutines
(2)   67/ 6001184 :                     ; ----------------------------------------------------------------
(2)   68/ 6001184 :                     
(2)   69/ 6001184 :                     ; --------------------------------------------------------
(2)   70/ 6001184 :                     ; MarsSound_SetPwm
(2)   71/ 6001184 :                     ;
(2)   72/ 6001184 :                     ; Sets new sound data to a channel slot, automaticly
(2)   73/ 6001184 :                     ; plays.
(2)   74/ 6001184 :                     ;
(2)   75/ 6001184 :                     ; Input:
(2)   76/ 6001184 :                     ; r1 | Channel (0-6)
(2)   77/ 6001184 :                     ; r2 | Start address (SH2 AREA)
(2)   78/ 6001184 :                     ; r3 | End address (SH2 AREA)
(2)   79/ 6001184 :                     ; r4 | Loop address (SH2 AREA, ignored if loop bit isn't set)
(2)   80/ 6001184 :                     ; r5 | Starting pitch ($xxxxxx.xx, $100 default speed)
(2)   81/ 6001184 :                     ; r6 | Volume (0-High)
(2)   82/ 6001184 :                     ; r7 | Flags: %xxxxslLR
(2)   83/ 6001184 :                     ;      LR - Enable output to these speakers
(2)   84/ 6001184 :                     ;       l - LOOP flag
(2)   85/ 6001184 :                     ;       s - Sample data is in Stereo (16-bit)
(2)   86/ 6001184 :                     ;
(2)   87/ 6001184 :                     ; Breaks:
(2)   88/ 6001184 :                     ; r0,r8-r9,macl
(2)   89/ 6001184 :                     ; --------------------------------------------------------
(2)   90/ 6001184 :                     
(2)   91/ 6001184 :                     MarsSound_SetPwm:
(2)   92/ 6001184 : D834                		mov	#MarsSnd_PwmChnls,r8
(2)   93/ 6001186 : E028                		mov 	#sizeof_sndchn,r0
(2)   94/ 6001188 : 201E                		mulu	r1,r0
(2)   95/ 600118A : 001A                		sts	macl,r0
(2)   96/ 600118C : 380C                		add 	r0,r8
(2)   97/ 600118E : E000                		mov 	#0,r0
(2)   98/ 6001190 : 1800                		mov 	r0,@(mchnsnd_enbl,r8)
(2)   99/ 6001192 :                     ; 		mov 	r0,@(mchnsnd_read,r8)
(2)  100/ 6001192 :                     ; 		mov 	r0,@(mchnsnd_bank,r8)
(2)  101/ 6001192 : 1857                		mov 	r5,@(mchnsnd_pitch,r8)
(2)  102/ 6001194 : 1869                		mov 	r6,@(mchnsnd_vol,r8)
(2)  103/ 6001196 : 1878                		mov 	r7,@(mchnsnd_flags,r8)
(2)  104/ 6001198 : 6023                		mov 	r2,r0				; Set MSB
(2)  105/ 600119A : E9FF                		mov	#-1,r9				; r9 - FF000000
(2)  106/ 600119C : 4928                		shll16	r9
(2)  107/ 600119E : 4918                		shll8	r9
(2)  108/ 60011A0 : 2099                		and	r9,r0
(2)  109/ 60011A2 :                     ; 		mov 	#$FF000000,r9
(2)  110/ 60011A2 :                     ; 		and 	r9,r0
(2)  111/ 60011A2 : 1803                		mov 	r0,@(mchnsnd_bank,r8)
(2)  112/ 60011A4 : 6043                		mov 	r4,r0				; Set POINTS
(2)  113/ 60011A6 : 88FF                		cmp/eq	#-1,r0
(2)  114/ 60011A8 : 8900                		bt	.endmrk
(2)  115/ 60011AA : 4018                		shll8	r0
(2)  116/ 60011AC :                     .endmrk:
(2)  117/ 60011AC : 1806                		mov	r0,@(mchnsnd_loop,r8)
(2)  118/ 60011AE : 6033                		mov 	r3,r0
(2)  119/ 60011B0 : 4018                		shll8	r0
(2)  120/ 60011B2 : 1805                		mov	r0,@(mchnsnd_end,r8)
(2)  121/ 60011B4 : 6023                		mov 	r2,r0
(2)  122/ 60011B6 : 4018                		shll8	r0
(2)  123/ 60011B8 : 1804                		mov 	r0,@(mchnsnd_start,r8)
(2)  124/ 60011BA : 1801                		mov 	r0,@(mchnsnd_read,r8)
(2)  125/ 60011BC : E001                		mov 	#1,r0
(2)  126/ 60011BE : 1800                		mov 	r0,@(mchnsnd_enbl,r8)
(2)  127/ 60011C0 : 000B                		rts
(2)  128/ 60011C2 : 0009                		nop
(2)  129/ 60011C4 :                     		align 4
(2)  130/ 60011C4 :                     
(2)  131/ 60011C4 :                     ; --------------------------------------------------------
(2)  132/ 60011C4 :                     ; MarsSound_SetPwmPitch
(2)  133/ 60011C4 :                     ;
(2)  134/ 60011C4 :                     ; Sets pitch data of a channel slot
(2)  135/ 60011C4 :                     ;
(2)  136/ 60011C4 :                     ; Input:
(2)  137/ 60011C4 :                     ; r1 | Channel (0-6)
(2)  138/ 60011C4 :                     ; r2 | Pitch ($xxxxxx.xx, $100 default speed)
(2)  139/ 60011C4 :                     ;
(2)  140/ 60011C4 :                     ; Breaks:
(2)  141/ 60011C4 :                     ; r8,macl
(2)  142/ 60011C4 :                     ; --------------------------------------------------------
(2)  143/ 60011C4 :                     
(2)  144/ 60011C4 :                     MarsSound_SetPwmPitch:
(2)  145/ 60011C4 : D825                		mov	#MarsSnd_PwmChnls,r8
(2)  146/ 60011C6 : E028                		mov 	#sizeof_sndchn,r0
(2)  147/ 60011C8 : 201E                		mulu	r1,r0
(2)  148/ 60011CA : 001A                		sts	macl,r0
(2)  149/ 60011CC : 380C                		add 	r0,r8
(2)  150/ 60011CE : 5080                		mov	@(mchnsnd_enbl,r8),r0
(2)  151/ 60011D0 : 8801                		cmp/eq	#1,r0
(2)  152/ 60011D2 : 8B01                		bf	.off_1
(2)  153/ 60011D4 : 5081                		mov	@(mchnsnd_read,r8),r0
(2)  154/ 60011D6 : 1827                		mov	r2,@(mchnsnd_pitch,r8)
(2)  155/ 60011D8 :                     .off_1:
(2)  156/ 60011D8 : 000B                		rts
(2)  157/ 60011DA : 0009                		nop
(2)  158/ 60011DC :                     		align 4
(2)  159/ 60011DC :                     
(2)  160/ 60011DC :                     ; --------------------------------------------------------
(2)  161/ 60011DC :                     ; MarsSound_SetVolume
(2)  162/ 60011DC :                     ;
(2)  163/ 60011DC :                     ; Changes the volume of a channel slot
(2)  164/ 60011DC :                     ;
(2)  165/ 60011DC :                     ; Input:
(2)  166/ 60011DC :                     ; r1 | Channel (0-6)
(2)  167/ 60011DC :                     ; r2 | Volume (in reverse: higher value is low)
(2)  168/ 60011DC :                     ;
(2)  169/ 60011DC :                     ; Breaks:
(2)  170/ 60011DC :                     ; r8,macl
(2)  171/ 60011DC :                     ; --------------------------------------------------------
(2)  172/ 60011DC :                     
(2)  173/ 60011DC :                     MarsSound_SetVolume:
(2)  174/ 60011DC : D820                		mov	#MarsSnd_PwmChnls,r8
(2)  175/ 60011DE : E028                		mov 	#sizeof_sndchn,r0
(2)  176/ 60011E0 : 201E                		mulu	r1,r0
(2)  177/ 60011E2 : 001A                		sts	macl,r0
(2)  178/ 60011E4 : 380C                		add 	r0,r8
(2)  179/ 60011E6 : 5080                		mov	@(mchnsnd_enbl,r8),r0
(2)  180/ 60011E8 : 8801                		cmp/eq	#1,r0
(2)  181/ 60011EA : 8B01                		bf	.off_1
(2)  182/ 60011EC : 6023                		mov	r2,r0
(2)  183/ 60011EE : 1809                		mov	r0,@(mchnsnd_vol,r8)
(2)  184/ 60011F0 :                     .off_1:
(2)  185/ 60011F0 : 000B                		rts
(2)  186/ 60011F2 : 0009                		nop
(2)  187/ 60011F4 :                     		align 4
(2)  188/ 60011F4 :                     
(2)  189/ 60011F4 :                     ; --------------------------------------------------------
(2)  190/ 60011F4 :                     ; MarsSound_PwmEnable
(2)  191/ 60011F4 :                     ;
(2)  192/ 60011F4 :                     ; Turns ON or OFF Current PWM slot
(2)  193/ 60011F4 :                     ;
(2)  194/ 60011F4 :                     ; Input:
(2)  195/ 60011F4 :                     ; r1 | Channel (0-6)
(2)  196/ 60011F4 :                     ; r2 | Enable/Disable
(2)  197/ 60011F4 :                     ;
(2)  198/ 60011F4 :                     ; Breaks:
(2)  199/ 60011F4 :                     ; r8,macl
(2)  200/ 60011F4 :                     ; --------------------------------------------------------
(2)  201/ 60011F4 :                     
(2)  202/ 60011F4 :                     MarsSound_PwmEnable:
(2)  203/ 60011F4 : D81B                		mov	#MarsSnd_PwmChnls,r8
(2)  204/ 60011F6 : E028                		mov 	#sizeof_sndchn,r0
(2)  205/ 60011F8 : 201E                		mulu	r1,r0
(2)  206/ 60011FA : 001A                		sts	macl,r0
(2)  207/ 60011FC : 380C                		add 	r0,r8
(2)  208/ 60011FE : 1820                		mov 	r2,@(mchnsnd_enbl,r8)
(2)  209/ 6001200 :                     ; 		mov 	#0,r0
(2)  210/ 6001200 :                     ; 		mov 	r0,@(mchnsnd_read,r8)
(2)  211/ 6001200 :                     ; 		mov 	r0,@(mchnsnd_bank,r8)
(2)  212/ 6001200 : 000B                		rts
(2)  213/ 6001202 : 0009                		nop
(2)  214/ 6001204 :                     		align 4
(2)  215/ 6001204 :                     
(2)  216/ 6001204 :                     ; --------------------------------------------------------
(2)  217/ 6001204 :                     ; MarsSound_Refill
(2)  218/ 6001204 :                     ;
(2)  219/ 6001204 :                     ; Call this before the 68K side closes ROM access
(2)  220/ 6001204 :                     ; (before 68k side sets RV=1)
(2)  221/ 6001204 :                     ;
(2)  222/ 6001204 :                     ; Breaks:
(2)  223/ 6001204 :                     ; r1-r8
(2)  224/ 6001204 :                     ;
(2)  225/ 6001204 :                     ; NOTE:
(2)  226/ 6001204 :                     ; The trick here is to keep PWM interrupt enabled
(2)  227/ 6001204 :                     ; while filling the backup data
(2)  228/ 6001204 :                     ; --------------------------------------------------------
(2)  229/ 6001204 :                     
(2)  230/ 6001204 :                     MarsSnd_Refill:
(2)  231/ 6001204 : D818                		mov	#MarsSnd_PwmChnls,r8
(2)  232/ 6001206 : E607                		mov	#MAX_PWMCHNL,r6
(2)  233/ 6001208 : E728                		mov	#sizeof_sndchn,r7
(2)  234/ 600120A : D518                		mov	#MarsSnd_PwmCache,r5
(2)  235/ 600120C :                     .next_one:
(2)  236/ 600120C : 5080                		mov	@(mchnsnd_enbl,r8),r0	; This channel is active?
(2)  237/ 600120E : 8801                		cmp/eq	#1,r0
(2)  238/ 6001210 : 8B19                		bf	.not_enbl
(2)  239/ 6001212 : 5083                		mov	@(mchnsnd_bank,r8),r0	; ROM area?
(2)  240/ 6001214 : D216                		mov	#CS1,r2
(2)  241/ 6001216 : 3020                		cmp/eq	r2,r0
(2)  242/ 6001218 : 8B15                		bf	.not_enbl
(2)  243/ 600121A : E100                		mov	#0,r1			; Reset backup LSB
(2)  244/ 600121C : 1812                		mov	r1,@(mchnsnd_cchread,r8)
(2)  245/ 600121E : 6153                		mov	r5,r1
(2)  246/ 6001220 : E220                		mov	#MAX_PWMBACKUP/4,r2	; Max bytes / 4
(2)  247/ 6001222 : 5481                		mov	@(mchnsnd_read,r8),r4	; r4 - OLD READ pos
(2)  248/ 6001224 : 6343                		mov	r4,r3
(2)  249/ 6001226 : 4319                		shlr8	r3
(2)  250/ 6001228 : 330C                		add	r0,r3
(2)  251/ 600122A :                     .copy_now:
(2)  252/ 600122A :                     	rept 4-1
(2)  253/ 600122A :                     		mov.b	@r3+,r0		; byte by byte...
(2)  254/ 600122A :                     		mov.b	r0,@r1
(2)  255/ 600122A :                     		add	#1,r1
(2)  256/ 600122A :                     	endm
(2)  253/ 600122A : 6034                		mov.b	@r3+,r0		; byte by byte...
(2)  254/ 600122C : 2100                		mov.b	r0,@r1
(2)  255/ 600122E : 7101                		add	#1,r1
(2)  253/ 6001230 : 6034                		mov.b	@r3+,r0		; byte by byte...
(2)  254/ 6001232 : 2100                		mov.b	r0,@r1
(2)  255/ 6001234 : 7101                		add	#1,r1
(2)  253/ 6001236 : 6034                		mov.b	@r3+,r0		; byte by byte...
(2)  254/ 6001238 : 2100                		mov.b	r0,@r1
(2)  255/ 600123A : 7101                		add	#1,r1
(2)  257/ 600123C : 6034                		mov.b	@r3+,r0
(2)  258/ 600123E : 2100                		mov.b	r0,@r1
(2)  259/ 6001240 : 4210                		dt	r2
(2)  260/ 6001242 : 8FF2                		bf/s	.copy_now
(2)  261/ 6001244 : 7101                		add	#1,r1
(2)  262/ 6001246 :                     .not_enbl:
(2)  263/ 6001246 : 9017                		mov	#MAX_PWMBACKUP,r0
(2)  264/ 6001248 : 350C                		add	r0,r5
(2)  265/ 600124A : 4610                		dt	r6
(2)  266/ 600124C : 8FDE                		bf/s	.next_one
(2)  267/ 600124E : 387C                		add	r7,r8
(2)  268/ 6001250 : 000B                		rts
(2)  269/ 6001252 : 0009                		nop
(2)  270/ 6001254 :                     		align 4
(2)  271/ 6001254 :                     
(2)  272/ 6001254 :                     ; ====================================================================
(2)  273/ 6001254 :                     
(2)  274/ 6001254 : 2000 4000 C000 01F8 		ltorg			; Save literals
                    C000 01F8 C000 01F8 
                    C000 01F8 C000 01F8 
                    2600 7600 0200 0000 
                    0105 0415 0080      
(2)  275/ 600127A :                     
(1) 1211/ 600127A :                     		align 4
(1) 1212/ 600127C :                     
(1) 1213/ 600127C :                     ; ====================================================================
(1) 1214/ 600127C :                     ; ----------------------------------------------------------------
(1) 1215/ 600127C :                     ; Master entry
(1) 1216/ 600127C :                     ; ----------------------------------------------------------------
(1) 1217/ 600127C :                     
(1) 1218/ 600127C :                     		align 4
(1) 1219/ 600127C :                     SH2_M_Entry:
(1) 1220/ 600127C : DF20                		mov	#STACK_MSTR,r15			; Reset stack
(1) 1221/ 600127E : D021                		mov	#SH2_Master,r0			; Reset vbr
(1) 1222/ 6001280 : 402E                		ldc	r0,vbr
(1) 1223/ 6001282 : 9149                		mov.l	#_FRT,r1
(1) 1224/ 6001284 : E000                		mov	#0,r0
(1) 1225/ 6001286 : 8010                		mov.b	r0,@(0,r1)
(1) 1226/ 6001288 : E0E2                		mov.b	#$E2,r0
(1) 1227/ 600128A : 8017                		mov.b	r0,@(7,r1)
(1) 1228/ 600128C : E000                		mov	#0,r0
(1) 1229/ 600128E : 8014                		mov.b	r0,@(4,r1)
(1) 1230/ 6001290 : E001                		mov	#1,r0
(1) 1231/ 6001292 : 8015                		mov.b	r0,@(5,r1)
(1) 1232/ 6001294 : E000                		mov	#0,r0
(1) 1233/ 6001296 : 8016                		mov.b	r0,@(6,r1)
(1) 1234/ 6001298 : E001                		mov	#1,r0
(1) 1235/ 600129A : 8011                		mov.b	r0,@(1,r1)
(1) 1236/ 600129C : E000                		mov	#0,r0
(1) 1237/ 600129E : 8013                		mov.b	r0,@(3,r1)
(1) 1238/ 60012A0 : 8012                		mov.b	r0,@(2,r1)
(1) 1239/ 60012A2 :                     ; 		mov.b	#$F2,r0			; <-- not needed here
(1) 1240/ 60012A2 :                     ; 		mov.b	r0,@(7,r1)
(1) 1241/ 60012A2 :                     ; 		mov	#0,r0
(1) 1242/ 60012A2 :                     ; 		mov.b	r0,@(4,r1)
(1) 1243/ 60012A2 :                     ; 		mov	#1,r0
(1) 1244/ 60012A2 :                     ; 		mov.b	r0,@(5,r1)
(1) 1245/ 60012A2 :                     ; 		mov.b	#$E2,r0
(1) 1246/ 60012A2 :                     ; 		mov.b	r0,@(7,r1)
(1) 1247/ 60012A2 :                     
(1) 1248/ 60012A2 :                     	; Extra interrupt settings
(1) 1249/ 60012A2 : 903A                		mov.w   #$FEE2,r0			; Extra interrupt priority levels ($FFFFFEE2)
(1) 1250/ 60012A4 : 913A                		mov     #(3<<4)|(5<<8),r1		; (DMA_LVL<<8)|(WDG_LVL<<4) Current: WDG 3 DMA 5
(1) 1251/ 60012A6 : 2011                		mov.w   r1,@r0
(1) 1252/ 60012A8 : 9039                		mov.w   #$FEE4,r0			; Vector jump number for Watchdog ($FFFFFEE4)
(1) 1253/ 60012AA : 9139                		mov     #($120/4)<<8,r1			; (vbr+POINTER)<<8
(1) 1254/ 60012AC : 2011                		mov.w   r1,@r0
(1) 1255/ 60012AE : E0A0                		mov	#-$60,r0			; Vector jump number for DMACHANNEL0 ($FFFFFFA0)
(1) 1256/ 60012B0 : E149                		mov     #($124/4),r1			; (vbr+POINTER)
(1) 1257/ 60012B2 : 2012                		mov	r1,@r0
(1) 1258/ 60012B4 :                     
(1) 1259/ 60012B4 : D014                		mov	#RAM_Mars_Global,r0		; Reset gbr
(1) 1260/ 60012B6 : 401E                		ldc	r0,gbr
(1) 1261/ 60012B8 : D014                		mov	#MarsVideo_Init,r0		; Init Video
(1) 1262/ 60012BA : 400B                		jsr	@r0
(1) 1263/ 60012BC : 0009                		nop
(1) 1264/ 60012BE :                     
(1) 1265/ 60012BE :                     ; ====================================================================
(1) 1266/ 60012BE :                     ; ----------------------------------------------------------------
(1) 1267/ 60012BE :                     ; Master main code
(1) 1268/ 60012BE :                     ;
(1) 1269/ 60012BE :                     ; This CPU is exclusively used for the visuals:
(1) 1270/ 60012BE :                     ; software-rendered backgrounds, sprites and polygons.
(1) 1271/ 60012BE :                     ; ----------------------------------------------------------------
(1) 1272/ 60012BE :                     
(1) 1273/ 60012BE :                     SH2_M_HotStart:
(1) 1274/ 60012BE : 9130                		mov	#$FFFFFE80,r1
(1) 1275/ 60012C0 : 9030                		mov.w	#$A518,r0		; Disable Watchdog
(1) 1276/ 60012C2 : 2101                		mov.w	r0,@r1
(1) 1277/ 60012C4 : 912F                		mov	#_CCR,r1		; Reset CACHE
(1) 1278/ 60012C6 : E010                		mov	#$10,r0
(1) 1279/ 60012C8 : 2100                		mov.b	r0,@r1
(1) 1280/ 60012CA : 0009                		nop
(1) 1281/ 60012CC : 0009                		nop
(1) 1282/ 60012CE : 0009                		nop
(1) 1283/ 60012D0 : 0009                		nop
(1) 1284/ 60012D2 : 0009                		nop
(1) 1285/ 60012D4 : 0009                		nop
(1) 1286/ 60012D6 : 0009                		nop
(1) 1287/ 60012D8 : E009                		mov	#9,r0
(1) 1288/ 60012DA : 2100                		mov.b	r0,@r1
(1) 1289/ 60012DC : D10C                		mov	#_sysreg,r1
(1) 1290/ 60012DE : 200A                    		xor	r0,r0
(1) 1291/ 60012E0 : 811A                		mov.w	r0,@(vresintclr,r1)
(1) 1292/ 60012E2 : 811B                		mov.w	r0,@(vintclr,r1)
(1) 1293/ 60012E4 : 811C                		mov.w	r0,@(hintclr,r1)
(1) 1294/ 60012E6 : 811D                		mov.w	r0,@(cmdintclr,r1)
(1) 1295/ 60012E8 : 811E                		mov.w	r0,@(pwmintclr,r1)
(1) 1296/ 60012EA : 6011                		mov.w	@r1,r0
(1) 1297/ 60012EC : CB02                		or	#CMDIRQ_ON,r0
(1) 1298/ 60012EE : 2101                		mov.w	r0,@r1
(1) 1299/ 60012F0 :                     
(1) 1300/ 60012F0 : D108                		mov	#_sysreg+comm14,r1
(1) 1301/ 60012F2 : 6011                .wait_slv:	mov.w	@r1,r0
(1) 1302/ 60012F4 : 2008                		tst	r0,r0
(1) 1303/ 60012F6 : 8BFC                		bf	.wait_slv
(1) 1304/ 60012F8 : E020                		mov	#$20,r0				; Interrupts ON
(1) 1305/ 60012FA : 400E                		ldc	r0,sr
(1) 1306/ 60012FC : A014                		bra	master_loop
(1) 1307/ 60012FE : 0009                		nop
(1) 1308/ 6001300 :                     		align 4
(1) 1309/ 6001300 : 0604 0000 0600 0000 		ltorg
                    2600 7540 0600 0850 
                    2000 4000 2000 402E 
                    FE10 FEE2 0530 FEE4 
                    4800 FE80 A518 FE92 
(1) 1310/ 6001328 :                     
(1) 1311/ 6001328 :                     ; 		mov	#1,r0
(1) 1312/ 6001328 :                     ; 		mov.w	r0,@(marsGbl_WaveEnable,gbr)	; *** TEMPORAL
(1) 1313/ 6001328 :                     ; 		mov	#16,r0
(1) 1314/ 6001328 :                     ; 		mov.w	r0,@(marsGbl_WaveSpd,gbr)	; ***
(1) 1315/ 6001328 :                     ; 		mov	#8,r0
(1) 1316/ 6001328 :                     ; 		mov.w	r0,@(marsGbl_WaveMax,gbr)	; ***
(1) 1317/ 6001328 :                     ; 		mov	#16,r0
(1) 1318/ 6001328 :                     ; 		mov.w	r0,@(marsGbl_WaveDeform,gbr)	; ***
(1) 1319/ 6001328 :                     
(1) 1320/ 6001328 :                     ; ----------------------------------------------------------------
(1) 1321/ 6001328 :                     ; MASTER CPU loop
(1) 1322/ 6001328 :                     ;
(1) 1323/ 6001328 :                     ; comm12:
(1) 1324/ 6001328 :                     ; bssscccc iir00lll
(1) 1325/ 6001328 :                     ;
(1) 1326/ 6001328 :                     ; b - Busy bit, this CPU can't be interrupted for CMD requests
(1) 1327/ 6001328 :                     ; r - Clears when frame is ready.
(1) 1328/ 6001328 :                     ; s - Status bits for some of the CMD interrupt tasks
(1) 1329/ 6001328 :                     ; c - Command number for CMD interrupt
(1) 1330/ 6001328 :                     ; i - Screen initialization bit(s)
(1) 1331/ 6001328 :                     ; l - MAIN LOOP command/task, For any mode change fill the
(1) 1332/ 6001328 :                     ;     ii bits: $C0+mode.
(1) 1333/ 6001328 :                     ; ----------------------------------------------------------------
(1) 1334/ 6001328 :                     
(1) 1335/ 6001328 :                     		align 4
(1) 1336/ 6001328 :                     master_loop:
(1) 1338/ 6001328 : D125                		mov	#_sysreg+comm0,r1		; DEBUG counter
(1) 1339/ 600132A : 6010                		mov.b	@r1,r0
(1) 1340/ 600132C : 7001                		add	#1,r0
(1) 1341/ 600132E : 2100                		mov.b	r0,@r1
(1) 1343/ 6001330 :                     	; ---------------------------------------
(1) 1344/ 6001330 : D124                		mov	#_vdpreg,r1			; Check if we got late
(1) 1345/ 6001332 : 841A                .waitl:		mov.b	@(vdpsts,r1),r0			; on VBlank
(1) 1346/ 6001334 : C880                		tst	#VBLK,r0
(1) 1347/ 6001336 : 8BFC                		bf	.waitl
(1) 1348/ 6001338 : 4F03                		stc	sr,@-r15
(1) 1349/ 600133A : 9053                		mov	#$F0,r0
(1) 1350/ 600133C : 400E                		ldc	r0,sr
(1) 1351/ 600133E : D122                		mov	#RAM_Mars_DreqDma,r1		; Copy DREQ data into a safe
(1) 1352/ 6001340 : D222                		mov	#RAM_Mars_DreqRead,r2		; location for reading
(1) 1353/ 6001342 : 9350                		mov	#sizeof_dreq/4,r3
(1) 1354/ 6001344 :                     .copy_safe:
(1) 1355/ 6001344 : 6016                		mov	@r1+,r0
(1) 1356/ 6001346 : 2202                		mov	r0,@r2
(1) 1357/ 6001348 : 4310                		dt	r3
(1) 1358/ 600134A : 8FFB                		bf/s	.copy_safe
(1) 1359/ 600134C : 7204                		add	#4,r2
(1) 1360/ 600134E : 4F07                		ldc	@r15+,sr
(1) 1361/ 6001350 :                     
(1) 1362/ 6001350 :                     	; ---------------------------------------
(1) 1363/ 6001350 : D11C                		mov	#_vdpreg,r1			; Now wait for VBlank.
(1) 1364/ 6001352 : 841A                .waitv:		mov.b	@(vdpsts,r1),r0
(1) 1365/ 6001354 : C880                		tst	#VBLK,r0
(1) 1366/ 6001356 : 89FC                		bt	.waitv
(1) 1367/ 6001358 : C510                 		mov.w	@(marsGbl_XShift,gbr),r0	; Set SHIFT bit first
(1) 1368/ 600135A : D11D                		mov	#_vdpreg+shift,r1		; For the indexed-scrolling mode.
(1) 1369/ 600135C : C901                		and	#1,r0
(1) 1370/ 600135E : 2101                		mov.w	r0,@r1
(1) 1371/ 6001360 : D11C                		mov	#RAM_Mars_DreqRead+Dreq_Palette,r1
(1) 1372/ 6001362 : D21D                		mov	#_palette,r2
(1) 1373/ 6001364 : E320                 		mov	#(256/8),r3
(1) 1374/ 6001366 :                     .copy_pal:
(1) 1375/ 6001366 :                     	rept 4
(1) 1376/ 6001366 :                     		mov	@r1+,r0				; Copy colors as LONGs, works on HW.
(1) 1377/ 6001366 :                     		mov	r0,@r2
(1) 1378/ 6001366 :                     		add	#4,r2
(1) 1379/ 6001366 :                     	endm
(1) 1376/ 6001366 : 6016                		mov	@r1+,r0				; Copy colors as LONGs, works on HW.
(1) 1377/ 6001368 : 2202                		mov	r0,@r2
(1) 1378/ 600136A : 7204                		add	#4,r2
(1) 1376/ 600136C : 6016                		mov	@r1+,r0				; Copy colors as LONGs, works on HW.
(1) 1377/ 600136E : 2202                		mov	r0,@r2
(1) 1378/ 6001370 : 7204                		add	#4,r2
(1) 1376/ 6001372 : 6016                		mov	@r1+,r0				; Copy colors as LONGs, works on HW.
(1) 1377/ 6001374 : 2202                		mov	r0,@r2
(1) 1378/ 6001376 : 7204                		add	#4,r2
(1) 1376/ 6001378 : 6016                		mov	@r1+,r0				; Copy colors as LONGs, works on HW.
(1) 1377/ 600137A : 2202                		mov	r0,@r2
(1) 1378/ 600137C : 7204                		add	#4,r2
(1) 1380/ 600137E : 4310                		dt	r3
(1) 1381/ 6001380 : 8BF1                		bf	.copy_pal
(1) 1382/ 6001382 :                     .not_ready:
(1) 1383/ 6001382 : D116                		mov	#_sysreg+comm12+1,r1		; Clear comm R bit
(1) 1384/ 6001384 : 6010                		mov.b	@r1,r0				; this tells to 68k that the frame is ready
(1) 1385/ 6001386 : C9DF                		and	#%11011111,r0
(1) 1386/ 6001388 : 2100                		mov.b	r0,@r1
(1) 1387/ 600138A :                     
(1) 1388/ 600138A :                     ; ---------------------------------------
(1) 1389/ 600138A :                     ; Init/Loop the current mode
(1) 1390/ 600138A :                     ;
(1) 1391/ 600138A :                     ; Init uses 2 separate jumps in case
(1) 1392/ 600138A :                     ; some routines need to be called twice.
(1) 1393/ 600138A :                     ; (Framebuffer updates)
(1) 1394/ 600138A :                     ;
(1) 1395/ 600138A :                     ; NOTE:
(1) 1396/ 600138A :                     ; The LOOP part starts very early at
(1) 1397/ 600138A :                     ; VBlank, add some work to make sure it
(1) 1398/ 600138A :                     ; exits on display.
(1) 1399/ 600138A :                     ; ---------------------------------------
(1) 1400/ 600138A :                     
(1) 1401/ 600138A : E503                		mov	#%00000011,r5		; <-- current modes limit (0-3)
(1) 1402/ 600138C : D413                		mov	#_sysreg+(comm12+1),r4
(1) 1403/ 600138E : 932B                		mov	#%11000000,r3
(1) 1404/ 6001390 : E100                		mov	#0,r1
(1) 1405/ 6001392 : 6040                		mov.b	@r4,r0			; r0 - bit check
(1) 1406/ 6001394 : 600F                		exts.w	r0,r0
(1) 1407/ 6001396 : 4011                		cmp/pz	r0
(1) 1408/ 6001398 : 8909                		bt	.no_init
(1) 1409/ 600139A : 610C                		extu.b	r0,r1
(1) 1410/ 600139C : 6213                		mov	r1,r2
(1) 1411/ 600139E : 4200                		shll	r2
(1) 1412/ 60013A0 : 2239                		and	r3,r2
(1) 1413/ 60013A2 : 2139                		and	r3,r1
(1) 1414/ 60013A4 : 2059                		and	r5,r0
(1) 1415/ 60013A6 : 302C                		add	r2,r0
(1) 1416/ 60013A8 : 2400                		mov.b	r0,@r4
(1) 1417/ 60013AA : 4109                		shlr2	r1
(1) 1418/ 60013AC : 4109                		shlr2	r1
(1) 1419/ 60013AE :                     .no_init:
(1) 1420/ 60013AE : 2059                		and	r5,r0
(1) 1421/ 60013B0 : 4008                		shll2	r0
(1) 1422/ 60013B2 : 4008                		shll2	r0
(1) 1423/ 60013B4 : 301C                		add	r1,r0
(1) 1424/ 60013B6 : D10A                		mov	#mstr_gfxlist,r1
(1) 1425/ 60013B8 : 011E                		mov	@(r1,r0),r1
(1) 1426/ 60013BA : 412B                		jmp	@r1
(1) 1427/ 60013BC : 0009                		nop
(1) 1428/ 60013BE :                     		align 4
(1) 1429/ 60013C0 : 2000 4020 2000 4100 		ltorg
                    2600 6890 2600 6EE8 
                    2000 4102 2600 6EE8 
                    2000 4200 2000 402D 
                    0600 13EC 00F0 0196 
                    00C0                
(1) 1430/ 60013EA :                     
(1) 1431/ 60013EA :                     ; ---------------------------------------
(1) 1432/ 60013EA :                     ; jump lists
(1) 1433/ 60013EA :                     ;
(1) 1434/ 60013EA :                     ; NOTE: the LOOP parts starts at
(1) 1435/ 60013EA :                     ; very top of VBlank.
(1) 1436/ 60013EA :                     
(1) 1437/ 60013EA :                     		align 4
(1) 1438/ 60013EC : 0600 1436           mstr_gfxlist:	dc.l mstr_gfx0_loop	; $00
(1) 1439/ 60013F0 : 0600 142C           		dc.l mstr_gfx0_hblk
(1) 1440/ 60013F4 : 0600 1430           		dc.l mstr_gfx0_init_2
(1) 1441/ 60013F8 : 0600 1436           		dc.l mstr_gfx0_init_1
(1) 1442/ 60013FC : 0600 1460           		dc.l mstr_gfx1_loop	; $01
(1) 1443/ 6001400 : 0600 143C           		dc.l mstr_gfx1_hblk
(1) 1444/ 6001404 : 0600 144E           		dc.l mstr_gfx1_init_2
(1) 1445/ 6001408 : 0600 1440           		dc.l mstr_gfx1_init_1
(1) 1446/ 600140C : 0600 1520           		dc.l mstr_gfx2_loop	; $02
(1) 1447/ 6001410 : 0600 14C0           		dc.l mstr_gfx2_hblk
(1) 1448/ 6001414 : 0600 1508           		dc.l mstr_gfx2_init_2
(1) 1449/ 6001418 : 0600 14C4           		dc.l mstr_gfx2_init_1
(1) 1450/ 600141C : 0600 1640           		dc.l mstr_gfx3_loop	; $03
(1) 1451/ 6001420 : 0600 160C           		dc.l mstr_gfx3_hblk
(1) 1452/ 6001424 : 0600 1630           		dc.l mstr_gfx3_init_2
(1) 1453/ 6001428 : 0600 1610           		dc.l mstr_gfx3_init_1
(1) 1454/ 600142C :                     
(1) 1455/ 600142C :                     ; ============================================================
(1) 1456/ 600142C :                     ; ---------------------------------------
(1) 1457/ 600142C :                     ; Pseudo-screen mode $00: BLANK
(1) 1458/ 600142C :                     ;
(1) 1459/ 600142C :                     ; YOU must use set this mode if you are
(1) 1460/ 600142C :                     ; doing using these VDP settings
(1) 1461/ 600142C :                     ; on the Genesis side:
(1) 1462/ 600142C :                     ;
(1) 1463/ 600142C :                     ; - H32 mode
(1) 1464/ 600142C :                     ; - Double interlace mode
(1) 1465/ 600142C :                     ;   (both H32 and H40)
(1) 1466/ 600142C :                     ; ---------------------------------------
(1) 1467/ 600142C :                     
(1) 1468/ 600142C :                     		align 4
(1) 1469/ 600142C :                     
(1) 1470/ 600142C :                     ; -------------------------------
(1) 1471/ 600142C :                     ; HBlank
(1) 1472/ 600142C :                     ; -------------------------------
(1) 1473/ 600142C :                     
(1) 1474/ 600142C :                     mstr_gfx0_hblk:
(1) 1475/ 600142C : 000B                		rts
(1) 1476/ 600142E : 0009                		nop
(1) 1477/ 6001430 :                     		align 4
(1) 1478/ 6001430 :                     
(1) 1479/ 6001430 :                     ; -------------------------------
(1) 1480/ 6001430 :                     ; Init
(1) 1481/ 6001430 :                     ; -------------------------------
(1) 1482/ 6001430 :                     
(1) 1483/ 6001430 :                     mstr_gfx0_init_2:
(1) 1484/ 6001430 : D118                		mov 	#_vdpreg,r1
(1) 1485/ 6001432 : E000                		mov	#0,r0
(1) 1486/ 6001434 : 8011                		mov.b	r0,@(bitmapmd,r1)
(1) 1487/ 6001436 :                     mstr_gfx0_init_1:
(1) 1488/ 6001436 :                     ; 		mov	#$200,r1
(1) 1489/ 6001436 :                     ; 		mov	#511,r2
(1) 1490/ 6001436 :                     ; 		mov	#240,r3
(1) 1491/ 6001436 :                     ; 		mov	#0,r4
(1) 1492/ 6001436 :                     ; 		mov	#MarsVideo_ClearScreen,r0
(1) 1493/ 6001436 :                     ; 		jsr	@r0
(1) 1494/ 6001436 :                     ; 		nop
(1) 1495/ 6001436 :                     ; 		mov	#_vdpreg,r1		; In case we are still on VBlank...
(1) 1496/ 6001436 :                     ; -		mov.b	@(vdpsts,r1),r0
(1) 1497/ 6001436 :                     ; 		tst	#VBLK,r0
(1) 1498/ 6001436 :                     ; 		bf	-
(1) 1499/ 6001436 :                     ; 		mov	#_vdpreg,r1		; Framebuffer swap REQUEST
(1) 1500/ 6001436 :                     ; 		mov.b	@(framectl,r1),r0
(1) 1501/ 6001436 :                     ; 		xor	#1,r0
(1) 1502/ 6001436 :                     ; 		mov.b	r0,@(framectl,r1)
(1) 1503/ 6001436 :                     
(1) 1504/ 6001436 :                     ; -------------------------------
(1) 1505/ 6001436 :                     ; Loop
(1) 1506/ 6001436 :                     ; -------------------------------
(1) 1507/ 6001436 :                     
(1) 1508/ 6001436 :                     mstr_gfx0_loop:
(1) 1509/ 6001436 : A198                		bra	mstr_ready
(1) 1510/ 6001438 : 0009                		nop
(1) 1511/ 600143A :                     		align 4
(1) 1512/ 600143C :                     
(1) 1513/ 600143C :                     ; ============================================================
(1) 1514/ 600143C :                     ; ---------------------------------------
(1) 1515/ 600143C :                     ; Pseudo-screen mode $01:
(1) 1516/ 600143C :                     ;
(1) 1517/ 600143C :                     ; Super Sprites ONLY
(1) 1518/ 600143C :                     ; ---------------------------------------
(1) 1519/ 600143C :                     
(1) 1520/ 600143C :                     		align 4
(1) 1521/ 600143C :                     
(1) 1522/ 600143C :                     ; -------------------------------
(1) 1523/ 600143C :                     ; HBlank
(1) 1524/ 600143C :                     ; -------------------------------
(1) 1525/ 600143C :                     
(1) 1526/ 600143C :                     mstr_gfx1_hblk:
(1) 1527/ 600143C : 000B                		rts
(1) 1528/ 600143E : 0009                		nop
(1) 1529/ 6001440 :                     		align 4
(1) 1530/ 6001440 :                     
(1) 1531/ 6001440 :                     ; -------------------------------
(1) 1532/ 6001440 :                     ; Init
(1) 1533/ 6001440 :                     ; -------------------------------
(1) 1534/ 6001440 :                     
(1) 1535/ 6001440 :                     ; -------------------------------
(1) 1536/ 6001440 :                     ; Init
(1) 1537/ 6001440 :                     ; -------------------------------
(1) 1538/ 6001440 :                     
(1) 1539/ 6001440 :                     mstr_gfx1_init_1:
(1) 1540/ 6001440 : D115                		mov	#CACHE_MSTR_SCRL,r1		; Load CACHE code
(1) 1541/ 6001442 : 9239                		mov	#(CACHE_MSTR_SCRL_E-CACHE_MSTR_SCRL)/4,r2
(1) 1542/ 6001444 : D015                		mov	#Mars_LoadCacheRam,r0
(1) 1543/ 6001446 : 400B                		jsr	@r0
(1) 1544/ 6001448 : 0009                		nop
(1) 1545/ 600144A : A003                		bra	mstr_gfx1_cont
(1) 1546/ 600144C : 0009                		nop
(1) 1547/ 600144E :                     mstr_gfx1_init_2:
(1) 1548/ 600144E : D111                		mov 	#_vdpreg,r1
(1) 1549/ 6001450 : E001                		mov	#1,r0
(1) 1550/ 6001452 : 8011                		mov.b	r0,@(bitmapmd,r1)
(1) 1551/ 6001454 :                     mstr_gfx1_cont:
(1) 1552/ 6001454 : 9131                		mov	#$200,r1
(1) 1553/ 6001456 : 9230                		mov	#512,r2
(1) 1554/ 6001458 : 9330                		mov	#240,r3
(1) 1555/ 600145A : D011                		mov	#MarsVideo_MakeNametbl,r0
(1) 1556/ 600145C : 400B                		jsr	@r0
(1) 1557/ 600145E : E400                		mov	#0,r4
(1) 1558/ 6001460 :                     
(1) 1559/ 6001460 :                     ; -------------------------------
(1) 1560/ 6001460 :                     ; Loop
(1) 1561/ 6001460 :                     ; -------------------------------
(1) 1562/ 6001460 :                     
(1) 1563/ 6001460 :                     mstr_gfx1_loop:
(1) 1564/ 6001460 : 912B                		mov	#$200,r1		; *** This also counts as a delay for Watchdog ***
(1) 1565/ 6001462 : 922C                		mov	#(320+16)/2,r2
(1) 1566/ 6001464 : 932A                		mov	#240,r3
(1) 1567/ 6001466 : D00F                		mov	#MarsVideo_ClearScreen,r0
(1) 1568/ 6001468 : 400B                		jsr	@r0
(1) 1569/ 600146A : E400                		mov	#0,r4
(1) 1570/ 600146C :                     
(1) 1571/ 600146C : 9125                		mov	#$200,r1
(1) 1572/ 600146E : E200                		mov	#0,r2
(1) 1573/ 6001470 : E300                		mov	#0,r3
(1) 1574/ 6001472 : 9422                		mov	#512,r4
(1) 1575/ 6001474 : 9522                		mov	#240,r5
(1) 1576/ 6001476 : D60C                		mov	#512*240,r6
(1) 1577/ 6001478 : D70C                		mov	#Cach_Intrl_Size,r7
(1) 1578/ 600147A : D00D                		mov	#MarsVideo_MkSprCoords,r0	; Screen settings for SuperSpr boxes
(1) 1579/ 600147C : 400B                		jsr	@r0
(1) 1580/ 600147E : 0009                		nop
(1) 1581/ 6001480 : D00C                		mov	#MarsVideo_DrawSuperSpr_M,r0
(1) 1582/ 6001482 : 400B                		jsr	@r0
(1) 1583/ 6001484 : 0009                		nop
(1) 1584/ 6001486 :                     
(1) 1585/ 6001486 : D103                		mov	#_vdpreg,r1			; Framebuffer swap REQUEST
(1) 1586/ 6001488 : 841B                		mov.b	@(framectl,r1),r0
(1) 1587/ 600148A : CA01                		xor	#1,r0
(1) 1588/ 600148C : 801B                		mov.b	r0,@(framectl,r1)
(1) 1589/ 600148E :                     
(1) 1590/ 600148E : A16C                		bra	mstr_ready
(1) 1591/ 6001490 : 0009                		nop
(1) 1592/ 6001492 :                     		align 4
(1) 1593/ 6001494 : 2000 4100 0600 1924 		ltorg
                    0600 07E0 0600 08DC 
                    0600 08A4 0001 E000 
                    C000 0434 0600 0D50 
                    C000 0140 0126 0200 
                    00F0 00A8           
(1) 1594/ 60014C0 :                     
(1) 1595/ 60014C0 :                     ; ============================================================
(1) 1596/ 60014C0 :                     ; ---------------------------------------
(1) 1597/ 60014C0 :                     ; Pseudo-screen mode $02:
(1) 1598/ 60014C0 :                     ;
(1) 1599/ 60014C0 :                     ; 256-color smooth scrolling map
(1) 1600/ 60014C0 :                     ; ---------------------------------------
(1) 1601/ 60014C0 :                     
(1) 1602/ 60014C0 :                     		align 4
(1) 1603/ 60014C0 :                     
(1) 1604/ 60014C0 :                     ; -------------------------------
(1) 1605/ 60014C0 :                     ; HBlank
(1) 1606/ 60014C0 :                     ; -------------------------------
(1) 1607/ 60014C0 :                     
(1) 1608/ 60014C0 :                     mstr_gfx2_hblk:
(1) 1609/ 60014C0 : 000B                		rts
(1) 1610/ 60014C2 : 0009                		nop
(1) 1611/ 60014C4 :                     		align 4
(1) 1612/ 60014C4 :                     
(1) 1613/ 60014C4 :                     ; -------------------------------
(1) 1614/ 60014C4 :                     ; Init
(1) 1615/ 60014C4 :                     ; -------------------------------
(1) 1616/ 60014C4 :                     
(1) 1617/ 60014C4 :                     mstr_gfx2_init_1:
(1) 1618/ 60014C4 : D134                		mov	#_sysreg+comm14,r1
(1) 1619/ 60014C6 : 6011                .slv_wait:	mov.w	@r1,r0
(1) 1620/ 60014C8 : C90F                		and	#%00001111,r0
(1) 1621/ 60014CA : 2008                		tst	r0,r0
(1) 1622/ 60014CC : 8BFB                		bf	.slv_wait
(1) 1623/ 60014CE : D133                		mov	#_vdpreg,r1
(1) 1624/ 60014D0 : 8515                .wait_fb:	mov.w	@(vdpsts,r1),r0
(1) 1625/ 60014D2 : C802                		tst	#2,r0
(1) 1626/ 60014D4 : 8BFC                		bf	.wait_fb
(1) 1627/ 60014D6 :                     
(1) 1628/ 60014D6 : 200A                		xor	r0,r0
(1) 1629/ 60014D8 : D131                		mov	#RAM_Mars_ScrnBuff,r1
(1) 1630/ 60014DA : 928F                		mov	#(end_scrn02-RAM_Mars_ScrnBuff)/4,r2
(1) 1631/ 60014DC :                     .clr_scrn:
(1) 1632/ 60014DC : 2102                		mov	r0,@r1
(1) 1633/ 60014DE : 4210                		dt	r2
(1) 1634/ 60014E0 : 8FFC                		bf/s	.clr_scrn
(1) 1635/ 60014E2 : 7104                		add	#4,r1
(1) 1636/ 60014E4 : D12F                		mov	#CACHE_MSTR_SCRL,r1			; Load CACHE code
(1) 1637/ 60014E6 : 928A                		mov	#(CACHE_MSTR_SCRL_E-CACHE_MSTR_SCRL)/4,r2
(1) 1638/ 60014E8 : D02F                		mov	#Mars_LoadCacheRam,r0
(1) 1639/ 60014EA : 400B                		jsr	@r0
(1) 1640/ 60014EC : 0009                		nop
(1) 1641/ 60014EE :                     
(1) 1642/ 60014EE :                     	; *** Create scrolling Section 0
(1) 1643/ 60014EE : E100                		mov	#0,r1			; Make a scrolling section
(1) 1644/ 60014F0 : 9286                		mov	#$200,r2		; Framebuffer VRAM position
(1) 1645/ 60014F2 : 9386                		mov	#320,r3
(1) 1646/ 60014F4 : 9486                		mov	#224,r4
(1) 1647/ 60014F6 : BA61                		bsr	MarsVideo_MkScrlField
(1) 1648/ 60014F8 : E510                		mov	#16,r5			; <-- expand size
(1) 1649/ 60014FA : DE2C                		mov	#RAM_Mars_DreqRead+Dreq_BgExBuff,r14
(1) 1650/ 60014FC : DD2C                		mov	#RAM_Mars_ScrlBuff,r13
(1) 1651/ 60014FE : D02D                		mov	#MarsVideo_DrwMapData,r0
(1) 1652/ 6001500 : 400B                		jsr	@r0
(1) 1653/ 6001502 : 0009                		nop
(1) 1654/ 6001504 : A003                		bra	mstr_gfx2_init_cont
(1) 1655/ 6001506 : 0009                		nop
(1) 1656/ 6001508 :                     
(1) 1657/ 6001508 :                     mstr_gfx2_init_2:
(1) 1658/ 6001508 : D124                		mov 	#_vdpreg,r1
(1) 1659/ 600150A : E001                		mov	#1,r0
(1) 1660/ 600150C : 8011                		mov.b	r0,@(bitmapmd,r1)
(1) 1661/ 600150E :                     mstr_gfx2_init_cont:
(1) 1662/ 600150E :                     
(1) 1663/ 600150E :                     	; Copy-paste the entire pixel data
(1) 1664/ 600150E :                     	; into the framebuffer(s)
(1) 1665/ 600150E : DE2A                		mov	#RAM_Mars_ScrlBuff,r14
(1) 1666/ 6001510 : D12A                		mov	#RAM_Mars_ScrlData,r1
(1) 1667/ 6001512 : D22B                		mov	#_framebuffer,r2
(1) 1668/ 6001514 : 50EA                		mov	@(scrl_fbdata,r14),r0
(1) 1669/ 6001516 : 320C                		add	r0,r2
(1) 1670/ 6001518 : 9375                		mov	#(((320+16)*(224+16))+320)/4,r3
(1) 1671/ 600151A : D02A                		mov	#MarsVideo_DmaDraw,r0
(1) 1672/ 600151C : 400B                		jsr	@r0
(1) 1673/ 600151E : 0009                		nop
(1) 1674/ 6001520 :                     
(1) 1675/ 6001520 :                     ; -------------------------------
(1) 1676/ 6001520 :                     ; Loop
(1) 1677/ 6001520 :                     ; -------------------------------
(1) 1678/ 6001520 :                     
(1) 1679/ 6001520 :                     mstr_gfx2_loop:
(1) 1680/ 6001520 : DE29                		mov	#RAM_Mars_DreqRead+Dreq_BgExBuff,r14	; Move this scrolling area
(1) 1681/ 6001522 : DD2A                		mov	#RAM_Mars_ScrlBuff,r13
(1) 1682/ 6001524 : 50EC                		mov	@(md_bg_x,r14),r0
(1) 1683/ 6001526 : 1D0B                		mov	r0,@(scrl_xpos,r13)
(1) 1684/ 6001528 : 50ED                		mov	@(md_bg_y,r14),r0
(1) 1685/ 600152A : 1D0C                		mov	r0,@(scrl_ypos,r13)
(1) 1686/ 600152C : BAB8                		bsr	MarsVideo_Bg_UpdPos		; Update X/Y
(1) 1687/ 600152E : 0009                		nop
(1) 1688/ 6001530 : BAF0                		bsr	MarsVideo_Bg_DrawReq
(1) 1689/ 6001532 : 0009                		nop
(1) 1690/ 6001534 : D026                 		mov	#MarsVideo_DrawBgSSpr,r0	; Draw backup BG using OLD values
(1) 1691/ 6001536 : 400B                		jsr	@r0
(1) 1692/ 6001538 : 0009                		nop
(1) 1693/ 600153A : D126                		mov	#_sysreg+comm14+1,r1		; Slave task $01
(1) 1694/ 600153C : E001                		mov	#1,r0
(1) 1695/ 600153E : 2100                		mov.b	r0,@r1
(1) 1696/ 6001540 :                     
(1) 1697/ 6001540 :                     ;  testme 2
(1) 1698/ 6001540 : DE25                		mov	#RAM_Mars_ScrlBuff,r14
(1) 1699/ 6001542 : 51EA                		mov	@(scrl_fbdata,r14),r1
(1) 1700/ 6001544 : 52E9                		mov	@(scrl_fbpos,r14),r2
(1) 1701/ 6001546 : 53E8                		mov	@(scrl_fbpos_y,r14),r3
(1) 1702/ 6001548 : 54E6                		mov	@(scrl_intrl_w,r14),r4
(1) 1703/ 600154A : 55E7                		mov	@(scrl_intrl_h,r14),r5
(1) 1704/ 600154C : 56E5                		mov	@(scrl_intrl_size,r14),r6
(1) 1705/ 600154E : D723                		mov	#Cach_Intrl_Size,r7
(1) 1706/ 6001550 : D023                		mov	#MarsVideo_MkSprCoords,r0	; Screen settings for SuperSpr boxes
(1) 1707/ 6001552 : 400B                		jsr	@r0
(1) 1708/ 6001554 : 0009                		nop
(1) 1709/ 6001556 : D023                		mov	#MarsVideo_MkSprBoxes,r0	; Make refill boxes
(1) 1710/ 6001558 : 400B                		jsr	@r0
(1) 1711/ 600155A : 0009                		nop
(1) 1712/ 600155C : D122                		mov	#RAM_Mars_ScrlBuff,r1		; *** Make a visible section
(1) 1713/ 600155E : E200                		mov	#0,r2				; of the scrolling data
(1) 1714/ 6001560 : 9352                		mov	#240,r3				; From Y 0 to 240
(1) 1715/ 6001562 : D022                		mov	#MarsVideo_ShowScrlBg,r0
(1) 1716/ 6001564 : 400B                		jsr	@r0
(1) 1717/ 6001566 : 0009                		nop
(1) 1718/ 6001568 :                     
(1) 1719/ 6001568 : D021                		mov	#MarsVideo_DrawSuperSpr_M,r0
(1) 1720/ 600156A : 400B                		jsr	@r0
(1) 1721/ 600156C : 0009                		nop
(1) 1722/ 600156E :                     ;  testme 1
(1) 1723/ 600156E : E100                		mov	#0,r1
(1) 1724/ 6001570 : 9248                		mov	#224,r2
(1) 1725/ 6001572 : D320                		mov	#FBVRAM_PATCH,r3
(1) 1726/ 6001574 : D020                		mov	#MarsVideo_FixTblShift,r0	; HW: Fix those broken lines that
(1) 1727/ 6001576 : 400B                		jsr	@r0				; the Xshift register can't move.
(1) 1728/ 6001578 : 0009                		nop
(1) 1729/ 600157A : D107                		mov	#_sysreg+comm14,r1		; Wait for Slave
(1) 1730/ 600157C :                     .wait_slv:
(1) 1731/ 600157C : 6011                		mov.w	@r1,r0
(1) 1732/ 600157E : C90F                		and	#%00001111,r0
(1) 1733/ 6001580 : 2008                		tst	r0,r0
(1) 1734/ 6001582 : 8BFB                		bf	.wait_slv
(1) 1735/ 6001584 : D105                		mov	#_vdpreg,r1			; Make frame...
(1) 1736/ 6001586 :                     .waitv:
(1) 1737/ 6001586 : 841A                		mov.b	@(vdpsts,r1),r0
(1) 1738/ 6001588 : C880                		tst	#VBLK,r0
(1) 1739/ 600158A : 8BFC                		bf	.waitv
(1) 1740/ 600158C : 841B                		mov.b	@(framectl,r1),r0
(1) 1741/ 600158E : CA01                		xor	#1,r0
(1) 1742/ 6001590 : 801B                		mov.b	r0,@(framectl,r1)
(1) 1743/ 6001592 : A0EA                		bra	mstr_ready
(1) 1744/ 6001594 : 0009                		nop
(1) 1745/ 6001596 :                     		align 4
(1) 1746/ 6001598 : 2000 402E 2000 4100 		ltorg
                    2600 7980 0600 1924 
                    0600 07E0 2600 70E8 
                    2600 7990 C000 0010 
                    2600 7990 2600 79F8 
                    2400 0000 0600 0B5C 
                    2600 70E8 2600 7990 
                    C000 0288 2000 402F 
                    2600 7990 C000 0434 
                    0600 0D50 0600 0D64 
                    2600 7990 0600 09EC 
                    C000 0140 0001 D000 
                    0600 094C 4F2E 0126 
                    0200 0140 00E0 4F10 
                    00F0                
(1) 1747/ 600160A :                     
(1) 1748/ 600160A :                     ; ============================================================
(1) 1749/ 600160A :                     ; ---------------------------------------
(1) 1750/ 600160A :                     ; Mode 4: 3D MODE Polygons-only
(1) 1751/ 600160A :                     ;
(1) 1752/ 600160A :                     ; Objects are divided into read/write
(1) 1753/ 600160A :                     ; buffers:
(1) 1754/ 600160A :                     ;
(1) 1755/ 600160A :                     ; - This CPU draws the polygons from
(1) 1756/ 600160A :                     ; the READ buffer
(1) 1757/ 600160A :                     ; - at the same time the Slave CPU is
(1) 1758/ 600160A :                     ; building the 3d models and
(1) 1759/ 600160A :                     ; sorts the polygons FOR THE NEXT FRAME
(1) 1760/ 600160A :                     ; (NOT current)
(1) 1761/ 600160A :                     ; ---------------------------------------
(1) 1762/ 600160A :                     
(1) 1763/ 600160A :                     		align 4
(1) 1764/ 600160C :                     
(1) 1765/ 600160C :                     ; -------------------------------
(1) 1766/ 600160C :                     ; HBlank
(1) 1767/ 600160C :                     ; -------------------------------
(1) 1768/ 600160C :                     
(1) 1769/ 600160C :                     mstr_gfx3_hblk:
(1) 1770/ 600160C : 000B                		rts
(1) 1771/ 600160E : 0009                		nop
(1) 1772/ 6001610 :                     		align 4
(1) 1773/ 6001610 :                     
(1) 1774/ 6001610 :                     ; -------------------------------
(1) 1775/ 6001610 :                     ; Init
(1) 1776/ 6001610 :                     ; -------------------------------
(1) 1777/ 6001610 :                     
(1) 1778/ 6001610 :                     mstr_gfx3_init_1:
(1) 1779/ 6001610 : 200A                		xor	r0,r0
(1) 1780/ 6001612 : D157                		mov	#RAM_Mars_ScrnBuff,r1
(1) 1781/ 6001614 : 92E0                		mov	#(end_scrn02-RAM_Mars_ScrnBuff)/4,r2
(1) 1782/ 6001616 :                     .clr_scrn:
(1) 1783/ 6001616 : 2102                		mov	r0,@r1
(1) 1784/ 6001618 : 4210                		dt	r2
(1) 1785/ 600161A : 8FFC                		bf/s	.clr_scrn
(1) 1786/ 600161C : 7104                		add	#4,r1
(1) 1787/ 600161E :                     ; 		xor	r0,r0
(1) 1788/ 600161E :                     ; 		mov.w	r0,@(marsGbl_PolyBuffNum,gbr)
(1) 1789/ 600161E :                     
(1) 1790/ 600161E : D155                		mov	#CACHE_MSTR_PLGN,r1
(1) 1791/ 6001620 : 92DB                		mov	#(CACHE_MSTR_PLGN_E-CACHE_MSTR_PLGN)/4,r2
(1) 1792/ 6001622 : D055                		mov	#Mars_LoadCacheRam,r0
(1) 1793/ 6001624 : 400B                		jsr	@r0
(1) 1794/ 6001626 : 0009                		nop
(1) 1795/ 6001628 : E000                		mov	#0,r0
(1) 1796/ 600162A : C110                		mov.w	r0,@(marsGbl_XShift,gbr)
(1) 1797/ 600162C : A003                		bra	mstr_gfx3_init_cont
(1) 1798/ 600162E : 0009                		nop
(1) 1799/ 6001630 :                     
(1) 1800/ 6001630 :                     mstr_gfx3_init_2:
(1) 1801/ 6001630 : D152                		mov 	#_vdpreg,r1
(1) 1802/ 6001632 : E001                		mov	#1,r0
(1) 1803/ 6001634 : 8011                		mov.b	r0,@(bitmapmd,r1)
(1) 1804/ 6001636 :                     mstr_gfx3_init_cont:
(1) 1805/ 6001636 : D151                		mov	#_vdpreg,r1
(1) 1806/ 6001638 : 8515                .wait_fb:	mov.w	@(vdpsts,r1),r0			; Wait until framebuffer is unlocked
(1) 1807/ 600163A : C802                		tst	#2,r0
(1) 1808/ 600163C : 8BFC                		bf	.wait_fb
(1) 1809/ 600163E : 0009                		nop
(1) 1810/ 6001640 :                     
(1) 1811/ 6001640 :                     ; -------------------------------
(1) 1812/ 6001640 :                     ; Loop
(1) 1813/ 6001640 :                     ; -------------------------------
(1) 1814/ 6001640 :                     
(1) 1815/ 6001640 :                     mstr_gfx3_loop:
(1) 1816/ 6001640 : D34F                		mov	#_sysreg+comm12,r3
(1) 1817/ 6001642 : D450                		mov	#_sysreg+comm14,r4
(1) 1818/ 6001644 :                     .wait_me:
(1) 1819/ 6001644 : 6031                		mov.w	@r3,r0
(1) 1820/ 6001646 : C90F                		and	#%1111,r0
(1) 1821/ 6001648 : 8803                		cmp/eq	#3,r0
(1) 1822/ 600164A : 8901                		bt	.mk_me
(1) 1823/ 600164C : A08D                		bra	mstr_ready		; <-- Stop processing on mode change
(1) 1824/ 600164E : 0009                		nop
(1) 1825/ 6001650 :                     		align 4
(1) 1826/ 6001650 :                     .mk_me:
(1) 1827/ 6001650 : 6041                		mov.w	@r4,r0
(1) 1828/ 6001652 : C90F                		and	#%00001111,r0		; Slave busy?
(1) 1829/ 6001654 : 2008                		tst	r0,r0
(1) 1830/ 6001656 : 8BF5                		bf	.wait_me
(1) 1831/ 6001658 : 4F03                		stc	sr,@-r15		; Disable interrupts
(1) 1832/ 600165A : 90BF                		mov	#$F0,r0
(1) 1833/ 600165C : 400E                		ldc	r0,sr
(1) 1834/ 600165E : D14A                		mov	#RAM_Mars_DreqRead+Dreq_Objects,r1	; Copy CAMERA and OBJECTS for Slave
(1) 1835/ 6001660 : D24A                		mov	#RAM_Mars_Objects,r2
(1) 1836/ 6001662 : E360                		mov	#(sizeof_mdlobj*MAX_MODELS)/4,r3
(1) 1837/ 6001664 :                     .copy_obj:
(1) 1838/ 6001664 : 6016                		mov	@r1+,r0
(1) 1839/ 6001666 : 2202                		mov	r0,@r2
(1) 1840/ 6001668 : 4310                		dt	r3
(1) 1841/ 600166A : 8FFB                		bf/s	.copy_obj
(1) 1842/ 600166C : 7204                		add	#4,r2
(1) 1843/ 600166E : D148                		mov	#RAM_Mars_DreqRead+Dreq_ObjCam,r1
(1) 1844/ 6001670 : D248                		mov	#RAM_Mars_ObjCamera,r2
(1) 1845/ 6001672 : E306                		mov	#sizeof_camera/4,r3
(1) 1846/ 6001674 :                     .copy_cam:
(1) 1847/ 6001674 : 6016                		mov	@r1+,r0
(1) 1848/ 6001676 : 2202                		mov	r0,@r2
(1) 1849/ 6001678 : 4310                		dt	r3
(1) 1850/ 600167A : 8FFB                		bf/s	.copy_cam
(1) 1851/ 600167C : 7204                		add	#4,r2
(1) 1852/ 600167E : C50C                		mov.w	@(marsGbl_PolyBuffNum,gbr),r0	; Swap Read/Write sections FIRST
(1) 1853/ 6001680 : CA01                		xor	#1,r0
(1) 1854/ 6001682 : C10C                		mov.w	r0,@(marsGbl_PolyBuffNum,gbr)
(1) 1855/ 6001684 : D444                		mov	#_sysreg+comm14+1,r4		; Request Slave task $02: Build the models
(1) 1856/ 6001686 : E002                		mov	#2,r0
(1) 1857/ 6001688 : 2400                		mov.b	r0,@r4
(1) 1859/ 600168A : D144                		mov	#_sysreg+comm0,r1		; DEBUG counter
(1) 1860/ 600168C : 200A                		xor	r0,r0
(1) 1861/ 600168E : 2100                		mov.b	r0,@r1
(1) 1863/ 6001690 : 4F07                		ldc	@r15+,sr
(1) 1864/ 6001692 :                     
(1) 1865/ 6001692 :                     	; Start with the polygons
(1) 1866/ 6001692 : D13A                		mov	#_vdpreg,r1
(1) 1867/ 6001694 : 8515                .wait_fb_i:	mov.w	@(vdpsts,r1),r0			; Wait until framebuffer is unlocked
(1) 1868/ 6001696 : C802                		tst	#2,r0
(1) 1869/ 6001698 : 8BFC                		bf	.wait_fb_i
(1) 1870/ 600169A : 90A0                		mov	#$A5,r0				; VDPFILL: Pre-start at $A5
(1) 1871/ 600169C : 8113                		mov.w	r0,@(6,r1)
(1) 1872/ 600169E : D040                		mov	#RAM_Mars_SVdpDrwList,r0	; Reset DDA Start/End/Read/Write points
(1) 1873/ 60016A0 : C200                		mov	r0,@(marsGbl_PlyPzList_R,gbr)
(1) 1874/ 60016A2 : C201                		mov	r0,@(marsGbl_PlyPzList_W,gbr)
(1) 1875/ 60016A4 : C202                		mov	r0,@(marsGbl_PlyPzList_Start,gbr)
(1) 1876/ 60016A6 : D03F                		mov	#RAM_Mars_SVdpDrwList_E,r0
(1) 1877/ 60016A8 : C203                		mov	r0,@(marsGbl_PlyPzList_End,gbr)
(1) 1878/ 60016AA : E000                		mov	#0,r0
(1) 1879/ 60016AC : C10D                		mov.w	r0,@(marsGbl_PlyPzCntr,gbr)	; And pieces counter
(1) 1880/ 60016AE : C10A                		mov.w	r0,@(marsGbl_WdgReady,gbr)
(1) 1881/ 60016B0 : E007                		mov	#7,r0				; Start on last mode
(1) 1882/ 60016B2 : C108                		mov.w	r0,@(marsGbl_WdgMode,gbr)
(1) 1883/ 60016B4 : 9094                		mov	#224,r0				; Lines to clear (WdgMode $07)
(1) 1884/ 60016B6 : D13C                		mov	#Cach_ClrLines,r1
(1) 1885/ 60016B8 : 2102                		mov	r0,@r1
(1) 1886/ 60016BA : 9192                		mov	#$200,r1
(1) 1887/ 60016BC : 9291                		mov	#512,r2			; <-- fixed WIDTH
(1) 1888/ 60016BE : 938D                		mov	#240,r3
(1) 1889/ 60016C0 : D03A                		mov	#MarsVideo_MakeNametbl,r0
(1) 1890/ 60016C2 : 400B                		jsr	@r0
(1) 1891/ 60016C4 : E400                		mov	#0,r4
(1) 1892/ 60016C6 : E100                		mov	#0,r1
(1) 1893/ 60016C8 : E210                		mov	#$10,r2
(1) 1894/ 60016CA : D039                		mov	#Mars_SetWatchdog,r0
(1) 1895/ 60016CC : 400B                		jsr	@r0
(1) 1896/ 60016CE : 0009                		nop
(1) 1897/ 60016D0 :                     
(1) 1898/ 60016D0 :                     	; The watchdog is now active
(1) 1899/ 60016D0 :                     
(1) 1900/ 60016D0 :                     ; SELECTION SORT for the READ buffer --quick copypaste---
(1) 1901/ 60016D0 :                     ; r14 - ***
(1) 1902/ 60016D0 :                     ; r13 - Polygon LIST top
(1) 1903/ 60016D0 :                     ; r12 - **
(1) 1904/ 60016D0 :                     ; r11 - Number of faces (MAIN)
(1) 1905/ 60016D0 :                     ; r10 - **
(1) 1906/ 60016D0 : C50C                		mov.w   @(marsGbl_PolyBuffNum,gbr),r0	; Start drawing polygons from the READ buffer
(1) 1907/ 60016D2 : C801                		tst     #1,r0				; Check for which buffer to use
(1) 1908/ 60016D4 : 8902                		bt	.page_22
(1) 1909/ 60016D6 : DD37                		mov 	#RAM_Mars_PlgnList_0,r13
(1) 1910/ 60016D8 : A002                		bra	.cont_plgn2
(1) 1911/ 60016DA : DB36                		mov	#RAM_Mars_PlgnNum_0,r11
(1) 1912/ 60016DC :                     .page_22:
(1) 1913/ 60016DC : DD37                		mov 	#RAM_Mars_PlgnList_1,r13
(1) 1914/ 60016DE : DB38                		mov	#RAM_Mars_PlgnNum_1,r11
(1) 1915/ 60016E0 :                     .cont_plgn2:
(1) 1916/ 60016E0 : 6BB2                		mov	@r11,r11
(1) 1917/ 60016E2 : 4B15                		cmp/pl	r11
(1) 1918/ 60016E4 : 8B15                		bf	.exit
(1) 1919/ 60016E6 :                     .roll:
(1) 1920/ 60016E6 : 6AB3                		mov	r11,r10
(1) 1921/ 60016E8 : 6ED3                		mov	r13,r14
(1) 1922/ 60016EA : 61E2                		mov	@r14,r1		; r1 - Start value
(1) 1923/ 60016EC :                     .srch:
(1) 1924/ 60016EC : 60E2                		mov	@r14,r0
(1) 1925/ 60016EE : 3017                		cmp/gt	r1,r0
(1) 1926/ 60016F0 : 8901                		bt	.higher
(1) 1927/ 60016F2 : 6103                		mov	r0,r1		; Update LOW r1 value
(1) 1928/ 60016F4 : 65E3                		mov	r14,r5		; Save LOWER pointer
(1) 1929/ 60016F6 :                     .higher:
(1) 1930/ 60016F6 : 4A10                		dt	r10
(1) 1931/ 60016F8 : 8FF8                		bf/s	.srch
(1) 1932/ 60016FA : 7E08                		add	#8,r14
(1) 1933/ 60016FC : 6156                		mov	@r5+,r1		; Swap Z and pointers
(1) 1934/ 60016FE : 6256                		mov	@r5+,r2
(1) 1935/ 6001700 : 63D6                		mov	@r13+,r3
(1) 1936/ 6001702 : 64D6                		mov	@r13+,r4
(1) 1937/ 6001704 : 2D26                		mov	r2,@-r13
(1) 1938/ 6001706 : 2D16                		mov	r1,@-r13
(1) 1939/ 6001708 : 2546                		mov	r4,@-r5
(1) 1940/ 600170A : 2536                		mov	r3,@-r5
(1) 1941/ 600170C : 4B10                		dt	r11
(1) 1942/ 600170E : 8FEA                		bf/s	.roll
(1) 1943/ 6001710 : 7D08                		add	#8,r13
(1) 1944/ 6001712 :                     .exit:
(1) 1945/ 6001712 :                     
(1) 1946/ 6001712 :                     
(1) 1947/ 6001712 :                     
(1) 1948/ 6001712 :                     
(1) 1949/ 6001712 : C50C                		mov.w   @(marsGbl_PolyBuffNum,gbr),r0	; Start drawing polygons from the READ buffer
(1) 1950/ 6001714 : C801                		tst     #1,r0				; Check for which buffer to use
(1) 1951/ 6001716 : 8902                		bt	.page_2
(1) 1952/ 6001718 : DE2A                		mov 	#RAM_Mars_PlgnList_0,r14
(1) 1953/ 600171A : A002                		bra	.cont_plgn
(1) 1954/ 600171C : DD29                		mov	#RAM_Mars_PlgnNum_0,r13
(1) 1955/ 600171E :                     .page_2:
(1) 1956/ 600171E : DE2B                		mov 	#RAM_Mars_PlgnList_1,r14
(1) 1957/ 6001720 :                     ; 		nop
(1) 1958/ 6001720 : DD2B                		mov	#RAM_Mars_PlgnNum_1,r13
(1) 1959/ 6001722 :                     .cont_plgn:
(1) 1960/ 6001722 : 6DD2                		mov	@r13,r13
(1) 1961/ 6001724 : 4D15                		cmp/pl	r13
(1) 1962/ 6001726 : 8B0E                		bf	.skip
(1) 1963/ 6001728 :                     	; Sorting goes here...
(1) 1964/ 6001728 : 7E04                		add	#4,r14
(1) 1965/ 600172A :                     .loop:
(1) 1966/ 600172A : 60E2                		mov	@r14,r0				; Get location of the polygon
(1) 1967/ 600172C : 4015                		cmp/pl	r0				; Zero?
(1) 1968/ 600172E : 8B07                		bf	.invalid			; if yes, skip
(1) 1969/ 6001730 : 2FE6                		mov	r14,@-r15
(1) 1970/ 6001732 : 2FD6                		mov	r13,@-r15
(1) 1971/ 6001734 : 6E03                		mov	r0,r14
(1) 1972/ 6001736 : D027                		mov 	#MarsVideo_SlicePlgn,r0
(1) 1973/ 6001738 : 400B                		jsr	@r0
(1) 1974/ 600173A : 0009                		nop
(1) 1975/ 600173C : 6DF6                		mov	@r15+,r13
(1) 1976/ 600173E : 6EF6                		mov	@r15+,r14
(1) 1977/ 6001740 :                     .invalid:
(1) 1978/ 6001740 : 4D10                		dt	r13				; Decrement numof_polygons
(1) 1979/ 6001742 : 8FF2                		bf/s	.loop
(1) 1980/ 6001744 : 7E08                		add	#8,r14				; Move to next entry
(1) 1981/ 6001746 :                     .skip:
(1) 1982/ 6001746 : E001                		mov	#1,r0
(1) 1983/ 6001748 : C10A                		mov.w	r0,@(marsGbl_WdgReady,gbr)
(1) 1984/ 600174A :                     ; 		mov	#MarsMdl_MdlLoop,r0
(1) 1985/ 600174A :                     ; 		jsr	@r0
(1) 1986/ 600174A :                     ; 		nop
(1) 1987/ 600174A :                     
(1) 1988/ 600174A : C50D                .wait_pz: 	mov.w	@(marsGbl_PlyPzCntr,gbr),r0	; Any pieces remaining?
(1) 1989/ 600174C : 2008                		tst	r0,r0
(1) 1990/ 600174E : 8BFC                		bf	.wait_pz
(1) 1991/ 6001750 : C508                .wait_wdg:	mov.w	@(marsGbl_WdgMode,gbr),r0	; Watchdog finished?
(1) 1992/ 6001752 : 2008                		tst	r0,r0
(1) 1993/ 6001754 : 8BFC                		bf	.wait_wdg
(1) 1994/ 6001756 : 9145                		mov.l   #$FFFFFE80,r1			; Disable watchdog
(1) 1995/ 6001758 : 9045                		mov.w   #$A518,r0
(1) 1996/ 600175A : 2101                		mov.w   r0,@r1
(1) 1997/ 600175C : D107                		mov	#_vdpreg,r1
(1) 1998/ 600175E : 8515                .wait_sv:	mov.w	@($A,r1),r0			; Check if FB is locked
(1) 1999/ 6001760 : C802                		tst	#2,r0
(1) 2000/ 6001762 : 8BFC                		bf	.wait_sv
(1) 2001/ 6001764 : 841B                		mov.b	@(framectl,r1),r0		; Frameswap request
(1) 2002/ 6001766 : CA01                		xor	#1,r0
(1) 2003/ 6001768 : 801B                		mov.b	r0,@(framectl,r1)
(1) 2004/ 600176A :                     
(1) 2005/ 600176A :                     ; ============================================================
(1) 2006/ 600176A :                     
(1) 2007/ 600176A :                     mstr_ready:
(1) 2008/ 600176A :                     
(1) 2009/ 600176A : ADDD                		bra	master_loop
(1) 2010/ 600176C : 0009                		nop
(1) 2011/ 600176E :                     		align 4
(1) 2012/ 6001770 : 2600 7980 0600 1DBC 		ltorg
                    0600 07E0 2000 4100 
                    2000 402C 2000 402E 
                    2600 7180 2603 2D48 
                    2600 7168 2603 2EC8 
                    2000 402F 2000 4020 
                    2600 7980 2601 4340 
                    C000 06DC 0600 08DC 
                    0600 0820 2602 F000 
                    2603 2D40 2603 0EA0 
                    2603 2D44 2602 F000 
                    2603 2D40 2603 0EA0 
                    2603 2D44 C000 03EC 
                    4F2E 01F0 00F0 00A5 
                    00E0 0200 FE80 A518 
(1) 2013/ 60017E8 :                     
(1) 2014/ 60017E8 :                     ; ; ============================================================
(1) 2015/ 60017E8 :                     ; ; ---------------------------------------
(1) 2016/ 60017E8 :                     ; ; Pseudo-screen mode $01:
(1) 2017/ 60017E8 :                     ; ;
(1) 2018/ 60017E8 :                     ; ; A Generic screen in any
(1) 2019/ 60017E8 :                     ; ; bitmap mode: Indexed, Direct or RLE
(1) 2020/ 60017E8 :                     ; ;
(1) 2021/ 60017E8 :                     ; ; Watch out for the limited lines
(1) 2022/ 60017E8 :                     ; ; available for DIRECT COLOR
(1) 2023/ 60017E8 :                     ; ; ---------------------------------------
(1) 2024/ 60017E8 :                     ;		align 4
(1) 2025/ 60017E8 :                     ; ; -------------------------------
(1) 2026/ 60017E8 :                     ; ; HBlank
(1) 2027/ 60017E8 :                     ; ; -------------------------------
(1) 2028/ 60017E8 :                     ;
(1) 2029/ 60017E8 :                     ; mstr_gfx1_hblk:
(1) 2030/ 60017E8 :                     ; 		rts
(1) 2031/ 60017E8 :                     ; 		nop
(1) 2032/ 60017E8 :                     ; 		align 4
(1) 2033/ 60017E8 :                     ;
(1) 2034/ 60017E8 :                     ; ; -------------------------------
(1) 2035/ 60017E8 :                     ; ; Init
(1) 2036/ 60017E8 :                     ; ; -------------------------------
(1) 2037/ 60017E8 :                     ;
(1) 2038/ 60017E8 :                     ; mstr_gfx1_init_2:
(1) 2039/ 60017E8 :                     ; 		mov	#0,r0
(1) 2040/ 60017E8 :                     ; 		mov.w	r0,@(marsGbl_XShift,gbr)
(1) 2041/ 60017E8 :                     ; 		mov 	#_vdpreg,r1
(1) 2042/ 60017E8 :                     ; 		mov	#2,r0
(1) 2043/ 60017E8 :                     ; 		mov.b	r0,@(bitmapmd,r1)
(1) 2044/ 60017E8 :                     ; mstr_gfx1_init_1:
(1) 2045/ 60017E8 :                     ; 		mov	#MarsVideo_ResetNameTbl,r0
(1) 2046/ 60017E8 :                     ; 		jsr	@r0
(1) 2047/ 60017E8 :                     ; 		nop
(1) 2048/ 60017E8 :                     ;
(1) 2049/ 60017E8 :                     ; ; -------------------------------
(1) 2050/ 60017E8 :                     ; ; Loop
(1) 2051/ 60017E8 :                     ; ; -------------------------------
(1) 2052/ 60017E8 :                     ;
(1) 2053/ 60017E8 :                     ; mstr_gfx1_loop:
(1) 2054/ 60017E8 :                     ; 		mov	#RAM_Mars_DreqRead+Dreq_ScrlBuff,r1
(1) 2055/ 60017E8 :                     ; 		mov	@(Dreq_Scrn_Type,r1),r0
(1) 2056/ 60017E8 :                     ; 		and	#%11,r0
(1) 2057/ 60017E8 :                     ; 		shll2	r0
(1) 2058/ 60017E8 :                     ; 		mov	#.m1list,r2
(1) 2059/ 60017E8 :                     ; 		mov	@(r0,r2),r2
(1) 2060/ 60017E8 :                     ; 		jmp	@r2
(1) 2061/ 60017E8 :                     ; 		nop
(1) 2062/ 60017E8 :                     ; 		align 4
(1) 2063/ 60017E8 :                     ; .m1list:
(1) 2064/ 60017E8 :                     ; 		dc.l mstr_ready
(1) 2065/ 60017E8 :                     ; 		dc.l mstr_ready		; Indexed
(1) 2066/ 60017E8 :                     ; 		dc.l .direct		; Direct
(1) 2067/ 60017E8 :                     ; 		dc.l mstr_ready
(1) 2068/ 60017E8 :                     ;
(1) 2069/ 60017E8 :                     ; ; -------------------------------
(1) 2070/ 60017E8 :                     ; ; Direct color
(1) 2071/ 60017E8 :                     ; ; currently 320x200 (DOS-style)
(1) 2072/ 60017E8 :                     ; .direct:
(1) 2073/ 60017E8 :                     ; 		mov	@(Dreq_Scrn_Data,r1),r1
(1) 2074/ 60017E8 :                     ; 		mov	#_framebuffer+$200,r2
(1) 2075/ 60017E8 :                     ; 		mov	#(320*200/2)/2,r3	; <- fixed size
(1) 2076/ 60017E8 :                     ; .copy_me:
(1) 2077/ 60017E8 :                     ; 		mov	@r1+,r0
(1) 2078/ 60017E8 :                     ; 		mov	r0,@r2
(1) 2079/ 60017E8 :                     ; 		add	#4,r2
(1) 2080/ 60017E8 :                     ; 		mov	@r1+,r0
(1) 2081/ 60017E8 :                     ; 		mov	r0,@r2
(1) 2082/ 60017E8 :                     ; 		dt	r3
(1) 2083/ 60017E8 :                     ; 		bf/s	.copy_me
(1) 2084/ 60017E8 :                     ; 		add	#4,r2
(1) 2085/ 60017E8 :                     ; .dont_rdrw:
(1) 2086/ 60017E8 :                     ; 		mov	#$200,r1
(1) 2087/ 60017E8 :                     ; 		mov	#320*2,r2
(1) 2088/ 60017E8 :                     ; 		mov	#200,r3
(1) 2089/ 60017E8 :                     ; 		mov	#MarsVideo_MakeNametbl,r0
(1) 2090/ 60017E8 :                     ; 		jsr	@r0
(1) 2091/ 60017E8 :                     ; 		mov	#12,r4
(1) 2092/ 60017E8 :                     ; 		mov	#_vdpreg,r1		; In case we are still on VBlank...
(1) 2093/ 60017E8 :                     ; -		mov.b	@(vdpsts,r1),r0
(1) 2094/ 60017E8 :                     ; 		tst	#VBLK,r0
(1) 2095/ 60017E8 :                     ; 		bf	-
(1) 2096/ 60017E8 :                     ; 		mov	#_vdpreg,r1		; Framebuffer swap REQUEST
(1) 2097/ 60017E8 :                     ; 		mov.b	@(framectl,r1),r0
(1) 2098/ 60017E8 :                     ; 		xor	#1,r0
(1) 2099/ 60017E8 :                     ; 		mov.b	r0,@(framectl,r1)
(1) 2100/ 60017E8 :                     ;
(1) 2101/ 60017E8 :                     ; 		bra	mstr_ready
(1) 2102/ 60017E8 :                     ; 		nop
(1) 2103/ 60017E8 :                     ;
(1) 2104/ 60017E8 :                     ; ; -------------------------------
(1) 2105/ 60017E8 :                     ; ; RLE indexed-compressed image
(1) 2106/ 60017E8 :                     ;
(1) 2107/ 60017E8 :                     ; .rle:
(1) 2108/ 60017E8 :                     ; 		bra	mstr_ready
(1) 2109/ 60017E8 :                     ; 		nop
(1) 2110/ 60017E8 :                     
(1) 2111/ 60017E8 :                     ; ; ============================================================
(1) 2112/ 60017E8 :                     ; ; ---------------------------------------
(1) 2113/ 60017E8 :                     ; ; Pseudo-screen mode $03:
(1) 2114/ 60017E8 :                     ; ; Scalable 256-color screen
(1) 2115/ 60017E8 :                     ; ;
(1) 2116/ 60017E8 :                     ; ; Not as smooth as Mode 2
(1) 2117/ 60017E8 :                     ; ; ---------------------------------------
(1) 2118/ 60017E8 :                     ;
(1) 2119/ 60017E8 :                     ; ; -------------------------------
(1) 2120/ 60017E8 :                     ; ; HBlank
(1) 2121/ 60017E8 :                     ; ; -------------------------------
(1) 2122/ 60017E8 :                     ;
(1) 2123/ 60017E8 :                     ; mstr_gfx3_hblk:
(1) 2124/ 60017E8 :                     ; 		rts
(1) 2125/ 60017E8 :                     ; 		nop
(1) 2126/ 60017E8 :                     ; 		align 4
(1) 2127/ 60017E8 :                     ;
(1) 2128/ 60017E8 :                     ; ; -------------------------------
(1) 2129/ 60017E8 :                     ; ; Init
(1) 2130/ 60017E8 :                     ; ; -------------------------------
(1) 2131/ 60017E8 :                     ;
(1) 2132/ 60017E8 :                     ; mstr_gfx3_init_1:
(1) 2133/ 60017E8 :                     ; 		mov	#CACHE_MSTR_SCRL,r1
(1) 2134/ 60017E8 :                     ; 		mov	#(CACHE_MSTR_SCRL_E-CACHE_MSTR_SCRL)/4,r2
(1) 2135/ 60017E8 :                     ; 		mov	#Mars_LoadCacheRam,r0
(1) 2136/ 60017E8 :                     ; 		jsr	@r0
(1) 2137/ 60017E8 :                     ; 		nop
(1) 2138/ 60017E8 :                     ; 		mov	#0,r0
(1) 2139/ 60017E8 :                     ; 		mov.w	r0,@(marsGbl_XShift,gbr)
(1) 2140/ 60017E8 :                     ; 		bra	mstr_gfx3_loop
(1) 2141/ 60017E8 :                     ; 		nop
(1) 2142/ 60017E8 :                     ;
(1) 2143/ 60017E8 :                     ; mstr_gfx3_init_2:
(1) 2144/ 60017E8 :                     ; 		mov 	#_vdpreg,r1
(1) 2145/ 60017E8 :                     ; 		mov	#1,r0
(1) 2146/ 60017E8 :                     ; 		mov.b	r0,@(bitmapmd,r1)
(1) 2147/ 60017E8 :                     ;
(1) 2148/ 60017E8 :                     ; ; -------------------------------
(1) 2149/ 60017E8 :                     ; ; Loop
(1) 2150/ 60017E8 :                     ; ; -------------------------------
(1) 2151/ 60017E8 :                     ;
(1) 2152/ 60017E8 :                     ; mstr_gfx3_loop:
(1) 2153/ 60017E8 :                     ; 		mov	#$200,r1
(1) 2154/ 60017E8 :                     ; 		mov	#0,r2
(1) 2155/ 60017E8 :                     ; 		mov	#0,r3
(1) 2156/ 60017E8 :                     ; 		mov	#320,r4
(1) 2157/ 60017E8 :                     ; 		mov	#240,r5
(1) 2158/ 60017E8 :                     ; 		mov	#320*240,r6
(1) 2159/ 60017E8 :                     ; 		mov	#Cach_Intrl_Size,r7
(1) 2160/ 60017E8 :                     ; 		mov	#MarsVideo_CopySprBgPos,r0
(1) 2161/ 60017E8 :                     ; 		jsr	@r0
(1) 2162/ 60017E8 :                     ; 		nop
(1) 2163/ 60017E8 :                     ; 		mov	#MarsVideo_DrawScaled,r0
(1) 2164/ 60017E8 :                     ; 		jsr	@r0
(1) 2165/ 60017E8 :                     ; 		nop
(1) 2166/ 60017E8 :                     ; 		mov	#MarsVideo_DrawSuperSpr_M,r0	; Draw Super Sprites
(1) 2167/ 60017E8 :                     ; 		jsr	@r0
(1) 2168/ 60017E8 :                     ; 		nop
(1) 2169/ 60017E8 :                     ; 		mov	#$200,r1
(1) 2170/ 60017E8 :                     ; 		mov	#320,r2
(1) 2171/ 60017E8 :                     ; 		mov	#240,r3
(1) 2172/ 60017E8 :                     ; 		mov	#MarsVideo_MakeNametbl,r0
(1) 2173/ 60017E8 :                     ; 		jsr	@r0
(1) 2174/ 60017E8 :                     ; 		mov	#0,r4
(1) 2175/ 60017E8 :                     ; 		mov	#_vdpreg,r1			; Framebuffer swap REQUEST
(1) 2176/ 60017E8 :                     ; 		mov.b	@(framectl,r1),r0
(1) 2177/ 60017E8 :                     ; 		xor	#1,r0
(1) 2178/ 60017E8 :                     ; 		mov.b	r0,@(framectl,r1)
(1) 2179/ 60017E8 :                     ; 		bra	mstr_ready
(1) 2180/ 60017E8 :                     ; 		nop
(1) 2181/ 60017E8 :                     ; 		align 4
(1) 2182/ 60017E8 :                     ; 		ltorg
(1) 2183/ 60017E8 :                     ; 		align 4
(1) 2184/ 60017E8 :                     
(1) 2185/ 60017E8 :                     ; ============================================================
(1) 2186/ 60017E8 :                     
(1) 2187/ 60017E8 :                     ; 	; ---------------------------------------
(1) 2188/ 60017E8 :                     ; 	; Prepare WATCHDOG interrupt
(1) 2189/ 60017E8 :                     ; 		mov.w   @(marsGbl_PolyBuffNum,gbr),r0
(1) 2190/ 60017E8 :                     ; 		tst     #1,r0
(1) 2191/ 60017E8 :                     ; 		bf	.page_2
(1) 2192/ 60017E8 :                     ; 		mov	#RAM_Mars_PlgnList_0,r0
(1) 2193/ 60017E8 :                     ; 		mov	#RAM_Mars_PlgnNum_0,r1
(1) 2194/ 60017E8 :                     ; 		bra	.cont_plgn
(1) 2195/ 60017E8 :                     ; 		nop
(1) 2196/ 60017E8 :                     ; .page_2:
(1) 2197/ 60017E8 :                     ; 		mov	#RAM_Mars_PlgnList_1,r0
(1) 2198/ 60017E8 :                     ; 		mov	#RAM_Mars_PlgnNum_1,r1
(1) 2199/ 60017E8 :                     ; 		nop
(1) 2200/ 60017E8 :                     ; .cont_plgn:
(1) 2201/ 60017E8 :                     ; 		mov	r0,@(marsGbl_CurrRdPlgn,gbr)
(1) 2202/ 60017E8 :                     ; 		mov	@r1,r0
(1) 2203/ 60017E8 :                     ; 		mov.w	r0,@(marsGbl_CntrRdPlgn,gbr)
(1) 2204/ 60017E8 :                     ;
(1) 2205/ 60017E8 :                     ; 		mov	#RAM_Mars_SVdpDrwList,r0		; Reset DDA pieces Read/Write points
(1) 2206/ 60017E8 :                     ; 		mov	r0,@(marsGbl_PlyPzList_R,gbr)		; And counter
(1) 2207/ 60017E8 :                     ; 		mov	r0,@(marsGbl_PlyPzList_W,gbr)
(1) 2208/ 60017E8 :                     ; 		mov	r0,@(marsGbl_PlyPzList_Start,gbr)
(1) 2209/ 60017E8 :                     ; 		mov	#RAM_Mars_SVdpDrwList_E,r0
(1) 2210/ 60017E8 :                     ; 		mov	r0,@(marsGbl_PlyPzList_End,gbr)
(1) 2211/ 60017E8 :                     ; 		mov	#0,r1
(1) 2212/ 60017E8 :                     ; 		mov	#$20,r2
(1) 2213/ 60017E8 :                     ; 		mov	#Mars_SetWatchdog,r0
(1) 2214/ 60017E8 :                     ; 		jsr	@r0
(1) 2215/ 60017E8 :                     ; 		nop
(1) 2216/ 60017E8 :                     ;
(1) 2217/ 60017E8 :                     ; 	; ---------------------------------------
(1) 2218/ 60017E8 :                     ; 	; Clear screen
(1) 2219/ 60017E8 :                     ; 	; ---------------------------------------
(1) 2220/ 60017E8 :                     ; 		mov.w	@(marsGbl_MdDrawTmr,gbr),r0
(1) 2221/ 60017E8 :                     ; 		tst	r0,r0
(1) 2222/ 60017E8 :                     ; 		bf	.no_redraw_2
(1) 2223/ 60017E8 :                     ; 		mov	#$200,r1		; *** This also counts as a delay for Watchdog ***
(1) 2224/ 60017E8 :                     ; 		mov	#(320+16)/2,r2
(1) 2225/ 60017E8 :                     ; 		mov	#240,r3
(1) 2226/ 60017E8 :                     ; 		mov	#0,r4
(1) 2227/ 60017E8 :                     ; 		mov	#MarsVideo_ClearScreen,r0
(1) 2228/ 60017E8 :                     ; 		jsr	@r0
(1) 2229/ 60017E8 :                     ; 		nop
(1) 2230/ 60017E8 :                     ; .no_redraw_2:
(1) 2231/ 60017E8 :                     ; 		mov	#$200,r1
(1) 2232/ 60017E8 :                     ; 		mov	#512,r2			; <-- fixed WIDTH
(1) 2233/ 60017E8 :                     ; 		mov	#240,r3
(1) 2234/ 60017E8 :                     ; 		mov	#MarsVideo_MakeNametbl,r0
(1) 2235/ 60017E8 :                     ; 		jsr	@r0
(1) 2236/ 60017E8 :                     ; 		mov	#0,r4
(1) 2237/ 60017E8 :                     ;
(1) 2238/ 60017E8 :                     ; 	; ---------------------------------------
(1) 2239/ 60017E8 :                     ;
(1) 2240/ 60017E8 :                     ; .wait_wd:	mov.w	@(marsGbl_WdgStatus,gbr),r0
(1) 2241/ 60017E8 :                     ; 		tst	r0,r0
(1) 2242/ 60017E8 :                     ; 		bt	.wait_wd
(1) 2243/ 60017E8 :                     ; 		mov	#MarsVideo_DrawPzPlgns,r0
(1) 2244/ 60017E8 :                     ; 		jsr	@r0
(1) 2245/ 60017E8 :                     ; 		nop
(1) 2246/ 60017E8 :                     ; .no_swap:
(1) 2247/ 60017E8 :                     ; 		mov	#_sysreg+comm14,r1	; Wait Slave CPU
(1) 2248/ 60017E8 :                     ; .wait:		mov.w	@r1,r0
(1) 2249/ 60017E8 :                     ; 		and	#$FF,r0
(1) 2250/ 60017E8 :                     ; 		tst	r0,r0
(1) 2251/ 60017E8 :                     ; 		bf	.wait
(1) 2252/ 60017E8 :                     ; 		mov	#_vdpreg,r1		; Framebuffer swap REQUEST
(1) 2253/ 60017E8 :                     ; 		mov.b	@(framectl,r1),r0
(1) 2254/ 60017E8 :                     ; 		xor	#1,r0
(1) 2255/ 60017E8 :                     ; 		mov.b	r0,@(framectl,r1)
(1) 2256/ 60017E8 :                     
(1) 2257/ 60017E8 :                     ; 		bra	mstr_ready
(1) 2258/ 60017E8 :                     ; 		nop
(1) 2259/ 60017E8 :                     ; 		align 4
(1) 2260/ 60017E8 :                     ; 		ltorg
(1) 2261/ 60017E8 :                     
(1) 2262/ 60017E8 :                     ; ====================================================================
(1) 2263/ 60017E8 :                     ; ----------------------------------------------------------------
(1) 2264/ 60017E8 :                     ; Slave entry
(1) 2265/ 60017E8 :                     ; ----------------------------------------------------------------
(1) 2266/ 60017E8 :                     
(1) 2267/ 60017E8 :                     		align 4
(1) 2268/ 60017E8 :                     SH2_S_Entry:
(1) 2269/ 60017E8 : DF27                		mov	#STACK_SLV,r15		; Reset stack
(1) 2270/ 60017EA : D028                		mov	#SH2_Slave,r0		; Reset vbr
(1) 2271/ 60017EC : 402E                		ldc	r0,vbr
(1) 2272/ 60017EE : 915B                		mov.l	#_FRT,r1		; Free-run timer settings
(1) 2273/ 60017F0 : E000                		mov	#0,r0			; ** REQUIRED FOR REAL HARDWARE **
(1) 2274/ 60017F2 : 8010                		mov.b	r0,@(0,r1)
(1) 2275/ 60017F4 : E0E2                		mov.b	#$E2,r0
(1) 2276/ 60017F6 : 8017                		mov.b	r0,@(7,r1)
(1) 2277/ 60017F8 : E000                		mov	#0,r0
(1) 2278/ 60017FA : 8014                		mov.b	r0,@(4,r1)
(1) 2279/ 60017FC : E001                		mov	#1,r0
(1) 2280/ 60017FE : 8015                		mov.b	r0,@(5,r1)
(1) 2281/ 6001800 : E000                		mov	#0,r0
(1) 2282/ 6001802 : 8016                		mov.b	r0,@(6,r1)
(1) 2283/ 6001804 : E001                		mov	#1,r0
(1) 2284/ 6001806 : 8011                		mov.b	r0,@(1,r1)
(1) 2285/ 6001808 : E000                		mov	#0,r0
(1) 2286/ 600180A : 8013                		mov.b	r0,@(3,r1)
(1) 2287/ 600180C : 8012                		mov.b	r0,@(2,r1)
(1) 2288/ 600180E : E0F2                		mov.b	#$F2,r0			; <-- PWM interrupt needs this
(1) 2289/ 6001810 : 8017                		mov.b	r0,@(7,r1)
(1) 2290/ 6001812 : E000                		mov	#0,r0
(1) 2291/ 6001814 : 8014                		mov.b	r0,@(4,r1)
(1) 2292/ 6001816 : E001                		mov	#1,r0
(1) 2293/ 6001818 : 8015                		mov.b	r0,@(5,r1)
(1) 2294/ 600181A : E0E2                		mov.b	#$E2,r0
(1) 2295/ 600181C : 8017                		mov.b	r0,@(7,r1)		; <-- ***
(1) 2296/ 600181E :                     
(1) 2297/ 600181E :                     	; Extra interrupt settings
(1) 2298/ 600181E : 9044                		mov.w   #$FEE2,r0		; Extra interrupt priority levels ($FFFFFEE2)
(1) 2299/ 6001820 : 9144                		mov     #(3<<4)|(5<<8),r1	; (DMA_LVL<<8)|(WDG_LVL<<4) Current: WDG 3 DMA 5
(1) 2300/ 6001822 : 2011                		mov.w   r1,@r0
(1) 2301/ 6001824 : 9043                		mov.w   #$FEE4,r0		; Vector jump number for Watchdog ($FFFFFEE4)
(1) 2302/ 6001826 : 9143                		mov     #($120/4)<<8,r1		; (vbr+POINTER)<<8
(1) 2303/ 6001828 : 2011                		mov.w   r1,@r0
(1) 2304/ 600182A : E0A0                		mov.b	#$A0,r0			; Vector jump number for DMACHANNEL0 ($FFFFFFA0)
(1) 2305/ 600182C : E149                		mov     #($124/4),r1		; (vbr+POINTER)
(1) 2306/ 600182E : 2012                		mov	r1,@r0
(1) 2307/ 6001830 :                     
(1) 2308/ 6001830 : D017                		mov	#RAM_Mars_Global,r0	; Reset gbr
(1) 2309/ 6001832 : 401E                		ldc	r0,gbr
(1) 2310/ 6001834 : BC98                		bsr	MarsSound_Init		; Init sound
(1) 2311/ 6001836 : 0009                		nop
(1) 2312/ 6001838 :                     
(1) 2313/ 6001838 :                     ; ====================================================================
(1) 2314/ 6001838 :                     ; ----------------------------------------------------------------
(1) 2315/ 6001838 :                     ; Slave main code
(1) 2316/ 6001838 :                     ; ----------------------------------------------------------------
(1) 2317/ 6001838 :                     
(1) 2318/ 6001838 :                     SH2_S_HotStart:
(1) 2319/ 6001838 : 913B                		mov	#$FFFFFE80,r1
(1) 2320/ 600183A : 903B                		mov.w	#$A518,r0		; Disable Watchdog
(1) 2321/ 600183C : 2101                		mov.w	r0,@r1
(1) 2322/ 600183E : 913A                		mov	#_CCR,r1		; Reset CACHE
(1) 2323/ 6001840 : E010                		mov	#$10,r0
(1) 2324/ 6001842 : 2100                		mov.b	r0,@r1
(1) 2325/ 6001844 : 0009                		nop
(1) 2326/ 6001846 : 0009                		nop
(1) 2327/ 6001848 : 0009                		nop
(1) 2328/ 600184A : 0009                		nop
(1) 2329/ 600184C : 0009                		nop
(1) 2330/ 600184E : 0009                		nop
(1) 2331/ 6001850 : 0009                		nop
(1) 2332/ 6001852 : E009                		mov	#9,r0
(1) 2333/ 6001854 : 2100                		mov.b	r0,@r1
(1) 2334/ 6001856 : D10F                		mov	#CACHE_SLAVE,r1
(1) 2335/ 6001858 : 922E                		mov	#(CACHE_SLAVE_E-CACHE_SLAVE)/4,r2
(1) 2336/ 600185A : D00F                		mov	#Mars_LoadCacheRam,r0
(1) 2337/ 600185C : 400B                		jsr	@r0
(1) 2338/ 600185E : 0009                		nop
(1) 2339/ 6001860 : D10E                		mov	#_sysreg,r1
(1) 2340/ 6001862 : 200A                    		xor	r0,r0
(1) 2341/ 6001864 : 811A                		mov.w	r0,@(vresintclr,r1)
(1) 2342/ 6001866 : 811B                		mov.w	r0,@(vintclr,r1)
(1) 2343/ 6001868 : 811C                		mov.w	r0,@(hintclr,r1)
(1) 2344/ 600186A : 811D                		mov.w	r0,@(cmdintclr,r1)
(1) 2345/ 600186C : 811E                		mov.w	r0,@(pwmintclr,r1)
(1) 2346/ 600186E : 6011                		mov.w	@r1,r0
(1) 2347/ 6001870 : CB03                		or	#CMDIRQ_ON|PWMIRQ_ON,r0
(1) 2348/ 6001872 :                     ; 		or	#CMDIRQ_ON,r0
(1) 2349/ 6001872 : 2101                		mov.w	r0,@r1
(1) 2350/ 6001874 :                     
(1) 2351/ 6001874 : D10A                		mov	#_sysreg+comm12,r1
(1) 2352/ 6001876 : 6011                .wait_mst:	mov.w	@r1,r0
(1) 2353/ 6001878 : 2008                		tst	r0,r0
(1) 2354/ 600187A : 8BFC                		bf	.wait_mst
(1) 2355/ 600187C : E020                		mov	#$20,r0				; Interrupts ON
(1) 2356/ 600187E : 400E                		ldc	r0,sr
(1) 2357/ 6001880 : D008                		mov	#slave_loop,r0
(1) 2358/ 6001882 : 402B                		jmp	@r0
(1) 2359/ 6001884 : 0009                		nop
(1) 2360/ 6001886 :                     		align 4
(1) 2361/ 6001888 : 0603 F000 0600 0128 		ltorg
                    2600 7540 0600 257C 
                    0600 07E0 2000 4000 
                    2000 402C 0600 18BC 
                    FE10 FEE2 0530 FEE4 
                    4800 FE80 A518 FE92 
                    00C4                
(1) 2362/ 60018BA :                     
(1) 2363/ 60018BA :                     ; ----------------------------------------------------------------
(1) 2364/ 60018BA :                     ; SLAVE CPU loop
(1) 2365/ 60018BA :                     ;
(1) 2366/ 60018BA :                     ; comm14:
(1) 2367/ 60018BA :                     ; bssscccc llllllll
(1) 2368/ 60018BA :                     ;
(1) 2369/ 60018BA :                     ; b - busy bit on the CMD interrupt
(1) 2370/ 60018BA :                     ;     (so 68k knows that the interrupt is active)
(1) 2371/ 60018BA :                     ; s - status bits for some CMD interrupt tasks
(1) 2372/ 60018BA :                     ; c - command number for CMD interrupt
(1) 2373/ 60018BA :                     ; l - MAIN LOOP command/task, clears on finish
(1) 2374/ 60018BA :                     ; ----------------------------------------------------------------
(1) 2375/ 60018BA :                     
(1) 2376/ 60018BA :                     		align 4
(1) 2377/ 60018BC :                     slave_loop:
(1) 2379/ 60018BC : D112                		mov	#_sysreg+comm1,r1	; DEBUG counter
(1) 2380/ 60018BE : 6010                		mov.b	@r1,r0
(1) 2381/ 60018C0 : 7001                		add	#1,r0
(1) 2382/ 60018C2 : 2100                		mov.b	r0,@r1
(1) 2384/ 60018C4 : D311                		mov	#.list,r3		; Default LOOP points
(1) 2385/ 60018C6 : D212                		mov	#_sysreg+comm14,r2
(1) 2386/ 60018C8 : 6021                		mov.w	@r2,r0			; r0 - INIT bit
(1) 2387/ 60018CA : C90F                		and	#%00001111,r0
(1) 2388/ 60018CC : 4008                		shll2	r0
(1) 2389/ 60018CE : 043E                		mov	@(r3,r0),r4
(1) 2390/ 60018D0 : 442B                		jmp	@r4
(1) 2391/ 60018D2 : 0009                		nop
(1) 2392/ 60018D4 :                     		align 4
(1) 2393/ 60018D4 :                     .list:
(1) 2394/ 60018D4 : 0600 18BC           		dc.l slave_loop		; $00
(1) 2395/ 60018D8 : 0600 18E4           		dc.l slv_task_1		; $01 - Build 3D models for the next frame
(1) 2396/ 60018DC : 0600 18F0           		dc.l slv_task_2		; $02
(1) 2397/ 60018E0 : 0600 18BC           		dc.l slave_loop		; $03
(1) 2398/ 60018E4 :                     
(1) 2399/ 60018E4 :                     ; ============================================================
(1) 2400/ 60018E4 :                     ; ---------------------------------------
(1) 2401/ 60018E4 :                     ; Slave task $01
(1) 2402/ 60018E4 :                     ; ---------------------------------------
(1) 2403/ 60018E4 :                     
(1) 2404/ 60018E4 :                     		align 4
(1) 2405/ 60018E4 :                     slv_task_1:
(1) 2406/ 60018E4 : DE0B                		mov	#RAM_Mars_DreqRead+Dreq_BgExBuff,r14	; Draw L/R here, Slave does U/D
(1) 2407/ 60018E6 : DD0C                		mov	#RAM_Mars_ScrlBuff,r13
(1) 2408/ 60018E8 : B956                		bsr	MarsVideo_Bg_DrawScrl
(1) 2409/ 60018EA : 0009                		nop
(1) 2410/ 60018EC :                     
(1) 2411/ 60018EC : A006                		bra	slv_exit
(1) 2412/ 60018EE : 0009                		nop
(1) 2413/ 60018F0 :                     		align 4
(1) 2414/ 60018F0 :                     
(1) 2415/ 60018F0 :                     ; ============================================================
(1) 2416/ 60018F0 :                     ; ---------------------------------------
(1) 2417/ 60018F0 :                     ; Slave task $02
(1) 2418/ 60018F0 :                     ; ---------------------------------------
(1) 2419/ 60018F0 :                     
(1) 2420/ 60018F0 :                     		align 4
(1) 2421/ 60018F0 :                     slv_task_2:
(1) 2422/ 60018F0 : D00A                		mov	#MarsMdl_MdlLoop,r0
(1) 2423/ 60018F2 : 400B                		jsr	@r0
(1) 2424/ 60018F4 : 0009                		nop
(1) 2425/ 60018F6 :                     
(1) 2426/ 60018F6 : A001                		bra	slv_exit
(1) 2427/ 60018F8 : 0009                		nop
(1) 2428/ 60018FA :                     		align 4
(1) 2429/ 60018FC :                     
(1) 2430/ 60018FC :                     ; ============================================================
(1) 2431/ 60018FC :                     
(1) 2432/ 60018FC :                     ; JMP only
(1) 2433/ 60018FC :                     slv_exit:
(1) 2434/ 60018FC : D408                		mov	#_sysreg+comm14+1,r4	; Finish task
(1) 2435/ 60018FE : 200A                		xor	r0,r0
(1) 2436/ 6001900 : 2400                		mov.b	r0,@r4
(1) 2437/ 6001902 : AFDB                		bra	slave_loop
(1) 2438/ 6001904 : 0009                		nop
(1) 2439/ 6001906 :                     		align 4
(1) 2440/ 6001908 : 2000 4021 0600 18D4 		ltorg
                    2000 402E 2600 70E8 
                    2600 7990 0600 0E0C 
                    2000 402F           
(1) 2441/ 6001924 :                     
(1) 2442/ 6001924 :                     ; ------------------------------------------------
(1) 2443/ 6001924 :                     ; Includes
(1) 2444/ 6001924 :                     ; ------------------------------------------------
(1) 2445/ 6001924 :                     
(1) 2446/ 6001924 :                     		include "system/mars/cache/cache_m_2D.asm"
(2)    1/ 6001924 :                     ; ====================================================================
(2)    2/ 6001924 :                     ; ----------------------------------------------------------------
(2)    3/ 6001924 :                     ; CACHE code
(2)    4/ 6001924 :                     ;
(2)    5/ 6001924 :                     ; LIMIT: $800 bytes
(2)    6/ 6001924 :                     ; ----------------------------------------------------------------
(2)    7/ 6001924 :                     
(2)    8/ 6001924 :                     		align 4
(2)    9/ 6001924 :                     CACHE_MSTR_SCRL:
(2)   10/FFFFFFFFC0000000 :                     		phase $C0000000
(2)   11/FFFFFFFFC0000000 :                     
(2)   12/FFFFFFFFC0000000 :                     ; ====================================================================
(2)   13/FFFFFFFFC0000000 :                     ; --------------------------------------------------------
(2)   14/FFFFFFFFC0000000 :                     ; Watchdog interrupt
(2)   15/FFFFFFFFC0000000 :                     ; --------------------------------------------------------
(2)   16/FFFFFFFFC0000000 :                     
(2)   17/FFFFFFFFC0000000 : 9104                		mov	#_FRT,r1
(2)   18/FFFFFFFFC0000002 : 8417                		mov.b	@(7,r1),r0
(2)   19/FFFFFFFFC0000004 : CA02                		xor	#2,r0
(2)   20/FFFFFFFFC0000006 : 8017                		mov.b	r0,@(7,r1)
(2)   21/FFFFFFFFC0000008 :                     
(2)   22/FFFFFFFFC0000008 :                     ; 		mov	#(Cach_WdgBuffWr+$20)-4,r1
(2)   23/FFFFFFFFC0000008 :                     ; 		mov	@r1,r0				; Check U/D first
(2)   24/FFFFFFFFC0000008 :                     ; 		tst	r0,r0
(2)   25/FFFFFFFFC0000008 :                     ; 		bf	.g_draw_ud
(2)   26/FFFFFFFFC0000008 :                     ; 		mov	#$20,r0				; <-- next timer
(2)   27/FFFFFFFFC0000008 :                     ; 		sub	r0,r1
(2)   28/FFFFFFFFC0000008 :                     ; 		mov	@r1,r0				; Check R/L
(2)   29/FFFFFFFFC0000008 :                     ; 		tst	r0,r0
(2)   30/FFFFFFFFC0000008 :                     ; 		bf	.g_draw_lr
(2)   31/FFFFFFFFC0000008 :                     ; .finish:
(2)   32/FFFFFFFFC0000008 :                     ; 		mov	#0,r0
(2)   33/FFFFFFFFC0000008 :                     ; 		mov.w	r0,@(marsGbl_WdgMode,gbr)
(2)   34/FFFFFFFFC0000008 :                     ; 		mov	#$FFFFFE80,r1			; Stop watchdog
(2)   35/FFFFFFFFC0000008 :                     ; 		mov.w   #$A518,r0
(2)   36/FFFFFFFFC0000008 :                     ; 		mov.w   r0,@r1
(2)   37/FFFFFFFFC0000008 :                     ; 		rts
(2)   38/FFFFFFFFC0000008 :                     ; 		nop
(2)   39/FFFFFFFFC0000008 :                     ; 		align 4
(2)   40/FFFFFFFFC0000008 :                     ; .g_draw_ud:
(2)   41/FFFFFFFFC0000008 :                     ; 		bra	wdgbg_draw_ud
(2)   42/FFFFFFFFC0000008 :                     ; 		nop
(2)   43/FFFFFFFFC0000008 :                     ; .g_draw_lr:
(2)   44/FFFFFFFFC0000008 :                     ; 		bra	wdgbg_draw_lr
(2)   45/FFFFFFFFC0000008 :                     ; 		nop
(2)   46/FFFFFFFFC0000008 :                     ;
(2)   47/FFFFFFFFC0000008 :                     ; 		align 4
(2)   48/FFFFFFFFC0000008 :                     ; .tag_FRT:	dc.l _FRT
(2)   49/FFFFFFFFC0000008 :                     
(2)   50/FFFFFFFFC0000008 :                     ; ; ----------------------------------------
(2)   51/FFFFFFFFC0000008 :                     ; ; Block refill
(2)   52/FFFFFFFFC0000008 :                     ; ; ----------------------------------------
(2)   53/FFFFFFFFC0000008 :                     ;
(2)   54/FFFFFFFFC0000008 :                     ; .draw_refill:
(2)   55/FFFFFFFFC0000008 :                     ; 		dt	r0
(2)   56/FFFFFFFFC0000008 :                     ; 		mov	r0,@r1
(2)   57/FFFFFFFFC0000008 :                     ; 		mov	#Cach_WdBackup_S,r0
(2)   58/FFFFFFFFC0000008 :                     ; 		mov	r2,@-r0
(2)   59/FFFFFFFFC0000008 :                     ; 		mov	r3,@-r0
(2)   60/FFFFFFFFC0000008 :                     ; 		mov	r4,@-r0
(2)   61/FFFFFFFFC0000008 :                     ; 		mov	r5,@-r0
(2)   62/FFFFFFFFC0000008 :                     ; 		mov	r6,@-r0
(2)   63/FFFFFFFFC0000008 :                     ; 		mov	r7,@-r0
(2)   64/FFFFFFFFC0000008 :                     ; 		mov	r8,@-r0
(2)   65/FFFFFFFFC0000008 :                     ; 		mov	r9,@-r0
(2)   66/FFFFFFFFC0000008 :                     ; 		mov	r10,@-r0
(2)   67/FFFFFFFFC0000008 :                     ; 		mov	r11,@-r0
(2)   68/FFFFFFFFC0000008 :                     ; 		mov	r12,@-r0
(2)   69/FFFFFFFFC0000008 :                     ; 		mov	r13,@-r0
(2)   70/FFFFFFFFC0000008 :                     ; 		mov	r14,@-r0
(2)   71/FFFFFFFFC0000008 :                     ; 		sts	macl,@-r0
(2)   72/FFFFFFFFC0000008 :                     ;
(2)   73/FFFFFFFFC0000008 :                     ; 		mov	#Cach_BlkRefill+4,r0
(2)   74/FFFFFFFFC0000008 :                     ; 		mov	@r0+,r12
(2)   75/FFFFFFFFC0000008 :                     ; 		mov	@r0+,r11
(2)   76/FFFFFFFFC0000008 :                     ; 		mov	@r0+,r10
(2)   77/FFFFFFFFC0000008 :                     ; 		mov	@r0+,r9
(2)   78/FFFFFFFFC0000008 :                     ; 		mov	@r0+,r8
(2)   79/FFFFFFFFC0000008 :                     ; 		mov	@r0+,r7
(2)   80/FFFFFFFFC0000008 :                     ; 		mov	@r0+,r6
(2)   81/FFFFFFFFC0000008 :                     ; 		mov	@r0+,r5
(2)   82/FFFFFFFFC0000008 :                     ; 		mov	@r0+,r13
(2)   83/FFFFFFFFC0000008 :                     ;
(2)   84/FFFFFFFFC0000008 :                     ; 		mov.w	@r12,r0
(2)   85/FFFFFFFFC0000008 :                     ; 		tst	r0,r0
(2)   86/FFFFFFFFC0000008 :                     ; 		bf	.get_in
(2)   87/FFFFFFFFC0000008 :                     ; 		mov	#Cach_BlkRefill,r1
(2)   88/FFFFFFFFC0000008 :                     ; 		xor	r0,r0
(2)   89/FFFFFFFFC0000008 :                     ; 		mov	r0,@r1
(2)   90/FFFFFFFFC0000008 :                     ; 		bra	.get_out
(2)   91/FFFFFFFFC0000008 :                     ; 		nop
(2)   92/FFFFFFFFC0000008 :                     ; .get_in:
(2)   93/FFFFFFFFC0000008 :                     ; 		extu.w	r0,r0
(2)   94/FFFFFFFFC0000008 :                     ; 		mov	r0,r1
(2)   95/FFFFFFFFC0000008 :                     ; 		mov	r0,r2
(2)   96/FFFFFFFFC0000008 :                     ; 		shlr8	r2
(2)   97/FFFFFFFFC0000008 :                     ; 		mov	#$7F,r0
(2)   98/FFFFFFFFC0000008 :                     ; 		and	r0,r2
(2)   99/FFFFFFFFC0000008 :                     ; 		mov	#$FF,r0
(2)  100/FFFFFFFFC0000008 :                     ; 		and	r0,r1
(2)  101/FFFFFFFFC0000008 :                     ;
(2)  102/FFFFFFFFC0000008 :                     ; 		xor	r0,r0
(2)  103/FFFFFFFFC0000008 :                     ; 		mov	r0,@r12
(2)  104/FFFFFFFFC0000008 :                     ; 		add	#4,r12
(2)  105/FFFFFFFFC0000008 :                     ; 		mov	#Cach_BlkRefill+4,r0
(2)  106/FFFFFFFFC0000008 :                     ; 		mov	r12,@r0
(2)  107/FFFFFFFFC0000008 :                     ;
(2)  108/FFFFFFFFC0000008 :                     ; 	;  r13 - _framebuffer area
(2)  109/FFFFFFFFC0000008 :                     ; 	;  r12 - Refill buffer
(2)  110/FFFFFFFFC0000008 :                     ; 	;  r11 - Scroll current top-left
(2)  111/FFFFFFFFC0000008 :                     ; 	;  r10 - FULL Scroll area size
(2)  112/FFFFFFFFC0000008 :                     ; 	;   r9 - Scroll Width
(2)  113/FFFFFFFFC0000008 :                     ; 	;   r8 - Block graphics
(2)  114/FFFFFFFFC0000008 :                     ; 	;   r7 - Layout data
(2)  115/FFFFFFFFC0000008 :                     ; 	;   r6 - Layout width
(2)  116/FFFFFFFFC0000008 :                     ; 	;   r5 - Block size
(2)  117/FFFFFFFFC0000008 :                     ;
(2)  118/FFFFFFFFC0000008 :                     ; 		mulu	r6,r2
(2)  119/FFFFFFFFC0000008 :                     ; 		sts	macl,r0
(2)  120/FFFFFFFFC0000008 :                     ; 		add	r1,r0
(2)  121/FFFFFFFFC0000008 :                     ; 		add	r0,r7
(2)  122/FFFFFFFFC0000008 :                     ; 		mov.b	@r7,r0
(2)  123/FFFFFFFFC0000008 :                     ; 		extu.b	r0,r0
(2)  124/FFFFFFFFC0000008 :                     ; 		mov	#16*16,r12
(2)  125/FFFFFFFFC0000008 :                     ; 		mulu	r12,r0
(2)  126/FFFFFFFFC0000008 :                     ; 		sts	macl,r0
(2)  127/FFFFFFFFC0000008 :                     ; 		add	r0,r8
(2)  128/FFFFFFFFC0000008 :                     ;
(2)  129/FFFFFFFFC0000008 :                     ; 		mulu	r5,r1
(2)  130/FFFFFFFFC0000008 :                     ; 		sts	macl,r1
(2)  131/FFFFFFFFC0000008 :                     ; 		mulu	r5,r2
(2)  132/FFFFFFFFC0000008 :                     ; 		sts	macl,r2
(2)  133/FFFFFFFFC0000008 :                     ; 		mulu	r9,r2
(2)  134/FFFFFFFFC0000008 :                     ; 		sts	macl,r12
(2)  135/FFFFFFFFC0000008 :                     ; 		add	r1,r12
(2)  136/FFFFFFFFC0000008 :                     ; 		add	r11,r12
(2)  137/FFFFFFFFC0000008 :                     ; 		mov	#320,r6
(2)  138/FFFFFFFFC0000008 :                     ; 		mov	r5,r3
(2)  139/FFFFFFFFC0000008 :                     ; .y_lne:
(2)  140/FFFFFFFFC0000008 :                     ; 		cmp/ge	r10,r12
(2)  141/FFFFFFFFC0000008 :                     ; 		bf	.ln_ret
(2)  142/FFFFFFFFC0000008 :                     ; 		sub	r10,r12
(2)  143/FFFFFFFFC0000008 :                     ; .ln_ret:
(2)  144/FFFFFFFFC0000008 :                     ; 		mov	r12,r11
(2)  145/FFFFFFFFC0000008 :                     ; 		mov	r5,r4
(2)  146/FFFFFFFFC0000008 :                     ; 		shlr2	r4
(2)  147/FFFFFFFFC0000008 :                     ; .x_lne:
(2)  148/FFFFFFFFC0000008 :                     ; 		mov	@r8+,r0
(2)  149/FFFFFFFFC0000008 :                     ; ; 		or	r7,r0
(2)  150/FFFFFFFFC0000008 :                     ; ; 		mov	#-1,r0
(2)  151/FFFFFFFFC0000008 :                     ; 		mov	r13,r7
(2)  152/FFFFFFFFC0000008 :                     ; 		add	r11,r7
(2)  153/FFFFFFFFC0000008 :                     ; 		mov	r0,@r7
(2)  154/FFFFFFFFC0000008 :                     ; 		cmp/ge	r6,r11
(2)  155/FFFFFFFFC0000008 :                     ; 		bt	.x_ex
(2)  156/FFFFFFFFC0000008 :                     ; 		mov	r13,r7
(2)  157/FFFFFFFFC0000008 :                     ; 		add	r11,r7
(2)  158/FFFFFFFFC0000008 :                     ; 		add	r10,r7
(2)  159/FFFFFFFFC0000008 :                     ; 		mov	r0,@r7
(2)  160/FFFFFFFFC0000008 :                     ; .x_ex:
(2)  161/FFFFFFFFC0000008 :                     ; 		dt	r4
(2)  162/FFFFFFFFC0000008 :                     ; 		bf/s	.x_lne
(2)  163/FFFFFFFFC0000008 :                     ; 		add	#4,r11
(2)  164/FFFFFFFFC0000008 :                     ; 		dt	r3
(2)  165/FFFFFFFFC0000008 :                     ; 		bf/s	.y_lne
(2)  166/FFFFFFFFC0000008 :                     ; 		add	r9,r12
(2)  167/FFFFFFFFC0000008 :                     ;
(2)  168/FFFFFFFFC0000008 :                     ;
(2)  169/FFFFFFFFC0000008 :                     ; .get_out:
(2)  170/FFFFFFFFC0000008 :                     ; 		mov	#Cach_WdBackup_L,r0
(2)  171/FFFFFFFFC0000008 :                     ; 		lds	@r0+,macl
(2)  172/FFFFFFFFC0000008 :                     ; 		mov	@r0+,r14
(2)  173/FFFFFFFFC0000008 :                     ; 		mov	@r0+,r13
(2)  174/FFFFFFFFC0000008 :                     ; 		mov	@r0+,r12
(2)  175/FFFFFFFFC0000008 :                     ; 		mov	@r0+,r11
(2)  176/FFFFFFFFC0000008 :                     ; 		mov	@r0+,r10
(2)  177/FFFFFFFFC0000008 :                     ; 		mov	@r0+,r9
(2)  178/FFFFFFFFC0000008 :                     ; 		mov	@r0+,r8
(2)  179/FFFFFFFFC0000008 :                     ; 		mov	@r0+,r7
(2)  180/FFFFFFFFC0000008 :                     ; 		mov	@r0+,r6
(2)  181/FFFFFFFFC0000008 :                     ; 		mov	@r0+,r5
(2)  182/FFFFFFFFC0000008 :                     ; 		mov	@r0+,r4
(2)  183/FFFFFFFFC0000008 :                     ; 		mov	@r0+,r3
(2)  184/FFFFFFFFC0000008 :                     ; 		mov	@r0+,r2
(2)  185/FFFFFFFFC0000008 :                     ; 		bra	wdgbg_nextwd
(2)  186/FFFFFFFFC0000008 :                     ; 		nop
(2)  187/FFFFFFFFC0000008 :                     ; 		align 4
(2)  188/FFFFFFFFC0000008 :                     ; 		ltorg
(2)  189/FFFFFFFFC0000008 :                     
(2)  190/FFFFFFFFC0000008 :                     ; ; ----------------------------------------
(2)  191/FFFFFFFFC0000008 :                     ; ; Draw timer L/R
(2)  192/FFFFFFFFC0000008 :                     ; ; ----------------------------------------
(2)  193/FFFFFFFFC0000008 :                     ;
(2)  194/FFFFFFFFC0000008 :                     ; wdgbg_draw_lr:
(2)  195/FFFFFFFFC0000008 :                     ; 		dt	r0
(2)  196/FFFFFFFFC0000008 :                     ; 		mov	r0,@r1
(2)  197/FFFFFFFFC0000008 :                     ; 		mov	#Cach_WdBackup_S,r0
(2)  198/FFFFFFFFC0000008 :                     ; 		mov	r2,@-r0
(2)  199/FFFFFFFFC0000008 :                     ; 		mov	r3,@-r0
(2)  200/FFFFFFFFC0000008 :                     ; 		mov	r4,@-r0
(2)  201/FFFFFFFFC0000008 :                     ; 		mov	r5,@-r0
(2)  202/FFFFFFFFC0000008 :                     ; 		mov	r6,@-r0
(2)  203/FFFFFFFFC0000008 :                     ; 		mov	r7,@-r0
(2)  204/FFFFFFFFC0000008 :                     ; 		mov	r8,@-r0
(2)  205/FFFFFFFFC0000008 :                     ; 		mov	r9,@-r0
(2)  206/FFFFFFFFC0000008 :                     ; 		mov	r10,@-r0
(2)  207/FFFFFFFFC0000008 :                     ; 		mov	r11,@-r0
(2)  208/FFFFFFFFC0000008 :                     ; 		mov	r12,@-r0
(2)  209/FFFFFFFFC0000008 :                     ; 		mov	r13,@-r0
(2)  210/FFFFFFFFC0000008 :                     ; 		mov	r14,@-r0
(2)  211/FFFFFFFFC0000008 :                     ; 		sts	macl,@-r0
(2)  212/FFFFFFFFC0000008 :                     ;
(2)  213/FFFFFFFFC0000008 :                     ; ; $00 - Layout data (read)
(2)  214/FFFFFFFFC0000008 :                     ; ; $04 - FB pos (read)
(2)  215/FFFFFFFFC0000008 :                     ; ; $08 - Layout width (next block)
(2)  216/FFFFFFFFC0000008 :                     ; ; $0C - FB width (next line)
(2)  217/FFFFFFFFC0000008 :                     ; ; $10 - FB FULL size
(2)  218/FFFFFFFFC0000008 :                     ; ; $14 - FB base
(2)  219/FFFFFFFFC0000008 :                     ; ; $18 - Block data
(2)  220/FFFFFFFFC0000008 :                     ; ; $1C - Block counter
(2)  221/FFFFFFFFC0000008 :                     ;
(2)  222/FFFFFFFFC0000008 :                     ; 		mov	#Cach_WdgBuffRd,r14
(2)  223/FFFFFFFFC0000008 :                     ; 		mov	@($14,r14),r13		; r13 - FB base
(2)  224/FFFFFFFFC0000008 :                     ; 		mov	@($10,r14),r12		; r12 - FB full size
(2)  225/FFFFFFFFC0000008 :                     ; 		mov	@($0C,r14),r11		; r11 - FB width
(2)  226/FFFFFFFFC0000008 :                     ; 		mov	@($04,r14),r10		; r10 - FB x/y pos
(2)  227/FFFFFFFFC0000008 :                     ; 		mov	@($18,r14),r9		; r9 - Block data
(2)  228/FFFFFFFFC0000008 :                     ; 		mov	@($08,r14),r7		; r7 - Layout increment
(2)  229/FFFFFFFFC0000008 :                     ; 		mov	@r14,r8			; r8 - Layout data
(2)  230/FFFFFFFFC0000008 :                     ; 		mov.b	@r8,r0
(2)  231/FFFFFFFFC0000008 :                     ; 		add	r7,r8
(2)  232/FFFFFFFFC0000008 :                     ; 		mov	r8,@r14
(2)  233/FFFFFFFFC0000008 :                     ; 		mov	#320,r8
(2)  234/FFFFFFFFC0000008 :                     ; 		extu.b	r0,r0
(2)  235/FFFFFFFFC0000008 :                     ; 		mov	#16*16,r1		; <-- Manual block size
(2)  236/FFFFFFFFC0000008 :                     ; 		mulu	r0,r1
(2)  237/FFFFFFFFC0000008 :                     ; 		sts	macl,r0
(2)  238/FFFFFFFFC0000008 :                     ; 		add	r0,r9
(2)  239/FFFFFFFFC0000008 :                     ; 		mov	#16,r7			; <-- Manual block size
(2)  240/FFFFFFFFC0000008 :                     ; 		mov	#_framebuffer,r1
(2)  241/FFFFFFFFC0000008 :                     ; 		mov	#RAM_Mars_ScrlData,r2
(2)  242/FFFFFFFFC0000008 :                     ; .y_loop:
(2)  243/FFFFFFFFC0000008 :                     ; 		cmp/ge	r12,r10
(2)  244/FFFFFFFFC0000008 :                     ; 		bf	.lne_sz
(2)  245/FFFFFFFFC0000008 :                     ; 		sub	r12,r10
(2)  246/FFFFFFFFC0000008 :                     ; .lne_sz:
(2)  247/FFFFFFFFC0000008 :                     ; 		mov	r10,r5
(2)  248/FFFFFFFFC0000008 :                     ; 		mov	#16,r6			; <-- Manual block size
(2)  249/FFFFFFFFC0000008 :                     ; 		shlr2	r6
(2)  250/FFFFFFFFC0000008 :                     ; .x_loop:
(2)  251/FFFFFFFFC0000008 :                     ; 		mov	@r9+,r0
(2)  252/FFFFFFFFC0000008 :                     ;
(2)  253/FFFFFFFFC0000008 :                     ; 		mov	r2,r4
(2)  254/FFFFFFFFC0000008 :                     ; 		add	r5,r4
(2)  255/FFFFFFFFC0000008 :                     ; 		mov	r13,r3
(2)  256/FFFFFFFFC0000008 :                     ; 		add	r1,r3
(2)  257/FFFFFFFFC0000008 :                     ; 		add	r5,r3
(2)  258/FFFFFFFFC0000008 :                     ;
(2)  259/FFFFFFFFC0000008 :                     ; 		mov	r0,@r3
(2)  260/FFFFFFFFC0000008 :                     ; 		mov	r0,@r4
(2)  261/FFFFFFFFC0000008 :                     ; 		cmp/ge	r8,r5
(2)  262/FFFFFFFFC0000008 :                     ; 		bt	.ex_line
(2)  263/FFFFFFFFC0000008 :                     ; 		add	r12,r3
(2)  264/FFFFFFFFC0000008 :                     ; 		add	r12,r4
(2)  265/FFFFFFFFC0000008 :                     ; 		mov	r0,@r3
(2)  266/FFFFFFFFC0000008 :                     ; 		mov	r0,@r4
(2)  267/FFFFFFFFC0000008 :                     ; .ex_line:
(2)  268/FFFFFFFFC0000008 :                     ; 		dt	r6
(2)  269/FFFFFFFFC0000008 :                     ; 		bf/s	.x_loop
(2)  270/FFFFFFFFC0000008 :                     ; 		add	#4,r5
(2)  271/FFFFFFFFC0000008 :                     ; 		dt	r7
(2)  272/FFFFFFFFC0000008 :                     ; 		bf/s	.y_loop
(2)  273/FFFFFFFFC0000008 :                     ; 		add	r11,r10
(2)  274/FFFFFFFFC0000008 :                     ;
(2)  275/FFFFFFFFC0000008 :                     ;
(2)  276/FFFFFFFFC0000008 :                     ; 		mov	r10,@($04,r14)	; Save FB pos
(2)  277/FFFFFFFFC0000008 :                     ;
(2)  278/FFFFFFFFC0000008 :                     ; 		mov	#Cach_WdBackup_L,r0
(2)  279/FFFFFFFFC0000008 :                     ; 		lds	@r0+,macl
(2)  280/FFFFFFFFC0000008 :                     ; 		mov	@r0+,r14
(2)  281/FFFFFFFFC0000008 :                     ; 		mov	@r0+,r13
(2)  282/FFFFFFFFC0000008 :                     ; 		mov	@r0+,r12
(2)  283/FFFFFFFFC0000008 :                     ; 		mov	@r0+,r11
(2)  284/FFFFFFFFC0000008 :                     ; 		mov	@r0+,r10
(2)  285/FFFFFFFFC0000008 :                     ; 		mov	@r0+,r9
(2)  286/FFFFFFFFC0000008 :                     ; 		mov	@r0+,r8
(2)  287/FFFFFFFFC0000008 :                     ; 		mov	@r0+,r7
(2)  288/FFFFFFFFC0000008 :                     ; 		mov	@r0+,r6
(2)  289/FFFFFFFFC0000008 :                     ; 		mov	@r0+,r5
(2)  290/FFFFFFFFC0000008 :                     ; 		mov	@r0+,r4
(2)  291/FFFFFFFFC0000008 :                     ; 		mov	@r0+,r3
(2)  292/FFFFFFFFC0000008 :                     ; 		mov	@r0+,r2
(2)  293/FFFFFFFFC0000008 :                     ; 		bra	wdgbg_nextwd
(2)  294/FFFFFFFFC0000008 :                     ; 		nop
(2)  295/FFFFFFFFC0000008 :                     
(2)  296/FFFFFFFFC0000008 :                     ; ; ----------------------------------------
(2)  297/FFFFFFFFC0000008 :                     ; ; Draw timer U/D
(2)  298/FFFFFFFFC0000008 :                     ; ; ----------------------------------------
(2)  299/FFFFFFFFC0000008 :                     ;
(2)  300/FFFFFFFFC0000008 :                     ; wdgbg_draw_ud:
(2)  301/FFFFFFFFC0000008 :                     ; 		dt	r0
(2)  302/FFFFFFFFC0000008 :                     ; 		mov	r0,@r1
(2)  303/FFFFFFFFC0000008 :                     ; 		mov	#Cach_WdBackup_S,r0
(2)  304/FFFFFFFFC0000008 :                     ; 		mov	r2,@-r0
(2)  305/FFFFFFFFC0000008 :                     ; 		mov	r3,@-r0
(2)  306/FFFFFFFFC0000008 :                     ; 		mov	r4,@-r0
(2)  307/FFFFFFFFC0000008 :                     ; 		mov	r5,@-r0
(2)  308/FFFFFFFFC0000008 :                     ; 		mov	r6,@-r0
(2)  309/FFFFFFFFC0000008 :                     ; 		mov	r7,@-r0
(2)  310/FFFFFFFFC0000008 :                     ; 		mov	r8,@-r0
(2)  311/FFFFFFFFC0000008 :                     ; 		mov	r9,@-r0
(2)  312/FFFFFFFFC0000008 :                     ; 		mov	r10,@-r0
(2)  313/FFFFFFFFC0000008 :                     ; 		mov	r11,@-r0
(2)  314/FFFFFFFFC0000008 :                     ; 		mov	r12,@-r0
(2)  315/FFFFFFFFC0000008 :                     ; 		mov	r13,@-r0
(2)  316/FFFFFFFFC0000008 :                     ; 		mov	r14,@-r0
(2)  317/FFFFFFFFC0000008 :                     ; 		sts	macl,@-r0
(2)  318/FFFFFFFFC0000008 :                     ;
(2)  319/FFFFFFFFC0000008 :                     ; ; $00 - Layout data (read)
(2)  320/FFFFFFFFC0000008 :                     ; ; $04 - FB pos (read)
(2)  321/FFFFFFFFC0000008 :                     ; ; $08 - Layout width (next block)
(2)  322/FFFFFFFFC0000008 :                     ; ; $0C - FB width (next line)
(2)  323/FFFFFFFFC0000008 :                     ; ; $10 - FB FULL size
(2)  324/FFFFFFFFC0000008 :                     ; ; $14 - FB base
(2)  325/FFFFFFFFC0000008 :                     ; ; $18 - Block data
(2)  326/FFFFFFFFC0000008 :                     ; ; $1C - Block counter
(2)  327/FFFFFFFFC0000008 :                     ;
(2)  328/FFFFFFFFC0000008 :                     ; 		mov	#Cach_WdgBuffRd_UD,r14
(2)  329/FFFFFFFFC0000008 :                     ; 		mov	@($14,r14),r13		; r13 - FB base
(2)  330/FFFFFFFFC0000008 :                     ; 		mov	@($10,r14),r12		; r12 - FB full size
(2)  331/FFFFFFFFC0000008 :                     ; 		mov	@($0C,r14),r11		; r11 - FB width
(2)  332/FFFFFFFFC0000008 :                     ; 		mov	@($04,r14),r10		; r10 - FB x/y pos
(2)  333/FFFFFFFFC0000008 :                     ; 		mov	@($18,r14),r9		; r9 - Block data
(2)  334/FFFFFFFFC0000008 :                     ; 		mov	#1,r7			; r7 - Layout increment
(2)  335/FFFFFFFFC0000008 :                     ; 		mov	@r14,r8			; r8 - Layout data
(2)  336/FFFFFFFFC0000008 :                     ; 		mov.b	@r8,r0
(2)  337/FFFFFFFFC0000008 :                     ; 		add	r7,r8
(2)  338/FFFFFFFFC0000008 :                     ; 		mov	r8,@r14
(2)  339/FFFFFFFFC0000008 :                     ; 		mov	#320,r8
(2)  340/FFFFFFFFC0000008 :                     ; 		extu.b	r0,r0
(2)  341/FFFFFFFFC0000008 :                     ; 		mov	#16*16,r1		; <-- Manual block size
(2)  342/FFFFFFFFC0000008 :                     ; 		mulu	r0,r1
(2)  343/FFFFFFFFC0000008 :                     ; 		sts	macl,r0
(2)  344/FFFFFFFFC0000008 :                     ; 		add	r0,r9
(2)  345/FFFFFFFFC0000008 :                     ; 		mov	#16,r7			; <-- Manual block size
(2)  346/FFFFFFFFC0000008 :                     ; 		lds	r10,macl
(2)  347/FFFFFFFFC0000008 :                     ; 		mov	#_framebuffer,r1
(2)  348/FFFFFFFFC0000008 :                     ; 		mov	#RAM_Mars_ScrlData,r2
(2)  349/FFFFFFFFC0000008 :                     ; .y_loopud:
(2)  350/FFFFFFFFC0000008 :                     ; 		cmp/ge	r12,r10
(2)  351/FFFFFFFFC0000008 :                     ; 		bf	.lne_szud
(2)  352/FFFFFFFFC0000008 :                     ; 		sub	r12,r10
(2)  353/FFFFFFFFC0000008 :                     ; .lne_szud:
(2)  354/FFFFFFFFC0000008 :                     ; 		mov	r10,r5
(2)  355/FFFFFFFFC0000008 :                     ; 		mov	#16,r6			; <-- Manual block size
(2)  356/FFFFFFFFC0000008 :                     ; 		shlr2	r6
(2)  357/FFFFFFFFC0000008 :                     ; .x_loopud:
(2)  358/FFFFFFFFC0000008 :                     ; 		mov	@r9+,r0
(2)  359/FFFFFFFFC0000008 :                     ;
(2)  360/FFFFFFFFC0000008 :                     ; 		mov	r2,r3
(2)  361/FFFFFFFFC0000008 :                     ; 		add	r5,r3
(2)  362/FFFFFFFFC0000008 :                     ; 		mov	r13,r4
(2)  363/FFFFFFFFC0000008 :                     ; 		add	r1,r4
(2)  364/FFFFFFFFC0000008 :                     ; 		add	r5,r4
(2)  365/FFFFFFFFC0000008 :                     ;
(2)  366/FFFFFFFFC0000008 :                     ; 		mov	r0,@r3
(2)  367/FFFFFFFFC0000008 :                     ; 		mov	r0,@r4
(2)  368/FFFFFFFFC0000008 :                     ; 		cmp/ge	r8,r5
(2)  369/FFFFFFFFC0000008 :                     ; 		bt	.exy_lineud
(2)  370/FFFFFFFFC0000008 :                     ; 		add	r12,r4
(2)  371/FFFFFFFFC0000008 :                     ; 		add	r12,r3
(2)  372/FFFFFFFFC0000008 :                     ; 		mov	r0,@r3
(2)  373/FFFFFFFFC0000008 :                     ; 		mov	r0,@r4
(2)  374/FFFFFFFFC0000008 :                     ; .exy_lineud:
(2)  375/FFFFFFFFC0000008 :                     ; 		dt	r6
(2)  376/FFFFFFFFC0000008 :                     ; 		bf/s	.x_loopud
(2)  377/FFFFFFFFC0000008 :                     ; 		add	#4,r5
(2)  378/FFFFFFFFC0000008 :                     ; 		dt	r7
(2)  379/FFFFFFFFC0000008 :                     ; 		bf/s	.y_loopud
(2)  380/FFFFFFFFC0000008 :                     ; 		add	r11,r10
(2)  381/FFFFFFFFC0000008 :                     ; 		sts	macl,r10
(2)  382/FFFFFFFFC0000008 :                     ;
(2)  383/FFFFFFFFC0000008 :                     ;
(2)  384/FFFFFFFFC0000008 :                     ; 		mov	#16,r0
(2)  385/FFFFFFFFC0000008 :                     ; 		add	r0,r10
(2)  386/FFFFFFFFC0000008 :                     ; 		mov	r10,@($04,r14)	; Save FB pos
(2)  387/FFFFFFFFC0000008 :                     ;
(2)  388/FFFFFFFFC0000008 :                     ; 		mov	#Cach_WdBackup_L,r0
(2)  389/FFFFFFFFC0000008 :                     ; 		lds	@r0+,macl
(2)  390/FFFFFFFFC0000008 :                     ; 		mov	@r0+,r14
(2)  391/FFFFFFFFC0000008 :                     ; 		mov	@r0+,r13
(2)  392/FFFFFFFFC0000008 :                     ; 		mov	@r0+,r12
(2)  393/FFFFFFFFC0000008 :                     ; 		mov	@r0+,r11
(2)  394/FFFFFFFFC0000008 :                     ; 		mov	@r0+,r10
(2)  395/FFFFFFFFC0000008 :                     ; 		mov	@r0+,r9
(2)  396/FFFFFFFFC0000008 :                     ; 		mov	@r0+,r8
(2)  397/FFFFFFFFC0000008 :                     ; 		mov	@r0+,r7
(2)  398/FFFFFFFFC0000008 :                     ; 		mov	@r0+,r6
(2)  399/FFFFFFFFC0000008 :                     ; 		mov	@r0+,r5
(2)  400/FFFFFFFFC0000008 :                     ; 		mov	@r0+,r4
(2)  401/FFFFFFFFC0000008 :                     ; 		mov	@r0+,r3
(2)  402/FFFFFFFFC0000008 :                     ; 		mov	@r0+,r2
(2)  403/FFFFFFFFC0000008 :                     
(2)  404/FFFFFFFFC0000008 :                     ; ----------------------------------------
(2)  405/FFFFFFFFC0000008 :                     
(2)  406/FFFFFFFFC0000008 :                     ; wdgbg_nextwd:
(2)  407/FFFFFFFFC0000008 :                     ; 		mov	#$FFFFFE80,r1
(2)  408/FFFFFFFFC0000008 :                     ; 		mov.w   #$A518,r0		; OFF
(2)  409/FFFFFFFFC0000008 :                     ; 		mov.w   r0,@r1
(2)  410/FFFFFFFFC0000008 :                     ; 		or      #$20,r0			; ON
(2)  411/FFFFFFFFC0000008 :                     ; 		mov.w   r0,@r1
(2)  412/FFFFFFFFC0000008 :                     ; 		mov.w   #$5A20,r0		; Timer for the next WD
(2)  413/FFFFFFFFC0000008 :                     ; 		mov.w   r0,@r1
(2)  414/FFFFFFFFC0000008 :                     ; 		rts
(2)  415/FFFFFFFFC0000008 :                     ; 		nop
(2)  416/FFFFFFFFC0000008 :                     ; 		align 4
(2)  417/FFFFFFFFC0000008 :                     
(2)  418/FFFFFFFFC0000008 :                     ; 		ltorg
(2)  419/FFFFFFFFC0000008 :                     
(2)  420/FFFFFFFFC0000008 :                     ; 	; NEXT ENTER
(2)  421/FFFFFFFFC0000008 :                     ; 		mov.l   #$FFFFFE80,r1
(2)  422/FFFFFFFFC0000008 :                     ; 		mov.w   #$A518,r0		; OFF
(2)  423/FFFFFFFFC0000008 :                     ; 		mov.w   r0,@r1
(2)  424/FFFFFFFFC0000008 :                     ; 		or      #$20,r0			; ON
(2)  425/FFFFFFFFC0000008 :                     ; 		mov.w   r0,@r1
(2)  426/FFFFFFFFC0000008 :                     ; 		mov.w   #$5A20,r0		; Timer for the next WD
(2)  427/FFFFFFFFC0000008 :                     ; 		mov.w   r0,@r1
(2)  428/FFFFFFFFC0000008 :                     ; 		rts
(2)  429/FFFFFFFFC0000008 :                     ; 		nop
(2)  430/FFFFFFFFC0000008 :                     ; 		align 4
(2)  431/FFFFFFFFC0000008 :                     ; .finish_now:
(2)  432/FFFFFFFFC0000008 :                     ; 		mov	#1,r0
(2)  433/FFFFFFFFC0000008 :                     ; 		mov.w	r0,@(marsGbl_WdgStatus,gbr)
(2)  434/FFFFFFFFC0000008 :                     ; 		mov	#$FFFFFE80,r1		; Stop watchdog
(2)  435/FFFFFFFFC0000008 :                     ; 		mov.w   #$A518,r0
(2)  436/FFFFFFFFC0000008 :                     ; 		mov.w   r0,@r1
(2)  437/FFFFFFFFC0000008 : 000B                		rts
(2)  438/FFFFFFFFC000000A : 0009                		nop
(2)  439/FFFFFFFFC000000C :                     		align 4
(2)  440/FFFFFFFFC000000C : FE10                		ltorg
(2)  441/FFFFFFFFC000000E :                     
(2)  442/FFFFFFFFC000000E :                     ; ====================================================================
(2)  443/FFFFFFFFC000000E :                     ; ----------------------------------------------------------------
(2)  444/FFFFFFFFC000000E :                     ; Drawing routines for the smooth-scrolling background
(2)  445/FFFFFFFFC000000E :                     ;
(2)  446/FFFFFFFFC000000E :                     ; NOTE: NO RV-ROM PROTECTION
(2)  447/FFFFFFFFC000000E :                     ; ----------------------------------------------------------------
(2)  448/FFFFFFFFC000000E :                     
(2)  449/FFFFFFFFC000000E :                     ; --------------------------------------------------------
(2)  450/FFFFFFFFC000000E :                     ; MarsVideo_DrwMapData
(2)  451/FFFFFFFFC000000E :                     ;
(2)  452/FFFFFFFFC000000E :                     ; Input:
(2)  453/FFFFFFFFC000000E :                     ; r14 | Scrolling section (Output)
(2)  454/FFFFFFFFC000000E :                     ; r13 | Background buffer (Input)
(2)  455/FFFFFFFFC000000E :                     ;
(2)  456/FFFFFFFFC000000E :                     ; Breaks:
(2)  457/FFFFFFFFC000000E :                     ; ALL
(2)  458/FFFFFFFFC000000E :                     ; --------------------------------------------------------
(2)  459/FFFFFFFFC000000E :                     
(2)  460/FFFFFFFFC000000E :                     		align 4
(2)  461/FFFFFFFFC0000010 :                     MarsVideo_DrwMapData:
(2)  462/FFFFFFFFC0000010 : 4F22                		sts	pr,@-r15
(2)  463/FFFFFFFFC0000012 : 2FE6                		mov	r14,@-r15
(2)  464/FFFFFFFFC0000014 : 2FD6                		mov	r13,@-r15
(2)  465/FFFFFFFFC0000016 : 5CD5                		mov	@(scrl_intrl_size,r13),r12
(2)  466/FFFFFFFFC0000018 : D543                		mov	#RAM_Mars_ScrlData,r5
(2)  467/FFFFFFFFC000001A :                     ; 		mov	@(scrl_fbdata,r13),r0
(2)  468/FFFFFFFFC000001A :                     ; 		add	r0,r5
(2)  469/FFFFFFFFC000001A : 51EC                		mov	@(md_bg_x,r14),r1
(2)  470/FFFFFFFFC000001C : 4129                		shlr16	r1
(2)  471/FFFFFFFFC000001E : 52ED                		mov	@(md_bg_y,r14),r2
(2)  472/FFFFFFFFC0000020 : 4229                		shlr16	r2
(2)  473/FFFFFFFFC0000022 : 59EA                		mov	@(md_bg_blk,r14),r9
(2)  474/FFFFFFFFC0000024 : 611F                		exts.w	r1,r1
(2)  475/FFFFFFFFC0000026 : 58E8                		mov	@(md_bg_low,r14),r8
(2)  476/FFFFFFFFC0000028 : 622F                		exts.w	r2,r2
(2)  477/FFFFFFFFC000002A : 84E0                		mov.b	@(md_bg_bw,r14),r0
(2)  478/FFFFFFFFC000002C : 630C                		extu.b	r0,r3
(2)  479/FFFFFFFFC000002E : 84E1                		mov.b	@(md_bg_bh,r14),r0
(2)  480/FFFFFFFFC0000030 : 640C                		extu.b	r0,r4
(2)  481/FFFFFFFFC0000032 : 85E4                		mov.w	@(md_bg_w,r14),r0
(2)  482/FFFFFFFFC0000034 : 670D                		extu.w	r0,r7
(2)  483/FFFFFFFFC0000036 : 85E5                		mov.w	@(md_bg_h,r14),r0
(2)  484/FFFFFFFFC0000038 : 660D                		extu.w	r0,r6
(2)  485/FFFFFFFFC000003A : 5BD6                		mov	@(scrl_intrl_w,r13),r11
(2)  486/FFFFFFFFC000003C : 450A                		lds	r5,mach
(2)  487/FFFFFFFFC000003E : 5AD7                		mov	@(scrl_intrl_h,r13),r10
(2)  488/FFFFFFFFC0000040 : E0F0                		mov	#-16,r0			; <- manual size
(2)  489/FFFFFFFFC0000042 : 2109                		and	r0,r1
(2)  490/FFFFFFFFC0000044 : 2209                		and	r0,r2
(2)  491/FFFFFFFFC0000046 :                     
(2)  492/FFFFFFFFC0000046 :                     	; TODO: X/Y map wrap check
(2)  493/FFFFFFFFC0000046 : 213E                		mulu	r3,r1
(2)  494/FFFFFFFFC0000048 : 001A                		sts	macl,r0
(2)  495/FFFFFFFFC000004A : 4019                		shlr8	r0
(2)  496/FFFFFFFFC000004C : 380C                		add	r0,r8
(2)  497/FFFFFFFFC000004E : 224E                		mulu	r4,r2
(2)  498/FFFFFFFFC0000050 : 001A                		sts	macl,r0
(2)  499/FFFFFFFFC0000052 : 4019                		shlr8	r0
(2)  500/FFFFFFFFC0000054 : 207E                		mulu	r7,r0
(2)  501/FFFFFFFFC0000056 : 001A                		sts	macl,r0
(2)  502/FFFFFFFFC0000058 : 380C                		add	r0,r8
(2)  503/FFFFFFFFC000005A :                     
(2)  504/FFFFFFFFC000005A :                     .x_in:
(2)  505/FFFFFFFFC000005A : 4115                		cmp/pl	r1		; X set
(2)  506/FFFFFFFFC000005C : 8901                		bt	.x_pl
(2)  507/FFFFFFFFC000005E : AFFC                		bra	.x_in
(2)  508/FFFFFFFFC0000060 : 31CC                		add	r12,r1		; <-- full size
(2)  509/FFFFFFFFC0000062 :                     .x_pl:
(2)  510/FFFFFFFFC0000062 : 31C3                		cmp/ge	r12,r1
(2)  511/FFFFFFFFC0000064 : 8B01                		bf	.x_fl
(2)  512/FFFFFFFFC0000066 : AFFC                		bra	.x_pl
(2)  513/FFFFFFFFC0000068 : 31C8                		sub	r12,r1
(2)  514/FFFFFFFFC000006A :                     .x_fl:
(2)  515/FFFFFFFFC000006A : 4215                		cmp/pl	r2		; Y set
(2)  516/FFFFFFFFC000006C : 8901                		bt	.y_pl
(2)  517/FFFFFFFFC000006E : AFFC                		bra	.x_fl
(2)  518/FFFFFFFFC0000070 : 32AC                		add	r10,r2
(2)  519/FFFFFFFFC0000072 :                     .y_pl:
(2)  520/FFFFFFFFC0000072 : 32A3                		cmp/ge	r10,r2
(2)  521/FFFFFFFFC0000074 : 8B01                		bf	.y_fl
(2)  522/FFFFFFFFC0000076 : AFFC                		bra	.y_pl
(2)  523/FFFFFFFFC0000078 : 32A8                		sub	r10,r2
(2)  524/FFFFFFFFC000007A :                     .y_fl:
(2)  525/FFFFFFFFC000007A : 22BE                		mulu	r11,r2
(2)  526/FFFFFFFFC000007C : 021A                		sts	macl,r2
(2)  527/FFFFFFFFC000007E : 6523                		mov	r2,r5
(2)  528/FFFFFFFFC0000080 : 351C                		add	r1,r5
(2)  529/FFFFFFFFC0000082 :                     
(2)  530/FFFFFFFFC0000082 :                     	; mach - _framebuffer area
(2)  531/FFFFFFFFC0000082 :                     	;  r12 - FULL Scroll area size
(2)  532/FFFFFFFFC0000082 :                     	;  r11 - Scroll area width
(2)  533/FFFFFFFFC0000082 :                     	;  r10 - Scroll area height
(2)  534/FFFFFFFFC0000082 :                     	;   r9 - Block graphics data
(2)  535/FFFFFFFFC0000082 :                     	;   r8 - Map data
(2)  536/FFFFFFFFC0000082 :                     	;   r7 - Map width
(2)  537/FFFFFFFFC0000082 :                     	;   r6 - Map height
(2)  538/FFFFFFFFC0000082 :                     	;   r5 - Current FB top
(2)  539/FFFFFFFFC0000082 :                     
(2)  540/FFFFFFFFC0000082 : E010                		mov	#16,r0			; <- manual size
(2)  541/FFFFFFFFC0000084 : 20AE                		mulu	r10,r0
(2)  542/FFFFFFFFC0000086 : 021A                		sts	macl,r2
(2)  543/FFFFFFFFC0000088 : 4219                		shlr8	r2
(2)  544/FFFFFFFFC000008A :                     .y_loop:
(2)  545/FFFFFFFFC000008A : D028                		mov	#Cach_InRead_S,r0
(2)  546/FFFFFFFFC000008C : 2056                		mov	r5,@-r0
(2)  547/FFFFFFFFC000008E : 2086                		mov	r8,@-r0
(2)  548/FFFFFFFFC0000090 : 35C3                		cmp/ge	r12,r5
(2)  549/FFFFFFFFC0000092 : 8B00                		bf	.xy_g
(2)  550/FFFFFFFFC0000094 : 35C8                		sub	r12,r5
(2)  551/FFFFFFFFC0000096 :                     .xy_g:
(2)  552/FFFFFFFFC0000096 : E010                		mov	#16,r0
(2)  553/FFFFFFFFC0000098 : 20BE                		mulu	r11,r0
(2)  554/FFFFFFFFC000009A : 031A                		sts	macl,r3
(2)  555/FFFFFFFFC000009C : 4319                		shlr8	r3
(2)  556/FFFFFFFFC000009E :                     .x_loop:
(2)  557/FFFFFFFFC000009E : B013                		bsr	.this_blk
(2)  558/FFFFFFFFC00000A0 : 6084                		mov.b	@r8+,r0
(2)  559/FFFFFFFFC00000A2 : E010                		mov	#16,r0			; <- manual size
(2)  560/FFFFFFFFC00000A4 : 4310                		dt	r3
(2)  561/FFFFFFFFC00000A6 : 8FFA                		bf/s	.x_loop
(2)  562/FFFFFFFFC00000A8 : 350C                		add	r0,r5
(2)  563/FFFFFFFFC00000AA : D021                		mov	#Cach_InRead_L,r0
(2)  564/FFFFFFFFC00000AC : 6806                		mov	@r0+,r8
(2)  565/FFFFFFFFC00000AE : 6506                		mov	@r0+,r5
(2)  566/FFFFFFFFC00000B0 :                     
(2)  567/FFFFFFFFC00000B0 : E010                		mov	#16,r0			; <- manual size
(2)  568/FFFFFFFFC00000B2 : 20BE                		mulu	r11,r0
(2)  569/FFFFFFFFC00000B4 : 001A                		sts	macl,r0
(2)  570/FFFFFFFFC00000B6 : 350C                		add	r0,r5
(2)  571/FFFFFFFFC00000B8 : 387C                		add	r7,r8
(2)  572/FFFFFFFFC00000BA : 4210                		dt	r2
(2)  573/FFFFFFFFC00000BC : 8BE5                		bf	.y_loop
(2)  574/FFFFFFFFC00000BE :                     
(2)  575/FFFFFFFFC00000BE : 6DF6                		mov	@r15+,r13
(2)  576/FFFFFFFFC00000C0 : 6EF6                		mov	@r15+,r14
(2)  577/FFFFFFFFC00000C2 : 4F26                		lds	@r15+,pr
(2)  578/FFFFFFFFC00000C4 : 000B                		rts
(2)  579/FFFFFFFFC00000C6 : 0009                		nop
(2)  580/FFFFFFFFC00000C8 :                     		align 4
(2)  581/FFFFFFFFC00000C8 :                     .this_blk:
(2)  582/FFFFFFFFC00000C8 : 600C                		extu.b	r0,r0
(2)  583/FFFFFFFFC00000CA : 9137                		mov	#16*16,r1		; <- manual size
(2)  584/FFFFFFFFC00000CC : 201E                		mulu	r1,r0
(2)  585/FFFFFFFFC00000CE : D019                		mov	#Cach_BlkBackup_S,r0
(2)  586/FFFFFFFFC00000D0 : 2026                		mov	r2,@-r0
(2)  587/FFFFFFFFC00000D2 : 2036                		mov	r3,@-r0
(2)  588/FFFFFFFFC00000D4 : 2046                		mov	r4,@-r0
(2)  589/FFFFFFFFC00000D6 : 2056                		mov	r5,@-r0
(2)  590/FFFFFFFFC00000D8 : 2066                		mov	r6,@-r0
(2)  591/FFFFFFFFC00000DA : 2096                		mov	r9,@-r0
(2)  592/FFFFFFFFC00000DC : 001A                		sts	macl,r0
(2)  593/FFFFFFFFC00000DE : 390C                		add	r0,r9
(2)  594/FFFFFFFFC00000E0 : E410                		mov	#16,r4			; <- manual size
(2)  595/FFFFFFFFC00000E2 :                     .yb_line:
(2)  596/FFFFFFFFC00000E2 : 35C3                		cmp/ge	r12,r5
(2)  597/FFFFFFFFC00000E4 : 8B00                		bf	.xy_g2
(2)  598/FFFFFFFFC00000E6 : 35C8                		sub	r12,r5
(2)  599/FFFFFFFFC00000E8 :                     .xy_g2:
(2)  600/FFFFFFFFC00000E8 : 6253                		mov	r5,r2
(2)  601/FFFFFFFFC00000EA : E310                		mov	#16,r3			; <- manual size
(2)  602/FFFFFFFFC00000EC : 4309                		shlr2	r3
(2)  603/FFFFFFFFC00000EE :                     .xb_line:
(2)  604/FFFFFFFFC00000EE : 010A                		sts	mach,r1
(2)  605/FFFFFFFFC00000F0 : 312C                		add	r2,r1
(2)  606/FFFFFFFFC00000F2 : 6092                		mov	@r9,r0
(2)  607/FFFFFFFFC00000F4 : 2102                		mov	r0,@r1
(2)  608/FFFFFFFFC00000F6 : 9022                		mov	#320,r0
(2)  609/FFFFFFFFC00000F8 : 3203                		cmp/ge	r0,r2
(2)  610/FFFFFFFFC00000FA : 8904                		bt	.x_ex
(2)  611/FFFFFFFFC00000FC : 010A                		sts	mach,r1
(2)  612/FFFFFFFFC00000FE : 312C                		add	r2,r1
(2)  613/FFFFFFFFC0000100 : 31CC                		add	r12,r1
(2)  614/FFFFFFFFC0000102 : 6092                		mov	@r9,r0
(2)  615/FFFFFFFFC0000104 : 2102                		mov	r0,@r1
(2)  616/FFFFFFFFC0000106 :                     .x_ex:
(2)  617/FFFFFFFFC0000106 : 7904                		add	#4,r9
(2)  618/FFFFFFFFC0000108 : 4310                		dt	r3
(2)  619/FFFFFFFFC000010A : 8FF0                		bf/s	.xb_line
(2)  620/FFFFFFFFC000010C : 7204                		add	#4,r2
(2)  621/FFFFFFFFC000010E : 4410                		dt	r4
(2)  622/FFFFFFFFC0000110 : 8FE7                		bf/s	.yb_line
(2)  623/FFFFFFFFC0000112 : 35BC                		add	r11,r5
(2)  624/FFFFFFFFC0000114 :                     
(2)  625/FFFFFFFFC0000114 : D008                		mov	#Cach_BlkBackup_L,r0
(2)  626/FFFFFFFFC0000116 : 6906                		mov	@r0+,r9
(2)  627/FFFFFFFFC0000118 : 6606                		mov	@r0+,r6
(2)  628/FFFFFFFFC000011A : 6506                		mov	@r0+,r5
(2)  629/FFFFFFFFC000011C : 6406                		mov	@r0+,r4
(2)  630/FFFFFFFFC000011E : 6306                		mov	@r0+,r3
(2)  631/FFFFFFFFC0000120 : 6206                		mov	@r0+,r2
(2)  632/FFFFFFFFC0000122 : 000B                		rts
(2)  633/FFFFFFFFC0000124 : 0009                		nop
(2)  634/FFFFFFFFC0000126 :                     		align 4
(2)  635/FFFFFFFFC0000128 : 2600 79F8 C000 03A8 		ltorg
                    C000 03A0 C000 03C0 
                    C000 03A8 0100 0140 
(2)  636/FFFFFFFFC0000140 :                     
(2)  637/FFFFFFFFC0000140 :                     ; ====================================================================
(2)  638/FFFFFFFFC0000140 :                     ; ----------------------------------------------------------------
(2)  639/FFFFFFFFC0000140 :                     ; Drawing routines for the Super-sprites
(2)  640/FFFFFFFFC0000140 :                     ;
(2)  641/FFFFFFFFC0000140 :                     ; Note: hardcoded
(2)  642/FFFFFFFFC0000140 :                     ; ----------------------------------------------------------------
(2)  643/FFFFFFFFC0000140 :                     
(2)  644/FFFFFFFFC0000140 :                     ; --------------------------------------------------------
(2)  645/FFFFFFFFC0000140 :                     ; MarsVideo_DrawSuperSpr_M
(2)  646/FFFFFFFFC0000140 :                     ;
(2)  647/FFFFFFFFC0000140 :                     ; Draws the Super-sprites directly recieved on DREQ
(2)  648/FFFFFFFFC0000140 :                     ;
(2)  649/FFFFFFFFC0000140 :                     ; Call MarsVideo_SetSuperSpr FIRST to setup the
(2)  650/FFFFFFFFC0000140 :                     ; main screen coordinates
(2)  651/FFFFFFFFC0000140 :                     ;
(2)  652/FFFFFFFFC0000140 :                     ; Input:
(2)  653/FFFFFFFFC0000140 :                     ; r14 - Super sprites data
(2)  654/FFFFFFFFC0000140 :                     ;
(2)  655/FFFFFFFFC0000140 :                     ; Breaks:
(2)  656/FFFFFFFFC0000140 :                     ; ALL
(2)  657/FFFFFFFFC0000140 :                     ;
(2)  658/FFFFFFFFC0000140 :                     ; Note:
(2)  659/FFFFFFFFC0000140 :                     ; Make sure the pixel data is set to Cache-thru (|TH)
(2)  660/FFFFFFFFC0000140 :                     ; --------------------------------------------------------
(2)  661/FFFFFFFFC0000140 :                     
(2)  662/FFFFFFFFC0000140 :                     		align 4
(2)  663/FFFFFFFFC0000140 :                     MarsVideo_DrawSuperSpr_M:
(2)  664/FFFFFFFFC0000140 : DE48                		mov	#RAM_Mars_DreqRead+Dreq_SuperSpr,r14
(2)  665/FFFFFFFFC0000142 : DB49                		mov	#Cach_Intrl_W,r11
(2)  666/FFFFFFFFC0000144 : 6BB2                		mov	@r11,r11
(2)  667/FFFFFFFFC0000146 : DA49                		mov	#Cach_Intrl_Size,r10
(2)  668/FFFFFFFFC0000148 : 6AA2                		mov	@r10,r10
(2)  669/FFFFFFFFC000014A : 0009                		nop
(2)  670/FFFFFFFFC000014C :                     MarsVideo_NxtSuprSpr:
(2)  671/FFFFFFFFC000014C : 50E4                		mov	@(marsspr_data,r14),r0
(2)  672/FFFFFFFFC000014E : 2008                		tst	r0,r0
(2)  673/FFFFFFFFC0000150 : 8B02                		bf	.valid
(2)  674/FFFFFFFFC0000152 : 000B                		rts
(2)  675/FFFFFFFFC0000154 : 0009                		nop
(2)  676/FFFFFFFFC0000156 :                     		align 4
(2)  677/FFFFFFFFC0000158 :                     .valid:
(2)  678/FFFFFFFFC0000158 : 85E5                		mov.w	@(marsspr_indx,r14),r0
(2)  679/FFFFFFFFC000015A : 6C03                		mov	r0,r12
(2)  680/FFFFFFFFC000015C : 55E1                		mov	@(marsspr_x,r14),r5	; XXXX YYYY
(2)  681/FFFFFFFFC000015E : 665F                		exts.w	r5,r6
(2)  682/FFFFFFFFC0000160 : 57E0                		mov	@(marsspr_xfrm,r14),r7	; ?? ?? XX YY
(2)  683/FFFFFFFFC0000162 : 4529                		shlr16	r5
(2)  684/FFFFFFFFC0000164 : 655F                		exts.w	r5,r5
(2)  685/FFFFFFFFC0000166 : 687C                		extu.b	r7,r8
(2)  686/FFFFFFFFC0000168 : 4719                		shlr8	r7
(2)  687/FFFFFFFFC000016A : 677C                		extu.b	r7,r7
(2)  688/FFFFFFFFC000016C :                     ; 		mov.w	@(marsspr_x,r14),r0
(2)  689/FFFFFFFFC000016C :                     ; 		exts.w	r0,r5
(2)  690/FFFFFFFFC000016C :                     ; 		mov.w	@(marsspr_y,r14),r0
(2)  691/FFFFFFFFC000016C :                     ; 		exts.w	r0,r6
(2)  692/FFFFFFFFC000016C :                     ; 		mov.b	@(marsspr_xs,r14),r0
(2)  693/FFFFFFFFC000016C :                     ; 		exts.b	r0,r7
(2)  694/FFFFFFFFC000016C :                     ; 		mov.b	@(marsspr_ys,r14),r0
(2)  695/FFFFFFFFC000016C :                     ; 		exts.b	r0,r8
(2)  696/FFFFFFFFC000016C : 6373                		mov	r7,r3			; Copy old XS / YS
(2)  697/FFFFFFFFC000016E : 6483                		mov	r8,r4
(2)  698/FFFFFFFFC0000170 : 375C                		add	r5,r7
(2)  699/FFFFFFFFC0000172 : 386C                		add	r6,r8
(2)  700/FFFFFFFFC0000174 :                     
(2)  701/FFFFFFFFC0000174 : D03E                		mov	#Cach_Intrl_H,r0
(2)  702/FFFFFFFFC0000176 : 6002                		mov	@r0,r0
(2)  703/FFFFFFFFC0000178 : 4815                		cmp/pl	r8
(2)  704/FFFFFFFFC000017A : 8B71                		bf	.spr_out
(2)  705/FFFFFFFFC000017C : 4715                		cmp/pl	r7
(2)  706/FFFFFFFFC000017E : 8B6F                		bf	.spr_out
(2)  707/FFFFFFFFC0000180 : 35B3                		cmp/ge	r11,r5
(2)  708/FFFFFFFFC0000182 : 896D                		bt	.spr_out
(2)  709/FFFFFFFFC0000184 : 3603                		cmp/ge	r0,r6
(2)  710/FFFFFFFFC0000186 : 896B                		bt	.spr_out
(2)  711/FFFFFFFFC0000188 :                     	; XR / YB
(2)  712/FFFFFFFFC0000188 : 907C                		mov	#224,r0
(2)  713/FFFFFFFFC000018A : 3803                		cmp/ge	r0,r8
(2)  714/FFFFFFFFC000018C : 8B00                		bf	.yb_e
(2)  715/FFFFFFFFC000018E : 6803                		mov	r0,r8
(2)  716/FFFFFFFFC0000190 :                     .yb_e:
(2)  717/FFFFFFFFC0000190 : 9079                		mov	#320,r0
(2)  718/FFFFFFFFC0000192 : 3703                		cmp/ge	r0,r7
(2)  719/FFFFFFFFC0000194 : 8B00                		bf	.xb_e
(2)  720/FFFFFFFFC0000196 : 6703                		mov	r0,r7
(2)  721/FFFFFFFFC0000198 :                     .xb_e:
(2)  722/FFFFFFFFC0000198 :                     
(2)  723/FFFFFFFFC0000198 : 85E4                		mov.w	@(marsspr_dwidth,r14),r0
(2)  724/FFFFFFFFC000019A : 6103                		mov	r0,r1
(2)  725/FFFFFFFFC000019C : 85E0                		mov.w	@(marsspr_xfrm,r14),r0	; X frame
(2)  726/FFFFFFFFC000019E : 6203                		mov	r0,r2
(2)  727/FFFFFFFFC00001A0 : 5DE4                		mov	@(marsspr_data,r14),r13
(2)  728/FFFFFFFFC00001A2 : 241E                		mulu	r1,r4
(2)  729/FFFFFFFFC00001A4 : 041A                		sts	macl,r4
(2)  730/FFFFFFFFC00001A6 : 600C                		extu.b	r0,r0
(2)  731/FFFFFFFFC00001A8 : 204E                		mulu	r4,r0
(2)  732/FFFFFFFFC00001AA : 001A                		sts	macl,r0
(2)  733/FFFFFFFFC00001AC : 3D0C                		add	r0,r13
(2)  734/FFFFFFFFC00001AE : 6023                		mov	r2,r0
(2)  735/FFFFFFFFC00001B0 : 4019                		shlr8	r0
(2)  736/FFFFFFFFC00001B2 : 600C                		extu.b	r0,r0
(2)  737/FFFFFFFFC00001B4 : 203E                		mulu	r3,r0
(2)  738/FFFFFFFFC00001B6 : 001A                		sts	macl,r0
(2)  739/FFFFFFFFC00001B8 : 3D0C                		add	r0,r13
(2)  740/FFFFFFFFC00001BA :                     
(2)  741/FFFFFFFFC00001BA : D22E                		mov	#Cach_FbData,r2
(2)  742/FFFFFFFFC00001BC : 6222                		mov	@r2,r2
(2)  743/FFFFFFFFC00001BE : D02E                		mov	#_framebuffer,r0
(2)  744/FFFFFFFFC00001C0 : 302C                		add	r2,r0
(2)  745/FFFFFFFFC00001C2 : 400A                		lds	r0,mach
(2)  746/FFFFFFFFC00001C4 : 85E4                		mov.w	@(marsspr_dwidth,r14),r0
(2)  747/FFFFFFFFC00001C6 : 620D                		extu.w	r0,r2
(2)  748/FFFFFFFFC00001C8 : 85E6                		mov.w	@(marsspr_flags,r14),r0
(2)  749/FFFFFFFFC00001CA : C802                		tst	#%10,r0		; Y flip?
(2)  750/FFFFFFFFC00001CC : 8902                		bt	.flp_v
(2)  751/FFFFFFFFC00001CE : 3D4C                		add	r4,r13
(2)  752/FFFFFFFFC00001D0 : 3D28                		sub	r2,r13
(2)  753/FFFFFFFFC00001D2 : 622B                		neg	r2,r2
(2)  754/FFFFFFFFC00001D4 :                     .flp_v:
(2)  755/FFFFFFFFC00001D4 : E401                		mov	#1,r4
(2)  756/FFFFFFFFC00001D6 : C801                		tst	#%01,r0		; X flip?
(2)  757/FFFFFFFFC00001D8 : 8901                		bt	.flp_h
(2)  758/FFFFFFFFC00001DA : 3D3C                		add	r3,r13		; move beam
(2)  759/FFFFFFFFC00001DC : E4FF                		mov	#-1,r4		; decrement line
(2)  760/FFFFFFFFC00001DE :                     .flp_h:
(2)  761/FFFFFFFFC00001DE : 4611                		cmp/pz	r6
(2)  762/FFFFFFFFC00001E0 : 8907                		bt	.yt_e
(2)  763/FFFFFFFFC00001E2 : 606B                		neg	r6,r0
(2)  764/FFFFFFFFC00001E4 : 266A                		xor	r6,r6
(2)  765/FFFFFFFFC00001E6 : 210F                		muls	r0,r1
(2)  766/FFFFFFFFC00001E8 : 001A                		sts	macl,r0
(2)  767/FFFFFFFFC00001EA : 4211                		cmp/pz	r2
(2)  768/FFFFFFFFC00001EC : 8900                		bt	.yfinc
(2)  769/FFFFFFFFC00001EE : 600B                		neg	r0,r0
(2)  770/FFFFFFFFC00001F0 :                     .yfinc:
(2)  771/FFFFFFFFC00001F0 : 3D0C                		add	r0,r13
(2)  772/FFFFFFFFC00001F2 :                     .yt_e:
(2)  773/FFFFFFFFC00001F2 : 4511                		cmp/pz	r5
(2)  774/FFFFFFFFC00001F4 : 8905                		bt	.xt_e
(2)  775/FFFFFFFFC00001F6 : 6953                		mov	r5,r9
(2)  776/FFFFFFFFC00001F8 : 4411                		cmp/pz	r4
(2)  777/FFFFFFFFC00001FA : 8900                		bt	.xfinc
(2)  778/FFFFFFFFC00001FC : 699B                		neg	r9,r9
(2)  779/FFFFFFFFC00001FE :                     .xfinc:
(2)  780/FFFFFFFFC00001FE : 3D98                		sub	r9,r13
(2)  781/FFFFFFFFC0000200 : 255A                		xor	r5,r5
(2)  782/FFFFFFFFC0000202 :                     .xt_e:
(2)  783/FFFFFFFFC0000202 : 694D                		extu.w	r4,r9
(2)  784/FFFFFFFFC0000204 : 4228                		shll16	r2
(2)  785/FFFFFFFFC0000206 : 292B                		or	r2,r9
(2)  786/FFFFFFFFC0000208 : D41C                		mov	#Cach_FbPos_Y,r4
(2)  787/FFFFFFFFC000020A : D21D                		mov	#Cach_FbPos,r2
(2)  788/FFFFFFFFC000020C : 6442                		mov	@r4,r4
(2)  789/FFFFFFFFC000020E : 346C                		add	r6,r4
(2)  790/FFFFFFFFC0000210 :                     ; 		cmp/ge	r10,r4
(2)  791/FFFFFFFFC0000210 :                     ; 		bf	.y_snap
(2)  792/FFFFFFFFC0000210 :                     ; 		sub	r10,r4
(2)  793/FFFFFFFFC0000210 :                     ; .y_snap:
(2)  794/FFFFFFFFC0000210 : 24BE                		mulu	r11,r4
(2)  795/FFFFFFFFC0000212 : 6222                		mov	@r2,r2
(2)  796/FFFFFFFFC0000214 : 041A                		sts	macl,r4
(2)  797/FFFFFFFFC0000216 : 342C                		add	r2,r4
(2)  798/FFFFFFFFC0000218 :                     
(2)  799/FFFFFFFFC0000218 :                     	; mach - _framebuffer + base
(2)  800/FFFFFFFFC0000218 :                     	;  r14 - Sprite data
(2)  801/FFFFFFFFC0000218 :                     	;  r13 - Texture data
(2)  802/FFFFFFFFC0000218 :                     	;  r12 - Texture index
(2)  803/FFFFFFFFC0000218 :                     	;  r11 - Internal WIDTH
(2)  804/FFFFFFFFC0000218 :                     	;  r10 - Internal WIDTH+HEIGHT
(2)  805/FFFFFFFFC0000218 :                     	;   r9 - Spritesheet Ydraw direction | Xdraw direction
(2)  806/FFFFFFFFC0000218 :                     	;   r8 - Y End
(2)  807/FFFFFFFFC0000218 :                     	;   r7 - X End
(2)  808/FFFFFFFFC0000218 :                     	;   r6 - Y Start
(2)  809/FFFFFFFFC0000218 :                     	;   r5 - X Start
(2)  810/FFFFFFFFC0000218 :                     	;   r4 - FB output position
(2)  811/FFFFFFFFC0000218 :                     	;
(2)  812/FFFFFFFFC0000218 :                     	; *** start ***
(2)  813/FFFFFFFFC0000218 :                     .y_loop:
(2)  814/FFFFFFFFC0000218 : 34A3                		cmp/ge	r10,r4			; Wrap FB output
(2)  815/FFFFFFFFC000021A : 8B00                		bf	.y_max
(2)  816/FFFFFFFFC000021C : 34A8                		sub	r10,r4
(2)  817/FFFFFFFFC000021E :                     .y_max:
(2)  818/FFFFFFFFC000021E : 61D3                		mov	r13,r1			; r1 - Texture IN
(2)  819/FFFFFFFFC0000220 : 6253                		mov	r5,r2			; r2 - X counter
(2)  820/FFFFFFFFC0000222 :                     .x_loop:
(2)  821/FFFFFFFFC0000222 : 030A                		sts	mach,r3			; r3 - Framebuffer + FbData
(2)  822/FFFFFFFFC0000224 : 334C                		add	r4,r3			; add top-left position
(2)  823/FFFFFFFFC0000226 : 332C                		add	r2,r3			; add X position
(2)  824/FFFFFFFFC0000228 :                     
(2)  825/FFFFFFFFC0000228 : 6010                		mov.b	@r1,r0			; r0 - pixel
(2)  826/FFFFFFFFC000022A : 2008                		tst	r0,r0			; blank pixel 0?
(2)  827/FFFFFFFFC000022C : 8900                		bt	.blnk
(2)  828/FFFFFFFFC000022E : 30CC                		add	r12,r0			; add pixel increment
(2)  829/FFFFFFFFC0000230 :                     .blnk:
(2)  830/FFFFFFFFC0000230 : 2300                		mov.b	r0,@r3			; Write pixel
(2)  831/FFFFFFFFC0000232 : 9028                		mov	#320,r0			; Check for hidden line (X < 320)
(2)  832/FFFFFFFFC0000234 : 3023                		cmp/ge	r2,r0
(2)  833/FFFFFFFFC0000236 : 8905                		bt	.ex_line
(2)  834/FFFFFFFFC0000238 : 6010                		mov.b	@r1,r0			; Repeat same thing but
(2)  835/FFFFFFFFC000023A : 2008                		tst	r0,r0			; but add r12 to the
(2)  836/FFFFFFFFC000023C : 8900                		bt	.blnk2			; destination
(2)  837/FFFFFFFFC000023E : 30CC                		add	r12,r0
(2)  838/FFFFFFFFC0000240 :                     .blnk2:
(2)  839/FFFFFFFFC0000240 : 33AC                		add	r10,r3
(2)  840/FFFFFFFFC0000242 : 2300                		mov.b	r0,@r3
(2)  841/FFFFFFFFC0000244 :                     .ex_line:
(2)  842/FFFFFFFFC0000244 : 7201                		add	#1,r2			; Increment X pos
(2)  843/FFFFFFFFC0000246 :                     
(2)  844/FFFFFFFFC0000246 : 6093                		mov	r9,r0
(2)  845/FFFFFFFFC0000248 : 600F                		exts.w	r0,r0
(2)  846/FFFFFFFFC000024A : 3273                		cmp/ge	r7,r2
(2)  847/FFFFFFFFC000024C : 8FE9                		bf/s	.x_loop
(2)  848/FFFFFFFFC000024E : 310C                		add	r0,r1			; Increment texture pos
(2)  849/FFFFFFFFC0000250 :                     
(2)  850/FFFFFFFFC0000250 : 6093                		mov	r9,r0
(2)  851/FFFFFFFFC0000252 : 4029                		shlr16	r0
(2)  852/FFFFFFFFC0000254 : 600F                		exts.w	r0,r0
(2)  853/FFFFFFFFC0000256 : 3D0C                		add	r0,r13			; Next texture line
(2)  854/FFFFFFFFC0000258 : 7601                		add	#1,r6			; Increment loop Y
(2)  855/FFFFFFFFC000025A : 3683                		cmp/ge	r8,r6			; Y start > Y end?
(2)  856/FFFFFFFFC000025C : 8FDC                		bf/s	.y_loop
(2)  857/FFFFFFFFC000025E : 34BC                		add	r11,r4			; Next FB top-left line
(2)  858/FFFFFFFFC0000260 :                     .spr_out:
(2)  859/FFFFFFFFC0000260 : AF74                		bra	MarsVideo_NxtSuprSpr
(2)  860/FFFFFFFFC0000262 : 7E18                		add 	#sizeof_marsspr,r14
(2)  861/FFFFFFFFC0000264 :                     		align 4
(2)  862/FFFFFFFFC0000264 : 2600 7300 C000 042C 		ltorg
                    C000 0434 C000 0430 
                    C000 0420 2400 0000 
                    C000 0428 C000 0424 
                    00E0 0140           
(2)  863/FFFFFFFFC0000288 :                     
(2)  864/FFFFFFFFC0000288 :                     
(2)  865/FFFFFFFFC0000288 :                     ; --------------------------------------------------------
(2)  866/FFFFFFFFC0000288 :                     ; MarsVideo_DrawBgSSpr
(2)  867/FFFFFFFFC0000288 :                     ;
(2)  868/FFFFFFFFC0000288 :                     ; Call this BEFORE updating Sprite info
(2)  869/FFFFFFFFC0000288 :                     ; --------------------------------------------------------
(2)  870/FFFFFFFFC0000288 :                     
(2)  871/FFFFFFFFC0000288 :                     		align 4
(2)  872/FFFFFFFFC0000288 :                     MarsVideo_DrawBgSSpr:
(2)  873/FFFFFFFFC0000288 : DE28                		mov	#Cach_SprBoxList,r14
(2)  874/FFFFFFFFC000028A :                     
(2)  875/FFFFFFFFC000028A : DC29                		mov	#Cach_Intrl_Size,r12
(2)  876/FFFFFFFFC000028C : DA29                		mov	#Cach_FbPos,r10
(2)  877/FFFFFFFFC000028E : DB2A                		mov	#Cach_Intrl_W,r11
(2)  878/FFFFFFFFC0000290 : D02A                		mov	#Cach_FbPos_Y,r0
(2)  879/FFFFFFFFC0000292 : 6002                		mov	@r0,r0
(2)  880/FFFFFFFFC0000294 : D92A                		mov	#Cach_FbData,r9
(2)  881/FFFFFFFFC0000296 : 6992                		mov	@r9,r9
(2)  882/FFFFFFFFC0000298 : D12A                		mov	#_framebuffer,r1
(2)  883/FFFFFFFFC000029A : 6BB2                		mov	@r11,r11
(2)  884/FFFFFFFFC000029C : E2FC                		mov	#-4,r2
(2)  885/FFFFFFFFC000029E : 6AA2                		mov	@r10,r10
(2)  886/FFFFFFFFC00002A0 : 391C                		add	r1,r9
(2)  887/FFFFFFFFC00002A2 : 6CC2                		mov	@r12,r12
(2)  888/FFFFFFFFC00002A4 :                     
(2)  889/FFFFFFFFC00002A4 :                     ; 		mov	#RAM_Mars_ScrlBuff,r13
(2)  890/FFFFFFFFC00002A4 :                     ; 		mov	@(scrl_fbpos_y,r13),r0
(2)  891/FFFFFFFFC00002A4 :                     ; 		mov	#_framebuffer,r1
(2)  892/FFFFFFFFC00002A4 :                     ; 		mov	@(scrl_fbdata,r13),r9
(2)  893/FFFFFFFFC00002A4 :                     ; 		add	r1,r9
(2)  894/FFFFFFFFC00002A4 :                     ; 		mov	@(scrl_intrl_w,r13),r11
(2)  895/FFFFFFFFC00002A4 :                     ; 		mov	#-4,r2
(2)  896/FFFFFFFFC00002A4 :                     ; 		mov	@(scrl_fbpos,r13),r10
(2)  897/FFFFFFFFC00002A4 :                     ; 		and	r2,r0
(2)  898/FFFFFFFFC00002A4 :                     ; 		mov	@(scrl_intrl_size,r13),r12
(2)  899/FFFFFFFFC00002A4 :                     
(2)  900/FFFFFFFFC00002A4 : 2B0E                		mulu	r0,r11
(2)  901/FFFFFFFFC00002A6 : 011A                		sts	macl,r1
(2)  902/FFFFFFFFC00002A8 : D027                		mov	#RAM_Mars_ScrlData,r0
(2)  903/FFFFFFFFC00002AA : 3A1C                		add	r1,r10
(2)  904/FFFFFFFFC00002AC : 3AC3                		cmp/ge	r12,r10
(2)  905/FFFFFFFFC00002AE : 8B00                		bf	.ygood
(2)  906/FFFFFFFFC00002B0 : 3AC8                		sub	r12,r10
(2)  907/FFFFFFFFC00002B2 :                     .ygood:
(2)  908/FFFFFFFFC00002B2 : 2A29                		and	r2,r10
(2)  909/FFFFFFFFC00002B4 : 400A                		lds	r0,mach
(2)  910/FFFFFFFFC00002B6 :                     
(2)  911/FFFFFFFFC00002B6 :                     .next_save:
(2)  912/FFFFFFFFC00002B6 : 60E2                		mov	@r14,r0
(2)  913/FFFFFFFFC00002B8 : 4011                		cmp/pz	r0
(2)  914/FFFFFFFFC00002BA : 8934                		bt	.last
(2)  915/FFFFFFFFC00002BC : 64A3                		mov	r10,r4
(2)  916/FFFFFFFFC00002BE : 6503                		mov	r0,r5
(2)  917/FFFFFFFFC00002C0 : 6603                		mov	r0,r6
(2)  918/FFFFFFFFC00002C2 : 6703                		mov	r0,r7
(2)  919/FFFFFFFFC00002C4 : 6803                		mov	r0,r8
(2)  920/FFFFFFFFC00002C6 : 200A                		xor	r0,r0
(2)  921/FFFFFFFFC00002C8 : 2E02                		mov	r0,@r14
(2)  922/FFFFFFFFC00002CA : E07F                		mov	#$7F,r0
(2)  923/FFFFFFFFC00002CC : 4529                		shlr16	r5
(2)  924/FFFFFFFFC00002CE : 4729                		shlr16	r7
(2)  925/FFFFFFFFC00002D0 : 4719                		shlr8	r7
(2)  926/FFFFFFFFC00002D2 : 2509                		and	r0,r5
(2)  927/FFFFFFFFC00002D4 : 2709                		and	r0,r7
(2)  928/FFFFFFFFC00002D6 : 4508                		shll2	r5
(2)  929/FFFFFFFFC00002D8 : 4708                		shll2	r7
(2)  930/FFFFFFFFC00002DA : 4819                		shlr8	r8
(2)  931/FFFFFFFFC00002DC : 9036                		mov	#$FF,r0
(2)  932/FFFFFFFFC00002DE : 2609                		and	r0,r6
(2)  933/FFFFFFFFC00002E0 : 2809                		and	r0,r8
(2)  934/FFFFFFFFC00002E2 : 3868                		sub	r6,r8
(2)  935/FFFFFFFFC00002E4 : 4815                		cmp/pl	r8
(2)  936/FFFFFFFFC00002E6 : 8B1C                		bf	.spr_out
(2)  937/FFFFFFFFC00002E8 : 26BE                		mulu	r11,r6
(2)  938/FFFFFFFFC00002EA : 001A                		sts	macl,r0
(2)  939/FFFFFFFFC00002EC : 340C                		add	r0,r4
(2)  940/FFFFFFFFC00002EE :                     
(2)  941/FFFFFFFFC00002EE : 962E                		mov	#320,r6
(2)  942/FFFFFFFFC00002F0 :                     .y_lp:
(2)  943/FFFFFFFFC00002F0 : 6153                		mov	r5,r1
(2)  944/FFFFFFFFC00002F2 : 6243                		mov	r4,r2
(2)  945/FFFFFFFFC00002F4 : 325C                		add	r5,r2
(2)  946/FFFFFFFFC00002F6 :                     .x_lp:
(2)  947/FFFFFFFFC00002F6 : 32C7                		cmp/gt	r12,r2
(2)  948/FFFFFFFFC00002F8 : 8B00                		bf	.x_keep
(2)  949/FFFFFFFFC00002FA : 32C8                		sub	r12,r2
(2)  950/FFFFFFFFC00002FC :                     .x_keep:
(2)  951/FFFFFFFFC00002FC : 0D0A                		sts	mach,r13
(2)  952/FFFFFFFFC00002FE : 3D2C                		add	r2,r13
(2)  953/FFFFFFFFC0000300 : 60D6                		mov	@r13+,r0
(2)  954/FFFFFFFFC0000302 :                     ; 		or	r13,r0
(2)  955/FFFFFFFFC0000302 :                     
(2)  956/FFFFFFFFC0000302 : 6393                		mov	r9,r3
(2)  957/FFFFFFFFC0000304 : 332C                		add	r2,r3
(2)  958/FFFFFFFFC0000306 : 2302                		mov	r0,@r3
(2)  959/FFFFFFFFC0000308 : 3263                		cmp/ge	r6,r2
(2)  960/FFFFFFFFC000030A : 8903                		bt	.x_lrg
(2)  961/FFFFFFFFC000030C : 33CC                		add	r12,r3
(2)  962/FFFFFFFFC000030E : 3DCC                		add	r12,r13
(2)  963/FFFFFFFFC0000310 : 2302                		mov	r0,@r3
(2)  964/FFFFFFFFC0000312 : 2D02                		mov	r0,@r13
(2)  965/FFFFFFFFC0000314 :                     .x_lrg:
(2)  966/FFFFFFFFC0000314 : 7104                		add	#4,r1
(2)  967/FFFFFFFFC0000316 : 3173                		cmp/ge	r7,r1
(2)  968/FFFFFFFFC0000318 : 8FED                		bf/s	.x_lp
(2)  969/FFFFFFFFC000031A : 7204                		add	#4,r2
(2)  970/FFFFFFFFC000031C : 4810                		dt	r8
(2)  971/FFFFFFFFC000031E : 8FE7                		bf/s	.y_lp
(2)  972/FFFFFFFFC0000320 : 34BC                		add	r11,r4
(2)  973/FFFFFFFFC0000322 :                     .spr_out:
(2)  974/FFFFFFFFC0000322 : AFC8                		bra	.next_save
(2)  975/FFFFFFFFC0000324 : 7E04                		add 	#4,r14
(2)  976/FFFFFFFFC0000326 :                     .last:
(2)  977/FFFFFFFFC0000326 : 000B                		rts
(2)  978/FFFFFFFFC0000328 : 0009                		nop
(2)  979/FFFFFFFFC000032A :                     		align 4
(2)  980/FFFFFFFFC000032C : C000 0438 C000 0434 		ltorg
                    C000 0424 C000 042C 
                    C000 0428 C000 0420 
                    2400 0000 2600 79F8 
                    00FF 0140           
(2)  981/FFFFFFFFC0000350 :                     
(2)  982/FFFFFFFFC0000350 :                     ; --------------------------------------------------------
(2)  983/FFFFFFFFC0000350 :                     ; ; MarsVideo_DrawBgSSpr
(2)  984/FFFFFFFFC0000350 :                     ; ;
(2)  985/FFFFFFFFC0000350 :                     ; ; Call this BEFORE updating Sprite info
(2)  986/FFFFFFFFC0000350 :                     ; ; --------------------------------------------------------
(2)  987/FFFFFFFFC0000350 :                     ;
(2)  988/FFFFFFFFC0000350 :                     ; 		align 4
(2)  989/FFFFFFFFC0000350 :                     ; MarsVideo_DrawBgSSpr:
(2)  990/FFFFFFFFC0000350 :                     ; 		mov	#Cach_SprBoxList,r14
(2)  991/FFFFFFFFC0000350 :                     ;
(2)  992/FFFFFFFFC0000350 :                     ; 		mov	#Cach_Intrl_Size,r12
(2)  993/FFFFFFFFC0000350 :                     ; 		mov	#Cach_FbPos,r10
(2)  994/FFFFFFFFC0000350 :                     ; 		mov	#Cach_Intrl_W,r11
(2)  995/FFFFFFFFC0000350 :                     ; 		mov	#Cach_FbPos_Y,r0
(2)  996/FFFFFFFFC0000350 :                     ; 		mov	@r0,r0
(2)  997/FFFFFFFFC0000350 :                     ; 		mov	#Cach_FbData,r9
(2)  998/FFFFFFFFC0000350 :                     ; 		mov	@r9,r9
(2)  999/FFFFFFFFC0000350 :                     ; 		mov	#_framebuffer,r1
(2) 1000/FFFFFFFFC0000350 :                     ; 		mov	@r11,r11
(2) 1001/FFFFFFFFC0000350 :                     ; 		mov	#-4,r2
(2) 1002/FFFFFFFFC0000350 :                     ; 		mov	@r10,r10
(2) 1003/FFFFFFFFC0000350 :                     ; 		add	r1,r9
(2) 1004/FFFFFFFFC0000350 :                     ; 		mov	@r12,r12
(2) 1005/FFFFFFFFC0000350 :                     ;
(2) 1006/FFFFFFFFC0000350 :                     ; ; 		mov	#RAM_Mars_ScrlBuff,r13
(2) 1007/FFFFFFFFC0000350 :                     ; ; 		mov	@(scrl_fbpos_y,r13),r0
(2) 1008/FFFFFFFFC0000350 :                     ; ; 		mov	#_framebuffer,r1
(2) 1009/FFFFFFFFC0000350 :                     ; ; 		mov	@(scrl_fbdata,r13),r9
(2) 1010/FFFFFFFFC0000350 :                     ; ; 		add	r1,r9
(2) 1011/FFFFFFFFC0000350 :                     ; ; 		mov	@(scrl_intrl_w,r13),r11
(2) 1012/FFFFFFFFC0000350 :                     ; ; 		mov	#-4,r2
(2) 1013/FFFFFFFFC0000350 :                     ; ; 		mov	@(scrl_fbpos,r13),r10
(2) 1014/FFFFFFFFC0000350 :                     ; ; 		and	r2,r0
(2) 1015/FFFFFFFFC0000350 :                     ; ; 		mov	@(scrl_intrl_size,r13),r12
(2) 1016/FFFFFFFFC0000350 :                     ;
(2) 1017/FFFFFFFFC0000350 :                     ; 		mulu	r0,r11
(2) 1018/FFFFFFFFC0000350 :                     ; 		sts	macl,r1
(2) 1019/FFFFFFFFC0000350 :                     ; 		mov	#RAM_Mars_ScrlData,r0
(2) 1020/FFFFFFFFC0000350 :                     ; 		add	r1,r10
(2) 1021/FFFFFFFFC0000350 :                     ; 		cmp/ge	r12,r10
(2) 1022/FFFFFFFFC0000350 :                     ; 		bf	.ygood
(2) 1023/FFFFFFFFC0000350 :                     ; 		sub	r12,r10
(2) 1024/FFFFFFFFC0000350 :                     ; .ygood:
(2) 1025/FFFFFFFFC0000350 :                     ; 		and	r2,r10
(2) 1026/FFFFFFFFC0000350 :                     ; 		lds	r0,mach
(2) 1027/FFFFFFFFC0000350 :                     ;
(2) 1028/FFFFFFFFC0000350 :                     ; .next_save:
(2) 1029/FFFFFFFFC0000350 :                     ; 		mov	@r14,r0
(2) 1030/FFFFFFFFC0000350 :                     ; 		cmp/pl	r0
(2) 1031/FFFFFFFFC0000350 :                     ; 		bt	.last
(2) 1032/FFFFFFFFC0000350 :                     ; 		mov	r10,r4
(2) 1033/FFFFFFFFC0000350 :                     ; 		mov	r0,r5
(2) 1034/FFFFFFFFC0000350 :                     ; 		mov	r0,r6
(2) 1035/FFFFFFFFC0000350 :                     ; 		mov	r0,r7
(2) 1036/FFFFFFFFC0000350 :                     ; 		mov	r0,r8
(2) 1037/FFFFFFFFC0000350 :                     ; 		xor	r0,r0
(2) 1038/FFFFFFFFC0000350 :                     ; 		mov	r0,@r14
(2) 1039/FFFFFFFFC0000350 :                     ; 		mov	#$7F,r0
(2) 1040/FFFFFFFFC0000350 :                     ; 		shlr16	r5
(2) 1041/FFFFFFFFC0000350 :                     ; 		shlr16	r7
(2) 1042/FFFFFFFFC0000350 :                     ; 		shlr8	r7
(2) 1043/FFFFFFFFC0000350 :                     ; 		and	r0,r5
(2) 1044/FFFFFFFFC0000350 :                     ; 		and	r0,r7
(2) 1045/FFFFFFFFC0000350 :                     ; 		shll2	r5
(2) 1046/FFFFFFFFC0000350 :                     ; 		shll2	r7
(2) 1047/FFFFFFFFC0000350 :                     ; 		shlr8	r8
(2) 1048/FFFFFFFFC0000350 :                     ; 		mov	#$FF,r0
(2) 1049/FFFFFFFFC0000350 :                     ; 		and	r0,r6
(2) 1050/FFFFFFFFC0000350 :                     ; 		and	r0,r8
(2) 1051/FFFFFFFFC0000350 :                     ; 		sub	r6,r8
(2) 1052/FFFFFFFFC0000350 :                     ; 		cmp/pl	r8
(2) 1053/FFFFFFFFC0000350 :                     ; 		bf	.spr_out
(2) 1054/FFFFFFFFC0000350 :                     ; 		mulu	r11,r6
(2) 1055/FFFFFFFFC0000350 :                     ; 		sts	macl,r0
(2) 1056/FFFFFFFFC0000350 :                     ; 		add	r0,r4
(2) 1057/FFFFFFFFC0000350 :                     ;
(2) 1058/FFFFFFFFC0000350 :                     ; 		mov	#320,r6
(2) 1059/FFFFFFFFC0000350 :                     ; .y_lp:
(2) 1060/FFFFFFFFC0000350 :                     ; 		mov	r5,r1
(2) 1061/FFFFFFFFC0000350 :                     ; 		mov	r4,r2
(2) 1062/FFFFFFFFC0000350 :                     ; 		add	r5,r2
(2) 1063/FFFFFFFFC0000350 :                     ; .x_lp:
(2) 1064/FFFFFFFFC0000350 :                     ; 		cmp/gt	r12,r2
(2) 1065/FFFFFFFFC0000350 :                     ; 		bf	.x_keep
(2) 1066/FFFFFFFFC0000350 :                     ; 		sub	r12,r2
(2) 1067/FFFFFFFFC0000350 :                     ; .x_keep:
(2) 1068/FFFFFFFFC0000350 :                     ; 		sts	mach,r13
(2) 1069/FFFFFFFFC0000350 :                     ; 		add	r2,r13
(2) 1070/FFFFFFFFC0000350 :                     ; 		mov	@r13+,r0
(2) 1071/FFFFFFFFC0000350 :                     ; ; 		or	r13,r0
(2) 1072/FFFFFFFFC0000350 :                     ;
(2) 1073/FFFFFFFFC0000350 :                     ; 		mov	r9,r3
(2) 1074/FFFFFFFFC0000350 :                     ; 		add	r2,r3
(2) 1075/FFFFFFFFC0000350 :                     ; 		mov	r0,@r3
(2) 1076/FFFFFFFFC0000350 :                     ; 		cmp/ge	r6,r2
(2) 1077/FFFFFFFFC0000350 :                     ; 		bt	.x_lrg
(2) 1078/FFFFFFFFC0000350 :                     ; 		add	r12,r3
(2) 1079/FFFFFFFFC0000350 :                     ; 		add	r12,r13
(2) 1080/FFFFFFFFC0000350 :                     ; 		mov	r0,@r3
(2) 1081/FFFFFFFFC0000350 :                     ; 		mov	r0,@r13
(2) 1082/FFFFFFFFC0000350 :                     ; .x_lrg:
(2) 1083/FFFFFFFFC0000350 :                     ; 		add	#4,r1
(2) 1084/FFFFFFFFC0000350 :                     ; 		cmp/ge	r7,r1
(2) 1085/FFFFFFFFC0000350 :                     ; 		bf/s	.x_lp
(2) 1086/FFFFFFFFC0000350 :                     ; 		add	#4,r2
(2) 1087/FFFFFFFFC0000350 :                     ; 		dt	r8
(2) 1088/FFFFFFFFC0000350 :                     ; 		bf/s	.y_lp
(2) 1089/FFFFFFFFC0000350 :                     ; 		add	r11,r4
(2) 1090/FFFFFFFFC0000350 :                     ; .spr_out:
(2) 1091/FFFFFFFFC0000350 :                     ; 		bra	.next_save
(2) 1092/FFFFFFFFC0000350 :                     ; 		add 	#4,r14
(2) 1093/FFFFFFFFC0000350 :                     ; .last:
(2) 1094/FFFFFFFFC0000350 :                     ; 		rts
(2) 1095/FFFFFFFFC0000350 :                     ; 		nop
(2) 1096/FFFFFFFFC0000350 :                     ; 		align 4
(2) 1097/FFFFFFFFC0000350 :                     ; 		ltorg
(2) 1098/FFFFFFFFC0000350 :                     
(2) 1099/FFFFFFFFC0000350 :                     ; ; --------------------------------------------------------
(2) 1100/FFFFFFFFC0000350 :                     ; ; MarsVideo_DrwSprData
(2) 1101/FFFFFFFFC0000350 :                     ; ; --------------------------------------------------------
(2) 1102/FFFFFFFFC0000350 :                     ;
(2) 1103/FFFFFFFFC0000350 :                     ; 		align 4
(2) 1104/FFFFFFFFC0000350 :                     ; MarsVideo_DrwSprData:
(2) 1105/FFFFFFFFC0000350 :                     ;  		mov	#RAM_Mars_DreqRead+Dreq_SuperSpr,r14
(2) 1106/FFFFFFFFC0000350 :                     ; 		mov	#RAM_Mars_SprPixels,r13
(2) 1107/FFFFFFFFC0000350 :                     ; 		mov	#Cach_Intrl_Size,r12
(2) 1108/FFFFFFFFC0000350 :                     ; 		mov	#Cach_FbPos,r10
(2) 1109/FFFFFFFFC0000350 :                     ; 		mov	#Cach_Intrl_W,r11
(2) 1110/FFFFFFFFC0000350 :                     ; 		mov	#Cach_FbPos_Y,r0
(2) 1111/FFFFFFFFC0000350 :                     ; 		mov	@r0,r0
(2) 1112/FFFFFFFFC0000350 :                     ; 		mov	#Cach_FbData,r9
(2) 1113/FFFFFFFFC0000350 :                     ; 		mov	@r9,r9
(2) 1114/FFFFFFFFC0000350 :                     ; 		mov	#_framebuffer,r1
(2) 1115/FFFFFFFFC0000350 :                     ; 		mov	@r11,r11
(2) 1116/FFFFFFFFC0000350 :                     ; 		mov	#-4,r2
(2) 1117/FFFFFFFFC0000350 :                     ; 		mov	@r10,r10
(2) 1118/FFFFFFFFC0000350 :                     ; 		add	r1,r9
(2) 1119/FFFFFFFFC0000350 :                     ; 		mov	@r12,r12
(2) 1120/FFFFFFFFC0000350 :                     ; 		mulu	r0,r11
(2) 1121/FFFFFFFFC0000350 :                     ; 		sts	macl,r0
(2) 1122/FFFFFFFFC0000350 :                     ; 		add	r0,r10
(2) 1123/FFFFFFFFC0000350 :                     ; 		cmp/ge	r12,r10
(2) 1124/FFFFFFFFC0000350 :                     ; 		bf	.next_save2
(2) 1125/FFFFFFFFC0000350 :                     ; 		sub	r12,r10
(2) 1126/FFFFFFFFC0000350 :                     ; .next_save2:
(2) 1127/FFFFFFFFC0000350 :                     ; 		lds	r9,mach
(2) 1128/FFFFFFFFC0000350 :                     ; 		mov	@(marsGbl_XShift,gbr),r0	; *** Xpos&1 add
(2) 1129/FFFFFFFFC0000350 :                     ; 		and	#1,r0
(2) 1130/FFFFFFFFC0000350 :                     ; 		add	r0,r13
(2) 1131/FFFFFFFFC0000350 :                     ;
(2) 1132/FFFFFFFFC0000350 :                     ; .next_save:
(2) 1133/FFFFFFFFC0000350 :                     ; 		mov	@(marsspr_data,r14),r0
(2) 1134/FFFFFFFFC0000350 :                     ; 		tst	r0,r0
(2) 1135/FFFFFFFFC0000350 :                     ; 		bt	.last
(2) 1136/FFFFFFFFC0000350 :                     ; 		nop
(2) 1137/FFFFFFFFC0000350 :                     ; 		mov	@(marsspr_x,r14),r5	; XXXX YYYY
(2) 1138/FFFFFFFFC0000350 :                     ; 		exts.w	r5,r6
(2) 1139/FFFFFFFFC0000350 :                     ; 		mov	@(marsspr_xfrm,r14),r7	; ?? ?? XX YY
(2) 1140/FFFFFFFFC0000350 :                     ; 		shlr16	r5
(2) 1141/FFFFFFFFC0000350 :                     ; 		exts.w	r5,r5
(2) 1142/FFFFFFFFC0000350 :                     ; 		extu.b	r7,r8
(2) 1143/FFFFFFFFC0000350 :                     ; 		shlr8	r7
(2) 1144/FFFFFFFFC0000350 :                     ; 		extu.b	r7,r7
(2) 1145/FFFFFFFFC0000350 :                     ; 		add	r5,r7
(2) 1146/FFFFFFFFC0000350 :                     ; 		add	r6,r8
(2) 1147/FFFFFFFFC0000350 :                     ; 		add	#2,r7		; +2
(2) 1148/FFFFFFFFC0000350 :                     ;
(2) 1149/FFFFFFFFC0000350 :                     ; ; 		mov.w	@(marsspr_x,r14),r0
(2) 1150/FFFFFFFFC0000350 :                     ; ; 		exts.w	r0,r5
(2) 1151/FFFFFFFFC0000350 :                     ; ; 		mov.w	@(marsspr_y,r14),r0
(2) 1152/FFFFFFFFC0000350 :                     ; ; 		exts.w	r0,r6
(2) 1153/FFFFFFFFC0000350 :                     ; ; 		mov.b	@(marsspr_xs,r14),r0
(2) 1154/FFFFFFFFC0000350 :                     ; ; 		exts.b	r0,r7
(2) 1155/FFFFFFFFC0000350 :                     ; ; 		mov.b	@(marsspr_ys,r14),r0
(2) 1156/FFFFFFFFC0000350 :                     ; ; 		exts.b	r0,r8
(2) 1157/FFFFFFFFC0000350 :                     ; ; 		add	r5,r7
(2) 1158/FFFFFFFFC0000350 :                     ; ; 		add	r6,r8
(2) 1159/FFFFFFFFC0000350 :                     ;
(2) 1160/FFFFFFFFC0000350 :                     ; 		mov	#320+2,r1	; + 2
(2) 1161/FFFFFFFFC0000350 :                     ; 		mov	#224,r2
(2) 1162/FFFFFFFFC0000350 :                     ; 		cmp/pl	r7
(2) 1163/FFFFFFFFC0000350 :                     ; 		bf	.spr_out
(2) 1164/FFFFFFFFC0000350 :                     ; 		cmp/pl	r8
(2) 1165/FFFFFFFFC0000350 :                     ; 		bf	.spr_out
(2) 1166/FFFFFFFFC0000350 :                     ; 		cmp/ge	r1,r5
(2) 1167/FFFFFFFFC0000350 :                     ; 		bt	.spr_out
(2) 1168/FFFFFFFFC0000350 :                     ; 		cmp/ge	r2,r6
(2) 1169/FFFFFFFFC0000350 :                     ; 		bt	.spr_out
(2) 1170/FFFFFFFFC0000350 :                     ; 		cmp/pz	r5
(2) 1171/FFFFFFFFC0000350 :                     ; 		bt	.xl_l
(2) 1172/FFFFFFFFC0000350 :                     ; 		xor	r5,r5
(2) 1173/FFFFFFFFC0000350 :                     ; .xl_l:
(2) 1174/FFFFFFFFC0000350 :                     ; 		cmp/pz	r6
(2) 1175/FFFFFFFFC0000350 :                     ; 		bt	.yl_l
(2) 1176/FFFFFFFFC0000350 :                     ; 		xor	r6,r6
(2) 1177/FFFFFFFFC0000350 :                     ; .yl_l:
(2) 1178/FFFFFFFFC0000350 :                     ; 		cmp/gt	r1,r7
(2) 1179/FFFFFFFFC0000350 :                     ; 		bf	.xr_l
(2) 1180/FFFFFFFFC0000350 :                     ; 		mov	r1,r7
(2) 1181/FFFFFFFFC0000350 :                     ; .xr_l:
(2) 1182/FFFFFFFFC0000350 :                     ; 		cmp/gt	r2,r8
(2) 1183/FFFFFFFFC0000350 :                     ; 		bf	.yr_l
(2) 1184/FFFFFFFFC0000350 :                     ; 		mov	r2,r8
(2) 1185/FFFFFFFFC0000350 :                     ; .yr_l:
(2) 1186/FFFFFFFFC0000350 :                     ;
(2) 1187/FFFFFFFFC0000350 :                     ; 	; r4 - Current TopLeft
(2) 1188/FFFFFFFFC0000350 :                     ; 	; r5 - X left
(2) 1189/FFFFFFFFC0000350 :                     ; 	; r6 - 320
(2) 1190/FFFFFFFFC0000350 :                     ; 	; r7 - X right
(2) 1191/FFFFFFFFC0000350 :                     ; 	; r8 - Y counter
(2) 1192/FFFFFFFFC0000350 :                     ; 	; r9 - *FREE*
(2) 1193/FFFFFFFFC0000350 :                     ; 	; r10 - TopLeft position (GLOBAL)
(2) 1194/FFFFFFFFC0000350 :                     ; 	; r11 - Internal Width
(2) 1195/FFFFFFFFC0000350 :                     ; 	; r12 - Internal W*H
(2) 1196/FFFFFFFFC0000350 :                     ; 	; r13 - Pixel data
(2) 1197/FFFFFFFFC0000350 :                     ; 	; mach - Framebuffer base
(2) 1198/FFFFFFFFC0000350 :                     ;
(2) 1199/FFFFFFFFC0000350 :                     ; 		mov	#320,r2
(2) 1200/FFFFFFFFC0000350 :                     ; 		mulu	r6,r2
(2) 1201/FFFFFFFFC0000350 :                     ; 		sts	macl,r1
(2) 1202/FFFFFFFFC0000350 :                     ; 		add	r5,r1
(2) 1203/FFFFFFFFC0000350 :                     ;
(2) 1204/FFFFFFFFC0000350 :                     ; 		mov	r10,r4
(2) 1205/FFFFFFFFC0000350 :                     ; 		mulu	r11,r6
(2) 1206/FFFFFFFFC0000350 :                     ; 		sts	macl,r0
(2) 1207/FFFFFFFFC0000350 :                     ; 		add	r0,r4
(2) 1208/FFFFFFFFC0000350 :                     ; 		add	r5,r4
(2) 1209/FFFFFFFFC0000350 :                     ; 		mov	#-2,r0
(2) 1210/FFFFFFFFC0000350 :                     ; 		and	r0,r4
(2) 1211/FFFFFFFFC0000350 :                     ; 		and	r0,r5
(2) 1212/FFFFFFFFC0000350 :                     ; 		and	r0,r7
(2) 1213/FFFFFFFFC0000350 :                     ;
(2) 1214/FFFFFFFFC0000350 :                     ; 		sub	r6,r8
(2) 1215/FFFFFFFFC0000350 :                     ; 		cmp/pl	r8
(2) 1216/FFFFFFFFC0000350 :                     ; 		bf	.spr_out
(2) 1217/FFFFFFFFC0000350 :                     ; 		mov	r2,r6
(2) 1218/FFFFFFFFC0000350 :                     ; .y_lp:
(2) 1219/FFFFFFFFC0000350 :                     ; 		cmp/gt	r12,r4
(2) 1220/FFFFFFFFC0000350 :                     ; 		bf	.y_keep
(2) 1221/FFFFFFFFC0000350 :                     ; 		sub	r12,r4
(2) 1222/FFFFFFFFC0000350 :                     ; .y_keep:
(2) 1223/FFFFFFFFC0000350 :                     ; 		mov	r4,r1
(2) 1224/FFFFFFFFC0000350 :                     ; 		mov	r5,r2
(2) 1225/FFFFFFFFC0000350 :                     ; .x_lp:
(2) 1226/FFFFFFFFC0000350 :                     ; 		mov.b	@r13+,r0
(2) 1227/FFFFFFFFC0000350 :                     ; 		shll8	r0
(2) 1228/FFFFFFFFC0000350 :                     ; 		mov.b	@r13+,r3
(2) 1229/FFFFFFFFC0000350 :                     ; 		extu.b	r3,r3
(2) 1230/FFFFFFFFC0000350 :                     ; 		or	r13,r0
(2) 1231/FFFFFFFFC0000350 :                     ;
(2) 1232/FFFFFFFFC0000350 :                     ; 		sts	mach,r3
(2) 1233/FFFFFFFFC0000350 :                     ; 		add	r1,r3
(2) 1234/FFFFFFFFC0000350 :                     ; 		mov.w	r0,@r3
(2) 1235/FFFFFFFFC0000350 :                     ; 		cmp/ge	r6,r1
(2) 1236/FFFFFFFFC0000350 :                     ; 		bt 	.x_hdn
(2) 1237/FFFFFFFFC0000350 :                     ; 		add	r12,r3
(2) 1238/FFFFFFFFC0000350 :                     ; 		mov.w	r0,@r3
(2) 1239/FFFFFFFFC0000350 :                     ; .x_hdn:
(2) 1240/FFFFFFFFC0000350 :                     ; 		add	#2,r2
(2) 1241/FFFFFFFFC0000350 :                     ; 		cmp/ge	r7,r2
(2) 1242/FFFFFFFFC0000350 :                     ; 		bf/s	.x_lp
(2) 1243/FFFFFFFFC0000350 :                     ; 		add	#2,r1
(2) 1244/FFFFFFFFC0000350 :                     ; 		dt	r8
(2) 1245/FFFFFFFFC0000350 :                     ; 		bf/s	.y_lp
(2) 1246/FFFFFFFFC0000350 :                     ; 		add	r11,r4
(2) 1247/FFFFFFFFC0000350 :                     ;
(2) 1248/FFFFFFFFC0000350 :                     ; .spr_out:
(2) 1249/FFFFFFFFC0000350 :                     ; 		bra	.next_save
(2) 1250/FFFFFFFFC0000350 :                     ; 		add 	#sizeof_marsspr,r14
(2) 1251/FFFFFFFFC0000350 :                     ; .last:
(2) 1252/FFFFFFFFC0000350 :                     ; 		rts
(2) 1253/FFFFFFFFC0000350 :                     ; 		nop
(2) 1254/FFFFFFFFC0000350 :                     ; 		align 4
(2) 1255/FFFFFFFFC0000350 :                     ; 		ltorg
(2) 1256/FFFFFFFFC0000350 :                     
(2) 1257/FFFFFFFFC0000350 :                     ; --------------------------------------------------------
(2) 1258/FFFFFFFFC0000350 :                     ; Quick RAM
(2) 1259/FFFFFFFFC0000350 :                     ; --------------------------------------------------------
(2) 1260/FFFFFFFFC0000350 :                     
(2) 1261/FFFFFFFFC0000350 :                     ; Cach_WdgDrawBuff:
(2) 1262/FFFFFFFFC0000350 :                     ; $00 - Layout data (read)
(2) 1263/FFFFFFFFC0000350 :                     ; $04 - FB pos (read)
(2) 1264/FFFFFFFFC0000350 :                     ; $08 - Layout width (next block)
(2) 1265/FFFFFFFFC0000350 :                     ; $0C - FB width (next line)
(2) 1266/FFFFFFFFC0000350 :                     ; $10 - FB FULL size
(2) 1267/FFFFFFFFC0000350 :                     ; $14 - FB base
(2) 1268/FFFFFFFFC0000350 :                     ; $18 - Block data
(2) 1269/FFFFFFFFC0000350 :                     ; $1C - Block counter
(2) 1270/FFFFFFFFC0000350 :                     ; $20 - ** Reserved **
(2) 1271/FFFFFFFFC0000350 :                     
(2) 1272/FFFFFFFFC0000350 :                     			align 4
(2) 1273/FFFFFFFFC0000350 :                     
(2) 1274/FFFFFFFFC0000350 :                     Cach_WdgBuffRd		ds.l 8
(2) 1275/FFFFFFFFC0000370 :                     Cach_WdgBuffWr		ds.l 0		; <-- read backwards
(2) 1276/FFFFFFFFC0000370 :                     Cach_WdgBuffRd_UD	ds.l 8
(2) 1277/FFFFFFFFC0000390 :                     Cach_WdgBuffWr_UD	ds.l 0		; <-- read backwards
(2) 1278/FFFFFFFFC0000390 :                     Cach_InSprRdrw		ds.l 4
(2) 1279/FFFFFFFFC00003A0 :                     Cach_InRead_L		ds.l 2
(2) 1280/FFFFFFFFC00003A8 :                     Cach_InRead_S		ds.l 0		; <-- read backwards
(2) 1281/FFFFFFFFC00003A8 :                     Cach_BlkBackup_L	ds.l 6
(2) 1282/FFFFFFFFC00003C0 :                     Cach_BlkBackup_S	ds.l 0		; <-- read backwards
(2) 1283/FFFFFFFFC00003C0 :                     Cach_WdBackup_L		ds.l 14
(2) 1284/FFFFFFFFC00003F8 :                     Cach_WdBackup_S		ds.l 0		; <-- read backwards
(2) 1285/FFFFFFFFC00003F8 :                     Cach_BlkRefill		ds.l 10
(2) 1286/FFFFFFFFC0000420 :                     Cach_BlkRefill_S	ds.l 0		; <-- read backwards
(2) 1287/FFFFFFFFC0000420 :                     ; Cach_DrawTimers		ds.l 4		; Screen draw-request timers, write $02 to these
(2) 1288/FFFFFFFFC0000420 :                     Cach_FbData		ds.l 1		; *** KEEP THIS ORDER
(2) 1289/FFFFFFFFC0000424 :                     Cach_FbPos		ds.l 1
(2) 1290/FFFFFFFFC0000428 :                     Cach_FbPos_Y		ds.l 1
(2) 1291/FFFFFFFFC000042C :                     Cach_Intrl_W		ds.l 1
(2) 1292/FFFFFFFFC0000430 :                     Cach_Intrl_H		ds.l 1
(2) 1293/FFFFFFFFC0000434 :                     Cach_Intrl_Size		ds.l 1		; ***
(2) 1294/FFFFFFFFC0000438 :                     Cach_SprBoxList		ds.l MAX_SUPERSPR
(2) 1295/FFFFFFFFC0000498 :                     ; RAM_Mars_ScrlBuff	ds.b sizeof_mscrl*2			; Scrolling buffers
(2) 1296/FFFFFFFFC0000498 :                     
(2) 1297/FFFFFFFFC0000498 :                     ; --------------------------------------------------------
(2) 1298/ 6001DBC :                     .end:		phase CACHE_MSTR_SCRL+.end&$1FFF
(2) 1299/ 6001DBC :                     		align 4
(2) 1300/ 6001DBC :                     CACHE_MSTR_SCRL_E:
(2) 1304/ 6001DBC :                     
(1) 2447/ 6001DBC :                     		include "system/mars/cache/cache_m_3D.asm"
(2)    1/ 6001DBC :                     ; ====================================================================
(2)    2/ 6001DBC :                     ; ----------------------------------------------------------------
(2)    3/ 6001DBC :                     ; CACHE code
(2)    4/ 6001DBC :                     ;
(2)    5/ 6001DBC :                     ; LIMIT: $800 bytes
(2)    6/ 6001DBC :                     ; ----------------------------------------------------------------
(2)    7/ 6001DBC :                     
(2)    8/ 6001DBC :                     		align 4
(2)    9/ 6001DBC :                     CACHE_MSTR_PLGN:
(2)   10/FFFFFFFFC0000000 :                     		phase $C0000000
(2)   11/FFFFFFFFC0000000 :                     
(2)   12/FFFFFFFFC0000000 :                     ; ====================================================================
(2)   13/FFFFFFFFC0000000 :                     ; --------------------------------------------------------
(2)   14/FFFFFFFFC0000000 :                     ; Watchdog interrupt
(2)   15/FFFFFFFFC0000000 :                     ; --------------------------------------------------------
(2)   16/FFFFFFFFC0000000 :                     
(2)   17/FFFFFFFFC0000000 : 912C                		mov	#_FRT,r1
(2)   18/FFFFFFFFC0000002 : 8417                		mov.b	@(7,r1),r0
(2)   19/FFFFFFFFC0000004 : CA02                		xor	#2,r0
(2)   20/FFFFFFFFC0000006 : 8017                		mov.b	r0,@(7,r1)
(2)   21/FFFFFFFFC0000008 : C509                		mov.w	@(marsGbl_WdgHold,gbr),r0
(2)   22/FFFFFFFFC000000A : 8801                		cmp/eq	#1,r0
(2)   23/FFFFFFFFC000000C : 891E                		bt	.exit
(2)   24/FFFFFFFFC000000E : C508                		mov.w	@(marsGbl_WdgMode,gbr),r0	; Framebuffer clear request ($07)?
(2)   25/FFFFFFFFC0000010 : 8807                		cmp/eq	#7,r0
(2)   26/FFFFFFFFC0000012 : 8B29                		bf	maindrw_tasks
(2)   27/FFFFFFFFC0000014 :                     
(2)   28/FFFFFFFFC0000014 :                     ; ------------------------------------------------
(2)   29/FFFFFFFFC0000014 :                     ; Clear Framebuffer
(2)   30/FFFFFFFFC0000014 :                     ; ------------------------------------------------
(2)   31/FFFFFFFFC0000014 :                     
(2)   32/FFFFFFFFC0000014 : D10F                		mov	#_vdpreg,r1
(2)   33/FFFFFFFFC0000016 : 8515                .wait_fb:	mov.w   @($A,r1),r0			; Framebuffer free?
(2)   34/FFFFFFFFC0000018 : C802                		tst     #2,r0
(2)   35/FFFFFFFFC000001A : 8BFC                		bf      .wait_fb
(2)   36/FFFFFFFFC000001C : 8513                		mov.w   @(6,r1),r0			; SVDP-fill address
(2)   37/FFFFFFFFC000001E : 705B                		add     #$5B,r0				; <-- Pre-increment
(2)   38/FFFFFFFFC0000020 : 8113                		mov.w   r0,@(6,r1)
(2)   39/FFFFFFFFC0000022 : 901C                		mov.w   #328/2,r0			; SVDP-fill size (320 pixels)
(2)   40/FFFFFFFFC0000024 : 8112                		mov.w   r0,@(4,r1)
(2)   41/FFFFFFFFC0000026 : E000                		mov.w	#$0000,r0			; SVDP-fill pixel data
(2)   42/FFFFFFFFC0000028 : 8114                		mov.w   r0,@(8,r1)			; now SVDP-fill is working.
(2)   43/FFFFFFFFC000002A : 9119                		mov	#$FFFFFE80,r1
(2)   44/FFFFFFFFC000002C : 9019                		mov.w   #$A518,r0			; OFF
(2)   45/FFFFFFFFC000002E : 2101                		mov.w   r0,@r1
(2)   46/FFFFFFFFC0000030 : CB20                		or      #$20,r0				; ON
(2)   47/FFFFFFFFC0000032 : 2101                		mov.w   r0,@r1
(2)   48/FFFFFFFFC0000034 : 9016                		mov.w   #$5A10,r0			; Timer before next watchdog
(2)   49/FFFFFFFFC0000036 : 2101                		mov.w   r0,@r1
(2)   50/FFFFFFFFC0000038 : D107                		mov	#Cach_ClrLines,r1		; Decrement a line to progress
(2)   51/FFFFFFFFC000003A : 6012                		mov	@r1,r0
(2)   52/FFFFFFFFC000003C : 4010                		dt	r0
(2)   53/FFFFFFFFC000003E : 8F02                		bf/s	.on_clr
(2)   54/FFFFFFFFC0000040 : 2102                		mov	r0,@r1
(2)   55/FFFFFFFFC0000042 : E001                		mov	#1,r0				; If finished: set task $01
(2)   56/FFFFFFFFC0000044 : C108                		mov.w	r0,@(marsGbl_WdgMode,gbr)
(2)   57/FFFFFFFFC0000046 :                     .on_clr:
(2)   58/FFFFFFFFC0000046 : 000B                		rts
(2)   59/FFFFFFFFC0000048 : 0009                		nop
(2)   60/FFFFFFFFC000004A :                     		align 4
(2)   61/FFFFFFFFC000004C : 2F26                .exit:		mov	r2,@-r15
(2)   62/FFFFFFFFC000004E : A1B2                		bra	drwtask_exit
(2)   63/FFFFFFFFC0000050 : E210                		mov	#$10,r2
(2)   64/FFFFFFFFC0000052 :                     		align 4
(2)   65/FFFFFFFFC0000054 : 2000 4100 C000 06DC 		ltorg
                    FE10 00A4 FE80 A518 
                    5A10                
(2)   66/FFFFFFFFC0000066 :                     
(2)   67/FFFFFFFFC0000066 :                     ; ------------------------------------------------
(2)   68/FFFFFFFFC0000066 :                     ; Main drawing routines
(2)   69/FFFFFFFFC0000066 :                     ; ------------------------------------------------
(2)   70/FFFFFFFFC0000066 :                     
(2)   71/FFFFFFFFC0000066 :                     		align 4
(2)   72/FFFFFFFFC0000068 :                     maindrw_tasks:
(2)   73/FFFFFFFFC0000068 : 4008                		shll2	r0
(2)   74/FFFFFFFFC000006A : D135                		mov	#.list,r1
(2)   75/FFFFFFFFC000006C : 001E                		mov	@(r1,r0),r0
(2)   76/FFFFFFFFC000006E : 402B                		jmp	@r0
(2)   77/FFFFFFFFC0000070 : 0009                		nop
(2)   78/FFFFFFFFC0000072 :                     		align 4
(2)   79/FFFFFFFFC0000074 :                     .list:
(2)   80/FFFFFFFFC0000074 : C000 0390           		dc.l slvplgn_00		;
(2)   81/FFFFFFFFC0000078 : C000 00C8           		dc.l slvplgn_01		; Main drawing routine
(2)   82/FFFFFFFFC000007C : C000 0080           		dc.l slvplgn_02		; Resume from solid color
(2)   83/FFFFFFFFC0000080 :                     
(2)   84/FFFFFFFFC0000080 :                     ; --------------------------------
(2)   85/FFFFFFFFC0000080 :                     ; Task $02
(2)   86/FFFFFFFFC0000080 :                     ; --------------------------------
(2)   87/FFFFFFFFC0000080 :                     
(2)   88/FFFFFFFFC0000080 :                     ; NOTE: It only resumes from solid_color
(2)   89/FFFFFFFFC0000080 :                     
(2)   90/FFFFFFFFC0000080 :                     slvplgn_02:
(2)   91/FFFFFFFFC0000080 : 2F26                		mov	r2,@-r15
(2)   92/FFFFFFFFC0000082 : 2F36                		mov	r3,@-r15
(2)   93/FFFFFFFFC0000084 : 2F46                		mov	r4,@-r15
(2)   94/FFFFFFFFC0000086 : 2F56                		mov	r5,@-r15
(2)   95/FFFFFFFFC0000088 : 2F66                		mov	r6,@-r15
(2)   96/FFFFFFFFC000008A : 2F76                		mov	r7,@-r15
(2)   97/FFFFFFFFC000008C : 2F86                		mov	r8,@-r15
(2)   98/FFFFFFFFC000008E : 2F96                		mov	r9,@-r15
(2)   99/FFFFFFFFC0000090 : 2FA6                		mov	r10,@-r15
(2)  100/FFFFFFFFC0000092 : 2FB6                		mov	r11,@-r15
(2)  101/FFFFFFFFC0000094 : 2FC6                		mov	r12,@-r15
(2)  102/FFFFFFFFC0000096 : 2FD6                		mov	r13,@-r15
(2)  103/FFFFFFFFC0000098 : 2FE6                		mov	r14,@-r15
(2)  104/FFFFFFFFC000009A : 4F12                		sts	macl,@-r15
(2)  105/FFFFFFFFC000009C : 4F02                		sts	mach,@-r15
(2)  106/FFFFFFFFC000009E : D029                		mov	#Cach_LnDrw_L,r0
(2)  107/FFFFFFFFC00000A0 : 6E06                		mov	@r0+,r14
(2)  108/FFFFFFFFC00000A2 : 6D06                		mov	@r0+,r13
(2)  109/FFFFFFFFC00000A4 : 6C06                		mov	@r0+,r12
(2)  110/FFFFFFFFC00000A6 : 6B06                		mov	@r0+,r11
(2)  111/FFFFFFFFC00000A8 : 6A06                		mov	@r0+,r10
(2)  112/FFFFFFFFC00000AA : 6906                		mov	@r0+,r9
(2)  113/FFFFFFFFC00000AC : 6806                		mov	@r0+,r8
(2)  114/FFFFFFFFC00000AE : 6706                		mov	@r0+,r7
(2)  115/FFFFFFFFC00000B0 : 6606                		mov	@r0+,r6
(2)  116/FFFFFFFFC00000B2 : 6506                		mov	@r0+,r5
(2)  117/FFFFFFFFC00000B4 : 6406                		mov	@r0+,r4
(2)  118/FFFFFFFFC00000B6 : 6306                		mov	@r0+,r3
(2)  119/FFFFFFFFC00000B8 : 6206                		mov	@r0+,r2
(2)  120/FFFFFFFFC00000BA : 6106                		mov	@r0+,r1
(2)  121/FFFFFFFFC00000BC : E001                		mov	#1,r0
(2)  122/FFFFFFFFC00000BE : C108                		mov.w	r0,@(marsGbl_WdgMode,gbr)
(2)  123/FFFFFFFFC00000C0 : A152                		bra	drwsld_updline
(2)  124/FFFFFFFFC00000C2 : 0009                		nop
(2)  125/FFFFFFFFC00000C4 : A177                .exit:		bra	drwtask_exit
(2)  126/FFFFFFFFC00000C6 : E210                		mov	#$10,r2
(2)  127/FFFFFFFFC00000C8 :                     		align 4
(2)  128/FFFFFFFFC00000C8 :                     
(2)  129/FFFFFFFFC00000C8 :                     ; --------------------------------
(2)  130/FFFFFFFFC00000C8 :                     ; Task $01
(2)  131/FFFFFFFFC00000C8 :                     ; --------------------------------
(2)  132/FFFFFFFFC00000C8 :                     
(2)  133/FFFFFFFFC00000C8 :                     slvplgn_01:
(2)  134/FFFFFFFFC00000C8 : 2F26                		mov	r2,@-r15
(2)  135/FFFFFFFFC00000CA : C50D                		mov.w	@(marsGbl_PlyPzCntr,gbr),r0	; Any pieces to draw?
(2)  136/FFFFFFFFC00000CC : 4015                		cmp/pl	r0
(2)  137/FFFFFFFFC00000CE : 8906                		bt	.has_pz
(2)  138/FFFFFFFFC00000D0 : C50A                		mov.w	@(marsGbl_WdgReady,gbr),r0
(2)  139/FFFFFFFFC00000D2 : 2008                		tst	r0,r0
(2)  140/FFFFFFFFC00000D4 : 8901                		bt	.exit
(2)  141/FFFFFFFFC00000D6 : E000                		mov	#0,r0
(2)  142/FFFFFFFFC00000D8 : C108                		mov.w	r0,@(marsGbl_WdgMode,gbr)
(2)  143/FFFFFFFFC00000DA : A16C                .exit:		bra	drwtask_exit
(2)  144/FFFFFFFFC00000DC : E210                		mov	#$10,r2
(2)  145/FFFFFFFFC00000DE :                     .has_pz:
(2)  146/FFFFFFFFC00000DE : 2F36                		mov	r3,@-r15			; Save all these regs
(2)  147/FFFFFFFFC00000E0 : 2F46                		mov	r4,@-r15
(2)  148/FFFFFFFFC00000E2 : 2F56                		mov	r5,@-r15
(2)  149/FFFFFFFFC00000E4 : 2F66                		mov	r6,@-r15
(2)  150/FFFFFFFFC00000E6 : 2F76                		mov	r7,@-r15
(2)  151/FFFFFFFFC00000E8 : 2F86                		mov	r8,@-r15
(2)  152/FFFFFFFFC00000EA : 2F96                		mov	r9,@-r15
(2)  153/FFFFFFFFC00000EC : 2FA6                		mov	r10,@-r15
(2)  154/FFFFFFFFC00000EE : 2FB6                		mov	r11,@-r15
(2)  155/FFFFFFFFC00000F0 : 2FC6                		mov	r12,@-r15
(2)  156/FFFFFFFFC00000F2 : 2FD6                		mov	r13,@-r15
(2)  157/FFFFFFFFC00000F4 : 2FE6                		mov	r14,@-r15
(2)  158/FFFFFFFFC00000F6 : 4F12                		sts	macl,@-r15
(2)  159/FFFFFFFFC00000F8 : 4F02                		sts	mach,@-r15
(2)  160/FFFFFFFFC00000FA :                     drwtsk1_newpz:
(2)  161/FFFFFFFFC00000FA : C600                		mov	@(marsGbl_PlyPzList_R,gbr),r0
(2)  162/FFFFFFFFC00000FC : 6E03                		mov	r0,r14
(2)  163/FFFFFFFFC00000FE :                     ; 		mov	@(marsGbl_PlyPzList_W,gbr),r0
(2)  164/FFFFFFFFC00000FE :                     ; 		cmp/eq	r0,r14
(2)  165/FFFFFFFFC00000FE :                     ; 		bt	g_return
(2)  166/FFFFFFFFC00000FE : 59E2                		mov	@(plypz_ytb,r14),r9	; Start grabbing StartY/EndY positions
(2)  167/FFFFFFFFC0000100 : 6A9F                		exts.w	r9,r10			; r10 - Bottom
(2)  168/FFFFFFFFC0000102 : 4929                		shlr16	r9
(2)  169/FFFFFFFFC0000104 : 699F                		exts.w	r9,r9			;  r9 - Top
(2)  170/FFFFFFFFC0000106 : 3A90                		cmp/eq	r9,r10			; if Top==Bottom, exit
(2)  171/FFFFFFFFC0000108 : 8908                		bt	.invld_y
(2)  172/FFFFFFFFC000010A : 901D                		mov	#SCREEN_HEIGHT,r0	; if Top > 224, skip
(2)  173/FFFFFFFFC000010C : 3903                		cmp/ge	r0,r9
(2)  174/FFFFFFFFC000010E : 8905                		bt	.invld_y		; if Bottom > 224, add max limit
(2)  175/FFFFFFFFC0000110 : 3A07                		cmp/gt	r0,r10
(2)  176/FFFFFFFFC0000112 : 8B00                		bf	.len_max
(2)  177/FFFFFFFFC0000114 : 6A03                		mov	r0,r10
(2)  178/FFFFFFFFC0000116 :                     .len_max:
(2)  179/FFFFFFFFC0000116 : 3A98                		sub	r9,r10			; Turn r10 into line lenght (Bottom - Top)
(2)  180/FFFFFFFFC0000118 : 4A15                		cmp/pl	r10
(2)  181/FFFFFFFFC000011A : 8903                		bt	.valid_y
(2)  182/FFFFFFFFC000011C :                     .invld_y:
(2)  183/FFFFFFFFC000011C : A129                		bra	drwsld_nextpz		; if LEN < 0 then check next one instead.
(2)  184/FFFFFFFFC000011E : 0009                		nop
(2)  185/FFFFFFFFC0000120 :                     		align 4
(2)  186/FFFFFFFFC0000120 :                     .no_pz:
(2)  187/FFFFFFFFC0000120 : A149                		bra	drwtask_exit
(2)  188/FFFFFFFFC0000122 : 0009                		nop
(2)  189/FFFFFFFFC0000124 :                     		align 4
(2)  190/FFFFFFFFC0000124 :                     .valid_y:
(2)  191/FFFFFFFFC0000124 : 51E3                		mov	@(plypz_xl,r14),r1
(2)  192/FFFFFFFFC0000126 : 6313                		mov	r1,r3
(2)  193/FFFFFFFFC0000128 : 52E6                		mov	@(plypz_xl_dx,r14),r2		; r2 - DX left
(2)  194/FFFFFFFFC000012A : 4129                		shlr16	r1
(2)  195/FFFFFFFFC000012C : 54E7                		mov	@(plypz_xr_dx,r14),r4		; r4 - DX right
(2)  196/FFFFFFFFC000012E : 4128                		shll16	r1
(2)  197/FFFFFFFFC0000130 : 50E0                		mov	@(plypz_type,r14),r0		; Check material options
(2)  198/FFFFFFFFC0000132 : 4328                		shll16	r3
(2)  199/FFFFFFFFC0000134 : 4029                		shlr16	r0
(2)  200/FFFFFFFFC0000136 : 4019                		shlr8	r0
(2)  201/FFFFFFFFC0000138 : C880                 		tst	#PLGN_TEXURE,r0			; Texture mode?
(2)  202/FFFFFFFFC000013A : 8B0D                 		bf	drwtsk_texmode
(2)  203/FFFFFFFFC000013C : A0BA                		bra	drwtsk_solidmode
(2)  204/FFFFFFFFC000013E : 0009                		nop
(2)  205/FFFFFFFFC0000140 :                     		align 4
(2)  206/FFFFFFFFC0000140 : C000 0074 C000 0740 		ltorg
                    00E0                
(2)  207/FFFFFFFFC000014A :                     g_return:
(2)  208/FFFFFFFFC000014A : A126                		bra	drwtask_return
(2)  209/FFFFFFFFC000014C : 0009                		nop
(2)  210/FFFFFFFFC000014E :                     		align 4
(2)  211/FFFFFFFFC0000150 :                     
(2)  212/FFFFFFFFC0000150 :                     ; ------------------------------------
(2)  213/FFFFFFFFC0000150 :                     ; Texture mode
(2)  214/FFFFFFFFC0000150 :                     ;
(2)  215/FFFFFFFFC0000150 :                     ; r1  - XL
(2)  216/FFFFFFFFC0000150 :                     ; r2  - XL DX
(2)  217/FFFFFFFFC0000150 :                     ; r3  - XR
(2)  218/FFFFFFFFC0000150 :                     ; r4  - XR DX
(2)  219/FFFFFFFFC0000150 :                     ; r5  - SRC XL
(2)  220/FFFFFFFFC0000150 :                     ; r6  - SRC XR
(2)  221/FFFFFFFFC0000150 :                     ; r7  - SRC YL
(2)  222/FFFFFFFFC0000150 :                     ; r8  - SRC YR
(2)  223/FFFFFFFFC0000150 :                     ; r9  - Y current
(2)  224/FFFFFFFFC0000150 :                     ; r10  - Number of lines
(2)  225/FFFFFFFFC0000150 :                     ; ------------------------------------
(2)  226/FFFFFFFFC0000150 :                     
(2)  227/FFFFFFFFC0000150 :                     		align 4
(2)  228/FFFFFFFFC0000150 :                     go_drwsld_updline_tex:
(2)  229/FFFFFFFFC0000150 : A099                		bra	drwsld_updline_tex
(2)  230/FFFFFFFFC0000152 : 0009                		nop
(2)  231/FFFFFFFFC0000154 :                     go_drwtex_gonxtpz:
(2)  232/FFFFFFFFC0000154 : A10D                		bra	drwsld_nextpz
(2)  233/FFFFFFFFC0000156 : 0009                		nop
(2)  234/FFFFFFFFC0000158 :                     		align 4
(2)  235/FFFFFFFFC0000158 :                     drwtsk_texmode:
(2)  236/FFFFFFFFC0000158 : C50B                		mov.w	@(marsGbl_WdgDivLock,gbr),r0	; Waste interrupt if MarsVideo_MakePolygon is in the
(2)  237/FFFFFFFFC000015A : 8801                		cmp/eq	#1,r0				; middle of HW-division
(2)  238/FFFFFFFFC000015C : 8B02                		bf	.texvalid
(2)  239/FFFFFFFFC000015E : A11C                		bra	drwtask_return
(2)  240/FFFFFFFFC0000160 : 0009                		nop
(2)  241/FFFFFFFFC0000162 :                     		align 4
(2)  242/FFFFFFFFC0000164 :                     .texvalid:
(2)  243/FFFFFFFFC0000164 : 55E4                		mov	@(plypz_src_xl,r14),r5		; Texture X left/right
(2)  244/FFFFFFFFC0000166 : 6653                		mov	r5,r6
(2)  245/FFFFFFFFC0000168 : 57E5                		mov	@(plypz_src_yl,r14),r7		; Texture Y up/down
(2)  246/FFFFFFFFC000016A : 4529                		shlr16	r5
(2)  247/FFFFFFFFC000016C : 6873                		mov	r7,r8
(2)  248/FFFFFFFFC000016E : 4729                		shlr16	r7
(2)  249/FFFFFFFFC0000170 :                     
(2)  250/FFFFFFFFC0000170 : 4528                		shll16	r5
(2)  251/FFFFFFFFC0000172 : 4628                		shll16	r6
(2)  252/FFFFFFFFC0000174 : 4728                		shll16	r7
(2)  253/FFFFFFFFC0000176 : 4828                		shll16	r8
(2)  254/FFFFFFFFC0000178 :                     drwsld_nxtline_tex:
(2)  255/FFFFFFFFC0000178 : 4911                		cmp/pz	r9				; Y Start below 0?
(2)  256/FFFFFFFFC000017A : 8BE9                		bf	go_drwsld_updline_tex
(2)  257/FFFFFFFFC000017C : D04C                		mov	tag_yhght,r0			; Y Start after 224?
(2)  258/FFFFFFFFC000017E : 3903                		cmp/ge	r0,r9
(2)  259/FFFFFFFFC0000180 : 89E8                		bt	go_drwtex_gonxtpz
(2)  260/FFFFFFFFC0000182 :                     
(2)  261/FFFFFFFFC0000182 : D092                		mov	#Cach_Bkup_S,r0
(2)  262/FFFFFFFFC0000184 : 2016                		mov	r1,@-r0
(2)  263/FFFFFFFFC0000186 : 2026                		mov	r2,@-r0
(2)  264/FFFFFFFFC0000188 : 2036                		mov	r3,@-r0
(2)  265/FFFFFFFFC000018A : 2046                		mov	r4,@-r0
(2)  266/FFFFFFFFC000018C : 2056                		mov	r5,@-r0
(2)  267/FFFFFFFFC000018E : 2066                		mov	r6,@-r0
(2)  268/FFFFFFFFC0000190 : 2076                		mov	r7,@-r0
(2)  269/FFFFFFFFC0000192 : 2086                		mov	r8,@-r0
(2)  270/FFFFFFFFC0000194 : 2096                		mov	r9,@-r0
(2)  271/FFFFFFFFC0000196 : 20A6                		mov	r10,@-r0
(2)  272/FFFFFFFFC0000198 : 20B6                		mov	r11,@-r0
(2)  273/FFFFFFFFC000019A :                     
(2)  274/FFFFFFFFC000019A :                     	; NOTE: r11-r12 are free
(2)  275/FFFFFFFFC000019A : 4129                		shlr16	r1
(2)  276/FFFFFFFFC000019C : 4329                		shlr16	r3
(2)  277/FFFFFFFFC000019E : 611F                		exts	r1,r1
(2)  278/FFFFFFFFC00001A0 : 633F                		exts	r3,r3
(2)  279/FFFFFFFFC00001A2 : 6033                		mov	r3,r0			; r0: X Right - X Left
(2)  280/FFFFFFFFC00001A4 : 3018                		sub	r1,r0
(2)  281/FFFFFFFFC00001A6 : 4015                		cmp/pl	r0			; Line reversed?
(2)  282/FFFFFFFFC00001A8 : 8908                		bt	.txrevers
(2)  283/FFFFFFFFC00001AA : 6033                		mov	r3,r0			; Swap XL and XR values
(2)  284/FFFFFFFFC00001AC : 6313                		mov	r1,r3
(2)  285/FFFFFFFFC00001AE : 6103                		mov	r0,r1
(2)  286/FFFFFFFFC00001B0 : 6053                		mov	r5,r0
(2)  287/FFFFFFFFC00001B2 : 6563                		mov	r6,r5
(2)  288/FFFFFFFFC00001B4 : 6603                		mov	r0,r6
(2)  289/FFFFFFFFC00001B6 : 6073                		mov	r7,r0
(2)  290/FFFFFFFFC00001B8 : 6783                		mov	r8,r7
(2)  291/FFFFFFFFC00001BA : 6803                		mov	r0,r8
(2)  292/FFFFFFFFC00001BC :                     .txrevers:
(2)  293/FFFFFFFFC00001BC : 3310                		cmp/eq	r1,r3				; Same X position?
(2)  294/FFFFFFFFC00001BE : 8955                		bt	.tex_skip_line
(2)  295/FFFFFFFFC00001C0 : D03A                		mov	tag_width,r0			; X right < 0?
(2)  296/FFFFFFFFC00001C2 : 4311                		cmp/pz	r3
(2)  297/FFFFFFFFC00001C4 : 8B52                		bf	.tex_skip_line
(2)  298/FFFFFFFFC00001C6 : 3107                		cmp/gt	r0,r1				; X left > 320?
(2)  299/FFFFFFFFC00001C8 : 8950                		bt	.tex_skip_line
(2)  300/FFFFFFFFC00001CA : 6233                		mov	r3,r2
(2)  301/FFFFFFFFC00001CC : 6013                		mov 	r1,r0
(2)  302/FFFFFFFFC00001CE : 3208                		sub 	r0,r2
(2)  303/FFFFFFFFC00001D0 : 3658                		sub	r5,r6
(2)  304/FFFFFFFFC00001D2 : 3878                		sub	r7,r8
(2)  305/FFFFFFFFC00001D4 :                     
(2)  306/FFFFFFFFC00001D4 :                     	; Calculate new DX values
(2)  307/FFFFFFFFC00001D4 :                     	; make sure DIV is not in use
(2)  308/FFFFFFFFC00001D4 :                     	; before getting here.
(2)  309/FFFFFFFFC00001D4 :                     	; (set marsGbl_WdgDivLock to 1)
(2)  310/FFFFFFFFC00001D4 : D034                		mov	tag_JR,r0			; r6 / r2
(2)  311/FFFFFFFFC00001D6 : 2022                		mov	r2,@r0
(2)  312/FFFFFFFFC00001D8 : 1061                		mov	r6,@(4,r0)
(2)  313/FFFFFFFFC00001DA : 0009                		nop
(2)  314/FFFFFFFFC00001DC : 5601                		mov	@(4,r0),r6			; r8 / r2
(2)  315/FFFFFFFFC00001DE : 2022                		mov	r2,@r0
(2)  316/FFFFFFFFC00001E0 : 1081                		mov	r8,@(4,r0)
(2)  317/FFFFFFFFC00001E2 : 0009                		nop
(2)  318/FFFFFFFFC00001E4 : 5801                		mov	@(4,r0),r8
(2)  319/FFFFFFFFC00001E6 :                     
(2)  320/FFFFFFFFC00001E6 :                     	; Limit X destination points
(2)  321/FFFFFFFFC00001E6 :                     	; and correct the texture's X positions
(2)  322/FFFFFFFFC00001E6 : D031                		mov	tag_width,r0		; XR point > 320?
(2)  323/FFFFFFFFC00001E8 : 3307                		cmp/gt	r0,r3
(2)  324/FFFFFFFFC00001EA : 8B00                		bf	.tr_fix
(2)  325/FFFFFFFFC00001EC : 6303                		mov	r0,r3				; Force XR to 320
(2)  326/FFFFFFFFC00001EE :                     .tr_fix:
(2)  327/FFFFFFFFC00001EE : 4111                		cmp/pz	r1				; XL point < 0?
(2)  328/FFFFFFFFC00001F0 : 8907                		bt	.tl_fix
(2)  329/FFFFFFFFC00001F2 : 621B                		neg	r1,r2				; Fix texture positions
(2)  330/FFFFFFFFC00001F4 : 326D                		dmuls	r6,r2
(2)  331/FFFFFFFFC00001F6 : 001A                		sts	macl,r0
(2)  332/FFFFFFFFC00001F8 : 350C                		add	r0,r5
(2)  333/FFFFFFFFC00001FA : 328D                		dmuls	r8,r2
(2)  334/FFFFFFFFC00001FC : 001A                		sts	macl,r0
(2)  335/FFFFFFFFC00001FE : 370C                		add	r0,r7
(2)  336/FFFFFFFFC0000200 : 211A                		xor	r1,r1				; And reset XL to 0
(2)  337/FFFFFFFFC0000202 :                     .tl_fix:
(2)  338/FFFFFFFFC0000202 :                     
(2)  339/FFFFFFFFC0000202 :                     	; start
(2)  340/FFFFFFFFC0000202 : E0FE                		mov	#-2,r0
(2)  341/FFFFFFFFC0000204 : 2109                		and	r0,r1
(2)  342/FFFFFFFFC0000206 : 7301                		add	#1,r3			; XR add
(2)  343/FFFFFFFFC0000208 : 2309                		and	r0,r3
(2)  344/FFFFFFFFC000020A : 3318                		sub 	r1,r3
(2)  345/FFFFFFFFC000020C : 4321                		shar	r3
(2)  346/FFFFFFFFC000020E : 4315                		cmp/pl	r3
(2)  347/FFFFFFFFC0000210 : 8B2C                		bf	.tex_skip_line
(2)  348/FFFFFFFFC0000212 : DA6F                		mov	#_overwrite+$200,r10
(2)  349/FFFFFFFFC0000214 : 54E0                		mov	@(plypz_type,r14),r4	;  r4 - texture width|palinc
(2)  350/FFFFFFFFC0000216 : 6D43                		mov	r4,r13
(2)  351/FFFFFFFFC0000218 : 4429                		shlr16	r4
(2)  352/FFFFFFFFC000021A : 6DDC                		extu.b	r13,r13
(2)  353/FFFFFFFFC000021C :                     ; 		mov	#$FF,r0
(2)  354/FFFFFFFFC000021C : 92E0                		mov	#$3FFF,r2
(2)  355/FFFFFFFFC000021E : 2429                		and	r2,r4
(2)  356/FFFFFFFFC0000220 :                     ; 		and	r0,r13
(2)  357/FFFFFFFFC0000220 : 6093                		mov 	r9,r0			; Y position * $200
(2)  358/FFFFFFFFC0000222 : 4018                		shll8	r0
(2)  359/FFFFFFFFC0000224 : 4000                		shll	r0
(2)  360/FFFFFFFFC0000226 : 3A0C                		add 	r0,r10			; Add Y
(2)  361/FFFFFFFFC0000228 : 3A1C                		add 	r1,r10			; Add X
(2)  362/FFFFFFFFC000022A : 51E1                		mov	@(plypz_mtrl,r14),r1
(2)  363/FFFFFFFFC000022C :                     .tex_xloop:
(2)  364/FFFFFFFFC000022C : 6273                		mov	r7,r2
(2)  365/FFFFFFFFC000022E : 4229                		shlr16	r2
(2)  366/FFFFFFFFC0000230 : 242E                		mulu	r2,r4
(2)  367/FFFFFFFFC0000232 : 6253                		mov	r5,r2	   		; Build column index
(2)  368/FFFFFFFFC0000234 : 001A                		sts	macl,r0
(2)  369/FFFFFFFFC0000236 : 4229                		shlr16	r2
(2)  370/FFFFFFFFC0000238 : 302C                		add	r2,r0
(2)  371/FFFFFFFFC000023A : 001C                		mov.b	@(r0,r1),r0		; Read left pixel
(2)  372/FFFFFFFFC000023C : 30DC                		add	r13,r0			; color-index increment
(2)  373/FFFFFFFFC000023E : 600C                		extu.b	r0,r0
(2)  374/FFFFFFFFC0000240 :                     ; 		and	#$FF,r0
(2)  375/FFFFFFFFC0000240 : 4018                		shll8	r0
(2)  376/FFFFFFFFC0000242 : 400A                		lds	r0,mach			; Save left pixel
(2)  377/FFFFFFFFC0000244 :                     
(2)  378/FFFFFFFFC0000244 : 356C                		add	r6,r5			; Update X
(2)  379/FFFFFFFFC0000246 : 378C                		add	r8,r7			; Update Y
(2)  380/FFFFFFFFC0000248 : 6273                		mov	r7,r2
(2)  381/FFFFFFFFC000024A : 4229                		shlr16	r2
(2)  382/FFFFFFFFC000024C : 242E                		mulu	r2,r4
(2)  383/FFFFFFFFC000024E : 6253                		mov	r5,r2	   		; Build column index
(2)  384/FFFFFFFFC0000250 : 001A                		sts	macl,r0
(2)  385/FFFFFFFFC0000252 : 4229                		shlr16	r2
(2)  386/FFFFFFFFC0000254 : 302C                		add	r2,r0
(2)  387/FFFFFFFFC0000256 : 001C                		mov.b	@(r0,r1),r0		; Read right pixel
(2)  388/FFFFFFFFC0000258 : 30DC                		add	r13,r0			; color-index increment
(2)  389/FFFFFFFFC000025A : 600C                		extu.b	r0,r0
(2)  390/FFFFFFFFC000025C :                     ; 		and	#$FF,r0
(2)  391/FFFFFFFFC000025C :                     
(2)  392/FFFFFFFFC000025C : 020A                		sts	mach,r2
(2)  393/FFFFFFFFC000025E : 202B                		or	r2,r0
(2)  394/FFFFFFFFC0000260 : 2A01                		mov.w	r0,@r10
(2)  395/FFFFFFFFC0000262 : 7A02                		add	#2,r10
(2)  396/FFFFFFFFC0000264 : 356C                		add	r6,r5			; Update X
(2)  397/FFFFFFFFC0000266 : 4310                		dt	r3
(2)  398/FFFFFFFFC0000268 : 8FE0                		bf/s	.tex_xloop
(2)  399/FFFFFFFFC000026A : 378C                		add	r8,r7			; Update Y
(2)  400/FFFFFFFFC000026C :                     .tex_skip_line:
(2)  401/FFFFFFFFC000026C : D059                		mov	#Cach_Bkup_LB,r0
(2)  402/FFFFFFFFC000026E : 6B06                		mov	@r0+,r11
(2)  403/FFFFFFFFC0000270 : 6A06                		mov	@r0+,r10
(2)  404/FFFFFFFFC0000272 : 6906                		mov	@r0+,r9
(2)  405/FFFFFFFFC0000274 : 6806                		mov	@r0+,r8
(2)  406/FFFFFFFFC0000276 : 6706                		mov	@r0+,r7
(2)  407/FFFFFFFFC0000278 : 6606                		mov	@r0+,r6
(2)  408/FFFFFFFFC000027A : 6506                		mov	@r0+,r5
(2)  409/FFFFFFFFC000027C : 6406                		mov	@r0+,r4
(2)  410/FFFFFFFFC000027E : 6306                		mov	@r0+,r3
(2)  411/FFFFFFFFC0000280 : 6206                		mov	@r0+,r2
(2)  412/FFFFFFFFC0000282 : 6106                		mov	@r0+,r1
(2)  413/FFFFFFFFC0000284 : 0009                		nop
(2)  414/FFFFFFFFC0000286 :                     drwsld_updline_tex:
(2)  415/FFFFFFFFC0000286 : 50E8                		mov	@(plypz_src_xl_dx,r14),r0	; Update DX postions
(2)  416/FFFFFFFFC0000288 : 350C                		add	r0,r5
(2)  417/FFFFFFFFC000028A : 50E9                		mov	@(plypz_src_xr_dx,r14),r0
(2)  418/FFFFFFFFC000028C : 360C                		add	r0,r6
(2)  419/FFFFFFFFC000028E : 50EA                		mov	@(plypz_src_yl_dx,r14),r0
(2)  420/FFFFFFFFC0000290 : 370C                		add	r0,r7
(2)  421/FFFFFFFFC0000292 : 50EB                		mov	@(plypz_src_yr_dx,r14),r0
(2)  422/FFFFFFFFC0000294 : 380C                		add	r0,r8
(2)  423/FFFFFFFFC0000296 : 312C                		add	r2,r1				; Update X postions
(2)  424/FFFFFFFFC0000298 : 4A10                		dt	r10
(2)  425/FFFFFFFFC000029A : 8D02                		bt/s	drwtex_nextpz
(2)  426/FFFFFFFFC000029C : 334C                		add	r4,r3
(2)  427/FFFFFFFFC000029E : AF6B                		bra	drwsld_nxtline_tex
(2)  428/FFFFFFFFC00002A0 : 7901                		add	#1,r9
(2)  429/FFFFFFFFC00002A2 :                     drwtex_nextpz:
(2)  430/FFFFFFFFC00002A2 : A066                		bra	drwsld_nextpz
(2)  431/FFFFFFFFC00002A4 : 0009                		nop
(2)  432/FFFFFFFFC00002A6 :                     		align 4
(2)  433/FFFFFFFFC00002A8 : FFFF FF00           tag_JR:		dc.l _JR
(2)  434/FFFFFFFFC00002AC : 0000 0140           tag_width:	dc.l	SCREEN_WIDTH
(2)  435/FFFFFFFFC00002B0 : 0000 00E0           tag_yhght:	dc.l	SCREEN_HEIGHT
(2)  436/FFFFFFFFC00002B4 :                     
(2)  437/FFFFFFFFC00002B4 :                     ; ------------------------------------
(2)  438/FFFFFFFFC00002B4 :                     ; Solid Color
(2)  439/FFFFFFFFC00002B4 :                     ;
(2)  440/FFFFFFFFC00002B4 :                     ; r1  - XL
(2)  441/FFFFFFFFC00002B4 :                     ; r2  - XL DX
(2)  442/FFFFFFFFC00002B4 :                     ; r3  - XR
(2)  443/FFFFFFFFC00002B4 :                     ; r4  - XR DX
(2)  444/FFFFFFFFC00002B4 :                     ; r9  - Y current
(2)  445/FFFFFFFFC00002B4 :                     ; r10  - Number of lines
(2)  446/FFFFFFFFC00002B4 :                     ; ------------------------------------
(2)  447/FFFFFFFFC00002B4 :                     
(2)  448/FFFFFFFFC00002B4 :                     drwtsk_solidmode:
(2)  449/FFFFFFFFC00002B4 :                     ; 		mov	#$FF,r0
(2)  450/FFFFFFFFC00002B4 : 56E1                		mov	@(plypz_mtrl,r14),r6
(2)  451/FFFFFFFFC00002B6 : 55E0                		mov	@(plypz_type,r14),r5
(2)  452/FFFFFFFFC00002B8 : 655C                		extu.b	r5,r5
(2)  453/FFFFFFFFC00002BA : 666C                		extu.b	r6,r6
(2)  454/FFFFFFFFC00002BC :                     ; 		and	r0,r5
(2)  455/FFFFFFFFC00002BC :                     ; 		and	r0,r6
(2)  456/FFFFFFFFC00002BC : 365C                		add	r5,r6
(2)  457/FFFFFFFFC00002BE : DD46                		mov	#_vdpreg,r13
(2)  458/FFFFFFFFC00002C0 : 85D5                .wait:		mov.w	@(10,r13),r0
(2)  459/FFFFFFFFC00002C2 : C802                		tst	#2,r0
(2)  460/FFFFFFFFC00002C4 : 8BFC                		bf	.wait
(2)  461/FFFFFFFFC00002C6 :                     drwsld_nxtline:
(2)  462/FFFFFFFFC00002C6 : 6093                		mov	r9,r0
(2)  463/FFFFFFFFC00002C8 : 30AC                		add	r10,r0
(2)  464/FFFFFFFFC00002CA : 4015                		cmp/pl	r0
(2)  465/FFFFFFFFC00002CC : 8B51                		bf	drwsld_nextpz
(2)  466/FFFFFFFFC00002CE : 4911                		cmp/pz	r9
(2)  467/FFFFFFFFC00002D0 : 8B4A                		bf	drwsld_updline
(2)  468/FFFFFFFFC00002D2 : 9086                		mov	#SCREEN_HEIGHT,r0
(2)  469/FFFFFFFFC00002D4 : 3907                		cmp/gt	r0,r9
(2)  470/FFFFFFFFC00002D6 : 894C                		bt	drwsld_nextpz
(2)  471/FFFFFFFFC00002D8 :                     
(2)  472/FFFFFFFFC00002D8 : 6B13                		mov	r1,r11
(2)  473/FFFFFFFFC00002DA : 6C33                		mov	r3,r12
(2)  474/FFFFFFFFC00002DC : 4B29                		shlr16	r11
(2)  475/FFFFFFFFC00002DE : 4C29                		shlr16	r12
(2)  476/FFFFFFFFC00002E0 : 6BBF                		exts.w	r11,r11
(2)  477/FFFFFFFFC00002E2 : 6CCF                		exts.w	r12,r12
(2)  478/FFFFFFFFC00002E4 : 60C3                		mov	r12,r0
(2)  479/FFFFFFFFC00002E6 : 30B8                		sub	r11,r0
(2)  480/FFFFFFFFC00002E8 : 4011                		cmp/pz	r0
(2)  481/FFFFFFFFC00002EA : 8902                		bt	.revers
(2)  482/FFFFFFFFC00002EC : 60C3                		mov	r12,r0
(2)  483/FFFFFFFFC00002EE : 6CB3                		mov	r11,r12
(2)  484/FFFFFFFFC00002F0 : 6B03                		mov	r0,r11
(2)  485/FFFFFFFFC00002F2 :                     .revers:
(2)  486/FFFFFFFFC00002F2 : 9077                		mov	#SCREEN_WIDTH-2,r0
(2)  487/FFFFFFFFC00002F4 : 4C15                		cmp/pl	r12
(2)  488/FFFFFFFFC00002F6 : 8B37                		bf	drwsld_updline
(2)  489/FFFFFFFFC00002F8 : 3B07                		cmp/gt	r0,r11
(2)  490/FFFFFFFFC00002FA : 8935                		bt	drwsld_updline
(2)  491/FFFFFFFFC00002FC : 3C07                		cmp/gt	r0,r12
(2)  492/FFFFFFFFC00002FE : 8B00                		bf	.r_fix
(2)  493/FFFFFFFFC0000300 : 6C03                		mov	r0,r12
(2)  494/FFFFFFFFC0000302 :                     .r_fix:
(2)  495/FFFFFFFFC0000302 : 4B15                		cmp/pl	r11
(2)  496/FFFFFFFFC0000304 : 8900                		bt	.l_fix
(2)  497/FFFFFFFFC0000306 : 2BBA                		xor	r11,r11
(2)  498/FFFFFFFFC0000308 :                     .l_fix:
(2)  499/FFFFFFFFC0000308 : E0FE                		mov	#-2,r0
(2)  500/FFFFFFFFC000030A : 2B09                		and	r0,r11
(2)  501/FFFFFFFFC000030C : 2C09                		and	r0,r12
(2)  502/FFFFFFFFC000030E : 60C3                		mov	r12,r0
(2)  503/FFFFFFFFC0000310 : 30B8                		sub	r11,r0
(2)  504/FFFFFFFFC0000312 : 4011                		cmp/pz	r0		; <-- TODO: cambiar a pl si freezea
(2)  505/FFFFFFFFC0000314 : 8B28                		bf	drwsld_updline
(2)  506/FFFFFFFFC0000316 :                     
(2)  507/FFFFFFFFC0000316 : 85D5                .wait:		mov.w	@(10,r13),r0
(2)  508/FFFFFFFFC0000318 : C802                		tst	#2,r0
(2)  509/FFFFFFFFC000031A : 8BFC                		bf	.wait
(2)  510/FFFFFFFFC000031C : 60C3                		mov	r12,r0
(2)  511/FFFFFFFFC000031E : 30B8                		sub	r11,r0
(2)  512/FFFFFFFFC0000320 : 6C03                		mov	r0,r12
(2)  513/FFFFFFFFC0000322 : 4001                		shlr	r0
(2)  514/FFFFFFFFC0000324 : 81D2                		mov.w	r0,@(4,r13)	; length
(2)  515/FFFFFFFFC0000326 : 60B3                		mov	r11,r0
(2)  516/FFFFFFFFC0000328 : 4001                		shlr	r0
(2)  517/FFFFFFFFC000032A : 6593                		mov	r9,r5
(2)  518/FFFFFFFFC000032C : 7501                		add	#1,r5
(2)  519/FFFFFFFFC000032E : 4518                		shll8	r5
(2)  520/FFFFFFFFC0000330 : 305C                		add	r5,r0
(2)  521/FFFFFFFFC0000332 : 81D3                		mov.w	r0,@(6,r13)	; address
(2)  522/FFFFFFFFC0000334 : 6063                		mov	r6,r0
(2)  523/FFFFFFFFC0000336 : 4018                		shll8	r0
(2)  524/FFFFFFFFC0000338 : 206B                		or	r6,r0
(2)  525/FFFFFFFFC000033A : 81D4                		mov.w	r0,@(8,r13)	; Set data
(2)  526/FFFFFFFFC000033C :                     ; .wait:	mov.w	@(10,r13),r0
(2)  527/FFFFFFFFC000033C :                     ; 		tst	#2,r0
(2)  528/FFFFFFFFC000033C :                     ; 		bf	.wait
(2)  529/FFFFFFFFC000033C :                     
(2)  530/FFFFFFFFC000033C :                     ; 	If the line is too large, leave it to VDP
(2)  531/FFFFFFFFC000033C :                     ; 	and exit watchdog, we will come back on
(2)  532/FFFFFFFFC000033C :                     ; 	next trigger.
(2)  533/FFFFFFFFC000033C : E028                		mov	#$28,r0
(2)  534/FFFFFFFFC000033E : 3C07                		cmp/gt	r0,r12
(2)  535/FFFFFFFFC0000340 : 8B12                		bf	drwsld_updline
(2)  536/FFFFFFFFC0000342 : E002                		mov	#2,r0
(2)  537/FFFFFFFFC0000344 : C108                		mov.w	r0,@(marsGbl_WdgMode,gbr)
(2)  538/FFFFFFFFC0000346 : D025                		mov	#Cach_LnDrw_S,r0
(2)  539/FFFFFFFFC0000348 : 2016                		mov	r1,@-r0
(2)  540/FFFFFFFFC000034A : 2026                		mov	r2,@-r0
(2)  541/FFFFFFFFC000034C : 2036                		mov	r3,@-r0
(2)  542/FFFFFFFFC000034E : 2046                		mov	r4,@-r0
(2)  543/FFFFFFFFC0000350 : 2056                		mov	r5,@-r0
(2)  544/FFFFFFFFC0000352 : 2066                		mov	r6,@-r0
(2)  545/FFFFFFFFC0000354 : 2076                		mov	r7,@-r0
(2)  546/FFFFFFFFC0000356 : 2086                		mov	r8,@-r0
(2)  547/FFFFFFFFC0000358 : 2096                		mov	r9,@-r0
(2)  548/FFFFFFFFC000035A : 20A6                		mov	r10,@-r0
(2)  549/FFFFFFFFC000035C : 20B6                		mov	r11,@-r0
(2)  550/FFFFFFFFC000035E : 20C6                		mov	r12,@-r0
(2)  551/FFFFFFFFC0000360 : 20D6                		mov	r13,@-r0
(2)  552/FFFFFFFFC0000362 : 20E6                		mov	r14,@-r0
(2)  553/FFFFFFFFC0000364 : A019                		bra	drwtask_return
(2)  554/FFFFFFFFC0000366 : E208                		mov	#$08,r2			; Exit and re-enter
(2)  555/FFFFFFFFC0000368 :                     drwsld_updline:
(2)  556/FFFFFFFFC0000368 : 312C                		add	r2,r1
(2)  557/FFFFFFFFC000036A : 334C                		add	r4,r3
(2)  558/FFFFFFFFC000036C : 4A10                		dt	r10
(2)  559/FFFFFFFFC000036E : 8FAA                		bf/s	drwsld_nxtline
(2)  560/FFFFFFFFC0000370 : 7901                		add	#1,r9
(2)  561/FFFFFFFFC0000372 :                     
(2)  562/FFFFFFFFC0000372 :                     ; ------------------------------------
(2)  563/FFFFFFFFC0000372 :                     
(2)  564/FFFFFFFFC0000372 :                     drwsld_nextpz:
(2)  565/FFFFFFFFC0000372 : 200A                		xor	r0,r0
(2)  566/FFFFFFFFC0000374 : 1E00                		mov	r0,@(plypz_type,r14)
(2)  567/FFFFFFFFC0000376 : C603                		mov	@(marsGbl_PlyPzList_End,gbr),r0
(2)  568/FFFFFFFFC0000378 : 7E30                		add	#sizeof_plypz,r14		; And set new point
(2)  569/FFFFFFFFC000037A : 3E03                		cmp/ge	r0,r14
(2)  570/FFFFFFFFC000037C : 8B01                		bf	.reset_rd
(2)  571/FFFFFFFFC000037E : C602                		mov	@(marsGbl_PlyPzList_Start,gbr),r0
(2)  572/FFFFFFFFC0000380 : 6E03                		mov	r0,r14
(2)  573/FFFFFFFFC0000382 :                     .reset_rd:
(2)  574/FFFFFFFFC0000382 : 60E3                		mov	r14,r0
(2)  575/FFFFFFFFC0000384 : C200                		mov	r0,@(marsGbl_PlyPzList_R,gbr)
(2)  576/FFFFFFFFC0000386 : C50D                		mov.w	@(marsGbl_PlyPzCntr,gbr),r0	; Decrement piece
(2)  577/FFFFFFFFC0000388 : 70FF                		add	#-1,r0
(2)  578/FFFFFFFFC000038A : C10D                		mov.w	r0,@(marsGbl_PlyPzCntr,gbr)
(2)  579/FFFFFFFFC000038C : A005                		bra	drwtask_return
(2)  580/FFFFFFFFC000038E : E220                		mov	#$20,r2			; Timer for next watchdog
(2)  581/FFFFFFFFC0000390 :                     
(2)  582/FFFFFFFFC0000390 :                     ; --------------------------------
(2)  583/FFFFFFFFC0000390 :                     ; Task $00
(2)  584/FFFFFFFFC0000390 :                     ; --------------------------------
(2)  585/FFFFFFFFC0000390 :                     
(2)  586/FFFFFFFFC0000390 :                     slvplgn_00:
(2)  587/FFFFFFFFC0000390 : 2F26                		mov	r2,@-r15
(2)  588/FFFFFFFFC0000392 : E000                		mov	#0,r0
(2)  589/FFFFFFFFC0000394 : C108                		mov.w	r0,@(marsGbl_WdgMode,gbr)
(2)  590/FFFFFFFFC0000396 : A00E                		bra	drwtask_exit
(2)  591/FFFFFFFFC0000398 : E210                		mov	#$10,r2
(2)  592/FFFFFFFFC000039A :                     
(2)  593/FFFFFFFFC000039A :                     drwtask_return:
(2)  594/FFFFFFFFC000039A : 4F06                		lds	@r15+,mach
(2)  595/FFFFFFFFC000039C : 4F16                		lds	@r15+,macl
(2)  596/FFFFFFFFC000039E : 6EF6                		mov	@r15+,r14
(2)  597/FFFFFFFFC00003A0 : 6DF6                		mov	@r15+,r13
(2)  598/FFFFFFFFC00003A2 : 6CF6                		mov	@r15+,r12
(2)  599/FFFFFFFFC00003A4 : 6BF6                		mov	@r15+,r11
(2)  600/FFFFFFFFC00003A6 : 6AF6                		mov	@r15+,r10
(2)  601/FFFFFFFFC00003A8 : 69F6                		mov	@r15+,r9
(2)  602/FFFFFFFFC00003AA : 68F6                		mov	@r15+,r8
(2)  603/FFFFFFFFC00003AC : 67F6                		mov	@r15+,r7
(2)  604/FFFFFFFFC00003AE : 66F6                		mov	@r15+,r6
(2)  605/FFFFFFFFC00003B0 : 65F6                		mov	@r15+,r5
(2)  606/FFFFFFFFC00003B2 : 64F6                		mov	@r15+,r4
(2)  607/FFFFFFFFC00003B4 : 63F6                		mov	@r15+,r3
(2)  608/FFFFFFFFC00003B6 :                     drwtask_exit:
(2)  609/FFFFFFFFC00003B6 : 9116                		mov.l   #$FFFFFE80,r1
(2)  610/FFFFFFFFC00003B8 : 9016                		mov.w   #$A518,r0	; OFF
(2)  611/FFFFFFFFC00003BA : 2101                		mov.w   r0,@r1
(2)  612/FFFFFFFFC00003BC : CB20                		or      #$20,r0		; ON
(2)  613/FFFFFFFFC00003BE : 2101                		mov.w   r0,@r1
(2)  614/FFFFFFFFC00003C0 : 9013                		mov.w   #$5A00,r0	; r2 - Timer
(2)  615/FFFFFFFFC00003C2 : 202B                		or	r2,r0
(2)  616/FFFFFFFFC00003C4 : 2101                		mov.w   r0,@r1
(2)  617/FFFFFFFFC00003C6 : 62F6                		mov	@r15+,r2
(2)  618/FFFFFFFFC00003C8 : 000B                		rts
(2)  619/FFFFFFFFC00003CA : 0009                		nop
(2)  620/FFFFFFFFC00003CC :                     		align 4
(2)  621/FFFFFFFFC00003CC : C000 07A4 2402 0200 		ltorg
                    C000 0778 2000 4100 
                    C000 0778 3FFF 00E0 
                    013E FE80 A518 5A00 
(2)  622/FFFFFFFFC00003EC :                     
(2)  623/FFFFFFFFC00003EC :                     ; ====================================================================
(2)  624/FFFFFFFFC00003EC :                     ; ----------------------------------------------------------------
(2)  625/FFFFFFFFC00003EC :                     ; 3D Rendering routines
(2)  626/FFFFFFFFC00003EC :                     ; ----------------------------------------------------------------
(2)  627/FFFFFFFFC00003EC :                     
(2)  628/FFFFFFFFC00003EC :                     ; ------------------------------------------------
(2)  629/FFFFFFFFC00003EC :                     ; MarsVideo_SlicePlgn
(2)  630/FFFFFFFFC00003EC :                     ;
(2)  631/FFFFFFFFC00003EC :                     ; This slices polygons into pieces.
(2)  632/FFFFFFFFC00003EC :                     ;
(2)  633/FFFFFFFFC00003EC :                     ; Input:
(2)  634/FFFFFFFFC00003EC :                     ; r14 | Polygon data
(2)  635/FFFFFFFFC00003EC :                     ; ------------------------------------------------
(2)  636/FFFFFFFFC00003EC :                     
(2)  637/FFFFFFFFC00003EC :                     		align 4
(2)  638/FFFFFFFFC00003EC :                     MarsVideo_SlicePlgn:
(2)  639/FFFFFFFFC00003EC : 4F22                		sts	pr,@-r15
(2)  640/FFFFFFFFC00003EE : DD38                		mov	#Cach_DDA_Last,r13		; r13 - DDA last point
(2)  641/FFFFFFFFC00003F0 : DC38                		mov	#Cach_DDA_Top,r12		; r12 - DDA first point
(2)  642/FFFFFFFFC00003F2 : 50E0                		mov	@(polygn_type,r14),r0		; Read type settings
(2)  643/FFFFFFFFC00003F4 : 4029                		shlr16	r0
(2)  644/FFFFFFFFC00003F6 : 4019                		shlr8	r0
(2)  645/FFFFFFFFC00003F8 : C840                		tst	#PLGN_TRI,r0			; PLGN_TRI set?
(2)  646/FFFFFFFFC00003FA : 8B00                		bf	.tringl
(2)  647/FFFFFFFFC00003FC : 7D08                		add	#8,r13				; If quad: add 8
(2)  648/FFFFFFFFC00003FE :                     .tringl:
(2)  649/FFFFFFFFC00003FE : 61E3                		mov	r14,r1
(2)  650/FFFFFFFFC0000400 : 62C3                		mov	r12,r2
(2)  651/FFFFFFFFC0000402 : D335                		mov	#Cach_DDA_Src,r3
(2)  652/FFFFFFFFC0000404 : 7108                		add	#polygn_points,r1
(2)  653/FFFFFFFFC0000406 :                     
(2)  654/FFFFFFFFC0000406 :                     	; ----------------------------------------
(2)  655/FFFFFFFFC0000406 :                     	; Polygon points
(2)  656/FFFFFFFFC0000406 :                     	; ----------------------------------------
(2)  657/FFFFFFFFC0000406 :                     
(2)  658/FFFFFFFFC0000406 :                     	; TODO: make these w/h halfs customizable
(2)  659/FFFFFFFFC0000406 : E804                		mov	#4,r8			; Copy polygon points Cache's DDA
(2)  660/FFFFFFFFC0000408 : 966E                		mov	#SCREEN_WIDTH/2,r6
(2)  661/FFFFFFFFC000040A : E770                		mov	#SCREEN_HEIGHT/2,r7
(2)  662/FFFFFFFFC000040C :                     .setpnts:
(2)  663/FFFFFFFFC000040C : 6416                		mov	@r1+,r4			; Get X
(2)  664/FFFFFFFFC000040E : 6516                		mov	@r1+,r5			; Get Y
(2)  665/FFFFFFFFC0000410 : 346C                		add	r6,r4			; X + width
(2)  666/FFFFFFFFC0000412 : 357C                		add	r7,r5			; Y + height
(2)  667/FFFFFFFFC0000414 : 2242                		mov	r4,@r2
(2)  668/FFFFFFFFC0000416 : 1251                		mov	r5,@(4,r2)
(2)  669/FFFFFFFFC0000418 : 4810                		dt	r8
(2)  670/FFFFFFFFC000041A : 8FF7                		bf/s	.setpnts
(2)  671/FFFFFFFFC000041C : 7208                		add	#8,r2
(2)  672/FFFFFFFFC000041E : E804                		mov	#4,r8			; Copy texture source points to Cache
(2)  673/FFFFFFFFC0000420 :                     .src_pnts:
(2)  674/FFFFFFFFC0000420 : 6415                		mov.w	@r1+,r4
(2)  675/FFFFFFFFC0000422 : 6515                		mov.w	@r1+,r5
(2)  676/FFFFFFFFC0000424 : 2342                		mov	r4,@r3
(2)  677/FFFFFFFFC0000426 : 1351                		mov	r5,@(4,r3)
(2)  678/FFFFFFFFC0000428 : 4810                		dt	r8
(2)  679/FFFFFFFFC000042A : 8FF9                		bf/s	.src_pnts
(2)  680/FFFFFFFFC000042C : 7308                		add	#8,r3
(2)  681/FFFFFFFFC000042E :                     
(2)  682/FFFFFFFFC000042E :                     	; Search for the lowest Y and highest Y
(2)  683/FFFFFFFFC000042E :                     	; r10 - Top Y
(2)  684/FFFFFFFFC000042E :                     	; r11 - Bottom Y
(2)  685/FFFFFFFFC000042E :                     .start_math:
(2)  686/FFFFFFFFC000042E : E903                		mov	#3,r9
(2)  687/FFFFFFFFC0000430 : C840                		tst	#PLGN_TRI,r0		; PLGN_TRI set?
(2)  688/FFFFFFFFC0000432 : 8B00                		bf	.ytringl
(2)  689/FFFFFFFFC0000434 : 7901                		add	#1,r9
(2)  690/FFFFFFFFC0000436 :                     .ytringl:
(2)  691/FFFFFFFFC0000436 : DA29                		mov	#$7FFFFFFF,r10
(2)  692/FFFFFFFFC0000438 : EBFF                		mov	#-1,r11			; $FFFFFFFF
(2)  693/FFFFFFFFC000043A : 67C3                		mov 	r12,r7
(2)  694/FFFFFFFFC000043C : 68C3                		mov	r12,r8
(2)  695/FFFFFFFFC000043E :                     .find_top:
(2)  696/FFFFFFFFC000043E : 5071                		mov	@(4,r7),r0
(2)  697/FFFFFFFFC0000440 : 30B7                		cmp/gt	r11,r0
(2)  698/FFFFFFFFC0000442 : 8B00                		bf	.is_low
(2)  699/FFFFFFFFC0000444 : 6B03                		mov 	r0,r11
(2)  700/FFFFFFFFC0000446 :                     .is_low:
(2)  701/FFFFFFFFC0000446 : 5081                		mov	@(4,r8),r0
(2)  702/FFFFFFFFC0000448 : 30A7                		cmp/gt	r10,r0
(2)  703/FFFFFFFFC000044A : 8901                		bt	.is_high
(2)  704/FFFFFFFFC000044C : 6A03                		mov 	r0,r10
(2)  705/FFFFFFFFC000044E : 6183                		mov	r8,r1
(2)  706/FFFFFFFFC0000450 :                     .is_high:
(2)  707/FFFFFFFFC0000450 : 7708                		add 	#8,r7
(2)  708/FFFFFFFFC0000452 : 4910                		dt	r9
(2)  709/FFFFFFFFC0000454 : 8FF3                		bf/s	.find_top
(2)  710/FFFFFFFFC0000456 : 7808                		add	#8,r8
(2)  711/FFFFFFFFC0000458 : 3AB3                		cmp/ge	r11,r10			; Top larger than Bottom?
(2)  712/FFFFFFFFC000045A : 8935                		bt	.exit
(2)  713/FFFFFFFFC000045C : 4B15                		cmp/pl	r11			; Bottom < 0?
(2)  714/FFFFFFFFC000045E : 8B33                		bf	.exit
(2)  715/FFFFFFFFC0000460 : 9043                		mov	#SCREEN_HEIGHT,r0	; Top > 224?
(2)  716/FFFFFFFFC0000462 : 3A03                		cmp/ge	r0,r10
(2)  717/FFFFFFFFC0000464 : 8930                		bt	.exit
(2)  718/FFFFFFFFC0000466 :                     
(2)  719/FFFFFFFFC0000466 :                     	; r2 - Left DDA READ pointer
(2)  720/FFFFFFFFC0000466 :                     	; r3 - Right DDA READ pointer
(2)  721/FFFFFFFFC0000466 :                     	; r4 - Left X
(2)  722/FFFFFFFFC0000466 :                     	; r5 - Left DX
(2)  723/FFFFFFFFC0000466 :                     	; r6 - Right X
(2)  724/FFFFFFFFC0000466 :                     	; r7 - Right DX
(2)  725/FFFFFFFFC0000466 :                     	; r8 - Left width
(2)  726/FFFFFFFFC0000466 :                     	; r9 - Right width
(2)  727/FFFFFFFFC0000466 :                     	; r10 - Top Y, gets updated after calling put_piece
(2)  728/FFFFFFFFC0000466 :                     	; r11 - Bottom Y
(2)  729/FFFFFFFFC0000466 :                     	; r12 - First DST point
(2)  730/FFFFFFFFC0000466 :                     	; r13 - Last DST point
(2)  731/FFFFFFFFC0000466 : 6213                		mov	r1,r2				; r2 - X left to process
(2)  732/FFFFFFFFC0000468 : 6313                		mov	r1,r3				; r3 - X right to process
(2)  733/FFFFFFFFC000046A : B03F                		bsr	set_left
(2)  734/FFFFFFFFC000046C : 0009                		nop
(2)  735/FFFFFFFFC000046E : B081                		bsr	set_right
(2)  736/FFFFFFFFC0000470 : 0009                		nop
(2)  737/FFFFFFFFC0000472 :                     .next_pz:
(2)  738/FFFFFFFFC0000472 : 903A                		mov	#SCREEN_HEIGHT,r0		; Current Y > 224?
(2)  739/FFFFFFFFC0000474 : 3A07                		cmp/gt	r0,r10
(2)  740/FFFFFFFFC0000476 : 8927                		bt	.exit
(2)  741/FFFFFFFFC0000478 : 3AB3                		cmp/ge	r11,r10				; Y top => Y bottom?
(2)  742/FFFFFFFFC000047A : 8925                		bt	.exit
(2)  743/FFFFFFFFC000047C :                     
(2)  744/FFFFFFFFC000047C : C601                		mov	@(marsGbl_PlyPzList_W,gbr),r0	; r1 - Current piece to WRITE
(2)  745/FFFFFFFFC000047E : 6103                		mov	r0,r1
(2)  746/FFFFFFFFC0000480 : 5821                		mov	@(4,r2),r8
(2)  747/FFFFFFFFC0000482 : 5931                		mov	@(4,r3),r9
(2)  748/FFFFFFFFC0000484 : 38A8                		sub	r10,r8
(2)  749/FFFFFFFFC0000486 : 39A8                		sub	r10,r9
(2)  750/FFFFFFFFC0000488 : 6083                		mov	r8,r0
(2)  751/FFFFFFFFC000048A : 3987                		cmp/gt	r8,r9
(2)  752/FFFFFFFFC000048C : 8900                		bt	.lefth
(2)  753/FFFFFFFFC000048E : 6093                		mov	r9,r0
(2)  754/FFFFFFFFC0000490 :                     .lefth:
(2)  755/FFFFFFFFC0000490 : D013                		mov	#Cach_Bkup_SPZ,r0
(2)  756/FFFFFFFFC0000492 : 2026                		mov	r2,@-r0
(2)  757/FFFFFFFFC0000494 : 2036                		mov	r3,@-r0
(2)  758/FFFFFFFFC0000496 : 2056                		mov	r5,@-r0
(2)  759/FFFFFFFFC0000498 : 2076                		mov	r7,@-r0
(2)  760/FFFFFFFFC000049A : 2086                		mov	r8,@-r0
(2)  761/FFFFFFFFC000049C : 2096                		mov	r9,@-r0
(2)  762/FFFFFFFFC000049E : 20B6                		mov	r11,@-r0
(2)  763/FFFFFFFFC00004A0 : B0AC                		bsr	put_piece
(2)  764/FFFFFFFFC00004A2 : 0009                		nop
(2)  765/FFFFFFFFC00004A4 : D00F                		mov	#Cach_Bkup_LPZ,r0
(2)  766/FFFFFFFFC00004A6 : 6B06                		mov	@r0+,r11
(2)  767/FFFFFFFFC00004A8 : 6906                		mov	@r0+,r9
(2)  768/FFFFFFFFC00004AA : 6806                		mov	@r0+,r8
(2)  769/FFFFFFFFC00004AC : 6706                		mov	@r0+,r7
(2)  770/FFFFFFFFC00004AE : 6506                		mov	@r0+,r5
(2)  771/FFFFFFFFC00004B0 : 6306                		mov	@r0+,r3
(2)  772/FFFFFFFFC00004B2 : 6206                		mov	@r0+,r2
(2)  773/FFFFFFFFC00004B4 :                     	; X direction update
(2)  774/FFFFFFFFC00004B4 : 3897                		cmp/gt	r9,r8				; Left width > Right width?
(2)  775/FFFFFFFFC00004B6 : 8B03                		bf	.lefth2
(2)  776/FFFFFFFFC00004B8 : B05C                		bsr	set_right
(2)  777/FFFFFFFFC00004BA : 0009                		nop
(2)  778/FFFFFFFFC00004BC : AFD9                		bra	.next_pz
(2)  779/FFFFFFFFC00004BE : 0009                		nop
(2)  780/FFFFFFFFC00004C0 :                     .lefth2:
(2)  781/FFFFFFFFC00004C0 : B014                		bsr	set_left
(2)  782/FFFFFFFFC00004C2 : 0009                		nop
(2)  783/FFFFFFFFC00004C4 : AFD5                		bra	.next_pz
(2)  784/FFFFFFFFC00004C6 : 0009                		nop
(2)  785/FFFFFFFFC00004C8 :                     .exit:
(2)  786/FFFFFFFFC00004C8 : 4F26                		lds	@r15+,pr
(2)  787/FFFFFFFFC00004CA : 000B                		rts
(2)  788/FFFFFFFFC00004CC : 0009                		nop
(2)  789/FFFFFFFFC00004CE :                     		align 4
(2)  790/FFFFFFFFC00004D0 : C000 06F0 C000 06E0 		ltorg
                    C000 0700 7FFF FFFF 
                    C000 07C0 C000 07A4 
                    00A0 00E0           
(2)  791/FFFFFFFFC00004EC :                     
(2)  792/FFFFFFFFC00004EC :                     		align 4
(2)  793/FFFFFFFFC00004EC :                     set_left:
(2)  794/FFFFFFFFC00004EC : 6823                		mov	r2,r8				; Get a copy of Xleft pointer
(2)  795/FFFFFFFFC00004EE : 7820                		add	#$20,r8				; To read Texture SRC points
(2)  796/FFFFFFFFC00004F0 : 6482                		mov	@r8,r4
(2)  797/FFFFFFFFC00004F2 : 5581                		mov	@(4,r8),r5
(2)  798/FFFFFFFFC00004F4 : D870                		mov	#Cach_DDA_Src_L,r8
(2)  799/FFFFFFFFC00004F6 : 6043                		mov	r4,r0
(2)  800/FFFFFFFFC00004F8 : 4028                		shll16	r0
(2)  801/FFFFFFFFC00004FA : 2802                		mov	r0,@r8
(2)  802/FFFFFFFFC00004FC : 6053                		mov	r5,r0
(2)  803/FFFFFFFFC00004FE : 4028                		shll16	r0
(2)  804/FFFFFFFFC0000500 : 1802                		mov	r0,@(8,r8)
(2)  805/FFFFFFFFC0000502 : 6122                		mov	@r2,r1
(2)  806/FFFFFFFFC0000504 : 5821                		mov	@(4,r2),r8
(2)  807/FFFFFFFFC0000506 : 7208                		add	#8,r2
(2)  808/FFFFFFFFC0000508 : 32D7                		cmp/gt	r13,r2
(2)  809/FFFFFFFFC000050A : 8B00                		bf	.lft_ok
(2)  810/FFFFFFFFC000050C : 62C3                		mov 	r12,r2
(2)  811/FFFFFFFFC000050E :                     .lft_ok:
(2)  812/FFFFFFFFC000050E : 5021                		mov	@(4,r2),r0
(2)  813/FFFFFFFFC0000510 : 3088                		sub	r8,r0
(2)  814/FFFFFFFFC0000512 : 8800                		cmp/eq	#0,r0
(2)  815/FFFFFFFFC0000514 : 89EA                		bt	set_left
(2)  816/FFFFFFFFC0000516 : 4011                		cmp/pz	r0
(2)  817/FFFFFFFFC0000518 : 8B29                		bf	.lft_skip
(2)  818/FFFFFFFFC000051A :                     
(2)  819/FFFFFFFFC000051A : 400A                		lds	r0,mach
(2)  820/FFFFFFFFC000051C : 6823                		mov	r2,r8
(2)  821/FFFFFFFFC000051E : 7820                		add	#$20,r8
(2)  822/FFFFFFFFC0000520 : 6082                		mov 	@r8,r0
(2)  823/FFFFFFFFC0000522 : 3048                		sub 	r4,r0
(2)  824/FFFFFFFFC0000524 : 5481                		mov 	@(4,r8),r4
(2)  825/FFFFFFFFC0000526 : 3458                		sub 	r5,r4
(2)  826/FFFFFFFFC0000528 : 6503                		mov	r0,r5
(2)  827/FFFFFFFFC000052A : 4418                		shll8	r4
(2)  828/FFFFFFFFC000052C : 4518                		shll8	r5
(2)  829/FFFFFFFFC000052E :                     
(2)  830/FFFFFFFFC000052E : E001                		mov	#1,r0
(2)  831/FFFFFFFFC0000530 : C10B                		mov.w	r0,@(marsGbl_WdgDivLock,gbr)
(2)  832/FFFFFFFFC0000532 : 080A                		sts	mach,r8
(2)  833/FFFFFFFFC0000534 : 90D0                		mov	#_JR,r0
(2)  834/FFFFFFFFC0000536 : 2082                		mov	r8,@r0
(2)  835/FFFFFFFFC0000538 : 1051                		mov	r5,@(4,r0)
(2)  836/FFFFFFFFC000053A : 0009                		nop
(2)  837/FFFFFFFFC000053C : 5501                		mov	@(4,r0),r5
(2)  838/FFFFFFFFC000053E : 90CB                		mov	#_JR,r0
(2)  839/FFFFFFFFC0000540 : 2082                		mov	r8,@r0
(2)  840/FFFFFFFFC0000542 : 1041                		mov	r4,@(4,r0)
(2)  841/FFFFFFFFC0000544 : 0009                		nop
(2)  842/FFFFFFFFC0000546 : 5401                		mov	@(4,r0),r4
(2)  843/FFFFFFFFC0000548 : 4418                		shll8	r4
(2)  844/FFFFFFFFC000054A : 4518                		shll8	r5
(2)  845/FFFFFFFFC000054C : D05B                		mov	#Cach_DDA_Src_L+$C,r0
(2)  846/FFFFFFFFC000054E : 2042                		mov	r4,@r0
(2)  847/FFFFFFFFC0000550 : D05B                		mov	#Cach_DDA_Src_L+4,r0
(2)  848/FFFFFFFFC0000552 : 2052                		mov	r5,@r0
(2)  849/FFFFFFFFC0000554 : 6522                		mov	@r2,r5
(2)  850/FFFFFFFFC0000556 : 3518                		sub 	r1,r5
(2)  851/FFFFFFFFC0000558 : 6413                		mov 	r1,r4
(2)  852/FFFFFFFFC000055A : 4518                		shll8	r5
(2)  853/FFFFFFFFC000055C : 4428                		shll16	r4
(2)  854/FFFFFFFFC000055E : 90BB                		mov	#_JR,r0
(2)  855/FFFFFFFFC0000560 : 2082                		mov	r8,@r0
(2)  856/FFFFFFFFC0000562 : 1051                		mov	r5,@(4,r0)
(2)  857/FFFFFFFFC0000564 : 0009                		nop
(2)  858/FFFFFFFFC0000566 : 5501                		mov	@(4,r0),r5
(2)  859/FFFFFFFFC0000568 : 4518                		shll8	r5
(2)  860/FFFFFFFFC000056A : E000                		mov	#0,r0
(2)  861/FFFFFFFFC000056C : C10B                		mov.w	r0,@(marsGbl_WdgDivLock,gbr)
(2)  862/FFFFFFFFC000056E :                     .lft_skip:
(2)  863/FFFFFFFFC000056E : 000B                		rts
(2)  864/FFFFFFFFC0000570 : 0009                		nop
(2)  865/FFFFFFFFC0000572 :                     		align 4
(2)  866/FFFFFFFFC0000574 :                     
(2)  867/FFFFFFFFC0000574 :                     ; --------------------------------------------------------
(2)  868/FFFFFFFFC0000574 :                     
(2)  869/FFFFFFFFC0000574 :                     set_right:
(2)  870/FFFFFFFFC0000574 : 6933                		mov	r3,r9
(2)  871/FFFFFFFFC0000576 : 7920                		add	#$20,r9
(2)  872/FFFFFFFFC0000578 : 6692                		mov	@r9,r6
(2)  873/FFFFFFFFC000057A : 5791                		mov	@(4,r9),r7
(2)  874/FFFFFFFFC000057C : D951                		mov	#Cach_DDA_Src_R,r9
(2)  875/FFFFFFFFC000057E : 6063                		mov	r6,r0
(2)  876/FFFFFFFFC0000580 : 4028                		shll16	r0
(2)  877/FFFFFFFFC0000582 : 2902                		mov	r0,@r9
(2)  878/FFFFFFFFC0000584 : 6073                		mov	r7,r0
(2)  879/FFFFFFFFC0000586 : 4028                		shll16	r0
(2)  880/FFFFFFFFC0000588 : 1902                		mov	r0,@(8,r9)
(2)  881/FFFFFFFFC000058A :                     
(2)  882/FFFFFFFFC000058A : 6132                		mov	@r3,r1
(2)  883/FFFFFFFFC000058C : 5931                		mov	@(4,r3),r9
(2)  884/FFFFFFFFC000058E : 73F8                		add	#-8,r3
(2)  885/FFFFFFFFC0000590 : 33C3                		cmp/ge	r12,r3
(2)  886/FFFFFFFFC0000592 : 8900                		bt	.rgt_ok
(2)  887/FFFFFFFFC0000594 : 63D3                		mov 	r13,r3
(2)  888/FFFFFFFFC0000596 :                     .rgt_ok:
(2)  889/FFFFFFFFC0000596 : 5031                		mov	@(4,r3),r0
(2)  890/FFFFFFFFC0000598 : 3098                		sub	r9,r0
(2)  891/FFFFFFFFC000059A : 8800                		cmp/eq	#0,r0
(2)  892/FFFFFFFFC000059C : 89EA                		bt	set_right
(2)  893/FFFFFFFFC000059E : 4011                		cmp/pz	r0
(2)  894/FFFFFFFFC00005A0 : 8B29                		bf	.rgt_skip
(2)  895/FFFFFFFFC00005A2 : 400A                		lds	r0,mach
(2)  896/FFFFFFFFC00005A4 : 6933                		mov	r3,r9
(2)  897/FFFFFFFFC00005A6 : 7920                		add	#$20,r9
(2)  898/FFFFFFFFC00005A8 : 6092                		mov 	@r9,r0
(2)  899/FFFFFFFFC00005AA : 3068                		sub 	r6,r0
(2)  900/FFFFFFFFC00005AC : 5691                		mov 	@(4,r9),r6
(2)  901/FFFFFFFFC00005AE : 3678                		sub 	r7,r6
(2)  902/FFFFFFFFC00005B0 : 6703                		mov	r0,r7
(2)  903/FFFFFFFFC00005B2 : 4618                		shll8	r6
(2)  904/FFFFFFFFC00005B4 : 4718                		shll8	r7
(2)  905/FFFFFFFFC00005B6 :                     
(2)  906/FFFFFFFFC00005B6 : E001                		mov	#1,r0
(2)  907/FFFFFFFFC00005B8 : C10B                		mov.w	r0,@(marsGbl_WdgDivLock,gbr)
(2)  908/FFFFFFFFC00005BA : 090A                		sts	mach,r9
(2)  909/FFFFFFFFC00005BC : 908C                		mov	#_JR,r0
(2)  910/FFFFFFFFC00005BE : 2092                		mov	r9,@r0
(2)  911/FFFFFFFFC00005C0 : 1071                		mov	r7,@(4,r0)
(2)  912/FFFFFFFFC00005C2 : 0009                		nop
(2)  913/FFFFFFFFC00005C4 : 5701                		mov	@(4,r0),r7
(2)  914/FFFFFFFFC00005C6 : 9087                		mov	#_JR,r0
(2)  915/FFFFFFFFC00005C8 : 2092                		mov	r9,@r0
(2)  916/FFFFFFFFC00005CA : 1061                		mov	r6,@(4,r0)
(2)  917/FFFFFFFFC00005CC : 0009                		nop
(2)  918/FFFFFFFFC00005CE : 5601                		mov	@(4,r0),r6
(2)  919/FFFFFFFFC00005D0 : 4618                		shll8	r6
(2)  920/FFFFFFFFC00005D2 : 4718                		shll8	r7
(2)  921/FFFFFFFFC00005D4 : D03C                		mov	#Cach_DDA_Src_R+4,r0
(2)  922/FFFFFFFFC00005D6 : 2072                		mov	r7,@r0
(2)  923/FFFFFFFFC00005D8 : D03C                		mov	#Cach_DDA_Src_R+$C,r0
(2)  924/FFFFFFFFC00005DA : 2062                		mov	r6,@r0
(2)  925/FFFFFFFFC00005DC : 6732                		mov	@r3,r7
(2)  926/FFFFFFFFC00005DE : 3718                		sub 	r1,r7
(2)  927/FFFFFFFFC00005E0 : 6613                		mov 	r1,r6
(2)  928/FFFFFFFFC00005E2 : 4628                		shll16	r6
(2)  929/FFFFFFFFC00005E4 : 4718                		shll8	r7
(2)  930/FFFFFFFFC00005E6 : 9077                		mov	#_JR,r0
(2)  931/FFFFFFFFC00005E8 : 2092                		mov	r9,@r0
(2)  932/FFFFFFFFC00005EA : 1071                		mov	r7,@(4,r0)
(2)  933/FFFFFFFFC00005EC : 0009                		nop
(2)  934/FFFFFFFFC00005EE : 5701                		mov	@(4,r0),r7
(2)  935/FFFFFFFFC00005F0 : 4718                		shll8	r7
(2)  936/FFFFFFFFC00005F2 : E000                		mov	#0,r0
(2)  937/FFFFFFFFC00005F4 : C10B                		mov.w	r0,@(marsGbl_WdgDivLock,gbr)
(2)  938/FFFFFFFFC00005F6 :                     .rgt_skip:
(2)  939/FFFFFFFFC00005F6 : 000B                		rts
(2)  940/FFFFFFFFC00005F8 : 0009                		nop
(2)  941/FFFFFFFFC00005FA :                     		align 4
(2)  942/FFFFFFFFC00005FC :                     
(2)  943/FFFFFFFFC00005FC :                     ; --------------------------------------------------------
(2)  944/FFFFFFFFC00005FC :                     
(2)  945/FFFFFFFFC00005FC :                     	; r2
(2)  946/FFFFFFFFC00005FC :                     	; r3
(2)  947/FFFFFFFFC00005FC :                     	; r4 - Left X
(2)  948/FFFFFFFFC00005FC :                     	; r5
(2)  949/FFFFFFFFC00005FC :                     	; r6 - Right X
(2)  950/FFFFFFFFC00005FC :                     	; r7
(2)  951/FFFFFFFFC00005FC :                     	; r8
(2)  952/FFFFFFFFC00005FC :                     	; r9
(2)  953/FFFFFFFFC00005FC :                     	; r10 - Top Y, gets updated after calling put_piece
(2)  954/FFFFFFFFC00005FC :                     
(2)  955/FFFFFFFFC00005FC :                     put_piece:
(2)  956/FFFFFFFFC00005FC : E001                		mov	#1,r0
(2)  957/FFFFFFFFC00005FE : C109                		mov.w	r0,@(marsGbl_WdgHold,gbr)	; Tell watchdog we are mid-write
(2)  958/FFFFFFFFC0000600 : 5821                		mov	@(4,r2),r8	; Left DDA's Y
(2)  959/FFFFFFFFC0000602 : 5931                		mov	@(4,r3),r9	; Right DDA's Y
(2)  960/FFFFFFFFC0000604 : 38A8                		sub	r10,r8
(2)  961/FFFFFFFFC0000606 : 39A8                		sub	r10,r9
(2)  962/FFFFFFFFC0000608 : 3897                		cmp/gt	r9,r8
(2)  963/FFFFFFFFC000060A : 8900                		bt	.lefth
(2)  964/FFFFFFFFC000060C : 6983                		mov	r8,r9
(2)  965/FFFFFFFFC000060E :                     .lefth:
(2)  966/FFFFFFFFC000060E : 6843                		mov	r4,r8
(2)  967/FFFFFFFFC0000610 : 6063                		mov	r6,r0
(2)  968/FFFFFFFFC0000612 : 4829                		shlr16	r8
(2)  969/FFFFFFFFC0000614 : 208D                		xtrct	r8,r0
(2)  970/FFFFFFFFC0000616 : 1103                		mov	r0,@(plypz_xl,r1)
(2)  971/FFFFFFFFC0000618 : 1156                		mov 	r5,@(plypz_xl_dx,r1)
(2)  972/FFFFFFFFC000061A : 359D                		dmuls	r9,r5
(2)  973/FFFFFFFFC000061C : 1177                		mov 	r7,@(plypz_xr_dx,r1)
(2)  974/FFFFFFFFC000061E : 021A                		sts	macl,r2
(2)  975/FFFFFFFFC0000620 : 379D                		dmuls	r9,r7
(2)  976/FFFFFFFFC0000622 : 031A                		sts	macl,r3
(2)  977/FFFFFFFFC0000624 : 342C                		add 	r2,r4
(2)  978/FFFFFFFFC0000626 : 363C                		add	r3,r6
(2)  979/FFFFFFFFC0000628 : 62A3                		mov	r10,r2
(2)  980/FFFFFFFFC000062A : 3A9C                		add	r9,r10
(2)  981/FFFFFFFFC000062C : 6BA3                		mov	r10,r11
(2)  982/FFFFFFFFC000062E : 4228                		shll16	r2
(2)  983/FFFFFFFFC0000630 : 2B2B                		or	r2,r11
(2)  984/FFFFFFFFC0000632 : 11B2                		mov	r11,@(plypz_ytb,r1)
(2)  985/FFFFFFFFC0000634 :                     
(2)  986/FFFFFFFFC0000634 :                     	; r9 - Y multiply
(2)  987/FFFFFFFFC0000634 :                     	;
(2)  988/FFFFFFFFC0000634 :                     	; free:
(2)  989/FFFFFFFFC0000634 :                     	; r2,r3,r5,r7,r8,r11
(2)  990/FFFFFFFFC0000634 : D826                		mov	#Cach_DDA_Src_L,r8
(2)  991/FFFFFFFFC0000636 : D727                		mov	#Cach_DDA_Src_R,r7
(2)  992/FFFFFFFFC0000638 : 6282                		mov	@r8,r2
(2)  993/FFFFFFFFC000063A : 6372                		mov	@r7,r3
(2)  994/FFFFFFFFC000063C : 6523                		mov	r2,r5
(2)  995/FFFFFFFFC000063E : 6033                		mov	r3,r0
(2)  996/FFFFFFFFC0000640 : 4529                		shlr16	r5
(2)  997/FFFFFFFFC0000642 : 205D                		xtrct	r5,r0
(2)  998/FFFFFFFFC0000644 : 1104                		mov	r0,@(plypz_src_xl,r1)
(2)  999/FFFFFFFFC0000646 :                     ; 		mov	r2,@(plypz_src_xl,r1)
(2) 1000/FFFFFFFFC0000646 :                     ; 		mov	r3,@(plypz_src_xr,r1)
(2) 1001/FFFFFFFFC0000646 :                     
(2) 1002/FFFFFFFFC0000646 : 5081                		mov	@(4,r8),r0
(2) 1003/FFFFFFFFC0000648 : 5571                		mov	@(4,r7),r5
(2) 1004/FFFFFFFFC000064A : 1108                		mov	r0,@(plypz_src_xl_dx,r1)
(2) 1005/FFFFFFFFC000064C : 1159                		mov	r5,@(plypz_src_xr_dx,r1)
(2) 1006/FFFFFFFFC000064E : 309D                		dmuls	r9,r0
(2) 1007/FFFFFFFFC0000650 : 001A                		sts	macl,r0
(2) 1008/FFFFFFFFC0000652 : 359D                		dmuls	r9,r5
(2) 1009/FFFFFFFFC0000654 : 051A                		sts	macl,r5
(2) 1010/FFFFFFFFC0000656 : 320C                		add 	r0,r2
(2) 1011/FFFFFFFFC0000658 : 335C                		add	r5,r3
(2) 1012/FFFFFFFFC000065A : 2822                		mov	r2,@r8
(2) 1013/FFFFFFFFC000065C : 2732                		mov	r3,@r7
(2) 1014/FFFFFFFFC000065E :                     
(2) 1015/FFFFFFFFC000065E : 7808                		add	#8,r8	; Go to Y/DY
(2) 1016/FFFFFFFFC0000660 : 7708                		add	#8,r7
(2) 1017/FFFFFFFFC0000662 : 6282                		mov	@r8,r2
(2) 1018/FFFFFFFFC0000664 : 6372                		mov	@r7,r3
(2) 1019/FFFFFFFFC0000666 : 6523                		mov	r2,r5
(2) 1020/FFFFFFFFC0000668 : 6033                		mov	r3,r0
(2) 1021/FFFFFFFFC000066A : 4529                		shlr16	r5
(2) 1022/FFFFFFFFC000066C : 205D                		xtrct	r5,r0
(2) 1023/FFFFFFFFC000066E : 1105                		mov	r0,@(plypz_src_yl,r1)
(2) 1024/FFFFFFFFC0000670 :                     ; 		mov	r2,@(plypz_src_yl,r1)
(2) 1025/FFFFFFFFC0000670 :                     ; 		mov	r3,@(plypz_src_yr,r1)
(2) 1026/FFFFFFFFC0000670 :                     
(2) 1027/FFFFFFFFC0000670 : 5081                		mov	@(4,r8),r0
(2) 1028/FFFFFFFFC0000672 : 5571                		mov	@(4,r7),r5
(2) 1029/FFFFFFFFC0000674 : 110A                		mov	r0,@(plypz_src_yl_dx,r1)
(2) 1030/FFFFFFFFC0000676 : 115B                		mov	r5,@(plypz_src_yr_dx,r1)
(2) 1031/FFFFFFFFC0000678 : 309D                		dmuls	r9,r0
(2) 1032/FFFFFFFFC000067A : 001A                		sts	macl,r0
(2) 1033/FFFFFFFFC000067C : 359D                		dmuls	r9,r5
(2) 1034/FFFFFFFFC000067E : 051A                		sts	macl,r5
(2) 1035/FFFFFFFFC0000680 : 320C                		add 	r0,r2
(2) 1036/FFFFFFFFC0000682 : 335C                		add	r5,r3
(2) 1037/FFFFFFFFC0000684 : 2822                		mov	r2,@r8
(2) 1038/FFFFFFFFC0000686 : 2732                		mov	r3,@r7
(2) 1039/FFFFFFFFC0000688 :                     
(2) 1040/FFFFFFFFC0000688 : 4B15                		cmp/pl	r11			; TOP check, 2 steps
(2) 1041/FFFFFFFFC000068A : 8902                		bt	.top_neg
(2) 1042/FFFFFFFFC000068C : 4B28                		shll16	r11
(2) 1043/FFFFFFFFC000068E : 4B15                		cmp/pl	r11
(2) 1044/FFFFFFFFC0000690 : 8B0E                		bf	.bad_piece
(2) 1045/FFFFFFFFC0000692 :                     .top_neg:
(2) 1046/FFFFFFFFC0000692 : 50E1                		mov	@(polygn_mtrl,r14),r0
(2) 1047/FFFFFFFFC0000694 : 1101                		mov 	r0,@(plypz_mtrl,r1)
(2) 1048/FFFFFFFFC0000696 : 50E0                		mov	@(polygn_type,r14),r0
(2) 1049/FFFFFFFFC0000698 : 1100                		mov 	r0,@(plypz_type,r1)
(2) 1050/FFFFFFFFC000069A :                     
(2) 1051/FFFFFFFFC000069A :                     	; next piece
(2) 1052/FFFFFFFFC000069A : 7130                		add	#sizeof_plypz,r1
(2) 1053/FFFFFFFFC000069C : C603                		mov	@(marsGbl_PlyPzList_End,gbr),r0
(2) 1054/FFFFFFFFC000069E : 3103                		cmp/ge	r0,r1
(2) 1055/FFFFFFFFC00006A0 : 8B01                		bf	.dontres
(2) 1056/FFFFFFFFC00006A2 : C602                		mov	@(marsGbl_PlyPzList_Start,gbr),r0
(2) 1057/FFFFFFFFC00006A4 : 6103                		mov	r0,r1
(2) 1058/FFFFFFFFC00006A6 :                     .dontres:
(2) 1059/FFFFFFFFC00006A6 : 6013                		mov	r1,r0
(2) 1060/FFFFFFFFC00006A8 : C201                		mov	r0,@(marsGbl_PlyPzList_W,gbr)
(2) 1061/FFFFFFFFC00006AA : C50D                		mov.w	@(marsGbl_PlyPzCntr,gbr),r0
(2) 1062/FFFFFFFFC00006AC : 7001                		add	#1,r0
(2) 1063/FFFFFFFFC00006AE : C10D                		mov.w	r0,@(marsGbl_PlyPzCntr,gbr)
(2) 1064/FFFFFFFFC00006B0 :                     .bad_piece:
(2) 1065/FFFFFFFFC00006B0 : E000                		mov	#0,r0
(2) 1066/FFFFFFFFC00006B2 : C109                		mov.w	r0,@(marsGbl_WdgHold,gbr)	; Unlock.
(2) 1067/FFFFFFFFC00006B4 : 000B                		rts
(2) 1068/FFFFFFFFC00006B6 : 0009                		nop
(2) 1069/FFFFFFFFC00006B8 :                     		align 4
(2) 1070/FFFFFFFFC00006B8 : C000 0720 C000 072C 		ltorg
                    C000 0724 C000 0730 
                    C000 0734 C000 073C 
                    C000 0720 C000 0730 
                    FF00                
(2) 1071/FFFFFFFFC00006DA :                     
(2) 1072/FFFFFFFFC00006DA :                     ; ------------------------------------------------
(2) 1073/FFFFFFFFC00006DA :                     
(2) 1074/FFFFFFFFC00006DA :                     		align 4
(2) 1075/FFFFFFFFC00006DC :                     Cach_ClrLines	ds.l 1		; Linecounter for the WDG task $07
(2) 1076/FFFFFFFFC00006E0 :                     Cach_DDA_Top	ds.l 2*2	; First 2 points
(2) 1077/FFFFFFFFC00006F0 :                     Cach_DDA_Last	ds.l 2*2	; Triangle or Quad (+8)
(2) 1078/FFFFFFFFC0000700 :                     Cach_DDA_Src	ds.l 4*2
(2) 1079/FFFFFFFFC0000720 :                     Cach_DDA_Src_L	ds.l 4		; X/DX/Y/DX result for textures
(2) 1080/FFFFFFFFC0000730 :                     Cach_DDA_Src_R	ds.l 4
(2) 1081/FFFFFFFFC0000740 :                     Cach_LnDrw_L	ds.l 14		;
(2) 1082/FFFFFFFFC0000778 :                     Cach_LnDrw_S	ds.l 0		; <-- Reads backwards
(2) 1083/FFFFFFFFC0000778 :                     Cach_Bkup_LB	ds.l 11
(2) 1084/FFFFFFFFC00007A4 :                     Cach_Bkup_S	ds.l 0		; <-- Reads backwards
(2) 1085/FFFFFFFFC00007A4 :                     Cach_Bkup_LPZ	ds.l 7
(2) 1086/FFFFFFFFC00007C0 :                     Cach_Bkup_SPZ	ds.l 0		; <-- Reads backwards
(2) 1087/FFFFFFFFC00007C0 :                     
(2) 1088/FFFFFFFFC00007C0 :                     ; ------------------------------------------------
(2) 1089/ 600257C :                     .end:		phase CACHE_MSTR_PLGN+.end&$1FFF
(2) 1090/ 600257C :                     		align 4
(2) 1091/ 600257C :                     CACHE_MSTR_PLGN_E:
(2) 1095/ 600257C :                     
(1) 2448/ 600257C :                     		include "system/mars/cache/cache_slv.asm"
(2)    1/ 600257C :                     ; ====================================================================
(2)    2/ 600257C :                     ; ----------------------------------------------------------------
(2)    3/ 600257C :                     ; CACHE code
(2)    4/ 600257C :                     ;
(2)    5/ 600257C :                     ; LIMIT: $800 bytes
(2)    6/ 600257C :                     ; ----------------------------------------------------------------
(2)    7/ 600257C :                     
(2)    8/ 600257C :                     		align 4
(2)    9/ 600257C :                     CACHE_SLAVE:
(2)   10/FFFFFFFFC0000000 :                     		phase $C0000000
(2)   11/FFFFFFFFC0000000 :                     
(2)   12/FFFFFFFFC0000000 :                     ; ====================================================================
(2)   13/FFFFFFFFC0000000 :                     ; --------------------------------------------------------
(2)   14/FFFFFFFFC0000000 :                     ; Watchdog interrupt
(2)   15/FFFFFFFFC0000000 :                     ; --------------------------------------------------------
(2)   16/FFFFFFFFC0000000 :                     
(2)   17/FFFFFFFFC0000000 : 91B8                		mov	#_FRT,r1
(2)   18/FFFFFFFFC0000002 : 8417                		mov.b	@(7,r1),r0
(2)   19/FFFFFFFFC0000004 : CA02                		xor	#2,r0
(2)   20/FFFFFFFFC0000006 : 8017                		mov.b	r0,@(7,r1)
(2)   21/FFFFFFFFC0000008 : 91B5                		mov	#$FFFFFE80,r1	; Stop watchdog
(2)   22/FFFFFFFFC000000A : 90B5                		mov.w   #$A518,r0
(2)   23/FFFFFFFFC000000C : 2101                		mov.w   r0,@r1
(2)   24/FFFFFFFFC000000E : 000B                		rts
(2)   25/FFFFFFFFC0000010 : 0009                		nop
(2)   26/FFFFFFFFC0000012 :                     		align 4
(2)   27/FFFFFFFFC0000014 :                     
(2)   28/FFFFFFFFC0000014 :                     ; ====================================================================
(2)   29/FFFFFFFFC0000014 :                     ; --------------------------------------------------------
(2)   30/FFFFFFFFC0000014 :                     ; PWM Interrupt for playback
(2)   31/FFFFFFFFC0000014 :                     ;
(2)   32/FFFFFFFFC0000014 :                     ; **** MUST BE FAST ***
(2)   33/FFFFFFFFC0000014 :                     ; --------------------------------------------------------
(2)   34/FFFFFFFFC0000014 :                     
(2)   35/FFFFFFFFC0000014 :                     s_irq_pwm:
(2)   36/FFFFFFFFC0000014 : 91AE                		mov	#_FRT,r1
(2)   37/FFFFFFFFC0000016 : 8417                		mov.b	@(7,r1),r0
(2)   38/FFFFFFFFC0000018 : CA02                		xor	#2,r0
(2)   39/FFFFFFFFC000001A : 8017                		mov.b	r0,@(7,r1)
(2)   40/FFFFFFFFC000001C : D14B                		mov	#_sysreg+pwmintclr,r1
(2)   41/FFFFFFFFC000001E : 2101                		mov.w	r0,@r1
(2)   42/FFFFFFFFC0000020 : 6011                		mov.w	@r1,r0
(2)   43/FFFFFFFFC0000022 :                     
(2)   44/FFFFFFFFC0000022 :                     ; ------------------------------------------------
(2)   45/FFFFFFFFC0000022 :                     
(2)   46/FFFFFFFFC0000022 : D04B                		mov	#Cach_SlvStack_S,r0
(2)   47/FFFFFFFFC0000024 : 2026                		mov	r2,@-r0
(2)   48/FFFFFFFFC0000026 : 2036                		mov	r3,@-r0
(2)   49/FFFFFFFFC0000028 : 2046                		mov	r4,@-r0
(2)   50/FFFFFFFFC000002A : 2056                		mov	r5,@-r0
(2)   51/FFFFFFFFC000002C : 2066                		mov	r6,@-r0
(2)   52/FFFFFFFFC000002E : 2076                		mov	r7,@-r0
(2)   53/FFFFFFFFC0000030 : 2086                		mov	r8,@-r0
(2)   54/FFFFFFFFC0000032 : 2096                		mov	r9,@-r0
(2)   55/FFFFFFFFC0000034 : 20A6                		mov	r10,@-r0
(2)   56/FFFFFFFFC0000036 : 4012                		sts	macl,@-r0
(2)   57/FFFFFFFFC0000038 :                     
(2)   58/FFFFFFFFC0000038 : DA46                		mov	#MarsSnd_PwmCache,r10
(2)   59/FFFFFFFFC000003A : D947                		mov	#MarsSnd_PwmChnls,r9	; r9 - Channel list
(2)   60/FFFFFFFFC000003C : E807                		mov 	#MAX_PWMCHNL,r8		; r8 - Number of channels
(2)   61/FFFFFFFFC000003E : E700                		mov 	#0,r7			; r7 - RIGHT BASE wave
(2)   62/FFFFFFFFC0000040 : E600                		mov 	#0,r6			; r6 - LEFT BASE wave
(2)   63/FFFFFFFFC0000042 :                     .loop:
(2)   64/FFFFFFFFC0000042 : 5090                		mov	@(mchnsnd_enbl,r9),r0	; Channel enabled? (non-Zero)
(2)   65/FFFFFFFFC0000044 : 8800                		cmp/eq	#0,r0
(2)   66/FFFFFFFFC0000046 : 8B03                		bf	.on
(2)   67/FFFFFFFFC0000048 :                     .silent:
(2)   68/FFFFFFFFC0000048 : E07F                		mov	#$7F,r0			; Silence...
(2)   69/FFFFFFFFC000004A : 6203                		mov	r0,r2
(2)   70/FFFFFFFFC000004C : A05E                		bra	.skip
(2)   71/FFFFFFFFC000004E : 6103                		mov	r0,r1
(2)   72/FFFFFFFFC0000050 :                     .on:
(2)   73/FFFFFFFFC0000050 : 5491                		mov 	@(mchnsnd_read,r9),r4
(2)   74/FFFFFFFFC0000052 : 6343                		mov	r4,r3
(2)   75/FFFFFFFFC0000054 : 5095                		mov 	@(mchnsnd_end,r9),r0
(2)   76/FFFFFFFFC0000056 : D141                		mov	#$00FFFFFF,r1
(2)   77/FFFFFFFFC0000058 : 4319                		shlr8	r3
(2)   78/FFFFFFFFC000005A : 4019                		shlr8	r0
(2)   79/FFFFFFFFC000005C : 2319                		and	r1,r3
(2)   80/FFFFFFFFC000005E : 2019                		and	r1,r0
(2)   81/FFFFFFFFC0000060 : 3302                		cmp/hs	r0,r3
(2)   82/FFFFFFFFC0000062 : 8B0D                		bf	.read
(2)   83/FFFFFFFFC0000064 : 5098                		mov 	@(mchnsnd_flags,r9),r0
(2)   84/FFFFFFFFC0000066 : C804                		tst	#%00000100,r0
(2)   85/FFFFFFFFC0000068 : 8B03                		bf	.loop_me
(2)   86/FFFFFFFFC000006A : E000                		mov 	#0,r0
(2)   87/FFFFFFFFC000006C : 1900                		mov 	r0,@(mchnsnd_enbl,r9)
(2)   88/FFFFFFFFC000006E : AFEB                		bra	.silent
(2)   89/FFFFFFFFC0000070 : 0009                		nop
(2)   90/FFFFFFFFC0000072 :                     .loop_me:
(2)   91/FFFFFFFFC0000072 : 5098                		mov 	@(mchnsnd_flags,r9),r0
(2)   92/FFFFFFFFC0000074 : 5196                		mov	@(mchnsnd_loop,r9),r1
(2)   93/FFFFFFFFC0000076 : 5494                		mov 	@(mchnsnd_start,r9),r4
(2)   94/FFFFFFFFC0000078 : C808                		tst	#%00001000,r0
(2)   95/FFFFFFFFC000007A : 8900                		bt	.mono_l
(2)   96/FFFFFFFFC000007C : 4100                		shll	r1
(2)   97/FFFFFFFFC000007E :                     .mono_l:
(2)   98/FFFFFFFFC000007E : 341C                		add	r1,r4
(2)   99/FFFFFFFFC0000080 :                     
(2)  100/FFFFFFFFC0000080 :                     ; read wave
(2)  101/FFFFFFFFC0000080 :                     ; r4 - WAVE READ pointer
(2)  102/FFFFFFFFC0000080 :                     .read:
(2)  103/FFFFFFFFC0000080 : 5597                		mov 	@(mchnsnd_pitch,r9),r5	; Check if sample is on ROM
(2)  104/FFFFFFFFC0000082 : 5293                		mov 	@(mchnsnd_bank,r9),r2
(2)  105/FFFFFFFFC0000084 : D036                		mov	#CS1,r0
(2)  106/FFFFFFFFC0000086 : 3200                		cmp/eq	r0,r2
(2)  107/FFFFFFFFC0000088 : 8B11                		bf	.not_rom
(2)  108/FFFFFFFFC000008A : D136                		mov	#MarsSnd_RvMode,r1
(2)  109/FFFFFFFFC000008C : 6012                		mov	@r1,r0
(2)  110/FFFFFFFFC000008E : 8801                		cmp/eq	#1,r0
(2)  111/FFFFFFFFC0000090 : 8B0D                		bf	.not_rom
(2)  112/FFFFFFFFC0000092 :                     
(2)  113/FFFFFFFFC0000092 :                     	; r1 - left WAV
(2)  114/FFFFFFFFC0000092 :                     	; r3 - right WAV
(2)  115/FFFFFFFFC0000092 :                     	; r4 - original READ point
(2)  116/FFFFFFFFC0000092 :                     	; r5 - Pitch
(2)  117/FFFFFFFFC0000092 : 5098                		mov 	@(mchnsnd_flags,r9),r0
(2)  118/FFFFFFFFC0000094 : 6153                		mov	r5,r1
(2)  119/FFFFFFFFC0000096 : C808                		tst	#%00001000,r0
(2)  120/FFFFFFFFC0000098 : 8900                		bt	.mono_c
(2)  121/FFFFFFFFC000009A : 4100                		shll	r1
(2)  122/FFFFFFFFC000009C :                     .mono_c:
(2)  123/FFFFFFFFC000009C : 5292                		mov	@(mchnsnd_cchread,r9),r2
(2)  124/FFFFFFFFC000009E : 4219                		shlr8	r2
(2)  125/FFFFFFFFC00000A0 : E17F                		mov	#MAX_PWMBACKUP-1,r1	; backup size limit
(2)  126/FFFFFFFFC00000A2 : 2219                		and	r1,r2
(2)  127/FFFFFFFFC00000A4 : 32AC                		add	r10,r2
(2)  128/FFFFFFFFC00000A6 : 6124                		mov.b	@r2+,r1
(2)  129/FFFFFFFFC00000A8 : 6324                		mov.b	@r2+,r3			; null in MONO samples
(2)  130/FFFFFFFFC00000AA : A00B                		bra	.from_rv
(2)  131/FFFFFFFFC00000AC : 0009                		nop
(2)  132/FFFFFFFFC00000AE :                     
(2)  133/FFFFFFFFC00000AE :                     ; Play as normal
(2)  134/FFFFFFFFC00000AE :                     ; r0 - flags
(2)  135/FFFFFFFFC00000AE :                     ; r4 - READ pointer
(2)  136/FFFFFFFFC00000AE :                     .not_rom:
(2)  137/FFFFFFFFC00000AE : 5098                		mov 	@(mchnsnd_flags,r9),r0
(2)  138/FFFFFFFFC00000B0 : 6343                		mov 	r4,r3
(2)  139/FFFFFFFFC00000B2 : 4319                		shlr8	r3
(2)  140/FFFFFFFFC00000B4 : D129                		mov	#$00FFFFFF,r1
(2)  141/FFFFFFFFC00000B6 : C808                		tst	#%00001000,r0
(2)  142/FFFFFFFFC00000B8 : 8900                		bt	.mono_a
(2)  143/FFFFFFFFC00000BA : 71FF                		add	#-1,r1
(2)  144/FFFFFFFFC00000BC :                     .mono_a:
(2)  145/FFFFFFFFC00000BC : 2319                		and	r1,r3
(2)  146/FFFFFFFFC00000BE : 232B                		or	r2,r3
(2)  147/FFFFFFFFC00000C0 : 6134                		mov.b	@r3+,r1
(2)  148/FFFFFFFFC00000C2 : 6334                		mov.b	@r3+,r3
(2)  149/FFFFFFFFC00000C4 :                     .from_rv:
(2)  150/FFFFFFFFC00000C4 : 6213                		mov	r1,r2
(2)  151/FFFFFFFFC00000C6 : C808                		tst	#%00001000,r0
(2)  152/FFFFFFFFC00000C8 : 8901                		bt	.mono
(2)  153/FFFFFFFFC00000CA : 6233                		mov	r3,r2
(2)  154/FFFFFFFFC00000CC : 4500                		shll	r5
(2)  155/FFFFFFFFC00000CE :                     .mono:
(2)  156/FFFFFFFFC00000CE : 345C                		add	r5,r4
(2)  157/FFFFFFFFC00000D0 : 1941                		mov	r4,@(mchnsnd_read,r9)
(2)  158/FFFFFFFFC00000D2 : 5392                		mov	@(mchnsnd_cchread,r9),r3
(2)  159/FFFFFFFFC00000D4 : 335C                		add	r5,r3
(2)  160/FFFFFFFFC00000D6 : 1932                		mov	r3,@(mchnsnd_cchread,r9)
(2)  161/FFFFFFFFC00000D8 : 611C                		extu.b	r1,r1
(2)  162/FFFFFFFFC00000DA : 622C                		extu.b	r2,r2
(2)  163/FFFFFFFFC00000DC : C802                		tst	#%00000010,r0	; LEFT enabled?
(2)  164/FFFFFFFFC00000DE : 8B00                		bf	.no_l
(2)  165/FFFFFFFFC00000E0 : E17F                		mov	#$7F,r1		; Force LEFT off
(2)  166/FFFFFFFFC00000E2 :                     .no_l:
(2)  167/FFFFFFFFC00000E2 : C801                		tst	#%00000001,r0	; RIGHT enabled?
(2)  168/FFFFFFFFC00000E4 : 8B00                		bf	.no_r
(2)  169/FFFFFFFFC00000E6 : E27F                		mov	#$7F,r2		; Force RIGHT off
(2)  170/FFFFFFFFC00000E8 :                     .no_r:
(2)  171/FFFFFFFFC00000E8 :                     
(2)  172/FFFFFFFFC00000E8 :                     	; Clearly rushed...
(2)  173/FFFFFFFFC00000E8 : 5099                		mov	@(mchnsnd_vol,r9),r0
(2)  174/FFFFFFFFC00000EA : 4015                		cmp/pl	r0
(2)  175/FFFFFFFFC00000EC : 8B0E                		bf	.skip
(2)  176/FFFFFFFFC00000EE : 7001                		add	#1,r0
(2)  177/FFFFFFFFC00000F0 : 210E                		mulu	r0,r1
(2)  178/FFFFFFFFC00000F2 : 041A                		sts	macl,r4
(2)  179/FFFFFFFFC00000F4 : 4419                		shlr8	r4
(2)  180/FFFFFFFFC00000F6 : 3148                		sub	r4,r1
(2)  181/FFFFFFFFC00000F8 : 220E                		mulu	r0,r2
(2)  182/FFFFFFFFC00000FA : 041A                		sts	macl,r4
(2)  183/FFFFFFFFC00000FC : 4419                		shlr8	r4
(2)  184/FFFFFFFFC00000FE : 3248                		sub	r4,r2
(2)  185/FFFFFFFFC0000100 : E47F                		mov	#$7F,r4
(2)  186/FFFFFFFFC0000102 : 240E                		mulu	r0,r4
(2)  187/FFFFFFFFC0000104 : 001A                		sts	macl,r0
(2)  188/FFFFFFFFC0000106 : 4019                		shlr8	r0
(2)  189/FFFFFFFFC0000108 : 310C                		add	r0,r1
(2)  190/FFFFFFFFC000010A : 320C                		add	r0,r2
(2)  191/FFFFFFFFC000010C :                     .skip:
(2)  192/FFFFFFFFC000010C : 7101                		add	#1,r1
(2)  193/FFFFFFFFC000010E : 7201                		add	#1,r2
(2)  194/FFFFFFFFC0000110 : 361C                		add	r1,r6
(2)  195/FFFFFFFFC0000112 : 372C                		add	r2,r7
(2)  196/FFFFFFFFC0000114 : 9031                		mov	#MAX_PWMBACKUP,r0
(2)  197/FFFFFFFFC0000116 : 3A0C                		add	r0,r10
(2)  198/FFFFFFFFC0000118 : 4810                		dt	r8
(2)  199/FFFFFFFFC000011A : 8F92                		bf/s	.loop
(2)  200/FFFFFFFFC000011C : 7928                		add	#sizeof_sndchn,r9
(2)  201/FFFFFFFFC000011E : 902D                		mov	#$3FF,r0		; Overflow protection
(2)  202/FFFFFFFFC0000120 : 3607                		cmp/gt	r0,r6
(2)  203/FFFFFFFFC0000122 : 8B00                		bf	.lmuch
(2)  204/FFFFFFFFC0000124 : 6603                		mov	r0,r6
(2)  205/FFFFFFFFC0000126 :                     .lmuch:
(2)  206/FFFFFFFFC0000126 : 3707                		cmp/gt	r0,r7
(2)  207/FFFFFFFFC0000128 : 8B00                		bf	.rmuch
(2)  208/FFFFFFFFC000012A : 6703                		mov	r0,r7
(2)  209/FFFFFFFFC000012C :                     .rmuch:
(2)  210/FFFFFFFFC000012C : D10E                		mov	#_sysreg+lchwidth,r1	; Write WAVE result
(2)  211/FFFFFFFFC000012E : D20F                		mov	#_sysreg+rchwidth,r2
(2)  212/FFFFFFFFC0000130 : 2161                 		mov.w	r6,@r1
(2)  213/FFFFFFFFC0000132 : 2271                 		mov.w	r7,@r2
(2)  214/FFFFFFFFC0000134 :                     
(2)  215/FFFFFFFFC0000134 : D00E                		mov	#Cach_SlvStack_L,r0
(2)  216/FFFFFFFFC0000136 : 4016                		lds	@r0+,macl
(2)  217/FFFFFFFFC0000138 : 6A06                		mov	@r0+,r10
(2)  218/FFFFFFFFC000013A : 6906                		mov	@r0+,r9
(2)  219/FFFFFFFFC000013C : 6806                		mov	@r0+,r8
(2)  220/FFFFFFFFC000013E : 6706                		mov	@r0+,r7
(2)  221/FFFFFFFFC0000140 : 6606                		mov	@r0+,r6
(2)  222/FFFFFFFFC0000142 : 6506                		mov	@r0+,r5
(2)  223/FFFFFFFFC0000144 : 6406                		mov	@r0+,r4
(2)  224/FFFFFFFFC0000146 : 6306                		mov	@r0+,r3
(2)  225/FFFFFFFFC0000148 : 000B                		rts
(2)  226/FFFFFFFFC000014A : 6206                		mov	@r0+,r2
(2)  227/FFFFFFFFC000014C :                     		align 4
(2)  228/FFFFFFFFC000014C : 2000 401C C000 01BC 		ltorg
                    2600 7600 C000 01F8 
                    00FF FFFF 0200 0000 
                    C000 01BC 2000 4034 
                    2000 4036 C000 0194 
                    FE10 FE80 A518 0080 
                    03FF                
(2)  229/FFFFFFFFC000017E :                     
(2)  230/FFFFFFFFC000017E :                     ; ====================================================================
(2)  231/FFFFFFFFC000017E :                     ; ----------------------------------------------------------------
(2)  232/FFFFFFFFC000017E :                     ; 3D Section
(2)  233/FFFFFFFFC000017E :                     ; ----------------------------------------------------------------
(2)  234/FFFFFFFFC000017E :                     
(2)  235/FFFFFFFFC000017E :                     ; ; --------------------------------------------------------
(2)  236/FFFFFFFFC000017E :                     ; ; MarsMdl_MdlLoop
(2)  237/FFFFFFFFC000017E :                     ; ;
(2)  238/FFFFFFFFC000017E :                     ; ; Call this to start building the 3D objects
(2)  239/FFFFFFFFC000017E :                     ; ; --------------------------------------------------------
(2)  240/FFFFFFFFC000017E :                     ;
(2)  241/FFFFFFFFC000017E :                     ; 		align 4
(2)  242/FFFFFFFFC000017E :                     ; MarsMdl_MdlLoop:
(2)  243/FFFFFFFFC000017E :                     ; 		sts	pr,@-r15
(2)  244/FFFFFFFFC000017E :                     ; 		mov 	#RAM_Mars_Polygons_0,r1
(2)  245/FFFFFFFFC000017E :                     ; 		mov	#RAM_Mars_PlgnList_0,r2
(2)  246/FFFFFFFFC000017E :                     ; 		mov.w   @(marsGbl_PolyBuffNum,gbr),r0
(2)  247/FFFFFFFFC000017E :                     ; 		tst     #1,r0
(2)  248/FFFFFFFFC000017E :                     ; 		bt	.go_mdl
(2)  249/FFFFFFFFC000017E :                     ; 		mov 	#RAM_Mars_Polygons_1,r1
(2)  250/FFFFFFFFC000017E :                     ; 		mov	#RAM_Mars_PlgnList_1,r2
(2)  251/FFFFFFFFC000017E :                     ; .go_mdl:
(2)  252/FFFFFFFFC000017E :                     ; 		mov	r1,r0
(2)  253/FFFFFFFFC000017E :                     ; 		mov	r0,@(marsGbl_CurrFacePos,gbr)
(2)  254/FFFFFFFFC000017E :                     ; 		mov	r2,r0
(2)  255/FFFFFFFFC000017E :                     ; 		mov	r0,@(marsGbl_CurrZList,gbr)
(2)  256/FFFFFFFFC000017E :                     ; 		mov	r0,@(marsGbl_CurrZTop,gbr)
(2)  257/FFFFFFFFC000017E :                     ; 		xor	r0,r0
(2)  258/FFFFFFFFC000017E :                     ; 		mov.w	r0,@(marsGbl_CurrNumFaces,gbr)
(2)  259/FFFFFFFFC000017E :                     ; 		mov	#RAM_Mars_Objects,r14
(2)  260/FFFFFFFFC000017E :                     ; 		mov	#MAX_MODELS,r13
(2)  261/FFFFFFFFC000017E :                     ; .loop:
(2)  262/FFFFFFFFC000017E :                     ; 		mov	@(mdl_data,r14),r0		; Object model data == 0 or -1?
(2)  263/FFFFFFFFC000017E :                     ; 		cmp/pl	r0
(2)  264/FFFFFFFFC000017E :                     ; 		bf	.invlid
(2)  265/FFFFFFFFC000017E :                     ; 		mov	#MarsMdl_ReadModel,r0
(2)  266/FFFFFFFFC000017E :                     ; 		jsr	@r0
(2)  267/FFFFFFFFC000017E :                     ; 		mov	r13,@-r15
(2)  268/FFFFFFFFC000017E :                     ; 		mov	@r15+,r13
(2)  269/FFFFFFFFC000017E :                     ; .invlid:
(2)  270/FFFFFFFFC000017E :                     ; 		dt	r13
(2)  271/FFFFFFFFC000017E :                     ; 		bf/s	.loop
(2)  272/FFFFFFFFC000017E :                     ; 		add	#sizeof_mdlobj,r14
(2)  273/FFFFFFFFC000017E :                     ; .skip:
(2)  274/FFFFFFFFC000017E :                     ; 		mov 	#RAM_Mars_PlgnNum_0,r1
(2)  275/FFFFFFFFC000017E :                     ; 		mov.w   @(marsGbl_PolyBuffNum,gbr),r0
(2)  276/FFFFFFFFC000017E :                     ; 		tst     #1,r0
(2)  277/FFFFFFFFC000017E :                     ; 		bt	.page_2
(2)  278/FFFFFFFFC000017E :                     ; 		mov 	#RAM_Mars_PlgnNum_1,r1
(2)  279/FFFFFFFFC000017E :                     ; .page_2:
(2)  280/FFFFFFFFC000017E :                     ; 		mov.w	@(marsGbl_CurrNumFaces,gbr),r0	; Ran out of space to store faces?
(2)  281/FFFFFFFFC000017E :                     ; 		mov	r0,@r1
(2)  282/FFFFFFFFC000017E :                     ; 		lds	@r15+,pr
(2)  283/FFFFFFFFC000017E :                     ; 		rts
(2)  284/FFFFFFFFC000017E :                     ; 		nop
(2)  285/FFFFFFFFC000017E :                     ; 		align 4
(2)  286/FFFFFFFFC000017E :                     ; 		ltorg
(2)  287/FFFFFFFFC000017E :                     ;
(2)  288/FFFFFFFFC000017E :                     ; ; ------------------------------------------------
(2)  289/FFFFFFFFC000017E :                     ; ; Read model
(2)  290/FFFFFFFFC000017E :                     ; ; ------------------------------------------------
(2)  291/FFFFFFFFC000017E :                     ;
(2)  292/FFFFFFFFC000017E :                     ; 		align 4
(2)  293/FFFFFFFFC000017E :                     ; MarsMdl_ReadModel:
(2)  294/FFFFFFFFC000017E :                     ; 		sts	pr,@-r15
(2)  295/FFFFFFFFC000017E :                     ;
(2)  296/FFFFFFFFC000017E :                     ; 		mov	#Cach_CurrPlygn,r13		; r13 - temporal face output
(2)  297/FFFFFFFFC000017E :                     ; 		mov	@(mdl_data,r14),r12		; r12 - model header
(2)  298/FFFFFFFFC000017E :                     ; 		mov 	@(8,r12),r11			; r11 - face data
(2)  299/FFFFFFFFC000017E :                     ; 		mov 	@(4,r12),r10			; r10 - vertice data (X,Y,Z)
(2)  300/FFFFFFFFC000017E :                     ; 		mov.w	@r12,r9				;  r9 - Number of faces used on model
(2)  301/FFFFFFFFC000017E :                     ; 		mov	@(marsGbl_CurrZList,gbr),r0	;  r8 - Zlist for sorting
(2)  302/FFFFFFFFC000017E :                     ; 		mov	r0,r8
(2)  303/FFFFFFFFC000017E :                     ; .next_face:
(2)  304/FFFFFFFFC000017E :                     ; 		mov.w	@(marsGbl_CurrNumFaces,gbr),r0	; Ran out of face storage?
(2)  305/FFFFFFFFC000017E :                     ; 		mov	.tag_maxfaces,r1
(2)  306/FFFFFFFFC000017E :                     ; 		cmp/gt	r1,r0
(2)  307/FFFFFFFFC000017E :                     ; 		bf	.can_build
(2)  308/FFFFFFFFC000017E :                     ; .no_model:
(2)  309/FFFFFFFFC000017E :                     ; 		bra	.exit_model
(2)  310/FFFFFFFFC000017E :                     ; 		nop
(2)  311/FFFFFFFFC000017E :                     ; 		align 4
(2)  312/FFFFFFFFC000017E :                     ; .tag_maxfaces:	dc.l	MAX_FACES
(2)  313/FFFFFFFFC000017E :                     ;
(2)  314/FFFFFFFFC000017E :                     ; ; --------------------------------
(2)  315/FFFFFFFFC000017E :                     ;
(2)  316/FFFFFFFFC000017E :                     ; .can_build:
(2)  317/FFFFFFFFC000017E :                     ; 		mov.w	@r11+,r4		; Read type
(2)  318/FFFFFFFFC000017E :                     ; 		nop
(2)  319/FFFFFFFFC000017E :                     ; 		mov	#3,r7			; r7 - Current polygon type: triangle (3)
(2)  320/FFFFFFFFC000017E :                     ; 		mov	r4,r0
(2)  321/FFFFFFFFC000017E :                     ; 		shlr8	r0
(2)  322/FFFFFFFFC000017E :                     ; 		tst	#PLGN_TRI,r0		; Model face uses triangle?
(2)  323/FFFFFFFFC000017E :                     ; 		bf	.set_tri
(2)  324/FFFFFFFFC000017E :                     ; 		add	#1,r7			; Face is quad, r7 = 4 points
(2)  325/FFFFFFFFC000017E :                     ; .set_tri:
(2)  326/FFFFFFFFC000017E :                     ; 		cmp/pl	r4			; Faces uses texture? ($8xxx)
(2)  327/FFFFFFFFC000017E :                     ; 		bt	.solid_type
(2)  328/FFFFFFFFC000017E :                     ;
(2)  329/FFFFFFFFC000017E :                     ; ; --------------------------------
(2)  330/FFFFFFFFC000017E :                     ; ; Set texture material
(2)  331/FFFFFFFFC000017E :                     ; ; --------------------------------
(2)  332/FFFFFFFFC000017E :                     ;
(2)  333/FFFFFFFFC000017E :                     ; 		mov	@($C,r12),r6		; r6 - Material data
(2)  334/FFFFFFFFC000017E :                     ; 		mov	r13,r5			; r5 - Go to UV section
(2)  335/FFFFFFFFC000017E :                     ; 		add 	#polygn_srcpnts,r5
(2)  336/FFFFFFFFC000017E :                     ; 	rept 3
(2)  337/FFFFFFFFC000017E :                     ; 		mov.w	@r11+,r0		; Read UV index
(2)  338/FFFFFFFFC000017E :                     ; 		extu.w	r0,r0
(2)  339/FFFFFFFFC000017E :                     ; 		shll2	r0
(2)  340/FFFFFFFFC000017E :                     ; 		mov	@(r6,r0),r0
(2)  341/FFFFFFFFC000017E :                     ; 		mov.w	r0,@(2,r5)
(2)  342/FFFFFFFFC000017E :                     ; 		shlr16	r0
(2)  343/FFFFFFFFC000017E :                     ; 		mov.w	r0,@r5
(2)  344/FFFFFFFFC000017E :                     ; 		add	#4,r5
(2)  345/FFFFFFFFC000017E :                     ; 	endm
(2)  346/FFFFFFFFC000017E :                     ; 		mov	r7,r0			; Triangle?
(2)  347/FFFFFFFFC000017E :                     ; 		cmp/eq	#3,r0
(2)  348/FFFFFFFFC000017E :                     ; 		bt	.alluvdone		; If yes, skip this
(2)  349/FFFFFFFFC000017E :                     ; 		nop
(2)  350/FFFFFFFFC000017E :                     ; 		mov.w	@r11+,r0		; Read extra UV index
(2)  351/FFFFFFFFC000017E :                     ; 		extu.w	r0,r0
(2)  352/FFFFFFFFC000017E :                     ; 		shll2	r0
(2)  353/FFFFFFFFC000017E :                     ; 		mov	@(r6,r0),r0
(2)  354/FFFFFFFFC000017E :                     ; 		mov.w	r0,@(2,r5)
(2)  355/FFFFFFFFC000017E :                     ; 		shlr16	r0
(2)  356/FFFFFFFFC000017E :                     ; 		mov.w	r0,@r5
(2)  357/FFFFFFFFC000017E :                     ; .alluvdone:
(2)  358/FFFFFFFFC000017E :                     ; 		mov	#-1,r5
(2)  359/FFFFFFFFC000017E :                     ; 		extu.b	r5,r5			; $FF
(2)  360/FFFFFFFFC000017E :                     ; 		mov	@(mdl_option,r14),r0
(2)  361/FFFFFFFFC000017E :                     ; 		extu.b	r0,r0
(2)  362/FFFFFFFFC000017E :                     ; 		mov	r0,r1
(2)  363/FFFFFFFFC000017E :                     ; 		mov	r4,r0
(2)  364/FFFFFFFFC000017E :                     ; 		and	r5,r0
(2)  365/FFFFFFFFC000017E :                     ; 		shll2	r0
(2)  366/FFFFFFFFC000017E :                     ; 		mov	@($10,r12),r6
(2)  367/FFFFFFFFC000017E :                     ; 		shll	r0
(2)  368/FFFFFFFFC000017E :                     ; 		add	r0,r6
(2)  369/FFFFFFFFC000017E :                     ; ; 		mov	#$C000,r0
(2)  370/FFFFFFFFC000017E :                     ; 		mov	#$60,r0		; grab special bits ($C000)
(2)  371/FFFFFFFFC000017E :                     ; 		shll	r0
(2)  372/FFFFFFFFC000017E :                     ; 		shll8	r0
(2)  373/FFFFFFFFC000017E :                     ; 		and	r0,r4
(2)  374/FFFFFFFFC000017E :                     ; 		shll16	r4
(2)  375/FFFFFFFFC000017E :                     ; 		mov	@(4,r6),r0
(2)  376/FFFFFFFFC000017E :                     ; 		or	r0,r4
(2)  377/FFFFFFFFC000017E :                     ; 		add	r1,r4
(2)  378/FFFFFFFFC000017E :                     ; 		mov	r4,@(polygn_type,r13)
(2)  379/FFFFFFFFC000017E :                     ; 		mov	@r6,r0
(2)  380/FFFFFFFFC000017E :                     ; 		mov	r0,@(polygn_mtrl,r13)
(2)  381/FFFFFFFFC000017E :                     ; 		bra	.go_faces
(2)  382/FFFFFFFFC000017E :                     ; 		nop
(2)  383/FFFFFFFFC000017E :                     ; 		align 4
(2)  384/FFFFFFFFC000017E :                     ;
(2)  385/FFFFFFFFC000017E :                     ; ; --------------------------------
(2)  386/FFFFFFFFC000017E :                     ; ; Set texture material
(2)  387/FFFFFFFFC000017E :                     ; ; --------------------------------
(2)  388/FFFFFFFFC000017E :                     ;
(2)  389/FFFFFFFFC000017E :                     ; .solid_type:
(2)  390/FFFFFFFFC000017E :                     ; 		mov	@(mdl_option,r14),r0
(2)  391/FFFFFFFFC000017E :                     ; 		extu.b	r0,r0
(2)  392/FFFFFFFFC000017E :                     ; ; 		and	#$FF,r0
(2)  393/FFFFFFFFC000017E :                     ; 		mov	r0,r1
(2)  394/FFFFFFFFC000017E :                     ; 		mov	r4,r0
(2)  395/FFFFFFFFC000017E :                     ; ; 		mov	#$E000,r5
(2)  396/FFFFFFFFC000017E :                     ; 		mov	#$70,r5		; $E000
(2)  397/FFFFFFFFC000017E :                     ; 		shll	r5
(2)  398/FFFFFFFFC000017E :                     ; 		shll8	r5
(2)  399/FFFFFFFFC000017E :                     ; 		and	r5,r4
(2)  400/FFFFFFFFC000017E :                     ; 		shll16	r4
(2)  401/FFFFFFFFC000017E :                     ; 		add	r1,r4
(2)  402/FFFFFFFFC000017E :                     ; 		mov	r4,@(polygn_type,r13)		; Set type 0 (tri) or quad (1)
(2)  403/FFFFFFFFC000017E :                     ; 		extu.b	r0,r0
(2)  404/FFFFFFFFC000017E :                     ; ; 		and	#$FF,r0
(2)  405/FFFFFFFFC000017E :                     ; 		mov	r0,@(polygn_mtrl,r13)		; Set pixel color (0-255)
(2)  406/FFFFFFFFC000017E :                     ;
(2)  407/FFFFFFFFC000017E :                     ; ; --------------------------------
(2)  408/FFFFFFFFC000017E :                     ; ; Read faces
(2)  409/FFFFFFFFC000017E :                     ; ; --------------------------------
(2)  410/FFFFFFFFC000017E :                     ;
(2)  411/FFFFFFFFC000017E :                     ; .go_faces:
(2)  412/FFFFFFFFC000017E :                     ; 		mov	r13,r1
(2)  413/FFFFFFFFC000017E :                     ; 		add 	#polygn_points,r1
(2)  414/FFFFFFFFC000017E :                     ; 		mov	r11,r6
(2)  415/FFFFFFFFC000017E :                     ; 		mov	r7,r0
(2)  416/FFFFFFFFC000017E :                     ; 		shll	r0
(2)  417/FFFFFFFFC000017E :                     ; 		add	r0,r11
(2)  418/FFFFFFFFC000017E :                     ;
(2)  419/FFFFFFFFC000017E :                     ; 		mov	#Cach_BkupS_S,r0
(2)  420/FFFFFFFFC000017E :                     ; 		mov 	r8,@-r0
(2)  421/FFFFFFFFC000017E :                     ; 		mov 	r9,@-r0
(2)  422/FFFFFFFFC000017E :                     ; 		mov 	r11,@-r0
(2)  423/FFFFFFFFC000017E :                     ; 		mov 	r12,@-r0
(2)  424/FFFFFFFFC000017E :                     ; 		mov 	r13,@-r0
(2)  425/FFFFFFFFC000017E :                     ; 		mov	#-(320/2)>>1,r8
(2)  426/FFFFFFFFC000017E :                     ; 		shll	r8
(2)  427/FFFFFFFFC000017E :                     ; 		mov	#-(224/2),r11
(2)  428/FFFFFFFFC000017E :                     ; 		neg	r8,r9
(2)  429/FFFFFFFFC000017E :                     ; 		neg	r11,r12
(2)  430/FFFFFFFFC000017E :                     ; 		mov	#-1,r13		; $FFFFFFFF
(2)  431/FFFFFFFFC000017E :                     ;
(2)  432/FFFFFFFFC000017E :                     ; 	; Do 3 points
(2)  433/FFFFFFFFC000017E :                     ; 	rept 3
(2)  434/FFFFFFFFC000017E :                     ; 		mov	#0,r0
(2)  435/FFFFFFFFC000017E :                     ; 		mov.w 	@r6+,r0
(2)  436/FFFFFFFFC000017E :                     ; 		mov	#$C,r4
(2)  437/FFFFFFFFC000017E :                     ; 		mulu	r4,r0
(2)  438/FFFFFFFFC000017E :                     ; 		sts	macl,r0
(2)  439/FFFFFFFFC000017E :                     ; 		mov	r10,r4
(2)  440/FFFFFFFFC000017E :                     ; 		add 	r0,r4
(2)  441/FFFFFFFFC000017E :                     ; 		mov	@r4,r2
(2)  442/FFFFFFFFC000017E :                     ; 		mov	@(4,r4),r3
(2)  443/FFFFFFFFC000017E :                     ; 		mov	@(8,r4),r4
(2)  444/FFFFFFFFC000017E :                     ; 		bsr	mdlrd_setpoint
(2)  445/FFFFFFFFC000017E :                     ; 		nop
(2)  446/FFFFFFFFC000017E :                     ; 		mov	r2,@r1
(2)  447/FFFFFFFFC000017E :                     ; 		mov	r3,@(4,r1)
(2)  448/FFFFFFFFC000017E :                     ; 		add	#8,r1
(2)  449/FFFFFFFFC000017E :                     ; 		nop
(2)  450/FFFFFFFFC000017E :                     ; 	endm
(2)  451/FFFFFFFFC000017E :                     ; 		mov	#3,r0			; Triangle?
(2)  452/FFFFFFFFC000017E :                     ; 		cmp/eq	r0,r7
(2)  453/FFFFFFFFC000017E :                     ; 		bt	.alldone		; If yes, skip this
(2)  454/FFFFFFFFC000017E :                     ; 		nop
(2)  455/FFFFFFFFC000017E :                     ; 		mov	#0,r0
(2)  456/FFFFFFFFC000017E :                     ; 		mov.w 	@r6+,r0
(2)  457/FFFFFFFFC000017E :                     ; 		mov	#$C,r4
(2)  458/FFFFFFFFC000017E :                     ; 		mulu	r4,r0
(2)  459/FFFFFFFFC000017E :                     ; 		sts	macl,r0
(2)  460/FFFFFFFFC000017E :                     ; 		mov	r10,r4
(2)  461/FFFFFFFFC000017E :                     ; 		add 	r0,r4
(2)  462/FFFFFFFFC000017E :                     ; 		mov	@r4,r2
(2)  463/FFFFFFFFC000017E :                     ; 		mov	@(4,r4),r3
(2)  464/FFFFFFFFC000017E :                     ; 		mov	@(8,r4),r4
(2)  465/FFFFFFFFC000017E :                     ; 		bsr	mdlrd_setpoint
(2)  466/FFFFFFFFC000017E :                     ; 		nop
(2)  467/FFFFFFFFC000017E :                     ; 		mov	r2,@r1
(2)  468/FFFFFFFFC000017E :                     ; 		mov	r3,@(4,r1)
(2)  469/FFFFFFFFC000017E :                     ; .alldone:
(2)  470/FFFFFFFFC000017E :                     ; 		mov	r8,r1
(2)  471/FFFFFFFFC000017E :                     ; 		mov	r9,r2
(2)  472/FFFFFFFFC000017E :                     ; 		mov	r11,r3
(2)  473/FFFFFFFFC000017E :                     ; 		mov	r12,r4
(2)  474/FFFFFFFFC000017E :                     ; 		mov	r13,r6
(2)  475/FFFFFFFFC000017E :                     ;
(2)  476/FFFFFFFFC000017E :                     ; 		mov	#Cach_BkupS_L,r0
(2)  477/FFFFFFFFC000017E :                     ; 		mov	@r0+,r13
(2)  478/FFFFFFFFC000017E :                     ; 		mov	@r0+,r12
(2)  479/FFFFFFFFC000017E :                     ; 		mov	@r0+,r11
(2)  480/FFFFFFFFC000017E :                     ; 		mov	@r0+,r9
(2)  481/FFFFFFFFC000017E :                     ; 		mov	@r0+,r8
(2)  482/FFFFFFFFC000017E :                     ;
(2)  483/FFFFFFFFC000017E :                     ; 	; NOTE: if you don't like how the perspective works
(2)  484/FFFFFFFFC000017E :                     ; 	; change this instruction depending how you want to ignore
(2)  485/FFFFFFFFC000017E :                     ; 	; faces closer to the camera:
(2)  486/FFFFFFFFC000017E :                     ; 	;
(2)  487/FFFFFFFFC000017E :                     ; 	; r5 - Back Z point, keep affine limitations
(2)  488/FFFFFFFFC000017E :                     ; 	; r6 - Front Z point, skip face but larger faces are affected
(2)  489/FFFFFFFFC000017E :                     ;
(2)  490/FFFFFFFFC000017E :                     ; 		cmp/pz	r5			; *** back z
(2)  491/FFFFFFFFC000017E :                     ; 		bt	.go_fout
(2)  492/FFFFFFFFC000017E :                     ; ; 		cmp/pz	r6			; *** front z
(2)  493/FFFFFFFFC000017E :                     ; ; 		bt	.go_fout
(2)  494/FFFFFFFFC000017E :                     ; 		mov	#MAX_ZDIST>>8,r0	; Draw distance
(2)  495/FFFFFFFFC000017E :                     ; 		shll8	r0
(2)  496/FFFFFFFFC000017E :                     ; 		cmp/ge	r0,r5
(2)  497/FFFFFFFFC000017E :                     ; 		bf	.go_fout
(2)  498/FFFFFFFFC000017E :                     ; 		mov	#-(SCREEN_WIDTH/2),r0
(2)  499/FFFFFFFFC000017E :                     ; 		cmp/gt	r0,r1
(2)  500/FFFFFFFFC000017E :                     ; 		bf	.go_fout
(2)  501/FFFFFFFFC000017E :                     ; 		neg	r0,r0
(2)  502/FFFFFFFFC000017E :                     ; 		cmp/ge	r0,r2
(2)  503/FFFFFFFFC000017E :                     ; 		bt	.go_fout
(2)  504/FFFFFFFFC000017E :                     ; 		mov	#-(SCREEN_HEIGHT/2),r0
(2)  505/FFFFFFFFC000017E :                     ; 		cmp/gt	r0,r3
(2)  506/FFFFFFFFC000017E :                     ; 		bf	.go_fout
(2)  507/FFFFFFFFC000017E :                     ; 		neg	r0,r0
(2)  508/FFFFFFFFC000017E :                     ; 		cmp/ge	r0,r4
(2)  509/FFFFFFFFC000017E :                     ; 		bf	.face_ok
(2)  510/FFFFFFFFC000017E :                     ; .go_fout:	bra	.face_out
(2)  511/FFFFFFFFC000017E :                     ; 		nop
(2)  512/FFFFFFFFC000017E :                     ; 		align 4
(2)  513/FFFFFFFFC000017E :                     ;
(2)  514/FFFFFFFFC000017E :                     ; ; --------------------------------
(2)  515/FFFFFFFFC000017E :                     ;
(2)  516/FFFFFFFFC000017E :                     ; .face_ok:
(2)  517/FFFFFFFFC000017E :                     ; 		mov.w	@(marsGbl_CurrNumFaces,gbr),r0	; Add 1 face to the list
(2)  518/FFFFFFFFC000017E :                     ; 		add	#1,r0
(2)  519/FFFFFFFFC000017E :                     ; 		mov.w	r0,@(marsGbl_CurrNumFaces,gbr)
(2)  520/FFFFFFFFC000017E :                     ; 		mov	@(marsGbl_CurrFacePos,gbr),r0
(2)  521/FFFFFFFFC000017E :                     ; 		mov	r0,r1
(2)  522/FFFFFFFFC000017E :                     ; 		mov	r13,r2
(2)  523/FFFFFFFFC000017E :                     ; 		mov	r5,@r8				; Store current Z to Zlist
(2)  524/FFFFFFFFC000017E :                     ; 		mov	r1,@(4,r8)			; And it's address
(2)  525/FFFFFFFFC000017E :                     ;
(2)  526/FFFFFFFFC000017E :                     ; ; ****
(2)  527/FFFFFFFFC000017E :                     ; ; 	Sort this face
(2)  528/FFFFFFFFC000017E :                     ; ; 	r7 - Curr Z
(2)  529/FFFFFFFFC000017E :                     ; ; 	r6 - Past Z
(2)  530/FFFFFFFFC000017E :                     ; 		mov.w	@(marsGbl_CurrNumFaces,gbr),r0
(2)  531/FFFFFFFFC000017E :                     ; 		cmp/eq	#1,r0
(2)  532/FFFFFFFFC000017E :                     ; 		bt	.first_face
(2)  533/FFFFFFFFC000017E :                     ; 		cmp/eq	#2,r0
(2)  534/FFFFFFFFC000017E :                     ; 		bt	.first_face
(2)  535/FFFFFFFFC000017E :                     ; 		mov	r8,r7
(2)  536/FFFFFFFFC000017E :                     ; 		add	#-8,r7
(2)  537/FFFFFFFFC000017E :                     ; 		mov	@(marsGbl_CurrZTop,gbr),r0
(2)  538/FFFFFFFFC000017E :                     ; 		mov	r0,r6
(2)  539/FFFFFFFFC000017E :                     ; .page_2:
(2)  540/FFFFFFFFC000017E :                     ; 		cmp/ge	r6,r7
(2)  541/FFFFFFFFC000017E :                     ; 		bf	.first_face
(2)  542/FFFFFFFFC000017E :                     ; 		mov	@(8,r7),r4
(2)  543/FFFFFFFFC000017E :                     ; 		mov	@r7,r5
(2)  544/FFFFFFFFC000017E :                     ; 		cmp/eq	r4,r5
(2)  545/FFFFFFFFC000017E :                     ; 		bt	.first_face
(2)  546/FFFFFFFFC000017E :                     ; 		cmp/gt	r4,r5
(2)  547/FFFFFFFFC000017E :                     ; 		bf	.swap_me
(2)  548/FFFFFFFFC000017E :                     ; 		mov	@r7,r4
(2)  549/FFFFFFFFC000017E :                     ; 		mov	@(8,r7),r5
(2)  550/FFFFFFFFC000017E :                     ; 		mov	r5,@r7
(2)  551/FFFFFFFFC000017E :                     ; 		mov	r4,@(8,r7)
(2)  552/FFFFFFFFC000017E :                     ; 		mov	@(4,r7),r4
(2)  553/FFFFFFFFC000017E :                     ; 		mov	@($C,r7),r5
(2)  554/FFFFFFFFC000017E :                     ; 		mov	r5,@(4,r7)
(2)  555/FFFFFFFFC000017E :                     ; 		mov	r4,@($C,r7)
(2)  556/FFFFFFFFC000017E :                     ; .swap_me:
(2)  557/FFFFFFFFC000017E :                     ; 		bra	.page_2
(2)  558/FFFFFFFFC000017E :                     ; 		add	#-8,r7
(2)  559/FFFFFFFFC000017E :                     ; .first_face:
(2)  560/FFFFFFFFC000017E :                     ; ; ****
(2)  561/FFFFFFFFC000017E :                     ;
(2)  562/FFFFFFFFC000017E :                     ; 		add	#8,r8			; Next Zlist entry
(2)  563/FFFFFFFFC000017E :                     ; 	rept sizeof_polygn/4			; Copy words manually
(2)  564/FFFFFFFFC000017E :                     ; 		mov	@r2+,r0
(2)  565/FFFFFFFFC000017E :                     ; 		mov	r0,@r1
(2)  566/FFFFFFFFC000017E :                     ; 		add	#4,r1
(2)  567/FFFFFFFFC000017E :                     ; 	endm
(2)  568/FFFFFFFFC000017E :                     ; 		mov	r1,r0
(2)  569/FFFFFFFFC000017E :                     ; 		mov	r0,@(marsGbl_CurrFacePos,gbr)
(2)  570/FFFFFFFFC000017E :                     ; .face_out:
(2)  571/FFFFFFFFC000017E :                     ; 		dt	r9
(2)  572/FFFFFFFFC000017E :                     ; 		bt	.finish_this
(2)  573/FFFFFFFFC000017E :                     ; 		bra	.next_face
(2)  574/FFFFFFFFC000017E :                     ; 		nop
(2)  575/FFFFFFFFC000017E :                     ; .finish_this:
(2)  576/FFFFFFFFC000017E :                     ; 		mov	r8,r0
(2)  577/FFFFFFFFC000017E :                     ; 		mov	r0,@(marsGbl_CurrZList,gbr)
(2)  578/FFFFFFFFC000017E :                     ; .exit_model:
(2)  579/FFFFFFFFC000017E :                     ; 		lds	@r15+,pr
(2)  580/FFFFFFFFC000017E :                     ; 		rts
(2)  581/FFFFFFFFC000017E :                     ; 		nop
(2)  582/FFFFFFFFC000017E :                     ; 		align 4
(2)  583/FFFFFFFFC000017E :                     ; ; 		ltorg
(2)  584/FFFFFFFFC000017E :                     ;
(2)  585/FFFFFFFFC000017E :                     ; ; ----------------------------------------
(2)  586/FFFFFFFFC000017E :                     ; ; Modify position to current point
(2)  587/FFFFFFFFC000017E :                     ; ; ----------------------------------------
(2)  588/FFFFFFFFC000017E :                     ;
(2)  589/FFFFFFFFC000017E :                     ; 		align 4
(2)  590/FFFFFFFFC000017E :                     ; mdlrd_setpoint:
(2)  591/FFFFFFFFC000017E :                     ; 		mov	#Cach_BkupPnt_S,r0
(2)  592/FFFFFFFFC000017E :                     ; 		sts	pr,@-r0
(2)  593/FFFFFFFFC000017E :                     ; 		mov 	r5,@-r0
(2)  594/FFFFFFFFC000017E :                     ; 		mov 	r6,@-r0
(2)  595/FFFFFFFFC000017E :                     ; 		mov 	r7,@-r0
(2)  596/FFFFFFFFC000017E :                     ; 		mov 	r8,@-r0
(2)  597/FFFFFFFFC000017E :                     ; 		mov 	r9,@-r0
(2)  598/FFFFFFFFC000017E :                     ; 		mov 	r10,@-r0
(2)  599/FFFFFFFFC000017E :                     ; 		mov 	r11,@-r0
(2)  600/FFFFFFFFC000017E :                     ;
(2)  601/FFFFFFFFC000017E :                     ; 	; Object rotation
(2)  602/FFFFFFFFC000017E :                     ; 		mov	r2,r5			; r5 - X
(2)  603/FFFFFFFFC000017E :                     ; 		mov	r4,r6			; r6 - Z
(2)  604/FFFFFFFFC000017E :                     ;   		mov.w 	@(mdl_x_rot,r14),r0
(2)  605/FFFFFFFFC000017E :                     ;   		bsr	mdlrd_rotate
(2)  606/FFFFFFFFC000017E :                     ;   		shlr2	r0
(2)  607/FFFFFFFFC000017E :                     ;    		mov	r7,r2
(2)  608/FFFFFFFFC000017E :                     ;    		mov	r3,r5
(2)  609/FFFFFFFFC000017E :                     ;   		mov	r8,r6
(2)  610/FFFFFFFFC000017E :                     ;   		mov.w	@(mdl_z_rot,r14),r0
(2)  611/FFFFFFFFC000017E :                     ;   		shlr	r0
(2)  612/FFFFFFFFC000017E :                     ;   		bsr	mdlrd_rotate
(2)  613/FFFFFFFFC000017E :                     ;   		shlr2	r0
(2)  614/FFFFFFFFC000017E :                     ;    		mov	r8,r4
(2)  615/FFFFFFFFC000017E :                     ;    		mov	r2,r5
(2)  616/FFFFFFFFC000017E :                     ;    		mov	r7,r6
(2)  617/FFFFFFFFC000017E :                     ;    		mov.w	@(mdl_y_rot,r14),r0
(2)  618/FFFFFFFFC000017E :                     ;   		shlr	r0
(2)  619/FFFFFFFFC000017E :                     ;   		bsr	mdlrd_rotate
(2)  620/FFFFFFFFC000017E :                     ;   		shlr2	r0
(2)  621/FFFFFFFFC000017E :                     ;    		mov	r7,r2
(2)  622/FFFFFFFFC000017E :                     ;    		mov	r8,r3
(2)  623/FFFFFFFFC000017E :                     ; 		mov.w	@(mdl_x_pos,r14),r0
(2)  624/FFFFFFFFC000017E :                     ; 		exts.w	r0,r5
(2)  625/FFFFFFFFC000017E :                     ; 		mov.w	@(mdl_y_pos,r14),r0
(2)  626/FFFFFFFFC000017E :                     ; 		exts.w	r0,r6
(2)  627/FFFFFFFFC000017E :                     ; 		mov.w	@(mdl_z_pos,r14),r0
(2)  628/FFFFFFFFC000017E :                     ; 		exts.w	r0,r7
(2)  629/FFFFFFFFC000017E :                     ; ;  		shar	r5
(2)  630/FFFFFFFFC000017E :                     ; ;  		shar	r6
(2)  631/FFFFFFFFC000017E :                     ; ;  		shar	r7
(2)  632/FFFFFFFFC000017E :                     ; 		add 	r5,r2
(2)  633/FFFFFFFFC000017E :                     ; 		add 	r6,r3
(2)  634/FFFFFFFFC000017E :                     ; 		add 	r7,r4
(2)  635/FFFFFFFFC000017E :                     ;
(2)  636/FFFFFFFFC000017E :                     ; 	; Include camera changes
(2)  637/FFFFFFFFC000017E :                     ; 		mov 	#RAM_Mars_ObjCamera,r11
(2)  638/FFFFFFFFC000017E :                     ; 		mov	@(cam_x_pos,r11),r5
(2)  639/FFFFFFFFC000017E :                     ; 		mov	@(cam_y_pos,r11),r6
(2)  640/FFFFFFFFC000017E :                     ; 		mov	@(cam_z_pos,r11),r7
(2)  641/FFFFFFFFC000017E :                     ; ; 		shlr	r5
(2)  642/FFFFFFFFC000017E :                     ; ; 		shlr	r6
(2)  643/FFFFFFFFC000017E :                     ; ; 		shlr	r7
(2)  644/FFFFFFFFC000017E :                     ; 		exts	r5,r5
(2)  645/FFFFFFFFC000017E :                     ; 		exts	r6,r6
(2)  646/FFFFFFFFC000017E :                     ; 		exts	r7,r7
(2)  647/FFFFFFFFC000017E :                     ; 		sub 	r5,r2
(2)  648/FFFFFFFFC000017E :                     ; 		sub 	r6,r3
(2)  649/FFFFFFFFC000017E :                     ; 		add 	r7,r4
(2)  650/FFFFFFFFC000017E :                     ;
(2)  651/FFFFFFFFC000017E :                     ; 		mov	r2,r5
(2)  652/FFFFFFFFC000017E :                     ; 		mov	r4,r6
(2)  653/FFFFFFFFC000017E :                     ;   		mov 	@(cam_x_rot,r11),r0
(2)  654/FFFFFFFFC000017E :                     ; ;   		shlr2	r0
(2)  655/FFFFFFFFC000017E :                     ; ;   		shlr	r0
(2)  656/FFFFFFFFC000017E :                     ;   		bsr	mdlrd_rotate
(2)  657/FFFFFFFFC000017E :                     ; 		shlr2	r0
(2)  658/FFFFFFFFC000017E :                     ;    		mov	r7,r2
(2)  659/FFFFFFFFC000017E :                     ;    		mov	r8,r4
(2)  660/FFFFFFFFC000017E :                     ;    		mov	r3,r5
(2)  661/FFFFFFFFC000017E :                     ;   		mov	r8,r6
(2)  662/FFFFFFFFC000017E :                     ;   		mov 	@(cam_y_rot,r11),r0
(2)  663/FFFFFFFFC000017E :                     ; ;   		shlr2	r0
(2)  664/FFFFFFFFC000017E :                     ; ;   		shlr	r0
(2)  665/FFFFFFFFC000017E :                     ;   		bsr	mdlrd_rotate
(2)  666/FFFFFFFFC000017E :                     ; 		shlr2	r0
(2)  667/FFFFFFFFC000017E :                     ;    		mov	r8,r4
(2)  668/FFFFFFFFC000017E :                     ;    		mov	r2,r5
(2)  669/FFFFFFFFC000017E :                     ;    		mov	r7,r6
(2)  670/FFFFFFFFC000017E :                     ;    		mov 	@(cam_z_rot,r11),r0
(2)  671/FFFFFFFFC000017E :                     ; ;   		shlr2	r0
(2)  672/FFFFFFFFC000017E :                     ; ;   		shlr	r0
(2)  673/FFFFFFFFC000017E :                     ;   		bsr	mdlrd_rotate
(2)  674/FFFFFFFFC000017E :                     ; 		shlr2	r0
(2)  675/FFFFFFFFC000017E :                     ;    		mov	r7,r2
(2)  676/FFFFFFFFC000017E :                     ;    		mov	r8,r3
(2)  677/FFFFFFFFC000017E :                     ;
(2)  678/FFFFFFFFC000017E :                     ; 	; Weak perspective projection
(2)  679/FFFFFFFFC000017E :                     ; 	; this is the best I got,
(2)  680/FFFFFFFFC000017E :                     ; 	; It breaks on large faces
(2)  681/FFFFFFFFC000017E :                     ; 		mov	#320<<16,r7
(2)  682/FFFFFFFFC000017E :                     ; 		neg	r4,r0		; reverse Z
(2)  683/FFFFFFFFC000017E :                     ; 		cmp/pl	r0
(2)  684/FFFFFFFFC000017E :                     ; 		bt	.inside
(2)  685/FFFFFFFFC000017E :                     ; 		mov	#1,r0
(2)  686/FFFFFFFFC000017E :                     ; 		shlr2	r7
(2)  687/FFFFFFFFC000017E :                     ; 		shlr2	r7
(2)  688/FFFFFFFFC000017E :                     ; ; 		shlr	r7
(2)  689/FFFFFFFFC000017E :                     ; ; 		dmuls	r7,r2
(2)  690/FFFFFFFFC000017E :                     ; ; 		sts	mach,r0
(2)  691/FFFFFFFFC000017E :                     ; ; 		sts	macl,r2
(2)  692/FFFFFFFFC000017E :                     ; ; 		xtrct	r0,r2
(2)  693/FFFFFFFFC000017E :                     ; ; 		dmuls	r7,r3
(2)  694/FFFFFFFFC000017E :                     ; ; 		sts	mach,r0
(2)  695/FFFFFFFFC000017E :                     ; ; 		sts	macl,r3
(2)  696/FFFFFFFFC000017E :                     ; ; 		xtrct	r0,r3
(2)  697/FFFFFFFFC000017E :                     ; 		bra	.zmulti
(2)  698/FFFFFFFFC000017E :                     ; 		nop
(2)  699/FFFFFFFFC000017E :                     ; .inside:
(2)  700/FFFFFFFFC000017E :                     ; 		mov 	#_JR,r9
(2)  701/FFFFFFFFC000017E :                     ; 		mov 	r0,@r9
(2)  702/FFFFFFFFC000017E :                     ; 		mov 	r7,@(4,r9)
(2)  703/FFFFFFFFC000017E :                     ; 		nop
(2)  704/FFFFFFFFC000017E :                     ; 		mov 	@(4,r9),r7
(2)  705/FFFFFFFFC000017E :                     ; .zmulti:
(2)  706/FFFFFFFFC000017E :                     ; 		dmuls	r7,r2
(2)  707/FFFFFFFFC000017E :                     ; 		sts	mach,r0
(2)  708/FFFFFFFFC000017E :                     ; 		sts	macl,r2
(2)  709/FFFFFFFFC000017E :                     ; 		xtrct	r0,r2
(2)  710/FFFFFFFFC000017E :                     ; 		dmuls	r7,r3
(2)  711/FFFFFFFFC000017E :                     ; 		sts	mach,r0
(2)  712/FFFFFFFFC000017E :                     ; 		sts	macl,r3
(2)  713/FFFFFFFFC000017E :                     ; 		xtrct	r0,r3
(2)  714/FFFFFFFFC000017E :                     ;
(2)  715/FFFFFFFFC000017E :                     ; 		mov	#Cach_BkupPnt_L,r0
(2)  716/FFFFFFFFC000017E :                     ; 		mov	@r0+,r11
(2)  717/FFFFFFFFC000017E :                     ; 		mov	@r0+,r10
(2)  718/FFFFFFFFC000017E :                     ; 		mov	@r0+,r9
(2)  719/FFFFFFFFC000017E :                     ; 		mov	@r0+,r8
(2)  720/FFFFFFFFC000017E :                     ; 		mov	@r0+,r7
(2)  721/FFFFFFFFC000017E :                     ; 		mov	@r0+,r6
(2)  722/FFFFFFFFC000017E :                     ; 		mov	@r0+,r5
(2)  723/FFFFFFFFC000017E :                     ; 		lds	@r0+,pr
(2)  724/FFFFFFFFC000017E :                     ;
(2)  725/FFFFFFFFC000017E :                     ; 	; Set the most far points
(2)  726/FFFFFFFFC000017E :                     ; 	; for each direction (X,Y,Z)
(2)  727/FFFFFFFFC000017E :                     ; 		cmp/gt	r13,r4
(2)  728/FFFFFFFFC000017E :                     ; 		bf	.save_z2
(2)  729/FFFFFFFFC000017E :                     ; 		mov	r4,r13
(2)  730/FFFFFFFFC000017E :                     ; .save_z2:
(2)  731/FFFFFFFFC000017E :                     ; 		cmp/gt	r5,r4
(2)  732/FFFFFFFFC000017E :                     ; 		bt	.save_z
(2)  733/FFFFFFFFC000017E :                     ; 		mov	r4,r5
(2)  734/FFFFFFFFC000017E :                     ; .save_z:
(2)  735/FFFFFFFFC000017E :                     ; 		cmp/gt	r8,r2
(2)  736/FFFFFFFFC000017E :                     ; 		bf	.x_lw
(2)  737/FFFFFFFFC000017E :                     ; 		mov	r2,r8
(2)  738/FFFFFFFFC000017E :                     ; .x_lw:
(2)  739/FFFFFFFFC000017E :                     ; 		cmp/gt	r9,r2
(2)  740/FFFFFFFFC000017E :                     ; 		bt	.x_rw
(2)  741/FFFFFFFFC000017E :                     ; 		mov	r2,r9
(2)  742/FFFFFFFFC000017E :                     ; .x_rw:
(2)  743/FFFFFFFFC000017E :                     ; 		cmp/gt	r11,r3
(2)  744/FFFFFFFFC000017E :                     ; 		bf	.y_lw
(2)  745/FFFFFFFFC000017E :                     ; 		mov	r3,r11
(2)  746/FFFFFFFFC000017E :                     ; .y_lw:
(2)  747/FFFFFFFFC000017E :                     ; 		cmp/gt	r12,r3
(2)  748/FFFFFFFFC000017E :                     ; 		bt	.y_rw
(2)  749/FFFFFFFFC000017E :                     ; 		mov	r3,r12
(2)  750/FFFFFFFFC000017E :                     ; .y_rw:
(2)  751/FFFFFFFFC000017E :                     ; 		rts
(2)  752/FFFFFFFFC000017E :                     ; 		nop
(2)  753/FFFFFFFFC000017E :                     ; 		align 4
(2)  754/FFFFFFFFC000017E :                     ; 		ltorg
(2)  755/FFFFFFFFC000017E :                     ;
(2)  756/FFFFFFFFC000017E :                     ; ; ------------------------------
(2)  757/FFFFFFFFC000017E :                     ; ; Rotate point
(2)  758/FFFFFFFFC000017E :                     ; ;
(2)  759/FFFFFFFFC000017E :                     ; ; Entry:
(2)  760/FFFFFFFFC000017E :                     ; ; r5: x
(2)  761/FFFFFFFFC000017E :                     ; ; r6: y
(2)  762/FFFFFFFFC000017E :                     ; ; r0: theta
(2)  763/FFFFFFFFC000017E :                     ; ;
(2)  764/FFFFFFFFC000017E :                     ; ; Returns:
(2)  765/FFFFFFFFC000017E :                     ; ; r7: (x  cos @) + (y sin @)
(2)  766/FFFFFFFFC000017E :                     ; ; r8: (x -sin @) + (y cos @)
(2)  767/FFFFFFFFC000017E :                     ; ; ------------------------------
(2)  768/FFFFFFFFC000017E :                     ;
(2)  769/FFFFFFFFC000017E :                     ; 		align 4
(2)  770/FFFFFFFFC000017E :                     ; mdlrd_rotate:
(2)  771/FFFFFFFFC000017E :                     ;     		mov	#$7FF,r7
(2)  772/FFFFFFFFC000017E :                     ;     		and	r7,r0
(2)  773/FFFFFFFFC000017E :                     ;    		shll2	r0
(2)  774/FFFFFFFFC000017E :                     ; 		mov	#sin_table,r7
(2)  775/FFFFFFFFC000017E :                     ; 		mov	#sin_table+$800,r8
(2)  776/FFFFFFFFC000017E :                     ; 		mov	@(r0,r7),r9
(2)  777/FFFFFFFFC000017E :                     ; 		mov	@(r0,r8),r10
(2)  778/FFFFFFFFC000017E :                     ;
(2)  779/FFFFFFFFC000017E :                     ; 		dmuls	r5,r10		; x cos @
(2)  780/FFFFFFFFC000017E :                     ; 		sts	macl,r7
(2)  781/FFFFFFFFC000017E :                     ; 		sts	mach,r0
(2)  782/FFFFFFFFC000017E :                     ; 		xtrct	r0,r7
(2)  783/FFFFFFFFC000017E :                     ; 		dmuls	r6,r9		; y sin @
(2)  784/FFFFFFFFC000017E :                     ; 		sts	macl,r8
(2)  785/FFFFFFFFC000017E :                     ; 		sts	mach,r0
(2)  786/FFFFFFFFC000017E :                     ; 		xtrct	r0,r8
(2)  787/FFFFFFFFC000017E :                     ; 		add	r8,r7
(2)  788/FFFFFFFFC000017E :                     ;
(2)  789/FFFFFFFFC000017E :                     ; 		neg	r9,r9
(2)  790/FFFFFFFFC000017E :                     ; 		dmuls	r5,r9		; x -sin @
(2)  791/FFFFFFFFC000017E :                     ; 		sts	macl,r8
(2)  792/FFFFFFFFC000017E :                     ; 		sts	mach,r0
(2)  793/FFFFFFFFC000017E :                     ; 		xtrct	r0,r8
(2)  794/FFFFFFFFC000017E :                     ; 		dmuls	r6,r10		; y cos @
(2)  795/FFFFFFFFC000017E :                     ; 		sts	macl,r9
(2)  796/FFFFFFFFC000017E :                     ; 		sts	mach,r0
(2)  797/FFFFFFFFC000017E :                     ; 		xtrct	r0,r9
(2)  798/FFFFFFFFC000017E :                     ; 		add	r9,r8
(2)  799/FFFFFFFFC000017E :                     ;  		rts
(2)  800/FFFFFFFFC000017E :                     ; 		nop
(2)  801/FFFFFFFFC000017E :                     ; 		align 4
(2)  802/FFFFFFFFC000017E :                     ; 		ltorg
(2)  803/FFFFFFFFC000017E :                     
(2)  804/FFFFFFFFC000017E :                     ; ------------------------------------------------
(2)  805/FFFFFFFFC000017E :                     
(2)  806/FFFFFFFFC000017E :                     			align 4
(2)  807/FFFFFFFFC0000180 :                     ; Cach_BkupPnt_L		ds.l 8				; **
(2)  808/FFFFFFFFC0000180 :                     ; Cach_BkupPnt_S		ds.l 0				; <-- Reads backwards
(2)  809/FFFFFFFFC0000180 :                     Cach_BkupS_L		ds.l 5				; **
(2)  810/FFFFFFFFC0000194 :                     Cach_BkupS_S		ds.l 0				; <-- Reads backwards
(2)  811/FFFFFFFFC0000194 :                     Cach_SlvStack_L		ds.l 10				; **
(2)  812/FFFFFFFFC00001BC :                     Cach_SlvStack_S		ds.l 0				; <-- Reads backwards
(2)  813/FFFFFFFFC00001BC :                     MarsSnd_RvMode		ds.l 1				; ROM RV protection flag
(2)  814/FFFFFFFFC00001C0 :                     MarsSnd_PwmControl	ds.b 8*7			; 8 bytes per channel.
(2)  815/FFFFFFFFC00001F8 :                     MarsSnd_PwmChnls	ds.b sizeof_sndchn*MAX_PWMCHNL
(2)  816/FFFFFFFFC0000310 :                     
(2)  817/FFFFFFFFC0000310 :                     ; ------------------------------------------------
(2)  818/ 600288C :                     .end:		phase CACHE_SLAVE+.end&$1FFF
(2)  819/ 600288C :                     
(2)  820/ 600288C :                     		align 4
(2)  821/ 600288C :                     CACHE_SLAVE_E:
(2)  825/ 600288C :                     
(1) 2449/ 600288C :                     
(1) 2450/ 600288C :                     ; ====================================================================
(1) 2451/ 600288C :                     ; ----------------------------------------------------------------
(1) 2452/ 600288C :                     ; Data
(1) 2453/ 600288C :                     ; ----------------------------------------------------------------
(1) 2454/ 600288C :                     
(1) 2455/ 600288C :                     		align 4
(1) 2456/ 600288C :                     sin_table	binclude "system/mars/data/sinedata.bin"
(1) 2457/ 600508C :                     m_ascii		binclude "system/mars/data/m_ascii.bin"
(1) 2458/ 600688C :                     
(1) 2459/ 600688C :                     		align 4
(1) 2460/ 600688C :                     		include "data/mars_sdram.asm"
(2)    1/ 600688C :                     ; ====================================================================
(2)    2/ 600688C :                     ; ----------------------------------------------------------------
(2)    3/ 600688C :                     ; SH2 SDRAM data
(2)    4/ 600688C :                     ; 
(2)    5/ 600688C :                     ; This data is stored on SDRAM, always available to use on the 32X
(2)    6/ 600688C :                     ; side and can be rewritible, but it is smaller than ROM
(2)    7/ 600688C :                     ;
(2)    8/ 600688C :                     ; PWM samples can be used here but those take a lot of space...
(2)    9/ 600688C :                     ; use ROM (mars_rom.asm) instead, those are RV-protected on SH2
(2)   10/ 600688C :                     ; ----------------------------------------------------------------
(2)   11/ 600688C :                     
(2)   12/ 600688C :                     		align 4
(2)   13/ 600688C :                     
(2)   14/ 600688C :                     ; 		align 4
(2)   15/ 600688C :                     ; 		include "data/maps/mars/mcity/map_incl.asm"
(2)   16/ 600688C :                     ; 		align 4
(2)   17/ 600688C :                     
(1) 2461/ 600688C :                     
(1) 2462/ 600688C :                     ; ====================================================================
(1) 2463/ 600688C :                     ; ----------------------------------------------------------------
(1) 2464/ 600688C :                     ; MARS SH2 RAM
(1) 2465/ 600688C :                     ; ----------------------------------------------------------------
(1) 2466/ 600688C :                     
(1) 2467/ 600688C :                     		align $10
(1) 2468/ 6006890 :                     SH2_RAM:
(1) 2469/ 6006890 : (MACRO)             		struct SH2_RAM|TH
(1) 2469/ 6006890 : =$6006890           GLBL_LASTPC     set *
(1) 2469/   4FC70 :                                     dephase
(1) 2469/   4FC70 : =$4FC70             GLBL_LASTORG    set *
(1) 2469/26006890 :                                     phase SH2_RAM|TH
(1) 2476/26006890 :                     MarsRam_System		ds.b (sizeof_marssys-MarsRam_System)
(1) 2477/26007600 :                     MarsRam_Sound		ds.b (sizeof_marssnd-MarsRam_Sound)
(1) 2478/26007980 :                     MarsRam_Video		ds.b (sizeof_marsvid-MarsRam_Video)
(1) 2479/26033980 :                     sizeof_marsram		ds.l 0
(1) 2481/26033980 :                     
(1) 2482/26033980 :                     .here:
(1) 2486/26033980 : (MACRO)             		finish
(1) 2486/26006890 :                                     !org GLBL_LASTORG
(1) 2486/ 6006890 :                                     phase GLBL_LASTPC
(1) 2487/ 6006890 :                     
(1) 2488/ 6006890 :                     ; ====================================================================
(1) 2489/ 6006890 :                     ; ----------------------------------------------------------------
(1) 2490/ 6006890 :                     ; MARS Video RAM
(1) 2491/ 6006890 :                     ;
(1) 2492/ 6006890 :                     ; RAM_Mars_ScrnBuff is recycled for all pseudo-screen modes
(1) 2493/ 6006890 :                     ; ----------------------------------------------------------------
(1) 2494/ 6006890 :                     
(1) 2495/ 6006890 : (MACRO)             			struct MarsRam_Video
(1) 2495/ 6006890 : =$6006890           GLBL_LASTPC     set *
(1) 2495/   4FC70 :                                     dephase
(1) 2495/   4FC70 : =$4FC70             GLBL_LASTORG    set *
(1) 2495/26007980 :                                     phase MARSRAM_VIDEO
(1) 2496/26007980 :                     RAM_Mars_ScrnBuff	ds.b MAX_SCRNBUFF			; Single buffer for all screen modes
(1) 2497/26033980 :                     sizeof_marsvid		ds.l 0
(1) 2498/26033980 : (MACRO)             			finish
(1) 2498/26007980 :                                     !org GLBL_LASTORG
(1) 2498/ 6006890 :                                     phase GLBL_LASTPC
(1) 2499/ 6006890 :                     
(1) 2500/ 6006890 :                     ; --------------------------------------------------------
(1) 2501/ 6006890 :                     ; per-screen RAM
(1) 2502/ 6006890 : (MACRO)             			struct RAM_Mars_ScrnBuff
(1) 2502/ 6006890 : =$6006890           GLBL_LASTPC     set *
(1) 2502/   4FC70 :                                     dephase
(1) 2502/   4FC70 : =$4FC70             GLBL_LASTORG    set *
(1) 2502/26007980 :                                     phase RAM_MARS_SCRNBUFF
(1) 2503/26007980 :                     Cach_DrawTimers		ds.l 4		; Screen draw-request timers, write $02 to these
(1) 2504/26007990 :                     RAM_Mars_ScrlBuff	ds.b sizeof_mscrl*2			; Scrolling buffers
(1) 2505/260079F8 :                     RAM_Mars_ScrlData	ds.b ((320+16)*(224+16))+320
(1) 2506/2601B638 :                     end_scrn02		ds.l 0
(1) 2507/2601B638 : (MACRO)             			finish
(1) 2507/26007980 :                                     !org GLBL_LASTORG
(1) 2507/ 6006890 :                                     phase GLBL_LASTPC
(1) 2508/ 6006890 : (MACRO)             			struct RAM_Mars_ScrnBuff
(1) 2508/ 6006890 : =$6006890           GLBL_LASTPC     set *
(1) 2508/   4FC70 :                                     dephase
(1) 2508/   4FC70 : =$4FC70             GLBL_LASTORG    set *
(1) 2508/26007980 :                                     phase RAM_MARS_SCRNBUFF
(1) 2509/26007980 :                     RAM_Mars_SVdpDrwList	ds.b sizeof_plypz*MAX_SVDP_PZ	; Sprites / Polygon pieces
(1) 2510/26014340 :                     RAM_Mars_SVdpDrwList_e	ds.l 0				; (END point label)
(1) 2511/26014340 :                     RAM_Mars_Polygons_0	ds.b sizeof_polygn*MAX_FACES	; Read/Write polygon data
(1) 2512/260219A0 :                     RAM_Mars_Polygons_1	ds.b sizeof_polygn*MAX_FACES
(1) 2513/2602F000 :                     RAM_Mars_PlgnList_0	ds.l MAX_FACES*2		; Polygon order list: Zpos, pointer
(1) 2514/26030EA0 :                     RAM_Mars_PlgnList_1	ds.l MAX_FACES*2
(1) 2515/26032D40 :                     RAM_Mars_PlgnNum_0	ds.l 1				; Number of polygons to process
(1) 2516/26032D44 :                     RAM_Mars_PlgnNum_1	ds.l 1
(1) 2517/26032D48 :                     RAM_Mars_Objects	ds.b sizeof_mdlobj*MAX_MODELS	; Slave's Objects
(1) 2518/26032EC8 :                     RAM_Mars_ObjCamera	ds.b sizeof_camera		; Slave's Camera
(1) 2519/26032EE0 :                     sizeof_scrn04		ds.l 0
(1) 2520/26032EE0 : (MACRO)             			finish
(1) 2520/26007980 :                                     !org GLBL_LASTORG
(1) 2520/ 6006890 :                                     phase GLBL_LASTPC
(1) 2528/ 6006890 :                     
(1) 2529/ 6006890 :                     ; ====================================================================
(1) 2530/ 6006890 :                     ; ----------------------------------------------------------------
(1) 2531/ 6006890 :                     ; MARS Sound RAM
(1) 2532/ 6006890 :                     ; ----------------------------------------------------------------
(1) 2533/ 6006890 :                     
(1) 2534/ 6006890 : (MACRO)             			struct MarsRam_Sound
(1) 2534/ 6006890 : =$6006890           GLBL_LASTPC     set *
(1) 2534/   4FC70 :                                     dephase
(1) 2534/   4FC70 : =$4FC70             GLBL_LASTORG    set *
(1) 2534/26007600 :                                     phase MARSRAM_SOUND
(1) 2535/26007600 :                     MarsSnd_PwmCache	ds.b $80*MAX_PWMCHNL
(1) 2536/26007980 :                     sizeof_marssnd		ds.l 0
(1) 2537/26007980 : (MACRO)             			finish
(1) 2537/26007600 :                                     !org GLBL_LASTORG
(1) 2537/ 6006890 :                                     phase GLBL_LASTPC
(1) 2538/ 6006890 :                     
(1) 2539/ 6006890 :                     ; ====================================================================
(1) 2540/ 6006890 :                     ; ----------------------------------------------------------------
(1) 2541/ 6006890 :                     ; MARS System RAM
(1) 2542/ 6006890 :                     ; ----------------------------------------------------------------
(1) 2543/ 6006890 :                     
(1) 2544/ 6006890 : (MACRO)             			struct MarsRam_System
(1) 2544/ 6006890 : =$6006890           GLBL_LASTPC     set *
(1) 2544/   4FC70 :                                     dephase
(1) 2544/   4FC70 : =$4FC70             GLBL_LASTORG    set *
(1) 2544/26006890 :                                     phase MARSRAM_SYSTEM
(1) 2545/26006890 :                     RAM_Mars_DreqDma	ds.b sizeof_dreq	; DREQ data from Genesis ***DO NOT READ FROM HERE***
(1) 2546/26006EE8 :                     RAM_Mars_DreqRead	ds.b sizeof_dreq	; Copy of DREQ for reading.
(1) 2547/26007540 :                     RAM_Mars_Global		ds.l sizeof_MarsGbl	; gbr values go here
(1) 2548/26007600 :                     sizeof_marssys		ds.l 0
(1) 2549/26007600 : (MACRO)             			finish
(1) 2549/26006890 :                                     !org GLBL_LASTORG
(1) 2549/ 6006890 :                                     phase GLBL_LASTPC
(1) 2550/ 6006890 :                     
(1) 2551/ 6006890 :                     ; ====================================================================
(1) 2552/ 6006890 :                     
(1) 2553/ 6006890 :                     
(1) 2554/ 6006890 :                     
     159/ 6006890 :                     		cpu 68000
     160/ 6006890 :                     		padding off
     161/   4FC70 :                     		dephase
     162/   4FC70 :                     MARS_RAMDATA_E:
     163/   4FC70 :                     		align 4
     164/   4FC70 :                     
     165/   4FC70 :                     ; ====================================================================
     166/   4FC70 :                     ; --------------------------------------------------------
     167/   4FC70 :                     ; 32X data for SH2's ROM view
     168/   4FC70 :                     ; This section will be gone if RV bit is set to 1
     169/   4FC70 :                     ; --------------------------------------------------------
     170/   4FC70 :                     
     171/ 204FC70 :                     		phase CS1+*
     172/ 204FC70 :                     		align 4
     173/ 204FC70 :                     		include "sound/smpl_pwm.asm"		; GEMA: PWM samples
(1)    1/ 204FC70 :                     ; ====================================================================
(1)    2/ 204FC70 :                     ; PWM samples
(1)    3/ 204FC70 :                     ;
(1)    4/ 204FC70 :                     ; For SH2's visible areas: ROM ($02000000) or SDRAM ($06000000)
(1)    5/ 204FC70 :                     ;
(1)    6/ 204FC70 :                     ; - SDRAM is safest but it has very LOW storage
(1)    7/ 204FC70 :                     ; - ROM area can use all the 4 Megabytes of storage, BUT when the
(1)    8/ 204FC70 :                     ; RV bit is set: the sample data will be lost. Luckily
(1)    9/ 204FC70 :                     ; a "Wave-backup" feature is implemented to copy a small
(1)   10/ 204FC70 :                     ; amount of bytes of the sample data into a safe place for playback
(1)   11/ 204FC70 :                     ; while RV bit is active.
(1)   12/ 204FC70 :                     ;
(1)   13/ 204FC70 :                     ; Do note that if the RV bit stays active too long it will ran out of
(1)   14/ 204FC70 :                     ; backup data and the sample will play trash bytes.
(1)   15/ 204FC70 :                     ;
(1)   16/ 204FC70 :                     ; SAMPLE DATA IS 8-BIT WAV, THIS INCLUDES STEREO SAMPLES
(1)   17/ 204FC70 :                     ; ====================================================================
(1)   18/ 204FC70 :                     
(1)   19/ 204FC70 :                     	align 4		; First align
(1)   20/ 204FC70 :                     SmpIns_Bell_Ice:
(1)   21/ 204FC70 : (MACRO)             	gSmpHead .end-.start,0
(1)   21/ 204FC70 : 263B 00                     dc.b ((.END-.START)&$FF),(((.END-.START)>>8)&$FF),(((.END-.START)>>16)&$FF)     ; length
(1)   21/ 204FC73 : 0000 00                     dc.b ((0)&$FF),(((0)>>8)&$FF),(((0)>>16)&$FF)
(1)   22/ 204FC76 :                     .start:	binclude "sound/instr/smpl/bell_ice.wav",$2C
(1)   23/ 205379A :                     	align 4
(1)   24/ 205379C :                     .end:
(1)   25/ 205379C :                     
(1)   26/ 205379C :                     SmpIns_Brass1_Hi:
(1)   27/ 205379C : (MACRO)             	gSmpHead .end-.start,0
(1)   27/ 205379C : C67B 00                     dc.b ((.END-.START)&$FF),(((.END-.START)>>8)&$FF),(((.END-.START)>>16)&$FF)     ; length
(1)   27/ 205379F : 0000 00                     dc.b ((0)&$FF),(((0)>>8)&$FF),(((0)>>16)&$FF)
(1)   28/ 20537A2 :                     .start:	binclude "sound/instr/smpl/brass1_hi.wav",$2C
(1)   29/ 205B366 :                     	align 4
(1)   30/ 205B368 :                     .end:
(1)   31/ 205B368 :                     
(1)   32/ 205B368 :                     SmpIns_Brass1_Low:
(1)   33/ 205B368 : (MACRO)             	gSmpHead .end-.start,0
(1)   33/ 205B368 : C67B 00                     dc.b ((.END-.START)&$FF),(((.END-.START)>>8)&$FF),(((.END-.START)>>16)&$FF)     ; length
(1)   33/ 205B36B : 0000 00                     dc.b ((0)&$FF),(((0)>>8)&$FF),(((0)>>16)&$FF)
(1)   34/ 205B36E :                     .start:	binclude "sound/instr/smpl/brass1_low.wav",$2C
(1)   35/ 2062F32 :                     	align 4
(1)   36/ 2062F34 :                     .end:
(1)   37/ 2062F34 :                     
(1)   38/ 2062F34 :                     SmpIns_Forest_1:
(1)   39/ 2062F34 : (MACRO)             	gSmpHead .end-.start,0
(1)   39/ 2062F34 : E648 00                     dc.b ((.END-.START)&$FF),(((.END-.START)>>8)&$FF),(((.END-.START)>>16)&$FF)     ; length
(1)   39/ 2062F37 : 0000 00                     dc.b ((0)&$FF),(((0)>>8)&$FF),(((0)>>16)&$FF)
(1)   40/ 2062F3A :                     .start:	binclude "sound/instr/smpl/forest1.wav",$2C
(1)   41/ 2067820 :                     	align 4
(1)   42/ 2067820 :                     .end:
(1)   43/ 2067820 :                     
(1)   44/ 2067820 :                     SmpIns_Kick_jam:
(1)   45/ 2067820 : (MACRO)             	gSmpHead .end-.start,0
(1)   45/ 2067820 : C60A 00                     dc.b ((.END-.START)&$FF),(((.END-.START)>>8)&$FF),(((.END-.START)>>16)&$FF)     ; length
(1)   45/ 2067823 : 0000 00                     dc.b ((0)&$FF),(((0)>>8)&$FF),(((0)>>16)&$FF)
(1)   46/ 2067826 :                     .start:	binclude "sound/instr/smpl/kick_jam.wav",$2C
(1)   47/ 20682EA :                     	align 4
(1)   48/ 20682EC :                     .end:
(1)   49/ 20682EC :                     
(1)   50/ 20682EC :                     SmpIns_Snare_jam:
(1)   51/ 20682EC : (MACRO)             	gSmpHead .end-.start,0
(1)   51/ 20682EC : 6609 00                     dc.b ((.END-.START)&$FF),(((.END-.START)>>8)&$FF),(((.END-.START)>>16)&$FF)     ; length
(1)   51/ 20682EF : 0000 00                     dc.b ((0)&$FF),(((0)>>8)&$FF),(((0)>>16)&$FF)
(1)   52/ 20682F2 :                     .start:	binclude "sound/instr/smpl/snare_jam.wav",$2C
(1)   53/ 2068C56 :                     	align 4
(1)   54/ 2068C58 :                     .end:
(1)   55/ 2068C58 :                     
(1)   56/ 2068C58 :                     SmpIns_SnrTom_1:
(1)   57/ 2068C58 : (MACRO)             	gSmpHead .end-.start,0
(1)   57/ 2068C58 : A214 00                     dc.b ((.END-.START)&$FF),(((.END-.START)>>8)&$FF),(((.END-.START)>>16)&$FF)     ; length
(1)   57/ 2068C5B : 0000 00                     dc.b ((0)&$FF),(((0)>>8)&$FF),(((0)>>16)&$FF)
(1)   58/ 2068C5E :                     .start:	binclude "sound/instr/smpl/snrtom_1.wav",$2C
(1)   59/ 206A0FE :                     	align 4
(1)   60/ 206A100 :                     .end:
(1)   61/ 206A100 :                     
(1)   62/ 206A100 :                     SmpIns_PIANO_1:
(1)   63/ 206A100 : (MACRO)             	gSmpHead .end-.start,0
(1)   63/ 206A100 : 1647 00                     dc.b ((.END-.START)&$FF),(((.END-.START)>>8)&$FF),(((.END-.START)>>16)&$FF)     ; length
(1)   63/ 206A103 : 0000 00                     dc.b ((0)&$FF),(((0)>>8)&$FF),(((0)>>16)&$FF)
(1)   64/ 206A106 :                     .start:	binclude "sound/instr/smpl/PIANO__1.wav",$2C
(1)   65/ 206E81A :                     	align 4
(1)   66/ 206E81C :                     .end:
(1)   67/ 206E81C :                     
(1)   68/ 206E81C :                     SmpIns_SSTR162A:
(1)   69/ 206E81C : (MACRO)             	gSmpHead .end-.start,0
(1)   69/ 206E81C : 6627 00                     dc.b ((.END-.START)&$FF),(((.END-.START)>>8)&$FF),(((.END-.START)>>16)&$FF)     ; length
(1)   69/ 206E81F : 0000 00                     dc.b ((0)&$FF),(((0)>>8)&$FF),(((0)>>16)&$FF)
(1)   70/ 206E822 :                     .start:	binclude "sound/instr/smpl/SSTR162A.wav",$2C
(1)   71/ 2070F86 :                     	align 4
(1)   72/ 2070F88 :                     .end:
(1)   73/ 2070F88 :                     
(1)   74/ 2070F88 :                     SmpIns_Nadie:
(1)   75/ 2070F88 : (MACRO)             	gSmpHead .end-.start,0
(1)   75/ 2070F88 : 7668 02                     dc.b ((.END-.START)&$FF),(((.END-.START)>>8)&$FF),(((.END-.START)>>16)&$FF)     ; length
(1)   75/ 2070F8B : 0000 00                     dc.b ((0)&$FF),(((0)>>8)&$FF),(((0)>>16)&$FF)
(1)   76/ 2070F8E :                     .start:	binclude "sound/instr/smpl/nadie_st.wav",$2C
(1)   77/ 2097802 :                     	align 4
(1)   78/ 2097804 :                     .end:
(1)   79/ 2097804 :                     
(1)   80/ 2097804 :                     SmpIns_PKick:
(1)   81/ 2097804 : (MACRO)             	gSmpHead .end-.start,0
(1)   81/ 2097804 : 7607 00                     dc.b ((.END-.START)&$FF),(((.END-.START)>>8)&$FF),(((.END-.START)>>16)&$FF)     ; length
(1)   81/ 2097807 : 0000 00                     dc.b ((0)&$FF),(((0)>>8)&$FF),(((0)>>16)&$FF)
(1)   82/ 209780A :                     .start:	binclude "sound/instr/smpl/wegot_kick.wav",$2C
(1)   83/ 2097F7E :                     	align 4
(1)   84/ 2097F80 :                     .end:
(1)   85/ 2097F80 :                     
(1)   86/ 2097F80 :                     SmpIns_PTom:
(1)   87/ 2097F80 : (MACRO)             	gSmpHead .end-.start,0
(1)   87/ 2097F80 : BA0B 00                     dc.b ((.END-.START)&$FF),(((.END-.START)>>8)&$FF),(((.END-.START)>>16)&$FF)     ; length
(1)   87/ 2097F83 : 0000 00                     dc.b ((0)&$FF),(((0)>>8)&$FF),(((0)>>16)&$FF)
(1)   88/ 2097F86 :                     .start:	binclude "sound/instr/smpl/sauron_tom.wav",$2C
(1)   89/ 2098B40 :                     	align 4
(1)   90/ 2098B40 :                     .end:
(1)   91/ 2098B40 :                     
(1)   92/ 2098B40 :                     SmpIns_Piano:
(1)   93/ 2098B40 : (MACRO)             	gSmpHead .end-.start,0
(1)   93/ 2098B40 : F661 00                     dc.b ((.END-.START)&$FF),(((.END-.START)>>8)&$FF),(((.END-.START)>>16)&$FF)     ; length
(1)   93/ 2098B43 : 0000 00                     dc.b ((0)&$FF),(((0)>>8)&$FF),(((0)>>16)&$FF)
(1)   94/ 2098B46 :                     .start:	binclude "sound/instr/smpl/piano_1.wav",$2C
(1)   95/ 209ED3C :                     	align 4
(1)   96/ 209ED3C :                     .end:
(1)   97/ 209ED3C :                     
(1)   98/ 209ED3C :                     
(1)   99/ 209ED3C :                     ; MOVEME
(1)  100/ 209ED3C :                     SmpIns_MoveMe_Hit:
(1)  101/ 209ED3C : (MACRO)             	gSmpHead .end-.start,0
(1)  101/ 209ED3C : B62E 00                     dc.b ((.END-.START)&$FF),(((.END-.START)>>8)&$FF),(((.END-.START)>>16)&$FF)     ; length
(1)  101/ 209ED3F : 0000 00                     dc.b ((0)&$FF),(((0)>>8)&$FF),(((0)>>16)&$FF)
(1)  102/ 209ED42 :                     .start:	binclude "sound/instr/smpl/moveme_hit.wav",$2C
(1)  103/ 20A1BF8 :                     	align 4
(1)  104/ 20A1BF8 :                     .end:
(1)  105/ 20A1BF8 :                     SmpIns_MoveMe_Brass:
(1)  106/ 20A1BF8 : (MACRO)             	gSmpHead .end-.start,6478
(1)  106/ 20A1BF8 : 6629 01                     dc.b ((.END-.START)&$FF),(((.END-.START)>>8)&$FF),(((.END-.START)>>16)&$FF)     ; length
(1)  106/ 20A1BFB : 4E19 00                     dc.b ((6478)&$FF),(((6478)>>8)&$FF),(((6478)>>16)&$FF)
(1)  107/ 20A1BFE :                     .start:	binclude "sound/instr/smpl/brass_moveme.wav",$2C
(1)  108/ 20B4562 :                     	align 4
(1)  109/ 20B4564 :                     .end:
(1)  110/ 20B4564 :                     SmpIns_Kick:
(1)  111/ 20B4564 : (MACRO)             	gSmpHead .end-.start,0
(1)  111/ 20B4564 : FA19 00                     dc.b ((.END-.START)&$FF),(((.END-.START)>>8)&$FF),(((.END-.START)>>16)&$FF)     ; length
(1)  111/ 20B4567 : 0000 00                     dc.b ((0)&$FF),(((0)>>8)&$FF),(((0)>>16)&$FF)
(1)  112/ 20B456A :                     .start:	binclude "sound/instr/smpl/kick_moveme.wav",$2C
(1)  113/ 20B5F64 :                     	align 4
(1)  114/ 20B5F64 :                     .end:
(1)  115/ 20B5F64 :                     SmpIns_Snare:
(1)  116/ 20B5F64 : (MACRO)             	gSmpHead .end-.start,0
(1)  116/ 20B5F64 : 361A 00                     dc.b ((.END-.START)&$FF),(((.END-.START)>>8)&$FF),(((.END-.START)>>16)&$FF)     ; length
(1)  116/ 20B5F67 : 0000 00                     dc.b ((0)&$FF),(((0)>>8)&$FF),(((0)>>16)&$FF)
(1)  117/ 20B5F6A :                     .start:	binclude "sound/instr/smpl/snare_moveme.wav",$2C
(1)  118/ 20B799E :                     	align 4
(1)  119/ 20B79A0 :                     .end:
(1)  120/ 20B79A0 :                     
(1)  121/ 20B79A0 :                     SmpIns_MyTime:
(1)  122/ 20B79A0 : (MACRO)             	gSmpHead .end-.start,0
(1)  122/ 20B79A0 : D6AF 00                     dc.b ((.END-.START)&$FF),(((.END-.START)>>8)&$FF),(((.END-.START)>>16)&$FF)     ; length
(1)  122/ 20B79A3 : 0000 00                     dc.b ((0)&$FF),(((0)>>8)&$FF),(((0)>>16)&$FF)
(1)  123/ 20B79A6 :                     .start:	binclude "sound/instr/smpl/mytime.wav",$2C
(1)  124/ 20C297B :                     	align 4
(1)  125/ 20C297C :                     .end:
(1)  126/ 20C297C :                     
     174/ 20C297C :                     		include "data/mars_rom.asm"
(1)    1/ 20C297C :                     ; ====================================================================
(1)    2/ 20C297C :                     ; ----------------------------------------------------------------
(1)    3/ 20C297C :                     ; SH2 ROM data
(1)    4/ 20C297C :                     ;
(1)    5/ 20C297C :                     ; If your data is too much for SDRAM, place it here.
(1)    6/ 20C297C :                     ; BUT keep in mind that this entire section will be gone
(1)    7/ 20C297C :                     ; if the Genesis performs DMA-to-VDP Transfers
(1)    8/ 20C297C :                     ; which requires RV=1 (Revert ROM to original position)
(1)    9/ 20C297C :                     ; ***EMULATORS IGNORE THIS LIMITATION***
(1)   10/ 20C297C :                     ;
(1)   11/ 20C297C :                     ; Only access here on these conditions:
(1)   12/ 20C297C :                     ; - Stop all tracks that use PWM samples
(1)   13/ 20C297C :                     ; - If you wanna keep any tracks active: set 1 to marsBlock
(1)   14/ 20C297C :                     ;   in the Z80 driver, all tracks will continue playing using
(1)   15/ 20C297C :                     ;   only the PSG and FM instruments
(1)   16/ 20C297C :                     ;   (TODO: check how it peforms)
(1)   17/ 20C297C :                     ;
(1)   18/ 20C297C :                     ; The PWM samples are safe to use with the implementation
(1)   19/ 20C297C :                     ; of a sample-backup routine that the 68K requests before
(1)   20/ 20C297C :                     ; doing DMA
(1)   21/ 20C297C :                     ; ----------------------------------------------------------------
(1)   22/ 20C297C :                     
(1)   23/ 20C297C :                     	align 4
(1)   24/ 20C297C :                     
(1)   25/ 20C297C :                     ; --------------------------------------------------------
(1)   26/ 20C297C :                     ; 32X MAP data: Block graphics and Layout
(1)   27/ 20C297C :                     ; --------------------------------------------------------
(1)   28/ 20C297C :                     
(1)   29/ 20C297C :                     		align 4
(1)   30/ 20C297C :                     MapBlk_M:	binclude "data/maps/level0/art_m.bin"
(1)   31/ 20D2A7C :                     		align 4
(1)   32/ 20D2A7C :                     MapFg_M:	binclude "data/maps/level0/fg_main.bin"
(1)   33/ 20D367C :                     		align 4
(1)   34/ 20D367C :                     
(1)   35/ 20D367C :                     ; --------------------------------------------------------
(1)   36/ 20D367C :                     ; Graphics
(1)   37/ 20D367C :                     ; --------------------------------------------------------
(1)   38/ 20D367C :                     
(1)   39/ 20D367C :                     		include "data/mars/graphics.asm"
(2)    1/ 20D367C :                     ; ====================================================================
(2)    2/ 20D367C :                     ; ----------------------------------------------------------------
(2)    3/ 20D367C :                     ; Put your 32X graphics here, indexed or direct
(2)    4/ 20D367C :                     ;
(2)    5/ 20D367C :                     ; These are located on the SH2's ROM area, this will be gone
(2)    6/ 20D367C :                     ; if RV is set to 1
(2)    7/ 20D367C :                     ;
(2)    8/ 20D367C :                     ; Labels MUST be aligned by 4
(2)    9/ 20D367C :                     ; ----------------------------------------------------------------
(2)   10/ 20D367C :                     
(2)   11/ 20D367C :                     		align 4
(2)   12/ 20D367C :                     Textr_marscity:
(2)   13/ 20D367C :                     		binclude "data/maps/mars/mcity/mtrl/marscity_art.bin"
(2)   14/ 211367C :                     		align 4
(2)   15/ 211367C :                     Textr_pecsi:
(2)   16/ 211367C :                     		binclude "data/mars/objects/mtrl/pecsi_art.bin"
(2)   17/ 215367C :                     		align 4
(2)   18/ 215367C :                     
(2)   19/ 215367C :                     SuperSpr_Test:
(2)   20/ 215367C :                     		binclude "data/sprites/mars/nicole/sprites_art.bin"
(2)   21/ 216E67C :                     		align 4
(2)   22/ 216E67C :                     
(1)   40/ 216E67C :                     
(1)   41/ 216E67C :                     ; --------------------------------------------------------
(1)   42/ 216E67C :                     ; Models
(1)   43/ 216E67C :                     ; --------------------------------------------------------
(1)   44/ 216E67C :                     
(1)   45/ 216E67C :                     		align 4
(1)   46/ 216E67C :                     		include "data/maps/mars/mcity/map_incl.asm"
(2)    1/ 216E67C :                     		include "data/maps/mars/mcity/pz/01_main.asm"
(3)    1/ 216E67C :                     MarsMapPz_01_main:
(3)    2/ 216E67C : 00DC 012E           		dc.w 220,302
(3)    3/ 216E680 : 2216 E690 2216 F4B8 		dc.l TH|.vert,TH|.face,TH|.vrtx,TH|.mtrl
                    2216 FE78 2217 0608 
(3)    4/ 216E690 :                     .vert:		binclude "data/maps/mars/mcity/pz/01_main_vert.bin"
(3)    5/ 216F4B8 :                     .face:		binclude "data/maps/mars/mcity/pz/01_main_face.bin"
(3)    6/ 216FE78 :                     .vrtx:		binclude "data/maps/mars/mcity/pz/01_main_vrtx.bin"
(3)    7/ 2170608 :                     .mtrl:		include "data/maps/mars/mcity/pz/01_main_mtrl.asm"
(4)    1/ 2170608 : 220D 367C           	 dc.l Textr_marscity|TH
(4)    2/ 217060C : 0200                	 dc.w 512
(4)    3/ 217060E : 0000                	 dc.w 0
(4)    4/ 2170610 :                     		align 4
(4)    5/ 2170610 :                     
(3)    8/ 2170610 :                     
(2)    2/ 2170610 :                     		include "data/maps/mars/mcity/pz/02_refsep_n.asm"
(3)    1/ 2170610 :                     MarsMapPz_02_refsep_n:
(3)    2/ 2170610 : 02F8 066A           		dc.w 760,1642
(3)    3/ 2170614 : 2217 0624 2217 44F4 		dc.l TH|.vert,TH|.face,TH|.vrtx,TH|.mtrl
                    2217 6394 2217 7D24 
(3)    4/ 2170624 :                     .vert:		binclude "data/maps/mars/mcity/pz/02_refsep_n_vert.bin"
(3)    5/ 21744F4 :                     .face:		binclude "data/maps/mars/mcity/pz/02_refsep_n_face.bin"
(3)    6/ 2176394 :                     .vrtx:		binclude "data/maps/mars/mcity/pz/02_refsep_n_vrtx.bin"
(3)    7/ 2177D24 :                     .mtrl:		include "data/maps/mars/mcity/pz/02_refsep_n_mtrl.asm"
(4)    1/ 2177D24 : 220D 367C           	 dc.l Textr_marscity|TH
(4)    2/ 2177D28 : 0200                	 dc.w 512
(4)    3/ 2177D2A : 0000                	 dc.w 0
(4)    4/ 2177D2C : 220D 367C           	 dc.l Textr_marscity|TH
(4)    5/ 2177D30 : 0200                	 dc.w 512
(4)    6/ 2177D32 : 0000                	 dc.w 0
(4)    7/ 2177D34 : 220D 367C           	 dc.l Textr_marscity|TH
(4)    8/ 2177D38 : 0200                	 dc.w 512
(4)    9/ 2177D3A : 0000                	 dc.w 0
(4)   10/ 2177D3C :                     		align 4
(4)   11/ 2177D3C :                     
(3)    8/ 2177D3C :                     
(2)    3/ 2177D3C :                     		include "data/maps/mars/mcity/pz/03_kfc.asm"
(3)    1/ 2177D3C :                     MarsMapPz_03_kfc:
(3)    2/ 2177D3C : 00AA 0712           		dc.w 170,1810
(3)    3/ 2177D40 : 2217 7D50 2217 8530 		dc.l TH|.vert,TH|.face,TH|.vrtx,TH|.mtrl
                    2217 8C70 2217 9110 
(3)    4/ 2177D50 :                     .vert:		binclude "data/maps/mars/mcity/pz/03_kfc_vert.bin"
(3)    5/ 2178530 :                     .face:		binclude "data/maps/mars/mcity/pz/03_kfc_face.bin"
(3)    6/ 2178C70 :                     .vrtx:		binclude "data/maps/mars/mcity/pz/03_kfc_vrtx.bin"
(3)    7/ 2179110 :                     .mtrl:		include "data/maps/mars/mcity/pz/03_kfc_mtrl.asm"
(4)    1/ 2179110 : 220D 367C           	 dc.l Textr_marscity|TH
(4)    2/ 2179114 : 0200                	 dc.w 512
(4)    3/ 2179116 : 0000                	 dc.w 0
(4)    4/ 2179118 :                     		align 4
(4)    5/ 2179118 :                     
(3)    8/ 2179118 :                     
(2)    4/ 2179118 :                     		include "data/maps/mars/mcity/pz/04_sept_r.asm"
(3)    1/ 2179118 :                     MarsMapPz_04_sept_r:
(3)    2/ 2179118 : 0033 0759           		dc.w 51,1881
(3)    3/ 217911C : 2217 912C 2217 9480 		dc.l TH|.vert,TH|.face,TH|.vrtx,TH|.mtrl
                    2217 9680 2217 97E0 
(3)    4/ 217912C :                     .vert:		binclude "data/maps/mars/mcity/pz/04_sept_r_vert.bin"
(3)    5/ 2179480 :                     .face:		binclude "data/maps/mars/mcity/pz/04_sept_r_face.bin"
(3)    6/ 2179680 :                     .vrtx:		binclude "data/maps/mars/mcity/pz/04_sept_r_vrtx.bin"
(3)    7/ 21797E0 :                     .mtrl:		include "data/maps/mars/mcity/pz/04_sept_r_mtrl.asm"
(4)    1/ 21797E0 :                     		align 4
(4)    2/ 21797E0 :                     
(3)    8/ 21797E0 :                     
(2)    5/ 21797E0 :                     		include "data/maps/mars/mcity/pz/05_carls_n.asm"
(3)    1/ 21797E0 :                     MarsMapPz_05_carls_n:
(3)    2/ 21797E0 : 0064 07C7           		dc.w 100,1991
(3)    3/ 21797E4 : 2217 97F4 2217 9D1C 		dc.l TH|.vert,TH|.face,TH|.vrtx,TH|.mtrl
                    2217 A0CC 2217 A2BC 
(3)    4/ 21797F4 :                     .vert:		binclude "data/maps/mars/mcity/pz/05_carls_n_vert.bin"
(3)    5/ 2179D1C :                     .face:		binclude "data/maps/mars/mcity/pz/05_carls_n_face.bin"
(3)    6/ 217A0CC :                     .vrtx:		binclude "data/maps/mars/mcity/pz/05_carls_n_vrtx.bin"
(3)    7/ 217A2BC :                     .mtrl:		include "data/maps/mars/mcity/pz/05_carls_n_mtrl.asm"
(4)    1/ 217A2BC :                     		align 4
(4)    2/ 217A2BC :                     
(3)    8/ 217A2BC :                     
(2)    6/ 217A2BC :                     		include "data/maps/mars/mcity/pz/06_carls_s.asm"
(3)    1/ 217A2BC :                     MarsMapPz_06_carls_s:
(3)    2/ 217A2BC : 010E 08C3           		dc.w 270,2243
(3)    3/ 217A2C0 : 2217 A2D0 2217 AEA0 		dc.l TH|.vert,TH|.face,TH|.vrtx,TH|.mtrl
                    2217 B900 2217 BED0 
(3)    4/ 217A2D0 :                     .vert:		binclude "data/maps/mars/mcity/pz/06_carls_s_vert.bin"
(3)    5/ 217AEA0 :                     .face:		binclude "data/maps/mars/mcity/pz/06_carls_s_face.bin"
(3)    6/ 217B900 :                     .vrtx:		binclude "data/maps/mars/mcity/pz/06_carls_s_vrtx.bin"
(3)    7/ 217BED0 :                     .mtrl:		include "data/maps/mars/mcity/pz/06_carls_s_mtrl.asm"
(4)    1/ 217BED0 : 220D 367C           	 dc.l Textr_marscity|TH
(4)    2/ 217BED4 : 0200                	 dc.w 512
(4)    3/ 217BED6 : 0000                	 dc.w 0
(4)    4/ 217BED8 :                     		align 4
(4)    5/ 217BED8 :                     
(3)    8/ 217BED8 :                     
(2)    7/ 217BED8 :                     		include "data/maps/mars/mcity/pz/07_carls_hut.asm"
(3)    1/ 217BED8 :                     MarsMapPz_07_carls_hut:
(3)    2/ 217BED8 : 002A 08FB           		dc.w 42,2299
(3)    3/ 217BEDC : 2217 BEEC 2217 C18C 		dc.l TH|.vert,TH|.face,TH|.vrtx,TH|.mtrl
                    2217 C35C 2217 C47C 
(3)    4/ 217BEEC :                     .vert:		binclude "data/maps/mars/mcity/pz/07_carls_hut_vert.bin"
(3)    5/ 217C18C :                     .face:		binclude "data/maps/mars/mcity/pz/07_carls_hut_face.bin"
(3)    6/ 217C35C :                     .vrtx:		binclude "data/maps/mars/mcity/pz/07_carls_hut_vrtx.bin"
(3)    7/ 217C47C :                     .mtrl:		include "data/maps/mars/mcity/pz/07_carls_hut_mtrl.asm"
(4)    1/ 217C47C : 220D 367C           	 dc.l Textr_marscity|TH
(4)    2/ 217C480 : 0200                	 dc.w 512
(4)    3/ 217C482 : 0000                	 dc.w 0
(4)    4/ 217C484 :                     		align 4
(4)    5/ 217C484 :                     
(3)    8/ 217C484 :                     
(2)    8/ 217C484 :                     		include "data/maps/mars/mcity/pz/08_sept_r.asm"
(3)    1/ 217C484 :                     MarsMapPz_08_sept_r:
(3)    2/ 217C484 : 0032 093C           		dc.w 50,2364
(3)    3/ 217C488 : 2217 C498 2217 C7A4 		dc.l TH|.vert,TH|.face,TH|.vrtx,TH|.mtrl
                    2217 C9C4 2217 CB04 
(3)    4/ 217C498 :                     .vert:		binclude "data/maps/mars/mcity/pz/08_sept_r_vert.bin"
(3)    5/ 217C7A4 :                     .face:		binclude "data/maps/mars/mcity/pz/08_sept_r_face.bin"
(3)    6/ 217C9C4 :                     .vrtx:		binclude "data/maps/mars/mcity/pz/08_sept_r_vrtx.bin"
(3)    7/ 217CB04 :                     .mtrl:		include "data/maps/mars/mcity/pz/08_sept_r_mtrl.asm"
(4)    1/ 217CB04 : 220D 367C           	 dc.l Textr_marscity|TH
(4)    2/ 217CB08 : 0200                	 dc.w 512
(4)    3/ 217CB0A : 0000                	 dc.w 0
(4)    4/ 217CB0C :                     		align 4
(4)    5/ 217CB0C :                     
(3)    8/ 217CB0C :                     
(2)    9/ 217CB0C :                     		include "data/maps/mars/mcity/pz/09_phut_n.asm"
(3)    1/ 217CB0C :                     MarsMapPz_09_phut_n:
(3)    2/ 217CB0C : 00A4 09EF           		dc.w 164,2543
(3)    3/ 217CB10 : 2217 CB20 2217 D384 		dc.l TH|.vert,TH|.face,TH|.vrtx,TH|.mtrl
                    2217 DB34 2217 DFF4 
(3)    4/ 217CB20 :                     .vert:		binclude "data/maps/mars/mcity/pz/09_phut_n_vert.bin"
(3)    5/ 217D384 :                     .face:		binclude "data/maps/mars/mcity/pz/09_phut_n_face.bin"
(3)    6/ 217DB34 :                     .vrtx:		binclude "data/maps/mars/mcity/pz/09_phut_n_vrtx.bin"
(3)    7/ 217DFF4 :                     .mtrl:		include "data/maps/mars/mcity/pz/09_phut_n_mtrl.asm"
(4)    1/ 217DFF4 : 220D 367C           	 dc.l Textr_marscity|TH
(4)    2/ 217DFF8 : 0200                	 dc.w 512
(4)    3/ 217DFFA : 0000                	 dc.w 0
(4)    4/ 217DFFC :                     		align 4
(4)    5/ 217DFFC :                     
(3)    8/ 217DFFC :                     
(2)   10/ 217DFFC :                     		include "data/maps/mars/mcity/pz/0A_phut_s.asm"
(3)    1/ 217DFFC :                     MarsMapPz_0A_phut_s:
(3)    2/ 217DFFC : 0042 0A42           		dc.w 66,2626
(3)    3/ 217E000 : 2217 E010 2217 E3F4 		dc.l TH|.vert,TH|.face,TH|.vrtx,TH|.mtrl
                    2217 E674 2217 E7D4 
(3)    4/ 217E010 :                     .vert:		binclude "data/maps/mars/mcity/pz/0A_phut_s_vert.bin"
(3)    5/ 217E3F4 :                     .face:		binclude "data/maps/mars/mcity/pz/0A_phut_s_face.bin"
(3)    6/ 217E674 :                     .vrtx:		binclude "data/maps/mars/mcity/pz/0A_phut_s_vrtx.bin"
(3)    7/ 217E7D4 :                     .mtrl:		include "data/maps/mars/mcity/pz/0A_phut_s_mtrl.asm"
(4)    1/ 217E7D4 :                     		align 4
(4)    2/ 217E7D4 :                     
(3)    8/ 217E7D4 :                     		align 4
(2)   11/ 217E7D4 :                     
(1)   47/ 217E7D4 :                     		align 4
(1)   48/ 217E7D4 :                     
(1)   49/ 217E7D4 :                     ; MarsObj_test:
(1)   50/ 217E7D4 :                     ; 		include "data/mars/objects/mdl/test/head.asm"
(1)   51/ 217E7D4 :                     
(1)   52/ 217E7D4 :                     
     175/  17E7D4 :                     		dephase
     176/  17E7D4 :                     
     177/  17E7D4 :                     ; ====================================================================
     178/  17E7D4 :                     ; ---------------------------------------------
     179/  17E7D4 :                     ; End
     180/  17E7D4 :                     ; ---------------------------------------------
     181/  17E7D4 :                     
     182/  17E7D4 :                     ROM_END:
     183/  17E7D4 :                     		align $8000
     184/  180000 :                     
 AS V1.42 Beta [Bld 118] - source file mars.asm - page 2 - 10/21/2022 1:21:17


  symbol table (* = unused):
  ------------------------

 ADAPTER :                        0 - | *ADEN :                           2 - |
 ALV :                           24 - |
*ARCHITECTURE :                                        x86_64-unknown-linux - |
 ART_LEVEL0 :                 48000 C |  ART_LEVEL0_E :               493E0 C |
 ART_TEST3D :                 40000 C |  ART_TEST3D_E :               41D20 C |
 ASCII_FONT :                 38000 C |  ASCII_FONT_E :               39000 C |
 ASCII_PAL :                 FF02D0 C | *ASCII_PAL_E :               FF02F0 C |
 ATK :                            8 - | *BIGENDIAN :                      0 - |
 BITBGON :                        7 - | *BITCLICKL :                      1 - |
*BITCLICKM :                      2 - | *BITCLICKR :                      0 - |
*BITCLICKS :                      3 - |  BITDISPENBL :                    6 - |
 BITDMA :                         1 - |  BITDMAENBL :                     4 - |
 BITDRWD :                        2 - |  BITDRWL :                        1 - |
 BITDRWR :                        0 - |  BITDRWU :                        3 - |
*BITFIFOE :                       9 - | *BITFIFOF :                       8 - |
*BITHBLK :                        2 - | *BITHINTENBL :                    4 - |
*BITHVSTOP :                      1 - |  BITJOYA :                        6 - |
 BITJOYB :                        4 - |  BITJOYC :                        5 - |
 BITJOYDOWN :                     1 - |  BITJOYLEFT :                     2 - |
 BITJOYMODE :                     B - |  BITJOYRIGHT :                    3 - |
 BITJOYSTART :                    7 - |  BITJOYUP :                       0 - |
 BITJOYX :                        A - |  BITJOYY :                        9 - |
 BITJOYZ :                        8 - |  BITMAPMD :                       1 - |
 BITMARSBG :                      6 - | *BITODD :                         4 - |
*BITPAL :                         0 - | *BITSPRCOL :                      5 - |
*BITSPROVR :                      6 - | *BITV30 :                         3 - |
 BITVBLK :                        3 - | *BITVINT :                        7 - |
*BITVINTENBL :                    5 - | *BRANCHEXT :                      0 - |
 CACHE_MSTR_PLGN :          6001DBC C |
 CACHE_MSTR_PLGN.EXIT :                                    FFFFFFFFC000004C C |
 CACHE_MSTR_PLGN.ON_CLR :                                  FFFFFFFFC0000046 C |
 CACHE_MSTR_PLGN.WAIT_FB :                                 FFFFFFFFC0000016 C |
 CACHE_MSTR_PLGN_E :        600257C C |  CACHE_MSTR_SCRL :          6001924 C |
 CACHE_MSTR_SCRL_E :        6001DBC C |  CACHE_SLAVE :              600257C C |
 CACHE_SLAVE_E :            600288C C | *CACH_BKUPS_L :    FFFFFFFFC0000180 C |
*CACH_BKUPS_S :    FFFFFFFFC0000194 C |  CACH_BKUP_LB :    FFFFFFFFC0000778 C |
 CACH_BKUP_LPZ :   FFFFFFFFC00007A4 C |  CACH_BKUP_S :     FFFFFFFFC00007A4 C |
 CACH_BKUP_SPZ :   FFFFFFFFC00007C0 C |
 CACH_BKUP_SPZ.END :                                       FFFFFFFFC00007C0 C |
 CACH_BLKBACKUP_L :                                        FFFFFFFFC00003A8 C |
 CACH_BLKBACKUP_S :                                        FFFFFFFFC00003C0 C |
*CACH_BLKREFILL :  FFFFFFFFC00003F8 C |
*CACH_BLKREFILL_S :                                        FFFFFFFFC0000420 C |
 CACH_CLRLINES :   FFFFFFFFC00006DC C |  CACH_DDA_LAST :   FFFFFFFFC00006F0 C |
 CACH_DDA_SRC :    FFFFFFFFC0000700 C |  CACH_DDA_SRC_L :  FFFFFFFFC0000720 C |
 CACH_DDA_SRC_R :  FFFFFFFFC0000730 C |  CACH_DDA_TOP :    FFFFFFFFC00006E0 C |
 CACH_DRAWTIMERS :         26007980 C |  CACH_FBDATA :     FFFFFFFFC0000420 C |
 CACH_FBPOS :      FFFFFFFFC0000424 C |  CACH_FBPOS_Y :    FFFFFFFFC0000428 C |
 CACH_INREAD_L :   FFFFFFFFC00003A0 C |  CACH_INREAD_S :   FFFFFFFFC00003A8 C |
*CACH_INSPRRDRW :  FFFFFFFFC0000390 C |  CACH_INTRL_H :    FFFFFFFFC0000430 C |
 CACH_INTRL_SIZE : FFFFFFFFC0000434 C |  CACH_INTRL_W :    FFFFFFFFC000042C C |
 CACH_LNDRW_L :    FFFFFFFFC0000740 C |  CACH_LNDRW_S :    FFFFFFFFC0000778 C |
 CACH_SLVSTACK_L : FFFFFFFFC0000194 C |  CACH_SLVSTACK_S : FFFFFFFFC00001BC C |
 CACH_SPRBOXLIST : FFFFFFFFC0000438 C |
 CACH_SPRBOXLIST.END :                                     FFFFFFFFC0000498 C |
*CACH_WDBACKUP_L : FFFFFFFFC00003C0 C | *CACH_WDBACKUP_S : FFFFFFFFC00003F8 C |
*CACH_WDGBUFFRD :  FFFFFFFFC0000350 C |
*CACH_WDGBUFFRD_UD :                                       FFFFFFFFC0000370 C |
*CACH_WDGBUFFWR :  FFFFFFFFC0000370 C |
*CACH_WDGBUFFWR_UD :                                       FFFFFFFFC0000390 C |
 CAM_X_POS :                      0 C |  CAM_X_ROT :                      C C |
 CAM_Y_POS :                      4 C |  CAM_Y_ROT :                     10 C |
 CAM_Z_POS :                      8 C |  CAM_Z_ROT :                     14 C |
*CART :                           1 - | *CASESENSITIVE :                  0 - |
 CHIP_ENV :                     FBA C |  CHIP_ENV.ATKEND :             108F C |
*CHIP_ENV.ATKZERO :            1092 C |  CHIP_ENV.CHK2 :               1098 C |
 CHIP_ENV.CHK4 :               10CD C |  CHIP_ENV.CKOF :                FE8 C |
 CHIP_ENV.CKON :               1005 C |  CHIP_ENV.COPYOPS :            11F5 C |
 CHIP_ENV.COPYOPS3 :           1281 C |  CHIP_ENV.COPY_1 :             1255 C |
*CHIP_ENV.DECTMR :             109C C |  CHIP_ENV.DKADD :              10B6 C |
 CHIP_ENV.DKSAV :              10BE C |  CHIP_ENV.DKYEND :             10C3 C |
 CHIP_ENV.DO_VOL :             12EF C |  CHIP_ENV.ENVPROC :            1060 C |
 CHIP_ENV.FM_CHNL :            117C C | *CHIP_ENV.FM_CHNLVOL :         12AD C |
 CHIP_ENV.FM_INSUPD :          1244 C |  CHIP_ENV.FM_INS_EX :          12A7 C |
 CHIP_ENV.FM_KEYCUT :          120F C |  CHIP_ENV.FM_KEYOFF :          1224 C |
*CHIP_ENV.FM_PANSET :          1231 C |  CHIP_ENV.FM_PANUPD :          122B C |
 CHIP_ENV.FM_VOLUPD :          12A9 C |  CHIP_ENV.KILLENV :            10E3 C |
 CHIP_ENV.NEXTFM_1 :           1125 C |  CHIP_ENV.NOMIDC :             113A C |
 CHIP_ENV.NOTFM3 :             1200 C |  CHIP_ENV.NOUPD :              110F C |
 CHIP_ENV.NSKIP :              1057 C |  CHIP_ENV.PSTEAL :             1046 C |
 CHIP_ENV.REQ_DAC :            1169 C |  CHIP_ENV.REQ_PITCH :          1176 C |
 CHIP_ENV.SETHAT :             1051 C |  CHIP_ENV.TNMODE :             103B C |
 CHIP_ENV.VEDLP :              10EB C |  CHIP_ENV.VLMUCH :             1100 C |
 CHIP_ENV.VLOOP :               FC5 C |  CHIP_ENV.VMUCH :              12F9 C |
 CHIP_ENV.WRFREQ :             1017 C |  CHNL_CHIP :                      0 - |
 CHNL_EFFARG :                    6 - |  CHNL_EFFID :                     5 - |
 CHNL_FLAGS :                     1 - |  CHNL_INS :                       3 - |
 CHNL_NOTE :                      2 - |  CHNL_TYPE :                      7 - |
 CHNL_VOL :                       4 - | *CLICKL :                         2 - |
*CLICKM :                         4 - | *CLICKR :                         1 - |
*CLICKS :                         8 - |  CMDINTCLR :                     1A - |
 CMDIRQ_ON :                      2 - |  COM :                            0 - |
 COMM0 :                         20 - |  COMM1 :                         21 - |
 COMM10 :                        2A - | *COMM11 :                        2B - |
 COMM12 :                        2C - | *COMM13 :                        2D - |
 COMM14 :                        2E - | *COMM15 :                        2F - |
 COMM2 :                         22 - | *COMM3 :                         23 - |
 COMM4 :                         24 - | *COMM5 :                         25 - |
 COMM6 :                         26 - | *COMM7 :                         27 - |
 COMM8 :                         28 - | *COMM9 :                         29 - |
 COMMZFIFO :                   1E00 C |  COMMZREAD :                     1E C |
 COMMZROMBLK :                   1C C |  COMMZROMRD :                    1D C |
 COMMZWRITE :                    1F C | *CONSTPI :        3.141592653589793 - |
 CONTROLLER_1 :    FFFFFFFFFFFFA702 - | *CONTROLLER_2 :    FFFFFFFFFFFFA712 - |
*CS0 :                            0 - |  CS1 :                      2000000 - |
 CS2 :                      4000000 - |  CS3 :                      6000000 - |
 CURRINSDATA :                 1E40 C |  CURRINSPOS :                  1E44 C |
 CURRTBLPOS :                  1E42 C |  CURRTICKBITS :                  30 C |
 CURRTRKCTRL :                 1E46 C |  CYCLE :                         32 - |
 DACCOM :                      17CC C | *DACINS_KICK :               89F342 C |
 DACINS_KICK.END :           8A0330 C |  DACINS_KICK.START :         89F348 C |
 DACINS_NADIE :              8A0330 C |  DACINS_NADIE.END :          8AEAF4 C |
 DACINS_NADIE.START :        8A0336 C |  DACINS_SNARE_LOBO :         89877A C |
 DACINS_SNARE_LOBO.END :     8998A4 C |  DACINS_SNARE_LOBO.START :   898780 C |
*DACINS_SNARE_MAGN :         89DF68 C |  DACINS_SNARE_MAGN.END :     89F342 C |
 DACINS_SNARE_MAGN.START :   89DF6E C | *DACINS_SNARE_SCD :          89C56E C |
 DACINS_SNARE_SCD.END :      89DF68 C |  DACINS_SNARE_SCD.START :    89C574 C |
 DACINS_WEGOT_CRASH :        8998A4 C |  DACINS_WEGOT_CRASH.END :    89C56E C |
 DACINS_WEGOT_CRASH.START :  8998AA C |  DACINS_WEGOT_KICK :         898000 C |
 DACINS_WEGOT_KICK.END :     89877A C |  DACINS_WEGOT_KICK.START :   898006 C |
 DAC_FILL :                      20 C |  DAC_FIRSTFILL :               1377 C |
 DAC_ME :                         8 C |  DAC_OFF :                     132E C |
 DAC_ON :                      1319 C |  DAC_PLAY :                    1343 C |
 DAC_REFILL :                  137B C |  DAC_REFILL.DAC_OVER :         13C9 C |
 DAC_REFILL.FDF7 :             143B C |  DAC_REFILL.FDF72 :            13F4 C |
 DAC_REFILL.FDFRETURN :        143E C | *DAC_REFILL.KEEPCNTR :         13A2 C |
*DATE :                  10/21/2022 - |  DDACCNTR :                    1E5A C |
 DDACFIFOMID :                 1E5D C |  DDACPNTR :                    1E57 C |
*DISPENBL :                      40 - |  DKY :                            C - |
*DMAENBL :                       10 - | *DOTTEDSTRUCTS :                  0 - |
 DREQCTL :                        6 - | *DREQDEST :                       C - |
 DREQFIFO :                      12 - |  DREQLEN :                       10 - |
*DREQSOURCE :                     8 - |  DREQ_BGEXBUFF :                200 C |
 DREQ_OBJCAM :                  280 C |  DREQ_OBJECTS :                 298 C |
 DREQ_PALETTE :                   0 C |  DREQ_SUPERSPR :                418 C |
 DRV_LOOP :                      42 C |  DRV_LOOP.CMND_0 :               EE C |
 DRV_LOOP.CMND_TRKPLAY :         F2 C |  DRV_LOOP.CMND_TRKRESUME :      170 C |
 DRV_LOOP.CMND_TRKSTOP :        155 C |  DRV_LOOP.CMND_TRKTEMPO :       18F C |
 DRV_LOOP.CMND_TRKTICKS :       17D C |  DRV_LOOP.LIST :                 AE C |
 DRV_LOOP.NEITHER :              82 C |  DRV_LOOP.NEXT_CMD :             89 C |
 DRV_LOOP.NOBEATS :              6A C |  DRV_LOOP.NOTICKS :              5D C |
 DRWSLD_NEXTPZ :   FFFFFFFFC0000372 C |
 DRWSLD_NEXTPZ.RESET_RD :                                  FFFFFFFFC0000382 C |
 DRWSLD_NXTLINE :  FFFFFFFFC00002C6 C |
 DRWSLD_NXTLINE.L_FIX :                                    FFFFFFFFC0000308 C |
 DRWSLD_NXTLINE.REVERS :                                   FFFFFFFFC00002F2 C |
 DRWSLD_NXTLINE.R_FIX :                                    FFFFFFFFC0000302 C |
 DRWSLD_NXTLINE.WAIT :                                     FFFFFFFFC0000316 C |
 DRWSLD_NXTLINE_TEX :                                      FFFFFFFFC0000178 C |
 DRWSLD_NXTLINE_TEX.TEX_SKIP_LINE :                        FFFFFFFFC000026C C |
 DRWSLD_NXTLINE_TEX.TEX_XLOOP :                            FFFFFFFFC000022C C |
 DRWSLD_NXTLINE_TEX.TL_FIX :                               FFFFFFFFC0000202 C |
 DRWSLD_NXTLINE_TEX.TR_FIX :                               FFFFFFFFC00001EE C |
 DRWSLD_NXTLINE_TEX.TXREVERS :                             FFFFFFFFC00001BC C |
 DRWSLD_UPDLINE :  FFFFFFFFC0000368 C |
 DRWSLD_UPDLINE_TEX :                                      FFFFFFFFC0000286 C |
 DRWTASK_EXIT :    FFFFFFFFC00003B6 C |  DRWTASK_RETURN :  FFFFFFFFC000039A C |
 DRWTEX_NEXTPZ :   FFFFFFFFC00002A2 C | *DRWTSK1_NEWPZ :   FFFFFFFFC00000FA C |
 DRWTSK1_NEWPZ.INVLD_Y :                                   FFFFFFFFC000011C C |
 DRWTSK1_NEWPZ.LEN_MAX :                                   FFFFFFFFC0000116 C |
*DRWTSK1_NEWPZ.NO_PZ :                                     FFFFFFFFC0000120 C |
 DRWTSK1_NEWPZ.VALID_Y :                                   FFFFFFFFC0000124 C |
 DRWTSK_SOLIDMODE :                                        FFFFFFFFC00002B4 C |
 DRWTSK_SOLIDMODE.WAIT :                                   FFFFFFFFC00002C0 C |
 DRWTSK_TEXMODE :  FFFFFFFFC0000158 C |
 DRWTSK_TEXMODE.TEXVALID :                                 FFFFFFFFC0000164 C |
 DTH :                           20 - |  DTL :                           1C - |
 DWAVEBUFF :                   1B00 C |  END_SCRN02 :              2601B638 C |
*EXTR_3 :                         A C | *EXTR_4 :                         C C |
*EXTR_5 :                         E C | *FALSE :                          0 - |
 FBVRAM_BLANK :               1F800 - |  FBVRAM_PATCH :               1D000 - |
*FEN :                            2 - |  FIELD_DATA :                     0 C |
 FILLDATA :                       8 - |  FILLLENGTH :                     4 - |
 FILLSTART :                      6 - |  FLG :                           28 - |
 FM :                            80 - |  FM3REG :                      17C0 C |
 FMCOM :                       1678 C |  FMFREQ_LIST :                 1443 C |
 FMFRQH :                        18 - |  FMFRQL :                        1E - |
 FMINS3_CLOSEDHAT :          893F6C C |  FMINS3_EXPLOSION :          893F94 C |
*FMINS3_KICK_ALIEN :         893FE4 C |  FMINS3_OPENHAT :            893F44 C |
*FMINS3_SNARE_ALIEN :        893FBC C | *FMINS_AMBIENT_3 :           89430C C |
 FMINS_AMBIENT_DARK :        8942CC C | *FMINS_AMBIENT_SPOOK :       8942EC C |
*FMINS_BANJO_PUY :           8943AC C | *FMINS_BASS_1 :              8940EC C |
 FMINS_BASS_2 :              89410C C | *FMINS_BASS_CALM :           8940CC C |
 FMINS_BASS_CLUB :           89412C C | *FMINS_BASS_DONNA :          89414C C |
 FMINS_BASS_DUCK :           8941EC C |  FMINS_BASS_GROOVE :         89416C C |
 FMINS_BASS_GROOVE_2 :       89418C C | *FMINS_BASS_GROOVE_GEM :     8941AC C |
 FMINS_BASS_ITALO :          8941CC C | *FMINS_BASS_OIL :            89400C C |
*FMINS_BRASS_EUR :           89434C C | *FMINS_BRASS_PUY :           89436C C |
 FMINS_CLOSEDHAT :           89408C C |  FMINS_COM :                   16D0 C |
 FMINS_COM2 :                  16F8 C |  FMINS_COM3 :                  1720 C |
 FMINS_COM4 :                  1748 C |  FMINS_COM5 :                  1770 C |
 FMINS_COM6 :                  1798 C | *FMINS_DING_1 :              8943EC C |
*FMINS_DING_BASEBALL :       89404C C |  FMINS_DING_TOY :            89432C C |
 FMINS_DRUMKICK_GEM :        89406C C | *FMINS_FLAUTE_CAVE :         89438C C |
 FMINS_HBEAT_TOM :           89442C C | *FMINS_MARIMBA :             8942AC C |
*FMINS_ORGAN_ITO :           89402C C |  FMINS_PIANOM1 :             8940AC C |
 FMINS_PIANO_AQUA :          89420C C |  FMINS_PSYNTH_PLUS :         8943CC C |
*FMINS_TROMBONE_GEM :        89440C C |  FMINS_TRUMPET_1 :           89422C C |
*FMINS_TRUMPET_2 :           89424C C |  FMINS_TRUMPET_CARNIVAL :    89428C C |
*FMINS_TRUMPET_PUY :         89426C C |  FMKEYS :                         6 - |
 FMPAN :                         12 - |  FMSPCMODE :                   1E5F C |
 FMVOL :                          C - |  FM_SEND_1 :                   1303 C |
 FM_SEND_2 :                   130E C |  FRAMECTL :                       B - |
*FS :                             1 - | *FULLPMMU :                       1 - |
 GEMABLK_BEMINE :            88C844 C |  GEMABLK_MECANO :            89117C C |
 GEMABLK_WEGOT :             88F4DA C |  GEMAINS_BEMINE :            88E118 C |
 GEMAINS_MECANO :            893EA4 C |  GEMAINS_WEGOT :             891120 C |
 GEMAPAT_BEMINE :            88C855 C |  GEMAPAT_MECANO :            89118A C |
 GEMAPAT_WEGOT :             88F4F0 C |  GEMASFXBLK_BOOM :           88A62E C |
 GEMASFXINS_BOOM :           88A67E C |  GEMASFXPAT_BOOM :           88A632 C |
 GEMATRKDATA_BEMINE :        88C838 C |  GEMATRKDATA_MECANO :        891170 C |
 GEMATRKDATA_MOVEME :        88A696 C |  GEMATRKDATA_MOVEME.BLK :    88A6A2 C |
 GEMATRKDATA_MOVEME.INS :    88B532 C |  GEMATRKDATA_MOVEME.PAT :    88A6BA C |
 GEMATRKDATA_NADIE_MARS :    88B5CA C |
 GEMATRKDATA_NADIE_MARS.BLK :                                        88B5D6 C |
 GEMATRKDATA_NADIE_MARS.INS :                                        88C7F0 C |
 GEMATRKDATA_NADIE_MARS.PAT :                                        88B5DE C |
 GEMATRKDATA_NADIE_MD :      88E1E0 C |  GEMATRKDATA_NADIE_MD.BLK :  88E1EC C |
 GEMATRKDATA_NADIE_MD.INST : 88F486 C |  GEMATRKDATA_NADIE_MD.PATT : 88E1F4 C |
*GEMATRKDATA_SFX :           88A622 C |  GEMATRKDATA_WEGOT :         88F4CE C |
 GEMA_INIT :                    E35 C |  GEMA_INIT.SET_IT :             EA6 C |
 GET_CMDBYTE :                  1B9 C |  GET_CMDBYTE.GETCBYTEL :        1BC C |
 GET_TICK :                     EB0 C |  GET_TICK.CTNOTICK :            ECD C |
 GET_TRKINDX :                  1A4 C |  GLBL_LASTORG :               4FC70 - |
 GLBL_LASTPC :              6006890 - |
 GO_DRWSLD_UPDLINE_TEX :                                   FFFFFFFFC0000150 C |
 GO_DRWTEX_GONXTPZ :                                       FFFFFFFFC0000154 C |
*G_RETURN :        FFFFFFFFC000014A C | *HAS64 :                          1 - |
*HASDSP :                         0 - | *HASFPU :                         0 - |
*HASPMMU :                        0 - | *HBLK :                          40 - |
*HCOUNT :                         5 - |  HINTCLR :                       18 - |
*HINTENBL :                      10 - |  HINT_DEFAULT :              FF16E6 C |
*HIRQ_ON :                        4 - | *HVSTOP :                         2 - |
*INEXTMODE :                      0 - | *INLWORDMODE :                    0 - |
*INMAXMODE :                      0 - |  INSDATAC_0 :                  185B C |
 INSDATAC_1 :                  18DB C | *INSRCMODE :                      0 - |
*INSUPMODE :                      1 - | *INTMASK :                        1 - |
 INT_M_LIST :               60002AC C |  INT_S_LIST :               60002EC C |
 JOYA :                          40 - |  JOYB :                          10 - |
 JOYC :                          20 - | *JOYDOWN :                        2 - |
*JOYLEFT :                        4 - | *JOYMODE :                      800 - |
*JOYRIGHT :                       8 - | *JOYSTART :                      80 - |
*JOYUP :                          1 - | *JOYX :                         400 - |
*JOYY :                         200 - | *JOYZ :                         100 - |
 LCHWIDTH :                      34 - |  LEV :                            4 - |
 LEVEL_PICKMAP :             FF1A82 C | *LEVEL_PICKMAP.HERE :        FF1B04 C |
*LISTON :                         3 - |  LIST_VDPREGS :              FF02BC C |
 LITERAL_F_00000000_1 :     60002A0 C |  LITERAL_F_00000001_1 :     60002A4 C |
 LITERAL_F_00000002_1 :     60004A0 C |  LITERAL_F_00000003_1 :     60004B0 C |
 LITERAL_F_00000004_1 :     60006F0 C |  LITERAL_F_00000005_1 :     60006F4 C |
 LITERAL_F_00000006_1 :     60006F8 C |  LITERAL_F_00000007_1 :     60006FC C |
 LITERAL_F_00000008_1 :     6000704 C |  LITERAL_F_00000009_1 :     6000708 C |
 LITERAL_F_0000000A_1 :     6000720 C |  LITERAL_F_0000000B_1 :     600070C C |
 LITERAL_F_0000000C_1 :     6000710 C |  LITERAL_F_0000000D_1 :     6000714 C |
 LITERAL_F_0000000E_1 :     6000718 C |  LITERAL_F_0000000F_1 :     600071C C |
 LITERAL_F_00000010_1 :     60007B8 C |  LITERAL_F_00000011_1 :     60009B0 C |
 LITERAL_F_00000012_1 :     6000A90 C |  LITERAL_F_00000013_1 :     6000A98 C |
 LITERAL_F_00000014_1 :     6000B90 C |  LITERAL_F_00000015_1 :     6000D34 C |
 LITERAL_F_00000016_1 :     6000D38 C |  LITERAL_F_00000017_1 :     6000D3C C |
 LITERAL_F_00000018_1 :     6000D40 C |  LITERAL_F_00000019_1 :     6000D44 C |
 LITERAL_F_0000001A_1 :     6000E00 C |  LITERAL_F_0000001B_1 :     6000E04 C |
 LITERAL_F_0000001C_1 :     6000E58 C |  LITERAL_F_0000001D_1 :     6000E5C C |
 LITERAL_F_0000001E_1 :     6000E60 C |  LITERAL_F_0000001F_1 :     6000E64 C |
 LITERAL_F_00000020_1 :     6000E68 C |  LITERAL_F_00000021_1 :     6000E6C C |
 LITERAL_F_00000022_1 :     6000E70 C |  LITERAL_F_00000023_1 :     6000E74 C |
 LITERAL_F_00000024_1 :     6000E78 C |  LITERAL_F_00000025_1 :     6000E7C C |
 LITERAL_F_00000026_1 :     6000E80 C |  LITERAL_F_00000027_1 :     6000E84 C |
 LITERAL_F_00000028_1 :     6001154 C |  LITERAL_F_00000029_1 :     600115C C |
 LITERAL_F_0000002A_1 :     6001160 C |  LITERAL_F_0000002B_1 :     6001258 C |
 LITERAL_F_0000002C_1 :     600125C C |  LITERAL_F_0000002D_1 :     6001260 C |
 LITERAL_F_0000002E_1 :     6001264 C |  LITERAL_F_0000002F_1 :     6001268 C |
 LITERAL_F_00000030_1 :     600126C C |  LITERAL_F_00000031_1 :     6001308 C |
 LITERAL_F_00000032_1 :     60013C8 C |  LITERAL_F_00000033_1 :     60013CC C |
 LITERAL_F_00000034_1 :     60013D4 C |  LITERAL_F_00000035_1 :     60013E0 C |
 LITERAL_F_00000036_1 :     6001498 C |  LITERAL_F_00000037_1 :     60014B8 C |
 LITERAL_F_00000038_1 :     60014AC C |  LITERAL_F_00000039_1 :     60014B4 C |
 LITERAL_F_0000003A_1 :     60015A0 C |  LITERAL_F_0000003B_1 :     60015FC C |
 LITERAL_F_0000003C_1 :     60015A4 C |  LITERAL_F_0000003D_1 :     60015FE C |
 LITERAL_F_0000003E_1 :     60015AC C |  LITERAL_F_0000003F_1 :     60015B0 C |
 LITERAL_F_00000040_1 :     60015B4 C |  LITERAL_F_00000041_1 :     60015B8 C |
 LITERAL_F_00000042_1 :     60015BC C |  LITERAL_F_00000043_1 :     60015C8 C |
 LITERAL_F_00000044_1 :     60015CC C |  LITERAL_F_00000045_1 :     60015D0 C |
 LITERAL_F_00000046_1 :     60015D8 C |  LITERAL_F_00000047_1 :     60015DC C |
 LITERAL_F_00000048_1 :     60015E8 C |  LITERAL_F_00000049_1 :     60015F0 C |
 LITERAL_F_0000004A_1 :     6001770 C |  LITERAL_F_0000004B_1 :     60017D8 C |
 LITERAL_F_0000004C_1 :     6001774 C |  LITERAL_F_0000004D_1 :     60017DA C |
 LITERAL_F_0000004E_1 :     6001788 C |  LITERAL_F_0000004F_1 :     600178C C |
 LITERAL_F_00000050_1 :     6001790 C |  LITERAL_F_00000051_1 :     6001794 C |
 LITERAL_F_00000052_1 :     60017A0 C |  LITERAL_F_00000053_1 :     60017A4 C |
 LITERAL_F_00000054_1 :     60017A8 C |  LITERAL_F_00000055_1 :     60017B4 C |
 LITERAL_F_00000056_1 :     60017B8 C |  LITERAL_F_00000057_1 :     60017BC C |
 LITERAL_F_00000058_1 :     60017C0 C |  LITERAL_F_00000059_1 :     60017C4 C |
 LITERAL_F_0000005A_1 :     60017C8 C |  LITERAL_F_0000005B_1 :     60017CC C |
 LITERAL_F_0000005C_1 :     60017D0 C |  LITERAL_F_0000005D_1 :     60017D4 C |
 LITERAL_F_0000005E_1 :     6001890 C |  LITERAL_F_0000005F_1 :     6001894 C |
 LITERAL_F_00000060_1 :     60018B8 C |  LITERAL_F_00000061_1 :     60018A4 C |
 LITERAL_F_00000062_1 :     600190C C |  LITERAL_F_00000063_1 :     6001914 C |
 LITERAL_F_00000064_1 :     6001918 C |
 LITERAL_F_00000065_1 :                                    FFFFFFFFC0000128 C |
 LITERAL_F_00000066_1 :                                    FFFFFFFFC000012C C |
 LITERAL_F_00000067_1 :                                    FFFFFFFFC0000130 C |
 LITERAL_F_00000068_1 :                                    FFFFFFFFC0000134 C |
 LITERAL_F_00000069_1 :                                    FFFFFFFFC0000138 C |
 LITERAL_F_0000006A_1 :                                    FFFFFFFFC0000264 C |
 LITERAL_F_0000006B_1 :                                    FFFFFFFFC0000268 C |
 LITERAL_F_0000006C_1 :                                    FFFFFFFFC000026C C |
 LITERAL_F_0000006D_1 :                                    FFFFFFFFC0000270 C |
 LITERAL_F_0000006E_1 :                                    FFFFFFFFC0000274 C |
 LITERAL_F_0000006F_1 :                                    FFFFFFFFC000027C C |
 LITERAL_F_00000070_1 :                                    FFFFFFFFC0000280 C |
 LITERAL_F_00000071_1 :                                    FFFFFFFFC000032C C |
 LITERAL_F_00000072_1 :                                    FFFFFFFFC0000330 C |
 LITERAL_F_00000073_1 :                                    FFFFFFFFC0000334 C |
 LITERAL_F_00000074_1 :                                    FFFFFFFFC0000338 C |
 LITERAL_F_00000075_1 :                                    FFFFFFFFC000033C C |
 LITERAL_F_00000076_1 :                                    FFFFFFFFC0000340 C |
 LITERAL_F_00000077_1 :                                    FFFFFFFFC0000348 C |
 LITERAL_F_00000078_1 :                                    FFFFFFFFC0000058 C |
 LITERAL_F_00000079_1 :                                    FFFFFFFFC0000140 C |
 LITERAL_F_0000007A_1 :                                    FFFFFFFFC0000144 C |
 LITERAL_F_0000007B_1 :                                    FFFFFFFFC00003CC C |
 LITERAL_F_0000007C_1 :                                    FFFFFFFFC00003D4 C |
 LITERAL_F_0000007D_1 :                                    FFFFFFFFC00003DC C |
 LITERAL_F_0000007E_1 :                                    FFFFFFFFC00004D0 C |
 LITERAL_F_0000007F_1 :                                    FFFFFFFFC00004D4 C |
 LITERAL_F_00000080_1 :                                    FFFFFFFFC00004D8 C |
 LITERAL_F_00000081_1 :                                    FFFFFFFFC00004E0 C |
 LITERAL_F_00000082_1 :                                    FFFFFFFFC00004E4 C |
 LITERAL_F_00000083_1 :                                    FFFFFFFFC00006B8 C |
 LITERAL_F_00000084_1 :                                    FFFFFFFFC00006BC C |
 LITERAL_F_00000085_1 :                                    FFFFFFFFC00006C0 C |
 LITERAL_F_00000086_1 :                                    FFFFFFFFC00006C4 C |
 LITERAL_F_00000087_1 :                                    FFFFFFFFC00006C8 C |
 LITERAL_F_00000088_1 :                                    FFFFFFFFC00006CC C |
 LITERAL_F_00000089_1 :                                    FFFFFFFFC00006D0 C |
 LITERAL_F_0000008A_1 :                                    FFFFFFFFC00006D4 C |
 LITERAL_F_0000008B_1 :                                    FFFFFFFFC0000150 C |
 LITERAL_F_0000008C_1 :                                    FFFFFFFFC0000154 C |
 LITERAL_F_0000008D_1 :                                    FFFFFFFFC0000158 C |
 LITERAL_F_0000008E_1 :                                    FFFFFFFFC0000164 C |
 LITERAL_F_0000008F_1 :                                    FFFFFFFFC0000170 C |
 LITERAL_L_0000FC00_1 :     600089C C |  LITERAL_L_0001D000_1 :     60015F4 C |
 LITERAL_L_0001E000_1 :     60014A8 C |  LITERAL_L_0001F800_1 :     60009AC C |
 LITERAL_L_00FFFFFF_1 :                                    FFFFFFFFC000015C C |
 LITERAL_L_01400000_1 :     6001158 C |  LITERAL_L_02000000_1 :     6001270 C |
 LITERAL_L_02000000_2 :                                    FFFFFFFFC0000160 C |
 LITERAL_L_06000000_1 :     6001304 C |  LITERAL_L_06000128_1 :     600188C C |
 LITERAL_L_060007E0_1 :     600149C C |  LITERAL_L_060007E0_2 :     60015A8 C |
 LITERAL_L_060007E0_3 :     6001778 C |  LITERAL_L_060007E0_4 :     6001898 C |
 LITERAL_L_06000820_1 :     60017B0 C |  LITERAL_L_06000850_1 :     600130C C |
 LITERAL_L_060008A4_1 :     60014A4 C |  LITERAL_L_060008DC_1 :     60014A0 C |
 LITERAL_L_060008DC_2 :     60017AC C |  LITERAL_L_0600094C_1 :     60015F8 C |
 LITERAL_L_060009EC_1 :     60015EC C |  LITERAL_L_06000B5C_1 :     60015C4 C |
 LITERAL_L_06000D50_1 :     60014B0 C |  LITERAL_L_06000D50_2 :     60015E0 C |
 LITERAL_L_06000D64_1 :     60015E4 C |  LITERAL_L_06000E0C_1 :     600191C C |
 LITERAL_L_0603EFF8_1 :     60007B4 C |  LITERAL_L_0603F000_1 :     6001888 C |
 LITERAL_L_0603FFF8_1 :     60004AC C |  LITERAL_L_06040000_1 :     6001300 C |
 LITERAL_L_20004000_1 :     6000494 C |  LITERAL_L_20004000_2 :     60007B0 C |
 LITERAL_L_20004000_3 :     6000890 C |  LITERAL_L_20004000_4 :     6001254 C |
 LITERAL_L_20004000_5 :     6001310 C |  LITERAL_L_20004000_6 :     600189C C |
 LITERAL_L_20004012_1 :     600049C C |  LITERAL_L_20004016_1 :     60004A8 C |
 LITERAL_L_20004016_2 :     60007AC C |  LITERAL_L_20004018_1 :     60004A4 C |
 LITERAL_L_20004018_2 :     60007A8 C |  LITERAL_L_2000401A_1 :     6000490 C |
 LITERAL_L_2000401A_2 :     60006E8 C |  LITERAL_L_2000401C_1 :     600048C C |
 LITERAL_L_2000401C_2 :                                    FFFFFFFFC000014C C |
 LITERAL_L_20004020_1 :     60013C0 C |  LITERAL_L_20004020_2 :     600179C C |
 LITERAL_L_20004021_1 :     6001908 C |  LITERAL_L_20004022_1 :     6000384 C |
 LITERAL_L_20004024_1 :     6000388 C |  LITERAL_L_20004028_1 :     6000700 C |
 LITERAL_L_2000402C_1 :     6000498 C |  LITERAL_L_2000402C_2 :     6001780 C |
 LITERAL_L_2000402C_3 :     60018A0 C |  LITERAL_L_2000402D_1 :     60013DC C |
 LITERAL_L_2000402E_1 :     60006EC C |  LITERAL_L_2000402E_2 :     6001314 C |
 LITERAL_L_2000402E_3 :     6001598 C |  LITERAL_L_2000402E_4 :     6001784 C |
 LITERAL_L_2000402E_5 :     6001910 C |  LITERAL_L_2000402F_1 :     60015D4 C |
 LITERAL_L_2000402F_2 :     6001798 C |  LITERAL_L_2000402F_3 :     6001920 C |
 LITERAL_L_20004034_1 :                                    FFFFFFFFC0000168 C |
 LITERAL_L_20004036_1 :                                    FFFFFFFFC000016C C |
 LITERAL_L_20004100_1 :     6000894 C |  LITERAL_L_20004100_2 :     60009A4 C |
 LITERAL_L_20004100_3 :     60013C4 C |  LITERAL_L_20004100_4 :     6001494 C |
 LITERAL_L_20004100_5 :     600159C C |  LITERAL_L_20004100_6 :     600177C C |
 LITERAL_L_20004100_7 :                                    FFFFFFFFC0000054 C |
 LITERAL_L_20004100_8 :                                    FFFFFFFFC00003D8 C |
 LITERAL_L_20004102_1 :     60013D0 C |  LITERAL_L_20004200_1 :     60013D8 C |
 LITERAL_L_24000000_1 :     6000898 C |  LITERAL_L_24000000_2 :     60009A8 C |
 LITERAL_L_24000000_3 :     6000A94 C |  LITERAL_L_24000000_4 :     6000D30 C |
 LITERAL_L_24000000_5 :     60015C0 C |
 LITERAL_L_24000000_6 :                                    FFFFFFFFC0000278 C |
 LITERAL_L_24000000_7 :                                    FFFFFFFFC0000344 C |
 LITERAL_L_24020200_1 :                                    FFFFFFFFC00003D0 C |
 LITERAL_L_4D5F4F4B_1 :     60004B4 C |  LITERAL_L_535F4F4B_1 :     60007BC C |
 LITERAL_L_7FFFFFFF_1 :                                    FFFFFFFFC00004DC C |
 LITERAL_L_FFFFFFFFC0000000_1 :                                     6000814 C |
 LITERAL_L_FFFFFFFFC0000800_1 :                                     6000810 C |
 LITERAL_W_0080_1 :         6000818 C |  LITERAL_W_0080_2 :         60008A0 C |
 LITERAL_W_0080_3 :         6001278 C |
 LITERAL_W_0080_4 :                                        FFFFFFFFC000017A C |
 LITERAL_W_00A0_1 :                                        FFFFFFFFC00004E8 C |
 LITERAL_W_00A2_1 :         60009B8 C |
 LITERAL_W_00A4_1 :                                        FFFFFFFFC000005E C |
 LITERAL_W_00A5_1 :         60017DE C |  LITERAL_W_00A8_1 :         60014BE C |
 LITERAL_W_00C0_1 :         60013E8 C |  LITERAL_W_00E0_1 :         6000D4C C |
 LITERAL_W_00E0_2 :         6001604 C |  LITERAL_W_00E0_3 :         60017E0 C |
 LITERAL_W_00E0_4 :                                        FFFFFFFFC0000284 C |
 LITERAL_W_00E0_5 :                                        FFFFFFFFC0000148 C |
 LITERAL_W_00E0_6 :                                        FFFFFFFFC00003E2 C |
 LITERAL_W_00E0_7 :                                        FFFFFFFFC00004EA C |
 LITERAL_W_00F0_1 :         60002A8 C |  LITERAL_W_00F0_2 :         60004BE C |
 LITERAL_W_00F0_3 :         60007C4 C |  LITERAL_W_00F0_4 :         600081A C |
 LITERAL_W_00F0_5 :         6000844 C |  LITERAL_W_00F0_6 :         60008A2 C |
 LITERAL_W_00F0_7 :         60009B4 C |  LITERAL_W_00F0_8 :         6000E0A C |
 LITERAL_W_00F0_9 :         60013E4 C |  LITERAL_W_00F0_A :         60014BC C |
 LITERAL_W_00F0_B :         6001608 C |  LITERAL_W_00F0_C :         60017DC C |
 LITERAL_W_00FC_1 :         6000722 C |
 LITERAL_W_00FF_1 :                                        FFFFFFFFC000034C C |
 LITERAL_W_0100_1 :         6000D4A C |
 LITERAL_W_0100_2 :                                        FFFFFFFFC000013C C |
 LITERAL_W_0105_1 :         6001274 C |
 LITERAL_W_013E_1 :                                        FFFFFFFFC00003E4 C |
 LITERAL_W_0140_1 :         6000D48 C |  LITERAL_W_0140_2 :         6001602 C |
 LITERAL_W_0140_3 :                                        FFFFFFFFC000013E C |
 LITERAL_W_0140_4 :                                        FFFFFFFFC0000286 C |
 LITERAL_W_0140_5 :                                        FFFFFFFFC000034E C |
 LITERAL_W_0150_1 :         6000E08 C |  LITERAL_W_0196_1 :         60013E6 C |
 LITERAL_W_0200_1 :         60014BA C |  LITERAL_W_0200_2 :         6001600 C |
 LITERAL_W_0200_3 :         60017E2 C |  LITERAL_W_03D4_1 :         6000E88 C |
 LITERAL_W_03D4_2 :         6001054 C |
 LITERAL_W_03FF_1 :                                        FFFFFFFFC000017C C |
 LITERAL_W_0415_1 :         6001276 C |  LITERAL_W_0530_1 :         600131C C |
 LITERAL_W_0530_2 :         60018AC C |  LITERAL_W_07FF_1 :         60009B6 C |
 LITERAL_W_07FF_2 :         6000A9C C |  LITERAL_W_07FF_3 :         6001166 C |
 LITERAL_W_3FFF_1 :                                        FFFFFFFFC00003E0 C |
 LITERAL_W_44E0_1 :         60004BA C |  LITERAL_W_44E0_2 :         60007C2 C |
 LITERAL_W_44E5_1 :         60004BC C |  LITERAL_W_4800_1 :         6001320 C |
 LITERAL_W_4800_2 :         60018B0 C |  LITERAL_W_4F10_1 :         6001606 C |
 LITERAL_W_5A00_1 :         600084A C |
 LITERAL_W_5A00_2 :                                        FFFFFFFFC00003EA C |
 LITERAL_W_5A10_1 :                                        FFFFFFFFC0000064 C |
 LITERAL_W_5AE0_1 :         6000B94 C |  LITERAL_W_5AE1_1 :         6000B96 C |
 LITERAL_W_A518_1 :         6001324 C |  LITERAL_W_A518_2 :         60017E6 C |
 LITERAL_W_A518_3 :         60018B4 C |
 LITERAL_W_A518_4 :                                        FFFFFFFFC0000062 C |
 LITERAL_W_A518_5 :                                        FFFFFFFFC00003E8 C |
 LITERAL_W_A518_6 :                                        FFFFFFFFC0000178 C |
 LITERAL_W_A538_1 :         600084C C |  LITERAL_W_FE10_1 :         60004B8 C |
 LITERAL_W_FE10_2 :         60007C0 C |  LITERAL_W_FE10_3 :         6001318 C |
 LITERAL_W_FE10_4 :         60018A8 C |
 LITERAL_W_FE10_5 :                                        FFFFFFFFC000000C C |
 LITERAL_W_FE10_6 :                                        FFFFFFFFC000005C C |
 LITERAL_W_FE10_7 :                                        FFFFFFFFC0000174 C |
 LITERAL_W_FE80_1 :         6000848 C |  LITERAL_W_FE80_2 :         6001322 C |
 LITERAL_W_FE80_3 :         60017E4 C |  LITERAL_W_FE80_4 :         60018B2 C |
 LITERAL_W_FE80_5 :                                        FFFFFFFFC0000060 C |
 LITERAL_W_FE80_6 :                                        FFFFFFFFC00003E6 C |
 LITERAL_W_FE80_7 :                                        FFFFFFFFC0000176 C |
 LITERAL_W_FE92_1 :         600081C C |  LITERAL_W_FE92_2 :         6000846 C |
 LITERAL_W_FE92_3 :         6001326 C |  LITERAL_W_FE92_4 :         60018B6 C |
 LITERAL_W_FEE2_1 :         600131A C |  LITERAL_W_FEE2_2 :         60018AA C |
 LITERAL_W_FEE4_1 :         600131E C |  LITERAL_W_FEE4_2 :         60018AE C |
 LITERAL_W_FF00_1 :         6001164 C |
 LITERAL_W_FF00_2 :                                        FFFFFFFFC00006D8 C |
 LITERAL_W_FF60_1 :         6001056 C | *MACEXP :                         7 - |
 MAINDRW_TASKS :   FFFFFFFFC0000068 C |
 MAINDRW_TASKS.LIST :                                      FFFFFFFFC0000074 C |
 MAPBGH_0 :                  933824 C |  MAPBGL_0 :                  932BC4 C |
 MAPBLK_0 :                  92FE9C C |  MAPBLK_M :                 20C297C C |
 MAPCAMERA_0 :               FF2408 C | *MAPCAMERA_0.HERE :          FF6F0C C |
 MAPFGC_0 :                  931F64 C |  MAPFGH_0 :                  931304 C |
 MAPFGL_0 :                  9306A4 C |  MAPFG_M :                  20D2A7C C |
 MAPHEAD_0 :                 92FE92 C |  MAPHEAD_M :                 934484 C |
 MAPPAL_M :                  92EEF4 C |  MAPPZ_SIZE :                  1000 - |
 MAP_TEST3D :                92F092 C | *MARS :                           1 - |
 MARSBLOCK :                     2E C | *MARSCD :                         0 - |
*MARSGBL_CNTRRDPLGN :            1C C | *MARSGBL_CNTRRDSPR :             1E C |
*MARSGBL_GOTDREQ :               2E C | *MARSGBL_MDDRAWTMR :             22 C |
 MARSGBL_PLYPZCNTR :             1A C |  MARSGBL_PLYPZLIST_END :          C C |
 MARSGBL_PLYPZLIST_R :            0 C |  MARSGBL_PLYPZLIST_START :        8 C |
 MARSGBL_PLYPZLIST_W :            4 C |  MARSGBL_POLYBUFFNUM :           18 C |
 MARSGBL_WAVEDEFORM :            2A C |  MARSGBL_WAVEENABLE :            24 C |
 MARSGBL_WAVEMAX :               28 C |  MARSGBL_WAVESPD :               26 C |
 MARSGBL_WAVETAN :               2C C |  MARSGBL_WDGDIVLOCK :            16 C |
 MARSGBL_WDGHOLD :               12 C |  MARSGBL_WDGMODE :               10 C |
 MARSGBL_WDGREADY :              14 C |  MARSGBL_XSHIFT :                20 C |
 MARSMAPPZ_01_MAIN :        216E67C C |  MARSMAPPZ_01_MAIN.FACE :   216F4B8 C |
 MARSMAPPZ_01_MAIN.MTRL :   2170608 C |  MARSMAPPZ_01_MAIN.VERT :   216E690 C |
 MARSMAPPZ_01_MAIN.VRTX :   216FE78 C |  MARSMAPPZ_02_REFSEP_N :    2170610 C |
 MARSMAPPZ_02_REFSEP_N.FACE :                                       21744F4 C |
 MARSMAPPZ_02_REFSEP_N.MTRL :                                       2177D24 C |
 MARSMAPPZ_02_REFSEP_N.VERT :                                       2170624 C |
 MARSMAPPZ_02_REFSEP_N.VRTX :                                       2176394 C |
 MARSMAPPZ_03_KFC :         2177D3C C |  MARSMAPPZ_03_KFC.FACE :    2178530 C |
 MARSMAPPZ_03_KFC.MTRL :    2179110 C |  MARSMAPPZ_03_KFC.VERT :    2177D50 C |
 MARSMAPPZ_03_KFC.VRTX :    2178C70 C |  MARSMAPPZ_04_SEPT_R :      2179118 C |
 MARSMAPPZ_04_SEPT_R.FACE : 2179480 C |  MARSMAPPZ_04_SEPT_R.MTRL : 21797E0 C |
 MARSMAPPZ_04_SEPT_R.VERT : 217912C C |  MARSMAPPZ_04_SEPT_R.VRTX : 2179680 C |
 MARSMAPPZ_05_CARLS_N :     21797E0 C |
 MARSMAPPZ_05_CARLS_N.FACE :                                        2179D1C C |
 MARSMAPPZ_05_CARLS_N.MTRL :                                        217A2BC C |
 MARSMAPPZ_05_CARLS_N.VERT :                                        21797F4 C |
 MARSMAPPZ_05_CARLS_N.VRTX :                                        217A0CC C |
 MARSMAPPZ_06_CARLS_S :     217A2BC C |
 MARSMAPPZ_06_CARLS_S.FACE :                                        217AEA0 C |
 MARSMAPPZ_06_CARLS_S.MTRL :                                        217BED0 C |
 MARSMAPPZ_06_CARLS_S.VERT :                                        217A2D0 C |
 MARSMAPPZ_06_CARLS_S.VRTX :                                        217B900 C |
 MARSMAPPZ_07_CARLS_HUT :   217BED8 C |
 MARSMAPPZ_07_CARLS_HUT.FACE :                                      217C18C C |
 MARSMAPPZ_07_CARLS_HUT.MTRL :                                      217C47C C |
 MARSMAPPZ_07_CARLS_HUT.VERT :                                      217BEEC C |
 MARSMAPPZ_07_CARLS_HUT.VRTX :                                      217C35C C |
 MARSMAPPZ_08_SEPT_R :      217C484 C |  MARSMAPPZ_08_SEPT_R.FACE : 217C7A4 C |
 MARSMAPPZ_08_SEPT_R.MTRL : 217CB04 C |  MARSMAPPZ_08_SEPT_R.VERT : 217C498 C |
 MARSMAPPZ_08_SEPT_R.VRTX : 217C9C4 C |  MARSMAPPZ_09_PHUT_N :      217CB0C C |
 MARSMAPPZ_09_PHUT_N.FACE : 217D384 C |  MARSMAPPZ_09_PHUT_N.MTRL : 217DFF4 C |
 MARSMAPPZ_09_PHUT_N.VERT : 217CB20 C |  MARSMAPPZ_09_PHUT_N.VRTX : 217DB34 C |
 MARSMAPPZ_0A_PHUT_S :      217DFFC C |  MARSMAPPZ_0A_PHUT_S.FACE : 217E3F4 C |
 MARSMAPPZ_0A_PHUT_S.MTRL : 217E7D4 C |  MARSMAPPZ_0A_PHUT_S.VERT : 217E010 C |
 MARSMAPPZ_0A_PHUT_S.VRTX : 217E674 C |  MARSMAP_00 :                FF1AE4 C |
 MARSMAP_00.BLOCKS :         FF22E8 C |  MARSMDL_MDLLOOP :          6000E0C C |
 MARSMDL_MDLLOOP.GO_MDL :   6000E1E C |  MARSMDL_MDLLOOP.INVLID :   6000E36 C |
 MARSMDL_MDLLOOP.LOOP :     6000E22 C |  MARSMDL_MDLLOOP.PAGE_2 :   6000E4E C |
*MARSMDL_MDLLOOP.SKIP :     6000E3C C |  MARSMDL_READMODEL :        6000E8C C |
 MARSMDL_READMODEL.BAD_FACE :                                       6001044 C |
*MARSMDL_READMODEL.DONT_BLD :                                       6000EA2 C |
 MARSMDL_READMODEL.EXIT :   600104C C |  MARSMDL_READMODEL.FC_TRI : 6000F6E C |
 MARSMDL_READMODEL.HAS_UV : 6000ED4 C |
 MARSMDL_READMODEL.MK_FACE :                                        6000F38 C |
 MARSMDL_READMODEL.NEXT_FACE :                                      6000E9C C |
 MARSMDL_READMODEL.NXT_X :  6000FF6 C |  MARSMDL_READMODEL.NXT_Y :  6001020 C |
 MARSMDL_READMODEL.QUAD :   6000EB6 C |  MARSMDL_READMODEL.UV_TRI : 6000EEC C |
 MARSMDL_READMODEL.VALID :  6000EA8 C |  MARSMDL_READMODEL.X_L :    6000FFE C |
 MARSMDL_READMODEL.X_R :    6001004 C |  MARSMDL_READMODEL.Y_L :    6001028 C |
 MARSMDL_READMODEL.Y_R :    600102E C |  MARSRAM_SOUND :           26007600 C |
 MARSRAM_SYSTEM :          26006890 C |  MARSRAM_VIDEO :           26007980 C |
 MARSSND_PWMCACHE :        26007600 C |
 MARSSND_PWMCHNLS :                                        FFFFFFFFC00001F8 C |
 MARSSND_PWMCHNLS.END :                                    FFFFFFFFC0000310 C |
 MARSSND_PWMCONTROL :                                      FFFFFFFFC00001C0 C |
 MARSSND_REFILL :           6001204 C |  MARSSND_REFILL.COPY_NOW :  600122A C |
 MARSSND_REFILL.NEXT_ONE :  600120C C |  MARSSND_REFILL.NOT_ENBL :  6001246 C |
 MARSSND_RVMODE :  FFFFFFFFC00001BC C |  MARSSOUND_INIT :           6001168 C |
 MARSSOUND_PWMENABLE :      60011F4 C |  MARSSOUND_SETPWM :         6001184 C |
 MARSSOUND_SETPWM.ENDMRK :  60011AC C |  MARSSOUND_SETPWMPITCH :    60011C4 C |
 MARSSOUND_SETPWMPITCH.OFF_1 :                                      60011D8 C |
 MARSSOUND_SETVOLUME :      60011DC C |
 MARSSOUND_SETVOLUME.OFF_1 :                                        60011F0 C |
 MARSSPR_DATA :                  10 C |  MARSSPR_DWIDTH :                 8 C |
*MARSSPR_FILL :                   E C |  MARSSPR_FLAGS :                  C C |
 MARSSPR_INDX :                   A C | *MARSSPR_MAP :                   14 C |
 MARSSPR_X :                      4 C |  MARSSPR_XFRM :                   0 C |
 MARSSPR_XS :                     2 C |  MARSSPR_Y :                      6 C |
 MARSSPR_YFRM :                   1 C |  MARSSPR_YS :                     3 C |
 MARSUPD :                       2F C |  MARSVIDEO_BG_DRAWREQ :     6000B14 C |
 MARSVIDEO_BG_DRAWREQ.X_K : 6000B38 C |  MARSVIDEO_BG_DRAWREQ.X_R : 6000B34 C |
 MARSVIDEO_BG_DRAWREQ.Y_K : 6000B54 C |  MARSVIDEO_BG_DRAWREQ.Y_R : 6000B50 C |
 MARSVIDEO_BG_DRAWSCRL :    6000B98 C |
 MARSVIDEO_BG_DRAWSCRL.DRAW_D :                                     6000C90 C |
 MARSVIDEO_BG_DRAWSCRL.DRAW_L :                                     6000C0A C |
 MARSVIDEO_BG_DRAWSCRL.DRAW_R :                                     6000BFC C |
 MARSVIDEO_BG_DRAWSCRL.DRAW_U :                                     6000C9E C |
 MARSVIDEO_BG_DRAWSCRL.FB_Y :                                       6000BC6 C |
 MARSVIDEO_BG_DRAWSCRL.GO_DU :                                      6000CA8 C |
 MARSVIDEO_BG_DRAWSCRL.GO_LR :                                      6000C14 C |
 MARSVIDEO_BG_DRAWSCRL.NO_D :                                       6000BEA C |
 MARSVIDEO_BG_DRAWSCRL.NO_L :                                       6000BDE C |
 MARSVIDEO_BG_DRAWSCRL.NO_R :                                       6000BD2 C |
 MARSVIDEO_BG_DRAWSCRL.NO_U :                                       6000BF6 C |
 MARSVIDEO_BG_DRAWSCRL.XD_EX :                                      6000D10 C |
 MARSVIDEO_BG_DRAWSCRL.XD_LNE :                                     6000CEC C |
 MARSVIDEO_BG_DRAWSCRL.X_EX :                                       6000C76 C |
 MARSVIDEO_BG_DRAWSCRL.X_LNE :                                      6000C52 C |
 MARSVIDEO_BG_DRAWSCRL.YD_BLK :                                     6000CCE C |
 MARSVIDEO_BG_DRAWSCRL.YD_LNE :                                     6000CE4 C |
 MARSVIDEO_BG_DRAWSCRL.YD_RES :                                     6000CEA C |
 MARSVIDEO_BG_DRAWSCRL.Y_BLK :                                      6000C36 C |
 MARSVIDEO_BG_DRAWSCRL.Y_LNE :                                      6000C4A C |
 MARSVIDEO_BG_DRAWSCRL.Y_RES :                                      6000C50 C |
 MARSVIDEO_BG_UPDPOS :      6000AA0 C |  MARSVIDEO_BG_UPDPOS.XEQU : 6000AB8 C |
 MARSVIDEO_BG_UPDPOS.YEQU : 6000ACE C |
 MARSVIDEO_BG_UPDPOS.YPU_NEGTV :                                    6000AE6 C |
 MARSVIDEO_BG_UPDPOS.YPU_POSTV :                                    6000AF0 C |
 MARSVIDEO_BG_UPDPOS.YX_NEGTV :                                     6000B02 C |
 MARSVIDEO_BG_UPDPOS.YX_POSTV :                                     6000B0C C |
 MARSVIDEO_CLEARSCREEN :    60008A4 C |
 MARSVIDEO_CLEARSCREEN.FB_LOOP :                                    60008AA C |
*MARSVIDEO_CLEARSCREEN.NO_REDRAW_2 :                                60008C2 C |
 MARSVIDEO_CLEARSCREEN.WAIT_FB2 :                                   60008B6 C |
 MARSVIDEO_DMADRAW :        6000B5C C |
 MARSVIDEO_DMADRAW.WAIT_DMA :                                       6000B7C C |
 MARSVIDEO_DRAWBGSSPR :                                    FFFFFFFFC0000288 C |
 MARSVIDEO_DRAWBGSSPR.LAST :                               FFFFFFFFC0000326 C |
 MARSVIDEO_DRAWBGSSPR.NEXT_SAVE :                          FFFFFFFFC00002B6 C |
 MARSVIDEO_DRAWBGSSPR.SPR_OUT :                            FFFFFFFFC0000322 C |
 MARSVIDEO_DRAWBGSSPR.X_KEEP :                             FFFFFFFFC00002FC C |
 MARSVIDEO_DRAWBGSSPR.X_LP :                               FFFFFFFFC00002F6 C |
 MARSVIDEO_DRAWBGSSPR.X_LRG :                              FFFFFFFFC0000314 C |
 MARSVIDEO_DRAWBGSSPR.YGOOD :                              FFFFFFFFC00002B2 C |
 MARSVIDEO_DRAWBGSSPR.Y_LP :                               FFFFFFFFC00002F0 C |
 MARSVIDEO_DRAWSUPERSPR_M :                                FFFFFFFFC0000140 C |
 MARSVIDEO_DRWMAPDATA :                                    FFFFFFFFC0000010 C |
 MARSVIDEO_DRWMAPDATA.THIS_BLK :                           FFFFFFFFC00000C8 C |
 MARSVIDEO_DRWMAPDATA.XB_LINE :                            FFFFFFFFC00000EE C |
 MARSVIDEO_DRWMAPDATA.XY_G :                               FFFFFFFFC0000096 C |
 MARSVIDEO_DRWMAPDATA.XY_G2 :                              FFFFFFFFC00000E8 C |
 MARSVIDEO_DRWMAPDATA.X_EX :                               FFFFFFFFC0000106 C |
 MARSVIDEO_DRWMAPDATA.X_FL :                               FFFFFFFFC000006A C |
 MARSVIDEO_DRWMAPDATA.X_IN :                               FFFFFFFFC000005A C |
 MARSVIDEO_DRWMAPDATA.X_LOOP :                             FFFFFFFFC000009E C |
 MARSVIDEO_DRWMAPDATA.X_PL :                               FFFFFFFFC0000062 C |
 MARSVIDEO_DRWMAPDATA.YB_LINE :                            FFFFFFFFC00000E2 C |
 MARSVIDEO_DRWMAPDATA.Y_FL :                               FFFFFFFFC000007A C |
 MARSVIDEO_DRWMAPDATA.Y_LOOP :                             FFFFFFFFC000008A C |
 MARSVIDEO_DRWMAPDATA.Y_PL :                               FFFFFFFFC0000072 C |
 MARSVIDEO_FIXTBLSHIFT :    600094C C |
 MARSVIDEO_FIXTBLSHIFT.COPY :                                       600098C C |
 MARSVIDEO_FIXTBLSHIFT.LOOP :                                       6000974 C |
 MARSVIDEO_FIXTBLSHIFT.PTCHSET :                                    600099E C |
 MARSVIDEO_FIXTBLSHIFT.TBLEXIT :                                    6000998 C |
 MARSVIDEO_INIT :           6000850 C |  MARSVIDEO_INIT.DEF_FB :    6000870 C |
 MARSVIDEO_INIT.NXT_LNE :   6000876 C |  MARSVIDEO_INIT.WAIT_FRM :  6000886 C |
 MARSVIDEO_MAKENAMETBL :    60008DC C |
 MARSVIDEO_MAKENAMETBL.CANT_USE :                                   6000946 C |
 MARSVIDEO_MAKENAMETBL.LINETBL_NORMAL :                             6000938 C |
 MARSVIDEO_MAKENAMETBL.NXT_LNE :                                    6000910 C |
 MARSVIDEO_MAKENAMETBL.NXT_LNE2 :                                   600093C C |
 MARSVIDEO_MKSCRLFIELD :    60009BC C |  MARSVIDEO_MKSPRBOXES :     6000D64 C |
 MARSVIDEO_MKSPRBOXES.LAST :                                        6000DFC C |
 MARSVIDEO_MKSPRBOXES.NEXT_SAVE :                                   6000D68 C |
 MARSVIDEO_MKSPRBOXES.SPR_OUT :                                     6000DF8 C |
 MARSVIDEO_MKSPRBOXES.XL_L :                                        6000DB2 C |
 MARSVIDEO_MKSPRBOXES.XR_L :                                        6000DBE C |
 MARSVIDEO_MKSPRBOXES.YL_L :                                        6000DB8 C |
 MARSVIDEO_MKSPRBOXES.YR_L :                                        6000DC4 C |
 MARSVIDEO_MKSPRBOXES.Y_KEEP :                                      6000DD0 C |
*MARSVIDEO_MKSPRBOXES.Y_LP :                                        6000DCA C |
 MARSVIDEO_MKSPRCOORDS :    6000D50 C |
 MARSVIDEO_NXTSUPRSPR :                                    FFFFFFFFC000014C C |
 MARSVIDEO_NXTSUPRSPR.BLNK :                               FFFFFFFFC0000230 C |
 MARSVIDEO_NXTSUPRSPR.BLNK2 :                              FFFFFFFFC0000240 C |
 MARSVIDEO_NXTSUPRSPR.EX_LINE :                            FFFFFFFFC0000244 C |
 MARSVIDEO_NXTSUPRSPR.FLP_H :                              FFFFFFFFC00001DE C |
 MARSVIDEO_NXTSUPRSPR.FLP_V :                              FFFFFFFFC00001D4 C |
 MARSVIDEO_NXTSUPRSPR.SPR_OUT :                            FFFFFFFFC0000260 C |
 MARSVIDEO_NXTSUPRSPR.VALID :                              FFFFFFFFC0000158 C |
 MARSVIDEO_NXTSUPRSPR.XB_E :                               FFFFFFFFC0000198 C |
 MARSVIDEO_NXTSUPRSPR.XFINC :                              FFFFFFFFC00001FE C |
 MARSVIDEO_NXTSUPRSPR.XT_E :                               FFFFFFFFC0000202 C |
 MARSVIDEO_NXTSUPRSPR.X_LOOP :                             FFFFFFFFC0000222 C |
 MARSVIDEO_NXTSUPRSPR.YB_E :                               FFFFFFFFC0000190 C |
 MARSVIDEO_NXTSUPRSPR.YFINC :                              FFFFFFFFC00001F0 C |
 MARSVIDEO_NXTSUPRSPR.YT_E :                               FFFFFFFFC00001F2 C |
 MARSVIDEO_NXTSUPRSPR.Y_LOOP :                             FFFFFFFFC0000218 C |
 MARSVIDEO_NXTSUPRSPR.Y_MAX :                              FFFFFFFFC000021E C |
*MARSVIDEO_RESETNAMETBL :   60008C8 C |
 MARSVIDEO_RESETNAMETBL.NXT_LNE2 :                                  60008CE C |
 MARSVIDEO_SHOWSCRLBG :     60009EC C |
 MARSVIDEO_SHOWSCRLBG.LN_LOOP :                                     6000A0E C |
 MARSVIDEO_SHOWSCRLBG.LN_LOOP_W :                                   6000A4C C |
 MARSVIDEO_SHOWSCRLBG.LN_WAVY :                                     6000A34 C |
*MARSVIDEO_SHOWSCRLBG.NO_LINES :                                    6000A8C C |
 MARSVIDEO_SHOWSCRLBG.WXL_L :                                       6000A70 C |
 MARSVIDEO_SHOWSCRLBG.WXL_R :                                       6000A6A C |
 MARSVIDEO_SHOWSCRLBG.XL_L :                                        6000A1C C |
 MARSVIDEO_SHOWSCRLBG.XL_R :                                        6000A16 C |
 MARSVIDEO_SLICEPLGN :                                     FFFFFFFFC00003EC C |
 MARSVIDEO_SLICEPLGN.EXIT :                                FFFFFFFFC00004C8 C |
 MARSVIDEO_SLICEPLGN.FIND_TOP :                            FFFFFFFFC000043E C |
 MARSVIDEO_SLICEPLGN.IS_HIGH :                             FFFFFFFFC0000450 C |
 MARSVIDEO_SLICEPLGN.IS_LOW :                              FFFFFFFFC0000446 C |
 MARSVIDEO_SLICEPLGN.LEFTH :                               FFFFFFFFC0000490 C |
 MARSVIDEO_SLICEPLGN.LEFTH2 :                              FFFFFFFFC00004C0 C |
 MARSVIDEO_SLICEPLGN.NEXT_PZ :                             FFFFFFFFC0000472 C |
 MARSVIDEO_SLICEPLGN.SETPNTS :                             FFFFFFFFC000040C C |
 MARSVIDEO_SLICEPLGN.SRC_PNTS :                            FFFFFFFFC0000420 C |
*MARSVIDEO_SLICEPLGN.START_MATH :                          FFFFFFFFC000042E C |
 MARSVIDEO_SLICEPLGN.TRINGL :                              FFFFFFFFC00003FE C |
 MARSVIDEO_SLICEPLGN.YTRINGL :                             FFFFFFFFC0000436 C |
*MARS_CLEARCACHERAM :       60007C8 C |  MARS_CLEARCACHERAM.LOOP :  60007CE C |
 MARS_ENTRY :                   800 C | *MARS_ENTRY.NO_MARS :           802 C |
 MARS_LOADCACHERAM :        60007E0 C |  MARS_LOADCACHERAM.COPY :   6000802 C |
 MARS_RAMDATA :               493E0 C |  MARS_RAMDATA_E :             4FC70 C |
 MARS_SCOMM :                   4C3 C |  MARS_SCOMM.BLOCKED :           547 C |
 MARS_SCOMM.CLRCOM :            54D C |  MARS_SCOMM.NEXT_COMM :         51E C |
 MARS_SCOMM.NEXT_PASS :         514 C | *MARS_SCOMM.WAIT_CMD :          512 C |
 MARS_SCOMM.WAIT_ENTER :        4F3 C |  MARS_SCOMM.W_PASS2 :           534 C |
 MARS_SETWATCHDOG :         6000820 C |  MASTERTRKBEATS :            FF1D24 C |
 MASTERTRKLIST :             FF1D3C C |  MASTER_IRQ :               6000250 C |
 MASTER_LOOP :              6001328 C |  MASTER_LOOP.COPY_PAL :     6001366 C |
 MASTER_LOOP.COPY_SAFE :    6001344 C | *MASTER_LOOP.NOT_READY :    6001382 C |
 MASTER_LOOP.NO_INIT :      60013AE C |  MASTER_LOOP.WAITL :        6001332 C |
 MASTER_LOOP.WAITV :        6001352 C |  MAX_FACES :                    3D4 - |
 MAX_GEMAENTRY :                  4 - |  MAX_INS :                       10 - |
 MAX_MDDMATSK :                  10 - |  MAX_MDERAM :                   800 - |
 MAX_MODELS :                    10 - |  MAX_PAGE0_EN :                   4 - |
 MAX_PWMBACKUP :                 80 - |  MAX_PWMCHNL :                    7 - |
 MAX_SCRNBUFF :               2C000 - |  MAX_SSPRSPD :                    4 - |
 MAX_SUPERSPR :                  18 - |  MAX_SVDP_PZ :                  434 - |
 MAX_TRKCHN :                    11 - |  MAX_ZDIST :       FFFFFFFFFFFFE400 - |
*MCD :                            0 - |  MCHNSND_BANK :                   C C |
 MCHNSND_CCHREAD :                8 C |  MCHNSND_ENBL :                   0 C |
 MCHNSND_END :                   14 C |  MCHNSND_FLAGS :                 20 C |
 MCHNSND_LOOP :                  18 C |  MCHNSND_PITCH :                 1C C |
 MCHNSND_READ :                   4 C |  MCHNSND_START :                 10 C |
 MCHNSND_VOL :                   24 C | *MDBNK0_END :                93448A C |
*MDBNK0_END.END :             3448A C | *MDBNK0_START :              92EAF4 C |
 MDLDATA_PAL_TEST :          92ECF4 C |  MDLMAP_BUILD :              FF19B2 C |
 MDLMAP_BUILD.DO_CLMN :      FF1A14 C |  MDLMAP_BUILD.FRONT_R :      FF19F8 C |
 MDLMAP_BUILD.MK_PZ :        FF1A22 C |  MDLMAP_BUILD.VIEWS :        FF19F0 C |
 MDLMAP_INIT :               FF18A0 C |  MDLMAP_LOOP :               FF18D6 C |
 MDLMAP_LOOP.BUSY :          FF198C C |  MDLMAP_LOOP.Z2_RL :         FF1948 C |
 MDLMAP_LOOP.Z2_RR :         FF1952 C |  MDLMAP_LOOP.Z_DW2 :         FF190A C |
 MDLMAP_LOOP.Z_DW3 :         FF1926 C |  MDLMAP_LOOP.Z_RL :          FF1932 C |
 MDLMAP_LOOP.Z_RLD :         FF195E C |  MDLMAP_LOOP.Z_RR :          FF193E C |
 MDLMAP_LOOP.Z_RRD :         FF196A C |  MDLMAP_LOOP.Z_UP2 :         FF18FE C |
 MDLMAP_LOOP.Z_UP3 :         FF191A C |  MDLRD_ROTATE :             600111C C |
 MDLRD_SETPOINT :           6001058 C |  MDLRD_SETPOINT.INSIDE :    60010EE C |
 MDLRD_SETPOINT.ZMULTI :    60010F8 C |  MDL_DATA :                       0 C |
*MDL_FLAGS :                     16 C | *MDL_FRAME :                     14 C |
 MDL_OPTION :                     4 C |  MDL_X_POS :                      8 C |
 MDL_X_ROT :                      E C |  MDL_Y_POS :                      A C |
 MDL_Y_ROT :                     10 C |  MDL_Z_POS :                      C C |
 MDL_Z_ROT :                     12 C |  MDMAP_DRAWALL :             FF0DE4 C |
 MDMAP_DRAWALL.BLANK :       FF0EAA C |  MDMAP_DRAWALL.DRWY_16 :     FF0F04 C |
 MDMAP_DRAWALL.GOT_BLK :     FF0EA8 C |  MDMAP_DRAWALL.MK_BLOCK :    FF0EE0 C |
 MDMAP_DRAWALL.NO_BG :       FF0EDE C |  MDMAP_DRAWALL.THIS_BG :     FF0DEE C |
 MDMAP_DRAWALL.X_LOOP :      FF0E98 C |  MDMAP_DRAWALL.Y_LOOP :      FF0E90 C |
 MDMAP_DRAWSCRL :            FF0F3E C | *MDMAP_DRAWSCRL.BLNK :       FF0FD8 C |
 MDMAP_DRAWSCRL.FRCE :       FF100C C |  MDMAP_DRAWSCRL.GET_COORDS : FF1120 C |
*MDMAP_DRAWSCRL.MARS_RET_C : FF1062 C |  MDMAP_DRAWSCRL.MK_CLMN :    FF0FB2 C |
 MDMAP_DRAWSCRL.MK_ROW :     FF1064 C |  MDMAP_DRAWSCRL.NO_BG :      FF0FB0 C |
 MDMAP_DRAWSCRL.NO_D :       FF0F84 C |  MDMAP_DRAWSCRL.NO_L :       FF0F9C C |
 MDMAP_DRAWSCRL.NO_R :       FF0FAC C |  MDMAP_DRAWSCRL.NO_U :       FF0F72 C |
 MDMAP_DRAWSCRL.PRIO :       FF0FDE C |  MDMAP_DRAWSCRL.THIS_BG :    FF0F4E C |
 MDMAP_DRAWSCRL.VLD :        FF0FEA C | *MDMAP_DRAWSCRL.XBLNK :      FF1098 C |
 MDMAP_DRAWSCRL.XFRCE :      FF10CC C |  MDMAP_DRAWSCRL.XPRIO :      FF109E C |
 MDMAP_DRAWSCRL.XVLD :       FF10AA C |  MDMAP_DRAWSCRL.X_BLK :      FF108C C |
 MDMAP_DRAWSCRL.X_LOW :      FF110E C | *MDMAP_DRAWSCRL.X_NEW :      FF1116 C |
 MDMAP_DRAWSCRL.Y_BLK :      FF0FCC C |  MDMAP_DRAWSCRL.Y_LOW :      FF105A C |
 MDMAP_INIT :                FF0BBE C |  MDMAP_INIT.CLR :            FF0BC8 C |
 MDMAP_MOVE :                FF0CC4 C |  MDMAP_MOVE.MARS_SIDE :      FF0CD6 C |
*MDMAP_MOVE.NOT_ENABLD :     FF0D06 C |  MDMAP_MOVE.X_LEFT :         FF0CE0 C |
 MDMAP_MOVE.X_RIGHT :        FF0CEA C |  MDMAP_MOVE.Y_LEFT :         FF0CF4 C |
 MDMAP_MOVE.Y_RIGHT :        FF0CFE C |  MDMAP_SET :                 FF0BD0 C |
 MDMAP_SET.MARS_SIDE :       FF0BF0 C |  MDMAP_SET.MD_SIDE :         FF0BE0 C |
 MDMAP_SET.XL_G :            FF0C8C C |  MDMAP_SET.XL_L :            FF0C84 C |
 MDMAP_SET.XR_G :            FF0C9C C |  MDMAP_SET.XR_L :            FF0C94 C |
 MDMAP_SET.YB_G :            FF0CB8 C |  MDMAP_SET.YB_L :            FF0CB0 C |
 MDMAP_SET.YT_G :            FF0CA8 C |  MDMAP_SET.YT_L :            FF0CA0 C |
 MDMAP_UPDATE :              FF0D08 C |  MDMAP_UPDATE.BEAM_INCR :    FF0DD0 C |
 MDMAP_UPDATE.NO_BG :        FF0DCE C |  MDMAP_UPDATE.THIS_BG :      FF0D18 C |
 MDMAP_UPDATE.VAL_H :        FF0DE2 C |  MDMAP_UPDATE.XD_G :         FF0DDA C |
 MDMAP_UPDATE.XD_L :         FF0DD2 C |  MDMAP_UPDATE.XEQU :         FF0D3A C |
 MDMAP_UPDATE.X_K :          FF0D9E C |  MDMAP_UPDATE.X_R :          FF0D9A C |
 MDMAP_UPDATE.YEQU :         FF0D4E C |  MDMAP_UPDATE.Y_D :          FF0DC0 C |
 MDMAP_UPDATE.Y_K :          FF0DC4 C |  MDMDL_CAMANIMATE :          FF1A54 C |
 MDMDL_CAMANIMATE.NO_CAMANIM :                                       FF1AC2 C |
 MDMDL_CAMANIMATE.ON_FRAMES :                                        FF1A8E C |
 MDMDL_SETNEWCAMERA :        FF1A38 C |  MDRAM_START :             FFFF9000 - |
 MDSYS_SINEDATA :            FF151C C | *MD_2DMODE :                 FF170C C |
*MD_2DMODE.FADE_IN :         FF1940 C |  MD_2DMODE.FADE_OUT :        FF1966 C |
 MD_2DMODE.LOOP :            FF180E C |  MD_2DMODE.LOOP2 :           FF198A C |
 MD_2DMODE.NOT_HOLD3 :       FF18F4 C |  MD_2DMODE.NOT_MODE :        FF1832 C |
 MD_2DMODE.NOZ_DOWN :        FF18AA C |  MD_2DMODE.NOZ_L :           FF18F2 C |
 MD_2DMODE.NOZ_R :           FF18DA C |  MD_2DMODE.NOZ_UP :          FF18C2 C |
 MD_2DMODE.PLOOP :           FF1812 C |  MD_2DMODE.UPDATE_POS :      FF1908 C |
 MD_2DMODE.Z_DW2 :           FF184E C |  MD_2DMODE.Z_UP :            FF187C C |
 MD_2DMODE.Z_UP2 :           FF1842 C | *MD_3DMODE :                 FF170C C |
*MD_3DMODE.FADE_IN :         FF184A C |  MD_3DMODE.FADE_OUT :        FF1870 C |
 MD_3DMODE.LOOP :            FF1814 C |  MD_3DMODE.LOOP2 :           FF1894 C |
 MD_3DMODE.NOT_MODE :        FF1836 C |  MD_3DMODE.PRE_W :           FF17FE C |
 MD_3DMODE.PRE_WL :          FF1806 C |  MD_BANK_SRAM :              A130F1 - |
 MD_BG_BH :                       1 C |  MD_BG_BLK :                     28 C |
*MD_BG_BLKW :                     2 C |  MD_BG_BW :                       0 C |
 MD_BG_COL :                     2C C |  MD_BG_FLAGS :                    3 C |
 MD_BG_H :                        A C |  MD_BG_HF :                       E C |
 MD_BG_HI :                      24 C |  MD_BG_LOW :                     20 C |
*MD_BG_MOVEX :                    6 C | *MD_BG_MOVEY :                    7 C |
 MD_BG_VPOS :                    1C C |  MD_BG_VRAM :                    1E C |
 MD_BG_W :                        8 C |  MD_BG_WF :                       C C |
 MD_BG_X :                       30 C |  MD_BG_XINC_L :                  10 C |
 MD_BG_XINC_R :                  12 C |  MD_BG_XSET :                     4 C |
 MD_BG_X_OLD :                   18 C |  MD_BG_Y :                       34 C |
 MD_BG_YINC_D :                  16 C |  MD_BG_YINC_U :                  14 C |
 MD_BG_YSET :                     5 C |  MD_BG_Y_OLD :                   1A C |
*MD_DEBUGMENU :              FF170C C |  MD_DEBUGMENU.CLEANUP :      FF1C7E C |
 MD_DEBUGMENU.CLNUP :        FF1C88 C |  MD_DEBUGMENU.COPY_1 :       FF1B92 C |
 MD_DEBUGMENU.COPY_2 :       FF1BAE C |  MD_DEBUGMENU.COPY_3 :       FF1BC8 C |
 MD_DEBUGMENU.FADE_IN :      FF1C90 C |  MD_DEBUGMENU.FADE_OUT :     FF1CB6 C |
 MD_DEBUGMENU.LIST :         FF1780 C |  MD_DEBUGMENU.LOOP :         FF1756 C |
 MD_DEBUGMENU.MOVE_CURSOR_UD :                                       FF1CEE C |
 MD_DEBUGMENU.NOAA :         FF1AFA C |  MD_DEBUGMENU.NOBA :         FF1AEA C |
 MD_DEBUGMENU.NOC_C :        FF1B2C C |  MD_DEBUGMENU.NOD2 :         FF1ABE C |
 MD_DEBUGMENU.NOL :          FF1B0A C |  MD_DEBUGMENU.NOR :          FF1B1A C |
 MD_DEBUGMENU.NOU2 :         FF1AA2 C |  MD_DEBUGMENU.NOX2 :         FF1A88 C |
 MD_DEBUGMENU.NOY2 :         FF1A6E C |  MD_DEBUGMENU.NO_UPD2 :      FF1BDC C |
 MD_DEBUGMENU.ON_LOOP :      FF177A C |  MD_DEBUGMENU.P0_DOWN :      FF1D08 C |
 MD_DEBUGMENU.P0_UP :        FF1D1E C |  MD_DEBUGMENU.PAGE0 :        FF1810 C |
 MD_DEBUGMENU.PAGE0_CURSOR : FF1822 C |  MD_DEBUGMENU.PAGE0_INIT :   FF17BA C |
 MD_DEBUGMENU.PAGE0_JUMP :   FF182C C |  MD_DEBUGMENU.PAGE0_RET :    FF17B8 C |
 MD_DEBUGMENU.PAGE1 :        FF187E C |  MD_DEBUGMENU.PAGE1_INIT :   FF183E C |
 MD_DEBUGMENU.PAGE1_RET :    FF1896 C |  MD_DEBUGMENU.PAGE2 :        FF18EA C |
 MD_DEBUGMENU.PAGE2_INIT :   FF1898 C |  MD_DEBUGMENU.PAGE2_RET :    FF1902 C |
 MD_DEBUGMENU.PAGE3 :        FF1948 C |  MD_DEBUGMENU.PAGE3_INIT :   FF1904 C |
 MD_DEBUGMENU.PAGE3_RET :    FF1970 C |  MD_DEBUGMENU.PAGE4 :        FF19BA C |
 MD_DEBUGMENU.PAGE4_INIT :   FF1974 C |  MD_DEBUGMENU.PAGE4_RET :    FF1A0E C |
 MD_DEBUGMENU.PAGE5 :        FF1A4E C |  MD_DEBUGMENU.PAGE5_INIT :   FF1A10 C |
 MD_DEBUGMENU.PAGE5_RET :    FF1B40 C |  MD_DEBUGMENU.PAGE5_UPDATE : FF1B42 C |
 MD_DEBUGMENU.PAGE5_UPDVARS :                                        FF1B66 C |
 MD_DEBUGMENU.PRINT_CURSOR : FF1CDC C |  MD_DEBUGMENU.PROCS_TASK :   FF1C10 C |
 MD_DEBUGMENU.TASKLIST :     FF1C1E C |  MD_DEBUGMENU.TASK_00 :      FF1C28 C |
 MD_DEBUGMENU.TASK_01 :      FF1C5E C |  MD_DEBUGMENU.TASK_02 :      FF1C6A C |
 MD_DEBUGMENU.TASK_03 :      FF1C6E C |  MD_DEBUGMENU.TASK_04 :      FF1C76 C |
 MD_DEBUGMENU.THIS_BG :      FF1972 C |  MD_DEBUGMENU.TOPTRK :       FF1ACE C |
 MD_DEBUGMENU.TOPTRK2 :      FF1ADA C |  MD_DEBUGMENU.WAIT :         FF1B74 C |
 MD_DEBUGMENU.Z_DW :         FF19FA C |  MD_DEBUGMENU.Z_UP :         FF19EE C |
 MD_ERRADDR :                   820 C |  MD_ERRBUS :                    820 C |
 MD_ERRCHK :                    820 C |  MD_ERRILL :                    820 C |
 MD_ERROREX :                   820 C |  MD_ERRORTRAP :                 820 C |
 MD_ERRPRIVL :                  820 C |  MD_ERRTRAPV :                  820 C |
 MD_ERRZDIV :                   820 C |  MD_INIT :                      838 C |
 MD_INIT.COPYME :               8B0 C |  MD_INIT.HOTSTART :             84E C |
 MD_INIT.LOOP_RAM :             85C C |  MD_INIT.WAIT_1 :               890 C |
 MD_INIT.WAIT_2 :               896 C |  MD_INIT.WAIT_DMA :             876 C |
 MD_LINE1010 :                  820 C |  MD_LINE1111 :                  820 C |
 MD_READMODES :              FF16E8 C | *MD_READMODES.HERE :         FF170C C |
 MD_READMODES.PICK_BOOT :    FF16FC C |  MD_TOPCODE :                   8D4 C |
 MD_TOPCODE_E :                1FE0 C |  MD_TRACE :                     820 C |
*MINFO_RAM_S :               FF0000 C |  MODE :                          18 - |
*MODE_FADEOUT :              FF169C C |  MODE_FADEOUT.LOOPW :        FF16C0 C |
 MODE_INIT :                 FF166A C |  MODE_INIT.CLR :             FF167A C |
 MODE_INIT.CLR_MDLS :        FF1688 C |  MOMCPU :                     68000 - |
*MOMCPUNAME :                 68000 - |  MONOWIDTH :                     38 - |
 MOUSE_X :                        6 C |  MOUSE_Y :                        8 C |
 MSTR_GFX0_HBLK :           600142C C |  MSTR_GFX0_INIT_1 :         6001436 C |
 MSTR_GFX0_INIT_2 :         6001430 C |  MSTR_GFX0_LOOP :           6001436 C |
 MSTR_GFX1_CONT :           6001454 C |  MSTR_GFX1_HBLK :           600143C C |
 MSTR_GFX1_INIT_1 :         6001440 C |  MSTR_GFX1_INIT_2 :         600144E C |
 MSTR_GFX1_LOOP :           6001460 C |  MSTR_GFX2_HBLK :           60014C0 C |
 MSTR_GFX2_INIT_1 :         60014C4 C |
 MSTR_GFX2_INIT_1.CLR_SCRN :                                        60014DC C |
 MSTR_GFX2_INIT_1.SLV_WAIT :                                        60014C6 C |
 MSTR_GFX2_INIT_1.WAIT_FB : 60014D0 C |  MSTR_GFX2_INIT_2 :         6001508 C |
 MSTR_GFX2_INIT_CONT :      600150E C |  MSTR_GFX2_LOOP :           6001520 C |
 MSTR_GFX2_LOOP.WAITV :     6001586 C |  MSTR_GFX2_LOOP.WAIT_SLV :  600157C C |
 MSTR_GFX3_HBLK :           600160C C |  MSTR_GFX3_INIT_1 :         6001610 C |
 MSTR_GFX3_INIT_1.CLR_SCRN :                                        6001616 C |
 MSTR_GFX3_INIT_2 :         6001630 C |  MSTR_GFX3_INIT_CONT :      6001636 C |
 MSTR_GFX3_INIT_CONT.WAIT_FB :                                      6001638 C |
 MSTR_GFX3_LOOP :           6001640 C |  MSTR_GFX3_LOOP.CONT_PLGN : 6001722 C |
 MSTR_GFX3_LOOP.CONT_PLGN2 :                                        60016E0 C |
 MSTR_GFX3_LOOP.COPY_CAM :  6001674 C |  MSTR_GFX3_LOOP.COPY_OBJ :  6001664 C |
 MSTR_GFX3_LOOP.EXIT :      6001712 C |  MSTR_GFX3_LOOP.HIGHER :    60016F6 C |
 MSTR_GFX3_LOOP.INVALID :   6001740 C |  MSTR_GFX3_LOOP.LOOP :      600172A C |
 MSTR_GFX3_LOOP.MK_ME :     6001650 C |  MSTR_GFX3_LOOP.PAGE_2 :    600171E C |
 MSTR_GFX3_LOOP.PAGE_22 :   60016DC C |  MSTR_GFX3_LOOP.ROLL :      60016E6 C |
 MSTR_GFX3_LOOP.SKIP :      6001746 C |  MSTR_GFX3_LOOP.SRCH :      60016EC C |
 MSTR_GFX3_LOOP.WAIT_FB_I : 6001694 C |  MSTR_GFX3_LOOP.WAIT_ME :   6001644 C |
 MSTR_GFX3_LOOP.WAIT_PZ :   600174A C |  MSTR_GFX3_LOOP.WAIT_SV :   600175E C |
 MSTR_GFX3_LOOP.WAIT_WDG :  6001750 C |  MSTR_GFXLIST :             60013EC C |
 MSTR_READY :               600176A C | *M_ASCII :                  600508C C |
 M_IRQ_BAD :                600038C C |  M_IRQ_CMD :                60003A8 C |
 M_IRQ_DMA :                60003FC C |  M_IRQ_DMA.WAIT_DMA :       6000406 C |
 M_IRQ_H :                  6000418 C |  M_IRQ_PWM :                6000390 C |
 M_IRQ_V :                  6000430 C |  M_IRQ_VRES :               6000440 C |
 M_IRQ_VRES.RV_BUSY :       6000480 C | *NESTMAX :                      100 - |
 ON_HOLD :                        2 C |  ON_PRESS :                       4 C |
*PACKING :                        0 - | *PADDING :                        0 - |
*PADDINGSOFAR :                   0 - |  PAD_ID :                         0 C |
 PAD_VER :                        1 C |  PALDATA_MARS_TEST :         92EAF4 C |
*PALMODE :                       31 C |  PAL_LEVEL0 :                92F062 C |
 PAL_TEST3D :                92F082 C | *PEN :                           20 - |
 PLGN_TEXURE :                   80 - |  PLGN_TRI :                      40 - |
 PLYPZ_MTRL :                     4 C |  PLYPZ_SRC_XL :                  10 C |
 PLYPZ_SRC_XL_DX :               20 C |  PLYPZ_SRC_XR_DX :               24 C |
 PLYPZ_SRC_YL :                  14 C |  PLYPZ_SRC_YL_DX :               28 C |
 PLYPZ_SRC_YR_DX :               2C C |  PLYPZ_TYPE :                     0 C |
 PLYPZ_XL :                       C C |  PLYPZ_XL_DX :                   18 C |
 PLYPZ_XR_DX :                   1C C |  PLYPZ_YTB :                      8 C |
 POLYGN_MTRL :                    4 C |  POLYGN_POINTS :                  8 C |
 POLYGN_SRCPNTS :                28 C |  POLYGN_TYPE :                    0 C |
*PSGALV :                      16C0 C | *PSGATK :                      16A4 C |
 PSGCOM :                      169C C | *PSGDEC :                      16A8 C |
*PSGDTH :                      16BC C |  PSGDTL :                      16B8 C |
*PSGENV :                      16B4 C |  PSGFREQ_LIST :                145B C |
 PSGHATMODE :                  1E5E C | *PSGLEV :                      16A0 C |
*PSGRRT :                      16B0 C | *PSGSLV :                      16AC C |
*PSGTIM :                      16C8 C | *PSGVOL :                      16CC C |
*PSG_CTRL :                  C00011 - |  PUT_PIECE :       FFFFFFFFC00005FC C |
 PUT_PIECE.BAD_PIECE :                                     FFFFFFFFC00006B0 C |
 PUT_PIECE.DONTRES :                                       FFFFFFFFC00006A6 C |
 PUT_PIECE.LEFTH : FFFFFFFFC000060E C |
 PUT_PIECE.TOP_NEG :                                       FFFFFFFFC0000692 C |
 PVOL :                          30 - | *PWCOM :                          0 - |
 PWINSH :                        20 - |  PWINSL :                        30 - |
 PWINSM :                        28 - |  PWMCOM :                      1640 C |
*PWMCTL :                        31 - |  PWMINTCLR :                     1C - |
 PWMIRQ_ON :                      1 - |  PWOUTF :                        18 - |
 PWPHL :                         10 - |  PWPTH_V :                        8 - |
 RAMCODE_DEBUG :               7BD8 C |  RAMCODE_SCRN1 :               1FE0 C |
 RAMCODE_SCRN2 :               23D8 C |  RAMCODE_USER :              FF170C C |
 RAM_BGBUFFER :    FFFFFFFFFFFF9820 C |  RAM_BGBUFFERM :   FFFFFFFFFFFFAD60 - |
 RAM_CAMDATA :     FFFFFFFFFFFF9006 C |  RAM_CAMFRAME :    FFFFFFFFFFFF900A C |
 RAM_CAMSPEED :    FFFFFFFFFFFF9012 C |  RAM_CAMTIMER :    FFFFFFFFFFFF900E C |
 RAM_CAM_XPOS :    FFFFFFFFFFFF9016 C |  RAM_CAM_YPOS :    FFFFFFFFFFFF901A C |
 RAM_CAM_ZPOS :    FFFFFFFFFFFF901E C | *RAM_CURRGFX :     FFFFFFFFFFFF9002 C |
 RAM_CURRINDX :    FFFFFFFFFFFF9006 C |  RAM_CURRPAGE :    FFFFFFFFFFFF9000 C |
 RAM_CURRSELC :    FFFFFFFFFFFF9004 C |  RAM_CURRTEMPO :   FFFFFFFFFFFF900C C |
 RAM_CURRTICKS :   FFFFFFFFFFFF900A C |  RAM_CURRTRACK :   FFFFFFFFFFFF9008 C |
*RAM_DMACODE :     FFFFFFFFFFFFA942 C |  RAM_EMIANIM :     FFFFFFFFFFFF900E C |
 RAM_EMIFRAME :    FFFFFFFFFFFF900C C | *RAM_EMITIMER :    FFFFFFFFFFFF9010 C |
 RAM_FADEMARSDELAY :                                       FFFFFFFFFFFFA6E6 C |
 RAM_FADEMARSINCR :                                        FFFFFFFFFFFFA6E4 C |
 RAM_FADEMARSREQ : FFFFFFFFFFFFA6E2 C |  RAM_FADEMARSTMR : FFFFFFFFFFFFA6E8 C |
 RAM_FADEMDDELAY : FFFFFFFFFFFFA6DE C |  RAM_FADEMDINCR :  FFFFFFFFFFFFA6DC C |
 RAM_FADEMDREQ :   FFFFFFFFFFFFA6DA C |  RAM_FADEMDTMR :   FFFFFFFFFFFFA6E0 C |
 RAM_FIELDBUFF :   FFFFFFFFFFFF9000 C |  RAM_FRAMECOUNT :  FFFFFFFFFFFF9900 C |
 RAM_GEMALIST :    FFFFFFFFFFFF9014 C |  RAM_GEMALISTFM :  FFFFFFFFFFFF901C C |
 RAM_GEMALISTPWM : FFFFFFFFFFFF9028 C |  RAM_GEMAUPD :     FFFFFFFFFFFF9012 C |
 RAM_GLBL_SCRN :   FFFFFFFFFFFFAB5E C |  RAM_HORCOPY :     FFFFFFFFFFFF9004 C |
 RAM_HORSCROLL :   FFFFFFFFFFFF9904 C | *RAM_INITFLUG :    FFFFFFFFFFFFAB4A C |
 RAM_INPUTDATA :   FFFFFFFFFFFFA702 C | *RAM_KEEPSONG :    FFFFFFFFFFFF9012 C |
 RAM_MAPX :        FFFFFFFFFFFF9000 C |  RAM_MAPY :        FFFFFFFFFFFF9004 C |
 RAM_MARS_DREQDMA :        26006890 C |  RAM_MARS_DREQREAD :       26006EE8 C |
 RAM_MARS_GLOBAL :         26007540 C |  RAM_MARS_OBJCAMERA :      26032EC8 C |
 RAM_MARS_OBJECTS :        26032D48 C |  RAM_MARS_PLGNLIST_0 :     2602F000 C |
 RAM_MARS_PLGNLIST_1 :     26030EA0 C |  RAM_MARS_PLGNNUM_0 :      26032D40 C |
 RAM_MARS_PLGNNUM_1 :      26032D44 C |  RAM_MARS_POLYGONS_0 :     26014340 C |
 RAM_MARS_POLYGONS_1 :     260219A0 C |  RAM_MARS_SCRLBUFF :       26007990 C |
 RAM_MARS_SCRLDATA :       260079F8 C |  RAM_MARS_SCRNBUFF :       26007980 C |
 RAM_MARS_SVDPDRWLIST :    26007980 C |  RAM_MARS_SVDPDRWLIST_E :  26014340 C |
 RAM_MDDREQ :      FFFFFFFFFFFFAB60 C |  RAM_MDGLOBAL :    FFFFFFFFFFFFAB5E C |
 RAM_MDMARSHINT :  FFFFFFFFFFFFAB54 C |  RAM_MDMARSPALFD : FFFFFFFFFFFFA274 C |
 RAM_MDMARSVINT :  FFFFFFFFFFFFAB4E C |  RAM_MDSOUND :     FFFFFFFFFFFF9800 C |
 RAM_MDSYSTEM :    FFFFFFFFFFFFA702 C | *RAM_MDVBLKWAIT :  FFFFFFFFFFFFAB5A C |
 RAM_MDVIDEO :     FFFFFFFFFFFF9820 C |  RAM_MODEBUFF :    FFFFFFFFFFFF9000 C |
 RAM_PALETTE :     FFFFFFFFFFFFA174 C |  RAM_PALETTEFD :   FFFFFFFFFFFFA1F4 C |
*RAM_SAVEDATA :    FFFFFFFFFFFFA742 C |  RAM_SCRN0_FRAME : FFFFFFFFFFFF900E C |
 RAM_SCRN0_TIMER : FFFFFFFFFFFF9010 C |  RAM_SNDSAVEREG :  FFFFFFFFFFFF9800 C |
 RAM_SPRFRAME :    FFFFFFFFFFFF9038 C |  RAM_SPRITES :     FFFFFFFFFFFF9D14 C |
 RAM_SPRTIMER :    FFFFFFFFFFFF9036 C | *RAM_SYSFLAGS :    FFFFFFFFFFFFAB5C C |
 RAM_SYSRANDSEED : FFFFFFFFFFFFAB46 C |  RAM_SYSRANDVAL :  FFFFFFFFFFFFAB42 C |
 RAM_THISSPEED :   FFFFFFFFFFFF9008 C |  RAM_VDPDMAINDX :  FFFFFFFFFFFFA6D4 C |
 RAM_VDPDMALIST :  FFFFFFFFFFFFA474 C |  RAM_VDPDMAMOD :   FFFFFFFFFFFFA6D6 C |
 RAM_VDPREGS :     FFFFFFFFFFFFA6EA C |  RAM_VERSCROLL :   FFFFFFFFFFFF9CC4 C |
 RAM_VIDPRNTLIST : FFFFFFFFFFFFA554 C |  RAM_VIDPRNTVRAM : FFFFFFFFFFFFA6D8 C |
 RCHWIDTH :                      36 - |  READROMB :                     EF2 C |
 READROMB.IMBACK :              F02 C |  READROMB.W2 :                  F0F C |
 READROMB.WAIT :                F0B C | *RELAXED :                        0 - |
 ROM_END :                   17E7D4 C |  RRT :                           14 - |
 SAMPLE_RATE :                 5622 - |  SBEATACC :                      34 C |
 SBEATPTCK_1 :                   32 C | *SCN0_TIMER :                     8 - |
 SCREEN_HEIGHT :                 E0 - |  SCREEN_WIDTH :                 140 - |
 SCRL_BLKSIZE :                  10 C |  SCRL_FBDATA :                   28 C |
 SCRL_FBPOS :                    24 C |  SCRL_FBPOS_Y :                  20 C |
 SCRL_INTRL_H :                  1C C |  SCRL_INTRL_SIZE :               14 C |
 SCRL_INTRL_W :                  18 C |  SCRL_XPOS :                     2C C |
 SCRL_XPOS_OLD :                  0 C |  SCRL_XSET :                      8 C |
 SCRL_YPOS :                     30 C |  SCRL_YPOS_OLD :                  4 C |
 SCRL_YSET :                      C C |  SETUPCHIP :                    552 C |
 SETUPCHIP.ALRDFND :            E18 C | *SETUPCHIP.BAD_INS :            DBE C |
 SETUPCHIP.BUSY_S :             DE8 C |  SETUPCHIP.CHECK_CHNL :         D90 C |
 SETUPCHIP.CHECK_INS :          D7D C |  SETUPCHIP.CHIP_OUT :           CC9 C |
 SETUPCHIP.CHIP_SWAP :          C8D C |  SETUPCHIP.CHKFREE :            E1F C |
 SETUPCHIP.CHK_TBL :            DEB C |  SETUPCHIP.CHK_TBLN :           DCD C |
 SETUPCHIP.CHNL_UNLINK :        ACD C |  SETUPCHIP.CHP_UNLK :           D56 C |
 SETUPCHIP.CLR :                577 C |  SETUPCHIP.CONFM_RD :           71C C |
 SETUPCHIP.DAC_OUT :            CEE C | *SETUPCHIP.DCUT :               BB8 C |
 SETUPCHIP.DIFFR :              E04 C | *SETUPCHIP.DOFF :               BBD C |
 SETUPCHIP.DO_CHNL :            597 C |  SETUPCHIP.EFFDAC_E :           8EF C |
 SETUPCHIP.EFFDAC_F :           91E C |  SETUPCHIP.EFFFM_D :            885 C |
 SETUPCHIP.EFFFM_E :            8E1 C |  SETUPCHIP.EFFFM_F :            917 C |
 SETUPCHIP.EFFFM_X :            9F4 C |  SETUPCHIP.EFFPSG_D :           857 C |
 SETUPCHIP.EFFPSG_E :           8D7 C |  SETUPCHIP.EFFPSG_F :           909 C |
 SETUPCHIP.EFFPWM_E :           8FC C |  SETUPCHIP.EFFPWM_F :           924 C |
 SETUPCHIP.EFFPWM_X :           9DB C |  SETUPCHIP.EFF_DAC :            82E C |
 SETUPCHIP.EFF_FM :             817 C |  SETUPCHIP.EFF_PSG :            804 C |
 SETUPCHIP.EFF_PWM :            840 C |  SETUPCHIP.E_FNEGD2 :           906 C |
 SETUPCHIP.E_GO :               9DA C |  SETUPCHIP.E_NEG :              8EB C |
 SETUPCHIP.E_NEGD :             8F9 C |  SETUPCHIP.E_NEGP :             914 C |
 SETUPCHIP.E_NOEF :             9D6 C |  SETUPCHIP.E_NOF :              9CC C |
 SETUPCHIP.FM3_OUT :            CFC C |  SETUPCHIP.FMPAN_LIST :         A2E C |
 SETUPCHIP.FMPICKINS :          72F C |  SETUPCHIP.FMSAME_INS :         72D C |
 SETUPCHIP.FM_CHNLKON :         C60 C |  SETUPCHIP.FM_KEYCUT :          C84 C |
 SETUPCHIP.FM_KEYOFF :          C89 C |  SETUPCHIP.FM_KPV :             C83 C |
 SETUPCHIP.FM_OUT :             D38 C |  SETUPCHIP.FNDLINK :            E14 C |
 SETUPCHIP.FNDSLOT :            E32 C |  SETUPCHIP.FND_OCT :            C3D C |
 SETUPCHIP.FREQINC_DAC :        95C C |  SETUPCHIP.FREQINC_FM :         96C C |
 SETUPCHIP.FREQINC_PSG :        992 C |  SETUPCHIP.FREQINC_PWM :        928 C |
 SETUPCHIP.FROM_NL :            CA6 C |  SETUPCHIP.GET_OCT :            C32 C |
 SETUPCHIP.GO_DOWN :            8BE C |  SETUPCHIP.GO_UP :              8C7 C |
 SETUPCHIP.GRAB_DVAL :          8B4 C |  SETUPCHIP.GRAB_PRTM :          9BC C |
 SETUPCHIP.INS_DAC :            675 C |  SETUPCHIP.INS_FM :             6BE C |
 SETUPCHIP.INS_FM3 :            6AF C |  SETUPCHIP.INS_PSG :            646 C |
 SETUPCHIP.INS_PSGN :           640 C |  SETUPCHIP.INS_PWM :            605 C |
 SETUPCHIP.LOWP :               87C C |  SETUPCHIP.LOWPF :              8AB C |
 SETUPCHIP.MK_CHIP :            563 C |  SETUPCHIP.NEW :                DDF C |
 SETUPCHIP.NEXT :               DEE C |  SETUPCHIP.NODEFV :             B7A C |
 SETUPCHIP.NOTEPSG_C :          B40 C |  SETUPCHIP.NOTEPSG_FN :         B4D C |
 SETUPCHIP.NOTE_DAC :           B85 C |  SETUPCHIP.NOTE_FM :            BEC C |
 SETUPCHIP.NOTE_FM3 :           BC8 C |  SETUPCHIP.NOTE_PSG :           B1B C |
 SETUPCHIP.NOTE_PSGN :          AEE C |  SETUPCHIP.NOTE_PWM :           A5D C |
 SETUPCHIP.NOT_PRDAC :          6D2 C |  SETUPCHIP.NO_CHNL :            5D8 C |
 SETUPCHIP.NP2_N :              B18 C |  SETUPCHIP.NXT_CHNL :           585 C |
 SETUPCHIP.PCUT :               ACB C |  SETUPCHIP.POFF :               AC7 C |
 SETUPCHIP.PSGN_OUT :           D0A C |  SETUPCHIP.PSG_OUT :            D18 C |
 SETUPCHIP.PVMUCH :             780 C |  SETUPCHIP.PWMN_KPV :           AA8 C |
 SETUPCHIP.PWM_KEYCUT :         AC3 C |  SETUPCHIP.PWM_KEYOFF :         ABF C |
 SETUPCHIP.PWM_OUT :            CCB C |  SETUPCHIP.P_OUT :              D36 C |
 SETUPCHIP.RAN_OUT :            5CE C |  SETUPCHIP.RD_FMINS :           6E9 C |
 SETUPCHIP.RD_NT3 :             C27 C |  SETUPCHIP.REQ_EFF :            7D6 C |
 SETUPCHIP.REQ_INS :            5DE C |  SETUPCHIP.REQ_NOTE :           A32 C |
 SETUPCHIP.REQ_VOL :            73B C |  SETUPCHIP.TBLLIST :            DC1 C |
 SETUPCHIP.VMUCH :              7AA C |  SETUPCHIP.VOL_FM :             7B1 C |
 SETUPCHIP.VOL_PSG :            78E C |  SETUPCHIP.VOL_PWM :            75B C |
 SET_LEFT :        FFFFFFFFC00004EC C |  SET_LEFT.LFT_OK : FFFFFFFFC000050E C |
 SET_LEFT.LFT_SKIP :                                       FFFFFFFFC000056E C |
 SET_MAPSPD :                    10 - |  SET_RIGHT :       FFFFFFFFC0000574 C |
 SET_RIGHT.RGT_OK :                                        FFFFFFFFC0000596 C |
 SET_RIGHT.RGT_SKIP :                                      FFFFFFFFC00005F6 C |
 SET_STARTPAGE :                  0 - |  SH2_DEBUG :                      1 - |
 SH2_MASTER :               6000000 C |  SH2_M_ENTRY :              600127C C |
 SH2_M_ERRADDR :            6000338 C |  SH2_M_ERRCODE :            6000348 C |
 SH2_M_ERRDMA :             600033C C |  SH2_M_ERRILLG :            6000330 C |
 SH2_M_ERRINVL :            6000334 C |  SH2_M_ERRNMI :             6000340 C |
 SH2_M_ERROR :              600032C C |  SH2_M_ERRUSER :            6000344 C |
 SH2_M_HOTSTART :           60012BE C |  SH2_M_HOTSTART.WAIT_SLV :  60012F2 C |
 SH2_RAM :                  6006890 C |  SH2_SLAVE :                6000128 C |
 SH2_S_ENTRY :              60017E8 C |  SH2_S_ERRADDR :            6000364 C |
 SH2_S_ERRCODE :            6000374 C |  SH2_S_ERRDMA :             6000368 C |
 SH2_S_ERRILLG :            600035C C |  SH2_S_ERRINVL :            6000360 C |
 SH2_S_ERRNMI :             600036C C |  SH2_S_ERROR :              6000358 C |
 SH2_S_ERRUSER :            6000370 C |  SH2_S_HOTSTART :           6001838 C |
 SH2_S_HOTSTART.WAIT_MST :  6001876 C |  SHIFT :                          2 - |
 SHOWROM :                      ED1 C |  SIN_TABLE :                600288C C |
 SIZEOF_CAMERA :                 18 C |  SIZEOF_DREQ :                  658 C |
 SIZEOF_INPUT :                  10 C |  SIZEOF_MARSGBL :                30 C |
*SIZEOF_MARSRAM :          26033980 C | *SIZEOF_MARSRAM.HERE :     26033980 C |
 SIZEOF_MARSSND :          26007980 C |  SIZEOF_MARSSPR :                18 C |
 SIZEOF_MARSSYS :          26007600 C |  SIZEOF_MARSVID :          26033980 C |
 SIZEOF_MDBG :                   38 C |  SIZEOF_MDFIELD :                 4 C |
 SIZEOF_MDGLBL :   FFFFFFFFFFFFAB60 C |  SIZEOF_MDLOBJ :                 18 C |
 SIZEOF_MDRAM :    FFFFFFFFFFFFB1B8 C |  SIZEOF_MDSND :    FFFFFFFFFFFF9820 C |
 SIZEOF_MDSYS :    FFFFFFFFFFFFAB5E C |  SIZEOF_MDVID :    FFFFFFFFFFFFA702 C |
 SIZEOF_MSCRL :                  34 C |  SIZEOF_PLYPZ :                  30 C |
 SIZEOF_POLYGN :                 38 C | *SIZEOF_SCRN04 :           26032EE0 C |
 SIZEOF_SNDCHN :                 28 C |  SLAVE_IRQ :                6000278 C |
 SLAVE_LOOP :               60018BC C |  SLAVE_LOOP.LIST :          60018D4 C |
 SLV :                           10 - |  SLVPLGN_00 :      FFFFFFFFC0000390 C |
 SLVPLGN_01 :      FFFFFFFFC00000C8 C |  SLVPLGN_01.EXIT : FFFFFFFFC00000DA C |
 SLVPLGN_01.HAS_PZ :                                       FFFFFFFFC00000DE C |
 SLVPLGN_02 :      FFFFFFFFC0000080 C | *SLVPLGN_02.EXIT : FFFFFFFFC00000C4 C |
 SLV_EXIT :                 60018FC C |  SLV_TASK_1 :               60018E4 C |
 SLV_TASK_2 :               60018F0 C |  SMPINS_BELL_ICE :          204FC70 C |
 SMPINS_BELL_ICE.END :      205379C C |  SMPINS_BELL_ICE.START :    204FC76 C |
 SMPINS_BRASS1_HI :         205379C C |  SMPINS_BRASS1_HI.END :     205B368 C |
 SMPINS_BRASS1_HI.START :   20537A2 C |  SMPINS_BRASS1_LOW :        205B368 C |
 SMPINS_BRASS1_LOW.END :    2062F34 C |  SMPINS_BRASS1_LOW.START :  205B36E C |
 SMPINS_FOREST_1 :          2062F34 C |  SMPINS_FOREST_1.END :      2067820 C |
 SMPINS_FOREST_1.START :    2062F3A C |  SMPINS_KICK :              20B4564 C |
 SMPINS_KICK.END :          20B5F64 C |  SMPINS_KICK.START :        20B456A C |
 SMPINS_KICK_JAM :          2067820 C |  SMPINS_KICK_JAM.END :      20682EC C |
 SMPINS_KICK_JAM.START :    2067826 C |  SMPINS_MOVEME_BRASS :      20A1BF8 C |
 SMPINS_MOVEME_BRASS.END :  20B4564 C |
 SMPINS_MOVEME_BRASS.START :                                        20A1BFE C |
 SMPINS_MOVEME_HIT :        209ED3C C |  SMPINS_MOVEME_HIT.END :    20A1BF8 C |
 SMPINS_MOVEME_HIT.START :  209ED42 C |  SMPINS_MYTIME :            20B79A0 C |
 SMPINS_MYTIME.END :        20C297C C |  SMPINS_MYTIME.START :      20B79A6 C |
 SMPINS_NADIE :             2070F88 C |  SMPINS_NADIE.END :         2097804 C |
 SMPINS_NADIE.START :       2070F8E C |  SMPINS_PIANO :             2098B40 C |
 SMPINS_PIANO.END :         209ED3C C |  SMPINS_PIANO.START :       2098B46 C |
*SMPINS_PIANO_1 :           206A100 C |  SMPINS_PIANO_1.END :       206E81C C |
 SMPINS_PIANO_1.START :     206A106 C |  SMPINS_PKICK :             2097804 C |
 SMPINS_PKICK.END :         2097F80 C |  SMPINS_PKICK.START :       209780A C |
 SMPINS_PTOM :              2097F80 C |  SMPINS_PTOM.END :          2098B40 C |
 SMPINS_PTOM.START :        2097F86 C |  SMPINS_SNARE :             20B5F64 C |
 SMPINS_SNARE.END :         20B79A0 C |  SMPINS_SNARE.START :       20B5F6A C |
 SMPINS_SNARE_JAM :         20682EC C |  SMPINS_SNARE_JAM.END :     2068C58 C |
 SMPINS_SNARE_JAM.START :   20682F2 C |  SMPINS_SNRTOM_1 :          2068C58 C |
 SMPINS_SNRTOM_1.END :      206A100 C |  SMPINS_SNRTOM_1.START :    2068C5E C |
*SMPINS_SSTR162A :          206E81C C |  SMPINS_SSTR162A.END :      2070F88 C |
 SMPINS_SSTR162A.START :    206E822 C |  SNDLOCKZ80 :                FF0094 C |
 SNDLOCKZ80.WAIT :           FF009C C |  SNDREQCMD :                 FF0126 C |
 SNDREQCMD.WAIT_IN :         FF0126 C |  SNDREQCMD.WAIT_OUT :        FF015C C |
 SNDREQ_ENTER :              FF00B2 C |  SNDREQ_ENTER.WAIT :         FF00D8 C |
 SNDREQ_EXIT :               FF00E8 C |  SNDREQ_SADDR :              FF0110 C |
 SNDREQ_SBYTE :              FF0118 C |  SNDREQ_SCMD :               FF00FE C |
*SNDREQ_SLONG :              FF010C C |  SNDREQ_SWORD :              FF0114 C |
 SNDUNLOCKZ80 :              FF00A8 C |  SOUND_DMA_PAUSE :           FF016A C |
 SOUND_DMA_PAUSE.RETRY :     FF016E C |  SOUND_DMA_PAUSE.SAFE :      FF0188 C |
 SOUND_DMA_RESUME :          FF01A4 C |  SOUND_GLBBEATS :            FF024C C |
 SOUND_INIT :                FF002C C |  SOUND_INIT.CLEANUP :        FF0056 C |
 SOUND_INIT.COPY :           FF006C C |  SOUND_INIT.WAIT :           FF0040 C |
 SOUND_TRKPLAY :             FF01C6 C |  SOUND_TRKRESUME :           FF021A C |
 SOUND_TRKSTOP :             FF0204 C |  SOUND_TRKTICKS :            FF0230 C |
 STACK_MSTR :               6040000 - |  STACK_SLV :                603F000 - |
 STANDBY :                        3 - |  STR_CURSOR :                FF1EE6 C |
 STR_GEMA :                  FF204C C |  STR_GEMAFM :                FF21EA C |
 STR_GEMAPSG :               FF21CA C |  STR_GEMAPWM :               FF221A C |
 STR_GEMASTATUS :            FF20CE C |  STR_PAGE1 :                 FF1F8A C |
*STR_PAGE1_INFO :            FF201E C |  STR_PAGE2 :                 FF1FBA C |
 STR_PAGE3 :                 FF1FF6 C |  STR_PAGE3_BG :              FF1FDA C |
 STR_PAGE4 :                 FF2012 C |  STR_STATS :                 FF2252 C |
*STR_STATS.HERE :            FF2292 C |  STR_STATS2 :                FF1AC6 C |
 STR_STATUS :                FF202C C |  STR_TITLE :                 FF1EEC C |
 SUPERSPRITE_TEST :          FF1DEC C |  SUPERSPRITE_TEST.NOD_S :    FF1E88 C |
 SUPERSPRITE_TEST.NOD_S2 :   FF1ECE C |  SUPERSPRITE_TEST.NOL_S :    FF1E80 C |
 SUPERSPRITE_TEST.NOL_S2 :   FF1EC6 C |  SUPERSPRITE_TEST.NOR_S :    FF1E78 C |
 SUPERSPRITE_TEST.NOR_S2 :   FF1EBE C |  SUPERSPRITE_TEST.NOT_HOLD : FF1EDE C |
 SUPERSPRITE_TEST.NOT_HOLD2 :                                        FF1E98 C |
 SUPERSPRITE_TEST.NOT_HOLD3 :                                        FF1E38 C |
 SUPERSPRITE_TEST.NOT_HOLD4 :                                        FF1E52 C |
 SUPERSPRITE_TEST.NOU_S :    FF1E90 C |  SUPERSPRITE_TEST.NOU_S2 :   FF1ED6 C |
 SUPERSPRITE_TEST.WSPR :     FF1E1E C |  SUPERSPRITE_TEST_INIT :     FF1D6C C |
 SUPERSPR_INIT :             FF1996 C |  SUPERSPR_MAIN :             FF19E6 C |
 SUPERSPR_MAIN.NOD_S :       FF1A6A C |  SUPERSPR_MAIN.NOL_S :       FF1A62 C |
 SUPERSPR_MAIN.NOR_S :       FF1A5A C | *SUPERSPR_MAIN.NOT_HOLD :    FF1A7A C |
 SUPERSPR_MAIN.NOT_HOLD2 :   FF1A7A C |  SUPERSPR_MAIN.NOT_HOLD3 :   FF1A04 C |
 SUPERSPR_MAIN.NOT_HOLD4 :   FF1A1A C |  SUPERSPR_MAIN.NOT_HOLD5 :   FF1A34 C |
 SUPERSPR_MAIN.NOU_S :       FF1A72 C |  SUPERSPR_TEST :            215367C C |
*SYSMARS_ID :                A130EC - |  SYSMARS_REG :               A15100 - |
 SYSTEM_DMA_ENTER :          FF12D8 C |  SYSTEM_DMA_EXIT :           FF12E0 C |
 SYSTEM_INIT :               FF119C C |  SYSTEM_INIT.CLRINPUT :      FF1212 C |
 SYSTEM_INIT.WAIT :          FF11AA C |  SYSTEM_INPUT :              FF1314 C |
 SYSTEM_INPUT.EXIT :         FF1342 C |  SYSTEM_INPUT.ID_03 :        FF1368 C |
 SYSTEM_INPUT.ID_0D :        FF1412 C |  SYSTEM_INPUT.INVALID :      FF140C C |
 SYSTEM_INPUT.LIST :         FF1348 C |  SYSTEM_INPUT.OLDPAD :       FF148A C |
 SYSTEM_INPUT.PICK_ID :      FF1490 C |  SYSTEM_INPUT.READ :         FF14A6 C |
 SYSTEM_INPUT.STEP_1 :       FF14B2 C |  SYSTEM_INPUT.STEP_2 :       FF14BE C |
 SYSTEM_INPUT.THIS_ONE :     FF1328 C | *SYSTEM_INPUT.WAIT :         FF1314 C |
 SYSTEM_INPUT.X_NEG :        FF13DA C |  SYSTEM_INPUT.Y_NEG :        FF1406 C |
 SYSTEM_JUMPRAMCODE :        FF12F6 C |
 SYSTEM_JUMPRAMCODE.COPYME2 :                                        FF1308 C |
 SYSTEM_MARSUPDATE :         FF12E8 C | *SYSTEM_RANDOM :             FF14C0 C |
 SYSTEM_ROMSENDDREQ :        88A5C6 C | *SYSTEM_ROMSENDDREQ.BAD :    88A61E C |
 SYSTEM_ROMSENDDREQ.L0 :     88A608 C |
 SYSTEM_ROMSENDDREQ.WAIT_BIT :                                       88A5F4 C |
 SYSTEM_SETINTS :            FF161C C |  SYSTEM_SETINTS.NOHINT :     FF1640 C |
 SYSTEM_SETINTS.NOVINT :     FF162E C | *SYSTEM_SINEWAVE :           FF14FE C |
 SYSTEM_SINEWAVE.DONT_NEG :  FF151A C | *SYSTEM_SINEWAVE_COS :       FF14DE C |
 SYSTEM_SINEWAVE_COS.DONT_NEG :                                      FF14F8 C |
*SYSTEM_SRAMINIT :           FF1642 C |  SYSTEM_SRAMINIT.INITSAVE :  FF1656 C |
 SYSTEM_WAITFRAME :          FF121E C |  SYSTEM_WAITFRAME.WAIT_IN :  FF1236 C |
 SYSTEM_WAITFRAME.WAIT_LAG : FF1224 C |  SYS_CTRL_1 :                A10009 - |
 SYS_CTRL_2 :                A1000B - |  SYS_CTRL_3 :                A1000D - |
 SYS_DATA_1 :                A10003 - | *SYS_DATA_2 :                A10005 - |
*SYS_DATA_3 :                A10007 - | *SYS_EXRAM :                 200000 - |
*SYS_IO :                    A10001 - | *SYS_TMSS :                  A14000 - |
 S_IRQ_BAD :                60004C0 C |  S_IRQ_CMD :                60004C4 C |
*S_IRQ_CMD.COPY_1 :         600058C C |  S_IRQ_CMD.END_CHNLS :      60006B4 C |
 S_IRQ_CMD.EXIT_C :         600059A C |  S_IRQ_CMD.GO_EXIT :        6000508 C |
 S_IRQ_CMD.LIST :           6000514 C |  S_IRQ_CMD.MODE_1 :         6000578 C |
 S_IRQ_CMD.MODE_2 :         6000554 C |  S_IRQ_CMD.MODE_3 :         6000568 C |
 S_IRQ_CMD.NEXT_CHNL :      60005A0 C |  S_IRQ_CMD.NO_CMDTASK :     60006DA C |
 S_IRQ_CMD.NO_KEYOFF :      60005D8 C |  S_IRQ_CMD.NO_PITCHBND :    60005FC C |
 S_IRQ_CMD.NO_REQ :         60006AA C |  S_IRQ_CMD.NO_REQ2 :        60005C8 C |
 S_IRQ_CMD.NO_TRNSFREX :    60006BA C |  S_IRQ_CMD.NO_VOLUMEBND :   6000614 C |
 S_IRQ_CMD.PWM_KEYCUT :     60005CC C |  S_IRQ_CMD.PWM_KEYOFF :     60005C0 C |
*S_IRQ_CMD.TAG_F0 :         600050C C |  S_IRQ_CMD.TAG_FRT :        6000510 C |
 S_IRQ_CMD.WAIT_1 :         6000580 C |  S_IRQ_H :                  6000724 C |
 S_IRQ_PWM :       FFFFFFFFC0000014 C |
 S_IRQ_PWM.FROM_RV :                                       FFFFFFFFC00000C4 C |
 S_IRQ_PWM.LMUCH : FFFFFFFFC0000126 C |  S_IRQ_PWM.LOOP :  FFFFFFFFC0000042 C |
 S_IRQ_PWM.LOOP_ME :                                       FFFFFFFFC0000072 C |
 S_IRQ_PWM.MONO :  FFFFFFFFC00000CE C |
 S_IRQ_PWM.MONO_A :                                        FFFFFFFFC00000BC C |
 S_IRQ_PWM.MONO_C :                                        FFFFFFFFC000009C C |
 S_IRQ_PWM.MONO_L :                                        FFFFFFFFC000007E C |
 S_IRQ_PWM.NOT_ROM :                                       FFFFFFFFC00000AE C |
 S_IRQ_PWM.NO_L :  FFFFFFFFC00000E2 C |  S_IRQ_PWM.NO_R :  FFFFFFFFC00000E8 C |
 S_IRQ_PWM.ON :    FFFFFFFFC0000050 C |  S_IRQ_PWM.READ :  FFFFFFFFC0000080 C |
 S_IRQ_PWM.RMUCH : FFFFFFFFC000012C C |
 S_IRQ_PWM.SILENT :                                        FFFFFFFFC0000048 C |
 S_IRQ_PWM.SKIP :  FFFFFFFFC000010C C |  S_IRQ_V :                  6000740 C |
 S_IRQ_VRES :               600075C C |  S_IRQ_VRES.RV_BUSY :       600079C C |
 TAG_JR :          FFFFFFFFC00002A8 C |  TAG_WIDTH :       FFFFFFFFC00002AC C |
 TAG_YHGHT :       FFFFFFFFC00002B0 C |  TBLFM :                       17EF C |
 TBLFM3 :                      180F C |  TBLFM6 :                      1817 C |
 TBLPSG :                      17CD C |  TBLPSGN :                     17E7 C |
 TBLPWM :                      1821 C |  TESTSUPSPR_PAL :            92EFF4 C |
 TEST_MAINSPD :                   4 - | *TEST_SPEED :                 20000 - |
 TEST_SPRSPD :                    2 - |  TEXTR_MARSCITY :           20D367C C |
*TEXTR_PECSI :              211367C C |  TH :                      20000000 - |
 TICKCNT :                     1E4A C |  TICKFLAG :                    1E48 C |
*TIME :                     1:21:17 - |  TIMERCTL :                      30 - |
*TMR :                           2C - |  TRACK_OUT :                    499 C |
 TRACK_OUT.CLRFE :              4A8 C |  TRACK_OUT.NOCHIP :             4BE C |
 TRANSFERROM :                  F1F C |  TRANSFERROM.DOUBLE :           F3E C |
 TRANSFERROM.TRANSFER :         F63 C |  TRANSFERROM.X68KLAST :         F82 C |
 TRANSFERROM.X68KLOOP :         F71 C |  TRANSFERROM.X68KLPCONT :       F7A C |
 TRANSFERROM.X68KLPWT :         F94 C |  TRANSFERROM.X68KLSTCONT :      F8C C |
 TRANSFERROM.X68KLSTWT :        FA7 C |  TRANSFERROM.X68KLSTWTLP :      FAB C |
 TRANSFERROM.X68KNOCARRY :      F5D C |  TRANSFERROM.X68KPWTLP :        F98 C |
 TRKBUFF_0 :                   1960 C |  TRKBUFF_1 :                   1A08 C |
 TRKDATA_0 :                   1C00 C |  TRKDATA_1 :                   1D00 C |
 TRKHDOUT :                    1E60 C |  TRKPOINTERS :                  1B5 C |
 TRK_CACHNOTES :                 18 - |  TRK_CMDREQ :                    1A - |
 TRK_CURRBLK :                   11 - |  TRK_HALFWAY :                   10 - |
 TRK_READ :                       C - |  TRK_ROMBLK :                     0 - |
 TRK_ROMINS :                     6 - |  TRK_ROMPATT :                    3 - |
 TRK_ROMPATTRD :                  9 - |  TRK_ROWPAUSE :                  17 - |
 TRK_ROWS :                       E - |  TRK_SETBLK :                    12 - |
 TRK_SIZEINS :                   16 - |  TRK_STATUS :                    13 - |
 TRK_TICKSET :                   15 - |  TRK_TICKTMR :                   14 - |
*TRUE :                           1 - | *TVMODE :                         0 - |
 UPDTRACK :                     1DA C |  UPDTRACK.CLRF :                43B C |
 UPDTRACK.DECROW :              258 C |  UPDTRACK.DECROW_E :            25B C |
 UPDTRACK.EFFECT_FILL :         41B C |  UPDTRACK.EFF_A :               346 C |
 UPDTRACK.EFF_B :               350 C |  UPDTRACK.EFF_C :               36A C |
 UPDTRACK.EXIT :                24D C |  UPDTRACK.FIRST_FILL :          423 C |
 UPDTRACK.GO_EFFECT :           459 C |  UPDTRACK.GRAB_ASAP :           319 C |
 UPDTRACK.HAS_NOTE :            264 C |  UPDTRACK.INC_CPATT :           2FC C |
 UPDTRACK.NEXT_NOTE :           23B C |  UPDTRACK.NEXT_TRACK :          375 C |
 UPDTRACK.NOCHIP :              44B C |  UPDTRACK.NO_EFF :              2C1 C |
 UPDTRACK.NO_INS :              2A3 C |  UPDTRACK.NO_NOTE :             298 C |
 UPDTRACK.NO_VOL :              2AF C |  UPDTRACK.OLD_TYPE :            28C C |
 UPDTRACK.READ_TRACK :          1F2 C |  UPDTRACK.SET_TRACK :           37C C |
 UPDTRACK.SFXMD :               20C C |  UPDTRACK.SZGOOD :              3F2 C |
 UPDTRACK.SZMUCH :              3ED C |  UPDTRACK.TRACK_END :           486 C |
 UPDTRACK.TRKEND_EFFC :         487 C |  VARNULLVRAM :                  7FF - |
 VARPRINTPAL :                    3 - |  VARPRINTVRAM :                 580 - |
 VBLK :                          80 - |  VDPSTS :                         A - |
 VDP_CTRL :                  C00004 - |  VDP_DATA :                  C00000 - |
*VERSION :                     142F - |  VIDEO_CLEAR :               FF02F0 C |
 VIDEO_CLEARSCREEN :         FF02F0 C |  VIDEO_CLEARSCREEN.PMNEXT :  FF0380 C |
 VIDEO_CLEARSCREEN.PNEXT :   FF036E C |  VIDEO_CLEARSCREEN.SNEXT :   FF035A C |
 VIDEO_CLEARSCREEN.XNEXT :   FF033A C |  VIDEO_CLEARSCREEN.YNEXT :   FF034A C |
*VIDEO_COPY :                FF084E C |  VIDEO_COPY.DMAW :           FF0862 C |
 VIDEO_COPY.DMAWE :          FF08BA C | *VIDEO_DMABLAST :            FF0988 C |
 VIDEO_DMABLAST.END :        FF09E0 C |  VIDEO_DMABLAST.EXIT :       FF09F8 C |
 VIDEO_DMABLAST.NEXT :       FF09BA C | *VIDEO_DMAMKENTRY :          FF076A C |
 VIDEO_DOPALFADE :           FF0620 C |  VIDEO_DOPALFADE.ACTIVE :    FF063C C |
 VIDEO_DOPALFADE.FADE_DONE : FF0644 C |  VIDEO_DOPALFADE.FADE_IN :   FF0646 C |
 VIDEO_DOPALFADE.FADE_LIST : FF063E C |  VIDEO_DOPALFADE.FADE_OUT :  FF06EA C |
 VIDEO_DOPALFADE.NO_BLU :    FF06C2 C |  VIDEO_DOPALFADE.NO_BLU_O :  FF0746 C |
 VIDEO_DOPALFADE.NO_FNSH :   FF06DA C |  VIDEO_DOPALFADE.NO_FNSH_O : FF075A C |
 VIDEO_DOPALFADE.NO_GRN :    FF06A2 C |  VIDEO_DOPALFADE.NO_GRN_O :  FF072E C |
 VIDEO_DOPALFADE.NO_MOVE :   FF06E8 C |  VIDEO_DOPALFADE.NO_MOVE_O : FF0768 C |
 VIDEO_DOPALFADE.NO_RED :    FF0682 C |  VIDEO_DOPALFADE.NO_RED_O :  FF0716 C |
 VIDEO_DOPALFADE.NXT_PAL :   FF0660 C |  VIDEO_DOPALFADE.NXT_PAL_O : FF06FE C |
 VIDEO_FADEPAL :             FF05F2 C |  VIDEO_FADEPAL_MARS :        FF0A3A C |
 VIDEO_FILL :                FF07DC C |  VIDEO_FILL.DMAW :           FF07F0 C |
 VIDEO_FILL.DMAWE :          FF0836 C |  VIDEO_INIT :                FF0268 C |
 VIDEO_INIT.CLRRAM :         FF0272 C | *VIDEO_INIT.EXIT :           FF029C C |
 VIDEO_INIT.LOOP :           FF028E C |  VIDEO_LOADART :             FF08D2 C |
 VIDEO_LOADART.FROM_RAM :    FF0974 C |  VIDEO_LOADMAP :             FF0388 C |
 VIDEO_LOADMAP.CONT :        FF03AE C |  VIDEO_LOADMAP.NODBLE :      FF03CE C |
 VIDEO_LOADMAP.NONULL :      FF03AC C |  VIDEO_LOADMAP.XLOOP :       FF039E C |
 VIDEO_LOADMAP.YLOOP :       FF0394 C |  VIDEO_LOADPAL :             FF05FC C |
*VIDEO_LOADPAL_MARS :        FF0A44 C |  VIDEO_MARSPALFADE :         FF0A6C C |
 VIDEO_MARSPALFADE.ACTIVE :  FF0A88 C |
 VIDEO_MARSPALFADE.FADE_DONE :                                       FF0A90 C |
 VIDEO_MARSPALFADE.FADE_IN : FF0A92 C |
 VIDEO_MARSPALFADE.FADE_LIST :                                       FF0A8A C |
 VIDEO_MARSPALFADE.FADE_OUT :                                        FF0B3C C |
 VIDEO_MARSPALFADE.NO_BLU :  FF0B0C C |
 VIDEO_MARSPALFADE.NO_BLU_O :                                        FF0B98 C |
 VIDEO_MARSPALFADE.NO_FNSH : FF0B2C C |
 VIDEO_MARSPALFADE.NO_FNSH_O :                                       FF0BAE C |
 VIDEO_MARSPALFADE.NO_GRN :  FF0AEC C |
 VIDEO_MARSPALFADE.NO_GRN_O :                                        FF0B80 C |
 VIDEO_MARSPALFADE.NO_MOVE : FF0B3A C |
 VIDEO_MARSPALFADE.NO_MOVE_O :                                       FF0BBC C |
 VIDEO_MARSPALFADE.NO_RED :  FF0ACC C |
 VIDEO_MARSPALFADE.NO_RED_O :                                        FF0B68 C |
 VIDEO_MARSPALFADE.NXT_PAL : FF0AAA C |
 VIDEO_MARSPALFADE.NXT_PAL_O :                                       FF0B50 C |
 VIDEO_MARS_GFXMODE :        FF09FA C |  VIDEO_MARS_GFXMODE.WAIT :   FF0A16 C |
 VIDEO_MARS_GFXMODE.WAIT_SLV :                                       FF0A0A C |
 VIDEO_MARS_WAITFRAME :      FF0A24 C | *VIDEO_MARS_WAITFRAME.LATE : FF0A38 C |
 VIDEO_MARS_WAITFRAME.WAIT : FF0A2C C |  VIDEO_PRINT :               FF040C C |
 VIDEO_PRINT.DONIBL :        FF0526 C |  VIDEO_PRINT.EXIT :          FF0496 C |
 VIDEO_PRINT.ISBYTE :        FF0460 C |  VIDEO_PRINT.ISLONG :        FF0484 C |
 VIDEO_PRINT.ISWORD :        FF0472 C |  VIDEO_PRINT.LNGLOOP :       FF0516 C |
 VIDEO_PRINT.LOOP :          FF0420 C |  VIDEO_PRINT.LOWR :          FF0536 C |
 VIDEO_PRINT.NEWJUMP :       FF041A C |  VIDEO_PRINT.NEXT :          FF0442 C |
 VIDEO_PRINT.NEXTV :         FF04A0 C |  VIDEO_PRINT.NOTHING :       FF0542 C |
 VIDEO_PRINT.PUTTEXT :       FF0434 C |  VIDEO_PRINT.SPECIAL :       FF0446 C |
 VIDEO_PRINT.VBYTE :         FF04D2 C |  VIDEO_PRINT.VLONG :         FF051E C |
 VIDEO_PRINT.VWORD :         FF04F4 C |  VIDEO_PRINTINIT :           FF03E0 C |
 VIDEO_PRINTPAL :            FF03FA C |  VIDEO_RUNFADE :             FF05E0 C |
 VIDEO_UPDATE :              FF029C C | *VIDEO_UPDATE.EXIT :         FF02BA C |
 VIDEO_UPDATE.LOOP :         FF02AE C |  VIDMARS_PAL :               FF0A48 C |
 VIDMARS_PAL.LOOP :          FF0A60 C |  VIDMD_PAL :                 FF0600 C |
 VIDMD_PAL.LOOP :            FF0618 C |  VID_PICKLAYER :             FF0544 C |
 VID_PICKLAYER.GOLYR :       FF0594 C |  VID_PICKLAYER.NOWD :        FF057E C |
 VID_PICKLAYER.PLAWND :      FF056C C |  VID_PICKLAYER.THISSZ :      FF05B4 C |
 VID_PICKLAYER.THISSZJ :     FF05DC C |  VINTCLR :                       16 - |
*VINTENBL :                      20 - |  VINT_DEFAULT :              FF16CE C |
*VIRQ_ON :                        8 - |  VRESINTCLR :                    14 - |
 WAVE_FLAGS :                  1E56 C |  WAVE_LEN :                    1E4E C |
 WAVE_LOOP :                   1E51 C |  WAVE_PITCH :                  1E54 C |
 WAVE_START :                  1E4B C |  WAVFREQ_LIST :                154D C |
*WHDFLG :                      16C4 C |  X68KSRCLSB :                    36 C |
 X68KSRCMID :                    37 C | *YM_CTRL_1 :                 A04000 - |
*YM_CTRL_2 :                 A04002 - | *YM_DATA_1 :                 A04001 - |
*YM_DATA_2 :                 A04003 - |  Z80_BUS :                   A11100 - |
 Z80_CODE :                  888760 C |  Z80_CODE_END :              88A5C6 C |
 Z80_CPU :                   A00000 - |  Z80_INIT :                      3E C |
 Z80_RESET :                 A11200 - |  Z80_TOP :                   888760 C |
*ZBANK :                       6000 - | *ZOPCEX :                         8 - |
 ZOPCEXX :                       D9 - | *ZOPCNOP :                        0 - |
 ZOPCPUSHAF :                    F5 - |  ZOPCRET :                       C9 - |
 ZPSG_CTRL :                   7F11 - |  ZSET_TESTME :                    0 - |
 ZSET_WTUNE :      FFFFFFFFFFFFFFE7 - |  ZYM_CTRL_1 :                  4000 - |
 ZYM_CTRL_2 :                  4002 - |  ZYM_DATA_1 :                  4001 - |
 ZYM_DATA_2 :                  4003 - |  _CCR :                    FFFFFE92 - |
*_DMACHANNEL0 :            FFFFFF8C - | *_DMACHANNEL1 :            FFFFFF9C - |
*_DMACOUNT0 :              FFFFFF88 - | *_DMACOUNT1 :              FFFFFF98 - |
*_DMADEST0 :               FFFFFF84 - | *_DMADEST1 :               FFFFFF94 - |
 _DMAOPERATION :           FFFFFFB0 - | *_DMAREQACK0 :             FFFFFFB4 - |
*_DMAREQACK1 :             FFFFFFB8 - |  _DMASOURCE0 :             FFFFFF80 - |
 _DMASOURCE1 :             FFFFFF90 - | *_DMAVECTORE0 :            FFFFFFA4 - |
*_DMAVECTORE1 :            FFFFFFAC - | *_DMAVECTORN0 :            FFFFFFA0 - |
*_DMAVECTORN1 :            FFFFFFA8 - |  _FRAMEBUFFER :            24000000 - |
*_FRC_H :                         2 - | *_FRC_L :                         3 - |
 _FRT :                    FFFFFE10 - | *_HRH :                    FFFFFF10 - |
*_HRL :                    FFFFFF14 - | *_HRL32 :                  FFFFFF04 - |
 _JR :                     FFFFFF00 - | *_OCR_H :                         4 - |
*_OCR_L :                         5 - |  _OVERWRITE :              24020000 - |
 _PALETTE :                20004200 - | *_SERIAL :                 FFFFFE00 - |
 _SYSREG :                 20004000 - | *_TCR :                           6 - |
*_TCSR :                          1 - | *_TIER :                          0 - |
*_TOCR :                          7 - |  _VDPREG :                 20004100 - |

   2290 symbols
    268 unused symbols

 AS V1.42 Beta [Bld 118] - source file mars.asm - page 3 - 10/21/2022 1:21:17


  defined macros:
  ---------------

COLORME                               | FINISH                               
GINSDAC                               | GINSFM                               
GINSFM3                               | GINSNULL                             
GINSPSG                               | GINSPSGN                             
GINSPWM                               | GSMPHEAD                             
ORG                                   | STRUCT                               
TESTME                                |

     13 macros

 AS V1.42 Beta [Bld 118] - source file mars.asm - page 4 - 10/21/2022 1:21:17


  defined functions:
  ------------------

NOTZ80                                | LOCATE                               
MAPSIZE                               | DWORD                                

 AS V1.42 Beta [Bld 118] - source file mars.asm - page 5 - 10/21/2022 1:21:17


  codepages:
  ----------

STANDARD (0 changed characters)


0.33 seconds assembly time

  21333 lines source file
  21970 lines incl. macro expansions
      7 passes
      0 errors
      0 warnings
