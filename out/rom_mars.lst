 AS V1.42 Beta [Bld 118] - source file mars.asm - page 1 - 8/28/2021 21:49:44


       1/       0 :                     ; ===========================================================================
       2/       0 :                     ; +-----------------------------------------------------------------+
       3/       0 :                     ; PROJECT SHINRINX
       4/       0 :                     ; 
       5/       0 :                     ; Started on 16/01/2020
       6/       0 :                     ; +-----------------------------------------------------------------+
       7/       0 :                     
       8/       0 :                     		include	"system/macros.asm"	; Assembler macros
(1)    1/       0 :                     ; ===========================================================================
(1)    2/       0 :                     ; ----------------------------------------------------------------
(1)    3/       0 :                     ; MACROS
(1)    4/       0 :                     ; ----------------------------------------------------------------
(1)    5/       0 :                     
(1)    6/       0 :                     ; --------------------------------------------------------
(1)    7/       0 :                     ; AS Main settings
(1)    8/       0 :                     ; --------------------------------------------------------
(1)    9/       0 :                     
(1)   10/       0 :                     		!org 0				; Start at 0
(1)   11/       0 :                     		cpu 		68000		; Current CPU is 68k, gets changed later
(1)   12/       0 :                     		padding		off		; Dont pad dc.b
(1)   13/       0 :                     		listing 	purecode	; Want listing file, but only the final code in expanded macros
(1)   14/       0 :                     		supmode 	on 		; Supervisor mode
(1)   15/       0 :                     		dottedstructs	off		; If needed
(1)   16/       0 :                     		page 		0
(1)   17/       0 :                     
(1)   18/       0 :                     ; ====================================================================
(1)   19/       0 :                     ; ---------------------------------------------
(1)   20/       0 :                     ; Functions
(1)   21/       0 :                     ; ---------------------------------------------
(1)   22/       0 :                     
(1)   23/       0 :                     ; doubleword 	function l,r,(l<<16&$FFFF0000|r&$FFFF)			; LLLL RRRR
(1)   24/       0 :                     mapsize		function l,r,(((l-1)/8)<<16&$FFFF0000|((r-1)/8)&$FFFF)	; for cells w/h use doubleword
(1)   25/       0 :                     locate		function a,b,c,(c&$FF)|(b<<8&$FF00)|(a<<16&$FF0000)	; VDP locate: Layer|X pos|Y pos for some video routines
(1)   26/       0 :                     
(1)   27/       0 :                     ; ====================================================================
(1)   28/       0 :                     ; ---------------------------------------------
(1)   29/       0 :                     ; Macros
(1)   30/       0 :                     ; ---------------------------------------------
(1)   31/       0 :                     
(1)   32/       0 :                     ; -------------------------------------
(1)   33/       0 :                     ; Reserve memory section
(1)   34/       0 :                     ;
(1)   35/       0 :                     ; NOTE: This doesn't work on Z80
(1)   36/       0 :                     ; -------------------------------------
(1)   37/       0 :                     
(1)   38/       0 :                     struct		macro thisinput			; Reserve memory address
(1)   39/       0 :                     GLBL_LASTPC	set *
(1)   40/       0 :                     		dephase
(1)   41/       0 :                     GLBL_LASTORG	set *
(1)   42/       0 :                     		phase thisinput
(1)   43/       0 :                     		endm
(1)   44/       0 :                     		
(1)   45/       0 :                     ; -------------------------------------
(1)   46/       0 :                     ; Finish
(1)   47/       0 :                     ; -------------------------------------
(1)   48/       0 :                     
(1)   49/       0 :                     finish		macro				; Then finish custom struct.
(1)   50/       0 :                     		!org GLBL_LASTORG
(1)   51/       0 :                     		phase GLBL_LASTPC
(1)   52/       0 :                     		endm
(1)   53/       0 :                     
(1)   54/       0 :                     ; -------------------------------------
(1)   55/       0 :                     ; Custom ORG
(1)   56/       0 :                     ;
(1)   57/       0 :                     ; (from s2disasm)
(1)   58/       0 :                     ; -------------------------------------
(1)   59/       0 :                     
(1)   60/       0 : =$0                 paddingSoFar set 0
(1)   61/       0 :                     notZ80 function cpu,(cpu<>128)&&(cpu<>32988)
(1)   62/       0 :                     org macro address
(1)   63/       0 :                     	if notZ80(MOMCPU)
(1)   64/       0 :                     		if address < *
(1)   65/       0 :                     			error "too much stuff before org $\{address} ($\{(*-address)} bytes)"
(1)   66/       0 :                     		elseif address > *
(1)   67/       0 :                     paddingSoFar	set paddingSoFar + address - *
(1)   68/       0 :                     			!org address
(1)   69/       0 :                     		endif
(1)   70/       0 :                     	else
(1)   71/       0 :                     		if address < $
(1)   72/       0 :                     			error "too much stuff before org 0\{address}h (0\{($-address)}h bytes)"
(1)   73/       0 :                     		else
(1)   74/       0 :                     			while address > $
(1)   75/       0 :                     				db 0
(1)   76/       0 :                     			endm
(1)   77/       0 :                     		endif
(1)   78/       0 :                     	endif
(1)   79/       0 :                         endm
(1)   80/       0 :                     
       9/       0 :                     		include	"system/md/const.asm"	; MD and MARS Variables
(1)    1/       0 :                     ; ====================================================================
(1)    2/       0 :                     ; ----------------------------------------------------------------
(1)    3/       0 :                     ; MD/MARS shared constants
(1)    4/       0 :                     ; ----------------------------------------------------------------
(1)    5/       0 :                     
(1)    6/       0 :                     ; MD to MARS Task transfer settings
(1)    7/       0 : =$8                 MAX_MDTSKARG	equ 8			; MAX MD task arguments (FIXED)
(1)    8/       0 : =$10                MAX_MDTASKS	equ 16			; MAX requests from MD to here
(1)    9/       0 :                     
(1)   10/       0 :                     ; ====================================================================
(1)   11/       0 :                     ; ----------------------------------------------------------------
(1)   12/       0 :                     ; MD Sound
(1)   13/       0 :                     ; ----------------------------------------------------------------
(1)   14/       0 :                     
(1)   15/       0 :                     ; ====================================================================
(1)   16/       0 :                     ; ----------------------------------------------------------------
(1)   17/       0 :                     ; MD Video
(1)   18/       0 :                     ; ----------------------------------------------------------------
(1)   19/       0 :                     
(1)   20/       0 :                     ; ------------------------------------------------
(1)   21/       0 :                     ; vdp_ctrl READ bits
(1)   22/       0 :                     ; ------------------------------------------------
(1)   23/       0 :                     
(1)   24/       0 : =$2                 bitHint		equ 2
(1)   25/       0 : =$3                 bitVint		equ 3
(1)   26/       0 : =$1                 bitDma		equ 1
(1)   27/       0 :                     
(1)   28/       0 :                     ; ------------------------------------------------
(1)   29/       0 :                     ; VDP register variables
(1)   30/       0 :                     ; ------------------------------------------------
(1)   31/       0 :                     
(1)   32/       0 :                     ; Register $80
(1)   33/       0 : =$2                 HVStop		equ $02
(1)   34/       0 : =$10                HintEnbl	equ $10
(1)   35/       0 : =$1                 bitHVStop	equ 1
(1)   36/       0 : =$4                 bitHintEnbl	equ 4
(1)   37/       0 :                     
(1)   38/       0 :                     ; Register $81
(1)   39/       0 : =$40                DispEnbl 	equ $40
(1)   40/       0 : =$20                VintEnbl 	equ $20
(1)   41/       0 : =$10                DmaEnbl		equ $10
(1)   42/       0 : =$6                 bitDispEnbl	equ 6
(1)   43/       0 : =$5                 bitVintEnbl	equ 5
(1)   44/       0 : =$4                 bitDmaEnbl	equ 4
(1)   45/       0 : =$3                 bitV30		equ 3
(1)   46/       0 :                     
(1)   47/       0 :                     ; ====================================================================
(1)   48/       0 :                     ; --------------------------------------------------------
(1)   49/       0 :                     ; Contoller reading (call System_Input first)
(1)   50/       0 :                     ; --------------------------------------------------------
(1)   51/       0 :                     
(1)   52/       0 :                     ; structure is below
(1)   53/       0 : =$FFFFFFFFFF..      Controller_1	equ RAM_InputData
(1)   54/       0 : =$FFFFFFFFFF..      Controller_2	equ RAM_InputData+sizeof_input
(1)   55/       0 :                     
(1)   56/       0 :                     ; read as full WORD (on_hold or on_press)
(1)   57/       0 : =$1                 JoyUp		equ $0001
(1)   58/       0 : =$2                 JoyDown		equ $0002
(1)   59/       0 : =$4                 JoyLeft		equ $0004
(1)   60/       0 : =$8                 JoyRight	equ $0008
(1)   61/       0 : =$10                JoyB		equ $0010
(1)   62/       0 : =$20                JoyC		equ $0020
(1)   63/       0 : =$40                JoyA		equ $0040
(1)   64/       0 : =$80                JoyStart	equ $0080
(1)   65/       0 : =$100               JoyZ		equ $0100
(1)   66/       0 : =$200               JoyY		equ $0200
(1)   67/       0 : =$400               JoyX		equ $0400
(1)   68/       0 : =$800               JoyMode		equ $0800
(1)   69/       0 :                     
(1)   70/       0 :                     ; right byte $00xx
(1)   71/       0 : =$0                 bitJoyUp	equ 0
(1)   72/       0 : =$1                 bitJoyDown	equ 1
(1)   73/       0 : =$2                 bitJoyLeft	equ 2
(1)   74/       0 : =$3                 bitJoyRight	equ 3
(1)   75/       0 : =$4                 bitJoyB		equ 4
(1)   76/       0 : =$5                 bitJoyC		equ 5
(1)   77/       0 : =$6                 bitJoyA		equ 6
(1)   78/       0 : =$7                 bitJoyStart	equ 7
(1)   79/       0 :                     
(1)   80/       0 :                     ; left byte $xx00
(1)   81/       0 : =$0                 bitJoyZ		equ 0
(1)   82/       0 : =$1                 bitJoyY		equ 1
(1)   83/       0 : =$2                 bitJoyX		equ 2
(1)   84/       0 : =$3                 bitJoyMode	equ 3
(1)   85/       0 :                     
(1)   86/       0 :                     ; ====================================================================
(1)   87/       0 :                     ; --------------------------------------------------------
(1)   88/       0 :                     ; Settings
(1)   89/       0 :                     ; --------------------------------------------------------
(1)   90/       0 :                     
(1)   91/       0 : =$FFFF8800          MDRAM_START	equ $FFFF8800		; Start of working MD RAM (below it is free for CODE or decompression output)
(1)   92/       0 : =$800               MAX_MDERAM	equ $800		; MAX RAM for current screen mode (title,menu,or gameplay...)
(1)   93/       0 : =$7FF               varNullVram	equ $7FF		; Default Blank tile for some video routines
(1)   94/       0 :                     
(1)   95/       0 :                     ; ====================================================================
(1)   96/       0 :                     ; ----------------------------------------------------------------
(1)   97/       0 :                     ; Structures
(1)   98/       0 :                     ; ----------------------------------------------------------------
(1)   99/       0 :                     
(1)  100/       0 :                     ; Controller buffer data (after calling System_Input)
(1)  101/       0 : (MACRO)             		struct 0
(1)  101/       0 : =$0                 GLBL_LASTPC     set *
(1)  101/       0 :                                     dephase
(1)  101/       0 : =$0                 GLBL_LASTORG    set *
(1)  101/       0 :                                     phase 0
(1)  102/       0 :                     pad_id		ds.b 1			; Controller ID
(1)  103/       1 :                     pad_ver		ds.b 1			; Controller type/revision: (ex. 0-3button 1-6button)
(1)  104/       2 :                     on_hold		ds.w 1			; User HOLD bits
(1)  105/       4 :                     on_press	ds.w 1			; User PRESSED bits
(1)  106/       6 :                     sizeof_input	ds.l 0
(1)  107/       8 : (MACRO)             		finish
(1)  107/       0 :                                     !org GLBL_LASTORG
(1)  107/       0 :                                     phase GLBL_LASTPC
(1)  108/       0 :                     
(1)  109/       0 :                     ; ====================================================================
(1)  110/       0 :                     ; ----------------------------------------------------------------
(1)  111/       0 :                     ; System RAM
(1)  112/       0 :                     ; ----------------------------------------------------------------
(1)  113/       0 :                     
(1)  114/       0 : (MACRO)             		struct RAM_MdSystem
(1)  114/       0 : =$0                 GLBL_LASTPC     set *
(1)  114/       0 :                                     dephase
(1)  114/       0 : =$0                 GLBL_LASTORG    set *
(1)  114/FFFFFFFFFFFF91BA :                                     phase RAM_MDSYSTEM
(1)  115/FFFFFFFFFFFF91BA :                     RAM_InputData	ds.b sizeof_input*4		; Input data section
(1)  116/FFFFFFFFFFFF91D2 :                     RAM_SaveData	ds.b $200			; Save data cache (for SRAM)
(1)  117/FFFFFFFFFFFF93D2 :                     RAM_MdMarsTskM	ds.l MAX_MDTSKARG*MAX_MDTASKS	; Queue task list for MASTER SH2
(1)  118/FFFFFFFFFFFF95D2 :                     RAM_MdMarsTskS	ds.l MAX_MDTSKARG*MAX_MDTASKS	; Queue task list for SLAVE SH2
(1)  119/FFFFFFFFFFFF97D2 :                     RAM_MdMarsTsSgl	ds.l MAX_MDTSKARG		; Single task request for 32X, shared for both Mst and Slv
(1)  120/FFFFFFFFFFFF97F2 :                     RAM_FrameCount	ds.l 1				; Global frame counter
(1)  121/FFFFFFFFFFFF97F6 :                     RAM_SysRandVal	ds.l 1				; Random value
(1)  122/FFFFFFFFFFFF97FA :                     RAM_SysRandSeed	ds.l 1				; Randomness seed
(1)  123/FFFFFFFFFFFF97FE :                     RAM_initflug	ds.l 1				; "INIT" flag
(1)  124/FFFFFFFFFFFF9802 :                     RAM_MdMarsVInt	ds.w 3				; VBlank jump (JMP xxxx xxxx)
(1)  125/FFFFFFFFFFFF9808 :                     RAM_MdMarsHint	ds.w 3				; HBlank jump (JMP xxxx xxxx)
(1)  126/FFFFFFFFFFFF980E :                     RAM_MdMarsTCntM	ds.w 1				; Counter for MASTER CPU's task list
(1)  127/FFFFFFFFFFFF9810 :                     RAM_MdMarsTCntS	ds.w 1				; Counter for SLAVE CPU's task list
(1)  128/FFFFFFFFFFFF9812 :                     RAM_SysFlags	ds.w 1				; Game engine flags (note: it's a byte)
(1)  129/FFFFFFFFFFFF9814 :                     sizeof_mdsys	ds.l 0
(1)  130/FFFFFFFFFFFF9816 : (MACRO)             		finish
(1)  130/FFFFFFFFFFFF91BA :                                     !org GLBL_LASTORG
(1)  130/       0 :                                     phase GLBL_LASTPC
(1)  131/       0 :                     
(1)  132/       0 :                     ; ====================================================================
(1)  133/       0 :                     ; ----------------------------------------------------------------
(1)  134/       0 :                     ; Sound 68k RAM
(1)  135/       0 :                     ; ----------------------------------------------------------------
(1)  136/       0 :                     
(1)  137/       0 : (MACRO)             		struct RAM_MdSound
(1)  137/       0 : =$0                 GLBL_LASTPC     set *
(1)  137/       0 :                                     dephase
(1)  137/       0 : =$0                 GLBL_LASTORG    set *
(1)  137/FFFFFFFFFFFF9000 :                                     phase RAM_MDSOUND
(1)  138/FFFFFFFFFFFF9000 :                     RAM_SndSaveReg	ds.l 8
(1)  139/FFFFFFFFFFFF9020 :                     sizeof_mdsnd	ds.l 0
(1)  140/FFFFFFFFFFFF9020 : (MACRO)             		finish
(1)  140/FFFFFFFFFFFF9000 :                                     !org GLBL_LASTORG
(1)  140/       0 :                                     phase GLBL_LASTPC
(1)  141/       0 :                     		
(1)  142/       0 :                     ; ====================================================================
(1)  143/       0 :                     ; ----------------------------------------------------------------
(1)  144/       0 :                     ; Video RAM
(1)  145/       0 :                     ; ----------------------------------------------------------------
(1)  146/       0 :                     
(1)  147/       0 : (MACRO)             		struct RAM_MdVideo
(1)  147/       0 : =$0                 GLBL_LASTPC     set *
(1)  147/       0 :                                     dephase
(1)  147/       0 : =$0                 GLBL_LASTORG    set *
(1)  147/FFFFFFFFFFFF9020 :                                     phase RAM_MDVIDEO
(1)  148/FFFFFFFFFFFF9020 :                     RAM_VidPrntVram	ds.w 1			; Default VRAM location for ASCII text used by Video_Print
(1)  149/FFFFFFFFFFFF9022 :                     RAM_VidPrntList	ds.w 3*64		; Video_Print list: Address, Type
(1)  150/FFFFFFFFFFFF91A2 :                     RAM_VdpRegs	ds.b 24			; VDP Register cache
(1)  151/FFFFFFFFFFFF91BA :                     sizeof_mdvid	ds.l 0
(1)  152/FFFFFFFFFFFF91BC : (MACRO)             		finish
(1)  152/FFFFFFFFFFFF9020 :                                     !org GLBL_LASTORG
(1)  152/       0 :                                     phase GLBL_LASTPC
(1)  153/       0 :                     
(1)  154/       0 :                     ; ====================================================================
(1)  155/       0 :                     ; ----------------------------------------------------------------
(1)  156/       0 :                     ; MD RAM
(1)  157/       0 :                     ;
(1)  158/       0 :                     ; NOTE: If using MCD Uses $FFFD00-$FFFDFF, and
(1)  159/       0 :                     ; stack point is $FFFD00
(1)  160/       0 :                     ; ----------------------------------------------------------------
(1)  161/       0 :                     
(1)  162/       0 : (MACRO)             		struct MDRAM_START
(1)  162/       0 : =$0                 GLBL_LASTPC     set *
(1)  162/       0 :                                     dephase
(1)  162/       0 : =$0                 GLBL_LASTORG    set *
(1)  162/FFFFFFFFFFFF8800 :                                     phase MDRAM_START
(1)  171/FFFFFFFFFFFF8800 :                     RAM_ModeBuff	ds.b MAX_MDERAM			; Second pass: sizes are set
(1)  172/FFFFFFFFFFFF9000 :                     RAM_MdSound	ds.b sizeof_mdsnd-RAM_MdSound
(1)  173/FFFFFFFFFFFF9020 :                     RAM_MdVideo	ds.b sizeof_mdvid-RAM_MdVideo
(1)  174/FFFFFFFFFFFF91BA :                     RAM_MdSystem	ds.b sizeof_mdsys-RAM_MdSystem
(1)  175/FFFFFFFFFFFF9814 :                     RAM_MdGlobal	ds.b sizeof_mdglbl-RAM_MdGlobal
(1)  176/FFFFFFFFFFFF8C32 :                     sizeof_mdram	ds.l 0
(1)  178/FFFFFFFFFFFF8C34 :                     
MD RAM ends at: FF8C32
(1)  180/FFFFFFFFFFFF8C34 :                     		message "MD RAM ends at: \{((sizeof_mdram)&$FFFFFF)}"
(1)  182/FFFFFFFFFFFF8C34 : (MACRO)             		finish
(1)  182/FFFFFFFFFFFF8800 :                                     !org GLBL_LASTORG
(1)  182/       0 :                                     phase GLBL_LASTPC
(1)  183/       0 :                     
      10/       0 :                     		include	"system/md/map.asm"	; Genesis hardware map
(1)    1/       0 :                     ; ====================================================================
(1)    2/       0 :                     ; ----------------------------------------------------------------
(1)    3/       0 :                     ; Genesis / MegaDrive 68k map
(1)    4/       0 :                     ; ----------------------------------------------------------------
(1)    5/       0 :                     
(1)    6/       0 : =$200000            sys_exram	equ	$200000		; Second half of 4MB rom or external RAM (Normal or save data)
(1)    7/       0 : =$A00000            z80_cpu		equ	$A00000		; Z80 CPU area, size: $2000
(1)    8/       0 : =$A04000            ym_ctrl_1	equ	$A04000		; YM2612 reg 1
(1)    9/       0 : =$A04001            ym_data_1	equ	$A04001		; YM2612 reg 2
(1)   10/       0 : =$A04002            ym_ctrl_2	equ	$A04002		; YM2612 reg 1
(1)   11/       0 : =$A04003            ym_data_2	equ	$A04003		; YM2612 reg 2
(1)   12/       0 : =$A10001            sys_io		equ	$A10001		; bits: OVRSEAS(7)|PAL(6)|DISK(5)|VER(3-0)
(1)   13/       0 : =$A10003            sys_data_1	equ	$A10003		; Port 1 DATA
(1)   14/       0 : =$A10005            sys_data_2	equ	$A10005		; Port 2 DATA
(1)   15/       0 : =$A10007            sys_data_3	equ	$A10007		; Modem DATA
(1)   16/       0 : =$A10009            sys_ctrl_1	equ	$A10009		; Port 1 CTRL
(1)   17/       0 : =$A1000B            sys_ctrl_2	equ	$A1000B		; Port 2 CTRL
(1)   18/       0 : =$A1000D            sys_ctrl_3	equ	$A1000D		; Modem CTRL
(1)   19/       0 : =$A11100            z80_bus 	equ	$A11100		; only use bit 0 (bit 8 as WORD)
(1)   20/       0 : =$A11200            z80_reset	equ	$A11200		; WRITE only ($0000 reset/$0100 cancel)
(1)   21/       0 : =$A130F1            md_bank_sram	equ	$A130F1		; Make SRAM visible at $200000
(1)   22/       0 : =$A14000            sys_tmss	equ	$A14000		; write "SEGA" here for ver > 0
(1)   23/       0 : =$C00000            vdp_data	equ	$C00000		; video data port
(1)   24/       0 : =$C00004            vdp_ctrl	equ	$C00004		; video control port
(1)   25/       0 : =$C00011            psg_ctrl	equ	$C00011		; PSG control
(1)   26/       0 :                     
(1)   27/       0 :                     ; ----------------------------------------------------------------
(1)   28/       0 :                     ; Genesis / Mega drive Z80 map
(1)   29/       0 :                     ; ----------------------------------------------------------------
(1)   30/       0 :                     
(1)   31/       0 : =$4000              zym_ctrl_1	equ	$4000		; YM2612 reg 1
(1)   32/       0 : =$4001              zym_data_1	equ	$4001		; YM2612 reg 2
(1)   33/       0 : =$4002              zym_ctrl_2	equ	$4002		; YM2612 reg 1
(1)   34/       0 : =$4003              zym_data_2	equ	$4003		; YM2612 reg 2
(1)   35/       0 : =$6000              zbank		equ	$6000		; Z80 ROM BANK 24bits, %XXXXXXXX X0000000 00000000 (9 writes)
(1)   36/       0 :                     ; zvdp_data	equ	$7F00		; video data port
(1)   37/       0 :                     ; zvdp_ctrl	equ	$7F04		; video control port
(1)   38/       0 : =$7F11              zpsg_ctrl	equ	$7F11		; PSG control
(1)   39/       0 :                     
(1)   40/       0 :                     ; ----------------------------------------------------------------
(1)   41/       0 :                     ; 32X registers
(1)   42/       0 :                     ; ----------------------------------------------------------------
(1)   43/       0 :                     
(1)   44/       0 : =$A130EC            sysmars_id	equ	$A130EC		; 32X's ID String: "MARS"
(1)   45/       0 : =$A15100            sysmars_reg	equ	$A15100		; MARS 32X registers section, see system/mars/map.asm for variables
(1)   46/       0 :                     
      11/       0 :                     		include	"system/mars/map.asm"	; MARS map
(1)    1/       0 :                     ; ====================================================================
(1)    2/       0 :                     ; ----------------------------------------------------------------
(1)    3/       0 :                     ; SH2 MAP
(1)    4/       0 :                     ; ----------------------------------------------------------------
(1)    5/       0 :                     
(1)    6/       0 :                     ; --------------------------------------------------------
(1)    7/       0 :                     ; SH2 SIDE MAP
(1)    8/       0 :                     ; --------------------------------------------------------
(1)    9/       0 :                     
(1)   10/       0 : =$0                 CS0		equ	$00000000	; Boot rom & system registers
(1)   11/       0 : =$2000000           CS1		equ	$02000000	; ROM data (all 4MB), Locked if RV=1
(1)   12/       0 : =$4000000           CS2		equ	$04000000	; Framebuffer section
(1)   13/       0 : =$6000000           CS3		equ	$06000000	; SDRAM
(1)   14/       0 : =$20000000          TH		equ	$20000000	; Cache-thru OR|value
(1)   15/       0 : =$20004000          _sysreg		equ	$00004000|TH	; MARS System registers, for MD: sysmars_reg
(1)   16/       0 : =$20004100          _vdpreg		equ	$00004100|TH	; SuperVDP registers
(1)   17/       0 : =$20004200          _palette	equ	$00004200|TH	; Palette RAM for Pixel-Packed or RLE mode
(1)   18/       0 : =$24000000          _framebuffer:	equ	CS2|TH		; Framebuffer, first 240 are the linetable
(1)   19/       0 : =$24020000          _overwrite:	equ	CS2|TH+$20000	; Overwrite, $00-byte writes are ignored
(1)   20/       0 :                     
(1)   21/       0 :                     ; --------------------------------------------------------
(1)   22/       0 :                     ; Variables
(1)   23/       0 :                     ; --------------------------------------------------------
(1)   24/       0 :                     
(1)   25/       0 :                     ; ------------------------------------------------
(1)   26/       0 :                     ; System
(1)   27/       0 :                     ; ------------------------------------------------
(1)   28/       0 :                     
(1)   29/       0 :                     ; _sysreg
(1)   30/       0 : =$0                 adapter		equ	$00		; adapter control register
(1)   31/       0 : =$1                 intmask		equ	$01		; interrupts mask
(1)   32/       0 : =$2                 standby		equ	$02		; CMD interrupt request bit by MD side (slave|master)
(1)   33/       0 : =$5                 hcount		equ	$05		; H Counter
(1)   34/       0 : =$6                 dreqctl		equ	$06		; DREQ control
(1)   35/       0 : =$8                 dreqsource	equ	$08		; DREQ source address
(1)   36/       0 : =$C                 dreqdest	equ	$0C		; DREQ destination address
(1)   37/       0 : =$10                dreqlen		equ	$10		; DREQ length
(1)   38/       0 : =$12                dreqfifo	equ	$12		; DREQ FIFO
(1)   39/       0 : =$14                vresintclr	equ	$14		; VRES interrupt clear
(1)   40/       0 : =$16                vintclr		equ	$16		; V interrupt clear
(1)   41/       0 : =$18                hintclr		equ	$18		; H interrupt clear
(1)   42/       0 : =$1A                cmdintclr	equ	$1a		; CMD interrupt clear
(1)   43/       0 : =$1C                pwmintclr	equ	$1C		; PWM interrupt clear
(1)   44/       0 : =$20                comm0		equ	$20		; Communication ports
(1)   45/       0 : =$22                comm2		equ	$22		; (If 2 CPUs either SH2 or 68K writes to
(1)   46/       0 : =$24                comm4		equ	$24		; the same location, it will freeze the
(1)   47/       0 : =$26                comm6		equ	$26		; system)
(1)   48/       0 : =$28                comm8		equ	$28		;
(1)   49/       0 : =$2A                comm10		equ	$2A		;
(1)   50/       0 : =$2C                comm12		equ	$2C		;
(1)   51/       0 : =$2E                comm14		equ	$2E		;
(1)   52/       0 : =$2F                comm15		equ	$2F		;
(1)   53/       0 : =$30                timerctl	equ	$30		; PWM Timer Control
(1)   54/       0 : =$31                pwmctl		equ	$31		; PWM Control
(1)   55/       0 : =$32                cycle		equ	$32		; PWM Cycle
(1)   56/       0 : =$34                lchwidth	equ	$34		; PWM L ch Width
(1)   57/       0 : =$36                rchwidth	equ	$36		; PWM R ch Width
(1)   58/       0 : =$38                monowidth	equ	$38		; PWM Monaural Width
(1)   59/       0 :                     
(1)   60/       0 :                     ; _sysreg
(1)   61/       0 :                     ; adapter
(1)   62/       0 : =$1                 CART		equ	%00000001	; CD or Cartridge
(1)   63/       0 : =$2                 ADEN		equ	%00000010	; MARS Enabled: No/Yes
(1)   64/       0 : =$80                FM		equ	%10000000	; SuperVDP permission: MD or SH
(1)   65/       0 :                     ; framectl
(1)   66/       0 : =$1                 FS		equ	%00000001	; Current framebuffer DRAM pixel data
(1)   67/       0 : =$2                 FEN		equ	%00000010	; Can write to Framebuffer: Yes/No
(1)   68/       0 :                     ; vdpsts
(1)   69/       0 : =$80                VBLK		equ	%10000000	; VBlank bit
(1)   70/       0 : =$40                HBLK		equ	%01000000	; HBlank bit
(1)   71/       0 : =$20                PEN		equ	%00100000	; Can write to Palette: Yes/No
(1)   72/       0 :                     ; intmask
(1)   73/       0 : =$8                 VIRQ_ON		equ	$08		; IRQ masks for IRQ mask register
(1)   74/       0 : =$4                 HIRQ_ON		equ	$04
(1)   75/       0 : =$2                 CMDIRQ_ON	equ	$02
(1)   76/       0 : =$1                 PWMIRQ_ON	equ	$01
(1)   77/       0 :                     
(1)   78/       0 :                     ; _vdpreg
(1)   79/       0 : =$0                 tvmode		equ	$00		; TV mode register
(1)   80/       0 : =$1                 bitmapmd	equ	$01		; Bitmap mode register
(1)   81/       0 : =$2                 shift		equ	$02		; Shift Control register
(1)   82/       0 : =$5                 filllength	equ	$05		; Auto Fill Length register
(1)   83/       0 : =$6                 fillstart	equ	$06		; Auto Fill Start Address register
(1)   84/       0 : =$8                 filldata	equ	$08		; Auto Fill Data register
(1)   85/       0 : =$A                 vdpsts		equ	$0a		; VDP Status register
(1)   86/       0 : =$B                 framectl	equ	$0b		; Frame Buffer Control register
(1)   87/       0 :                     
(1)   88/       0 :                     ; --------------------------------------------------------
(1)   89/       0 :                     ; SH2 Internal registers, independent for each CPU
(1)   90/       0 :                     ; --------------------------------------------------------
(1)   91/       0 :                     
(1)   92/       0 :                     ; DMA Channel 0: General data transfer
(1)   93/       0 :                     ; DMA Channel 1: PWM exclusive
(1)   94/       0 : =$FFFFFE00          _SERIAL		equ	$FFFFFE00	; Serial Control
(1)   95/       0 : =$FFFFFE10          _FRT		equ	$FFFFFE10	; Free run timer
(1)   96/       0 : =$0                 _TIER		equ	$00		; Timer interrupt enable register
(1)   97/       0 : =$1                 _TCSR		equ	$01		; Timer control & status register
(1)   98/       0 : =$2                 _FRC_H		equ	$02		; free running counter High
(1)   99/       0 : =$3                 _FRC_L		equ	$03		; free running counter Low
(1)  100/       0 : =$4                 _OCR_H		equ	$04		; Output compare register High
(1)  101/       0 : =$5                 _OCR_L		equ	$05		; Output compare register Low
(1)  102/       0 : =$6                 _TCR		equ	$06		; Timer control register
(1)  103/       0 : =$7                 _TOCR		equ	$07		; timer output compare control register
(1)  104/       0 : =$FFFFFE92          _CCR:		equ	$FFFFFE92
(1)  105/       0 : =$FFFFFF00          _JR		equ	$FFFFFF00	; DIVU (--- / val)
(1)  106/       0 : =$FFFFFF04          _HRL32		equ	$FFFFFF04	; DIVU (val / ---) or LOW Result if read
(1)  107/       0 : =$FFFFFF10          _HRH		equ	$FFFFFF10	; DIVU Result, HIGH
(1)  108/       0 : =$FFFFFF14          _HRL		equ	$FFFFFF14	; DIVU Result, LOW
(1)  109/       0 : =$FFFFFF80          _DMASOURCE0	equ	$FFFFFF80	; DMA source address 0
(1)  110/       0 : =$FFFFFF84          _DMADEST0	equ	$FFFFFF84	; DMA destination address 0
(1)  111/       0 : =$FFFFFF88          _DMACOUNT0	equ	$FFFFFF88	; DMA transfer count 0
(1)  112/       0 : =$FFFFFF8C          _DMACHANNEL0	equ	$FFFFFF8C	; DMA channel control 0
(1)  113/       0 : =$FFFFFF90          _DMASOURCE1	equ	$FFFFFF90	; DMA source address 1
(1)  114/       0 : =$FFFFFF94          _DMADEST1	equ	$FFFFFF94	; DMA destination address 1
(1)  115/       0 : =$FFFFFF98          _DMACOUNT1	equ	$FFFFFF98	; DMA transfer count 1
(1)  116/       0 : =$FFFFFF9C          _DMACHANNEL1	equ	$FFFFFF9C	; DMA channel control 1
(1)  117/       0 : =$FFFFFFA0          _DMAVECTORN0	equ	$FFFFFFA0	; DMA vector number N0
(1)  118/       0 : =$FFFFFFA4          _DMAVECTORE0	equ	$FFFFFFA4	; DMA vector number E0
(1)  119/       0 : =$FFFFFFA8          _DMAVECTORN1	equ	$FFFFFFA8	; DMA vector number N1
(1)  120/       0 : =$FFFFFFAC          _DMAVECTORE1	equ	$FFFFFFAC	; DMA vector number E1
(1)  121/       0 : =$FFFFFFB0          _DMAOPERATION	equ	$FFFFFFB0	; DMA operation
(1)  122/       0 : =$FFFFFFB4          _DMAREQACK0	equ	$FFFFFFB4	; DMA request/ack select control 0
(1)  123/       0 : =$FFFFFFB8          _DMAREQACK1	equ	$FFFFFFB8	; DMA request/ack select control 1
(1)  124/       0 :                     
      12/       0 :                     		
      13/       0 :                     ; ====================================================================
      14/       0 :                     ; ----------------------------------------------------------------
      15/       0 :                     ; Header
      16/       0 :                     ; ----------------------------------------------------------------
      17/       0 :                     
      18/       0 :                     		include	"system/head.asm"	; 32X Header and boot sequence
(1)    1/       0 :                     ; ====================================================================
(1)    2/       0 :                     ; ----------------------------------------------------------------
(1)    3/       0 :                     ; ROM HEADER FOR 32X
(1)    4/       0 :                     ; 
(1)    5/       0 :                     ; These labels work even if the 32X isn't present
(1)    6/       0 :                     ; ----------------------------------------------------------------
(1)    7/       0 :                     
(1)    8/       0 : 0000 0000           		dc.l 0				; Stack point
(1)    9/       4 : 0000 03F0           		dc.l $3F0			; Entry point (always $3F0)
(1)   10/       8 : 0000 0948           		dc.l MD_ErrBus			; Bus error
(1)   11/       C : 0000 0948           		dc.l MD_ErrAddr			; Address error
(1)   12/      10 : 0000 0948           		dc.l MD_ErrIll			; ILLEGAL Instruction
(1)   13/      14 : 0000 0948           		dc.l MD_ErrZDiv			; Divide by 0
(1)   14/      18 : 0000 0948           		dc.l MD_ErrChk			; CHK Instruction
(1)   15/      1C : 0000 0948           		dc.l MD_ErrTrapV		; TRAPV Instruction
(1)   16/      20 : 0000 0948           		dc.l MD_ErrPrivl		; Privilege violation
(1)   17/      24 : 0000 0948           		dc.l MD_Trace			; Trace
(1)   18/      28 : 0000 0948           		dc.l MD_Line1010		; Line 1010 Emulator
(1)   19/      2C : 0000 0948           		dc.l MD_Line1111		; Line 1111 Emulator
(1)   20/      30 : 0000 0948           		dc.l MD_ErrorEx			; Error exception
(1)   21/      34 : 0000 0948           		dc.l MD_ErrorEx
(1)   22/      38 : 0000 0948           		dc.l MD_ErrorEx
(1)   23/      3C : 0000 0948           		dc.l MD_ErrorEx
(1)   24/      40 : 0000 0948           		dc.l MD_ErrorEx	
(1)   25/      44 : 0000 0948           		dc.l MD_ErrorEx
(1)   26/      48 : 0000 0948           		dc.l MD_ErrorEx
(1)   27/      4C : 0000 0948           		dc.l MD_ErrorEx
(1)   28/      50 : 0000 0948           		dc.l MD_ErrorEx
(1)   29/      54 : 0000 0948           		dc.l MD_ErrorEx
(1)   30/      58 : 0000 0948           		dc.l MD_ErrorEx
(1)   31/      5C : 0000 0948           		dc.l MD_ErrorEx
(1)   32/      60 : 0000 0948           		dc.l MD_ErrorEx		
(1)   33/      64 : 0000 0948           		dc.l MD_ErrorTrap
(1)   34/      68 : 0000 0948           		dc.l MD_ErrorTrap
(1)   35/      6C : 0000 0948           		dc.l MD_ErrorTrap
(1)   36/      70 : FFFF 9808           		dc.l RAM_MdMarsHInt		; RAM jump for HBlank (JMP xxxx xxxx)
(1)   37/      74 : 0000 0948           		dc.l MD_ErrorTrap
(1)   38/      78 : FFFF 9802           		dc.l RAM_MdMarsVInt		; RAM jump for VBlank (JMP xxxx xxxx)
(1)   39/      7C : 0000 0948           		dc.l MD_ErrorTrap
(1)   40/      80 : 0000 0948           		dc.l MD_ErrorTrap
(1)   41/      84 : 0000 0948           		dc.l MD_ErrorTrap
(1)   42/      88 : 0000 0948           		dc.l MD_ErrorTrap
(1)   43/      8C : 0000 0948           		dc.l MD_ErrorTrap
(1)   44/      90 : 0000 0948           		dc.l MD_ErrorTrap
(1)   45/      94 : 0000 0948           		dc.l MD_ErrorTrap
(1)   46/      98 : 0000 0948           		dc.l MD_ErrorTrap
(1)   47/      9C : 0000 0948           		dc.l MD_ErrorTrap
(1)   48/      A0 : 0000 0948           		dc.l MD_ErrorTrap
(1)   49/      A4 : 0000 0948           		dc.l MD_ErrorTrap
(1)   50/      A8 : 0000 0948           		dc.l MD_ErrorTrap
(1)   51/      AC : 0000 0948           		dc.l MD_ErrorTrap
(1)   52/      B0 : 0000 0948           		dc.l MD_ErrorTrap
(1)   53/      B4 : 0000 0948           		dc.l MD_ErrorTrap
(1)   54/      B8 : 0000 0948           		dc.l MD_ErrorTrap
(1)   55/      BC : 0000 0948           		dc.l MD_ErrorTrap
(1)   56/      C0 : 0000 0948           		dc.l MD_ErrorTrap
(1)   57/      C4 : 0000 0948           		dc.l MD_ErrorTrap
(1)   58/      C8 : 0000 0948           		dc.l MD_ErrorTrap
(1)   59/      CC : 0000 0948           		dc.l MD_ErrorTrap
(1)   60/      D0 : 0000 0948           		dc.l MD_ErrorTrap
(1)   61/      D4 : 0000 0948           		dc.l MD_ErrorTrap
(1)   62/      D8 : 0000 0948           		dc.l MD_ErrorTrap
(1)   63/      DC : 0000 0948           		dc.l MD_ErrorTrap
(1)   64/      E0 : 0000 0948           		dc.l MD_ErrorTrap
(1)   65/      E4 : 0000 0948           		dc.l MD_ErrorTrap
(1)   66/      E8 : 0000 0948           		dc.l MD_ErrorTrap
(1)   67/      EC : 0000 0948           		dc.l MD_ErrorTrap
(1)   68/      F0 : 0000 0948           		dc.l MD_ErrorTrap
(1)   69/      F4 : 0000 0948           		dc.l MD_ErrorTrap
(1)   70/      F8 : 0000 0948           		dc.l MD_ErrorTrap
(1)   71/      FC : 0000 0948           		dc.l MD_ErrorTrap
(1)   72/     100 : 5345 4741 2033 3258 		dc.b "SEGA 32X        "
                    2020 2020 2020 2020 
(1)   73/     110 : 2843 2947 4636 3420 		dc.b "(C)GF64 2022.???"
                    3230 3232 2E3F 3F3F 
(1)   74/     120 : 5072 6F79 6563 746F 		dc.b "Proyecto MARSIANO                               "
                    204D 4152 5349 414E 
                    4F20 2020 2020 2020 
                    2020 2020 2020 2020 
                    2020 2020 2020 2020 
                    2020 2020 2020 2020 
(1)   75/     150 : 5072 6F6A 6563 7420 		dc.b "Project MARSIANO                                "
                    4D41 5253 4941 4E4F 
                    2020 2020 2020 2020 
                    2020 2020 2020 2020 
                    2020 2020 2020 2020 
                    2020 2020 2020 2020 
(1)   76/     180 : 474D 2048 4F4D 4542 		dc.b "GM HOMEBREW-00"
                    5245 572D 3030      
(1)   77/     18E : 0000                		dc.w 0
(1)   78/     190 : 4A36 2020 2020 2020 		dc.b "J6              "
                    2020 2020 2020 2020 
(1)   79/     1A0 : 0000 0000           		dc.l 0
(1)   80/     1A4 : 0009 C4B0           		dc.l ROM_END
(1)   81/     1A8 : 00FF 0000           		dc.l $FF0000
(1)   82/     1AC : 00FF FFFF           		dc.l $FFFFFF
(1)   83/     1B0 : 2020 2020           		dc.l $20202020		; dc.b "RA",$F8,$20
(1)   84/     1B4 : 2020 2020           		dc.l $20202020		; $200000
(1)   85/     1B8 : 2020 2020           		dc.l $20202020		; $203FFF
(1)   86/     1BC :                     		align $1F0
(1)   87/     1F0 : 5520 2020 2020 2020 		dc.b "U               "
                    2020 2020 2020 2020 
(1)   88/     200 :                     
(1)   89/     200 :                     ; ====================================================================
(1)   90/     200 :                     ; ----------------------------------------------------------------
(1)   91/     200 :                     ; Second header for 32X
(1)   92/     200 :                     ; 
(1)   93/     200 :                     ; These new jumps are for the 68K if the 32X is currently
(1)   94/     200 :                     ; active.
(1)   95/     200 :                     ; ----------------------------------------------------------------
(1)   96/     200 :                     
(1)   97/     200 : 4EF9 0088 0800      		jmp	($880000|MARS_Entry).l
(1)   98/     206 : 4EF9 0088 0948      		jmp	($880000|MD_ErrBus).l			; Bus error
(1)   99/     20C : 4EF9 0088 0948      		jmp	($880000|MD_ErrAddr).l			; Address error
(1)  100/     212 : 4EF9 0088 0948      		jmp	($880000|MD_ErrIll).l			; ILLEGAL Instruction
(1)  101/     218 : 4EF9 0088 0948      		jmp	($880000|MD_ErrZDiv).l			; Divide by 0
(1)  102/     21E : 4EF9 0088 0948      		jmp	($880000|MD_ErrChk).l			; CHK Instruction
(1)  103/     224 : 4EF9 0088 0948      		jmp	($880000|MD_ErrTrapV).l			; TRAPV Instruction
(1)  104/     22A : 4EF9 0088 0948      		jmp	($880000|MD_ErrPrivl).l			; Privilege violation
(1)  105/     230 : 4EF9 0088 0948      		jmp	($880000|MD_Trace).l			; Trace
(1)  106/     236 : 4EF9 0088 0948      		jmp	($880000|MD_Line1010).l			; Line 1010 Emulator
(1)  107/     23C : 4EF9 0088 0948      		jmp	($880000|MD_Line1111).l			; Line 1111 Emulator
(1)  108/     242 : 4EF9 0088 0948      		jmp	($880000|MD_ErrorEx).l			; Error exception
(1)  109/     248 : 4EF9 0088 0948      		jmp	($880000|MD_ErrorEx).l
(1)  110/     24E : 4EF9 0088 0948      		jmp	($880000|MD_ErrorEx).l
(1)  111/     254 : 4EF9 0088 0948      		jmp	($880000|MD_ErrorEx).l
(1)  112/     25A : 4EF9 0088 0948      		jmp	($880000|MD_ErrorEx).l	
(1)  113/     260 : 4EF9 0088 0948      		jmp	($880000|MD_ErrorEx).l
(1)  114/     266 : 4EF9 0088 0948      		jmp	($880000|MD_ErrorEx).l
(1)  115/     26C : 4EF9 0088 0948      		jmp	($880000|MD_ErrorEx).l
(1)  116/     272 : 4EF9 0088 0948      		jmp	($880000|MD_ErrorEx).l
(1)  117/     278 : 4EF9 0088 0948      		jmp	($880000|MD_ErrorEx).l
(1)  118/     27E : 4EF9 0088 0948      		jmp	($880000|MD_ErrorEx).l
(1)  119/     284 : 4EF9 0088 0948      		jmp	($880000|MD_ErrorEx).l
(1)  120/     28A : 4EF9 0088 0948      		jmp	($880000|MD_ErrorEx).l		
(1)  121/     290 : 4EF9 0088 0948      		jmp	($880000|MD_ErrorTrap).l
(1)  122/     296 : 4EF9 0088 0948      		jmp	($880000|MD_ErrorTrap).l
(1)  123/     29C : 4EF9 0088 0948      		jmp	($880000|MD_ErrorTrap).l
(1)  124/     2A2 : 4EF9 FFFF 9808      		jmp	(RAM_MdMarsHInt).l			; RAM jump for HBlank (JMP xxxx xxxx)
(1)  125/     2A8 : 4EF9 0088 0948      		jmp	($880000|MD_ErrorTrap).l
(1)  126/     2AE : 4EF9 FFFF 9802      		jmp	(RAM_MdMarsVInt).l			; RAM jump for VBlank (JMP xxxx xxxx)
(1)  127/     2B4 : 4EF9 0088 0948      		jmp	($880000|MD_ErrorTrap).l
(1)  128/     2BA : 4EF9 0088 0948      		jmp	($880000|MD_ErrorTrap).l
(1)  129/     2C0 : 4EF9 0088 0948      		jmp	($880000|MD_ErrorTrap).l
(1)  130/     2C6 : 4EF9 0088 0948      		jmp	($880000|MD_ErrorTrap).l
(1)  131/     2CC : 4EF9 0088 0948      		jmp	($880000|MD_ErrorTrap).l
(1)  132/     2D2 : 4EF9 0088 0948      		jmp	($880000|MD_ErrorTrap).l
(1)  133/     2D8 : 4EF9 0088 0948      		jmp	($880000|MD_ErrorTrap).l
(1)  134/     2DE : 4EF9 0088 0948      		jmp	($880000|MD_ErrorTrap).l
(1)  135/     2E4 : 4EF9 0088 0948      		jmp	($880000|MD_ErrorTrap).l
(1)  136/     2EA : 4EF9 0088 0948      		jmp	($880000|MD_ErrorTrap).l
(1)  137/     2F0 : 4EF9 0088 0948      		jmp	($880000|MD_ErrorTrap).l
(1)  138/     2F6 : 4EF9 0088 0948      		jmp	($880000|MD_ErrorTrap).l
(1)  139/     2FC : 4EF9 0088 0948      		jmp	($880000|MD_ErrorTrap).l
(1)  140/     302 : 4EF9 0088 0948      		jmp	($880000|MD_ErrorTrap).l
(1)  141/     308 : 4EF9 0088 0948      		jmp	($880000|MD_ErrorTrap).l
(1)  142/     30E : 4EF9 0088 0948      		jmp	($880000|MD_ErrorTrap).l
(1)  143/     314 : 4EF9 0088 0948      		jmp	($880000|MD_ErrorTrap).l
(1)  144/     31A : 4EF9 0088 0948      		jmp	($880000|MD_ErrorTrap).l
(1)  145/     320 : 4EF9 0088 0948      		jmp	($880000|MD_ErrorTrap).l
(1)  146/     326 : 4EF9 0088 0948      		jmp	($880000|MD_ErrorTrap).l
(1)  147/     32C : 4EF9 0088 0948      		jmp	($880000|MD_ErrorTrap).l
(1)  148/     332 : 4EF9 0088 0948      		jmp	($880000|MD_ErrorTrap).l
(1)  149/     338 : 4EF9 0088 0948      		jmp	($880000|MD_ErrorTrap).l
(1)  150/     33E : 4EF9 0088 0948      		jmp	($880000|MD_ErrorTrap).l
(1)  151/     344 : 4EF9 0088 0948      		jmp	($880000|MD_ErrorTrap).l
(1)  152/     34A : 4EF9 0088 0948      		jmp	($880000|MD_ErrorTrap).l
(1)  153/     350 : 4EF9 0088 0948      		jmp	($880000|MD_ErrorTrap).l
(1)  154/     356 : 4EF9 0088 0948      		jmp	($880000|MD_ErrorTrap).l
(1)  155/     35C : 4EF9 0088 0948      		jmp	($880000|MD_ErrorTrap).l
(1)  156/     362 : 4EF9 0088 0948      		jmp	($880000|MD_ErrorTrap).l
(1)  157/     368 : 4EF9 0088 0948      		jmp	($880000|MD_ErrorTrap).l
(1)  158/     36E : 4EF9 0088 0948      		jmp	($880000|MD_ErrorTrap).l
(1)  159/     374 : 4EF9 0088 0948      		jmp	($880000|MD_ErrorTrap).l
(1)  160/     37A :                     
(1)  161/     37A :                     ; ----------------------------------------------------------------
(1)  162/     37A :                     
(1)  163/     37A :                     		align $3C0
(1)  164/     3C0 : 4D41 5253 2043 4845 		dc.b "MARS CHECK MODE "			; Module name
                    434B 204D 4F44 4520 
(1)  165/     3D0 : 0000 0000           		dc.l 0					; Version (always 0)
(1)  166/     3D4 : 0004 CF20           		dc.l MARS_RAMDATA			; Set to 0 if SH2 code points to ROM
(1)  167/     3D8 : 0000 0000           		dc.l 0					; Zero.
(1)  168/     3DC : 0000 4390           		dc.l MARS_RAMDATA_e-MARS_RAMDATA	; Set to 4 if SH2 code points to ROM
(1)  169/     3E0 : 0600 0C84           		dc.l SH2_M_Entry			; Master SH2 PC (SH2 map area)
(1)  170/     3E4 : 0600 131C           		dc.l SH2_S_Entry			; Slave SH2 PC (SH2 map area)
(1)  171/     3E8 : 0600 0000           		dc.l SH2_Master				; Master SH2 default vector table (vbr)
(1)  172/     3EC : 0600 0124           		dc.l SH2_Slave				; Slave SH2 default vector table (vbr)
(1)  173/     3F0 :                     		binclude "system/mars/data/security.bin"
(1)  174/     800 :                     
(1)  175/     800 :                     ; ====================================================================
(1)  176/     800 :                     ; ----------------------------------------------------------------
(1)  177/     800 :                     ; Entry point, this must be located at $3F0
(1)  178/     800 :                     ; 
(1)  179/     800 :                     ; After the 32X's internal initialization finishes,
(1)  180/     800 :                     ; It returns the following stuff:
(1)  181/     800 :                     ; 
(1)  182/     800 :                     ; d0: %h0000000 rsc000ti
(1)  183/     800 :                     ; 	h - Cold start / Hot Start
(1)  184/     800 :                     ; 	r - SDRAM Self Check pass or error
(1)  185/     800 :                     ; 	s - Security check pass or error
(1)  186/     800 :                     ; 	c - Checksum pass or error
(1)  187/     800 :                     ; 	t - TV mode pass or error
(1)  188/     800 :                     ; 	i - MARS ID pass or error
(1)  189/     800 :                     ; 
(1)  190/     800 :                     ; d1: %m0000000 jdk0vvv
(1)  191/     800 :                     ; 	m - MARS TV mode
(1)  192/     800 :                     ; 	j - Country: Japan / Overseas
(1)  193/     800 :                     ; 	d - MD TV mode
(1)  194/     800 :                     ; 	k - DISK connected: Yes / No
(1)  195/     800 :                     ; 	v - Version
(1)  196/     800 :                     ; 
(1)  197/     800 :                     ; Carry flag: "MARS ID" and Self Check result
(1)  198/     800 :                     ; 	cc: Test passed
(1)  199/     800 :                     ; 	cs: Test failed
(1)  200/     800 :                     ; ----------------------------------------------------------------
(1)  201/     800 :                     
(1)  202/     800 :                     MARS_Entry:
(1)  203/     800 : 6500 012E           		bcs	.no_mars			; if Carry set, 32X is not present
(1)  204/     804 : 23FC 0000 0000 FFFF 		move.l	#0,(RAM_initflug).l		; Reset "INIT" flag
                    97FE                
(1)  205/     80E : 0800 000F           		btst	#15,d0				; Soft reset?	
(1)  206/     812 : 676C                		beq.s	.init
(1)  207/     814 : 4BF9 00A1 5100      		lea	(sysmars_reg).l,a5		; a5 - MARS register
(1)  208/     81A : 0815 0000           		btst.b	#0,adapter(a5)			; 32X enabled?
(1)  209/     81E : 6652                		bne	.adapterenable			; If yes, start booting
(1)  210/     820 : 2B7C 0000 0000 0028 		move.l	#0,comm8(a5)			; If not, we can't use 32X or something went wrong
(1)  211/     828 : 41FA 0020           		lea	.ramcode(pc),a0			; Copy the adapter-retry code to RAM
(1)  212/     82C : 43F9 00FF 0000      		lea	($FF0000).l,a1			; and jump there.
(1)  213/     832 : 22D8                		move.l	(a0)+,(a1)+
(1)  214/     834 : 22D8                		move.l	(a0)+,(a1)+
(1)  215/     836 : 22D8                		move.l	(a0)+,(a1)+
(1)  216/     838 : 22D8                		move.l	(a0)+,(a1)+
(1)  217/     83A : 22D8                		move.l	(a0)+,(a1)+
(1)  218/     83C : 22D8                		move.l	(a0)+,(a1)+
(1)  219/     83E : 22D8                		move.l	(a0)+,(a1)+
(1)  220/     840 : 22D8                		move.l	(a0)+,(a1)+
(1)  221/     842 : 41F9 00FF 0000      		lea	($FF0000).l,a0
(1)  222/     848 : 4ED0                		jmp	(a0)
(1)  223/     84A :                     .ramcode:
(1)  224/     84A : 1ABC 0001           		move.b	#1,adapter(a5)			; Enable adapter.
(1)  225/     84E : 41FA 000A           		lea	.restarticd(pc),a0		; JUMP to the following code in
(1)  226/     852 : D1FC 0088 0000      		adda.l	#$880000,a0			; the new 68k location
(1)  227/     858 : 4ED0                		jmp	(a0)
(1)  228/     85A :                     .restarticd:
(1)  229/     85A : 4BF9 00A1 0000      		lea	($A10000).l,a5			; a5 - MD's I/O area base
(1)  230/     860 : 287C FFFF FFC0      		move.l	#-64,a4				; a4 - $FFFFFF9C
(1)  231/     866 : 3E3C 0F3C           		move.w	#3900,d7			; d7 - loop this many times
(1)  232/     86A : 43F9 0088 06E4      		lea	($880000+$6E4),a1		; Jump to ?res_wait (check ICD_MARS.PRG for details)
(1)  233/     870 : 4ED1                		jmp	(a1)
(1)  234/     872 :                     .adapterenable:
(1)  235/     872 : 4BF9 00A1 5100      		lea	(sysmars_reg),a5
(1)  236/     878 : 0815 0001           		btst.b	#1,adapter(a5)			; SH2 Reset request?
(1)  237/     87C : 6640                		bne.s	.hotstart			; If not, we are on hotstart
(1)  238/     87E : 60DA                		bra.s	.restarticd
(1)  239/     880 :                     
(1)  240/     880 :                     ; ------------------------------------------------
(1)  241/     880 :                     ; Init
(1)  242/     880 :                     ; ------------------------------------------------
(1)  243/     880 :                     
(1)  244/     880 :                     .init:
(1)  245/     880 : 46FC 2700           		move.w	#$2700,sr			; Disable interrupts
(1)  246/     884 : 4BF9 00A1 5100      		lea	(sysmars_reg).l,a5
(1)  247/     88A : 2B7C 3638 5550 002C 		move.l	#"68UP",comm12(a5)		; comm12: Report to SH2 that we are active.
(1)  248/     892 : 0CAD 4D5F 4F4B 0020 .wm:		cmp.l	#"M_OK",comm0(a5)		; SH2 Master active?
(1)  249/     89A : 66F6                		bne.s	.wm
(1)  250/     89C : 0CAD 535F 4F4B 0024 .ws:		cmp.l	#"S_OK",comm4(a5)		; SH2 Slave active?
(1)  251/     8A4 : 66F6                		bne.s	.ws
(1)  252/     8A6 : 7000                		moveq	#0,d0				; Reset comm values
(1)  253/     8A8 : 2B40 0020           		move.l	d0,comm0(a5)
(1)  254/     8AC : 2B40 0024           		move.l	d0,comm4(a5)
(1)  255/     8B0 : 2B40 002C           		move.l	d0,comm12(a5)
(1)  256/     8B4 : 23FC 494E 4954 FFFF 		move.l	#"INIT",(RAM_initflug).l	; Set "INIT" as our boot flag
                    97FE                
(1)  257/     8BE :                     .hotstart:
(1)  258/     8BE : 0CB9 494E 4954 FFFF 		cmp.l	#"INIT",(RAM_initflug).l	; Did it write?
                    97FE                
(1)  259/     8C8 : 66B6                		bne.s	.init				; If not, restart everything and try again.
(1)  260/     8CA :                     		
(1)  261/     8CA :                     	; Initialize Genesis
(1)  262/     8CA : 7000                		moveq	#0,d0				; Clear USP
(1)  263/     8CC : 2C40                		movea.l	d0,a6
(1)  264/     8CE : 4E66                		move.l	a6,usp
(1)  265/     8D0 : 3039 00C0 0004      .waitframe:	move.w	(vdp_ctrl).l,d0			; Wait a frame
(1)  266/     8D6 : 0800 0003           		btst	#bitVint,d0
(1)  267/     8DA : 67F4                		beq.s	.waitframe
(1)  268/     8DC : 23FC 8004 8144 00C0 		move.l	#$80048144,(vdp_ctrl).l		; Keep display
                    0004                
(1)  269/     8E6 : 41F9 00FF 0000      		lea	($FF0000),a0			; Clear RAM until $FFF000
(1)  270/     8EC : 303C 3BFF           		move.w	#($F000/4)-1,d0
(1)  271/     8F0 :                     .clrram:
(1)  272/     8F0 : 4298                		clr.l	(a0)+
(1)  273/     8F2 : 51C8 FFFC           		dbf	d0,.clrram
(1)  274/     8F6 : 4CF9 7FFF 00FF 0000 		movem.l	($FF0000),d0-a6			; Clear registers (using zeros from RAM)
(1)  275/     8FE :                     
(1)  276/     8FE :                     	; Transfer RAM-Common code
(1)  277/     8FE : 41FA 004A           		lea	MdRamCode(pc),a0		; Now copy ALL our 68k code to RAM, to prevent
(1)  278/     902 : 43F9 00FF 0000      		lea	($FF0000),a1			; BUS-fighthing the ROM area (speed-up purposes)
(1)  279/     908 : 303C 1B89           		move.w	#((MdRamCode_end-MdRamCode))-1,d0
(1)  280/     90C :                     .copyme:
(1)  281/     90C : 12D8                		move.b	(a0)+,(a1)+
(1)  282/     90E : 51C8 FFFC           		dbf	d0,.copyme
(1)  283/     912 : 4EB9 00FF 0036      		jsr	(Sound_init).l
(1)  284/     918 : 4EB9 00FF 01E4      		jsr	(Video_init).l
(1)  285/     91E : 4EB9 00FF 17BC      		jsr	(System_Init).l
(1)  286/     924 : 203C 0000 4240      		move.l	#Default_Boot,d0
(1)  287/     92A : 4EF9 00FF 19EC      		jmp	(System_JumpRamCode).l
(1)  288/     930 :                     
(1)  289/     930 :                     ; ====================================================================
(1)  290/     930 :                     ; ----------------------------------------------------------------
(1)  291/     930 :                     ; If 32X is not detected... 
(1)  292/     930 :                     ; 
(1)  293/     930 :                     ; This only works in emulators, though.
(1)  294/     930 :                     ; ----------------------------------------------------------------
(1)  295/     930 :                     
(1)  296/     930 :                     .no_mars:
(1)  297/     930 : 46FC 2700           		move.w	#$2700,sr			; Disable interrupts
(1)  298/     934 : 23FC C000 0000 00C0 		move.l	#$C0000000,(vdp_ctrl).l		; VDP: Point to Color 0
                    0004                
(1)  299/     93E : 33FC 0E00 00C0 0000 		move.w	#$0E00,(vdp_data).l		; Write blue
(1)  300/     946 : 60FE                		bra.s	*				; Infinite loop.
(1)  301/     948 :                     
(1)  302/     948 :                     ; ====================================================================
(1)  303/     948 :                     ; ----------------------------------------------------------------
(1)  304/     948 :                     ; Error traps
(1)  305/     948 :                     ; ----------------------------------------------------------------
(1)  306/     948 :                     
(1)  307/     948 :                     MD_ErrBus:		; Bus error
(1)  308/     948 :                     MD_ErrAddr:		; Address error
(1)  309/     948 :                     MD_ErrIll:		; ILLEGAL Instruction
(1)  310/     948 :                     MD_ErrZDiv:		; Divide by 0
(1)  311/     948 :                     MD_ErrChk:		; CHK Instruction
(1)  312/     948 :                     MD_ErrTrapV:		; TRAPV Instruction
(1)  313/     948 :                     MD_ErrPrivl:		; Privilege violation
(1)  314/     948 :                     MD_Trace:		; Trace
(1)  315/     948 :                     MD_Line1010:		; Line 1010 Emulator
(1)  316/     948 :                     MD_Line1111:		; Line 1111 Emulator
(1)  317/     948 :                     MD_ErrorEx:		; Error exception
(1)  318/     948 :                     MD_ErrorTrap:
(1)  319/     948 : 4E73                		rte
(1)  320/     94A :                     
      19/     94A :                     
      20/     94A :                     ; ====================================================================
      21/     94A :                     ; --------------------------------------------------------
      22/     94A :                     ; All purpose 68k stored on RAM
      23/     94A :                     ; --------------------------------------------------------
      24/     94A :                     
      25/     94A :                     MdRamCode:
      26/  FF0000 :                     		phase $FF0000
      27/  FF0000 :                     minfo_ram_s:
      28/  FF0000 :                     		include	"system/md/sound.asm"
(1)    1/  FF0000 :                     ; ====================================================================
(1)    2/  FF0000 :                     ; ----------------------------------------------------------------
(1)    3/  FF0000 :                     ; MD Sound
(1)    4/  FF0000 :                     ; ----------------------------------------------------------------
(1)    5/  FF0000 :                     
(1)    6/  FF0000 :                     ; --------------------------------------------------------
(1)    7/  FF0000 :                     ; Init Sound
(1)    8/  FF0000 :                     ; 
(1)    9/  FF0000 :                     ; Uses:
(1)   10/  FF0000 :                     ; a0-a1,d0-d1
(1)   11/  FF0000 :                     ; --------------------------------------------------------
(1)   12/  FF0000 :                     
(1)   13/  FF0000 :                     		align $80				; (GENS emulator only)
(1)   14/  FF0036 :                     Sound_Init:
(1)   15/  FF0036 : 33FC 0100 00A1 1100 		move.w	#$0100,(z80_bus).l		; Stop Z80
(1)   16/  FF003E : 13FC 0001 00A1 1200 		move.b	#1,(z80_reset).l		; Reset
(1)   17/  FF0046 :                     .wait:
(1)   18/  FF0046 : 0839 0000 00A1 1100 		btst	#0,(z80_bus).l
(1)   19/  FF004E : 66F6                		bne.s	.wait
(1)   20/  FF0050 : 41F9 00A0 0000      		lea	(z80_cpu).l,a0
(1)   21/  FF0056 : 303C 1FFF           		move.w	#$1FFF,d0
(1)   22/  FF005A : 7200                		moveq	#0,d1
(1)   23/  FF005C :                     .cleanup:
(1)   24/  FF005C : 10C1                		move.b	d1,(a0)+
(1)   25/  FF005E : 51C8 FFFC           		dbf	d0,.cleanup
(1)   26/  FF0062 : 41F9 0088 2500      		lea	(Z80_CODE|$880000).l,a0		; a0 - Z80 code (on $880000 area)
(1)   27/  FF0068 : 43F9 00A0 0000      		lea	(z80_cpu).l,a1			; a1 - Z80 area
(1)   28/  FF006E : 303C 1D3F           		move.w	#(Z80_CODE_END-Z80_CODE)-1,d0	; d0 - Size
(1)   29/  FF0072 :                     .copy:
(1)   30/  FF0072 : 12D8                		move.b	(a0)+,(a1)+
(1)   31/  FF0074 : 51C8 FFFC           		dbf	d0,.copy
(1)   32/  FF0078 : 13FC 0001 00A1 1200 		move.b	#1,(z80_reset).l		; Reset
(1)   33/  FF0080 : 4E71                		nop 
(1)   34/  FF0082 : 4E71                		nop 
(1)   35/  FF0084 : 4E71                		nop 
(1)   36/  FF0086 : 33FC 0000 00A1 1100 		move.w	#0,(z80_bus).l
(1)   37/  FF008E : 4E75                		rts
(1)   38/  FF0090 :                     
(1)   39/  FF0090 :                     ; ; --------------------------------------------------------
(1)   40/  FF0090 :                     ; ; Routine to check if Z80 wants something from here
(1)   41/  FF0090 :                     ; ;
(1)   42/  FF0090 :                     ; ; Call this on VBlank only.
(1)   43/  FF0090 :                     ; ; --------------------------------------------------------
(1)   44/  FF0090 :                     ;
(1)   45/  FF0090 :                     ; Sound_Update:
(1)   46/  FF0090 :                     ; 		rts
(1)   47/  FF0090 :                     
(1)   48/  FF0090 :                     ; ====================================================================
(1)   49/  FF0090 :                     ; ----------------------------------------------------------------
(1)   50/  FF0090 :                     ; Subroutines
(1)   51/  FF0090 :                     ; ----------------------------------------------------------------
(1)   52/  FF0090 :                     
(1)   53/  FF0090 :                     ; --------------------------------------------------------
(1)   54/  FF0090 :                     ; Sound_DMA_Pause
(1)   55/  FF0090 :                     ; 
(1)   56/  FF0090 :                     ; Call this before doing any DMA task
(1)   57/  FF0090 :                     ; --------------------------------------------------------
(1)   58/  FF0090 :                     
(1)   59/  FF0090 :                     Sound_DMA_Pause:
(1)   60/  FF0090 : 40E7                		move.w	sr,-(sp)
(1)   61/  FF0092 : 007C 0700           		or.w	#$700,sr
(1)   62/  FF0096 :                     .retry:
(1)   63/  FF0096 : 33FC 0100 00A1 1100 		move.w	#$0100,(z80_bus).l		; Stop Z80
(1)   64/  FF009E :                     .wait:
(1)   65/  FF009E : 0839 0000 00A1 1100 		btst	#0,(z80_bus).l			; Wait for it
(1)   66/  FF00A6 : 66F6                		bne.s	.wait
(1)   67/  FF00A8 : 1E39 00A0 002E      		move.b	(z80_cpu+commZRomRd),d7		; Get mid-read bit
(1)   68/  FF00AE : 33FC 0000 00A1 1100 		move.w	#0,(z80_bus).l			; Resume Z80
(1)   69/  FF00B6 : 4A07                		tst.b	d7
(1)   70/  FF00B8 : 6708                		beq.s	.safe
(1)   71/  FF00BA : 7E44                		moveq	#68,d7
(1)   72/  FF00BC : 51CF FFFE           		dbf	d7,*
(1)   73/  FF00C0 : 60D4                		bra.s	.retry
(1)   74/  FF00C2 :                     .safe:
(1)   75/  FF00C2 : 13FC 0001 00A0 002D 		move.b	#1,(z80_cpu+commZRomBlk)	; Block flag for Z80
(1)   76/  FF00CA : 46DF                		move.w	(sp)+,sr
(1)   77/  FF00CC : 4E75                		rts
(1)   78/  FF00CE :                     
(1)   79/  FF00CE :                     ; --------------------------------------------------------
(1)   80/  FF00CE :                     ; Sound_DMA_Resume
(1)   81/  FF00CE :                     ; 
(1)   82/  FF00CE :                     ; Call this after finishing DMA
(1)   83/  FF00CE :                     ; --------------------------------------------------------
(1)   84/  FF00CE :                     
(1)   85/  FF00CE :                     Sound_DMA_Resume:
(1)   86/  FF00CE : 40E7                		move.w	sr,-(sp)
(1)   87/  FF00D0 : 007C 0700           		or.w	#$700,sr
(1)   88/  FF00D4 : 617A                		bsr	sndLockZ80
(1)   89/  FF00D6 : 13FC 0000 00A0 002D 		move.b	#0,(z80_cpu+commZRomBlk)
(1)   90/  FF00DE : 6100 0084           		bsr	sndUnlockZ80
(1)   91/  FF00E2 : 46DF                		move.w	(sp)+,sr
(1)   92/  FF00E4 : 4E75                		rts
(1)   93/  FF00E6 :                     
(1)   94/  FF00E6 :                     ; --------------------------------------------------------
(1)   95/  FF00E6 :                     ; Sound_Request_Word
(1)   96/  FF00E6 :                     ; 
(1)   97/  FF00E6 :                     ; d0    - request id
(1)   98/  FF00E6 :                     ; d1    - argument
(1)   99/  FF00E6 :                     ; --------------------------------------------------------
(1)  100/  FF00E6 :                     
(1)  101/  FF00E6 :                     Sound_Request:
(1)  102/  FF00E6 : 6100 0088           		bsr	sndReq_Enter
(1)  103/  FF00EA : 3E00                		move.w	d0,d7
(1)  104/  FF00EC : 6100 00CE           		bsr	sndReq_scmd
(1)  105/  FF00F0 : 2E01                		move.l	d1,d7
(1)  106/  FF00F2 : 6100 00DE           		bsr	sndReq_sword
(1)  107/  FF00F6 : 6000 00AE           		bra 	sndReq_Exit
(1)  108/  FF00FA :                     
(1)  109/  FF00FA :                     ; --------------------------------------------------------
(1)  110/  FF00FA :                     ; SoundReq_SetTrack
(1)  111/  FF00FA :                     ; 
(1)  112/  FF00FA :                     ; d0 - Pattern data pointer
(1)  113/  FF00FA :                     ; d1 - Block data pointer
(1)  114/  FF00FA :                     ; d2 - Instrument data pointer
(1)  115/  FF00FA :                     ; d3 - Ticks (Tempo is set separately)
(1)  116/  FF00FA :                     ; d4 - Slot (0-2)
(1)  117/  FF00FA :                     ; --------------------------------------------------------
(1)  118/  FF00FA :                     
(1)  119/  FF00FA :                     SoundReq_SetTrack:
(1)  120/  FF00FA : 6174                		bsr	sndReq_Enter
(1)  121/  FF00FC : 3E3C 0000           		move.w	#$00,d7			; Command $00
(1)  122/  FF0100 : 6100 00BA           		bsr	sndReq_scmd
(1)  123/  FF0104 : 1E04                		move.b	d4,d7			; d4 - Slot
(1)  124/  FF0106 : 6100 00CE           		bsr	sndReq_sbyte
(1)  125/  FF010A : 1E03                		move.b	d3,d7			; d3 - Ticks
(1)  126/  FF010C : 6100 00C8           		bsr	sndReq_sbyte
(1)  127/  FF0110 : 2E00                		move.l	d0,d7			; d0 - Patt data point
(1)  128/  FF0112 : 6100 00BA           		bsr	sndReq_saddr
(1)  129/  FF0116 : 2E01                		move.l	d1,d7			; d1 - Block data point
(1)  130/  FF0118 : 6100 00B4           		bsr	sndReq_saddr
(1)  131/  FF011C : 2E02                		move.l	d2,d7			; d2 - Intrument data
(1)  132/  FF011E : 6100 00AE           		bsr	sndReq_saddr
(1)  133/  FF0122 : 6000 0082           		bra 	sndReq_Exit
(1)  134/  FF0126 :                     		
(1)  135/  FF0126 :                     ; --------------------------------------------------------
(1)  136/  FF0126 :                     ; SoundReq_SetSample
(1)  137/  FF0126 :                     ; 
(1)  138/  FF0126 :                     ; d0 - Sample pointer
(1)  139/  FF0126 :                     ; d1 - length
(1)  140/  FF0126 :                     ; d2 - loop point
(1)  141/  FF0126 :                     ; d3 - Pitch ($01.00)
(1)  142/  FF0126 :                     ; d4 - Flags (%00l l-loop enable)
(1)  143/  FF0126 :                     ; --------------------------------------------------------
(1)  144/  FF0126 :                     
(1)  145/  FF0126 :                     SoundReq_SetSample:
(1)  146/  FF0126 : 6148                		bsr	sndReq_Enter
(1)  147/  FF0128 : 3E3C 0021           		move.w	#$21,d7			; Command $21
(1)  148/  FF012C : 6100 008E           		bsr	sndReq_scmd
(1)  149/  FF0130 : 2E00                		move.l	d0,d7
(1)  150/  FF0132 : 6100 009A           		bsr	sndReq_saddr
(1)  151/  FF0136 : 2E01                		move.l	d1,d7
(1)  152/  FF0138 : 6100 0094           		bsr	sndReq_saddr
(1)  153/  FF013C : 2E02                		move.l	d2,d7
(1)  154/  FF013E : 6100 008E           		bsr	sndReq_saddr
(1)  155/  FF0142 : 2E03                		move.l	d3,d7
(1)  156/  FF0144 : 6100 008C           		bsr	sndReq_sword
(1)  157/  FF0148 : 2E04                		move.l	d4,d7
(1)  158/  FF014A : 6100 008A           		bsr	sndReq_sbyte
(1)  159/  FF014E : 6056                		bra 	sndReq_Exit
(1)  160/  FF0150 :                     
(1)  161/  FF0150 :                     ; ------------------------------------------------
(1)  162/  FF0150 :                     ; Lock Z80, get bus
(1)  163/  FF0150 :                     ; ------------------------------------------------
(1)  164/  FF0150 :                     
(1)  165/  FF0150 :                     sndLockZ80:
(1)  166/  FF0150 : 33FC 0100 00A1 1100 		move.w	#$0100,(z80_bus).l		; Stop Z80
(1)  167/  FF0158 :                     .wait:
(1)  168/  FF0158 : 0839 0000 00A1 1100 		btst	#0,(z80_bus).l			; Wait for it
(1)  169/  FF0160 : 66F6                		bne.s	.wait
(1)  170/  FF0162 : 4E75                		rts
(1)  171/  FF0164 :                     		
(1)  172/  FF0164 :                     ; ------------------------------------------------
(1)  173/  FF0164 :                     ; Unlock Z80, return bus
(1)  174/  FF0164 :                     ; ------------------------------------------------
(1)  175/  FF0164 :                     
(1)  176/  FF0164 :                     sndUnlockZ80:
(1)  177/  FF0164 : 33FC 0000 00A1 1100 		move.w	#0,(z80_bus).l
(1)  178/  FF016C : 4E75                		rts
(1)  179/  FF016E :                     sndSendCmd:
(1)  180/  FF016E : 4E75                		rts
(1)  181/  FF0170 :                     
(1)  182/  FF0170 :                     ; ------------------------------------------------
(1)  183/  FF0170 :                     ; 68k-to-z80 Sound request
(1)  184/  FF0170 :                     ; enter/exit routines
(1)  185/  FF0170 :                     ; ------------------------------------------------
(1)  186/  FF0170 :                     
(1)  187/  FF0170 :                     sndReq_Enter:
(1)  188/  FF0170 : 48F9 60C0 FFFF 9000 		movem.l	d6-d7/a5-a6,(RAM_SndSaveReg).l
(1)  189/  FF0178 : 7C00                		moveq	#0,d6
(1)  190/  FF017A : 40C6                		move.w	sr,d6
(1)  191/  FF017C : 4846                		swap	d6
(1)  192/  FF017E : 33FC 0100 00A1 1100 		move.w	#$0100,(z80_bus).l		; Stop Z80
(1)  193/  FF0186 : 007C 0700           		or.w	#$0700,sr			; disable ints
(1)  194/  FF018A : 4BF9 00A0 002C      		lea	(z80_cpu+commZWrite),a5		; a5 - commZWrite
(1)  195/  FF0190 : 4DF9 00A0 1D00      		lea	(z80_cpu+commZfifo),a6		; a6 - fifo command list
(1)  196/  FF0196 :                     .wait:
(1)  197/  FF0196 : 0839 0000 00A1 1100 		btst	#0,(z80_bus).l			; Wait for Z80
(1)  198/  FF019E : 66F6                		bne.s	.wait
(1)  199/  FF01A0 : 1C15                		move.b	(a5),d6				; d6 - index fifo position
(1)  200/  FF01A2 : 4886                		ext.w	d6				; extend to 16 bits
(1)  201/  FF01A4 : 4E75                		rts
(1)  202/  FF01A6 :                     ; JUMP ONLY
(1)  203/  FF01A6 :                     sndReq_Exit:
(1)  204/  FF01A6 : 33FC 0000 00A1 1100 		move.w	#0,(z80_bus).l
(1)  205/  FF01AE : 4846                		swap	d6
(1)  206/  FF01B0 : 46C6                		move.w	d6,sr
(1)  207/  FF01B2 : 4CF9 60C0 FFFF 9000 		movem.l	(RAM_SndSaveReg).l,d6-d7/a5-a6
(1)  208/  FF01BA : 4E75                		rts
(1)  209/  FF01BC :                     		
(1)  210/  FF01BC :                     ; ------------------------------------------------
(1)  211/  FF01BC :                     ; Send request id and arguments
(1)  212/  FF01BC :                     ;
(1)  213/  FF01BC :                     ; Input:
(1)  214/  FF01BC :                     ; d7 - byte to write
(1)  215/  FF01BC :                     ; d6 - index pointer
(1)  216/  FF01BC :                     ; a5 - commZWrite, update index
(1)  217/  FF01BC :                     ; a6 - commZfifo command list
(1)  218/  FF01BC :                     ; 
(1)  219/  FF01BC :                     ; *** CALL sndReq_Enter FIRST ***
(1)  220/  FF01BC :                     ; ------------------------------------------------
(1)  221/  FF01BC :                     
(1)  222/  FF01BC :                     sndReq_scmd:
(1)  223/  FF01BC : 1DBC 00FF 6000      		move.b	#-1,(a6,d6.w)			; write command-start flag
(1)  224/  FF01C2 : 5206                		addq.b	#1,d6				; next fifo pos
(1)  225/  FF01C4 : 0206 003F           		andi.b	#$3F,d6
(1)  226/  FF01C8 : 600C                		bra.s	sndReq_sbyte
(1)  227/  FF01CA :                     sndReq_slong:
(1)  228/  FF01CA : 610A                		bsr	sndReq_sbyte
(1)  229/  FF01CC : E09F                		ror.l	#8,d7
(1)  230/  FF01CE :                     sndReq_saddr:
(1)  231/  FF01CE : 6106                		bsr	sndReq_sbyte
(1)  232/  FF01D0 : E09F                		ror.l	#8,d7
(1)  233/  FF01D2 :                     sndReq_sword:
(1)  234/  FF01D2 : 6102                		bsr	sndReq_sbyte
(1)  235/  FF01D4 : E09F                		ror.l	#8,d7
(1)  236/  FF01D6 :                     sndReq_sbyte:
(1)  237/  FF01D6 : 1D87 6000           		move.b	d7,(a6,d6.w)			; write byte
(1)  238/  FF01DA : 5206                		addq.b	#1,d6				; next fifo pos
(1)  239/  FF01DC : 0206 003F           		andi.b	#$3F,d6
(1)  240/  FF01E0 : 1A86                		move.b	d6,(a5)				; update commZWrite
(1)  241/  FF01E2 : 4E75                		rts
(1)  242/  FF01E4 :                     
      29/  FF01E4 :                     		include	"system/md/video.asm"
(1)    1/  FF01E4 :                     ; ====================================================================
(1)    2/  FF01E4 :                     ; ----------------------------------------------------------------
(1)    3/  FF01E4 :                     ; MD Video
(1)    4/  FF01E4 :                     ; ----------------------------------------------------------------
(1)    5/  FF01E4 :                     
(1)    6/  FF01E4 :                     ; --------------------------------------------------------
(1)    7/  FF01E4 :                     ; Init Video
(1)    8/  FF01E4 :                     ; 
(1)    9/  FF01E4 :                     ; Uses:
(1)   10/  FF01E4 :                     ; a0-a2,d0-d1
(1)   11/  FF01E4 :                     ; --------------------------------------------------------
(1)   12/  FF01E4 :                     
(1)   13/  FF01E4 :                     Video_Init:		
(1)   14/  FF01E4 : 41F8 9020           		lea	(RAM_MdVideo),a0	; Clear RAM
(1)   15/  FF01E8 : 7000                		moveq	#0,d0
(1)   16/  FF01EA : 323C 0199           		move.w	#(sizeof_mdvid-RAM_MdVideo)-1,d1
(1)   17/  FF01EE :                     .clrram:
(1)   18/  FF01EE : 10C0                		move.b	d0,(a0)+
(1)   19/  FF01F0 : 51C9 FFFC           		dbf	d1,.clrram
(1)   20/  FF01F4 :                     
(1)   21/  FF01F4 : 41FA 0592           		lea	list_vdpregs(pc),a0	; Init registers
(1)   22/  FF01F8 : 43F8 91A2           		lea	(RAM_VdpRegs).w,a1
(1)   23/  FF01FC : 45F9 00C0 0004      		lea	(vdp_ctrl),a2
(1)   24/  FF0202 : 303C 8000           		move.w	#$8000,d0
(1)   25/  FF0206 : 323C 0012           		move.w	#19-1,d1
(1)   26/  FF020A :                     .loop:
(1)   27/  FF020A : 1018                		move.b	(a0)+,d0
(1)   28/  FF020C : 12C0                		move.b	d0,(a1)+
(1)   29/  FF020E : 3480                		move.w	d0,(a2)
(1)   30/  FF0210 : D07C 0100           		add.w	#$100,d0
(1)   31/  FF0214 : 51C9 FFF4           		dbf	d1,.loop
(1)   32/  FF0218 :                     .exit:
(1)   33/  FF0218 : 4E75                		rts
(1)   34/  FF021A :                     
(1)   35/  FF021A :                     ; ====================================================================
(1)   36/  FF021A :                     ; ----------------------------------------------------------------
(1)   37/  FF021A :                     ; Video subroutines
(1)   38/  FF021A :                     ; ----------------------------------------------------------------
(1)   39/  FF021A :                     
(1)   40/  FF021A :                     ; --------------------------------------------------------
(1)   41/  FF021A :                     ; Video_Clear
(1)   42/  FF021A :                     ; 
(1)   43/  FF021A :                     ; Clear all video data
(1)   44/  FF021A :                     ; --------------------------------------------------------
(1)   45/  FF021A :                     
(1)   46/  FF021A :                     Video_Clear:
(1)   47/  FF021A : 303C 0000           		move.w	#0,d0			; Clear until $57F
(1)   48/  FF021E : 323C AFE0           		move.w	#$57F*$20,d1
(1)   49/  FF0222 : 343C 0000           		move.w	#0,d2
(1)   50/  FF0226 : 6100 038C           		bsr	Video_Fill
(1)   51/  FF022A : 323C 0FFF           		move.w	#$FFF,d1		; FG/BG size
(1)   52/  FF022E : 1439 FFFF 91A4      		move.b	(RAM_VdpRegs+2).l,d2	; FG
(1)   53/  FF0234 : 0242 0038           		andi.w	#%111000,d2
(1)   54/  FF0238 : E14A                		lsl.w	#8,d2
(1)   55/  FF023A : E54A                		lsl.w	#2,d2
(1)   56/  FF023C : 6100 0376           		bsr	Video_Fill
(1)   57/  FF0240 : 1439 FFFF 91A5      		move.b	(RAM_VdpRegs+3).l,d2	; BG
(1)   58/  FF0246 : 0242 0007           		andi.w	#%000111,d2
(1)   59/  FF024A : E14A                		lsl.w	#8,d2
(1)   60/  FF024C : EB4A                		lsl.w	#5,d2
(1)   61/  FF024E : 6100 0364           		bsr	Video_Fill	
(1)   62/  FF0252 : 323C 0FFF           		move.w	#$FFF,d1		; WD Size
(1)   63/  FF0256 : 1439 FFFF 91A6      		move.b	(RAM_VdpRegs+4).l,d2	; Window
(1)   64/  FF025C : 0242 003E           		andi.w	#%111110,d2
(1)   65/  FF0260 : E14A                		lsl.w	#8,d2
(1)   66/  FF0262 : E54A                		lsl.w	#2,d2
(1)   67/  FF0264 : 6000 034E           		bra	Video_Fill
(1)   68/  FF0268 :                     		
(1)   69/  FF0268 :                     ; ---------------------------------
(1)   70/  FF0268 :                     ; Video_Update
(1)   71/  FF0268 :                     ; 
(1)   72/  FF0268 :                     ; Copy our RAM reg settings to
(1)   73/  FF0268 :                     ; VDP from $80 to $90
(1)   74/  FF0268 :                     ; 
(1)   75/  FF0268 :                     ; Uses:
(1)   76/  FF0268 :                     ; d4-d5,a4-a5
(1)   77/  FF0268 :                     ; ---------------------------------
(1)   78/  FF0268 :                     
(1)   79/  FF0268 :                     Video_Update:
(1)   80/  FF0268 : 49F8 91A2           		lea	(RAM_VdpRegs).w,a4
(1)   81/  FF026C : 4BF9 00C0 0004      		lea	(vdp_ctrl),a5
(1)   82/  FF0272 : 383C 8000           		move.w	#$8000,d4
(1)   83/  FF0276 : 3A3C 0010           		move.w	#17-1,d5
(1)   84/  FF027A :                     .loop:
(1)   85/  FF027A : 181C                		move.b	(a4)+,d4
(1)   86/  FF027C : 3A84                		move.w	d4,(a5)
(1)   87/  FF027E : D87C 0100           		add.w	#$100,d4
(1)   88/  FF0282 : 51CD FFF6           		dbf	d5,.loop
(1)   89/  FF0286 :                     .exit:
(1)   90/  FF0286 : 4E75                		rts
(1)   91/  FF0288 :                     		
(1)   92/  FF0288 :                     ; --------------------------------------------------------
(1)   93/  FF0288 :                     ; Video_LoadPal
(1)   94/  FF0288 :                     ; Load palette to VDP directly, waits VBLANK
(1)   95/  FF0288 :                     ; 
(1)   96/  FF0288 :                     ; Input:
(1)   97/  FF0288 :                     ; a0 - Palette data
(1)   98/  FF0288 :                     ; d0 - Start at
(1)   99/  FF0288 :                     ; d1 - Num of colors - 1
(1)  100/  FF0288 :                     ; 
(1)  101/  FF0288 :                     ; Uses:
(1)  102/  FF0288 :                     ; a4,d4
(1)  103/  FF0288 :                     ; 
(1)  104/  FF0288 :                     ; Note:
(1)  105/  FF0288 :                     ; It will show dots on screen
(1)  106/  FF0288 :                     ; --------------------------------------------------------
(1)  107/  FF0288 :                     
(1)  108/  FF0288 :                     Video_LoadPal:
(1)  109/  FF0288 : 49F9 00C0 0000      		lea	(vdp_data),a4
(1)  110/  FF028E : 7800                		moveq	#0,d4
(1)  111/  FF0290 : 3800                		move.w	d0,d4
(1)  112/  FF0292 : D844                		add.w	d4,d4
(1)  113/  FF0294 : 0044 C000           		ori.w	#$C000,d4
(1)  114/  FF0298 : 4844                		swap	d4
(1)  115/  FF029A : 2944 0004           		move.l	d4,4(a4)
(1)  116/  FF029E : 3801                		move.w	d1,d4
(1)  117/  FF02A0 : 3A2C 0004           .outv: 		move.w	4(a4),d5
(1)  118/  FF02A4 : 0805 0003           		btst	#bitVint,d5
(1)  119/  FF02A8 : 67F6                		beq.s	.outv
(1)  120/  FF02AA :                     .loop:
(1)  121/  FF02AA : 3898                		move.w	(a0)+,(a4)
(1)  122/  FF02AC : 51CC FFFC           		dbf	d4,.loop
(1)  123/  FF02B0 : 4E75                		rts
(1)  124/  FF02B2 :                     		
(1)  125/  FF02B2 :                     ; --------------------------------------------------------
(1)  126/  FF02B2 :                     ; Video_LoadMap
(1)  127/  FF02B2 :                     ; 
(1)  128/  FF02B2 :                     ; Load map data, Horizontal order
(1)  129/  FF02B2 :                     ; 
(1)  130/  FF02B2 :                     ; a0 - Map data
(1)  131/  FF02B2 :                     ; d0 | LONG - 00|Layer|X|Y, locate(lyr,x,y)  
(1)  132/  FF02B2 :                     ; d1 | LONG - Width|Height (cells),  mapsize(x,y)
(1)  133/  FF02B2 :                     ; d2 | WORD - VRAM
(1)  134/  FF02B2 :                     
(1)  135/  FF02B2 :                     ; Uses:
(1)  136/  FF02B2 :                     ; a4-a5,d4-d7
(1)  137/  FF02B2 :                     ; --------------------------------------------------------
(1)  138/  FF02B2 :                     
(1)  139/  FF02B2 :                     Video_LoadMap:
(1)  140/  FF02B2 : 49F9 00C0 0000      		lea	(vdp_data),a4
(1)  141/  FF02B8 : 6100 025E           		bsr	vid_PickLayer
(1)  142/  FF02BC : 3A01                		move.w	d1,d5		; Start here
(1)  143/  FF02BE :                     .yloop:
(1)  144/  FF02BE : 4845                		swap	d5
(1)  145/  FF02C0 : 2944 0004           		move.l	d4,4(a4)
(1)  146/  FF02C4 : 2E01                		move.l	d1,d7
(1)  147/  FF02C6 : 4847                		swap	d7
(1)  148/  FF02C8 :                     .xloop:
(1)  149/  FF02C8 : 3A18                		move.w	(a0)+,d5
(1)  150/  FF02CA : BA7C FFFF           		cmp.w	#-1,d5
(1)  151/  FF02CE : 6606                		bne.s	.nonull
(1)  152/  FF02D0 : 3A3C 07FF           		move.w	#varNullVram,d5
(1)  153/  FF02D4 : 6002                		bra.s	.cont
(1)  154/  FF02D6 :                     .nonull:
(1)  155/  FF02D6 : DA42                		add.w	d2,d5
(1)  156/  FF02D8 :                     .cont:
(1)  157/  FF02D8 : 4847                		swap	d7
(1)  158/  FF02DA : 1E39 FFFF 91AE      		move.b	(RAM_VdpRegs+$C).l,d7
(1)  159/  FF02E0 : CE7C 0006           		and.w	#%110,d7
(1)  160/  FF02E4 : BE7C 0006           		cmp.w	#%110,d7
(1)  161/  FF02E8 : 660E                		bne.s	.nodble
(1)  162/  FF02EA : 3E05                		move.w	d5,d7
(1)  163/  FF02EC : E24F                		lsr.w	#1,d7
(1)  164/  FF02EE : CE7C 07FF           		and.w	#$7FF,d7
(1)  165/  FF02F2 : CA7C F800           		and.w	#$F800,d5
(1)  166/  FF02F6 : 8A47                		or.w	d7,d5
(1)  167/  FF02F8 :                     .nodble:
(1)  168/  FF02F8 : 4847                		swap	d7
(1)  169/  FF02FA : 3885                		move.w	d5,(a4)
(1)  170/  FF02FC : 51CF FFCA           		dbf	d7,.xloop
(1)  171/  FF0300 : D886                		add.l	d6,d4
(1)  172/  FF0302 : 4845                		swap	d5
(1)  173/  FF0304 : 51CD FFB8           		dbf	d5,.yloop
(1)  174/  FF0308 : 4E75                		rts
(1)  175/  FF030A :                     
(1)  176/  FF030A :                     ; --------------------------------------------------------
(1)  177/  FF030A :                     ; Video_LoadMap_Vert
(1)  178/  FF030A :                     ; 
(1)  179/  FF030A :                     ; Load map data, Vertical order
(1)  180/  FF030A :                     ; 
(1)  181/  FF030A :                     ; a0 - Map data
(1)  182/  FF030A :                     ; d0 | LONG - 00|Lyr|X|Y,  locate(lyr,x,y)
(1)  183/  FF030A :                     ; d1 | LONG - Width|Height (cells),  mapsize(x,y)
(1)  184/  FF030A :                     ; d2 | WORD - VRAM
(1)  185/  FF030A :                     
(1)  186/  FF030A :                     ; Uses:
(1)  187/  FF030A :                     ; a4-a5,d4-d7
(1)  188/  FF030A :                     ; --------------------------------------------------------
(1)  189/  FF030A :                     
(1)  190/  FF030A :                     Video_LoadMap_Vert:
(1)  191/  FF030A : 49F9 00C0 0000      		lea	(vdp_data),a4
(1)  192/  FF0310 : 6100 0206           		bsr	vid_PickLayer
(1)  193/  FF0314 : 2A01                		move.l	d1,d5		; Start here
(1)  194/  FF0316 : 4845                		swap	d5
(1)  195/  FF0318 :                     .xloop:
(1)  196/  FF0318 : 4845                		swap	d5
(1)  197/  FF031A : 2F04                		move.l	d4,-(sp)
(1)  198/  FF031C : 3E01                		move.w	d1,d7
(1)  199/  FF031E : 0839 0002 FFFF 91AE 		btst	#2,(RAM_VdpRegs+$C).l
(1)  200/  FF0326 : 6702                		beq.s	.yloop
(1)  201/  FF0328 : E24F                		lsr.w	#1,d7
(1)  202/  FF032A :                     .yloop:
(1)  203/  FF032A : 2944 0004           		move.l	d4,4(a4)
(1)  204/  FF032E : 3A10                		move.w	(a0),d5
(1)  205/  FF0330 : BA7C FFFF           		cmp.w	#-1,d5
(1)  206/  FF0334 : 6606                		bne.s	.nonull
(1)  207/  FF0336 : 3A3C 07FF           		move.w	#varNullVram,d5
(1)  208/  FF033A : 6002                		bra.s	.cont
(1)  209/  FF033C :                     .nonull:
(1)  210/  FF033C : DA42                		add.w	d2,d5
(1)  211/  FF033E :                     .cont:
(1)  212/  FF033E : 4847                		swap	d7
(1)  213/  FF0340 : D0FC 0002           		adda	#2,a0
(1)  214/  FF0344 : 0839 0002 FFFF 91AE 		btst	#2,(RAM_VdpRegs+$C).l
(1)  215/  FF034C : 6712                		beq.s	.nodble
(1)  216/  FF034E : D0FC 0002           		adda	#2,a0
(1)  217/  FF0352 : 3E05                		move.w	d5,d7
(1)  218/  FF0354 : E24F                		lsr.w	#1,d7
(1)  219/  FF0356 : CE7C 07FF           		and.w	#$7FF,d7
(1)  220/  FF035A : CA7C F800           		and.w	#$F800,d5
(1)  221/  FF035E : 8A47                		or.w	d7,d5
(1)  222/  FF0360 :                     .nodble:
(1)  223/  FF0360 : 4847                		swap	d7
(1)  224/  FF0362 : 3885                		move.w	d5,(a4)
(1)  225/  FF0364 : D886                		add.l	d6,d4
(1)  226/  FF0366 : 51CF FFC2           		dbf	d7,.yloop
(1)  227/  FF036A :                     .outdbl:
(1)  228/  FF036A : 281F                		move.l	(sp)+,d4
(1)  229/  FF036C : D8BC 0002 0000      		add.l	#$20000,d4
(1)  230/  FF0372 : 4845                		swap	d5
(1)  231/  FF0374 : 51CD FFA2           		dbf	d5,.xloop
(1)  232/  FF0378 : 4E75                		rts
(1)  233/  FF037A :                     		
(1)  234/  FF037A :                     ; --------------------------------------------------------
(1)  235/  FF037A :                     ; Video_AutoMap_Vert
(1)  236/  FF037A :                     ; 
(1)  237/  FF037A :                     ; Make automatic map, Vertical order
(1)  238/  FF037A :                     ; 
(1)  239/  FF037A :                     ; MCD: Use this to make a virtual screen
(1)  240/  FF037A :                     ; for Stamps
(1)  241/  FF037A :                     ; 
(1)  242/  FF037A :                     ; d0 | LONG - 00|Lyr|X|Y,  locate(lyr,x,y)
(1)  243/  FF037A :                     ; d1 | LONG - Width|Height (cells),  mapsize(x,y)
(1)  244/  FF037A :                     ; d2 | WORD - VRAM
(1)  245/  FF037A :                     
(1)  246/  FF037A :                     ; Uses:
(1)  247/  FF037A :                     ; a4-a5,d4-d7
(1)  248/  FF037A :                     ; --------------------------------------------------------
(1)  249/  FF037A :                     
(1)  250/  FF037A :                     ; TODO: double interlace
(1)  251/  FF037A :                     Video_AutoMap_Vert:
(1)  252/  FF037A : 49F9 00C0 0000      		lea	(vdp_data),a4
(1)  253/  FF0380 : 6100 0196           		bsr	vid_PickLayer
(1)  254/  FF0384 : 3E02                		move.w	d2,d7		; Start here
(1)  255/  FF0386 : 2A01                		move.l	d1,d5
(1)  256/  FF0388 : 4845                		swap	d5
(1)  257/  FF038A :                     .xloop:
(1)  258/  FF038A : 4845                		swap	d5
(1)  259/  FF038C : 2F04                		move.l	d4,-(sp)
(1)  260/  FF038E : 3A01                		move.w	d1,d5
(1)  261/  FF0390 : 0839 0002 FFFF 91AE 		btst	#2,(RAM_VdpRegs+$C).l
(1)  262/  FF0398 : 6702                		beq.s	.yloop
(1)  263/  FF039A : E24D                		lsr.w	#1,d5
(1)  264/  FF039C :                     .yloop:
(1)  265/  FF039C : 2944 0004           		move.l	d4,4(a4)
(1)  266/  FF03A0 : 3887                		move.w	d7,(a4)
(1)  267/  FF03A2 : DE7C 0001           		add.w	#1,d7
(1)  268/  FF03A6 : D886                		add.l	d6,d4
(1)  269/  FF03A8 : 51CD FFF2           		dbf	d5,.yloop
(1)  270/  FF03AC :                     
(1)  271/  FF03AC : 281F                		move.l	(sp)+,d4
(1)  272/  FF03AE : D8BC 0002 0000      		add.l	#$20000,d4
(1)  273/  FF03B4 : 4845                		swap	d5
(1)  274/  FF03B6 : 51CD FFD2           		dbf	d5,.xloop
(1)  275/  FF03BA : 4E75                		rts
(1)  276/  FF03BC :                     
(1)  277/  FF03BC :                     ; --------------------------------------------------------
(1)  278/  FF03BC :                     ; Video_PrintInit
(1)  279/  FF03BC :                     ; 
(1)  280/  FF03BC :                     ; Load palette and font for printing text
(1)  281/  FF03BC :                     ; --------------------------------------------------------
(1)  282/  FF03BC :                     
(1)  283/  FF03BC :                     Video_PrintInit:
(1)  284/  FF03BC : 41FA 03DE           		lea	ASCII_PAL(pc),a0
(1)  285/  FF03C0 : 7030                		moveq	#$30,d0
(1)  286/  FF03C2 : 323C 000F           		move.w	#$F,d1
(1)  287/  FF03C6 : 6100 FEC0           		bsr	Video_LoadPal
(1)  288/  FF03CA : 203C 00FF 07BC      		move.l	#ASCII_FONT,d0
(1)  289/  FF03D0 : 323C 1000           		move.w	#ASCII_FONT_e-ASCII_FONT,d1
(1)  290/  FF03D4 : 343C 6580           		move.w	#$580|$6000,d2
(1)  291/  FF03D8 : 31C2 9020           		move.w	d2,(RAM_VidPrntVram).w
(1)  292/  FF03DC : 6000 02D0           		bra	Video_LoadArt
(1)  293/  FF03E0 :                     
(1)  294/  FF03E0 :                     ; --------------------------------------------------------
(1)  295/  FF03E0 :                     ; Video_Print
(1)  296/  FF03E0 :                     ; 
(1)  297/  FF03E0 :                     ; Prints string to layer
(1)  298/  FF03E0 :                     ; requires ASCII font
(1)  299/  FF03E0 :                     ; 
(1)  300/  FF03E0 :                     ; a0 - string data
(1)  301/  FF03E0 :                     ; d0 | LONG - 00|Lyr|X|Y, locate(lyr,x,y)
(1)  302/  FF03E0 :                     ; 
(1)  303/  FF03E0 :                     ; Notes:
(1)  304/  FF03E0 :                     ; "//b" - Show BYTE value
(1)  305/  FF03E0 :                     ; "//w" - Show WORD value
(1)  306/  FF03E0 :                     ; "//l" - Show LONG value
(1)  307/  FF03E0 :                     ;   $0A - Next line
(1)  308/  FF03E0 :                     ;   $00 - End of line
(1)  309/  FF03E0 :                     ; 
(1)  310/  FF03E0 :                     ; Uses:
(1)  311/  FF03E0 :                     ; a4-a6,d4-d7
(1)  312/  FF03E0 :                     ; --------------------------------------------------------
(1)  313/  FF03E0 :                     
(1)  314/  FF03E0 :                     Video_Print:
(1)  315/  FF03E0 :                     ; 		movem.l	d3-d7,-(sp)
(1)  316/  FF03E0 :                     ; 		movem.l	a4-a6,-(sp)
(1)  317/  FF03E0 :                     		
(1)  318/  FF03E0 : 4DF9 00C0 0000      		lea	(vdp_data),a6
(1)  319/  FF03E6 : 6100 0130           		bsr	vid_PickLayer
(1)  320/  FF03EA : 4BF8 9022           		lea	(RAM_VidPrntList),a5
(1)  321/  FF03EE :                     .newjump:
(1)  322/  FF03EE : 2D44 0004           		move.l	d4,4(a6)
(1)  323/  FF03F2 : 2A04                		move.l	d4,d5
(1)  324/  FF03F4 :                     .loop:
(1)  325/  FF03F4 : 1E18                		move.b	(a0)+,d7
(1)  326/  FF03F6 : 6772                		beq	.exit
(1)  327/  FF03F8 : 0C07 000A           		cmpi.b	#$A,d7			; $A - next line?
(1)  328/  FF03FC : 6718                		beq.s	.next
(1)  329/  FF03FE : 0C07 005C           		cmpi.b	#$5C,d7			; $27 ("\") special?
(1)  330/  FF0402 : 6716                		beq.s	.special
(1)  331/  FF0404 : 0247 00FF           		andi.w	#$FF,d7
(1)  332/  FF0408 :                     .puttext:
(1)  333/  FF0408 : DE78 9020           		add.w	(RAM_VidPrntVram).w,d7	; VRAM add
(1)  334/  FF040C : 3C87                		move.w	d7,(a6)
(1)  335/  FF040E : DABC 0002 0000      		add.l	#$20000,d5
(1)  336/  FF0414 : 60DE                		bra.s	.loop
(1)  337/  FF0416 :                     ; Next line
(1)  338/  FF0416 :                     .next:
(1)  339/  FF0416 : D886                		add.l	d6,d4
(1)  340/  FF0418 : 60D4                		bra.s	.newjump
(1)  341/  FF041A :                     
(1)  342/  FF041A :                     ; Specials
(1)  343/  FF041A :                     .special:
(1)  344/  FF041A : 1E18                		move.b	(a0)+,d7
(1)  345/  FF041C : 0C07 0062           		cmpi.b	#"b",d7
(1)  346/  FF0420 : 6712                		beq.s	.isbyte
(1)  347/  FF0422 : 0C07 0077           		cmpi.b	#"w",d7
(1)  348/  FF0426 : 671E                		beq.s	.isword
(1)  349/  FF0428 : 0C07 006C           		cmpi.b	#"l",d7
(1)  350/  FF042C : 672A                		beq.s	.islong
(1)  351/  FF042E : 3E3C 005C           		move.w	#"\\",d7			; nothing to do
(1)  352/  FF0432 : 60D4                		bra.s	.puttext
(1)  353/  FF0434 :                     		
(1)  354/  FF0434 :                     	; TEMPORAL VALUES
(1)  355/  FF0434 :                     .isbyte:
(1)  356/  FF0434 : 2AC5                		move.l	d5,(a5)+
(1)  357/  FF0436 : 3AFC 0001           		move.w	#1,(a5)+
(1)  358/  FF043A : DABC 0004 0000      		add.l	#$40000,d5
(1)  359/  FF0440 : 2D45 0004           		move.l	d5,4(a6)
(1)  360/  FF0444 : 60AE                		bra	.loop
(1)  361/  FF0446 :                     .isword:
(1)  362/  FF0446 : 2AC5                		move.l	d5,(a5)+
(1)  363/  FF0448 : 3AFC 0002           		move.w	#2,(a5)+
(1)  364/  FF044C : DABC 0008 0000      		add.l	#$80000,d5
(1)  365/  FF0452 : 2D45 0004           		move.l	d5,4(a6)
(1)  366/  FF0456 : 609C                		bra	.loop
(1)  367/  FF0458 :                     .islong:
(1)  368/  FF0458 : 2AC5                		move.l	d5,(a5)+
(1)  369/  FF045A : 3AFC 0003           		move.w	#3,(a5)+
(1)  370/  FF045E : DABC 0010 0000      		add.l	#$100000,d5
(1)  371/  FF0464 : 2D45 0004           		move.l	d5,4(a6)
(1)  372/  FF0468 : 608A                		bra	.loop
(1)  373/  FF046A :                     .exit:
(1)  374/  FF046A :                     
(1)  375/  FF046A :                     ; --------------------------------------------------------
(1)  376/  FF046A :                     ; Print values
(1)  377/  FF046A :                     ; 
(1)  378/  FF046A :                     ; vvvv vvvv tttt
(1)  379/  FF046A :                     ; v - vdp pos
(1)  380/  FF046A :                     ; t - value type
(1)  381/  FF046A :                     ; --------------------------------------------------------
(1)  382/  FF046A :                     
(1)  383/  FF046A : 7800                		moveq	#0,d4
(1)  384/  FF046C : 7A00                		moveq	#0,d5
(1)  385/  FF046E : 7C00                		moveq	#0,d6
(1)  386/  FF0470 : 4BF8 9022           		lea	(RAM_VidPrntList),a5
(1)  387/  FF0474 :                     .nextv:
(1)  388/  FF0474 : 4A95                		tst.l	(a5)
(1)  389/  FF0476 : 6700 009E           		beq	.nothing
(1)  390/  FF047A :                     
(1)  391/  FF047A :                     	; grab value
(1)  392/  FF047A : 7800                		moveq	#0,d4
(1)  393/  FF047C : 1818                		move.b	(a0)+,d4
(1)  394/  FF047E : E19C                		rol.l	#8,d4
(1)  395/  FF0480 : 1818                		move.b	(a0)+,d4
(1)  396/  FF0482 : E19C                		rol.l	#8,d4
(1)  397/  FF0484 : 1818                		move.b	(a0)+,d4
(1)  398/  FF0486 : E19C                		rol.l	#8,d4
(1)  399/  FF0488 : 1818                		move.b	(a0)+,d4
(1)  400/  FF048A : 2844                		movea.l	d4,a4
(1)  401/  FF048C : 7800                		moveq	#0,d4
(1)  402/  FF048E :                     
(1)  403/  FF048E :                     	; get value
(1)  404/  FF048E : 3C2D 0004           		move.w	4(a5),d6
(1)  405/  FF0492 :                     		
(1)  406/  FF0492 : BC7C 0001           		cmp.w	#1,d6		; byte?
(1)  407/  FF0496 : 660E                		bne.s	.vbyte
(1)  408/  FF0498 : 1814                		move.b	(a4),d4
(1)  409/  FF049A : 2D55 0004           		move.l	(a5),4(a6)
(1)  410/  FF049E : E91C                		rol.b	#4,d4
(1)  411/  FF04A0 : 6158                		bsr.s	.donibl
(1)  412/  FF04A2 : E91C                		rol.b	#4,d4
(1)  413/  FF04A4 : 6154                		bsr.s	.donibl
(1)  414/  FF04A6 :                     .vbyte:
(1)  415/  FF04A6 : BC7C 0002           		cmp.w	#2,d6		; word?
(1)  416/  FF04AA : 661C                		bne.s	.vword
(1)  417/  FF04AC : 1814                		move.b	(a4),d4
(1)  418/  FF04AE : E15C                		rol.w	#8,d4
(1)  419/  FF04B0 : 182C 0001           		move.b	1(a4),d4
(1)  420/  FF04B4 : 2D55 0004           		move.l	(a5),4(a6)
(1)  421/  FF04B8 : E95C                		rol.w	#4,d4
(1)  422/  FF04BA : 613E                		bsr.s	.donibl
(1)  423/  FF04BC : E95C                		rol.w	#4,d4
(1)  424/  FF04BE : 613A                		bsr.s	.donibl
(1)  425/  FF04C0 : E95C                		rol.w	#4,d4
(1)  426/  FF04C2 : 6136                		bsr.s	.donibl
(1)  427/  FF04C4 : E95C                		rol.w	#4,d4
(1)  428/  FF04C6 : 6132                		bsr.s	.donibl
(1)  429/  FF04C8 :                     .vword:
(1)  430/  FF04C8 : BC7C 0003           		cmp.w	#3,d6		; long?
(1)  431/  FF04CC : 6624                		bne.s	.vlong
(1)  432/  FF04CE : 1814                		move.b	(a4),d4
(1)  433/  FF04D0 : E19C                		rol.l	#8,d4
(1)  434/  FF04D2 : 182C 0001           		move.b	1(a4),d4
(1)  435/  FF04D6 : E19C                		rol.l	#8,d4
(1)  436/  FF04D8 : 182C 0002           		move.b	2(a4),d4
(1)  437/  FF04DC : E19C                		rol.l	#8,d4
(1)  438/  FF04DE : 182C 0003           		move.b	3(a4),d4
(1)  439/  FF04E2 : 2D55 0004           		move.l	(a5),4(a6)
(1)  440/  FF04E6 : 3C3C 0007           		move.w	#7,d6
(1)  441/  FF04EA : E99C                .lngloop:	rol.l	#4,d4
(1)  442/  FF04EC : 610C                		bsr.s	.donibl
(1)  443/  FF04EE : 51CE FFFA           		dbf	d6,.lngloop
(1)  444/  FF04F2 :                     .vlong:
(1)  445/  FF04F2 : 429D                		clr.l	(a5)+
(1)  446/  FF04F4 : 425D                		clr.w	(a5)+
(1)  447/  FF04F6 : 6000 FF7C           		bra	.nextv
(1)  448/  FF04FA :                     
(1)  449/  FF04FA :                     ; make nibble byte
(1)  450/  FF04FA :                     .donibl:
(1)  451/  FF04FA : 3A04                		move.w	d4,d5
(1)  452/  FF04FC : 0245 000F           		andi.w	#%1111,d5
(1)  453/  FF0500 : BA3C 000A           		cmp.b	#$A,d5
(1)  454/  FF0504 : 6D04                		blt.s	.lowr
(1)  455/  FF0506 : DA3C 0007           		add.b	#7,d5
(1)  456/  FF050A :                     .lowr:
(1)  457/  FF050A : DA7C 0030           		add.w	#"0",d5
(1)  458/  FF050E : DA78 9020           		add.w	(RAM_VidPrntVram),d5
(1)  459/  FF0512 : 3C85                		move.w	d5,(a6)
(1)  460/  FF0514 : 4E75                		rts
(1)  461/  FF0516 :                     ; exit
(1)  462/  FF0516 :                     .nothing:
(1)  463/  FF0516 :                     ; 		movem.l	(sp)+,a4-a6
(1)  464/  FF0516 :                     ; 		movem.l	(sp)+,d3-d7
(1)  465/  FF0516 : 4E75                		rts
(1)  466/  FF0518 :                     
(1)  467/  FF0518 :                     ; --------------------------------------------------------
(1)  468/  FF0518 :                     ; Shared: pick layer / x pos / y pos and set size
(1)  469/  FF0518 :                     ; --------------------------------------------------------
(1)  470/  FF0518 :                     
(1)  471/  FF0518 :                     vid_PickLayer:
(1)  472/  FF0518 : 2C00                		move.l	d0,d6			; Pick layer
(1)  473/  FF051A : 4846                		swap	d6
(1)  474/  FF051C : 0806 0000           		btst	#0,d6
(1)  475/  FF0520 : 671E                		beq.s	.plawnd
(1)  476/  FF0522 : 1839 FFFF 91A6      		move.b	(RAM_VdpRegs+4).l,d4	; BG
(1)  477/  FF0528 : 3A04                		move.w	d4,d5
(1)  478/  FF052A : E24D                		lsr.w	#1,d5
(1)  479/  FF052C : 0245 0003           		andi.w	#%11,d5
(1)  480/  FF0530 : 4844                		swap	d4
(1)  481/  FF0532 : 3805                		move.w	d5,d4
(1)  482/  FF0534 : 4844                		swap	d4
(1)  483/  FF0536 : 0244 0001           		andi.w	#1,d4
(1)  484/  FF053A : E14C                		lsl.w	#8,d4
(1)  485/  FF053C : EB4C                		lsl.w	#5,d4
(1)  486/  FF053E : 6028                		bra.s	.golyr
(1)  487/  FF0540 :                     .plawnd:
(1)  488/  FF0540 : 1839 FFFF 91A4      		move.b	(RAM_VdpRegs+2).l,d4	; FG
(1)  489/  FF0546 : 0806 0001           		btst	#1,d6
(1)  490/  FF054A : 6706                		beq.s	.nowd
(1)  491/  FF054C : 1839 FFFF 91A5      		move.b	(RAM_VdpRegs+3).l,d4	; WINDOW
(1)  492/  FF0552 :                     .nowd:		
(1)  493/  FF0552 : 3A04                		move.w	d4,d5
(1)  494/  FF0554 : E84D                		lsr.w	#4,d5
(1)  495/  FF0556 : 0245 0003           		andi.w	#%11,d5
(1)  496/  FF055A : 4844                		swap	d4
(1)  497/  FF055C : 3805                		move.w	d5,d4
(1)  498/  FF055E : 4844                		swap	d4
(1)  499/  FF0560 : 0244 000E           		andi.w	#%00001110,d4
(1)  500/  FF0564 : E14C                		lsl.w	#8,d4
(1)  501/  FF0566 : E54C                		lsl.w	#2,d4
(1)  502/  FF0568 :                     .golyr:
(1)  503/  FF0568 : 0044 4000           		ori.w	#$4000,d4
(1)  504/  FF056C : 3A00                		move.w	d0,d5			; Y start pos
(1)  505/  FF056E : 0245 00FF           		andi.w	#$FF,d5			; Y only
(1)  506/  FF0572 : ED4D                		lsl.w	#6,d5			
(1)  507/  FF0574 : 1C38 91B2           		move.b	(RAM_VdpRegs+$10).w,d6
(1)  508/  FF0578 : 0246 0003           		andi.w	#%11,d6
(1)  509/  FF057C : 670A                		beq.s	.thissz
(1)  510/  FF057E : DA45                		add.w	d5,d5			; H64
(1)  511/  FF0580 : 0246 0002           		andi.w	#%10,d6
(1)  512/  FF0584 : 6702                		beq.s	.thissz
(1)  513/  FF0586 : DA45                		add.w	d5,d5			; H128		
(1)  514/  FF0588 :                     .thissz:
(1)  515/  FF0588 : D845                		add.w	d5,d4
(1)  516/  FF058A : 3A00                		move.w	d0,d5
(1)  517/  FF058C : 0245 FF00           		andi.w	#$FF00,d5		; X only
(1)  518/  FF0590 : EE4D                		lsr.w	#7,d5
(1)  519/  FF0592 : D845                		add.w	d5,d4			; X add
(1)  520/  FF0594 : 4844                		swap	d4
(1)  521/  FF0596 : 7C00                		moveq	#0,d6
(1)  522/  FF0598 : 3C3C 0040           		move.w	#$40,d6			; Set jump size
(1)  523/  FF059C : 1A38 91B2           		move.b	(RAM_VdpRegs+$10).w,d5
(1)  524/  FF05A0 : 0245 0003           		andi.w	#%11,d5
(1)  525/  FF05A4 : 670A                		beq.s	.thisszj
(1)  526/  FF05A6 : DC46                		add.w	d6,d6			; H64
(1)  527/  FF05A8 : 0245 0002           		andi.w	#%10,d5
(1)  528/  FF05AC : 6702                		beq.s	.thisszj
(1)  529/  FF05AE : DC46                		add.w	d6,d6			; H128		
(1)  530/  FF05B0 :                     .thisszj:
(1)  531/  FF05B0 : 4846                		swap	d6
(1)  532/  FF05B2 : 4E75                		rts
(1)  533/  FF05B4 :                     		
(1)  534/  FF05B4 :                     ; --------------------------------------------------------
(1)  535/  FF05B4 :                     ; Video_Fill
(1)  536/  FF05B4 :                     ; 
(1)  537/  FF05B4 :                     ; Fill data to VRAM
(1)  538/  FF05B4 :                     ;
(1)  539/  FF05B4 :                     ; d0 | WORD - Fill data
(1)  540/  FF05B4 :                     ; d1 | WORD - Size
(1)  541/  FF05B4 :                     ; d2 | WORD - VRAM
(1)  542/  FF05B4 :                     ; --------------------------------------------------------
(1)  543/  FF05B4 :                     
(1)  544/  FF05B4 :                     Video_Fill:
(1)  545/  FF05B4 : 49F9 00C0 0004      		lea	(vdp_ctrl),a4
(1)  546/  FF05BA :                     		
(1)  547/  FF05BA : 383C 8100           		move.w	#$8100,d4
(1)  548/  FF05BE : 1838 91A3           		move.b	(RAM_VdpRegs+1),d4
(1)  549/  FF05C2 : 08C4 0004           		bset	#bitDmaEnbl,d4
(1)  550/  FF05C6 : 3884                		move.w	d4,(a4)
(1)  551/  FF05C8 : 3814                .dmaw:		move.w	(a4),d4
(1)  552/  FF05CA : 0804 0001           		btst	#bitDma,d4
(1)  553/  FF05CE : 66F8                		bne.s	.dmaw
(1)  554/  FF05D0 : 38BC 8F01           		move.w	#$8F01,(a4)		; Increment $01
(1)  555/  FF05D4 :                     
(1)  556/  FF05D4 :                     	; SIZE
(1)  557/  FF05D4 : 3801                		move.w	d1,d4
(1)  558/  FF05D6 : 2A3C 9400 9300      		move.l	#$94009300,d5
(1)  559/  FF05DC : E24C                		lsr.w	#1,d4
(1)  560/  FF05DE : 1A04                		move.b	d4,d5
(1)  561/  FF05E0 : 4845                		swap	d5
(1)  562/  FF05E2 : E04C                		lsr.w	#8,d4
(1)  563/  FF05E4 : 1A04                		move.b	d4,d5
(1)  564/  FF05E6 : 4845                		swap	d5
(1)  565/  FF05E8 : 2885                		move.l	d5,(a4)
(1)  566/  FF05EA : 38BC 9780           		move.w	#$9780,(a4)		; DMA Fill bit
(1)  567/  FF05EE :                     
(1)  568/  FF05EE :                     	; DESTINATION
(1)  569/  FF05EE : 2802                		move.l	d2,d4
(1)  570/  FF05F0 :                     ; 		lsl.w	#5,d4
(1)  571/  FF05F0 : 3A04                		move.w	d4,d5
(1)  572/  FF05F2 : 0245 3FFF           		andi.w	#$3FFF,d5
(1)  573/  FF05F6 : 0045 4000           		ori.w	#$4000,d5
(1)  574/  FF05FA : 4845                		swap	d5
(1)  575/  FF05FC : 3A04                		move.w	d4,d5
(1)  576/  FF05FE : E04D                		lsr.w	#8,d5
(1)  577/  FF0600 : EC4D                		lsr.w	#6,d5
(1)  578/  FF0602 : 0245 0003           		andi.w	#%11,d5
(1)  579/  FF0606 : 0045 0080           		ori.w	#$80,d5
(1)  580/  FF060A : 2885                		move.l	d5,(a4)
(1)  581/  FF060C : 3940 FFFC           		move.w	d0,-4(a4)
(1)  582/  FF0610 : 3814                .dmawe:		move.w	(a4),d4
(1)  583/  FF0612 : 0804 0001           		btst	#bitDma,d4
(1)  584/  FF0616 : 66F8                		bne.s	.dmawe
(1)  585/  FF0618 :                     
(1)  586/  FF0618 : 38BC 8F02           		move.w	#$8F02,(a4)		; Increment $02
(1)  587/  FF061C : 383C 8100           		move.w	#$8100,d4
(1)  588/  FF0620 : 1838 91A3           		move.b	(RAM_VdpRegs+1),d4
(1)  589/  FF0624 : 3884                		move.w	d4,(a4)
(1)  590/  FF0626 : 4E75                		rts
(1)  591/  FF0628 :                     
(1)  592/  FF0628 :                     ; --------------------------------------------------------
(1)  593/  FF0628 :                     ; Video_Copy
(1)  594/  FF0628 :                     ; 
(1)  595/  FF0628 :                     ; Copy VRAM data to another location
(1)  596/  FF0628 :                     ;
(1)  597/  FF0628 :                     ; d0 | WORD - VRAM Source
(1)  598/  FF0628 :                     ; d1 | WORD - Size
(1)  599/  FF0628 :                     ; d2 | WORD - VRAM Destination
(1)  600/  FF0628 :                     ; --------------------------------------------------------
(1)  601/  FF0628 :                     
(1)  602/  FF0628 :                     Video_Copy:
(1)  603/  FF0628 : 49F9 00C0 0004      		lea	(vdp_ctrl),a4
(1)  604/  FF062E :                     		
(1)  605/  FF062E : 383C 8100           		move.w	#$8100,d4
(1)  606/  FF0632 : 1838 91A3           		move.b	(RAM_VdpRegs+1),d4
(1)  607/  FF0636 : 08C4 0004           		bset	#bitDmaEnbl,d4
(1)  608/  FF063A : 3884                		move.w	d4,(a4)
(1)  609/  FF063C : 3814                .dmaw:		move.w	(a4),d4
(1)  610/  FF063E : 0804 0001           		btst	#bitDma,d4
(1)  611/  FF0642 : 66F8                		bne.s	.dmaw
(1)  612/  FF0644 : 38BC 8F01           		move.w	#$8F01,(a4)		; Increment $01
(1)  613/  FF0648 : 3801                		move.w	d1,d4			; SIZE
(1)  614/  FF064A : 2A3C 9400 9300      		move.l	#$94009300,d5
(1)  615/  FF0650 : E24C                		lsr.w	#1,d4
(1)  616/  FF0652 : 1A04                		move.b	d4,d5
(1)  617/  FF0654 : 4845                		swap	d5
(1)  618/  FF0656 : E04C                		lsr.w	#8,d4
(1)  619/  FF0658 : 1A04                		move.b	d4,d5
(1)  620/  FF065A : 4845                		swap	d5
(1)  621/  FF065C : 2885                		move.l	d5,(a4)
(1)  622/  FF065E : 2A3C 9600 9500      		move.l	#$96009500,d5		; SOURCE
(1)  623/  FF0664 : 3800                		move.w	d0,d4
(1)  624/  FF0666 : 1A04                		move.b	d4,d5
(1)  625/  FF0668 : 4845                		swap	d5
(1)  626/  FF066A : E04C                		lsr.w	#8,d4
(1)  627/  FF066C : 1A04                		move.b	d4,d5
(1)  628/  FF066E : 2885                		move.l	d5,(a4)
(1)  629/  FF0670 : 38BC 97C0           		move.w	#$97C0,(a4)		; DMA Fill bit
(1)  630/  FF0674 : 2802                		move.l	d2,d4			; DESTINATION
(1)  631/  FF0676 :                     ; 		lsl.w	#5,d4
(1)  632/  FF0676 : 3A04                		move.w	d4,d5
(1)  633/  FF0678 : 0245 3FFF           		andi.w	#$3FFF,d5
(1)  634/  FF067C : 0045 4000           		ori.w	#$4000,d5
(1)  635/  FF0680 : 4845                		swap	d5
(1)  636/  FF0682 : 3A04                		move.w	d4,d5
(1)  637/  FF0684 : E04D                		lsr.w	#8,d5
(1)  638/  FF0686 : EC4D                		lsr.w	#6,d5
(1)  639/  FF0688 : 0245 0003           		andi.w	#%11,d5
(1)  640/  FF068C : 0045 00C0           		ori.w	#$C0,d5
(1)  641/  FF0690 : 2885                		move.l	d5,(a4)
(1)  642/  FF0692 : 3940 FFFC           		move.w	d0,-4(a4)
(1)  643/  FF0696 : 3814                .dmawe:		move.w	(a4),d4
(1)  644/  FF0698 : 0804 0001           		btst	#bitDma,d4
(1)  645/  FF069C : 66F8                		bne.s	.dmawe
(1)  646/  FF069E :                     
(1)  647/  FF069E : 38BC 8F02           		move.w	#$8F02,(a4)		; Increment $02
(1)  648/  FF06A2 : 383C 8100           		move.w	#$8100,d4
(1)  649/  FF06A6 : 1838 91A3           		move.b	(RAM_VdpRegs+1),d4
(1)  650/  FF06AA : 3884                		move.w	d4,(a4)
(1)  651/  FF06AC : 4E75                		rts
(1)  652/  FF06AE :                     
(1)  653/  FF06AE :                     
(1)  654/  FF06AE :                     ; ====================================================================
(1)  655/  FF06AE :                     ; --------------------------------------------------------
(1)  656/  FF06AE :                     ; DMA ROM to VDP Transfer, sets RV=1
(1)  657/  FF06AE :                     ; --------------------------------------------------------
(1)  658/  FF06AE :                     
(1)  659/  FF06AE :                     ; --------------------------------------------------------
(1)  660/  FF06AE :                     ; Load graphics using DMA
(1)  661/  FF06AE :                     ;
(1)  662/  FF06AE :                     ; d0 | LONG - Art data
(1)  663/  FF06AE :                     ; d1 | WORD - Size
(1)  664/  FF06AE :                     ; d2 | WORD - VRAM (cell)
(1)  665/  FF06AE :                     ; 
(1)  666/  FF06AE :                     ; Uses:
(1)  667/  FF06AE :                     ; d4-d5,a4
(1)  668/  FF06AE :                     ; --------------------------------------------------------
(1)  669/  FF06AE :                     
(1)  670/  FF06AE :                     Video_LoadArt:
(1)  671/  FF06AE : 3C0F                		move.w	sp,d6
(1)  672/  FF06B0 : 46FC 2700           		move.w	#$2700,sr
(1)  673/  FF06B4 : 49F9 00C0 0004      		lea	(vdp_ctrl),a4
(1)  674/  FF06BA : 383C 8100           		move.w	#$8100,d4
(1)  675/  FF06BE : 1838 91A3           		move.b	(RAM_VdpRegs+1),d4
(1)  676/  FF06C2 : 08C4 0004           		bset	#bitDmaEnbl,d4
(1)  677/  FF06C6 : 3884                		move.w	d4,(a4)
(1)  678/  FF06C8 :                     
(1)  679/  FF06C8 :                     	; SIZE
(1)  680/  FF06C8 : 3801                		move.w	d1,d4
(1)  681/  FF06CA : 2A3C 9400 9300      		move.l	#$94009300,d5
(1)  682/  FF06D0 : E24C                		lsr.w	#1,d4
(1)  683/  FF06D2 : 1A04                		move.b	d4,d5
(1)  684/  FF06D4 : 4845                		swap	d5
(1)  685/  FF06D6 : E04C                		lsr.w	#8,d4
(1)  686/  FF06D8 : 1A04                		move.b	d4,d5
(1)  687/  FF06DA : 4845                		swap	d5
(1)  688/  FF06DC : 2885                		move.l	d5,(a4)
(1)  689/  FF06DE :                     
(1)  690/  FF06DE :                     	; SOURCE
(1)  691/  FF06DE : 2800                		move.l	d0,d4
(1)  692/  FF06E0 : E28C                  		lsr.l	#1,d4
(1)  693/  FF06E2 : 2A3C 9600 9500       		move.l	#$96009500,d5
(1)  694/  FF06E8 : 1A04                 		move.b	d4,d5
(1)  695/  FF06EA : E08C                 		lsr.l	#8,d4
(1)  696/  FF06EC : 4845                 		swap	d5
(1)  697/  FF06EE : 1A04                 		move.b	d4,d5
(1)  698/  FF06F0 : 2885                 		move.l	d5,(a4)
(1)  699/  FF06F2 : 3A3C 9700            		move.w	#$9700,d5
(1)  700/  FF06F6 : E08C                 		lsr.l	#8,d4
(1)  701/  FF06F8 : 1A04                 		move.b	d4,d5
(1)  702/  FF06FA : 3885                 		move.w	d5,(a4)
(1)  703/  FF06FC :                      		
(1)  704/  FF06FC :                     	; DESTINATION
(1)  705/  FF06FC : 3802                		move.w	d2,d4
(1)  706/  FF06FE : C87C 07FF           		and.w	#$7FF,d4
(1)  707/  FF0702 : EB4C                		lsl.w	#5,d4
(1)  708/  FF0704 : 3A04                		move.w	d4,d5
(1)  709/  FF0706 : C8BC 0000 3FE0      		and.l	#$3FE0,d4
(1)  710/  FF070C : 0044 4000           		ori.w	#$4000,d4
(1)  711/  FF0710 : 3884                		move.w	d4,(a4)				; First write
(1)  712/  FF0712 : 33FC 0100 00A1 1100 		move.w	#$0100,(z80_bus).l		; Stop Z80
(1)  713/  FF071A : E04D                		lsr.w	#8,d5
(1)  714/  FF071C : EC4D                		lsr.w	#6,d5
(1)  715/  FF071E : 0245 0003           		andi.w	#%11,d5
(1)  716/  FF0722 : 0045 0080           		ori.w	#$80,d5
(1)  717/  FF0726 :                     .wait:
(1)  718/  FF0726 : 0839 0000 00A1 1100 		btst	#0,(z80_bus).l			; Wait for cpu
(1)  719/  FF072E : 66F6                		bne.s	.wait
(1)  720/  FF0730 : 2800                		move.l	d0,d4
(1)  721/  FF0732 : 4844                		swap	d4
(1)  722/  FF0734 : E04C                		lsr.w	#8,d4
(1)  723/  FF0736 : B83C 00FF           		cmp.b	#$FF,d4
(1)  724/  FF073A : 673A                		beq.s	.from_ram
(1)  725/  FF073C :                     
(1)  726/  FF073C :                     ; 		bsr	Sound_DMA_Pause
(1)  727/  FF073C :                     	; TODO: interrupt both CPUS with a wait flag
(1)  728/  FF073C : 3839 00A1 5106      		move.w	(sysmars_reg+dreqctl).l,d4	; Set RV=1
(1)  729/  FF0742 : 887C 0001           		or.w	#1,d4				; 68k ROM map moves to $000000, $880000/$900000=trash
(1)  730/  FF0746 : 33C4 00A1 5106      		move.w	d4,(sysmars_reg+dreqctl).l
(1)  731/  FF074C : 3F05                 		move.w	d5,-(sp)
(1)  732/  FF074E : 389F                		move.w	(sp)+,(a4)			; Second write, CPU freezes until it DMA ends
(1)  733/  FF0750 : 3839 00A1 5106      		move.w	(sysmars_reg+dreqctl).l,d4	; Set RV=0
(1)  734/  FF0756 : C87C 00FE           		and.w	#%11111110,d4			; 68k ROM map returns to $880000/$900000
(1)  735/  FF075A : 33C4 00A1 5106      		move.w	d4,(sysmars_reg+dreqctl).l
(1)  736/  FF0760 : 33FC 0000 00A1 1100 		move.w	#0,(z80_bus).l
(1)  737/  FF0768 : 383C 8100           		move.w	#$8100,d4
(1)  738/  FF076C : 1838 91A3           		move.b	(RAM_VdpRegs+1),d4
(1)  739/  FF0770 : 3884                		move.w	d4,(a4)
(1)  740/  FF0772 : 46C6                		move.w	d6,sr
(1)  741/  FF0774 :                     ; 		bsr	Sound_DMA_Resume
(1)  742/  FF0774 : 4E75                		rts
(1)  743/  FF0776 :                     .from_ram:
(1)  744/  FF0776 : 3F05                 		move.w	d5,-(sp)
(1)  745/  FF0778 : 389F                		move.w	(sp)+,(a4)			; Second write
(1)  746/  FF077A : 383C 8100           		move.w	#$8100,d4
(1)  747/  FF077E : 1838 91A3           		move.b	(RAM_VdpRegs+1),d4
(1)  748/  FF0782 : 3884                		move.w	d4,(a4)
(1)  749/  FF0784 : 46C6                		move.w	d6,sr
(1)  750/  FF0786 : 4E75                		rts
(1)  751/  FF0788 :                     
(1)  752/  FF0788 :                     ; ====================================================================
(1)  753/  FF0788 :                     ; --------------------------------------------------------
(1)  754/  FF0788 :                     ; Video data
(1)  755/  FF0788 :                     ; --------------------------------------------------------
(1)  756/  FF0788 :                     
(1)  757/  FF0788 :                     list_vdpregs:
(1)  758/  FF0788 : 04                  		dc.b $04			; HBlank int off, HV Counter on
(1)  759/  FF0789 : 44                  		dc.b $44			; Display ON, VBlank int off
(1)  760/  FF078A : 30                  		dc.b (($C000)>>10)		; ForeGrd at VRAM $C000 (%00xxx000)
(1)  761/  FF078B : 34                  		dc.b (($D000)>>10)		; Window  at VRAM $D000 (%00xxxxy0)
(1)  762/  FF078C : 07                  		dc.b (($E000)>>13)		; BackGrd at VRAM $E000 (%00000xxx)
(1)  763/  FF078D : 7C                  		dc.b (($F800)>>9)		; Sprites at VRAM $F800 (%0xxxxxxy)
(1)  764/  FF078E : 00                  		dc.b $00			; Nothing
(1)  765/  FF078F : 00                  		dc.b $00			; Background color: 0
(1)  766/  FF0790 : 00                  		dc.b $00			; Nothing
(1)  767/  FF0791 : 00                  		dc.b $00			; Nothing
(1)  768/  FF0792 : 00                  		dc.b $00			; HInt value
(1)  769/  FF0793 : 00                  		dc.b (%000|%00)			; No ExtInt, Scroll: VSCR:full HSCR:full
(1)  770/  FF0794 : 81                  		dc.b $81			; H40, No shadow mode, Normal resolution
(1)  771/  FF0795 : 3F                  		dc.b (($FC00)>>10)		; HScroll at VRAM $FC00 (%00xxxxxx)
(1)  772/  FF0796 : 00                  		dc.b $00			; Nothing
(1)  773/  FF0797 : 02                  		dc.b $02			; VDP Auto increment by $02
(1)  774/  FF0798 : 01                  		dc.b (%00<<4)|%01		; Layer size: V32 H64
(1)  775/  FF0799 : 00                  		dc.b $00
(1)  776/  FF079A : 00                  		dc.b $00
(1)  777/  FF079B :                     		align 2
(1)  778/  FF079C :                     ASCII_PAL:	;binclude "engine/shared/ascii_pal.bin"
(1)  779/  FF079C : 0000 0EEE 0CCC 0AAA 		dc.w $0000,$0EEE,$0CCC,$0AAA,$0888,$0444,$000E,$0008
                    0888 0444 000E 0008 
(1)  780/  FF07AC : 00EE 0088 00E0 0080 		dc.w $00EE,$0088,$00E0,$0080,$0E00,$0800,$0000,$0000
                    0E00 0800 0000 0000 
(1)  781/  FF07BC :                     ASCII_PAL_e:
(1)  782/  FF07BC :                     ASCII_FONT:	binclude "system/md/data/font.bin"
(1)  783/  FF17BC :                     ASCII_FONT_e:
(1)  784/  FF17BC :                     		align 2
(1)  785/  FF17BC :                     
      30/  FF17BC :                     		include	"system/md/system.asm"
(1)    1/  FF17BC :                     ; ====================================================================
(1)    2/  FF17BC :                     ; ----------------------------------------------------------------
(1)    3/  FF17BC :                     ; System
(1)    4/  FF17BC :                     ; ----------------------------------------------------------------
(1)    5/  FF17BC :                     
(1)    6/  FF17BC :                     ; --------------------------------------------------------
(1)    7/  FF17BC :                     ; Init System
(1)    8/  FF17BC :                     ; 
(1)    9/  FF17BC :                     ; Uses:
(1)   10/  FF17BC :                     ; a0-a2,d0-d1
(1)   11/  FF17BC :                     ; --------------------------------------------------------
(1)   12/  FF17BC :                     
(1)   13/  FF17BC :                     System_Init:
(1)   14/  FF17BC : 46FC 2700           		move.w	#$2700,sr		; Disable interrupts
(1)   15/  FF17C0 : 40E7                		move.w	sr,-(sp)
(1)   16/  FF17C2 : 33FC 0100 00A1 1100 		move.w	#$0100,(z80_bus).l	; Stop Z80
(1)   17/  FF17CA :                     .wait:
(1)   18/  FF17CA : 0839 0000 00A1 1100 		btst	#0,(z80_bus).l		; Wait for it
(1)   19/  FF17D2 : 66F6                		bne.s	.wait
(1)   20/  FF17D4 : 7040                		moveq	#%01000000,d0		; Init ports, TH=1
(1)   21/  FF17D6 : 13C0 00A1 0009      		move.b	d0,(sys_ctrl_1).l	; Controller 1
(1)   22/  FF17DC : 13C0 00A1 000B      		move.b	d0,(sys_ctrl_2).l	; Controller 2
(1)   23/  FF17E2 : 13C0 00A1 000D      		move.b	d0,(sys_ctrl_3).l	; Modem
(1)   24/  FF17E8 : 33FC 0000 00A1 1100 		move.w	#0,(z80_bus).l		; Enable Z80
(1)   25/  FF17F0 : 41F8 91BA           		lea	(RAM_InputData),a0	; Clear input data buffer
(1)   26/  FF17F4 : 323C 0006           		move.w	#sizeof_input-1/2,d1
(1)   27/  FF17F8 : 7000                		moveq	#0,d0
(1)   28/  FF17FA :                     .clrinput:
(1)   29/  FF17FA : 30FC 0000           		move.w	#0,(a0)+
(1)   30/  FF17FE : 51C9 FFFA           		dbf	d1,.clrinput
(1)   31/  FF1802 : 303C 4EF9           		move.w	#$4EF9,d0		; Set JMP opcode for the Hblank/VBlank jumps
(1)   32/  FF1806 : 33C0 FFFF 9802       		move.w	d0,(RAM_MdMarsVInt).l
(1)   33/  FF180C : 33C0 FFFF 9808      		move.w	d0,(RAM_MdMarsHInt).l
(1)   34/  FF1812 : 203C 5625 5769      		move.l	#$56255769,d0		; Set these random values
(1)   35/  FF1818 : 223C 9511 6102      		move.l	#$95116102,d1
(1)   36/  FF181E : 23C0 FFFF 97F6      		move.l	d0,(RAM_SysRandVal).l
(1)   37/  FF1824 : 23C1 FFFF 97FA      		move.l	d1,(RAM_SysRandSeed).l
(1)   38/  FF182A : 203C 00FF 1B70      		move.l	#VInt_Default,d0	; Set default ints
(1)   39/  FF1830 : 223C 00FF 1B88      		move.l	#Hint_Default,d1
(1)   40/  FF1836 : 6100 013E           		bsr	System_SetInts
(1)   41/  FF183A : 46DF                		move.w	(sp)+,sr
(1)   42/  FF183C : 4E75                		rts
(1)   43/  FF183E :                     
(1)   44/  FF183E :                     ; ====================================================================
(1)   45/  FF183E :                     ; --------------------------------------------------------
(1)   46/  FF183E :                     ; System_Input (VBLANK ONLY)
(1)   47/  FF183E :                     ; 
(1)   48/  FF183E :                     ; Uses:
(1)   49/  FF183E :                     ; d4-d6,a4-a5
(1)   50/  FF183E :                     ; --------------------------------------------------------
(1)   51/  FF183E :                     
(1)   52/  FF183E :                     ; TODO: check if it still requires to turn OFF the Z80
(1)   53/  FF183E :                     ; while reading the controller
(1)   54/  FF183E :                     
(1)   55/  FF183E :                     System_Input:
(1)   56/  FF183E :                     ; 		move.w	#$0100,(z80_bus).l	; Stop Z80
(1)   57/  FF183E :                     .wait:
(1)   58/  FF183E :                     ; 		btst	#0,(z80_bus).l		; Wait for it
(1)   59/  FF183E :                     ; 		bne.s	.wait
(1)   60/  FF183E : 49F9 00A1 0003      		lea	($A10003),a4
(1)   61/  FF1844 : 4BF8 91BA           		lea	(RAM_InputData),a5
(1)   62/  FF1848 : 6108                		bsr.s	.this_one
(1)   63/  FF184A : D8FC 0002           		adda	#2,a4
(1)   64/  FF184E : DAFC 0006           		adda	#sizeof_input,a5
(1)   65/  FF1852 :                     ; 		bsr.s	.this_one
(1)   66/  FF1852 :                     ; 		move.w	#0,(z80_bus).l
(1)   67/  FF1852 :                     ; 		rts
(1)   68/  FF1852 :                     
(1)   69/  FF1852 :                     ; --------------------------------------------------------	
(1)   70/  FF1852 :                     ; Read port
(1)   71/  FF1852 :                     ; 
(1)   72/  FF1852 :                     ; a4 - Current port
(1)   73/  FF1852 :                     ; a5 - Output data
(1)   74/  FF1852 :                     ; --------------------------------------------------------
(1)   75/  FF1852 :                     
(1)   76/  FF1852 :                     .this_one:
(1)   77/  FF1852 : 6100 00D4           		bsr	.pick_id
(1)   78/  FF1856 : 1A84                		move.b	d4,pad_id(a5)
(1)   79/  FF1858 : B87C 000F           		cmp.w	#$F,d4
(1)   80/  FF185C : 670E                		beq.s	.exit
(1)   81/  FF185E : C87C 000F           		and.w	#$F,d4
(1)   82/  FF1862 : D844                		add.w	d4,d4
(1)   83/  FF1864 : 3A3B 400C           		move.w	.list(pc,d4.w),d5
(1)   84/  FF1868 : 4EFB 5008           		jmp	.list(pc,d5.w)
(1)   85/  FF186C :                     .exit:
(1)   86/  FF186C : 422D 0001           		clr.b	pad_ver(a5)
(1)   87/  FF1870 : 4E75                		rts
(1)   88/  FF1872 :                     
(1)   89/  FF1872 :                     ; --------------------------------------------------------
(1)   90/  FF1872 :                     ; Grab ID
(1)   91/  FF1872 :                     ; --------------------------------------------------------
(1)   92/  FF1872 :                     
(1)   93/  FF1872 : FFFA                .list:		dc.w .exit-.list	; $0
(1)   94/  FF1874 : FFFA                		dc.w .exit-.list
(1)   95/  FF1876 : FFFA                		dc.w .exit-.list
(1)   96/  FF1878 : FFFA                		dc.w .exit-.list
(1)   97/  FF187A : FFFA                		dc.w .exit-.list	; $4
(1)   98/  FF187C : FFFA                		dc.w .exit-.list
(1)   99/  FF187E : FFFA                		dc.w .exit-.list
(1)  100/  FF1880 : FFFA                		dc.w .exit-.list
(1)  101/  FF1882 : FFFA                		dc.w .exit-.list	; $8
(1)  102/  FF1884 : FFFA                		dc.w .exit-.list
(1)  103/  FF1886 : FFFA                		dc.w .exit-.list
(1)  104/  FF1888 : FFFA                		dc.w .exit-.list
(1)  105/  FF188A : FFFA                		dc.w .exit-.list	; $C
(1)  106/  FF188C : 0020                		dc.w .id_0D-.list
(1)  107/  FF188E : FFFA                		dc.w .exit-.list
(1)  108/  FF1890 : FFFA                		dc.w .exit-.list
(1)  109/  FF1892 :                     
(1)  110/  FF1892 :                     ; --------------------------------------------------------
(1)  111/  FF1892 :                     ; ID $0D
(1)  112/  FF1892 :                     ; 
(1)  113/  FF1892 :                     ; Normal controller, Old or New
(1)  114/  FF1892 :                     ; --------------------------------------------------------
(1)  115/  FF1892 :                     
(1)  116/  FF1892 :                     .id_0D:
(1)  117/  FF1892 : 18BC 0040           		move.b	#$40,(a4)	; Show CB|RLDU
(1)  118/  FF1896 : 4E71                		nop
(1)  119/  FF1898 : 4E71                		nop
(1)  120/  FF189A : 18BC 0000           		move.b	#$00,(a4)	; Show SA|RLDU
(1)  121/  FF189E : 4E71                		nop
(1)  122/  FF18A0 : 4E71                		nop
(1)  123/  FF18A2 : 18BC 0040           		move.b	#$40,(a4)	; Show CB|RLDU
(1)  124/  FF18A6 : 4E71                		nop
(1)  125/  FF18A8 : 4E71                		nop
(1)  126/  FF18AA : 18BC 0000           		move.b	#$00,(a4)	; Show SA|RLDU
(1)  127/  FF18AE : 4E71                		nop
(1)  128/  FF18B0 : 4E71                		nop
(1)  129/  FF18B2 : 18BC 0040           		move.b	#$40,(a4)	; 6 button responds
(1)  130/  FF18B6 : 4E71                		nop
(1)  131/  FF18B8 : 4E71                		nop
(1)  132/  FF18BA : 1814                		move.b	(a4),d4		; Grab ??|MXYZ
(1)  133/  FF18BC : 18BC 0000            		move.b	#$00,(a4)
(1)  134/  FF18C0 : 4E71                  		nop
(1)  135/  FF18C2 : 4E71                  		nop
(1)  136/  FF18C4 : 1C14                 		move.b	(a4),d6		; Type: $03 old, $0F new
(1)  137/  FF18C6 : 18BC 0040            		move.b	#$40,(a4)
(1)  138/  FF18CA : 4E71                 		nop
(1)  139/  FF18CC : 4E71                 		nop
(1)  140/  FF18CE : CC7C 000F           		and.w	#$F,d6
(1)  141/  FF18D2 : E44E                		lsr.w	#2,d6
(1)  142/  FF18D4 : CC7C 0001           		and.w	#1,d6
(1)  143/  FF18D8 : 6716                		beq.s	.oldpad
(1)  144/  FF18DA : 4604                		not.b	d4
(1)  145/  FF18DC : C87C 000F            		and.w	#%1111,d4
(1)  146/  FF18E0 : 1A2D 0002           		move.b	on_hold(a5),d5
(1)  147/  FF18E4 : B905                		eor.b	d4,d5
(1)  148/  FF18E6 : 1B44 0002           		move.b	d4,on_hold(a5)
(1)  149/  FF18EA : CA04                		and.b	d4,d5
(1)  150/  FF18EC : 1B45 0004           		move.b	d5,on_press(a5)
(1)  151/  FF18F0 :                     .oldpad:
(1)  152/  FF18F0 : 1B46 0001           		move.b	d6,pad_ver(a5)
(1)  153/  FF18F4 :                     		
(1)  154/  FF18F4 : 18BC 0000           		move.b	#$00,(a4)	; Show SA??|RLDU
(1)  155/  FF18F8 : 4E71                		nop
(1)  156/  FF18FA : 4E71                		nop
(1)  157/  FF18FC : 1814                		move.b	(a4),d4
(1)  158/  FF18FE : E50C                		lsl.b	#2,d4
(1)  159/  FF1900 : C83C 00C0           		and.b	#%11000000,d4
(1)  160/  FF1904 : 18BC 0040           		move.b	#$40,(a4)	; Show ??CB|RLDU
(1)  161/  FF1908 : 4E71                		nop
(1)  162/  FF190A : 4E71                		nop
(1)  163/  FF190C : 1A14                		move.b	(a4),d5
(1)  164/  FF190E : CA3C 003F           		and.b	#%00111111,d5
(1)  165/  FF1912 : 8805                		or.b	d5,d4
(1)  166/  FF1914 : 4604                		not.b	d4
(1)  167/  FF1916 : 1A2D 0003           		move.b	on_hold+1(a5),d5
(1)  168/  FF191A : B905                		eor.b	d4,d5
(1)  169/  FF191C : 1B44 0003           		move.b	d4,on_hold+1(a5)
(1)  170/  FF1920 : CA04                		and.b	d4,d5
(1)  171/  FF1922 : 1B45 0005           		move.b	d5,on_press+1(a5)
(1)  172/  FF1926 : 4E75                		rts
(1)  173/  FF1928 :                     		
(1)  174/  FF1928 :                     ; --------------------------------------------------------
(1)  175/  FF1928 :                     ; Grab ID
(1)  176/  FF1928 :                     ; --------------------------------------------------------
(1)  177/  FF1928 :                     
(1)  178/  FF1928 :                     .pick_id:
(1)  179/  FF1928 : 7800                		moveq	#0,d4
(1)  180/  FF192A : 18BC 0070           		move.b	#%01110000,(a4)		; TH=1,TR=1,TL=1
(1)  181/  FF192E : 4E71                		nop
(1)  182/  FF1930 : 4E71                		nop
(1)  183/  FF1932 : 610A                		bsr.s	.read
(1)  184/  FF1934 : 18BC 0030           		move.b	#%00110000,(a4)		; TH=0,TR=1,TL=1
(1)  185/  FF1938 : 4E71                		nop
(1)  186/  FF193A : 4E71                		nop
(1)  187/  FF193C : D844                		add.w	d4,d4
(1)  188/  FF193E :                     
(1)  189/  FF193E :                     
(1)  190/  FF193E :                     .read:
(1)  191/  FF193E : 1A14                		move.b	(a4),d5
(1)  192/  FF1940 : 1C05                		move.b	d5,d6
(1)  193/  FF1942 : CC3C 000C           		and.b	#$C,d6
(1)  194/  FF1946 : 6702                		beq.s	.step_1
(1)  195/  FF1948 : 5244                		addq.w	#1,d4
(1)  196/  FF194A :                     .step_1:
(1)  197/  FF194A : D844                		add.w	d4,d4
(1)  198/  FF194C : 1C05                		move.b	d5,d6
(1)  199/  FF194E : CC7C 0003           		and.w	#3,d6
(1)  200/  FF1952 : 6702                		beq.s	.step_2
(1)  201/  FF1954 : 5244                		addq.w	#1,d4
(1)  202/  FF1956 :                     .step_2:
(1)  203/  FF1956 : 4E75                		rts
(1)  204/  FF1958 :                     
(1)  205/  FF1958 :                     ; --------------------------------------------------------
(1)  206/  FF1958 :                     ; System_Random
(1)  207/  FF1958 :                     ; 
(1)  208/  FF1958 :                     ; Set random value
(1)  209/  FF1958 :                     ; 
(1)  210/  FF1958 :                     ; Output:
(1)  211/  FF1958 :                     ; d0 | LONG
(1)  212/  FF1958 :                     ; --------------------------------------------------------
(1)  213/  FF1958 :                     
(1)  214/  FF1958 :                     ; TODO: rewrite this
(1)  215/  FF1958 :                     System_Random:
(1)  216/  FF1958 : 2A38 97FA           		move.l	(RAM_SysRandSeed),d5
(1)  217/  FF195C : 2838 97F6           		move.l	(RAM_SysRandVal),d4
(1)  218/  FF1960 : E39D                		rol.l	#1,d5
(1)  219/  FF1962 : E284                		asr.l	#1,d4
(1)  220/  FF1964 : D885                		add.l	d5,d4
(1)  221/  FF1966 : 23C5 FFFF 97FA      		move.l	d5,(RAM_SysRandSeed).l
(1)  222/  FF196C : 23C4 FFFF 97F6      		move.l	d4,(RAM_SysRandVal).l
(1)  223/  FF1972 : 2004                		move.l	d4,d0
(1)  224/  FF1974 : 4E75                		rts
(1)  225/  FF1976 :                     		
(1)  226/  FF1976 :                     ; --------------------------------------------------------
(1)  227/  FF1976 :                     ; System_SetInts
(1)  228/  FF1976 :                     ;
(1)  229/  FF1976 :                     ; Set new interrputs
(1)  230/  FF1976 :                     ;
(1)  231/  FF1976 :                     ; d0 | LONG - VBlank
(1)  232/  FF1976 :                     ; d1 | LONG - HBlank
(1)  233/  FF1976 :                     ;
(1)  234/  FF1976 :                     ; Uses:
(1)  235/  FF1976 :                     ; d4
(1)  236/  FF1976 :                     ;
(1)  237/  FF1976 :                     ; Notes:
(1)  238/  FF1976 :                     ; writing $00 or a negative number will skip change
(1)  239/  FF1976 :                     ; to the interrupt pointer
(1)  240/  FF1976 :                     ; --------------------------------------------------------
(1)  241/  FF1976 :                     
(1)  242/  FF1976 :                     System_SetInts:
(1)  243/  FF1976 : 2800                		move.l	d0,d4
(1)  244/  FF1978 : 670E                		beq.s	.novint
(1)  245/  FF197A : 6B0C                		bmi.s	.novint
(1)  246/  FF197C : 88BC 0088 0000      		or.l	#$880000,d4
(1)  247/  FF1982 : 23C4 FFFF 9804       		move.l	d4,(RAM_MdMarsVInt+2).l
(1)  248/  FF1988 :                     .novint:
(1)  249/  FF1988 : 2801                		move.l	d1,d4
(1)  250/  FF198A : 670E                		beq.s	.nohint
(1)  251/  FF198C : 6B0C                		bmi.s	.nohint
(1)  252/  FF198E : 88BC 0088 0000      		or.l	#$880000,d4
(1)  253/  FF1994 : 23C4 FFFF 980A      		move.l	d4,(RAM_MdMarsHInt+2).l
(1)  254/  FF199A :                     .nohint:
(1)  255/  FF199A : 4E75                		rts
(1)  256/  FF199C :                     
(1)  257/  FF199C :                     ; --------------------------------------------------------
(1)  258/  FF199C :                     ; System_SramInit
(1)  259/  FF199C :                     ; 
(1)  260/  FF199C :                     ; Init save data
(1)  261/  FF199C :                     ; 
(1)  262/  FF199C :                     ; Uses:
(1)  263/  FF199C :                     ; a4,d4-d5
(1)  264/  FF199C :                     ; --------------------------------------------------------
(1)  265/  FF199C :                     
(1)  266/  FF199C :                     ; TODO: Check if RV bit is needed here...
(1)  267/  FF199C :                     System_SramInit:
(1)  268/  FF199C : 13FC 0001 00A1 30F1 		move.b	#1,(md_bank_sram).l
(1)  269/  FF19A4 : 49F9 0020 0001      		lea	($200001).l,a4
(1)  270/  FF19AA : 7800                		moveq	#0,d4
(1)  271/  FF19AC : 3A3C 1FFF           		move.w	#($4000/2)-1,d5
(1)  272/  FF19B0 :                     .initsave:
(1)  273/  FF19B0 : 1884                		move.b	d4,(a4)
(1)  274/  FF19B2 : D8FC 0002           		adda	#2,a4
(1)  275/  FF19B6 : 51CD FFF8           		dbf	d5,.initsave
(1)  276/  FF19BA : 13FC 0000 00A1 30F1 		move.b	#0,(md_bank_sram).l
(1)  277/  FF19C2 : 4E75                		rts
(1)  278/  FF19C4 :                     
(1)  279/  FF19C4 :                     ; --------------------------------------------------------
(1)  280/  FF19C4 :                     ; System_VSync
(1)  281/  FF19C4 :                     ; 
(1)  282/  FF19C4 :                     ; Waits for VBlank manually
(1)  283/  FF19C4 :                     ; 
(1)  284/  FF19C4 :                     ; Uses:
(1)  285/  FF19C4 :                     ; d4
(1)  286/  FF19C4 :                     ; --------------------------------------------------------
(1)  287/  FF19C4 :                     
(1)  288/  FF19C4 :                     System_VSync:
(1)  289/  FF19C4 : 3839 00C0 0004      		move.w	(vdp_ctrl),d4
(1)  290/  FF19CA : 0804 0003           		btst	#bitVint,d4
(1)  291/  FF19CE : 67F4                		beq.s	System_VSync
(1)  292/  FF19D0 : 6100 FE6C           		bsr	System_Input
(1)  293/  FF19D4 :                     ; 		bsr	Sound_Update
(1)  294/  FF19D4 : 06B9 0000 0001 FFFF 		add.l	#1,(RAM_FrameCount).l
                    97F2                
(1)  295/  FF19DE : 3839 00C0 0004      .inside:	move.w	(vdp_ctrl),d4
(1)  296/  FF19E4 : 0804 0003           		btst	#bitVint,d4
(1)  297/  FF19E8 : 66F4                		bne.s	.inside
(1)  298/  FF19EA : 4E75                		rts
(1)  299/  FF19EC :                     
(1)  300/  FF19EC :                     ; --------------------------------------------------------
(1)  301/  FF19EC :                     ; System_JumpRamCode
(1)  302/  FF19EC :                     ;
(1)  303/  FF19EC :                     ; Transfer user code to RAM and jump to it.
(1)  304/  FF19EC :                     ;
(1)  305/  FF19EC :                     ; Input:
(1)  306/  FF19EC :                     ; d0 - Location of the RAM code
(1)  307/  FF19EC :                     ; --------------------------------------------------------
(1)  308/  FF19EC :                     
(1)  309/  FF19EC :                     System_JumpRamCode:
(1)  310/  FF19EC : 80BC 0088 0000      		or.l	#$880000,d0
(1)  311/  FF19F2 : 2040                		move.l	d0,a0
(1)  312/  FF19F4 : 43F9 00FF 1B8A      		lea	(RAMCODE_USER),a1
(1)  313/  FF19FA : 3E3C 3FFF           		move.w	#$4000-1,d7
(1)  314/  FF19FE :                     .copyme2:
(1)  315/  FF19FE : 12D8                		move.b	(a0)+,(a1)+
(1)  316/  FF1A00 : 51CF FFFC           		dbf	d7,.copyme2
(1)  317/  FF1A04 : 4EF9 00FF 1B8A      		jmp	(RAMCODE_USER).l
(1)  318/  FF1A0A :                     
(1)  319/  FF1A0A :                     ; ====================================================================
(1)  320/  FF1A0A :                     ; --------------------------------------------------------
(1)  321/  FF1A0A :                     ; 32X Communication, using CMD interrupt on both SH2s
(1)  322/  FF1A0A :                     ;
(1)  323/  FF1A0A :                     ; ARGUMENTS (d0-d7) MUST BE LONGWORDS (move.l) OR MOVEQ's
(1)  324/  FF1A0A :                     ; d0 IS ALWAYS A JUMP POINTER IN SH2's AREA
(1)  325/  FF1A0A :                     ;
(1)  326/  FF1A0A :                     ; Uses comm8,comm10,comm12, shared for both SH2s
(1)  327/  FF1A0A :                     ; --------------------------------------------------------
(1)  328/  FF1A0A :                     
(1)  329/  FF1A0A :                     ; ------------------------------------------------
(1)  330/  FF1A0A :                     ; Add new task to the list
(1)  331/  FF1A0A :                     ; ------------------------------------------------
(1)  332/  FF1A0A :                     
(1)  333/  FF1A0A :                     System_MdMars_MstAddTask:
(1)  334/  FF1A0A : 41F8 93D2           		lea	(RAM_MdMarsTskM).w,a0
(1)  335/  FF1A0E : 43F8 980E           		lea	(RAM_MdMarsTCntM).w,a1
(1)  336/  FF1A12 : 6000 00C4           		bra	sysMdMars_instask
(1)  337/  FF1A16 :                     
(1)  338/  FF1A16 :                     System_MdMars_SlvAddTask:
(1)  339/  FF1A16 : 41F8 95D2           		lea	(RAM_MdMarsTskS).w,a0
(1)  340/  FF1A1A : 43F8 9810           		lea	(RAM_MdMarsTCntS).w,a1
(1)  341/  FF1A1E : 6000 00B8           		bra	sysMdMars_instask
(1)  342/  FF1A22 :                     
(1)  343/  FF1A22 :                     ; ------------------------------------------------
(1)  344/  FF1A22 :                     ; Single task
(1)  345/  FF1A22 :                     ; ------------------------------------------------
(1)  346/  FF1A22 :                     
(1)  347/  FF1A22 :                     System_MdMars_MstTask:
(1)  348/  FF1A22 : 41F8 97D2           		lea	(RAM_MdMarsTsSgl),a0
(1)  349/  FF1A26 : 43F9 00A1 512E      		lea	(sysmars_reg+comm14),a1
(1)  350/  FF1A2C : 48D0 00FF           		movem.l	d0-d7,(a0)
(1)  351/  FF1A30 : 303C 0020           		move.w	#(MAX_MDTSKARG*4),d0
(1)  352/  FF1A34 : 7201                		moveq	#1,d1
(1)  353/  FF1A36 : 7400                		moveq	#0,d2
(1)  354/  FF1A38 : 6000 00B0           		bra	sysMdMars_Transfer
(1)  355/  FF1A3C :                     
(1)  356/  FF1A3C :                     System_MdMars_SlvTask:
(1)  357/  FF1A3C : 41F8 97D2           		lea	(RAM_MdMarsTsSgl),a0
(1)  358/  FF1A40 : 43F9 00A1 512F      		lea	(sysmars_reg+comm15),a1
(1)  359/  FF1A46 : 48D0 00FF           		movem.l	d0-d7,(a0)
(1)  360/  FF1A4A : 303C 0020           		move.w	#(MAX_MDTSKARG*4),d0
(1)  361/  FF1A4E : 7201                		moveq	#1,d1
(1)  362/  FF1A50 : 7401                		moveq	#1,d2
(1)  363/  FF1A52 : 6000 0096           		bra	sysMdMars_Transfer
(1)  364/  FF1A56 :                     
(1)  365/  FF1A56 :                     ; ------------------------------------------------
(1)  366/  FF1A56 :                     ; Queued tasks
(1)  367/  FF1A56 :                     ; ------------------------------------------------
(1)  368/  FF1A56 :                     
(1)  369/  FF1A56 :                     System_MdMars_MstSendAll:
(1)  370/  FF1A56 : 41F8 93D2           		lea	(RAM_MdMarsTskM),a0
(1)  371/  FF1A5A : 43F9 00A1 512E      		lea	(sysmars_reg+comm14),a1
(1)  372/  FF1A60 : 3038 980E           		move.w	(RAM_MdMarsTCntM).w,d0
(1)  373/  FF1A64 : 4278 980E           		clr.w	(RAM_MdMarsTCntM).w
(1)  374/  FF1A68 : 7201                		moveq	#1,d1
(1)  375/  FF1A6A : 7400                		moveq	#0,d2
(1)  376/  FF1A6C : 607C                		bra	sysMdMars_Transfer
(1)  377/  FF1A6E :                     
(1)  378/  FF1A6E :                     System_MdMars_SlvSendAll:
(1)  379/  FF1A6E : 41F8 95D2           		lea	(RAM_MdMarsTskS),a0
(1)  380/  FF1A72 : 43F9 00A1 512F      		lea	(sysmars_reg+comm15),a1
(1)  381/  FF1A78 : 3038 9810           		move.w	(RAM_MdMarsTCntS).w,d0
(1)  382/  FF1A7C : 4278 9810           		clr.w	(RAM_MdMarsTCntS).w
(1)  383/  FF1A80 : 7201                		moveq	#1,d1
(1)  384/  FF1A82 : 7401                		moveq	#1,d2
(1)  385/  FF1A84 : 6064                		bra.s	sysMdMars_Transfer
(1)  386/  FF1A86 :                     
(1)  387/  FF1A86 :                     System_MdMars_MstSendDrop:
(1)  388/  FF1A86 : 41F8 93D2           		lea	(RAM_MdMarsTskM),a0
(1)  389/  FF1A8A : 43F9 00A1 512E      		lea	(sysmars_reg+comm14),a1
(1)  390/  FF1A90 : 3038 980E           		move.w	(RAM_MdMarsTCntM).w,d0
(1)  391/  FF1A94 : 7201                		moveq	#1,d1
(1)  392/  FF1A96 : 7400                		moveq	#0,d2
(1)  393/  FF1A98 : 4E71                		nop
(1)  394/  FF1A9A : 4E71                		nop
(1)  395/  FF1A9C : 1E11                		move.b	(a1),d7
(1)  396/  FF1A9E : CE7C 0080           		and.w	#$80,d7
(1)  397/  FF1AA2 : 6702                		beq.s	.go_m
(1)  398/  FF1AA4 : 4E75                		rts
(1)  399/  FF1AA6 : 4278 980E           .go_m:		clr.w	(RAM_MdMarsTCntM).w
(1)  400/  FF1AAA : 603E                		bra	sysMdMars_Transfer
(1)  401/  FF1AAC :                     
(1)  402/  FF1AAC :                     System_MdMars_SlvSendDrop:
(1)  403/  FF1AAC : 41F8 95D2           		lea	(RAM_MdMarsTskS),a0
(1)  404/  FF1AB0 : 43F9 00A1 512F      		lea	(sysmars_reg+comm15),a1
(1)  405/  FF1AB6 : 3038 9810           		move.w	(RAM_MdMarsTCntS).w,d0
(1)  406/  FF1ABA : 7201                		moveq	#1,d1
(1)  407/  FF1ABC : 7401                		moveq	#1,d2
(1)  408/  FF1ABE : 4E71                		nop
(1)  409/  FF1AC0 : 4E71                		nop
(1)  410/  FF1AC2 : 1E11                		move.b	(a1),d7
(1)  411/  FF1AC4 : CE7C 0080           		and.w	#$80,d7
(1)  412/  FF1AC8 : 6704                		beq.s	.go_s
(1)  413/  FF1ACA : 7EFF                		moveq	#-1,d7
(1)  414/  FF1ACC : 4E75                		rts
(1)  415/  FF1ACE : 4278 9810           .go_s:		clr.w	(RAM_MdMarsTCntS).w
(1)  416/  FF1AD2 : 6116                		bsr	sysMdMars_Transfer
(1)  417/  FF1AD4 : 7E00                		moveq	#0,d7
(1)  418/  FF1AD6 : 4E75                		rts
(1)  419/  FF1AD8 :                     		
(1)  420/  FF1AD8 :                     ; a0 - task pointer and args
(1)  421/  FF1AD8 :                     ; a1 - task list counter
(1)  422/  FF1AD8 :                     sysMdMars_instask:
(1)  423/  FF1AD8 : 0C51 0200           		cmp.w	#(MAX_MDTSKARG*MAX_MDTASKS)*4,(a1)
(1)  424/  FF1ADC : 6C0A                		bge.s	.ran_out
(1)  425/  FF1ADE : D0D1                		adda.w	(a1),a0
(1)  426/  FF1AE0 : 48D0 00FF           		movem.l	d0-d7,(a0)		; Set variables to RAM (d0 is the label to jump)
(1)  427/  FF1AE4 : 0651 0020           		add.w	#MAX_MDTSKARG*4,(a1)
(1)  428/  FF1AE8 :                     .ran_out:
(1)  429/  FF1AE8 : 4E75                		rts
(1)  430/  FF1AEA :                     
(1)  431/  FF1AEA :                     ; ------------------------------------------------
(1)  432/  FF1AEA :                     ; sysMdMars_Transfer
(1)  433/  FF1AEA :                     ; 
(1)  434/  FF1AEA :                     ; a0 - Data to transfer
(1)  435/  FF1AEA :                     ; a1 - Status byte from the target CPU
(1)  436/  FF1AEA :                     ; d0 - Num of LONGS(4bytes) to transfer
(1)  437/  FF1AEA :                     ; d1 - Transfer type ID
(1)  438/  FF1AEA :                     ; d2 - CMD Interrupt bitset value
(1)  439/  FF1AEA :                     ; 	($00-Master/$01-Slave)
(1)  440/  FF1AEA :                     ; ------------------------------------------------
(1)  441/  FF1AEA :                     
(1)  442/  FF1AEA :                     sysMdMars_Transfer:
(1)  443/  FF1AEA : 4E71                		nop
(1)  444/  FF1AEC : 4E71                		nop
(1)  445/  FF1AEE : 1811                		move.b	(a1),d4
(1)  446/  FF1AF0 : C87C 0080           		and.w	#$80,d4
(1)  447/  FF1AF4 : 66F4                		bne.s	sysMdMars_Transfer
(1)  448/  FF1AF6 : 49F9 00A1 5100      		lea	(sysmars_reg),a4
(1)  449/  FF1AFC : 40C5                		move.w	sr,d5
(1)  450/  FF1AFE : 46FC 2700           		move.w	#$2700,sr		; Disable interrupts
(1)  451/  FF1B02 : 47EC 0028           		lea	comm8(a4),a3		; comm transfer method	
(1)  452/  FF1B06 : 1681                		move.b	d1,(a3)			; Set MD task ID
(1)  453/  FF1B08 : 177C 0001 0001      		move.b	#$01,1(a3)		; Set SH as busy first
(1)  454/  FF1B0E : 382C 0002           		move.w	standby(a4),d4		; Request CMD interrupt
(1)  455/  FF1B12 : 05C4                		bset	d2,d4
(1)  456/  FF1B14 : 3944 0002           		move.w	d4,standby(a4)
(1)  457/  FF1B18 : 382C 0002           .wait_cmd:	move.w	standby(a4),d4		; CMD cleared?
(1)  458/  FF1B1C : 0504                		btst    d2,d4
(1)  459/  FF1B1E : 66F8                		bne.s   .wait_cmd
(1)  460/  FF1B20 :                     .loop:
(1)  461/  FF1B20 : 0C2B 0002 0001      		cmpi.b	#2,1(a3)		; SH ready?
(1)  462/  FF1B26 : 66F8                		bne.s	.loop
(1)  463/  FF1B28 : 3801                		move.w	d1,d4
(1)  464/  FF1B2A : 887C 0080           		or.w	#$80,d4
(1)  465/  FF1B2E : 1684                		move.b	d4,(a3)			; MD is busy
(1)  466/  FF1B30 : 4A40                		tst.w	d0
(1)  467/  FF1B32 : 671E                		beq.s	.exit
(1)  468/  FF1B34 : 6B1C                		bmi.s	.exit
(1)  469/  FF1B36 : 2810                		move.l	(a0),d4
(1)  470/  FF1B38 : 4298                		clr.l	(a0)+
(1)  471/  FF1B3A : 3744 0004           		move.w	d4,4(a3)
(1)  472/  FF1B3E : 4844                		swap	d4
(1)  473/  FF1B40 : 3744 0002           		move.w	d4,2(a3)
(1)  474/  FF1B44 : 3801                		move.w	d1,d4
(1)  475/  FF1B46 : 887C 0040           		or.w	#$40,d4
(1)  476/  FF1B4A : 1684                		move.b	d4,(a3)			; MD is ready
(1)  477/  FF1B4C : 907C 0004           		sub.w	#4,d0
(1)  478/  FF1B50 : 60CE                		bra.s	.loop
(1)  479/  FF1B52 :                     .exit:	
(1)  480/  FF1B52 : 16BC 0000           		move.b	#0,(a3)			; MD finished
(1)  481/  FF1B56 : 46C5                		move.w	d5,sr
(1)  482/  FF1B58 :                     .mid_write:
(1)  483/  FF1B58 : 4E75                		rts
(1)  484/  FF1B5A :                     
(1)  485/  FF1B5A :                     ; --------------------------------------------------------
(1)  486/  FF1B5A :                     ; Initialize current screen mode
(1)  487/  FF1B5A :                     ; --------------------------------------------------------
(1)  488/  FF1B5A :                     
(1)  489/  FF1B5A :                     Mode_Init:
(1)  490/  FF1B5A : 6100 E6BE           		bsr	Video_Clear
(1)  491/  FF1B5E : 49F8 8800           		lea	(RAM_ModeBuff),a4
(1)  492/  FF1B62 : 3A3C 03FF           		move.w	#(MAX_MDERAM/2)-1,d5
(1)  493/  FF1B66 : 7800                		moveq	#0,d4
(1)  494/  FF1B68 :                     .clr:
(1)  495/  FF1B68 : 38C4                		move.w	d4,(a4)+
(1)  496/  FF1B6A : 51CD FFFC           		dbf	d5,.clr
(1)  497/  FF1B6E : 4E75                		rts
(1)  498/  FF1B70 :                     		
(1)  499/  FF1B70 :                     ; ====================================================================
(1)  500/  FF1B70 :                     ; ----------------------------------------------------------------
(1)  501/  FF1B70 :                     ; Default interrupts
(1)  502/  FF1B70 :                     ; ----------------------------------------------------------------
(1)  503/  FF1B70 :                     
(1)  504/  FF1B70 :                     ; --------------------------------------------------------
(1)  505/  FF1B70 :                     ; VBlank
(1)  506/  FF1B70 :                     ; --------------------------------------------------------
(1)  507/  FF1B70 :                     
(1)  508/  FF1B70 :                     VInt_Default:
(1)  509/  FF1B70 : 48E7 FFFE           		movem.l	d0-a6,-(sp)
(1)  510/  FF1B74 : 6100 FCC8           		bsr	System_Input
(1)  511/  FF1B78 :                     ; 		bsr	Sound_Update
(1)  512/  FF1B78 : 06B9 0000 0001 FFFF 		add.l	#1,(RAM_FrameCount).l
                    97F2                
(1)  513/  FF1B82 : 4CDF 7FFF           		movem.l	(sp)+,d0-a6		
(1)  514/  FF1B86 : 4E73                		rte
(1)  515/  FF1B88 :                     
(1)  516/  FF1B88 :                     ; --------------------------------------------------------
(1)  517/  FF1B88 :                     ; HBlank
(1)  518/  FF1B88 :                     ; --------------------------------------------------------
(1)  519/  FF1B88 :                     
(1)  520/  FF1B88 :                     HInt_Default:
(1)  521/  FF1B88 : 4E73                		rte
(1)  522/  FF1B8A :                     		
(1)  523/  FF1B8A :                     ; ====================================================================
(1)  524/  FF1B8A :                     ; ----------------------------------------------------------------
(1)  525/  FF1B8A :                     ; System data
(1)  526/  FF1B8A :                     ; ----------------------------------------------------------------
(1)  527/  FF1B8A :                     
(1)  528/  FF1B8A :                     ; Stuff like Sinewave data for MD will go here.
(1)  529/  FF1B8A :                     
      35/  FF1B8A :                     RAMCODE_USER:
      36/    24D4 :                     		dephase
      37/    24D4 :                     
      38/    24D4 :                     MdRamCode_end:
      39/    24D4 :                     		align 2
      40/    24D4 :                     
      41/    24D4 :                     ; ====================================================================
      42/    24D4 :                     ; ----------------------------------------------------------------
      43/    24D4 :                     ; Z80 code (read once)
      44/    24D4 :                     ; ----------------------------------------------------------------
      45/    24D4 :                     
      46/    24D4 :                     		align $80
      47/    2500 :                     Z80_CODE:
      48/    2500 :                     		include "system/md/z80.asm"
(1)    1/    2500 :                     ; --------------------------------------------------------
(1)    2/    2500 :                     ; GEMA sound driver, inspired by GEMS
(1)    3/    2500 :                     ;
(1)    4/    2500 :                     ; WARNING: The sample playback has to be sync'd manually
(1)    5/    2500 :                     ; on any code change, DAC sample rate is 16000hz base
(1)    6/    2500 :                     ; --------------------------------------------------------
(1)    7/    2500 :                     
(1)    8/    2500 :                     		cpu Z80			; Set Z80 here
(1)    9/       0 :                     		phase 0			; And set PC to 0
(1)   10/       0 :                     
(1)   11/       0 :                     ; --------------------------------------------------------
(1)   12/       0 :                     ; Structs
(1)   13/       0 :                     ;
(1)   14/       0 :                     ; NOTE: struct doesn't work properly here. use
(1)   15/       0 :                     ; equs instead
(1)   16/       0 :                     ; --------------------------------------------------------
(1)   17/       0 :                     
(1)   18/       0 :                     ; trkBuff struct
(1)   19/       0 :                     ; LIMIT: 10h bytes
(1)   20/       0 : =0H                 trk_romBlk	equ 0			; 24-bit base block data
(1)   21/       0 : =3H                 trk_romPatt	equ 3			; 24-bit base patt data
(1)   22/       0 : =6H                 trk_romIns	equ 6			; 24-bit ROM instrument pointers
(1)   23/       0 : =9H                 trk_romPattRd	equ 9			; same but for reading
(1)   24/       0 : =CH                 trk_Read	equ 12			; Current track position (in cache)
(1)   25/       0 : =EH                 trk_Rows	equ 14			; Current track length
(1)   26/       0 : =10H                trk_Halfway	equ 16			; Only 00h or 80h
(1)   27/       0 : =11H                trk_currBlk	equ 17			; Current block
(1)   28/       0 : =12H                trk_setBlk	equ 18			; Start on this block
(1)   29/       0 : =13H                trk_status	equ 19			; %ERSx xxxx | E-enabled / R-Init or Restart track
(1)   30/       0 :                     					;	       S-sfx mode
(1)   31/       0 : =14H                trk_tickTmr	equ 20			; Ticks timer
(1)   32/       0 : =15H                trk_tickSet	equ 21			; Ticks set for this track
(1)   33/       0 :                     
(1)   34/       0 :                     ; chnBuff
(1)   35/       0 :                     ; 8 bytes
(1)   36/       0 : =0H                 chnl_Chip	equ 0			; Channel chip: etti iiii | e-enable t-type i-chip channel
(1)   37/       0 : =1H                 chnl_Type	equ 1			; Current type
(1)   38/       0 : =2H                 chnl_Note	equ 2
(1)   39/       0 : =3H                 chnl_Ins	equ 3
(1)   40/       0 : =4H                 chnl_Vol	equ 4
(1)   41/       0 : =5H                 chnl_EffId	equ 5
(1)   42/       0 : =6H                 chnl_EffArg	equ 6
(1)   43/       0 : =7H                 chnl_Status	equ 7			; 000e uuuu | p-priority overwrite, u-update bits from Tracker
(1)   44/       0 :                     
(1)   45/       0 :                     ; --------------------------------------------------------
(1)   46/       0 :                     ; Variables
(1)   47/       0 :                     ; --------------------------------------------------------
(1)   48/       0 :                     
(1)   49/       0 : =2H                 MAX_TRKS	equ	2		; Max tracks to read
(1)   50/       0 : =12H                MAX_TRKCHN	equ	18		; Max internal tracker channels
(1)   51/       0 :                     
(1)   52/       0 :                     ; To brute force DAC playback
(1)   53/       0 :                     ; on or off
(1)   54/       0 : =8H                 zopcEx		equ	08h
(1)   55/       0 : =0H                 zopcNop		equ	00h
(1)   56/       0 : =C9H                zopcRet		equ 	0C9h
(1)   57/       0 : =D9H                zopcExx		equ	0D9h		; (dac_me ONLY)
(1)   58/       0 : =F5H                zopcPushAf	equ	0F5h		; (dac_fill ONLY)
(1)   59/       0 :                     
(1)   60/       0 :                     ; PSG external control
(1)   61/       0 : =0H                 COM		equ	0
(1)   62/       0 : =4H                 LEV		equ	4
(1)   63/       0 : =8H                 ATK		equ	8
(1)   64/       0 : =CH                 DKY		equ	12
(1)   65/       0 : =10H                SLV		equ	16
(1)   66/       0 : =14H                RRT		equ	20
(1)   67/       0 : =18H                MODE		equ	24
(1)   68/       0 : =1CH                DTL		equ	28
(1)   69/       0 : =20H                DTH		equ	32
(1)   70/       0 : =24H                ALV		equ	36
(1)   71/       0 : =28H                FLG		equ	40
(1)   72/       0 : =2CH                TMR		equ	44
(1)   73/       0 :                     
(1)   74/       0 :                     ; ====================================================================
(1)   75/       0 :                     ; --------------------------------------------------------
(1)   76/       0 :                     ; Code starts here
(1)   77/       0 :                     ; --------------------------------------------------------
(1)   78/       0 :                     
(1)   79/       0 : F3                  		di			; Disable interrputs
(1)   80/       1 : ED 56               		im	1		; Interrupt mode 1
(1)   81/       3 : 31 00 20            		ld	sp,2000h	; Set stack at the end of Z80
(1)   82/       6 : 18 36               		jr	z80_init	; Jump to z80_init
(1)   83/       8 :                     
(1)   84/       8 :                     ; --------------------------------------------------------
(1)   85/       8 :                     
(1)   86/       8 : 00 00               wave_Start	dw 0;TEST_WAV&0FFFFh	; START: 68k direct pointer ($00xxxxxx)
(1)   87/       A : 00                  		db 0;TEST_WAV>>16&0FFh
(1)   88/       B : 00 00               wave_Len	dw 0;(TEST_WAV_E-TEST_WAV)&0FFFFh
(1)   89/       D : 00                  		db 0;(TEST_WAV_E-TEST_WAV)>>16
(1)   90/       E : 00 00               wave_Loop	dw 0
(1)   91/      10 : 00                  		db 0
(1)   92/      11 : 00 01               wave_Pitch	dw 100h			; 01.00h
(1)   93/      13 : 04                  wave_Flags	db 100b			; WAVE playback flags (%10x: 1 loop / 0 no loop)
(1)   94/      14 : 00 00               currTrkBlkHd	dw 0
(1)   95/      16 : 00 00               currTrkData	dw 0
(1)   96/      18 : 00 00               currInsData	dw 0
(1)   97/      1A : 00 00               tickFlag	dw 0			; Tick flag from VBlank, Read as (tickFlag+1) for reading/reseting
(1)   98/      1C : 00                  tickCnt		db 0			; Tick counter (PUT THIS TAG AFTER tickFlag)
(1)   99/      1D : CC 00               sbeatPtck	dw 204			; Sub beats per tick (8frac), default is 120bpm
(1)  100/      1F : 00 00               sbeatAcc	dw 0			; Accumulates ^^ each tick to track sub beats
(1)  101/      21 : 00                  currTickBits	db 0			; Current Tick/Tempo bitflags (000000BTb B-beat, T-tick)
(1)  102/      22 : 00 00 00            dDacPntr	db 0,0,0		; WAVE play current ROM position
(1)  103/      25 : 00 00 00            dDacCntr	db 0,0,0		; WAVE play length counter
(1)  104/      28 : 00                  dDacFifoMid	db 0			; WAVE play halfway refill flag (00h/80h)
(1)  105/      29 : 00                  x68ksrclsb	db 0			; transferRom temporal LSB
(1)  106/      2A : 00                  x68ksrcmid	db 0			; transferRom temporal MID
(1)  107/      2B : 00                  commZRead	db 0			; read pointer (here)
(1)  108/      2C : 00                  commZWrite	db 0			; cmd fifo wptr (from 68k)
(1)  109/      2D : 00                  commZRomBlk	db 0			; 68k ROM block flag
(1)  110/      2E : 00                  commZRomRd	db 0			; Z80 is reading ROM bit
(1)  111/      2F : 00 00 00            psgHatMode	db 0,0,0		; noise mode bits + linked channel
(1)  112/      32 : 00 00               currTblSrch	dw 0
(1)  113/      34 : 00                  reqSampl	db 0			; DAC play request
(1)  114/      35 :                     
(1)  115/      35 :                     ; --------------------------------------------------------
(1)  116/      35 :                     ; Z80 Interrupt at 0038h
(1)  117/      35 :                     ;
(1)  118/      35 :                     ; Sets the TICK flag
(1)  119/      35 :                     ; --------------------------------------------------------
(1)  120/      35 :                     
(1)  121/      35 : (MACRO)             		org 0038h		; Align to 0038h
(1)  121/      35 : 00                                                  db 0
(1)  121/      36 : 00                                                  db 0
(1)  121/      37 : 00                                                  db 0
(1)  121/      38 :                     
(1)  122/      38 : ED 73 1A 00         		ld	(tickFlag),sp	; Use sp to set TICK flag (xx1F, check for tickFlag+1)
(1)  123/      3C : F3                  		di			; Disable interrupt until next request
(1)  124/      3D : C9                  		ret
(1)  125/      3E :                     
(1)  126/      3E :                     ; --------------------------------------------------------
(1)  127/      3E :                     ; Initilize
(1)  128/      3E :                     ; --------------------------------------------------------
(1)  129/      3E :                     
(1)  130/      3E :                     z80_init:
(1)  131/      3E : CD 31 0B            		call	gema_init	; Initilize VBLANK sound driver
(1)  132/      41 : FB                  		ei
(1)  133/      42 :                     
(1)  134/      42 :                     ; --------------------------------------------------------
(1)  135/      42 :                     ; MAIN LOOP
(1)  136/      42 :                     ; --------------------------------------------------------
(1)  137/      42 :                     
(1)  138/      42 :                     drv_loop:
(1)  139/      42 : CD 88 0E            		call	dac_me
(1)  140/      45 : CD AF 0B            		call	check_tick	; Check for tick on VBlank
(1)  141/      48 : CD 9C 0E            		call	dac_fill
(1)  142/      4B : CD 88 0E            		call	dac_me
(1)  143/      4E :                     
(1)  144/      4E :                     	; Check for tick and tempo
(1)  145/      4E : 06 00               		ld	b,0		; b - Reset current flags (beat|tick)
(1)  146/      50 : 3A 1C 00            		ld	a,(tickCnt)
(1)  147/      53 : D6 01               		sub	1
(1)  148/      55 : 38 0B               		jr	c,.noticks
(1)  149/      57 : 32 1C 00            		ld	(tickCnt),a
(1)  150/      5A : CD F0 0C            		call	psg_env		; Process PSG volume and freqs manually
(1)  151/      5D : CD AF 0B            		call	check_tick	; Check for another tick
(1)  152/      60 : 06 01               		ld 	b,01b		; Set TICK (01b) flag, and clear BEAT
(1)  153/      62 :                     .noticks:
(1)  154/      62 : CD 88 0E            		call	dac_me
(1)  155/      65 : 3A 20 00            		ld	a,(sbeatAcc+1)	; check beat counter (scaled by tempo)
(1)  156/      68 : D6 01               		sub	1
(1)  157/      6A : 38 08               		jr	c,.nobeats
(1)  158/      6C : 32 20 00            		ld	(sbeatAcc+1),a	; 1/24 beat passed.
(1)  159/      6F : CB C8               		set	1,b		; Set BEAT (10b) flag
(1)  160/      71 : CD 88 0E            		call	dac_me
(1)  161/      74 :                     .nobeats:
(1)  162/      74 : 78                  		ld	a,b
(1)  163/      75 : B7                  		or	a
(1)  164/      76 : 28 12               		jr	z,.neither
(1)  165/      78 :                     ; 		call	dac_me
(1)  166/      78 : 32 21 00            		ld	(currTickBits),a; Save BEAT/TICK bits
(1)  167/      7B :                     ; 		call	doenvelope	; TODO: probably not doing this...
(1)  168/      7B : CD AF 0B            		call	check_tick
(1)  169/      7E : CD E0 01            		call	playonchip	; Set channels to their respective sound chips
(1)  170/      81 : CD AF 0B            		call	check_tick
(1)  171/      84 : CD 64 07            		call	updtrack	; Update track data
(1)  172/      87 : CD AF 0B            		call	check_tick
(1)  173/      8A :                     .neither:
(1)  174/      8A :                     ; 		call	mars_scomm
(1)  175/      8A :                     ; 		call	dac_me
(1)  176/      8A :                     
(1)  177/      8A :                     .next_cmd:
(1)  178/      8A : CD 9C 0E            		call	dac_fill
(1)  179/      8D : CD 88 0E            		call	dac_me
(1)  180/      90 : 3A 2C 00            		ld	a,(commZWrite)
(1)  181/      93 : 47                  		ld	b,a
(1)  182/      94 : 3A 2B 00            		ld	a,(commZRead)
(1)  183/      97 : B8                  		cp	b
(1)  184/      98 : CA 42 00            		jp	z,drv_loop
(1)  185/      9B : CD 86 0B            		call	get_cmdbyte
(1)  186/      9E : FE FF               		cp	-1			; Read -1 (Start of command)
(1)  187/      A0 : C2 42 00            		jp	nz,drv_loop
(1)  188/      A3 : CD 86 0B            		call	get_cmdbyte		; Read cmd number
(1)  189/      A6 : 87                  		add	a,a
(1)  190/      A7 : 21 B9 00            		ld	hl,.list
(1)  191/      AA : 16 00               		ld	d,0
(1)  192/      AC : 5F                  		ld	e,a
(1)  193/      AD : 19                  		add	hl,de
(1)  194/      AE : CD 9C 0E            		call	dac_fill
(1)  195/      B1 : CD 88 0E            		call	dac_me
(1)  196/      B4 : 7E                  		ld	a,(hl)
(1)  197/      B5 : 23                  		inc	hl
(1)  198/      B6 : 66                  		ld	h,(hl)
(1)  199/      B7 : 6F                  		ld	l,a
(1)  200/      B8 : E9                  		jp	(hl)
(1)  201/      B9 :                     .list:
(1)  202/      B9 : 04 01               		dw .cmnd_trkplay	; $00
(1)  203/      BB : FF 00               		dw .cmnd_0
(1)  204/      BD : FF 00               		dw .cmnd_0
(1)  205/      BF : FF 00               		dw .cmnd_0
(1)  206/      C1 : FF 00               		dw .cmnd_0		; $04
(1)  207/      C3 : FF 00               		dw .cmnd_0
(1)  208/      C5 : FF 00               		dw .cmnd_0
(1)  209/      C7 : FF 00               		dw .cmnd_0
(1)  210/      C9 : FF 00               		dw .cmnd_0		; $08
(1)  211/      CB : FF 00               		dw .cmnd_0
(1)  212/      CD : FF 00               		dw .cmnd_0
(1)  213/      CF : FF 00               		dw .cmnd_0
(1)  214/      D1 : FF 00               		dw .cmnd_0		; $0C
(1)  215/      D3 : FF 00               		dw .cmnd_0
(1)  216/      D5 : FF 00               		dw .cmnd_0
(1)  217/      D7 : FF 00               		dw .cmnd_0
(1)  218/      D9 : FF 00               		dw .cmnd_0		; $10
(1)  219/      DB : FF 00               		dw .cmnd_0
(1)  220/      DD : FF 00               		dw .cmnd_0
(1)  221/      DF : FF 00               		dw .cmnd_0
(1)  222/      E1 : FF 00               		dw .cmnd_0		; $14
(1)  223/      E3 : FF 00               		dw .cmnd_0
(1)  224/      E5 : FF 00               		dw .cmnd_0
(1)  225/      E7 : FF 00               		dw .cmnd_0
(1)  226/      E9 : FF 00               		dw .cmnd_0		; $18
(1)  227/      EB : FF 00               		dw .cmnd_0
(1)  228/      ED : FF 00               		dw .cmnd_0
(1)  229/      EF : FF 00               		dw .cmnd_0
(1)  230/      F1 : FF 00               		dw .cmnd_0		; $1C
(1)  231/      F3 : FF 00               		dw .cmnd_0
(1)  232/      F5 : FF 00               		dw .cmnd_0
(1)  233/      F7 : FF 00               		dw .cmnd_0
(1)  234/      F9 : FF 00               		dw .cmnd_0		; $20
(1)  235/      FB : 5D 01               		dw .cmnd_wav_set	; $21
(1)  236/      FD : C7 01               		dw .cmnd_wav_pitch	; $22
(1)  237/      FF :                     
(1)  238/      FF :                     ; --------------------------------------------------------
(1)  239/      FF :                     ; Command list
(1)  240/      FF :                     ; --------------------------------------------------------
(1)  241/      FF :                     
(1)  242/      FF :                     .cmnd_0:
(1)  243/      FF : 18 FE               		jr	$
(1)  244/     101 : C3 8A 00            		jp	.next_cmd
(1)  245/     104 :                     
(1)  246/     104 :                     ; --------------------------------------------------------
(1)  247/     104 :                     ; $01 - change current wave pitch
(1)  248/     104 :                     ; --------------------------------------------------------
(1)  249/     104 :                     
(1)  250/     104 :                     ; Slot
(1)  251/     104 :                     ; Ticks
(1)  252/     104 :                     ; 24-bit patt data
(1)  253/     104 :                     ; 24-bit block data
(1)  254/     104 :                     
(1)  255/     104 :                     .cmnd_trkplay:
(1)  256/     104 : CD 86 0B            		call	get_cmdbyte		; Get slot position
(1)  257/     107 : FD 21 00 18         		ld	iy,trkBuff
(1)  258/     10B : 11 00 00            		ld	de,0			; Get $0x00
(1)  259/     10E : 57                  		ld	d,a
(1)  260/     10F : FD 19               		add	iy,de
(1)  261/     111 : CD 86 0B            		call	get_cmdbyte		; Get ticks
(1)  262/     114 : FD 77 15            		ld	(iy+trk_tickSet),a
(1)  263/     117 : CD 86 0B            		call	get_cmdbyte		; Pattern data
(1)  264/     11A : FD 77 03            		ld	(iy+trk_romPatt),a
(1)  265/     11D : CD 86 0B            		call	get_cmdbyte
(1)  266/     120 : FD 77 04            		ld	(iy+(trk_romPatt+1)),a
(1)  267/     123 : CD 86 0B            		call	get_cmdbyte
(1)  268/     126 : FD 77 05            		ld	(iy+(trk_romPatt+2)),a
(1)  269/     129 : CD 86 0B            		call	get_cmdbyte		; Block data
(1)  270/     12C : FD 77 00            		ld	(iy+trk_romBlk),a
(1)  271/     12F : CD 86 0B            		call	get_cmdbyte
(1)  272/     132 : FD 77 01            		ld	(iy+(trk_romBlk+1)),a
(1)  273/     135 : CD 86 0B            		call	get_cmdbyte
(1)  274/     138 : FD 77 02            		ld	(iy+(trk_romBlk+2)),a
(1)  275/     13B : CD 86 0B            		call	get_cmdbyte		; Instrument data
(1)  276/     13E : FD 77 06            		ld	(iy+trk_romIns),a
(1)  277/     141 : CD 86 0B            		call	get_cmdbyte
(1)  278/     144 : FD 77 07            		ld	(iy+(trk_romIns+1)),a
(1)  279/     147 : CD 86 0B            		call	get_cmdbyte
(1)  280/     14A : FD 77 08            		ld	(iy+(trk_romIns+2)),a
(1)  281/     14D : 3E 01               		ld	a,1
(1)  282/     14F : FD 77 14            		ld	(iy+trk_tickTmr),a
(1)  283/     152 : FD 7E 13            		ld	a,(iy+trk_status)
(1)  284/     155 : F6 C0               		or	0C0h			; Set Enable + REFILL flags
(1)  285/     157 : FD 77 13            		ld	(iy+trk_status),a
(1)  286/     15A : C3 8A 00            		jp	.next_cmd
(1)  287/     15D :                     
(1)  288/     15D :                     ; --------------------------------------------------------
(1)  289/     15D :                     ; $21 - change current wave pitch
(1)  290/     15D :                     ; --------------------------------------------------------
(1)  291/     15D :                     
(1)  292/     15D :                     .cmnd_wav_set:
(1)  293/     15D : FD 21 08 00         		ld	iy,wave_Start
(1)  294/     161 : CD 86 0B            		call	get_cmdbyte		; Start address
(1)  295/     164 : FD 77 00            		ld	(iy),a
(1)  296/     167 : FD 23               		inc	iy
(1)  297/     169 : CD 86 0B            		call	get_cmdbyte
(1)  298/     16C : FD 77 00            		ld	(iy),a
(1)  299/     16F : FD 23               		inc	iy
(1)  300/     171 : CD 86 0B            		call	get_cmdbyte
(1)  301/     174 : FD 77 00            		ld	(iy),a
(1)  302/     177 : FD 23               		inc	iy
(1)  303/     179 : CD 86 0B            		call	get_cmdbyte		; Length
(1)  304/     17C : FD 77 00            		ld	(iy),a
(1)  305/     17F : FD 23               		inc	iy
(1)  306/     181 : CD 86 0B            		call	get_cmdbyte
(1)  307/     184 : FD 77 00            		ld	(iy),a
(1)  308/     187 : FD 23               		inc	iy
(1)  309/     189 : CD 86 0B            		call	get_cmdbyte
(1)  310/     18C : FD 77 00            		ld	(iy),a
(1)  311/     18F : FD 23               		inc	iy
(1)  312/     191 : CD 86 0B            		call	get_cmdbyte		; Loop point
(1)  313/     194 : FD 77 00            		ld	(iy),a
(1)  314/     197 : FD 23               		inc	iy
(1)  315/     199 : CD 86 0B            		call	get_cmdbyte
(1)  316/     19C : FD 77 00            		ld	(iy),a
(1)  317/     19F : FD 23               		inc	iy
(1)  318/     1A1 : CD 86 0B            		call	get_cmdbyte
(1)  319/     1A4 : FD 77 00            		ld	(iy),a
(1)  320/     1A7 : FD 23               		inc	iy
(1)  321/     1A9 : CD 86 0B            		call	get_cmdbyte		; Pitch
(1)  322/     1AC : FD 77 00            		ld	(iy),a
(1)  323/     1AF : FD 23               		inc	iy
(1)  324/     1B1 : CD 86 0B            		call	get_cmdbyte
(1)  325/     1B4 : FD 77 00            		ld	(iy),a
(1)  326/     1B7 : FD 23               		inc	iy
(1)  327/     1B9 : CD 86 0B            		call	get_cmdbyte		; Flags
(1)  328/     1BC : FD 77 00            		ld	(iy),a
(1)  329/     1BF : FD 23               		inc	iy
(1)  330/     1C1 : CD 54 0E            		call	dac_play
(1)  331/     1C4 : C3 8A 00            		jp	.next_cmd
(1)  332/     1C7 :                     
(1)  333/     1C7 :                     ; --------------------------------------------------------
(1)  334/     1C7 :                     ; $22 - change current wave pitch
(1)  335/     1C7 :                     ; --------------------------------------------------------
(1)  336/     1C7 :                     
(1)  337/     1C7 :                     .cmnd_wav_pitch:
(1)  338/     1C7 : D9                  		exx
(1)  339/     1C8 : D5                  		push	de
(1)  340/     1C9 : D9                  		exx
(1)  341/     1CA : E1                  		pop	hl
(1)  342/     1CB : CD 88 0E            		call	dac_me
(1)  343/     1CE : CD 86 0B            		call	get_cmdbyte	; $00xx
(1)  344/     1D1 : 5F                  		ld	e,a
(1)  345/     1D2 : CD 86 0B            		call	get_cmdbyte	; $xx00
(1)  346/     1D5 : 57                  		ld	d,a
(1)  347/     1D6 : D5                  		push	de
(1)  348/     1D7 : CD 88 0E            		call	dac_me
(1)  349/     1DA : D9                  		exx
(1)  350/     1DB : D1                  		pop	de
(1)  351/     1DC : D9                  		exx
(1)  352/     1DD : C3 42 00            		jp	drv_loop
(1)  353/     1E0 :                     
(1)  354/     1E0 :                     ; ====================================================================
(1)  355/     1E0 :                     ; ----------------------------------------------------------------
(1)  356/     1E0 :                     ; Sound playback code
(1)  357/     1E0 :                     ; ----------------------------------------------------------------
(1)  358/     1E0 :                     
(1)  359/     1E0 :                     ; --------------------------------------------------------
(1)  360/     1E0 :                     ; Set and play instruments in their respective channels
(1)  361/     1E0 :                     ; --------------------------------------------------------
(1)  362/     1E0 :                     
(1)  363/     1E0 :                     playonchip
(1)  364/     1E0 : CD 9C 0E            		call	dac_fill
(1)  365/     1E3 : CD 88 0E            		call	dac_me
(1)  366/     1E6 :                     
(1)  367/     1E6 :                     	; Play new notes
(1)  368/     1E6 : 0E 02               		ld	c,MAX_TRKS
(1)  369/     1E8 : 21 00 1C            		ld	hl,insDataC
(1)  370/     1EB : 22 18 00            		ld	(currInsData),hl
(1)  371/     1EE : FD 21 20 18         		ld	iy,trkBuff+20h		; Point to channels
(1)  372/     1F2 :                     .nxt_track:
(1)  373/     1F2 : 06 12               		ld	b,MAX_TRKCHN
(1)  374/     1F4 : FD E5               		push	iy
(1)  375/     1F6 :                     .nxt_chnl:
(1)  376/     1F6 : C5                  		push	bc
(1)  377/     1F7 : FD 7E 07            		ld	a,(iy+chnl_Status)
(1)  378/     1FA : B7                  		or	a
(1)  379/     1FB : C4 2D 02            		call	nz,.do_chnl
(1)  380/     1FE : 00                  		nop
(1)  381/     1FF : 00                  		nop
(1)  382/     200 : CD 88 0E            		call	dac_me
(1)  383/     203 : C1                  		pop	bc
(1)  384/     204 : 11 08 00            		ld	de,8
(1)  385/     207 : FD 19               		add	iy,de
(1)  386/     209 : 10 EB               		djnz	.nxt_chnl
(1)  387/     20B : FD E1               		pop	iy
(1)  388/     20D : 11 00 01            		ld	de,100h
(1)  389/     210 : FD 19               		add	iy,de
(1)  390/     212 :                     
(1)  391/     212 : 11 80 00            		ld	de,80h
(1)  392/     215 : 2A 18 00            		ld	hl,(currInsData)
(1)  393/     218 : 19                  		add	hl,de
(1)  394/     219 : 22 18 00            		ld	(currInsData),hl
(1)  395/     21C : 0D                  		dec	c
(1)  396/     21D : C2 F2 01            		jp	nz,.nxt_track
(1)  397/     220 :                     
(1)  398/     220 : 3A 34 00            		ld	a,(reqSampl)
(1)  399/     223 : B7                  		or	a
(1)  400/     224 : C8                  		ret	z
(1)  401/     225 : AF                  		xor	a
(1)  402/     226 : 32 34 00            		ld	(reqSampl),a
(1)  403/     229 : CD 54 0E            		call	dac_play
(1)  404/     22C : C9                  		ret
(1)  405/     22D :                     
(1)  406/     22D :                     ; ----------------------------------------
(1)  407/     22D :                     ; Channel wants to update
(1)  408/     22D :                     ; ----------------------------------------
(1)  409/     22D :                     
(1)  410/     22D :                     .do_chnl:
(1)  411/     22D : CD 9C 0E            		call	dac_fill
(1)  412/     230 : CD 88 0E            		call	dac_me
(1)  413/     233 : FD CB 07 4E         		bit	1,(iy+chnl_Status)		; Update instrument first
(1)  414/     237 : C4 A8 02            		call	nz,.req_ins
(1)  415/     23A : FD CB 07 56         		bit	2,(iy+chnl_Status)
(1)  416/     23E : C4 B6 03            		call	nz,.req_vol
(1)  417/     241 : CD 88 0E            		call	dac_me
(1)  418/     244 : FD CB 07 5E         		bit	3,(iy+chnl_Status)
(1)  419/     248 : C4 5E 02            		call	nz,.req_eff
(1)  420/     24B : FD CB 07 46         		bit	0,(iy+chnl_Status)
(1)  421/     24F : C4 AE 04            		call	nz,.req_note
(1)  422/     252 : CD 88 0E            		call	dac_me
(1)  423/     255 : FD 7E 07            		ld	a,(iy+chnl_Status)		; clear update flags
(1)  424/     258 : E6 F0               		and	11110000b
(1)  425/     25A : FD 77 07            		ld	(iy+chnl_Status),a
(1)  426/     25D : C9                  		ret
(1)  427/     25E :                     
(1)  428/     25E :                     ; ----------------------------------------
(1)  429/     25E :                     ; Set new instrument
(1)  430/     25E :                     ; ----------------------------------------
(1)  431/     25E :                     
(1)  432/     25E :                     .req_eff:
(1)  433/     25E : CD C6 06            		call	.get_instype
(1)  434/     261 : FE FF               		cp	-1
(1)  435/     263 : C8                  		ret	z
(1)  436/     264 : FE 00               		cp	0
(1)  437/     266 : C8                  		ret	z
(1)  438/     267 : FE 01               		cp	1
(1)  439/     269 : C8                  		ret	z
(1)  440/     26A : FE 02               		cp	2
(1)  441/     26C : CA 78 02            		jp	z,.fm_eff
(1)  442/     26F : FE 03               		cp	3
(1)  443/     271 : CA 78 02            		jp	z,.fm_eff
(1)  444/     274 : FE 04               		cp	4
(1)  445/     276 : C8                  		ret	z
(1)  446/     277 :                     ; 		cp	5
(1)  447/     277 :                     ; 		jp	z,.pwm_eff
(1)  448/     277 : C9                  		ret
(1)  449/     278 :                     .fm_eff:
(1)  450/     278 : FD 7E 05            		ld	a,(iy+chnl_EffId)	; Eff X?
(1)  451/     27B : FE 18               		cp	24
(1)  452/     27D : CA 81 02            		jp	z,.eff_X_fm
(1)  453/     280 : C9                  		ret
(1)  454/     281 :                     .eff_X_fm:
(1)  455/     281 : CD EA 06            		call	.srch_fm
(1)  456/     284 : FE FF               		cp	-1
(1)  457/     286 : C8                  		ret	z
(1)  458/     287 : E5                  		push	hl
(1)  459/     288 : DD E1               		pop	ix
(1)  460/     28A : FD 7E 06            		ld	a,(iy+chnl_EffArg)
(1)  461/     28D : 07                  		rlca
(1)  462/     28E : 07                  		rlca
(1)  463/     28F : E6 03               		and	00000011b
(1)  464/     291 : 21 A4 02            		ld	hl,.fmpan_list
(1)  465/     294 : 11 00 00            		ld	de,0
(1)  466/     297 : 5F                  		ld	e,a
(1)  467/     298 : 19                  		add	hl,de
(1)  468/     299 : DD 7E 07            		ld	a,(ix+7)
(1)  469/     29C : E6 3F               		and	00111111b
(1)  470/     29E : 46                  		ld	b,(hl)
(1)  471/     29F : B0                  		or	b
(1)  472/     2A0 : DD 77 07            		ld	(ix+7),a
(1)  473/     2A3 : C9                  		ret
(1)  474/     2A4 :                     .fmpan_list:
(1)  475/     2A4 : 40                  		db 01000000b	; 000h
(1)  476/     2A5 : 40                  		db 01000000b	; 040h
(1)  477/     2A6 : 00                  		db 00000000b	; 080h
(1)  478/     2A7 : 80                  		db 10000000b	; 0C0h
(1)  479/     2A8 :                     
(1)  480/     2A8 :                     ; .pwm_eff:
(1)  481/     2A8 :                     ; 		ld	a,(iy+chnl_EffId)	; Eff X?
(1)  482/     2A8 :                     ; 		cp	24
(1)  483/     2A8 :                     ; 		jp	z,.eff_X_pwm
(1)  484/     2A8 :                     ; 		ret
(1)  485/     2A8 :                     ; .eff_X_pwm:
(1)  486/     2A8 :                     ; 		call	.srch_pwm
(1)  487/     2A8 :                     ; 		cp	-1
(1)  488/     2A8 :                     ; 		ret	z
(1)  489/     2A8 :                     ; 		push	hl
(1)  490/     2A8 :                     ; 		pop	ix
(1)  491/     2A8 :                     ; 		ld	a,(iy+chnl_EffArg)
(1)  492/     2A8 :                     ; 		rlca
(1)  493/     2A8 :                     ; 		rlca
(1)  494/     2A8 :                     ; 		and	00000011b
(1)  495/     2A8 :                     ; 		ld	hl,.pwmpan_list
(1)  496/     2A8 :                     ; 		ld	de,0
(1)  497/     2A8 :                     ; 		ld	e,a
(1)  498/     2A8 :                     ; 		add	hl,de
(1)  499/     2A8 :                     ; 		ld	a,(hl)
(1)  500/     2A8 :                     ; 		ld	(ix+7),a
(1)  501/     2A8 :                     ; 		ret
(1)  502/     2A8 :                     ;
(1)  503/     2A8 :                     ; .pwmpan_list:
(1)  504/     2A8 :                     ; 		db 001h		; 000h
(1)  505/     2A8 :                     ; 		db 001h		; 040h
(1)  506/     2A8 :                     ; 		db 003h		; 080h
(1)  507/     2A8 :                     ; 		db 002h		; 0C0h
(1)  508/     2A8 :                     
(1)  509/     2A8 :                     ; ----------------------------------------
(1)  510/     2A8 :                     ; Set new instrument
(1)  511/     2A8 :                     ; ----------------------------------------
(1)  512/     2A8 :                     
(1)  513/     2A8 :                     .req_ins:
(1)  514/     2A8 : CD C6 06            		call	.get_instype
(1)  515/     2AB : FE FF               		cp	-1		; Null
(1)  516/     2AD : C8                  		ret	z
(1)  517/     2AE : FE 00               		cp	0		; PSG normal
(1)  518/     2B0 : 28 11               		jr	z,.ins_psg
(1)  519/     2B2 : FE 01               		cp	1		; PSG noise
(1)  520/     2B4 : 28 21               		jr	z,.ins_ns
(1)  521/     2B6 : FE 02               		cp	2		; FM normal
(1)  522/     2B8 : 28 66               		jr	z,.fm_ins
(1)  523/     2BA : FE 03               		cp	3		; FM special
(1)  524/     2BC : C8                  		ret	z
(1)  525/     2BD : FE 04               		cp	4		; DAC
(1)  526/     2BF : CA 94 03            		jp	z,.dac_ins
(1)  527/     2C2 :                     ; 		cp	5		; PWM
(1)  528/     2C2 :                     ; 		jp	z,.pwm_ins
(1)  529/     2C2 : C9                  		ret
(1)  530/     2C3 :                     
(1)  531/     2C3 :                     ; PSG instrument
(1)  532/     2C3 :                     .ins_psg:
(1)  533/     2C3 : E5                  		push	hl
(1)  534/     2C4 : CD 88 0E            		call	dac_me
(1)  535/     2C7 : CD E2 06            		call	.srch_psg	; Type 0: PSG
(1)  536/     2CA : D1                  		pop	de
(1)  537/     2CB : FE FF               		cp	-1
(1)  538/     2CD : C8                  		ret	z
(1)  539/     2CE : 1A                  		ld	a,(de)
(1)  540/     2CF : 4F                  		ld	c,a
(1)  541/     2D0 : 13                  		inc	de
(1)  542/     2D1 : 13                  		inc	de
(1)  543/     2D2 : CD 88 0E            		call	dac_me
(1)  544/     2D5 : 18 0F               		jr	.cont_psg
(1)  545/     2D7 :                     .ins_ns:
(1)  546/     2D7 : E5                  		push	hl
(1)  547/     2D8 : CD DA 06            		call	.srch_psgn	; Type 1: PSG Noise
(1)  548/     2DB : D1                  		pop	de
(1)  549/     2DC : FE FF               		cp	-1
(1)  550/     2DE : C8                  		ret	z
(1)  551/     2DF : 7E                  		ld	a,(hl)
(1)  552/     2E0 : 4F                  		ld	c,a
(1)  553/     2E1 : 13                  		inc	de
(1)  554/     2E2 : 13                  		inc	de
(1)  555/     2E3 : CD 88 0E            		call	dac_me
(1)  556/     2E6 :                     .cont_psg:
(1)  557/     2E6 : 23                  		inc	hl
(1)  558/     2E7 : 23                  		inc 	hl
(1)  559/     2E8 : 23                  		inc	hl
(1)  560/     2E9 : CD 88 0E            		call	dac_me
(1)  561/     2EC : 1A                  		ld	a,(de)
(1)  562/     2ED : 47                  		ld	b,a
(1)  563/     2EE : 13                  		inc	de
(1)  564/     2EF : 1A                  		ld	a,(de)
(1)  565/     2F0 : 13                  		inc	de
(1)  566/     2F1 : D5                  		push	de
(1)  567/     2F2 : 57                  		ld	d,a
(1)  568/     2F3 : 58                  		ld	e,b
(1)  569/     2F4 :                     	rept 5				; copypaste to psduochnl
(1)  570/     2F4 :                     		ld	a,(de)
(1)  571/     2F4 :                      		ld	(hl),a
(1)  572/     2F4 :                      		inc	de
(1)  573/     2F4 :                     		inc	hl
(1)  574/     2F4 :                     		call	dac_me
(1)  575/     2F4 :                     		nop
(1)  576/     2F4 :                     	endm
(1)  570/     2F4 : 1A                  		ld	a,(de)
(1)  571/     2F5 : 77                   		ld	(hl),a
(1)  572/     2F6 : 13                   		inc	de
(1)  573/     2F7 : 23                  		inc	hl
(1)  574/     2F8 : CD 88 0E            		call	dac_me
(1)  575/     2FB : 00                  		nop
(1)  570/     2FC : 1A                  		ld	a,(de)
(1)  571/     2FD : 77                   		ld	(hl),a
(1)  572/     2FE : 13                   		inc	de
(1)  573/     2FF : 23                  		inc	hl
(1)  574/     300 : CD 88 0E            		call	dac_me
(1)  575/     303 : 00                  		nop
(1)  570/     304 : 1A                  		ld	a,(de)
(1)  571/     305 : 77                   		ld	(hl),a
(1)  572/     306 : 13                   		inc	de
(1)  573/     307 : 23                  		inc	hl
(1)  574/     308 : CD 88 0E            		call	dac_me
(1)  575/     30B : 00                  		nop
(1)  570/     30C : 1A                  		ld	a,(de)
(1)  571/     30D : 77                   		ld	(hl),a
(1)  572/     30E : 13                   		inc	de
(1)  573/     30F : 23                  		inc	hl
(1)  574/     310 : CD 88 0E            		call	dac_me
(1)  575/     313 : 00                  		nop
(1)  570/     314 : 1A                  		ld	a,(de)
(1)  571/     315 : 77                   		ld	(hl),a
(1)  572/     316 : 13                   		inc	de
(1)  573/     317 : 23                  		inc	hl
(1)  574/     318 : CD 88 0E            		call	dac_me
(1)  575/     31B : 00                  		nop
(1)  577/     31C : D1                  		pop	de
(1)  578/     31D : 1A                  		ld	a,(de)
(1)  579/     31E : 77                  		ld	(hl),a
(1)  580/     31F : C9                  		ret
(1)  581/     320 :                     ; Type 2
(1)  582/     320 :                     .fm_ins:
(1)  583/     320 : E5                  		push	hl
(1)  584/     321 : CD EA 06            		call	.srch_fm
(1)  585/     324 : FE FF               		cp	-1
(1)  586/     326 : C8                  		ret	z
(1)  587/     327 : E5                  		push	hl
(1)  588/     328 : DD E1               		pop	ix
(1)  589/     32A : E1                  		pop	hl
(1)  590/     32B : CD 88 0E            		call	dac_me
(1)  591/     32E : 23                  		inc	hl
(1)  592/     32F : 7E                  		ld	a,(hl)
(1)  593/     330 : DD 77 05            		ld	(ix+5),a
(1)  594/     333 : 23                  		inc	hl
(1)  595/     334 : 7E                  		ld	a,(hl)
(1)  596/     335 : 23                  		inc	hl
(1)  597/     336 : 66                  		ld	h,(hl)
(1)  598/     337 : 6F                  		ld	l,a
(1)  599/     338 : DD 75 03            		ld	(ix+3),l
(1)  600/     33B : DD 74 04            		ld	(ix+4),h
(1)  601/     33E : CD 88 0E            		call	dac_me
(1)  602/     341 :                     
(1)  603/     341 : DD 7E 00            		ld	a,(ix)		; Keys off
(1)  604/     344 : E6 07               		and	0111b
(1)  605/     346 : 5F                  		ld	e,a
(1)  606/     347 : 16 28               		ld	d,28h
(1)  607/     349 : CD 3E 0E            		call	fm_send_1
(1)  608/     34C :                     
(1)  609/     34C : DD 7E 00            		ld	a,(ix)		; Prepare first FM reg
(1)  610/     34F : E6 03               		and	11b
(1)  611/     351 : F6 30               		or	30h
(1)  612/     353 : 57                  		ld	d,a
(1)  613/     354 : 06 1C               		ld	b,4*7
(1)  614/     356 :                     .setlv:
(1)  615/     356 : CD 88 0E            		call	dac_me
(1)  616/     359 : 5E                  		ld	e,(hl)
(1)  617/     35A : CD 37 0E            		call	fm_autoset
(1)  618/     35D : 14                  		inc 	d
(1)  619/     35E : 14                  		inc 	d
(1)  620/     35F : 14                  		inc 	d
(1)  621/     360 : 14                  		inc 	d
(1)  622/     361 : 23                  		inc	hl
(1)  623/     362 : 10 F2               		djnz	.setlv
(1)  624/     364 :                     
(1)  625/     364 : 7A                  		ld	a,d
(1)  626/     365 : E6 03               		and	11b
(1)  627/     367 : F6 B0               		or	0B0h
(1)  628/     369 : 57                  		ld	d,a
(1)  629/     36A : 5E                  		ld	e,(hl)			; 0B0h
(1)  630/     36B : DD 73 06            		ld	(ix+6),e
(1)  631/     36E : CD 37 0E            		call	fm_autoset
(1)  632/     371 : CD 88 0E            		call	dac_me
(1)  633/     374 : 23                  		inc 	hl
(1)  634/     375 : 14                  		inc	d
(1)  635/     376 : 14                  		inc	d
(1)  636/     377 : 14                  		inc	d
(1)  637/     378 : 14                  		inc	d
(1)  638/     379 :                     
(1)  639/     379 : 7E                  		ld	a,(hl)			; 0B4h
(1)  640/     37A : E6 3F               		and	00111111b
(1)  641/     37C : 47                  		ld	b,a
(1)  642/     37D : DD 7E 07            		ld	a,(ix+7)
(1)  643/     380 : E6 C0               		and	11000000b
(1)  644/     382 : B0                  		or	b
(1)  645/     383 : DD 77 07            		ld	(ix+7),a
(1)  646/     386 : 5F                  		ld	e,a
(1)  647/     387 : CD 88 0E            		call	dac_me
(1)  648/     38A : CD 37 0E            		call	fm_autoset
(1)  649/     38D : 23                  		inc	hl			; TODO: FM3 enable bit
(1)  650/     38E : 23                  		inc	hl
(1)  651/     38F : 7E                  		ld	a,(hl)			; Keys (xxxx0000b)
(1)  652/     390 : DD 77 08            		ld	(ix+8),a
(1)  653/     393 : C9                  		ret
(1)  654/     394 :                     
(1)  655/     394 :                     ; Type 4
(1)  656/     394 :                     .dac_ins:
(1)  657/     394 :                     	; TODO: FM6/DAC LOCK
(1)  658/     394 : 23                  		inc	hl
(1)  659/     395 : 23                  		inc	hl
(1)  660/     396 : 4E                  		ld	c,(hl)
(1)  661/     397 : 23                  		inc	hl
(1)  662/     398 : CD 88 0E            		call	dac_me
(1)  663/     39B : 46                  		ld	b,(hl)
(1)  664/     39C : 23                  		inc	hl
(1)  665/     39D : 7E                  		ld	a,(hl)
(1)  666/     39E : F6 04               		or	100b
(1)  667/     3A0 : 32 13 00            		ld	(wave_Flags),a
(1)  668/     3A3 :                     
(1)  669/     3A3 : 60                  		ld	h,b
(1)  670/     3A4 : 69                  		ld	l,c
(1)  671/     3A5 : 11 08 00            		ld	de,wave_Start
(1)  672/     3A8 : 06 09               		ld	b,9
(1)  673/     3AA :                     .copybytes:
(1)  674/     3AA : 7E                  		ld	a,(hl)
(1)  675/     3AB : 12                  		ld	(de),a
(1)  676/     3AC : 23                  		inc	hl
(1)  677/     3AD : 13                  		inc	de
(1)  678/     3AE : CD 88 0E            		call	dac_me
(1)  679/     3B1 : 00                  		nop
(1)  680/     3B2 : 00                  		nop
(1)  681/     3B3 : 10 F5               		djnz	.copybytes
(1)  682/     3B5 : C9                  		ret
(1)  683/     3B6 :                     
(1)  684/     3B6 :                     ; 		jr	$
(1)  685/     3B6 :                     
(1)  686/     3B6 :                     ; Type 5
(1)  687/     3B6 :                     ; .pwm_ins:
(1)  688/     3B6 :                     ; 		push	hl
(1)  689/     3B6 :                     ; 		call	.srch_pwm
(1)  690/     3B6 :                     ; 		cp	-1
(1)  691/     3B6 :                     ; 		ret	z
(1)  692/     3B6 :                     ; 		push	hl
(1)  693/     3B6 :                     ; 		pop	ix
(1)  694/     3B6 :                     ; 		pop	hl
(1)  695/     3B6 :                     ;  		ld	de,
(1)  696/     3B6 :                     ;  		ld	a,(iy+chnl_Ins)
(1)  697/     3B6 :                     ;  		dec	a
(1)  698/     3B6 :                     ;  		ld	(ix+5),a		; put ins number
(1)  699/     3B6 :                     ; 		ret
(1)  700/     3B6 :                     
(1)  701/     3B6 :                     ; ----------------------------------------
(1)  702/     3B6 :                     ; Volume request
(1)  703/     3B6 :                     ; ----------------------------------------
(1)  704/     3B6 :                     
(1)  705/     3B6 :                     .req_vol:
(1)  706/     3B6 : CD C6 06            		call	.get_instype
(1)  707/     3B9 : FE FF               		cp	-1
(1)  708/     3BB : C8                  		ret	z
(1)  709/     3BC : FE 02               		cp	2
(1)  710/     3BE : CA EE 03            		jp	z,.vol_fm
(1)  711/     3C1 : FE 03               		cp	3
(1)  712/     3C3 : C8                  		ret	z
(1)  713/     3C4 : FE 04               		cp	4
(1)  714/     3C6 : C8                  		ret	z
(1)  715/     3C7 : FE 05               		cp	5
(1)  716/     3C9 : CA 95 04            		jp	z,.vol_pwm
(1)  717/     3CC :                     
(1)  718/     3CC :                     	; PSG volume
(1)  719/     3CC : FE 01               		cp	1
(1)  720/     3CE : 20 05               		jr	nz,.notnsev
(1)  721/     3D0 : CD DA 06            		call	.srch_psgn
(1)  722/     3D3 : 18 03               		jr	.pvcont
(1)  723/     3D5 :                     .notnsev:
(1)  724/     3D5 : CD E2 06            		call	.srch_psg	; Type 0: PSG
(1)  725/     3D8 :                     .pvcont:
(1)  726/     3D8 : FE FF               		cp	-1
(1)  727/     3DA : C8                  		ret	z
(1)  728/     3DB : 23                  		inc	hl
(1)  729/     3DC : 23                  		inc 	hl
(1)  730/     3DD : 23                  		inc 	hl		; Point to Attack level
(1)  731/     3DE : FD 7E 04            		ld	a,(iy+chnl_Vol)
(1)  732/     3E1 : D6 40               		sub	a,40h
(1)  733/     3E3 : 87                  		add	a,a
(1)  734/     3E4 : CD 88 0E            		call	dac_me
(1)  735/     3E7 : 47                  		ld	b,a
(1)  736/     3E8 : 7E                  		ld	a,(hl)
(1)  737/     3E9 : 90                  		sub	b
(1)  738/     3EA : 77                  		ld	(hl),a
(1)  739/     3EB : 23                  		inc	hl
(1)  740/     3EC : 23                  		inc	hl
(1)  741/     3ED : C9                  		ret
(1)  742/     3EE :                     
(1)  743/     3EE :                     .vol_fm:
(1)  744/     3EE : CD EA 06            		call	.srch_fm
(1)  745/     3F1 : FE FF               		cp	-1
(1)  746/     3F3 : C8                  		ret	z
(1)  747/     3F4 : E5                  		push	hl
(1)  748/     3F5 : DD E1               		pop	ix
(1)  749/     3F7 : 23                  		inc	hl
(1)  750/     3F8 : 23                  		inc	hl
(1)  751/     3F9 : 23                  		inc	hl
(1)  752/     3FA : CD 88 0E            		call	dac_me
(1)  753/     3FD : 7E                  		ld	a,(hl)
(1)  754/     3FE : 23                  		inc	hl
(1)  755/     3FF : 66                  		ld	h,(hl)
(1)  756/     400 : 6F                  		ld	l,a
(1)  757/     401 : 11 04 00            		ld	de,4
(1)  758/     404 : 19                  		add	hl,de		; Point to 40h's
(1)  759/     405 :                     
(1)  760/     405 :                     	; copy-pasted from PulseMini
(1)  761/     405 :                     	; b - 0B0h
(1)  762/     405 :                     	; c - Volume
(1)  763/     405 : CD 9C 0E            		call	dac_fill
(1)  764/     408 : CD 88 0E            		call	dac_me
(1)  765/     40B : FD 7E 04            		ld	a,(iy+chnl_Vol)
(1)  766/     40E : D6 40               		sub	a,40h
(1)  767/     410 : ED 44               		neg	a
(1)  768/     412 : 4F                  		ld	c,a
(1)  769/     413 : DD 7E 06            		ld	a,(ix+6)
(1)  770/     416 : E6 07               		and	111b
(1)  771/     418 : 47                  		ld	b,a
(1)  772/     419 : 16 40               		ld	d,40h
(1)  773/     41B : DD 7E 00            		ld	a,(ix)
(1)  774/     41E : E6 03               		and	11b
(1)  775/     420 : B2                  		or	d
(1)  776/     421 : 57                  		ld	d,a
(1)  777/     422 : CD 88 0E            		call	dac_me
(1)  778/     425 : 5E                  		ld	e,(hl)
(1)  779/     426 : 23                  		inc 	hl
(1)  780/     427 : 78                  		ld	a,b
(1)  781/     428 : FE 07               		cp	7
(1)  782/     42A : C2 36 04            		jp	nz,.tlv_lv1
(1)  783/     42D : 7B                  		ld	a,e
(1)  784/     42E : 81                  		add 	a,c
(1)  785/     42F : 5F                  		ld	e,a
(1)  786/     430 : B7                  		or	a
(1)  787/     431 : F2 36 04            		jp	p,.tlv_lv1
(1)  788/     434 : 1E 7F               		ld	e,7Fh
(1)  789/     436 :                     .tlv_lv1:
(1)  790/     436 : CD 37 0E            		call	fm_autoset
(1)  791/     439 : 14                  		inc 	d
(1)  792/     43A : 14                  		inc 	d
(1)  793/     43B : 14                  		inc 	d
(1)  794/     43C : 14                  		inc 	d
(1)  795/     43D : CD 88 0E            		call	dac_me
(1)  796/     440 : 5E                  		ld	e,(hl)
(1)  797/     441 : 78                  		ld	a,b
(1)  798/     442 : FE 07               		cp	7
(1)  799/     444 : CA 54 04            		jp	z,.tlv_lv2_ok
(1)  800/     447 : FE 06               		cp	6
(1)  801/     449 : CA 54 04            		jp	z,.tlv_lv2_ok
(1)  802/     44C : FE 05               		cp	5
(1)  803/     44E : C2 5D 04            		jp	nz,.tlv_lv2
(1)  804/     451 : CD 88 0E            		call	dac_me
(1)  805/     454 :                     .tlv_lv2_ok:
(1)  806/     454 : 7B                  		ld	a,e
(1)  807/     455 : 81                  		add 	a,c
(1)  808/     456 : 5F                  		ld	e,a
(1)  809/     457 : B7                  		or	a
(1)  810/     458 : F2 5D 04            		jp	p,.tlv_lv2
(1)  811/     45B : 1E 7F               		ld	e,7Fh
(1)  812/     45D :                     .tlv_lv2:
(1)  813/     45D : CD 37 0E            		call	fm_autoset
(1)  814/     460 : 23                  		inc 	hl
(1)  815/     461 : 14                  		inc 	d
(1)  816/     462 : 14                  		inc 	d
(1)  817/     463 : 14                  		inc 	d
(1)  818/     464 : 14                  		inc 	d
(1)  819/     465 : CD 88 0E            		call	dac_me
(1)  820/     468 : 5E                  		ld	e,(hl)
(1)  821/     469 : 78                  		ld	a,b
(1)  822/     46A : E6 04               		and	100b
(1)  823/     46C : B7                  		or	a
(1)  824/     46D : CA 7C 04            		jp	z,.tlv_lv3
(1)  825/     470 : 7B                  		ld	a,e
(1)  826/     471 : 81                  		add 	a,c
(1)  827/     472 : 5F                  		ld	e,a
(1)  828/     473 : B7                  		or	a
(1)  829/     474 : F2 7C 04            		jp	p,.tlv_lv3
(1)  830/     477 : CD 88 0E            		call	dac_me
(1)  831/     47A : 3E 7F               		ld	a,7Fh
(1)  832/     47C :                     .tlv_lv3:
(1)  833/     47C : CD 37 0E            		call	fm_autoset
(1)  834/     47F : 23                  		inc 	hl
(1)  835/     480 : 14                  		inc 	d
(1)  836/     481 : 14                  		inc 	d
(1)  837/     482 : 14                  		inc 	d
(1)  838/     483 : 14                  		inc 	d
(1)  839/     484 : CD 88 0E            		call	dac_me
(1)  840/     487 : 7E                  		ld	a,(hl)
(1)  841/     488 : 81                  		add 	a,c
(1)  842/     489 : B7                  		or	a
(1)  843/     48A : F2 8F 04            		jp	p,.tlv_lv4
(1)  844/     48D : 3E 7F               		ld	a,7Fh
(1)  845/     48F :                     .tlv_lv4:
(1)  846/     48F : 5F                  		ld	e,a
(1)  847/     490 : 23                  		inc 	hl
(1)  848/     491 : CD 37 0E            		call	fm_autoset
(1)  849/     494 : C9                  		ret
(1)  850/     495 :                     
(1)  851/     495 :                     ; Type 5
(1)  852/     495 :                     .vol_pwm:
(1)  853/     495 : E5                  		push	hl
(1)  854/     496 : CD 02 07            		call	.srch_pwm
(1)  855/     499 : FE FF               		cp	-1
(1)  856/     49B : C8                  		ret	z
(1)  857/     49C : E5                  		push	hl
(1)  858/     49D : DD E1               		pop	ix
(1)  859/     49F : E1                  		pop	hl
(1)  860/     4A0 : 11 00 00             		ld	de,
(1)  861/     4A3 : FD 7E 04             		ld	a,(iy+chnl_Vol)
(1)  862/     4A6 : D6 40               		sub	a,40h
(1)  863/     4A8 : ED 44               		neg	a
(1)  864/     4AA :                     ; 		add	a,a
(1)  865/     4AA : DD 77 06             		ld	(ix+6),a		; put vol number
(1)  866/     4AD : C9                  		ret
(1)  867/     4AE :                     
(1)  868/     4AE :                     ; ----------------------------------------
(1)  869/     4AE :                     ; Note request
(1)  870/     4AE :                     ; ----------------------------------------
(1)  871/     4AE :                     
(1)  872/     4AE :                     .req_note:
(1)  873/     4AE : CD C6 06            		call	.get_instype
(1)  874/     4B1 : FE FF               		cp	-1
(1)  875/     4B3 : C8                  		ret	z
(1)  876/     4B4 : FE 02               		cp	2
(1)  877/     4B6 : CA CB 05            		jp	z,.note_fm
(1)  878/     4B9 : FE 03               		cp	3
(1)  879/     4BB : CA AD 06            		jp	z,.note_fm3
(1)  880/     4BE : FE 04               		cp	4
(1)  881/     4C0 : CA B9 06            		jp	z,.note_dac
(1)  882/     4C3 : FE 05               		cp	5
(1)  883/     4C5 : CA C5 06            		jp	z,.note_pwm
(1)  884/     4C8 : CD 88 0E            		call	dac_me
(1)  885/     4CB : 23                  		inc	hl
(1)  886/     4CC : 4E                  		ld	c,(hl)
(1)  887/     4CD : C5                  		push	bc
(1)  888/     4CE :                     
(1)  889/     4CE :                     	; PSG mode 0 and 1
(1)  890/     4CE : FE 01               		cp	1
(1)  891/     4D0 : 20 05               		jr	nz,.notnse
(1)  892/     4D2 : CD DA 06            		call	.srch_psgn
(1)  893/     4D5 : 18 03               		jr	.pncont
(1)  894/     4D7 :                     .notnse:
(1)  895/     4D7 : CD E2 06            		call	.srch_psg	; Type 0: PSG
(1)  896/     4DA :                     .pncont:
(1)  897/     4DA : FE FF               		cp	-1
(1)  898/     4DC : C8                  		ret	z
(1)  899/     4DD : 7E                  		ld	a,(hl)		; Get pseudo channel slot
(1)  900/     4DE : FE FF               		cp	-1
(1)  901/     4E0 : C8                  		ret	z
(1)  902/     4E1 : C1                  		pop	bc
(1)  903/     4E2 : E5                  		push	hl		; save this hl
(1)  904/     4E3 : E6 03               		and	11b
(1)  905/     4E5 : CD 88 0E            		call	dac_me
(1)  906/     4E8 : DD 21 38 12         		ld	ix,psgcom
(1)  907/     4EC : 11 00 00            		ld	de,0
(1)  908/     4EF : 5F                  		ld	e,a
(1)  909/     4F0 : DD 19               		add	ix,de
(1)  910/     4F2 : 11 00 00            		ld	de,0		; Read freq
(1)  911/     4F5 : FD 7E 02            		ld	a,(iy+chnl_Note)
(1)  912/     4F8 : FE FE               		cp	-2
(1)  913/     4FA : CA 9B 05            		jp	z,.pstop
(1)  914/     4FD : FE FF               		cp	-1
(1)  915/     4FF : CA B3 05            		jp	z,.poff
(1)  916/     502 : 81                  		add	a,c
(1)  917/     503 : 21 80 10            		ld	hl,psgFreq_List
(1)  918/     506 : 87                  		add	a,a
(1)  919/     507 : 5F                  		ld	e,a
(1)  920/     508 : 19                  		add	hl,de
(1)  921/     509 : CD 88 0E            		call	dac_me
(1)  922/     50C : 7E                  		ld	a,(hl)
(1)  923/     50D : E6 0F               		and	0Fh
(1)  924/     50F : DD 77 1C            		ld	(ix+DTL),a
(1)  925/     512 : 7E                  		ld	a,(hl)
(1)  926/     513 : CB 2F               		sra	a
(1)  927/     515 : CB 2F               		sra	a
(1)  928/     517 : CB 2F               		sra	a
(1)  929/     519 : CB 2F               		sra	a
(1)  930/     51B : E6 0F               		and	0Fh
(1)  931/     51D : CD 88 0E            		call	dac_me
(1)  932/     520 : 47                  		ld	b,a
(1)  933/     521 : 23                  		inc	hl
(1)  934/     522 : 7E                  		ld	a,(hl)
(1)  935/     523 : CB 27               		sla	a
(1)  936/     525 : CB 27               		sla	a
(1)  937/     527 : CB 27               		sla	a
(1)  938/     529 : CB 27               		sla	a
(1)  939/     52B : E6 F0               		and	0F0h
(1)  940/     52D : B0                  		or	b
(1)  941/     52E : CD 88 0E            		call	dac_me
(1)  942/     531 : DD 77 20            		ld	(ix+DTH),a
(1)  943/     534 : E1                  		pop	hl		; get hl back
(1)  944/     535 : 46                  		ld	b,(hl)
(1)  945/     536 : 23                  		inc	hl
(1)  946/     537 : 23                  		inc	hl
(1)  947/     538 : 23                  		inc 	hl		; Point to our PSG ins data
(1)  948/     539 : 7E                  		ld	a,(hl)
(1)  949/     53A : 23                  		inc	hl
(1)  950/     53B : DD 77 24            		ld	(ix+ALV),a	; attack level
(1)  951/     53E : 7E                  		ld	a,(hl)
(1)  952/     53F : 23                  		inc	hl
(1)  953/     540 : CD 88 0E            		call	dac_me
(1)  954/     543 : DD 77 08            		ld	(ix+ATK),a	; attack rate
(1)  955/     546 : 7E                  		ld	a,(hl)
(1)  956/     547 : 23                  		inc	hl
(1)  957/     548 : DD 77 10            		ld	(ix+SLV),a	; sustain
(1)  958/     54B : 7E                  		ld	a,(hl)
(1)  959/     54C : 23                  		inc	hl
(1)  960/     54D : DD 77 0C            		ld	(ix+DKY),a	; decay rate
(1)  961/     550 : 7E                  		ld	a,(hl)
(1)  962/     551 : 23                  		inc	hl
(1)  963/     552 : DD 77 14            		ld	(ix+RRT),a	; release rate
(1)  964/     555 : 78                  		ld	a,b
(1)  965/     556 : E6 83               		and	10000011b
(1)  966/     558 : FD 77 00            		ld	(iy+chnl_Chip),a
(1)  967/     55B : CD 88 0E            		call	dac_me
(1)  968/     55E : E6 03               		and	11b
(1)  969/     560 : FE 02               		cp	2
(1)  970/     562 : CA 8B 05            		jp	z,.psgchnl3
(1)  971/     565 : FE 03               		cp	3
(1)  972/     567 : C2 96 05            		jp	nz,.normlpsg
(1)  973/     56A : 11 2F 00            		ld	de,psgHatMode	; if chnl uses NOISE
(1)  974/     56D : 7E                  		ld	a,(hl)
(1)  975/     56E : FD E5               		push	iy
(1)  976/     570 : E1                  		pop	hl
(1)  977/     571 : 4F                  		ld	c,a
(1)  978/     572 : 12                  		ld	(de),a		; NOISE mode
(1)  979/     573 : 13                  		inc	de
(1)  980/     574 : 7D                  		ld	a,l
(1)  981/     575 : 12                  		ld	(de),a
(1)  982/     576 : CD 88 0E            		call	dac_me
(1)  983/     579 : 13                  		inc 	de
(1)  984/     57A : 7C                  		ld	a,h
(1)  985/     57B : 12                  		ld	(de),a
(1)  986/     57C : 79                  		ld	a,c		; Auto-silence PSG3
(1)  987/     57D : E6 03               		and	11b		; is Tone3 is active
(1)  988/     57F : FE 03               		cp	3
(1)  989/     581 : C2 96 05            		jp	nz,.normlpsg
(1)  990/     584 : 3E 04               		ld	a,100b		; Send stop com directly
(1)  991/     586 : 32 3A 12            		ld	(psgcom+2),a	; To PSG3
(1)  992/     589 : 18 0B               		jr	.normlpsg
(1)  993/     58B :                     	; if chnl uses PSG3
(1)  994/     58B :                     .psgchnl3:
(1)  995/     58B : 3A 2F 00            		ld	a,(psgHatMode)
(1)  996/     58E : E6 03               		and	11b
(1)  997/     590 : FE 03               		cp	11b
(1)  998/     592 : C8                  		ret	z
(1)  999/     593 : CD 88 0E            		call	dac_me
(1) 1000/     596 :                     .normlpsg:
(1) 1001/     596 : DD 36 00 01         		ld	(ix+COM),001b	; Key on.
(1) 1002/     59A : C9                  		ret
(1) 1003/     59B :                     ; full stop
(1) 1004/     59B :                     .pstop:
(1) 1005/     59B : E1                  		pop	hl
(1) 1006/     59C : 7E                  		ld	a,(hl)		; Unlock this channel
(1) 1007/     59D : E6 7F               		and	07Fh
(1) 1008/     59F : 77                  		ld	(hl),a
(1) 1009/     5A0 : 23                  		inc 	hl
(1) 1010/     5A1 : 36 00               		ld	(hl),0
(1) 1011/     5A3 : CD 88 0E            		call	dac_me
(1) 1012/     5A6 : 23                  		inc 	hl
(1) 1013/     5A7 : 36 00               		ld	(hl),0
(1) 1014/     5A9 : 23                  		inc 	hl
(1) 1015/     5AA : DD 36 00 04         		ld	(ix+COM),100b	; Full stop
(1) 1016/     5AE : FD 36 00 00         		ld	(iy+chnl_Chip),0
(1) 1017/     5B2 : C9                  		ret
(1) 1018/     5B3 :                     ; key off
(1) 1019/     5B3 :                     .poff:
(1) 1020/     5B3 : E1                  		pop	hl
(1) 1021/     5B4 : 7E                  		ld	a,(hl)		; unlock this channel
(1) 1022/     5B5 : E6 7F               		and	07Fh
(1) 1023/     5B7 : 77                  		ld	(hl),a
(1) 1024/     5B8 : 23                  		inc 	hl
(1) 1025/     5B9 : 36 00               		ld	(hl),0
(1) 1026/     5BB : CD 88 0E            		call	dac_me
(1) 1027/     5BE : 23                  		inc 	hl
(1) 1028/     5BF : 36 00               		ld	(hl),0
(1) 1029/     5C1 : 23                  		inc 	hl
(1) 1030/     5C2 : DD 36 00 02         		ld	(ix+COM),010b	; Key off ===
(1) 1031/     5C6 : FD 36 00 00         		ld	(iy+chnl_Chip),0
(1) 1032/     5CA : C9                  		ret
(1) 1033/     5CB :                     
(1) 1034/     5CB :                     ; ----------------------------------------
(1) 1035/     5CB :                     ; FM
(1) 1036/     5CB :                     ; ----------------------------------------
(1) 1037/     5CB :                     
(1) 1038/     5CB :                     .note_fm:
(1) 1039/     5CB : CD EA 06            		call	.srch_fm
(1) 1040/     5CE : FE FF               		cp	-1
(1) 1041/     5D0 : C8                  		ret	z
(1) 1042/     5D1 : E5                  		push	hl
(1) 1043/     5D2 : DD E1               		pop	ix
(1) 1044/     5D4 : 23                  		inc	hl
(1) 1045/     5D5 : 23                  		inc	hl
(1) 1046/     5D6 : 23                  		inc	hl
(1) 1047/     5D7 : 23                  		inc	hl
(1) 1048/     5D8 : 23                  		inc	hl
(1) 1049/     5D9 : CD 9C 0E            		call	dac_fill
(1) 1050/     5DC : CD 88 0E            		call	dac_me
(1) 1051/     5DF :                     
(1) 1052/     5DF : DD 7E 00            		ld	a,(ix)		; Keys off
(1) 1053/     5E2 : E6 87               		and	10000111b
(1) 1054/     5E4 : F6 20               		or	00100000b	; Mark as FM
(1) 1055/     5E6 : FD 77 00            		ld	(iy+chnl_Chip),a
(1) 1056/     5E9 :                     
(1) 1057/     5E9 : FD 7E 02            		ld	a,(iy+chnl_Note)
(1) 1058/     5EC : FE FF               		cp	-1		; Key off.
(1) 1059/     5EE : CA AE 06            		jp	z,.keyoff
(1) 1060/     5F1 : FE FE               		cp	-2		; TODO: Total level force off
(1) 1061/     5F3 : CA AE 06            		jp	z,.keyoff
(1) 1062/     5F6 : DD 46 05            		ld	b,(ix+5)
(1) 1063/     5F9 : 80                  		add	a,b
(1) 1064/     5FA : 06 00               		ld	b,0
(1) 1065/     5FC :                     	rept 7				; Separate notedata as octave(b) and note(c)
(1) 1066/     5FC :                     		call	dac_me
(1) 1067/     5FC :                     		ld	c,a
(1) 1068/     5FC :                     		sub	12
(1) 1069/     5FC :                     		or	a
(1) 1070/     5FC :                     		jp	m,.getoct
(1) 1071/     5FC :                     		inc	b
(1) 1072/     5FC :                     	endm
(1) 1066/     5FC : CD 88 0E            		call	dac_me
(1) 1067/     5FF : 4F                  		ld	c,a
(1) 1068/     600 : D6 0C               		sub	12
(1) 1069/     602 : B7                  		or	a
(1) 1070/     603 : FA 49 06            		jp	m,.getoct
(1) 1071/     606 : 04                  		inc	b
(1) 1066/     607 : CD 88 0E            		call	dac_me
(1) 1067/     60A : 4F                  		ld	c,a
(1) 1068/     60B : D6 0C               		sub	12
(1) 1069/     60D : B7                  		or	a
(1) 1070/     60E : FA 49 06            		jp	m,.getoct
(1) 1071/     611 : 04                  		inc	b
(1) 1066/     612 : CD 88 0E            		call	dac_me
(1) 1067/     615 : 4F                  		ld	c,a
(1) 1068/     616 : D6 0C               		sub	12
(1) 1069/     618 : B7                  		or	a
(1) 1070/     619 : FA 49 06            		jp	m,.getoct
(1) 1071/     61C : 04                  		inc	b
(1) 1066/     61D : CD 88 0E            		call	dac_me
(1) 1067/     620 : 4F                  		ld	c,a
(1) 1068/     621 : D6 0C               		sub	12
(1) 1069/     623 : B7                  		or	a
(1) 1070/     624 : FA 49 06            		jp	m,.getoct
(1) 1071/     627 : 04                  		inc	b
(1) 1066/     628 : CD 88 0E            		call	dac_me
(1) 1067/     62B : 4F                  		ld	c,a
(1) 1068/     62C : D6 0C               		sub	12
(1) 1069/     62E : B7                  		or	a
(1) 1070/     62F : FA 49 06            		jp	m,.getoct
(1) 1071/     632 : 04                  		inc	b
(1) 1066/     633 : CD 88 0E            		call	dac_me
(1) 1067/     636 : 4F                  		ld	c,a
(1) 1068/     637 : D6 0C               		sub	12
(1) 1069/     639 : B7                  		or	a
(1) 1070/     63A : FA 49 06            		jp	m,.getoct
(1) 1071/     63D : 04                  		inc	b
(1) 1066/     63E : CD 88 0E            		call	dac_me
(1) 1067/     641 : 4F                  		ld	c,a
(1) 1068/     642 : D6 0C               		sub	12
(1) 1069/     644 : B7                  		or	a
(1) 1070/     645 : FA 49 06            		jp	m,.getoct
(1) 1071/     648 : 04                  		inc	b
(1) 1073/     649 :                     .getoct:
(1) 1074/     649 : CD 88 0E            		call	dac_me
(1) 1075/     64C : 11 00 00            		ld	de,0
(1) 1076/     64F : DD 7E 00            		ld	a,(ix)
(1) 1077/     652 : E6 03               		and	11b
(1) 1078/     654 : F6 A4               		or	0A4h
(1) 1079/     656 : 57                  		ld	d,a
(1) 1080/     657 : 79                  		ld	a,c		; c - Note
(1) 1081/     658 : 87                  		add	a,a
(1) 1082/     659 : 4F                  		ld	c,a
(1) 1083/     65A : 78                  		ld	a,b
(1) 1084/     65B : 87                  		add	a,a
(1) 1085/     65C : 87                  		add	a,a
(1) 1086/     65D : 87                  		add	a,a		; a - Octave
(1) 1087/     65E : 06 00               		ld	b,0
(1) 1088/     660 : CD 88 0E            		call	dac_me
(1) 1089/     663 : 21 68 10            		ld	hl,fmFreq_List
(1) 1090/     666 : 09                  		add	hl,bc
(1) 1091/     667 : 23                  		inc	hl
(1) 1092/     668 : 5F                  		ld	e,a
(1) 1093/     669 : 7E                  		ld	a,(hl)
(1) 1094/     66A : B3                  		or	e
(1) 1095/     66B : 5F                  		ld	e,a
(1) 1096/     66C : DD 77 09            		ld	(ix+9),a
(1) 1097/     66F : CD 37 0E            		call	fm_autoset
(1) 1098/     672 : CD 88 0E            		call	dac_me
(1) 1099/     675 : 15                  		dec	d
(1) 1100/     676 : 15                  		dec	d
(1) 1101/     677 : 15                  		dec	d
(1) 1102/     678 : 15                  		dec	d
(1) 1103/     679 : 2B                  		dec	hl
(1) 1104/     67A : 5E                  		ld	e,(hl)
(1) 1105/     67B : DD 73 0A            		ld	(ix+10),e
(1) 1106/     67E : CD 37 0E            		call	fm_autoset
(1) 1107/     681 : DD 7E 00            		ld	a,(ix)		; 0B4h
(1) 1108/     684 : E6 07               		and	111b
(1) 1109/     686 : 16 B4               		ld	d,0B4h
(1) 1110/     688 : B2                  		or	d
(1) 1111/     689 : 57                  		ld	d,a
(1) 1112/     68A :                     
(1) 1113/     68A : DD 7E 07            		ld	a,(ix+7)
(1) 1114/     68D : 4F                  		ld	c,a
(1) 1115/     68E : E6 3F               		and	00111111b
(1) 1116/     690 : 5F                  		ld	e,a
(1) 1117/     691 : 79                  		ld	a,c
(1) 1118/     692 : 2F                  		cpl
(1) 1119/     693 : E6 C0               		and	11000000b
(1) 1120/     695 : B3                  		or	e
(1) 1121/     696 : 5F                  		ld	e,a
(1) 1122/     697 :                     
(1) 1123/     697 : CD 37 0E            		call	fm_autoset
(1) 1124/     69A : CD 88 0E            		call	dac_me
(1) 1125/     69D : DD 7E 00            		ld	a,(ix)		; Keys
(1) 1126/     6A0 : E6 07               		and	111b
(1) 1127/     6A2 : DD 5E 08            		ld	e,(ix+8)
(1) 1128/     6A5 : B3                  		or	e
(1) 1129/     6A6 : 5F                  		ld	e,a
(1) 1130/     6A7 : 16 28               		ld	d,28h
(1) 1131/     6A9 : CD 3E 0E            		call	fm_send_1
(1) 1132/     6AC : C9                  		ret
(1) 1133/     6AD :                     .note_fm3:
(1) 1134/     6AD : C9                  		ret
(1) 1135/     6AE :                     
(1) 1136/     6AE :                     .keyoff:
(1) 1137/     6AE : DD 7E 00            		ld	a,(ix)		; Keys off
(1) 1138/     6B1 : E6 07               		and	111b
(1) 1139/     6B3 : 5F                  		ld	e,a
(1) 1140/     6B4 : 16 28               		ld	d,28h
(1) 1141/     6B6 : C3 3E 0E            		jp	fm_send_1
(1) 1142/     6B9 :                     
(1) 1143/     6B9 :                     .note_dac:
(1) 1144/     6B9 :                     	; TODO: FM6/DAC LOCK
(1) 1145/     6B9 : 21 00 01            		ld	hl,100h		; temporal.
(1) 1146/     6BC : 22 11 00            		ld	(wave_Pitch),hl
(1) 1147/     6BF : 3E 01               		ld	a,1
(1) 1148/     6C1 : 32 34 00            		ld	(reqSampl),a
(1) 1149/     6C4 : C9                  		ret
(1) 1150/     6C5 :                     
(1) 1151/     6C5 :                     ; ----------------------------------------
(1) 1152/     6C5 :                     ; PWM
(1) 1153/     6C5 :                     ; ----------------------------------------
(1) 1154/     6C5 :                     
(1) 1155/     6C5 :                     .note_pwm:
(1) 1156/     6C5 :                     ; 		push	hl
(1) 1157/     6C5 :                     ; 		call	.srch_pwm
(1) 1158/     6C5 :                     ; 		push	hl
(1) 1159/     6C5 :                     ; 		pop	ix
(1) 1160/     6C5 :                     ; 		pop	hl
(1) 1161/     6C5 :                     ; 		inc	hl
(1) 1162/     6C5 :                     ;
(1) 1163/     6C5 :                     ; 		call	dac_me
(1) 1164/     6C5 :                     ; 		ld	a,(iy+chnl_Note)
(1) 1165/     6C5 :                     ; 		cp	-1
(1) 1166/     6C5 :                     ; 		jr	z,.pwm_stop
(1) 1167/     6C5 :                     ; 		cp	-2
(1) 1168/     6C5 :                     ; 		jr	z,.pwm_stop
(1) 1169/     6C5 :                     ; 		ld	l,(hl)
(1) 1170/     6C5 :                     ; 		call	dac_me
(1) 1171/     6C5 :                     ; 		add	a,l
(1) 1172/     6C5 :                     ; 		add	a,a
(1) 1173/     6C5 :                     ; 		ld	de,0
(1) 1174/     6C5 :                     ; 		ld	e,a
(1) 1175/     6C5 :                     ; 		ld	hl,wavFreq_Pwm
(1) 1176/     6C5 :                     ; 		add	hl,de
(1) 1177/     6C5 :                     ; 		ld	a,(hl)
(1) 1178/     6C5 :                     ; 		ld	(ix+3),a	; NOTE: big endian
(1) 1179/     6C5 :                     ; 		inc	hl
(1) 1180/     6C5 :                     ; 		ld	a,(hl)
(1) 1181/     6C5 :                     ; 		ld	(ix+4),a
(1) 1182/     6C5 :                     ;
(1) 1183/     6C5 :                     ; 		ld	a,(ix)		; Tell SH2 we want to play channel
(1) 1184/     6C5 :                     ; 		or	01000000b
(1) 1185/     6C5 :                     ; 		ld	(ix),a
(1) 1186/     6C5 :                     ; 		ret
(1) 1187/     6C5 :                     ; .pwm_stop:
(1) 1188/     6C5 :                     ; 		ld	a,(ix)		; Tell SH2 to stop this channel
(1) 1189/     6C5 :                     ; 		or	00100000b
(1) 1190/     6C5 :                     ; 		ld	(ix),a
(1) 1191/     6C5 : C9                  		ret
(1) 1192/     6C6 :                     
(1) 1193/     6C6 :                     ; ----------------------------------------
(1) 1194/     6C6 :                     ; Check the current instrument type
(1) 1195/     6C6 :                     ;
(1) 1196/     6C6 :                     ; Returns:
(1) 1197/     6C6 :                     ;  a - Type
(1) 1198/     6C6 :                     ; hl - Instrument data
(1) 1199/     6C6 :                     ;
(1) 1200/     6C6 :                     ; Types:
(1) 1201/     6C6 :                     ; -1 - Null
(1) 1202/     6C6 :                     ;  0 - PSG
(1) 1203/     6C6 :                     ;  1 - PSG Noise
(1) 1204/     6C6 :                     ;  2 - FM
(1) 1205/     6C6 :                     ;  3 - FM Special
(1) 1206/     6C6 :                     ;  4 - FM Sample
(1) 1207/     6C6 :                     ;  5 - PWM
(1) 1208/     6C6 :                     ; ----------------------------------------
(1) 1209/     6C6 :                     
(1) 1210/     6C6 :                     .get_instype:
(1) 1211/     6C6 : FD 7E 03            		ld	a,(iy+chnl_Ins)
(1) 1212/     6C9 : 3D                  		dec	a
(1) 1213/     6CA : 87                  		add	a,a
(1) 1214/     6CB : 87                  		add	a,a
(1) 1215/     6CC : 87                  		add	a,a
(1) 1216/     6CD : CD 88 0E            		call	dac_me
(1) 1217/     6D0 : 2A 18 00            		ld	hl,(currInsData)
(1) 1218/     6D3 : 11 00 00            		ld	de,0
(1) 1219/     6D6 : 5F                  		ld	e,a
(1) 1220/     6D7 : 19                  		add	hl,de
(1) 1221/     6D8 : 7E                  		ld	a,(hl)		; check type
(1) 1222/     6D9 : C9                  		ret
(1) 1223/     6DA :                     
(1) 1224/     6DA :                     ; ----------------------------------------
(1) 1225/     6DA :                     
(1) 1226/     6DA :                     .srch_psgn:
(1) 1227/     6DA : 11 09 00            		ld	de,9
(1) 1228/     6DD : 21 8E 11            		ld	hl,PSGNVTBL
(1) 1229/     6E0 : 18 39               		jr	.srch_chnltbl
(1) 1230/     6E2 :                     .srch_psg:
(1) 1231/     6E2 : 11 09 00            		ld	de,9
(1) 1232/     6E5 : 21 72 11            		ld	hl,PSGVTBL
(1) 1233/     6E8 : 18 31               		jr	.srch_chnltbl
(1) 1234/     6EA :                     .srch_fm:
(1) 1235/     6EA : 11 11 00            		ld	de,17
(1) 1236/     6ED : 21 98 11            		ld	hl,FMVTBL
(1) 1237/     6F0 : 18 29               		jr	.srch_chnltbl
(1) 1238/     6F2 :                     .srch_fm3:
(1) 1239/     6F2 : 11 11 00            		ld	de,17		; TODO: don't autosearch this
(1) 1240/     6F5 : 21 DC 11            		ld	hl,FM3VTBL
(1) 1241/     6F8 : 18 21               		jr	.srch_chnltbl
(1) 1242/     6FA :                     .srch_fm6:
(1) 1243/     6FA : 11 11 00            		ld	de,17		; TODO: same thing
(1) 1244/     6FD : 21 ED 11            		ld	hl,FM6VTBL
(1) 1245/     700 : 18 19               		jr	.srch_chnltbl
(1) 1246/     702 :                     .srch_pwm:
(1) 1247/     702 : 11 08 00            		ld	de,8
(1) 1248/     705 : 21 FF 11            		ld	hl,PWMVTBL
(1) 1249/     708 : 18 11               		jr	.srch_chnltbl
(1) 1250/     70A :                     
(1) 1251/     70A :                     ; ----------------------------------------
(1) 1252/     70A :                     
(1) 1253/     70A :                     .psgvoltbl:
(1) 1254/     70A : F0                  		db 0F0h
(1) 1255/     70B : F0                  		db 0F0h
(1) 1256/     70C : E0                  		db 0E0h
(1) 1257/     70D : D0                  		db 0D0h
(1) 1258/     70E : C0                  		db 0C0h
(1) 1259/     70F : B0                  		db 0B0h
(1) 1260/     710 : A0                  		db 0A0h
(1) 1261/     711 : 90                  		db 090h
(1) 1262/     712 : 80                  		db 080h
(1) 1263/     713 : 70                  		db 070h
(1) 1264/     714 : 60                  		db 060h
(1) 1265/     715 : 50                  		db 050h
(1) 1266/     716 : 40                  		db 040h
(1) 1267/     717 : 30                  		db 030h
(1) 1268/     718 : 20                  		db 020h
(1) 1269/     719 : 10                  		db 010h
(1) 1270/     71A : 00                  		db 000h
(1) 1271/     71B :                     
(1) 1272/     71B :                     ; ----------------------------------------
(1) 1273/     71B :                     ; iy - track channel data
(1) 1274/     71B :                     ; de - Slot incrm
(1) 1275/     71B :                     ; hl - table
(1) 1276/     71B :                     ;
(1) 1277/     71B :                     ; Returns
(1) 1278/     71B :                     ; a  - Status: -1: error
(1) 1279/     71B :                     ;               0: ok
(1) 1280/     71B :                     ; hl - slot
(1) 1281/     71B :                     ; ----------------------------------------
(1) 1282/     71B :                     
(1) 1283/     71B :                     .srch_chnltbl:
(1) 1284/     71B : CD 9C 0E            		call	dac_fill
(1) 1285/     71E : 22 32 00            		ld	(currTblSrch),hl	; save base hl
(1) 1286/     721 : FD E5               		push	iy
(1) 1287/     723 : C1                  		pop	bc
(1) 1288/     724 :                     ; first search:
(1) 1289/     724 :                     ; check for linked track channel
(1) 1290/     724 :                     .l_lp:
(1) 1291/     724 : CD 88 0E            		call	dac_me
(1) 1292/     727 : 7E                  		ld	a,(hl)
(1) 1293/     728 : FE FF               		cp	-1
(1) 1294/     72A : CA 43 07            		jp	z,.nolnk
(1) 1295/     72D : 23                  		inc	hl
(1) 1296/     72E : 23                  		inc	hl
(1) 1297/     72F : 7E                  		ld	a,(hl)
(1) 1298/     730 : 2B                  		dec	hl
(1) 1299/     731 : 2B                  		dec	hl
(1) 1300/     732 : B8                  		cp	b
(1) 1301/     733 : 20 0B               		jr	nz,.ngood
(1) 1302/     735 : CD 88 0E            		call	dac_me
(1) 1303/     738 : 00                  		nop
(1) 1304/     739 : 23                  		inc	hl
(1) 1305/     73A : 7E                  		ld	a,(hl)
(1) 1306/     73B : 2B                  		dec	hl
(1) 1307/     73C : B9                  		cp	c
(1) 1308/     73D : CA 62 07            		jp	z,.setgood
(1) 1309/     740 :                     .ngood:					; if it's ours, use it
(1) 1310/     740 : 19                  		add	hl,de
(1) 1311/     741 : 18 E1               		jr	.l_lp
(1) 1312/     743 :                     
(1) 1313/     743 :                     .nolnk:
(1) 1314/     743 : 2A 32 00            		ld	hl,(currTblSrch)
(1) 1315/     746 :                     
(1) 1316/     746 :                     ; second search:
(1) 1317/     746 :                     ; assign current track channel to a
(1) 1318/     746 :                     ; new sound channel
(1) 1319/     746 :                     .f_lp:
(1) 1320/     746 : 7E                  		ld	a,(hl)
(1) 1321/     747 : FE FF               		cp	-1
(1) 1322/     749 : C8                  		ret	z
(1) 1323/     74A : CD 88 0E            		call	dac_me
(1) 1324/     74D : 7E                  		ld	a,(hl)
(1) 1325/     74E : B7                  		or	a
(1) 1326/     74F : F2 55 07            		jp	p,.newp
(1) 1327/     752 : 19                  		add	hl,de
(1) 1328/     753 : 18 F1               		jr	.f_lp
(1) 1329/     755 :                     .newp:
(1) 1330/     755 : 7E                  		ld	a,(hl)		; lock this channel
(1) 1331/     756 : F6 80               		or	80h
(1) 1332/     758 : 77                  		ld	(hl),a
(1) 1333/     759 : 23                  		inc	hl
(1) 1334/     75A : 71                  		ld	(hl),c		; set owner LSB
(1) 1335/     75B : 23                  		inc	hl
(1) 1336/     75C : 70                  		ld	(hl),b		; and MSB
(1) 1337/     75D : 2B                  		dec	hl
(1) 1338/     75E : 2B                  		dec	hl
(1) 1339/     75F : CD 88 0E            		call	dac_me
(1) 1340/     762 :                     .setgood:
(1) 1341/     762 : AF                  		xor	a
(1) 1342/     763 : C9                  		ret
(1) 1343/     764 :                     
(1) 1344/     764 :                     ; --------------------------------------------------------
(1) 1345/     764 :                     ; Read track data
(1) 1346/     764 :                     ; --------------------------------------------------------
(1) 1347/     764 :                     
(1) 1348/     764 :                     updtrack:
(1) 1349/     764 : CD 88 0E            		call	dac_me
(1) 1350/     767 : FD 21 00 18         		ld	iy,trkBuff
(1) 1351/     76B : 21 00 1A            		ld	hl,blkHeadC
(1) 1352/     76E : 11 00 16            		ld	de,trkDataC
(1) 1353/     771 : 01 00 1C            		ld	bc,insDataC
(1) 1354/     774 : 22 14 00            		ld	(currTrkBlkHd),hl
(1) 1355/     777 : ED 53 16 00         		ld	(currTrkData),de
(1) 1356/     77B : ED 43 18 00         		ld	(currInsData),bc
(1) 1357/     77F : 06 02               		ld	b,MAX_TRKS
(1) 1358/     781 :                     .next:
(1) 1359/     781 : C5                  		push	bc
(1) 1360/     782 : CD AF 07            		call	.read_track
(1) 1361/     785 : C1                  		pop	bc
(1) 1362/     786 : CD 88 0E            		call	dac_me
(1) 1363/     789 :                     
(1) 1364/     789 :                     	; Next blocks
(1) 1365/     789 : 11 00 01            		ld	de,100h
(1) 1366/     78C : FD 19               		add	iy,de
(1) 1367/     78E : 2A 16 00            		ld	hl,(currTrkData)
(1) 1368/     791 : 19                  		add	hl,de
(1) 1369/     792 : 22 16 00            		ld	(currTrkData),hl
(1) 1370/     795 : 11 00 01            		ld	de,100h
(1) 1371/     798 : 2A 14 00            		ld	hl,(currTrkBlkHd)
(1) 1372/     79B : 19                  		add	hl,de
(1) 1373/     79C : CD 88 0E            		call	dac_me
(1) 1374/     79F : 22 14 00            		ld	(currTrkBlkHd),hl
(1) 1375/     7A2 : 11 80 00            		ld	de,80h
(1) 1376/     7A5 : 2A 18 00            		ld	hl,(currInsData)
(1) 1377/     7A8 : 19                  		add	hl,de
(1) 1378/     7A9 : 22 18 00            		ld	(currInsData),hl
(1) 1379/     7AC : 10 D3               		djnz	.next
(1) 1380/     7AE : C9                  		ret
(1) 1381/     7AF :                     
(1) 1382/     7AF :                     ; ----------------------------------------
(1) 1383/     7AF :                     ; Read current track
(1) 1384/     7AF :                     ; ----------------------------------------
(1) 1385/     7AF :                     
(1) 1386/     7AF :                     .read_track:
(1) 1387/     7AF : CD 88 0E            		call	dac_me
(1) 1388/     7B2 : FD 46 13            		ld	b,(iy+trk_status)	; b - Track status
(1) 1389/     7B5 : CB 78               		bit	7,b			; Active?
(1) 1390/     7B7 : C8                  		ret	z
(1) 1391/     7B8 : 3A 21 00            		ld	a,(currTickBits)
(1) 1392/     7BB : CB 68               		bit	5,b			; Status: sfx mode?
(1) 1393/     7BD : C2 C3 07            		jp	nz,.sfxmd
(1) 1394/     7C0 : 00                  		nop
(1) 1395/     7C1 : 00                  		nop
(1) 1396/     7C2 : 00                  		nop
(1) 1397/     7C3 :                     ; 		bit	1,a			; BEAT passed?
(1) 1398/     7C3 :                     ; 		ret	z
(1) 1399/     7C3 :                     .sfxmd:
(1) 1400/     7C3 : CB 47               		bit	0,a			; TICK passed?
(1) 1401/     7C5 : C8                  		ret	z
(1) 1402/     7C6 : CB 70               		bit	6,b			; Restart/First time?
(1) 1403/     7C8 : C4 BA 09            		call	nz,.first_fill
(1) 1404/     7CB : FD 7E 14            		ld	a,(iy+trk_tickTmr)	; Tick timer for this track
(1) 1405/     7CE : 3D                  		dec	a
(1) 1406/     7CF : FD 77 14            		ld	(iy+trk_tickTmr),a	; If 0, we can progress
(1) 1407/     7D2 : B7                  		or	a
(1) 1408/     7D3 : C0                  		ret	nz
(1) 1409/     7D4 : FD 7E 15            		ld	a,(iy+trk_tickSet)	; Set new tick timer
(1) 1410/     7D7 : FD 77 14            		ld	(iy+trk_tickTmr),a
(1) 1411/     7DA : CD 88 0E            		call	dac_me
(1) 1412/     7DD : FD 6E 0C            		ld	l,(iy+trk_Read)		; hl - Pattern data to read in cache
(1) 1413/     7E0 : FD 66 0D            		ld	h,(iy+((trk_Read+1)))
(1) 1414/     7E3 : FD 4E 0E            		ld	c,(iy+trk_Rows)		; Check if this pattern finished
(1) 1415/     7E6 : FD 46 0F            		ld	b,(iy+(trk_Rows+1))
(1) 1416/     7E9 : 79                  		ld	a,c
(1) 1417/     7EA : B0                  		or	b
(1) 1418/     7EB : CC 21 09            		call	z,.next_track
(1) 1419/     7EE : CD 88 0E            		call	dac_me
(1) 1420/     7F1 :                     
(1) 1421/     7F1 :                     ; --------------------------------
(1) 1422/     7F1 :                     ; Main reading loop
(1) 1423/     7F1 :                     ; --------------------------------
(1) 1424/     7F1 :                     
(1) 1425/     7F1 :                     .next_note:
(1) 1426/     7F1 : 7E                  		ld	a,(hl)			; Check if timer or note
(1) 1427/     7F2 : B7                  		or	a
(1) 1428/     7F3 : CA A0 08            		jp	z,.exit			; If == 00h: exit
(1) 1429/     7F6 : FA 02 08            		jp	m,.is_note		; If 80h-0FFh: note data, 01h-7Fh: timer
(1) 1430/     7F9 : 7E                  		ld	a,(hl)			; Countdown
(1) 1431/     7FA : 3D                  		dec	a
(1) 1432/     7FB : 77                  		ld	(hl),a
(1) 1433/     7FC : CD 88 0E            		call	dac_me
(1) 1434/     7FF : C3 A9 08            		jp	.decrow
(1) 1435/     802 :                     .is_note:
(1) 1436/     802 : C5                  		push	bc
(1) 1437/     803 : 4F                  		ld	c,a			; c - Copy of control+channel
(1) 1438/     804 : CD B4 08            		call	.inc_cpatt
(1) 1439/     807 : 79                  		ld	a,c
(1) 1440/     808 : FD E5               		push	iy
(1) 1441/     80A : DD E1               		pop	ix
(1) 1442/     80C : 11 20 00            		ld	de,20h
(1) 1443/     80F : DD 19               		add	ix,de
(1) 1444/     811 : CD 88 0E            		call	dac_me
(1) 1445/     814 : 16 00               		ld 	d,0
(1) 1446/     816 : E6 3F               		and	00111111b
(1) 1447/     818 : 87                  		add	a,a			; * 8
(1) 1448/     819 : 87                  		add	a,a
(1) 1449/     81A : 87                  		add	a,a
(1) 1450/     81B : 5F                  		ld	e,a
(1) 1451/     81C : DD 19               		add	ix,de
(1) 1452/     81E :                     ; 		ld	a,c
(1) 1453/     81E :                     ; 		and	00111111b
(1) 1454/     81E :                     ; 		inc	a
(1) 1455/     81E :                     ; 		ld	(ix+chnl_Chip),a
(1) 1456/     81E : CD 88 0E            		call	dac_me
(1) 1457/     821 : DD 46 01            		ld	b,(ix+chnl_Type)	; b - our current Note type
(1) 1458/     824 : CB 71               		bit	6,c			; Next byte is new type?
(1) 1459/     826 : CA 2F 08            		jp	z,.old_type
(1) 1460/     829 : 7E                  		ld	a,(hl)			;
(1) 1461/     82A : DD 77 01            		ld	(ix+chnl_Type),a
(1) 1462/     82D : 47                  		ld	b,a
(1) 1463/     82E : 2C                  		inc 	l
(1) 1464/     82F :                     .old_type:
(1) 1465/     82F :                     
(1) 1466/     82F :                     	; b - evinEVIN
(1) 1467/     82F :                     	;     E-effect/V-volume/I-instrument/N-note
(1) 1468/     82F :                     	;     evin: recycle value stored on the buffer
(1) 1469/     82F :                     	;     EVIN: next byte(for eff:2 bytes) contains new value
(1) 1470/     82F : CD 88 0E            		call	dac_me
(1) 1471/     832 : CB 40               		bit	0,b
(1) 1472/     834 : CA 3E 08            		jp	z,.no_note
(1) 1473/     837 : 7E                  		ld	a,(hl)
(1) 1474/     838 : DD 77 02            		ld	(ix+chnl_Note),a
(1) 1475/     83B : CD B4 08            		call	.inc_cpatt
(1) 1476/     83E :                     .no_note:
(1) 1477/     83E :                     ; 		call	dac_me
(1) 1478/     83E : CB 48               		bit	1,b
(1) 1479/     840 : CA 4A 08            		jp	z,.no_ins
(1) 1480/     843 : 7E                  		ld	a,(hl)
(1) 1481/     844 : DD 77 03            		ld	(ix+chnl_Ins),a
(1) 1482/     847 : CD B4 08            		call	.inc_cpatt
(1) 1483/     84A :                     .no_ins:
(1) 1484/     84A :                     ; 		call	dac_me
(1) 1485/     84A : CB 50               		bit	2,b
(1) 1486/     84C : CA 56 08            		jp	z,.no_vol
(1) 1487/     84F : 7E                  		ld	a,(hl)
(1) 1488/     850 : DD 77 04            		ld	(ix+chnl_Vol),a
(1) 1489/     853 : CD B4 08            		call	.inc_cpatt
(1) 1490/     856 :                     .no_vol:
(1) 1491/     856 :                     ; 		call	dac_me
(1) 1492/     856 : CB 58               		bit	3,b
(1) 1493/     858 : CA 69 08            		jp	z,.no_eff
(1) 1494/     85B : 7E                  		ld	a,(hl)
(1) 1495/     85C : DD 77 05            		ld	(ix+chnl_EffId),a
(1) 1496/     85F : CD B4 08            		call	.inc_cpatt
(1) 1497/     862 : 7E                  		ld	a,(hl)
(1) 1498/     863 : DD 77 06            		ld	(ix+chnl_EffArg),a
(1) 1499/     866 : CD B4 08            		call	.inc_cpatt
(1) 1500/     869 :                     .no_eff:
(1) 1501/     869 : CD 88 0E            		call	dac_me
(1) 1502/     86C : 78                  		ld	a,b			; Merge recycle bits to main bits
(1) 1503/     86D : CB 3F               		srl	a
(1) 1504/     86F : CB 3F               		srl	a
(1) 1505/     871 : CB 3F               		srl	a
(1) 1506/     873 : CB 3F               		srl	a
(1) 1507/     875 : E6 0F               		and	1111b
(1) 1508/     877 : CD 88 0E            		call	dac_me
(1) 1509/     87A : 4F                  		ld	c,a
(1) 1510/     87B : 78                  		ld	a,b
(1) 1511/     87C : E6 0F               		and	1111b
(1) 1512/     87E : B1                  		or	c
(1) 1513/     87F : 4F                  		ld	c,a
(1) 1514/     880 : CD 88 0E            		call	dac_me
(1) 1515/     883 : DD 7E 07            		ld	a,(ix+chnl_Status)
(1) 1516/     886 : B1                  		or	c
(1) 1517/     887 : DD 77 07            		ld	(ix+chnl_Status),a
(1) 1518/     88A : C1                  		pop	bc
(1) 1519/     88B :                     
(1) 1520/     88B :                     	; Special checks
(1) 1521/     88B : B7                  		or	a
(1) 1522/     88C : CA 97 08            		jp	z,.no_updst
(1) 1523/     88F :                     ; 		cp	-2
(1) 1524/     88F :                     ; 		jp	z,.id_off
(1) 1525/     88F :                     ; 		cp	-1
(1) 1526/     88F :                     ; 		jp	nz,.id_stlon
(1) 1527/     88F :                     ; .id_off:
(1) 1528/     88F :                     ; 		ld	(ix+chnl_Chip),0
(1) 1529/     88F :                     ; .id_stlon:
(1) 1530/     88F : DD 7E 05            		ld	a,(ix+chnl_EffId)
(1) 1531/     892 : FE 02               		cp	2			; Effect B: position jump?
(1) 1532/     894 : CC F2 08            		call	z,.eff_B
(1) 1533/     897 :                     .no_updst:
(1) 1534/     897 : CD 9C 0E            		call	dac_fill
(1) 1535/     89A : CD 88 0E            		call	dac_me
(1) 1536/     89D : C3 F1 07            		jp	.next_note
(1) 1537/     8A0 :                     
(1) 1538/     8A0 :                     ; --------------------------------
(1) 1539/     8A0 :                     ; Exit
(1) 1540/     8A0 :                     ; --------------------------------
(1) 1541/     8A0 :                     
(1) 1542/     8A0 :                     .exit:
(1) 1543/     8A0 : CD B4 08            		call	.inc_cpatt
(1) 1544/     8A3 : FD 75 0C            		ld	(iy+trk_Read),l		; Update read location
(1) 1545/     8A6 : FD 74 0D            		ld	(iy+((trk_Read+1))),h
(1) 1546/     8A9 :                     .decrow:
(1) 1547/     8A9 : CD 88 0E            		call	dac_me
(1) 1548/     8AC : 0B                  		dec	bc			; Decrement this row
(1) 1549/     8AD : FD 71 0E            		ld	(iy+trk_Rows),c		; And update it
(1) 1550/     8B0 : FD 70 0F            		ld	(iy+(trk_Rows+1)),b
(1) 1551/     8B3 : C9                  		ret
(1) 1552/     8B4 :                     
(1) 1553/     8B4 :                     ; ----------------------------------------
(1) 1554/     8B4 :                     ; Call this to increment the
(1) 1555/     8B4 :                     ; cache pattern read pointer (iy+trk_Read)
(1) 1556/     8B4 :                     ; it also refills the next section to
(1) 1557/     8B4 :                     ; read if needed.
(1) 1558/     8B4 :                     ;
(1) 1559/     8B4 :                     ; NOTE: breaks A
(1) 1560/     8B4 :                     ; ----------------------------------------
(1) 1561/     8B4 :                     
(1) 1562/     8B4 :                     .inc_cpatt:
(1) 1563/     8B4 : 2C                  		inc	l
(1) 1564/     8B5 : FD 7E 10            		ld	a,(iy+trk_Halfway)
(1) 1565/     8B8 : AD                  		xor	l
(1) 1566/     8B9 : E6 80               		and	080h
(1) 1567/     8BB : C8                  		ret	z
(1) 1568/     8BC :                     
(1) 1569/     8BC : CD 9C 0E            		call	dac_fill
(1) 1570/     8BF : CD 88 0E            		call	dac_me
(1) 1571/     8C2 : E5                  		push	hl
(1) 1572/     8C3 : C5                  		push	bc
(1) 1573/     8C4 : 54                  		ld	d,h
(1) 1574/     8C5 : FD 7E 10            		ld	a,(iy+trk_Halfway)
(1) 1575/     8C8 : 5F                  		ld	e,a
(1) 1576/     8C9 : C6 80               		add 	a,080h
(1) 1577/     8CB : FD 77 10            		ld	(iy+trk_Halfway),a
(1) 1578/     8CE : 01 80 00            		ld	bc,80h
(1) 1579/     8D1 : FD 6E 09            		ld	l,(iy+trk_romPattRd)
(1) 1580/     8D4 : CD 88 0E            		call	dac_me
(1) 1581/     8D7 : FD 66 0A            		ld	h,(iy+(trk_romPattRd+1))
(1) 1582/     8DA : FD 7E 0B            		ld	a,(iy+(trk_romPattRd+2))
(1) 1583/     8DD : 09                  		add	hl,bc
(1) 1584/     8DE : CE 00               		adc	a,0
(1) 1585/     8E0 : FD 75 09            		ld	(iy+trk_romPattRd),l
(1) 1586/     8E3 : FD 74 0A            		ld	(iy+(trk_romPattRd+1)),h
(1) 1587/     8E6 : FD 77 0B            		ld	(iy+(trk_romPattRd+2)),a
(1) 1588/     8E9 : CD FB 0B            		call	transferRom
(1) 1589/     8EC : CD 88 0E            		call	dac_me
(1) 1590/     8EF : C1                  		pop	bc
(1) 1591/     8F0 : E1                  		pop	hl
(1) 1592/     8F1 : C9                  		ret
(1) 1593/     8F2 :                     
(1) 1594/     8F2 :                     ; ----------------------------------------
(1) 1595/     8F2 :                     ; If effect B: jump to the block
(1) 1596/     8F2 :                     ; requested by the effect
(1) 1597/     8F2 :                     ; ----------------------------------------
(1) 1598/     8F2 :                     
(1) 1599/     8F2 :                     .eff_B:
(1) 1600/     8F2 : DD 7E 06            		ld	a,(ix+chnl_EffArg)
(1) 1601/     8F5 : FD 77 11            		ld 	(iy+trk_currBlk),a
(1) 1602/     8F8 : FD E5               		push	iy			; Clear all channels first
(1) 1603/     8FA : DD E1               		pop	ix
(1) 1604/     8FC : 11 20 00            		ld	de,20h
(1) 1605/     8FF : DD 19               		add	ix,de
(1) 1606/     901 : 11 08 00            		ld	de,8
(1) 1607/     904 : AF                  		xor	a
(1) 1608/     905 : 06 48               		ld	b,MAX_TRKCHN*8/2
(1) 1609/     907 :                     .clrf2:
(1) 1610/     907 : DD 77 00            		ld	(ix),a
(1) 1611/     90A : DD 23               		inc	ix
(1) 1612/     90C : CD 88 0E            		call	dac_me
(1) 1613/     90F : 00                  		nop
(1) 1614/     910 : DD 77 00            		ld	(ix),a
(1) 1615/     913 : DD 23               		inc	ix
(1) 1616/     915 : 10 F0               		djnz	.clrf2
(1) 1617/     917 : 00                  		nop
(1) 1618/     918 : 00                  		nop
(1) 1619/     919 : CD 88 0E            		call	dac_me
(1) 1620/     91C : FD 7E 11            		ld	a,(iy+trk_currBlk)
(1) 1621/     91F : 18 07               		jr	.set_track
(1) 1622/     921 :                     
(1) 1623/     921 :                     ; ----------------------------------------
(1) 1624/     921 :                     ; If pattern finished, load the next one
(1) 1625/     921 :                     ; ----------------------------------------
(1) 1626/     921 :                     
(1) 1627/     921 :                     .next_track:
(1) 1628/     921 : FD 7E 11            		ld	a,(iy+trk_currBlk)
(1) 1629/     924 : 3C                  		inc	a
(1) 1630/     925 : FD 77 11            		ld 	(iy+trk_currBlk),a
(1) 1631/     928 :                     
(1) 1632/     928 :                     .set_track:
(1) 1633/     928 : CD 88 0E            		call	dac_me
(1) 1634/     92B : 2E 80               		ld	l,80h			; Set LSB as 40h
(1) 1635/     92D : FD 75 0C            		ld	(iy+trk_Read),l
(1) 1636/     930 : E5                  		push	hl
(1) 1637/     931 : CD 88 0E            		call	dac_me
(1) 1638/     934 : 2A 14 00            		ld	hl,(currTrkBlkHd)	; Block section
(1) 1639/     937 : 11 00 00            		ld	de,0
(1) 1640/     93A : 5F                  		ld	e,a
(1) 1641/     93B : AF                  		xor	a			; Reset halfway, next pass
(1) 1642/     93C : FD 77 10            		ld	(iy+trk_Halfway),a	; will load the first section
(1) 1643/     93F : 19                  		add	hl,de
(1) 1644/     940 : 7E                  		ld	a,(hl)			; a - block
(1) 1645/     941 : E1                  		pop	hl
(1) 1646/     942 : FE FF               		cp	-1
(1) 1647/     944 : CA 9C 09            		jp	z,.track_end
(1) 1648/     947 : 2A 14 00            		ld	hl,(currTrkBlkHd)	; Header section
(1) 1649/     94A : CD 88 0E            		call	dac_me
(1) 1650/     94D : 11 80 00            		ld	de,80h
(1) 1651/     950 : 19                  		add	hl,de
(1) 1652/     951 : 87                  		add	a,a
(1) 1653/     952 : 87                  		add	a,a
(1) 1654/     953 : 5F                  		ld	e,a			; block * 4
(1) 1655/     954 : 19                  		add	hl,de
(1) 1656/     955 : 4E                  		ld	c,(hl)
(1) 1657/     956 : 23                  		inc	hl
(1) 1658/     957 : 46                  		ld	b,(hl)			; bc - numof Rows
(1) 1659/     958 : 23                  		inc	hl
(1) 1660/     959 : CD 88 0E            		call	dac_me
(1) 1661/     95C : 5E                  		ld	e,(hl)
(1) 1662/     95D : 23                  		inc	hl
(1) 1663/     95E : 56                  		ld	d,(hl)			; de - pointer (base+increment by this)
(1) 1664/     95F : FD 71 0E            		ld	(iy+trk_Rows),c		; Save this number of rows
(1) 1665/     962 : FD 70 0F            		ld	(iy+(trk_Rows+1)),b
(1) 1666/     965 : FD 6E 03            		ld	l,(iy+trk_romPatt)	; hl - Low and Mid pointer of ROM patt data
(1) 1667/     968 : FD 66 04            		ld	h,(iy+(trk_romPatt+1))
(1) 1668/     96B : FD 7E 05            		ld	a,(iy+(trk_romPatt+2))
(1) 1669/     96E : 19                  		add	hl,de			; increment to get new pointer
(1) 1670/     96F : CE 00               		adc	a,0			; and highest byte too.
(1) 1671/     971 : FD 75 09            		ld	(iy+trk_romPattRd),l	; Save copy of the pointer
(1) 1672/     974 : FD 74 0A            		ld	(iy+(trk_romPattRd+1)),h
(1) 1673/     977 : FD 77 0B            		ld	(iy+(trk_romPattRd+2)),a
(1) 1674/     97A : FD 56 0D            		ld	d,(iy+(trk_Read+1))
(1) 1675/     97D : FD 5E 0C            		ld	e,(iy+trk_Read)
(1) 1676/     980 : 01 80 00            		ld	bc,080h			; bc - 080h
(1) 1677/     983 : CD 9C 0E            		call	dac_fill
(1) 1678/     986 : CD FB 0B            		call	transferRom
(1) 1679/     989 : CD 88 0E            		call	dac_me
(1) 1680/     98C : FD 66 0D            		ld	h,(iy+(trk_Read+1))
(1) 1681/     98F : FD 6E 0C            		ld	l,(iy+trk_Read)
(1) 1682/     992 : FD 4E 0E            		ld	c,(iy+trk_Rows)		; Check if this pattern finished
(1) 1683/     995 : FD 46 0F            		ld	b,(iy+(trk_Rows+1))
(1) 1684/     998 : CD 88 0E            		call	dac_me
(1) 1685/     99B : C9                  		ret
(1) 1686/     99C :                     
(1) 1687/     99C :                     ; If -1, track ends
(1) 1688/     99C :                     .track_end:
(1) 1689/     99C : FD E5               		push	iy
(1) 1690/     99E : DD E1               		pop	ix
(1) 1691/     9A0 : 11 20 00            		ld	de,20h
(1) 1692/     9A3 : DD 19               		add	ix,de
(1) 1693/     9A5 : 11 08 00            		ld	de,8
(1) 1694/     9A8 : AF                  		xor	a
(1) 1695/     9A9 : 06 12               		ld	b,MAX_TRKCHN
(1) 1696/     9AB :                     .clrfe:
(1) 1697/     9AB : DD 77 00            		ld	(ix),a
(1) 1698/     9AE : DD 19               		add	ix,de
(1) 1699/     9B0 : 10 F9               		djnz	.clrfe
(1) 1700/     9B2 : CD 88 0E            		call	dac_me
(1) 1701/     9B5 : FD 36 13 00         		ld	(iy+trk_status),0
(1) 1702/     9B9 : C9                  		ret
(1) 1703/     9BA :                     
(1) 1704/     9BA :                     ; ----------------------------------------
(1) 1705/     9BA :                     ; Playing first time
(1) 1706/     9BA :                     ; Load Blocks/Pointers for 3 of 4 sections
(1) 1707/     9BA :                     ; of pattern data, the remaining one is
(1) 1708/     9BA :                     ; loaded after returning.
(1) 1709/     9BA :                     ; ----------------------------------------
(1) 1710/     9BA :                     
(1) 1711/     9BA :                     .first_fill:
(1) 1712/     9BA : CD 9C 0E            		call	dac_fill
(1) 1713/     9BD : CD 88 0E            		call	dac_me
(1) 1714/     9C0 : CB B0               		res	6,b			; Reset FILL flag
(1) 1715/     9C2 : FD 70 13            		ld	(iy+trk_status),b
(1) 1716/     9C5 :                     
(1) 1717/     9C5 :                     	; Stop last used sound chips
(1) 1718/     9C5 : FD E5               		push	iy
(1) 1719/     9C7 : DD E1               		pop	ix
(1) 1720/     9C9 : 11 20 00            		ld	de,20h
(1) 1721/     9CC : DD 19               		add	ix,de
(1) 1722/     9CE : 11 08 00            		ld	de,8
(1) 1723/     9D1 : 06 12               		ld	b,MAX_TRKCHN
(1) 1724/     9D3 :                     .clrf:
(1) 1725/     9D3 : D5                  		push	de
(1) 1726/     9D4 : DD 7E 00            		ld	a,(ix+chnl_Chip)
(1) 1727/     9D7 : B7                  		or	a
(1) 1728/     9D8 : C4 9F 0A            		call	nz,.silnc_chip
(1) 1729/     9DB : DD 36 02 FE         		ld	(ix+chnl_Note),-2
(1) 1730/     9DF : DD 36 07 03         		ld	(ix+chnl_Status),11b
(1) 1731/     9E3 : D1                  		pop	de
(1) 1732/     9E4 : DD 19               		add	ix,de
(1) 1733/     9E6 : 10 EB               		djnz	.clrf
(1) 1734/     9E8 :                     
(1) 1735/     9E8 :                     	; TODO: psgHat lock check
(1) 1736/     9E8 : AF                  		xor	a
(1) 1737/     9E9 :                     ; 		ld	hl,psgHatMode+1
(1) 1738/     9E9 :                     ; 		ld	e,(hl)
(1) 1739/     9E9 :                     ; 		inc	hl
(1) 1740/     9E9 :                     ; 		ld	d,(hl)
(1) 1741/     9E9 :                     ; 		dec	hl
(1) 1742/     9E9 :                     ; 		dec	hl
(1) 1743/     9E9 :                     ; 		ld	a,(de)
(1) 1744/     9E9 :                     ; 		or	a
(1) 1745/     9E9 :                     ; 		jp	nz,.inuse
(1) 1746/     9E9 : 32 2F 00            		ld	(psgHatMode),a		; already in use
(1) 1747/     9EC :                     ; .inuse:
(1) 1748/     9EC :                     
(1) 1749/     9EC : FD 7E 12            		ld	a,(iy+trk_setBlk)
(1) 1750/     9EF : FD 77 11            		ld 	(iy+trk_currBlk),a
(1) 1751/     9F2 : FD 77 10            		ld	(iy+trk_Halfway),a	; Reset halfway
(1) 1752/     9F5 : CD 9C 0E            		call	dac_fill
(1) 1753/     9F8 : CD 88 0E            		call	dac_me
(1) 1754/     9FB : FD 6E 06            		ld	l,(iy+trk_romIns)	; Recieve 80h of instrument pointers
(1) 1755/     9FE : FD 66 07            		ld	h,(iy+(trk_romIns+1))
(1) 1756/     A01 : FD 7E 08            		ld	a,(iy+(trk_romIns+2))
(1) 1757/     A04 : ED 5B 18 00         		ld	de,(currInsData)
(1) 1758/     A08 :                     ; 		ld	(reqMarsTrnf),de	; Tell 68k to copy instruments
(1) 1759/     A08 : 01 80 00            		ld	bc,080h
(1) 1760/     A0B : CD FB 0B            		call	transferRom
(1) 1761/     A0E :                     
(1) 1762/     A0E : FD 6E 00            		ld	l,(iy+trk_romBlk)	; Recieve 80h of block data
(1) 1763/     A11 : FD 66 01            		ld	h,(iy+(trk_romBlk+1))
(1) 1764/     A14 : FD 7E 02            		ld	a,(iy+(trk_romBlk+2))
(1) 1765/     A17 : ED 5B 14 00         		ld	de,(currTrkBlkHd)
(1) 1766/     A1B : 01 80 00            		ld	bc,80h
(1) 1767/     A1E : D5                  		push	de
(1) 1768/     A1F : CD FB 0B            		call	transferRom
(1) 1769/     A22 : D1                  		pop	de
(1) 1770/     A23 : CD 9C 0E            		call	dac_fill
(1) 1771/     A26 : CD 88 0E            		call	dac_me
(1) 1772/     A29 : 7B                  		ld	a,e
(1) 1773/     A2A : C6 80               		add	a,80h
(1) 1774/     A2C : 5F                  		ld	e,a
(1) 1775/     A2D : FD 6E 03            		ld	l,(iy+trk_romPatt)	; Recieve 80h of header data
(1) 1776/     A30 : FD 66 04            		ld	h,(iy+(trk_romPatt+1))
(1) 1777/     A33 : FD 7E 05            		ld	a,(iy+(trk_romPatt+2))
(1) 1778/     A36 : 01 80 00            		ld	bc,80h
(1) 1779/     A39 : CD FB 0B            		call	transferRom
(1) 1780/     A3C : 3E 00               		ld	a,0
(1) 1781/     A3E : 2A 14 00            		ld	hl,(currTrkBlkHd)	; Block section
(1) 1782/     A41 : 11 00 00            		ld	de,0
(1) 1783/     A44 : 5F                  		ld	e,a
(1) 1784/     A45 : 19                  		add	hl,de
(1) 1785/     A46 : 7E                  		ld	a,(hl)			; a - block
(1) 1786/     A47 : FE FF               		cp	-1
(1) 1787/     A49 : CA 9C 09            		jp	z,.track_end
(1) 1788/     A4C : CD 9C 0E            		call	dac_fill
(1) 1789/     A4F : CD 88 0E            		call	dac_me
(1) 1790/     A52 : 2A 14 00            		ld	hl,(currTrkBlkHd)	; Header section
(1) 1791/     A55 : 11 80 00            		ld	de,80h
(1) 1792/     A58 : 19                  		add	hl,de
(1) 1793/     A59 : 87                  		add	a,a
(1) 1794/     A5A : 87                  		add	a,a
(1) 1795/     A5B : 5F                  		ld	e,a			; block * 4
(1) 1796/     A5C : 19                  		add	hl,de
(1) 1797/     A5D : 4E                  		ld	c,(hl)
(1) 1798/     A5E : 23                  		inc	hl
(1) 1799/     A5F : 46                  		ld	b,(hl)			; bc - numof Rows
(1) 1800/     A60 : 23                  		inc	hl
(1) 1801/     A61 : 5E                  		ld	e,(hl)
(1) 1802/     A62 : 23                  		inc	hl
(1) 1803/     A63 : 56                  		ld	d,(hl)			; de - pointer (base+increment by this)
(1) 1804/     A64 : FD 71 0E            		ld	(iy+trk_Rows),c		; Save this number of rows
(1) 1805/     A67 : FD 70 0F            		ld	(iy+(trk_Rows+1)),b
(1) 1806/     A6A : CD 88 0E            		call	dac_me
(1) 1807/     A6D : FD 6E 03            		ld	l,(iy+trk_romPatt)	; hl - Low and Mid pointer of ROM patt data
(1) 1808/     A70 : FD 66 04            		ld	h,(iy+(trk_romPatt+1))
(1) 1809/     A73 : FD 7E 05            		ld	a,(iy+(trk_romPatt+2))
(1) 1810/     A76 : 19                  		add	hl,de			; increment to get new pointer
(1) 1811/     A77 : CE 00               		adc	a,0			; and highest byte too.
(1) 1812/     A79 : FD 75 09            		ld	(iy+trk_romPattRd),l	; Save copy of the pointer
(1) 1813/     A7C : FD 74 0A            		ld	(iy+(trk_romPattRd+1)),h
(1) 1814/     A7F : FD 77 0B            		ld	(iy+(trk_romPattRd+2)),a
(1) 1815/     A82 : ED 5B 16 00         		ld	de,(currTrkData)	; Set new Read point to this track
(1) 1816/     A86 : 47                  		ld	b,a
(1) 1817/     A87 : 7B                  		ld	a,e
(1) 1818/     A88 : C6 80               		add	a,80h
(1) 1819/     A8A : 5F                  		ld	e,a
(1) 1820/     A8B : 78                  		ld	a,b
(1) 1821/     A8C : FD 73 0C            		ld	(iy+trk_Read),e
(1) 1822/     A8F : FD 72 0D            		ld	(iy+((trk_Read+1))),d
(1) 1823/     A92 : 01 80 00            		ld	bc,080h			; fill sections 2,3,4
(1) 1824/     A95 : CD 9C 0E            		call	dac_fill
(1) 1825/     A98 : CD 88 0E            		call	dac_me
(1) 1826/     A9B : CD FB 0B            		call	transferRom
(1) 1827/     A9E : C9                  		ret
(1) 1828/     A9F :                     
(1) 1829/     A9F :                     ; c - Chip
(1) 1830/     A9F :                     ; PSG: 80h
(1) 1831/     A9F :                     ; FM:  A0h + fm key
(1) 1832/     A9F :                     ; PWM: C0h
(1) 1833/     A9F :                     
(1) 1834/     A9F :                     .silnc_chip:
(1) 1835/     A9F : 4F                  		ld	c,a
(1) 1836/     AA0 : E6 60               		and	01100000b	; Get curr used chip
(1) 1837/     AA2 : FE 20               		cp	00100000b	; FM?
(1) 1838/     AA4 : 28 40               		jr	z,.sil_fm
(1) 1839/     AA6 : FE 40               		cp	01000000b	; PWM?
(1) 1840/     AA8 : C8                  		ret	z
(1) 1841/     AA9 :                     
(1) 1842/     AA9 :                     	; chip ID: 00b
(1) 1843/     AA9 : 21 8E 11            		ld	hl,PSGNVTBL	; Check for NOISE
(1) 1844/     AAC : 11 09 00            		ld	de,9
(1) 1845/     AAF : CD 28 0B            		call	.chlst_unlk
(1) 1846/     AB2 : E6 83               		and	83h
(1) 1847/     AB4 : FE 83               		cp	83h
(1) 1848/     AB6 : CA C8 0A            		jp	z,.unlknow
(1) 1849/     AB9 : 21 72 11            		ld	hl,PSGVTBL
(1) 1850/     ABC : 11 09 00            		ld	de,9
(1) 1851/     ABF : CD 28 0B            		call	.chlst_unlk
(1) 1852/     AC2 : FE FF               		cp	-1
(1) 1853/     AC4 : C2 C8 0A            		jp	nz,.unlknow
(1) 1854/     AC7 : C9                  		ret
(1) 1855/     AC8 :                     .unlknow:
(1) 1856/     AC8 : 7E                  		ld	a,(hl)
(1) 1857/     AC9 : E6 7F               		and	7Fh
(1) 1858/     ACB : 77                  		ld	(hl),a
(1) 1859/     ACC : 23                  		inc	hl		; delete link
(1) 1860/     ACD : 36 00               		ld	(hl),0
(1) 1861/     ACF : 23                  		inc	hl
(1) 1862/     AD0 : 36 00               		ld	(hl),0
(1) 1863/     AD2 : 23                  		inc	hl		; ALV to 0
(1) 1864/     AD3 : 36 00               		ld	(hl),0
(1) 1865/     AD5 : 23                  		inc	hl		; ATK to 0
(1) 1866/     AD6 : 36 00               		ld	(hl),0
(1) 1867/     AD8 : 79                  		ld	a,c
(1) 1868/     AD9 : E6 03               		and	11b
(1) 1869/     ADB :                     
(1) 1870/     ADB : 21 38 12            		ld	hl,psgcom
(1) 1871/     ADE : 11 00 00            		ld	de,0
(1) 1872/     AE1 : 5F                  		ld	e,a
(1) 1873/     AE2 : 19                  		add	hl,de
(1) 1874/     AE3 : 36 04               		ld	(hl),100b
(1) 1875/     AE5 : C9                  		ret
(1) 1876/     AE6 :                     
(1) 1877/     AE6 :                     ; FM silence
(1) 1878/     AE6 :                     .sil_fm:
(1) 1879/     AE6 : 79                  		ld	a,c
(1) 1880/     AE7 : E6 87               		and	10000111b
(1) 1881/     AE9 : 4F                  		ld	c,a
(1) 1882/     AEA : 11 11 00            		ld	de,17
(1) 1883/     AED : 21 98 11            		ld	hl,FMVTBL
(1) 1884/     AF0 : CD 28 0B            		call	.chlst_unlk
(1) 1885/     AF3 : 79                  		ld	a,c
(1) 1886/     AF4 : E6 03               		and	11b
(1) 1887/     AF6 : 16 40               		ld	d,40h
(1) 1888/     AF8 : B2                  		or	d
(1) 1889/     AF9 : 57                  		ld	d,a
(1) 1890/     AFA : 1E 7F               		ld	e,7Fh
(1) 1891/     AFC : CD 37 0E            		call	fm_autoset		; ix is already our channel
(1) 1892/     AFF : 14                  		inc	d
(1) 1893/     B00 : 14                  		inc	d
(1) 1894/     B01 : 14                  		inc	d
(1) 1895/     B02 : 14                  		inc	d
(1) 1896/     B03 : CD 37 0E            		call	fm_autoset
(1) 1897/     B06 : 14                  		inc	d
(1) 1898/     B07 : 14                  		inc	d
(1) 1899/     B08 : 14                  		inc	d
(1) 1900/     B09 : 14                  		inc	d
(1) 1901/     B0A : CD 37 0E            		call	fm_autoset
(1) 1902/     B0D : 14                  		inc	d
(1) 1903/     B0E : 14                  		inc	d
(1) 1904/     B0F : 14                  		inc	d
(1) 1905/     B10 : 14                  		inc	d
(1) 1906/     B11 : CD 37 0E            		call	fm_autoset
(1) 1907/     B14 : 79                  		ld	a,c
(1) 1908/     B15 : E6 07               		and	111b
(1) 1909/     B17 : 5F                  		ld	e,a
(1) 1910/     B18 : 16 28               		ld	d,28h
(1) 1911/     B1A : CD 3E 0E            		call	fm_send_1
(1) 1912/     B1D : 11 00 28            		ld	de,2800h
(1) 1913/     B20 : 79                  		ld	a,c
(1) 1914/     B21 : E6 07               		and	111b
(1) 1915/     B23 : B3                  		or	e
(1) 1916/     B24 : 5F                  		ld	e,a
(1) 1917/     B25 : C3 3E 0E            		jp	fm_send_1
(1) 1918/     B28 :                     .chlst_unlk:
(1) 1919/     B28 : 7E                  		ld	a,(hl)
(1) 1920/     B29 : FE FF               		cp	-1
(1) 1921/     B2B : C8                  		ret	z
(1) 1922/     B2C : B9                  		cp	c
(1) 1923/     B2D : C8                  		ret	z
(1) 1924/     B2E : 19                  		add	hl,de
(1) 1925/     B2F : 18 F7               		jr	.chlst_unlk
(1) 1926/     B31 :                     
(1) 1927/     B31 :                     ; ; --------------------------------------------------------
(1) 1928/     B31 :                     ; ; For 32X only:
(1) 1929/     B31 :                     ; ; Communicate to Master SH2 using CMD interrupt
(1) 1930/     B31 :                     ; ; --------------------------------------------------------
(1) 1931/     B31 :                     ;
(1) 1932/     B31 :                     ; mars_scomm:
(1) 1933/     B31 :                     ; 		ret
(1) 1934/     B31 :                     ; 		ld	de,(reqMarsTrnf)	; New PWM ins data?
(1) 1935/     B31 :                     ; 		ld	a,e
(1) 1936/     B31 :                     ; 		or	d
(1) 1937/     B31 :                     ; 		jp	z,.playbck
(1) 1938/     B31 :                     ; 		call	dac_fill
(1) 1939/     B31 :                     ; 		ld	hl,(reqMarsTrnf)
(1) 1940/     B31 :                     ; 		ld	c,21h			; 21h: Send copy of Instrlist
(1) 1941/     B31 :                     ; 		ld	b,80h/2			; num of words to transfer
(1) 1942/     B31 :                     ; 		call	mars_zcomm
(1) 1943/     B31 :                     ; 		ld	de,0			; Reset wordflag
(1) 1944/     B31 :                     ; 		ld	(reqMarsTrnf),de
(1) 1945/     B31 :                     ; 		ret
(1) 1946/     B31 :                     ; .playbck:
(1) 1947/     B31 :                     ; 		ld	iy,PWMVTBL
(1) 1948/     B31 :                     ; 		ld	b,7			; 7 channels
(1) 1949/     B31 :                     ; .next:
(1) 1950/     B31 :                     ; 		push	bc
(1) 1951/     B31 :                     ; 		push	iy
(1) 1952/     B31 :                     ; 		ld	a,(iy)
(1) 1953/     B31 :                     ; 		or	a
(1) 1954/     B31 :                     ; 		jp	p,.disbld
(1) 1955/     B31 :                     ; 		and	01100000b
(1) 1956/     B31 :                     ; 		or	a
(1) 1957/     B31 :                     ; 		call	nz,.play
(1) 1958/     B31 :                     ; 		res	6,(iy)
(1) 1959/     B31 :                     ; 		res	5,(iy)
(1) 1960/     B31 :                     ; .disbld:
(1) 1961/     B31 :                     ; 		pop	iy
(1) 1962/     B31 :                     ; 		pop	bc
(1) 1963/     B31 :                     ; 		ld	de,8
(1) 1964/     B31 :                     ; 		call	dac_me
(1) 1965/     B31 :                     ; 		add	iy,de
(1) 1966/     B31 :                     ; 		djnz	.next
(1) 1967/     B31 :                     ;
(1) 1968/     B31 :                     ; ; 	; All this code just to tell SH2
(1) 1969/     B31 :                     ; ; 	; to update PWM list...
(1) 1970/     B31 :                     ; ; 		call	dac_me
(1) 1971/     B31 :                     ; ; 		ld	hl,6000h		; Set bank
(1) 1972/     B31 :                     ; ; 		ld	(hl),0
(1) 1973/     B31 :                     ; ; 		ld	(hl),1
(1) 1974/     B31 :                     ; ; 		ld	(hl),0
(1) 1975/     B31 :                     ; ; 		ld	(hl),0
(1) 1976/     B31 :                     ; ; 		ld	(hl),0
(1) 1977/     B31 :                     ; ; 		ld	(hl),0
(1) 1978/     B31 :                     ; ; 		ld	(hl),1
(1) 1979/     B31 :                     ; ; 		call	dac_me
(1) 1980/     B31 :                     ; ; 		ld	(hl),0
(1) 1981/     B31 :                     ; ; 		ld	(hl),1
(1) 1982/     B31 :                     ; ; 		ld	ix,5100h|8000h		; ix - mars sysreg
(1) 1983/     B31 :                     ; ; .wait_md:	ld	a,(ix+comm8)		; 68k got it first?
(1) 1984/     B31 :                     ; ; 		or	a
(1) 1985/     B31 :                     ; ; 		jp	nz,.wait_md
(1) 1986/     B31 :                     ; ; 		call	dac_me
(1) 1987/     B31 :                     ; ; 		ld	(ix+comm4),20h		; Z80 ready
(1) 1988/     B31 :                     ; ; 		ld	(ix+3),01b		; Master CMD interrupt
(1) 1989/     B31 :                     ; ; .wait_cmd:	bit	0,(ix+3)		; CMD clear?
(1) 1990/     B31 :                     ; ; 		jp	nz,.wait_cmd
(1) 1991/     B31 :                     ; ; 		call	dac_me
(1) 1992/     B31 :                     ; 		ret
(1) 1993/     B31 :                     ;
(1) 1994/     B31 :                     ; ; bit 6
(1) 1995/     B31 :                     ; .play:
(1) 1996/     B31 :                     ; 		ld	a,(iy)
(1) 1997/     B31 :                     ; 		and	00001111b
(1) 1998/     B31 :                     ; 		inc	a
(1) 1999/     B31 :                     ; 		ld	c,a
(1) 2000/     B31 :                     ; 		call	dac_me
(1) 2001/     B31 :                     ; 		push	iy
(1) 2002/     B31 :                     ; 		pop	hl
(1) 2003/     B31 :                     ; 		ld	b,8/2
(1) 2004/     B31 :                     ; 		call	mars_zcomm
(1) 2005/     B31 :                     ; 		ld	a,(iy)
(1) 2006/     B31 :                     ; 		and	10011111b
(1) 2007/     B31 :                     ; 		ld	(iy),a
(1) 2008/     B31 :                     ; 		ret
(1) 2009/     B31 :                     
(1) 2010/     B31 :                     ; ====================================================================
(1) 2011/     B31 :                     ; ----------------------------------------------------------------
(1) 2012/     B31 :                     ; Subroutines
(1) 2013/     B31 :                     ; ----------------------------------------------------------------
(1) 2014/     B31 :                     
(1) 2015/     B31 :                     ; --------------------------------------------------------
(1) 2016/     B31 :                     ; Init sound engine
(1) 2017/     B31 :                     ; --------------------------------------------------------
(1) 2018/     B31 :                     
(1) 2019/     B31 :                     gema_init:
(1) 2020/     B31 : CD DB 0C            		call	dac_off
(1) 2021/     B34 : 3E 9F               		ld	a,09Fh
(1) 2022/     B36 : 32 11 7F            		ld	(Zpsg_ctrl),a
(1) 2023/     B39 : 3E BF               		ld	a,0BFh
(1) 2024/     B3B : 32 11 7F            		ld	(Zpsg_ctrl),a
(1) 2025/     B3E : 3E DF               		ld	a,0DFh
(1) 2026/     B40 : 32 11 7F            		ld	(Zpsg_ctrl),a
(1) 2027/     B43 : 3E FF               		ld	a,0FFh
(1) 2028/     B45 : 32 11 7F            		ld	(Zpsg_ctrl),a
(1) 2029/     B48 : 11 00 27            		ld	de,2700h
(1) 2030/     B4B : CD 3E 0E            		call	fm_send_1
(1) 2031/     B4E : 11 00 28            		ld	de,2800h
(1) 2032/     B51 : CD 3E 0E            		call	fm_send_1
(1) 2033/     B54 : 11 01 28            		ld	de,2801h
(1) 2034/     B57 : CD 3E 0E            		call	fm_send_1
(1) 2035/     B5A : 11 02 28            		ld	de,2802h
(1) 2036/     B5D : CD 3E 0E            		call	fm_send_1
(1) 2037/     B60 : 11 04 28            		ld	de,2804h
(1) 2038/     B63 : CD 3E 0E            		call	fm_send_1
(1) 2039/     B66 : 11 05 28            		ld	de,2805h
(1) 2040/     B69 : CD 3E 0E            		call	fm_send_1
(1) 2041/     B6C : 11 06 28            		ld	de,2806h
(1) 2042/     B6F : CD 3E 0E            		call	fm_send_1
(1) 2043/     B72 : 11 00 2B            		ld	de,2B00h
(1) 2044/     B75 : CD 3E 0E            		call	fm_send_1
(1) 2045/     B78 : 21 00 15            		ld	hl,dWaveBuff			; Initilize WAVE FIFO
(1) 2046/     B7B : 11 01 15            		ld	de,dWaveBuff+1
(1) 2047/     B7E : 01 FF 00            		ld	bc,100h-1
(1) 2048/     B81 : 36 80               		ld	(hl),80h
(1) 2049/     B83 : ED B0               		ldir
(1) 2050/     B85 : C9                  		ret
(1) 2051/     B86 :                     
(1) 2052/     B86 :                     ; --------------------------------------------------------
(1) 2053/     B86 :                     ; Read cmd byte, auto re-aligns to 7Fh
(1) 2054/     B86 :                     ; --------------------------------------------------------
(1) 2055/     B86 :                     
(1) 2056/     B86 :                     get_cmdbyte:
(1) 2057/     B86 : C5                  		push	bc
(1) 2058/     B87 : D5                  		push	de
(1) 2059/     B88 : E5                  		push	hl
(1) 2060/     B89 :                     .getcbytel:
(1) 2061/     B89 : CD 88 0E            		call	dac_me
(1) 2062/     B8C : CD 9C 0E            		call	dac_fill
(1) 2063/     B8F : 3A 2C 00            		ld	a,(commZWrite)
(1) 2064/     B92 : 47                  		ld	b,a
(1) 2065/     B93 : 3A 2B 00            		ld	a,(commZRead)
(1) 2066/     B96 : B8                  		cp	b
(1) 2067/     B97 : CA 89 0B            		jp	z,.getcbytel		; wait for a command from 68k
(1) 2068/     B9A : 06 00               		ld	b,0
(1) 2069/     B9C : 4F                  		ld	c,a
(1) 2070/     B9D : 21 00 1D            		ld	hl,commZfifo
(1) 2071/     BA0 : CD 88 0E            		call	dac_me
(1) 2072/     BA3 : 09                  		add	hl,bc
(1) 2073/     BA4 : 3C                  		inc	a
(1) 2074/     BA5 : E6 3F               		and	3Fh			; limit to 128
(1) 2075/     BA7 : 32 2B 00            		ld	(commZRead),a
(1) 2076/     BAA : 7E                  		ld	a,(hl)
(1) 2077/     BAB : E1                  		pop	hl
(1) 2078/     BAC : D1                  		pop	de
(1) 2079/     BAD : C1                  		pop	bc
(1) 2080/     BAE : C9                  		ret
(1) 2081/     BAF :                     
(1) 2082/     BAF :                     ; --------------------------------------------------------
(1) 2083/     BAF :                     ; check_tick
(1) 2084/     BAF :                     ;
(1) 2085/     BAF :                     ; Checks if VBlank triggred a TICK (1/150)
(1) 2086/     BAF :                     ; --------------------------------------------------------
(1) 2087/     BAF :                     
(1) 2088/     BAF :                     check_tick:
(1) 2089/     BAF : F3                  		di				; Disable ints
(1) 2090/     BB0 : F5                  		push	af
(1) 2091/     BB1 : E5                  		push	hl
(1) 2092/     BB2 : 21 1B 00            		ld	hl,tickFlag+1		; read last TICK flag
(1) 2093/     BB5 : 7E                  		ld	a,(hl)			; non-zero value?
(1) 2094/     BB6 : B7                  		or 	a
(1) 2095/     BB7 : 28 1D               		jr	z,.ctnotick
(1) 2096/     BB9 :                     	; ints are disabled from here
(1) 2097/     BB9 : 36 00               		ld	(hl),0			; Reset TICK flag
(1) 2098/     BBB : 23                  		inc	hl			; Move to tickCnt
(1) 2099/     BBC : 34                  		inc	(hl)			; and increment
(1) 2100/     BBD : CD 88 0E            		call	dac_me
(1) 2101/     BC0 : D5                  		push	de
(1) 2102/     BC1 : 2A 1F 00            		ld	hl,(sbeatAcc)		; Increment subbeats
(1) 2103/     BC4 : ED 5B 1D 00         		ld	de,(sbeatPtck)
(1) 2104/     BC8 : CD 88 0E            		call	dac_me
(1) 2105/     BCB : 19                  		add	hl,de
(1) 2106/     BCC : 22 1F 00            		ld	(sbeatAcc),hl
(1) 2107/     BCF : D1                  		pop	de
(1) 2108/     BD0 : CD 88 0E            		call	dac_me
(1) 2109/     BD3 : CD 9C 0E            		call	dac_fill
(1) 2110/     BD6 :                     .ctnotick:
(1) 2111/     BD6 : E1                  		pop	hl
(1) 2112/     BD7 : F1                  		pop	af
(1) 2113/     BD8 : FB                  		ei				; Enable ints again
(1) 2114/     BD9 : C9                  		ret
(1) 2115/     BDA :                     
(1) 2116/     BDA :                     ; --------------------------------------------------------
(1) 2117/     BDA :                     ; set_tempo
(1) 2118/     BDA :                     ;
(1) 2119/     BDA :                     ; Input:
(1) 2120/     BDA :                     ; a - Beats per minute
(1) 2121/     BDA :                     ;
(1) 2122/     BDA :                     ; Uses:
(1) 2123/     BDA :                     ; de,hl
(1) 2124/     BDA :                     ; --------------------------------------------------------
(1) 2125/     BDA :                     
(1) 2126/     BDA :                     set_tempo:
(1) 2127/     BDA : 11 DA 00            		ld	de,218
(1) 2128/     BDD : CD EC 0B            		call	do_multiply
(1) 2129/     BE0 : AF                  		xor	a
(1) 2130/     BE1 : CB 25               		sla	l
(1) 2131/     BE3 : CB 14               		rl	h
(1) 2132/     BE5 : 17                  		rla			; AH <- sbpt, 8 fracs
(1) 2133/     BE6 : 6C                  		ld	l,h
(1) 2134/     BE7 : 67                  		ld	h,a		; HL <- AH
(1) 2135/     BE8 : 22 1D 00            		ld	(sbeatPtck),hl
(1) 2136/     BEB : C9                  		ret
(1) 2137/     BEC :                     
(1) 2138/     BEC :                     ; ---------------------------------------------
(1) 2139/     BEC :                     ; do_multiply
(1) 2140/     BEC :                     ;
(1) 2141/     BEC :                     ; Input:
(1) 2142/     BEC :                     ; hl - Start from
(1) 2143/     BEC :                     ; de - Multply by this
(1) 2144/     BEC :                     ; ---------------------------------------------
(1) 2145/     BEC :                     
(1) 2146/     BEC :                     ; 			      ; GETPATPTR
(1) 2147/     BEC :                     ; 			      ; 		ld	HL,PATCHDATA
(1) 2148/     BEC :                     ; 	dc.b	$21,$86,$18
(1) 2149/     BEC :                     ; 			      ; 		ld	DE,39
(1) 2150/     BEC :                     ; 	dc.b	$11,$27,$00
(1) 2151/     BEC :                     ; 			      ; 		jr	MULADD
(1) 2152/     BEC :                     ; 	dc.b	$18,$03
(1) 2153/     BEC :                     
(1) 2154/     BEC :                     do_multiply:
(1) 2155/     BEC : 21 00 00            		ld	hl,0
(1) 2156/     BEF :                     .mul_add:
(1) 2157/     BEF : CB 3F               		srl	a
(1) 2158/     BF1 : 30 01               		jr	nc,.mulbitclr
(1) 2159/     BF3 : 19                  		add	hl,de
(1) 2160/     BF4 :                     .mulbitclr:
(1) 2161/     BF4 : C8                  		ret	z
(1) 2162/     BF5 : CB 23               		sla	e		; if more bits still set in A, DE*=2 and loop
(1) 2163/     BF7 : CB 12               		rl	d
(1) 2164/     BF9 : 18 F4               		jr	.mul_add
(1) 2165/     BFB :                     
(1) 2166/     BFB :                     ; --------------------------------------------------------
(1) 2167/     BFB :                     ; transferRom
(1) 2168/     BFB :                     ;
(1) 2169/     BFB :                     ; Transfer bytes from ROM to Z80, this also tells
(1) 2170/     BFB :                     ; to 68k that we are reading fom ROM
(1) 2171/     BFB :                     ;
(1) 2172/     BFB :                     ; Input:
(1) 2173/     BFB :                     ; a  - Source ROM address $xx0000
(1) 2174/     BFB :                     ; bc - Byte count (size 0 NOT allowed, MAX: 0FFh)
(1) 2175/     BFB :                     ; hl - Source ROM address $00xxxx
(1) 2176/     BFB :                     ; de - Destination address
(1) 2177/     BFB :                     ;
(1) 2178/     BFB :                     ; Uses:
(1) 2179/     BFB :                     ; b, ix
(1) 2180/     BFB :                     ;
(1) 2181/     BFB :                     ; Notes:
(1) 2182/     BFB :                     ; call dac_fill first if transfering anything other than
(1) 2183/     BFB :                     ; WAV sample data, just to be safe
(1) 2184/     BFB :                     ; --------------------------------------------------------
(1) 2185/     BFB :                     
(1) 2186/     BFB :                     ; TODO: check if I can improve this
(1) 2187/     BFB :                     
(1) 2188/     BFB :                     transferRom:
(1) 2189/     BFB : CD 88 0E            		call	dac_me
(1) 2190/     BFE : DD E5               		push	ix
(1) 2191/     C00 : DD 21 2D 00         		ld	ix,commZRomBlk
(1) 2192/     C04 : 22 29 00            		ld	(x68ksrclsb),hl
(1) 2193/     C07 : CB BC               		res	7,h
(1) 2194/     C09 : 06 00               		ld	b,0
(1) 2195/     C0B : 0B                  		dec	bc
(1) 2196/     C0C : 09                  		add	hl,bc
(1) 2197/     C0D : CB 7C               		bit	7,h
(1) 2198/     C0F : 20 0B               		jr	nz,.double
(1) 2199/     C11 : 2A 29 00            		ld	hl,(x68ksrclsb)		; single transfer
(1) 2200/     C14 : 0C                  		inc	c
(1) 2201/     C15 : 47                  		ld	b,a
(1) 2202/     C16 : CD 45 0C            		call	.transfer
(1) 2203/     C19 : DD E1               		pop	ix
(1) 2204/     C1B : C9                  		ret
(1) 2205/     C1C :                     .double:
(1) 2206/     C1C : CD 88 0E            		call	dac_me
(1) 2207/     C1F : 47                  		ld	b,a			; double transfer
(1) 2208/     C20 : C5                  		push	bc
(1) 2209/     C21 : E5                  		push	hl
(1) 2210/     C22 : 79                  		ld	a,c
(1) 2211/     C23 : 95                  		sub	a,l
(1) 2212/     C24 : 4F                  		ld	c,a
(1) 2213/     C25 : 2A 29 00            		ld	hl,(x68ksrclsb)
(1) 2214/     C28 : CD 45 0C            		call	.transfer
(1) 2215/     C2B : E1                  		pop	hl
(1) 2216/     C2C : C1                  		pop	bc
(1) 2217/     C2D : CD 88 0E            		call	dac_me
(1) 2218/     C30 : 4D                  		ld	c,l
(1) 2219/     C31 : 0C                  		inc	c
(1) 2220/     C32 : 3A 2A 00            		ld	a,(x68ksrcmid)
(1) 2221/     C35 : E6 80               		and	80h
(1) 2222/     C37 : C6 80               		add	a,80h
(1) 2223/     C39 : 67                  		ld	h,a
(1) 2224/     C3A : 2E 00               		ld	l,0
(1) 2225/     C3C : 30 01               		jr	nc,.x68knocarry
(1) 2226/     C3E : 04                  		inc	b
(1) 2227/     C3F :                     .x68knocarry:
(1) 2228/     C3F : CD 45 0C            		call	.transfer
(1) 2229/     C42 : DD E1               		pop	ix
(1) 2230/     C44 : C9                  		ret
(1) 2231/     C45 :                     
(1) 2232/     C45 :                     ; b  - Source ROM xx0000
(1) 2233/     C45 :                     ;  c - Bytes to transfer (00h not allowed)
(1) 2234/     C45 :                     ; hl - Source ROM 00xxxx
(1) 2235/     C45 :                     ; de - Destination address
(1) 2236/     C45 :                     ;
(1) 2237/     C45 :                     ; Uses:
(1) 2238/     C45 :                     ; a
(1) 2239/     C45 :                     .transfer:
(1) 2240/     C45 : CD 88 0E            		call	dac_me
(1) 2241/     C48 : D5                  		push	de
(1) 2242/     C49 : 11 00 60            		ld	de,6000h
(1) 2243/     C4C : 7C                  		ld	a,h
(1) 2244/     C4D : CB 07               		rlc	a
(1) 2245/     C4F : 12                  		ld	(de),a
(1) 2246/     C50 : 78                  		ld	a,b
(1) 2247/     C51 : 12                  		ld	(de),a
(1) 2248/     C52 : 1F                  		rra
(1) 2249/     C53 : 12                  		ld	(de),a
(1) 2250/     C54 : 1F                  		rra
(1) 2251/     C55 : 12                  		ld	(de),a
(1) 2252/     C56 : 1F                  		rra
(1) 2253/     C57 : CD 88 0E            		call	dac_me
(1) 2254/     C5A : 12                  		ld	(de),a
(1) 2255/     C5B : 1F                  		rra
(1) 2256/     C5C : 12                  		ld	(de),a
(1) 2257/     C5D : 1F                  		rra
(1) 2258/     C5E : 12                  		ld	(de),a
(1) 2259/     C5F : 1F                  		rra
(1) 2260/     C60 : 12                  		ld	(de),a
(1) 2261/     C61 : 1F                  		rra
(1) 2262/     C62 : 12                  		ld	(de),a
(1) 2263/     C63 : D1                  		pop	de
(1) 2264/     C64 : CB FC               		set	7,h
(1) 2265/     C66 : CD 88 0E            		call	dac_me
(1) 2266/     C69 :                     
(1) 2267/     C69 :                     	; Transfer data in parts of 3bytes
(1) 2268/     C69 :                     	; while playing cache'd WAV in the process
(1) 2269/     C69 : 79                  		ld	a,c
(1) 2270/     C6A : 06 00               		ld	b,0
(1) 2271/     C6C : DD CB 01 C6         		set	0,(ix+1)	; Tell to 68k that we are reading from ROM
(1) 2272/     C70 : D6 03               		sub	a,3
(1) 2273/     C72 : 38 14               		jr	c,.x68klast
(1) 2274/     C74 :                     .x68kloop:
(1) 2275/     C74 : 0E 02               		ld	c,3-1
(1) 2276/     C76 : DD CB 00 46         		bit	0,(ix)		; If 68k requested ROM block from here
(1) 2277/     C7A : 20 20               		jr	nz,.x68klpwt
(1) 2278/     C7C :                     .x68klpcont:
(1) 2279/     C7C : ED B0               		ldir
(1) 2280/     C7E : 00                  		nop
(1) 2281/     C7F : CD 88 0E            		call	dac_me
(1) 2282/     C82 : 00                  		nop
(1) 2283/     C83 : D6 02               		sub	a,3-1
(1) 2284/     C85 : D2 74 0C            		jp	nc,.x68kloop
(1) 2285/     C88 :                     ; last block
(1) 2286/     C88 :                     .x68klast:
(1) 2287/     C88 : C6 03               		add	a,3
(1) 2288/     C8A : 4F                  		ld	c,a
(1) 2289/     C8B : DD CB 00 46         		bit	0,(ix)		; If 68k requested ROM block from here
(1) 2290/     C8F : C2 B1 0C            		jp	nz,.x68klstwt
(1) 2291/     C92 :                     .x68klstcont:
(1) 2292/     C92 : ED B0               		ldir
(1) 2293/     C94 : CD 88 0E            		call	dac_me
(1) 2294/     C97 : DD CB 01 86         		res	0,(ix+1)
(1) 2295/     C9B : C9                  		ret
(1) 2296/     C9C :                     
(1) 2297/     C9C :                     ; If Genesis wants to do a DMA job...
(1) 2298/     C9C :                     ; This MIGHT cause the DAC to ran out of sample data
(1) 2299/     C9C :                     .x68klpwt:
(1) 2300/     C9C : DD CB 01 86         		res	0,(ix+1)		; Not reading ROM
(1) 2301/     CA0 :                     .x68kpwtlp:
(1) 2302/     CA0 : 00                  		nop
(1) 2303/     CA1 : CD 88 0E            		call	dac_me
(1) 2304/     CA4 : 00                  		nop
(1) 2305/     CA5 : DD CB 00 46         		bit	0,(ix)			; Is ROM free from 68K?
(1) 2306/     CA9 : 20 F5               		jr	nz,.x68kpwtlp
(1) 2307/     CAB : DD CB 01 C6         		set	0,(ix+1)		; Reading ROM again.
(1) 2308/     CAF : 18 CB               		jr	.x68klpcont
(1) 2309/     CB1 :                     
(1) 2310/     CB1 :                     ; For last write
(1) 2311/     CB1 :                     .x68klstwt:
(1) 2312/     CB1 : DD CB 01 86         		res	0,(ix+1)		; Not reading ROM
(1) 2313/     CB5 :                     .x68klstwtlp:
(1) 2314/     CB5 : 00                  		nop
(1) 2315/     CB6 : CD 88 0E            		call	dac_me
(1) 2316/     CB9 : 00                  		nop
(1) 2317/     CBA : DD CB 00 46         		bit	0,(ix)			; Is ROM free from 68K?
(1) 2318/     CBE : 20 F5               		jr	nz,.x68klstwtlp
(1) 2319/     CC0 : DD CB 01 C6         		set	0,(ix+1)		; Reading ROM again.
(1) 2320/     CC4 : 18 CC               		jr	.x68klstcont
(1) 2321/     CC6 :                     
(1) 2322/     CC6 :                     ; --------------------------------------------------------
(1) 2323/     CC6 :                     ; bruteforce DAC ON/OFF playback
(1) 2324/     CC6 :                     ; --------------------------------------------------------
(1) 2325/     CC6 :                     
(1) 2326/     CC6 :                     dac_on:
(1) 2327/     CC6 : 3E 2B               		ld	a,2Bh
(1) 2328/     CC8 : 32 00 40            		ld	(Zym_ctrl_1),a
(1) 2329/     CCB : 3E 80               		ld	a,80h
(1) 2330/     CCD : 32 01 40            		ld	(Zym_data_1),a
(1) 2331/     CD0 : 3E D9               		ld 	a,zopcExx
(1) 2332/     CD2 : 32 88 0E            		ld	(dac_me),a
(1) 2333/     CD5 : 3E F5               		ld 	a,zopcPushAf
(1) 2334/     CD7 : 32 9C 0E            		ld	(dac_fill),a
(1) 2335/     CDA : C9                  		ret
(1) 2336/     CDB :                     dac_off:
(1) 2337/     CDB : 3E 2B               		ld	a,2Bh
(1) 2338/     CDD : 32 00 40            		ld	(Zym_ctrl_1),a
(1) 2339/     CE0 : 3E 00               		ld	a,00h
(1) 2340/     CE2 : 32 01 40            		ld	(Zym_data_1),a
(1) 2341/     CE5 : 3E C9               		ld 	a,zopcRet
(1) 2342/     CE7 : 32 88 0E            		ld	(dac_me),a
(1) 2343/     CEA : 3E C9               		ld 	a,zopcRet
(1) 2344/     CEC : 32 9C 0E            		ld	(dac_fill),a
(1) 2345/     CEF : C9                  		ret
(1) 2346/     CF0 :                     
(1) 2347/     CF0 :                     ; ====================================================================
(1) 2348/     CF0 :                     ; ----------------------------------------------------------------
(1) 2349/     CF0 :                     ; Sound chip routines
(1) 2350/     CF0 :                     ; ----------------------------------------------------------------
(1) 2351/     CF0 :                     
(1) 2352/     CF0 :                     ; --------------------------------------------------------
(1) 2353/     CF0 :                     ; psg_env
(1) 2354/     CF0 :                     ;
(1) 2355/     CF0 :                     ; Processes the PSG manually to add effects
(1) 2356/     CF0 :                     ; --------------------------------------------------------
(1) 2357/     CF0 :                     
(1) 2358/     CF0 :                     psg_env:
(1) 2359/     CF0 :                     	; NOTE: this now reads backwards, because
(1) 2360/     CF0 :                     	; of the HAT mode check
(1) 2361/     CF0 : FD 21 3B 12         		ld	iy,psgcom+3
(1) 2362/     CF4 : 21 11 7F            		ld	hl,Zpsg_ctrl
(1) 2363/     CF7 : 16 E0               		ld	d,0E0h			; PSG first ctrl command
(1) 2364/     CF9 : 1E 04               		ld	e,4			; 4 channels
(1) 2365/     CFB :                     .vloop:
(1) 2366/     CFB : CD 88 0E            		call	dac_me
(1) 2367/     CFE : FD 4E 00            		ld	c,(iy+COM)		; c - current command
(1) 2368/     D01 : FD 36 00 00         		ld	(iy+COM),0
(1) 2369/     D05 : CB 51               		bit	2,c			; bit 2 - stop sound
(1) 2370/     D07 : 28 0C               		jr	z,.ckof
(1) 2371/     D09 : FD 36 04 FF         		ld	(iy+LEV),-1		; reset level
(1) 2372/     D0D : FD 36 28 01         		ld	(iy+FLG),1		; and update
(1) 2373/     D11 : FD 36 18 00         		ld	(iy+MODE),0		; envelope off
(1) 2374/     D15 :                     ; 		ld	a,4			; PSG Channel 3?
(1) 2375/     D15 :                     ; 		cp	e
(1) 2376/     D15 :                     ; 		jr	nz,.ckof
(1) 2377/     D15 :                     ; 		nop
(1) 2378/     D15 :                     ; 		res	5,(ix)			; Unlock PSG3
(1) 2379/     D15 :                     .ckof:
(1) 2380/     D15 : CB 49               		bit	1,c			; bit 1 - key off
(1) 2381/     D17 : 28 0E               		jr      z,.ckon
(1) 2382/     D19 : FD 7E 18            		ld	a,(iy+MODE)		; mode 0?
(1) 2383/     D1C : B7                  		or	a
(1) 2384/     D1D : 28 08               		jr	z,.ckon
(1) 2385/     D1F : FD 36 28 01         		ld	(iy+FLG),1		; psg update flag
(1) 2386/     D23 : FD 36 18 04         		ld	(iy+MODE),100b		; set envelope mode 100b
(1) 2387/     D27 :                     .ckon:
(1) 2388/     D27 : CB 41               		bit	0,c			; bit 0 - key on
(1) 2389/     D29 : 28 43               		jr	z,.envproc
(1) 2390/     D2B : FD 36 04 FF         		ld	(iy+LEV),-1		; reset level
(1) 2391/     D2F : 3A 2F 00            		ld	a,(psgHatMode)		; check if using tone3 mode.
(1) 2392/     D32 : 4F                  		ld	c,a
(1) 2393/     D33 : E6 03               		and	11b
(1) 2394/     D35 : FE 03               		cp	11b
(1) 2395/     D37 : CA 4B 0D            		jp	z,.tnmode
(1) 2396/     D3A :                     .wrfreq:
(1) 2397/     D3A : 7B                  		ld	a,e
(1) 2398/     D3B : FE 04               		cp	4
(1) 2399/     D3D : CA 61 0D            		jp	z,.sethat
(1) 2400/     D40 : FD 7E 1C            		ld	a,(iy+DTL)		; load frequency LSB or NOISE data
(1) 2401/     D43 : B2                  		or	d			; OR with current channel
(1) 2402/     D44 : 77                  		ld	(hl),a			; write it
(1) 2403/     D45 : FD 7E 20            		ld	a,(iy+DTH)
(1) 2404/     D48 : 77                  		ld	(hl),a
(1) 2405/     D49 : 18 1B               		jr	.nskip
(1) 2406/     D4B :                     
(1) 2407/     D4B :                     ; Tone3 mode
(1) 2408/     D4B :                     .tnmode:
(1) 2409/     D4B : 7B                  		ld	a,e
(1) 2410/     D4C : FE 04               		cp	4			; NOISE
(1) 2411/     D4E : 28 07               		jr	z,.psteal
(1) 2412/     D50 : FE 03               		cp	3			; PSG3, can't play
(1) 2413/     D52 : CA 66 0D            		jp	z,.nskip
(1) 2414/     D55 : 18 E3               		jr	.wrfreq
(1) 2415/     D57 :                     .psteal:
(1) 2416/     D57 : FD 7E 1C            		ld	a,(iy+DTL)		; Steal PSG3's freq
(1) 2417/     D5A : F6 C0               		or	0C0h
(1) 2418/     D5C : 77                  		ld	(hl),a
(1) 2419/     D5D : FD 7E 20            		ld	a,(iy+DTH)
(1) 2420/     D60 : 77                  		ld	(hl),a
(1) 2421/     D61 :                     .sethat:
(1) 2422/     D61 : 3A 2F 00            		ld	a,(psgHatMode)		; write hat mode only.
(1) 2423/     D64 : B2                  		or	d
(1) 2424/     D65 : 77                  		ld	(hl),a
(1) 2425/     D66 :                     .nskip:
(1) 2426/     D66 : FD 36 28 01         		ld	(iy+FLG),1		; psg update flag
(1) 2427/     D6A : FD 36 18 01         		ld	(iy+MODE),001b		; set to attack mode
(1) 2428/     D6E :                     
(1) 2429/     D6E :                     ; ----------------------------
(1) 2430/     D6E :                     ; Process effects
(1) 2431/     D6E :                     ; ----------------------------
(1) 2432/     D6E :                     
(1) 2433/     D6E :                     .envproc:
(1) 2434/     D6E : CD 88 0E            		call	dac_me
(1) 2435/     D71 : FD 7E 18            		ld	a,(iy+MODE)
(1) 2436/     D74 : B7                  		or	a			; no modes
(1) 2437/     D75 : CA F8 0D            		jp	z,.vedlp
(1) 2438/     D78 : FE 01               		cp 	001b			; Attack mode
(1) 2439/     D7A : 20 26               		jr	nz,.chk2
(1) 2440/     D7C : FD 36 28 01         		ld	(iy+FLG),1		; psg update flag
(1) 2441/     D80 : FD 7E 04            		ld	a,(iy+LEV)		; a - current level (volume)
(1) 2442/     D83 : FD 46 24            		ld	b,(iy+ALV)		; b - attack level
(1) 2443/     D86 : FD 96 08            		sub	a,(iy+ATK)		; (attack rate) - (level)
(1) 2444/     D89 : 38 0D               		jr	c,.atkend		; if carry: already finished
(1) 2445/     D8B : 28 0B               		jr	z,.atkend		; if zero: no attack rate
(1) 2446/     D8D : B8                  		cp	b			; attack rate == level?
(1) 2447/     D8E : 38 08               		jr	c,.atkend
(1) 2448/     D90 : 28 06               		jr	z,.atkend
(1) 2449/     D92 : FD 77 04            		ld	(iy+LEV),a		; set new level
(1) 2450/     D95 : C3 F8 0D            		jp	.vedlp
(1) 2451/     D98 :                     .atkend:
(1) 2452/     D98 : FD 70 04            		ld	(iy+LEV),b		; attack level = new level
(1) 2453/     D9B : FD 36 18 02         		ld	(iy+MODE),2		; set to decay mode
(1) 2454/     D9F : C3 F8 0D            		jp	.vedlp
(1) 2455/     DA2 :                     .chk2:
(1) 2456/     DA2 :                     
(1) 2457/     DA2 : FE 02               		cp	010b			; Decay mode
(1) 2458/     DA4 : C2 D6 0D            		jp	nz,.chk4
(1) 2459/     DA7 :                     .dectmr:
(1) 2460/     DA7 : FD 36 28 01         		ld	(iy+FLG),1		; psg update flag
(1) 2461/     DAB : FD 7E 04            		ld	a,(iy+LEV)		; a - Level
(1) 2462/     DAE : FD 46 10            		ld	b,(iy+SLV)		; b - Sustain
(1) 2463/     DB1 : B8                  		cp	b
(1) 2464/     DB2 : 38 0C               		jr	c,.dkadd		; if carry: add
(1) 2465/     DB4 : 28 17               		jr	z,.dkyend		; if zero:  finish
(1) 2466/     DB6 : FD 96 0C            		sub	(iy+DKY)		; substract decay rate
(1) 2467/     DB9 : 38 12               		jr	c,.dkyend		; finish if wraped.
(1) 2468/     DBB : B8                  		cp	b			; compare level
(1) 2469/     DBC : 38 0F               		jr	c,.dkyend		; and finish
(1) 2470/     DBE : 18 08               		jr	.dksav
(1) 2471/     DC0 :                     .dkadd:
(1) 2472/     DC0 : FD 86 0C            		add	a,(iy+DKY)		;  (level) + (decay rate)
(1) 2473/     DC3 : 38 08               		jr	c,.dkyend		; finish if wraped.
(1) 2474/     DC5 : B8                  		cp	b			; compare level
(1) 2475/     DC6 : 30 05               		jr	nc,.dkyend
(1) 2476/     DC8 :                     .dksav:
(1) 2477/     DC8 : FD 77 04            		ld	(iy+LEV),a		; save new level
(1) 2478/     DCB : 18 2B               		jr	.vedlp
(1) 2479/     DCD :                     .dkyend:
(1) 2480/     DCD : FD 70 04            		ld	(iy+LEV),b		; save last attack
(1) 2481/     DD0 : FD 36 18 04         		ld	(iy+MODE),100b		; and set to sustain
(1) 2482/     DD4 : 18 22               		jr	.vedlp
(1) 2483/     DD6 :                     
(1) 2484/     DD6 :                     .chk4:
(1) 2485/     DD6 : FE 04               		cp	100b			; Sustain phase
(1) 2486/     DD8 : 20 1E               		jr	nz,.vedlp
(1) 2487/     DDA : FD 36 28 01         		ld	(iy+FLG),1		; psg update flag
(1) 2488/     DDE : FD 7E 04            		ld	a,(iy+LEV)		; a - Level
(1) 2489/     DE1 : FD 86 14            		add 	a,(iy+RRT)		; add Release Rate
(1) 2490/     DE4 : 38 05               		jr	c,.killenv		; release done
(1) 2491/     DE6 : FD 77 04            		ld	(iy+LEV),a		; set new Level
(1) 2492/     DE9 : 18 0D               		jr	.vedlp
(1) 2493/     DEB :                     .killenv:
(1) 2494/     DEB : FD 36 04 FF         		ld	(iy+LEV),-1		; Silence this channel
(1) 2495/     DEF : FD 36 18 00         		ld	(iy+MODE),0		; Reset mode
(1) 2496/     DF3 : 3E 04               		ld	a,4			; PSG Channel 3?
(1) 2497/     DF5 : BB                  		cp	e
(1) 2498/     DF6 : 20 00               		jr	nz,.vedlp
(1) 2499/     DF8 :                     ; 		res	5,(ix)			; Unlock PSG3
(1) 2500/     DF8 :                     .vedlp:
(1) 2501/     DF8 : FD 2B               		dec	iy			; next COM to check
(1) 2502/     DFA : 7A                  		ld	a,d
(1) 2503/     DFB : D6 20               		sub	a,20h
(1) 2504/     DFD : 57                  		ld	d,a
(1) 2505/     DFE : 1D                  		dec	e
(1) 2506/     DFF : C2 FB 0C            		jp	nz,.vloop
(1) 2507/     E02 :                     
(1) 2508/     E02 :                     	; ----------------------------
(1) 2509/     E02 :                     	; Set final volumes
(1) 2510/     E02 : CD 88 0E            		call	dac_me
(1) 2511/     E05 : FD 21 38 12         		ld	iy,psgcom
(1) 2512/     E09 : DD 21 11 7F         		ld	ix,Zpsg_ctrl
(1) 2513/     E0D : 21 90 00            		ld	hl,90h		; Channel + volumeset bit
(1) 2514/     E10 : 11 20 00            		ld	de,20h		; next channel increment
(1) 2515/     E13 : 06 04               		ld	b,4
(1) 2516/     E15 :                     .nextpsg:
(1) 2517/     E15 : FD CB 28 46         		bit	0,(iy+FLG)	; PSG update?
(1) 2518/     E19 : 28 13               		jr	z,.flgoff
(1) 2519/     E1B : FD 36 28 00         		ld	(iy+FLG),0	; Reset until next one
(1) 2520/     E1F : FD 7E 04            		ld	a,(iy+LEV)	; a - Level
(1) 2521/     E22 : CB 3F               		srl	a		; (Level >> 4)
(1) 2522/     E24 : CB 3F               		srl	a
(1) 2523/     E26 : CB 3F               		srl	a
(1) 2524/     E28 : CB 3F               		srl	a
(1) 2525/     E2A : B5                  		or	l		; merge Channel bits
(1) 2526/     E2B : DD 77 00            		ld	(ix),a		; Write volume
(1) 2527/     E2E :                     .flgoff:
(1) 2528/     E2E : 19                  		add	hl,de		; next channel
(1) 2529/     E2F : FD 23               		inc	iy		; next com
(1) 2530/     E31 : 10 E2               		djnz	.nextpsg
(1) 2531/     E33 : CD 88 0E            		call	dac_me
(1) 2532/     E36 : C9                  		ret
(1) 2533/     E37 :                     
(1) 2534/     E37 :                     ; ; --------------------------------------------------------
(1) 2535/     E37 :                     ; ; Communicate to 32X from here
(1) 2536/     E37 :                     ; ; hl - Data to transfer
(1) 2537/     E37 :                     ; ; b - WORDS to transfer
(1) 2538/     E37 :                     ; ; c - Task id
(1) 2539/     E37 :                     ; ;
(1) 2540/     E37 :                     ; ; Uses comm4/comm6
(1) 2541/     E37 :                     ; ; --------------------------------------------------------
(1) 2542/     E37 :                     ;
(1) 2543/     E37 :                     ; mars_zcomm:
(1) 2544/     E37 :                     ; 		call	dac_me
(1) 2545/     E37 :                     ; 		push	hl
(1) 2546/     E37 :                     ; 		ld	hl,6000h		; Set bank
(1) 2547/     E37 :                     ; 		ld	(hl),0
(1) 2548/     E37 :                     ; 		ld	(hl),1
(1) 2549/     E37 :                     ; 		ld	(hl),0
(1) 2550/     E37 :                     ; 		ld	(hl),0
(1) 2551/     E37 :                     ; 		ld	(hl),0
(1) 2552/     E37 :                     ; 		ld	(hl),0
(1) 2553/     E37 :                     ; 		ld	(hl),1
(1) 2554/     E37 :                     ; 		call	dac_me
(1) 2555/     E37 :                     ; 		ld	(hl),0
(1) 2556/     E37 :                     ; 		ld	(hl),1
(1) 2557/     E37 :                     ; 		pop	hl
(1) 2558/     E37 :                     ; 		ld	ix,5100h|8000h		; ix - mars sysreg
(1) 2559/     E37 :                     ; .wait_md:	ld	a,(ix+comm8)		; 68k got it first?
(1) 2560/     E37 :                     ; 		or	a
(1) 2561/     E37 :                     ; 		jp	nz,.wait_md
(1) 2562/     E37 :                     ; .wait_md2:	ld	a,(ix+comm4+1)		; busy?
(1) 2563/     E37 :                     ; 		or	a
(1) 2564/     E37 :                     ; 		jp	m,.wait_md2
(1) 2565/     E37 :                     ; 		call	dac_me
(1) 2566/     E37 :                     ; 		ld	(ix+comm4),c		; Z80 ready
(1) 2567/     E37 :                     ; 		ld	(ix+(comm4+1)),1	; SH busy
(1) 2568/     E37 :                     ; 		ld	(ix+3),01b		; Master CMD interrupt
(1) 2569/     E37 :                     ; .wait_cmd:	bit	0,(ix+3)		; CMD clear?
(1) 2570/     E37 :                     ; 		jp	nz,.wait_cmd
(1) 2571/     E37 :                     ; 		call	dac_me
(1) 2572/     E37 :                     ; .loop:
(1) 2573/     E37 :                     ; 		call	dac_me
(1) 2574/     E37 :                     ; 		ld	a,(ix+(comm4+1))	; SH ready?
(1) 2575/     E37 :                     ; 		cp	2
(1) 2576/     E37 :                     ; 		jr	nz,.loop
(1) 2577/     E37 :                     ; 		ld	a,(ix+(comm4+1))	; SH ready?
(1) 2578/     E37 :                     ; 		cp	2
(1) 2579/     E37 :                     ; 		jr	nz,.loop
(1) 2580/     E37 :                     ; 		ld	a,c			; Z80 is busy
(1) 2581/     E37 :                     ; 		or	80h
(1) 2582/     E37 :                     ; 		ld	(ix+comm4),a
(1) 2583/     E37 :                     ; 		call	dac_me
(1) 2584/     E37 :                     ; 		ld	a,b			; check b
(1) 2585/     E37 :                     ; 		or	a
(1) 2586/     E37 :                     ; 		jr	z,.exit
(1) 2587/     E37 :                     ; 		jp	m,.exit
(1) 2588/     E37 :                     ; 		ld	a,(hl)
(1) 2589/     E37 :                     ; 		ld	(ix+comm6),a
(1) 2590/     E37 :                     ; 		call	dac_me
(1) 2591/     E37 :                     ; 		inc	hl
(1) 2592/     E37 :                     ; 		ld	a,(hl)
(1) 2593/     E37 :                     ; 		ld	(ix+comm6+1),a
(1) 2594/     E37 :                     ; 		inc	hl
(1) 2595/     E37 :                     ; 		call	dac_me
(1) 2596/     E37 :                     ; 		ld	a,c			; Z80 is ready
(1) 2597/     E37 :                     ; 		or	40h
(1) 2598/     E37 :                     ; 		ld	(ix+comm4),a
(1) 2599/     E37 :                     ; 		dec	b
(1) 2600/     E37 :                     ; 		jr	.loop
(1) 2601/     E37 :                     ; .exit:
(1) 2602/     E37 :                     ; 		ld	(ix+comm4),0		; Z80 finished
(1) 2603/     E37 :                     ; 		ret
(1) 2604/     E37 :                     
(1) 2605/     E37 :                     ; ---------------------------------------------
(1) 2606/     E37 :                     ; FM send registers
(1) 2607/     E37 :                     ;
(1) 2608/     E37 :                     ; Input:
(1) 2609/     E37 :                     ; d - ctrl
(1) 2610/     E37 :                     ; e - data
(1) 2611/     E37 :                     ; ---------------------------------------------
(1) 2612/     E37 :                     
(1) 2613/     E37 :                     ; ix - first byte: FM id
(1) 2614/     E37 :                     fm_autoset:
(1) 2615/     E37 : DD CB 00 56         		bit	2,(ix)
(1) 2616/     E3B : C2 49 0E            		jp	nz,fm_send_2
(1) 2617/     E3E :                     
(1) 2618/     E3E :                     fm_send_1:
(1) 2619/     E3E : 7A                  		ld	a,d
(1) 2620/     E3F : 32 00 40            		ld	(Zym_ctrl_1),a
(1) 2621/     E42 : 00                  		nop
(1) 2622/     E43 : 7B                  		ld	a,e
(1) 2623/     E44 : 32 01 40            		ld	(Zym_data_1),a
(1) 2624/     E47 : 00                  		nop
(1) 2625/     E48 : C9                  		ret
(1) 2626/     E49 :                     
(1) 2627/     E49 :                     fm_send_2:
(1) 2628/     E49 : 7A                  		ld	a,d
(1) 2629/     E4A : 32 02 40            		ld	(Zym_ctrl_2),a
(1) 2630/     E4D : 00                  		nop
(1) 2631/     E4E : 7B                  		ld	a,e
(1) 2632/     E4F : 32 03 40            		ld	(Zym_data_2),a
(1) 2633/     E52 : 00                  		nop
(1) 2634/     E53 : C9                  		ret
(1) 2635/     E54 :                     
(1) 2636/     E54 :                     ; --------------------------------------------------------
(1) 2637/     E54 :                     ; dac_play
(1) 2638/     E54 :                     ;
(1) 2639/     E54 :                     ; Plays a new sample
(1) 2640/     E54 :                     ; --------------------------------------------------------
(1) 2641/     E54 :                     
(1) 2642/     E54 :                     dac_play:
(1) 2643/     E54 : F3                  		di
(1) 2644/     E55 : CD DB 0C            		call	dac_off
(1) 2645/     E58 : D9                  		exx
(1) 2646/     E59 : 01 15 00            		ld	bc,dWaveBuff>>8			; bc - WAVFIFO MSB
(1) 2647/     E5C : ED 5B 11 00         		ld	de,(wave_Pitch)			; de - Pitch
(1) 2648/     E60 : 21 00 00            		ld	hl,(dWaveBuff&0FFh)<<8		; hl - WAVFIFO LSB pointer (xx.00)
(1) 2649/     E63 : D9                  		exx
(1) 2650/     E64 : 2A 08 00            		ld	hl,(wave_Start)
(1) 2651/     E67 : 3A 0A 00            		ld 	a,(wave_Start+2)
(1) 2652/     E6A : 22 22 00            		ld	(dDacPntr),hl
(1) 2653/     E6D : 32 24 00            		ld	(dDacPntr+2),a
(1) 2654/     E70 : 2A 0B 00            		ld	hl,(wave_Len)
(1) 2655/     E73 : 3A 0D 00            		ld 	a,(wave_Len+2)
(1) 2656/     E76 : 22 25 00            		ld	(dDacCntr),hl
(1) 2657/     E79 : 32 27 00            		ld	(dDacCntr+2),a
(1) 2658/     E7C : AF                  		xor	a
(1) 2659/     E7D : 32 28 00            		ld	(dDacFifoMid),a
(1) 2660/     E80 : CD AA 0E            		call	dac_firstfill
(1) 2661/     E83 : CD C6 0C            		call	dac_on
(1) 2662/     E86 : FB                  		ei
(1) 2663/     E87 : C9                  		ret
(1) 2664/     E88 :                     
(1) 2665/     E88 :                     ; --------------------------------------------------------
(1) 2666/     E88 :                     ; dac_me
(1) 2667/     E88 :                     ;
(1) 2668/     E88 :                     ; Writes wave data to DAC using data stored on buffer.
(1) 2669/     E88 :                     ; Call this routine every 6 or more lines of code
(1) 2670/     E88 :                     ; (use any emu-debugger to check if it still plays
(1) 2671/     E88 :                     ; at stable 16000hz)
(1) 2672/     E88 :                     ;
(1) 2673/     E88 :                     ; Input (EXX):
(1) 2674/     E88 :                     ;  c - WAVEFIFO MSB
(1) 2675/     E88 :                     ; de - Pitch (xx.00)
(1) 2676/     E88 :                     ; h  - WAVEFIFO LSB (as xx.00)
(1) 2677/     E88 :                     ;
(1) 2678/     E88 :                     ; Uses (EXX):
(1) 2679/     E88 :                     ; b
(1) 2680/     E88 :                     ;
(1) 2681/     E88 :                     ; *** self-modifiable code ***
(1) 2682/     E88 :                     ; --------------------------------------------------------
(1) 2683/     E88 :                     
(1) 2684/     E88 : D9                  dac_me:		exx				; <-- code changes between EXX(play) and RET(stop)
(1) 2685/     E89 : 08                  		ex	af,af'
(1) 2686/     E8A : 45                  		ld	b,l
(1) 2687/     E8B : 3E 2A               		ld	a,2Ah
(1) 2688/     E8D : 32 00 40            		ld	(Zym_ctrl_1),a
(1) 2689/     E90 : 6C                  		ld	l,h
(1) 2690/     E91 : 61                  		ld	h,c
(1) 2691/     E92 : 7E                  		ld	a,(hl)
(1) 2692/     E93 : 32 01 40            		ld	(Zym_data_1),a
(1) 2693/     E96 : 65                  		ld	h,l
(1) 2694/     E97 : 68                  		ld	l,b
(1) 2695/     E98 : 19                  		add	hl,de
(1) 2696/     E99 : 08                  		ex	af,af'
(1) 2697/     E9A : D9                  		exx
(1) 2698/     E9B : C9                  		ret
(1) 2699/     E9C :                     
(1) 2700/     E9C :                     ; --------------------------------------------------------
(1) 2701/     E9C :                     ; dac_fill
(1) 2702/     E9C :                     ;
(1) 2703/     E9C :                     ; Refills a half of the WAVE FIFO data, automatic
(1) 2704/     E9C :                     ;
(1) 2705/     E9C :                     ; *** self-modifiable code ***
(1) 2706/     E9C :                     ; --------------------------------------------------------
(1) 2707/     E9C :                     
(1) 2708/     E9C : F5                  dac_fill:	push	af			; <-- code changes between PUSH AF(play) and RET(stop)
(1) 2709/     E9D : 3A 28 00            		ld	a,(dDacFifoMid)
(1) 2710/     EA0 : D9                  		exx
(1) 2711/     EA1 : AC                  		xor	h			; xx.00
(1) 2712/     EA2 : D9                  		exx
(1) 2713/     EA3 : E6 80               		and	80h
(1) 2714/     EA5 : C2 AE 0E            		jp	nz,dac_refill
(1) 2715/     EA8 : F1                  		pop	af
(1) 2716/     EA9 : C9                  		ret
(1) 2717/     EAA :                     ; first time
(1) 2718/     EAA :                     dac_firstfill:
(1) 2719/     EAA : CD AF 0B            		call	check_tick
(1) 2720/     EAD : F5                  		push	af
(1) 2721/     EAE :                     
(1) 2722/     EAE :                     ; If auto-fill is needed
(1) 2723/     EAE :                     ; TODO: improve this, it's rushed.
(1) 2724/     EAE :                     
(1) 2725/     EAE :                     dac_refill:
(1) 2726/     EAE : CD 88 0E            		call	dac_me
(1) 2727/     EB1 : C5                  		push	bc
(1) 2728/     EB2 : D5                  		push	de
(1) 2729/     EB3 : E5                  		push	hl
(1) 2730/     EB4 : 3A 13 00            		ld	a,(wave_Flags)
(1) 2731/     EB7 : FE 07               		cp	111b
(1) 2732/     EB9 : D2 70 0F            		jp	nc,.FDF7
(1) 2733/     EBC :                     
(1) 2734/     EBC : 3A 27 00            		ld	a,(dDacCntr+2)
(1) 2735/     EBF : 2A 25 00            		ld	hl,(dDacCntr)
(1) 2736/     EC2 : 01 80 00            		ld	bc,80h
(1) 2737/     EC5 : 37                  		scf
(1) 2738/     EC6 : 3F                  		ccf
(1) 2739/     EC7 : ED 42               		sbc	hl,bc
(1) 2740/     EC9 : DE 00               		sbc	a,0
(1) 2741/     ECB : 32 27 00            		ld	(dDacCntr+2),a
(1) 2742/     ECE : 22 25 00            		ld	(dDacCntr),hl
(1) 2743/     ED1 : 16 15               		ld	d,dWaveBuff>>8
(1) 2744/     ED3 : B7                  		or	a
(1) 2745/     ED4 : FA FE 0E            		jp	m,.FDF4DONE
(1) 2746/     ED7 :                     .keepcntr:
(1) 2747/     ED7 :                     
(1) 2748/     ED7 : 3A 28 00            		ld	a,(dDacFifoMid)
(1) 2749/     EDA : 5F                  		ld	e,a
(1) 2750/     EDB : C6 80               		add 	a,80h
(1) 2751/     EDD : 32 28 00            		ld	(dDacFifoMid),a
(1) 2752/     EE0 : 2A 22 00            		ld	hl,(dDacPntr)
(1) 2753/     EE3 : 3A 24 00            		ld	a,(dDacPntr+2)
(1) 2754/     EE6 : CD FB 0B            		call	transferRom
(1) 2755/     EE9 : 2A 22 00            		ld	hl,(dDacPntr)
(1) 2756/     EEC : 3A 24 00            		ld	a,(dDacPntr+2)
(1) 2757/     EEF : 01 80 00            		ld	bc,80h
(1) 2758/     EF2 : 09                  		add	hl,bc
(1) 2759/     EF3 : CE 00               		adc	a,0
(1) 2760/     EF5 : 22 22 00            		ld	(dDacPntr),hl
(1) 2761/     EF8 : 32 24 00            		ld	(dDacPntr+2),a
(1) 2762/     EFB : C3 73 0F            		jp	.FDFreturn
(1) 2763/     EFE :                     .FDF4DONE:
(1) 2764/     EFE : 16 15               		ld	d,dWaveBuff>>8
(1) 2765/     F00 : 3A 13 00            		ld	a,(wave_Flags)
(1) 2766/     F03 : E6 01               		and	01b
(1) 2767/     F05 : B7                  		or	a
(1) 2768/     F06 : C2 29 0F            		jp	nz,.FDF72
(1) 2769/     F09 :                     
(1) 2770/     F09 : 7D                  		ld	a,l
(1) 2771/     F0A : C6 80               		add	a,80h
(1) 2772/     F0C : 4F                  		ld	c,a
(1) 2773/     F0D : 06 00               		ld	b,0
(1) 2774/     F0F : C5                  		push	bc
(1) 2775/     F10 : 3A 28 00            		ld	a,(dDacFifoMid)
(1) 2776/     F13 : 5F                  		ld	e,a
(1) 2777/     F14 : C6 80               		add	a,80h
(1) 2778/     F16 : 32 28 00            		ld	(dDacFifoMid),a
(1) 2779/     F19 : C1                  		pop	bc			; C <- # just xfered
(1) 2780/     F1A : 79                  		ld	a,c
(1) 2781/     F1B : B0                  		or	b
(1) 2782/     F1C : 28 52               		jr	z,.FDF7
(1) 2783/     F1E : 2A 22 00            		ld	hl,(dDacPntr)
(1) 2784/     F21 : 3A 24 00            		ld	a,(dDacPntr+2)
(1) 2785/     F24 : CD FB 0B            		call	transferRom
(1) 2786/     F27 : 18 47               		jr	.FDF7
(1) 2787/     F29 :                     .FDF72:
(1) 2788/     F29 :                     
(1) 2789/     F29 :                     	; loop sample
(1) 2790/     F29 : C5                  		push	bc
(1) 2791/     F2A : D5                  		push	de
(1) 2792/     F2B : 3A 10 00            		ld	a,(wave_Loop+2)
(1) 2793/     F2E : 4F                  		ld	c,a
(1) 2794/     F2F : ED 5B 0E 00         		ld	de,(wave_Loop)
(1) 2795/     F33 : 2A 08 00            		ld	hl,(wave_Start)
(1) 2796/     F36 : 3A 0A 00            		ld 	a,(wave_Start+2)
(1) 2797/     F39 : 81                  		add	a,c
(1) 2798/     F3A : 19                  		add	hl,de
(1) 2799/     F3B : CE 00               		adc	a,0
(1) 2800/     F3D : 22 22 00            		ld	(dDacPntr),hl
(1) 2801/     F40 : 32 24 00            		ld	(dDacPntr+2),a
(1) 2802/     F43 : 2A 0B 00            		ld	hl,(wave_Len)
(1) 2803/     F46 : 3A 0D 00            		ld 	a,(wave_Len+2)
(1) 2804/     F49 : 91                  		sub	a,c
(1) 2805/     F4A : 37                  		scf
(1) 2806/     F4B : 3F                  		ccf
(1) 2807/     F4C : ED 52               		sbc	hl,de
(1) 2808/     F4E : DE 00               		sbc	a,0
(1) 2809/     F50 : 22 25 00            		ld	(dDacCntr),hl
(1) 2810/     F53 : 32 27 00            		ld	(dDacCntr+2),a
(1) 2811/     F56 : D1                  		pop	de
(1) 2812/     F57 : C1                  		pop	bc
(1) 2813/     F58 : 78                  		ld	a,b
(1) 2814/     F59 : B1                  		or	c
(1) 2815/     F5A : 28 17               		jr	z,.FDFreturn
(1) 2816/     F5C : 3A 28 00            		ld	a,(dDacFifoMid)
(1) 2817/     F5F : 5F                  		ld	e,a
(1) 2818/     F60 : C6 80               		add	a,80h
(1) 2819/     F62 : 32 28 00            		ld	(dDacFifoMid),a
(1) 2820/     F65 : 2A 22 00            		ld	hl,(dDacPntr)
(1) 2821/     F68 : 3A 24 00            		ld	a,(dDacPntr+2)
(1) 2822/     F6B : CD FB 0B            		call	transferRom
(1) 2823/     F6E : 18 03               		jr	.FDFreturn
(1) 2824/     F70 :                     .FDF7:
(1) 2825/     F70 : CD DB 0C            		call	dac_off
(1) 2826/     F73 :                     ; 		ld	HL,FMVTBLCH6
(1) 2827/     F73 :                     ; 		ld	(HL),0C6H		; mark voice free, unlocked, and releasing
(1) 2828/     F73 :                     ; 		inc	HL
(1) 2829/     F73 :                     ; 		inc	HL
(1) 2830/     F73 :                     ; 		inc	HL
(1) 2831/     F73 :                     ; 		inc	HL
(1) 2832/     F73 :                     ; 		ld	(HL),0			; clear any pending release timer value
(1) 2833/     F73 :                     ; 		inc	HL
(1) 2834/     F73 :                     ; 		ld	(HL),0
(1) 2835/     F73 :                     .FDFreturn:
(1) 2836/     F73 : E1                  		pop	hl
(1) 2837/     F74 : D1                  		pop	de
(1) 2838/     F75 : C1                  		pop	bc
(1) 2839/     F76 : F1                  		pop	af
(1) 2840/     F77 : C9                  		ret
(1) 2841/     F78 :                     
(1) 2842/     F78 :                     ; ====================================================================
(1) 2843/     F78 :                     ; ----------------------------------------------------------------
(1) 2844/     F78 :                     ; Tables
(1) 2845/     F78 :                     ; ----------------------------------------------------------------
(1) 2846/     F78 :                     
(1) 2847/     F78 : 00 01               wavFreq_Pwm:	dw 100h		; C-0
(1) 2848/     F7A : 00 01               		dw 100h
(1) 2849/     F7C : 00 01               		dw 100h
(1) 2850/     F7E : 00 01               		dw 100h
(1) 2851/     F80 : 00 01               		dw 100h
(1) 2852/     F82 : 00 01               		dw 100h
(1) 2853/     F84 : 00 01               		dw 100h
(1) 2854/     F86 : 00 01               		dw 100h
(1) 2855/     F88 : 00 01               		dw 100h
(1) 2856/     F8A : 00 01               		dw 100h
(1) 2857/     F8C : 00 01               		dw 100h
(1) 2858/     F8E : 00 01               		dw 100h
(1) 2859/     F90 : 00 01               		dw 100h		; C-1
(1) 2860/     F92 : 00 01               		dw 100h
(1) 2861/     F94 : 00 01               		dw 100h
(1) 2862/     F96 : 00 01               		dw 100h
(1) 2863/     F98 : 00 01               		dw 100h
(1) 2864/     F9A : 00 01               		dw 100h
(1) 2865/     F9C : 00 01               		dw 100h
(1) 2866/     F9E : 00 01               		dw 100h
(1) 2867/     FA0 : 00 01               		dw 100h
(1) 2868/     FA2 : 00 01               		dw 100h
(1) 2869/     FA4 : 00 01               		dw 100h
(1) 2870/     FA6 : 00 01               		dw 100h
(1) 2871/     FA8 : 00 01               		dw 100h		; C-2
(1) 2872/     FAA : 00 01               		dw 100h
(1) 2873/     FAC : 00 01               		dw 100h
(1) 2874/     FAE : 00 01               		dw 100h
(1) 2875/     FB0 : 00 01               		dw 100h
(1) 2876/     FB2 : 00 01               		dw 100h
(1) 2877/     FB4 : 00 01               		dw 100h
(1) 2878/     FB6 : 00 01               		dw 100h
(1) 2879/     FB8 : 00 01               		dw 100h
(1) 2880/     FBA : 00 01               		dw 100h
(1) 2881/     FBC : 00 01               		dw 100h
(1) 2882/     FBE : 3B 00               		dw 03Bh
(1) 2883/     FC0 : 3E 00               		dw 03Eh		; C-3 5512
(1) 2884/     FC2 : 43 00               		dw 043h		; C#3
(1) 2885/     FC4 : 46 00               		dw 046h		; D-3
(1) 2886/     FC6 : 49 00               		dw 049h		; D#3
(1) 2887/     FC8 : 4E 00               		dw 04Eh		; E-3
(1) 2888/     FCA : 54 00               		dw 054h		; F-3
(1) 2889/     FCC : 58 00               		dw 058h		; F#3
(1) 2890/     FCE : 5E 00               		dw 05Eh		; G-3 8363 -17
(1) 2891/     FD0 : 63 00               		dw 063h		; G#3
(1) 2892/     FD2 : 68 00               		dw 068h		; A-3
(1) 2893/     FD4 : 70 00               		dw 070h		; A#3
(1) 2894/     FD6 : 75 00               		dw 075h		; B-3
(1) 2895/     FD8 : 7F 00               		dw 07Fh		; C-4 11025 -12
(1) 2896/     FDA : 88 00               		dw 088h		; C#4
(1) 2897/     FDC : 8F 00               		dw 08Fh		; D-4
(1) 2898/     FDE : 97 00               		dw 097h		; D#4
(1) 2899/     FE0 : A0 00               		dw 0A0h		; E-4
(1) 2900/     FE2 : AD 00               		dw 0ADh		; F-4
(1) 2901/     FE4 : B5 00               		dw 0B5h		; F#4
(1) 2902/     FE6 : C0 00               		dw 0C0h		; G-4
(1) 2903/     FE8 : CC 00               		dw 0CCh		; G#4
(1) 2904/     FEA : D7 00               		dw 0D7h		; A-4
(1) 2905/     FEC : E7 00               		dw 0E7h		; A#4
(1) 2906/     FEE : F0 00               		dw 0F0h		; B-4
(1) 2907/     FF0 : 00 01               		dw 100h		; C-5 22050
(1) 2908/     FF2 : 10 01               		dw 110h		; C#5
(1) 2909/     FF4 : 20 01               		dw 120h		; D-5
(1) 2910/     FF6 : 2C 01               		dw 12Ch		; D#5
(1) 2911/     FF8 : 42 01               		dw 142h		; E-5
(1) 2912/     FFA : 58 01               		dw 158h		; F-5
(1) 2913/     FFC : 6A 01               		dw 16Ah		; F#5 32000 +6
(1) 2914/     FFE : 7E 01               		dw 17Eh		; G-5
(1) 2915/    1000 : 90 01               		dw 190h		; G#5
(1) 2916/    1002 : AC 01               		dw 1ACh		; A-5
(1) 2917/    1004 : C2 01               		dw 1C2h		; A#5
(1) 2918/    1006 : E0 01               		dw 1E0h		; B-5
(1) 2919/    1008 : F8 01               		dw 1F8h		; C-6 44100 +12
(1) 2920/    100A : 10 02               		dw 210h		; C#6
(1) 2921/    100C : 40 02               		dw 240h		; D-6
(1) 2922/    100E : 60 02               		dw 260h		; D#6
(1) 2923/    1010 : 80 02               		dw 280h		; E-6
(1) 2924/    1012 : A0 02               		dw 2A0h		; F-6
(1) 2925/    1014 : D0 02               		dw 2D0h		; F#6
(1) 2926/    1016 : F8 02               		dw 2F8h		; G-6
(1) 2927/    1018 : 20 03               		dw 320h		; G#6
(1) 2928/    101A : 50 03               		dw 350h		; A-6
(1) 2929/    101C : 80 03               		dw 380h		; A#6
(1) 2930/    101E : C0 03               		dw 3C0h		; B-6
(1) 2931/    1020 : 00 04               		dw 400h		; C-7 88200
(1) 2932/    1022 : 00 01               		dw 100h
(1) 2933/    1024 : 00 01               		dw 100h
(1) 2934/    1026 : 00 01               		dw 100h
(1) 2935/    1028 : 00 01               		dw 100h
(1) 2936/    102A : 00 01               		dw 100h
(1) 2937/    102C : 00 01               		dw 100h
(1) 2938/    102E : 00 01               		dw 100h
(1) 2939/    1030 : 00 01               		dw 100h
(1) 2940/    1032 : 00 01               		dw 100h
(1) 2941/    1034 : 00 01               		dw 100h
(1) 2942/    1036 : 00 01               		dw 100h
(1) 2943/    1038 : 00 01               		dw 100h		; C-8
(1) 2944/    103A : 00 01               		dw 100h
(1) 2945/    103C : 00 01               		dw 100h
(1) 2946/    103E : 00 01               		dw 100h
(1) 2947/    1040 : 00 01               		dw 100h
(1) 2948/    1042 : 00 01               		dw 100h
(1) 2949/    1044 : 00 01               		dw 100h
(1) 2950/    1046 : 00 01               		dw 100h
(1) 2951/    1048 : 00 01               		dw 100h
(1) 2952/    104A : 00 01               		dw 100h
(1) 2953/    104C : 00 01               		dw 100h
(1) 2954/    104E : 00 01               		dw 100h
(1) 2955/    1050 : 00 01               		dw 100h		; C-9
(1) 2956/    1052 : 00 01               		dw 100h
(1) 2957/    1054 : 00 01               		dw 100h
(1) 2958/    1056 : 00 01               		dw 100h
(1) 2959/    1058 : 00 01               		dw 100h
(1) 2960/    105A : 00 01               		dw 100h
(1) 2961/    105C : 00 01               		dw 100h
(1) 2962/    105E : 00 01               		dw 100h
(1) 2963/    1060 : 00 01               		dw 100h
(1) 2964/    1062 : 00 01               		dw 100h
(1) 2965/    1064 : 00 01               		dw 100h
(1) 2966/    1066 : 00 01               		dw 100h
(1) 2967/    1068 :                     
(1) 2968/    1068 : 84 02               fmFreq_List:	dw 644		; C-0
(1) 2969/    106A : A9 02               		dw 681
(1) 2970/    106C : D2 02               		dw 722
(1) 2971/    106E : FD 02               		dw 765
(1) 2972/    1070 : 2A 03               		dw 810
(1) 2973/    1072 : 5A 03               		dw 858
(1) 2974/    1074 : 8E 03               		dw 910
(1) 2975/    1076 : C4 03               		dw 964
(1) 2976/    1078 : FD 03               		dw 1021
(1) 2977/    107A : 39 04               		dw 1081
(1) 2978/    107C : 7A 04               		dw 1146
(1) 2979/    107E : BE 04               		dw 1214
(1) 2980/    1080 :                     
(1) 2981/    1080 :                     psgFreq_List:
(1) 2982/    1080 : FF FF               		dw -1		; C-0 $0
(1) 2983/    1082 : FF FF               		dw -1
(1) 2984/    1084 : FF FF               		dw -1
(1) 2985/    1086 : FF FF               		dw -1
(1) 2986/    1088 : FF FF               		dw -1
(1) 2987/    108A : FF FF               		dw -1
(1) 2988/    108C : FF FF               		dw -1
(1) 2989/    108E : FF FF               		dw -1
(1) 2990/    1090 : FF FF               		dw -1
(1) 2991/    1092 : FF FF               		dw -1
(1) 2992/    1094 : FF FF               		dw -1
(1) 2993/    1096 : FF FF               		dw -1
(1) 2994/    1098 : FF FF               		dw -1		; C-1 $C
(1) 2995/    109A : FF FF               		dw -1
(1) 2996/    109C : FF FF               		dw -1
(1) 2997/    109E : FF FF               		dw -1
(1) 2998/    10A0 : FF FF               		dw -1
(1) 2999/    10A2 : FF FF               		dw -1
(1) 3000/    10A4 : FF FF               		dw -1
(1) 3001/    10A6 : FF FF               		dw -1
(1) 3002/    10A8 : FF FF               		dw -1
(1) 3003/    10AA : FF FF               		dw -1
(1) 3004/    10AC : FF FF               		dw -1
(1) 3005/    10AE : FF FF               		dw -1
(1) 3006/    10B0 : FF FF               		dw -1		; C-2 $18
(1) 3007/    10B2 : FF FF               		dw -1
(1) 3008/    10B4 : FF FF               		dw -1
(1) 3009/    10B6 : FF FF               		dw -1
(1) 3010/    10B8 : FF FF               		dw -1
(1) 3011/    10BA : FF FF               		dw -1
(1) 3012/    10BC : FF FF               		dw -1
(1) 3013/    10BE : FF FF               		dw -1
(1) 3014/    10C0 : FF FF               		dw -1
(1) 3015/    10C2 : FF FF               		dw -1
(1) 3016/    10C4 : FF FF               		dw -1
(1) 3017/    10C6 : FF FF               		dw -1
(1) 3018/    10C8 : FF FF               		dw -1		; C-3 $24
(1) 3019/    10CA : FF FF               		dw -1
(1) 3020/    10CC : FF FF               		dw -1
(1) 3021/    10CE : FF FF               		dw -1
(1) 3022/    10D0 : FF FF               		dw -1
(1) 3023/    10D2 : FF FF               		dw -1
(1) 3024/    10D4 : FF FF               		dw -1
(1) 3025/    10D6 : FF FF               		dw -1
(1) 3026/    10D8 : FF FF               		dw -1
(1) 3027/    10DA : F8 03               		dw 3F8h
(1) 3028/    10DC : BF 03               		dw 3BFh
(1) 3029/    10DE : 89 03               		dw 389h
(1) 3030/    10E0 : 56 03               		dw 356h		;C-4 30
(1) 3031/    10E2 : 26 03               		dw 326h
(1) 3032/    10E4 : F9 02               		dw 2F9h
(1) 3033/    10E6 : CE 02               		dw 2CEh
(1) 3034/    10E8 : A5 02               		dw 2A5h
(1) 3035/    10EA : 80 02               		dw 280h
(1) 3036/    10EC : 5C 02               		dw 25Ch
(1) 3037/    10EE : 3A 02               		dw 23Ah
(1) 3038/    10F0 : 1A 02               		dw 21Ah
(1) 3039/    10F2 : FB 01               		dw 1FBh
(1) 3040/    10F4 : DF 01               		dw 1DFh
(1) 3041/    10F6 : C4 01               		dw 1C4h
(1) 3042/    10F8 : AB 01               		dw 1ABh		;C-5 3C
(1) 3043/    10FA : 93 01               		dw 193h
(1) 3044/    10FC : 7D 01               		dw 17Dh
(1) 3045/    10FE : 67 01               		dw 167h
(1) 3046/    1100 : 53 01               		dw 153h
(1) 3047/    1102 : 40 01               		dw 140h
(1) 3048/    1104 : 2E 01               		dw 12Eh
(1) 3049/    1106 : 1D 01               		dw 11Dh
(1) 3050/    1108 : 0D 01               		dw 10Dh
(1) 3051/    110A : FE 00               		dw 0FEh
(1) 3052/    110C : EF 00               		dw 0EFh
(1) 3053/    110E : E2 00               		dw 0E2h
(1) 3054/    1110 : D6 00               		dw 0D6h		;C-6 48
(1) 3055/    1112 : C9 00               		dw 0C9h
(1) 3056/    1114 : BE 00               		dw 0BEh
(1) 3057/    1116 : B4 00               		dw 0B4h
(1) 3058/    1118 : A9 00               		dw 0A9h
(1) 3059/    111A : A0 00               		dw 0A0h
(1) 3060/    111C : 97 00               		dw 97h
(1) 3061/    111E : 8F 00               		dw 8Fh
(1) 3062/    1120 : 87 00               		dw 87h
(1) 3063/    1122 : 7F 00               		dw 7Fh
(1) 3064/    1124 : 78 00               		dw 78h
(1) 3065/    1126 : 71 00               		dw 71h
(1) 3066/    1128 : 6B 00               		dw 6Bh		; C-7 54
(1) 3067/    112A : 65 00               		dw 65h
(1) 3068/    112C : 5F 00               		dw 5Fh
(1) 3069/    112E : 5A 00               		dw 5Ah
(1) 3070/    1130 : 55 00               		dw 55h
(1) 3071/    1132 : 50 00               		dw 50h
(1) 3072/    1134 : 4B 00               		dw 4Bh
(1) 3073/    1136 : 47 00               		dw 47h
(1) 3074/    1138 : 43 00               		dw 43h
(1) 3075/    113A : 40 00               		dw 40h
(1) 3076/    113C : 3C 00               		dw 3Ch
(1) 3077/    113E : 39 00               		dw 39h
(1) 3078/    1140 : 36 00               		dw 36h		; C-8 $60
(1) 3079/    1142 : 33 00               		dw 33h
(1) 3080/    1144 : 30 00               		dw 30h
(1) 3081/    1146 : 2D 00               		dw 2Dh
(1) 3082/    1148 : 2B 00               		dw 2Bh
(1) 3083/    114A : 28 00               		dw 28h
(1) 3084/    114C : 26 00               		dw 26h
(1) 3085/    114E : 24 00               		dw 24h
(1) 3086/    1150 : 22 00               		dw 22h
(1) 3087/    1152 : 20 00               		dw 20h
(1) 3088/    1154 : 1F 00               		dw 1Fh
(1) 3089/    1156 : 1D 00               		dw 1Dh
(1) 3090/    1158 : 1B 00               		dw 1Bh		; C-9 $6C
(1) 3091/    115A : 1A 00               		dw 1Ah
(1) 3092/    115C : 18 00               		dw 18h
(1) 3093/    115E : 17 00               		dw 17h
(1) 3094/    1160 : 16 00               		dw 16h
(1) 3095/    1162 : 15 00               		dw 15h
(1) 3096/    1164 : 13 00               		dw 13h
(1) 3097/    1166 : 12 00               		dw 12h
(1) 3098/    1168 : 11 00               		dw 11h
(1) 3099/    116A : 10 00                		dw 10h
(1) 3100/    116C : 09 00                		dw 9h
(1) 3101/    116E : 08 00                		dw 8h
(1) 3102/    1170 : 00 00               		dw 0		; use +60 if using C-5 for tone 3 noise
(1) 3103/    1172 :                     
(1) 3104/    1172 :                     ; --------------------------------------------------------
(1) 3105/    1172 :                     
(1) 3106/    1172 : 00                  PSGVTBL		db 00h			; 0 - PSG channel id + flags
(1) 3107/    1173 : 00 00               		dw 0			; 1 - track channel link
(1) 3108/    1175 : 00                  		db 0			; 3 - ALV
(1) 3109/    1176 : 00                  		db 0			; 4 - ATK
(1) 3110/    1177 : 00                  		db 0			; 5 - SLV
(1) 3111/    1178 : 00                  		db 0			; 6 - DKY
(1) 3112/    1179 : 00                  		db 0			; 7 - RRT
(1) 3113/    117A : 00                  		db 0
(1) 3114/    117B : 01                  		db 01h
(1) 3115/    117C : 00 00               		dw 0			; link
(1) 3116/    117E : 00                  		db 0			; ALV
(1) 3117/    117F : 00                  		db 0			; ATK
(1) 3118/    1180 : 00                  		db 0			; SLV
(1) 3119/    1181 : 00                  		db 0			; DKY
(1) 3120/    1182 : 00                  		db 0			; RRT
(1) 3121/    1183 : 00                  		db 0
(1) 3122/    1184 : 02                  		db 02h
(1) 3123/    1185 : 00 00               		dw 0			; link
(1) 3124/    1187 : 00                  		db 0			; ALV
(1) 3125/    1188 : 00                  		db 0			; ATK
(1) 3126/    1189 : 00                  		db 0			; SLV
(1) 3127/    118A : 00                  		db 0			; DKY
(1) 3128/    118B : 00                  		db 0			; RRT
(1) 3129/    118C : 00                  		db 0
(1) 3130/    118D : FF                  		db -1			; end-of-list
(1) 3131/    118E : 03                  PSGNVTBL	db 03h
(1) 3132/    118F : 00 00               		dw 0			; track channel link
(1) 3133/    1191 : 00                  		db 0			; ALV
(1) 3134/    1192 : 00                  		db 0			; ATK
(1) 3135/    1193 : 00                  		db 0			; SLV
(1) 3136/    1194 : 00                  		db 0			; DKY
(1) 3137/    1195 : 00                  		db 0			; RRT
(1) 3138/    1196 : 00                  		db 0
(1) 3139/    1197 : FF                  		db -1			; end-of-list
(1) 3140/    1198 :                     
(1) 3141/    1198 : 00                  FMVTBL		db 00h			;  0 - FM channel (chip's actual order)
(1) 3142/    1199 : 00 00               		dw 0			;  1 - link
(1) 3143/    119B : 00 00               		dw 0			;  3 - FM instr pointer
(1) 3144/    119D : 00                  		db 0			;  5 - Pitch
(1) 3145/    119E : 00 00 00            		db 0,0,0		;  6 - 0B0h,0B4h,keys
(1) 3146/    11A1 : 00 00               		dw 0			;  9 - Main frequency
(1) 3147/    11A3 : 00 00               		dw 0			; 11 - Ex freq 1
(1) 3148/    11A5 : 00 00               		dw 0			; 13 - Ex freq 2
(1) 3149/    11A7 : 00 00               		dw 0			; 15 - Ex freq 3
(1) 3150/    11A9 : 01                  		db 01h
(1) 3151/    11AA : 00 00               		dw 0
(1) 3152/    11AC : 00 00               		dw 0
(1) 3153/    11AE : 00                  		db 0
(1) 3154/    11AF : 00 00 00            		db 0,0,0
(1) 3155/    11B2 : 00 00               		dw 0
(1) 3156/    11B4 : 00 00               		dw 0
(1) 3157/    11B6 : 00 00               		dw 0
(1) 3158/    11B8 : 00 00               		dw 0
(1) 3159/    11BA : 04                  		db 04h
(1) 3160/    11BB : 00 00               		dw 0
(1) 3161/    11BD : 00 00               		dw 0
(1) 3162/    11BF : 00                  		db 0
(1) 3163/    11C0 : 00 00 00            		db 0,0,0
(1) 3164/    11C3 : 00 00               		dw 0
(1) 3165/    11C5 : 00 00               		dw 0
(1) 3166/    11C7 : 00 00               		dw 0
(1) 3167/    11C9 : 00 00               		dw 0
(1) 3168/    11CB : 05                  		db 05h
(1) 3169/    11CC : 00 00               		dw 0
(1) 3170/    11CE : 00 00               		dw 0
(1) 3171/    11D0 : 00                  		db 0
(1) 3172/    11D1 : 00 00 00            		db 0,0,0
(1) 3173/    11D4 : 00 00               		dw 0
(1) 3174/    11D6 : 00 00               		dw 0
(1) 3175/    11D8 : 00 00               		dw 0
(1) 3176/    11DA : 00 00               		dw 0
(1) 3177/    11DC : 02                  FM3VTBL		db 02h
(1) 3178/    11DD : 00 00               		dw 0			;  1 - link
(1) 3179/    11DF : 00 00               		dw 0			;  3 - FM instr pointer
(1) 3180/    11E1 : 00                  		db 0
(1) 3181/    11E2 : 00 00 00            		db 0,0,0		;  5 - 0B0h,0B4h,keys
(1) 3182/    11E5 : 00 00               		dw 0			;  8 - Main frequency
(1) 3183/    11E7 : 00 00               		dw 0			; 10 - Ex freq 1
(1) 3184/    11E9 : 00 00               		dw 0			; 12 - Ex freq 2
(1) 3185/    11EB : 00 00               		dw 0			; 14 - Ex freq 3
(1) 3186/    11ED : 06                  FM6VTBL		db 06h
(1) 3187/    11EE : 00 00               		dw 0			;  1 - link
(1) 3188/    11F0 : 00 00               		dw 0			;  3 - FM instr pointer
(1) 3189/    11F2 : 00                  		db 0
(1) 3190/    11F3 : 00 00 00            		db 0,0,0		;  5 - 0B0h,0B4h,keys
(1) 3191/    11F6 : 00 00               		dw 0			;  8 - Main frequency
(1) 3192/    11F8 : 00 00               		dw 0			; 10 - Ex freq 1
(1) 3193/    11FA : 00 00               		dw 0			; 12 - Ex freq 2
(1) 3194/    11FC : 00 00               		dw 0			; 14 - Ex freq 3
(1) 3195/    11FE : FF                  		db -1
(1) 3196/    11FF :                     
(1) 3197/    11FF :                     ; 		align 8
(1) 3198/    11FF : 00                  PWMVTBL		db 00h		; 0 - PWM entry, bit7:locked bit6:update for 68k
(1) 3199/    1200 : 00 00               		dw 0		; 1 - track link
(1) 3200/    1202 : 00 00               		dw 0		; 3 - Pitch (note)
(1) 3201/    1204 : 00                  		db 0		; 5 - Instrument number
(1) 3202/    1205 : 00                  		db 0		; 6 - Volume
(1) 3203/    1206 : 03                  		db 11b		; 7 - Panning
(1) 3204/    1207 : 01                  		db 01h
(1) 3205/    1208 : 00 00               		dw 0
(1) 3206/    120A : 00 00               		dw 0
(1) 3207/    120C : 00                  		db 0
(1) 3208/    120D : 00                  		db 0
(1) 3209/    120E : 03                  		db 11b
(1) 3210/    120F : 02                  		db 02h
(1) 3211/    1210 : 00 00               		dw 0
(1) 3212/    1212 : 00 00               		dw 0
(1) 3213/    1214 : 00                  		db 0
(1) 3214/    1215 : 00                  		db 0
(1) 3215/    1216 : 03                  		db 11b
(1) 3216/    1217 : 03                  		db 03h
(1) 3217/    1218 : 00 00               		dw 0
(1) 3218/    121A : 00 00               		dw 0
(1) 3219/    121C : 00                  		db 0
(1) 3220/    121D : 00                  		db 0
(1) 3221/    121E : 03                  		db 11b
(1) 3222/    121F : 04                  		db 04h
(1) 3223/    1220 : 00 00               		dw 0
(1) 3224/    1222 : 00 00               		dw 0
(1) 3225/    1224 : 00                  		db 0
(1) 3226/    1225 : 00                  		db 0
(1) 3227/    1226 : 03                  		db 11b
(1) 3228/    1227 : 05                  		db 05h
(1) 3229/    1228 : 00 00               		dw 0
(1) 3230/    122A : 00 00               		dw 0
(1) 3231/    122C : 00                  		db 0
(1) 3232/    122D : 00                  		db 0
(1) 3233/    122E : 03                  		db 11b
(1) 3234/    122F : 06                  		db 06h
(1) 3235/    1230 : 00 00               		dw 0
(1) 3236/    1232 : 00 00               		dw 0
(1) 3237/    1234 : 00                  		db 0
(1) 3238/    1235 : 00                  		db 0
(1) 3239/    1236 : 03                  		db 11b
(1) 3240/    1237 : FF                  		db -1
(1) 3241/    1238 :                     
(1) 3242/    1238 : 00 00 00 00         psgcom		db 00h,00h,00h,00h	;  0 command 1 = key on, 2 = key off, 4 = stop snd
(1) 3243/    123C : FF FF FF FF         psglev		db -1, -1, -1, -1	;  4 output level attenuation (%llll.0000, -1 = silent)
(1) 3244/    1240 : 00 00 00 00         psgatk		db 00h,00h,00h,00h	;  8 attack rate
(1) 3245/    1244 : 00 00 00 00         psgdec		db 00h,00h,00h,00h	; 12 decay rate
(1) 3246/    1248 : 00 00 00 00         psgslv		db 00h,00h,00h,00h	; 16 sustain level attenuation
(1) 3247/    124C : 00 00 00 00         psgrrt		db 00h,00h,00h,00h	; 20 release rate
(1) 3248/    1250 : 00 00 00 00         psgenv		db 00h,00h,00h,00h	; 24 envelope mode 0 = off, 1 = attack, 2 = decay, 3 = sustain, 4
(1) 3249/    1254 : 00 00 00 00         psgdtl		db 00h,00h,00h,00h	; 28 tone bottom 4 bits
(1) 3250/    1258 : 00 00 00 00         psgdth		db 00h,00h,00h,00h	; 32 tone upper 6 bits
(1) 3251/    125C : 00 00 00 00         psgalv		db 00h,00h,00h,00h	; 36 attack level attenuation
(1) 3252/    1260 : 00 00 00 00         whdflg		db 00h,00h,00h,00h	; 40 flags to indicate hardware should be updated
(1) 3253/    1264 : 00 00 00 00         psgtim		db 00h,00h,00h,00h	; 44 timer for sustain
(1) 3254/    1268 :                     
(1) 3255/    1268 :                     ; ====================================================================
(1) 3256/    1268 :                     ; ----------------------------------------------------------------
(1) 3257/    1268 :                     ; FM Voices
(1) 3258/    1268 :                     ; ----------------------------------------------------------------
(1) 3259/    1268 :                     
(1) 3260/    1268 :                     		include "data/sound/instr_z80.asm"
(2)    1/    1268 :                     ; ====================================================================
(2)    2/    1268 :                     ; ----------------------------------------------------------------
(2)    3/    1268 :                     ; PSG, FM, FM3, DAC instruments go here.
(2)    4/    1268 :                     ; Stored on Z80's RAM space
(2)    5/    1268 :                     ; 
(2)    6/    1268 :                     ; NOTE: Very low storage space
(2)    7/    1268 :                     ; ----------------------------------------------------------------
(2)    8/    1268 :                     
(2)    9/    1268 :                     zSmpl 		macro start,end,loop,flags
(2)   10/    1268 :                     		db start&0FFh,((start>>8)&0FFh),((start>>16)&0FFh)
(2)   11/    1268 :                     		db ((end-start)&0FFh),(((end-start)>>8)&0FFh),(((end-start)>>16)&0FFh)
(2)   12/    1268 :                     		db loop&0FFh,((loop>>8)&0FFh),((loop>>16)&0FFh)
(2)   13/    1268 :                     		db 0
(2)   14/    1268 :                     		endm
(2)   15/    1268 :                     
(2)   16/    1268 : (MACRO)             DacIns_Magic1:	zSmpl Sampl_Magic1,Sampl_Magic1_End,0
(2)   16/    1268 : A4 A2 90                            db SAMPL_MAGIC1&0FFh,((SAMPL_MAGIC1>>8)&0FFh),((SAMPL_MAGIC1>>16)&0FFh)
(2)   16/    126B : 8E 8E 01                            db ((SAMPL_MAGIC1_END-SAMPL_MAGIC1)&0FFh),(((SAMPL_MAGIC1_END-SAMPL_MAGIC1)>>8)&0FFh),(((SAMPL_MAGIC1_END-SAMPL_MAGIC1)>>16)&0FFh)
(2)   16/    126E : 00 00 00                            db 0&0FFh,((0>>8)&0FFh),((0>>16)&0FFh)
(2)   16/    1271 : 00                                  db 0
(2)   17/    1272 : (MACRO)             DacIns_Magic2:	zSmpl Sampl_Magic2,Sampl_Magic2_End,0
(2)   17/    1272 : 32 31 92                            db SAMPL_MAGIC2&0FFh,((SAMPL_MAGIC2>>8)&0FFh),((SAMPL_MAGIC2>>16)&0FFh)
(2)   17/    1275 : 34 8E 01                            db ((SAMPL_MAGIC2_END-SAMPL_MAGIC2)&0FFh),(((SAMPL_MAGIC2_END-SAMPL_MAGIC2)>>8)&0FFh),(((SAMPL_MAGIC2_END-SAMPL_MAGIC2)>>16)&0FFh)
(2)   17/    1278 : 00 00 00                            db 0&0FFh,((0>>8)&0FFh),((0>>16)&0FFh)
(2)   17/    127B : 00                                  db 0
(2)   18/    127C : (MACRO)             DacIns_MyTime:	zSmpl Sampl_MyTime,Sampl_MyTime_End,0
(2)   18/    127C : 66 BF 93                            db SAMPL_MYTIME&0FFh,((SAMPL_MYTIME>>8)&0FFh),((SAMPL_MYTIME>>16)&0FFh)
(2)   18/    127F : D5 AF 00                            db ((SAMPL_MYTIME_END-SAMPL_MYTIME)&0FFh),(((SAMPL_MYTIME_END-SAMPL_MYTIME)>>8)&0FFh),(((SAMPL_MYTIME_END-SAMPL_MYTIME)>>16)&0FFh)
(2)   18/    1282 : 00 00 00                            db 0&0FFh,((0>>8)&0FFh),((0>>16)&0FFh)
(2)   18/    1285 : 00                                  db 0
(2)   19/    1286 :                     
(2)   20/    1286 : 00 FF 40 00 80      PsgIns_00:	db 00h,0FFh,40h,00h, 80h
(2)   21/    128B : 00 FF 00 03 03      PsgIns_01:	db 00h,0FFh,00h,03h, 03h
(2)   22/    1290 : 00 FF 80 04 04      PsgIns_02:	db 00h,0FFh,80h,04h, 04h
(2)   23/    1295 : 30 FF FF 00 04      PsgIns_03:	db 30h,0FFh, -1,00h, 04h
(2)   24/    129A : 00 FF FF 01 01      PsgIns_Bass:	db 00h,0FFh, -1,01h, 01h
(2)   25/    129F : 00 FF 00 F0 F0      PsgIns_Snare:	db 00h,0FFh,00h,0F0h,0F0h
(2)   26/    12A4 :                     
(2)   27/    12A4 :                     Fmins_Guitar_Heavy:
(2)   28/    12A4 :                     		binclude "data/sound/instr/fm/guitar_heavy.gsx",2478h,28h
(2)   29/    12CC :                     FmIns_Fm3_OpenHat:
(2)   30/    12CC :                     		binclude "data/sound/instr/fm/fm3_openhat.gsx",2478h,28h
(2)   31/    12F4 :                     FmIns_Fm3_ClosedHat:
(2)   32/    12F4 :                     		binclude "data/sound/instr/fm/fm3_closedhat.gsx",2478h,28h
(2)   33/    131C :                     		
(2)   34/    131C :                     FmIns_DrumKick:
(2)   35/    131C :                     		binclude "data/sound/instr/fm/drum_kick.gsx",2478h,20h
(2)   36/    133C :                     ; FmIns_DrumSnare:
(2)   37/    133C :                     ; 		binclude "data/sound/instr/fm/drum_snare.gsx",2478h,20h
(2)   38/    133C :                     ; FmIns_DrumCloseHat:
(2)   39/    133C :                     ; 		binclude "data/sound/instr/fm/drum_closehat.gsx",2478h,20h
(2)   40/    133C :                     ; FmIns_Piano_m1:
(2)   41/    133C :                     ; 		binclude "data/sound/instr/fm/piano_m1.gsx",2478h,20h
(2)   42/    133C :                     
(2)   43/    133C :                     ; FmIns_Bass_gum:
(2)   44/    133C :                     ; 		binclude "data/sound/instr/fm/bass_gum.gsx",2478h,20h
(2)   45/    133C :                     FmIns_Bass_calm:
(2)   46/    133C :                     		binclude "data/sound/instr/fm/bass_calm.gsx",2478h,20h
(2)   47/    135C :                     ; FmIns_Bass_heavy:
(2)   48/    135C :                     ; 		binclude "data/sound/instr/fm/bass_heavy.gsx",2478h,20h
(2)   49/    135C :                     ; FmIns_Bass_ambient:
(2)   50/    135C :                     ; 		binclude "data/sound/instr/fm/bass_ambient.gsx",2478h,20h
(2)   51/    135C :                     ; FmIns_Brass_gummy:
(2)   52/    135C :                     ; 		binclude "data/sound/instr/fm/brass_gummy.gsx",2478h,20h
(2)   53/    135C :                     ; FmIns_Flaute_1:
(2)   54/    135C :                     ; 		binclude "data/sound/instr/fm/flaute_1.gsx",2478h,20h
(2)   55/    135C :                     ; FmIns_Bass_1:
(2)   56/    135C :                     ; 		binclude "data/sound/instr/fm/bass_2.gsx",2478h,20h
(2)   57/    135C :                     ; FmIns_Bass_2:
(2)   58/    135C :                     ; 		binclude "data/sound/instr/fm/bass_2.gsx",2478h,20h
(2)   59/    135C :                     ; FmIns_Bass_3:
(2)   60/    135C :                     ; 		binclude "data/sound/instr/fm/bass_3.gsx",2478h,20h
(2)   61/    135C :                     ; FmIns_Bass_4:
(2)   62/    135C :                     ; 		binclude "data/sound/instr/fm/bass_4.gsx",2478h,20h
(2)   63/    135C :                     ; FmIns_Bass_5:
(2)   64/    135C :                     ; 		binclude "data/sound/instr/fm/bass_5.gsx",2478h,20h
(2)   65/    135C :                     ; FmIns_Bass_6:
(2)   66/    135C :                     ; 		binclude "data/sound/instr/fm/bass_6.gsx",2478h,20h
(2)   67/    135C :                     ; FmIns_Bass_7:
(2)   68/    135C :                     ; 		binclude "data/sound/instr/fm/bass_7.gsx",2478h,20h
(2)   69/    135C :                     ; FmIns_Bass_heavy:
(2)   70/    135C :                     ; 		binclude "data/sound/instr/fm/bass_heavy.gsx",2478h,20h
(2)   71/    135C :                     ; FmIns_Bass_metal:
(2)   72/    135C :                     ; 		binclude "data/sound/instr/fm/bass_metal.gsx",2478h,20h
(2)   73/    135C :                     ; FmIns_Bass_synth:
(2)   74/    135C :                     ; 		binclude "data/sound/instr/fm/bass_synth_1.gsx",2478h,20h
(2)   75/    135C :                     ; FmIns_Guitar_1:
(2)   76/    135C :                     ; 		binclude "data/sound/instr/fm/guitar_1.gsx",2478h,20h
(2)   77/    135C :                     ; FmIns_Horn_1:
(2)   78/    135C :                     ; 		binclude "data/sound/instr/fm/horn_1.gsx",2478h,20h
(2)   79/    135C :                     ; FmIns_Organ_M1:
(2)   80/    135C :                     ; 		binclude "data/sound/instr/fm/organ_m1.gsx",2478h,20h
(2)   81/    135C :                     ; FmIns_Bass_Beach:
(2)   82/    135C :                     ; 		binclude "data/sound/instr/fm/bass_beach.gsx",2478h,20h
(2)   83/    135C :                     ; FmIns_Bass_Beach_2:
(2)   84/    135C :                     ; 		binclude "data/sound/instr/fm/bass_beach_2.gsx",2478h,20h
(2)   85/    135C :                     ; FmIns_Brass_Cave:
(2)   86/    135C :                     ; 		binclude "data/sound/instr/fm/brass_cave.gsx",2478h,20h
(2)   87/    135C :                     FmIns_Brass_Gem:
(2)   88/    135C :                     		binclude "data/sound/instr/fm/brass_gem.gsx",2478h,20h
(2)   89/    137C :                     FmIns_Piano_Small:
(2)   90/    137C :                     		binclude "data/sound/instr/fm/piano_small.gsx",2478h,20h
(2)   91/    139C :                     FmIns_Piano:
(2)   92/    139C :                     		binclude "data/sound/instr/fm/piano_m1.gsx",2478h,20h
(2)   93/    13BC :                     FmIns_Trumpet_2:
(2)   94/    13BC :                     		binclude "data/sound/instr/fm/trumpet_2.gsx",2478h,20h
(2)   95/    13DC :                     ; FmIns_Bell_Glass:
(2)   96/    13DC :                     ; 		binclude "data/sound/instr/fm/bell_glass.gsx",2478h,20h
(2)   97/    13DC :                     ; FmIns_Marimba_1:
(2)   98/    13DC :                     ; 		binclude "data/sound/instr/fm/marimba_1.gsx",2478h,20h
(2)   99/    13DC :                     FmIns_Ambient_dark:
(2)  100/    13DC :                     		binclude "data/sound/instr/fm/ambient_dark.gsx",2478h,20h
(2)  101/    13FC :                     FmIns_Ambient_spook:
(2)  102/    13FC :                     		binclude "data/sound/instr/fm/ambient_spook.gsx",2478h,20h
(2)  103/    141C :                     FmIns_Ambient_3:
(2)  104/    141C :                     		binclude "data/sound/instr/fm/ambient_3.gsx",2478h,20h
(2)  105/    143C :                     ; FmIns_Ding_toy:
(2)  106/    143C :                     ; 		binclude "data/sound/instr/fm/ding_toy.gsx",2478h,20h
(2)  107/    143C :                     
(1) 3261/    143C :                     		; PWM instruments are stored in SDRAM
(1) 3262/    143C :                     
(1) 3263/    143C :                     ; ====================================================================
(1) 3264/    143C :                     ; ----------------------------------------------------------------
(1) 3265/    143C :                     ; Z80 RAM
(1) 3266/    143C :                     ; ----------------------------------------------------------------
(1) 3267/    143C :                     
(1) 3268/    143C :                     ; --------------------------------------------------------
(1) 3269/    143C :                     ; Buffers
(1) 3270/    143C :                     ; --------------------------------------------------------
(1) 3271/    143C :                     
(1) 3272/    143C :                     		align 100h
(1) 3273/    1500 :                     dWaveBuff	ds 100h			; WAVE data buffer: updated every 80h bytes *LSB must be 00h*
(1) 3274/    1600 :                     trkDataC	ds 100h*MAX_TRKS	; Track data cache: 100h bytes each
(1) 3275/    1800 :                     trkBuff		ds 100h*MAX_TRKS	; Track control (20h) + channels (8h each)
(1) 3276/    1A00 :                     blkHeadC	ds 100h*MAX_TRKS	; Track blocks and heads: 80h each
(1) 3277/    1C00 :                     insDataC	ds 80h*MAX_TRKS		; Instrument pointers cache: 80h each
(1) 3278/    1D00 :                     commZfifo	ds 40h			; Buffer for command requests from 68k
(1) 3279/    1D40 :                     
      49/    1D40 :                     		cpu 68000
      50/    1D40 :                     		padding off
      51/    4240 :                     		phase Z80_CODE+*
      52/    4240 :                     Z80_CODE_END:
      53/    4240 :                     		align 2
      54/    4240 :                     
      55/    4240 :                     ; ====================================================================
      56/    4240 :                     ; ----------------------------------------------------------------
      57/    4240 :                     ; 68k code-banks for RAM
      58/    4240 :                     ;
      59/    4240 :                     ; 880000 area: 512KB max
      60/    4240 :                     ; ----------------------------------------------------------------
      61/    4240 :                     
      62/    4240 :                     Default_Boot:
      63/  FF1B8A :                     		phase RAMCODE_USER
      64/  FF1B8A :                     		include "code/default.asm"
(1)    1/  FF1B8A :                     ; ====================================================================
(1)    2/  FF1B8A :                     ; ----------------------------------------------------------------
(1)    3/  FF1B8A :                     ; Default gamemode
(1)    4/  FF1B8A :                     ; ----------------------------------------------------------------
(1)    5/  FF1B8A :                     
(1)    6/  FF1B8A :                     ; ====================================================================
(1)    7/  FF1B8A :                     ; ------------------------------------------------------
(1)    8/  FF1B8A :                     ; Variables
(1)    9/  FF1B8A :                     ; ------------------------------------------------------
(1)   10/  FF1B8A :                     
(1)   11/  FF1B8A : =$4000              var_MoveSpd	equ	$4000
(1)   12/  FF1B8A :                     
(1)   13/  FF1B8A :                     ; ====================================================================
(1)   14/  FF1B8A :                     ; ------------------------------------------------------
(1)   15/  FF1B8A :                     ; Structs
(1)   16/  FF1B8A :                     ; ------------------------------------------------------
(1)   17/  FF1B8A :                     
(1)   18/  FF1B8A :                     ; 		struct 0
(1)   19/  FF1B8A :                     ; strc_xpos	ds.w 1
(1)   20/  FF1B8A :                     ; strc_ypos	ds.w 1
(1)   21/  FF1B8A :                     ; 		finish
(1)   22/  FF1B8A :                     
(1)   23/  FF1B8A :                     ; ====================================================================
(1)   24/  FF1B8A :                     ; ------------------------------------------------------
(1)   25/  FF1B8A :                     ; This mode's RAM
(1)   26/  FF1B8A :                     ; ------------------------------------------------------
(1)   27/  FF1B8A :                     
(1)   28/  FF1B8A : (MACRO)             		struct RAM_ModeBuff
(1)   28/  FF1B8A : =$FF1B8A            GLBL_LASTPC     set *
(1)   28/    4240 :                                     dephase
(1)   28/    4240 : =$4240              GLBL_LASTORG    set *
(1)   28/FFFFFFFFFFFF8800 :                                     phase RAM_MODEBUFF
(1)   29/FFFFFFFFFFFF8800 :                     RAM_MarsPal	ds.w 256
(1)   30/FFFFFFFFFFFF8A00 :                     RAM_MarsFade	ds.w 256
(1)   31/FFFFFFFFFFFF8C00 :                     RAM_Cam_Xpos	ds.l 1
(1)   32/FFFFFFFFFFFF8C04 :                     RAM_Cam_Ypos	ds.l 1
(1)   33/FFFFFFFFFFFF8C08 :                     RAM_Cam_Zpos	ds.l 1
(1)   34/FFFFFFFFFFFF8C0C :                     RAM_Cam_Xrot	ds.l 1
(1)   35/FFFFFFFFFFFF8C10 :                     RAM_Cam_Yrot	ds.l 1
(1)   36/FFFFFFFFFFFF8C14 :                     RAM_Cam_Zrot	ds.l 1
(1)   37/FFFFFFFFFFFF8C18 :                     RAM_CamData	ds.l 1
(1)   38/FFFFFFFFFFFF8C1C :                     RAM_CamFrame	ds.l 1
(1)   39/FFFFFFFFFFFF8C20 :                     RAM_CamTimer	ds.l 1
(1)   40/FFFFFFFFFFFF8C24 :                     RAM_CamSpeed	ds.l 1
(1)   41/FFFFFFFFFFFF8C28 :                     RAM_MdlCurrMd	ds.w 1
(1)   42/FFFFFFFFFFFF8C2A :                     RAM_BgCamera	ds.w 1
(1)   43/FFFFFFFFFFFF8C2C :                     RAM_BgCamCurr	ds.w 1
(1)   44/FFFFFFFFFFFF8C2E :                     RAM_Layout_X	ds.w 1
(1)   45/FFFFFFFFFFFF8C30 :                     RAM_Layout_Y	ds.w 1
(1)   46/FFFFFFFFFFFF8C32 :                     sizeof_mdglbl	ds.l 0
(1)   47/FFFFFFFFFFFF8C34 : (MACRO)             		finish
(1)   47/FFFFFFFFFFFF8800 :                                     !org GLBL_LASTORG
(1)   47/  FF1B8A :                                     phase GLBL_LASTPC
(1)   48/  FF1B8A :                     
(1)   49/  FF1B8A :                     ; ====================================================================
(1)   50/  FF1B8A :                     ; ------------------------------------------------------
(1)   51/  FF1B8A :                     ; Code start
(1)   52/  FF1B8A :                     ; ------------------------------------------------------
(1)   53/  FF1B8A :                     
(1)   54/  FF1B8A :                     thisCode_Top:
(1)   55/  FF1B8A : 46FC 2700           		move.w	#$2700,sr
(1)   56/  FF1B8E : 61CA                		bsr	Mode_Init
(1)   57/  FF1B90 : 6100 E82A           		bsr	Video_PrintInit
(1)   58/  FF1B94 : 31FC 0000 8C28      		move.w	#0,(RAM_MdlCurrMd).w
(1)   59/  FF1B9A :                     ; 		move.l	#GemaTrk_Demo_patt,d0
(1)   60/  FF1B9A :                     ; 		move.l	#GemaTrk_Demo_blk,d1
(1)   61/  FF1B9A :                     ; 		move.l	#GemaTrk_Demo_ins,d2
(1)   62/  FF1B9A :                     ; 		moveq	#4,d3
(1)   63/  FF1B9A :                     ; 		moveq	#0,d4
(1)   64/  FF1B9A :                     ; 		bsr	SoundReq_SetTrack
(1)   65/  FF1B9A :                     
(1)   66/  FF1B9A : 08F9 0006 FFFF 91A3 		bset	#bitDispEnbl,(RAM_VdpRegs+1).l		; Enable display
(1)   67/  FF1BA2 : 6100 E6C4           		bsr	Video_Update
(1)   68/  FF1BA6 :                     
(1)   69/  FF1BA6 :                     ; 		moveq	#0,d1
(1)   70/  FF1BA6 :                     ; 		move.l	#PWM_STEREO,d2
(1)   71/  FF1BA6 :                     ; 		move.l	#PWM_STEREO_e,d3
(1)   72/  FF1BA6 :                     ; 		move.l	d2,d4
(1)   73/  FF1BA6 :                     ; 		move.l	#$100,d5
(1)   74/  FF1BA6 :                     ; 		move.l	#0,d6
(1)   75/  FF1BA6 :                     ; 		moveq	#%11|%10000000,d7
(1)   76/  FF1BA6 :                     ; 		move.l	#CmdTaskMd_PWM_SetChnl,d0
(1)   77/  FF1BA6 :                     ; 		bsr	System_MdMars_MstTask
(1)   78/  FF1BA6 :                     
(1)   79/  FF1BA6 :                     ; ====================================================================
(1)   80/  FF1BA6 :                     ; ------------------------------------------------------
(1)   81/  FF1BA6 :                     ; Loop
(1)   82/  FF1BA6 :                     ; ------------------------------------------------------
(1)   83/  FF1BA6 :                     
(1)   84/  FF1BA6 :                     .loop:
(1)   85/  FF1BA6 : 3839 00C0 0004      		move.w	(vdp_ctrl),d4
(1)   86/  FF1BAC : 0804 0003           		btst	#bitVint,d4
(1)   87/  FF1BB0 : 67F4                		beq.s	.loop
(1)   88/  FF1BB2 : 6100 FC8A           		bsr	System_Input
(1)   89/  FF1BB6 : 3839 00C0 0004      .inside:	move.w	(vdp_ctrl),d4
(1)   90/  FF1BBC : 0804 0003           		btst	#bitVint,d4
(1)   91/  FF1BC0 : 66F4                		bne.s	.inside
(1)   92/  FF1BC2 :                     ; 		rts
(1)   93/  FF1BC2 :                     
(1)   94/  FF1BC2 :                     ; 		bsr	System_VSync
(1)   95/  FF1BC2 : 23FC 7C00 0003 00C0 		move.l	#$7C000003,(vdp_ctrl).l
                    0004                
(1)   96/  FF1BCC : 3039 FFFF 8C2C      		move.w	(RAM_BgCamCurr).l,d0
(1)   97/  FF1BD2 : 4440                		neg.w	d0
(1)   98/  FF1BD4 : E440                		asr.w	#2,d0
(1)   99/  FF1BD6 : 33C0 00C0 0000      		move.w	d0,(vdp_data).l
(1)  100/  FF1BDC : E240                		asr.w	#1,d0
(1)  101/  FF1BDE : 33C0 00C0 0000      		move.w	d0,(vdp_data).l
(1)  102/  FF1BE4 : 41FA 00E8           		lea	str_Status(pc),a0
(1)  103/  FF1BE8 : 203C 0000 0000      		move.l	#locate(0,0,0),d0
(1)  104/  FF1BEE : 6100 E7F0           		bsr	Video_Print
(1)  105/  FF1BF2 : 3038 8C28           		move.w	(RAM_MdlCurrMd).w,d0
(1)  106/  FF1BF6 : C07C 001F           		and.w	#%11111,d0
(1)  107/  FF1BFA : D040                		add.w	d0,d0
(1)  108/  FF1BFC : D040                		add.w	d0,d0
(1)  109/  FF1BFE : 4EBB 0004           		jsr	.list(pc,d0.w)
(1)  110/  FF1C02 : 60A2                		bra	.loop
(1)  111/  FF1C04 :                     
(1)  112/  FF1C04 :                     ; ====================================================================
(1)  113/  FF1C04 :                     ; ------------------------------------------------------
(1)  114/  FF1C04 :                     ; Mode sections
(1)  115/  FF1C04 :                     ; ------------------------------------------------------
(1)  116/  FF1C04 :                     
(1)  117/  FF1C04 :                     .list:
(1)  118/  FF1C04 : 6000 000A           		bra.w	.mode0
(1)  119/  FF1C08 : 6000 0006           		bra.w	.mode0
(1)  120/  FF1C0C : 6000 0002           		bra.w	.mode0
(1)  121/  FF1C10 :                     
(1)  122/  FF1C10 :                     ; --------------------------------------------------
(1)  123/  FF1C10 :                     ; Mode 0
(1)  124/  FF1C10 :                     ; --------------------------------------------------
(1)  125/  FF1C10 :                     
(1)  126/  FF1C10 :                     .mode0:
(1)  127/  FF1C10 : 4A78 8C28           		tst.w	(RAM_MdlCurrMd).w
(1)  128/  FF1C14 : 6B1E                		bmi	.mode0_loop
(1)  129/  FF1C16 : 0078 8000 8C28      		or.w	#$8000,(RAM_MdlCurrMd).w
(1)  130/  FF1C1C :                     
(1)  131/  FF1C1C :                     ; 		lea	MdPal_BgTestB(pc),a0
(1)  132/  FF1C1C :                     ; 		move.w	#0,d0
(1)  133/  FF1C1C :                     ; 		move.w	#32-1,d1
(1)  134/  FF1C1C :                     ; 		bsr	Video_LoadPal
(1)  135/  FF1C1C :                     ; 		lea	(MdMap_BgTestB),a0
(1)  136/  FF1C1C :                     ; 		move.l	#locate(1,0,0),d0
(1)  137/  FF1C1C :                     ; 		move.l	#mapsize(512,224),d1
(1)  138/  FF1C1C :                     ; 		move.w	#1,d2
(1)  139/  FF1C1C :                     ; 		bsr	Video_LoadMap
(1)  140/  FF1C1C :                     ; 		move.l	#MdGfx_BgTestB,d0
(1)  141/  FF1C1C :                     ; 		move.w	#(MdGfx_BgTestB_e-MdGfx_BgTestB),d1
(1)  142/  FF1C1C :                     ; 		move.w	#1,d2
(1)  143/  FF1C1C :                     ; 		bsr	Video_LoadArt
(1)  144/  FF1C1C :                     ;
(1)  145/  FF1C1C :                     ; 		lea	(MdMap_BgTestT),a0
(1)  146/  FF1C1C :                     ; 		move.l	#locate(0,0,0),d0
(1)  147/  FF1C1C :                     ; 		move.l	#mapsize(512,224),d1
(1)  148/  FF1C1C :                     ; 		move.w	#$180,d2
(1)  149/  FF1C1C :                     ; 		bsr	Video_LoadMap
(1)  150/  FF1C1C :                     ; 		move.l	#MdGfx_BgTestT,d0
(1)  151/  FF1C1C :                     ; 		move.w	#(MdGfx_BgTestT_e-MdGfx_BgTestT),d1
(1)  152/  FF1C1C :                     ; 		move.w	#$180,d2
(1)  153/  FF1C1C :                     ; 		bsr	Video_LoadArt
(1)  154/  FF1C1C :                     
(1)  155/  FF1C1C :                     ; 		move.l	#CmdTaskMd_SetBitmap,d0		; 32X display OFF
(1)  156/  FF1C1C :                     ; 		moveq	#0,d1
(1)  157/  FF1C1C :                     ; 		bsr	System_MdMars_MstTask		; Wait until it finishes.
(1)  158/  FF1C1C :                     ; 		bclr	#bitDispEnbl,(RAM_VdpRegs+1).l	; Disable MD display
(1)  159/  FF1C1C :                     ; 		bsr	Video_Update
(1)  160/  FF1C1C :                     ; 		move.l	#TESTMARS_BG_PAL,d1			; Load palette
(1)  161/  FF1C1C :                     ; 		moveq	#0,d2
(1)  162/  FF1C1C :                     ; 		move.l	#256,d3
(1)  163/  FF1C1C :                     ; 		move.l	#$0000,d4
(1)  164/  FF1C1C :                     ; 		move.l	#CmdTaskMd_LoadSPal,d0
(1)  165/  FF1C1C :                     ; 		bsr	System_MdMars_MstTask
(1)  166/  FF1C1C :                     ; 		move.l	#CmdTaskMd_SetBitmap,d0		; 32X display ON
(1)  167/  FF1C1C :                     ; 		moveq	#1,d1
(1)  168/  FF1C1C :                     ; 		bsr	System_MdMars_MstTask
(1)  169/  FF1C1C :                     ; 		bset	#bitDispEnbl,(RAM_VdpRegs+1).l	; Enable MD display
(1)  170/  FF1C1C :                     ; 		bsr	Video_Update
(1)  171/  FF1C1C :                     
(1)  172/  FF1C1C : 33FC 0000 00A1 5120 		move.w	#$0000,(sysmars_reg+comm0)
(1)  173/  FF1C24 : 33FC 0000 00A1 5122 		move.w	#$0000,(sysmars_reg+comm2)
(1)  174/  FF1C2C :                     ; 		move.w	#$0100,(sysmars_reg+comm4)
(1)  175/  FF1C2C :                     ; 		move.w	#$0100,(sysmars_reg+comm6)
(1)  176/  FF1C2C : 33FC 474F 00A1 512E 		move.w	#"GO",(sysmars_reg+comm14)
(1)  177/  FF1C34 :                     
(1)  178/  FF1C34 :                     ; Mode 0 mainloop
(1)  179/  FF1C34 :                     .mode0_loop:
(1)  180/  FF1C34 : 7000                		moveq	#0,d0
(1)  181/  FF1C36 : 7200                		moveq	#0,d1
(1)  182/  FF1C38 :                     
(1)  183/  FF1C38 :                     ; 		move.b	(sysmars_reg+comm14).l,d7
(1)  184/  FF1C38 :                     ; 		tst.b	d7
(1)  185/  FF1C38 :                     ; 		bne	.busy_mstr
(1)  186/  FF1C38 : 3E38 91BE           		move.w	(Controller_1+on_press),d7
(1)  187/  FF1C3C : 3C07                		move.w	d7,d6
(1)  188/  FF1C3E : CC7C 0200           		and.w	#JoyY,d6
(1)  189/  FF1C42 : 6704                		beq.s	.no_x
(1)  190/  FF1C44 :                     ; 		sub.w	#1,(RAM_BgCamCurr).l
(1)  191/  FF1C44 : 303C FFFF           		move.w	#-1,d0
(1)  192/  FF1C48 :                     .no_x:
(1)  193/  FF1C48 : 3C07                		move.w	d7,d6
(1)  194/  FF1C4A : CC7C 0100           		and.w	#JoyZ,d6
(1)  195/  FF1C4E : 6704                		beq.s	.no_y
(1)  196/  FF1C50 :                     ; 		add.w	#1,(RAM_BgCamCurr).l
(1)  197/  FF1C50 : 303C 0001           		move.w	#1,d0
(1)  198/  FF1C54 :                     .no_y:
(1)  199/  FF1C54 :                     
(1)  200/  FF1C54 :                     
(1)  201/  FF1C54 : 3E38 91BC           		move.w	(Controller_1+on_hold),d7
(1)  202/  FF1C58 : 0807 0000           		btst	#bitJoyUp,d7
(1)  203/  FF1C5C : 6704                		beq.s	.no_up
(1)  204/  FF1C5E : 323C FFFC           		move.w	#-4,d1
(1)  205/  FF1C62 :                     .no_up:
(1)  206/  FF1C62 : 0807 0001           		btst	#bitJoyDown,d7
(1)  207/  FF1C66 : 6704                		beq.s	.no_dw
(1)  208/  FF1C68 : 323C 0004           		move.w	#4,d1
(1)  209/  FF1C6C :                     .no_dw:
(1)  210/  FF1C6C : 0807 0002           		btst	#bitJoyLeft,d7
(1)  211/  FF1C70 : 6704                		beq.s	.no_lf
(1)  212/  FF1C72 :                     ; 		sub.w	#3,(RAM_BgCamCurr).l
(1)  213/  FF1C72 : 303C FFFC           		move.w	#-4,d0
(1)  214/  FF1C76 :                     .no_lf:
(1)  215/  FF1C76 : 0807 0003           		btst	#bitJoyRight,d7
(1)  216/  FF1C7A : 6704                		beq.s	.no_rf
(1)  217/  FF1C7C :                     ; 		add.w	#3,(RAM_BgCamCurr).l
(1)  218/  FF1C7C : 303C 0004           		move.w	#4,d0
(1)  219/  FF1C80 :                     .no_rf:
(1)  220/  FF1C80 :                     ; 		move.b	(sysmars_reg+comm14).l,d7
(1)  221/  FF1C80 :                     ; 		tst.b	d7
(1)  222/  FF1C80 :                     ; 		bne.s	.busy
(1)  223/  FF1C80 : 33C0 00A1 5120      		move.w	d0,(sysmars_reg+comm0).l
(1)  224/  FF1C86 : 33C1 00A1 5122      		move.w	d1,(sysmars_reg+comm2).l
(1)  225/  FF1C8C :                     .busy:
(1)  226/  FF1C8C :                     
(1)  227/  FF1C8C :                     ; 		move.w	(Controller_2+on_hold),d7
(1)  228/  FF1C8C :                     ; 		btst	#bitJoyUp,d7
(1)  229/  FF1C8C :                     ; 		beq.s	.no2_up
(1)  230/  FF1C8C :                     ; 		sub.w	#1,(sysmars_reg+comm6).l
(1)  231/  FF1C8C :                     ; .no2_up:
(1)  232/  FF1C8C :                     ; 		btst	#bitJoyDown,d7
(1)  233/  FF1C8C :                     ; 		beq.s	.no2_dw
(1)  234/  FF1C8C :                     ; 		add.w	#1,(sysmars_reg+comm6).l
(1)  235/  FF1C8C :                     ; .no2_dw:
(1)  236/  FF1C8C :                     ; 		btst	#bitJoyLeft,d7
(1)  237/  FF1C8C :                     ; 		beq.s	.no2_lf
(1)  238/  FF1C8C :                     ; 		sub.w	#1,(sysmars_reg+comm4).l
(1)  239/  FF1C8C :                     ; .no2_lf:
(1)  240/  FF1C8C :                     ; 		btst	#bitJoyRight,d7
(1)  241/  FF1C8C :                     ; 		beq.s	.no2_rf
(1)  242/  FF1C8C :                     ; 		add.w	#1,(sysmars_reg+comm4).l
(1)  243/  FF1C8C :                     ; .no2_rf:
(1)  244/  FF1C8C :                     
(1)  245/  FF1C8C :                     
(1)  246/  FF1C8C :                     ; 		move.l	#CmdTaskMd_UpdModels,d0
(1)  247/  FF1C8C :                     ; 		bsr	System_MdMars_SlvTask
(1)  248/  FF1C8C :                     .busy_mstr:
(1)  249/  FF1C8C : 4E75                		rts
(1)  250/  FF1C8E :                     
(1)  251/  FF1C8E :                     ; ====================================================================
(1)  252/  FF1C8E :                     ; ------------------------------------------------------
(1)  253/  FF1C8E :                     ; Subroutines
(1)  254/  FF1C8E :                     ; ------------------------------------------------------
(1)  255/  FF1C8E :                     
(1)  256/  FF1C8E :                     MdMdl_SetNewCamera:
(1)  257/  FF1C8E : 42B9 FFFF 8C00      		clr.l	(RAM_Cam_Xpos).l
(1)  258/  FF1C94 : 42B9 FFFF 8C04      		clr.l	(RAM_Cam_Ypos).l
(1)  259/  FF1C9A : 42B9 FFFF 8C08      		clr.l	(RAM_Cam_Zpos).l
(1)  260/  FF1CA0 : 42B9 FFFF 8C0C      		clr.l	(RAM_Cam_Xrot).l
(1)  261/  FF1CA6 : 42B9 FFFF 8C10      		clr.l	(RAM_Cam_Yrot).l
(1)  262/  FF1CAC : 42B9 FFFF 8C14      		clr.l	(RAM_Cam_Zrot).l
(1)  263/  FF1CB2 : 7800                		moveq	#0,d4
(1)  264/  FF1CB4 : 23C4 FFFF 8C1C      		move.l	d4,(RAM_CamFrame).l
(1)  265/  FF1CBA : 23C4 FFFF 8C20      		move.l	d4,(RAM_CamTimer).l
(1)  266/  FF1CC0 : 23C1 FFFF 8C24      		move.l	d1,(RAM_CamSpeed).l
(1)  267/  FF1CC6 : 23C0 FFFF 8C18      		move.l	d0,(RAM_CamData).l
(1)  268/  FF1CCC : 4E75                		rts
(1)  269/  FF1CCE :                     
(1)  270/  FF1CCE :                     ; d7 - Move to this mode after
(1)  271/  FF1CCE :                     ;      animation ends.
(1)  272/  FF1CCE :                     ; MdMdl_RunAnimation:
(1)  273/  FF1CCE :                     ; 		bsr	MdMdl_CamAnimate
(1)  274/  FF1CCE :                     ; 		bpl.s	.stay
(1)  275/  FF1CCE :                     ; 		move.w	d7,(RAM_MdlCurrMd).w
(1)  276/  FF1CCE :                     ; 		rts					; exit mode
(1)  277/  FF1CCE :                     ; .stay:
(1)  278/  FF1CCE :                     ; 		moveq	#0,d1
(1)  279/  FF1CCE :                     ; 		move.l	(RAM_Cam_Xpos),d2
(1)  280/  FF1CCE :                     ; 		move.l	(RAM_Cam_Ypos),d3
(1)  281/  FF1CCE :                     ; 		move.l	(RAM_Cam_Zpos),d4
(1)  282/  FF1CCE :                     ; 		move.l	(RAM_Cam_Xrot),d5
(1)  283/  FF1CCE :                     ; 		move.l	(RAM_Cam_Yrot),d6
(1)  284/  FF1CCE :                     ; 		move.l	(RAM_Cam_Zrot),d7
(1)  285/  FF1CCE :                     ; ; 		move.l	#CmdTaskMd_CameraPos,d0		; Load map
(1)  286/  FF1CCE :                     ; ; 		bsr	System_MdMars_SlvAddTask
(1)  287/  FF1CCE :                     ; ; 		move.l	#CmdTaskMd_UpdModels,d0
(1)  288/  FF1CCE :                     ; ; 		bsr	System_MdMars_SlvAddTask
(1)  289/  FF1CCE :                     ; 		bsr	System_MdMars_SlvSendDrop
(1)  290/  FF1CCE :                     ; .nel2:
(1)  291/  FF1CCE :                     ; 		bne.s	.busy
(1)  292/  FF1CCE :                     ; 		move.l	(RAM_Cam_Xrot),d1
(1)  293/  FF1CCE :                     ; 		neg.l	d1
(1)  294/  FF1CCE :                     ; 		lsr.l	#8,d1
(1)  295/  FF1CCE :                     ; 		move.w	d1,(RAM_BgCamCurr).l
(1)  296/  FF1CCE :                     ; .busy:
(1)  297/  FF1CCE :                     ; 		rts
(1)  298/  FF1CCE :                     
(1)  299/  FF1CCE :                     ; MdMdl_CamAnimate:
(1)  300/  FF1CCE :                     ; 		move.l	(RAM_CamData).l,d0			; If 0 == No animation
(1)  301/  FF1CCE :                     ; 		beq.s	.no_camanim
(1)  302/  FF1CCE :                     ; 		sub.l	#1,(RAM_CamTimer).l
(1)  303/  FF1CCE :                     ; 		bpl.s	.no_camanim
(1)  304/  FF1CCE :                     ; 		move.l	(RAM_CamSpeed).l,(RAM_CamTimer).l	; TEMPORAL timer
(1)  305/  FF1CCE :                     ; 		move.l	d0,a1
(1)  306/  FF1CCE :                     ; 		move.l	(a1)+,d1
(1)  307/  FF1CCE :                     ; 		move.l	(RAM_CamFrame).l,d0
(1)  308/  FF1CCE :                     ; 		add.l	#1,d0
(1)  309/  FF1CCE :                     ; 		cmp.l	d1,d0
(1)  310/  FF1CCE :                     ; 		bne.s	.on_frames
(1)  311/  FF1CCE :                     ; 		moveq	#-1,d0
(1)  312/  FF1CCE :                     ; 		rts
(1)  313/  FF1CCE :                     ; .on_frames:
(1)  314/  FF1CCE :                     ; 		move.l	d0,(RAM_CamFrame).l
(1)  315/  FF1CCE :                     ; 		mulu.w	#$18,d0
(1)  316/  FF1CCE :                     ; 		adda	d0,a1
(1)  317/  FF1CCE :                     ; 		move.l	(a1)+,(RAM_Cam_Xpos).l
(1)  318/  FF1CCE :                     ; 		move.l	(a1)+,(RAM_Cam_Ypos).l
(1)  319/  FF1CCE :                     ; 		move.l	(a1)+,(RAM_Cam_Zpos).l
(1)  320/  FF1CCE :                     ; 		move.l	(a1)+,(RAM_Cam_Xrot).l
(1)  321/  FF1CCE :                     ; 		move.l	(a1)+,(RAM_Cam_Yrot).l
(1)  322/  FF1CCE :                     ; 		move.l	(a1)+,(RAM_Cam_Zrot).l
(1)  323/  FF1CCE :                     ; 		lsr.l	#7,d1
(1)  324/  FF1CCE :                     ; 		move.w	d1,(RAM_BgCamera).l
(1)  325/  FF1CCE :                     ; .no_camanim:
(1)  326/  FF1CCE :                     ; 		moveq	#0,d0
(1)  327/  FF1CCE :                     ; 		rts
(1)  328/  FF1CCE :                     ;
(1)  329/  FF1CCE :                     ; MdMdl1_Usercontrol:
(1)  330/  FF1CCE :                     ; 		move.l	#var_MoveSpd,d5
(1)  331/  FF1CCE :                     ; 		move.l	#-var_MoveSpd,d6
(1)  332/  FF1CCE :                     ; 		move.w	(Controller_1+on_hold),d7
(1)  333/  FF1CCE :                     ; 		btst	#bitJoyUp,d7
(1)  334/  FF1CCE :                     ; 		beq.s	.no_up
(1)  335/  FF1CCE :                     ; ; 		lea	(RAM_MdCamera),a0
(1)  336/  FF1CCE :                     ; 		move.l	(RAM_Cam_Zpos).l,d0
(1)  337/  FF1CCE :                     ; 		add.l	d5,d0
(1)  338/  FF1CCE :                     ; 		move.l	d0,(RAM_Cam_Zpos).l
(1)  339/  FF1CCE :                     ; .no_up:
(1)  340/  FF1CCE :                     ; 		btst	#bitJoyDown,d7
(1)  341/  FF1CCE :                     ; 		beq.s	.no_dw
(1)  342/  FF1CCE :                     ; ; 		lea	(RAM_MdCamera),a0
(1)  343/  FF1CCE :                     ; 		move.l	(RAM_Cam_Zpos).l,d0
(1)  344/  FF1CCE :                     ; 		add.l	d6,d0
(1)  345/  FF1CCE :                     ; 		move.l	d0,(RAM_Cam_Zpos).l
(1)  346/  FF1CCE :                     ; .no_dw:
(1)  347/  FF1CCE :                     ; 		btst	#bitJoyLeft,d7
(1)  348/  FF1CCE :                     ; 		beq.s	.no_lf
(1)  349/  FF1CCE :                     ; ; 		lea	(RAM_MdCamera),a0
(1)  350/  FF1CCE :                     ; 		move.l	(RAM_Cam_Xpos).l,d0
(1)  351/  FF1CCE :                     ; 		add.l	d6,d0
(1)  352/  FF1CCE :                     ; 		move.l	d0,(RAM_Cam_Xpos).l
(1)  353/  FF1CCE :                     ; .no_lf:
(1)  354/  FF1CCE :                     ; 		btst	#bitJoyRight,d7
(1)  355/  FF1CCE :                     ; 		beq.s	.no_rg
(1)  356/  FF1CCE :                     ; ; 		lea	(RAM_MdCamera),a0
(1)  357/  FF1CCE :                     ; 		move.l	(RAM_Cam_Xpos).l,d0
(1)  358/  FF1CCE :                     ; 		add.l	d5,d0
(1)  359/  FF1CCE :                     ; 		move.l	d0,(RAM_Cam_Xpos).l
(1)  360/  FF1CCE :                     ; .no_rg:
(1)  361/  FF1CCE :                     ;
(1)  362/  FF1CCE :                     ; 		btst	#bitJoyB,d7
(1)  363/  FF1CCE :                     ; 		beq.s	.no_a
(1)  364/  FF1CCE :                     ; ; 		lea	(RAM_MdCamera),a0
(1)  365/  FF1CCE :                     ; 		move.l	(RAM_Cam_Xrot).l,d0
(1)  366/  FF1CCE :                     ; 		move.l	d6,d1
(1)  367/  FF1CCE :                     ; 		add.l	d1,d0
(1)  368/  FF1CCE :                     ; 		move.l	d0,(RAM_Cam_Xrot).l
(1)  369/  FF1CCE :                     ; 		lsr.l	#7,d0
(1)  370/  FF1CCE :                     ; 		neg.l	d0
(1)  371/  FF1CCE :                     ; 		move.w	d0,(RAM_BgCamera).l
(1)  372/  FF1CCE :                     ; .no_a:
(1)  373/  FF1CCE :                     ; 		btst	#bitJoyC,d7
(1)  374/  FF1CCE :                     ; 		beq.s	.no_b
(1)  375/  FF1CCE :                     ; ; 		lea	(RAM_MdCamera),a0
(1)  376/  FF1CCE :                     ; 		move.l	(RAM_Cam_Xrot).l,d0
(1)  377/  FF1CCE :                     ; 		move.l	d5,d1
(1)  378/  FF1CCE :                     ; 		add.l	d1,d0
(1)  379/  FF1CCE :                     ; 		move.l	d0,(RAM_Cam_Xrot).l
(1)  380/  FF1CCE :                     ; 		lsr.l	#7,d0
(1)  381/  FF1CCE :                     ; 		neg.l	d0
(1)  382/  FF1CCE :                     ; 		move.w	d0,(RAM_BgCamera).l
(1)  383/  FF1CCE :                     ; .no_b:
(1)  384/  FF1CCE :                     ; 	; Reset all
(1)  385/  FF1CCE :                     ; ; 		btst	#bitJoyC,d7
(1)  386/  FF1CCE :                     ; ; 		beq.s	.no_c
(1)  387/  FF1CCE :                     ; ; 		;move.w	#1,(RAM_MdMdlsUpd).l
(1)  388/  FF1CCE :                     ; ; 		lea	(RAM_MdCamera),a0
(1)  389/  FF1CCE :                     ; ; 		moveq	#0,d0
(1)  390/  FF1CCE :                     ; ; 		move.l	d0,(RAM_Cam_Xpos).l
(1)  391/  FF1CCE :                     ; ; 		move.l	d0,(RAM_Cam_Ypos).l
(1)  392/  FF1CCE :                     ; ; 		move.l	d0,(RAM_Cam_Zpos).l
(1)  393/  FF1CCE :                     ; ; 		move.l	d0,(RAM_Cam_Xrot).l
(1)  394/  FF1CCE :                     ; ; 		move.l	d0,(RAM_Cam_Yrot).l
(1)  395/  FF1CCE :                     ; ; 		move.l	d0,(RAM_Cam_Zrot).l
(1)  396/  FF1CCE :                     ; ; .no_c:
(1)  397/  FF1CCE :                     ;
(1)  398/  FF1CCE :                     ;
(1)  399/  FF1CCE :                     ; 	; Up/Down
(1)  400/  FF1CCE :                     ; 		move.w	(Controller_1+on_hold),d7
(1)  401/  FF1CCE :                     ; 		move.w	d7,d4
(1)  402/  FF1CCE :                     ; 		and.w	#JoyZ,d4
(1)  403/  FF1CCE :                     ; 		beq.s	.no_x
(1)  404/  FF1CCE :                     ; 		;move.w	#1,(RAM_MdMdlsUpd).l
(1)  405/  FF1CCE :                     ; ; 		lea	(RAM_MdCamera),a0
(1)  406/  FF1CCE :                     ; 		move.l	(RAM_Cam_Ypos).l,d0
(1)  407/  FF1CCE :                     ; 		add.l	d5,d0
(1)  408/  FF1CCE :                     ; 		move.l	d0,(RAM_Cam_Ypos).l
(1)  409/  FF1CCE :                     ; .no_x:
(1)  410/  FF1CCE :                     ; 		move.w	d7,d4
(1)  411/  FF1CCE :                     ; 		and.w	#JoyY,d4
(1)  412/  FF1CCE :                     ; 		beq.s	.no_y
(1)  413/  FF1CCE :                     ; 		;move.w	#1,(RAM_MdMdlsUpd).l
(1)  414/  FF1CCE :                     ; ; 		lea	(RAM_MdCamera),a0
(1)  415/  FF1CCE :                     ; 		move.l	(RAM_Cam_Ypos).l,d0
(1)  416/  FF1CCE :                     ; 		add.l	d6,d0
(1)  417/  FF1CCE :                     ; 		move.l	d0,(RAM_Cam_Ypos).l
(1)  418/  FF1CCE :                     ; .no_y:
(1)  419/  FF1CCE :                     ;
(1)  420/  FF1CCE :                     ; 		moveq	#0,d1
(1)  421/  FF1CCE :                     ; 		move.l	(RAM_Cam_Xpos),d2
(1)  422/  FF1CCE :                     ; 		move.l	(RAM_Cam_Ypos),d3
(1)  423/  FF1CCE :                     ; 		move.l	(RAM_Cam_Zpos),d4
(1)  424/  FF1CCE :                     ; 		move.l	(RAM_Cam_Xrot),d5
(1)  425/  FF1CCE :                     ; 		move.l	(RAM_Cam_Yrot),d6
(1)  426/  FF1CCE :                     ; 		move.l	(RAM_Cam_Zrot),d7
(1)  427/  FF1CCE :                     ; 		move.l	#CmdTaskMd_CameraPos,d0		; Load map
(1)  428/  FF1CCE :                     ; 		bsr	System_MdMars_SlvAddTask
(1)  429/  FF1CCE :                     ; 		move.l	#CmdTaskMd_UpdModels,d0
(1)  430/  FF1CCE :                     ; 		bsr	System_MdMars_SlvAddTask
(1)  431/  FF1CCE :                     ; 		bsr	System_MdMars_SlvSendDrop
(1)  432/  FF1CCE :                     ; .nel2:
(1)  433/  FF1CCE :                     ; 		bne.s	.busy
(1)  434/  FF1CCE :                     ; 		move.l	(RAM_Cam_Xrot),d1
(1)  435/  FF1CCE :                     ; 		neg.l	d1
(1)  436/  FF1CCE :                     ; 		lsr.l	#8,d1
(1)  437/  FF1CCE :                     ; 		move.w	d1,(RAM_BgCamCurr).l
(1)  438/  FF1CCE :                     ; .busy:
(1)  439/  FF1CCE :                     ; 		rts
(1)  440/  FF1CCE :                     
(1)  441/  FF1CCE :                     ; 		lea	(RAM_MdCamera),a0
(1)  442/  FF1CCE :                     ; 		move.l	#CmdTaskMd_CameraPos,d0		; Cmnd $0D: Set camera positions
(1)  443/  FF1CCE :                     ; 		moveq	#0,d1
(1)  444/  FF1CCE :                     ; 		move.l	(RAM_Cam_Xpos).l,d2
(1)  445/  FF1CCE :                     ; 		move.l	(RAM_Cam_Ypos).l,d3
(1)  446/  FF1CCE :                     ; 		move.l	(RAM_Cam_Zpos).l,d4
(1)  447/  FF1CCE :                     ; 		move.l	(RAM_Cam_Xrot).l,d5
(1)  448/  FF1CCE :                     ; 		move.l	(RAM_Cam_Yrot).l,d6
(1)  449/  FF1CCE :                     ; 		move.l	(RAM_Cam_Zrot).l,d7
(1)  450/  FF1CCE :                     ; 		bsr	System_MdMars_SlvAddTask
(1)  451/  FF1CCE :                     
(1)  452/  FF1CCE :                     ; 	; temporal camera
(1)  453/  FF1CCE :                     ; 		moveq	#0,d6
(1)  454/  FF1CCE :                     ; 		move.w	(Controller_1+on_hold).l,d7
(1)  455/  FF1CCE :                     ; 		btst	#bitJoyUp,d7
(1)  456/  FF1CCE :                     ; 		beq.s	.nou
(1)  457/  FF1CCE :                     ; 		add.l	#var_MoveSpd,(RAM_Cam_Zpos).l
(1)  458/  FF1CCE :                     ; 		moveq	#1,d6
(1)  459/  FF1CCE :                     ; .nou:
(1)  460/  FF1CCE :                     ; 		btst	#bitJoyDown,d7
(1)  461/  FF1CCE :                     ; 		beq.s	.nod
(1)  462/  FF1CCE :                     ; 		add.l	#-var_MoveSpd,(RAM_Cam_Zpos).l
(1)  463/  FF1CCE :                     ; 		moveq	#1,d6
(1)  464/  FF1CCE :                     ; .nod:
(1)  465/  FF1CCE :                     ; 		btst	#bitJoyLeft,d7
(1)  466/  FF1CCE :                     ; 		beq.s	.nol
(1)  467/  FF1CCE :                     ; 		add.l	#-var_MoveSpd,(RAM_Cam_Xpos).l
(1)  468/  FF1CCE :                     ; 		moveq	#1,d6
(1)  469/  FF1CCE :                     ; .nol:
(1)  470/  FF1CCE :                     ; 		btst	#bitJoyRight,d7
(1)  471/  FF1CCE :                     ; 		beq.s	.nor
(1)  472/  FF1CCE :                     ; 		add.l	#var_MoveSpd,(RAM_Cam_Xpos).l
(1)  473/  FF1CCE :                     ; 		moveq	#1,d6
(1)  474/  FF1CCE :                     ; .nor:
(1)  475/  FF1CCE :                     ; 		btst	#bitJoyA,d7
(1)  476/  FF1CCE :                     ; 		beq.s	.noa
(1)  477/  FF1CCE :                     ; 		add.l	#-var_MoveSpd,(RAM_Cam_Xrot).l
(1)  478/  FF1CCE :                     ; 		moveq	#1,d6
(1)  479/  FF1CCE :                     ; .noa:
(1)  480/  FF1CCE :                     ; 		btst	#bitJoyB,d7
(1)  481/  FF1CCE :                     ; 		beq.s	.nob
(1)  482/  FF1CCE :                     ; 		add.l	#var_MoveSpd,(RAM_Cam_Xrot).l
(1)  483/  FF1CCE :                     ; 		moveq	#1,d6
(1)  484/  FF1CCE :                     ; .nob:
(1)  485/  FF1CCE :                     ; ; 		tst.w	d6
(1)  486/  FF1CCE :                     ; ; 		beq.s	.nel
(1)  487/  FF1CCE :                     ; .first_draw:
(1)  488/  FF1CCE :                     
(1)  489/  FF1CCE :                     ; ====================================================================
(1)  490/  FF1CCE :                     ; ------------------------------------------------------
(1)  491/  FF1CCE :                     ; VBlank
(1)  492/  FF1CCE :                     ; ------------------------------------------------------
(1)  493/  FF1CCE :                     
(1)  494/  FF1CCE :                     ; ------------------------------------------------------
(1)  495/  FF1CCE :                     ; HBlank
(1)  496/  FF1CCE :                     ; ------------------------------------------------------
(1)  497/  FF1CCE :                     
(1)  498/  FF1CCE :                     ; ====================================================================
(1)  499/  FF1CCE :                     ; ------------------------------------------------------
(1)  500/  FF1CCE :                     ; DATA
(1)  501/  FF1CCE :                     ;
(1)  502/  FF1CCE :                     ; Small stuff goes here
(1)  503/  FF1CCE :                     ; ------------------------------------------------------
(1)  504/  FF1CCE :                     
(1)  505/  FF1CCE :                     str_Status:
(1)  506/  FF1CCE : 5C77 205C 7720 5C77 		dc.b "\\w \\w \\w \\w",$A
                    205C 770A           
(1)  507/  FF1CDA : 5C77 205C 7720 5C77 		dc.b "\\w \\w \\w \\w",0
                    205C 7700           
(1)  508/  FF1CE6 : 00A1 5120           		dc.l sysmars_reg+comm0
(1)  509/  FF1CEA : 00A1 5122           		dc.l sysmars_reg+comm2
(1)  510/  FF1CEE : 00A1 5124           		dc.l sysmars_reg+comm4
(1)  511/  FF1CF2 : 00A1 5126           		dc.l sysmars_reg+comm6
(1)  512/  FF1CF6 : 00A1 5128           		dc.l sysmars_reg+comm8
(1)  513/  FF1CFA : 00A1 512A           		dc.l sysmars_reg+comm10
(1)  514/  FF1CFE : 00A1 512C           		dc.l sysmars_reg+comm12
(1)  515/  FF1D02 : 00A1 512E           		dc.l sysmars_reg+comm14
(1)  516/  FF1D06 :                     
(1)  517/  FF1D06 :                     		align 2
(1)  518/  FF1D06 :                     MdPal_BgTestB:
(1)  519/  FF1D06 :                     		binclude "data/md/bg/bg_b_pal.bin"
(1)  520/  FF1D24 :                     		binclude "data/md/bg/bg_t_pal.bin"
(1)  521/  FF1D44 :                     		align 2
(1)  522/  FF1D44 :                     
(1)  523/  FF1D44 :                     ; ====================================================================
(1)  524/  FF1D44 :                     
(1)  529/  FF1D44 :                     
      65/    43FA :                     		dephase
      66/    43FA :                     
      67/    43FA :                     ; ====================================================================
      68/    43FA :                     ; ----------------------------------------------------------------
      69/    43FA :                     ; 68k DATA BANKs (at $900000) 1MB max
      70/    43FA :                     ; ----------------------------------------------------------------
      71/    43FA :                     
      72/    43FA :                     	; First one is smaller than the rest...
      73/  9043FA :                     		phase $900000+*				; Only one currently
      74/  9043FA :                     		include "data/md_bank0.asm"
(1)    1/  9043FA :                     ; ====================================================================
(1)    2/  9043FA :                     ; ----------------------------------------------------------------
(1)    3/  9043FA :                     ; Single 68k DATA BANK for MD ($900000-$9FFFFF)
(1)    4/  9043FA :                     ; for stuff other than MD's DMA data
(1)    5/  9043FA :                     ; 
(1)    6/  9043FA :                     ; Maximum size: $0FFFFF bytes per bank
(1)    7/  9043FA :                     ; ----------------------------------------------------------------
(1)    8/  9043FA :                     
(1)    9/  9043FA :                     		align $8000
(1)   10/  908000 :                     		include "data/sound/tracks.asm"
(2)    1/  908000 :                     ; ================================================================
(2)    2/  908000 :                     ; ------------------------------------------------------------
(2)    3/  908000 :                     ; DATA SECTION
(2)    4/  908000 :                     ; 
(2)    5/  908000 :                     ; SOUND
(2)    6/  908000 :                     ; ------------------------------------------------------------
(2)    7/  908000 :                     
(2)    8/  908000 :                     gemaInsPsg	macro pitch,psgins
(2)    9/  908000 :                     		dc.b 0,pitch
(2)   10/  908000 :                     		dc.b psgins&$FF,((psgins>>8)&$FF)
(2)   11/  908000 :                     		dc.b 0,0
(2)   12/  908000 :                     		dc.b 0,0
(2)   13/  908000 :                     		endm
(2)   14/  908000 :                     
(2)   15/  908000 :                     gemaInsPsgN	macro pitch,psgins,type
(2)   16/  908000 :                     		dc.b 1,pitch
(2)   17/  908000 :                     		dc.b psgins&$FF,((psgins>>8)&$FF)
(2)   18/  908000 :                     		dc.b type,0
(2)   19/  908000 :                     		dc.b 0,0
(2)   20/  908000 :                     		endm
(2)   21/  908000 :                     
(2)   22/  908000 :                     gemaInsFm	macro pitch,fmins
(2)   23/  908000 :                     		dc.b 2,pitch
(2)   24/  908000 :                     		dc.b fmins&$FF,((fmins>>8)&$FF)
(2)   25/  908000 :                     		dc.b 0,0
(2)   26/  908000 :                     		dc.b 0,0
(2)   27/  908000 :                     		endm
(2)   28/  908000 :                     
(2)   29/  908000 :                     gemaInsFm3	macro pitch,fmins,freq1,freq2,freq3
(2)   30/  908000 :                     		dc.b 3,pitch
(2)   31/  908000 :                     		dc.b fmins&$FF,((fmins>>8)&$FF)
(2)   32/  908000 :                     		dc.b 0,0
(2)   33/  908000 :                     		dc.b 0,0		
(2)   34/  908000 :                     		endm
(2)   35/  908000 :                     		
(2)   36/  908000 :                     gemaInsDac	macro pitch,dacins,flags
(2)   37/  908000 :                     		dc.b 4,pitch
(2)   38/  908000 :                     		dc.b dacins&$FF,((dacins>>8)&$FF)
(2)   39/  908000 :                     		dc.b flags,0		; flags: 0-dont loop, 1-loop
(2)   40/  908000 :                     		dc.b 0,0
(2)   41/  908000 :                     		endm
(2)   42/  908000 :                     
(2)   43/  908000 :                     ; Pointers go to instr_sdram.asm
(2)   44/  908000 :                     ; 
(2)   45/  908000 :                     ; gemaInsPwm	macro pitch,pointer
(2)   46/  908000 :                     ; 		dc.b 5,pitch
(2)   47/  908000 :                     ; 		dc.b 0,0		; filler
(2)   48/  908000 :                     ; 		dc.b ((pointer>>24)&$FF),((pointer>>16)&$FF)
(2)   49/  908000 :                     ; 		dc.b ((pointer>>8)&$FF),pointer&$FF
(2)   50/  908000 :                     ; 		endm
(2)   51/  908000 :                     
(2)   52/  908000 :                     gemaInsNull	macro
(2)   53/  908000 :                     		dc.b -1,0
(2)   54/  908000 :                     		dc.b  0,0
(2)   55/  908000 :                     		dc.b  0,0
(2)   56/  908000 :                     		dc.b  0,0
(2)   57/  908000 :                     		endm
(2)   58/  908000 :                     
(2)   59/  908000 :                     ; ------------------------------------------------------------
(2)   60/  908000 :                     
(2)   61/  908000 :                     ; TEST_BLOCKS	binclude "data/sound/tracks/temple_blk.bin"
(2)   62/  908000 :                     ; TEST_PATTERN	binclude "data/sound/tracks/temple_patt.bin"
(2)   63/  908000 :                     ; TEST_INSTR
(2)   64/  908000 :                     ; 		gemaInsPsg  0,PsgIns_01
(2)   65/  908000 :                     ; 		gemaInsPsg  0,PsgIns_01
(2)   66/  908000 :                     ; 		gemaInsPsgN 0,PsgIns_Snare,%101
(2)   67/  908000 :                     ; 
(2)   68/  908000 :                     ; TEST_BLOCKS_2	binclude "data/sound/tracks/kraid_blk.bin"
(2)   69/  908000 :                     ; TEST_PATTERN_2	binclude "data/sound/tracks/kraid_patt.bin"
(2)   70/  908000 :                     ; TEST_INSTR_2
(2)   71/  908000 :                     ; 		gemaInsPsgN 0,PsgIns_Bass,%011
(2)   72/  908000 :                     ; 		gemaInsPsg  0,PsgIns_03
(2)   73/  908000 :                     
(2)   74/  908000 :                     ; GemaTrk_Yuki_blk:
(2)   75/  908000 :                     ; 		binclude "data/sound/tracks/marscomm_blk.bin"
(2)   76/  908000 :                     ; GemaTrk_Yuki_patt:
(2)   77/  908000 :                     ; 		binclude "data/sound/tracks/marscomm_patt.bin"
(2)   78/  908000 :                     ; GemaTrk_Yuki_ins:
(2)   79/  908000 :                     ; 		gemaInsPwm -17,PwmIns_TECHNOBASSD
(2)   80/  908000 :                     ; 		gemaInsFm    0,FmIns_Bass_metal
(2)   81/  908000 :                     ; 		gemaInsPwm -17,PwmIns_WHODSNARE
(2)   82/  908000 :                     ; 		gemaInsPsgN  0,PsgIns_00,%100
(2)   83/  908000 :                     ; 		gemaInsFm    0,FmIns_Bass_2
(2)   84/  908000 :                     ; 		gemaInsPwm -17,PwmIns_TECHNOBASSD
(2)   85/  908000 :                     ; 		gemaInsPwm -17,PwmIns_SPHEAVY1
(2)   86/  908000 :                     ; 		gemaInsPwm -17,PwmIns_MCLSTRNG
(2)   87/  908000 :                     
(2)   88/  908000 :                     GemaTrk_Demo_blk:
(2)   89/  908000 :                     		binclude "data/sound/tracks/demo_blk.bin"
(2)   90/  908005 :                     GemaTrk_Demo_patt:
(2)   91/  908005 :                     		binclude "data/sound/tracks/demo_patt.bin"
(2)   92/  908271 :                     GemaTrk_Demo_ins:
(2)   93/  908271 : (MACRO)             		gemaInsDac  0,DacIns_MyTime,0
(2)   93/  908271 : 0400                                dc.b 4,0
(2)   93/  908273 : 7C12                                dc.b DACINS_MYTIME&$FF,((DACINS_MYTIME>>8)&$FF)
(2)   93/  908275 : 0000                                dc.b 0,0            ; 0: 0-dont loop, 1-loop
(2)   93/  908277 : 0000                                dc.b 0,0
(2)   94/  908279 : (MACRO)             		gemaInsDac  0,DacIns_Magic1,0
(2)   94/  908279 : 0400                                dc.b 4,0
(2)   94/  90827B : 6812                                dc.b DACINS_MAGIC1&$FF,((DACINS_MAGIC1>>8)&$FF)
(2)   94/  90827D : 0000                                dc.b 0,0            ; 0: 0-dont loop, 1-loop
(2)   94/  90827F : 0000                                dc.b 0,0
(2)   95/  908281 : (MACRO)             		gemaInsDac  0,DacIns_Magic2,0
(2)   95/  908281 : 0400                                dc.b 4,0
(2)   95/  908283 : 7212                                dc.b DACINS_MAGIC2&$FF,((DACINS_MAGIC2>>8)&$FF)
(2)   95/  908285 : 0000                                dc.b 0,0            ; 0: 0-dont loop, 1-loop
(2)   95/  908287 : 0000                                dc.b 0,0
(2)   96/  908289 : (MACRO)             		gemaInsNull;Fm   0,FmIns_Ambient_dark
(2)   96/  908289 : FF00                                dc.b -1,0
(2)   96/  90828B : 0000                                dc.b  0,0
(2)   96/  90828D : 0000                                dc.b  0,0
(2)   96/  90828F : 0000                                dc.b  0,0
(2)   97/  908291 : (MACRO)             		gemaInsFm   0,FmIns_Bass_Calm
(2)   97/  908291 : 0200                                dc.b 2,0
(2)   97/  908293 : 3C13                                dc.b FMINS_BASS_CALM&$FF,((FMINS_BASS_CALM>>8)&$FF)
(2)   97/  908295 : 0000                                dc.b 0,0
(2)   97/  908297 : 0000                                dc.b 0,0
(2)   98/  908299 : (MACRO)             		gemaInsNull
(2)   98/  908299 : FF00                                dc.b -1,0
(2)   98/  90829B : 0000                                dc.b  0,0
(2)   98/  90829D : 0000                                dc.b  0,0
(2)   98/  90829F : 0000                                dc.b  0,0
(2)   99/  9082A1 :                     
(1)   11/  9082A1 :                     		align 4
(1)   12/  9082A4 :                     ; CAMERA_INTRO:	binclude "data/mars/objects/anim/intro_anim.bin"
(1)   13/  9082A4 :                     ; 		align 4
(1)   14/  9082A4 :                     ; CAMERA_INTNAME:	binclude "data/mars/objects/anim/projcam_anim.bin"
(1)   15/  9082A4 :                     ; 		align 4
(1)   16/  9082A4 :                     ; CAMERA_CITY:	binclude "data/mars/maps/anim/camera_anim.bin"
(1)   17/  9082A4 :                     ; 		align 4
(1)   18/  9082A4 :                     
(1)   19/  9082A4 :                     ; MdMap_Bg:
(1)   20/  9082A4 :                     ; 		binclude "data/md/bg/bg_map.bin"
(1)   21/  9082A4 :                     ; 		align 2
(1)   22/  9082A4 :                     MdMap_BgTestB:
(1)   23/  9082A4 :                     		binclude "data/md/bg/bg_b_map.bin"
(1)   24/  9092A4 :                     		align 2
(1)   25/  9092A4 :                     MdMap_BgTestT:
(1)   26/  9092A4 :                     		binclude "data/md/bg/bg_t_map.bin"
(1)   27/  90A2A4 :                     		align 2
(1)   28/  90A2A4 :                     
(1)   29/  90A2A4 :                     
(1)   30/  90A2A4 :                     Sampl_Magic1:	binclude "data/sound/instr/smpl/magic_1.wav",$2C
(1)   31/  923132 :                     Sampl_Magic1_End:
(1)   32/  923132 :                     Sampl_Magic2:	binclude "data/sound/instr/smpl/magic_2.wav",$2C
(1)   33/  93BF66 :                     Sampl_Magic2_End:
(1)   34/  93BF66 :                     Sampl_MyTime:	binclude "data/sound/instr/smpl/mytime.wav",$2C
(1)   35/  946F3B :                     Sampl_MyTime_End:
(1)   36/  946F3B :                     
(1)   37/  946F3B :                     ; PWM_START:	binclude "data/sound/pwm_m.wav",$2C,$05FFFF
(1)   38/  946F3B :                     ; PWM_END:
(1)   39/  946F3B :                     
      75/   46F3B :                     		dephase
      76/   46F3B :                     ; 		org $100000-4				; Fill this bank and
      77/   46F3B :                     ; 		dc.b "BNK0"				; add a tag at the end
      78/   46F3B :                     
      79/   46F3B :                     ; 		phase $900000+*
      80/   46F3B :                     ; 		include "data/md_bank1.asm"
      81/   46F3B :                     ; 		dephase
      82/   46F3B :                     ; 		org $200000-4
      83/   46F3B :                     ; 		dc.b "BNK1"
      84/   46F3B :                     
      85/   46F3B :                     ; 		phase $900000+*
      86/   46F3B :                     ; 		include "data/md_bank2.asm"
      87/   46F3B :                     ; 		dephase
      88/   46F3B :                     ; 		org $300000-4
      89/   46F3B :                     ; 		dc.b "BNK2"
      90/   46F3B :                     
      91/   46F3B :                     ; 		phase $900000+*
      92/   46F3B :                     ; 		include "data/md_bank3.asm"
      93/   46F3B :                     ; 		dephase
      94/   46F3B :                     ; 		org $400000-4
      95/   46F3B :                     ; 		dc.b "BNK3"
      96/   46F3B :                     
      97/   46F3B :                     ; ====================================================================
      98/   46F3B :                     ; ----------------------------------------------------------------
      99/   46F3B :                     ; DMA transfer data, RV=1 only.
     100/   46F3B :                     ; ----------------------------------------------------------------
     101/   46F3B :                     
     102/   46F3B :                     		align 4
     103/   46F3C :                     		include "data/md_dma.asm"
(1)    1/   46F3C :                     ; ====================================================================
(1)    2/   46F3C :                     ; ----------------------------------------------------------------
(1)    3/   46F3C :                     ; DMA ROM DATA Transfer section, no bank limitations
(1)    4/   46F3C :                     ; 
(1)    5/   46F3C :                     ; RV bit must be set to access here
(1)    6/   46F3C :                     ; ----------------------------------------------------------------
(1)    7/   46F3C :                     
(1)    8/   46F3C :                     		align $8000
(1)    9/   48000 :                     MdGfx_BgTestT:
(1)   10/   48000 :                     		binclude "data/md/bg/bg_t_art.bin"
(1)   11/   4A980 :                     MdGfx_BgTestT_e:
(1)   12/   4A980 :                     		align 2
(1)   13/   4A980 :                     
(1)   14/   4A980 :                     MdGfx_BgTestB:
(1)   15/   4A980 :                     		binclude "data/md/bg/bg_b_art.bin"
(1)   16/   4CF20 :                     MdGfx_BgTestB_e:
(1)   17/   4CF20 :                     		align 2
(1)   18/   4CF20 :                     
(1)   19/   4CF20 :                     
     104/   4CF20 :                     
     105/   4CF20 :                     ; ====================================================================
     106/   4CF20 :                     ; ----------------------------------------------------------------
     107/   4CF20 :                     ; SH2 SECTION
     108/   4CF20 :                     ; ----------------------------------------------------------------
     109/   4CF20 :                     
     110/   4CF20 :                     		align 4
     111/   4CF20 :                     MARS_RAMDATA:
     112/   4CF20 :                     		include "system/mars/code.asm"
(1)    1/   4CF20 :                     ; ====================================================================		
(1)    2/   4CF20 :                     ; ----------------------------------------------------------------
(1)    3/   4CF20 :                     ; MARS SH2 Section
(1)    4/   4CF20 :                     ;
(1)    5/   4CF20 :                     ; CODE for both CPUs
(1)    6/   4CF20 :                     ; RAM and some DATA go here
(1)    7/   4CF20 :                     ; ----------------------------------------------------------------
(1)    8/   4CF20 :                     
(1)    9/ 6000000 :                     		phase CS3		; now we are at SDRAM
(1)   10/ 6000000 :                     		cpu SH7600		; should be SH7095 but this works.
(1)   11/ 6000000 :                     
(1)   12/ 6000000 :                     ; ====================================================================
(1)   13/ 6000000 :                     ; ----------------------------------------------------------------
(1)   14/ 6000000 :                     ; User settings
(1)   15/ 6000000 :                     ; ----------------------------------------------------------------
(1)   16/ 6000000 :                     
(1)   17/ 6000000 :                     ; Third scrolling layer settings, Screen mode 1 only.
(1)   18/ 6000000 :                     ;
(1)   19/ 6000000 :                     ; The scrolling system only draws the new sections when the camera
(1)   20/ 6000000 :                     ; when it moves to new locations
(1)   21/ 6000000 :                     ; Do note that drawing the new sections takes TWO frames, because
(1)   22/ 6000000 :                     ; of how the framebuffer shows pixels on screen.
(1)   23/ 6000000 :                     ; (one buffer for drawing, one for display)
(1)   24/ 6000000 :                     ; The maximum moving speed is divided by 2 depending of
(1)   25/ 6000000 :                     ; the BLKSIZE setting. (BLKSIZE/2)
(1)   26/ 6000000 :                     ;
(1)   27/ 6000000 :                     ; Map data can be either ROM data or a RAM section,
(1)   28/ 6000000 :                     ; Background's WIDTH and HEIGHT are defined by gbr variables (BgWidth and BgHeight)
(1)   29/ 6000000 :                     ; but the sizes must be aligned by the same value as BLKSIZE
(1)   30/ 6000000 :                     ;
(1)   31/ 6000000 :                     ; SVDP FILL breaks because this scroll system manipulates the linetable.
(1)   32/ 6000000 :                     ; (unless I come up with a workaround)
(1)   33/ 6000000 :                     
(1)   34/ 6000000 : =$10                MSCRL_BLKSIZE		equ $10		; Block size for both directions, maximum speed is (blksize/2)
(1)   35/ 6000000 : =$150               MSCRL_WIDTH		equ 320+$10	; Internal width for scrolldata
(1)   36/ 6000000 : =$100               MSCRL_HEIGHT		equ 240+$10	; Internal height for scrolldata
(1)   37/ 6000000 :                     
(1)   38/ 6000000 :                     ; ----------------------------------------
(1)   39/ 6000000 :                     ; Polygon settings
(1)   40/ 6000000 :                     ; (can manipulate 3 or 4 points)
(1)   41/ 6000000 :                     ; ----------------------------------------
(1)   42/ 6000000 :                     
(1)   43/ 6000000 : =$80                MAX_MPLGN	equ	128		; Maximum polygon faces to store on buffer(s)
(1)   44/ 6000000 : =$C0                MAX_SVDP_PZ	equ	128+64		; Polygon pieces r/w list, loops
(1)   45/ 6000000 :                     ; MAX_MODELS	equ	24		; Note: First 9 models are reserved for layout map
(1)   46/ 6000000 :                     ; MAX_ZDIST	equ	-$2400		; Max drawing distance (-Z max)
(1)   47/ 6000000 :                     ; LAY_WIDTH	equ	$20*2		; Layout data width * 2
(1)   48/ 6000000 :                     
(1)   49/ 6000000 :                     ; ----------------------------------------
(1)   50/ 6000000 :                     ; Normal sprite settings
(1)   51/ 6000000 :                     ; ----------------------------------------
(1)   52/ 6000000 :                     
(1)   53/ 6000000 : =$80                MAX_MSPR	equ	128		; Maximum sprites
(1)   54/ 6000000 :                     
(1)   55/ 6000000 :                     ; ====================================================================
(1)   56/ 6000000 :                     ; ----------------------------------------------------------------
(1)   57/ 6000000 :                     ; MARS GBR variables for both SH2
(1)   58/ 6000000 :                     ; ----------------------------------------------------------------
(1)   59/ 6000000 :                     
(1)   60/ 6000000 : (MACRO)             			struct 0
(1)   60/ 6000000 : =$6000000           GLBL_LASTPC     set *
(1)   60/   4CF20 :                                     dephase
(1)   60/   4CF20 : =$4CF20             GLBL_LASTORG    set *
(1)   60/       0 :                                     phase 0
(1)   61/       0 :                     marsGbl_BgData		ds.l 1		; Background pixel data location (ROM or RAM)
(1)   62/       4 :                     marsGbl_BgData_R	ds.l 1		; Background data pointer (only updates vertically)
(1)   63/       8 :                     marsGbl_PlyPzList_R	ds.l 1		; Current graphic piece to draw
(1)   64/       C :                     marsGbl_PlyPzList_W	ds.l 1		; Current graphic piece to write
(1)   65/      10 :                     marsGbl_CurrZList	ds.l 1		; Current Zsort entry
(1)   66/      14 :                     marsGbl_CurrFacePos	ds.l 1		; Current top face of the list while reading model data
(1)   67/      18 :                     marsGbl_Bg_Xpos		ds.l 1
(1)   68/      1C :                     marsGbl_Bg_Ypos		ds.l 1
(1)   69/      20 :                     marsGbl_Bg_Xpos_old	ds.l 1
(1)   70/      24 :                     marsGbl_Bg_Ypos_old	ds.l 1
(1)   71/      28 :                     marsGbl_Plgn_Read	ds.l 1
(1)   72/      2C :                     marsGbl_Plgn_Write	ds.l 1
(1)   73/      30 :                     marsGbl_Bg_FbBase	ds.l 1		; X base position for Up/Down draw
(1)   74/      34 :                     marsGbl_Bg_Xshift	ds.w 1
(1)   75/      36 :                     marsGbl_GraphMode	ds.w 1
(1)   76/      38 :                     marsGbl_BgWidth		ds.w 1
(1)   77/      3A :                     marsGbl_BgHeight	ds.w 1
(1)   78/      3C :                     marsGbl_Bg_Xset		ds.w 1		; Redraw timers
(1)   79/      3E :                     marsGbl_Bg_Yset		ds.w 1		;
(1)   80/      40 :                     marsGbl_Bg_YFbPos_U	ds.w 1		; Y position for Up/Down drawing section
(1)   81/      42 :                     marsGbl_Bg_YFbPos_D	ds.w 1
(1)   82/      44 :                     marsGbl_Bg_YFbPos_LR	ds.w 1		; Y position only for L/R draw
(1)   83/      46 :                     marsGbl_Bg_XbgInc_L	ds.w 1		; Address X increment
(1)   84/      48 :                     marsGbl_Bg_XbgInc_R	ds.w 1		;
(1)   85/      4A :                     marsGbl_Bg_YbgInc_D	ds.w 1		; Address Y increment (Multiply with BGWIDTH externally)
(1)   86/      4C :                     marsGbl_Bg_YbgInc_U	ds.w 1		;
(1)   87/      4E :                     marsGbl_Bg_YbgInc_LR	ds.w 1		; Y bg position for L/R draw
(1)   88/      50 :                     marsGbl_Bg_DrwReqU	ds.w 1		; Draw UP request, write 2
(1)   89/      52 :                     marsGbl_Bg_DrwReqD	ds.w 1		; Draw DOWN request, write 2
(1)   90/      54 :                     marsGbl_Bg_DrwReqL	ds.w 1		; Draw LEFT request, write 2
(1)   91/      56 :                     marsGbl_Bg_DrwReqR	ds.w 1		; Draw RIGHT request, write 2
(1)   92/      58 :                     marsGbl_Bg_DrwReqFull	ds.w 1		; FULL Draw, write 2
(1)   93/      5A :                     marsGbl_MdlFacesCntr	ds.w 1		; And the number of faces stored on that list
(1)   94/      5C :                     marsGbl_PlgnBuffNum	ds.w 1		; PolygonBuffer switch: READ/WRITE or WRITE/READ
(1)   95/      5E :                     marsGbl_MstrReqDraw	ds.w 1
(1)   96/      60 :                     marsGbl_CurrGfxMode	ds.w 1
(1)   97/      62 :                     marsGbl_PzListCntr	ds.w 1		; Number of graphic pieces to draw
(1)   98/      64 :                     marsGbl_DrwTask		ds.w 1		; Current Drawing task for Watchdog
(1)   99/      66 :                     marsGbl_DrwPause	ds.w 1		; Pause background drawing
(1)  100/      68 :                     marsGbl_VIntFlag_M	ds.w 1		; Sets to 0 if VBlank finished on Master CPU
(1)  101/      6A :                     marsGbl_VIntFlag_S	ds.w 1		; Same thing but for the Slave CPU
(1)  102/      6C :                     marsGbl_DivStop_M	ds.w 1		; Flag to tell Watchdog we are in the middle of hardware division
(1)  103/      6E :                     marsGbl_CurrFb		ds.w 1		; Current framebuffer number
(1)  104/      70 :                     marsGbl_ZSortReq	ds.w 1		; Flag to request Zsort in Slave's watchdog
(1)  105/      72 :                     marsGbl_PwmTrkUpd	ds.w 1		; Flag to update PWM tracks (from Z80 then PWM IRQ)
(1)  106/      74 :                     marsGbl_PalDmaMidWr	ds.w 1		; Flag to tell we are in middle of transfering palette
(1)  107/      76 :                     sizeof_MarsGbl		ds.l 0
(1)  108/      78 : (MACRO)             			finish
(1)  108/       0 :                                     !org GLBL_LASTORG
(1)  108/ 6000000 :                                     phase GLBL_LASTPC
(1)  109/ 6000000 :                     
(1)  110/ 6000000 :                     ; ====================================================================
(1)  111/ 6000000 :                     ; ----------------------------------------------------------------
(1)  112/ 6000000 :                     ; MASTER CPU HEADER (vbr)
(1)  113/ 6000000 :                     ; ----------------------------------------------------------------
(1)  114/ 6000000 :                     
(1)  115/ 6000000 :                     		align 4
(1)  116/ 6000000 :                     SH2_Master:
(1)  117/ 6000000 : 0600 0C84 0604 0000 		dc.l SH2_M_Entry,CS3|$40000	; Cold PC,SP
(1)  118/ 6000008 : 0600 0C84 0604 0000 		dc.l SH2_M_Entry,CS3|$40000	; Manual PC,SP
(1)  119/ 6000010 :                     
(1)  120/ 6000010 : 0600 030C           		dc.l SH2_Error			; Illegal instruction
(1)  121/ 6000014 : 0000 0000           		dc.l 0				; reserved
(1)  122/ 6000018 : 0600 030C           		dc.l SH2_Error			; Invalid slot instruction
(1)  123/ 600001C : 2010 0400           		dc.l $20100400			; reserved
(1)  124/ 6000020 : 2010 0420           		dc.l $20100420			; reserved
(1)  125/ 6000024 : 0600 030C           		dc.l SH2_Error			; CPU address error
(1)  126/ 6000028 : 0600 030C           		dc.l SH2_Error			; DMA address error
(1)  127/ 600002C : 0600 030C           		dc.l SH2_Error			; NMI vector
(1)  128/ 6000030 : 0600 030C           		dc.l SH2_Error			; User break vector
(1)  129/ 6000034 :                     
(1)  130/ 6000034 : 0000 0000 0000 0000 		dc.l 0,0,0,0,0,0,0,0,0,0	; reserved
                    0000 0000 0000 0000 
                    0000 0000 0000 0000 
                    0000 0000 0000 0000 
                    0000 0000 0000 0000 
(1)  131/ 600005C : 0000 0000 0000 0000 		dc.l 0,0,0,0,0,0,0,0,0
                    0000 0000 0000 0000 
                    0000 0000 0000 0000 
                    0000 0000 0000 0000 
                    0000 0000           
(1)  132/ 6000080 :                     
(1)  133/ 6000080 : 0600 030C 0600 030C 		dc.l SH2_Error,SH2_Error	; Trap vectors
(1)  134/ 6000088 : 0600 030C 0600 030C 		dc.l SH2_Error,SH2_Error
(1)  135/ 6000090 : 0600 030C 0600 030C 		dc.l SH2_Error,SH2_Error
(1)  136/ 6000098 : 0600 030C 0600 030C 		dc.l SH2_Error,SH2_Error
(1)  137/ 60000A0 : 0600 030C 0600 030C 		dc.l SH2_Error,SH2_Error
(1)  138/ 60000A8 : 0600 030C 0600 030C 		dc.l SH2_Error,SH2_Error
(1)  139/ 60000B0 : 0600 030C 0600 030C 		dc.l SH2_Error,SH2_Error
(1)  140/ 60000B8 : 0600 030C 0600 030C 		dc.l SH2_Error,SH2_Error
(1)  141/ 60000C0 : 0600 030C 0600 030C 		dc.l SH2_Error,SH2_Error
(1)  142/ 60000C8 : 0600 030C 0600 030C 		dc.l SH2_Error,SH2_Error
(1)  143/ 60000D0 : 0600 030C 0600 030C 		dc.l SH2_Error,SH2_Error
(1)  144/ 60000D8 : 0600 030C 0600 030C 		dc.l SH2_Error,SH2_Error
(1)  145/ 60000E0 : 0600 030C 0600 030C 		dc.l SH2_Error,SH2_Error
(1)  146/ 60000E8 : 0600 030C 0600 030C 		dc.l SH2_Error,SH2_Error
(1)  147/ 60000F0 : 0600 030C 0600 030C 		dc.l SH2_Error,SH2_Error
(1)  148/ 60000F8 : 0600 030C 0600 030C 		dc.l SH2_Error,SH2_Error
(1)  149/ 6000100 :                     
(1)  150/ 6000100 : 0600 0248            		dc.l master_irq			; Level 1 IRQ
(1)  151/ 6000104 : 0600 0248           		dc.l master_irq			; Level 2 & 3 IRQ's
(1)  152/ 6000108 : 0600 0248           		dc.l master_irq			; Level 4 & 5 IRQ's
(1)  153/ 600010C : 0600 0248           		dc.l master_irq			; PWM interupt
(1)  154/ 6000110 : 0600 0248           		dc.l master_irq			; Command interupt
(1)  155/ 6000114 : 0600 0248           		dc.l master_irq			; H Blank interupt
(1)  156/ 6000118 : 0600 0248           		dc.l master_irq			; V Blank interupt
(1)  157/ 600011C : 0600 0248           		dc.l master_irq			; Reset Button
(1)  158/ 6000120 : 0600 0248           		dc.l master_irq			; Watchdog
(1)  159/ 6000124 :                     
(1)  160/ 6000124 :                     ; ====================================================================
(1)  161/ 6000124 :                     ; ----------------------------------------------------------------
(1)  162/ 6000124 :                     ; SLAVE CPU HEADER (vbr)
(1)  163/ 6000124 :                     ; ----------------------------------------------------------------
(1)  164/ 6000124 :                     
(1)  165/ 6000124 :                     		align 4
(1)  166/ 6000124 :                     SH2_Slave:
(1)  167/ 6000124 : 0600 131C 0603 F000 		dc.l SH2_S_Entry,CS3|$3F000	; Cold PC,SP
(1)  168/ 600012C : 0600 131C 0603 F000 		dc.l SH2_S_Entry,CS3|$3F000	; Manual PC,SP
(1)  169/ 6000134 :                     
(1)  170/ 6000134 : 0600 030C           		dc.l SH2_Error			; Illegal instruction
(1)  171/ 6000138 : 0000 0000           		dc.l 0				; reserved
(1)  172/ 600013C : 0600 030C           		dc.l SH2_Error			; Invalid slot instruction
(1)  173/ 6000140 : 2010 0400           		dc.l $20100400			; reserved
(1)  174/ 6000144 : 2010 0420           		dc.l $20100420			; reserved
(1)  175/ 6000148 : 0600 030C           		dc.l SH2_Error			; CPU address error
(1)  176/ 600014C : 0600 030C           		dc.l SH2_Error			; DMA address error
(1)  177/ 6000150 : 0600 030C           		dc.l SH2_Error			; NMI vector
(1)  178/ 6000154 : 0600 030C           		dc.l SH2_Error			; User break vector
(1)  179/ 6000158 :                     
(1)  180/ 6000158 : 0000 0000 0000 0000 		dc.l 0,0,0,0,0,0,0,0,0,0	; reserved
                    0000 0000 0000 0000 
                    0000 0000 0000 0000 
                    0000 0000 0000 0000 
                    0000 0000 0000 0000 
(1)  181/ 6000180 : 0000 0000 0000 0000 		dc.l 0,0,0,0,0,0,0,0,0
                    0000 0000 0000 0000 
                    0000 0000 0000 0000 
                    0000 0000 0000 0000 
                    0000 0000           
(1)  182/ 60001A4 :                     
(1)  183/ 60001A4 : 0600 030C 0600 030C 		dc.l SH2_Error,SH2_Error	; Trap vectors
(1)  184/ 60001AC : 0600 030C 0600 030C 		dc.l SH2_Error,SH2_Error
(1)  185/ 60001B4 : 0600 030C 0600 030C 		dc.l SH2_Error,SH2_Error
(1)  186/ 60001BC : 0600 030C 0600 030C 		dc.l SH2_Error,SH2_Error
(1)  187/ 60001C4 : 0600 030C 0600 030C 		dc.l SH2_Error,SH2_Error
(1)  188/ 60001CC : 0600 030C 0600 030C 		dc.l SH2_Error,SH2_Error
(1)  189/ 60001D4 : 0600 030C 0600 030C 		dc.l SH2_Error,SH2_Error
(1)  190/ 60001DC : 0600 030C 0600 030C 		dc.l SH2_Error,SH2_Error
(1)  191/ 60001E4 : 0600 030C 0600 030C 		dc.l SH2_Error,SH2_Error
(1)  192/ 60001EC : 0600 030C 0600 030C 		dc.l SH2_Error,SH2_Error
(1)  193/ 60001F4 : 0600 030C 0600 030C 		dc.l SH2_Error,SH2_Error
(1)  194/ 60001FC : 0600 030C 0600 030C 		dc.l SH2_Error,SH2_Error
(1)  195/ 6000204 : 0600 030C 0600 030C 		dc.l SH2_Error,SH2_Error
(1)  196/ 600020C : 0600 030C 0600 030C 		dc.l SH2_Error,SH2_Error
(1)  197/ 6000214 : 0600 030C 0600 030C 		dc.l SH2_Error,SH2_Error
(1)  198/ 600021C : 0600 030C 0600 030C 		dc.l SH2_Error,SH2_Error
(1)  199/ 6000224 :                     
(1)  200/ 6000224 : 0600 02AC            		dc.l slave_irq			; Level 1 IRQ
(1)  201/ 6000228 : 0600 02AC           		dc.l slave_irq			; Level 2 & 3 IRQ's
(1)  202/ 600022C : 0600 02AC           		dc.l slave_irq			; Level 4 & 5 IRQ's
(1)  203/ 6000230 : 0600 02AC           		dc.l slave_irq			; PWM interupt
(1)  204/ 6000234 : 0600 02AC           		dc.l slave_irq			; Command interupt
(1)  205/ 6000238 : 0600 02AC           		dc.l slave_irq			; H Blank interupt
(1)  206/ 600023C : 0600 02AC           		dc.l slave_irq			; V Blank interupt
(1)  207/ 6000240 : 0600 02AC           		dc.l slave_irq			; Reset Button
(1)  208/ 6000244 : 0600 02AC           		dc.l slave_irq			; Watchdog
(1)  209/ 6000248 :                     
(1)  210/ 6000248 :                     ; ====================================================================
(1)  211/ 6000248 :                     ; ----------------------------------------------------------------
(1)  212/ 6000248 :                     ; irq
(1)  213/ 6000248 :                     ;
(1)  214/ 6000248 :                     ; r0-r1 are safe
(1)  215/ 6000248 :                     ; ----------------------------------------------------------------
(1)  216/ 6000248 :                     
(1)  217/ 6000248 :                     		align 4
(1)  218/ 6000248 :                     master_irq:
(1)  219/ 6000248 : 2F06                		mov.l	r0,@-r15
(1)  220/ 600024A : 2F16                		mov.l	r1,@-r15
(1)  221/ 600024C : 4F22                		sts.l	pr,@-r15
(1)  222/ 600024E :                     
(1)  223/ 600024E : 0002                		stc	sr,r0
(1)  224/ 6000250 : 4009                		shlr2	r0
(1)  225/ 6000252 : C93C                		and	#$3C,r0
(1)  226/ 6000254 : D104                		mov	#int_m_list,r1
(1)  227/ 6000256 : 301C                		add	r1,r0
(1)  228/ 6000258 : 6102                		mov	@r0,r1
(1)  229/ 600025A : 410B                		jsr	@r1
(1)  230/ 600025C : 0009                		nop
(1)  231/ 600025E :                     
(1)  232/ 600025E : 4F26                		lds.l	@r15+,pr
(1)  233/ 6000260 : 61F6                		mov.l	@r15+,r1
(1)  234/ 6000262 : 60F6                		mov.l	@r15+,r0
(1)  235/ 6000264 : 002B                		rte
(1)  236/ 6000266 : 0009                		nop
(1)  237/ 6000268 :                     		align 4
(1)  238/ 6000268 : 0600 026C           		ltorg
(1)  239/ 600026C :                     
(1)  240/ 600026C :                     ; ------------------------------------------------
(1)  241/ 600026C :                     ; irq list
(1)  242/ 600026C :                     ; ------------------------------------------------
(1)  243/ 600026C :                     
(1)  244/ 600026C :                     		align 4
(1)  245/ 600026C :                     int_m_list:
(1)  246/ 600026C : 0600 0314 0600 0314 		dc.l m_irq_bad,m_irq_bad
(1)  247/ 6000274 : 0600 0314 0600 0314 		dc.l m_irq_bad,m_irq_bad
(1)  248/ 600027C : 0600 0314 C000 0000 		dc.l m_irq_bad,m_irq_custom
(1)  249/ 6000284 : 0600 0318 0600 0318 		dc.l m_irq_pwm,m_irq_pwm
(1)  250/ 600028C : 0600 0334 0600 0334 		dc.l m_irq_cmd,m_irq_cmd
(1)  251/ 6000294 : 0600 0368 0600 0368 		dc.l m_irq_h,m_irq_h
(1)  252/ 600029C : 0600 0384 0600 0384 		dc.l m_irq_v,m_irq_v
(1)  253/ 60002A4 : 0600 044C 0600 044C 		dc.l m_irq_vres,m_irq_vres
(1)  254/ 60002AC :                     
(1)  255/ 60002AC :                     ; ====================================================================
(1)  256/ 60002AC :                     ; ----------------------------------------------------------------
(1)  257/ 60002AC :                     ; irq
(1)  258/ 60002AC :                     ;
(1)  259/ 60002AC :                     ; r0-r1 are safe
(1)  260/ 60002AC :                     ; ----------------------------------------------------------------
(1)  261/ 60002AC :                     
(1)  262/ 60002AC :                     slave_irq:
(1)  263/ 60002AC : 2F06                		mov.l	r0,@-r15
(1)  264/ 60002AE : 2F16                		mov.l	r1,@-r15
(1)  265/ 60002B0 : 4F22                		sts.l	pr,@-r15
(1)  266/ 60002B2 :                     
(1)  267/ 60002B2 : 0002                		stc	sr,r0
(1)  268/ 60002B4 : 4009                		shlr2	r0
(1)  269/ 60002B6 : C93C                		and	#$3C,r0
(1)  270/ 60002B8 : D127                		mov	#int_s_list,r1
(1)  271/ 60002BA : 301C                		add	r1,r0
(1)  272/ 60002BC : 6102                		mov	@r0,r1
(1)  273/ 60002BE : 410B                		jsr	@r1
(1)  274/ 60002C0 : 0009                		nop
(1)  275/ 60002C2 :                     
(1)  276/ 60002C2 : 4F26                		lds.l	@r15+,pr
(1)  277/ 60002C4 : 61F6                		mov.l	@r15+,r1
(1)  278/ 60002C6 : 60F6                		mov.l	@r15+,r0
(1)  279/ 60002C8 : 002B                		rte
(1)  280/ 60002CA : 0009                		nop
(1)  281/ 60002CC :                     		align 4
(1)  282/ 60002CC :                     
(1)  283/ 60002CC :                     ; ------------------------------------------------
(1)  284/ 60002CC :                     ; irq list
(1)  285/ 60002CC :                     ; ------------------------------------------------
(1)  286/ 60002CC :                     
(1)  287/ 60002CC :                     int_s_list:
(1)  288/ 60002CC : 0600 04CE 0600 04CE 		dc.l s_irq_bad,s_irq_bad
(1)  289/ 60002D4 : 0600 04CE 0600 04CE 		dc.l s_irq_bad,s_irq_bad
(1)  290/ 60002DC : 0600 04CE 0600 1510 		dc.l s_irq_bad,s_irq_custom
(1)  291/ 60002E4 : 0600 04D4 0600 04D4 		dc.l s_irq_pwm,s_irq_pwm
(1)  292/ 60002EC : 0600 04F8 0600 04F8 		dc.l s_irq_cmd,s_irq_cmd
(1)  293/ 60002F4 : 0600 0530 0600 0530 		dc.l s_irq_h,s_irq_h
(1)  294/ 60002FC : 0600 054C 0600 054C 		dc.l s_irq_v,s_irq_v
(1)  295/ 6000304 : 0600 0560 0600 0560 		dc.l s_irq_vres,s_irq_vres
(1)  296/ 600030C :                     			
(1)  297/ 600030C :                     ; ====================================================================
(1)  298/ 600030C :                     ; ----------------------------------------------------------------
(1)  299/ 600030C :                     ; Noraml error trap
(1)  300/ 600030C :                     ; ----------------------------------------------------------------
(1)  301/ 600030C :                     
(1)  302/ 600030C :                     SH2_Error:
(1)  303/ 600030C : 0009                		nop
(1)  304/ 600030E : AFFD                		bra	SH2_Error
(1)  305/ 6000310 : 0009                		nop
(1)  306/ 6000312 :                     		align 4
(1)  307/ 6000314 :                     
(1)  308/ 6000314 :                     ; ====================================================================		
(1)  309/ 6000314 :                     ; ----------------------------------------------------------------
(1)  310/ 6000314 :                     ; MARS Interrupts
(1)  311/ 6000314 :                     ; ----------------------------------------------------------------
(1)  312/ 6000314 :                     
(1)  313/ 6000314 :                     ; =================================================================
(1)  314/ 6000314 :                     ; ------------------------------------------------
(1)  315/ 6000314 :                     ; Master | Unused interrupt
(1)  316/ 6000314 :                     ; ------------------------------------------------
(1)  317/ 6000314 :                     
(1)  318/ 6000314 :                     m_irq_bad:
(1)  319/ 6000314 : 000B                		rts
(1)  320/ 6000316 : 0009                		nop
(1)  321/ 6000318 :                     		align 4
(1)  322/ 6000318 :                     
(1)  323/ 6000318 :                     ; =================================================================
(1)  324/ 6000318 :                     ; ------------------------------------------------
(1)  325/ 6000318 :                     ; Master | PWM Interrupt
(1)  326/ 6000318 :                     ; ------------------------------------------------
(1)  327/ 6000318 :                     
(1)  328/ 6000318 :                     m_irq_pwm:
(1)  329/ 6000318 : 9124                		mov	#_FRT,r1
(1)  330/ 600031A : 8417                		mov.b	@(7,r1),r0
(1)  331/ 600031C : CA02                		xor	#2,r0
(1)  332/ 600031E : 8017                		mov.b	r0,@(7,r1)
(1)  333/ 6000320 : D10E                		mov	#_sysreg+pwmintclr,r1
(1)  334/ 6000322 : 2101                		mov.w	r0,@r1
(1)  335/ 6000324 : 0009                		nop
(1)  336/ 6000326 : 0009                		nop
(1)  337/ 6000328 : 0009                		nop
(1)  338/ 600032A : 0009                		nop
(1)  339/ 600032C : 0009                		nop
(1)  340/ 600032E : 000B                		rts
(1)  341/ 6000330 : 0009                		nop
(1)  342/ 6000332 :                     		align 4
(1)  343/ 6000334 :                     
(1)  344/ 6000334 :                     ; =================================================================
(1)  345/ 6000334 :                     ; ------------------------------------------------
(1)  346/ 6000334 :                     ; Master | CMD Interrupt
(1)  347/ 6000334 :                     ; 
(1)  348/ 6000334 :                     ; Recieve data from Genesis (DREQ-less)
(1)  349/ 6000334 :                     ; ------------------------------------------------
(1)  350/ 6000334 :                     
(1)  351/ 6000334 :                     m_irq_cmd:
(1)  352/ 6000334 : 9116                		mov	#_FRT,r1
(1)  353/ 6000336 : 8417                		mov.b	@(7,r1),r0
(1)  354/ 6000338 : CA02                		xor	#2,r0
(1)  355/ 600033A : 8017                		mov.b	r0,@(7,r1)
(1)  356/ 600033C : D108                		mov	#_sysreg+cmdintclr,r1
(1)  357/ 600033E : 2101                		mov.w	r0,@r1
(1)  358/ 6000340 : 2F26                		mov	r2,@-r15
(1)  359/ 6000342 : 2F36                		mov	r3,@-r15
(1)  360/ 6000344 : 2F46                		mov	r4,@-r15
(1)  361/ 6000346 : 4F03                		stc	sr,@-r15
(1)  362/ 6000348 : 900D                		mov	#$F0,r0
(1)  363/ 600034A : 400E                		ldc	r0,sr
(1)  364/ 600034C :                     
(1)  365/ 600034C :                     ; ; ----------------------------------------
(1)  366/ 600034C :                     ;
(1)  367/ 600034C :                     ; ; 		mov	#_sysreg+comm4,r1	; Check if Z80
(1)  368/ 600034C :                     ; ; 		mov.b	@(0,r1),r0		; called first
(1)  369/ 600034C :                     ; ; 		cmp/eq	#0,r0
(1)  370/ 600034C :                     ; ; 		bf	.pwm_play
(1)  371/ 600034C :                     ;
(1)  372/ 600034C :                     ; ; ----------------------------------------
(1)  373/ 600034C :                     ; ; Transfer from 68K
(1)  374/ 600034C :                     ; ; ----------------------------------------
(1)  375/ 600034C :                     ;
(1)  376/ 600034C :                     ; 		mov	#_sysreg+comm8,r1
(1)  377/ 600034C :                     ; 		mov	#RAM_Mars_MdTasksFifo_M,r2
(1)  378/ 600034C :                     ; 		mov	#_sysreg+comm14,r3	; Also process tasks
(1)  379/ 600034C :                     ; 		mov.b	@r3,r0			; after this
(1)  380/ 600034C :                     ; 		or	#$80,r0
(1)  381/ 600034C :                     ; 		mov.b	r0,@r3
(1)  382/ 600034C :                     ; .next_comm:
(1)  383/ 600034C :                     ; 		mov	#2,r0		; SH is ready
(1)  384/ 600034C :                     ; 		mov.b	r0,@(1,r1)
(1)  385/ 600034C :                     ; .wait_md_b:
(1)  386/ 600034C :                     ; 		mov.b	@(0,r1),r0	; get MD status
(1)  387/ 600034C :                     ; 		cmp/eq	#0,r0
(1)  388/ 600034C :                     ; 		bt	.finish
(1)  389/ 600034C :                     ; 		and	#$80,r0
(1)  390/ 600034C :                     ; 		cmp/eq	#0,r0		; is MD busy?
(1)  391/ 600034C :                     ; 		bt	.wait_md_b
(1)  392/ 600034C :                     ; 		mov	#1,r0		; SH is busy
(1)  393/ 600034C :                     ; 		mov.b	r0,@(1,r1)
(1)  394/ 600034C :                     ; .wait_md_c:
(1)  395/ 600034C :                     ; 		mov.b	@(0,r1),r0
(1)  396/ 600034C :                     ; 		cmp/eq	#0,r0
(1)  397/ 600034C :                     ; 		bt	.finish
(1)  398/ 600034C :                     ; 		and	#$40,r0
(1)  399/ 600034C :                     ; 		cmp/eq	#$40,r0		; MD ready?
(1)  400/ 600034C :                     ; 		bf	.wait_md_c
(1)  401/ 600034C :                     ; 		mov.w	@(2,r1),r0	; comm10
(1)  402/ 600034C :                     ; 		mov.w	r0,@r2
(1)  403/ 600034C :                     ; 		mov.w	@(4,r1),r0	; comm12
(1)  404/ 600034C :                     ; 		mov.w	r0,@(2,r2)
(1)  405/ 600034C :                     ; 		bra	.next_comm
(1)  406/ 600034C :                     ; 		add	#4,r2
(1)  407/ 600034C :                     
(1)  408/ 600034C :                     ; ; ----------------------------------------
(1)  409/ 600034C :                     ; ; Transfer from Z80
(1)  410/ 600034C :                     ; ; ----------------------------------------
(1)  411/ 600034C :                     ; 
(1)  412/ 600034C :                     ; .pwm_play:
(1)  413/ 600034C :                     ; 		cmp/eq	#$20,r0
(1)  414/ 600034C :                     ; 		bt	.finish_s
(1)  415/ 600034C :                     ; 		mov	#MarsSnd_PwmTrkData,r2
(1)  416/ 600034C :                     ; 		cmp/eq	#$21,r0
(1)  417/ 600034C :                     ; 		bt	.next_commz
(1)  418/ 600034C :                     ; 		mov	#MarsSnd_PwmPlyData,r2
(1)  419/ 600034C :                     ; 		add	#-1,r0
(1)  420/ 600034C :                     ; 		and	#%11111,r0
(1)  421/ 600034C :                     ; 		shll2	r0
(1)  422/ 600034C :                     ; 		shll	r0
(1)  423/ 600034C :                     ; 		add	r0,r2
(1)  424/ 600034C :                     ; .next_commz:
(1)  425/ 600034C :                     ; 		mov	#2,r0		; SH is ready
(1)  426/ 600034C :                     ; 		mov.b	r0,@(1,r1)
(1)  427/ 600034C :                     ; .wait_z_b:
(1)  428/ 600034C :                     ; 		mov.b	@(0,r1),r0	; get Z80 status
(1)  429/ 600034C :                     ; 		cmp/eq	#0,r0
(1)  430/ 600034C :                     ; 		bt	.finish_s
(1)  431/ 600034C :                     ; 		and	#$80,r0
(1)  432/ 600034C :                     ; 		cmp/eq	#0,r0		; is Z80 busy?
(1)  433/ 600034C :                     ; 		bt	.wait_z_b
(1)  434/ 600034C :                     ; 		mov	#1,r0		; SH is busy
(1)  435/ 600034C :                     ; 		mov.b	r0,@(1,r1)
(1)  436/ 600034C :                     ; .wait_z_c:
(1)  437/ 600034C :                     ; 		mov.b	@(0,r1),r0
(1)  438/ 600034C :                     ; 		cmp/eq	#0,r0
(1)  439/ 600034C :                     ; 		bt	.finish_s
(1)  440/ 600034C :                     ; 		and	#$40,r0
(1)  441/ 600034C :                     ; 		cmp/eq	#$40,r0		; Z80 ready?
(1)  442/ 600034C :                     ; 		bf	.wait_z_c
(1)  443/ 600034C :                     ; 		mov.w	@(2,r1),r0	; word write.
(1)  444/ 600034C :                     ; 		mov.w	r0,@r2
(1)  445/ 600034C :                     ; 		bra	.next_commz
(1)  446/ 600034C :                     ; 		add	#2,r2
(1)  447/ 600034C :                     ; 		align 4
(1)  448/ 600034C :                     ; 
(1)  449/ 600034C :                     ; ; ----------------------------------------
(1)  450/ 600034C :                     ; 
(1)  451/ 600034C :                     ; .finish_s:
(1)  452/ 600034C :                     ; 		mov	#1,r0
(1)  453/ 600034C :                     ; 		mov.w	r0,@(marsGbl_PwmTrkUpd,gbr)
(1)  454/ 600034C :                     ; 		mov	#$80,r0
(1)  455/ 600034C :                     ; 		mov.b	r0,@(1,r1)
(1)  456/ 600034C :                     
(1)  457/ 600034C :                     .finish:
(1)  458/ 600034C : 4F07                		ldc 	@r15+,sr
(1)  459/ 600034E : 64F6                		mov 	@r15+,r4
(1)  460/ 6000350 : 63F6                		mov 	@r15+,r3
(1)  461/ 6000352 : 62F6                		mov 	@r15+,r2
(1)  462/ 6000354 : 000B                		rts
(1)  463/ 6000356 : 0009                		nop
(1)  464/ 6000358 :                     		align 4
(1)  465/ 6000358 : 0600 02CC 2000 401C 		ltorg
                    2000 401A FE10 00F0 
(1)  466/ 6000368 :                     		
(1)  467/ 6000368 :                     ; =================================================================
(1)  468/ 6000368 :                     ; ------------------------------------------------
(1)  469/ 6000368 :                     ; Master | HBlank
(1)  470/ 6000368 :                     ; ------------------------------------------------
(1)  471/ 6000368 :                     
(1)  472/ 6000368 :                     m_irq_h:
(1)  473/ 6000368 : 916E                		mov	#_FRT,r1
(1)  474/ 600036A : 8417                		mov.b	@(7,r1),r0
(1)  475/ 600036C : CA02                		xor	#2,r0
(1)  476/ 600036E : 8017                		mov.b	r0,@(7,r1)
(1)  477/ 6000370 : D130                		mov	#_sysreg+hintclr,r1
(1)  478/ 6000372 : 2101                		mov.w	r0,@r1
(1)  479/ 6000374 : 0009                		nop
(1)  480/ 6000376 : 0009                		nop
(1)  481/ 6000378 : 0009                		nop
(1)  482/ 600037A : 0009                		nop
(1)  483/ 600037C : 0009                		nop
(1)  484/ 600037E : 000B                		rts
(1)  485/ 6000380 : 0009                		nop
(1)  486/ 6000382 :                     		align 4
(1)  487/ 6000384 :                     		
(1)  488/ 6000384 :                     ; =================================================================
(1)  489/ 6000384 :                     ; ------------------------------------------------
(1)  490/ 6000384 :                     ; Master | VBlank
(1)  491/ 6000384 :                     ; ------------------------------------------------
(1)  492/ 6000384 :                     
(1)  493/ 6000384 :                     m_irq_v:
(1)  494/ 6000384 : 9160                		mov	#_FRT,r1
(1)  495/ 6000386 : 8417                		mov.b	@(7,r1),r0
(1)  496/ 6000388 : CA02                		xor	#2,r0
(1)  497/ 600038A : 8017                		mov.b	r0,@(7,r1)
(1)  498/ 600038C : D12A                		mov	#_sysreg+vintclr,r1
(1)  499/ 600038E : 2101                		mov.w	r0,@r1
(1)  500/ 6000390 :                     
(1)  501/ 6000390 : D12A                		mov	#_vdpreg,r1		; Wait for palette access
(1)  502/ 6000392 : 8515                .wait_fb:	mov.w	@(vdpsts,r1),r0		; Read status as WORD
(1)  503/ 6000394 : C802                		tst	#2,r0			; Framebuffer busy? (wait for FEN=1)
(1)  504/ 6000396 : 8BFC                		bf	.wait_fb
(1)  505/ 6000398 : 841A                .wait		mov.b	@(vdpsts,r1),r0		; Now read as a BYTE
(1)  506/ 600039A : C820                		tst	#$20,r0			; Palette unlocked? (wait for PEN=0)
(1)  507/ 600039C : 89FC                		bt	.wait
(1)  508/ 600039E : 4F03                		stc	sr,@-r15
(1)  509/ 60003A0 : 2F26                		mov	r2,@-r15
(1)  510/ 60003A2 : 2F36                		mov	r3,@-r15
(1)  511/ 60003A4 : 2F46                		mov	r4,@-r15
(1)  512/ 60003A6 : 2F56                		mov	r5,@-r15
(1)  513/ 60003A8 : 4F12                		sts	macl,@-r15
(1)  514/ 60003AA : 904E                		mov	#$F0,r0			; Disable interrupts
(1)  515/ 60003AC : 400E                		ldc	r0,sr
(1)  516/ 60003AE :                     
(1)  517/ 60003AE :                     	; Copy palette manually to SuperVDP
(1)  518/ 60003AE : E001                		mov	#1,r0
(1)  519/ 60003B0 : C13A                		mov.w	r0,@(marsGbl_PalDmaMidWr,gbr)
(1)  520/ 60003B2 : D123                		mov	#RAM_Mars_Palette,r1
(1)  521/ 60003B4 : D223                		mov	#_palette,r2
(1)  522/ 60003B6 : E310                 		mov	#256/16,r3
(1)  523/ 60003B8 :                     .copy_pal:
(1)  524/ 60003B8 :                     	rept 16
(1)  525/ 60003B8 :                     		mov.w	@r1+,r0
(1)  526/ 60003B8 :                     		mov.w	r0,@r2
(1)  527/ 60003B8 :                     		add	#2,r2
(1)  528/ 60003B8 :                     	endm
(1)  525/ 60003B8 : 6015                		mov.w	@r1+,r0
(1)  526/ 60003BA : 2201                		mov.w	r0,@r2
(1)  527/ 60003BC : 7202                		add	#2,r2
(1)  525/ 60003BE : 6015                		mov.w	@r1+,r0
(1)  526/ 60003C0 : 2201                		mov.w	r0,@r2
(1)  527/ 60003C2 : 7202                		add	#2,r2
(1)  525/ 60003C4 : 6015                		mov.w	@r1+,r0
(1)  526/ 60003C6 : 2201                		mov.w	r0,@r2
(1)  527/ 60003C8 : 7202                		add	#2,r2
(1)  525/ 60003CA : 6015                		mov.w	@r1+,r0
(1)  526/ 60003CC : 2201                		mov.w	r0,@r2
(1)  527/ 60003CE : 7202                		add	#2,r2
(1)  525/ 60003D0 : 6015                		mov.w	@r1+,r0
(1)  526/ 60003D2 : 2201                		mov.w	r0,@r2
(1)  527/ 60003D4 : 7202                		add	#2,r2
(1)  525/ 60003D6 : 6015                		mov.w	@r1+,r0
(1)  526/ 60003D8 : 2201                		mov.w	r0,@r2
(1)  527/ 60003DA : 7202                		add	#2,r2
(1)  525/ 60003DC : 6015                		mov.w	@r1+,r0
(1)  526/ 60003DE : 2201                		mov.w	r0,@r2
(1)  527/ 60003E0 : 7202                		add	#2,r2
(1)  525/ 60003E2 : 6015                		mov.w	@r1+,r0
(1)  526/ 60003E4 : 2201                		mov.w	r0,@r2
(1)  527/ 60003E6 : 7202                		add	#2,r2
(1)  525/ 60003E8 : 6015                		mov.w	@r1+,r0
(1)  526/ 60003EA : 2201                		mov.w	r0,@r2
(1)  527/ 60003EC : 7202                		add	#2,r2
(1)  525/ 60003EE : 6015                		mov.w	@r1+,r0
(1)  526/ 60003F0 : 2201                		mov.w	r0,@r2
(1)  527/ 60003F2 : 7202                		add	#2,r2
(1)  525/ 60003F4 : 6015                		mov.w	@r1+,r0
(1)  526/ 60003F6 : 2201                		mov.w	r0,@r2
(1)  527/ 60003F8 : 7202                		add	#2,r2
(1)  525/ 60003FA : 6015                		mov.w	@r1+,r0
(1)  526/ 60003FC : 2201                		mov.w	r0,@r2
(1)  527/ 60003FE : 7202                		add	#2,r2
(1)  525/ 6000400 : 6015                		mov.w	@r1+,r0
(1)  526/ 6000402 : 2201                		mov.w	r0,@r2
(1)  527/ 6000404 : 7202                		add	#2,r2
(1)  525/ 6000406 : 6015                		mov.w	@r1+,r0
(1)  526/ 6000408 : 2201                		mov.w	r0,@r2
(1)  527/ 600040A : 7202                		add	#2,r2
(1)  525/ 600040C : 6015                		mov.w	@r1+,r0
(1)  526/ 600040E : 2201                		mov.w	r0,@r2
(1)  527/ 6000410 : 7202                		add	#2,r2
(1)  525/ 6000412 : 6015                		mov.w	@r1+,r0
(1)  526/ 6000414 : 2201                		mov.w	r0,@r2
(1)  527/ 6000416 : 7202                		add	#2,r2
(1)  529/ 6000418 : 4310                		dt	r3
(1)  530/ 600041A : 8BCD                		bf	.copy_pal
(1)  531/ 600041C : E000                		mov	#0,r0
(1)  532/ 600041E : C13A                		mov.w	r0,@(marsGbl_PalDmaMidWr,gbr)
(1)  533/ 6000420 :                     
(1)  534/ 6000420 :                             ; OLD method: doesn't work on hardware
(1)  535/ 6000420 :                     ; 		mov	r4,@-r15
(1)  536/ 6000420 :                     ; 		mov	r5,@-r15
(1)  537/ 6000420 :                     ; 		mov	r6,@-r15
(1)  538/ 6000420 :                     ; 		mov	#RAM_Mars_Palette,r1		; Send palette stored on RAM
(1)  539/ 6000420 :                     ; 		mov	#_palette,r2
(1)  540/ 6000420 :                     ;  		mov	#256,r3
(1)  541/ 6000420 :                     ; 		mov	#%0101011011110001,r4		; transfer size 2 / burst
(1)  542/ 6000420 :                     ; 		mov	#_DMASOURCE0,r5 		; _DMASOURCE = $ffffff80
(1)  543/ 6000420 :                     ; 		mov	#_DMAOPERATION,r6 		; _DMAOPERATION = $ffffffb0
(1)  544/ 6000420 :                     ; 		mov	r1,@r5				; set source address
(1)  545/ 6000420 :                     ; 		mov	r2,@(4,r5)			; set destination address
(1)  546/ 6000420 :                     ; 		mov	r3,@(8,r5)			; set length
(1)  547/ 6000420 :                     ; 		xor	r0,r0
(1)  548/ 6000420 :                     ; 		mov	r0,@r6				; Stop OPERATION
(1)  549/ 6000420 :                     ; 		xor	r0,r0
(1)  550/ 6000420 :                     ; 		mov	r0,@($C,r5)			; clear TE bit
(1)  551/ 6000420 :                     ; 		mov	r4,@($C,r5)			; load mode
(1)  552/ 6000420 :                     ; 		add	#1,r0
(1)  553/ 6000420 :                     ; 		mov	r0,@r6				; Start OPERATION
(1)  554/ 6000420 :                     ; 		mov	@r15+,r6
(1)  555/ 6000420 :                     ; 		mov	@r15+,r5
(1)  556/ 6000420 :                     ; 		mov	@r15+,r4
(1)  557/ 6000420 :                     
(1)  558/ 6000420 :                     ; 		mov	#1,r1
(1)  559/ 6000420 :                     ; 		mov	#MarsVideo_MoveBgX,r0
(1)  560/ 6000420 :                     ; 		jsr	@r0
(1)  561/ 6000420 :                     
(1)  562/ 6000420 : 4F16                		lds	@r15+,macl
(1)  563/ 6000422 : 65F6                		mov	@r15+,r5
(1)  564/ 6000424 : 64F6                		mov	@r15+,r4
(1)  565/ 6000426 : 63F6                		mov	@r15+,r3
(1)  566/ 6000428 : 62F6                		mov	@r15+,r2
(1)  567/ 600042A : 4F07                		ldc	@r15+,sr
(1)  568/ 600042C :                     		
(1)  569/ 600042C :                     .mid_pwrite:
(1)  570/ 600042C : E000                		mov 	#0,r0				; Clear VintFlag for Master
(1)  571/ 600042E : C134                		mov.w	r0,@(marsGbl_VIntFlag_M,gbr)
(1)  572/ 6000430 : 000B                		rts
(1)  573/ 6000432 : 0009                		nop
(1)  574/ 6000434 :                     		align 4
(1)  575/ 6000434 : 2000 4018 2000 4016 		ltorg
                    2000 4100 0600 483C 
                    2000 4200 FE10 00F0 
(1)  576/ 600044C :                     
(1)  577/ 600044C :                     ; =================================================================
(1)  578/ 600044C :                     ; ------------------------------------------------
(1)  579/ 600044C :                     ; Master | VRES Interrupt (RESET on Genesis)
(1)  580/ 600044C :                     ; ------------------------------------------------
(1)  581/ 600044C :                     
(1)  582/ 600044C :                     m_irq_vres:
(1)  583/ 600044C : D017                		mov.l	#_sysreg,r0
(1)  584/ 600044E : 401E                		ldc	r0,gbr
(1)  585/ 6000450 : C10A                		mov.w	r0,@(vresintclr,gbr)	; V interrupt clear
(1)  586/ 6000452 : 0009                		nop
(1)  587/ 6000454 : 0009                		nop
(1)  588/ 6000456 : 0009                		nop
(1)  589/ 6000458 : 0009                		nop
(1)  590/ 600045A : 9033                		mov	#$F0,r0
(1)  591/ 600045C : 400E                		ldc	r0,sr
(1)  592/ 600045E : C406                		mov.b	@(dreqctl,gbr),r0
(1)  593/ 6000460 : C801                		tst	#1,r0
(1)  594/ 6000462 : 8B1C                		bf	.mars_reset
(1)  595/ 6000464 :                     .md_reset:
(1)  596/ 6000464 : D112                		mov.l	#"68UP",r1		; wait for the 68K to show up
(1)  597/ 6000466 : C60B                		mov.l	@(comm12,gbr),r0
(1)  598/ 6000468 : 3100                		cmp/eq	r0,r1
(1)  599/ 600046A : 8BFB                		bf	.md_reset
(1)  600/ 600046C :                     .sh_wait:
(1)  601/ 600046C : D111                		mov.l	#"S_OK",r1		; wait for the Slave CPU to show up
(1)  602/ 600046E : C609                		mov.l	@(comm4,gbr),r0
(1)  603/ 6000470 : 3100                		cmp/eq	r0,r1
(1)  604/ 6000472 : 8BFB                		bf	.sh_wait
(1)  605/ 6000474 : D010                		mov.l	#"M_OK",r0		; let the others know master ready
(1)  606/ 6000476 : C208                		mov.l	r0,@(comm0,gbr)
(1)  607/ 6000478 : 9125                		mov.l   #$FFFFFE80,r1		; Stop watchdog
(1)  608/ 600047A : 9025                		mov.w   #$A518,r0
(1)  609/ 600047C : 2101                		mov.w   r0,@r1
(1)  610/ 600047E :                     ; 		mov	#_vdpreg,r1		; Framebuffer swap request
(1)  611/ 600047E :                     ; 		mov.b	@(framectl,r1),r0	; watchdog will check for it later
(1)  612/ 600047E :                     ; 		xor	#1,r0
(1)  613/ 600047E :                     ; 		mov.b	r0,@(framectl,r1)
(1)  614/ 600047E :                     ; 		mov	#RAM_Mars_Global+marsGbl_CurrFb,r1
(1)  615/ 600047E : 2100                		mov.b	r0,@r1
(1)  616/ 6000480 : DF0E                		mov.l	#CS3|$40000-8,r15	; Set reset values
(1)  617/ 6000482 : D00F                		mov.l	#SH2_M_HotStart,r0
(1)  618/ 6000484 : 2F02                		mov.l	r0,@r15
(1)  619/ 6000486 : 901D                		mov.w	#$F0,r0
(1)  620/ 6000488 : 1F01                		mov.l	r0,@(4,r15)
(1)  621/ 600048A : E1B0                		mov.l	#_DMAOPERATION,r1
(1)  622/ 600048C : E000                		mov.l	#0,r0
(1)  623/ 600048E : 2102                		mov.l	r0,@r1			; Turn any DMA tasks OFF
(1)  624/ 6000490 : E18C                		mov.l	#_DMACHANNEL0,r1
(1)  625/ 6000492 : E000                		mov.l	#0,r0
(1)  626/ 6000494 : 2102                		mov.l	r0,@r1
(1)  627/ 6000496 : 9118                		mov.l	#%0100010011100000,r1
(1)  628/ 6000498 : 2102                		mov.l	r0,@r1			; Channel control
(1)  629/ 600049A : 002B                		rte
(1)  630/ 600049C : 0009                		nop
(1)  631/ 600049E :                     .mars_reset:
(1)  632/ 600049E : 9115                		mov	#_FRT,r1
(1)  633/ 60004A0 : 8417                		mov.b	@(_TOCR,r1),r0
(1)  634/ 60004A2 : CB01                		or	#$01,r0
(1)  635/ 60004A4 : 8017                		mov.b	r0,@(_TOCR,r1)
(1)  636/ 60004A6 :                     .vresloop:
(1)  637/ 60004A6 : AFFE                		bra	.vresloop
(1)  638/ 60004A8 : 0009                		nop
(1)  639/ 60004AA :                     		align 4
(1)  640/ 60004AC : 2000 4000 3638 5550 		ltorg				; Save MASTER IRQ literals here
                    535F 4F4B 4D5F 4F4B 
                    0603 FFF8 0600 0CCA 
                    00F0 FE80 A518 44E0 
                    FE10                
(1)  641/ 60004CE :                     
(1)  642/ 60004CE :                     ; =================================================================
(1)  643/ 60004CE :                     ; ------------------------------------------------
(1)  644/ 60004CE :                     ; Master | Watchdog interrupt
(1)  645/ 60004CE :                     ; ------------------------------------------------
(1)  646/ 60004CE :                     
(1)  647/ 60004CE :                     ; m_irq_custom:
(1)  648/ 60004CE :                     ; MOVED: see cache.asm
(1)  649/ 60004CE :                     
(1)  650/ 60004CE :                     ; =================================================================
(1)  651/ 60004CE :                     ; ------------------------------------------------
(1)  652/ 60004CE :                     ; Unused
(1)  653/ 60004CE :                     ; ------------------------------------------------
(1)  654/ 60004CE :                     
(1)  655/ 60004CE :                     s_irq_bad:
(1)  656/ 60004CE : 000B                		rts
(1)  657/ 60004D0 : 0009                		nop
(1)  658/ 60004D2 :                     		align 4
(1)  659/ 60004D4 :                     
(1)  660/ 60004D4 :                     ; =================================================================
(1)  661/ 60004D4 :                     ; ------------------------------------------------
(1)  662/ 60004D4 :                     ; Slave | PWM Interrupt
(1)  663/ 60004D4 :                     ; ------------------------------------------------
(1)  664/ 60004D4 :                     
(1)  665/ 60004D4 :                     s_irq_pwm:
(1)  666/ 60004D4 : D111                		mov	#_sysreg+monowidth,r1
(1)  667/ 60004D6 : 6010                		mov.b	@r1,r0
(1)  668/ 60004D8 : C880                 		tst	#$80,r0
(1)  669/ 60004DA : 8B04                 		bf	.exit
(1)  670/ 60004DC : 4F22                		sts	pr,@-r15
(1)  671/ 60004DE : D010                		mov	#MarsSound_ReadPwm,r0
(1)  672/ 60004E0 : 400B                		jsr	@r0
(1)  673/ 60004E2 : 0009                		nop
(1)  674/ 60004E4 : 4F26                		lds	@r15+,pr
(1)  675/ 60004E6 : 9121                .exit:		mov	#_FRT,r1
(1)  676/ 60004E8 : 8417                		mov.b	@(7,r1),r0
(1)  677/ 60004EA : CA02                		xor	#2,r0
(1)  678/ 60004EC : 8017                		mov.b	r0,@(7,r1)
(1)  679/ 60004EE : D10D                		mov	#_sysreg+pwmintclr,r1
(1)  680/ 60004F0 : 2101                		mov.w	r0,@r1
(1)  681/ 60004F2 : 000B                		rts
(1)  682/ 60004F4 : 0009                		nop
(1)  683/ 60004F6 :                     		align 4
(1)  684/ 60004F8 :                     
(1)  685/ 60004F8 :                     ; 		mov	#_FRT,r1
(1)  686/ 60004F8 :                     ; 		mov.b	@(7,r1),r0
(1)  687/ 60004F8 :                     ; 		xor	#2,r0
(1)  688/ 60004F8 :                     ; 		mov.b	r0,@(7,r1)
(1)  689/ 60004F8 :                     ; 		mov	#_sysreg+pwmintclr,r1
(1)  690/ 60004F8 :                     ; 		mov.w	r0,@r1
(1)  691/ 60004F8 :                     ; 		nop
(1)  692/ 60004F8 :                     ; 		nop
(1)  693/ 60004F8 :                     ; 		nop
(1)  694/ 60004F8 :                     ; 		nop
(1)  695/ 60004F8 :                     ; 		nop
(1)  696/ 60004F8 :                     ; 		rts
(1)  697/ 60004F8 :                     ; 		nop
(1)  698/ 60004F8 :                     ; 		align 4
(1)  699/ 60004F8 :                     
(1)  700/ 60004F8 :                     ; =================================================================
(1)  701/ 60004F8 :                     ; ------------------------------------------------
(1)  702/ 60004F8 :                     ; Slave | CMD Interrupt
(1)  703/ 60004F8 :                     ; 
(1)  704/ 60004F8 :                     ; Recieve data from Genesis
(1)  705/ 60004F8 :                     ; ------------------------------------------------
(1)  706/ 60004F8 :                     
(1)  707/ 60004F8 :                     s_irq_cmd:
(1)  708/ 60004F8 : 9118                		mov	#_FRT,r1
(1)  709/ 60004FA : 8417                		mov.b	@(7,r1),r0
(1)  710/ 60004FC : CA02                		xor	#2,r0
(1)  711/ 60004FE : 8017                		mov.b	r0,@(7,r1)
(1)  712/ 6000500 : D109                		mov	#_sysreg+cmdintclr,r1
(1)  713/ 6000502 : 2101                		mov.w	r0,@r1
(1)  714/ 6000504 : 2F26                		mov	r2,@-r15
(1)  715/ 6000506 : 2F36                		mov	r3,@-r15
(1)  716/ 6000508 : 2F46                		mov	r4,@-r15
(1)  717/ 600050A : 4F03                		stc	sr,@-r15
(1)  718/ 600050C : 900F                		mov	#$F0,r0
(1)  719/ 600050E : 400E                		ldc	r0,sr
(1)  720/ 6000510 :                     
(1)  721/ 6000510 :                     ; ----------------------------------------
(1)  722/ 6000510 :                     ; Transfer from 68K
(1)  723/ 6000510 :                     ; ----------------------------------------
(1)  724/ 6000510 :                     
(1)  725/ 6000510 :                     ; 		mov	#_sysreg+comm8,r1
(1)  726/ 6000510 :                     ; 		mov	#RAM_Mars_MdTasksFifo_S,r2
(1)  727/ 6000510 :                     ; 		mov	#_sysreg+comm15,r3	; Also process tasks
(1)  728/ 6000510 :                     ; 		mov.b	@r3,r0			; after this
(1)  729/ 6000510 :                     ; 		or	#$80,r0
(1)  730/ 6000510 :                     ; 		mov.b	r0,@r3
(1)  731/ 6000510 :                     ; .next_comm:
(1)  732/ 6000510 :                     ; 		mov	#2,r0		; SH is ready
(1)  733/ 6000510 :                     ; 		mov.b	r0,@(1,r1)
(1)  734/ 6000510 :                     ; .wait_md_b:
(1)  735/ 6000510 :                     ; 		mov.b	@(0,r1),r0	; get MD status
(1)  736/ 6000510 :                     ; 		cmp/eq	#0,r0
(1)  737/ 6000510 :                     ; 		bt	.finish
(1)  738/ 6000510 :                     ; 		and	#$80,r0
(1)  739/ 6000510 :                     ; 		cmp/eq	#0,r0		; is MD busy?
(1)  740/ 6000510 :                     ; 		bt	.wait_md_b
(1)  741/ 6000510 :                     ; 		mov	#1,r0		; SH is busy
(1)  742/ 6000510 :                     ; 		mov.b	r0,@(1,r1)
(1)  743/ 6000510 :                     ; .wait_md_c:
(1)  744/ 6000510 :                     ; 		mov.b	@(0,r1),r0
(1)  745/ 6000510 :                     ; 		cmp/eq	#0,r0
(1)  746/ 6000510 :                     ; 		bt	.finish
(1)  747/ 6000510 :                     ; 		and	#$40,r0
(1)  748/ 6000510 :                     ; 		cmp/eq	#$40,r0		; MD ready?
(1)  749/ 6000510 :                     ; 		bf	.wait_md_c
(1)  750/ 6000510 :                     ; 		mov.w	@(2,r1),r0	; comm10
(1)  751/ 6000510 :                     ; 		mov.w	r0,@r2
(1)  752/ 6000510 :                     ; 		mov.w	@(4,r1),r0	; comm12
(1)  753/ 6000510 :                     ; 		mov.w	r0,@(2,r2)
(1)  754/ 6000510 :                     ; 		bra	.next_comm
(1)  755/ 6000510 :                     ; 		add	#4,r2
(1)  756/ 6000510 :                     ; .finish:
(1)  757/ 6000510 : 4F07                		ldc 	@r15+,sr
(1)  758/ 6000512 : 64F6                		mov 	@r15+,r4
(1)  759/ 6000514 : 63F6                		mov 	@r15+,r3
(1)  760/ 6000516 : 62F6                		mov 	@r15+,r2
(1)  761/ 6000518 : 000B                		rts
(1)  762/ 600051A : 0009                		nop
(1)  763/ 600051C :                     		align 4
(1)  764/ 600051C : 2000 4038 0600 0AD6 		ltorg
                    2000 401C 2000 401A 
                    FE10 00F0           
(1)  765/ 6000530 :                     		
(1)  766/ 6000530 :                     ; =================================================================
(1)  767/ 6000530 :                     ; ------------------------------------------------
(1)  768/ 6000530 :                     ; Slave | HBlank
(1)  769/ 6000530 :                     ; ------------------------------------------------
(1)  770/ 6000530 :                     
(1)  771/ 6000530 :                     s_irq_h:
(1)  772/ 6000530 : 9152                		mov	#_FRT,r1
(1)  773/ 6000532 : 8417                		mov.b	@(7,r1),r0
(1)  774/ 6000534 : CA02                		xor	#2,r0
(1)  775/ 6000536 : 8017                		mov.b	r0,@(7,r1)
(1)  776/ 6000538 : D11F                		mov	#_sysreg+hintclr,r1
(1)  777/ 600053A : 2101                		mov.w	r0,@r1
(1)  778/ 600053C : 0009                		nop
(1)  779/ 600053E : 0009                		nop
(1)  780/ 6000540 : 0009                		nop
(1)  781/ 6000542 : 0009                		nop
(1)  782/ 6000544 : 0009                		nop
(1)  783/ 6000546 : 000B                		rts
(1)  784/ 6000548 : 0009                		nop
(1)  785/ 600054A :                     		align 4
(1)  786/ 600054C :                     
(1)  787/ 600054C :                     ; =================================================================
(1)  788/ 600054C :                     ; ------------------------------------------------
(1)  789/ 600054C :                     ; Slave | VBlank
(1)  790/ 600054C :                     ; ------------------------------------------------
(1)  791/ 600054C :                     
(1)  792/ 600054C :                     s_irq_v:
(1)  793/ 600054C : E000                		mov 	#0,r0				; Clear VintFlag for Slave
(1)  794/ 600054E : C135                		mov.w	r0,@(marsGbl_VIntFlag_S,gbr)
(1)  795/ 6000550 : 9142                		mov	#_FRT,r1
(1)  796/ 6000552 : 8417                		mov.b	@(7,r1),r0
(1)  797/ 6000554 : CA02                		xor	#2,r0
(1)  798/ 6000556 : 8017                		mov.b	r0,@(7,r1)
(1)  799/ 6000558 : D118                		mov	#_sysreg+vintclr,r1
(1)  800/ 600055A : 000B                		rts
(1)  801/ 600055C : 2101                		mov.w	r0,@r1
(1)  802/ 600055E :                     		align 4
(1)  803/ 6000560 :                     
(1)  804/ 6000560 :                     ; =================================================================
(1)  805/ 6000560 :                     ; ------------------------------------------------
(1)  806/ 6000560 :                     ; Slave | VRES Interrupt (Pressed RESET on Genesis)
(1)  807/ 6000560 :                     ; ------------------------------------------------
(1)  808/ 6000560 :                     
(1)  809/ 6000560 :                     s_irq_vres:
(1)  810/ 6000560 : D017                		mov.l	#_sysreg,r0
(1)  811/ 6000562 : 401E                		ldc	r0,gbr
(1)  812/ 6000564 : C10A                		mov.w	r0,@(vresintclr,gbr)	; V interrupt clear
(1)  813/ 6000566 : 0009                		nop
(1)  814/ 6000568 : 0009                		nop
(1)  815/ 600056A : 0009                		nop
(1)  816/ 600056C : 0009                		nop
(1)  817/ 600056E : 9034                		mov	#$F0,r0
(1)  818/ 6000570 : 400E                		ldc	r0,sr
(1)  819/ 6000572 : C406                		mov.b	@(dreqctl,gbr),r0
(1)  820/ 6000574 : C801                		tst	#1,r0
(1)  821/ 6000576 : 8B18                		bf	.mars_reset
(1)  822/ 6000578 :                     .md_reset:
(1)  823/ 6000578 : D112                		mov.l	#"68UP",r1		; wait for the 68k to show up
(1)  824/ 600057A : C60B                		mov.l	@(comm12,gbr),r0
(1)  825/ 600057C : 3100                		cmp/eq	r0,r1
(1)  826/ 600057E : 8BFB                		bf	.md_reset
(1)  827/ 6000580 : D011                		mov.l	#"S_OK",r0		; tell the others slave is ready
(1)  828/ 6000582 : C209                		mov.l	r0,@(comm4,gbr)
(1)  829/ 6000584 :                     .sh_wait:
(1)  830/ 6000584 : D111                		mov.l	#"M_OK",r1		; wait for the slave to show up
(1)  831/ 6000586 : C608                		mov.l	@(comm0,gbr),r0
(1)  832/ 6000588 : 3100                		cmp/eq	r0,r1
(1)  833/ 600058A : 8BFB                		bf	.sh_wait
(1)  834/ 600058C : DF10                		mov.l	#CS3|$3F000-8,r15
(1)  835/ 600058E : D011                		mov.l	#SH2_S_HotStart,r0
(1)  836/ 6000590 : 2F02                		mov.l	r0,@r15
(1)  837/ 6000592 : 9022                		mov.w	#$F0,r0
(1)  838/ 6000594 : 1F01                		mov.l	r0,@(4,r15)
(1)  839/ 6000596 : E1B0                		mov.l	#_DMAOPERATION,r1
(1)  840/ 6000598 : E000                		mov.l	#0,r0
(1)  841/ 600059A : 2102                		mov.l	r0,@r1			; DMA off
(1)  842/ 600059C : E18C                		mov.l	#_DMACHANNEL0,r1
(1)  843/ 600059E : E000                		mov.l	#0,r0
(1)  844/ 60005A0 : 2102                		mov.l	r0,@r1
(1)  845/ 60005A2 : 911B                		mov.l	#%0100010011100000,r1
(1)  846/ 60005A4 : 2102                		mov.l	r0,@r1			; Channel control
(1)  847/ 60005A6 : 002B                		rte
(1)  848/ 60005A8 : 0009                		nop
(1)  849/ 60005AA :                     .mars_reset:
(1)  850/ 60005AA : 9115                		mov	#_FRT,r1
(1)  851/ 60005AC : 8417                		mov.b	@(_TOCR,r1),r0
(1)  852/ 60005AE : CB01                		or	#$01,r0
(1)  853/ 60005B0 : 8017                		mov.b	r0,@(_TOCR,r1)
(1)  854/ 60005B2 :                     .vresloop:
(1)  855/ 60005B2 : AFFE                		bra	.vresloop
(1)  856/ 60005B4 : 0009                		nop
(1)  857/ 60005B6 :                     		align 4
(1)  858/ 60005B8 : 2000 4018 2000 4016 		ltorg			; Save Slave IRQ literals
                    2000 4000 3638 5550 
                    535F 4F4B 4D5F 4F4B 
                    0603 EFF8 0600 1358 
                    FE10 00F0 44E0      
(1)  859/ 60005DE :                     
(1)  860/ 60005DE :                     ; ====================================================================
(1)  861/ 60005DE :                     ; ----------------------------------------------------------------
(1)  862/ 60005DE :                     ; MARS System features
(1)  863/ 60005DE :                     ; ----------------------------------------------------------------
(1)  864/ 60005DE :                     
(1)  865/ 60005DE :                     		include "system/mars/video.asm"
(2)    1/ 60005DE :                     ; ====================================================================
(2)    2/ 60005DE :                     ; ----------------------------------------------------------------
(2)    3/ 60005DE :                     ; MARS Video
(2)    4/ 60005DE :                     ; ----------------------------------------------------------------
(2)    5/ 60005DE :                     
(2)    6/ 60005DE :                     ; ----------------------------------------
(2)    7/ 60005DE :                     ; Variables
(2)    8/ 60005DE :                     ; ----------------------------------------
(2)    9/ 60005DE :                     
(2)   10/ 60005DE :                     ; 3D drawing area, affects 3D positions too.
(2)   11/ 60005DE : =$140               SCREEN_WIDTH	equ	320
(2)   12/ 60005DE : =$E0                SCREEN_HEIGHT	equ	224
(2)   13/ 60005DE :                     
(2)   14/ 60005DE :                     ; MSB
(2)   15/ 60005DE : =$80                PLGN_TEXURE	equ	%10000000
(2)   16/ 60005DE : =$40                PLGN_TRI	equ	%01000000
(2)   17/ 60005DE :                     ; PLGN_SPRITE	equ	%00100000	; TODO: leftover.
(2)   18/ 60005DE :                     
(2)   19/ 60005DE :                     ; ----------------------------------------
(2)   20/ 60005DE :                     ; Structs
(2)   21/ 60005DE :                     ; ----------------------------------------
(2)   22/ 60005DE :                     
(2)   23/ 60005DE :                     ; model objects
(2)   24/ 60005DE : (MACRO)             		struct 0
(2)   24/ 60005DE : =$60005DE           GLBL_LASTPC     set *
(2)   24/   4D4FE :                                     dephase
(2)   24/   4D4FE : =$4D4FE             GLBL_LASTORG    set *
(2)   24/       0 :                                     phase 0
(2)   25/       0 :                     mdl_data	ds.l 1			; Model data pointer, if zero: no model
(2)   26/       4 :                     mdl_option	ds.l 1			; Model options: pixelvalue add
(2)   27/       8 :                     mdl_x_pos	ds.l 1			; X position $000000.00
(2)   28/       C :                     mdl_y_pos	ds.l 1			; Y position $000000.00
(2)   29/      10 :                     mdl_z_pos	ds.l 1			; Z position $000000.00
(2)   30/      14 :                     mdl_x_rot	ds.l 1			; X rotation $000000.00
(2)   31/      18 :                     mdl_y_rot	ds.l 1			; Y rotation $000000.00
(2)   32/      1C :                     mdl_z_rot	ds.l 1			; Z rotation $000000.00
(2)   33/      20 :                     mdl_animdata	ds.l 1			; Model animation data pointer, zero: no animation
(2)   34/      24 :                     mdl_animframe	ds.l 1			; Current frame in animation
(2)   35/      28 :                     mdl_animtimer	ds.l 1			; Animation timer
(2)   36/      2C :                     mdl_animspd	ds.l 1			; Animation USER speed setting
(2)   37/      30 :                     sizeof_mdlobj	ds.l 0
(2)   38/      32 : (MACRO)             		finish
(2)   38/       0 :                                     !org GLBL_LASTORG
(2)   38/ 60005DE :                                     phase GLBL_LASTPC
(2)   39/ 60005DE :                     
(2)   40/ 60005DE :                     ; field view camera
(2)   41/ 60005DE : (MACRO)             		struct 0
(2)   41/ 60005DE : =$60005DE           GLBL_LASTPC     set *
(2)   41/   4D4FE :                                     dephase
(2)   41/   4D4FE : =$4D4FE             GLBL_LASTORG    set *
(2)   41/       0 :                                     phase 0
(2)   42/       0 :                     cam_x_pos	ds.l 1			; X position $000000.00
(2)   43/       4 :                     cam_y_pos	ds.l 1			; Y position $000000.00
(2)   44/       8 :                     cam_z_pos	ds.l 1			; Z position $000000.00
(2)   45/       C :                     cam_x_rot	ds.l 1			; X rotation $000000.00
(2)   46/      10 :                     cam_y_rot	ds.l 1			; Y rotation $000000.00
(2)   47/      14 :                     cam_z_rot	ds.l 1			; Z rotation $000000.00
(2)   48/      18 :                     cam_animdata	ds.l 1			; Model animation data pointer, zero: no animation
(2)   49/      1C :                     cam_animframe	ds.l 1			; Current frame in animation
(2)   50/      20 :                     cam_animtimer	ds.l 1			; Animation timer
(2)   51/      24 :                     cam_animspd	ds.l 1			; Animation speed
(2)   52/      28 :                     sizeof_camera	ds.l 0
(2)   53/      2A : (MACRO)             		finish
(2)   53/       0 :                                     !org GLBL_LASTORG
(2)   53/ 60005DE :                                     phase GLBL_LASTPC
(2)   54/ 60005DE :                     
(2)   55/ 60005DE : (MACRO)             		struct 0
(2)   55/ 60005DE : =$60005DE           GLBL_LASTPC     set *
(2)   55/   4D4FE :                                     dephase
(2)   55/   4D4FE : =$4D4FE             GLBL_LASTORG    set *
(2)   55/       0 :                                     phase 0
(2)   56/       0 :                     mdllay_data	ds.l 1			; Model layout data, zero: Don't use layout
(2)   57/       4 :                     mdllay_x	ds.l 1			; X position
(2)   58/       8 :                     mdllay_y	ds.l 1			; Y position
(2)   59/       C :                     mdllay_z	ds.l 1			; Z position
(2)   60/      10 :                     mdllay_x_last	ds.l 1			; LAST saved X position
(2)   61/      14 :                     mdllay_y_last	ds.l 1			; LAST saved Y position
(2)   62/      18 :                     mdllay_z_last	ds.l 1			; LAST saved Z position
(2)   63/      1C :                     mdllay_xr_last	ds.l 1			; LAST saved X rotation
(2)   64/      20 :                     sizeof_layout	ds.l 0
(2)   65/      22 : (MACRO)             		finish
(2)   65/       0 :                                     !org GLBL_LASTORG
(2)   65/ 60005DE :                                     phase GLBL_LASTPC
(2)   66/ 60005DE :                     
(2)   67/ 60005DE : (MACRO)             		struct 0
(2)   67/ 60005DE : =$60005DE           GLBL_LASTPC     set *
(2)   67/   4D4FE :                                     dephase
(2)   67/   4D4FE : =$4D4FE             GLBL_LASTORG    set *
(2)   67/       0 :                                     phase 0
(2)   68/       0 :                     plypz_ypos	ds.l 1			; Ytop | Ybottom
(2)   69/       4 :                     plypz_xl	ds.l 1
(2)   70/       8 :                     plypz_xl_dx	ds.l 1
(2)   71/       C :                     plypz_xr	ds.l 1
(2)   72/      10 :                     plypz_xr_dx	ds.l 1
(2)   73/      14 :                     plypz_src_xl	ds.l 1
(2)   74/      18 :                     plypz_src_xl_dx	ds.l 1
(2)   75/      1C :                     plypz_src_yl	ds.l 1
(2)   76/      20 :                     plypz_src_yl_dx	ds.l 1
(2)   77/      24 :                     plypz_src_xr	ds.l 1
(2)   78/      28 :                     plypz_src_xr_dx	ds.l 1
(2)   79/      2C :                     plypz_src_yr	ds.l 1
(2)   80/      30 :                     plypz_src_yr_dx	ds.l 1
(2)   81/      34 :                     plypz_mtrl	ds.l 1
(2)   82/      38 :                     plypz_type	ds.l 1			; Type | Option
(2)   83/      3C :                     sizeof_plypz	ds.l 0
(2)   84/      3E : (MACRO)             		finish
(2)   84/       0 :                                     !org GLBL_LASTORG
(2)   84/ 60005DE :                                     phase GLBL_LASTPC
(2)   85/ 60005DE :                     
(2)   86/ 60005DE : (MACRO)             		struct 0
(2)   86/ 60005DE : =$60005DE           GLBL_LASTPC     set *
(2)   86/   4D4FE :                                     dephase
(2)   86/   4D4FE : =$4D4FE             GLBL_LASTORG    set *
(2)   86/       0 :                                     phase 0
(2)   87/       0 :                     polygn_type	ds.l 1		; %MST00000 iiiiiiii wwwwwwww wwwwwwww | Type and Material option (palinc|width)
(2)   88/       4 :                     polygn_mtrl	ds.l 1		; Material Type: Color (0-255) or Texture data address
(2)   89/       8 :                     polygn_points	ds.w 4*2	; X/Y positions
(2)   90/      18 :                     polygn_srcpnts	ds.w 4*2	; X/Y texture points (16-bit), ignored on solidcolor
(2)   91/      28 :                     sizeof_polygn	ds.l 0
(2)   92/      2A : (MACRO)             		finish
(2)   92/       0 :                                     !org GLBL_LASTORG
(2)   92/ 60005DE :                                     phase GLBL_LASTPC
(2)   93/ 60005DE :                     
(2)   94/ 60005DE :                     ; ====================================================================
(2)   95/ 60005DE :                     ; ----------------------------------------------------------------
(2)   96/ 60005DE :                     ; Init MARS Video
(2)   97/ 60005DE :                     ; ----------------------------------------------------------------
(2)   98/ 60005DE :                     
(2)   99/ 60005DE :                     MarsVideo_Init:
(2)  100/ 60005DE : 4F22                		sts	pr,@-r15
(2)  101/ 60005E0 : D104                		mov	#_sysreg,r1
(2)  102/ 60005E2 : 900B                		mov 	#FM,r0			; Set SVDP permission to SH2
(2)  103/ 60005E4 : 8010                  		mov.b	r0,@(adapter,r1)
(2)  104/ 60005E6 : D104                		mov 	#_vdpreg,r1
(2)  105/ 60005E8 : E000                		mov	#0,r0			; Start at blank
(2)  106/ 60005EA : 8011                		mov.b	r0,@(bitmapmd,r1)
(2)  107/ 60005EC : 4F26                		lds	@r15+,pr
(2)  108/ 60005EE : 000B                		rts
(2)  109/ 60005F0 : 0009                		nop
(2)  110/ 60005F2 :                     		align 4
(2)  111/ 60005F4 : 2000 4000 2000 4100 		ltorg
                    0080                
(2)  112/ 60005FE :                     
(2)  113/ 60005FE :                     ; ; ------------------------------------------------
(2)  114/ 60005FE :                     ; ; Init current framebuffer
(2)  115/ 60005FE :                     ; ; ------------------------------------------------
(2)  116/ 60005FE :                     ;
(2)  117/ 60005FE :                     ; .this_fb:
(2)  118/ 60005FE :                     ;  		mov	#_framebuffer,r1
(2)  119/ 60005FE :                     ; 		mov	#$200/2,r0	; START line data
(2)  120/ 60005FE :                     ; 		mov	#240,r2		; Vertical lines to set
(2)  121/ 60005FE :                     ; 		mov	r0,r3		; Increment by (copy from r0)
(2)  122/ 60005FE :                     ; .loop:		mov.w	r0,@r1
(2)  123/ 60005FE :                     ; 		add	#2,r1
(2)  124/ 60005FE :                     ; 		add	r3,r0
(2)  125/ 60005FE :                     ; 		dt	r2
(2)  126/ 60005FE :                     ; 		bf	.loop
(2)  127/ 60005FE :                     ; .fb_wait1:	mov.w   @($A,r4),r0	; Swap for next table
(2)  128/ 60005FE :                     ; 		tst     #2,r0
(2)  129/ 60005FE :                     ; 		bf      .fb_wait1
(2)  130/ 60005FE :                     ; 		mov.w   @($A,r4), r0
(2)  131/ 60005FE :                     ; 		xor     #1,r0
(2)  132/ 60005FE :                     ; 		mov.w   r0,@($A,r4)
(2)  133/ 60005FE :                     ; 		and     #1,r0
(2)  134/ 60005FE :                     ; 		mov     r0,r1
(2)  135/ 60005FE :                     ; .wait_result:
(2)  136/ 60005FE :                     ; 		mov.w   @($A,r4),r0
(2)  137/ 60005FE :                     ; 		and     #1,r0
(2)  138/ 60005FE :                     ; 		cmp/eq  r0,r1
(2)  139/ 60005FE :                     ; 		bf      .wait_result
(2)  140/ 60005FE :                     ; 		rts
(2)  141/ 60005FE :                     ; 		nop
(2)  142/ 60005FE :                     ; 		align 4
(2)  143/ 60005FE :                     
(2)  144/ 60005FE :                     ; ------------------------------------------------
(2)  145/ 60005FE :                     ; Read polygon and build pieces
(2)  146/ 60005FE :                     ;
(2)  147/ 60005FE :                     ; Input:
(2)  148/ 60005FE :                     ; r14 - Polygon data
(2)  149/ 60005FE :                     ;
(2)  150/ 60005FE :                     ; polygn_type bits:
(2)  151/ 60005FE :                     ; %tsp----- -------- -------- --------
(2)  152/ 60005FE :                     ;
(2)  153/ 60005FE :                     ; p - Polygon type: Quad (0) or Triangle (1)
(2)  154/ 60005FE :                     ; s - Corrds are Normal (0) or Sprite (1) <-- Unused.
(2)  155/ 60005FE :                     ; t - Polygon has texture data (1):
(2)  156/ 60005FE :                     ;     polygn_mtrlopt: Texture width
(2)  157/ 60005FE :                     ;     polygn_mtrl   : Texture data address
(2)  158/ 60005FE :                     ;     polygn_srcpnts: Texture X/Y positions for
(2)  159/ 60005FE :                     ;                     each edge (3 or 4)
(2)  160/ 60005FE :                     ; ------------------------------------------------
(2)  161/ 60005FE :                     
(2)  162/ 60005FE :                     MarsVideo_SlicePlgn:
(2)  163/ 60005FE : 4F22                		sts	pr,@-r15
(2)  164/ 6000600 : DD30                		mov	#Cach_DDA_Last,r13		; r13 - DDA last point
(2)  165/ 6000602 : DC31                		mov	#Cach_DDA_Top,r12		; r12 - DDA first point
(2)  166/ 6000604 : 50E0                		mov	@(polygn_type,r14),r0
(2)  167/ 6000606 : 4029                		shlr16	r0
(2)  168/ 6000608 : 4019                		shlr8	r0
(2)  169/ 600060A : C840                		tst	#PLGN_TRI,r0			; PLGN_TRI set?
(2)  170/ 600060C : 8B00                		bf	.tringl
(2)  171/ 600060E : 7D08                		add	#8,r13				; If quad: add 8
(2)  172/ 6000610 :                     .tringl:
(2)  173/ 6000610 : 61E3                		mov	r14,r1
(2)  174/ 6000612 : 62C3                		mov	r12,r2
(2)  175/ 6000614 : D32D                		mov	#Cach_DDA_Src,r3
(2)  176/ 6000616 : 7108                		add	#polygn_points,r1
(2)  177/ 6000618 :                     ; 		tst	#PLGN_SPRITE,r0			; PLGN_SPRITE set?
(2)  178/ 6000618 :                     ; 		bt	.plgn_pnts
(2)  179/ 6000618 :                     ;
(2)  180/ 6000618 :                     ; ; ----------------------------------------
(2)  181/ 6000618 :                     ; ; Sprite points
(2)  182/ 6000618 :                     ; ; ----------------------------------------
(2)  183/ 6000618 :                     ;
(2)  184/ 6000618 :                     ; ; TODO: rework or get rid of this
(2)  185/ 6000618 :                     ; .spr_pnts:
(2)  186/ 6000618 :                     ; 		mov.w	@r1+,r8		; X pos
(2)  187/ 6000618 :                     ; 		mov.w	@r1+,r9		; Y pos
(2)  188/ 6000618 :                     ;
(2)  189/ 6000618 :                     ; 		mov.w	@r1+,r4
(2)  190/ 6000618 :                     ; 		mov.w	@r1+,r6
(2)  191/ 6000618 :                     ; 		mov.w	@r1+,r5
(2)  192/ 6000618 :                     ; 		mov.w	@r1+,r7
(2)  193/ 6000618 :                     ; 		add	#2*2,r1
(2)  194/ 6000618 :                     ; 		add	r8,r4
(2)  195/ 6000618 :                     ; 		add 	r8,r5
(2)  196/ 6000618 :                     ; 		add	r9,r6
(2)  197/ 6000618 :                     ; 		add 	r9,r7
(2)  198/ 6000618 :                     ; 		mov	r5,@r2		; TR
(2)  199/ 6000618 :                     ; 		add	#4,r2
(2)  200/ 6000618 :                     ; 		mov	r6,@r2
(2)  201/ 6000618 :                     ; 		add	#4,r2
(2)  202/ 6000618 :                     ; 		mov	r4,@r2		; TL
(2)  203/ 6000618 :                     ; 		add	#4,r2
(2)  204/ 6000618 :                     ; 		mov	r6,@r2
(2)  205/ 6000618 :                     ; 		add	#4,r2
(2)  206/ 6000618 :                     ; 		mov	r4,@r2		; BL
(2)  207/ 6000618 :                     ; 		add	#4,r2
(2)  208/ 6000618 :                     ; 		mov	r7,@r2
(2)  209/ 6000618 :                     ; 		add	#4,r2
(2)  210/ 6000618 :                     ; 		mov	r5,@r2		; BR
(2)  211/ 6000618 :                     ; 		add	#4,r2
(2)  212/ 6000618 :                     ; 		mov	r7,@r2
(2)  213/ 6000618 :                     ; 		add	#4,r2
(2)  214/ 6000618 :                     ;
(2)  215/ 6000618 :                     ; 		mov.w	@r1+,r4
(2)  216/ 6000618 :                     ; 		mov.w	@r1+,r6
(2)  217/ 6000618 :                     ; 		mov.w	@r1+,r5
(2)  218/ 6000618 :                     ; 		mov.w	@r1+,r7
(2)  219/ 6000618 :                     ; 		mov	r5,@r3		; TR
(2)  220/ 6000618 :                     ; 		add	#4,r3
(2)  221/ 6000618 :                     ; 		mov	r6,@r3
(2)  222/ 6000618 :                     ; 		add	#4,r3
(2)  223/ 6000618 :                     ; 		mov	r4,@r3		; TL
(2)  224/ 6000618 :                     ; 		add	#4,r3
(2)  225/ 6000618 :                     ; 		mov	r6,@r3
(2)  226/ 6000618 :                     ; 		add	#4,r3
(2)  227/ 6000618 :                     ; 		mov	r4,@r3		; BL
(2)  228/ 6000618 :                     ; 		add	#4,r3
(2)  229/ 6000618 :                     ; 		mov	r7,@r3
(2)  230/ 6000618 :                     ; 		add	#4,r3
(2)  231/ 6000618 :                     ; 		mov	r5,@r3		; BR
(2)  232/ 6000618 :                     ; 		add	#4,r3
(2)  233/ 6000618 :                     ; 		mov	r7,@r3
(2)  234/ 6000618 :                     ; 		add	#4,r3
(2)  235/ 6000618 :                     ; ; 		mov	#4*2,r0
(2)  236/ 6000618 :                     ; ; .sprsrc_pnts:
(2)  237/ 6000618 :                     ; ; 		mov.w	@r1+,r0
(2)  238/ 6000618 :                     ; ; 		mov.w	@r1+,r4
(2)  239/ 6000618 :                     ; ; 		mov	r0,@r3
(2)  240/ 6000618 :                     ; ; 		mov	r4,@(4,r3)
(2)  241/ 6000618 :                     ; ; 		dt	r0
(2)  242/ 6000618 :                     ; ; 		bf/s	.sprsrc_pnts
(2)  243/ 6000618 :                     ; ; 		add	#8,r3
(2)  244/ 6000618 :                     ; 		bra	.start_math
(2)  245/ 6000618 :                     ; 		nop
(2)  246/ 6000618 :                     ;
(2)  247/ 6000618 :                     ; ; ----------------------------------------
(2)  248/ 6000618 :                     ; ; Polygon points
(2)  249/ 6000618 :                     ; ; ----------------------------------------
(2)  250/ 6000618 :                     ;
(2)  251/ 6000618 :                     ; .plgn_pnts:
(2)  252/ 6000618 :                     
(2)  253/ 6000618 :                     	; Copy polygon points Cache's DDA
(2)  254/ 6000618 : E804                		mov	#4,r8
(2)  255/ 600061A : 965F                		mov	#SCREEN_WIDTH/2,r6
(2)  256/ 600061C : E770                		mov	#SCREEN_HEIGHT/2,r7
(2)  257/ 600061E :                     .setpnts:
(2)  258/ 600061E : 6415                		mov.w	@r1+,r4			; Get X
(2)  259/ 6000620 : 6515                		mov.w	@r1+,r5			; Get Y
(2)  260/ 6000622 : 346C                		add	r6,r4			; X + width
(2)  261/ 6000624 : 357C                		add	r7,r5			; Y + height
(2)  262/ 6000626 : 2242                		mov	r4,@r2
(2)  263/ 6000628 : 1251                		mov	r5,@(4,r2)
(2)  264/ 600062A : 4810                		dt	r8
(2)  265/ 600062C : 8FF7                		bf/s	.setpnts
(2)  266/ 600062E : 7208                		add	#8,r2
(2)  267/ 6000630 :                     
(2)  268/ 6000630 :                     	; Copy texture source points
(2)  269/ 6000630 :                     	; to Cache
(2)  270/ 6000630 : E804                		mov	#4,r8
(2)  271/ 6000632 :                     .src_pnts:
(2)  272/ 6000632 : 6415                		mov.w	@r1+,r4
(2)  273/ 6000634 : 6515                		mov.w	@r1+,r5
(2)  274/ 6000636 : 2342                		mov	r4,@r3
(2)  275/ 6000638 : 1351                		mov	r5,@(4,r3)
(2)  276/ 600063A : 4810                		dt	r8
(2)  277/ 600063C : 8FF9                		bf/s	.src_pnts
(2)  278/ 600063E : 7308                		add	#8,r3
(2)  279/ 6000640 :                     
(2)  280/ 6000640 :                     	; Here we search for the lowest Y point
(2)  281/ 6000640 :                     	; and highest Y
(2)  282/ 6000640 :                     	; r10 - Top Y
(2)  283/ 6000640 :                     	; r11 - Bottom Y
(2)  284/ 6000640 :                     .start_math:
(2)  285/ 6000640 : E903                		mov	#3,r9
(2)  286/ 6000642 : C840                		tst	#PLGN_TRI,r0			; PLGN_TRI set?
(2)  287/ 6000644 : 8B00                		bf	.ytringl
(2)  288/ 6000646 : 7901                		add	#1,r9
(2)  289/ 6000648 :                     .ytringl:
(2)  290/ 6000648 : DA21                		mov	#$7FFFFFFF,r10
(2)  291/ 600064A : EBFF                		mov	#$FFFFFFFF,r11
(2)  292/ 600064C : 67C3                		mov 	r12,r7
(2)  293/ 600064E : 68C3                		mov	r12,r8
(2)  294/ 6000650 :                     .find_top:
(2)  295/ 6000650 : 5071                		mov	@(4,r7),r0
(2)  296/ 6000652 : 30B7                		cmp/gt	r11,r0
(2)  297/ 6000654 : 8B00                		bf	.is_low
(2)  298/ 6000656 : 6B03                		mov 	r0,r11
(2)  299/ 6000658 :                     .is_low:
(2)  300/ 6000658 : 5081                		mov	@(4,r8),r0
(2)  301/ 600065A : 30A7                		cmp/gt	r10,r0
(2)  302/ 600065C : 8901                		bt	.is_high
(2)  303/ 600065E : 6A03                		mov 	r0,r10
(2)  304/ 6000660 : 6183                		mov	r8,r1
(2)  305/ 6000662 :                     .is_high:
(2)  306/ 6000662 : 7708                		add 	#8,r7
(2)  307/ 6000664 : 4910                		dt	r9
(2)  308/ 6000666 : 8FF3                		bf/s	.find_top
(2)  309/ 6000668 : 7808                		add	#8,r8
(2)  310/ 600066A : 3AB3                		cmp/ge	r11,r10			; Top larger than Bottom?
(2)  311/ 600066C : 8927                		bt	.exit
(2)  312/ 600066E : 4B15                		cmp/pl	r11			; Bottom < 0?
(2)  313/ 6000670 : 8B25                		bf	.exit
(2)  314/ 6000672 : 9034                		mov	#SCREEN_HEIGHT,r0	; Top > 224?
(2)  315/ 6000674 : 3A03                		cmp/ge	r0,r10
(2)  316/ 6000676 : 8922                		bt	.exit
(2)  317/ 6000678 :                     
(2)  318/ 6000678 :                     	; r2 - Left DDA READ pointer
(2)  319/ 6000678 :                     	; r3 - Right DDA READ pointer
(2)  320/ 6000678 :                     	; r4 - Left X
(2)  321/ 6000678 :                     	; r5 - Left DX
(2)  322/ 6000678 :                     	; r6 - Right X
(2)  323/ 6000678 :                     	; r7 - Right DX
(2)  324/ 6000678 :                     	; r8 - Left width
(2)  325/ 6000678 :                     	; r9 - Right width
(2)  326/ 6000678 :                     	; r10 - Top Y, gets updated after calling put_piece
(2)  327/ 6000678 :                     	; r11 - Bottom Y
(2)  328/ 6000678 :                     	; r12 - First DST point
(2)  329/ 6000678 :                     	; r13 - Last DST point
(2)  330/ 6000678 : 6213                		mov	r1,r2				; r2 - X left to process
(2)  331/ 600067A : 6313                		mov	r1,r3				; r3 - X right to process
(2)  332/ 600067C : B030                		bsr	set_left
(2)  333/ 600067E : 0009                		nop
(2)  334/ 6000680 : B072                		bsr	set_right
(2)  335/ 6000682 : 0009                		nop
(2)  336/ 6000684 :                     .next_pz:
(2)  337/ 6000684 : 902B                		mov	#SCREEN_HEIGHT,r0		; Current Y > 224?
(2)  338/ 6000686 : 3A07                		cmp/gt	r0,r10
(2)  339/ 6000688 : 8919                		bt	.exit
(2)  340/ 600068A : 3AB3                		cmp/ge	r11,r10				; Y top => Y bottom?
(2)  341/ 600068C : 8917                		bt	.exit
(2)  342/ 600068E : C603                		mov	@(marsGbl_PlyPzList_W,gbr),r0	; r1 - Current piece to WRITE
(2)  343/ 6000690 : 6103                		mov	r0,r1
(2)  344/ 6000692 : D010                		mov	#RAM_Mars_VdpDrwList_e,r0	; pointer reached end of the list?
(2)  345/ 6000694 : 3103                		cmp/ge	r0,r1
(2)  346/ 6000696 : 8B02                		bf	.dontreset
(2)  347/ 6000698 : D00F                		mov	#RAM_Mars_VdpDrwList,r0		; Return WRITE pointer to the top of the list
(2)  348/ 600069A : 6103                		mov	r0,r1
(2)  349/ 600069C : C203                		mov	r0,@(marsGbl_PlyPzList_W,gbr)
(2)  350/ 600069E :                     .dontreset:
(2)  351/ 600069E : E001                		mov	#1,r0
(2)  352/ 60006A0 : C133                		mov.w	r0,@(marsGbl_DrwPause,gbr)	; Tell watchdog we are mid-write
(2)  353/ 60006A2 : B0B2                		bsr	put_piece
(2)  354/ 60006A4 : 0009                		nop
(2)  355/ 60006A6 : E000                		mov	#0,r0
(2)  356/ 60006A8 : C133                		mov.w	r0,@(marsGbl_DrwPause,gbr)	; Unlock.
(2)  357/ 60006AA :                     
(2)  358/ 60006AA :                     	; X direction update
(2)  359/ 60006AA : 3897                		cmp/gt	r9,r8				; Left width > Right width?
(2)  360/ 60006AC : 8B03                		bf	.lefth2
(2)  361/ 60006AE : B05B                		bsr	set_right
(2)  362/ 60006B0 : 0009                		nop
(2)  363/ 60006B2 : AFE7                		bra	.next_pz
(2)  364/ 60006B4 : 0009                		nop
(2)  365/ 60006B6 :                     .lefth2:
(2)  366/ 60006B6 : B013                		bsr	set_left
(2)  367/ 60006B8 : 0009                		nop
(2)  368/ 60006BA : AFE3                		bra	.next_pz
(2)  369/ 60006BC : 0009                		nop
(2)  370/ 60006BE :                     .exit:
(2)  371/ 60006BE : 4F26                		lds	@r15+,pr
(2)  372/ 60006C0 : 000B                		rts
(2)  373/ 60006C2 : 0009                		nop
(2)  374/ 60006C4 :                     		align 4
(2)  375/ 60006C4 : C000 0540 C000 0530 		ltorg
                    C000 0550 7FFF FFFF 
                    0600 9F84 0600 7284 
                    00A0 00E0           
(2)  376/ 60006E0 :                     
(2)  377/ 60006E0 :                     ; --------------------------------
(2)  378/ 60006E0 :                     
(2)  379/ 60006E0 :                     set_left:
(2)  380/ 60006E0 : 6823                		mov	r2,r8			; Get a copy of Xleft pointer
(2)  381/ 60006E2 : 7820                		add	#$20,r8			; To read Texture SRC points
(2)  382/ 60006E4 : 6482                		mov	@r8,r4
(2)  383/ 60006E6 : 5581                		mov	@(4,r8),r5
(2)  384/ 60006E8 : D841                		mov	#Cach_DDA_Src_L,r8
(2)  385/ 60006EA : 6043                		mov	r4,r0
(2)  386/ 60006EC : 4028                		shll16	r0
(2)  387/ 60006EE : 2802                		mov	r0,@r8
(2)  388/ 60006F0 : 6053                		mov	r5,r0
(2)  389/ 60006F2 : 4028                		shll16	r0
(2)  390/ 60006F4 : 1802                		mov	r0,@(8,r8)
(2)  391/ 60006F6 : 6122                		mov	@r2,r1
(2)  392/ 60006F8 : 5821                		mov	@(4,r2),r8
(2)  393/ 60006FA : 7208                		add	#8,r2
(2)  394/ 60006FC : 32D7                		cmp/gt	r13,r2
(2)  395/ 60006FE : 8B00                		bf	.lft_ok
(2)  396/ 6000700 : 62C3                		mov 	r12,r2
(2)  397/ 6000702 :                     .lft_ok:
(2)  398/ 6000702 : 5021                		mov	@(4,r2),r0
(2)  399/ 6000704 : 3088                		sub	r8,r0
(2)  400/ 6000706 : 8800                		cmp/eq	#0,r0
(2)  401/ 6000708 : 89EA                		bt	set_left
(2)  402/ 600070A : 4011                		cmp/pz	r0
(2)  403/ 600070C : 8B29                		bf	.lft_skip
(2)  404/ 600070E :                     
(2)  405/ 600070E : 400A                		lds	r0,mach
(2)  406/ 6000710 : 6823                		mov	r2,r8
(2)  407/ 6000712 : 7820                		add	#$20,r8
(2)  408/ 6000714 : 6082                		mov 	@r8,r0
(2)  409/ 6000716 : 3048                		sub 	r4,r0
(2)  410/ 6000718 : 5481                		mov 	@(4,r8),r4
(2)  411/ 600071A : 3458                		sub 	r5,r4
(2)  412/ 600071C : 6503                		mov	r0,r5
(2)  413/ 600071E : 4418                		shll8	r4
(2)  414/ 6000720 : 4518                		shll8	r5
(2)  415/ 6000722 : 080A                		sts	mach,r8
(2)  416/ 6000724 : E001                		mov	#1,r0				; Tell WD we are using
(2)  417/ 6000726 : C136                		mov.w	r0,@(marsGbl_DivStop_M,gbr)	; HW Division
(2)  418/ 6000728 : 906E                		mov	#_JR,r0
(2)  419/ 600072A : 2082                		mov	r8,@r0
(2)  420/ 600072C : 1051                		mov	r5,@(4,r0)
(2)  421/ 600072E : 0009                		nop
(2)  422/ 6000730 : 5501                		mov	@(4,r0),r5
(2)  423/ 6000732 : 9069                		mov	#_JR,r0
(2)  424/ 6000734 : 2082                		mov	r8,@r0
(2)  425/ 6000736 : 1041                		mov	r4,@(4,r0)
(2)  426/ 6000738 : 0009                		nop
(2)  427/ 600073A : 5401                		mov	@(4,r0),r4
(2)  428/ 600073C : 4418                		shll8	r4
(2)  429/ 600073E : 4518                		shll8	r5
(2)  430/ 6000740 : D02C                		mov	#Cach_DDA_Src_L+$C,r0
(2)  431/ 6000742 : 2042                		mov	r4,@r0
(2)  432/ 6000744 : D02C                		mov	#Cach_DDA_Src_L+4,r0
(2)  433/ 6000746 : 2052                		mov	r5,@r0
(2)  434/ 6000748 : 6522                		mov	@r2,r5
(2)  435/ 600074A : 3518                		sub 	r1,r5
(2)  436/ 600074C : 6413                		mov 	r1,r4
(2)  437/ 600074E : 4518                		shll8	r5
(2)  438/ 6000750 : 4428                		shll16	r4
(2)  439/ 6000752 : 9059                		mov	#_JR,r0
(2)  440/ 6000754 : 2082                		mov	r8,@r0
(2)  441/ 6000756 : 1051                		mov	r5,@(4,r0)
(2)  442/ 6000758 : 0009                		nop
(2)  443/ 600075A : 5501                		mov	@(4,r0),r5
(2)  444/ 600075C : E000                		mov	#0,r0				; Unlock HW division
(2)  445/ 600075E : C136                		mov.w	r0,@(marsGbl_DivStop_M,gbr)
(2)  446/ 6000760 : 4518                		shll8	r5
(2)  447/ 6000762 :                     .lft_skip:
(2)  448/ 6000762 : 000B                		rts
(2)  449/ 6000764 : 0009                		nop
(2)  450/ 6000766 :                     		align 4
(2)  451/ 6000768 :                     
(2)  452/ 6000768 :                     ; --------------------------------
(2)  453/ 6000768 :                     
(2)  454/ 6000768 :                     set_right:
(2)  455/ 6000768 : 6933                		mov	r3,r9
(2)  456/ 600076A : 7920                		add	#$20,r9
(2)  457/ 600076C : 6692                		mov	@r9,r6
(2)  458/ 600076E : 5791                		mov	@(4,r9),r7
(2)  459/ 6000770 : D922                		mov	#Cach_DDA_Src_R,r9
(2)  460/ 6000772 : 6063                		mov	r6,r0
(2)  461/ 6000774 : 4028                		shll16	r0
(2)  462/ 6000776 : 2902                		mov	r0,@r9
(2)  463/ 6000778 : 6073                		mov	r7,r0
(2)  464/ 600077A : 4028                		shll16	r0
(2)  465/ 600077C : 1902                		mov	r0,@(8,r9)
(2)  466/ 600077E :                     
(2)  467/ 600077E : 6132                		mov	@r3,r1
(2)  468/ 6000780 : 5931                		mov	@(4,r3),r9
(2)  469/ 6000782 : 73F8                		add	#-8,r3
(2)  470/ 6000784 : 33C3                		cmp/ge	r12,r3
(2)  471/ 6000786 : 8900                		bt	.rgt_ok
(2)  472/ 6000788 : 63D3                		mov 	r13,r3
(2)  473/ 600078A :                     .rgt_ok:
(2)  474/ 600078A : 5031                		mov	@(4,r3),r0
(2)  475/ 600078C : 3098                		sub	r9,r0
(2)  476/ 600078E : 8800                		cmp/eq	#0,r0
(2)  477/ 6000790 : 89EA                		bt	set_right
(2)  478/ 6000792 : 4011                		cmp/pz	r0
(2)  479/ 6000794 : 8B29                		bf	.rgt_skip
(2)  480/ 6000796 : 400A                		lds	r0,mach
(2)  481/ 6000798 : 6933                		mov	r3,r9
(2)  482/ 600079A : 7920                		add	#$20,r9
(2)  483/ 600079C : 6092                		mov 	@r9,r0
(2)  484/ 600079E : 3068                		sub 	r6,r0
(2)  485/ 60007A0 : 5691                		mov 	@(4,r9),r6
(2)  486/ 60007A2 : 3678                		sub 	r7,r6
(2)  487/ 60007A4 : 6703                		mov	r0,r7
(2)  488/ 60007A6 : 4618                		shll8	r6
(2)  489/ 60007A8 : 4718                		shll8	r7
(2)  490/ 60007AA : 090A                		sts	mach,r9
(2)  491/ 60007AC : E001                		mov	#1,r0				; Tell WD we are using
(2)  492/ 60007AE : C136                		mov.w	r0,@(marsGbl_DivStop_M,gbr)	; HW Division
(2)  493/ 60007B0 : 902A                		mov	#_JR,r0
(2)  494/ 60007B2 : 2092                		mov	r9,@r0
(2)  495/ 60007B4 : 1071                		mov	r7,@(4,r0)
(2)  496/ 60007B6 : 0009                		nop
(2)  497/ 60007B8 : 5701                		mov	@(4,r0),r7
(2)  498/ 60007BA : 9025                		mov	#_JR,r0
(2)  499/ 60007BC : 2092                		mov	r9,@r0
(2)  500/ 60007BE : 1061                		mov	r6,@(4,r0)
(2)  501/ 60007C0 : 0009                		nop
(2)  502/ 60007C2 : 5601                		mov	@(4,r0),r6
(2)  503/ 60007C4 : 4618                		shll8	r6
(2)  504/ 60007C6 : 4718                		shll8	r7
(2)  505/ 60007C8 : D00D                		mov	#Cach_DDA_Src_R+4,r0
(2)  506/ 60007CA : 2072                		mov	r7,@r0
(2)  507/ 60007CC : D00D                		mov	#Cach_DDA_Src_R+$C,r0
(2)  508/ 60007CE : 2062                		mov	r6,@r0
(2)  509/ 60007D0 : 6732                		mov	@r3,r7
(2)  510/ 60007D2 : 3718                		sub 	r1,r7
(2)  511/ 60007D4 : 6613                		mov 	r1,r6
(2)  512/ 60007D6 : 4628                		shll16	r6
(2)  513/ 60007D8 : 4718                		shll8	r7
(2)  514/ 60007DA : 9015                		mov	#_JR,r0
(2)  515/ 60007DC : 2092                		mov	r9,@r0
(2)  516/ 60007DE : 1071                		mov	r7,@(4,r0)
(2)  517/ 60007E0 : 0009                		nop
(2)  518/ 60007E2 : 5701                		mov	@(4,r0),r7
(2)  519/ 60007E4 : E000                		mov	#0,r0				; Unlock HW division
(2)  520/ 60007E6 : C136                		mov.w	r0,@(marsGbl_DivStop_M,gbr)
(2)  521/ 60007E8 : 4718                		shll8	r7
(2)  522/ 60007EA :                     .rgt_skip:
(2)  523/ 60007EA : 000B                		rts
(2)  524/ 60007EC : 0009                		nop
(2)  525/ 60007EE :                     		align 4
(2)  526/ 60007F0 : C000 0570 C000 057C 		ltorg
                    C000 0574 C000 0580 
                    C000 0584 C000 058C 
                    FF00                
(2)  527/ 600080A :                     
(2)  528/ 600080A :                     ; --------------------------------
(2)  529/ 600080A :                     ; Mark piece
(2)  530/ 600080A :                     ; --------------------------------
(2)  531/ 600080A :                     
(2)  532/ 600080A :                     put_piece:
(2)  533/ 600080A : 5821                		mov	@(4,r2),r8
(2)  534/ 600080C : 5931                		mov	@(4,r3),r9
(2)  535/ 600080E : 38A8                		sub	r10,r8
(2)  536/ 6000810 : 39A8                		sub	r10,r9
(2)  537/ 6000812 : 6083                		mov	r8,r0
(2)  538/ 6000814 : 3987                		cmp/gt	r8,r9
(2)  539/ 6000816 : 8900                		bt	.lefth
(2)  540/ 6000818 : 6093                		mov	r9,r0
(2)  541/ 600081A :                     .lefth:
(2)  542/ 600081A : 2F26                		mov	r2,@-r15
(2)  543/ 600081C : 2F36                		mov	r3,@-r15
(2)  544/ 600081E : 2F56                		mov	r5,@-r15
(2)  545/ 6000820 : 2F76                		mov	r7,@-r15
(2)  546/ 6000822 : 2F86                		mov	r8,@-r15
(2)  547/ 6000824 : 2F96                		mov	r9,@-r15
(2)  548/ 6000826 : 1141                		mov 	r4,@(plypz_xl,r1)
(2)  549/ 6000828 : 1152                		mov 	r5,@(plypz_xl_dx,r1)
(2)  550/ 600082A : 1163                		mov 	r6,@(plypz_xr,r1)
(2)  551/ 600082C : 1174                		mov 	r7,@(plypz_xr_dx,r1)
(2)  552/ 600082E : 350D                		dmuls	r0,r5
(2)  553/ 6000830 : 021A                		sts	macl,r2
(2)  554/ 6000832 : 370D                		dmuls	r0,r7
(2)  555/ 6000834 : 031A                		sts	macl,r3
(2)  556/ 6000836 : 342C                		add 	r2,r4
(2)  557/ 6000838 : 363C                		add	r3,r6
(2)  558/ 600083A : 62A3                		mov	r10,r2
(2)  559/ 600083C : 3A0C                		add	r0,r10
(2)  560/ 600083E : 63A3                		mov	r10,r3
(2)  561/ 6000840 : 4228                		shll16	r2
(2)  562/ 6000842 : 232B                		or	r2,r3
(2)  563/ 6000844 : 1130                		mov	r3,@(plypz_ypos,r1)
(2)  564/ 6000846 : 2F36                		mov	r3,@-r15
(2)  565/ 6000848 : D220                		mov	#Cach_DDA_Src_L,r2
(2)  566/ 600084A : 6522                		mov	@r2,r5
(2)  567/ 600084C : 1155                		mov	r5,@(plypz_src_xl,r1)
(2)  568/ 600084E : 5721                		mov	@(4,r2),r7
(2)  569/ 6000850 : 1176                		mov	r7,@(plypz_src_xl_dx,r1)
(2)  570/ 6000852 : 5822                		mov	@(8,r2),r8
(2)  571/ 6000854 : 1187                		mov	r8,@(plypz_src_yl,r1)
(2)  572/ 6000856 : 5923                		mov	@($C,r2),r9
(2)  573/ 6000858 : 1198                		mov	r9,@(plypz_src_yl_dx,r1)
(2)  574/ 600085A : 370D                		dmuls	r0,r7
(2)  575/ 600085C : 021A                		sts	macl,r2
(2)  576/ 600085E : 390D                		dmuls	r0,r9
(2)  577/ 6000860 : 031A                		sts	macl,r3
(2)  578/ 6000862 : 352C                		add 	r2,r5
(2)  579/ 6000864 : 383C                		add	r3,r8
(2)  580/ 6000866 : D21A                		mov	#Cach_DDA_Src_L,r2
(2)  581/ 6000868 : 2252                		mov	r5,@r2
(2)  582/ 600086A : 1282                		mov	r8,@(8,r2)
(2)  583/ 600086C : D219                		mov	#Cach_DDA_Src_R,r2
(2)  584/ 600086E : 6522                		mov	@r2,r5
(2)  585/ 6000870 : 1159                		mov	r5,@(plypz_src_xr,r1)
(2)  586/ 6000872 : 5721                		mov	@(4,r2),r7
(2)  587/ 6000874 : 117A                		mov	r7,@(plypz_src_xr_dx,r1)
(2)  588/ 6000876 : 5822                		mov	@(8,r2),r8
(2)  589/ 6000878 : 118B                		mov	r8,@(plypz_src_yr,r1)
(2)  590/ 600087A : 5923                		mov	@($C,r2),r9
(2)  591/ 600087C : 119C                		mov	r9,@(plypz_src_yr_dx,r1)
(2)  592/ 600087E : 370D                		dmuls	r0,r7
(2)  593/ 6000880 : 021A                		sts	macl,r2
(2)  594/ 6000882 : 390D                		dmuls	r0,r9
(2)  595/ 6000884 : 031A                		sts	macl,r3
(2)  596/ 6000886 : 352C                		add 	r2,r5
(2)  597/ 6000888 : 383C                		add	r3,r8
(2)  598/ 600088A : D213                		mov	#Cach_DDA_Src_R,r2
(2)  599/ 600088C : 2252                		mov	r5,@r2
(2)  600/ 600088E : 1282                		mov	r8,@(8,r2)
(2)  601/ 6000890 : 63F6                		mov	@r15+,r3
(2)  602/ 6000892 : 4315                		cmp/pl	r3			; TOP check, 2 steps
(2)  603/ 6000894 : 8902                		bt	.top_neg
(2)  604/ 6000896 : 4328                		shll16	r3
(2)  605/ 6000898 : 4315                		cmp/pl	r3
(2)  606/ 600089A : 8B0E                		bf	.bad_piece
(2)  607/ 600089C :                     .top_neg:
(2)  608/ 600089C : 50E1                		mov	@(polygn_mtrl,r14),r0
(2)  609/ 600089E : 110D                		mov 	r0,@(plypz_mtrl,r1)
(2)  610/ 60008A0 : 50E0                		mov	@(polygn_type,r14),r0
(2)  611/ 60008A2 : 110E                		mov 	r0,@(plypz_type,r1)
(2)  612/ 60008A4 : 713C                		add	#sizeof_plypz,r1
(2)  613/ 60008A6 : 6013                		mov	r1,r0
(2)  614/ 60008A8 : D80C                		mov	#RAM_Mars_VdpDrwList_e,r8
(2)  615/ 60008AA : 3083                		cmp/ge	r8,r0
(2)  616/ 60008AC : 8B01                		bf	.dontreset_pz
(2)  617/ 60008AE : D00C                		mov	#RAM_Mars_VdpDrwList,r0
(2)  618/ 60008B0 : 6103                		mov	r0,r1
(2)  619/ 60008B2 :                     .dontreset_pz:
(2)  620/ 60008B2 : C203                		mov	r0,@(marsGbl_PlyPzList_W,gbr)
(2)  621/ 60008B4 : C531                		mov.w	@(marsGbl_PzListCntr,gbr),r0
(2)  622/ 60008B6 : 7001                		add	#1,r0
(2)  623/ 60008B8 : C131                		mov.w	r0,@(marsGbl_PzListCntr,gbr)
(2)  624/ 60008BA :                     .bad_piece:
(2)  625/ 60008BA : 69F6                		mov	@r15+,r9
(2)  626/ 60008BC : 68F6                		mov	@r15+,r8
(2)  627/ 60008BE : 67F6                		mov	@r15+,r7
(2)  628/ 60008C0 : 65F6                		mov	@r15+,r5
(2)  629/ 60008C2 : 63F6                		mov	@r15+,r3
(2)  630/ 60008C4 : 62F6                		mov	@r15+,r2
(2)  631/ 60008C6 : 000B                		rts
(2)  632/ 60008C8 : 0009                		nop
(2)  633/ 60008CA :                     		align 4
(2)  634/ 60008CC : C000 0570 C000 0570 		ltorg
                    C000 0580 C000 0580 
                    0600 9F84 0600 7284 
(2)  635/ 60008E4 :                     
(2)  636/ 60008E4 :                     ; ; ------------------------------------------------
(2)  637/ 60008E4 :                     ; ; Refill screen.
(2)  638/ 60008E4 :                     ; ; ------------------------------------------------
(2)  639/ 60008E4 :                     ;
(2)  640/ 60008E4 :                     ; MarsVideo_Refill:
(2)  641/ 60008E4 :                     ; 		mov	r2,@-r15
(2)  642/ 60008E4 :                     ; 		mov	r3,@-r15
(2)  643/ 60008E4 :                     ; 		mov	r4,@-r15
(2)  644/ 60008E4 :                     ; 		mov	r5,@-r15
(2)  645/ 60008E4 :                     ; 		mov	r6,@-r15
(2)  646/ 60008E4 :                     ; 		sts	macl,@-r15
(2)  647/ 60008E4 :                     ; ; 		mov	#_vdpreg,r1
(2)  648/ 60008E4 :                     ; ; .wait_fb:	mov.w   @($A,r1),r0		; Framebuffer free?
(2)  649/ 60008E4 :                     ; ; 		tst     #2,r0
(2)  650/ 60008E4 :                     ; ; 		bf      .wait_fb
(2)  651/ 60008E4 :                     ; ;
(2)  652/ 60008E4 :                     ; ; 		mov	.tag_Cach_Redraw,r1
(2)  653/ 60008E4 :                     ; ; 		mov 	@r1,r0
(2)  654/ 60008E4 :                     ; ; 		cmp/eq	#0,r0
(2)  655/ 60008E4 :                     ; ; 		bt	.g_exitthis
(2)  656/ 60008E4 :                     ; ; 		mov	@(marsGbl_Bg_Xinc,gbr),r0
(2)  657/ 60008E4 :                     ; ; ; 		shlr8	r0
(2)  658/ 60008E4 :                     ; ; 		shll2	r0
(2)  659/ 60008E4 :                     ; ; 		mov	r0,r6
(2)  660/ 60008E4 :                     ; ; 		mov.w	@(marsGbl_BgWidth,gbr),r0
(2)  661/ 60008E4 :                     ; ; 		mov	r0,r2
(2)  662/ 60008E4 :                     ; ; 		mov	.tag_Cach_CurrY,r0
(2)  663/ 60008E4 :                     ; ; 		mov	@r0,r0
(2)  664/ 60008E4 :                     ; ; 		shlr8	r0
(2)  665/ 60008E4 :                     ; ; 		exts.w	r0,r0
(2)  666/ 60008E4 :                     ; ; 		muls	r0,r2
(2)  667/ 60008E4 :                     ; ; 		sts	macl,r5
(2)  668/ 60008E4 :                     ; ; 		mov	@(marsGbl_BgData_R,gbr),r0
(2)  669/ 60008E4 :                     ; ; 		add	r5,r0
(2)  670/ 60008E4 :                     ; ;
(2)  671/ 60008E4 :                     ; ; 		mov	r0,r5
(2)  672/ 60008E4 :                     ; ; 		mov	r0,r4
(2)  673/ 60008E4 :                     ; ; 		mov	r0,r3
(2)  674/ 60008E4 :                     ; ; 		add	r2,r3
(2)  675/ 60008E4 :                     ; ; 		mov	#-4,r1
(2)  676/ 60008E4 :                     ; ; 		mov	.tag_Cach_XHead,r0
(2)  677/ 60008E4 :                     ; ; 		mov	@r0,r0
(2)  678/ 60008E4 :                     ; ; 		and	r1,r0
(2)  679/ 60008E4 :                     ; ; 		and	r1,r5
(2)  680/ 60008E4 :                     ; ; 		and	r1,r4
(2)  681/ 60008E4 :                     ; ; 		and	r1,r3
(2)  682/ 60008E4 :                     ; ; 		add	r0,r5
(2)  683/ 60008E4 :                     ; ; ; 		shll8	r5
(2)  684/ 60008E4 :                     ; ; ; 		shll8	r4
(2)  685/ 60008E4 :                     ; ; ; 		shll8	r3
(2)  686/ 60008E4 :                     ; ; ; 		mov	.tag_CS1,r1
(2)  687/ 60008E4 :                     ; ; 		mov	@(marsGbl_BgFbPos_R,gbr),r0
(2)  688/ 60008E4 :                     ; ; 		bra	.blast_me
(2)  689/ 60008E4 :                     ; ; 		mov	r0,r2
(2)  690/ 60008E4 :                     ; ; .g_exitthis:
(2)  691/ 60008E4 :                     ; ; 		bra	.exitthis
(2)  692/ 60008E4 :                     ; ; 		nop
(2)  693/ 60008E4 :                     ; ; 		align 4
(2)  694/ 60008E4 :                     ; ; .tag_Cach_CurrY	dc.l Cach_CurrY
(2)  695/ 60008E4 :                     ; ; .tag_Cach_XHead	dc.l Cach_XHead
(2)  696/ 60008E4 :                     ; ; .tag_CS1	dc.l CS1
(2)  697/ 60008E4 :                     ; ; .tag_Cach_Redraw
(2)  698/ 60008E4 :                     ; ; 		dc.l Cach_Redraw
(2)  699/ 60008E4 :                     ; ;
(2)  700/ 60008E4 :                     ; ; ; Blast ALL the pixels.
(2)  701/ 60008E4 :                     ; ; .blast_me:
(2)  702/ 60008E4 :                     ; ;
(2)  703/ 60008E4 :                     ; ; ; 	NORMAL
(2)  704/ 60008E4 :                     ; ; 	rept 16*5
(2)  705/ 60008E4 :                     ; ; 		cmp/ge	r3,r5
(2)  706/ 60008E4 :                     ; ; 		bf	.lel2r
(2)  707/ 60008E4 :                     ; ; 		mov	r4,r5
(2)  708/ 60008E4 :                     ; ; .lel2r:
(2)  709/ 60008E4 :                     ; ; 		mov	@r5+,r0
(2)  710/ 60008E4 :                     ; ; 		mov	r0,@r2
(2)  711/ 60008E4 :                     ; ; 		add	#4,r2
(2)  712/ 60008E4 :                     ; ; 	endm
(2)  713/ 60008E4 :                     ; ; 	rept 2
(2)  714/ 60008E4 :                     ; ; 		cmp/ge	r3,r5		; last 4 bytes
(2)  715/ 60008E4 :                     ; ; 		bf	.lel2r
(2)  716/ 60008E4 :                     ; ; 		mov	r4,r5
(2)  717/ 60008E4 :                     ; ; .lel2r:
(2)  718/ 60008E4 :                     ; ; 		mov	@r5+,r0
(2)  719/ 60008E4 :                     ; ; 		mov	r0,@r2
(2)  720/ 60008E4 :                     ; ; 		add	#4,r2
(2)  721/ 60008E4 :                     ; ; 	endm
(2)  722/ 60008E4 :                     ; ;
(2)  723/ 60008E4 :                     ; ; ; 	SCALED
(2)  724/ 60008E4 :                     ; ; ; 	rept 16*5
(2)  725/ 60008E4 :                     ; ; ; 		cmp/ge	r3,r5
(2)  726/ 60008E4 :                     ; ; ; 		bf	.lel2r
(2)  727/ 60008E4 :                     ; ; ; 		mov	r4,r5
(2)  728/ 60008E4 :                     ; ; ; .lel2r:
(2)  729/ 60008E4 :                     ; ; ; 		mov	r5,r0
(2)  730/ 60008E4 :                     ; ; ; 		shlr8	r0
(2)  731/ 60008E4 :                     ; ; ; 		or	r1,r0
(2)  732/ 60008E4 :                     ; ; ; 		mov	@r0,r0
(2)  733/ 60008E4 :                     ; ; ; 		mov	r0,@r2
(2)  734/ 60008E4 :                     ; ; ; 		add	#4,r2
(2)  735/ 60008E4 :                     ; ; ; 		add	r6,r5
(2)  736/ 60008E4 :                     ; ; ; 	endm
(2)  737/ 60008E4 :                     ; ; ; 		cmp/ge	r3,r5
(2)  738/ 60008E4 :                     ; ; ; 		bf	.lel3r
(2)  739/ 60008E4 :                     ; ; ; 		mov	r4,r5
(2)  740/ 60008E4 :                     ; ; ; .lel3r:
(2)  741/ 60008E4 :                     ; ; ; 		mov	r5,r0
(2)  742/ 60008E4 :                     ; ; ; 		shlr8	r0
(2)  743/ 60008E4 :                     ; ; ; 		or	r1,r0
(2)  744/ 60008E4 :                     ; ; ; 		mov	@r0,r0
(2)  745/ 60008E4 :                     ; ; ; 		mov	r0,@r2
(2)  746/ 60008E4 :                     ; ; ; 		add	#4,r2
(2)  747/ 60008E4 :                     ; ; ; 		add	r6,r5
(2)  748/ 60008E4 :                     ; ;
(2)  749/ 60008E4 :                     ; ; 	; Next Y
(2)  750/ 60008E4 :                     ; ; 		mov	#Cach_CurrY,r1
(2)  751/ 60008E4 :                     ; ; 		mov	@(marsGbl_BgData,gbr),r0
(2)  752/ 60008E4 :                     ; ; 		mov	r0,r2
(2)  753/ 60008E4 :                     ; ; 		mov.w	@(marsGbl_BgHeight,gbr),r0
(2)  754/ 60008E4 :                     ; ; 		mov	r0,r3
(2)  755/ 60008E4 :                     ; ; 		shll8	r3
(2)  756/ 60008E4 :                     ; ; 		mov	@(marsGbl_Bg_Yinc,gbr),r0
(2)  757/ 60008E4 :                     ; ; 		mov	r0,r4
(2)  758/ 60008E4 :                     ; ; 		mov	@(marsGbl_BgData_R,gbr),r0
(2)  759/ 60008E4 :                     ; ; 		mov	r0,r5
(2)  760/ 60008E4 :                     ; ; 		mov.w	@(marsGbl_BgWidth,gbr),r0
(2)  761/ 60008E4 :                     ; ; 		add	r0,r5
(2)  762/ 60008E4 :                     ; ; 		mov	@r1,r0
(2)  763/ 60008E4 :                     ; ; 		add	r4,r0
(2)  764/ 60008E4 :                     ; ; 		cmp/ge	r3,r0
(2)  765/ 60008E4 :                     ; ; 		bf	.lel2
(2)  766/ 60008E4 :                     ; ; 		xor	r0,r0
(2)  767/ 60008E4 :                     ; ; .lel2:
(2)  768/ 60008E4 :                     ; ; 		mov	r0,@r1
(2)  769/ 60008E4 :                     ; ; 		mov	@(marsGbl_BgFbPos_R,gbr),r0
(2)  770/ 60008E4 :                     ; ; 		mov	#$200,r5
(2)  771/ 60008E4 :                     ; ; 		add	r5,r0
(2)  772/ 60008E4 :                     ; ; 		mov	r0,@(marsGbl_BgFbPos_R,gbr)
(2)  773/ 60008E4 :                     ;
(2)  774/ 60008E4 :                     ; ; .exitthis:
(2)  775/ 60008E4 :                     ; 		mov.l   #$FFFFFE80,r1
(2)  776/ 60008E4 :                     ; 		mov.w   #$A518,r0		; OFF
(2)  777/ 60008E4 :                     ; 		mov.w   r0,@r1
(2)  778/ 60008E4 :                     ; 		or      #$20,r0			; ON
(2)  779/ 60008E4 :                     ; 		mov.w   r0,@r1
(2)  780/ 60008E4 :                     ; 		mov.w   #$5A10,r0		; Timer before next watchdog
(2)  781/ 60008E4 :                     ; 		mov.w   r0,@r1
(2)  782/ 60008E4 :                     ; 		mov	#Cach_ClrLines,r1	; Decrement a line to progress
(2)  783/ 60008E4 :                     ; 		mov	@r1,r0
(2)  784/ 60008E4 :                     ; 		dt	r0
(2)  785/ 60008E4 :                     ; 		bf/s	.on_clr
(2)  786/ 60008E4 :                     ; 		mov	r0,@r1
(2)  787/ 60008E4 :                     ;
(2)  788/ 60008E4 :                     ; 		mov	#Cach_Redraw,r1
(2)  789/ 60008E4 :                     ; 		mov	@r1,r0
(2)  790/ 60008E4 :                     ; 		cmp/eq	#0,r0
(2)  791/ 60008E4 :                     ; 		bt	.iszero
(2)  792/ 60008E4 :                     ; 		add	#-1,r0
(2)  793/ 60008E4 :                     ; 		mov	r0,@r1
(2)  794/ 60008E4 :                     ; .iszero:
(2)  795/ 60008E4 :                     ; 		mov	#2,r0			; If finished: Set task $02
(2)  796/ 60008E4 :                     ; 		mov.w	r0,@(marsGbl_DrwTask,gbr)
(2)  797/ 60008E4 :                     ; .on_clr:
(2)  798/ 60008E4 :                     ;
(2)  799/ 60008E4 :                     ; 		lds	@r15+,macl
(2)  800/ 60008E4 :                     ; 		mov	@r15+,r6
(2)  801/ 60008E4 :                     ; 		mov	@r15+,r5
(2)  802/ 60008E4 :                     ; 		mov	@r15+,r4
(2)  803/ 60008E4 :                     ; 		mov	@r15+,r3
(2)  804/ 60008E4 :                     ; 		mov	@r15+,r2
(2)  805/ 60008E4 :                     ; 		rts
(2)  806/ 60008E4 :                     ; 		nop
(2)  807/ 60008E4 :                     ; 		ltorg
(2)  808/ 60008E4 :                     ; 		align 4
(2)  809/ 60008E4 :                     
(2)  810/ 60008E4 :                     ; ------------------------------------
(2)  811/ 60008E4 :                     ; MarsVideo_ClearFrame
(2)  812/ 60008E4 :                     ;
(2)  813/ 60008E4 :                     ; Clear the current framebuffer
(2)  814/ 60008E4 :                     ; ------------------------------------
(2)  815/ 60008E4 :                     
(2)  816/ 60008E4 :                     MarsVideo_ClearFrame:
(2)  817/ 60008E4 : D12A                		mov	#_vdpreg,r1
(2)  818/ 60008E6 : 8515                .wait2		mov.w	@(10,r1),r0		; Wait for FEN to clear
(2)  819/ 60008E8 : C902                		and	#%10,r0
(2)  820/ 60008EA : 8802                		cmp/eq	#2,r0
(2)  821/ 60008EC : 89FB                		bt	.wait2
(2)  822/ 60008EE :                     
(2)  823/ 60008EE : 9255                		mov	#255,r2			; r2 - lenght: 256 words per pass
(2)  824/ 60008F0 : 9355                		mov	#$200/2,r3		; r3 - Start address / 2
(2)  825/ 60008F2 : E400                		mov	#0,r4			; r4 - data (zero)
(2)  826/ 60008F4 : 9553                		mov	#256,r5			; Increment address by 256
(2)  827/ 60008F6 : 9653                		mov	#((512*240)/256)/2,r6	; 140 passes
(2)  828/ 60008F8 :                     .loop
(2)  829/ 60008F8 : 6023                		mov	r2,r0
(2)  830/ 60008FA : 8112                		mov.w	r0,@(4,r1)		; Set length
(2)  831/ 60008FC : 6033                		mov	r3,r0
(2)  832/ 60008FE : 8113                		mov.w	r0,@(6,r1)		; Set address
(2)  833/ 6000900 : 6043                		mov	r4,r0
(2)  834/ 6000902 : 8114                		mov.w	r0,@(8,r1)		; Set data
(2)  835/ 6000904 : 335C                		add	r5,r3
(2)  836/ 6000906 :                     
(2)  837/ 6000906 : 8515                .wait		mov.w	@(10,r1),r0		; Wait for FEN to clear
(2)  838/ 6000908 : C902                		and	#%10,r0
(2)  839/ 600090A : 8802                		cmp/eq	#2,r0
(2)  840/ 600090C : 89FB                		bt	.wait
(2)  841/ 600090E : 4610                		dt	r6
(2)  842/ 6000910 : 8BF2                		bf	.loop
(2)  843/ 6000912 : 000B                		rts
(2)  844/ 6000914 : 0009                		nop
(2)  845/ 6000916 :                     		align 4
(2)  846/ 6000918 :                     
(2)  847/ 6000918 :                     ; ------------------------------------
(2)  848/ 6000918 :                     ; MarsVideo_FrameSwap
(2)  849/ 6000918 :                     ; ------------------------------------
(2)  850/ 6000918 :                     
(2)  851/ 6000918 :                     ; MarsVideo_FrameSwap:
(2)  852/ 6000918 :                     ; 		mov.l	#_vdpreg,r2
(2)  853/ 6000918 :                     ; .wait_fb:
(2)  854/ 6000918 :                     ; 		mov.w	@($A,r2),r0
(2)  855/ 6000918 :                     ; 		tst	#2,r0
(2)  856/ 6000918 :                     ; 		bf	.wait_fb
(2)  857/ 6000918 :                     ; 		mov.w	@($A,r2),r0
(2)  858/ 6000918 :                     ; 		xor	#1,r0
(2)  859/ 6000918 :                     ; 		mov.w	r0,@($A,r2)
(2)  860/ 6000918 :                     ; 		and	#1,r0
(2)  861/ 6000918 :                     ; 		mov	r0,r1
(2)  862/ 6000918 :                     ; .wait_result:
(2)  863/ 6000918 :                     ; 		mov.w	@($A,r2),r0
(2)  864/ 6000918 :                     ; 		and	#1,r0
(2)  865/ 6000918 :                     ; 		cmp/eq	r0,r1
(2)  866/ 6000918 :                     ; 		bf	.wait_result
(2)  867/ 6000918 :                     ; 		rts
(2)  868/ 6000918 :                     ; 		nop
(2)  869/ 6000918 :                     ; 		align 4
(2)  870/ 6000918 :                     
(2)  871/ 6000918 :                     ; ------------------------------------
(2)  872/ 6000918 :                     ; MarsVdp_LoadPal
(2)  873/ 6000918 :                     ;
(2)  874/ 6000918 :                     ; Load palette to RAM
(2)  875/ 6000918 :                     ; then the Palette will be transfered
(2)  876/ 6000918 :                     ; on VBlank
(2)  877/ 6000918 :                     ;
(2)  878/ 6000918 :                     ; Input:
(2)  879/ 6000918 :                     ; r1 - Palette data
(2)  880/ 6000918 :                     ; r2 - Start index
(2)  881/ 6000918 :                     ; r3 - Number of colors
(2)  882/ 6000918 :                     ; r4 - OR value ($0000 or $8000)
(2)  883/ 6000918 :                     ;
(2)  884/ 6000918 :                     ; Uses:
(2)  885/ 6000918 :                     ; r0,r4-r6
(2)  886/ 6000918 :                     ; ------------------------------------
(2)  887/ 6000918 :                     
(2)  888/ 6000918 :                     ; MarsVideo_TempDraw:
(2)  889/ 6000918 :                     ; 		mov	#RAM_Mars_Background,r0
(2)  890/ 6000918 :                     ; 		mov	r0,@(marsGbl_BgData,gbr)
(2)  891/ 6000918 :                     ;
(2)  892/ 6000918 :                     ; 		mov	#RAM_Mars_Background,r2
(2)  893/ 6000918 :                     ; 		mov	#(336*232)/4,r3
(2)  894/ 6000918 :                     ; .wvm2:
(2)  895/ 6000918 :                     ; 		mov.l	@r1+,r0
(2)  896/ 6000918 :                     ; 		mov.l	r0,@r2
(2)  897/ 6000918 :                     ; 		add	#4,r2
(2)  898/ 6000918 :                     ; 		dt	r3
(2)  899/ 6000918 :                     ; 		bf	.wvm2
(2)  900/ 6000918 :                     ; 		rts
(2)  901/ 6000918 :                     ; 		nop
(2)  902/ 6000918 :                     ; 		align 4
(2)  903/ 6000918 :                     
(2)  904/ 6000918 :                     ; TODO: improve this
(2)  905/ 6000918 :                     MarsVideo_DrawAllBg:
(2)  906/ 6000918 :                     
(2)  907/ 6000918 :                     
(2)  908/ 6000918 :                     ; 		mov	#_vdpreg,r1
(2)  909/ 6000918 :                     ; .wait_fb:	mov.w   @($A,r1),r0		; Framebuffer free?
(2)  910/ 6000918 :                     ; 		tst     #2,r0
(2)  911/ 6000918 :                     ; 		bf      .wait_fb
(2)  912/ 6000918 : E4FE                		mov	#-2,r4
(2)  913/ 600091A : C600                		mov	@(marsGbl_BgData,gbr),r0
(2)  914/ 600091C : 6803                		mov	r0,r8
(2)  915/ 600091E : 6903                		mov	r0,r9
(2)  916/ 6000920 : C51D                		mov.w	@(marsGbl_BgHeight,gbr),r0
(2)  917/ 6000922 : 6103                		mov	r0,r1
(2)  918/ 6000924 : C51C                		mov.w	@(marsGbl_BgWidth,gbr),r0
(2)  919/ 6000926 : 201E                		mulu	r1,r0
(2)  920/ 6000928 : 001A                		sts	macl,r0
(2)  921/ 600092A : 390C                		add	r0,r9
(2)  922/ 600092C :                     
(2)  923/ 600092C : C600                		mov	@(marsGbl_BgData,gbr),r0
(2)  924/ 600092E : 6103                		mov	r0,r1			; r1 - read
(2)  925/ 6000930 : 6203                		mov	r0,r2			; r2 - start
(2)  926/ 6000932 : 6303                		mov	r0,r3			; r3 - end
(2)  927/ 6000934 : C51C                		mov.w	@(marsGbl_BgWidth,gbr),r0
(2)  928/ 6000936 : 330C                		add	r0,r3
(2)  929/ 6000938 : D516                		mov	#_framebuffer+$200,r5
(2)  930/ 600093A : 9730                		mov	#MSCRL_HEIGHT,r7
(2)  931/ 600093C :                     
(2)  932/ 600093C :                     	; ex line
(2)  933/ 600093C :                     ; 		mov	#RAM_Mars_Line0_Data,r8
(2)  934/ 600093C :                     ; 		mov	#320/4,r6
(2)  935/ 600093C :                     ; 		mov	r2,r1
(2)  936/ 600093C :                     ; .y_ex:
(2)  937/ 600093C :                     ; 		cmp/ge	r3,r1
(2)  938/ 600093C :                     ; 		bf	.nolm_e
(2)  939/ 600093C :                     ; 		mov	r2,r1
(2)  940/ 600093C :                     ; .nolm_e:
(2)  941/ 600093C :                     ; 		mov	@r1+,r0
(2)  942/ 600093C :                     ; 		mov	r0,@r8
(2)  943/ 600093C :                     ; 		add	#4,r8
(2)  944/ 600093C :                     ; 		dt	r6
(2)  945/ 600093C :                     ; 		bf	.y_ex
(2)  946/ 600093C :                     ; ; 		mov	#2,r0
(2)  947/ 600093C :                     ; ; 		mov.w	r0,@(marsGbl_Bg_DrwLine0,gbr)
(2)  948/ 600093C :                     ; 		mov	r2,r1
(2)  949/ 600093C :                     
(2)  950/ 600093C :                     .y_next:
(2)  951/ 600093C : 6453                		mov	r5,r4
(2)  952/ 600093E : E654                		mov	#(MSCRL_WIDTH)/4,r6
(2)  953/ 6000940 :                     .x_next:
(2)  954/ 6000940 : 3133                		cmp/ge	r3,r1
(2)  955/ 6000942 : 8B00                		bf	.nolm
(2)  956/ 6000944 : 6123                		mov	r2,r1
(2)  957/ 6000946 :                     .nolm:
(2)  958/ 6000946 : 6016                		mov	@r1+,r0
(2)  959/ 6000948 : 2402                		mov	r0,@r4
(2)  960/ 600094A : 7404                		add	#4,r4
(2)  961/ 600094C : 4610                		dt	r6
(2)  962/ 600094E : 8BF7                		bf	.x_next
(2)  963/ 6000950 : 9027                		mov	#MSCRL_WIDTH,r0
(2)  964/ 6000952 : 350C                		add	r0,r5
(2)  965/ 6000954 : C51C                		mov.w	@(marsGbl_BgWidth,gbr),r0
(2)  966/ 6000956 : 320C                		add	r0,r2
(2)  967/ 6000958 : 330C                		add	r0,r3
(2)  968/ 600095A : 3293                		cmp/ge	r9,r2
(2)  969/ 600095C : 8B02                		bf	.ylrge
(2)  970/ 600095E : 6283                		mov	r8,r2
(2)  971/ 6000960 : 6383                		mov	r8,r3
(2)  972/ 6000962 : 330C                		add	r0,r3
(2)  973/ 6000964 :                     .ylrge:
(2)  974/ 6000964 : 6123                		mov	r2,r1
(2)  975/ 6000966 : 4710                		dt	r7
(2)  976/ 6000968 : 8BE8                		bf	.y_next
(2)  977/ 600096A :                     
(2)  978/ 600096A :                     	; Copy-paste but for hidden line
(2)  979/ 600096A :                     	; (TODO: improve this)
(2)  980/ 600096A : C600                		mov	@(marsGbl_BgData,gbr),r0
(2)  981/ 600096C : 6103                		mov	r0,r1			; r1 - read
(2)  982/ 600096E : 6203                		mov	r0,r2			; r2 - start
(2)  983/ 6000970 : 6303                		mov	r0,r3			; r3 - end
(2)  984/ 6000972 : C51C                		mov.w	@(marsGbl_BgWidth,gbr),r0
(2)  985/ 6000974 : 330C                		add	r0,r3
(2)  986/ 6000976 : D508                		mov	#(_framebuffer+$200)+(MSCRL_WIDTH*MSCRL_HEIGHT),r5
(2)  987/ 6000978 : 6453                		mov	r5,r4
(2)  988/ 600097A : E654                		mov	#(320+16)/4,r6
(2)  989/ 600097C :                     .x_next_l:
(2)  990/ 600097C : 3133                		cmp/ge	r3,r1
(2)  991/ 600097E : 8B00                		bf	.nolm_l
(2)  992/ 6000980 : 6123                		mov	r2,r1
(2)  993/ 6000982 :                     .nolm_l:
(2)  994/ 6000982 : 6016                		mov	@r1+,r0
(2)  995/ 6000984 : 2402                		mov	r0,@r4
(2)  996/ 6000986 : 7404                		add	#4,r4
(2)  997/ 6000988 : 4610                		dt	r6
(2)  998/ 600098A : 8BF7                		bf	.x_next_l
(2)  999/ 600098C :                     .stop:
(2) 1000/ 600098C : 000B                		rts
(2) 1001/ 600098E : 0009                		nop
(2) 1002/ 6000990 :                     		align 4
(2) 1003/ 6000990 : 2000 4100 2400 0200 		ltorg
                    2401 5200 00FF 0100 
                    00F0 0150           
(2) 1004/ 60009A4 :                     
(2) 1005/ 60009A4 :                     ; ------------------------------------
(2) 1006/ 60009A4 :                     ; MarsVdp_LoadPal
(2) 1007/ 60009A4 :                     ;
(2) 1008/ 60009A4 :                     ; Load palette to RAM
(2) 1009/ 60009A4 :                     ; then the Palette will be transfered
(2) 1010/ 60009A4 :                     ; on VBlank
(2) 1011/ 60009A4 :                     ;
(2) 1012/ 60009A4 :                     ; Input:
(2) 1013/ 60009A4 :                     ; r1 - Palette data
(2) 1014/ 60009A4 :                     ; r2 - Start index
(2) 1015/ 60009A4 :                     ; r3 - Number of colors
(2) 1016/ 60009A4 :                     ; r4 - OR value ($0000 or $8000)
(2) 1017/ 60009A4 :                     ;
(2) 1018/ 60009A4 :                     ; Uses:
(2) 1019/ 60009A4 :                     ; r0,r4-r6
(2) 1020/ 60009A4 :                     ; ------------------------------------
(2) 1021/ 60009A4 :                     
(2) 1022/ 60009A4 :                     MarsVideo_LoadPal:
(2) 1023/ 60009A4 : C53A                		mov.w	@(marsGbl_PalDmaMidWr,gbr),r0
(2) 1024/ 60009A6 : 8801                		cmp/eq	#1,r0
(2) 1025/ 60009A8 : 89FC                		bt	MarsVideo_LoadPal
(2) 1026/ 60009AA : 6513                		mov 	r1,r5
(2) 1027/ 60009AC : D60A                		mov 	#RAM_Mars_Palette,r6
(2) 1028/ 60009AE : 6023                		mov 	r2,r0
(2) 1029/ 60009B0 : 4000                		shll	r0
(2) 1030/ 60009B2 : 360C                		add 	r0,r6
(2) 1031/ 60009B4 : 6033                		mov 	r3,r0
(2) 1032/ 60009B6 :                     ; 		and	#$FF,r0
(2) 1033/ 60009B6 :                     ; 		cmp/pl	r0
(2) 1034/ 60009B6 :                     ; 		bf	.badlen
(2) 1035/ 60009B6 : 9713                		mov	#256,r7
(2) 1036/ 60009B8 : 3077                		cmp/gt	r7,r0
(2) 1037/ 60009BA : 8900                		bt	.loop
(2) 1038/ 60009BC : 6703                		mov	r0,r7
(2) 1039/ 60009BE :                     .loop:
(2) 1040/ 60009BE : 6055                		mov.w	@r5+,r0
(2) 1041/ 60009C0 : 204B                		or	r4,r0
(2) 1042/ 60009C2 : 2601                		mov.w	r0,@r6
(2) 1043/ 60009C4 : 4710                		dt	r7
(2) 1044/ 60009C6 : 8FFA                		bf/s	.loop
(2) 1045/ 60009C8 : 7602                		add 	#2,r6
(2) 1046/ 60009CA :                     .badlen:
(2) 1047/ 60009CA : D104                		mov	#RAM_Mars_Palette,r1	; lazy fix
(2) 1048/ 60009CC : 6011                		mov.w	@r1,r0			; for background
(2) 1049/ 60009CE : 9208                		mov	#$7FFF,r2
(2) 1050/ 60009D0 : 2029                		and	r2,r0
(2) 1051/ 60009D2 : 2101                		mov.w	r0,@r1
(2) 1052/ 60009D4 : 000B                		rts
(2) 1053/ 60009D6 : 0009                		nop
(2) 1054/ 60009D8 :                     		align 4
(2) 1055/ 60009D8 : 0600 483C 0600 483C 		ltorg
                    0100 7FFF           
(2) 1056/ 60009E4 :                     
(2) 1057/ 60009E4 :                     ; ------------------------------------------------
(2) 1058/ 60009E4 :                     ; Sets SuperVDP's background settings
(2) 1059/ 60009E4 :                     ; ------------------------------------------------
(2) 1060/ 60009E4 :                     
(2) 1061/ 60009E4 :                     MarsVideo_SetBg:
(2) 1062/ 60009E4 : 6013                		mov	r1,r0
(2) 1063/ 60009E6 : C200                		mov	r0,@(marsGbl_BgData,gbr)
(2) 1064/ 60009E8 : 6023                		mov	r2,r0
(2) 1065/ 60009EA : C11C                		mov.w	r0,@(marsGbl_BgWidth,gbr)
(2) 1066/ 60009EC : 6033                		mov	r3,r0
(2) 1067/ 60009EE : C11D                		mov.w	r0,@(marsGbl_BgHeight,gbr)
(2) 1068/ 60009F0 :                     ; 		mov	r4,r0
(2) 1069/ 60009F0 :                     ; 		mov	r0,@(marsGbl_Bg_Xinc,gbr)
(2) 1070/ 60009F0 :                     ; 		mov	r5,r0
(2) 1071/ 60009F0 :                     ; 		mov	r0,@(marsGbl_Bg_Yinc,gbr)
(2) 1072/ 60009F0 :                     
(2) 1073/ 60009F0 :                     	; Scroll setup values
(2) 1074/ 60009F0 :                     	; TODO: very basic setup
(2) 1075/ 60009F0 :                     	; needs extra checks for drawing from
(2) 1076/ 60009F0 :                     	; specific X/Y point
(2) 1077/ 60009F0 : E000                		mov	#0,r0;@(marsGbl_Bg_Xpos,gbr),r0
(2) 1078/ 60009F2 : C123                		mov.w	r0,@(marsGbl_Bg_XbgInc_L,gbr)
(2) 1079/ 60009F4 : 9114                		mov	#320,r1
(2) 1080/ 60009F6 : E000                		mov	#0,r0;@(marsGbl_Bg_Xpos,gbr),r0
(2) 1081/ 60009F8 : 301C                		add	r1,r0
(2) 1082/ 60009FA : C124                		mov.w	r0,@(marsGbl_Bg_XbgInc_R,gbr)
(2) 1083/ 60009FC :                     
(2) 1084/ 60009FC : E2F0                		mov	#-MSCRL_BLKSIZE,r2
(2) 1085/ 60009FE : E000                		mov	#0,r0;@(marsGbl_Bg_Ypos,gbr),r0
(2) 1086/ 6000A00 : C127                		mov.w	r0,@(marsGbl_Bg_YbgInc_LR,gbr)
(2) 1087/ 6000A02 : C122                		mov.w	r0,@(marsGbl_Bg_YFbPos_LR,gbr)
(2) 1088/ 6000A04 : E000                		mov	#0,r0;@(marsGbl_Bg_Ypos,gbr),r0
(2) 1089/ 6000A06 : E100                		mov	#0,r1
(2) 1090/ 6000A08 : 301C                		add	r1,r0
(2) 1091/ 6000A0A : 2029                		and	r2,r0
(2) 1092/ 6000A0C : C120                		mov.w	r0,@(marsGbl_Bg_YFbPos_U,gbr)
(2) 1093/ 6000A0E : E000                		mov	#0,r0;@(marsGbl_Bg_Ypos,gbr),r0
(2) 1094/ 6000A10 : 9107                		mov	#MSCRL_HEIGHT-MSCRL_BLKSIZE,r1
(2) 1095/ 6000A12 : 301C                		add	r1,r0
(2) 1096/ 6000A14 : 2029                		and	r2,r0
(2) 1097/ 6000A16 : C125                		mov.w	r0,@(marsGbl_Bg_YbgInc_D,gbr)
(2) 1098/ 6000A18 : C121                		mov.w	r0,@(marsGbl_Bg_YFbPos_D,gbr)
(2) 1099/ 6000A1A : 000B                		rts
(2) 1100/ 6000A1C : 0009                		nop
(2) 1101/ 6000A1E :                     		align 4
(2) 1102/ 6000A20 : 0140 00F0           		ltorg
(2) 1103/ 6000A24 :                     
(2) 1104/ 6000A24 :                     ; ------------------------------------------------
(2) 1105/ 6000A24 :                     ; MarsVideo_SetWatchdog
(2) 1106/ 6000A24 :                     ;
(2) 1107/ 6000A24 :                     ; Initialize watchdog interrupt with
(2) 1108/ 6000A24 :                     ; default settings
(2) 1109/ 6000A24 :                     ; ------------------------------------------------
(2) 1110/ 6000A24 :                     
(2) 1111/ 6000A24 :                     MarsVideo_SetWatchdog:
(2) 1112/ 6000A24 : 4F03                		stc	sr,@-r15			; Save interrupts
(2) 1113/ 6000A26 : 904F                		mov	#$F0,r0
(2) 1114/ 6000A28 : 400E                		ldc	r0,sr
(2) 1115/ 6000A2A :                     
(2) 1116/ 6000A2A :                     	; Polygon start-values
(2) 1117/ 6000A2A : D01E                		mov	#RAM_Mars_VdpDrwList,r0		; Reset the piece-drawing pointer
(2) 1118/ 6000A2C : C202                		mov	r0,@(marsGbl_PlyPzList_R,gbr)	; on both READ and WRITE pointers
(2) 1119/ 6000A2E : C203                		mov	r0,@(marsGbl_PlyPzList_W,gbr)
(2) 1120/ 6000A30 : E000                		mov	#0,r0				; Reset polygon pieces counter
(2) 1121/ 6000A32 : C131                		mov.w	r0,@(marsGbl_PzListCntr,gbr)
(2) 1122/ 6000A34 :                     
(2) 1123/ 6000A34 :                     	; Vars that require reset
(2) 1124/ 6000A34 : D11C                		mov	#Cach_LR_Lines,r1		; L/R lines to process
(2) 1125/ 6000A36 : 9048                		mov	#MSCRL_HEIGHT,r0
(2) 1126/ 6000A38 : 2102                		mov	r0,@r1
(2) 1127/ 6000A3A : D11C                		mov	#Cach_UD_Lines,r1		; U/D lines to process
(2) 1128/ 6000A3C : E010                		mov	#MSCRL_BLKSIZE,r0
(2) 1129/ 6000A3E : 2102                		mov	r0,@r1
(2) 1130/ 6000A40 :                     
(2) 1131/ 6000A40 :                     	; X draw settings
(2) 1132/ 6000A40 : C600                		mov	@(marsGbl_BgData,gbr),r0
(2) 1133/ 6000A42 : C201                		mov	r0,@(marsGbl_BgData_R,gbr)
(2) 1134/ 6000A44 : 9442                		mov	#MSCRL_WIDTH,r4				; Set Top-Left framebuffer position
(2) 1135/ 6000A46 : E2F0                		mov	#-MSCRL_BLKSIZE,r2			; for L/R drawing
(2) 1136/ 6000A48 : D119                		mov	#Cach_XHead_L,r1			; X draw heads
(2) 1137/ 6000A4A : C523                		mov.w	@(marsGbl_Bg_XbgInc_L,gbr),r0
(2) 1138/ 6000A4C : 2029                		and	r2,r0
(2) 1139/ 6000A4E : 2102                		mov	r0,@r1
(2) 1140/ 6000A50 : D118                		mov	#Cach_XHead_R,r1
(2) 1141/ 6000A52 : C524                		mov.w	@(marsGbl_Bg_XbgInc_R,gbr),r0
(2) 1142/ 6000A54 : 2029                		and	r2,r0
(2) 1143/ 6000A56 : 2102                		mov	r0,@r1
(2) 1144/ 6000A58 : D117                		mov	#Cach_BgFbPosLR,r1
(2) 1145/ 6000A5A : C60C                		mov	@(marsGbl_Bg_FbBase,gbr),r0
(2) 1146/ 6000A5C : 2029                		and	r2,r0
(2) 1147/ 6000A5E : 6303                		mov	r0,r3
(2) 1148/ 6000A60 : C522                		mov.w	@(marsGbl_Bg_YFbPos_LR,gbr),r0
(2) 1149/ 6000A62 : 2029                		and	r2,r0
(2) 1150/ 6000A64 : 240E                		mulu	r0,r4
(2) 1151/ 6000A66 : 001A                		sts	macl,r0
(2) 1152/ 6000A68 : 303C                		add	r3,r0
(2) 1153/ 6000A6A : 2102                		mov	r0,@r1
(2) 1154/ 6000A6C : C51C                		mov.w	@(marsGbl_BgWidth,gbr),r0		; Y add for L/R
(2) 1155/ 6000A6E : 6303                		mov	r0,r3
(2) 1156/ 6000A70 : D112                		mov	#Cach_YRead_LR,r1
(2) 1157/ 6000A72 : C527                		mov.w	@(marsGbl_Bg_YbgInc_LR,gbr),r0
(2) 1158/ 6000A74 : 2029                		and	r2,r0
(2) 1159/ 6000A76 : 2102                		mov	r0,@r1
(2) 1160/ 6000A78 : 2029                		and	r2,r0
(2) 1161/ 6000A7A : 203E                		mulu	r3,r0
(2) 1162/ 6000A7C : 001A                		sts	macl,r0
(2) 1163/ 6000A7E : D110                		mov	#Cach_YHead_LR,r1
(2) 1164/ 6000A80 : 2102                		mov	r0,@r1
(2) 1165/ 6000A82 :                     
(2) 1166/ 6000A82 :                     	; Y draw settings
(2) 1167/ 6000A82 : E001                		mov	#1,r0				; Set first task $01
(2) 1168/ 6000A84 : C132                		mov.w	r0,@(marsGbl_DrwTask,gbr)
(2) 1169/ 6000A86 : 4F07                		ldc	@r15+,sr			; Restore interrupts
(2) 1170/ 6000A88 : 9121                		mov	#$FFFFFE80,r1
(2) 1171/ 6000A8A : 9021                		mov.w	#$5A20,r0			; Watchdog timer
(2) 1172/ 6000A8C : 2101                		mov.w	r0,@r1
(2) 1173/ 6000A8E : 9020                		mov.w	#$A538,r0			; Enable this watchdog
(2) 1174/ 6000A90 : 2101                		mov.w	r0,@r1
(2) 1175/ 6000A92 : D10C                		mov	#_vdpreg,r1
(2) 1176/ 6000A94 : 8515                .wait_fb:	mov.w	@($A,r1),r0			; Wait until framebuffer is unlocked
(2) 1177/ 6000A96 : C802                		tst	#2,r0
(2) 1178/ 6000A98 : 8BFC                		bf	.wait_fb
(2) 1179/ 6000A9A : 901B                		mov.w	#$A1,r0				; ClearOnly: Pre-start at $A1
(2) 1180/ 6000A9C :                     ; 		mov.w	#$100,r0			; BG: Pre-start at $100
(2) 1181/ 6000A9C : 8113                		mov.w	r0,@(6,r1)			;
(2) 1182/ 6000A9E :                     
(2) 1183/ 6000A9E : 000B                		rts
(2) 1184/ 6000AA0 : 0009                		nop
(2) 1185/ 6000AA2 :                     		align 4
(2) 1186/ 6000AA4 : 0600 7284 C000 0528 		ltorg
                    C000 052C C000 0500 
                    C000 0504 C000 051C 
                    C000 0514 C000 0510 
                    2000 4100 00F0 0100 
                    0150 FE80 5A20 A538 
                    00A1                
(2) 1187/ 6000AD6 :                     
(2) 1188/ 6000AD6 :                     ; ====================================================================
(2) 1189/ 6000AD6 :                     ; ----------------------------------------------------------------
(2) 1190/ 6000AD6 :                     ; 3D MODELS SYSTEM
(2) 1191/ 6000AD6 :                     ; ----------------------------------------------------------------
(2) 1192/ 6000AD6 :                     
(2) 1193/ 6000AD6 :                     ; ; ------------------------------------------------
(2) 1194/ 6000AD6 :                     ; ; Object layout routines
(2) 1195/ 6000AD6 :                     ; ; ------------------------------------------------
(2) 1196/ 6000AD6 :                     ;
(2) 1197/ 6000AD6 :                     ; ; ----------------------------------------
(2) 1198/ 6000AD6 :                     ; ; Read layout
(2) 1199/ 6000AD6 :                     ; ; ----------------------------------------
(2) 1200/ 6000AD6 :                     ;
(2) 1201/ 6000AD6 :                     ; MarsLay_Read:
(2) 1202/ 6000AD6 :                     ; 		sts	pr,@-r15
(2) 1203/ 6000AD6 :                     ; 		mov	#RAM_Mars_ObjLayout,r14
(2) 1204/ 6000AD6 :                     ; 		mov	#RAM_Mars_ObjCamera,r13
(2) 1205/ 6000AD6 :                     ; 		mov	#RAM_Mars_Objects,r12
(2) 1206/ 6000AD6 :                     ; 		mov	@(mdllay_data,r14),r0
(2) 1207/ 6000AD6 :                     ; 		cmp/pl	r0
(2) 1208/ 6000AD6 :                     ; 		bf	.no_lay
(2) 1209/ 6000AD6 :                     ; 		mov	r0,r11
(2) 1210/ 6000AD6 :                     ;
(2) 1211/ 6000AD6 :                     ; 		mov	#0,r10				; r10 - Update counter
(2) 1212/ 6000AD6 :                     ; 		mov	#-$100000,r9			;  r9 - MAX Z block size
(2) 1213/ 6000AD6 :                     ; 		mov	#-$100000,r8			;  r8 - MAX Y block size
(2) 1214/ 6000AD6 :                     ; 		mov	#-$100000,r7			;  r7 - MAX X block size
(2) 1215/ 6000AD6 :                     ; 		mov	#-$8000,r6			;  r6 - X Rotation update point
(2) 1216/ 6000AD6 :                     ;
(2) 1217/ 6000AD6 :                     ; 		mov	@(mdllay_z_last,r14),r5
(2) 1218/ 6000AD6 :                     ; 		mov	@(cam_z_pos,r13),r0
(2) 1219/ 6000AD6 :                     ; 		and	r9,r0
(2) 1220/ 6000AD6 :                     ; 		and	r9,r5
(2) 1221/ 6000AD6 :                     ; 		cmp/eq	r0,r5
(2) 1222/ 6000AD6 :                     ; 		bt	.no_z_upd
(2) 1223/ 6000AD6 :                     ; ; 		add	r9,r5
(2) 1224/ 6000AD6 :                     ; ; 		neg	r5,r4
(2) 1225/ 6000AD6 :                     ; ; 		cmp/gt	r5,r0
(2) 1226/ 6000AD6 :                     ; ; 		bf	.set_z_upd
(2) 1227/ 6000AD6 :                     ; ; 		cmp/ge	r4,r0
(2) 1228/ 6000AD6 :                     ; ; 		bf	.no_z_upd
(2) 1229/ 6000AD6 :                     ; ; .set_z_upd:
(2) 1230/ 6000AD6 :                     ; 		and	r9,r0
(2) 1231/ 6000AD6 :                     ; 		mov	r0,@(mdllay_z_last,r14)
(2) 1232/ 6000AD6 :                     ; 		add	#1,r10
(2) 1233/ 6000AD6 :                     ; .no_z_upd:
(2) 1234/ 6000AD6 :                     ;
(2) 1235/ 6000AD6 :                     ; 		mov	@(mdllay_y_last,r14),r5
(2) 1236/ 6000AD6 :                     ; 		mov	@(cam_y_pos,r13),r0
(2) 1237/ 6000AD6 :                     ; 		and	r8,r0
(2) 1238/ 6000AD6 :                     ; 		and	r8,r5
(2) 1239/ 6000AD6 :                     ; 		cmp/eq	r0,r5
(2) 1240/ 6000AD6 :                     ; 		bt	.no_y_upd
(2) 1241/ 6000AD6 :                     ; ; 		add	r8,r5
(2) 1242/ 6000AD6 :                     ; ; 		neg	r5,r4
(2) 1243/ 6000AD6 :                     ; ; 		cmp/gt	r5,r0
(2) 1244/ 6000AD6 :                     ; ; 		bf	.set_y_upd
(2) 1245/ 6000AD6 :                     ; ; 		cmp/ge	r4,r0
(2) 1246/ 6000AD6 :                     ; ; 		bf	.no_y_upd
(2) 1247/ 6000AD6 :                     ; ; .set_y_upd:
(2) 1248/ 6000AD6 :                     ; 		and	r8,r0
(2) 1249/ 6000AD6 :                     ; 		mov	r0,@(mdllay_y_last,r14)
(2) 1250/ 6000AD6 :                     ; 		add	#1,r10
(2) 1251/ 6000AD6 :                     ; .no_y_upd:
(2) 1252/ 6000AD6 :                     ;
(2) 1253/ 6000AD6 :                     ; 		mov	@(mdllay_x_last,r14),r5
(2) 1254/ 6000AD6 :                     ; 		mov	@(cam_x_pos,r13),r0
(2) 1255/ 6000AD6 :                     ; 		and	r7,r0
(2) 1256/ 6000AD6 :                     ; 		and	r7,r5
(2) 1257/ 6000AD6 :                     ; 		cmp/eq	r0,r5
(2) 1258/ 6000AD6 :                     ; 		bt	.no_x_upd
(2) 1259/ 6000AD6 :                     ; ; 		add	r7,r5
(2) 1260/ 6000AD6 :                     ; ; 		neg	r5,r4
(2) 1261/ 6000AD6 :                     ; ; 		cmp/gt	r5,r0
(2) 1262/ 6000AD6 :                     ; ; 		bf	.set_x_upd
(2) 1263/ 6000AD6 :                     ; ; 		cmp/ge	r4,r0
(2) 1264/ 6000AD6 :                     ; ; 		bf	.no_x_upd
(2) 1265/ 6000AD6 :                     ; ; .set_x_upd:
(2) 1266/ 6000AD6 :                     ; 		and	r7,r0
(2) 1267/ 6000AD6 :                     ; 		mov	r0,@(mdllay_x_last,r14)
(2) 1268/ 6000AD6 :                     ; 		add	#1,r10
(2) 1269/ 6000AD6 :                     ; .no_x_upd:
(2) 1270/ 6000AD6 :                     ;
(2) 1271/ 6000AD6 :                     ; 		mov	@(mdllay_xr_last,r14),r5
(2) 1272/ 6000AD6 :                     ; 		mov	@(cam_x_rot,r13),r0
(2) 1273/ 6000AD6 :                     ; 		and	r6,r0
(2) 1274/ 6000AD6 :                     ; 		and	r6,r5
(2) 1275/ 6000AD6 :                     ; 		cmp/eq	r0,r5
(2) 1276/ 6000AD6 :                     ; 		bt	.no_xr_upd
(2) 1277/ 6000AD6 :                     ; ; 		add	r6,r5
(2) 1278/ 6000AD6 :                     ; ; 		neg	r5,r4
(2) 1279/ 6000AD6 :                     ; ; 		cmp/gt	r5,r0
(2) 1280/ 6000AD6 :                     ; ; 		bf	.set_xr_upd
(2) 1281/ 6000AD6 :                     ; ; 		cmp/ge	r4,r0
(2) 1282/ 6000AD6 :                     ; ; 		bf	.no_xr_upd
(2) 1283/ 6000AD6 :                     ; ; .set_xr_upd:
(2) 1284/ 6000AD6 :                     ; 		and	r6,r0
(2) 1285/ 6000AD6 :                     ; 		mov	r0,@(mdllay_xr_last,r14)
(2) 1286/ 6000AD6 :                     ; 		add	#1,r10
(2) 1287/ 6000AD6 :                     ; .no_xr_upd:
(2) 1288/ 6000AD6 :                     ;
(2) 1289/ 6000AD6 :                     ; 		cmp/pl	r10
(2) 1290/ 6000AD6 :                     ; 		bf	.no_lay
(2) 1291/ 6000AD6 :                     ; 		bsr	MarsLay_Draw
(2) 1292/ 6000AD6 :                     ; 		nop
(2) 1293/ 6000AD6 :                     ; .no_lay:
(2) 1294/ 6000AD6 :                     ; 		lds	@r15+,pr
(2) 1295/ 6000AD6 :                     ; 		rts
(2) 1296/ 6000AD6 :                     ; 		nop
(2) 1297/ 6000AD6 :                     ; 		align 4
(2) 1298/ 6000AD6 :                     ; 		ltorg
(2) 1299/ 6000AD6 :                     ;
(2) 1300/ 6000AD6 :                     ; ; r1 - layout data pointer
(2) 1301/ 6000AD6 :                     ; MarsLay_Make:
(2) 1302/ 6000AD6 :                     ; 		mov	#RAM_Mars_ObjLayout,r14
(2) 1303/ 6000AD6 :                     ; 		mov	#RAM_Mars_ObjCamera,r13
(2) 1304/ 6000AD6 :                     ; 		xor	r0,r0
(2) 1305/ 6000AD6 :                     ; 		mov	r1,@(mdllay_data,r14)
(2) 1306/ 6000AD6 :                     ; 		mov	r0,@(mdllay_x_last,r14)
(2) 1307/ 6000AD6 :                     ; 		mov	r0,@(mdllay_y_last,r14)
(2) 1308/ 6000AD6 :                     ; 		mov	r0,@(mdllay_z_last,r14)
(2) 1309/ 6000AD6 :                     ; 		mov	r0,@(mdllay_x,r14)
(2) 1310/ 6000AD6 :                     ; 		mov	r0,@(mdllay_y,r14)
(2) 1311/ 6000AD6 :                     ; 		mov	r0,@(mdllay_z,r14)
(2) 1312/ 6000AD6 :                     ; 		rts
(2) 1313/ 6000AD6 :                     ; 		nop
(2) 1314/ 6000AD6 :                     ; 		align 4
(2) 1315/ 6000AD6 :                     ;
(2) 1316/ 6000AD6 :                     ; MarsLay_Draw:
(2) 1317/ 6000AD6 :                     ; 		mov	#RAM_Mars_Objects,r10
(2) 1318/ 6000AD6 :                     ; 		mov	r10,r2
(2) 1319/ 6000AD6 :                     ; 		mov	#sizeof_mdlobj,r3
(2) 1320/ 6000AD6 :                     ; 		mov	#0,r0
(2) 1321/ 6000AD6 :                     ; 		mov	#9,r4
(2) 1322/ 6000AD6 :                     ; .clrold:
(2) 1323/ 6000AD6 :                     ; 		mov	r0,@(mdl_data,r2)
(2) 1324/ 6000AD6 :                     ; 		mov	r0,@(mdl_x_pos,r2)
(2) 1325/ 6000AD6 :                     ; 		mov	r0,@(mdl_y_pos,r2)
(2) 1326/ 6000AD6 :                     ; 		mov	r0,@(mdl_z_pos,r2)
(2) 1327/ 6000AD6 :                     ; 		mov	r0,@(mdl_x_rot,r2)
(2) 1328/ 6000AD6 :                     ; 		mov	r0,@(mdl_y_rot,r2)
(2) 1329/ 6000AD6 :                     ; 		mov	r0,@(mdl_z_rot,r2)
(2) 1330/ 6000AD6 :                     ; 		dt	r4
(2) 1331/ 6000AD6 :                     ; 		bf/s	.clrold
(2) 1332/ 6000AD6 :                     ; 		add	r3,r2
(2) 1333/ 6000AD6 :                     ;
(2) 1334/ 6000AD6 :                     ; 	; r13 - Layout Ids
(2) 1335/ 6000AD6 :                     ; 	; r12 - Layout model list
(2) 1336/ 6000AD6 :                     ; 		mov	#0,r4
(2) 1337/ 6000AD6 :                     ; 		mov	@(mdllay_data,r14),r13
(2) 1338/ 6000AD6 :                     ; 		mov	@r13+,r12
(2) 1339/ 6000AD6 :                     ; 		mov	.center_val,r0			; list center point
(2) 1340/ 6000AD6 :                     ; 		add	r0,r13
(2) 1341/ 6000AD6 :                     ;
(2) 1342/ 6000AD6 :                     ; 	; X/Y add
(2) 1343/ 6000AD6 :                     ; 		mov	@(mdllay_x_last,r14),r1
(2) 1344/ 6000AD6 :                     ; 		mov	@(mdllay_z_last,r14),r2
(2) 1345/ 6000AD6 :                     ; 		mov	#LAY_WIDTH,r0
(2) 1346/ 6000AD6 :                     ; 		shlr16	r1
(2) 1347/ 6000AD6 :                     ; 		shlr16	r2
(2) 1348/ 6000AD6 :                     ; 		exts	r1,r1
(2) 1349/ 6000AD6 :                     ; 		exts	r2,r2
(2) 1350/ 6000AD6 :                     ; 	rept 3
(2) 1351/ 6000AD6 :                     ; 		shar	r1
(2) 1352/ 6000AD6 :                     ; 		shar	r2
(2) 1353/ 6000AD6 :                     ; 	endm
(2) 1354/ 6000AD6 :                     ; 		shar	r2			; extra shift
(2) 1355/ 6000AD6 :                     ; 		muls	r0,r2
(2) 1356/ 6000AD6 :                     ; 		sts	macl,r0
(2) 1357/ 6000AD6 :                     ; 		add	r1,r13			; X add
(2) 1358/ 6000AD6 :                     ; 		sub	r0,r13			; Y add
(2) 1359/ 6000AD6 :                     ;
(2) 1360/ 6000AD6 :                     ; 	; Rotation
(2) 1361/ 6000AD6 :                     ; 		mov	@(mdllay_xr_last,r14),r0
(2) 1362/ 6000AD6 :                     ; 		shlr16	r0
(2) 1363/ 6000AD6 :                     ; 		and	#$3F,r0
(2) 1364/ 6000AD6 :                     ; 		shll2	r0
(2) 1365/ 6000AD6 :                     ; 		mov	#.list,r1
(2) 1366/ 6000AD6 :                     ; 		mov	@(r0,r1),r0
(2) 1367/ 6000AD6 :                     ; 		jmp	@r0
(2) 1368/ 6000AD6 :                     ; 		nop
(2) 1369/ 6000AD6 :                     ; 		align 4
(2) 1370/ 6000AD6 :                     ; .center_val:	dc.l ($E*LAY_WIDTH)+($C*2)
(2) 1371/ 6000AD6 :                     ;
(2) 1372/ 6000AD6 :                     ; .list:
(2) 1373/ 6000AD6 :                     ; 		dc.l .front
(2) 1374/ 6000AD6 :                     ; 		dc.l .front_fr
(2) 1375/ 6000AD6 :                     ; 		dc.l .front_fr
(2) 1376/ 6000AD6 :                     ; 		dc.l .front_fr
(2) 1377/ 6000AD6 :                     ; 		dc.l .front_fr
(2) 1378/ 6000AD6 :                     ; 		dc.l .front_fr
(2) 1379/ 6000AD6 :                     ; 		dc.l .front_fr
(2) 1380/ 6000AD6 :                     ; 		dc.l .front_fr
(2) 1381/ 6000AD6 :                     ; 		dc.l .front_fr
(2) 1382/ 6000AD6 :                     ; 		dc.l .front_fr
(2) 1383/ 6000AD6 :                     ; 		dc.l .front_fr
(2) 1384/ 6000AD6 :                     ; 		dc.l .front_fr
(2) 1385/ 6000AD6 :                     ; 		dc.l .front_fr
(2) 1386/ 6000AD6 :                     ; 		dc.l .front_fr
(2) 1387/ 6000AD6 :                     ; 		dc.l .front_fr
(2) 1388/ 6000AD6 :                     ; 		dc.l .front_fr
(2) 1389/ 6000AD6 :                     ;
(2) 1390/ 6000AD6 :                     ; 		dc.l .front_fr
(2) 1391/ 6000AD6 :                     ; 		dc.l .front_fr
(2) 1392/ 6000AD6 :                     ; 		dc.l .right_dw
(2) 1393/ 6000AD6 :                     ; 		dc.l .right_dw
(2) 1394/ 6000AD6 :                     ; 		dc.l .right_dw
(2) 1395/ 6000AD6 :                     ; 		dc.l .right_dw
(2) 1396/ 6000AD6 :                     ; 		dc.l .right_dw
(2) 1397/ 6000AD6 :                     ; 		dc.l .right_dw
(2) 1398/ 6000AD6 :                     ; 		dc.l .right_dw
(2) 1399/ 6000AD6 :                     ; 		dc.l .right_dw
(2) 1400/ 6000AD6 :                     ; 		dc.l .right_dw
(2) 1401/ 6000AD6 :                     ; 		dc.l .right_dw
(2) 1402/ 6000AD6 :                     ; 		dc.l .right_dw
(2) 1403/ 6000AD6 :                     ; 		dc.l .right_dw
(2) 1404/ 6000AD6 :                     ; 		dc.l .right_dw
(2) 1405/ 6000AD6 :                     ; 		dc.l .right_dw
(2) 1406/ 6000AD6 :                     ;
(2) 1407/ 6000AD6 :                     ; 		dc.l .right_dw
(2) 1408/ 6000AD6 :                     ; 		dc.l .right_dw
(2) 1409/ 6000AD6 :                     ; 		dc.l .down_left
(2) 1410/ 6000AD6 :                     ; 		dc.l .down_left
(2) 1411/ 6000AD6 :                     ; 		dc.l .down_left
(2) 1412/ 6000AD6 :                     ; 		dc.l .down_left
(2) 1413/ 6000AD6 :                     ; 		dc.l .down_left
(2) 1414/ 6000AD6 :                     ; 		dc.l .down_left
(2) 1415/ 6000AD6 :                     ; 		dc.l .down_left
(2) 1416/ 6000AD6 :                     ; 		dc.l .down_left
(2) 1417/ 6000AD6 :                     ; 		dc.l .down_left
(2) 1418/ 6000AD6 :                     ; 		dc.l .down_left
(2) 1419/ 6000AD6 :                     ; 		dc.l .down_left
(2) 1420/ 6000AD6 :                     ; 		dc.l .down_left
(2) 1421/ 6000AD6 :                     ; 		dc.l .down_left
(2) 1422/ 6000AD6 :                     ; 		dc.l .down_left
(2) 1423/ 6000AD6 :                     ;
(2) 1424/ 6000AD6 :                     ; 		dc.l .down_left
(2) 1425/ 6000AD6 :                     ; 		dc.l .down_left
(2) 1426/ 6000AD6 :                     ; 		dc.l .front_lf
(2) 1427/ 6000AD6 :                     ; 		dc.l .front_lf
(2) 1428/ 6000AD6 :                     ; 		dc.l .front_lf
(2) 1429/ 6000AD6 :                     ; 		dc.l .front_lf
(2) 1430/ 6000AD6 :                     ; 		dc.l .front_lf
(2) 1431/ 6000AD6 :                     ; 		dc.l .front_lf
(2) 1432/ 6000AD6 :                     ; 		dc.l .front_lf
(2) 1433/ 6000AD6 :                     ; 		dc.l .front_lf
(2) 1434/ 6000AD6 :                     ; 		dc.l .front_lf
(2) 1435/ 6000AD6 :                     ; 		dc.l .front_lf
(2) 1436/ 6000AD6 :                     ; 		dc.l .front_lf
(2) 1437/ 6000AD6 :                     ; 		dc.l .front
(2) 1438/ 6000AD6 :                     ; 		dc.l .front
(2) 1439/ 6000AD6 :                     ; 		dc.l .front
(2) 1440/ 6000AD6 :                     ;
(2) 1441/ 6000AD6 :                     ; ; r5 - numof pieces
(2) 1442/ 6000AD6 :                     ; ; uses: r6,r7
(2) 1443/ 6000AD6 :                     ; .do_piece:
(2) 1444/ 6000AD6 :                     ; 		mov	r1,@-r15
(2) 1445/ 6000AD6 :                     ; 		mov	r13,@-r15
(2) 1446/ 6000AD6 :                     ; 		mov	#$100000,r6
(2) 1447/ 6000AD6 :                     ; .nxt_one:
(2) 1448/ 6000AD6 :                     ; 		xor	r4,r4
(2) 1449/ 6000AD6 :                     ; 		mov.w	@r13+,r0
(2) 1450/ 6000AD6 :                     ; 		cmp/pl 	r0
(2) 1451/ 6000AD6 :                     ; 		bf	.blank_mdl
(2) 1452/ 6000AD6 :                     ; ; 		mov	r0,r7
(2) 1453/ 6000AD6 :                     ; ; 		shlr8	r0
(2) 1454/ 6000AD6 :                     ; ; 		shlr2	r0
(2) 1455/ 6000AD6 :                     ; ; 		shlr	r0
(2) 1456/ 6000AD6 :                     ; ; 		and	#%11100,r0
(2) 1457/ 6000AD6 :                     ; ; 		mov	#.xrotlist,r8
(2) 1458/ 6000AD6 :                     ; ; 		mov	@(r8,r0),r8
(2) 1459/ 6000AD6 :                     ; ; 		mov	r7,r0
(2) 1460/ 6000AD6 :                     ; 		add	#-1,r0
(2) 1461/ 6000AD6 :                     ; 		shll2	r0
(2) 1462/ 6000AD6 :                     ; ; 		shll	r0
(2) 1463/ 6000AD6 :                     ; ; 		mov	#$1FFF,r7
(2) 1464/ 6000AD6 :                     ; ; 		and	r7,r0
(2) 1465/ 6000AD6 :                     ; 		mov	@(r12,r0),r4
(2) 1466/ 6000AD6 :                     ; 		mov	#$40000000,r0	; OR val: set special object mode
(2) 1467/ 6000AD6 :                     ; 		or	r0,r4
(2) 1468/ 6000AD6 :                     ; .blank_mdl:
(2) 1469/ 6000AD6 :                     ; 		mov	r1,@(mdl_x_pos,r10)
(2) 1470/ 6000AD6 :                     ; 		mov	r2,@(mdl_y_pos,r10)
(2) 1471/ 6000AD6 :                     ; 		mov	r3,@(mdl_z_pos,r10)
(2) 1472/ 6000AD6 :                     ; ; 		mov	r8,@(mdl_x_rot,r10)
(2) 1473/ 6000AD6 :                     ; 		mov	r4,@(mdl_data,r10)
(2) 1474/ 6000AD6 :                     ; 		add	#sizeof_mdlobj,r10
(2) 1475/ 6000AD6 :                     ; 		dt	r5
(2) 1476/ 6000AD6 :                     ; 		bf/s	.nxt_one
(2) 1477/ 6000AD6 :                     ; 		add	r6,r1
(2) 1478/ 6000AD6 :                     ; 		mov	@r15+,r13
(2) 1479/ 6000AD6 :                     ; 		mov	@r15+,r1
(2) 1480/ 6000AD6 :                     ; 		rts
(2) 1481/ 6000AD6 :                     ; 		nop
(2) 1482/ 6000AD6 :                     ; 		align 4
(2) 1483/ 6000AD6 :                     ; ; .xrotlist:	dc.l 0
(2) 1484/ 6000AD6 :                     ; ; 		dc.l $100000
(2) 1485/ 6000AD6 :                     ; ; 		dc.l $200000
(2) 1486/ 6000AD6 :                     ; ; 		dc.l $300000
(2) 1487/ 6000AD6 :                     ;
(2) 1488/ 6000AD6 :                     ; ; o X X X o
(2) 1489/ 6000AD6 :                     ; ; o X X X o
(2) 1490/ 6000AD6 :                     ; ; o X C X o
(2) 1491/ 6000AD6 :                     ; ; o - - - o
(2) 1492/ 6000AD6 :                     ; ; o o o o o
(2) 1493/ 6000AD6 :                     ; .front:
(2) 1494/ 6000AD6 :                     ; 		mov	#-$100000,r1
(2) 1495/ 6000AD6 :                     ; 		mov	#0,r2
(2) 1496/ 6000AD6 :                     ; 		mov	#-$200000,r3
(2) 1497/ 6000AD6 :                     ; 		add	#(1*2),r13
(2) 1498/ 6000AD6 :                     ; 		mov	#$100000,r11
(2) 1499/ 6000AD6 :                     ;
(2) 1500/ 6000AD6 :                     ; 		sts	pr,@-r15
(2) 1501/ 6000AD6 :                     ; 		bsr	.do_piece
(2) 1502/ 6000AD6 :                     ; 		mov	#3,r5
(2) 1503/ 6000AD6 :                     ; 		add	#LAY_WIDTH,r13
(2) 1504/ 6000AD6 :                     ; 		add	r11,r3
(2) 1505/ 6000AD6 :                     ; 		bsr	.do_piece
(2) 1506/ 6000AD6 :                     ; 		mov	#3,r5
(2) 1507/ 6000AD6 :                     ; 		add	#LAY_WIDTH,r13
(2) 1508/ 6000AD6 :                     ; 		add	r11,r3
(2) 1509/ 6000AD6 :                     ; 		bsr	.do_piece
(2) 1510/ 6000AD6 :                     ; 		mov	#3,r5
(2) 1511/ 6000AD6 :                     ; 		lds	@r15+,pr
(2) 1512/ 6000AD6 :                     ; 		rts
(2) 1513/ 6000AD6 :                     ; 		nop
(2) 1514/ 6000AD6 :                     ; 		align 4
(2) 1515/ 6000AD6 :                     ;
(2) 1516/ 6000AD6 :                     ; ; front right view
(2) 1517/ 6000AD6 :                     ; ; o o X X X
(2) 1518/ 6000AD6 :                     ; ; o - X X X
(2) 1519/ 6000AD6 :                     ; ; o - C X X
(2) 1520/ 6000AD6 :                     ; ; o - - - o
(2) 1521/ 6000AD6 :                     ; ; o o o o o
(2) 1522/ 6000AD6 :                     ; .front_fr:
(2) 1523/ 6000AD6 :                     ; 		mov	#0,r1
(2) 1524/ 6000AD6 :                     ; 		mov	#0,r2
(2) 1525/ 6000AD6 :                     ; 		mov	#-$200000,r3
(2) 1526/ 6000AD6 :                     ; 		add	#(2*2),r13
(2) 1527/ 6000AD6 :                     ; 		mov	#$100000,r11
(2) 1528/ 6000AD6 :                     ; 		sts	pr,@-r15
(2) 1529/ 6000AD6 :                     ; 		bsr	.do_piece
(2) 1530/ 6000AD6 :                     ; 		mov	#3,r5
(2) 1531/ 6000AD6 :                     ; 		add	#LAY_WIDTH,r13
(2) 1532/ 6000AD6 :                     ; 		add	r11,r3
(2) 1533/ 6000AD6 :                     ; 		bsr	.do_piece
(2) 1534/ 6000AD6 :                     ; 		mov	#3,r5
(2) 1535/ 6000AD6 :                     ; 		add	#LAY_WIDTH,r13
(2) 1536/ 6000AD6 :                     ; 		add	r11,r3
(2) 1537/ 6000AD6 :                     ; 		bsr	.do_piece
(2) 1538/ 6000AD6 :                     ; 		mov	#3,r5
(2) 1539/ 6000AD6 :                     ; 		lds	@r15+,pr
(2) 1540/ 6000AD6 :                     ; 		rts
(2) 1541/ 6000AD6 :                     ; 		nop
(2) 1542/ 6000AD6 :                     ; 		align 4
(2) 1543/ 6000AD6 :                     ;
(2) 1544/ 6000AD6 :                     ;
(2) 1545/ 6000AD6 :                     ; ; right view/down
(2) 1546/ 6000AD6 :                     ; ; o o o o o
(2) 1547/ 6000AD6 :                     ; ; o - - - o
(2) 1548/ 6000AD6 :                     ; ; o - C X X
(2) 1549/ 6000AD6 :                     ; ; o - X X X
(2) 1550/ 6000AD6 :                     ; ; o o X X X
(2) 1551/ 6000AD6 :                     ; .right_dw:
(2) 1552/ 6000AD6 :                     ; 		mov	#0,r1
(2) 1553/ 6000AD6 :                     ; 		mov	#0,r2
(2) 1554/ 6000AD6 :                     ; 		mov	#-$100000,r3
(2) 1555/ 6000AD6 :                     ; 		mov	#(2*2)+(LAY_WIDTH),r0
(2) 1556/ 6000AD6 :                     ; 		add	r0,r13
(2) 1557/ 6000AD6 :                     ; 		mov	#$100000,r11
(2) 1558/ 6000AD6 :                     ; 		sts	pr,@-r15
(2) 1559/ 6000AD6 :                     ; 		bsr	.do_piece
(2) 1560/ 6000AD6 :                     ; 		mov	#3,r5
(2) 1561/ 6000AD6 :                     ; 		add	#LAY_WIDTH,r13
(2) 1562/ 6000AD6 :                     ; 		add	r11,r3
(2) 1563/ 6000AD6 :                     ; 		bsr	.do_piece
(2) 1564/ 6000AD6 :                     ; 		mov	#3,r5
(2) 1565/ 6000AD6 :                     ; 		add	#LAY_WIDTH,r13
(2) 1566/ 6000AD6 :                     ; 		add	r11,r3
(2) 1567/ 6000AD6 :                     ; 		bsr	.do_piece
(2) 1568/ 6000AD6 :                     ; 		mov	#3,r5
(2) 1569/ 6000AD6 :                     ; 		lds	@r15+,pr
(2) 1570/ 6000AD6 :                     ; 		rts
(2) 1571/ 6000AD6 :                     ; 		nop
(2) 1572/ 6000AD6 :                     ; 		align 4
(2) 1573/ 6000AD6 :                     ;
(2) 1574/ 6000AD6 :                     ; ; o o o o o
(2) 1575/ 6000AD6 :                     ; ; o - - - o
(2) 1576/ 6000AD6 :                     ; ; o X C X o
(2) 1577/ 6000AD6 :                     ; ; o X X X o
(2) 1578/ 6000AD6 :                     ; ; o X X X o
(2) 1579/ 6000AD6 :                     ; .down:
(2) 1580/ 6000AD6 :                     ; 		mov	#0,r1
(2) 1581/ 6000AD6 :                     ; 		mov	#0,r2
(2) 1582/ 6000AD6 :                     ; 		mov	#-$100000,r3
(2) 1583/ 6000AD6 :                     ; 		mov	#(2*2)+(LAY_WIDTH*1),r0
(2) 1584/ 6000AD6 :                     ; 		add	r0,r13
(2) 1585/ 6000AD6 :                     ; 		mov	#$100000,r11
(2) 1586/ 6000AD6 :                     ; 		sts	pr,@-r15
(2) 1587/ 6000AD6 :                     ; 		bsr	.do_piece
(2) 1588/ 6000AD6 :                     ; 		mov	#3,r5
(2) 1589/ 6000AD6 :                     ; 		add	#LAY_WIDTH,r13
(2) 1590/ 6000AD6 :                     ; 		add	r11,r3
(2) 1591/ 6000AD6 :                     ; 		bsr	.do_piece
(2) 1592/ 6000AD6 :                     ; 		mov	#3,r5
(2) 1593/ 6000AD6 :                     ; 		add	#LAY_WIDTH,r13
(2) 1594/ 6000AD6 :                     ; 		add	r11,r3
(2) 1595/ 6000AD6 :                     ; 		bsr	.do_piece
(2) 1596/ 6000AD6 :                     ; 		mov	#3,r5
(2) 1597/ 6000AD6 :                     ; 		lds	@r15+,pr
(2) 1598/ 6000AD6 :                     ; 		rts
(2) 1599/ 6000AD6 :                     ; 		nop
(2) 1600/ 6000AD6 :                     ; 		align 4
(2) 1601/ 6000AD6 :                     ;
(2) 1602/ 6000AD6 :                     ; ; o o o o o
(2) 1603/ 6000AD6 :                     ; ; o - - - o
(2) 1604/ 6000AD6 :                     ; ; X X C - o
(2) 1605/ 6000AD6 :                     ; ; X X X - o
(2) 1606/ 6000AD6 :                     ; ; X X X o o
(2) 1607/ 6000AD6 :                     ; .down_left:
(2) 1608/ 6000AD6 :                     ; 		mov	#-$100000,r1
(2) 1609/ 6000AD6 :                     ; 		mov	#0,r2
(2) 1610/ 6000AD6 :                     ; 		mov	#-$100000,r3
(2) 1611/ 6000AD6 :                     ; 		mov	#(1*2)+(LAY_WIDTH*1),r0
(2) 1612/ 6000AD6 :                     ; 		add	r0,r13
(2) 1613/ 6000AD6 :                     ; 		mov	#$100000,r11
(2) 1614/ 6000AD6 :                     ; 		sts	pr,@-r15
(2) 1615/ 6000AD6 :                     ; 		bsr	.do_piece
(2) 1616/ 6000AD6 :                     ; 		mov	#3,r5
(2) 1617/ 6000AD6 :                     ; 		add	#LAY_WIDTH,r13
(2) 1618/ 6000AD6 :                     ; 		add	r11,r3
(2) 1619/ 6000AD6 :                     ; 		bsr	.do_piece
(2) 1620/ 6000AD6 :                     ; 		mov	#3,r5
(2) 1621/ 6000AD6 :                     ; 		add	#LAY_WIDTH,r13
(2) 1622/ 6000AD6 :                     ; 		add	r11,r3
(2) 1623/ 6000AD6 :                     ; 		bsr	.do_piece
(2) 1624/ 6000AD6 :                     ; 		mov	#3,r5
(2) 1625/ 6000AD6 :                     ; 		lds	@r15+,pr
(2) 1626/ 6000AD6 :                     ; 		rts
(2) 1627/ 6000AD6 :                     ; 		nop
(2) 1628/ 6000AD6 :                     ; 		align 4
(2) 1629/ 6000AD6 :                     ;
(2) 1630/ 6000AD6 :                     ;
(2) 1631/ 6000AD6 :                     ; ; X X X o o
(2) 1632/ 6000AD6 :                     ; ; X X X - o
(2) 1633/ 6000AD6 :                     ; ; X X C - o
(2) 1634/ 6000AD6 :                     ; ; o - - - o
(2) 1635/ 6000AD6 :                     ; ; o o o o o
(2) 1636/ 6000AD6 :                     ; .front_lf:
(2) 1637/ 6000AD6 :                     ; 		mov	#-$100000,r1
(2) 1638/ 6000AD6 :                     ; 		mov	#0,r2
(2) 1639/ 6000AD6 :                     ; 		mov	#-$200000,r3
(2) 1640/ 6000AD6 :                     ; 		add	#(1*2),r13
(2) 1641/ 6000AD6 :                     ; 		mov	#$100000,r11
(2) 1642/ 6000AD6 :                     ; 		sts	pr,@-r15
(2) 1643/ 6000AD6 :                     ; 		bsr	.do_piece
(2) 1644/ 6000AD6 :                     ; 		mov	#3,r5
(2) 1645/ 6000AD6 :                     ; 		add	#LAY_WIDTH,r13
(2) 1646/ 6000AD6 :                     ; 		add	r11,r3
(2) 1647/ 6000AD6 :                     ; 		bsr	.do_piece
(2) 1648/ 6000AD6 :                     ; 		mov	#3,r5
(2) 1649/ 6000AD6 :                     ; 		add	#LAY_WIDTH,r13
(2) 1650/ 6000AD6 :                     ; 		add	r11,r3
(2) 1651/ 6000AD6 :                     ; 		bsr	.do_piece
(2) 1652/ 6000AD6 :                     ; 		mov	#3,r5
(2) 1653/ 6000AD6 :                     ; 		lds	@r15+,pr
(2) 1654/ 6000AD6 :                     ; 		rts
(2) 1655/ 6000AD6 :                     ; 		nop
(2) 1656/ 6000AD6 :                     ; 		align 4
(2) 1657/ 6000AD6 :                     ; 		ltorg
(2) 1658/ 6000AD6 :                     ;
(2) 1659/ 6000AD6 :                     ; ; ------------------------------------------------
(2) 1660/ 6000AD6 :                     ; ; MarsMdl_Init
(2) 1661/ 6000AD6 :                     ; ;
(2) 1662/ 6000AD6 :                     ; ; Reset ALL objects
(2) 1663/ 6000AD6 :                     ; ; ------------------------------------------------
(2) 1664/ 6000AD6 :                     ;
(2) 1665/ 6000AD6 :                     ; MarsMdl_Init:
(2) 1666/ 6000AD6 :                     ; 		mov	#RAM_Mars_Objects,r1
(2) 1667/ 6000AD6 :                     ; 		mov	#MAX_MODELS,r2
(2) 1668/ 6000AD6 :                     ; 		mov	#0,r0
(2) 1669/ 6000AD6 :                     ; .clnup:
(2) 1670/ 6000AD6 :                     ; 		mov	r0,@(mdl_data,r1)
(2) 1671/ 6000AD6 :                     ; 		mov	r0,@(mdl_animdata,r1)
(2) 1672/ 6000AD6 :                     ; 		mov	r0,@(mdl_x_pos,r1)
(2) 1673/ 6000AD6 :                     ; 		mov	r0,@(mdl_x_rot,r1)
(2) 1674/ 6000AD6 :                     ; 		mov	r0,@(mdl_y_pos,r1)
(2) 1675/ 6000AD6 :                     ; 		mov	r0,@(mdl_y_rot,r1)
(2) 1676/ 6000AD6 :                     ; 		mov	r0,@(mdl_y_pos,r1)
(2) 1677/ 6000AD6 :                     ; 		mov	r0,@(mdl_y_rot,r1)
(2) 1678/ 6000AD6 :                     ; 		dt	r2
(2) 1679/ 6000AD6 :                     ; 		bf/s	.clnup
(2) 1680/ 6000AD6 :                     ; 		add	#sizeof_mdlobj,r1
(2) 1681/ 6000AD6 :                     ; 		rts
(2) 1682/ 6000AD6 :                     ; 		nop
(2) 1683/ 6000AD6 :                     ; 		align 4
(2) 1684/ 6000AD6 :                     ; 		ltorg
(2) 1685/ 6000AD6 :                     ;
(2) 1686/ 6000AD6 :                     ; ; ------------------------------------------------
(2) 1687/ 6000AD6 :                     ; ; Read model
(2) 1688/ 6000AD6 :                     ; ; ------------------------------------------------
(2) 1689/ 6000AD6 :                     ;
(2) 1690/ 6000AD6 :                     ; MarsMdl_ReadModel:
(2) 1691/ 6000AD6 :                     ; 		sts	pr,@-r15
(2) 1692/ 6000AD6 :                     ; 		mov	@(mdl_animdata,r14),r13
(2) 1693/ 6000AD6 :                     ; 		cmp/pl	r13
(2) 1694/ 6000AD6 :                     ; 		bf	.no_anim
(2) 1695/ 6000AD6 :                     ; 		mov	@(mdl_animtimer,r14),r0
(2) 1696/ 6000AD6 :                     ; 		add	#-1,r0
(2) 1697/ 6000AD6 :                     ; 		cmp/pl 	r0
(2) 1698/ 6000AD6 :                     ; 		bt	.wait_camanim
(2) 1699/ 6000AD6 :                     ; 		mov	@r13+,r2
(2) 1700/ 6000AD6 :                     ; 		mov	@(mdl_animframe,r14),r0
(2) 1701/ 6000AD6 :                     ; 		add	#1,r0
(2) 1702/ 6000AD6 :                     ; 		cmp/eq	r2,r0
(2) 1703/ 6000AD6 :                     ; 		bf	.on_frames
(2) 1704/ 6000AD6 :                     ; 		xor	r0,r0
(2) 1705/ 6000AD6 :                     ; .on_frames:
(2) 1706/ 6000AD6 :                     ; 		mov	r0,r1
(2) 1707/ 6000AD6 :                     ; 		mov	r0,@(mdl_animframe,r14)
(2) 1708/ 6000AD6 :                     ; 		mov	#$18,r0
(2) 1709/ 6000AD6 :                     ; 		mulu	r0,r1
(2) 1710/ 6000AD6 :                     ; 		sts	macl,r0
(2) 1711/ 6000AD6 :                     ; 		add	r0,r13
(2) 1712/ 6000AD6 :                     ; 		mov	@r13+,r1
(2) 1713/ 6000AD6 :                     ; 		mov	@r13+,r2
(2) 1714/ 6000AD6 :                     ; 		mov	@r13+,r3
(2) 1715/ 6000AD6 :                     ; 		mov	@r13+,r4
(2) 1716/ 6000AD6 :                     ; 		mov	@r13+,r5
(2) 1717/ 6000AD6 :                     ; 		mov	@r13+,r6
(2) 1718/ 6000AD6 :                     ; ; 		neg	r4,r4
(2) 1719/ 6000AD6 :                     ; 		mov	r1,@(mdl_x_pos,r14)
(2) 1720/ 6000AD6 :                     ; 		mov	r2,@(mdl_y_pos,r14)
(2) 1721/ 6000AD6 :                     ; 		mov	r3,@(mdl_z_pos,r14)
(2) 1722/ 6000AD6 :                     ; 		mov	r4,@(mdl_x_rot,r14)
(2) 1723/ 6000AD6 :                     ; 		mov	r5,@(mdl_y_rot,r14)
(2) 1724/ 6000AD6 :                     ; 		mov	r6,@(mdl_z_rot,r14)
(2) 1725/ 6000AD6 :                     ; 		mov	@(mdl_animspd,r14),r0		; TODO: make a timer setting
(2) 1726/ 6000AD6 :                     ; .wait_camanim:
(2) 1727/ 6000AD6 :                     ; 		mov	r0,@(mdl_animtimer,r14)
(2) 1728/ 6000AD6 :                     ; .no_anim:
(2) 1729/ 6000AD6 :                     ; 	; Now start reading
(2) 1730/ 6000AD6 :                     ; 		mov	#$3FFFFFFF,r0
(2) 1731/ 6000AD6 :                     ; 		mov	#Cach_CurrPlygn,r13		; r13 - temporal face output
(2) 1732/ 6000AD6 :                     ; 		mov	@(mdl_data,r14),r12		; r12 - model header
(2) 1733/ 6000AD6 :                     ; 		and	r0,r12
(2) 1734/ 6000AD6 :                     ; 		mov 	@(8,r12),r11			; r11 - face data
(2) 1735/ 6000AD6 :                     ; 		mov 	@(4,r12),r10			; r10 - vertice data (X,Y,Z)
(2) 1736/ 6000AD6 :                     ; 		mov.w	@r12,r9				;  r9 - Number of faces used on model
(2) 1737/ 6000AD6 :                     ; 		mov	@(marsGbl_CurrZList,gbr),r0	;  r8 - Zlist for sorting
(2) 1738/ 6000AD6 :                     ; 		mov	r0,r8
(2) 1739/ 6000AD6 :                     ; .next_face:
(2) 1740/ 6000AD6 :                     ; 		mov.w	@(marsGbl_MdlFacesCntr,gbr),r0	; Ran out of space to store faces?
(2) 1741/ 6000AD6 :                     ; 		mov	.tag_maxfaces,r1
(2) 1742/ 6000AD6 :                     ; 		cmp/ge	r1,r0
(2) 1743/ 6000AD6 :                     ; 		bf	.can_build
(2) 1744/ 6000AD6 :                     ; 		bra	.exit_model
(2) 1745/ 6000AD6 :                     ; 		nop
(2) 1746/ 6000AD6 :                     ; 		align 4
(2) 1747/ 6000AD6 :                     ; .tag_maxfaces:	dc.l	MAX_FACES
(2) 1748/ 6000AD6 :                     ;
(2) 1749/ 6000AD6 :                     ; ; --------------------------------
(2) 1750/ 6000AD6 :                     ;
(2) 1751/ 6000AD6 :                     ; .can_build:
(2) 1752/ 6000AD6 :                     ; 		mov.w	@r11+,r4		; Read type
(2) 1753/ 6000AD6 :                     ; 		mov	#3,r7			; r7 - Current polygon type: triangle (3)
(2) 1754/ 6000AD6 :                     ; 		mov	r4,r0
(2) 1755/ 6000AD6 :                     ; 		shlr8	r0
(2) 1756/ 6000AD6 :                     ; 		tst	#PLGN_TRI,r0		; Model face uses triangle?
(2) 1757/ 6000AD6 :                     ; 		bf	.set_tri
(2) 1758/ 6000AD6 :                     ; 		add	#1,r7			; Face is quad, r7 = 4 points
(2) 1759/ 6000AD6 :                     ; .set_tri:
(2) 1760/ 6000AD6 :                     ; 		cmp/pl	r4			; Faces uses texture? ($8xxx)
(2) 1761/ 6000AD6 :                     ; 		bt	.solid_type
(2) 1762/ 6000AD6 :                     ;
(2) 1763/ 6000AD6 :                     ; ; --------------------------------
(2) 1764/ 6000AD6 :                     ; ; Set texture material
(2) 1765/ 6000AD6 :                     ; ; --------------------------------
(2) 1766/ 6000AD6 :                     ;
(2) 1767/ 6000AD6 :                     ; 		mov	@($C,r12),r6		; r6 - Material data
(2) 1768/ 6000AD6 :                     ; 		mov	r13,r5			; r5 - Go to UV section
(2) 1769/ 6000AD6 :                     ; 		add 	#polygn_srcpnts,r5
(2) 1770/ 6000AD6 :                     ; 		mov	r7,r3			; r3 - copy of current face points (3 or 4)
(2) 1771/ 6000AD6 :                     ;
(2) 1772/ 6000AD6 :                     ; 	; New method
(2) 1773/ 6000AD6 :                     ; 	rept 3
(2) 1774/ 6000AD6 :                     ; 		mov.w	@r11+,r0			; Read UV index
(2) 1775/ 6000AD6 :                     ; 		extu	r0,r0
(2) 1776/ 6000AD6 :                     ; 		shll2	r0
(2) 1777/ 6000AD6 :                     ; 		mov	@(r6,r0),r0
(2) 1778/ 6000AD6 :                     ; 		mov.w	r0,@(2,r5)
(2) 1779/ 6000AD6 :                     ; 		shlr16	r0
(2) 1780/ 6000AD6 :                     ; 		mov.w	r0,@r5
(2) 1781/ 6000AD6 :                     ; 		add	#4,r5
(2) 1782/ 6000AD6 :                     ; 	endm
(2) 1783/ 6000AD6 :                     ; 		mov	#3,r0			; Triangle?
(2) 1784/ 6000AD6 :                     ; 		cmp/eq	r0,r7
(2) 1785/ 6000AD6 :                     ; 		bt	.alluvdone		; If yes, skip this
(2) 1786/ 6000AD6 :                     ; 		mov.w	@r11+,r0		; Read extra UV index
(2) 1787/ 6000AD6 :                     ; 		extu	r0,r0
(2) 1788/ 6000AD6 :                     ; 		shll2	r0
(2) 1789/ 6000AD6 :                     ; 		mov	@(r6,r0),r0
(2) 1790/ 6000AD6 :                     ; 		mov.w	r0,@(2,r5)
(2) 1791/ 6000AD6 :                     ; 		shlr16	r0
(2) 1792/ 6000AD6 :                     ; 		mov.w	r0,@r5
(2) 1793/ 6000AD6 :                     ; .alluvdone:
(2) 1794/ 6000AD6 :                     ;
(2) 1795/ 6000AD6 :                     ; 		mov	@(mdl_option,r14),r0
(2) 1796/ 6000AD6 :                     ; 		and	#$FF,r0
(2) 1797/ 6000AD6 :                     ; 		mov	r0,r1
(2) 1798/ 6000AD6 :                     ; 		mov	r4,r0
(2) 1799/ 6000AD6 :                     ; 		mov	.tag_andmtrl,r5
(2) 1800/ 6000AD6 :                     ; 		and	r5,r0
(2) 1801/ 6000AD6 :                     ; 		shll2	r0
(2) 1802/ 6000AD6 :                     ; 		shll	r0
(2) 1803/ 6000AD6 :                     ; 		mov	@($10,r12),r6
(2) 1804/ 6000AD6 :                     ; 		add	r0,r6
(2) 1805/ 6000AD6 :                     ; 		mov	#$E000,r0		; grab special bits
(2) 1806/ 6000AD6 :                     ; 		and	r0,r4
(2) 1807/ 6000AD6 :                     ; 		shll16	r4
(2) 1808/ 6000AD6 :                     ; 		mov	@(4,r6),r0
(2) 1809/ 6000AD6 :                     ; 		or	r0,r4
(2) 1810/ 6000AD6 :                     ; 		add	r1,r4
(2) 1811/ 6000AD6 :                     ; 		mov	r4,@(polygn_type,r13)
(2) 1812/ 6000AD6 :                     ; 		mov	@r6,r0
(2) 1813/ 6000AD6 :                     ; 		mov	r0,@(polygn_mtrl,r13)
(2) 1814/ 6000AD6 :                     ; 		bra	.go_faces
(2) 1815/ 6000AD6 :                     ; 		nop
(2) 1816/ 6000AD6 :                     ; 		align 4
(2) 1817/ 6000AD6 :                     ; .tag_andmtrl:
(2) 1818/ 6000AD6 :                     ; 		dc.l $1FFF
(2) 1819/ 6000AD6 :                     ;
(2) 1820/ 6000AD6 :                     ; ; --------------------------------
(2) 1821/ 6000AD6 :                     ; ; Set texture material
(2) 1822/ 6000AD6 :                     ; ; --------------------------------
(2) 1823/ 6000AD6 :                     ;
(2) 1824/ 6000AD6 :                     ; .solid_type:
(2) 1825/ 6000AD6 :                     ; 		mov	@(mdl_option,r14),r0
(2) 1826/ 6000AD6 :                     ; 		and	#$FF,r0
(2) 1827/ 6000AD6 :                     ; 		mov	r0,r1
(2) 1828/ 6000AD6 :                     ; 		mov	r4,r0
(2) 1829/ 6000AD6 :                     ; 		mov	#$E000,r5
(2) 1830/ 6000AD6 :                     ; 		and	r5,r4
(2) 1831/ 6000AD6 :                     ; 		shll16	r4
(2) 1832/ 6000AD6 :                     ; 		add	r1,r4
(2) 1833/ 6000AD6 :                     ; 		mov	r4,@(polygn_type,r13)		; Set type 0 (tri) or quad (1)
(2) 1834/ 6000AD6 :                     ; 		and	#$FF,r0
(2) 1835/ 6000AD6 :                     ; 		mov	r0,@(polygn_mtrl,r13)		; Set pixel color (0-255)
(2) 1836/ 6000AD6 :                     ;
(2) 1837/ 6000AD6 :                     ; ; --------------------------------
(2) 1838/ 6000AD6 :                     ; ; Read faces
(2) 1839/ 6000AD6 :                     ; ; --------------------------------
(2) 1840/ 6000AD6 :                     ;
(2) 1841/ 6000AD6 :                     ; .go_faces:
(2) 1842/ 6000AD6 :                     ; 		mov	r13,r1
(2) 1843/ 6000AD6 :                     ; 		add 	#polygn_points,r1
(2) 1844/ 6000AD6 :                     ; 		mov	r11,r6
(2) 1845/ 6000AD6 :                     ; 		mov	r7,r0
(2) 1846/ 6000AD6 :                     ; 		shll	r0
(2) 1847/ 6000AD6 :                     ; 		add	r0,r11
(2) 1848/ 6000AD6 :                     ; 		mov 	r8,@-r15
(2) 1849/ 6000AD6 :                     ; 		mov 	r9,@-r15
(2) 1850/ 6000AD6 :                     ; 		mov 	r11,@-r15
(2) 1851/ 6000AD6 :                     ; 		mov 	r12,@-r15
(2) 1852/ 6000AD6 :                     ; 		mov 	r13,@-r15
(2) 1853/ 6000AD6 :                     ; 		mov	.tag_xl,r8
(2) 1854/ 6000AD6 :                     ; 		neg	r8,r9
(2) 1855/ 6000AD6 :                     ; 		mov	#-112,r11
(2) 1856/ 6000AD6 :                     ; 		neg	r11,r12
(2) 1857/ 6000AD6 :                     ; 		mov	#$7FFFFFFF,r5
(2) 1858/ 6000AD6 :                     ; 		mov	#$FFFFFFFF,r13
(2) 1859/ 6000AD6 :                     ;
(2) 1860/ 6000AD6 :                     ; 	; Do 3 points
(2) 1861/ 6000AD6 :                     ; 	rept 3
(2) 1862/ 6000AD6 :                     ; 		mov	#0,r0
(2) 1863/ 6000AD6 :                     ; 		mov.w 	@r6+,r0
(2) 1864/ 6000AD6 :                     ; 		mov	#$C,r4
(2) 1865/ 6000AD6 :                     ; 		mulu	r4,r0
(2) 1866/ 6000AD6 :                     ; 		sts	macl,r0
(2) 1867/ 6000AD6 :                     ; 		mov	r10,r4
(2) 1868/ 6000AD6 :                     ; 		add 	r0,r4
(2) 1869/ 6000AD6 :                     ; 		mov	@r4,r2
(2) 1870/ 6000AD6 :                     ; 		mov	@(4,r4),r3
(2) 1871/ 6000AD6 :                     ; 		mov	@(8,r4),r4
(2) 1872/ 6000AD6 :                     ; 		bsr	mdlrd_setpoint
(2) 1873/ 6000AD6 :                     ; 		nop
(2) 1874/ 6000AD6 :                     ; 		mov	r2,@r1
(2) 1875/ 6000AD6 :                     ; 		mov	r3,@(4,r1)
(2) 1876/ 6000AD6 :                     ; 		add	#8,r1
(2) 1877/ 6000AD6 :                     ; 	endm
(2) 1878/ 6000AD6 :                     ; 		mov	#3,r0			; Triangle?
(2) 1879/ 6000AD6 :                     ; 		cmp/eq	r0,r7
(2) 1880/ 6000AD6 :                     ; 		bt	.alldone		; If yes, skip this
(2) 1881/ 6000AD6 :                     ; 		mov	#0,r0
(2) 1882/ 6000AD6 :                     ; 		mov.w 	@r6+,r0
(2) 1883/ 6000AD6 :                     ; 		mov	#$C,r4
(2) 1884/ 6000AD6 :                     ; 		mulu	r4,r0
(2) 1885/ 6000AD6 :                     ; 		sts	macl,r0
(2) 1886/ 6000AD6 :                     ; 		mov	r10,r4
(2) 1887/ 6000AD6 :                     ; 		add 	r0,r4
(2) 1888/ 6000AD6 :                     ; 		mov	@r4,r2
(2) 1889/ 6000AD6 :                     ; 		mov	@(4,r4),r3
(2) 1890/ 6000AD6 :                     ; 		mov	@(8,r4),r4
(2) 1891/ 6000AD6 :                     ; 		bsr	mdlrd_setpoint
(2) 1892/ 6000AD6 :                     ; 		nop
(2) 1893/ 6000AD6 :                     ; 		mov	r2,@r1
(2) 1894/ 6000AD6 :                     ; 		mov	r3,@(4,r1)
(2) 1895/ 6000AD6 :                     ; .alldone:
(2) 1896/ 6000AD6 :                     ; 		mov	r8,r1
(2) 1897/ 6000AD6 :                     ; 		mov	r9,r2
(2) 1898/ 6000AD6 :                     ; 		mov	r11,r3
(2) 1899/ 6000AD6 :                     ; 		mov	r12,r4
(2) 1900/ 6000AD6 :                     ; 		mov	r13,r6
(2) 1901/ 6000AD6 :                     ; 		mov	@r15+,r13
(2) 1902/ 6000AD6 :                     ; 		mov	@r15+,r12
(2) 1903/ 6000AD6 :                     ; 		mov	@r15+,r11
(2) 1904/ 6000AD6 :                     ; 		mov	@r15+,r9
(2) 1905/ 6000AD6 :                     ; 		mov	@r15+,r8
(2) 1906/ 6000AD6 :                     ;
(2) 1907/ 6000AD6 :                     ; 	; NOTE: if you don't like how the perspective works
(2) 1908/ 6000AD6 :                     ; 	; change this register depending how you want to ignore
(2) 1909/ 6000AD6 :                     ; 	; faces closer to the camera:
(2) 1910/ 6000AD6 :                     ; 	;
(2) 1911/ 6000AD6 :                     ; 	; r5 - Back Z point, keep affine limitations
(2) 1912/ 6000AD6 :                     ; 	; r6 - Front Z point, skip face but larger faces are affected
(2) 1913/ 6000AD6 :                     ;
(2) 1914/ 6000AD6 :                     ; 		cmp/pz	r5
(2) 1915/ 6000AD6 :                     ; 		bt	.go_fout
(2) 1916/ 6000AD6 :                     ; ; 		cmp/pz	r6
(2) 1917/ 6000AD6 :                     ; ; 		bt	.go_fout
(2) 1918/ 6000AD6 :                     ;
(2) 1919/ 6000AD6 :                     ;
(2) 1920/ 6000AD6 :                     ; ; 		mov	#RAM_Mars_ObjCamera,r0
(2) 1921/ 6000AD6 :                     ; ; 		mov	@(cam_y_pos,r0),r7
(2) 1922/ 6000AD6 :                     ; ; 		shlr2	r7
(2) 1923/ 6000AD6 :                     ; ; 		shlr2	r7
(2) 1924/ 6000AD6 :                     ; ; 		shlr2	r7
(2) 1925/ 6000AD6 :                     ; ; 		shlr	r7
(2) 1926/ 6000AD6 :                     ; ; 		exts	r7,r7
(2) 1927/ 6000AD6 :                     ; ; 		cmp/pl	r7
(2) 1928/ 6000AD6 :                     ; ; 		bf	.revrscam
(2) 1929/ 6000AD6 :                     ; ; 		neg	r7,r7
(2) 1930/ 6000AD6 :                     ; ; .revrscam:
(2) 1931/ 6000AD6 :                     ; ; 		mov	#MAX_ZDIST,r0
(2) 1932/ 6000AD6 :                     ; ; 		cmp/ge	r0,r7
(2) 1933/ 6000AD6 :                     ; ; 		bt	.camlimit
(2) 1934/ 6000AD6 :                     ; ; 		mov	r0,r7
(2) 1935/ 6000AD6 :                     ; ; .camlimit:
(2) 1936/ 6000AD6 :                     ; ; 		cmp/pl	r6
(2) 1937/ 6000AD6 :                     ; ; 		bt	.face_out
(2) 1938/ 6000AD6 :                     ; 		mov	#MAX_ZDIST,r0		; Draw distance
(2) 1939/ 6000AD6 :                     ; ; 		add 	r7,r0
(2) 1940/ 6000AD6 :                     ; 		cmp/ge	r0,r5
(2) 1941/ 6000AD6 :                     ; 		bf	.go_fout
(2) 1942/ 6000AD6 :                     ; 		mov	#-(SCREEN_WIDTH/2),r0
(2) 1943/ 6000AD6 :                     ; 		cmp/gt	r0,r1
(2) 1944/ 6000AD6 :                     ; 		bf	.go_fout
(2) 1945/ 6000AD6 :                     ; 		neg	r0,r0
(2) 1946/ 6000AD6 :                     ; 		cmp/ge	r0,r2
(2) 1947/ 6000AD6 :                     ; 		bt	.go_fout
(2) 1948/ 6000AD6 :                     ; 		mov	#-(SCREEN_HEIGHT/2),r0
(2) 1949/ 6000AD6 :                     ; 		cmp/gt	r0,r3
(2) 1950/ 6000AD6 :                     ; 		bf	.go_fout
(2) 1951/ 6000AD6 :                     ; 		neg	r0,r0
(2) 1952/ 6000AD6 :                     ; 		cmp/ge	r0,r4
(2) 1953/ 6000AD6 :                     ; 		bf	.face_ok
(2) 1954/ 6000AD6 :                     ; .go_fout:	bra	.face_out
(2) 1955/ 6000AD6 :                     ; 		nop
(2) 1956/ 6000AD6 :                     ; 		align 4
(2) 1957/ 6000AD6 :                     ; .tag_xl:	dc.l -160
(2) 1958/ 6000AD6 :                     ;
(2) 1959/ 6000AD6 :                     ; ; --------------------------------
(2) 1960/ 6000AD6 :                     ;
(2) 1961/ 6000AD6 :                     ; .face_ok:
(2) 1962/ 6000AD6 :                     ; 		mov.w	@(marsGbl_MdlFacesCntr,gbr),r0	; Add 1 face to the list
(2) 1963/ 6000AD6 :                     ; 		add	#1,r0
(2) 1964/ 6000AD6 :                     ; 		mov.w	r0,@(marsGbl_MdlFacesCntr,gbr)
(2) 1965/ 6000AD6 :                     ; 		mov	@(marsGbl_CurrFacePos,gbr),r0
(2) 1966/ 6000AD6 :                     ; 		mov	r0,r1
(2) 1967/ 6000AD6 :                     ; 		mov	r13,r2
(2) 1968/ 6000AD6 :                     ; 		mov	r5,@r8				; Store current Z to Zlist
(2) 1969/ 6000AD6 :                     ; 		mov	r1,@(4,r8)			; And it's address
(2) 1970/ 6000AD6 :                     ;
(2) 1971/ 6000AD6 :                     ; ; 	Sort this face, SLOW
(2) 1972/ 6000AD6 :                     ; ; 	r7 - Curr Z
(2) 1973/ 6000AD6 :                     ; ; 	r6 - Past Z
(2) 1974/ 6000AD6 :                     ; 		mov.w	@(marsGbl_MdlFacesCntr,gbr),r0
(2) 1975/ 6000AD6 :                     ; 		cmp/eq	#1,r0
(2) 1976/ 6000AD6 :                     ; 		bt	.first_face
(2) 1977/ 6000AD6 :                     ; 		cmp/eq	#2,r0
(2) 1978/ 6000AD6 :                     ; 		bt	.first_face
(2) 1979/ 6000AD6 :                     ; 		mov	r8,r7
(2) 1980/ 6000AD6 :                     ; 		add	#-8,r7
(2) 1981/ 6000AD6 :                     ; ; 		mov	@(marsGbl_CurrZList,gbr),r0
(2) 1982/ 6000AD6 :                     ; ; 		mov	r0,r6
(2) 1983/ 6000AD6 :                     ; 		mov	#RAM_Mars_Plgn_ZList_0,r6
(2) 1984/ 6000AD6 :                     ; 		mov.w   @(marsGbl_PlgnBuffNum,gbr),r0
(2) 1985/ 6000AD6 :                     ; 		tst     #1,r0
(2) 1986/ 6000AD6 :                     ; 		bt	.page_2
(2) 1987/ 6000AD6 :                     ; 		mov	#RAM_Mars_Plgn_ZList_1,r6
(2) 1988/ 6000AD6 :                     ; .page_2:
(2) 1989/ 6000AD6 :                     ; 		cmp/ge	r6,r7
(2) 1990/ 6000AD6 :                     ; 		bf	.first_face
(2) 1991/ 6000AD6 :                     ; 		mov	@(8,r7),r4
(2) 1992/ 6000AD6 :                     ; 		mov	@r7,r5
(2) 1993/ 6000AD6 :                     ; 		cmp/eq	r4,r5
(2) 1994/ 6000AD6 :                     ; 		bt	.first_face
(2) 1995/ 6000AD6 :                     ; 		cmp/gt	r4,r5
(2) 1996/ 6000AD6 :                     ; 		bf	.swap_me
(2) 1997/ 6000AD6 :                     ; 		mov	@r7,r4
(2) 1998/ 6000AD6 :                     ; 		mov	@(8,r7),r5
(2) 1999/ 6000AD6 :                     ; 		mov	r5,@r7
(2) 2000/ 6000AD6 :                     ; 		mov	r4,@(8,r7)
(2) 2001/ 6000AD6 :                     ; 		mov	@(4,r7),r4
(2) 2002/ 6000AD6 :                     ; 		mov	@($C,r7),r5
(2) 2003/ 6000AD6 :                     ; 		mov	r5,@(4,r7)
(2) 2004/ 6000AD6 :                     ; 		mov	r4,@($C,r7)
(2) 2005/ 6000AD6 :                     ; .swap_me:
(2) 2006/ 6000AD6 :                     ; 		bra	.page_2
(2) 2007/ 6000AD6 :                     ; 		add	#-8,r7
(2) 2008/ 6000AD6 :                     ; .first_face:
(2) 2009/ 6000AD6 :                     ;
(2) 2010/ 6000AD6 :                     ;
(2) 2011/ 6000AD6 :                     ; 		add	#8,r8				; Next Zlist entry
(2) 2012/ 6000AD6 :                     ; 	rept sizeof_polygn/2				; Copy words manually
(2) 2013/ 6000AD6 :                     ; 		mov.w	@r2+,r0
(2) 2014/ 6000AD6 :                     ; 		mov.w	r0,@r1
(2) 2015/ 6000AD6 :                     ; 		add	#2,r1
(2) 2016/ 6000AD6 :                     ; 	endm
(2) 2017/ 6000AD6 :                     ; 		mov	r1,r0
(2) 2018/ 6000AD6 :                     ; 		mov	r0,@(marsGbl_CurrFacePos,gbr)
(2) 2019/ 6000AD6 :                     ;
(2) 2020/ 6000AD6 :                     ; ; 		mov	r0,r1
(2) 2021/ 6000AD6 :                     ; ; 		mov	@(marsGbl_ZSortReq,gbr),r0
(2) 2022/ 6000AD6 :                     ; ; 		cmp/eq	#1,r0
(2) 2023/ 6000AD6 :                     ; ; 		bt	.face_out
(2) 2024/ 6000AD6 :                     ; ; 		mov	#1,r0
(2) 2025/ 6000AD6 :                     ; ; 		mov.w	r0,@(marsGbl_ZSortReq,gbr)
(2) 2026/ 6000AD6 :                     ; .face_out:
(2) 2027/ 6000AD6 :                     ; 		dt	r9
(2) 2028/ 6000AD6 :                     ; 		bt	.finish_this
(2) 2029/ 6000AD6 :                     ; 		bra	.next_face
(2) 2030/ 6000AD6 :                     ; 		nop
(2) 2031/ 6000AD6 :                     ; .finish_this:
(2) 2032/ 6000AD6 :                     ; 		mov	r8,r0
(2) 2033/ 6000AD6 :                     ; 		mov	r0,@(marsGbl_CurrZList,gbr)
(2) 2034/ 6000AD6 :                     ;
(2) 2035/ 6000AD6 :                     ; .exit_model:
(2) 2036/ 6000AD6 :                     ; 		lds	@r15+,pr
(2) 2037/ 6000AD6 :                     ; 		rts
(2) 2038/ 6000AD6 :                     ; 		nop
(2) 2039/ 6000AD6 :                     ; 		align 4
(2) 2040/ 6000AD6 :                     ; 		ltorg
(2) 2041/ 6000AD6 :                     ;
(2) 2042/ 6000AD6 :                     ; ; ----------------------------------------
(2) 2043/ 6000AD6 :                     ; ; Modify position to current point
(2) 2044/ 6000AD6 :                     ; ; ----------------------------------------
(2) 2045/ 6000AD6 :                     ;
(2) 2046/ 6000AD6 :                     ; 		align 4
(2) 2047/ 6000AD6 :                     ; mdlrd_setpoint:
(2) 2048/ 6000AD6 :                     ; 		sts	pr,@-r15
(2) 2049/ 6000AD6 :                     ; 		mov 	r5,@-r15
(2) 2050/ 6000AD6 :                     ; 		mov 	r6,@-r15
(2) 2051/ 6000AD6 :                     ; 		mov 	r7,@-r15
(2) 2052/ 6000AD6 :                     ; 		mov 	r8,@-r15
(2) 2053/ 6000AD6 :                     ; 		mov 	r9,@-r15
(2) 2054/ 6000AD6 :                     ; 		mov 	r10,@-r15
(2) 2055/ 6000AD6 :                     ; 		mov 	r11,@-r15
(2) 2056/ 6000AD6 :                     ;
(2) 2057/ 6000AD6 :                     ; 	; Object rotation
(2) 2058/ 6000AD6 :                     ; 		mov	r2,r5			; r5 - X
(2) 2059/ 6000AD6 :                     ; 		mov	r4,r6			; r6 - Z
(2) 2060/ 6000AD6 :                     ;   		mov 	@(mdl_x_rot,r14),r0
(2) 2061/ 6000AD6 :                     ;   		shlr2	r0
(2) 2062/ 6000AD6 :                     ;   		shlr	r0
(2) 2063/ 6000AD6 :                     ;   		bsr	mdlrd_rotate
(2) 2064/ 6000AD6 :                     ; 		shlr8	r0
(2) 2065/ 6000AD6 :                     ;    		mov	r7,r2
(2) 2066/ 6000AD6 :                     ;    		mov	r3,r5
(2) 2067/ 6000AD6 :                     ;   		mov	r8,r6
(2) 2068/ 6000AD6 :                     ;   		mov 	@(mdl_y_rot,r14),r0
(2) 2069/ 6000AD6 :                     ;   		shlr2	r0
(2) 2070/ 6000AD6 :                     ;   		shlr	r0
(2) 2071/ 6000AD6 :                     ;   		bsr	mdlrd_rotate
(2) 2072/ 6000AD6 :                     ; 		shlr8	r0
(2) 2073/ 6000AD6 :                     ;    		mov	r8,r4
(2) 2074/ 6000AD6 :                     ;    		mov	r2,r5
(2) 2075/ 6000AD6 :                     ;    		mov	r7,r6
(2) 2076/ 6000AD6 :                     ;    		mov 	@(mdl_z_rot,r14),r0
(2) 2077/ 6000AD6 :                     ;   		shlr2	r0
(2) 2078/ 6000AD6 :                     ;   		shlr	r0
(2) 2079/ 6000AD6 :                     ;   		bsr	mdlrd_rotate
(2) 2080/ 6000AD6 :                     ; 		shlr8	r0
(2) 2081/ 6000AD6 :                     ;    		mov	r7,r2
(2) 2082/ 6000AD6 :                     ;    		mov	r8,r3
(2) 2083/ 6000AD6 :                     ; 		mov	@(mdl_x_pos,r14),r5
(2) 2084/ 6000AD6 :                     ; 		mov	@(mdl_y_pos,r14),r6
(2) 2085/ 6000AD6 :                     ; 		mov	@(mdl_z_pos,r14),r7
(2) 2086/ 6000AD6 :                     ; 		shlr8	r5
(2) 2087/ 6000AD6 :                     ; 		shlr8	r6
(2) 2088/ 6000AD6 :                     ; 		shlr8	r7
(2) 2089/ 6000AD6 :                     ; 		exts	r5,r5
(2) 2090/ 6000AD6 :                     ; 		exts	r6,r6
(2) 2091/ 6000AD6 :                     ; 		exts	r7,r7
(2) 2092/ 6000AD6 :                     ; 		add 	r5,r2
(2) 2093/ 6000AD6 :                     ; 		add 	r6,r3
(2) 2094/ 6000AD6 :                     ; 		add 	r7,r4
(2) 2095/ 6000AD6 :                     ;
(2) 2096/ 6000AD6 :                     ; 	; Include camera changes
(2) 2097/ 6000AD6 :                     ; 		mov 	#RAM_Mars_ObjCamera,r11
(2) 2098/ 6000AD6 :                     ; 		mov	@(cam_x_pos,r11),r5
(2) 2099/ 6000AD6 :                     ; 		mov	@(cam_y_pos,r11),r6
(2) 2100/ 6000AD6 :                     ; 		mov	@(cam_z_pos,r11),r7
(2) 2101/ 6000AD6 :                     ; 		mov	@(mdl_data,r14),r0		; Layout object?
(2) 2102/ 6000AD6 :                     ; 		shll	r0
(2) 2103/ 6000AD6 :                     ; 		cmp/pl	r0
(2) 2104/ 6000AD6 :                     ; 		bt	.lay_move
(2) 2105/ 6000AD6 :                     ; 		mov	#$FFFFF,r0			; Limit camera movement
(2) 2106/ 6000AD6 :                     ; 		and	r0,r5
(2) 2107/ 6000AD6 :                     ; ; 		and	r0,r6
(2) 2108/ 6000AD6 :                     ; 		and	r0,r7
(2) 2109/ 6000AD6 :                     ; .lay_move:
(2) 2110/ 6000AD6 :                     ; 		shlr8	r5
(2) 2111/ 6000AD6 :                     ; 		shlr8	r6
(2) 2112/ 6000AD6 :                     ; 		shlr8	r7
(2) 2113/ 6000AD6 :                     ; 		exts	r5,r5
(2) 2114/ 6000AD6 :                     ; 		exts	r6,r6
(2) 2115/ 6000AD6 :                     ; 		exts	r7,r7
(2) 2116/ 6000AD6 :                     ; 		sub 	r5,r2
(2) 2117/ 6000AD6 :                     ; 		sub 	r6,r3
(2) 2118/ 6000AD6 :                     ; 		add 	r7,r4
(2) 2119/ 6000AD6 :                     ;
(2) 2120/ 6000AD6 :                     ; 		mov	r2,r5
(2) 2121/ 6000AD6 :                     ; 		mov	r4,r6
(2) 2122/ 6000AD6 :                     ;   		mov 	@(cam_x_rot,r11),r0
(2) 2123/ 6000AD6 :                     ;   		shlr2	r0
(2) 2124/ 6000AD6 :                     ;   		shlr	r0
(2) 2125/ 6000AD6 :                     ;   		bsr	mdlrd_rotate
(2) 2126/ 6000AD6 :                     ; 		shlr8	r0
(2) 2127/ 6000AD6 :                     ;    		mov	r7,r2
(2) 2128/ 6000AD6 :                     ;    		mov	r8,r4
(2) 2129/ 6000AD6 :                     ;    		mov	r3,r5
(2) 2130/ 6000AD6 :                     ;   		mov	r8,r6
(2) 2131/ 6000AD6 :                     ;   		mov 	@(cam_y_rot,r11),r0
(2) 2132/ 6000AD6 :                     ;   		shlr2	r0
(2) 2133/ 6000AD6 :                     ;   		shlr	r0
(2) 2134/ 6000AD6 :                     ;   		bsr	mdlrd_rotate
(2) 2135/ 6000AD6 :                     ; 		shlr8	r0
(2) 2136/ 6000AD6 :                     ;    		mov	r8,r4
(2) 2137/ 6000AD6 :                     ;    		mov	r2,r5
(2) 2138/ 6000AD6 :                     ;    		mov	r7,r6
(2) 2139/ 6000AD6 :                     ;    		mov 	@(cam_z_rot,r11),r0
(2) 2140/ 6000AD6 :                     ;   		shlr2	r0
(2) 2141/ 6000AD6 :                     ;   		shlr	r0
(2) 2142/ 6000AD6 :                     ;   		bsr	mdlrd_rotate
(2) 2143/ 6000AD6 :                     ; 		shlr8	r0
(2) 2144/ 6000AD6 :                     ;    		mov	r7,r2
(2) 2145/ 6000AD6 :                     ;    		mov	r8,r3
(2) 2146/ 6000AD6 :                     ;
(2) 2147/ 6000AD6 :                     ; ; 		mov	#-(SCREEN_WIDTH/2)<<4,r6
(2) 2148/ 6000AD6 :                     ; ; 		cmp/ge	r6,r2
(2) 2149/ 6000AD6 :                     ; ; 		bf	.x_forz
(2) 2150/ 6000AD6 :                     ; ; 		neg	r6,r6
(2) 2151/ 6000AD6 :                     ; ; 		cmp/ge	r6,r2
(2) 2152/ 6000AD6 :                     ; ; 		bf	.x_rsd
(2) 2153/ 6000AD6 :                     ; ; .x_forz:
(2) 2154/ 6000AD6 :                     ; ; 		mov	r6,r2
(2) 2155/ 6000AD6 :                     ; ; .x_rsd:
(2) 2156/ 6000AD6 :                     ;
(2) 2157/ 6000AD6 :                     ; ; 		mov	#-(SCREEN_HEIGHT/2),r6
(2) 2158/ 6000AD6 :                     ; ; 		cmp/ge	r6,r3
(2) 2159/ 6000AD6 :                     ; ; 		bf	.y_forz
(2) 2160/ 6000AD6 :                     ; ; 		neg	r6,r6
(2) 2161/ 6000AD6 :                     ; ; 		cmp/ge	r6,r3
(2) 2162/ 6000AD6 :                     ; ; 		bf	.y_rsd
(2) 2163/ 6000AD6 :                     ; ; .y_forz:
(2) 2164/ 6000AD6 :                     ; ; 		mov	r6,r3
(2) 2165/ 6000AD6 :                     ; ; .y_rsd:
(2) 2166/ 6000AD6 :                     ;
(2) 2167/ 6000AD6 :                     ; 	; Weak perspective projection
(2) 2168/ 6000AD6 :                     ; 	; this is the best I got,
(2) 2169/ 6000AD6 :                     ; 	; It breaks on large faces
(2) 2170/ 6000AD6 :                     ; 		mov 	#_JR,r8
(2) 2171/ 6000AD6 :                     ; 		mov	#320<<16,r7
(2) 2172/ 6000AD6 :                     ; 		neg	r4,r0		; reverse Z
(2) 2173/ 6000AD6 :                     ; ; 		add	#-16,r0
(2) 2174/ 6000AD6 :                     ; 		cmp/pl	r0
(2) 2175/ 6000AD6 :                     ; 		bt	.inside
(2) 2176/ 6000AD6 :                     ; 		shlr	r7
(2) 2177/ 6000AD6 :                     ;
(2) 2178/ 6000AD6 :                     ; 		dmuls	r7,r2
(2) 2179/ 6000AD6 :                     ; 		sts	mach,r0
(2) 2180/ 6000AD6 :                     ; 		sts	macl,r2
(2) 2181/ 6000AD6 :                     ; 		xtrct	r0,r2
(2) 2182/ 6000AD6 :                     ; 		dmuls	r7,r3
(2) 2183/ 6000AD6 :                     ; 		sts	mach,r0
(2) 2184/ 6000AD6 :                     ; 		sts	macl,r3
(2) 2185/ 6000AD6 :                     ; 		xtrct	r0,r3
(2) 2186/ 6000AD6 :                     ; 		bra	.zmulti
(2) 2187/ 6000AD6 :                     ; 		nop
(2) 2188/ 6000AD6 :                     ; .inside:
(2) 2189/ 6000AD6 :                     ; 		mov 	r0,@r8
(2) 2190/ 6000AD6 :                     ; 		mov 	r7,@(4,r8)
(2) 2191/ 6000AD6 :                     ; 		nop
(2) 2192/ 6000AD6 :                     ; 		mov 	@(4,r8),r7
(2) 2193/ 6000AD6 :                     ; 		dmuls	r7,r2
(2) 2194/ 6000AD6 :                     ; 		sts	mach,r0
(2) 2195/ 6000AD6 :                     ; 		sts	macl,r2
(2) 2196/ 6000AD6 :                     ; 		xtrct	r0,r2
(2) 2197/ 6000AD6 :                     ; 		dmuls	r7,r3
(2) 2198/ 6000AD6 :                     ; 		sts	mach,r0
(2) 2199/ 6000AD6 :                     ; 		sts	macl,r3
(2) 2200/ 6000AD6 :                     ; 		xtrct	r0,r3
(2) 2201/ 6000AD6 :                     ; .zmulti:
(2) 2202/ 6000AD6 :                     ;
(2) 2203/ 6000AD6 :                     ; 		mov	@r15+,r11
(2) 2204/ 6000AD6 :                     ; 		mov	@r15+,r10
(2) 2205/ 6000AD6 :                     ; 		mov	@r15+,r9
(2) 2206/ 6000AD6 :                     ; 		mov	@r15+,r8
(2) 2207/ 6000AD6 :                     ; 		mov	@r15+,r7
(2) 2208/ 6000AD6 :                     ; 		mov	@r15+,r6
(2) 2209/ 6000AD6 :                     ; 		mov	@r15+,r5
(2) 2210/ 6000AD6 :                     ;
(2) 2211/ 6000AD6 :                     ; 	; Set the most far points
(2) 2212/ 6000AD6 :                     ; 	; for each direction (X,Y,Z)
(2) 2213/ 6000AD6 :                     ; 		cmp/gt	r13,r4
(2) 2214/ 6000AD6 :                     ; 		bf	.save_z2
(2) 2215/ 6000AD6 :                     ; 		mov	r4,r13
(2) 2216/ 6000AD6 :                     ; .save_z2:
(2) 2217/ 6000AD6 :                     ; 		cmp/gt	r5,r4
(2) 2218/ 6000AD6 :                     ; 		bt	.save_z
(2) 2219/ 6000AD6 :                     ; 		mov	r4,r5
(2) 2220/ 6000AD6 :                     ; .save_z:
(2) 2221/ 6000AD6 :                     ; 		cmp/gt	r8,r2
(2) 2222/ 6000AD6 :                     ; 		bf	.x_lw
(2) 2223/ 6000AD6 :                     ; 		mov	r2,r8
(2) 2224/ 6000AD6 :                     ; .x_lw:
(2) 2225/ 6000AD6 :                     ; 		cmp/gt	r9,r2
(2) 2226/ 6000AD6 :                     ; 		bt	.x_rw
(2) 2227/ 6000AD6 :                     ; 		mov	r2,r9
(2) 2228/ 6000AD6 :                     ; .x_rw:
(2) 2229/ 6000AD6 :                     ; 		cmp/gt	r11,r3
(2) 2230/ 6000AD6 :                     ; 		bf	.y_lw
(2) 2231/ 6000AD6 :                     ; 		mov	r3,r11
(2) 2232/ 6000AD6 :                     ; .y_lw:
(2) 2233/ 6000AD6 :                     ; 		cmp/gt	r12,r3
(2) 2234/ 6000AD6 :                     ; 		bt	.y_rw
(2) 2235/ 6000AD6 :                     ; 		mov	r3,r12
(2) 2236/ 6000AD6 :                     ; .y_rw:
(2) 2237/ 6000AD6 :                     ;
(2) 2238/ 6000AD6 :                     ; 		lds	@r15+,pr
(2) 2239/ 6000AD6 :                     ; 		rts
(2) 2240/ 6000AD6 :                     ; 		nop
(2) 2241/ 6000AD6 :                     ; 		align 4
(2) 2242/ 6000AD6 :                     ; 		ltorg
(2) 2243/ 6000AD6 :                     ;
(2) 2244/ 6000AD6 :                     ; ; ------------------------------
(2) 2245/ 6000AD6 :                     ; ; Rotate point
(2) 2246/ 6000AD6 :                     ; ;
(2) 2247/ 6000AD6 :                     ; ; Entry:
(2) 2248/ 6000AD6 :                     ; ; r5: x
(2) 2249/ 6000AD6 :                     ; ; r6: y
(2) 2250/ 6000AD6 :                     ; ; r0: theta
(2) 2251/ 6000AD6 :                     ; ;
(2) 2252/ 6000AD6 :                     ; ; Returns:
(2) 2253/ 6000AD6 :                     ; ; r7: (x  cos @) + (y sin @)
(2) 2254/ 6000AD6 :                     ; ; r8: (x -sin @) + (y cos @)
(2) 2255/ 6000AD6 :                     ; ; ------------------------------
(2) 2256/ 6000AD6 :                     ;
(2) 2257/ 6000AD6 :                     ; mdlrd_rotate:
(2) 2258/ 6000AD6 :                     ;     		mov	#$7FF,r7
(2) 2259/ 6000AD6 :                     ;     		and	r7,r0
(2) 2260/ 6000AD6 :                     ;    		shll2	r0
(2) 2261/ 6000AD6 :                     ; 		mov	#sin_table,r7
(2) 2262/ 6000AD6 :                     ; 		mov	#sin_table+$800,r8
(2) 2263/ 6000AD6 :                     ; 		mov	@(r0,r7),r9
(2) 2264/ 6000AD6 :                     ; 		mov	@(r0,r8),r10
(2) 2265/ 6000AD6 :                     ;
(2) 2266/ 6000AD6 :                     ; 		dmuls	r5,r10		; x cos @
(2) 2267/ 6000AD6 :                     ; 		sts	macl,r7
(2) 2268/ 6000AD6 :                     ; 		sts	mach,r0
(2) 2269/ 6000AD6 :                     ; 		xtrct	r0,r7
(2) 2270/ 6000AD6 :                     ; 		dmuls	r6,r9		; y sin @
(2) 2271/ 6000AD6 :                     ; 		sts	macl,r8
(2) 2272/ 6000AD6 :                     ; 		sts	mach,r0
(2) 2273/ 6000AD6 :                     ; 		xtrct	r0,r8
(2) 2274/ 6000AD6 :                     ; 		add	r8,r7
(2) 2275/ 6000AD6 :                     ;
(2) 2276/ 6000AD6 :                     ; 		neg	r9,r9
(2) 2277/ 6000AD6 :                     ; 		dmuls	r5,r9		; x -sin @
(2) 2278/ 6000AD6 :                     ; 		sts	macl,r8
(2) 2279/ 6000AD6 :                     ; 		sts	mach,r0
(2) 2280/ 6000AD6 :                     ; 		xtrct	r0,r8
(2) 2281/ 6000AD6 :                     ; 		dmuls	r6,r10		; y cos @
(2) 2282/ 6000AD6 :                     ; 		sts	macl,r9
(2) 2283/ 6000AD6 :                     ; 		sts	mach,r0
(2) 2284/ 6000AD6 :                     ; 		xtrct	r0,r9
(2) 2285/ 6000AD6 :                     ; 		add	r9,r8
(2) 2286/ 6000AD6 :                     ;  		rts
(2) 2287/ 6000AD6 :                     ; 		nop
(2) 2288/ 6000AD6 :                     ; 		align 4
(2) 2289/ 6000AD6 :                     
(1)  866/ 6000AD6 :                     		include "system/mars/sound.asm"
(2)    1/ 6000AD6 :                     ; ====================================================================
(2)    2/ 6000AD6 :                     ; ----------------------------------------------------------------
(2)    3/ 6000AD6 :                     ; MARS Sound
(2)    4/ 6000AD6 :                     ; ----------------------------------------------------------------
(2)    5/ 6000AD6 :                     
(2)    6/ 6000AD6 : =$7                 MAX_PWMCHNL	equ	7
(2)    7/ 6000AD6 :                     
(2)    8/ 6000AD6 :                     ; 32X sound channel
(2)    9/ 6000AD6 : (MACRO)             		struct 0
(2)    9/ 6000AD6 : =$6000AD6           GLBL_LASTPC     set *
(2)    9/   4D9F6 :                                     dephase
(2)    9/   4D9F6 : =$4D9F6             GLBL_LASTORG    set *
(2)    9/       0 :                                     phase 0
(2)   10/       0 :                     mchnsnd_enbl	ds.l 1
(2)   11/       4 :                     mchnsnd_read	ds.l 1		; 0 - off
(2)   12/       8 :                     mchnsnd_bank	ds.l 1		; CS0-3 OR value
(2)   13/       C :                     mchnsnd_start	ds.l 1
(2)   14/      10 :                     mchnsnd_end	ds.l 1
(2)   15/      14 :                     mchnsnd_loop	ds.l 1
(2)   16/      18 :                     mchnsnd_pitch	ds.l 1
(2)   17/      1C :                     mchnsnd_flags	ds.l 1		; %SLR S-wave format mono/stereo | LR-wave output bits
(2)   18/      20 :                     mchnsnd_vol	ds.l 1
(2)   19/      24 :                     sizeof_sndchn	ds.l 0
(2)   20/      26 : (MACRO)             		finish
(2)   20/       0 :                                     !org GLBL_LASTORG
(2)   20/ 6000AD6 :                                     phase GLBL_LASTPC
(2)   21/ 6000AD6 :                     
(2)   22/ 6000AD6 :                     ; ====================================================================
(2)   23/ 6000AD6 :                     ; ----------------------------------------------------------------
(2)   24/ 6000AD6 :                     ; Mars PWM playback (Runs on PWM interrupt)
(2)   25/ 6000AD6 :                     ;
(2)   26/ 6000AD6 :                     ; READ/START/END/LOOP points are floating values (xxxxxx.00)
(2)   27/ 6000AD6 :                     ;
(2)   28/ 6000AD6 :                     ; r0-r9 only
(2)   29/ 6000AD6 :                     ; ----------------------------------------------------------------
(2)   30/ 6000AD6 :                     
(2)   31/ 6000AD6 :                     ; NUMCHANNELS	equ	4
(2)   32/ 6000AD6 :                     ; PWMSIZE		equ	2	; number of elemts in the PWM structure
(2)   33/ 6000AD6 :                     ;
(2)   34/ 6000AD6 :                     ; PWMADDRESS	equ	4
(2)   35/ 6000AD6 :                     ;
(2)   36/ 6000AD6 :                     ; process_pwm:
(2)   37/ 6000AD6 :                     ;
(2)   38/ 6000AD6 :                     
(2)   39/ 6000AD6 :                     
(2)   40/ 6000AD6 :                     MarsSound_ReadPwm:
(2)   41/ 6000AD6 : 2F26                		mov	r2,@-r15
(2)   42/ 6000AD8 : 2F36                		mov	r3,@-r15
(2)   43/ 6000ADA : 2F46                		mov	r4,@-r15
(2)   44/ 6000ADC : 2F56                		mov	r5,@-r15
(2)   45/ 6000ADE : 2F66                		mov	r6,@-r15
(2)   46/ 6000AE0 : 2F76                		mov	r7,@-r15
(2)   47/ 6000AE2 : 2F86                		mov	r8,@-r15
(2)   48/ 6000AE4 : 2F96                		mov	r9,@-r15
(2)   49/ 6000AE6 : 4F12                		sts	macl,@-r15
(2)   50/ 6000AE8 :                     
(2)   51/ 6000AE8 :                     ; ------------------------------------------------
(2)   52/ 6000AE8 :                     ; Process PWM request(s) from GEMA sound driver
(2)   53/ 6000AE8 :                     ; 		mov.w	@(marsGbl_PwmTrkUpd,gbr),r0
(2)   54/ 6000AE8 :                     ; 		cmp/eq	#0,r0
(2)   55/ 6000AE8 :                     ; 		bt	.retry
(2)   56/ 6000AE8 :                     ; 		mov	#MarsSnd_PwmPlyData,r8
(2)   57/ 6000AE8 :                     ; 		mov	#MarsSnd_PwmTrkData,r7
(2)   58/ 6000AE8 :                     ; 		mov	#MarsSnd_PwmChnls,r6
(2)   59/ 6000AE8 :                     ; 		mov	#MAX_PWMCHNL,r5
(2)   60/ 6000AE8 :                     ; .next_pwm:
(2)   61/ 6000AE8 :                     ; 		mov.b	@r8,r0
(2)   62/ 6000AE8 :                     ; 		mov	r0,r3
(2)   63/ 6000AE8 :                     ; 		and	#%01100000,r0
(2)   64/ 6000AE8 :                     ; 		cmp/eq	#%01000000,r0
(2)   65/ 6000AE8 :                     ; 		bt	.play
(2)   66/ 6000AE8 :                     ; 		cmp/eq	#%00100000,r0
(2)   67/ 6000AE8 :                     ; 		bf	.pwmcont
(2)   68/ 6000AE8 :                     ;
(2)   69/ 6000AE8 :                     ; 		mov.b	@r8,r0
(2)   70/ 6000AE8 :                     ; 		and	#%1111,r0
(2)   71/ 6000AE8 :                     ; 		mov	#MarsSnd_PwmChnls,r6
(2)   72/ 6000AE8 :                     ; 		mov 	#sizeof_sndchn,r1
(2)   73/ 6000AE8 :                     ; 		mulu	r1,r0
(2)   74/ 6000AE8 :                     ; 		sts	macl,r0
(2)   75/ 6000AE8 :                     ; 		add 	r0,r6
(2)   76/ 6000AE8 :                     ; 		mov	#0,r0
(2)   77/ 6000AE8 :                     ; 		mov	r0,@(mchnsnd_enbl,r6)
(2)   78/ 6000AE8 :                     ; 		bra	.pwmcont
(2)   79/ 6000AE8 :                     ; 		nop
(2)   80/ 6000AE8 :                     ; .play:
(2)   81/ 6000AE8 :                     ; 		mov.b	@r8,r0
(2)   82/ 6000AE8 :                     ; 		and	#%1111,r0
(2)   83/ 6000AE8 :                     ; 		mov	#MarsSnd_PwmChnls,r6
(2)   84/ 6000AE8 :                     ; 		mov 	#sizeof_sndchn,r1
(2)   85/ 6000AE8 :                     ; 		mulu	r1,r0
(2)   86/ 6000AE8 :                     ; 		sts	macl,r0
(2)   87/ 6000AE8 :                     ; 		add 	r0,r6
(2)   88/ 6000AE8 :                     ;
(2)   89/ 6000AE8 :                     ; 		mov.b	@(4,r8),r0
(2)   90/ 6000AE8 :                     ; 		and	#$FF,r0
(2)   91/ 6000AE8 :                     ; 		shll8	r0
(2)   92/ 6000AE8 :                     ; 		mov	r0,r4
(2)   93/ 6000AE8 :                     ; 		mov.b	@(3,r8),r0
(2)   94/ 6000AE8 :                     ; 		and	#$FF,r0
(2)   95/ 6000AE8 :                     ; 		or	r4,r0
(2)   96/ 6000AE8 :                     ; 		mov	r0,@(mchnsnd_pitch,r6)
(2)   97/ 6000AE8 :                     ; 		mov.b	@(6,r8),r0
(2)   98/ 6000AE8 :                     ; 		and	#$FF,r0
(2)   99/ 6000AE8 :                     ; 		shll2	r0
(2)  100/ 6000AE8 :                     ; 		mov	r0,@(mchnsnd_vol,r6)
(2)  101/ 6000AE8 :                     ;
(2)  102/ 6000AE8 :                     ; 		mov.b	@(5,r8),r0
(2)  103/ 6000AE8 :                     ; 		shll2	r0
(2)  104/ 6000AE8 :                     ; 		shll	r0
(2)  105/ 6000AE8 :                     ; 		mov	r7,r4
(2)  106/ 6000AE8 :                     ; 		add	r0,r4
(2)  107/ 6000AE8 :                     ; 		add	#4,r4			; Move to pointer
(2)  108/ 6000AE8 :                     ; 		mov	@r4,r4
(2)  109/ 6000AE8 :                     ; 		mov	@r4+,r0
(2)  110/ 6000AE8 :                     ; 		mov	r0,r2
(2)  111/ 6000AE8 :                     ; 		mov 	#$FF000000,r3
(2)  112/ 6000AE8 :                     ; 		and 	r3,r2
(2)  113/ 6000AE8 :                     ; 		mov 	r2,@(mchnsnd_bank,r6)
(2)  114/ 6000AE8 :                     ; 		shll8	r0
(2)  115/ 6000AE8 :                     ; 		mov	r0,@(mchnsnd_start,r6)
(2)  116/ 6000AE8 :                     ; 		mov 	r0,@(mchnsnd_read,r6)
(2)  117/ 6000AE8 :                     ;
(2)  118/ 6000AE8 :                     ; 		mov	@r4+,r0
(2)  119/ 6000AE8 :                     ; 		shll8	r0
(2)  120/ 6000AE8 :                     ; 		mov	r0,@(mchnsnd_end,r6)
(2)  121/ 6000AE8 :                     ; 		mov	@r4+,r0
(2)  122/ 6000AE8 :                     ; 		mov	r0,@(mchnsnd_loop,r6)
(2)  123/ 6000AE8 :                     ; ; 		mov	@r4+,r1
(2)  124/ 6000AE8 :                     ; 		mov.b	@(7,r8),r0
(2)  125/ 6000AE8 :                     ; 		and	#$FF,r0
(2)  126/ 6000AE8 :                     ; ; 		or	r1,r0
(2)  127/ 6000AE8 :                     ; 		mov	r0,@(mchnsnd_flags,r6)
(2)  128/ 6000AE8 :                     ; 		mov	#1,r0
(2)  129/ 6000AE8 :                     ; 		mov	r0,@(mchnsnd_enbl,r6)
(2)  130/ 6000AE8 :                     ; .pwmcont:
(2)  131/ 6000AE8 :                     ; 		mov	r3,r0
(2)  132/ 6000AE8 :                     ; 		and	#%10011111,r0
(2)  133/ 6000AE8 :                     ; 		mov.b	r0,@r8
(2)  134/ 6000AE8 :                     ; 		add	#8,r8
(2)  135/ 6000AE8 :                     ; 		dt	r5
(2)  136/ 6000AE8 :                     ; 		bf	.next_pwm
(2)  137/ 6000AE8 :                     ;
(2)  138/ 6000AE8 :                     ; 		mov	#_sysreg+comm4,r1
(2)  139/ 6000AE8 :                     ; 		mov	#$00,r0			; SH is busy
(2)  140/ 6000AE8 :                     ; 		mov.b	r0,@(1,r1)
(2)  141/ 6000AE8 :                     ; 		mov	#0,r0
(2)  142/ 6000AE8 :                     ; 		mov.w	r0,@(marsGbl_PwmTrkUpd,gbr)
(2)  143/ 6000AE8 :                     ; ; ------------------------------------------------
(2)  144/ 6000AE8 :                     ;
(2)  145/ 6000AE8 :                     ; .retry:
(2)  146/ 6000AE8 : E500                		mov 	#0,r5			; LEFT start
(2)  147/ 6000AEA : E600                		mov 	#0,r6			; RIGHT start
(2)  148/ 6000AEC : D82C                		mov	#MarsSnd_PwmChnls,r8
(2)  149/ 6000AEE : E707                		mov 	#MAX_PWMCHNL,r7
(2)  150/ 6000AF0 :                     .loop:
(2)  151/ 6000AF0 : 5080                		mov	@(mchnsnd_enbl,r8),r0
(2)  152/ 6000AF2 : 8800                		cmp/eq	#0,r0
(2)  153/ 6000AF4 : 8B03                		bf	.on
(2)  154/ 6000AF6 :                     .silent:
(2)  155/ 6000AF6 : E07F                		mov	#$7F,r0
(2)  156/ 6000AF8 : 6203                		mov	r0,r2
(2)  157/ 6000AFA : A034                		bra	.skip
(2)  158/ 6000AFC : 6103                		mov	r0,r1
(2)  159/ 6000AFE :                     .on:
(2)  160/ 6000AFE : 5481                		mov 	@(mchnsnd_read,r8),r4
(2)  161/ 6000B00 : 5084                		mov 	@(mchnsnd_end,r8),r0
(2)  162/ 6000B02 : 3403                		cmp/ge	r0,r4
(2)  163/ 6000B04 : 8B09                		bf	.read
(2)  164/ 6000B06 : 5085                		mov 	@(mchnsnd_loop,r8),r0
(2)  165/ 6000B08 : 88FF                		cmp/eq	#-1,r0
(2)  166/ 6000B0A : 8B04                		bf	.loop_me
(2)  167/ 6000B0C : E000                		mov 	#0,r0
(2)  168/ 6000B0E : 1800                		mov 	r0,@(mchnsnd_enbl,r8)
(2)  169/ 6000B10 : 5483                		mov 	@(mchnsnd_start,r8),r4
(2)  170/ 6000B12 : AFF0                		bra	.silent
(2)  171/ 6000B14 : 0009                		nop
(2)  172/ 6000B16 :                     .loop_me:
(2)  173/ 6000B16 : 5483                		mov 	@(mchnsnd_start,r8),r4
(2)  174/ 6000B18 : 340C                		add	r0,r4
(2)  175/ 6000B1A :                     
(2)  176/ 6000B1A :                     ; read wave
(2)  177/ 6000B1A :                     .read:
(2)  178/ 6000B1A : 5087                		mov 	@(mchnsnd_flags,r8),r0
(2)  179/ 6000B1C : D121                		mov	#$00FFFFFF,r1
(2)  180/ 6000B1E : 6343                		mov 	r4,r3
(2)  181/ 6000B20 : 4319                		shlr8	r3
(2)  182/ 6000B22 : C880                		tst	#%10000000,r0
(2)  183/ 6000B24 : 8900                		bt	.mono_a
(2)  184/ 6000B26 : 71FF                		add	#-1,r1
(2)  185/ 6000B28 :                     .mono_a
(2)  186/ 6000B28 : 2319                		and	r1,r3
(2)  187/ 6000B2A : 5182                		mov 	@(mchnsnd_bank,r8),r1
(2)  188/ 6000B2C : 5986                		mov 	@(mchnsnd_pitch,r8),r9
(2)  189/ 6000B2E : 231B                		or	r1,r3
(2)  190/ 6000B30 : 6134                		mov.b	@r3+,r1
(2)  191/ 6000B32 : 6213                		mov	r1,r2
(2)  192/ 6000B34 : C880                		tst	#%10000000,r0
(2)  193/ 6000B36 : 8901                		bt	.mono
(2)  194/ 6000B38 : 6234                		mov.b	@r3+,r2
(2)  195/ 6000B3A : 4900                		shll	r9
(2)  196/ 6000B3C :                     .mono:
(2)  197/ 6000B3C : 349C                		add	r9,r4
(2)  198/ 6000B3E : 1841                		mov	r4,@(mchnsnd_read,r8)
(2)  199/ 6000B40 : 9330                		mov	#$FF,r3
(2)  200/ 6000B42 : 2139                		and	r3,r1
(2)  201/ 6000B44 : 2239                		and	r3,r2
(2)  202/ 6000B46 :                     
(2)  203/ 6000B46 :                     	; Volume goes down only.
(2)  204/ 6000B46 :                     	; vol=0 normal
(2)  205/ 6000B46 : 5988                		mov	@(mchnsnd_vol,r8),r9
(2)  206/ 6000B48 : 7901                		add	#1,r9
(2)  207/ 6000B4A : 219E                		mulu	r9,r1
(2)  208/ 6000B4C : 041A                		sts	macl,r4
(2)  209/ 6000B4E : 4419                		shlr8	r4
(2)  210/ 6000B50 : 3148                		sub	r4,r1
(2)  211/ 6000B52 : 229E                		mulu	r9,r2
(2)  212/ 6000B54 : 041A                		sts	macl,r4
(2)  213/ 6000B56 : 4419                		shlr8	r4
(2)  214/ 6000B58 : 3248                		sub	r4,r2
(2)  215/ 6000B5A : C802                		tst	#%00000010,r0		; TODO: temporal way to check L/R
(2)  216/ 6000B5C : 8B00                		bf	.no_l
(2)  217/ 6000B5E : E17F                		mov	#$7F,r1
(2)  218/ 6000B60 :                     .no_l:
(2)  219/ 6000B60 : C801                		tst	#%00000001,r0
(2)  220/ 6000B62 : 8B00                		bf	.skip
(2)  221/ 6000B64 : E27F                		mov	#$7F,r2
(2)  222/ 6000B66 :                     .skip:
(2)  223/ 6000B66 : 7101                		add	#1,r1
(2)  224/ 6000B68 : 7201                		add	#1,r2
(2)  225/ 6000B6A : 351C                		add	r1,r5
(2)  226/ 6000B6C : 362C                		add	r2,r6
(2)  227/ 6000B6E : 7824                		add	#sizeof_sndchn,r8
(2)  228/ 6000B70 : 4710                		dt	r7
(2)  229/ 6000B72 : 8BBD                		bf	.loop
(2)  230/ 6000B74 :                     
(2)  231/ 6000B74 :                     	; ***This check is for emus only***
(2)  232/ 6000B74 :                     	; It recreates what happens to the PWM
(2)  233/ 6000B74 :                     	; in real hardware when it overflows
(2)  234/ 6000B74 : 901C                		mov	#$3FF,r0
(2)  235/ 6000B76 : 3507                		cmp/gt	r0,r5
(2)  236/ 6000B78 : 8B00                		bf	.lmuch
(2)  237/ 6000B7A : 6503                		mov	r0,r5
(2)  238/ 6000B7C : 3607                .lmuch:		cmp/gt	r0,r6
(2)  239/ 6000B7E : 8B00                		bf	.rmuch
(2)  240/ 6000B80 : 6603                		mov	r0,r6
(2)  241/ 6000B82 :                     .rmuch:
(2)  242/ 6000B82 : D309                		mov	#_sysreg+lchwidth,r3
(2)  243/ 6000B84 : D409                		mov	#_sysreg+rchwidth,r4
(2)  244/ 6000B86 : 2351                 		mov.w	r5,@r3
(2)  245/ 6000B88 : 2461                 		mov.w	r6,@r4
(2)  246/ 6000B8A :                     ; 		mov	#_sysreg+monowidth,r3	; Not needed on HW
(2)  247/ 6000B8A :                     ; 		mov.b	@r3,r0
(2)  248/ 6000B8A :                     ; 		tst	#$80,r0
(2)  249/ 6000B8A :                     ; 		bf	.retry
(2)  250/ 6000B8A :                     
(2)  251/ 6000B8A : 4F16                		lds	@r15+,macl
(2)  252/ 6000B8C : 69F6                		mov	@r15+,r9
(2)  253/ 6000B8E : 68F6                		mov	@r15+,r8
(2)  254/ 6000B90 : 67F6                		mov	@r15+,r7
(2)  255/ 6000B92 : 66F6                		mov	@r15+,r6
(2)  256/ 6000B94 : 65F6                		mov	@r15+,r5
(2)  257/ 6000B96 : 64F6                		mov	@r15+,r4
(2)  258/ 6000B98 : 63F6                		mov	@r15+,r3
(2)  259/ 6000B9A : 62F6                		mov	@r15+,r2
(2)  260/ 6000B9C : 000B                		rts
(2)  261/ 6000B9E : 0009                		nop
(2)  262/ 6000BA0 :                     		align 4
(2)  263/ 6000BA0 : 0600 A788 00FF FFFF 		ltorg
                    2000 4034 2000 4036 
                    03FF                
(2)  264/ 6000BB2 :                     
(2)  265/ 6000BB2 :                     ; ; ====================================================================
(2)  266/ 6000BB2 :                     ; ; ----------------------------------------------------------------
(2)  267/ 6000BB2 :                     ; ; Mars PWM control (Runs on VBlank)
(2)  268/ 6000BB2 :                     ; ; ----------------------------------------------------------------
(2)  269/ 6000BB2 :                     ;
(2)  270/ 6000BB2 :                     ; MarsSound_Run:
(2)  271/ 6000BB2 :                     ; 		sts	pr,@-r15
(2)  272/ 6000BB2 :                     ;
(2)  273/ 6000BB2 :                     ; 		lds	@r15+,pr
(2)  274/ 6000BB2 :                     ; 		rts
(2)  275/ 6000BB2 :                     ; 		nop
(2)  276/ 6000BB2 :                     ; 		align 4
(2)  277/ 6000BB2 :                     
(2)  278/ 6000BB2 :                     ; ====================================================================
(2)  279/ 6000BB2 :                     ; ----------------------------------------------------------------
(2)  280/ 6000BB2 :                     ; Subroutines
(2)  281/ 6000BB2 :                     ; ----------------------------------------------------------------
(2)  282/ 6000BB2 :                     
(2)  283/ 6000BB2 :                     ; --------------------------------------------------------
(2)  284/ 6000BB2 :                     ; Init Sound PWM
(2)  285/ 6000BB2 :                     ;
(2)  286/ 6000BB2 :                     ; Frequency values:
(2)  287/ 6000BB2 :                     ; 23011361 NTSC
(2)  288/ 6000BB2 :                     ; 22801467 PAL
(2)  289/ 6000BB2 :                     ;
(2)  290/ 6000BB2 :                     ; NOTE: cycle causes a CLICK to sound
(2)  291/ 6000BB2 :                     ; --------------------------------------------------------
(2)  292/ 6000BB2 :                     
(2)  293/ 6000BB2 :                     MarsSound_Init:
(2)  294/ 6000BB2 : 4F22                		sts	pr,@-r15
(2)  295/ 6000BB4 : 4F13                		stc	gbr,@-r15
(2)  296/ 6000BB6 : D02B                		mov	#_sysreg,r0
(2)  297/ 6000BB8 : 401E                		ldc	r0,gbr
(2)  298/ 6000BBA : 905F                		mov	#$0105,r0
(2)  299/ 6000BBC : C118                		mov.w	r0,@(timerctl,gbr)
(2)  300/ 6000BBE : 905E                		mov	#((((23011361<<1)/22050+1)>>1)+1),r0	; 22050 best
(2)  301/ 6000BC0 : C119                		mov.w	r0,@(cycle,gbr)
(2)  302/ 6000BC2 : E001                		mov	#1,r0
(2)  303/ 6000BC4 : C11C                		mov.w	r0,@(monowidth,gbr)
(2)  304/ 6000BC6 : C11C                		mov.w	r0,@(monowidth,gbr)
(2)  305/ 6000BC8 : C11C                		mov.w	r0,@(monowidth,gbr)
(2)  306/ 6000BCA :                     
(2)  307/ 6000BCA : E000                		mov	#0,r0
(2)  308/ 6000BCC : D126                		mov	#MarsSnd_PwmChnls,r1
(2)  309/ 6000BCE : E207                		mov	#MAX_PWMCHNL,r2
(2)  310/ 6000BD0 : E324                		mov	#sizeof_sndchn,r3
(2)  311/ 6000BD2 :                     .clr_enbl:
(2)  312/ 6000BD2 : 1100                		mov	r0,@(mchnsnd_enbl,r1)
(2)  313/ 6000BD4 : 4210                		dt	r2
(2)  314/ 6000BD6 : 8FFC                		bf/s	.clr_enbl
(2)  315/ 6000BD8 : 313C                		add	r3,r1
(2)  316/ 6000BDA : 4F17                		ldc	@r15+,gbr
(2)  317/ 6000BDC : 4F26                		lds	@r15+,pr
(2)  318/ 6000BDE : 000B                		rts
(2)  319/ 6000BE0 : 0009                		nop
(2)  320/ 6000BE2 :                     		align 4
(2)  321/ 6000BE4 :                     
(2)  322/ 6000BE4 :                     ; --------------------------------------------------------
(2)  323/ 6000BE4 :                     ; MarsSound_SetPwm
(2)  324/ 6000BE4 :                     ;
(2)  325/ 6000BE4 :                     ; Set new sound data to a single channel
(2)  326/ 6000BE4 :                     ;
(2)  327/ 6000BE4 :                     ; Input:
(2)  328/ 6000BE4 :                     ; r1 | Channel
(2)  329/ 6000BE4 :                     ; r2 | Start address
(2)  330/ 6000BE4 :                     ; r3 | End address
(2)  331/ 6000BE4 :                     ; r4 | Loop address (-1, dont loop)
(2)  332/ 6000BE4 :                     ; r5 | Pitch ($xxxxxx.xx)
(2)  333/ 6000BE4 :                     ; r6 | Volume
(2)  334/ 6000BE4 :                     ; r7 | Flags (Currently: %xxxxxxLR)
(2)  335/ 6000BE4 :                     ;
(2)  336/ 6000BE4 :                     ; Uses:
(2)  337/ 6000BE4 :                     ; r0,r8-r9
(2)  338/ 6000BE4 :                     ; --------------------------------------------------------
(2)  339/ 6000BE4 :                     
(2)  340/ 6000BE4 :                     MarsSound_SetPwm:
(2)  341/ 6000BE4 : 0902                		stc	sr,r9
(2)  342/ 6000BE6 : 904B                		mov	#$F0,r0
(2)  343/ 6000BE8 : 400E                		ldc	r0,sr
(2)  344/ 6000BEA : D820                		mov	#MarsSnd_PwmChnls,r8
(2)  345/ 6000BEC : E024                		mov 	#sizeof_sndchn,r0
(2)  346/ 6000BEE : 201E                		mulu	r1,r0
(2)  347/ 6000BF0 : 001A                		sts	macl,r0
(2)  348/ 6000BF2 : 380C                		add 	r0,r8
(2)  349/ 6000BF4 : E000                		mov 	#0,r0
(2)  350/ 6000BF6 : 1800                		mov 	r0,@(mchnsnd_enbl,r8)
(2)  351/ 6000BF8 : 1801                		mov 	r0,@(mchnsnd_read,r8)
(2)  352/ 6000BFA : 1802                		mov 	r0,@(mchnsnd_bank,r8)
(2)  353/ 6000BFC :                     
(2)  354/ 6000BFC : 1856                		mov 	r5,@(mchnsnd_pitch,r8)
(2)  355/ 6000BFE : 1868                		mov 	r6,@(mchnsnd_vol,r8)
(2)  356/ 6000C00 : 1877                		mov 	r7,@(mchnsnd_flags,r8)
(2)  357/ 6000C02 :                     
(2)  358/ 6000C02 : 6023                		mov 	r2,r0				; Set MSB
(2)  359/ 6000C04 : D71A                		mov 	#$FF000000,r7
(2)  360/ 6000C06 : 2079                		and 	r7,r0
(2)  361/ 6000C08 : 1802                		mov 	r0,@(mchnsnd_bank,r8)
(2)  362/ 6000C0A : 6043                		mov 	r4,r0				; Set POINTS
(2)  363/ 6000C0C : 88FF                		cmp/eq	#-1,r0
(2)  364/ 6000C0E : 8900                		bt	.endmrk
(2)  365/ 6000C10 : 4018                		shll8	r0
(2)  366/ 6000C12 :                     .endmrk:
(2)  367/ 6000C12 : 1805                		mov	r0,@(mchnsnd_loop,r8)
(2)  368/ 6000C14 : 6033                		mov 	r3,r0
(2)  369/ 6000C16 : 4018                		shll8	r0
(2)  370/ 6000C18 : 1804                		mov	r0,@(mchnsnd_end,r8)
(2)  371/ 6000C1A : 6023                		mov 	r2,r0
(2)  372/ 6000C1C : 4018                		shll8	r0
(2)  373/ 6000C1E : 1803                		mov 	r0,@(mchnsnd_start,r8)
(2)  374/ 6000C20 : 1801                		mov 	r0,@(mchnsnd_read,r8)
(2)  375/ 6000C22 : E001                		mov 	#1,r0
(2)  376/ 6000C24 : 1800                		mov 	r0,@(mchnsnd_enbl,r8)
(2)  377/ 6000C26 : 490E                 		ldc	r9,sr
(2)  378/ 6000C28 : 000B                		rts
(2)  379/ 6000C2A : 0009                		nop
(2)  380/ 6000C2C :                     		align 4
(2)  381/ 6000C2C :                     
(2)  382/ 6000C2C :                     ; --------------------------------------------------------
(2)  383/ 6000C2C :                     ; MarsSound_MulPwmPitch
(2)  384/ 6000C2C :                     ;
(2)  385/ 6000C2C :                     ; Set pitch data to 8 consecutive sound channels
(2)  386/ 6000C2C :                     ; starting from specific slot
(2)  387/ 6000C2C :                     ;
(2)  388/ 6000C2C :                     ; Input:
(2)  389/ 6000C2C :                     ; r1 | Channel pitch slot 0
(2)  390/ 6000C2C :                     ; r2 | Pitch data
(2)  391/ 6000C2C :                     ;
(2)  392/ 6000C2C :                     ; Uses:
(2)  393/ 6000C2C :                     ; r3,r4
(2)  394/ 6000C2C :                     ; --------------------------------------------------------
(2)  395/ 6000C2C :                     
(2)  396/ 6000C2C :                     MarsSound_SetPwmPitch:
(2)  397/ 6000C2C : 0902                		stc	sr,r9
(2)  398/ 6000C2E : 9027                		mov	#$F0,r0
(2)  399/ 6000C30 : 400E                		ldc	r0,sr
(2)  400/ 6000C32 : D810                		mov	#MarsSnd_PwmChnls,r8
(2)  401/ 6000C34 : E024                		mov 	#sizeof_sndchn,r0
(2)  402/ 6000C36 : 201E                		mulu	r1,r0
(2)  403/ 6000C38 : 001A                		sts	macl,r0
(2)  404/ 6000C3A : 380C                		add 	r0,r8
(2)  405/ 6000C3C :                     
(2)  406/ 6000C3C : 5080                		mov	@(mchnsnd_enbl,r8),r0
(2)  407/ 6000C3E : 8801                		cmp/eq	#1,r0
(2)  408/ 6000C40 : 8B01                		bf	.off_1
(2)  409/ 6000C42 : 5081                		mov	@(mchnsnd_read,r8),r0
(2)  410/ 6000C44 :                     ; 		mov	#$FFFFFF00,r1
(2)  411/ 6000C44 :                     ; 		and	r1,r0
(2)  412/ 6000C44 :                     ; 		mov	r0,@(mchnsnd_read,r8)
(2)  413/ 6000C44 : 1826                		mov	r2,@(mchnsnd_pitch,r8)
(2)  414/ 6000C46 :                     .off_1:
(2)  415/ 6000C46 : 490E                 		ldc	r9,sr
(2)  416/ 6000C48 : 000B                		rts
(2)  417/ 6000C4A : 0009                		nop
(2)  418/ 6000C4C :                     		align 4
(2)  419/ 6000C4C :                     
(2)  420/ 6000C4C :                     ; --------------------------------------------------------
(2)  421/ 6000C4C :                     ; MarsSound_MulPwmPitch
(2)  422/ 6000C4C :                     ;
(2)  423/ 6000C4C :                     ; Set pitch data to 8 consecutive sound channels
(2)  424/ 6000C4C :                     ; starting from specific slot
(2)  425/ 6000C4C :                     ;
(2)  426/ 6000C4C :                     ; Input:
(2)  427/ 6000C4C :                     ; r1 | Channel pitch slot 0
(2)  428/ 6000C4C :                     ; r2 | Pitch data
(2)  429/ 6000C4C :                     ;
(2)  430/ 6000C4C :                     ; Uses:
(2)  431/ 6000C4C :                     ; r3,r4
(2)  432/ 6000C4C :                     ; --------------------------------------------------------
(2)  433/ 6000C4C :                     
(2)  434/ 6000C4C :                     MarsSound_PwmEnable:
(2)  435/ 6000C4C : 0902                		stc	sr,r9
(2)  436/ 6000C4E : 9017                		mov	#$F0,r0
(2)  437/ 6000C50 : 400E                		ldc	r0,sr
(2)  438/ 6000C52 : D809                		mov	#MarsSnd_PwmChnls,r8
(2)  439/ 6000C54 : E024                		mov 	#sizeof_sndchn,r0
(2)  440/ 6000C56 : 201E                		mulu	r1,r0
(2)  441/ 6000C58 : 001A                		sts	macl,r0
(2)  442/ 6000C5A : 380C                		add 	r0,r8
(2)  443/ 6000C5C :                     
(2)  444/ 6000C5C : 1820                		mov	r2,@(mchnsnd_enbl,r8)
(2)  445/ 6000C5E : 490E                 		ldc	r9,sr
(2)  446/ 6000C60 : 000B                		rts
(2)  447/ 6000C62 : 0009                		nop
(2)  448/ 6000C64 :                     		align 4
(2)  449/ 6000C64 :                     
(2)  450/ 6000C64 :                     ; ====================================================================
(2)  451/ 6000C64 :                     
(2)  452/ 6000C64 :                     ; 		include "data/sound/instr_sdram.asm"
(2)  453/ 6000C64 :                     
(2)  454/ 6000C64 :                     ; ====================================================================
(2)  455/ 6000C64 :                     
(2)  456/ 6000C64 : 2000 4000 0600 A788 		ltorg			; Save literals
                    0600 A788 FF00 0000 
                    0600 A788 0600 A788 
                    0105 0415 00F0      
(2)  457/ 6000C82 :                     
(1)  867/ 6000C82 :                     		align 4
(1)  868/ 6000C84 :                     
(1)  869/ 6000C84 :                     ; ====================================================================
(1)  870/ 6000C84 :                     ; ----------------------------------------------------------------
(1)  871/ 6000C84 :                     ; Master entry
(1)  872/ 6000C84 :                     ; ----------------------------------------------------------------
(1)  873/ 6000C84 :                     
(1)  874/ 6000C84 :                     		align 4
(1)  875/ 6000C84 :                     SH2_M_Entry:
(1)  876/ 6000C84 : DF61                		mov	#CS3|$40000,r15			; Set default Stack for Master
(1)  877/ 6000C86 : 91E7                		mov	#_FRT,r1
(1)  878/ 6000C88 : E000                		mov     #0,r0
(1)  879/ 6000C8A : 8010                		mov.b   r0,@(0,r1)
(1)  880/ 6000C8C : E0E2                		mov     #$FFFFFFE2,r0
(1)  881/ 6000C8E : 8017                		mov.b   r0,@(7,r1)
(1)  882/ 6000C90 : E000                		mov     #0,r0
(1)  883/ 6000C92 : 8014                		mov.b   r0,@(4,r1)
(1)  884/ 6000C94 : E001                		mov     #1,r0
(1)  885/ 6000C96 : 8015                		mov.b   r0,@(5,r1)
(1)  886/ 6000C98 : E000                		mov     #0,r0
(1)  887/ 6000C9A : 8016                		mov.b   r0,@(6,r1)
(1)  888/ 6000C9C : E001                		mov     #1,r0
(1)  889/ 6000C9E : 8011                		mov.b   r0,@(1,r1)
(1)  890/ 6000CA0 : E000                		mov     #0,r0
(1)  891/ 6000CA2 : 8013                		mov.b   r0,@(3,r1)
(1)  892/ 6000CA4 : 8012                		mov.b   r0,@(2,r1)
(1)  893/ 6000CA6 : 90D8                		mov.l   #$FFFFFEE2,r0			; Watchdog: Set interrupt priority bits (IPRA)
(1)  894/ 6000CA8 : E150                		mov     #%0101<<4,r1
(1)  895/ 6000CAA : 2011                		mov.w   r1,@r0
(1)  896/ 6000CAC : 90D6                		mov.l   #$FFFFFEE4,r0
(1)  897/ 6000CAE : E148                		mov     #$120/4,r1			; Watchdog: Set jump pointer (VBR + this/4) (WITV)
(1)  898/ 6000CB0 : 4118                		shll8   r1
(1)  899/ 6000CB2 : 2011                		mov.w   r1,@r0
(1)  900/ 6000CB4 :                     
(1)  901/ 6000CB4 :                     ; ------------------------------------------------
(1)  902/ 6000CB4 :                     ; Wait for Genesis and Slave CPU
(1)  903/ 6000CB4 :                     ; ------------------------------------------------
(1)  904/ 6000CB4 :                     
(1)  905/ 6000CB4 :                     .wait_md:
(1)  906/ 6000CB4 : D256                		mov 	#_sysreg+comm0,r2		; Wait for Genesis
(1)  907/ 6000CB6 : 6022                		mov.l	@r2,r0
(1)  908/ 6000CB8 : 8800                		cmp/eq	#0,r0
(1)  909/ 6000CBA : 8BFB                		bf	.wait_md
(1)  910/ 6000CBC : D155                		mov.l	#"SLAV",r1
(1)  911/ 6000CBE :                     .wait_slave:
(1)  912/ 6000CBE : 5022                		mov.l	@(8,r2),r0			; Wait for Slave CPU to finish booting
(1)  913/ 6000CC0 : 3010                		cmp/eq	r1,r0
(1)  914/ 6000CC2 : 8BFC                		bf	.wait_slave
(1)  915/ 6000CC4 : E000                		mov.l	#0,r0				; clear "SLAV"
(1)  916/ 6000CC6 : 1202                		mov.l	r0,@(8,r2)
(1)  917/ 6000CC8 : 2202                		mov.l	r0,@r2
(1)  918/ 6000CCA :                     
(1)  919/ 6000CCA :                     ; ====================================================================
(1)  920/ 6000CCA :                     ; ----------------------------------------------------------------
(1)  921/ 6000CCA :                     ; Master main code
(1)  922/ 6000CCA :                     ; 
(1)  923/ 6000CCA :                     ; This CPU is exclusively used for visual tasks:
(1)  924/ 6000CCA :                     ; Polygons, Sprites, Backgrounds...
(1)  925/ 6000CCA :                     ;
(1)  926/ 6000CCA :                     ; To interact with the models use the Slave CPU and request
(1)  927/ 6000CCA :                     ; a drawing task there
(1)  928/ 6000CCA :                     ; ----------------------------------------------------------------
(1)  929/ 6000CCA :                     
(1)  930/ 6000CCA :                     SH2_M_HotStart:
(1)  931/ 6000CCA : DF50                		mov	#CS3|$40000,r15				; Stack again if coming from RESET
(1)  932/ 6000CCC : DE52                		mov	#RAM_Mars_Global,r14			; GBR - Global values/variables
(1)  933/ 6000CCE : 4E1E                		ldc	r14,gbr
(1)  934/ 6000CD0 : 90C5                		mov	#$F0,r0					; Interrupts OFF
(1)  935/ 6000CD2 : 400E                		ldc	r0,sr
(1)  936/ 6000CD4 : 91C4                		mov.l	#_CCR,r1
(1)  937/ 6000CD6 : E008                		mov	#%00001000,r0				; Cache OFF
(1)  938/ 6000CD8 : 2101                		mov.w	r0,@r1
(1)  939/ 6000CDA : E019                		mov	#%00011001,r0				; Cache purge / Two-way mode / Cache ON
(1)  940/ 6000CDC : 2101                		mov.w	r0,@r1
(1)  941/ 6000CDE : D14F                		mov	#_sysreg,r1
(1)  942/ 6000CE0 : E00A                		mov	#VIRQ_ON|CMDIRQ_ON,r0			; Enable usage of these interrupts
(1)  943/ 6000CE2 : 8011                    		mov.b	r0,@(intmask,r1)			; (Watchdog is external)
(1)  944/ 6000CE4 : D14E                		mov 	#CACHE_MASTER,r1			; Transfer Master's fast-code to CACHE
(1)  945/ 6000CE6 : D24F                		mov 	#$C0000000,r2
(1)  946/ 6000CE8 : 93BB                		mov 	#(CACHE_MASTER_E-CACHE_MASTER)/4,r3
(1)  947/ 6000CEA :                     .copy:
(1)  948/ 6000CEA : 6016                		mov 	@r1+,r0
(1)  949/ 6000CEC : 2202                		mov 	r0,@r2
(1)  950/ 6000CEE : 7204                		add 	#4,r2
(1)  951/ 6000CF0 : 4310                		dt	r3
(1)  952/ 6000CF2 : 8BFA                		bf	.copy
(1)  953/ 6000CF4 : D04C                		mov	#MarsVideo_Init,r0		; Init Video
(1)  954/ 6000CF6 : 400B                		jsr	@r0
(1)  955/ 6000CF8 : 0009                		nop
(1)  956/ 6000CFA : E020                		mov.l	#$20,r0				; Interrupts ON
(1)  957/ 6000CFC : 400E                		ldc	r0,sr
(1)  958/ 6000CFE :                     
(1)  959/ 6000CFE :                     	; *** TEMPORAL
(1)  960/ 6000CFE : D44B                		mov	#RAM_Mars_Linescroll,r4
(1)  961/ 6000D00 : E300                		mov	#0,r3
(1)  962/ 6000D02 : 92AF                		mov	#MSCRL_WIDTH,r2
(1)  963/ 6000D04 : 91AB                		mov	#240,r1
(1)  964/ 6000D06 :                     .copyln:
(1)  965/ 6000D06 : 2432                		mov	r3,@r4
(1)  966/ 6000D08 : 7404                		add	#4,r4
(1)  967/ 6000D0A : 332C                		add	r2,r3
(1)  968/ 6000D0C : 4110                		dt	r1
(1)  969/ 6000D0E : 8BFA                		bf	.copyln
(1)  970/ 6000D10 :                     
(1)  971/ 6000D10 : D147                		mov	#TESTMARS_BG,r1			; Set image
(1)  972/ 6000D12 : 92A8                		mov	#640,r2
(1)  973/ 6000D14 : 93A8                		mov	#480,r3
(1)  974/ 6000D16 : D447                		mov	#$00010000,r4
(1)  975/ 6000D18 : D546                		mov	#$00010000,r5
(1)  976/ 6000D1A : BE63                		bsr	MarsVideo_SetBg
(1)  977/ 6000D1C : 0009                		nop
(1)  978/ 6000D1E : D146                		mov	#TESTMARS_BG_PAL,r1		; Load palette
(1)  979/ 6000D20 : E200                		mov	#0,r2
(1)  980/ 6000D22 : 93A2                		mov	#256,r3
(1)  981/ 6000D24 : E400                		mov	#$0000,r4
(1)  982/ 6000D26 : D045                		mov	#MarsVideo_LoadPal,r0
(1)  983/ 6000D28 : 400B                		jsr	@r0
(1)  984/ 6000D2A : 0009                		nop
(1)  985/ 6000D2C : E002                		mov	#2,r0				; Request full draw on loop
(1)  986/ 6000D2E : C12C                		mov.w	r0,@(marsGbl_Bg_DrwReqFull,gbr)
(1)  987/ 6000D30 : D143                		mov 	#_vdpreg,r1
(1)  988/ 6000D32 : E001                		mov	#1,r0
(1)  989/ 6000D34 : 8011                		mov.b	r0,@(bitmapmd,r1)
(1)  990/ 6000D36 :                     
(1)  991/ 6000D36 :                     ; --------------------------------------------------------
(1)  992/ 6000D36 :                     ; MASTER Loop
(1)  993/ 6000D36 :                     ; --------------------------------------------------------
(1)  994/ 6000D36 :                     
(1)  995/ 6000D36 :                     
(1)  996/ 6000D36 :                     master_loop:
(1)  997/ 6000D36 : D442                		mov	#_vdpreg,r4			; Wait if frameswap is done
(1)  998/ 6000D38 : C46E                		mov.b	@(marsGbl_CurrFb,gbr),r0
(1)  999/ 6000D3A : 6303                		mov	r0,r3
(1) 1000/ 6000D3C : D141                		mov	#.list,r1
(1) 1001/ 6000D3E : C530                		mov.w	@(marsGbl_CurrGfxMode,gbr),r0
(1) 1002/ 6000D40 : C9FF                		and	#$FF,r0
(1) 1003/ 6000D42 : 4008                		shll2	r0
(1) 1004/ 6000D44 : 021E                		mov	@(r0,r1),r2
(1) 1005/ 6000D46 : 844B                .wait_frmswp:	mov.b	@(framectl,r4),r0
(1) 1006/ 6000D48 : 3300                		cmp/eq	r0,r3
(1) 1007/ 6000D4A : 8BFC                		bf	.wait_frmswp
(1) 1008/ 6000D4C : 422B                		jmp	@r2
(1) 1009/ 6000D4E : 0009                		nop
(1) 1010/ 6000D50 :                     		align 4
(1) 1011/ 6000D50 :                     
(1) 1012/ 6000D50 :                     ; --------------------------------------------------------
(1) 1013/ 6000D50 :                     ; GFX mode jumplist
(1) 1014/ 6000D50 :                     ; --------------------------------------------------------
(1) 1015/ 6000D50 :                     
(1) 1016/ 6000D50 :                     .list:
(1) 1017/ 6000D50 : 0600 0D58           		dc.l mstr_gfx0
(1) 1018/ 6000D54 : 0600 0D58           		dc.l mstr_gfx0
(1) 1019/ 6000D58 :                     
(1) 1020/ 6000D58 :                     ; ---------------------------------------
(1) 1021/ 6000D58 :                     ; Custom graphics mode 0
(1) 1022/ 6000D58 :                     ;
(1) 1023/ 6000D58 :                     ; Single 256-color scrolling layer
(1) 1024/ 6000D58 :                     ; using dirty-section method,
(1) 1025/ 6000D58 :                     ; ---------------------------------------
(1) 1026/ 6000D58 :                     
(1) 1027/ 6000D58 :                     mstr_gfx0_init:
(1) 1028/ 6000D58 :                     ; 		mov	#RAM_Mars_Linescroll,r4
(1) 1029/ 6000D58 :                     ; 		mov	#0,r3
(1) 1030/ 6000D58 :                     ; 		mov	#MSCRL_WIDTH,r2
(1) 1031/ 6000D58 :                     ; 		mov	#240,r1
(1) 1032/ 6000D58 :                     ; .copy:
(1) 1033/ 6000D58 :                     ; 		mov	r3,@r4
(1) 1034/ 6000D58 :                     ; 		add	#4,r4
(1) 1035/ 6000D58 :                     ; 		add	r2,r3
(1) 1036/ 6000D58 :                     ; 		dt	r1
(1) 1037/ 6000D58 :                     ; 		bf	.copy
(1) 1038/ 6000D58 :                     ;
(1) 1039/ 6000D58 :                     ; 		mov	#TESTMARS_BG,r1			; Set image
(1) 1040/ 6000D58 :                     ; 		mov	#304,r2
(1) 1041/ 6000D58 :                     ; 		mov	#224,r3
(1) 1042/ 6000D58 :                     ; 		mov	#$00010000,r4
(1) 1043/ 6000D58 :                     ; 		mov	#$00010000,r5
(1) 1044/ 6000D58 :                     ; 		bsr	MarsVideo_SetBg
(1) 1045/ 6000D58 :                     ; 		nop
(1) 1046/ 6000D58 :                     ; 		mov	#TESTMARS_BG_PAL,r1			; Load palette
(1) 1047/ 6000D58 :                     ; 		mov	#0,r2
(1) 1048/ 6000D58 :                     ; 		mov	#256,r3
(1) 1049/ 6000D58 :                     ; 		mov	#$0000,r4
(1) 1050/ 6000D58 :                     ; 		mov	#MarsVideo_LoadPal,r0
(1) 1051/ 6000D58 :                     ; 		jsr	@r0
(1) 1052/ 6000D58 :                     ; 		nop
(1) 1053/ 6000D58 :                     ; 		mov	#2,r0
(1) 1054/ 6000D58 :                     ; 		mov.w	r0,@(marsGbl_Bg_DrwReqFull,gbr)
(1) 1055/ 6000D58 :                     ; 		mov 	#_vdpreg,r1
(1) 1056/ 6000D58 :                     ; 		mov	#1,r0
(1) 1057/ 6000D58 :                     ; 		mov.b	r0,@(bitmapmd,r1)
(1) 1058/ 6000D58 :                     ; 		mov.w	@(marsGbl_CurrGfxMode,gbr),r0
(1) 1059/ 6000D58 :                     ; 		and	#$7F,r0
(1) 1060/ 6000D58 :                     ; 		mov.w	r0,@(marsGbl_CurrGfxMode,gbr)
(1) 1061/ 6000D58 :                     
(1) 1062/ 6000D58 :                     ; ---------------------------------------
(1) 1063/ 6000D58 :                     ; Mode0 loop
(1) 1064/ 6000D58 :                     ; ---------------------------------------
(1) 1065/ 6000D58 :                     
(1) 1066/ 6000D58 :                     mstr_gfx0:
(1) 1067/ 6000D58 : C52C                		mov.w	@(marsGbl_Bg_DrwReqFull,gbr),r0
(1) 1068/ 6000D5A : 8800                		cmp/eq	#0,r0
(1) 1069/ 6000D5C : 8903                		bt	.no_redraw
(1) 1070/ 6000D5E : 4010                		dt	r0
(1) 1071/ 6000D60 : C12C                		mov.w	r0,@(marsGbl_Bg_DrwReqFull,gbr)
(1) 1072/ 6000D62 : BDD9                		bsr	MarsVideo_DrawAllBg
(1) 1073/ 6000D64 : 0009                		nop
(1) 1074/ 6000D66 :                     .no_redraw:
(1) 1075/ 6000D66 : C600                		mov	@(marsGbl_BgData,gbr),r0	; Background data?
(1) 1076/ 6000D68 : 4015                		cmp/pl	r0
(1) 1077/ 6000D6A : 8B49                		bf	.no_num				; No BG: swap only
(1) 1078/ 6000D6C : C52E                		mov.w   @(marsGbl_PlgnBuffNum,gbr),r0	; Start drawing polygons from the READ buffer
(1) 1079/ 6000D6E : C801                		tst     #1,r0				; Check for which buffer to use
(1) 1080/ 6000D70 : 8903                		bt	.p2_rfl
(1) 1081/ 6000D72 : DE35                		mov 	#RAM_Mars_Plgn_ZList_0,r14
(1) 1082/ 6000D74 : DD35                		mov	#RAM_Mars_PlgnNum_0,r13
(1) 1083/ 6000D76 : A004                		bra	.go_rfll
(1) 1084/ 6000D78 : 0009                		nop
(1) 1085/ 6000D7A :                     .p2_rfl:
(1) 1086/ 6000D7A : DE35                		mov 	#RAM_Mars_Plgn_ZList_1,r14
(1) 1087/ 6000D7C : DD35                		mov	#RAM_Mars_PlgnNum_1,r13
(1) 1088/ 6000D7E : 0009                		nop
(1) 1089/ 6000D80 : 0009                		nop
(1) 1090/ 6000D82 :                     .go_rfll:
(1) 1091/ 6000D82 : 6DD1                		mov.w	@r13,r13			; r13 - get numof_plgn
(1) 1092/ 6000D84 : 4D15                		cmp/pl	r13
(1) 1093/ 6000D86 : 8B3B                		bf	.no_num
(1) 1094/ 6000D88 :                     .nxt_rfll:
(1) 1095/ 6000D88 : 6CE2                		mov	@r14,r12			; Get location of the polygon
(1) 1096/ 6000D8A : 4C15                		cmp/pl	r12
(1) 1097/ 6000D8C : 8B35                		bf	.badp
(1) 1098/ 6000D8E : 6BC3                		mov	r12,r11
(1) 1099/ 6000D90 : 7B08                		add	#polygn_points,r11
(1) 1100/ 6000D92 : 60C3                		mov	r12,r0
(1) 1101/ 6000D94 : 50C0                		mov	@(polygn_type,r12),r0
(1) 1102/ 6000D96 : 4029                		shlr16	r0
(1) 1103/ 6000D98 : 4019                		shlr8	r0
(1) 1104/ 6000D9A : E703                		mov	#3,r7
(1) 1105/ 6000D9C : C840                		tst	#PLGN_TRI,r0			; PLGN_TRI set?
(1) 1106/ 6000D9E : 8B00                		bf	.tringl
(1) 1107/ 6000DA0 : 7701                		add	#1,r7
(1) 1108/ 6000DA2 :                     .tringl:
(1) 1109/ 6000DA2 : 6673                		mov	r7,r6
(1) 1110/ 6000DA4 : E100                		mov	#0,r1		; r1 - X left
(1) 1111/ 6000DA6 : E200                		mov	#0,r2		; r2 - X right
(1) 1112/ 6000DA8 : 68B3                		mov 	r11,r8
(1) 1113/ 6000DAA : 69B3                		mov	r11,r9
(1) 1114/ 6000DAC :                     .find_x:
(1) 1115/ 6000DAC : 6081                		mov.w	@r8,r0
(1) 1116/ 6000DAE : 3027                		cmp/gt	r2,r0
(1) 1117/ 6000DB0 : 8B00                		bf	.xis_low
(1) 1118/ 6000DB2 : 6203                		mov 	r0,r2
(1) 1119/ 6000DB4 :                     .xis_low:
(1) 1120/ 6000DB4 : 6091                		mov.w	@r9,r0
(1) 1121/ 6000DB6 : 3017                		cmp/gt	r1,r0
(1) 1122/ 6000DB8 : 8900                		bt	.xis_high
(1) 1123/ 6000DBA : 6103                		mov 	r0,r1
(1) 1124/ 6000DBC :                     .xis_high:
(1) 1125/ 6000DBC : 7804                		add 	#4,r8
(1) 1126/ 6000DBE : 4710                		dt	r7
(1) 1127/ 6000DC0 : 8FF4                		bf/s	.find_x
(1) 1128/ 6000DC2 : 7904                		add	#4,r9
(1) 1129/ 6000DC4 : E300                		mov	#0,r3	; r3 - Y up
(1) 1130/ 6000DC6 : E400                		mov	#0,r4	; r4 - Y down
(1) 1131/ 6000DC8 : 68B3                		mov 	r11,r8
(1) 1132/ 6000DCA : 69B3                		mov	r11,r9
(1) 1133/ 6000DCC :                     .find_top:
(1) 1134/ 6000DCC : 8581                		mov.w	@(2,r8),r0
(1) 1135/ 6000DCE : 3047                		cmp/gt	r4,r0
(1) 1136/ 6000DD0 : 8B00                		bf	.is_low
(1) 1137/ 6000DD2 : 6403                		mov 	r0,r4
(1) 1138/ 6000DD4 :                     .is_low:
(1) 1139/ 6000DD4 : 8591                		mov.w	@(2,r9),r0
(1) 1140/ 6000DD6 : 3037                		cmp/gt	r3,r0
(1) 1141/ 6000DD8 : 8900                		bt	.is_high
(1) 1142/ 6000DDA : 6303                		mov 	r0,r3
(1) 1143/ 6000DDC :                     .is_high:
(1) 1144/ 6000DDC : 7804                		add 	#4,r8
(1) 1145/ 6000DDE : 4610                		dt	r6
(1) 1146/ 6000DE0 : 8FF4                		bf/s	.find_top
(1) 1147/ 6000DE2 : 7904                		add	#4,r9
(1) 1148/ 6000DE4 : 9042                		mov	#SCREEN_WIDTH/2,r0		; Make them direct positions
(1) 1149/ 6000DE6 : 310C                		add	r0,r1
(1) 1150/ 6000DE8 : 320C                		add	r0,r2
(1) 1151/ 6000DEA : E070                		mov	#SCREEN_HEIGHT/2,r0
(1) 1152/ 6000DEC : 330C                		add	r0,r3
(1) 1153/ 6000DEE : 340C                		add	r0,r4
(1) 1154/ 6000DF0 : 71F8                		add	#-(MSCRL_BLKSIZE/2),r1		; Increment box w/h (l/r/u/d)
(1) 1155/ 6000DF2 : 7208                		add	#(MSCRL_BLKSIZE/2),r2
(1) 1156/ 6000DF4 : 73F8                		add	#-(MSCRL_BLKSIZE/2),r3
(1) 1157/ 6000DF6 : B14A                		bsr	mstr_bgfill
(1) 1158/ 6000DF8 : 7408                		add	#(MSCRL_BLKSIZE/2),r4
(1) 1159/ 6000DFA :                     .badp:
(1) 1160/ 6000DFA : 4D10                		dt	r13
(1) 1161/ 6000DFC : 8FC4                		bf/s	.nxt_rfll
(1) 1162/ 6000DFE : 7E04                		add	#4,r14
(1) 1163/ 6000E00 :                     .no_num:
(1) 1164/ 6000E00 : C52E                		mov.w	@(marsGbl_PlgnBuffNum,gbr),r0	; Swap polygon buffer
(1) 1165/ 6000E02 : CA01                 		xor	#1,r0
(1) 1166/ 6000E04 : C12E                 		mov.w	r0,@(marsGbl_PlgnBuffNum,gbr)
(1) 1167/ 6000E06 :                     .no_req:
(1) 1168/ 6000E06 : A032                		bra	gfxmd1_step2
(1) 1169/ 6000E08 : 0009                		nop
(1) 1170/ 6000E0A :                     		align 4
(1) 1171/ 6000E0C : 0604 0000 2000 4020 		ltorg
                    534C 4156 0600 4390 
                    2000 4000 0600 1598 
                    C000 0000 0600 05DE 
                    0600 447C 0205 12B0 
                    0001 0000 0209 C2B0 
                    0600 09A4 2000 4100 
                    0600 0D50 0600 9F84 
                    0600 A784 0600 A384 
                    0600 A786 FE10 FEE2 
                    FEE4 00F0 FE92 0172 
                    0150 0280 01E0 0100 
                    00A0                
(1) 1172/ 6000E6E :                     gfxmd1_step2:
(1) 1173/ 6000E6E :                     
(1) 1174/ 6000E6E :                     	; ---------------------------------------
(1) 1175/ 6000E6E :                     	; Read 3rd-layer scroll values
(1) 1176/ 6000E6E :                     	; ---------------------------------------
(1) 1177/ 6000E6E :                     
(1) 1178/ 6000E6E : E100                		mov	#0,r1				; X/Y reset
(1) 1179/ 6000E70 : E200                		mov	#0,r2
(1) 1180/ 6000E72 : C52F                		mov.w	@(marsGbl_MstrReqDraw,gbr),r0	; Draw request?
(1) 1181/ 6000E74 : 8800                		cmp/eq	#0,r0
(1) 1182/ 6000E76 : 891B                		bt	.no_scrldata
(1) 1183/ 6000E78 : C600                		mov	@(marsGbl_BgData,gbr),r0
(1) 1184/ 6000E7A : 8800                		cmp/eq	#0,r0
(1) 1185/ 6000E7C : 8918                		bt	.no_scrldata
(1) 1186/ 6000E7E :                     
(1) 1187/ 6000E7E :                     	; Small COMM
(1) 1188/ 6000E7E : D56B                 		mov 	#_sysreg+comm0,r5
(1) 1189/ 6000E80 : 6151                 		mov.w	@r5,r1
(1) 1190/ 6000E82 : 8551                 		mov.w	@(2,r5),r0
(1) 1191/ 6000E84 : 6203                 		mov	r0,r2
(1) 1192/ 6000E86 : C606                 		mov	@(marsGbl_Bg_Xpos,gbr),r0
(1) 1193/ 6000E88 : 6303                		mov	r0,r3				; Get OLD X value
(1) 1194/ 6000E8A : 301C                 		add	r1,r0
(1) 1195/ 6000E8C : C206                 		mov	r0,@(marsGbl_Bg_Xpos,gbr)	; Set NEW value
(1) 1196/ 6000E8E : C607                 		mov	@(marsGbl_Bg_Ypos,gbr),r0
(1) 1197/ 6000E90 : 302C                 		add	r2,r0
(1) 1198/ 6000E92 : C207                 		mov	r0,@(marsGbl_Bg_Ypos,gbr)
(1) 1199/ 6000E94 : D466                		mov	#_vdpreg+shift,r4
(1) 1200/ 6000E96 : 6033                		mov	r3,r0
(1) 1201/ 6000E98 : C901                		and	#1,r0
(1) 1202/ 6000E9A : 2401                		mov.w	r0,@r4				; Write OLD value & 1
(1) 1203/ 6000E9C : B15E                		bsr	mstr_movebg
(1) 1204/ 6000E9E : 0009                		nop
(1) 1205/ 6000EA0 :                     
(1) 1206/ 6000EA0 : D564                		mov 	#_sysreg+comm4,r5
(1) 1207/ 6000EA2 : D065                		mov	#RAM_Mars_Linescroll,r0
(1) 1208/ 6000EA4 : 6002                		mov	@r0,r0
(1) 1209/ 6000EA6 : 4001                		shlr	r0
(1) 1210/ 6000EA8 : 2501                		mov.w	r0,@r5
(1) 1211/ 6000EAA : D461                		mov	#_vdpreg+shift,r4
(1) 1212/ 6000EAC : 6041                		mov.w	@r4,r0
(1) 1213/ 6000EAE : 8151                		mov.w	r0,@(2,r5)
(1) 1214/ 6000EB0 :                     .no_scrldata:
(1) 1215/ 6000EB0 :                     
(1) 1216/ 6000EB0 :                     	; ---------------------------------------
(1) 1217/ 6000EB0 :                     	; Write linetable to current framebuffer
(1) 1218/ 6000EB0 :                     	; ---------------------------------------
(1) 1219/ 6000EB0 :                     
(1) 1220/ 6000EB0 :                     	; r1 - X increment
(1) 1221/ 6000EB0 :                     	; r2 - Y increment
(1) 1222/ 6000EB0 : D962                		mov	#RAM_Mars_Linescroll,r9
(1) 1223/ 6000EB2 : DA63                		mov	#_framebuffer,r10
(1) 1224/ 6000EB4 : 98E4                		mov	#$200,r8			; TOP FB position
(1) 1225/ 6000EB6 : D763                		mov	#(MSCRL_WIDTH*MSCRL_HEIGHT),r7	; Last line point
(1) 1227/ 6000EB8 : 93E3                		mov	#240,r3				; Number of lines to show
(1) 1235/ 6000EBA : 90E3                		mov	#MSCRL_WIDTH,r0
(1) 1236/ 6000EBC : 202F                		muls	r2,r0
(1) 1237/ 6000EBE : 021A                		sts	macl,r2
(1) 1239/ 6000EC0 :                     
(1) 1240/ 6000EC0 :                     .ln_loop:
(1) 1241/ 6000EC0 : 6092                		mov	@r9,r0
(1) 1242/ 6000EC2 : 301C                		add	r1,r0
(1) 1243/ 6000EC4 : 302C                		add	r2,r0
(1) 1244/ 6000EC6 : 3073                		cmp/ge	r7,r0
(1) 1245/ 6000EC8 : 8B00                		bf	.xl_r
(1) 1246/ 6000ECA : 3078                		sub	r7,r0
(1) 1247/ 6000ECC :                     .xl_r:
(1) 1248/ 6000ECC : 4011                		cmp/pz	r0
(1) 1249/ 6000ECE : 8900                		bt	.xl_l
(1) 1250/ 6000ED0 : 307C                		add	r7,r0
(1) 1251/ 6000ED2 :                     .xl_l:
(1) 1252/ 6000ED2 : 2902                		mov	r0,@r9
(1) 1253/ 6000ED4 : 7904                		add	#4,r9
(1) 1254/ 6000ED6 : 308C                		add	r8,r0		; add base pos
(1) 1255/ 6000ED8 : 4001                		shlr	r0		; divide by 2
(1) 1256/ 6000EDA : 2A01                		mov.w	r0,@r10		; send to FB's table
(1) 1257/ 6000EDC : 4310                		dt	r3
(1) 1258/ 6000EDE : 8FEF                		bf/s	.ln_loop
(1) 1259/ 6000EE0 : 7A02                		add	#2,r10
(1) 1260/ 6000EE2 :                     
(1) 1261/ 6000EE2 :                     	; ---------------------------------------
(1) 1262/ 6000EE2 :                     
(1) 1263/ 6000EE2 : 93D0                		mov	#_CCR,r3			; <-- Required for Watchdog
(1) 1264/ 6000EE4 : E008                		mov	#%00001000,r0			; Two-way mode
(1) 1265/ 6000EE6 : 2301                		mov.w	r0,@r3
(1) 1266/ 6000EE8 : E019                		mov	#%00011001,r0			; Cache purge / Two-way mode / Cache ON
(1) 1267/ 6000EEA : 2301                		mov.w	r0,@r3
(1) 1268/ 6000EEC : D056                		mov	#MarsVideo_SetWatchdog,r0
(1) 1269/ 6000EEE : 400B                		jsr	@r0
(1) 1270/ 6000EF0 : 0009                		nop
(1) 1271/ 6000EF2 :                     ; 		mov	#CachJmp_DrwUpDown,r0
(1) 1272/ 6000EF2 :                     ; 		jsr	@r0
(1) 1273/ 6000EF2 :                     ; 		nop
(1) 1274/ 6000EF2 :                     
(1) 1275/ 6000EF2 :                     	; Start slicing polygons
(1) 1276/ 6000EF2 :                     	; r14 - Polygon pointers list
(1) 1277/ 6000EF2 :                     	; r13 - Number of polygons to build
(1) 1278/ 6000EF2 : C52F                		mov.w	@(marsGbl_MstrReqDraw,gbr),r0
(1) 1279/ 6000EF4 : 8800                		cmp/eq	#0,r0
(1) 1280/ 6000EF6 : 891C                		bt	.skip
(1) 1281/ 6000EF8 : 200A                		xor	r0,r0
(1) 1282/ 6000EFA : C12F                		mov.w	r0,@(marsGbl_MstrReqDraw,gbr)
(1) 1283/ 6000EFC : C52E                		mov.w   @(marsGbl_PlgnBuffNum,gbr),r0	; Start drawing polygons from the READ buffer
(1) 1284/ 6000EFE : C801                		tst     #1,r0				; Check for which buffer to use
(1) 1285/ 6000F00 : 8903                		bt	.page_2
(1) 1286/ 6000F02 : DE52                		mov 	#RAM_Mars_Plgn_ZList_0,r14
(1) 1287/ 6000F04 : DD52                		mov	#RAM_Mars_PlgnNum_0,r13
(1) 1288/ 6000F06 : A004                		bra	.cont_plgn
(1) 1289/ 6000F08 : 0009                		nop
(1) 1290/ 6000F0A :                     .page_2:
(1) 1291/ 6000F0A : DE52                		mov 	#RAM_Mars_Plgn_ZList_1,r14
(1) 1292/ 6000F0C : DD52                		mov	#RAM_Mars_PlgnNum_1,r13
(1) 1293/ 6000F0E : 0009                		nop
(1) 1294/ 6000F10 : 0009                		nop
(1) 1295/ 6000F12 :                     .cont_plgn:
(1) 1296/ 6000F12 : 6DD1                		mov.w	@r13,r13			; read from memory to register
(1) 1297/ 6000F14 : 4D15                		cmp/pl	r13				; zero?
(1) 1298/ 6000F16 : 8B0C                		bf	.skip
(1) 1299/ 6000F18 :                     .loop:
(1) 1300/ 6000F18 : 2FE6                		mov	r14,@-r15
(1) 1301/ 6000F1A : 2FD6                		mov	r13,@-r15
(1) 1302/ 6000F1C : 6EE2                		mov	@r14,r14			; Get location of the polygon
(1) 1303/ 6000F1E : 4E15                		cmp/pl	r14				; Zero?
(1) 1304/ 6000F20 : 8B02                		bf	.invalid			; if yes, skip
(1) 1305/ 6000F22 : D04E                		mov 	#MarsVideo_SlicePlgn,r0
(1) 1306/ 6000F24 : 400B                		jsr	@r0
(1) 1307/ 6000F26 : 0009                		nop
(1) 1308/ 6000F28 :                     .invalid:
(1) 1309/ 6000F28 : 6DF6                		mov	@r15+,r13
(1) 1310/ 6000F2A : 6EF6                		mov	@r15+,r14
(1) 1311/ 6000F2C : 4D10                		dt	r13				; Decrement numof_polygons
(1) 1312/ 6000F2E : 8FF3                		bf/s	.loop
(1) 1313/ 6000F30 : 7E08                		add	#8,r14				; Move to next entry
(1) 1314/ 6000F32 :                     .skip:
(1) 1315/ 6000F32 :                     
(1) 1316/ 6000F32 :                     	; **** Up/Down draw check
(1) 1317/ 6000F32 : C600                		mov	@(marsGbl_BgData,gbr),r0
(1) 1318/ 6000F34 : 6B03                		mov	r0,r11
(1) 1319/ 6000F36 : 6C03                		mov	r0,r12
(1) 1320/ 6000F38 : C51C                		mov.w	@(marsGbl_BgWidth,gbr),r0
(1) 1321/ 6000F3A : 6103                		mov	r0,r1
(1) 1322/ 6000F3C : C51D                		mov.w	@(marsGbl_BgHeight,gbr),r0
(1) 1323/ 6000F3E : 201E                		mulu	r1,r0
(1) 1324/ 6000F40 : 001A                		sts	macl,r0
(1) 1325/ 6000F42 : 3C0C                		add	r0,r12
(1) 1326/ 6000F44 : E6F0                		mov	#-MSCRL_BLKSIZE,r6
(1) 1327/ 6000F46 : C529                		mov.w	@(marsGbl_Bg_DrwReqD,gbr),r0
(1) 1328/ 6000F48 : 8800                		cmp/eq	#0,r0
(1) 1329/ 6000F4A : 8B04                		bf	.tsk00_down
(1) 1330/ 6000F4C : C528                		mov.w	@(marsGbl_Bg_DrwReqU,gbr),r0
(1) 1331/ 6000F4E : 8800                		cmp/eq	#0,r0
(1) 1332/ 6000F50 : 8B14                		bf	.tsk00_up
(1) 1333/ 6000F52 : A057                		bra	drw_ud_exit
(1) 1334/ 6000F54 : 0009                		nop
(1) 1335/ 6000F56 :                     
(1) 1336/ 6000F56 :                     	; r2 - Start bg line
(1) 1337/ 6000F56 :                     	; r3 - End bg line
(1) 1338/ 6000F56 :                     	; r6 - Y current
(1) 1339/ 6000F56 :                     	; r5 - FB current base
(1) 1340/ 6000F56 :                     .tsk00_down:
(1) 1341/ 6000F56 : 4010                		dt	r0
(1) 1342/ 6000F58 : C129                		mov.w	r0,@(marsGbl_Bg_DrwReqD,gbr)
(1) 1343/ 6000F5A :                     
(1) 1344/ 6000F5A : D241                		mov	#Cach_YHead_D,r2
(1) 1345/ 6000F5C : 6222                		mov	@r2,r2
(1) 1346/ 6000F5E : C51C                		mov.w	@(marsGbl_BgWidth,gbr),r0
(1) 1347/ 6000F60 : 220F                		muls	r0,r2
(1) 1348/ 6000F62 : 021A                		sts	macl,r2
(1) 1349/ 6000F64 : C600                		mov	@(marsGbl_BgData,gbr),r0
(1) 1350/ 6000F66 : 320C                		add	r0,r2
(1) 1351/ 6000F68 : 6323                		mov	r2,r3
(1) 1352/ 6000F6A : C51C                		mov.w	@(marsGbl_BgWidth,gbr),r0
(1) 1353/ 6000F6C : 330C                		add	r0,r3
(1) 1354/ 6000F6E : C60C                		mov	@(marsGbl_Bg_FbBase,gbr),r0
(1) 1355/ 6000F70 : 2069                		and	r6,r0
(1) 1356/ 6000F72 : 6503                		mov	r0,r5
(1) 1357/ 6000F74 : D03B                		mov	#Cach_BgFbPos_D,r0
(1) 1358/ 6000F76 : 6002                		mov	@r0,r0
(1) 1359/ 6000F78 : A012                		bra	.drwy_go
(1) 1360/ 6000F7A : 6603                		mov	r0,r6
(1) 1361/ 6000F7C :                     
(1) 1362/ 6000F7C :                     .tsk00_up:
(1) 1363/ 6000F7C : 4010                		dt	r0
(1) 1364/ 6000F7E : C128                		mov.w	r0,@(marsGbl_Bg_DrwReqU,gbr)
(1) 1365/ 6000F80 :                     
(1) 1366/ 6000F80 : D239                		mov	#Cach_YHead_U,r2
(1) 1367/ 6000F82 : 6222                		mov	@r2,r2
(1) 1368/ 6000F84 : C51C                		mov.w	@(marsGbl_BgWidth,gbr),r0
(1) 1369/ 6000F86 : 220F                		muls	r0,r2
(1) 1370/ 6000F88 : 021A                		sts	macl,r2
(1) 1371/ 6000F8A : C600                		mov	@(marsGbl_BgData,gbr),r0
(1) 1372/ 6000F8C : 320C                		add	r0,r2
(1) 1373/ 6000F8E : 6323                		mov	r2,r3
(1) 1374/ 6000F90 : C51C                		mov.w	@(marsGbl_BgWidth,gbr),r0
(1) 1375/ 6000F92 : 330C                		add	r0,r3
(1) 1376/ 6000F94 : C60C                		mov	@(marsGbl_Bg_FbBase,gbr),r0
(1) 1377/ 6000F96 : 2069                		and	r6,r0
(1) 1378/ 6000F98 : 6503                		mov	r0,r5
(1) 1379/ 6000F9A : D034                		mov	#Cach_BgFbPos_U,r0
(1) 1380/ 6000F9C : 6002                		mov	@r0,r0
(1) 1381/ 6000F9E : 6603                		mov	r0,r6
(1) 1382/ 6000FA0 :                     
(1) 1383/ 6000FA0 :                     .drwy_go:
(1) 1384/ 6000FA0 : E810                		mov	#MSCRL_BLKSIZE,r8
(1) 1385/ 6000FA2 :                     .rept_y:
(1) 1386/ 6000FA2 : 32C3                		cmp/ge	r12,r2
(1) 1387/ 6000FA4 : 8B03                		bf	.ybgend
(1) 1388/ 6000FA6 : 62B3                		mov	r11,r2
(1) 1389/ 6000FA8 : 63B3                		mov	r11,r3
(1) 1390/ 6000FAA : C51C                		mov.w	@(marsGbl_BgWidth,gbr),r0
(1) 1391/ 6000FAC : 330C                		add	r0,r3
(1) 1392/ 6000FAE :                     .ybgend:
(1) 1393/ 6000FAE :                     
(1) 1394/ 6000FAE : 6123                		mov	r2,r1		; r1 - bg pixel data
(1) 1395/ 6000FB0 : E7F0                		mov	#-MSCRL_BLKSIZE,r7
(1) 1396/ 6000FB2 : D02F                		mov	#Cach_XHead_L,r0
(1) 1397/ 6000FB4 : 6002                		mov	@r0,r0
(1) 1398/ 6000FB6 : 2079                		and	r7,r0
(1) 1399/ 6000FB8 : 310C                		add	r0,r1
(1) 1400/ 6000FBA :                     
(1) 1401/ 6000FBA : 6453                		mov	r5,r4		; r4 - X
(1) 1402/ 6000FBC : 6063                		mov	r6,r0
(1) 1403/ 6000FBE : 9761                		mov	#MSCRL_WIDTH,r7
(1) 1404/ 6000FC0 : 207E                		mulu	r7,r0
(1) 1405/ 6000FC2 : 001A                		sts	macl,r0
(1) 1406/ 6000FC4 :                     ; 		shll8	r0
(1) 1407/ 6000FC4 :                     ; 		shll	r0
(1) 1408/ 6000FC4 : 340C                		add	r0,r4		; X + Y
(1) 1409/ 6000FC6 : E754                		mov	#(MSCRL_WIDTH)/4,r7
(1) 1410/ 6000FC8 :                     
(1) 1411/ 6000FC8 :                     
(1) 1412/ 6000FC8 :                     .rept_x:
(1) 1413/ 6000FC8 : D01E                		mov	#(MSCRL_WIDTH*MSCRL_HEIGHT),r0
(1) 1414/ 6000FCA : 3403                		cmp/ge	r0,r4
(1) 1415/ 6000FCC : 8B00                		bf	.res_x
(1) 1416/ 6000FCE : 3408                		sub	r0,r4
(1) 1417/ 6000FD0 :                     .res_x:
(1) 1418/ 6000FD0 : 3133                		cmp/ge	r3,r1
(1) 1419/ 6000FD2 : 8B00                		bf	.xlon1
(1) 1420/ 6000FD4 : 6123                		mov	r2,r1
(1) 1421/ 6000FD6 :                     .xlon1:
(1) 1422/ 6000FD6 : 6A16                		mov	@r1+,r10
(1) 1423/ 6000FD8 :                     
(1) 1424/ 6000FD8 : 6943                		mov	r4,r9
(1) 1425/ 6000FDA : D026                		mov	#_framebuffer+$200,r0
(1) 1426/ 6000FDC : 390C                		add	r0,r9
(1) 1427/ 6000FDE : 9053                		mov	#320,r0
(1) 1428/ 6000FE0 : 3407                		cmp/gt	r0,r4
(1) 1429/ 6000FE2 : 8902                		bt	.not_l2
(1) 1430/ 6000FE4 : D024                		mov	#(_framebuffer+$200)+(MSCRL_WIDTH*MSCRL_HEIGHT),r0
(1) 1431/ 6000FE6 : 304C                		add	r4,r0
(1) 1432/ 6000FE8 : 20A2                		mov	r10,@r0
(1) 1433/ 6000FEA :                     .not_l2:
(1) 1434/ 6000FEA : 29A2                		mov	r10,@r9
(1) 1435/ 6000FEC : 4710                		dt	r7
(1) 1436/ 6000FEE : 8FEB                		bf/s	.rept_x
(1) 1437/ 6000FF0 : 7404                		add	#4,r4
(1) 1438/ 6000FF2 :                     
(1) 1439/ 6000FF2 : C51C                		mov.w	@(marsGbl_BgWidth,gbr),r0
(1) 1440/ 6000FF4 : 320C                		add	r0,r2
(1) 1441/ 6000FF6 : 330C                		add	r0,r3
(1) 1443/ 6000FF8 : 6063                		mov	r6,r0
(1) 1444/ 6000FFA : 7001                		add	#1,r0
(1) 1445/ 6000FFC : C9FF                		and	#$FF,r0
(1) 1446/ 6000FFE : 6603                		mov	r0,r6
(1) 1455/ 6001000 : 4810                		dt	r8
(1) 1456/ 6001002 : 8BCE                		bf	.rept_y
(1) 1457/ 6001004 :                     drw_ud_exit:
(1) 1458/ 6001004 :                     
(1) 1459/ 6001004 :                     ; 		mov	#_sysreg+comm8,r1
(1) 1460/ 6001004 :                     ; 		mov	#0,r0
(1) 1461/ 6001004 :                     ; 		mov.w	r0,@r1
(1) 1462/ 6001004 :                     ; 		mov.w	r0,@(2,r1)
(1) 1463/ 6001004 :                     	; --------------------------------------
(1) 1464/ 6001004 :                     .wait_pz:
(1) 1465/ 6001004 :                     ; 		mov.w	@r1,r0
(1) 1466/ 6001004 :                     ; 		add	#1,r0
(1) 1467/ 6001004 :                     ; 		mov.w	r0,@r1
(1) 1468/ 6001004 : C531                		mov.w	@(marsGbl_PzListCntr,gbr),r0	; Any pieces remaining on Watchdog?
(1) 1469/ 6001006 : 8800                		cmp/eq	#0,r0
(1) 1470/ 6001008 : 8BFC                		bf	.wait_pz
(1) 1471/ 600100A :                     .wait_task:
(1) 1472/ 600100A :                     ; 		mov.w	@(2,r1),r0
(1) 1473/ 600100A :                     ; 		add	#1,r0
(1) 1474/ 600100A :                     ; 		mov.w	r0,@(2,r1)
(1) 1475/ 600100A : C532                		mov.w	@(marsGbl_DrwTask,gbr),r0	; Any drawing task active?
(1) 1476/ 600100C : 8800                		cmp/eq	#0,r0
(1) 1477/ 600100E : 8BFC                		bf	.wait_task
(1) 1478/ 6001010 : 913B                		mov.l   #$FFFFFE80,r1			; Stop watchdog
(1) 1479/ 6001012 : 903B                		mov.w   #$A518,r0
(1) 1480/ 6001014 : 2101                		mov.w   r0,@r1
(1) 1481/ 6001016 :                     
(1) 1482/ 6001016 : D119                		mov	#_vdpreg,r1
(1) 1483/ 6001018 : 8515                .waitfb:	mov.w	@(vdpsts,r1),r0			; Wait until any line-fill finishes.
(1) 1484/ 600101A : C802                		tst	#%10,r0
(1) 1485/ 600101C : 8BFC                		bf	.waitfb
(1) 1486/ 600101E : D117                		mov	#_vdpreg,r1
(1) 1487/ 6001020 : 841B                		mov.b	@(framectl,r1),r0		; Frameswap request, Next Watchdog will
(1) 1488/ 6001022 : CA01                		xor	#1,r0				; check for it later.
(1) 1489/ 6001024 : 801B                		mov.b	r0,@(framectl,r1)		; Save new bit
(1) 1490/ 6001026 : C06E                		mov.b	r0,@(marsGbl_CurrFb,gbr)	; And a copy for checking
(1) 1491/ 6001028 :                     
(1) 1492/ 6001028 : AE85                		bra	master_loop
(1) 1493/ 600102A : 0009                		nop
(1) 1494/ 600102C :                     		align 4
(1) 1495/ 600102C : 2000 4020 2000 4102 		ltorg
                    2000 4024 0600 447C 
                    0600 447C 2400 0000 
                    0001 5000 0600 0A24 
                    0600 9F84 0600 A784 
                    0600 A384 0600 A786 
                    0600 05FE C000 0508 
                    C000 0524 C000 050C 
                    C000 0520 C000 0500 
                    2400 0200 2401 5200 
                    2000 4100 0200 00F0 
                    0150 FE92 0140 FE80 
                    A518                
(1) 1496/ 600108E :                     
(1) 1497/ 600108E :                     
(1) 1498/ 600108E :                     ; r1 - X left
(1) 1499/ 600108E :                     ; r2 - X right
(1) 1500/ 600108E :                     ; r3 - Y top
(1) 1501/ 600108E :                     ; r4 - Y bottom
(1) 1502/ 600108E :                     mstr_bgfill:
(1) 1503/ 600108E : 2FE6                		mov	r14,@-r15
(1) 1504/ 6001090 : 2FD6                		mov	r13,@-r15
(1) 1505/ 6001092 : 3438                		sub	r3,r4
(1) 1506/ 6001094 : 4411                		cmp/pz	r4
(1) 1507/ 6001096 : 8B52                		bf	.len_off
(1) 1508/ 6001098 :                     ; 		add	#1,r4
(1) 1509/ 6001098 : E0FC                		mov	#-4,r0
(1) 1510/ 600109A : 2109                		and	r0,r1
(1) 1511/ 600109C : 2209                		and	r0,r2
(1) 1512/ 600109E : 3218                		sub	r1,r2
(1) 1513/ 60010A0 : 4211                		cmp/pz	r2
(1) 1514/ 60010A2 : 8B4C                		bf	.len_off
(1) 1515/ 60010A4 : 4209                		shlr2	r2
(1) 1516/ 60010A6 :                     
(1) 1517/ 60010A6 :                     ; 		mov.w	@(marsGbl_Bg_YFbPos_U,gbr),r0
(1) 1518/ 60010A6 :                     ; 		mov	#MSCRL_WIDTH,r12
(1) 1519/ 60010A6 :                     ; 		mulu	r12,r0
(1) 1520/ 60010A6 :                     ; 		sts	macl,r12
(1) 1521/ 60010A6 :                     ; 		mov	@(marsGbl_Bg_FbBase,gbr),r0
(1) 1522/ 60010A6 :                     ; 		add	r12,r0
(1) 1523/ 60010A6 :                     ; 		mov	#-4,r12
(1) 1524/ 60010A6 :                     ; 		and	r12,r0
(1) 1525/ 60010A6 :                     ; 		mov	r0,r12
(1) 1526/ 60010A6 : D028                		mov	#RAM_Mars_Linescroll,r0
(1) 1527/ 60010A8 : 6002                		mov	@r0,r0
(1) 1528/ 60010AA : ECFC                		mov	#-4,r12
(1) 1529/ 60010AC : 20C9                		and	r12,r0
(1) 1530/ 60010AE : 6C03                		mov	r0,r12
(1) 1531/ 60010B0 : 9052                		mov	#MSCRL_WIDTH,r0
(1) 1532/ 60010B2 : 230E                		mulu	r0,r3
(1) 1533/ 60010B4 : 001A                		sts	macl,r0
(1) 1534/ 60010B6 : 3C0C                		add	r0,r12
(1) 1535/ 60010B8 : 3C1C                		add	r1,r12
(1) 1536/ 60010BA :                     
(1) 1537/ 60010BA : C51D                		mov.w	@(marsGbl_BgHeight,gbr),r0
(1) 1538/ 60010BC : 6503                		mov	r0,r5
(1) 1539/ 60010BE : C51C                		mov.w	@(marsGbl_BgWidth,gbr),r0
(1) 1540/ 60010C0 : 6603                		mov	r0,r6
(1) 1541/ 60010C2 : 265E                		mulu	r5,r6
(1) 1542/ 60010C4 : 051A                		sts	macl,r5
(1) 1543/ 60010C6 : C600                		mov	@(marsGbl_BgData,gbr),r0
(1) 1544/ 60010C8 : 6A03                		mov	r0,r10
(1) 1545/ 60010CA : 6903                		mov	r0,r9
(1) 1546/ 60010CC : 6803                		mov	r0,r8
(1) 1547/ 60010CE : 385C                		add	r5,r8
(1) 1548/ 60010D0 : C51D                		mov.w	@(marsGbl_BgHeight,gbr),r0
(1) 1549/ 60010D2 : 6503                		mov	r0,r5
(1) 1550/ 60010D4 : C526                		mov.w	@(marsGbl_Bg_YbgInc_U,gbr),r0
(1) 1551/ 60010D6 : 303C                		add	r3,r0
(1) 1552/ 60010D8 : 3053                		cmp/ge	r5,r0
(1) 1553/ 60010DA : 8B00                		bf	.noyrest
(1) 1554/ 60010DC : 3058                		sub	r5,r0
(1) 1555/ 60010DE :                     .noyrest:
(1) 1556/ 60010DE : 206E                		mulu	r6,r0
(1) 1557/ 60010E0 : 001A                		sts	macl,r0
(1) 1558/ 60010E2 : 3A0C                		add	r0,r10
(1) 1559/ 60010E4 :                     
(1) 1560/ 60010E4 :                     	; r10 - Y curr
(1) 1561/ 60010E4 :                     	;  r9 - Y start
(1) 1562/ 60010E4 :                     	;  r8 - Y end
(1) 1563/ 60010E4 :                     	;  r7 - X read
(1) 1564/ 60010E4 :                     .y_nxt:
(1) 1565/ 60010E4 : 3A83                		cmp/ge	r8,r10
(1) 1566/ 60010E6 : 8B00                		bf	.ybgres
(1) 1567/ 60010E8 : 6A93                		mov	r9,r10
(1) 1568/ 60010EA :                     .ybgres:
(1) 1569/ 60010EA : 67A3                		mov	r10,r7
(1) 1570/ 60010EC : 66A3                		mov	r10,r6
(1) 1571/ 60010EE : 65A3                		mov	r10,r5
(1) 1572/ 60010F0 : C51C                		mov.w	@(marsGbl_BgWidth,gbr),r0
(1) 1573/ 60010F2 : 6B03                		mov	r0,r11
(1) 1574/ 60010F4 : C523                		mov.w	@(marsGbl_Bg_XbgInc_L,gbr),r0
(1) 1575/ 60010F6 : 301C                		add	r1,r0
(1) 1576/ 60010F8 : 30B3                		cmp/ge	r11,r0
(1) 1577/ 60010FA : 8B00                		bf	.noxres
(1) 1578/ 60010FC : 30B8                		sub	r11,r0
(1) 1579/ 60010FE :                     .noxres:
(1) 1580/ 60010FE : 370C                		add	r0,r7
(1) 1581/ 6001100 : C51C                		mov.w	@(marsGbl_BgWidth,gbr),r0
(1) 1582/ 6001102 : 350C                		add	r0,r5
(1) 1583/ 6001104 : 6BC3                		mov	r12,r11		; X current
(1) 1584/ 6001106 : 6D23                		mov	r2,r13		; X width
(1) 1585/ 6001108 : 7D01                		add	#1,r13		; TODO: temporal...
(1) 1586/ 600110A :                     ; X loop
(1) 1587/ 600110A :                     .x_nxt:
(1) 1588/ 600110A : 3753                		cmp/ge	r5,r7
(1) 1589/ 600110C : 8B00                		bf	.xbgres
(1) 1590/ 600110E : 6763                		mov	r6,r7
(1) 1591/ 6001110 :                     .xbgres:
(1) 1592/ 6001110 : D00E                		mov	#MSCRL_WIDTH*MSCRL_HEIGHT,r0
(1) 1593/ 6001112 : 3B03                		cmp/ge	r0,r11
(1) 1594/ 6001114 : 8B00                		bf	.ylarg
(1) 1595/ 6001116 : 3B08                		sub	r0,r11
(1) 1596/ 6001118 :                     .ylarg:
(1) 1597/ 6001118 : 6376                		mov	@r7+,r3
(1) 1598/ 600111A : D00D                		mov	#_framebuffer+$200,r0
(1) 1599/ 600111C : 30BC                		add	r11,r0
(1) 1600/ 600111E : 2032                		mov	r3,@r0
(1) 1601/ 6001120 : 901B                		mov	#320,r0
(1) 1602/ 6001122 : 3B07                		cmp/gt	r0,r11
(1) 1603/ 6001124 : 8902                		bt	.not_hdn
(1) 1604/ 6001126 : D00B                		mov	#_framebuffer+$200+(MSCRL_WIDTH*MSCRL_HEIGHT),r0
(1) 1605/ 6001128 : 30BC                		add	r11,r0
(1) 1606/ 600112A : 2032                		mov	r3,@r0
(1) 1607/ 600112C :                     .not_hdn:
(1) 1608/ 600112C : 4D10                		dt	r13
(1) 1609/ 600112E : 8FEC                		bf/s	.x_nxt
(1) 1610/ 6001130 : 7B04                		add	#4,r11
(1) 1611/ 6001132 :                     
(1) 1612/ 6001132 : C51C                		mov.w	@(marsGbl_BgWidth,gbr),r0
(1) 1613/ 6001134 : 3A0C                		add	r0,r10
(1) 1614/ 6001136 : 900F                		mov	#MSCRL_WIDTH,r0
(1) 1615/ 6001138 : 4410                		dt	r4
(1) 1616/ 600113A : 8FD3                		bf/s	.y_nxt
(1) 1617/ 600113C : 3C0C                		add	r0,r12
(1) 1618/ 600113E :                     
(1) 1619/ 600113E :                     .len_off:
(1) 1620/ 600113E : 6DF6                		mov	@r15+,r13
(1) 1621/ 6001140 : 6EF6                		mov	@r15+,r14
(1) 1622/ 6001142 : 000B                		rts
(1) 1623/ 6001144 : 0009                		nop
(1) 1624/ 6001146 :                     		align 4
(1) 1625/ 6001148 : 0600 447C 0001 5000 		ltorg
                    2400 0200 2401 5200 
                    0150 0140           
(1) 1626/ 600115C :                     
(1) 1627/ 600115C :                     ; r1 - X move
(1) 1628/ 600115C :                     ; r2 - Y move
(1) 1629/ 600115C :                     mstr_movebg:
(1) 1630/ 600115C :                     ; 		mov 	#_sysreg+comm14,r3		; temporal communication
(1) 1631/ 600115C :                     ; 		mov	#1,r0
(1) 1632/ 600115C :                     ; 		mov.b	r0,@r3
(1) 1633/ 600115C :                     
(1) 1634/ 600115C :                     	; ---------------------------------------
(1) 1635/ 600115C :                     	; Get X/Y increment values (at r1 and r2)
(1) 1636/ 600115C :                     	; using CURR and OLD values
(1) 1637/ 600115C :                     	; and Set the X-shift bit
(1) 1638/ 600115C :                     	; ---------------------------------------
(1) 1639/ 600115C :                     
(1) 1640/ 600115C : D868                		mov 	#_sysreg+comm0,r8
(1) 1641/ 600115E : C606                		mov	@(marsGbl_Bg_Xpos,gbr),r0
(1) 1642/ 6001160 : 6303                		mov	r0,r3
(1) 1643/ 6001162 : C608                		mov	@(marsGbl_Bg_Xpos_old,gbr),r0
(1) 1644/ 6001164 : 3300                		cmp/eq	r0,r3
(1) 1645/ 6001166 : 8903                		bt	.xequ
(1) 1646/ 6001168 : 6133                		mov	r3,r1
(1) 1647/ 600116A : 3108                		sub	r0,r1
(1) 1648/ 600116C : C901                		and	#1,r0
(1) 1649/ 600116E : 2701                		mov.w	r0,@r7
(1) 1650/ 6001170 :                     .xequ:
(1) 1651/ 6001170 : 6033                		mov	r3,r0
(1) 1652/ 6001172 : C208                		mov	r0,@(marsGbl_Bg_Xpos_old,gbr)
(1) 1653/ 6001174 : C607                		mov	@(marsGbl_Bg_Ypos,gbr),r0
(1) 1654/ 6001176 : 6303                		mov	r0,r3
(1) 1655/ 6001178 : C609                		mov	@(marsGbl_Bg_Ypos_old,gbr),r0
(1) 1656/ 600117A : 3300                		cmp/eq	r0,r3
(1) 1657/ 600117C : 8901                		bt	.yequ
(1) 1658/ 600117E : 6233                		mov	r3,r2
(1) 1659/ 6001180 : 3208                		sub	r0,r2
(1) 1660/ 6001182 :                     .yequ:
(1) 1661/ 6001182 : 6033                		mov	r3,r0
(1) 1662/ 6001184 : C209                		mov	r0,@(marsGbl_Bg_Ypos_old,gbr)
(1) 1663/ 6001186 : 4111                		cmp/pz	r1
(1) 1664/ 6001188 : 8900                		bt	.x_stend
(1) 1665/ 600118A : 611F                		exts	r1,r1
(1) 1666/ 600118C :                     .x_stend:
(1) 1667/ 600118C : 4211                		cmp/pz	r2
(1) 1668/ 600118E : 8900                		bt	.y_stend
(1) 1669/ 6001190 : 622F                		exts	r2,r2
(1) 1670/ 6001192 :                     .y_stend:
(1) 1671/ 6001192 : D35C                		mov 	#_sysreg+comm14,r3		; temporal communication
(1) 1672/ 6001194 : E000                		mov	#0,r0
(1) 1673/ 6001196 : 2300                		mov.b	r0,@r3
(1) 1674/ 6001198 :                     
(1) 1675/ 6001198 :                     ; 	---------------------------------------
(1) 1676/ 6001198 :                     ; 	Y move
(1) 1677/ 6001198 :                     ; 	---------------------------------------
(1) 1678/ 6001198 :                     
(1) 1679/ 6001198 :                     ; 		mov.w	@(marsGbl_Bg_Yset,gbr),r0
(1) 1680/ 6001198 :                     ; 		add	r2,r0
(1) 1681/ 6001198 :                     ; 		mov	r0,r4
(1) 1682/ 6001198 :                     ; 		tst	#%11110000,r0
(1) 1683/ 6001198 :                     ; 		bt	.yset_w
(1) 1684/ 6001198 :                     ;
(1) 1685/ 6001198 :                     ; 		mov	#0,r7
(1) 1686/ 6001198 :                     ; 		mov	r2,r0
(1) 1687/ 6001198 :                     ; 		cmp/eq	#0,r0
(1) 1688/ 6001198 :                     ; 		bt	.noy
(1) 1689/ 6001198 :                     ; 		mov	#%0100,r7
(1) 1690/ 6001198 :                     ; 		cmp/pz	r2
(1) 1691/ 6001198 :                     ; 		bt	.noy
(1) 1692/ 6001198 :                     ; 		mov	#%1000,r7
(1) 1693/ 6001198 :                     ; .noy:
(1) 1694/ 6001198 :                     
(1) 1695/ 6001198 :                     	; Set Y framebuffer position
(1) 1697/ 6001198 : C520                		mov.w	@(marsGbl_Bg_YFbPos_U,gbr),r0
(1) 1698/ 600119A : 302C                		add	r2,r0
(1) 1699/ 600119C : C9FF                		and	#$FF,r0
(1) 1700/ 600119E : C120                		mov.w	r0,@(marsGbl_Bg_YFbPos_U,gbr)
(1) 1701/ 60011A0 : C521                		mov.w	@(marsGbl_Bg_YFbPos_D,gbr),r0
(1) 1702/ 60011A2 : 302C                		add	r2,r0
(1) 1703/ 60011A4 : C9FF                		and	#$FF,r0
(1) 1704/ 60011A6 : C121                		mov.w	r0,@(marsGbl_Bg_YFbPos_D,gbr)
(1) 1705/ 60011A8 : C522                		mov.w	@(marsGbl_Bg_YFbPos_LR,gbr),r0
(1) 1706/ 60011AA : 302C                		add	r2,r0
(1) 1707/ 60011AC : C9FF                		and	#$FF,r0
(1) 1708/ 60011AE : C122                		mov.w	r0,@(marsGbl_Bg_YFbPos_LR,gbr)
(1) 1762/ 60011B0 :                     
(1) 1763/ 60011B0 :                     	; Y Map limit
(1) 1764/ 60011B0 : C51D                		mov.w	@(marsGbl_BgHeight,gbr),r0
(1) 1765/ 60011B2 : 6303                		mov	r0,r3
(1) 1766/ 60011B4 : C526                		mov.w	@(marsGbl_Bg_YbgInc_U,gbr),r0
(1) 1767/ 60011B6 : 302C                		add	r2,r0
(1) 1768/ 60011B8 : 4215                		cmp/pl	r2
(1) 1769/ 60011BA : 8B02                		bf	.ynegtv
(1) 1770/ 60011BC : 3037                		cmp/gt	r3,r0
(1) 1771/ 60011BE : 8B00                		bf	.ynegtv
(1) 1772/ 60011C0 : 3038                		sub	r3,r0
(1) 1773/ 60011C2 :                     .ynegtv:
(1) 1774/ 60011C2 : 4211                		cmp/pz	r2
(1) 1775/ 60011C4 : 8902                		bt	.ypostv
(1) 1776/ 60011C6 : 4011                		cmp/pz	r0
(1) 1777/ 60011C8 : 8900                		bt	.ypostv
(1) 1778/ 60011CA : 303C                		add	r3,r0
(1) 1779/ 60011CC :                     .ypostv:
(1) 1780/ 60011CC : C126                		mov.w	r0,@(marsGbl_Bg_YbgInc_U,gbr)
(1) 1781/ 60011CE : C525                		mov.w	@(marsGbl_Bg_YbgInc_D,gbr),r0
(1) 1782/ 60011D0 : 302C                		add	r2,r0
(1) 1783/ 60011D2 : 4215                		cmp/pl	r2
(1) 1784/ 60011D4 : 8B02                		bf	.ynegtvl
(1) 1785/ 60011D6 : 3037                		cmp/gt	r3,r0
(1) 1786/ 60011D8 : 8B00                		bf	.ynegtvl
(1) 1787/ 60011DA : 3038                		sub	r3,r0
(1) 1788/ 60011DC :                     .ynegtvl:
(1) 1789/ 60011DC : 4211                		cmp/pz	r2
(1) 1790/ 60011DE : 8902                		bt	.ypostvl
(1) 1791/ 60011E0 : 4011                		cmp/pz	r0
(1) 1792/ 60011E2 : 8900                		bt	.ypostvl
(1) 1793/ 60011E4 : 303C                		add	r3,r0
(1) 1794/ 60011E6 :                     .ypostvl:
(1) 1795/ 60011E6 : C125                		mov.w	r0,@(marsGbl_Bg_YbgInc_D,gbr)
(1) 1796/ 60011E8 : C527                		mov.w	@(marsGbl_Bg_YbgInc_LR,gbr),r0
(1) 1797/ 60011EA : 302C                		add	r2,r0
(1) 1798/ 60011EC : 4215                		cmp/pl	r2
(1) 1799/ 60011EE : 8B02                		bf	.yenegtv
(1) 1800/ 60011F0 : 3033                		cmp/ge	r3,r0
(1) 1801/ 60011F2 : 8B00                		bf	.yenegtv
(1) 1802/ 60011F4 : 3038                		sub	r3,r0
(1) 1803/ 60011F6 :                     .yenegtv:
(1) 1804/ 60011F6 : 4211                		cmp/pz	r2
(1) 1805/ 60011F8 : 8902                		bt	.yepostv
(1) 1806/ 60011FA : 4011                		cmp/pz	r0
(1) 1807/ 60011FC : 8900                		bt	.yepostv
(1) 1808/ 60011FE : 303C                		add	r3,r0
(1) 1809/ 6001200 :                     .yepostv:
(1) 1810/ 6001200 : C127                		mov.w	r0,@(marsGbl_Bg_YbgInc_LR,gbr)
(1) 1811/ 6001202 :                     
(1) 1812/ 6001202 :                     ; 		mov.w	@(marsGbl_Bg_DrwReq,gbr),r0	; r7: draw directions
(1) 1813/ 6001202 :                     ; 		or	r7,r0
(1) 1814/ 6001202 :                     ; 		mov.w	r0,@(marsGbl_Bg_DrwReq,gbr)
(1) 1815/ 6001202 :                     ; .yset_w:
(1) 1816/ 6001202 :                     
(1) 1817/ 6001202 :                     	; Set Up/Down requests
(1) 1818/ 6001202 : C51F                		mov.w	@(marsGbl_Bg_Yset,gbr),r0
(1) 1819/ 6001204 : 302C                		add	r2,r0
(1) 1820/ 6001206 : 6603                		mov	r0,r6
(1) 1821/ 6001208 : C8F0                		tst	#(-MSCRL_BLKSIZE)&$FF,r0
(1) 1822/ 600120A : 8924                		bt	.ydr_busy
(1) 1823/ 600120C : E3F0                		mov	#-MSCRL_BLKSIZE,r3
(1) 1824/ 600120E : 4215                		cmp/pl	r2
(1) 1825/ 6001210 : 8B0F                		bf	.reqd_b
(1) 1826/ 6001212 : C528                		mov.w	@(marsGbl_Bg_DrwReqU,gbr),r0
(1) 1827/ 6001214 : 6403                		mov	r0,r4
(1) 1828/ 6001216 : C529                		mov.w	@(marsGbl_Bg_DrwReqD,gbr),r0
(1) 1829/ 6001218 : 204B                		or	r4,r0
(1) 1830/ 600121A : 8800                		cmp/eq	#0,r0
(1) 1831/ 600121C : 8B1B                		bf	.ydr_busy
(1) 1832/ 600121E :                     
(1) 1833/ 600121E : C525                		mov.w	@(marsGbl_Bg_YbgInc_D,gbr),r0
(1) 1834/ 6001220 : D439                		mov	#Cach_YHead_D,r4
(1) 1835/ 6001222 : 2039                		and	r3,r0
(1) 1836/ 6001224 : 2402                		mov	r0,@r4
(1) 1837/ 6001226 : C521                		mov.w	@(marsGbl_Bg_YFbPos_D,gbr),r0
(1) 1838/ 6001228 : D438                		mov	#Cach_BgFbPos_D,r4
(1) 1839/ 600122A : 2039                		and	r3,r0
(1) 1840/ 600122C : 2402                		mov	r0,@r4
(1) 1841/ 600122E : E002                		mov	#2,r0
(1) 1842/ 6001230 : C129                		mov.w	r0,@(marsGbl_Bg_DrwReqD,gbr)
(1) 1843/ 6001232 :                     
(1) 1844/ 6001232 :                     .reqd_b:
(1) 1845/ 6001232 : 4211                		cmp/pz	r2
(1) 1846/ 6001234 : 890F                		bt	.ydr_busy
(1) 1847/ 6001236 : C528                		mov.w	@(marsGbl_Bg_DrwReqU,gbr),r0
(1) 1848/ 6001238 : 6403                		mov	r0,r4
(1) 1849/ 600123A : C529                		mov.w	@(marsGbl_Bg_DrwReqD,gbr),r0
(1) 1850/ 600123C : 204B                		or	r4,r0
(1) 1851/ 600123E : 8800                		cmp/eq	#0,r0
(1) 1852/ 6001240 : 8B09                		bf	.ydr_busy
(1) 1853/ 6001242 :                     
(1) 1854/ 6001242 : C526                		mov.w	@(marsGbl_Bg_YbgInc_U,gbr),r0
(1) 1855/ 6001244 : D432                		mov	#Cach_YHead_U,r4
(1) 1856/ 6001246 : 2039                		and	r3,r0
(1) 1857/ 6001248 : 2402                		mov	r0,@r4
(1) 1858/ 600124A : C520                		mov.w	@(marsGbl_Bg_YFbPos_U,gbr),r0
(1) 1859/ 600124C : D431                		mov	#Cach_BgFbPos_U,r4
(1) 1860/ 600124E : 2039                		and	r3,r0
(1) 1861/ 6001250 : 2402                		mov	r0,@r4
(1) 1862/ 6001252 : E002                		mov	#2,r0
(1) 1863/ 6001254 : C128                		mov.w	r0,@(marsGbl_Bg_DrwReqU,gbr)
(1) 1864/ 6001256 :                     
(1) 1865/ 6001256 :                     .ydr_busy:
(1) 1866/ 6001256 : 6063                		mov	r6,r0
(1) 1867/ 6001258 : C90F                		and	#MSCRL_BLKSIZE-1,r0
(1) 1868/ 600125A : C11F                		mov.w	r0,@(marsGbl_Bg_Yset,gbr)
(1) 1869/ 600125C :                     
(1) 1870/ 600125C :                     .skipyset:
(1) 1871/ 600125C :                     
(1) 1872/ 600125C :                     	; ---------------------------------------
(1) 1873/ 600125C :                     	; X move
(1) 1874/ 600125C :                     	; ---------------------------------------
(1) 1875/ 600125C :                     
(1) 1876/ 600125C : D32E                		mov	#(MSCRL_WIDTH*MSCRL_HEIGHT),r3
(1) 1877/ 600125E : C60C                		mov	@(marsGbl_Bg_FbBase,gbr),r0
(1) 1878/ 6001260 : 301C                		add	r1,r0
(1) 1879/ 6001262 : 4115                		cmp/pl	r1
(1) 1880/ 6001264 : 8B02                		bf	.yx_negtv
(1) 1881/ 6001266 : 3033                		cmp/ge	r3,r0
(1) 1882/ 6001268 : 8B00                		bf	.yx_negtv
(1) 1883/ 600126A : 3038                		sub	r3,r0
(1) 1884/ 600126C :                     .yx_negtv:
(1) 1885/ 600126C : 4111                		cmp/pz	r1
(1) 1886/ 600126E : 8902                		bt	.yx_postv
(1) 1887/ 6001270 : 4011                		cmp/pz	r0
(1) 1888/ 6001272 : 8900                		bt	.yx_postv
(1) 1889/ 6001274 : 303C                		add	r3,r0
(1) 1890/ 6001276 :                     .yx_postv:
(1) 1891/ 6001276 : C20C                		mov	r0,@(marsGbl_Bg_FbBase,gbr)
(1) 1892/ 6001278 :                     
(1) 1893/ 6001278 :                     	; X draw heads for Left/Right drawing
(1) 1894/ 6001278 : C51C                		mov.w	@(marsGbl_BgWidth,gbr),r0
(1) 1895/ 600127A : 6303                		mov	r0,r3
(1) 1896/ 600127C : E500                		mov	#0,r5
(1) 1897/ 600127E : E600                		mov	#0,r6
(1) 1898/ 6001280 : C524                		mov.w	@(marsGbl_Bg_XbgInc_R,gbr),r0
(1) 1899/ 6001282 : 301C                		add	r1,r0
(1) 1900/ 6001284 : 4115                		cmp/pl	r1
(1) 1901/ 6001286 : 8B03                		bf	.negtv
(1) 1902/ 6001288 : E501                		mov	#%0001,r5
(1) 1903/ 600128A : 3033                		cmp/ge	r3,r0
(1) 1904/ 600128C : 8B00                		bf	.negtv
(1) 1905/ 600128E : 3038                		sub	r3,r0
(1) 1906/ 6001290 :                     .negtv:
(1) 1907/ 6001290 : 4111                		cmp/pz	r1
(1) 1908/ 6001292 : 8903                		bt	.postv
(1) 1909/ 6001294 : E502                		mov	#%0010,r5
(1) 1910/ 6001296 : 4011                		cmp/pz	r0
(1) 1911/ 6001298 : 8900                		bt	.postv
(1) 1912/ 600129A : 303C                		add	r3,r0
(1) 1913/ 600129C :                     .postv:
(1) 1914/ 600129C : C124                		mov.w	r0,@(marsGbl_Bg_XbgInc_R,gbr)
(1) 1915/ 600129E :                     
(1) 1916/ 600129E : C523                		mov.w	@(marsGbl_Bg_XbgInc_L,gbr),r0
(1) 1917/ 60012A0 : 301C                		add	r1,r0
(1) 1918/ 60012A2 : 4115                		cmp/pl	r1
(1) 1919/ 60012A4 : 8B02                		bf	.negtvl
(1) 1920/ 60012A6 : 3033                		cmp/ge	r3,r0
(1) 1921/ 60012A8 : 8B00                		bf	.negtvl
(1) 1922/ 60012AA : 3038                		sub	r3,r0
(1) 1923/ 60012AC :                     .negtvl:
(1) 1924/ 60012AC : 4111                		cmp/pz	r1
(1) 1925/ 60012AE : 8902                		bt	.postvl
(1) 1926/ 60012B0 : 4011                		cmp/pz	r0
(1) 1927/ 60012B2 : 8900                		bt	.postvl
(1) 1928/ 60012B4 : 303C                		add	r3,r0
(1) 1929/ 60012B6 :                     .postvl:
(1) 1930/ 60012B6 : C123                		mov.w	r0,@(marsGbl_Bg_XbgInc_L,gbr)
(1) 1931/ 60012B8 :                     
(1) 1932/ 60012B8 :                     
(1) 1933/ 60012B8 :                     	; Set Left/Right requests
(1) 1934/ 60012B8 : C51E                		mov.w	@(marsGbl_Bg_Xset,gbr),r0
(1) 1935/ 60012BA : 301C                		add	r1,r0
(1) 1936/ 60012BC : 6603                		mov	r0,r6
(1) 1937/ 60012BE : C8F0                		tst	#(-MSCRL_BLKSIZE)&$FF,r0
(1) 1938/ 60012C0 : 8918                		bt	.ydl_busy
(1) 1939/ 60012C2 : E3F0                		mov	#-MSCRL_BLKSIZE,r3
(1) 1940/ 60012C4 : 4115                		cmp/pl	r1
(1) 1941/ 60012C6 : 8B09                		bf	.reqr_b
(1) 1942/ 60012C8 : C52A                		mov.w	@(marsGbl_Bg_DrwReqL,gbr),r0
(1) 1943/ 60012CA : 6403                		mov	r0,r4
(1) 1944/ 60012CC : C52B                		mov.w	@(marsGbl_Bg_DrwReqR,gbr),r0
(1) 1945/ 60012CE : 204B                		or	r4,r0
(1) 1946/ 60012D0 : 8800                		cmp/eq	#0,r0
(1) 1947/ 60012D2 : 8B0F                		bf	.ydl_busy
(1) 1948/ 60012D4 :                     ; 		mov.w	@(marsGbl_Bg_YbgInc_D,gbr),r0
(1) 1949/ 60012D4 :                     ; 		mov	#Cach_YHead_D,r4
(1) 1950/ 60012D4 :                     ; 		and	r3,r0
(1) 1951/ 60012D4 :                     ; 		mov	r0,@r4
(1) 1952/ 60012D4 :                     ; 		mov.w	@(marsGbl_Bg_YFbPos_D,gbr),r0
(1) 1953/ 60012D4 :                     ; 		mov	#Cach_BgFbPos_D,r4
(1) 1954/ 60012D4 :                     ; 		and	r3,r0
(1) 1955/ 60012D4 :                     ; 		mov	r0,@r4
(1) 1956/ 60012D4 : E002                		mov	#2,r0
(1) 1957/ 60012D6 : C12B                		mov.w	r0,@(marsGbl_Bg_DrwReqR,gbr)
(1) 1958/ 60012D8 : E000                		mov	#0,r0
(1) 1959/ 60012DA : C12A                		mov.w	r0,@(marsGbl_Bg_DrwReqL,gbr)
(1) 1960/ 60012DC :                     .reqr_b:
(1) 1961/ 60012DC : 4111                		cmp/pz	r1
(1) 1962/ 60012DE : 8909                		bt	.ydl_busy
(1) 1963/ 60012E0 : C52A                		mov.w	@(marsGbl_Bg_DrwReqL,gbr),r0
(1) 1964/ 60012E2 : 6403                		mov	r0,r4
(1) 1965/ 60012E4 : C52B                		mov.w	@(marsGbl_Bg_DrwReqR,gbr),r0
(1) 1966/ 60012E6 : 204B                		or	r4,r0
(1) 1967/ 60012E8 : 8800                		cmp/eq	#0,r0
(1) 1968/ 60012EA : 8B03                		bf	.ydl_busy
(1) 1969/ 60012EC :                     ; 		mov.w	@(marsGbl_Bg_YbgInc_U,gbr),r0
(1) 1970/ 60012EC :                     ; 		mov	#Cach_YHead_U,r4
(1) 1971/ 60012EC :                     ; 		and	r3,r0
(1) 1972/ 60012EC :                     ; 		mov	r0,@r4
(1) 1973/ 60012EC :                     ; 		mov.w	@(marsGbl_Bg_YFbPos_U,gbr),r0
(1) 1974/ 60012EC :                     ; 		mov	#Cach_BgFbPos_U,r4
(1) 1975/ 60012EC :                     ; 		and	r3,r0
(1) 1976/ 60012EC :                     ; 		mov	r0,@r4
(1) 1977/ 60012EC : E002                		mov	#2,r0
(1) 1978/ 60012EE : C12A                		mov.w	r0,@(marsGbl_Bg_DrwReqL,gbr)
(1) 1979/ 60012F0 : E000                		mov	#0,r0
(1) 1980/ 60012F2 : C12B                		mov.w	r0,@(marsGbl_Bg_DrwReqR,gbr)
(1) 1981/ 60012F4 :                     .ydl_busy:
(1) 1982/ 60012F4 : 6063                		mov	r6,r0
(1) 1983/ 60012F6 : C90F                		and	#MSCRL_BLKSIZE-1,r0
(1) 1984/ 60012F8 : C11E                		mov.w	r0,@(marsGbl_Bg_Xset,gbr)
(1) 1985/ 60012FA : 000B                		rts
(1) 1986/ 60012FC : 0009                		nop
(1) 1987/ 60012FE :                     		align 4
(1) 1988/ 6001300 : 2000 4020 2000 402E 		ltorg
                    C000 0508 C000 0524 
                    C000 050C C000 0520 
                    0001 5000           
(1) 1989/ 600131C :                     
(1) 1990/ 600131C :                     ; 	; --------------------
(1) 1991/ 600131C :                     ; 	; DEBUG counter
(1) 1992/ 600131C :                     ; ; 		mov	#_sysreg+comm2,r4		; DEBUG COUNTER
(1) 1993/ 600131C :                     ; ; 		mov.b	@r4,r0
(1) 1994/ 600131C :                     ; ; 		add	#1,r0
(1) 1995/ 600131C :                     ; ; 		mov.b	r0,@r4
(1) 1996/ 600131C :                     ; 	; --------------------
(1) 1997/ 600131C :                     ;
(1) 1998/ 600131C :                     ; 		mov	#_sysreg+comm14,r1
(1) 1999/ 600131C :                     ; 		mov.b	@r1,r0
(1) 2000/ 600131C :                     ; 		mov	r0,r2
(1) 2001/ 600131C :                     ; 		and 	#$80,r0
(1) 2002/ 600131C :                     ; 		cmp/eq	#0,r0			; Genesis requested tasks? (bit 7)
(1) 2003/ 600131C :                     ; 		bf	.md_req			; If yes, process them first.
(1) 2004/ 600131C :                     ; 		mov	r2,r0			; OR Process tasks from Slave SH2
(1) 2005/ 600131C :                     ; 		and	#$7F,r0
(1) 2006/ 600131C :                     ; 		shll2	r0
(1) 2007/ 600131C :                     ; 		mov	#.list,r1
(1) 2008/ 600131C :                     ; 		mov	@(r1,r0),r0
(1) 2009/ 600131C :                     ; 		jmp	@r0
(1) 2010/ 600131C :                     ; 		nop
(1) 2011/ 600131C :                     ; 		align 4
(1) 2012/ 600131C :                     ;
(1) 2013/ 600131C :                     ; ; ------------------------------------------------
(1) 2014/ 600131C :                     ; ; Graphic processing list for Master
(1) 2015/ 600131C :                     ; ; ------------------------------------------------
(1) 2016/ 600131C :                     ;
(1) 2017/ 600131C :                     ; .list:
(1) 2018/ 600131C :                     ; 		dc.l .draw_objects	; Null task
(1) 2019/ 600131C :                     ; 		dc.l .draw_objects
(1) 2020/ 600131C :                     ; 		dc.l master_loop
(1) 2021/ 600131C :                     ;
(1) 2022/ 600131C :                     ; ; ------------------------------------------------
(1) 2023/ 600131C :                     ; ; Process Visual/Audio requests from Genesis
(1) 2024/ 600131C :                     ; ; ------------------------------------------------
(1) 2025/ 600131C :                     ;
(1) 2026/ 600131C :                     ; .md_req:
(1) 2027/ 600131C :                     ; 		stc	sr,@-r15
(1) 2028/ 600131C :                     ; 		mov	#$F0,r0			; Disable interrupts
(1) 2029/ 600131C :                     ; 		ldc	r0,sr
(1) 2030/ 600131C :                     ; 		mov	#MAX_MDTASKS,r13
(1) 2031/ 600131C :                     ; 		mov	#RAM_Mars_MdTasksFifo_M,r14
(1) 2032/ 600131C :                     ; .next_req:
(1) 2033/ 600131C :                     ; 		mov	r13,@-r15
(1) 2034/ 600131C :                     ; 		mov	@r14,r0
(1) 2035/ 600131C :                     ; 		cmp/eq	#0,r0
(1) 2036/ 600131C :                     ; 		bt	.no_task
(1) 2037/ 600131C :                     ; 		jsr	@r0
(1) 2038/ 600131C :                     ; 		nop
(1) 2039/ 600131C :                     ; 		xor	r0,r0
(1) 2040/ 600131C :                     ; 		mov	r0,@r14
(1) 2041/ 600131C :                     ; .no_task:
(1) 2042/ 600131C :                     ; 		mov	#MAX_MDTSKARG*4,r0
(1) 2043/ 600131C :                     ; 		mov	@r15+,r13
(1) 2044/ 600131C :                     ; 		dt	r13
(1) 2045/ 600131C :                     ; 		bf/s	.next_req
(1) 2046/ 600131C :                     ; 		add	r0,r14
(1) 2047/ 600131C :                     ; 		mov	#_sysreg+comm14,r1
(1) 2048/ 600131C :                     ; 		mov.b	@r1,r0
(1) 2049/ 600131C :                     ; 		and	#$7F,r0
(1) 2050/ 600131C :                     ; 		mov.b	r0,@r1
(1) 2051/ 600131C :                     ; 		ldc 	@r15+,sr		; Re-enable interrupts
(1) 2052/ 600131C :                     ; 		bra	master_loop
(1) 2053/ 600131C :                     ; 		nop
(1) 2054/ 600131C :                     ;
(1) 2055/ 600131C :                     ; ; --------------------------------------------------------
(1) 2056/ 600131C :                     ; ; Drawing task $01
(1) 2057/ 600131C :                     ; ;
(1) 2058/ 600131C :                     ; ; Polygons mode
(1) 2059/ 600131C :                     ; ; --------------------------------------------------------
(1) 2060/ 600131C :                     
(1) 2061/ 600131C :                     ; .draw_objects:
(1) 2062/ 600131C :                     
(1) 2063/ 600131C :                     ; ====================================================================
(1) 2064/ 600131C :                     ; ----------------------------------------------------------------
(1) 2065/ 600131C :                     ; Slave entry
(1) 2066/ 600131C :                     ; ----------------------------------------------------------------
(1) 2067/ 600131C :                     
(1) 2068/ 600131C :                     		align 4
(1) 2069/ 600131C :                     SH2_S_Entry:
(1) 2070/ 600131C : DF3F                		mov.l	#CS3|$3F000,r15			; Reset stack
(1) 2071/ 600131E : 91A3                		mov	#_FRT,r1
(1) 2072/ 6001320 : E000                		mov     #0,r0
(1) 2073/ 6001322 : 8010                		mov.b   r0,@(0,r1)
(1) 2074/ 6001324 : E0E2                		mov     #$FFFFFFE2,r0
(1) 2075/ 6001326 : 8017                		mov.b   r0,@(7,r1)
(1) 2076/ 6001328 : E000                		mov     #0,r0
(1) 2077/ 600132A : 8014                		mov.b   r0,@(4,r1)
(1) 2078/ 600132C : E001                		mov     #1,r0
(1) 2079/ 600132E : 8015                		mov.b   r0,@(5,r1)
(1) 2080/ 6001330 : E000                		mov     #0,r0
(1) 2081/ 6001332 : 8016                		mov.b   r0,@(6,r1)
(1) 2082/ 6001334 : E001                		mov     #1,r0
(1) 2083/ 6001336 : 8011                		mov.b   r0,@(1,r1)
(1) 2084/ 6001338 : E000                		mov     #0,r0
(1) 2085/ 600133A : 8013                		mov.b   r0,@(3,r1)
(1) 2086/ 600133C : 8012                		mov.b   r0,@(2,r1)
(1) 2087/ 600133E : 9094                		mov.l   #$FFFFFEE2,r0			; Watchdog: Set interrupt priority bits (IPRA)
(1) 2088/ 6001340 : E150                		mov     #%0101<<4,r1
(1) 2089/ 6001342 : 2011                		mov.w   r1,@r0
(1) 2090/ 6001344 : 9092                		mov.l   #$FFFFFEE4,r0
(1) 2091/ 6001346 : E148                		mov     #$120/4,r1			; Watchdog: Set jump pointer (VBR + this/4) (WITV)
(1) 2092/ 6001348 : 4118                		shll8   r1
(1) 2093/ 600134A : 2011                		mov.w   r1,@r0
(1) 2094/ 600134C :                     		
(1) 2095/ 600134C :                     ; ------------------------------------------------
(1) 2096/ 600134C :                     ; Wait for Genesis, report to Master SH2
(1) 2097/ 600134C :                     ; ------------------------------------------------
(1) 2098/ 600134C :                     
(1) 2099/ 600134C :                     .wait_md:
(1) 2100/ 600134C : D234                		mov 	#_sysreg+comm0,r2
(1) 2101/ 600134E : 6022                		mov.l	@r2,r0
(1) 2102/ 6001350 : 8800                		cmp/eq	#0,r0
(1) 2103/ 6001352 : 8BFB                		bf	.wait_md
(1) 2104/ 6001354 : D033                		mov.l	#"SLAV",r0
(1) 2105/ 6001356 : 1202                		mov.l	r0,@(8,r2)
(1) 2106/ 6001358 :                     
(1) 2107/ 6001358 :                     ; ====================================================================
(1) 2108/ 6001358 :                     ; ----------------------------------------------------------------
(1) 2109/ 6001358 :                     ; Slave main code
(1) 2110/ 6001358 :                     ; ----------------------------------------------------------------
(1) 2111/ 6001358 :                     
(1) 2112/ 6001358 :                     SH2_S_HotStart:
(1) 2113/ 6001358 : DF30                		mov.l	#CS3|$3F000,r15			; Reset stack
(1) 2114/ 600135A : DE33                		mov.l	#RAM_Mars_Global,r14		; Reset gbr
(1) 2115/ 600135C : 4E1E                		ldc	r14,gbr
(1) 2116/ 600135E : 9086                		mov.l	#$F0,r0				; Interrupts OFF
(1) 2117/ 6001360 : 400E                		ldc	r0,sr
(1) 2118/ 6001362 : 9185                		mov.l	#_CCR,r1
(1) 2119/ 6001364 : E008                		mov	#%00001000,r0			; Cache OFF
(1) 2120/ 6001366 : 2101                		mov.w	r0,@r1
(1) 2121/ 6001368 : E019                		mov	#%00011001,r0			; Cache purge / Two-way mode / Cache ON
(1) 2122/ 600136A : 2101                		mov.w	r0,@r1
(1) 2123/ 600136C : D12F                		mov	#_sysreg,r1
(1) 2124/ 600136E : E003                		mov	#CMDIRQ_ON|PWMIRQ_ON,r0		; Enable these interrupts
(1) 2125/ 6001370 : 8011                    		mov.b	r0,@(intmask,r1)		; (Watchdog is external)
(1) 2126/ 6001372 : D12F                		mov 	#CACHE_SLAVE,r1			; Transfer Slave's fast-code to CACHE
(1) 2127/ 6001374 : D22F                		mov 	#$C0000000,r2
(1) 2128/ 6001376 : 937C                		mov 	#(CACHE_SLAVE_E-CACHE_SLAVE)/4,r3
(1) 2129/ 6001378 :                     .copy:
(1) 2130/ 6001378 : 6016                		mov 	@r1+,r0
(1) 2131/ 600137A : 2202                		mov 	r0,@r2
(1) 2132/ 600137C : 7204                		add 	#4,r2
(1) 2133/ 600137E : 4310                		dt	r3
(1) 2134/ 6001380 : 8BFA                		bf	.copy
(1) 2135/ 6001382 : BC16                		bsr	MarsSound_Init			; Init Sound
(1) 2136/ 6001384 : 0009                		nop
(1) 2137/ 6001386 :                     ; 		mov	#MarsMdl_Init,r0		; REMINDER: 1 meter = $10000
(1) 2138/ 6001386 :                     ; 		jsr	@r0
(1) 2139/ 6001386 :                     ; 		nop
(1) 2140/ 6001386 :                     ; 		mov	#0,r1
(1) 2141/ 6001386 :                     ; 		mov	#PWM_STEREO,r2
(1) 2142/ 6001386 :                     ; 		mov	#PWM_STEREO_e,r3
(1) 2143/ 6001386 :                     ; 		mov	#0,r4
(1) 2144/ 6001386 :                     ; 		mov	#$100,r5
(1) 2145/ 6001386 :                     ; 		mov	#0,r6
(1) 2146/ 6001386 :                     ; 		mov	#%11|%10000000,r7
(1) 2147/ 6001386 :                     ; 		mov	#MarsSound_SetPwm,r0
(1) 2148/ 6001386 :                     ; 		jsr	@r0
(1) 2149/ 6001386 :                     ; 		nop
(1) 2150/ 6001386 :                     ; 		mov	#1,r1
(1) 2151/ 6001386 :                     ; 		mov	#PWM_STEREO,r2
(1) 2152/ 6001386 :                     ; 		mov	#PWM_STEREO_e,r3
(1) 2153/ 6001386 :                     ; 		mov	#0,r4
(1) 2154/ 6001386 :                     ; 		mov	#$100,r5
(1) 2155/ 6001386 :                     ; 		mov	#0,r6
(1) 2156/ 6001386 :                     ; 		mov	#%11|%10000000,r7
(1) 2157/ 6001386 :                     ; 		mov	#MarsSound_SetPwm,r0
(1) 2158/ 6001386 :                     ; 		jsr	@r0
(1) 2159/ 6001386 :                     ; 		nop
(1) 2160/ 6001386 : E020                		mov.l	#$20,r0				; Interrupts ON
(1) 2161/ 6001388 : 400E                		ldc	r0,sr
(1) 2162/ 600138A :                     
(1) 2163/ 600138A :                     ; --------------------------------------------------------
(1) 2164/ 600138A :                     ; Loop
(1) 2165/ 600138A :                     ; --------------------------------------------------------
(1) 2166/ 600138A :                     
(1) 2167/ 600138A : 9273                		mov	#"GO",r2
(1) 2168/ 600138C : D12A                		mov	#_sysreg+comm14,r1
(1) 2169/ 600138E : 6011                .lel:		mov.w	@r1,r0
(1) 2170/ 6001390 : 3020                		cmp/eq	r2,r0
(1) 2171/ 6001392 : 8BFC                		bf	.lel
(1) 2172/ 6001394 : 200A                		xor	r0,r0
(1) 2173/ 6001396 : 2101                		mov.w	r0,@r1
(1) 2174/ 6001398 :                     
(1) 2175/ 6001398 :                     	; TEMPORAL polygon
(1) 2176/ 6001398 :                     ; 		mov	#this_polygon,r0
(1) 2177/ 6001398 :                     ; 		mov 	#RAM_Mars_Plgn_ZList_0,r14
(1) 2178/ 6001398 :                     ; 		mov	#RAM_Mars_PlgnNum_0,r13
(1) 2179/ 6001398 :                     ; 		mov	r0,@r14
(1) 2180/ 6001398 :                     ; 		mov	r0,@(8,r14)
(1) 2181/ 6001398 :                     ; 		mov	r0,@($10,r14)
(1) 2182/ 6001398 :                     ; 		mov	r0,@($18,r14)
(1) 2183/ 6001398 :                     ; 		mov	#1,r0			; enable test polygon
(1) 2184/ 6001398 :                     ; 		mov.w	r0,@r13
(1) 2185/ 6001398 :                     ; 		mov	#this_polygon,r0
(1) 2186/ 6001398 :                     ; 		mov 	#RAM_Mars_Plgn_ZList_1,r14
(1) 2187/ 6001398 :                     ; 		mov	#RAM_Mars_PlgnNum_1,r13
(1) 2188/ 6001398 :                     ; 		mov	r0,@r14
(1) 2189/ 6001398 :                     ; 		mov	r0,@(8,r14)
(1) 2190/ 6001398 :                     ; 		mov	r0,@($10,r14)
(1) 2191/ 6001398 :                     ; 		mov	r0,@($18,r14)
(1) 2192/ 6001398 :                     ; 		mov	#1,r0			; enable test polygon
(1) 2193/ 6001398 :                     ; 		mov.w	r0,@r13
(1) 2194/ 6001398 :                     
(1) 2195/ 6001398 :                     ; 		mov	#_sysreg+comm0,r1
(1) 2196/ 6001398 :                     ; 		mov	#1,r0
(1) 2197/ 6001398 :                     ; 		mov.w	r0,@r1
(1) 2198/ 6001398 :                     ; 		mov.w	r0,@(2,r1)
(1) 2199/ 6001398 :                     
(1) 2200/ 6001398 :                     ; 		mov	#1,r0
(1) 2201/ 6001398 :                     ; 		mov.w	r0,@(marsGbl_CurrGfxMode,gbr)
(1) 2202/ 6001398 :                     
(1) 2203/ 6001398 : EEFF                		mov	#-1,r14
(1) 2204/ 600139A :                     slave_loop:
(1) 2205/ 600139A : C52F                		mov.w	@(marsGbl_MstrReqDraw,gbr),r0
(1) 2206/ 600139C : 8801                		cmp/eq	#1,r0
(1) 2207/ 600139E : 893B                		bt	.wait_drw
(1) 2208/ 60013A0 :                     
(1) 2209/ 60013A0 :                     	; Polygon interaction
(1) 2210/ 60013A0 : D526                	mov	#30*65536,r5
(1) 2211/ 60013A2 : D627                	mov	#-30*65536,r6
(1) 2212/ 60013A4 : D727                	mov	#rot_angle,r7
(1) 2213/ 60013A6 : B07D                	bsr	Rotate_Point
(1) 2214/ 60013A8 : 6772                	mov	@r7,r7
(1) 2215/ 60013AA : D227                	mov	#dest_data,r2
(1) 2216/ 60013AC : 4029                	shlr16	r0
(1) 2217/ 60013AE : 600F                	exts.w	r0,r0
(1) 2218/ 60013B0 : 2201                	mov.w	r0,@r2
(1) 2219/ 60013B2 : 4129                	shlr16	r1
(1) 2220/ 60013B4 : 611F                	exts.w	r1,r1
(1) 2221/ 60013B6 : 6013                	mov	r1,r0
(1) 2222/ 60013B8 : 8121                	mov.w	r0,@(2,r2)
(1) 2223/ 60013BA :                     
(1) 2224/ 60013BA : D521                	mov	#-30*65536,r5
(1) 2225/ 60013BC : D620                	mov	#-30*65536,r6
(1) 2226/ 60013BE : D723                	mov	#rot_angle,r7
(1) 2227/ 60013C0 : B070                	bsr	Rotate_Point
(1) 2228/ 60013C2 : 6772                	mov	@r7,r7
(1) 2229/ 60013C4 : D222                	mov	#dest_data+4,r2
(1) 2230/ 60013C6 : 4029                	shlr16	r0
(1) 2231/ 60013C8 : 600F                	exts.w	r0,r0
(1) 2232/ 60013CA : 2201                	mov.w	r0,@r2
(1) 2233/ 60013CC : 4129                	shlr16	r1
(1) 2234/ 60013CE : 611F                	exts.w	r1,r1
(1) 2235/ 60013D0 : 6013                	mov	r1,r0
(1) 2236/ 60013D2 : 8121                	mov.w	r0,@(2,r2)
(1) 2237/ 60013D4 :                     
(1) 2238/ 60013D4 : D51A                	mov	#-30*65536,r5
(1) 2239/ 60013D6 : D619                	mov	#30*65536,r6
(1) 2240/ 60013D8 : D71E                	mov	#rot_angle,r7
(1) 2241/ 60013DA : B063                	bsr	Rotate_Point
(1) 2242/ 60013DC : 6772                	mov	@r7,r7
(1) 2243/ 60013DE : D21E                	mov	#dest_data+8,r2
(1) 2244/ 60013E0 : 4029                	shlr16	r0
(1) 2245/ 60013E2 : 600F                	exts.w	r0,r0
(1) 2246/ 60013E4 : 2201                	mov.w	r0,@r2
(1) 2247/ 60013E6 : 4129                	shlr16	r1
(1) 2248/ 60013E8 : 611F                	exts.w	r1,r1
(1) 2249/ 60013EA : 6013                	mov	r1,r0
(1) 2250/ 60013EC : 8121                	mov.w	r0,@(2,r2)
(1) 2251/ 60013EE :                     
(1) 2252/ 60013EE : D513                	mov	#30*65536,r5
(1) 2253/ 60013F0 : D612                	mov	#30*65536,r6
(1) 2254/ 60013F2 : D71A                	mov	#rot_angle,r7
(1) 2255/ 60013F4 : B056                	bsr	Rotate_Point
(1) 2256/ 60013F6 : 6772                	mov	@r7,r7
(1) 2257/ 60013F8 : D219                	mov	#dest_data+$C,r2
(1) 2258/ 60013FA : 4029                	shlr16	r0
(1) 2259/ 60013FC : 600F                	exts.w	r0,r0
(1) 2260/ 60013FE : 2201                	mov.w	r0,@r2
(1) 2261/ 6001400 : 4129                	shlr16	r1
(1) 2262/ 6001402 : 611F                	exts.w	r1,r1
(1) 2263/ 6001404 : 6013                	mov	r1,r0
(1) 2264/ 6001406 : 8121                	mov.w	r0,@(2,r2)
(1) 2265/ 6001408 :                     
(1) 2266/ 6001408 : D016                	mov	#rot_angle,r0
(1) 2267/ 600140A : 6102                	mov	@r0,r1
(1) 2268/ 600140C : 7104                	add	#4,r1
(1) 2269/ 600140E : 9232                	mov	#2047,r2
(1) 2270/ 6001410 : 2129                	and	r2,r1
(1) 2271/ 6001412 : 2012                	mov	r1,@r0
(1) 2272/ 6001414 :                     
(1) 2273/ 6001414 : E001                		mov.w	#1,r0
(1) 2274/ 6001416 : C12F                		mov.w	r0,@(marsGbl_MstrReqDraw,gbr)
(1) 2275/ 6001418 :                     .wait_drw:
(1) 2276/ 6001418 : AFBF                		bra	slave_loop
(1) 2277/ 600141A : 0009                		nop
(1) 2278/ 600141C :                     		align 4
(1) 2279/ 600141C : 0603 F000 2000 4020 		ltorg
                    534C 4156 0600 4390 
                    2000 4000 0600 1B60 
                    C000 0000 2000 402E 
                    001E 0000 FFE2 0000 
                    0600 14A0 0600 1480 
                    0600 14A0 0600 1484 
                    0600 14A0 0600 1488 
                    0600 14A0 0600 148C 
                    0600 14A0 FE10 FEE2 
                    FEE4 00F0 FE92 000B 
                    474F 07FF           
(1) 2280/ 6001478 :                     
(1) 2281/ 6001478 :                     		align 4
(1) 2282/ 6001478 :                     this_polygon:
(1) 2283/ 6001478 : 8000                		dc.w $8000
(1) 2284/ 600147A : 0130                		dc.w 304
(1) 2285/ 600147C : 0205 12B0           		dc.l TESTMARS_BG
(1) 2286/ 6001480 : 0020 FFE0           dest_data:	dc.w  32,-32
(1) 2287/ 6001484 : FFE0 FFE0           		dc.w -32,-32
(1) 2288/ 6001488 : FFE0 0020           		dc.w -32, 32
(1) 2289/ 600148C : 0020 0020           		dc.w  32, 32
(1) 2290/ 6001490 : 0112 004F           		dc.w 274, 79
(1) 2291/ 6001494 : 00C7 004F           		dc.w 199, 79
(1) 2292/ 6001498 : 00C7 008D           		dc.w 199,142-1
(1) 2293/ 600149C : 0112 008D           		dc.w 274,142-1
(1) 2294/ 60014A0 : 0000 0000           rot_angle	dc.l 0
(1) 2295/ 60014A4 :                     
(1) 2296/ 60014A4 :                     Rotate_Point
(1) 2297/ 60014A4 :                     
(1) 2298/ 60014A4 : 4708                	shll2	r7
(1) 2299/ 60014A6 : 6073                	mov	r7,r0
(1) 2300/ 60014A8 : D10C                	mov	#sin_table,r1
(1) 2301/ 60014AA : D20D                	mov	#sin_table+$800,r2
(1) 2302/ 60014AC : 031E                	mov	@(r0,r1),r3
(1) 2303/ 60014AE : 042E                	mov	@(r0,r2),r4
(1) 2304/ 60014B0 :                     
(1) 2305/ 60014B0 : 345D                	dmuls.l	r5,r4		; x cos @
(1) 2306/ 60014B2 : 001A                	sts	macl,r0
(1) 2307/ 60014B4 : 010A                	sts	mach,r1
(1) 2308/ 60014B6 : 201D                	xtrct	r1,r0
(1) 2309/ 60014B8 : 336D                	dmuls.l	r6,r3		; y sin @
(1) 2310/ 60014BA : 011A                	sts	macl,r1
(1) 2311/ 60014BC : 020A                	sts	mach,r2
(1) 2312/ 60014BE : 212D                	xtrct	r2,r1
(1) 2313/ 60014C0 : 301C                	add	r1,r0
(1) 2314/ 60014C2 :                     
(1) 2315/ 60014C2 : 633B                	neg	r3,r3
(1) 2316/ 60014C4 : 335D                	dmuls.l	r5,r3		; x -sin @
(1) 2317/ 60014C6 : 011A                	sts	macl,r1
(1) 2318/ 60014C8 : 020A                	sts	mach,r2
(1) 2319/ 60014CA : 212D                	xtrct	r2,r1
(1) 2320/ 60014CC : 346D                	dmuls.l	r6,r4		; y cos @
(1) 2321/ 60014CE : 021A                	sts	macl,r2
(1) 2322/ 60014D0 : 030A                	sts	mach,r3
(1) 2323/ 60014D2 : 223D                	xtrct	r3,r2
(1) 2324/ 60014D4 : 312C                	add	r2,r1
(1) 2325/ 60014D6 :                     
(1) 2326/ 60014D6 : 000B                	rts
(1) 2327/ 60014D8 : 0009                	nop
(1) 2328/ 60014DA :                     	align 4
(1) 2329/ 60014DC : 0600 1B8C 0600 238C 	ltorg
(1) 2330/ 60014E4 :                     
(1) 2331/ 60014E4 :                     ; ; ------------------------------------------------
(1) 2332/ 60014E4 :                     ; ; Process task requests from Genesis
(1) 2333/ 60014E4 :                     ; ; ------------------------------------------------
(1) 2334/ 60014E4 :                     ;
(1) 2335/ 60014E4 :                     ; 		mov	#_sysreg+comm15,r1
(1) 2336/ 60014E4 :                     ; 		mov.b	@r1,r0
(1) 2337/ 60014E4 :                     ; 		and	#$80,r0
(1) 2338/ 60014E4 :                     ; 		cmp/eq	#0,r0
(1) 2339/ 60014E4 :                     ; 		bt	.no_req
(1) 2340/ 60014E4 :                     ; 		mov	#MAX_MDTASKS,r13
(1) 2341/ 60014E4 :                     ; 		mov	#RAM_Mars_MdTasksFifo_S,r14
(1) 2342/ 60014E4 :                     ; .next_req:
(1) 2343/ 60014E4 :                     ; 		mov	r13,@-r15
(1) 2344/ 60014E4 :                     ; 		mov	@r14,r0
(1) 2345/ 60014E4 :                     ; 		cmp/eq	#0,r0
(1) 2346/ 60014E4 :                     ; 		bt	.no_task
(1) 2347/ 60014E4 :                     ; 		jsr	@r0
(1) 2348/ 60014E4 :                     ; 		nop
(1) 2349/ 60014E4 :                     ; 		xor	r0,r0
(1) 2350/ 60014E4 :                     ; 		mov	r0,@r14
(1) 2351/ 60014E4 :                     ; .no_task:
(1) 2352/ 60014E4 :                     ; 		mov	#MAX_MDTSKARG*4,r0
(1) 2353/ 60014E4 :                     ; 		mov	@r15+,r13
(1) 2354/ 60014E4 :                     ; 		dt	r13
(1) 2355/ 60014E4 :                     ; 		bf/s	.next_req
(1) 2356/ 60014E4 :                     ; 		add	r0,r14
(1) 2357/ 60014E4 :                     ; 		mov	#_sysreg+comm15,r1
(1) 2358/ 60014E4 :                     ; 		mov.b	@r1,r0
(1) 2359/ 60014E4 :                     ; 		and	#$7F,r0
(1) 2360/ 60014E4 :                     ; 		mov.b	r0,@r1
(1) 2361/ 60014E4 :                     ; .no_req:
(1) 2362/ 60014E4 :                     ; 		mov	#_sysreg+comm15,r1
(1) 2363/ 60014E4 :                     ; 		mov.b	@r1,r0
(1) 2364/ 60014E4 :                     ; 		and	#$7F,r0
(1) 2365/ 60014E4 :                     ; 		cmp/eq	#1,r0
(1) 2366/ 60014E4 :                     ; 		bf	slave_loop
(1) 2367/ 60014E4 :                     
(1) 2368/ 60014E4 :                     ; --------------------------------------------------------
(1) 2369/ 60014E4 :                     ; Start building polygons from models
(1) 2370/ 60014E4 :                     ;
(1) 2371/ 60014E4 :                     ; *** CAMERA ANIMATION IS DONE ON THE 68K ***
(1) 2372/ 60014E4 :                     ; --------------------------------------------------------
(1) 2373/ 60014E4 :                     
(1) 2374/ 60014E4 :                     ; 		mov	#0,r0
(1) 2375/ 60014E4 :                     ; 		mov.w	r0,@(marsGbl_MdlFacesCntr,gbr)
(1) 2376/ 60014E4 :                     ; 		mov 	#RAM_Mars_Polygons_0,r1
(1) 2377/ 60014E4 :                     ; 		mov	#RAM_Mars_Plgn_ZList_0,r2
(1) 2378/ 60014E4 :                     ; 		mov.w   @(marsGbl_PlgnBuffNum,gbr),r0
(1) 2379/ 60014E4 :                     ; 		tst     #1,r0
(1) 2380/ 60014E4 :                     ; 		bt	.go_mdl
(1) 2381/ 60014E4 :                     ; 		mov 	#RAM_Mars_Polygons_1,r1
(1) 2382/ 60014E4 :                     ; 		mov	#RAM_Mars_Plgn_ZList_1,r2
(1) 2383/ 60014E4 :                     ; .go_mdl:
(1) 2384/ 60014E4 :                     ; 		mov	r1,r0
(1) 2385/ 60014E4 :                     ; 		mov	r0,@(marsGbl_CurrFacePos,gbr)
(1) 2386/ 60014E4 :                     ; 		mov	r2,r0
(1) 2387/ 60014E4 :                     ; 		mov	r0,@(marsGbl_CurrZList,gbr)
(1) 2388/ 60014E4 :                     ; 		mov	#$FFFFFE80,r1
(1) 2389/ 60014E4 :                     ; 		mov.w	#$5A7F,r0			; Watchdog wait timer
(1) 2390/ 60014E4 :                     ; 		mov.w	r0,@r1
(1) 2391/ 60014E4 :                     ; 		mov.w	#$A538,r0			; Watchdog ON
(1) 2392/ 60014E4 :                     ; 		mov.w	r0,@r1
(1) 2393/ 60014E4 :                     ;
(1) 2394/ 60014E4 :                     ; ; ----------------------------------------
(1) 2395/ 60014E4 :                     ;
(1) 2396/ 60014E4 :                     ; 		mov	#_CCR,r1			; <-- Required for Watchdog
(1) 2397/ 60014E4 :                     ; 		mov	#%00001000,r0			; Two-way mode
(1) 2398/ 60014E4 :                     ; 		mov.w	r0,@r1
(1) 2399/ 60014E4 :                     ; 		mov	#%00011001,r0			; Cache purge / Two-way mode / Cache ON
(1) 2400/ 60014E4 :                     ; 		mov.w	r0,@r1
(1) 2401/ 60014E4 :                     ; 		mov	#MarsLay_Read,r0		; Build layout inside camera
(1) 2402/ 60014E4 :                     ; 		jsr	@r0				; takes 9 object slots
(1) 2403/ 60014E4 :                     ; 		nop
(1) 2404/ 60014E4 :                     ; 		mov	#RAM_Mars_Objects,r14		; Build all objects
(1) 2405/ 60014E4 :                     ; 		mov	#MAX_MODELS,r13
(1) 2406/ 60014E4 :                     ; .loop:
(1) 2407/ 60014E4 :                     ; 		mov	@(mdl_data,r14),r0		; Object model data == 0 or -1?
(1) 2408/ 60014E4 :                     ; 		cmp/pl	r0
(1) 2409/ 60014E4 :                     ; 		bf	.invlid
(1) 2410/ 60014E4 :                     ; 		mov	#MarsMdl_ReadModel,r0
(1) 2411/ 60014E4 :                     ; 		jsr	@r0
(1) 2412/ 60014E4 :                     ; 		mov	r13,@-r15
(1) 2413/ 60014E4 :                     ; 		mov	@r15+,r13
(1) 2414/ 60014E4 :                     ; 		mov	#0,r0
(1) 2415/ 60014E4 :                     ; 		mov.w	@(marsGbl_MdlFacesCntr,gbr),r0	; Ran out of space to store faces?
(1) 2416/ 60014E4 :                     ; 		mov	#MAX_MPLGN,r1
(1) 2417/ 60014E4 :                     ; 		cmp/ge	r1,r0
(1) 2418/ 60014E4 :                     ; 		bt	.skip
(1) 2419/ 60014E4 :                     ; .invlid:
(1) 2420/ 60014E4 :                     ; 		dt	r13
(1) 2421/ 60014E4 :                     ; 		bf/s	.loop
(1) 2422/ 60014E4 :                     ; 		add	#sizeof_mdlobj,r14
(1) 2423/ 60014E4 :                     ; .skip:
(1) 2424/ 60014E4 :                     ; 		mov	#1,r0
(1) 2425/ 60014E4 :                     ; 		mov.w	r0,@(marsGbl_ZSortReq,gbr)
(1) 2426/ 60014E4 :                     ;
(1) 2427/ 60014E4 :                     ; ; ----------------------------------------
(1) 2428/ 60014E4 :                     ;
(1) 2429/ 60014E4 :                     ; .wait_z:
(1) 2430/ 60014E4 :                     ; 		mov.w	@(marsGbl_ZSortReq,gbr),r0
(1) 2431/ 60014E4 :                     ; 		cmp/eq	#1,r0
(1) 2432/ 60014E4 :                     ; 		bt	.wait_z
(1) 2433/ 60014E4 :                     ; 		mov.l   #$FFFFFE80,r1			; Stop watchdog
(1) 2434/ 60014E4 :                     ; 		mov.w   #$A518,r0
(1) 2435/ 60014E4 :                     ; 		mov.w   r0,@r1
(1) 2436/ 60014E4 :                     ;
(1) 2437/ 60014E4 :                     ; ; ----------------------------------------
(1) 2438/ 60014E4 :                     ;
(1) 2439/ 60014E4 :                     ; ; 		mov 	#RAM_Mars_Plgn_ZList_0,r14
(1) 2440/ 60014E4 :                     ; 		mov 	#RAM_Mars_PlgnNum_0,r13
(1) 2441/ 60014E4 :                     ; 		mov.w   @(marsGbl_PlgnBuffNum,gbr),r0
(1) 2442/ 60014E4 :                     ; 		tst     #1,r0
(1) 2443/ 60014E4 :                     ; 		bt	.page_2
(1) 2444/ 60014E4 :                     ; ; 		mov 	#RAM_Mars_Plgn_ZList_1,r14
(1) 2445/ 60014E4 :                     ; 		mov 	#RAM_Mars_PlgnNum_1,r13
(1) 2446/ 60014E4 :                     ; .page_2:
(1) 2447/ 60014E4 :                     ; 		mov.w	@(marsGbl_MdlFacesCntr,gbr),r0
(1) 2448/ 60014E4 :                     ; 		mov.w	r0,@r13
(1) 2449/ 60014E4 :                     ;
(1) 2450/ 60014E4 :                     ; 		mov	#_sysreg+comm2,r4		; DEBUG COUNTER
(1) 2451/ 60014E4 :                     ; ; 		mov	#0,r0
(1) 2452/ 60014E4 :                     ; 		mov.w	r0,@r4
(1) 2453/ 60014E4 :                     ; 		mov	#_sysreg+comm14,r2
(1) 2454/ 60014E4 :                     ; .mstr_busy:
(1) 2455/ 60014E4 :                     ; 		mov.b	@r2,r0
(1) 2456/ 60014E4 :                     ; 		and	#$7F,r0
(1) 2457/ 60014E4 :                     ; 		cmp/eq	#0,r0
(1) 2458/ 60014E4 :                     ; 		bf	.mstr_busy			; Skip frame
(1) 2459/ 60014E4 :                     ; 		mov.w	@(marsGbl_PlgnBuffNum,gbr),r0	; Swap polygon buffer
(1) 2460/ 60014E4 :                     ;  		xor	#1,r0
(1) 2461/ 60014E4 :                     ;  		mov.w	r0,@(marsGbl_PlgnBuffNum,gbr)
(1) 2462/ 60014E4 :                     ;  		mov	#1,r1				; Set task $01 to Master
(1) 2463/ 60014E4 :                     ; 		mov.b	@r2,r0
(1) 2464/ 60014E4 :                     ; 		and	#$80,r0
(1) 2465/ 60014E4 :                     ; 		or	r1,r0
(1) 2466/ 60014E4 :                     ; 		mov.b	r0,@r2
(1) 2467/ 60014E4 :                     ;
(1) 2468/ 60014E4 :                     ; 		mov	#_sysreg+comm15,r1
(1) 2469/ 60014E4 :                     ; 		mov.b	@r1,r0
(1) 2470/ 60014E4 :                     ; 		and	#$80,r0
(1) 2471/ 60014E4 :                     ; 		mov.b	r0,@r1
(1) 2472/ 60014E4 :                     
(1) 2473/ 60014E4 :                     ; ====================================================================
(1) 2474/ 60014E4 :                     ; --------------------------------------------------------
(1) 2475/ 60014E4 :                     ; Task list for MD-to-MARS tasks, call these 68k side
(1) 2476/ 60014E4 :                     ; with the respective arguments
(1) 2477/ 60014E4 :                     ; 
(1) 2478/ 60014E4 :                     ; *** 68k EXAMPLES ***
(1) 2479/ 60014E4 :                     ; 
(1) 2480/ 60014E4 :                     ; Single task:
(1) 2481/ 60014E4 :                     ; 	move.l	#CmdTaskMd_SetBitmap,d0		; 32X display ON
(1) 2482/ 60014E4 :                     ; 	moveq	#1,d1
(1) 2483/ 60014E4 :                     ; 	bsr	System_MdMars_MstAddTask
(1) 2484/ 60014E4 :                     ; 	
(1) 2485/ 60014E4 :                     ; Queued task:
(1) 2486/ 60014E4 :                     ; 	move.l	#Palette_Intro,d1
(1) 2487/ 60014E4 :                     ; 	moveq	#0,d2
(1) 2488/ 60014E4 :                     ; 	move.w	#16,d3
(1) 2489/ 60014E4 :                     ; 	moveq	#0,d4
(1) 2490/ 60014E4 :                     ; 	move.l	#CmdTaskMd_LoadSPal,d0		; Load palette
(1) 2491/ 60014E4 :                     ; 	bsr	System_MdMars_MstAddTask
(1) 2492/ 60014E4 :                     ;	; then add more requests
(1) 2493/ 60014E4 :                     ; 	bsr	System_MdMars_MstSendAll	; <-- Send all and wait
(1) 2494/ 60014E4 :                     ; 	; or
(1) 2495/ 60014E4 :                     ; 	bsr	System_MdMars_MstSendDrop	; <-- Send all but skip if busy
(1) 2496/ 60014E4 :                     ;
(1) 2497/ 60014E4 :                     ; Mst: for Master, processes until all draw-tasks finished
(1) 2498/ 60014E4 :                     ; Slv: for Slave, processes after sorting model faces
(1) 2499/ 60014E4 :                     ; --------------------------------------------------------
(1) 2500/ 60014E4 :                     
(1) 2501/ 60014E4 :                     		align 4
(1) 2502/ 60014E4 :                     
(1) 2503/ 60014E4 :                     ; ------------------------------------------------
(1) 2504/ 60014E4 :                     ; CALLS EXCLUSIVE TO MASTER CPU
(1) 2505/ 60014E4 :                     ; ------------------------------------------------
(1) 2506/ 60014E4 :                     
(1) 2507/ 60014E4 :                     ; ------------------------------------------------
(1) 2508/ 60014E4 :                     ; Set SuperVDP bitmap value
(1) 2509/ 60014E4 :                     ;
(1) 2510/ 60014E4 :                     ; @($04,r14) - SuperVDP bitmap number (0-3)
(1) 2511/ 60014E4 :                     ; ------------------------------------------------
(1) 2512/ 60014E4 :                     
(1) 2513/ 60014E4 :                     CmdTaskMd_SetBitmap:
(1) 2514/ 60014E4 : D108                		mov 	#_vdpreg,r1
(1) 2515/ 60014E6 : 8515                .wait_fb:	mov.w   @($A,r1),r0
(1) 2516/ 60014E8 : C802                		tst     #2,r0
(1) 2517/ 60014EA : 8BFC                		bf      .wait_fb
(1) 2518/ 60014EC : 50E1                		mov	@($04,r14),r0
(1) 2519/ 60014EE : 8011                		mov.b	r0,@(bitmapmd,r1)
(1) 2520/ 60014F0 : 000B                		rts
(1) 2521/ 60014F2 : 0009                		nop
(1) 2522/ 60014F4 :                     		align 4
(1) 2523/ 60014F4 :                     
(1) 2524/ 60014F4 :                     ; ------------------------------------------------
(1) 2525/ 60014F4 :                     ; Load palette to SuperVDP from MD
(1) 2526/ 60014F4 :                     ;
(1) 2527/ 60014F4 :                     ; @($04,r14) - Palette data
(1) 2528/ 60014F4 :                     ; @($08,r14) - Start from
(1) 2529/ 60014F4 :                     ; @($0C,r14) - Number of colors
(1) 2530/ 60014F4 :                     ; @($10,r14) - OR value
(1) 2531/ 60014F4 :                     ; ------------------------------------------------
(1) 2532/ 60014F4 :                     
(1) 2533/ 60014F4 :                     CmdTaskMd_LoadSPal:
(1) 2534/ 60014F4 : 6DE3                		mov	r14,r13
(1) 2535/ 60014F6 : 7D04                		add	#4,r13
(1) 2536/ 60014F8 : 61D6                		mov	@r13+,r1
(1) 2537/ 60014FA : 62D6                		mov	@r13+,r2
(1) 2538/ 60014FC : 63D6                		mov	@r13+,r3
(1) 2539/ 60014FE : 64D6                		mov	@r13+,r4
(1) 2540/ 6001500 : D002                		mov	#MarsVideo_LoadPal,r0
(1) 2541/ 6001502 : 402B                		jmp	@r0
(1) 2542/ 6001504 : 0009                		nop
(1) 2543/ 6001506 :                     		align 4
(1) 2544/ 6001508 :                     
(1) 2545/ 6001508 :                     ; ------------------------------------------------
(1) 2546/ 6001508 :                     ; CALLS EXCLUSIVE TO SLAVE CPU
(1) 2547/ 6001508 :                     ; ------------------------------------------------
(1) 2548/ 6001508 :                     
(1) 2549/ 6001508 :                     ; ; ------------------------------------------------
(1) 2550/ 6001508 :                     ; ; Make new object and insert it to specific slot
(1) 2551/ 6001508 :                     ; ;
(1) 2552/ 6001508 :                     ; ; @($04,r14) - Object slot
(1) 2553/ 6001508 :                     ; ; @($08,r14) - Object data
(1) 2554/ 6001508 :                     ; ; @($0C,r14) - Object animation data
(1) 2555/ 6001508 :                     ; ; @($10,r14) - Object animation speed
(1) 2556/ 6001508 :                     ; ; @($14,r14) - Object options:
(1) 2557/ 6001508 :                     ; ;	       %????????????????????????pppppppp
(1) 2558/ 6001508 :                     ; ;		p - index pixel increment value
(1) 2559/ 6001508 :                     ; ; ------------------------------------------------
(1) 2560/ 6001508 :                     ;
(1) 2561/ 6001508 :                     ; CmdTaskMd_ObjectSet:
(1) 2562/ 6001508 :                     ; 		mov	#RAM_Mars_Objects+(sizeof_mdlobj*9),r12
(1) 2563/ 6001508 :                     ; 		mov	r14,r13
(1) 2564/ 6001508 :                     ; 		add	#4,r13
(1) 2565/ 6001508 :                     ; 		mov	@r13+,r0
(1) 2566/ 6001508 :                     ; 		mov	#sizeof_mdlobj,r1
(1) 2567/ 6001508 :                     ; 		mulu	r1,r0
(1) 2568/ 6001508 :                     ; 		sts	macl,r0
(1) 2569/ 6001508 :                     ; 		add	r0,r12
(1) 2570/ 6001508 :                     ; 		xor	r0,r0
(1) 2571/ 6001508 :                     ; 		mov	@r13+,r1
(1) 2572/ 6001508 :                     ; 		mov	r1,@(mdl_data,r12)
(1) 2573/ 6001508 :                     ; 		mov	@r13+,r1
(1) 2574/ 6001508 :                     ; 		mov	r1,@(mdl_animdata,r12)
(1) 2575/ 6001508 :                     ; 		mov	@r13+,r1
(1) 2576/ 6001508 :                     ; 		mov	r1,@(mdl_animspd,r12)
(1) 2577/ 6001508 :                     ; 		mov	@r13+,r1
(1) 2578/ 6001508 :                     ; 		mov	r1,@(mdl_option,r12)
(1) 2579/ 6001508 :                     ; 		xor	r0,r0
(1) 2580/ 6001508 :                     ; 		mov	r0,@(mdl_x_pos,r12)
(1) 2581/ 6001508 :                     ; 		mov	r0,@(mdl_y_pos,r12)
(1) 2582/ 6001508 :                     ; 		mov	r0,@(mdl_z_pos,r12)
(1) 2583/ 6001508 :                     ; 		mov	r0,@(mdl_x_rot,r12)
(1) 2584/ 6001508 :                     ; 		mov	r0,@(mdl_y_rot,r12)
(1) 2585/ 6001508 :                     ; 		mov	r0,@(mdl_z_rot,r12)
(1) 2586/ 6001508 :                     ; 		mov	r0,@(mdl_animframe,r12)
(1) 2587/ 6001508 :                     ; 		mov	r0,@(mdl_animtimer,r12)
(1) 2588/ 6001508 :                     ; 		rts
(1) 2589/ 6001508 :                     ; 		nop
(1) 2590/ 6001508 :                     ; 		align 4
(1) 2591/ 6001508 :                     ;
(1) 2592/ 6001508 :                     ; ; ------------------------------------------------
(1) 2593/ 6001508 :                     ; ; Move/Rotate object from slot
(1) 2594/ 6001508 :                     ; ;
(1) 2595/ 6001508 :                     ; ; @($04,r14) - Object slot
(1) 2596/ 6001508 :                     ; ; @($08,r14) - Object X pos
(1) 2597/ 6001508 :                     ; ; @($0C,r14) - Object Y pos
(1) 2598/ 6001508 :                     ; ; @($10,r14) - Object Z pos
(1) 2599/ 6001508 :                     ; ; @($14,r14) - Object X rot
(1) 2600/ 6001508 :                     ; ; @($18,r14) - Object Y rot
(1) 2601/ 6001508 :                     ; ; @($1C,r14) - Object Z rot
(1) 2602/ 6001508 :                     ; ; ------------------------------------------------
(1) 2603/ 6001508 :                     ;
(1) 2604/ 6001508 :                     ; CmdTaskMd_ObjectPos:
(1) 2605/ 6001508 :                     ; 		mov	#RAM_Mars_Objects+(sizeof_mdlobj*9),r12
(1) 2606/ 6001508 :                     ; 		mov	r14,r13
(1) 2607/ 6001508 :                     ; 		add	#4,r13
(1) 2608/ 6001508 :                     ; 		mov	@r13+,r0
(1) 2609/ 6001508 :                     ; 		mov	#sizeof_mdlobj,r1
(1) 2610/ 6001508 :                     ; 		mulu	r1,r0
(1) 2611/ 6001508 :                     ; 		sts	macl,r0
(1) 2612/ 6001508 :                     ; 		add	r0,r12
(1) 2613/ 6001508 :                     ; 		mov	@r13+,r1
(1) 2614/ 6001508 :                     ; 		mov	@r13+,r2
(1) 2615/ 6001508 :                     ; 		mov	@r13+,r3
(1) 2616/ 6001508 :                     ; 		mov	@r13+,r4
(1) 2617/ 6001508 :                     ; 		mov	@r13+,r5
(1) 2618/ 6001508 :                     ; 		mov	@r13+,r6
(1) 2619/ 6001508 :                     ; 		mov	r1,@(mdl_x_pos,r12)
(1) 2620/ 6001508 :                     ; 		mov	r2,@(mdl_y_pos,r12)
(1) 2621/ 6001508 :                     ; 		mov	r3,@(mdl_z_pos,r12)
(1) 2622/ 6001508 :                     ; 		mov	r4,@(mdl_x_rot,r12)
(1) 2623/ 6001508 :                     ; 		mov	r5,@(mdl_y_rot,r12)
(1) 2624/ 6001508 :                     ; 		mov	r6,@(mdl_z_rot,r12)
(1) 2625/ 6001508 :                     ; 		rts
(1) 2626/ 6001508 :                     ; 		nop
(1) 2627/ 6001508 :                     ; 		align 4
(1) 2628/ 6001508 :                     ;
(1) 2629/ 6001508 :                     ; ; ------------------------------------------------
(1) 2630/ 6001508 :                     ; ; Clear ALL objects, including layout
(1) 2631/ 6001508 :                     ; ; ------------------------------------------------
(1) 2632/ 6001508 :                     ;
(1) 2633/ 6001508 :                     ; CmdTaskMd_ObjectClrAll:
(1) 2634/ 6001508 :                     ; 		sts	pr,@-r15
(1) 2635/ 6001508 :                     ; 		mov	#MarsMdl_Init,r0
(1) 2636/ 6001508 :                     ; 		jsr	@r0
(1) 2637/ 6001508 :                     ; 		nop
(1) 2638/ 6001508 :                     ; 		lds	@r15+,pr
(1) 2639/ 6001508 :                     ; 		rts
(1) 2640/ 6001508 :                     ; 		nop
(1) 2641/ 6001508 :                     ; 		align 4
(1) 2642/ 6001508 :                     ;
(1) 2643/ 6001508 :                     ; ; ------------------------------------------------
(1) 2644/ 6001508 :                     ; ; Set new map data
(1) 2645/ 6001508 :                     ; ;
(1) 2646/ 6001508 :                     ; ; @($04,r14) - layout data (set to 0 to clear)
(1) 2647/ 6001508 :                     ; ; ------------------------------------------------
(1) 2648/ 6001508 :                     ;
(1) 2649/ 6001508 :                     ; CmdTaskMd_MakeMap:
(1) 2650/ 6001508 :                     ; 		sts	pr,@-r15
(1) 2651/ 6001508 :                     ; ; 		bsr	MarsVideo_ClearFrame
(1) 2652/ 6001508 :                     ; ; 		nop
(1) 2653/ 6001508 :                     ; 		mov	@(4,r14),r1
(1) 2654/ 6001508 :                     ; 		mov	#MarsLay_Make,r0
(1) 2655/ 6001508 :                     ; 		jsr	@r0
(1) 2656/ 6001508 :                     ; 		mov	r14,@-r15
(1) 2657/ 6001508 :                     ; 		mov	@r15+,r14
(1) 2658/ 6001508 :                     ; 		lds	@r15+,pr
(1) 2659/ 6001508 :                     ; 		rts
(1) 2660/ 6001508 :                     ; 		nop
(1) 2661/ 6001508 :                     ; 		align 4
(1) 2662/ 6001508 :                     ;
(1) 2663/ 6001508 :                     ; ; ------------------------------------------------
(1) 2664/ 6001508 :                     ; ; Set camera position
(1) 2665/ 6001508 :                     ; ;
(1) 2666/ 6001508 :                     ; ; @($04,r14) - Camera slot (TODO)
(1) 2667/ 6001508 :                     ; ; @($08,r14) - Camera X pos
(1) 2668/ 6001508 :                     ; ; @($0C,r14) - Camera Y pos
(1) 2669/ 6001508 :                     ; ; @($10,r14) - Camera Z pos
(1) 2670/ 6001508 :                     ; ; @($14,r14) - Camera X rot
(1) 2671/ 6001508 :                     ; ; @($18,r14) - Camera Y rot
(1) 2672/ 6001508 :                     ; ; @($1C,r14) - Camera Z rot
(1) 2673/ 6001508 :                     ; ; ------------------------------------------------
(1) 2674/ 6001508 :                     ;
(1) 2675/ 6001508 :                     ; CmdTaskMd_CameraPos:
(1) 2676/ 6001508 :                     ; 		mov	#RAM_Mars_ObjCamera,r12
(1) 2677/ 6001508 :                     ; 		mov	r14,r13
(1) 2678/ 6001508 :                     ; 		add	#8,r13
(1) 2679/ 6001508 :                     ; 		mov	@r13+,r1
(1) 2680/ 6001508 :                     ; 		mov	@r13+,r2
(1) 2681/ 6001508 :                     ; 		mov	@r13+,r3
(1) 2682/ 6001508 :                     ; 		mov	@r13+,r4
(1) 2683/ 6001508 :                     ; 		mov	@r13+,r5
(1) 2684/ 6001508 :                     ; 		mov	@r13+,r6
(1) 2685/ 6001508 :                     ; 		mov	r1,@(cam_x_pos,r12)
(1) 2686/ 6001508 :                     ; 		mov	r2,@(cam_y_pos,r12)
(1) 2687/ 6001508 :                     ; 		mov	r3,@(cam_z_pos,r12)
(1) 2688/ 6001508 :                     ; 		mov	r4,@(cam_x_rot,r12)
(1) 2689/ 6001508 :                     ; 		mov	r5,@(cam_y_rot,r12)
(1) 2690/ 6001508 :                     ; 		mov	r6,@(cam_z_rot,r12)
(1) 2691/ 6001508 :                     ; 		rts
(1) 2692/ 6001508 :                     ; 		nop
(1) 2693/ 6001508 :                     ; 		align 4
(1) 2694/ 6001508 :                     ;
(1) 2695/ 6001508 :                     ; ; ------------------------------------------------
(1) 2696/ 6001508 :                     ; ; Set camera position
(1) 2697/ 6001508 :                     ; ;
(1) 2698/ 6001508 :                     ; ; @($04,r14) - Camera slot (TODO)
(1) 2699/ 6001508 :                     ; ; @($08,r14) - Camera X pos
(1) 2700/ 6001508 :                     ; ; @($0C,r14) - Camera Y pos
(1) 2701/ 6001508 :                     ; ; @($10,r14) - Camera Z pos
(1) 2702/ 6001508 :                     ; ; @($14,r14) - Camera X rot
(1) 2703/ 6001508 :                     ; ; @($18,r14) - Camera Y rot
(1) 2704/ 6001508 :                     ; ; @($1C,r14) - Camera Z rot
(1) 2705/ 6001508 :                     ; ; ------------------------------------------------
(1) 2706/ 6001508 :                     ;
(1) 2707/ 6001508 :                     ; CmdTaskMd_UpdModels:
(1) 2708/ 6001508 :                     ; 		mov	#_sysreg+comm15,r1
(1) 2709/ 6001508 :                     ; 		mov	#1,r2
(1) 2710/ 6001508 :                     ; 		mov.b	@r1,r0
(1) 2711/ 6001508 :                     ; 		and	#$80,r0
(1) 2712/ 6001508 :                     ; 		or	r2,r0
(1) 2713/ 6001508 :                     ; 		mov.b	r0,@r1
(1) 2714/ 6001508 :                     ; 		rts
(1) 2715/ 6001508 :                     ; 		nop
(1) 2716/ 6001508 :                     ; 		align 4
(1) 2717/ 6001508 :                     ;
(1) 2718/ 6001508 :                     ; ; ------------------------------------------------
(1) 2719/ 6001508 :                     ; ; Set PWM to play
(1) 2720/ 6001508 :                     ; ;
(1) 2721/ 6001508 :                     ; ; @($04,r14) - Channel slot
(1) 2722/ 6001508 :                     ; ; @($08,r14) - Start point
(1) 2723/ 6001508 :                     ; ; @($0C,r14) - End point
(1) 2724/ 6001508 :                     ; ; @($10,r14) - Loop point
(1) 2725/ 6001508 :                     ; ; @($14,r14) - Pitch
(1) 2726/ 6001508 :                     ; ; @($18,r14) - Volume
(1) 2727/ 6001508 :                     ; ; @($1C,r14) - Settings: %00000000 00000000LR | LR - output bits
(1) 2728/ 6001508 :                     ; ; ------------------------------------------------
(1) 2729/ 6001508 :                     ;
(1) 2730/ 6001508 :                     ; CmdTaskMd_PWM_SetChnl:
(1) 2731/ 6001508 :                     ; 		sts	pr,@-r15
(1) 2732/ 6001508 :                     ; 		mov	@($04,r14),r1
(1) 2733/ 6001508 :                     ; 		mov	@($08,r14),r2
(1) 2734/ 6001508 :                     ; 		mov	@($0C,r14),r3
(1) 2735/ 6001508 :                     ; 		mov	@($10,r14),r4
(1) 2736/ 6001508 :                     ; 		mov	@($14,r14),r5
(1) 2737/ 6001508 :                     ; 		mov	@($18,r14),r6
(1) 2738/ 6001508 :                     ; 		mov	@($1C,r14),r7
(1) 2739/ 6001508 :                     ; 		bsr	MarsSound_SetPwm
(1) 2740/ 6001508 :                     ; 		nop
(1) 2741/ 6001508 :                     ; 		lds	@r15+,pr
(1) 2742/ 6001508 :                     ; 		rts
(1) 2743/ 6001508 :                     ; 		nop
(1) 2744/ 6001508 :                     ; 		align 4
(1) 2745/ 6001508 :                     ;
(1) 2746/ 6001508 :                     ; ; ------------------------------------------------
(1) 2747/ 6001508 :                     ; ; Set PWM pitch to multiple channels
(1) 2748/ 6001508 :                     ; ;
(1) 2749/ 6001508 :                     ; ; @($04,r14) - Channel 0 pitch
(1) 2750/ 6001508 :                     ; ; @($08,r14) - Channel 1 pitch
(1) 2751/ 6001508 :                     ; ; @($0C,r14) - Channel 2 pitch
(1) 2752/ 6001508 :                     ; ; @($10,r14) - Channel 3 pitch
(1) 2753/ 6001508 :                     ; ; @($14,r14) - Channel 4 pitch
(1) 2754/ 6001508 :                     ; ; @($18,r14) - Channel 5 pitch
(1) 2755/ 6001508 :                     ; ; @($1C,r14) - Channel 6 pitch
(1) 2756/ 6001508 :                     ; ; ------------------------------------------------
(1) 2757/ 6001508 :                     ;
(1) 2758/ 6001508 :                     ; CmdTaskMd_PWM_MultPitch:
(1) 2759/ 6001508 :                     ; 		sts	pr,@-r15
(1) 2760/ 6001508 :                     ; 		mov	#$FFFF,r7
(1) 2761/ 6001508 :                     ; 		mov	r14,r13
(1) 2762/ 6001508 :                     ; 		add	#4,r13
(1) 2763/ 6001508 :                     ; 		mov	#0,r1
(1) 2764/ 6001508 :                     ; 	rept MAX_PWMCHNL		; MAX: 7
(1) 2765/ 6001508 :                     ; 		mov	@r13+,r2
(1) 2766/ 6001508 :                     ; 		and	r7,r2
(1) 2767/ 6001508 :                     ; 		bsr	MarsSound_SetPwmPitch
(1) 2768/ 6001508 :                     ; 		nop
(1) 2769/ 6001508 :                     ; 		add	#1,r1
(1) 2770/ 6001508 :                     ; 	endm
(1) 2771/ 6001508 :                     ; 		lds	@r15+,pr
(1) 2772/ 6001508 :                     ; 		rts
(1) 2773/ 6001508 :                     ; 		nop
(1) 2774/ 6001508 :                     ; 		align 4
(1) 2775/ 6001508 :                     ;
(1) 2776/ 6001508 :                     ; ; ------------------------------------------------
(1) 2777/ 6001508 :                     ; ; Enable/Disable PWM channels from playing
(1) 2778/ 6001508 :                     ; ;
(1) 2779/ 6001508 :                     ; ; @($04,r14) - Channel slot
(1) 2780/ 6001508 :                     ; ; @($08,r14) - Enable/Disable/Restart
(1) 2781/ 6001508 :                     ; ; ------------------------------------------------
(1) 2782/ 6001508 :                     ;
(1) 2783/ 6001508 :                     ; CmdTaskMd_PWM_Enable:
(1) 2784/ 6001508 :                     ; 		sts	pr,@-r15
(1) 2785/ 6001508 :                     ; 		mov	@($04,r14),r1
(1) 2786/ 6001508 :                     ; 		mov	@($08,r14),r2
(1) 2787/ 6001508 :                     ; 		bsr	MarsSound_PwmEnable
(1) 2788/ 6001508 :                     ; 		nop
(1) 2789/ 6001508 :                     ; 		lds	@r15+,pr
(1) 2790/ 6001508 :                     ; 		rts
(1) 2791/ 6001508 :                     ; 		nop
(1) 2792/ 6001508 :                     ; 		align 4
(1) 2793/ 6001508 :                     
(1) 2794/ 6001508 :                     ; ----------------------------------------
(1) 2795/ 6001508 :                     
(1) 2796/ 6001508 : 2000 4100 0600 09A4 		ltorg
(1) 2797/ 6001510 :                     
(1) 2798/ 6001510 :                     ; =================================================================
(1) 2799/ 6001510 :                     ; ------------------------------------------------
(1) 2800/ 6001510 :                     ; Slave | Watchdog interrupt
(1) 2801/ 6001510 :                     ; ------------------------------------------------
(1) 2802/ 6001510 :                     
(1) 2803/ 6001510 :                     s_irq_custom:
(1) 2804/ 6001510 : 2F26                		mov	r2,@-r15
(1) 2805/ 6001512 : 2F36                		mov	r3,@-r15
(1) 2806/ 6001514 : 2F46                		mov	r4,@-r15
(1) 2807/ 6001516 : 2F56                		mov	r5,@-r15
(1) 2808/ 6001518 : 2F66                		mov	r6,@-r15
(1) 2809/ 600151A : 2F76                		mov	r7,@-r15
(1) 2810/ 600151C : 9138                		mov	#_FRT,r1
(1) 2811/ 600151E : 8417                		mov.b   @(7,r1),r0
(1) 2812/ 6001520 : CA02                		xor     #2,r0
(1) 2813/ 6001522 : 8017                		mov.b   r0,@(7,r1)
(1) 2814/ 6001524 : C538                		mov.w	@(marsGbl_ZSortReq,gbr),r0
(1) 2815/ 6001526 : 8801                		cmp/eq	#1,r0
(1) 2816/ 6001528 : 8B1C                		bf	.no_req
(1) 2817/ 600152A :                     
(1) 2818/ 600152A :                     	; DONT CALL THIS
(1) 2819/ 600152A :                     	; IF NUMOF FACES < 2
(1) 2820/ 600152A : C52D                		mov.w	@(marsGbl_MdlFacesCntr,gbr),r0
(1) 2821/ 600152C : 6203                		mov	r0,r2
(1) 2822/ 600152E : E103                		mov	#3,r1
(1) 2823/ 6001530 : 3217                		cmp/gt	r1,r2
(1) 2824/ 6001532 : 8B15                		bf	.no_faces
(1) 2825/ 6001534 : D314                		mov	#RAM_Mars_Plgn_ZList_0,r3
(1) 2826/ 6001536 : C52E                		mov.w   @(marsGbl_PlgnBuffNum,gbr),r0
(1) 2827/ 6001538 : C801                		tst     #1,r0
(1) 2828/ 600153A : 8900                		bt	.page_2
(1) 2829/ 600153C : D313                		mov	#RAM_Mars_Plgn_ZList_1,r3
(1) 2830/ 600153E :                     .page_2:
(1) 2831/ 600153E : 6423                		mov	r2,r4
(1) 2832/ 6001540 : 74FE                		add	#-2,r4
(1) 2833/ 6001542 : 4411                		cmp/pz	r4
(1) 2834/ 6001544 : 8B0E                		bf	.no_req
(1) 2835/ 6001546 :                     .z_next:
(1) 2836/ 6001546 : 6032                		mov	@r3,r0
(1) 2837/ 6001548 : 5132                		mov	@(8,r3),r1
(1) 2838/ 600154A : 3017                		cmp/gt	r1,r0
(1) 2839/ 600154C : 8B05                		bf	.z_keep
(1) 2840/ 600154E : 2312                		mov	r1,@r3
(1) 2841/ 6001550 : 1302                		mov	r0,@(8,r3)
(1) 2842/ 6001552 : 5031                		mov	@(4,r3),r0
(1) 2843/ 6001554 : 5133                		mov	@($C,r3),r1
(1) 2844/ 6001556 : 1311                		mov	r1,@(4,r3)
(1) 2845/ 6001558 : 1303                		mov	r0,@($C,r3)
(1) 2846/ 600155A :                     .z_keep:
(1) 2847/ 600155A : 4410                		dt	r4
(1) 2848/ 600155C : 8FF3                		bf/s	.z_next
(1) 2849/ 600155E : 7308                		add	#8,r3
(1) 2850/ 6001560 :                     .no_faces:
(1) 2851/ 6001560 : E000                		mov	#0,r0
(1) 2852/ 6001562 : C138                		mov.w	r0,@(marsGbl_ZSortReq,gbr)
(1) 2853/ 6001564 :                     
(1) 2854/ 6001564 :                     .no_req:
(1) 2855/ 6001564 : 9115                		mov	#$FFFFFE80,r1
(1) 2856/ 6001566 : 9015                		mov.w   #$A518,r0		; Watchdog OFF
(1) 2857/ 6001568 : 2101                		mov.w   r0,@r1
(1) 2858/ 600156A : CB20                		or      #$20,r0			; ON again
(1) 2859/ 600156C : 2101                		mov.w   r0,@r1
(1) 2860/ 600156E : E201                		mov	#1,r2
(1) 2861/ 6001570 : 9011                		mov.w   #$5A00,r0		; Timer for the next one
(1) 2862/ 6001572 : 202B                		or	r2,r0
(1) 2863/ 6001574 : 2101                		mov.w	r0,@r1
(1) 2864/ 6001576 :                     
(1) 2865/ 6001576 : 67F6                		mov	@r15+,r7
(1) 2866/ 6001578 : 66F6                		mov	@r15+,r6
(1) 2867/ 600157A : 65F6                		mov	@r15+,r5
(1) 2868/ 600157C : 64F6                		mov	@r15+,r4
(1) 2869/ 600157E : 63F6                		mov	@r15+,r3
(1) 2870/ 6001580 : 62F6                		mov	@r15+,r2
(1) 2871/ 6001582 : 000B                		rts
(1) 2872/ 6001584 : 0009                		nop
(1) 2873/ 6001586 :                     		align 4
(1) 2874/ 6001588 : 0600 9F84 0600 A384 		ltorg
                    FE10 FE80 A518 5A00 
(1) 2875/ 6001598 :                     
(1) 2876/ 6001598 :                     ; ====================================================================
(1) 2877/ 6001598 :                     ; ----------------------------------------------------------------
(1) 2878/ 6001598 :                     ; Cache routines
(1) 2879/ 6001598 :                     ; ----------------------------------------------------------------
(1) 2880/ 6001598 :                     
(1) 2881/ 6001598 :                     		include "system/mars/cache.asm"
(2)    1/ 6001598 :                     ; ====================================================================
(2)    2/ 6001598 :                     ; ----------------------------------------------------------------
(2)    3/ 6001598 :                     ; CACHE code for Master CPU
(2)    4/ 6001598 :                     ;
(2)    5/ 6001598 :                     ; LIMIT: $800 bytes
(2)    6/ 6001598 :                     ; ----------------------------------------------------------------
(2)    7/ 6001598 :                     
(2)    8/ 6001598 :                     		align 4
(2)    9/ 6001598 :                     CACHE_MASTER:
(2)   10/FFFFFFFFC0000000 :                     		phase $C0000000
(2)   11/FFFFFFFFC0000000 :                     
(2)   12/FFFFFFFFC0000000 :                     ; ------------------------------------------------
(2)   13/FFFFFFFFC0000000 :                     ; Watchdog tasks
(2)   14/FFFFFFFFC0000000 :                     ; ------------------------------------------------
(2)   15/FFFFFFFFC0000000 :                     
(2)   16/FFFFFFFFC0000000 :                     ; Cache_OnInterrupt:
(2)   17/FFFFFFFFC0000000 :                     m_irq_custom:
(2)   18/FFFFFFFFC0000000 : D108                		mov	.tag_FRT,r1
(2)   19/FFFFFFFFC0000002 : 8417                		mov.b	@(7,r1), r0
(2)   20/FFFFFFFFC0000004 : CA02                		xor	#2,r0
(2)   21/FFFFFFFFC0000006 : 8017                		mov.b	r0,@(7,r1)
(2)   22/FFFFFFFFC0000008 : C532                		mov.w	@(marsGbl_DrwTask,gbr),r0
(2)   23/FFFFFFFFC000000A : C9FF                		and	#$FF,r0
(2)   24/FFFFFFFFC000000C : 4008                		shll2	r0
(2)   25/FFFFFFFFC000000E : D16D                		mov	#.list,r1
(2)   26/FFFFFFFFC0000010 : 001E                		mov	@(r1,r0),r0
(2)   27/FFFFFFFFC0000012 : 402B                		jmp	@r0
(2)   28/FFFFFFFFC0000014 : 0009                		nop
(2)   29/FFFFFFFFC0000016 :                     		align 4
(2)   30/FFFFFFFFC0000018 :                     .list:
(2)   31/FFFFFFFFC0000018 : C000 04A8           		dc.l drwtsk_00		; (null entry)
(2)   32/FFFFFFFFC000001C : C000 0028           		dc.l drwtsk_01		; Draw background
(2)   33/FFFFFFFFC0000020 : C000 0204           		dc.l drwtsk_02		; Main polygons jump
(2)   34/FFFFFFFFC0000024 :                     ; 		dc.l drwtsk_03		; Resume from solid-color
(2)   35/FFFFFFFFC0000024 : FFFF FE10           .tag_FRT:	dc.l _FRT
(2)   36/FFFFFFFFC0000028 :                     
(2)   37/FFFFFFFFC0000028 :                     ; --------------------------------
(2)   38/FFFFFFFFC0000028 :                     ; Task $01: Left/Right drawing
(2)   39/FFFFFFFFC0000028 :                     ;
(2)   40/FFFFFFFFC0000028 :                     ; (Called on Watchdog)
(2)   41/FFFFFFFFC0000028 :                     ; --------------------------------
(2)   42/FFFFFFFFC0000028 :                     
(2)   43/FFFFFFFFC0000028 :                     		align 4
(2)   44/FFFFFFFFC0000028 :                     drwtsk_01:
(2)   45/FFFFFFFFC0000028 : 2F26                		mov	r2,@-r15
(2)   46/FFFFFFFFC000002A : 2F36                		mov	r3,@-r15
(2)   47/FFFFFFFFC000002C : 2F46                		mov	r4,@-r15
(2)   48/FFFFFFFFC000002E : 2F56                		mov	r5,@-r15
(2)   49/FFFFFFFFC0000030 : 2F66                		mov	r6,@-r15
(2)   50/FFFFFFFFC0000032 : 2F76                		mov	r7,@-r15
(2)   51/FFFFFFFFC0000034 : 2F86                		mov	r8,@-r15
(2)   52/FFFFFFFFC0000036 : 2F96                		mov	r9,@-r15
(2)   53/FFFFFFFFC0000038 : 4F12                		sts	macl,@-r15
(2)   54/FFFFFFFFC000003A :                     
(2)   55/FFFFFFFFC000003A :                     ; 		mov	#_vdpreg,r1
(2)   56/FFFFFFFFC000003A :                     ; .wait_fb:	mov.w   @($A,r1),r0		; Framebuffer free?
(2)   57/FFFFFFFFC000003A :                     ; 		tst     #2,r0
(2)   58/FFFFFFFFC000003A :                     ; 		bf      .wait_fb
(2)   59/FFFFFFFFC000003A :                     ; 		mov.w   @(6,r1),r0		; SVDP-fill address
(2)   60/FFFFFFFFC000003A :                     ; 		add     #$5F,r0			; Preincrement
(2)   61/FFFFFFFFC000003A :                     ; 		mov.w   r0,@(6,r1)
(2)   62/FFFFFFFFC000003A :                     ; 		mov.w   #320/2,r0		; SVDP-fill size (320 pixels)
(2)   63/FFFFFFFFC000003A :                     ; 		mov.w   r0,@(4,r1)
(2)   64/FFFFFFFFC000003A :                     ; 		mov.w	#$0000,r0		; SVDP-fill pixel data and start filling
(2)   65/FFFFFFFFC000003A :                     ; 		mov.w   r0,@(8,r1)		; After finishing, SVDP-address got updated
(2)   66/FFFFFFFFC000003A :                     
(2)   67/FFFFFFFFC000003A :                     ; Left/Right draw goes in and out
(2)   68/FFFFFFFFC000003A : C600                		mov	@(marsGbl_BgData,gbr),r0
(2)   69/FFFFFFFFC000003C : 4015                		cmp/pl	r0
(2)   70/FFFFFFFFC000003E : 8B06                		bf	.get_out
(2)   71/FFFFFFFFC0000040 : E600                		mov	#0,r6
(2)   72/FFFFFFFFC0000042 : C52B                		mov.w	@(marsGbl_Bg_DrwReqR,gbr),r0
(2)   73/FFFFFFFFC0000044 : 8800                		cmp/eq	#0,r0
(2)   74/FFFFFFFFC0000046 : 8B22                		bf	.dtsk01_dright
(2)   75/FFFFFFFFC0000048 : C52A                		mov.w	@(marsGbl_Bg_DrwReqL,gbr),r0
(2)   76/FFFFFFFFC000004A : 8800                		cmp/eq	#0,r0
(2)   77/FFFFFFFFC000004C : 8B02                		bf	.dtsk01_dleft
(2)   78/FFFFFFFFC000004E :                     .get_out:
(2)   79/FFFFFFFFC000004E : A093                		bra	dtsk01_exit
(2)   80/FFFFFFFFC0000050 : 0009                		nop
(2)   81/FFFFFFFFC0000052 :                     		align 4
(2)   82/FFFFFFFFC0000054 :                     .dtsk01_dleft:
(2)   83/FFFFFFFFC0000054 : D25C                		mov	#Cach_BgFbPosLR,r2
(2)   84/FFFFFFFFC0000056 : 6022                		mov	@r2,r0
(2)   85/FFFFFFFFC0000058 : D15C                		mov	#(MSCRL_WIDTH*MSCRL_HEIGHT),r1
(2)   86/FFFFFFFFC000005A : 3017                		cmp/gt	r1,r0
(2)   87/FFFFFFFFC000005C : 8B01                		bf	.prefix_l
(2)   88/FFFFFFFFC000005E : 3018                		sub	r1,r0
(2)   89/FFFFFFFFC0000060 : 2202                		mov	r0,@r2
(2)   90/FFFFFFFFC0000062 :                     .prefix_l:
(2)   91/FFFFFFFFC0000062 : D11B                		mov	.tag_scrlwdth,r1
(2)   92/FFFFFFFFC0000064 : 3013                		cmp/ge	r1,r0
(2)   93/FFFFFFFFC0000066 : 8902                		bt	.lastline_l
(2)   94/FFFFFFFFC0000068 : D459                		mov	#(_framebuffer+$200)+(MSCRL_WIDTH*MSCRL_HEIGHT),r4
(2)   95/FFFFFFFFC000006A : 340C                		add	r0,r4
(2)   96/FFFFFFFFC000006C : E601                		mov	#1,r6
(2)   97/FFFFFFFFC000006E :                     .lastline_l:
(2)   98/FFFFFFFFC000006E : D759                		mov	#_framebuffer+$200,r7
(2)   99/FFFFFFFFC0000070 : 370C                		add	r0,r7
(2)  100/FFFFFFFFC0000072 : C601                		mov	@(marsGbl_BgData_R,gbr),r0
(2)  101/FFFFFFFFC0000074 : 6103                		mov	r0,r1
(2)  102/FFFFFFFFC0000076 : D058                		mov	#Cach_YHead_LR,r0
(2)  103/FFFFFFFFC0000078 : 6002                		mov	@r0,r0
(2)  104/FFFFFFFFC000007A : 310C                		add	r0,r1
(2)  105/FFFFFFFFC000007C : 6213                		mov	r1,r2
(2)  106/FFFFFFFFC000007E : 6313                		mov	r1,r3
(2)  107/FFFFFFFFC0000080 : C51C                		mov.w	@(marsGbl_BgWidth,gbr),r0
(2)  108/FFFFFFFFC0000082 : 330C                		add	r0,r3
(2)  109/FFFFFFFFC0000084 : D055                		mov	#Cach_XHead_L,r0
(2)  110/FFFFFFFFC0000086 : 6002                		mov	@r0,r0
(2)  111/FFFFFFFFC0000088 : 310C                		add	r0,r1
(2)  112/FFFFFFFFC000008A : A025                		bra	dtsk01_lrdraw
(2)  113/FFFFFFFFC000008C : 6513                		mov	r1,r5
(2)  114/FFFFFFFFC000008E :                     .dtsk01_dright:
(2)  115/FFFFFFFFC000008E : D254                		mov	#Cach_BgFbPosLR,r2
(2)  116/FFFFFFFFC0000090 : 6022                		mov	@r2,r0
(2)  117/FFFFFFFFC0000092 : D14E                		mov	#(MSCRL_WIDTH*MSCRL_HEIGHT),r1
(2)  118/FFFFFFFFC0000094 : 3017                		cmp/gt	r1,r0
(2)  119/FFFFFFFFC0000096 : 8B01                		bf	.prefix_r
(2)  120/FFFFFFFFC0000098 : 3018                		sub	r1,r0
(2)  121/FFFFFFFFC000009A : 2202                		mov	r0,@r2
(2)  122/FFFFFFFFC000009C :                     .prefix_r:
(2)  123/FFFFFFFFC000009C : D10D                		mov	.tag_scrnwdth,r1			; TODO: a variable for this?
(2)  124/FFFFFFFFC000009E : 301C                		add	r1,r0
(2)  125/FFFFFFFFC00000A0 : D74A                		mov	#(MSCRL_WIDTH*MSCRL_HEIGHT),r7
(2)  126/FFFFFFFFC00000A2 : 3073                		cmp/ge	r7,r0
(2)  127/FFFFFFFFC00000A4 : 8B03                		bf	.lastline_r
(2)  128/FFFFFFFFC00000A6 : E601                		mov	#1,r6
(2)  129/FFFFFFFFC00000A8 : D44A                		mov	#_framebuffer+$200,r4
(2)  130/FFFFFFFFC00000AA : 340C                		add	r0,r4
(2)  131/FFFFFFFFC00000AC : 3078                		sub	r7,r0
(2)  132/FFFFFFFFC00000AE :                     .lastline_r:
(2)  133/FFFFFFFFC00000AE : D749                		mov	#_framebuffer+$200,r7
(2)  134/FFFFFFFFC00000B0 : 370C                		add	r0,r7
(2)  135/FFFFFFFFC00000B2 : C601                		mov	@(marsGbl_BgData_R,gbr),r0
(2)  136/FFFFFFFFC00000B4 : 6103                		mov	r0,r1
(2)  137/FFFFFFFFC00000B6 : D04B                		mov	#Cach_YHead_LR,r0
(2)  138/FFFFFFFFC00000B8 : 6002                		mov	@r0,r0
(2)  139/FFFFFFFFC00000BA : 310C                		add	r0,r1
(2)  140/FFFFFFFFC00000BC : 6213                		mov	r1,r2
(2)  141/FFFFFFFFC00000BE : 6313                		mov	r1,r3
(2)  142/FFFFFFFFC00000C0 : C51C                		mov.w	@(marsGbl_BgWidth,gbr),r0
(2)  143/FFFFFFFFC00000C2 : 330C                		add	r0,r3
(2)  144/FFFFFFFFC00000C4 : D048                		mov	#Cach_XHead_R,r0
(2)  145/FFFFFFFFC00000C6 : 6002                		mov	@r0,r0
(2)  146/FFFFFFFFC00000C8 : 310C                		add	r0,r1
(2)  147/FFFFFFFFC00000CA : A005                		bra	dtsk01_lrdraw
(2)  148/FFFFFFFFC00000CC : 6513                		mov	r1,r5
(2)  149/FFFFFFFFC00000CE :                     		align 4
(2)  150/FFFFFFFFC00000D0 : 0000 0150           .tag_scrlwdth:	dc.l MSCRL_WIDTH
(2)  151/FFFFFFFFC00000D4 : 0000 0140           .tag_scrnwdth	dc.l 320
(2)  152/FFFFFFFFC00000D8 :                     
(2)  153/FFFFFFFFC00000D8 :                     dtsk01_lrdraw:
(2)  154/FFFFFFFFC00000D8 :                     	rept (MSCRL_BLKSIZE>>2)
(2)  155/FFFFFFFFC00000D8 :                     		cmp/ge	r3,r1
(2)  156/FFFFFFFFC00000D8 :                     		bf	.toomx
(2)  157/FFFFFFFFC00000D8 :                     		mov	r2,r1
(2)  158/FFFFFFFFC00000D8 :                     .toomx:
(2)  159/FFFFFFFFC00000D8 :                     		mov	@r1+,r0
(2)  160/FFFFFFFFC00000D8 :                     		mov	r0,@r7
(2)  161/FFFFFFFFC00000D8 :                     		add	#4,r7
(2)  162/FFFFFFFFC00000D8 :                     	endm
(2)  155/FFFFFFFFC00000D8 : 3133                		cmp/ge	r3,r1
(2)  156/FFFFFFFFC00000DA : 8B00                		bf	.toomx
(2)  157/FFFFFFFFC00000DC : 6123                		mov	r2,r1
(2)  158/FFFFFFFFC00000DE :                     .toomx:
(2)  159/FFFFFFFFC00000DE : 6016                		mov	@r1+,r0
(2)  160/FFFFFFFFC00000E0 : 2702                		mov	r0,@r7
(2)  161/FFFFFFFFC00000E2 : 7704                		add	#4,r7
(2)  155/FFFFFFFFC00000E4 : 3133                		cmp/ge	r3,r1
(2)  156/FFFFFFFFC00000E6 : 8B00                		bf	.toomx
(2)  157/FFFFFFFFC00000E8 : 6123                		mov	r2,r1
(2)  158/FFFFFFFFC00000EA :                     .toomx:
(2)  159/FFFFFFFFC00000EA : 6016                		mov	@r1+,r0
(2)  160/FFFFFFFFC00000EC : 2702                		mov	r0,@r7
(2)  161/FFFFFFFFC00000EE : 7704                		add	#4,r7
(2)  155/FFFFFFFFC00000F0 : 3133                		cmp/ge	r3,r1
(2)  156/FFFFFFFFC00000F2 : 8B00                		bf	.toomx
(2)  157/FFFFFFFFC00000F4 : 6123                		mov	r2,r1
(2)  158/FFFFFFFFC00000F6 :                     .toomx:
(2)  159/FFFFFFFFC00000F6 : 6016                		mov	@r1+,r0
(2)  160/FFFFFFFFC00000F8 : 2702                		mov	r0,@r7
(2)  161/FFFFFFFFC00000FA : 7704                		add	#4,r7
(2)  155/FFFFFFFFC00000FC : 3133                		cmp/ge	r3,r1
(2)  156/FFFFFFFFC00000FE : 8B00                		bf	.toomx
(2)  157/FFFFFFFFC0000100 : 6123                		mov	r2,r1
(2)  158/FFFFFFFFC0000102 :                     .toomx:
(2)  159/FFFFFFFFC0000102 : 6016                		mov	@r1+,r0
(2)  160/FFFFFFFFC0000104 : 2702                		mov	r0,@r7
(2)  161/FFFFFFFFC0000106 : 7704                		add	#4,r7
(2)  163/FFFFFFFFC0000108 :                     
(2)  164/FFFFFFFFC0000108 :                     	; *** Last line only ***
(2)  165/FFFFFFFFC0000108 :                     	; r6 - flag
(2)  166/FFFFFFFFC0000108 :                     	; r5 - BG in / r4 - FB out
(2)  167/FFFFFFFFC0000108 : 4615                		cmp/pl	r6
(2)  168/FFFFFFFFC000010A : 8B17                		bf	.not_ln0
(2)  169/FFFFFFFFC000010C :                     	rept (MSCRL_BLKSIZE>>2)
(2)  170/FFFFFFFFC000010C :                     		cmp/ge	r3,r5
(2)  171/FFFFFFFFC000010C :                     		bf	.toomx
(2)  172/FFFFFFFFC000010C :                     		mov	r2,r5
(2)  173/FFFFFFFFC000010C :                     .toomx:
(2)  174/FFFFFFFFC000010C :                     		mov	@r5+,r0
(2)  175/FFFFFFFFC000010C :                     		mov	r0,@r4
(2)  176/FFFFFFFFC000010C :                     		add	#4,r4
(2)  177/FFFFFFFFC000010C :                     	endm
(2)  170/FFFFFFFFC000010C : 3533                		cmp/ge	r3,r5
(2)  171/FFFFFFFFC000010E : 8B00                		bf	.toomx
(2)  172/FFFFFFFFC0000110 : 6523                		mov	r2,r5
(2)  173/FFFFFFFFC0000112 :                     .toomx:
(2)  174/FFFFFFFFC0000112 : 6056                		mov	@r5+,r0
(2)  175/FFFFFFFFC0000114 : 2402                		mov	r0,@r4
(2)  176/FFFFFFFFC0000116 : 7404                		add	#4,r4
(2)  170/FFFFFFFFC0000118 : 3533                		cmp/ge	r3,r5
(2)  171/FFFFFFFFC000011A : 8B00                		bf	.toomx
(2)  172/FFFFFFFFC000011C : 6523                		mov	r2,r5
(2)  173/FFFFFFFFC000011E :                     .toomx:
(2)  174/FFFFFFFFC000011E : 6056                		mov	@r5+,r0
(2)  175/FFFFFFFFC0000120 : 2402                		mov	r0,@r4
(2)  176/FFFFFFFFC0000122 : 7404                		add	#4,r4
(2)  170/FFFFFFFFC0000124 : 3533                		cmp/ge	r3,r5
(2)  171/FFFFFFFFC0000126 : 8B00                		bf	.toomx
(2)  172/FFFFFFFFC0000128 : 6523                		mov	r2,r5
(2)  173/FFFFFFFFC000012A :                     .toomx:
(2)  174/FFFFFFFFC000012A : 6056                		mov	@r5+,r0
(2)  175/FFFFFFFFC000012C : 2402                		mov	r0,@r4
(2)  176/FFFFFFFFC000012E : 7404                		add	#4,r4
(2)  170/FFFFFFFFC0000130 : 3533                		cmp/ge	r3,r5
(2)  171/FFFFFFFFC0000132 : 8B00                		bf	.toomx
(2)  172/FFFFFFFFC0000134 : 6523                		mov	r2,r5
(2)  173/FFFFFFFFC0000136 :                     .toomx:
(2)  174/FFFFFFFFC0000136 : 6056                		mov	@r5+,r0
(2)  175/FFFFFFFFC0000138 : 2402                		mov	r0,@r4
(2)  176/FFFFFFFFC000013A : 7404                		add	#4,r4
(2)  178/FFFFFFFFC000013C :                     .not_ln0:
(2)  179/FFFFFFFFC000013C : D12B                		mov	#Cach_YRead_LR,r1
(2)  180/FFFFFFFFC000013E : C600                		mov	@(marsGbl_BgData,gbr),r0
(2)  181/FFFFFFFFC0000140 : 6203                		mov	r0,r2
(2)  182/FFFFFFFFC0000142 : C51D                		mov.w	@(marsGbl_BgHeight,gbr),r0
(2)  183/FFFFFFFFC0000144 : 6403                		mov	r0,r4
(2)  184/FFFFFFFFC0000146 : C51C                		mov.w	@(marsGbl_BgWidth,gbr),r0
(2)  185/FFFFFFFFC0000148 : 6303                		mov	r0,r3
(2)  186/FFFFFFFFC000014A : C601                		mov	@(marsGbl_BgData_R,gbr),r0
(2)  187/FFFFFFFFC000014C : 6503                		mov	r0,r5
(2)  188/FFFFFFFFC000014E : 353C                		add	r3,r5
(2)  189/FFFFFFFFC0000150 : 6012                		mov	@r1,r0
(2)  190/FFFFFFFFC0000152 : 7001                		add	#1,r0
(2)  191/FFFFFFFFC0000154 : 3043                		cmp/ge	r4,r0
(2)  192/FFFFFFFFC0000156 : 8B03                		bf	.resety
(2)  193/FFFFFFFFC0000158 : 6523                		mov	r2,r5
(2)  194/FFFFFFFFC000015A : 200A                		xor	r0,r0
(2)  195/FFFFFFFFC000015C : D424                		mov	#Cach_YHead_LR,r4
(2)  196/FFFFFFFFC000015E : 2402                		mov	r0,@r4
(2)  197/FFFFFFFFC0000160 :                     .resety:
(2)  198/FFFFFFFFC0000160 : 2102                		mov	r0,@r1
(2)  199/FFFFFFFFC0000162 : 6053                		mov	r5,r0
(2)  200/FFFFFFFFC0000164 : C201                		mov	r0,@(marsGbl_BgData_R,gbr)
(2)  201/FFFFFFFFC0000166 : D323                		mov	#Cach_BgFbPosLR,r3	; TODO: cambiame a otro var de Y
(2)  202/FFFFFFFFC0000168 : 6032                		mov	@r3,r0
(2)  203/FFFFFFFFC000016A : D218                		mov	#(MSCRL_WIDTH*MSCRL_HEIGHT),r2
(2)  204/FFFFFFFFC000016C : 9146                		mov	#MSCRL_WIDTH,r1
(2)  205/FFFFFFFFC000016E : 301C                		add	r1,r0
(2)  206/FFFFFFFFC0000170 : 3027                		cmp/gt	r2,r0
(2)  207/FFFFFFFFC0000172 : 8B00                		bf	.fbmuch
(2)  208/FFFFFFFFC0000174 : 3028                		sub	r2,r0
(2)  209/FFFFFFFFC0000176 :                     .fbmuch:
(2)  210/FFFFFFFFC0000176 : 2302                		mov	r0,@r3
(2)  211/FFFFFFFFC0000178 :                     
(2)  212/FFFFFFFFC0000178 :                     dtsk01_exit:
(2)  213/FFFFFFFFC0000178 : 9141                		mov.l   #$FFFFFE80,r1
(2)  214/FFFFFFFFC000017A : 9041                		mov.w   #$A518,r0		; OFF
(2)  215/FFFFFFFFC000017C : 2101                		mov.w   r0,@r1
(2)  216/FFFFFFFFC000017E : CB20                		or      #$20,r0			; ON
(2)  217/FFFFFFFFC0000180 : 2101                		mov.w   r0,@r1
(2)  218/FFFFFFFFC0000182 : 903E                		mov.w   #$5A10,r0		; Timer before next watchdog
(2)  219/FFFFFFFFC0000184 : 2101                		mov.w   r0,@r1
(2)  220/FFFFFFFFC0000186 : D11C                		mov	#Cach_LR_Lines,r1	; Decrement a line to progress
(2)  221/FFFFFFFFC0000188 : 6012                		mov	@r1,r0
(2)  222/FFFFFFFFC000018A : 4010                		dt	r0
(2)  223/FFFFFFFFC000018C : 8F0C                		bf/s	tsk00_exit
(2)  224/FFFFFFFFC000018E : 2102                		mov	r0,@r1
(2)  225/FFFFFFFFC0000190 :                     
(2)  226/FFFFFFFFC0000190 : C52B                		mov.w	@(marsGbl_Bg_DrwReqR,gbr),r0
(2)  227/FFFFFFFFC0000192 : 8800                		cmp/eq	#0,r0
(2)  228/FFFFFFFFC0000194 : 8901                		bt	.ndrw_r
(2)  229/FFFFFFFFC0000196 : 4010                		dt	r0
(2)  230/FFFFFFFFC0000198 : C12B                		mov.w	r0,@(marsGbl_Bg_DrwReqR,gbr)
(2)  231/FFFFFFFFC000019A :                     .ndrw_r:
(2)  232/FFFFFFFFC000019A : C52A                		mov.w	@(marsGbl_Bg_DrwReqL,gbr),r0
(2)  233/FFFFFFFFC000019C : 8800                		cmp/eq	#0,r0
(2)  234/FFFFFFFFC000019E : 8901                		bt	tsk00_gonext
(2)  235/FFFFFFFFC00001A0 : 4010                		dt	r0
(2)  236/FFFFFFFFC00001A2 : C12A                		mov.w	r0,@(marsGbl_Bg_DrwReqL,gbr)
(2)  237/FFFFFFFFC00001A4 :                     
(2)  238/FFFFFFFFC00001A4 :                     tsk00_gonext:
(2)  239/FFFFFFFFC00001A4 : E002                		mov	#2,r0			; If finished: Set task $02
(2)  240/FFFFFFFFC00001A6 : C132                		mov.w	r0,@(marsGbl_DrwTask,gbr)
(2)  241/FFFFFFFFC00001A8 :                     tsk00_exit:
(2)  242/FFFFFFFFC00001A8 : 4F16                		lds	@r15+,macl
(2)  243/FFFFFFFFC00001AA : 69F6                		mov	@r15+,r9
(2)  244/FFFFFFFFC00001AC : 68F6                		mov	@r15+,r8
(2)  245/FFFFFFFFC00001AE : 67F6                		mov	@r15+,r7
(2)  246/FFFFFFFFC00001B0 : 66F6                		mov	@r15+,r6
(2)  247/FFFFFFFFC00001B2 : 65F6                		mov	@r15+,r5
(2)  248/FFFFFFFFC00001B4 : 64F6                		mov	@r15+,r4
(2)  249/FFFFFFFFC00001B6 : 63F6                		mov	@r15+,r3
(2)  250/FFFFFFFFC00001B8 : 62F6                		mov	@r15+,r2
(2)  251/FFFFFFFFC00001BA : 000B                		rts
(2)  252/FFFFFFFFC00001BC : 0009                		nop
(2)  253/FFFFFFFFC00001BE :                     		align 4
(2)  254/FFFFFFFFC00001C0 :                     ; 		ltorg
(2)  255/FFFFFFFFC00001C0 :                     
(2)  256/FFFFFFFFC00001C0 :                     ; --------------------------------
(2)  257/FFFFFFFFC00001C0 :                     ; Up/Down drawing
(2)  258/FFFFFFFFC00001C0 :                     ;
(2)  259/FFFFFFFFC00001C0 :                     ; (Called on mainloop)
(2)  260/FFFFFFFFC00001C0 :                     ; --------------------------------
(2)  261/FFFFFFFFC00001C0 :                     
(2)  262/FFFFFFFFC00001C0 :                     CachJmp_DrwUpDown:
(2)  263/FFFFFFFFC00001C0 :                     ; 	; **** Up/Down draw check
(2)  264/FFFFFFFFC00001C0 :                     ; 		mov	@(marsGbl_BgData,gbr),r0
(2)  265/FFFFFFFFC00001C0 :                     ; 		mov	r0,r11
(2)  266/FFFFFFFFC00001C0 :                     ; 		mov	r0,r12
(2)  267/FFFFFFFFC00001C0 :                     ; 		mov.w	@(marsGbl_BgWidth,gbr),r0
(2)  268/FFFFFFFFC00001C0 :                     ; 		mov	r0,r1
(2)  269/FFFFFFFFC00001C0 :                     ; 		mov.w	@(marsGbl_BgHeight,gbr),r0
(2)  270/FFFFFFFFC00001C0 :                     ; 		mulu	r1,r0
(2)  271/FFFFFFFFC00001C0 :                     ; 		sts	macl,r0
(2)  272/FFFFFFFFC00001C0 :                     ; 		add	r0,r12
(2)  273/FFFFFFFFC00001C0 :                     ; 		mov	#-MSCRL_BLKSIZE,r6
(2)  274/FFFFFFFFC00001C0 :                     ; 		mov.w	@(marsGbl_Bg_DrwReqD,gbr),r0
(2)  275/FFFFFFFFC00001C0 :                     ; 		cmp/eq	#0,r0
(2)  276/FFFFFFFFC00001C0 :                     ; 		bf	.tsk00_down
(2)  277/FFFFFFFFC00001C0 :                     ; 		mov.w	@(marsGbl_Bg_DrwReqU,gbr),r0
(2)  278/FFFFFFFFC00001C0 :                     ; 		cmp/eq	#0,r0
(2)  279/FFFFFFFFC00001C0 :                     ; 		bf	.tsk00_up
(2)  280/FFFFFFFFC00001C0 :                     ; 		bra	drw_ud_exit
(2)  281/FFFFFFFFC00001C0 :                     ; 		nop
(2)  282/FFFFFFFFC00001C0 :                     ;
(2)  283/FFFFFFFFC00001C0 :                     ; 	; r2 - Start bg line
(2)  284/FFFFFFFFC00001C0 :                     ; 	; r3 - End bg line
(2)  285/FFFFFFFFC00001C0 :                     ; 	; r6 - Y current
(2)  286/FFFFFFFFC00001C0 :                     ; 	; r5 - FB current base
(2)  287/FFFFFFFFC00001C0 :                     ; .tsk00_down:
(2)  288/FFFFFFFFC00001C0 :                     ; 		dt	r0
(2)  289/FFFFFFFFC00001C0 :                     ; 		mov.w	r0,@(marsGbl_Bg_DrwReqD,gbr)
(2)  290/FFFFFFFFC00001C0 :                     ;
(2)  291/FFFFFFFFC00001C0 :                     ; 		mov	#Cach_YHead_D,r2
(2)  292/FFFFFFFFC00001C0 :                     ; 		mov	@r2,r2
(2)  293/FFFFFFFFC00001C0 :                     ; 		mov.w	@(marsGbl_BgWidth,gbr),r0
(2)  294/FFFFFFFFC00001C0 :                     ; 		muls	r0,r2
(2)  295/FFFFFFFFC00001C0 :                     ; 		sts	macl,r2
(2)  296/FFFFFFFFC00001C0 :                     ; 		mov	@(marsGbl_BgData,gbr),r0
(2)  297/FFFFFFFFC00001C0 :                     ; 		add	r0,r2
(2)  298/FFFFFFFFC00001C0 :                     ; 		mov	r2,r3
(2)  299/FFFFFFFFC00001C0 :                     ; 		mov.w	@(marsGbl_BgWidth,gbr),r0
(2)  300/FFFFFFFFC00001C0 :                     ; 		add	r0,r3
(2)  301/FFFFFFFFC00001C0 :                     ; 		mov	@(marsGbl_Bg_YbgXBase,gbr),r0
(2)  302/FFFFFFFFC00001C0 :                     ; 		and	r6,r0
(2)  303/FFFFFFFFC00001C0 :                     ; 		mov	r0,r5
(2)  304/FFFFFFFFC00001C0 :                     ; 		mov	#Cach_BgFbPos_D,r0
(2)  305/FFFFFFFFC00001C0 :                     ; 		mov	@r0,r0
(2)  306/FFFFFFFFC00001C0 :                     ; 		bra	.drwy_go
(2)  307/FFFFFFFFC00001C0 :                     ; 		mov	r0,r6
(2)  308/FFFFFFFFC00001C0 :                     ;
(2)  309/FFFFFFFFC00001C0 :                     ; .tsk00_up:
(2)  310/FFFFFFFFC00001C0 :                     ; 		dt	r0
(2)  311/FFFFFFFFC00001C0 :                     ; 		mov.w	r0,@(marsGbl_Bg_DrwReqU,gbr)
(2)  312/FFFFFFFFC00001C0 :                     ;
(2)  313/FFFFFFFFC00001C0 :                     ; 		mov	#Cach_YHead_U,r2
(2)  314/FFFFFFFFC00001C0 :                     ; 		mov	@r2,r2
(2)  315/FFFFFFFFC00001C0 :                     ; 		mov.w	@(marsGbl_BgWidth,gbr),r0
(2)  316/FFFFFFFFC00001C0 :                     ; 		muls	r0,r2
(2)  317/FFFFFFFFC00001C0 :                     ; 		sts	macl,r2
(2)  318/FFFFFFFFC00001C0 :                     ; 		mov	@(marsGbl_BgData,gbr),r0
(2)  319/FFFFFFFFC00001C0 :                     ; 		add	r0,r2
(2)  320/FFFFFFFFC00001C0 :                     ; 		mov	r2,r3
(2)  321/FFFFFFFFC00001C0 :                     ; 		mov.w	@(marsGbl_BgWidth,gbr),r0
(2)  322/FFFFFFFFC00001C0 :                     ; 		add	r0,r3
(2)  323/FFFFFFFFC00001C0 :                     ; 		mov	@(marsGbl_Bg_YbgXBase,gbr),r0
(2)  324/FFFFFFFFC00001C0 :                     ; 		and	r6,r0
(2)  325/FFFFFFFFC00001C0 :                     ; 		mov	r0,r5
(2)  326/FFFFFFFFC00001C0 :                     ; 		mov	#Cach_BgFbPos_U,r0
(2)  327/FFFFFFFFC00001C0 :                     ; 		mov	@r0,r0
(2)  328/FFFFFFFFC00001C0 :                     ; 		mov	r0,r6
(2)  329/FFFFFFFFC00001C0 :                     ;
(2)  330/FFFFFFFFC00001C0 :                     ; .drwy_go:
(2)  331/FFFFFFFFC00001C0 :                     ; 		mov	#MSCRL_BLKSIZE,r8
(2)  332/FFFFFFFFC00001C0 :                     ; .rept_y:
(2)  333/FFFFFFFFC00001C0 :                     ; 		cmp/ge	r12,r2
(2)  334/FFFFFFFFC00001C0 :                     ; 		bf	.ybgend
(2)  335/FFFFFFFFC00001C0 :                     ; 		mov	r11,r2
(2)  336/FFFFFFFFC00001C0 :                     ; 		mov	r11,r3
(2)  337/FFFFFFFFC00001C0 :                     ; 		mov.w	@(marsGbl_BgWidth,gbr),r0
(2)  338/FFFFFFFFC00001C0 :                     ; 		add	r0,r3
(2)  339/FFFFFFFFC00001C0 :                     ; .ybgend:
(2)  340/FFFFFFFFC00001C0 :                     ;
(2)  341/FFFFFFFFC00001C0 :                     ; 		mov	r2,r1		; r1 - bg pixel data
(2)  342/FFFFFFFFC00001C0 :                     ; 		mov	#-MSCRL_BLKSIZE,r7
(2)  343/FFFFFFFFC00001C0 :                     ; 		mov	#Cach_XHead_L,r0
(2)  344/FFFFFFFFC00001C0 :                     ; 		mov	@r0,r0
(2)  345/FFFFFFFFC00001C0 :                     ; 		and	r7,r0
(2)  346/FFFFFFFFC00001C0 :                     ; 		add	r0,r1
(2)  347/FFFFFFFFC00001C0 :                     ;
(2)  348/FFFFFFFFC00001C0 :                     ; 		mov	r5,r4		; r4 - X
(2)  349/FFFFFFFFC00001C0 :                     ; 		mov	r6,r0
(2)  350/FFFFFFFFC00001C0 :                     ; 		mov	#MSCRL_WIDTH,r7
(2)  351/FFFFFFFFC00001C0 :                     ; 		mulu	r7,r0
(2)  352/FFFFFFFFC00001C0 :                     ; 		sts	macl,r0
(2)  353/FFFFFFFFC00001C0 :                     ; ; 		shll8	r0
(2)  354/FFFFFFFFC00001C0 :                     ; ; 		shll	r0
(2)  355/FFFFFFFFC00001C0 :                     ; 		add	r0,r4		; X + Y
(2)  356/FFFFFFFFC00001C0 :                     ; 		mov	#(MSCRL_WIDTH)/4,r7
(2)  357/FFFFFFFFC00001C0 :                     ;
(2)  358/FFFFFFFFC00001C0 :                     ;
(2)  359/FFFFFFFFC00001C0 :                     ; .rept_x:
(2)  360/FFFFFFFFC00001C0 :                     ; 		mov	#(MSCRL_WIDTH*MSCRL_HEIGHT),r0
(2)  361/FFFFFFFFC00001C0 :                     ; 		cmp/ge	r0,r4
(2)  362/FFFFFFFFC00001C0 :                     ; 		bf	.res_x
(2)  363/FFFFFFFFC00001C0 :                     ; 		sub	r0,r4
(2)  364/FFFFFFFFC00001C0 :                     ; .res_x:
(2)  365/FFFFFFFFC00001C0 :                     ; 		cmp/ge	r3,r1
(2)  366/FFFFFFFFC00001C0 :                     ; 		bf	.xlon1
(2)  367/FFFFFFFFC00001C0 :                     ; 		mov	r2,r1
(2)  368/FFFFFFFFC00001C0 :                     ; .xlon1:
(2)  369/FFFFFFFFC00001C0 :                     ; 		mov	@r1+,r10
(2)  370/FFFFFFFFC00001C0 :                     ;
(2)  371/FFFFFFFFC00001C0 :                     ; 		mov	r4,r9
(2)  372/FFFFFFFFC00001C0 :                     ; 		mov	#_framebuffer+$200,r0
(2)  373/FFFFFFFFC00001C0 :                     ; 		add	r0,r9
(2)  374/FFFFFFFFC00001C0 :                     ; 		mov	#320,r0
(2)  375/FFFFFFFFC00001C0 :                     ; 		cmp/gt	r0,r4
(2)  376/FFFFFFFFC00001C0 :                     ; 		bt	.not_l2
(2)  377/FFFFFFFFC00001C0 :                     ; 		mov	#(_framebuffer+$200)+(MSCRL_WIDTH*MSCRL_HEIGHT),r0
(2)  378/FFFFFFFFC00001C0 :                     ; 		add	r4,r0
(2)  379/FFFFFFFFC00001C0 :                     ; 		mov	r10,@r0
(2)  380/FFFFFFFFC00001C0 :                     ; .not_l2:
(2)  381/FFFFFFFFC00001C0 :                     ; 		mov	r10,@r9
(2)  382/FFFFFFFFC00001C0 :                     ; 		dt	r7
(2)  383/FFFFFFFFC00001C0 :                     ; 		bf/s	.rept_x
(2)  384/FFFFFFFFC00001C0 :                     ; 		add	#4,r4
(2)  385/FFFFFFFFC00001C0 :                     ;
(2)  386/FFFFFFFFC00001C0 :                     ; 		mov.w	@(marsGbl_BgWidth,gbr),r0
(2)  387/FFFFFFFFC00001C0 :                     ; 		add	r0,r2
(2)  388/FFFFFFFFC00001C0 :                     ; 		add	r0,r3
(2)  389/FFFFFFFFC00001C0 :                     ; 	if MSCRL_HEIGHT=256
(2)  390/FFFFFFFFC00001C0 :                     ; 		mov	r6,r0
(2)  391/FFFFFFFFC00001C0 :                     ; 		add	#1,r0
(2)  392/FFFFFFFFC00001C0 :                     ; 		and	#$FF,r0
(2)  393/FFFFFFFFC00001C0 :                     ; 		mov	r0,r6
(2)  394/FFFFFFFFC00001C0 :                     ; 	else
(2)  395/FFFFFFFFC00001C0 :                     ; 		mov	#MSCRL_HEIGHT,r0
(2)  396/FFFFFFFFC00001C0 :                     ; 		add	#1,r6
(2)  397/FFFFFFFFC00001C0 :                     ; 		cmp/gt	r0,r6
(2)  398/FFFFFFFFC00001C0 :                     ; 		bf	.rdhlow
(2)  399/FFFFFFFFC00001C0 :                     ; 		sub	r0,r6
(2)  400/FFFFFFFFC00001C0 :                     ; .rdhlow:
(2)  401/FFFFFFFFC00001C0 :                     ; 	endif
(2)  402/FFFFFFFFC00001C0 :                     ; 		dt	r8
(2)  403/FFFFFFFFC00001C0 :                     ; 		bf	.rept_y
(2)  404/FFFFFFFFC00001C0 :                     ; drw_ud_exit:
(2)  405/FFFFFFFFC00001C0 : 000B                		rts
(2)  406/FFFFFFFFC00001C2 : 0009                		nop
(2)  407/FFFFFFFFC00001C4 :                     		align 4
(2)  408/FFFFFFFFC00001C4 : C000 0018 C000 051C 		ltorg
                    0001 5000 2401 5200 
                    2400 0200 C000 0510 
                    C000 0500 C000 051C 
                    C000 0510 C000 0504 
                    C000 0514 C000 0510 
                    C000 051C C000 0528 
                    0150 FE80 A518 5A10 
(2)  409/FFFFFFFFC0000204 :                     
(2)  410/FFFFFFFFC0000204 :                     ; ; --------------------------------
(2)  411/FFFFFFFFC0000204 :                     ; ; Task $03
(2)  412/FFFFFFFFC0000204 :                     ; ; --------------------------------
(2)  413/FFFFFFFFC0000204 :                     ;
(2)  414/FFFFFFFFC0000204 :                     ; drwtsk_03:
(2)  415/FFFFFFFFC0000204 :                     ; 		mov	r2,@-r15
(2)  416/FFFFFFFFC0000204 :                     ; 		mov.w	@(marsGbl_DrwPause,gbr),r0
(2)  417/FFFFFFFFC0000204 :                     ; 		cmp/eq	#1,r0
(2)  418/FFFFFFFFC0000204 :                     ; 		bt	.exit
(2)  419/FFFFFFFFC0000204 :                     ; 		mov	r3,@-r15
(2)  420/FFFFFFFFC0000204 :                     ; 		mov	r4,@-r15
(2)  421/FFFFFFFFC0000204 :                     ; 		mov	r5,@-r15
(2)  422/FFFFFFFFC0000204 :                     ; 		mov	r6,@-r15
(2)  423/FFFFFFFFC0000204 :                     ; 		mov	r7,@-r15
(2)  424/FFFFFFFFC0000204 :                     ; 		mov	r8,@-r15
(2)  425/FFFFFFFFC0000204 :                     ; 		mov	r9,@-r15
(2)  426/FFFFFFFFC0000204 :                     ; 		mov	r10,@-r15
(2)  427/FFFFFFFFC0000204 :                     ; 		mov	r11,@-r15
(2)  428/FFFFFFFFC0000204 :                     ; 		mov	r12,@-r15
(2)  429/FFFFFFFFC0000204 :                     ; 		mov	r13,@-r15
(2)  430/FFFFFFFFC0000204 :                     ; 		mov	r14,@-r15
(2)  431/FFFFFFFFC0000204 :                     ; 		sts	macl,@-r15
(2)  432/FFFFFFFFC0000204 :                     ; 		sts	mach,@-r15
(2)  433/FFFFFFFFC0000204 :                     ; 		mov	#Cach_LnDrw_L,r0
(2)  434/FFFFFFFFC0000204 :                     ; 		mov	@r0+,r14
(2)  435/FFFFFFFFC0000204 :                     ; 		mov	@r0+,r13
(2)  436/FFFFFFFFC0000204 :                     ; 		mov	@r0+,r12
(2)  437/FFFFFFFFC0000204 :                     ; 		mov	@r0+,r11
(2)  438/FFFFFFFFC0000204 :                     ; 		mov	@r0+,r10
(2)  439/FFFFFFFFC0000204 :                     ; 		mov	@r0+,r9
(2)  440/FFFFFFFFC0000204 :                     ; 		mov	@r0+,r8
(2)  441/FFFFFFFFC0000204 :                     ; 		mov	@r0+,r7
(2)  442/FFFFFFFFC0000204 :                     ; 		mov	@r0+,r6
(2)  443/FFFFFFFFC0000204 :                     ; 		mov	@r0+,r5
(2)  444/FFFFFFFFC0000204 :                     ; 		mov	@r0+,r4
(2)  445/FFFFFFFFC0000204 :                     ; 		mov	@r0+,r3
(2)  446/FFFFFFFFC0000204 :                     ; 		mov	@r0+,r2
(2)  447/FFFFFFFFC0000204 :                     ; 		mov	@r0+,r1
(2)  448/FFFFFFFFC0000204 :                     ; 		mov	#1,r0
(2)  449/FFFFFFFFC0000204 :                     ; 		mov.w	r0,@(marsGbl_DrwTask,gbr)
(2)  450/FFFFFFFFC0000204 :                     ; 		bra	drwsld_updline
(2)  451/FFFFFFFFC0000204 :                     ; 		nop
(2)  452/FFFFFFFFC0000204 :                     ; .exit:		bra	drwtask_exit
(2)  453/FFFFFFFFC0000204 :                     ; 		mov	#$10,r2
(2)  454/FFFFFFFFC0000204 :                     ; 		align 4
(2)  455/FFFFFFFFC0000204 :                     
(2)  456/FFFFFFFFC0000204 :                     ; --------------------------------
(2)  457/FFFFFFFFC0000204 :                     ; Task $02
(2)  458/FFFFFFFFC0000204 :                     ; --------------------------------
(2)  459/FFFFFFFFC0000204 :                     
(2)  460/FFFFFFFFC0000204 :                     drwtsk_02:
(2)  461/FFFFFFFFC0000204 : 2F26                		mov	r2,@-r15
(2)  462/FFFFFFFFC0000206 : C533                		mov.w	@(marsGbl_DrwPause,gbr),r0
(2)  463/FFFFFFFFC0000208 : 8801                		cmp/eq	#1,r0
(2)  464/FFFFFFFFC000020A : 8904                		bt	.exit
(2)  465/FFFFFFFFC000020C : C531                		mov.w	@(marsGbl_PzListCntr,gbr),r0	; Any pieces to draw?
(2)  466/FFFFFFFFC000020E : 4015                		cmp/pl	r0
(2)  467/FFFFFFFFC0000210 : 8903                		bt	.has_pz
(2)  468/FFFFFFFFC0000212 : E000                		mov	#0,r0
(2)  469/FFFFFFFFC0000214 : C132                		mov.w	r0,@(marsGbl_DrwTask,gbr)
(2)  470/FFFFFFFFC0000216 : A15A                .exit:		bra	drwtask_exit
(2)  471/FFFFFFFFC0000218 : E210                		mov	#$10,r2
(2)  472/FFFFFFFFC000021A :                     .has_pz:
(2)  473/FFFFFFFFC000021A : 2F36                		mov	r3,@-r15			; Save all these regs
(2)  474/FFFFFFFFC000021C : 2F46                		mov	r4,@-r15
(2)  475/FFFFFFFFC000021E : 2F56                		mov	r5,@-r15
(2)  476/FFFFFFFFC0000220 : 2F66                		mov	r6,@-r15
(2)  477/FFFFFFFFC0000222 : 2F76                		mov	r7,@-r15
(2)  478/FFFFFFFFC0000224 : 2F86                		mov	r8,@-r15
(2)  479/FFFFFFFFC0000226 : 2F96                		mov	r9,@-r15
(2)  480/FFFFFFFFC0000228 : 2FA6                		mov	r10,@-r15
(2)  481/FFFFFFFFC000022A : 2FB6                		mov	r11,@-r15
(2)  482/FFFFFFFFC000022C : 2FC6                		mov	r12,@-r15
(2)  483/FFFFFFFFC000022E : 2FD6                		mov	r13,@-r15
(2)  484/FFFFFFFFC0000230 : 2FE6                		mov	r14,@-r15
(2)  485/FFFFFFFFC0000232 : 4F12                		sts	macl,@-r15
(2)  486/FFFFFFFFC0000234 : 4F02                		sts	mach,@-r15
(2)  487/FFFFFFFFC0000236 :                     
(2)  488/FFFFFFFFC0000236 :                     ; Piece loop
(2)  489/FFFFFFFFC0000236 :                     drwtsk02_newpz:
(2)  490/FFFFFFFFC0000236 : C602                		mov	@(marsGbl_PlyPzList_R,gbr),r0	; r14 - Current pieces pointer to READ
(2)  491/FFFFFFFFC0000238 : 6E03                		mov	r0,r14
(2)  492/FFFFFFFFC000023A : 59E0                		mov	@(plypz_ypos,r14),r9		; Grab StartY/EndY positions
(2)  493/FFFFFFFFC000023C : 6A93                		mov	r9,r10
(2)  494/FFFFFFFFC000023E : D008                		mov	#$FFFF,r0
(2)  495/FFFFFFFFC0000240 : 4929                		shlr16	r9
(2)  496/FFFFFFFFC0000242 : 699F                		exts	r9,r9				;  r9 - Top
(2)  497/FFFFFFFFC0000244 : 2A09                		and	r0,r10				; r10 - Bottom
(2)  498/FFFFFFFFC0000246 : 3090                		cmp/eq	r9,r0				; if Top==Bottom, exit
(2)  499/FFFFFFFFC0000248 : 8908                		bt	.invld_y
(2)  500/FFFFFFFFC000024A : 900B                		mov	#SCREEN_HEIGHT,r0		; if Top > 224, exit
(2)  501/FFFFFFFFC000024C : 3903                		cmp/ge	r0,r9
(2)  502/FFFFFFFFC000024E : 8905                		bt	.invld_y			; if Bottom > 224, add limit
(2)  503/FFFFFFFFC0000250 : 3A07                		cmp/gt	r0,r10
(2)  504/FFFFFFFFC0000252 : 8B00                		bf	.len_max
(2)  505/FFFFFFFFC0000254 : 6A03                		mov	r0,r10
(2)  506/FFFFFFFFC0000256 :                     .len_max:
(2)  507/FFFFFFFFC0000256 : 3A98                		sub	r9,r10				; Turn r10 into line length (Bottom - Top)
(2)  508/FFFFFFFFC0000258 : 4A15                		cmp/pl	r10
(2)  509/FFFFFFFFC000025A : 8904                		bt	drwtsk1_vld_y
(2)  510/FFFFFFFFC000025C :                     .invld_y:
(2)  511/FFFFFFFFC000025C : A114                		bra	drwsld_nextpz			; if LEN < 0 then check next one instead.
(2)  512/FFFFFFFFC000025E : 0009                		nop
(2)  513/FFFFFFFFC0000260 :                     		align 4
(2)  514/FFFFFFFFC0000260 : 0000 FFFF 00E0      		ltorg
(2)  515/FFFFFFFFC0000266 :                     
(2)  516/FFFFFFFFC0000266 :                     ; ------------------------------------
(2)  517/FFFFFFFFC0000266 :                     ; If Y top / Y len are valid:
(2)  518/FFFFFFFFC0000266 :                     ; ------------------------------------
(2)  519/FFFFFFFFC0000266 :                     
(2)  520/FFFFFFFFC0000266 :                     drwtsk1_vld_y:
(2)  521/FFFFFFFFC0000266 : 51E1                		mov	@(plypz_xl,r14),r1		; r1 - X left
(2)  522/FFFFFFFFC0000268 : 52E2                		mov	@(plypz_xl_dx,r14),r2		; r2 - DX left
(2)  523/FFFFFFFFC000026A : 53E3                		mov	@(plypz_xr,r14),r3		; r3 - X right
(2)  524/FFFFFFFFC000026C : 54E4                		mov	@(plypz_xr_dx,r14),r4		; r4 - DX right
(2)  525/FFFFFFFFC000026E : 50EE                		mov	@(plypz_type,r14),r0		; Check material options
(2)  526/FFFFFFFFC0000270 : 4029                		shlr16	r0
(2)  527/FFFFFFFFC0000272 : 4019                		shlr8	r0
(2)  528/FFFFFFFFC0000274 : C880                 		tst	#PLGN_TEXURE,r0			; Texture-enable bit?
(2)  529/FFFFFFFFC0000276 : 8B05                 		bf	drwtsk_texmode
(2)  530/FFFFFFFFC0000278 : A0A6                		bra	drwtsk_solidmode
(2)  531/FFFFFFFFC000027A : 0009                		nop
(2)  532/FFFFFFFFC000027C :                     
(2)  533/FFFFFFFFC000027C :                     ; ------------------------------------
(2)  534/FFFFFFFFC000027C :                     ; Texture mode
(2)  535/FFFFFFFFC000027C :                     ;
(2)  536/FFFFFFFFC000027C :                     ; r1  - XL
(2)  537/FFFFFFFFC000027C :                     ; r2  - XL DX
(2)  538/FFFFFFFFC000027C :                     ; r3  - XR
(2)  539/FFFFFFFFC000027C :                     ; r4  - XR DX
(2)  540/FFFFFFFFC000027C :                     ; r5  - SRC XL
(2)  541/FFFFFFFFC000027C :                     ; r6  - SRC XR
(2)  542/FFFFFFFFC000027C :                     ; r7  - SRC YL
(2)  543/FFFFFFFFC000027C :                     ; r8  - SRC YR
(2)  544/FFFFFFFFC000027C :                     ; r9  - Y current
(2)  545/FFFFFFFFC000027C :                     ; r10  - Number of lines
(2)  546/FFFFFFFFC000027C :                     ; ------------------------------------
(2)  547/FFFFFFFFC000027C :                     
(2)  548/FFFFFFFFC000027C :                     go_drwsld_updline_tex:
(2)  549/FFFFFFFFC000027C : A088                		bra	drwsld_updline_tex
(2)  550/FFFFFFFFC000027E : 0009                		nop
(2)  551/FFFFFFFFC0000280 :                     
(2)  552/FFFFFFFFC0000280 :                     go_drwtex_gonxtpz:
(2)  553/FFFFFFFFC0000280 : A094                		bra	drwtex_gonxtpz
(2)  554/FFFFFFFFC0000282 : 0009                		nop
(2)  555/FFFFFFFFC0000284 :                     
(2)  556/FFFFFFFFC0000284 :                     drwtsk_texmode:
(2)  557/FFFFFFFFC0000284 : C536                		mov.w	@(marsGbl_DivStop_M,gbr),r0	; Waste interrupt if MarsVideo_MakePolygon is in the
(2)  558/FFFFFFFFC0000286 : 8801                		cmp/eq	#1,r0				; middle of HW-division
(2)  559/FFFFFFFFC0000288 : 8B02                		bf	.texvalid
(2)  560/FFFFFFFFC000028A : A112                		bra	drwtask_return
(2)  561/FFFFFFFFC000028C : 0009                		nop
(2)  562/FFFFFFFFC000028E :                     		align 4
(2)  563/FFFFFFFFC0000290 :                     .texvalid:
(2)  564/FFFFFFFFC0000290 : 55E5                		mov	@(plypz_src_xl,r14),r5		; Texture X left
(2)  565/FFFFFFFFC0000292 : 56E9                		mov	@(plypz_src_xr,r14),r6		; Texture X right
(2)  566/FFFFFFFFC0000294 : 57E7                		mov	@(plypz_src_yl,r14),r7		; Texture Y up
(2)  567/FFFFFFFFC0000296 : 58EB                		mov	@(plypz_src_yr,r14),r8		; Texture Y down
(2)  568/FFFFFFFFC0000298 :                     
(2)  569/FFFFFFFFC0000298 :                     drwsld_nxtline_tex:
(2)  570/FFFFFFFFC0000298 : 4911                		cmp/pz	r9				; Y Start below 0?
(2)  571/FFFFFFFFC000029A : 8BEF                		bf	go_drwsld_updline_tex
(2)  572/FFFFFFFFC000029C : 908E                		mov	#SCREEN_HEIGHT,r0		; Y Start after 224?
(2)  573/FFFFFFFFC000029E : 3903                		cmp/ge	r0,r9
(2)  574/FFFFFFFFC00002A0 : 89EE                		bt	go_drwtex_gonxtpz
(2)  575/FFFFFFFFC00002A2 : 2F16                		mov	r1,@-r15
(2)  576/FFFFFFFFC00002A4 : 2F26                		mov	r2,@-r15
(2)  577/FFFFFFFFC00002A6 : 2F46                		mov	r4,@-r15
(2)  578/FFFFFFFFC00002A8 : 2F56                		mov	r5,@-r15
(2)  579/FFFFFFFFC00002AA : 2F66                		mov	r6,@-r15
(2)  580/FFFFFFFFC00002AC : 2F76                		mov	r7,@-r15
(2)  581/FFFFFFFFC00002AE : 2F86                		mov	r8,@-r15
(2)  582/FFFFFFFFC00002B0 : 2F96                		mov	r9,@-r15
(2)  583/FFFFFFFFC00002B2 : 2FA6                		mov	r10,@-r15
(2)  584/FFFFFFFFC00002B4 : 2FD6                		mov	r13,@-r15
(2)  585/FFFFFFFFC00002B6 : 6B13                		mov	r1,r11			; r11 - X left copy
(2)  586/FFFFFFFFC00002B8 : 6C33                		mov	r3,r12			; r12 - X right copy
(2)  587/FFFFFFFFC00002BA : 4B29                		shlr16	r11
(2)  588/FFFFFFFFC00002BC : 4C29                		shlr16	r12
(2)  589/FFFFFFFFC00002BE : 6BBF                		exts	r11,r11
(2)  590/FFFFFFFFC00002C0 : 6CCF                		exts	r12,r12
(2)  591/FFFFFFFFC00002C2 : 60C3                		mov	r12,r0			; r0: X Right - X Left
(2)  592/FFFFFFFFC00002C4 : 30B8                		sub	r11,r0
(2)  593/FFFFFFFFC00002C6 : 4015                		cmp/pl	r0			; Line reversed?
(2)  594/FFFFFFFFC00002C8 : 8908                		bt	.txrevers
(2)  595/FFFFFFFFC00002CA : 60C3                		mov	r12,r0			; Swap XL and XR values
(2)  596/FFFFFFFFC00002CC : 6CB3                		mov	r11,r12
(2)  597/FFFFFFFFC00002CE : 6B03                		mov	r0,r11
(2)  598/FFFFFFFFC00002D0 : 6053                		mov	r5,r0
(2)  599/FFFFFFFFC00002D2 : 6563                		mov	r6,r5
(2)  600/FFFFFFFFC00002D4 : 6603                		mov	r0,r6
(2)  601/FFFFFFFFC00002D6 : 6073                		mov	r7,r0
(2)  602/FFFFFFFFC00002D8 : 6783                		mov	r8,r7
(2)  603/FFFFFFFFC00002DA : 6803                		mov	r0,r8
(2)  604/FFFFFFFFC00002DC :                     .txrevers:
(2)  605/FFFFFFFFC00002DC : 3CB0                		cmp/eq	r11,r12			; Same X position?
(2)  606/FFFFFFFFC00002DE : 894D                		bt	.tex_skip_line
(2)  607/FFFFFFFFC00002E0 : 906D                		mov	#SCREEN_WIDTH,r0	; X right < 0?
(2)  608/FFFFFFFFC00002E2 : 4C15                		cmp/pl	r12
(2)  609/FFFFFFFFC00002E4 : 8B4A                		bf	.tex_skip_line
(2)  610/FFFFFFFFC00002E6 : 3B07                		cmp/gt	r0,r11			; X left > 320?
(2)  611/FFFFFFFFC00002E8 : 8948                		bt	.tex_skip_line
(2)  612/FFFFFFFFC00002EA : 62C3                		mov	r12,r2
(2)  613/FFFFFFFFC00002EC : 60B3                		mov 	r11,r0
(2)  614/FFFFFFFFC00002EE : 3208                		sub 	r0,r2
(2)  615/FFFFFFFFC00002F0 : 3658                		sub	r5,r6
(2)  616/FFFFFFFFC00002F2 : 3878                		sub	r7,r8
(2)  617/FFFFFFFFC00002F4 :                     
(2)  618/FFFFFFFFC00002F4 :                     	; Calculate new DX values
(2)  619/FFFFFFFFC00002F4 :                     	; make sure DIV is available
(2)  620/FFFFFFFFC00002F4 :                     	; (marsGbl_DivStop_M == 0)
(2)  621/FFFFFFFFC00002F4 : 9064                		mov	#_JR,r0		; r6 / r2
(2)  622/FFFFFFFFC00002F6 : 2022                		mov	r2,@r0
(2)  623/FFFFFFFFC00002F8 : 1061                		mov	r6,@(4,r0)
(2)  624/FFFFFFFFC00002FA : 0009                		nop
(2)  625/FFFFFFFFC00002FC : 5601                		mov	@(4,r0),r6		; r8 / r2
(2)  626/FFFFFFFFC00002FE : 2022                		mov	r2,@r0
(2)  627/FFFFFFFFC0000300 : 1081                		mov	r8,@(4,r0)
(2)  628/FFFFFFFFC0000302 : 0009                		nop
(2)  629/FFFFFFFFC0000304 : 5801                		mov	@(4,r0),r8
(2)  630/FFFFFFFFC0000306 :                     
(2)  631/FFFFFFFFC0000306 :                     	; Limit X destination points
(2)  632/FFFFFFFFC0000306 :                     	; and correct the texture's X positions
(2)  633/FFFFFFFFC0000306 : 905A                		mov	#SCREEN_WIDTH,r0		; XR point > 320?
(2)  634/FFFFFFFFC0000308 : 3C07                		cmp/gt	r0,r12
(2)  635/FFFFFFFFC000030A : 8B00                		bf	.tr_fix
(2)  636/FFFFFFFFC000030C : 6C03                		mov	r0,r12			; Force XR to 320
(2)  637/FFFFFFFFC000030E :                     .tr_fix:
(2)  638/FFFFFFFFC000030E : 4B15                		cmp/pl	r11			; XL point < 0?
(2)  639/FFFFFFFFC0000310 : 8907                		bt	.tl_fix
(2)  640/FFFFFFFFC0000312 : 62BB                		neg	r11,r2			; Fix texture positions
(2)  641/FFFFFFFFC0000314 : 326D                		dmuls	r6,r2
(2)  642/FFFFFFFFC0000316 : 001A                		sts	macl,r0
(2)  643/FFFFFFFFC0000318 : 350C                		add	r0,r5
(2)  644/FFFFFFFFC000031A : 328D                		dmuls	r8,r2
(2)  645/FFFFFFFFC000031C : 001A                		sts	macl,r0
(2)  646/FFFFFFFFC000031E : 370C                		add	r0,r7
(2)  647/FFFFFFFFC0000320 : 2BBA                		xor	r11,r11			; And reset XL to 0
(2)  648/FFFFFFFFC0000322 :                     .tl_fix:
(2)  649/FFFFFFFFC0000322 : E0FE                		mov	#-2,r0
(2)  650/FFFFFFFFC0000324 : 2B09                		and	r0,r11
(2)  651/FFFFFFFFC0000326 : 2C09                		and	r0,r12
(2)  652/FFFFFFFFC0000328 :                     
(2)  653/FFFFFFFFC0000328 :                     	; X right - X left
(2)  654/FFFFFFFFC0000328 : 3CB8                		sub 	r11,r12
(2)  655/FFFFFFFFC000032A :                     ; 		shar	r12
(2)  656/FFFFFFFFC000032A :                     ; 		shar	r12
(2)  657/FFFFFFFFC000032A : 4C15                		cmp/pl	r12
(2)  658/FFFFFFFFC000032C : 8B26                		bf	.tex_skip_line
(2)  659/FFFFFFFFC000032E :                     ; 		mov	#$20,r0			; (Limiter test)
(2)  660/FFFFFFFFC000032E :                     ; 		cmp/ge	r0,r12
(2)  661/FFFFFFFFC000032E :                     ; 		bf	.testlwrit
(2)  662/FFFFFFFFC000032E :                     ; 		mov	r0,r12
(2)  663/FFFFFFFFC000032E :                     ; .testlwrit:
(2)  664/FFFFFFFFC000032E :                     
(2)  665/FFFFFFFFC000032E :                     	; TODO: a check for the hidden line
(2)  666/FFFFFFFFC000032E : DA20                		mov	#RAM_Mars_Linescroll,r10
(2)  671/FFFFFFFFC0000330 : 9047                		mov	#MSCRL_WIDTH,r0
(2)  672/FFFFFFFFC0000332 : 209F                		muls	r9,r0
(2)  673/FFFFFFFFC0000334 : 091A                		sts	macl,r9
(2)  675/FFFFFFFFC0000336 : 6AA2                		mov	@r10,r10
(2)  676/FFFFFFFFC0000338 : 3A9C                		add	r9,r10
(2)  677/FFFFFFFFC000033A : 3ABC                		add 	r11,r10				; Add X
(2)  678/FFFFFFFFC000033C : D01D                		mov	#(MSCRL_WIDTH*MSCRL_HEIGHT),r0
(2)  679/FFFFFFFFC000033E : 3A03                		cmp/ge	r0,r10
(2)  680/FFFFFFFFC0000340 : 8B00                		bf	.xl_r
(2)  681/FFFFFFFFC0000342 : 3A08                		sub	r0,r10
(2)  682/FFFFFFFFC0000344 :                     .xl_r:
(2)  683/FFFFFFFFC0000344 : 4A11                		cmp/pz	r10
(2)  684/FFFFFFFFC0000346 : 8900                		bt	.xl_l
(2)  685/FFFFFFFFC0000348 : 3A0C                		add	r0,r10
(2)  686/FFFFFFFFC000034A :                     .xl_l:
(2)  687/FFFFFFFFC000034A :                     
(2)  688/FFFFFFFFC000034A :                     
(2)  689/FFFFFFFFC000034A : D01B                		mov	#_overwrite+$200,r0
(2)  690/FFFFFFFFC000034C : 3A0C                		add	r0,r10
(2)  691/FFFFFFFFC000034E : 9239                		mov	#$1FFF,r2
(2)  692/FFFFFFFFC0000350 : 9039                		mov	#$FF,r0
(2)  693/FFFFFFFFC0000352 : 5BED                		mov	@(plypz_mtrl,r14),r11		; r11 - texture data
(2)  694/FFFFFFFFC0000354 : 54EE                		mov	@(plypz_type,r14),r4		;  r4 - texture palinc|width
(2)  695/FFFFFFFFC0000356 : 6D43                		mov	r4,r13
(2)  696/FFFFFFFFC0000358 : 4D29                		shlr16	r13
(2)  697/FFFFFFFFC000035A :                     ; 		and	r2,r4
(2)  698/FFFFFFFFC000035A : 2D09                		and	r0,r13
(2)  699/FFFFFFFFC000035C :                     
(2)  700/FFFFFFFFC000035C :                     	; r5 - X curr
(2)  701/FFFFFFFFC000035C :                     	; r6 - X inc
(2)  702/FFFFFFFFC000035C :                     	; r7 - Y Curr
(2)  703/FFFFFFFFC000035C :                     	; r8 - Y add
(2)  704/FFFFFFFFC000035C :                     .tex_xloop:
(2)  705/FFFFFFFFC000035C : 6273                		mov	r7,r2
(2)  706/FFFFFFFFC000035E : 4229                		shlr16	r2
(2)  707/FFFFFFFFC0000360 : 242F                		muls	r2,r4
(2)  708/FFFFFFFFC0000362 : 6253                		mov	r5,r2	   			; Build column index
(2)  709/FFFFFFFFC0000364 : 356C                		add	r6,r5				; Update X
(2)  710/FFFFFFFFC0000366 : 378C                		add	r8,r7				; Update Y
(2)  711/FFFFFFFFC0000368 : 001A                		sts	macl,r0
(2)  712/FFFFFFFFC000036A : 4229                		shlr16	r2
(2)  713/FFFFFFFFC000036C : 302C                		add	r2,r0
(2)  714/FFFFFFFFC000036E : 00BC                		mov.b	@(r0,r11),r0			; Read pixel
(2)  715/FFFFFFFFC0000370 : 30DC                		add	r13,r0
(2)  716/FFFFFFFFC0000372 : C9FF                		and	#$FF,r0
(2)  717/FFFFFFFFC0000374 : 2A00                		mov.b	r0,@r10	   			; Write pixels
(2)  718/FFFFFFFFC0000376 : 7A01                		add 	#1,r10
(2)  719/FFFFFFFFC0000378 : 4C10                		dt	r12
(2)  720/FFFFFFFFC000037A : 8BEF                		bf	.tex_xloop
(2)  721/FFFFFFFFC000037C :                     
(2)  722/FFFFFFFFC000037C :                     .tex_skip_line:
(2)  723/FFFFFFFFC000037C : 6DF6                		mov	@r15+,r13
(2)  724/FFFFFFFFC000037E : 6AF6                		mov	@r15+,r10
(2)  725/FFFFFFFFC0000380 : 69F6                		mov	@r15+,r9
(2)  726/FFFFFFFFC0000382 : 68F6                		mov	@r15+,r8
(2)  727/FFFFFFFFC0000384 : 67F6                		mov	@r15+,r7
(2)  728/FFFFFFFFC0000386 : 66F6                		mov	@r15+,r6
(2)  729/FFFFFFFFC0000388 : 65F6                		mov	@r15+,r5
(2)  730/FFFFFFFFC000038A : 64F6                		mov	@r15+,r4
(2)  731/FFFFFFFFC000038C : 62F6                		mov	@r15+,r2
(2)  732/FFFFFFFFC000038E : 61F6                		mov	@r15+,r1
(2)  733/FFFFFFFFC0000390 :                     drwsld_updline_tex:
(2)  734/FFFFFFFFC0000390 : 50E6                		mov	@(plypz_src_xl_dx,r14),r0	; Update DX postions
(2)  735/FFFFFFFFC0000392 : 350C                		add	r0,r5
(2)  736/FFFFFFFFC0000394 : 50EA                		mov	@(plypz_src_xr_dx,r14),r0
(2)  737/FFFFFFFFC0000396 : 360C                		add	r0,r6
(2)  738/FFFFFFFFC0000398 : 50E8                		mov	@(plypz_src_yl_dx,r14),r0
(2)  739/FFFFFFFFC000039A : 370C                		add	r0,r7
(2)  740/FFFFFFFFC000039C : 50EC                		mov	@(plypz_src_yr_dx,r14),r0
(2)  741/FFFFFFFFC000039E : 380C                		add	r0,r8
(2)  742/FFFFFFFFC00003A0 : 312C                		add	r2,r1				; Update X postions
(2)  743/FFFFFFFFC00003A2 : 4A10                		dt	r10
(2)  744/FFFFFFFFC00003A4 : 8D02                		bt/s	drwtex_gonxtpz
(2)  745/FFFFFFFFC00003A6 : 334C                		add	r4,r3
(2)  746/FFFFFFFFC00003A8 : AF76                		bra	drwsld_nxtline_tex
(2)  747/FFFFFFFFC00003AA : 7901                		add	#1,r9
(2)  748/FFFFFFFFC00003AC :                     drwtex_gonxtpz:
(2)  749/FFFFFFFFC00003AC : A06C                		bra	drwsld_nextpz			; if LEN < 0 then check next one instead.
(2)  750/FFFFFFFFC00003AE : 0009                		nop
(2)  751/FFFFFFFFC00003B0 :                     		align 4
(2)  752/FFFFFFFFC00003B0 : 0600 447C 0001 5000 		ltorg
                    2402 0200 00E0 0140 
                    FF00 0150 1FFF 00FF 
(2)  753/FFFFFFFFC00003C8 :                     
(2)  754/FFFFFFFFC00003C8 :                     ; ------------------------------------
(2)  755/FFFFFFFFC00003C8 :                     ; Solid Color
(2)  756/FFFFFFFFC00003C8 :                     ;
(2)  757/FFFFFFFFC00003C8 :                     ; r1  - XL
(2)  758/FFFFFFFFC00003C8 :                     ; r2  - XL DX
(2)  759/FFFFFFFFC00003C8 :                     ; r3  - XR
(2)  760/FFFFFFFFC00003C8 :                     ; r4  - XR DX
(2)  761/FFFFFFFFC00003C8 :                     ; r9  - Y current
(2)  762/FFFFFFFFC00003C8 :                     ; r10  - Number of lines
(2)  763/FFFFFFFFC00003C8 :                     ; ------------------------------------
(2)  764/FFFFFFFFC00003C8 :                     
(2)  765/FFFFFFFFC00003C8 :                     ; BUG: Not working anymore because
(2)  766/FFFFFFFFC00003C8 :                     ; of the scrolling system.
(2)  767/FFFFFFFFC00003C8 :                     
(2)  768/FFFFFFFFC00003C8 :                     drwtsk_solidmode:
(2)  769/FFFFFFFFC00003C8 : 9094                		mov	#$FF,r0
(2)  770/FFFFFFFFC00003CA : 56ED                		mov	@(plypz_mtrl,r14),r6
(2)  771/FFFFFFFFC00003CC : 55EE                		mov	@(plypz_type,r14),r5
(2)  772/FFFFFFFFC00003CE : 2509                		and	r0,r5
(2)  773/FFFFFFFFC00003D0 : 2609                		and	r0,r6
(2)  774/FFFFFFFFC00003D2 : 365C                		add	r5,r6
(2)  775/FFFFFFFFC00003D4 : DD43                		mov	#_vdpreg,r13
(2)  776/FFFFFFFFC00003D6 : 85D5                .wait:		mov.w	@(10,r13),r0
(2)  777/FFFFFFFFC00003D8 : C802                		tst	#2,r0
(2)  778/FFFFFFFFC00003DA : 8BFC                		bf	.wait
(2)  779/FFFFFFFFC00003DC :                     drwsld_nxtline:
(2)  780/FFFFFFFFC00003DC : 6093                		mov	r9,r0
(2)  781/FFFFFFFFC00003DE : 30AC                		add	r10,r0
(2)  782/FFFFFFFFC00003E0 : 4015                		cmp/pl	r0
(2)  783/FFFFFFFFC00003E2 : 8B51                		bf	drwsld_nextpz
(2)  784/FFFFFFFFC00003E4 : 4911                		cmp/pz	r9
(2)  785/FFFFFFFFC00003E6 : 8B4A                		bf	drwsld_updline
(2)  786/FFFFFFFFC00003E8 : 9085                		mov	#SCREEN_HEIGHT,r0
(2)  787/FFFFFFFFC00003EA : 3907                		cmp/gt	r0,r9
(2)  788/FFFFFFFFC00003EC : 894C                		bt	drwsld_nextpz
(2)  789/FFFFFFFFC00003EE :                     
(2)  790/FFFFFFFFC00003EE : 6B13                		mov	r1,r11
(2)  791/FFFFFFFFC00003F0 : 6C33                		mov	r3,r12
(2)  792/FFFFFFFFC00003F2 : 4B29                		shlr16	r11
(2)  793/FFFFFFFFC00003F4 : 4C29                		shlr16	r12
(2)  794/FFFFFFFFC00003F6 : 6BBF                		exts	r11,r11
(2)  795/FFFFFFFFC00003F8 : 6CCF                		exts	r12,r12
(2)  796/FFFFFFFFC00003FA : 60C3                		mov	r12,r0
(2)  797/FFFFFFFFC00003FC : 30B8                		sub	r11,r0
(2)  798/FFFFFFFFC00003FE : 4011                		cmp/pz	r0
(2)  799/FFFFFFFFC0000400 : 8902                		bt	.revers
(2)  800/FFFFFFFFC0000402 : 60C3                		mov	r12,r0
(2)  801/FFFFFFFFC0000404 : 6CB3                		mov	r11,r12
(2)  802/FFFFFFFFC0000406 : 6B03                		mov	r0,r11
(2)  803/FFFFFFFFC0000408 :                     .revers:
(2)  804/FFFFFFFFC0000408 : 9076                		mov	#SCREEN_WIDTH-2,r0
(2)  805/FFFFFFFFC000040A : 4C15                		cmp/pl	r12
(2)  806/FFFFFFFFC000040C : 8B37                		bf	drwsld_updline
(2)  807/FFFFFFFFC000040E : 3B07                		cmp/gt	r0,r11
(2)  808/FFFFFFFFC0000410 : 8935                		bt	drwsld_updline
(2)  809/FFFFFFFFC0000412 : 3C07                		cmp/gt	r0,r12
(2)  810/FFFFFFFFC0000414 : 8B00                		bf	.r_fix
(2)  811/FFFFFFFFC0000416 : 6C03                		mov	r0,r12
(2)  812/FFFFFFFFC0000418 :                     .r_fix:
(2)  813/FFFFFFFFC0000418 : 4B15                		cmp/pl	r11
(2)  814/FFFFFFFFC000041A : 8900                		bt	.l_fix
(2)  815/FFFFFFFFC000041C : 2BBA                		xor	r11,r11
(2)  816/FFFFFFFFC000041E :                     .l_fix:
(2)  817/FFFFFFFFC000041E : E0FE                		mov	#-2,r0
(2)  818/FFFFFFFFC0000420 : 2B09                		and	r0,r11
(2)  819/FFFFFFFFC0000422 : 2C09                		and	r0,r12
(2)  820/FFFFFFFFC0000424 : 60C3                		mov	r12,r0
(2)  821/FFFFFFFFC0000426 : 30B8                		sub	r11,r0
(2)  822/FFFFFFFFC0000428 : 4015                		cmp/pl	r0
(2)  823/FFFFFFFFC000042A : 8B28                		bf	drwsld_updline
(2)  824/FFFFFFFFC000042C : 85D5                .wait:		mov.w	@(10,r13),r0
(2)  825/FFFFFFFFC000042E : C802                		tst	#2,r0
(2)  826/FFFFFFFFC0000430 : 8BFC                		bf	.wait
(2)  827/FFFFFFFFC0000432 : 60C3                		mov	r12,r0
(2)  828/FFFFFFFFC0000434 : 30B8                		sub	r11,r0
(2)  829/FFFFFFFFC0000436 : 6C03                		mov	r0,r12
(2)  830/FFFFFFFFC0000438 : 4001                		shlr	r0
(2)  831/FFFFFFFFC000043A : 81D2                		mov.w	r0,@(4,r13)	; length
(2)  832/FFFFFFFFC000043C : 60B3                		mov	r11,r0
(2)  833/FFFFFFFFC000043E : 4001                		shlr	r0
(2)  834/FFFFFFFFC0000440 : 6593                		mov	r9,r5
(2)  835/FFFFFFFFC0000442 : 7501                		add	#1,r5
(2)  836/FFFFFFFFC0000444 : 4518                		shll8	r5
(2)  837/FFFFFFFFC0000446 : 305C                		add	r5,r0
(2)  838/FFFFFFFFC0000448 : 81D3                		mov.w	r0,@(6,r13)	; address
(2)  839/FFFFFFFFC000044A : 6063                		mov	r6,r0
(2)  840/FFFFFFFFC000044C : 4018                		shll8	r0
(2)  841/FFFFFFFFC000044E : 206B                		or	r6,r0
(2)  842/FFFFFFFFC0000450 : 81D4                		mov.w	r0,@(8,r13)	; Set data
(2)  843/FFFFFFFFC0000452 :                     ; .wait:		mov.w	@(10,r13),r0
(2)  844/FFFFFFFFC0000452 :                     ; 		tst	#2,r0
(2)  845/FFFFFFFFC0000452 :                     ; 		bf	.wait
(2)  846/FFFFFFFFC0000452 :                     
(2)  847/FFFFFFFFC0000452 :                     ; 	If the line is too large, leave it to VDP
(2)  848/FFFFFFFFC0000452 :                     ; 	and exit watchdog, we will come back on
(2)  849/FFFFFFFFC0000452 :                     ; 	next trigger.
(2)  850/FFFFFFFFC0000452 : E028                		mov	#$28,r0
(2)  851/FFFFFFFFC0000454 : 3C07                		cmp/gt	r0,r12
(2)  852/FFFFFFFFC0000456 : 8B12                		bf	drwsld_updline
(2)  853/FFFFFFFFC0000458 : E003                		mov	#3,r0
(2)  854/FFFFFFFFC000045A : C132                		mov.w	r0,@(marsGbl_DrwTask,gbr)
(2)  855/FFFFFFFFC000045C : D022                		mov	#Cach_LnDrw_S,r0
(2)  856/FFFFFFFFC000045E : 2016                		mov	r1,@-r0
(2)  857/FFFFFFFFC0000460 : 2026                		mov	r2,@-r0
(2)  858/FFFFFFFFC0000462 : 2036                		mov	r3,@-r0
(2)  859/FFFFFFFFC0000464 : 2046                		mov	r4,@-r0
(2)  860/FFFFFFFFC0000466 : 2056                		mov	r5,@-r0
(2)  861/FFFFFFFFC0000468 : 2066                		mov	r6,@-r0
(2)  862/FFFFFFFFC000046A : 2076                		mov	r7,@-r0
(2)  863/FFFFFFFFC000046C : 2086                		mov	r8,@-r0
(2)  864/FFFFFFFFC000046E : 2096                		mov	r9,@-r0
(2)  865/FFFFFFFFC0000470 : 20A6                		mov	r10,@-r0
(2)  866/FFFFFFFFC0000472 : 20B6                		mov	r11,@-r0
(2)  867/FFFFFFFFC0000474 : 20C6                		mov	r12,@-r0
(2)  868/FFFFFFFFC0000476 : 20D6                		mov	r13,@-r0
(2)  869/FFFFFFFFC0000478 : 20E6                		mov	r14,@-r0
(2)  870/FFFFFFFFC000047A : A01A                		bra	drwtask_return
(2)  871/FFFFFFFFC000047C : E210                		mov	#$10,r2			; Exit and re-enter
(2)  872/FFFFFFFFC000047E :                     drwsld_updline:
(2)  873/FFFFFFFFC000047E : 312C                		add	r2,r1
(2)  874/FFFFFFFFC0000480 : 334C                		add	r4,r3
(2)  875/FFFFFFFFC0000482 : 4A10                		dt	r10
(2)  876/FFFFFFFFC0000484 : 8FAA                		bf/s	drwsld_nxtline
(2)  877/FFFFFFFFC0000486 : 7901                		add	#1,r9
(2)  878/FFFFFFFFC0000488 :                     
(2)  879/FFFFFFFFC0000488 :                     ; ------------------------------------
(2)  880/FFFFFFFFC0000488 :                     
(2)  881/FFFFFFFFC0000488 :                     drwsld_nextpz:
(2)  882/FFFFFFFFC0000488 : 7E3C                		add	#sizeof_plypz,r14		; And set new point
(2)  883/FFFFFFFFC000048A : 60E3                		mov	r14,r0
(2)  884/FFFFFFFFC000048C : DE17                		mov	#RAM_Mars_VdpDrwList_e,r14	; End-of-list?
(2)  885/FFFFFFFFC000048E : 30E3                		cmp/ge	r14,r0
(2)  886/FFFFFFFFC0000490 : 8B00                		bf	.reset_rd
(2)  887/FFFFFFFFC0000492 : D017                		mov	#RAM_Mars_VdpDrwList,r0
(2)  888/FFFFFFFFC0000494 :                     .reset_rd:
(2)  889/FFFFFFFFC0000494 : C202                		mov	r0,@(marsGbl_PlyPzList_R,gbr)
(2)  890/FFFFFFFFC0000496 : C531                		mov.w	@(marsGbl_PzListCntr,gbr),r0	; Decrement piece
(2)  891/FFFFFFFFC0000498 : 70FF                		add	#-1,r0
(2)  892/FFFFFFFFC000049A : C131                		mov.w	r0,@(marsGbl_PzListCntr,gbr)
(2)  893/FFFFFFFFC000049C : 4015                		cmp/pl	r0
(2)  894/FFFFFFFFC000049E : 8901                		bt	.activ
(2)  895/FFFFFFFFC00004A0 :                     ; 		bf	.finish_it
(2)  896/FFFFFFFFC00004A0 :                     ; 		bra	drwtsk02_newpz2
(2)  897/FFFFFFFFC00004A0 :                     ; 		nop
(2)  898/FFFFFFFFC00004A0 :                     .finish_it:
(2)  899/FFFFFFFFC00004A0 : E000                		mov	#0,r0
(2)  900/FFFFFFFFC00004A2 : C132                		mov.w	r0,@(marsGbl_DrwTask,gbr)
(2)  901/FFFFFFFFC00004A4 :                     .activ:
(2)  902/FFFFFFFFC00004A4 : A005                		bra	drwtask_return
(2)  903/FFFFFFFFC00004A6 : E210                		mov	#$10,r2			; Timer for next watchdog
(2)  904/FFFFFFFFC00004A8 :                     
(2)  905/FFFFFFFFC00004A8 :                     ; --------------------------------
(2)  906/FFFFFFFFC00004A8 :                     ; Task $00
(2)  907/FFFFFFFFC00004A8 :                     ; --------------------------------
(2)  908/FFFFFFFFC00004A8 :                     
(2)  909/FFFFFFFFC00004A8 :                     drwtsk_00:
(2)  910/FFFFFFFFC00004A8 : 2F26                		mov	r2,@-r15
(2)  911/FFFFFFFFC00004AA : E000                		mov	#0,r0
(2)  912/FFFFFFFFC00004AC : C132                		mov.w	r0,@(marsGbl_DrwTask,gbr)
(2)  913/FFFFFFFFC00004AE : A00E                		bra	drwtask_exit
(2)  914/FFFFFFFFC00004B0 : E210                		mov	#$10,r2
(2)  915/FFFFFFFFC00004B2 :                     
(2)  916/FFFFFFFFC00004B2 :                     ; --------------------------------
(2)  917/FFFFFFFFC00004B2 :                     
(2)  918/FFFFFFFFC00004B2 :                     drwtask_return:
(2)  919/FFFFFFFFC00004B2 : 4F06                		lds	@r15+,mach
(2)  920/FFFFFFFFC00004B4 : 4F16                		lds	@r15+,macl
(2)  921/FFFFFFFFC00004B6 : 6EF6                		mov	@r15+,r14
(2)  922/FFFFFFFFC00004B8 : 6DF6                		mov	@r15+,r13
(2)  923/FFFFFFFFC00004BA : 6CF6                		mov	@r15+,r12
(2)  924/FFFFFFFFC00004BC : 6BF6                		mov	@r15+,r11
(2)  925/FFFFFFFFC00004BE : 6AF6                		mov	@r15+,r10
(2)  926/FFFFFFFFC00004C0 : 69F6                		mov	@r15+,r9
(2)  927/FFFFFFFFC00004C2 : 68F6                		mov	@r15+,r8
(2)  928/FFFFFFFFC00004C4 : 67F6                		mov	@r15+,r7
(2)  929/FFFFFFFFC00004C6 : 66F6                		mov	@r15+,r6
(2)  930/FFFFFFFFC00004C8 : 65F6                		mov	@r15+,r5
(2)  931/FFFFFFFFC00004CA : 64F6                		mov	@r15+,r4
(2)  932/FFFFFFFFC00004CC : 63F6                		mov	@r15+,r3
(2)  933/FFFFFFFFC00004CE :                     drwtask_exit:
(2)  934/FFFFFFFFC00004CE : 9114                		mov.l   #$FFFFFE80,r1
(2)  935/FFFFFFFFC00004D0 : 9014                		mov.w   #$A518,r0	; OFF
(2)  936/FFFFFFFFC00004D2 : 2101                		mov.w   r0,@r1
(2)  937/FFFFFFFFC00004D4 : CB20                		or      #$20,r0		; ON
(2)  938/FFFFFFFFC00004D6 : 2101                		mov.w   r0,@r1
(2)  939/FFFFFFFFC00004D8 : 9011                		mov.w   #$5A00,r0	; r2 - Timer
(2)  940/FFFFFFFFC00004DA : 202B                		or	r2,r0
(2)  941/FFFFFFFFC00004DC : 2101                		mov.w   r0,@r1
(2)  942/FFFFFFFFC00004DE : 62F6                		mov	@r15+,r2
(2)  943/FFFFFFFFC00004E0 : 000B                		rts
(2)  944/FFFFFFFFC00004E2 : 0009                		nop
(2)  945/FFFFFFFFC00004E4 :                     		align 4
(2)  946/FFFFFFFFC00004E4 : 2000 4100 C000 05C8 		ltorg
                    0600 9F84 0600 7284 
                    00FF 00E0 013E FE80 
                    A518 5A00           
(2)  947/FFFFFFFFC0000500 :                     
(2)  948/FFFFFFFFC0000500 :                     ; ------------------------------------------------
(2)  949/FFFFFFFFC0000500 :                     
(2)  950/FFFFFFFFC0000500 :                     		align 4
(2)  951/FFFFFFFFC0000500 :                     Cach_XHead_L	ds.l 1			; Left draw beam
(2)  952/FFFFFFFFC0000504 :                     Cach_XHead_R	ds.l 1			; Right draw beam
(2)  953/FFFFFFFFC0000508 :                     Cach_YHead_D	ds.l 1			; Bottom draw beam
(2)  954/FFFFFFFFC000050C :                     Cach_YHead_U	ds.l 1			; Top draw beam
(2)  955/FFFFFFFFC0000510 :                     Cach_YHead_LR	ds.l 1			; (L/R) Top Y position (updates)
(2)  956/FFFFFFFFC0000514 :                     Cach_YRead_LR	ds.l 1			; (L/R) Current Y (updates)
(2)  957/FFFFFFFFC0000518 :                     Cach_XHead_UD	ds.l 1
(2)  958/FFFFFFFFC000051C :                     Cach_BgFbPosLR	ds.l 1			; (L/R) Current Y FB position (updates)
(2)  959/FFFFFFFFC0000520 :                     Cach_BgFbPos_U	ds.l 1			; (U/D) Upper Y FB pos
(2)  960/FFFFFFFFC0000524 :                     Cach_BgFbPos_D	ds.l 1			; (U/D) Lower Y FB pos
(2)  961/FFFFFFFFC0000528 :                     
(2)  962/FFFFFFFFC0000528 :                     Cach_LR_Lines	ds.l 1			; (L/R) X Lines to process
(2)  963/FFFFFFFFC000052C :                     Cach_UD_Lines	ds.l 1			; (U/D) Y Lines to process
(2)  964/FFFFFFFFC0000530 :                     
(2)  965/FFFFFFFFC0000530 :                     Cach_DDA_Top	ds.l 2*2		; First 2 points
(2)  966/FFFFFFFFC0000540 :                     Cach_DDA_Last	ds.l 2*2		; Triangle or Quad (+8)
(2)  967/FFFFFFFFC0000550 :                     Cach_DDA_Src	ds.l 4*2
(2)  968/FFFFFFFFC0000570 :                     Cach_DDA_Src_L	ds.l 4			; X/DX/Y/DX positions for textures
(2)  969/FFFFFFFFC0000580 :                     Cach_DDA_Src_R	ds.l 4
(2)  970/FFFFFFFFC0000590 :                     Cach_LnDrw_L	ds.l 14			; Own stack: Read foward (-->)
(2)  971/FFFFFFFFC00005C8 :                     Cach_LnDrw_S	ds.l 0			; Read this backwards (<--)
(2)  972/FFFFFFFFC00005C8 :                     
(2)  973/FFFFFFFFC00005C8 :                     ; ------------------------------------------------
(2)  974/ 6001B60 :                     .end:		phase CACHE_MASTER+.end&$1FFF
(2)  975/ 6001B60 :                     CACHE_MASTER_E:
(2)  976/ 6001B60 :                     		align 4
(2)  980/ 6001B60 :                     
(2)  981/ 6001B60 :                     ; ====================================================================
(2)  982/ 6001B60 :                     ; ----------------------------------------------------------------
(2)  983/ 6001B60 :                     ; CACHE code for Slave CPU
(2)  984/ 6001B60 :                     ;
(2)  985/ 6001B60 :                     ; LIMIT: $800 bytes
(2)  986/ 6001B60 :                     ; ----------------------------------------------------------------
(2)  987/ 6001B60 :                     
(2)  988/ 6001B60 :                     		align 4
(2)  989/ 6001B60 :                     CACHE_SLAVE:
(2)  990/FFFFFFFFC0000000 :                     		phase $C0000000
(2)  991/FFFFFFFFC0000000 :                     ; ------------------------------------------------
(2)  992/FFFFFFFFC0000000 :                     
(2)  993/FFFFFFFFC0000000 :                     	; code goes here...
(2)  994/FFFFFFFFC0000000 :                     
(2)  995/FFFFFFFFC0000000 :                     ; ------------------------------------------------
(2)  996/FFFFFFFFC0000000 :                     		align 4
(2)  997/FFFFFFFFC0000000 :                     Cach_CurrPlygn	ds.b sizeof_polygn	; Current polygon in modelread
(2)  998/FFFFFFFFC0000028 : 0000 0000           Cach_TestTimer	dc.l 0
(2)  999/FFFFFFFFC000002C :                     
(2) 1000/FFFFFFFFC000002C :                     ; ------------------------------------------------
(2) 1001/ 6001B8C :                     .end:		phase CACHE_SLAVE+.end&$1FFF
(2) 1002/ 6001B8C :                     CACHE_SLAVE_E:
(2) 1003/ 6001B8C :                     		align 4
(2) 1007/ 6001B8C :                     
(1) 2882/ 6001B8C :                     		
(1) 2883/ 6001B8C :                     ; ====================================================================
(1) 2884/ 6001B8C :                     ; ----------------------------------------------------------------
(1) 2885/ 6001B8C :                     ; Data
(1) 2886/ 6001B8C :                     ; ----------------------------------------------------------------
(1) 2887/ 6001B8C :                     
(1) 2888/ 6001B8C :                     		align 4
(1) 2889/ 6001B8C :                     sin_table	binclude "system/mars/data/sinedata.bin"
(1) 2890/ 600438C :                     		align 4
(1) 2891/ 600438C :                     		include "data/mars_sdram.asm"
(2)    1/ 600438C :                     ; ====================================================================
(2)    2/ 600438C :                     ; ----------------------------------------------------------------
(2)    3/ 600438C :                     ; SH2 SDRAM user data
(2)    4/ 600438C :                     ; 
(2)    5/ 600438C :                     ; This data is stored on SDRAM, it's always available to use
(2)    6/ 600438C :                     ; and can be re-writeable
(2)    7/ 600438C :                     ; Put small sections of data like palettes or small models
(2)    8/ 600438C :                     ; ----------------------------------------------------------------
(2)    9/ 600438C :                     
(2)   10/ 600438C :                     ; --------------------------------------------------------
(2)   11/ 600438C :                     ; Palettes
(2)   12/ 600438C :                     ; --------------------------------------------------------
(2)   13/ 600438C :                     
(2)   14/ 600438C :                     ; Palette_Intro:	binclude "data/mars/objects/mtrl/intro_pal.bin"
(2)   15/ 600438C :                     ; 		align 4
(2)   16/ 600438C :                     ; Palette_Map:	binclude "data/mars/maps/mtrl/marscity_pal.bin"
(2)   17/ 600438C :                     ; 		align 4
(2)   18/ 600438C :                     ; Palette_projname:
(2)   19/ 600438C :                     ; 		binclude "data/mars/objects/mtrl/projname_pal.bin"
(2)   20/ 600438C :                     ; 		align 4
(2)   21/ 600438C :                     
(2)   22/ 600438C :                     ; --------------------------------------------------------
(2)   23/ 600438C :                     ; Objects
(2)   24/ 600438C :                     ; --------------------------------------------------------
(2)   25/ 600438C :                     
(2)   26/ 600438C :                     ; 		include "data/mars/objects/mdl/intro_1/head.asm"
(2)   27/ 600438C :                     ; 		align 4
(2)   28/ 600438C :                     ; 		include "data/mars/objects/mdl/intro_2/head.asm"
(2)   29/ 600438C :                     ; 		align 4
(2)   30/ 600438C :                     
(2)   31/ 600438C :                     ; ====================================================================
(2)   32/ 600438C :                     ; ----------------------------------------------------------------
(2)   33/ 600438C :                     ; PWM Instrument pointers stored on 32X's SDRAM area
(2)   34/ 600438C :                     ; the sample data is stored on the 32X's ROM view area
(2)   35/ 600438C :                     ; (data/mars_rom.asm)
(2)   36/ 600438C :                     ; ----------------------------------------------------------------
(2)   37/ 600438C :                     
(2)   38/ 600438C :                     ; Example:		
(2)   39/ 600438C :                     ; PwmIns_SPHEAVY1:
(2)   40/ 600438C :                     ; 		dc.l PwmInsWav_SPHEAVY1		; Start
(2)   41/ 600438C :                     ; 		dc.l PwmInsWav_SPHEAVY1_e	; End
(2)   42/ 600438C :                     ; 		dc.l -1				; Sample loop point (-1: don't loop)
(2)   43/ 600438C :                     ; 		dc.l %011			; Flags:
(2)   44/ 600438C :                     ; 						; %S0000000 S-stereo sample
(2)   45/ 600438C :                     ; 						; 
(2)   46/ 600438C :                     
(2)   47/ 600438C :                     ; 		align 4
(2)   48/ 600438C :                     ; PwmIns_SPHEAVY1:
(2)   49/ 600438C :                     ; 		dc.l PwmInsWav_SPHEAVY1
(2)   50/ 600438C :                     ; 		dc.l PwmInsWav_SPHEAVY1_e
(2)   51/ 600438C :                     ; 		dc.l -1
(2)   52/ 600438C :                     ; 		dc.l 0
(2)   53/ 600438C :                     ; PwmIns_MCLSTRNG:
(2)   54/ 600438C :                     ; 		dc.l PwmInsWav_MCLSTRNG
(2)   55/ 600438C :                     ; 		dc.l PwmInsWav_MCLSTRNG_e
(2)   56/ 600438C :                     ; 		dc.l -1
(2)   57/ 600438C :                     ; 		dc.l 0
(2)   58/ 600438C :                     ; PwmIns_WHODSNARE:
(2)   59/ 600438C :                     ; 		dc.l PwmInsWav_WHODSNARE
(2)   60/ 600438C :                     ; 		dc.l PwmInsWav_WHODSNARE_e
(2)   61/ 600438C :                     ; 		dc.l -1
(2)   62/ 600438C :                     ; 		dc.l 0
(2)   63/ 600438C :                     ; PwmIns_TECHNOBASSD:
(2)   64/ 600438C :                     ; 		dc.l PwmInsWav_TECHNOBASSD
(2)   65/ 600438C :                     ; 		dc.l PwmInsWav_TECHNOBASSD_e
(2)   66/ 600438C :                     ; 		dc.l -1
(2)   67/ 600438C :                     ; 		dc.l 0
(2)   68/ 600438C :                     ; PwmIns_String:
(2)   69/ 600438C :                     ; 		dc.l PwmInsWav_String
(2)   70/ 600438C :                     ; 		dc.l PwmInsWav_String_e
(2)   71/ 600438C :                     ; 		dc.l 0
(2)   72/ 600438C :                     ; 		dc.l 0
(2)   73/ 600438C :                     ; PwmIns_Piano:
(2)   74/ 600438C :                     ; 		dc.l PwmInsWav_Piano
(2)   75/ 600438C :                     ; 		dc.l PwmInsWav_Piano_e
(2)   76/ 600438C :                     ; 		dc.l -1
(2)   77/ 600438C :                     ; 		dc.l 0
(2)   78/ 600438C :                     
(1) 2892/ 600438C :                     
(1) 2893/ 600438C :                     ; ====================================================================
(1) 2894/ 600438C :                     ; ----------------------------------------------------------------
(1) 2895/ 600438C :                     ; MARS SH2 RAM
(1) 2896/ 600438C :                     ; ----------------------------------------------------------------
(1) 2897/ 600438C :                     
(1) 2898/ 600438C :                     		align $10
(1) 2899/ 6004390 :                     SH2_RAM:
(1) 2900/ 6004390 : (MACRO)             		struct SH2_RAM
(1) 2900/ 6004390 : =$6004390           GLBL_LASTPC     set *
(1) 2900/   512B0 :                                     dephase
(1) 2900/   512B0 : =$512B0             GLBL_LASTORG    set *
(1) 2900/ 6004390 :                                     phase SH2_RAM
(1) 2907/ 6004390 :                     MarsRam_System	ds.b (sizeof_marssys-MarsRam_System)
(1) 2908/ 600447C :                     MarsRam_Video	ds.b (sizeof_marsvid-MarsRam_Video)
(1) 2909/ 600A788 :                     MarsRam_Sound	ds.b (sizeof_marssnd-MarsRam_Sound)
(1) 2910/ 600A8A0 :                     sizeof_marsram	ds.l 0
(1) 2912/ 600A8A0 :                     
(1) 2913/ 600A8A0 :                     .here:
(1) 2917/ 600A8A0 : (MACRO)             		finish
(1) 2917/ 6004390 :                                     !org GLBL_LASTORG
(1) 2917/ 6004390 :                                     phase GLBL_LASTPC
(1) 2918/ 6004390 :                     
(1) 2919/ 6004390 :                     ; ====================================================================
(1) 2920/ 6004390 :                     ; ----------------------------------------------------------------
(1) 2921/ 6004390 :                     ; MARS Sound RAM
(1) 2922/ 6004390 :                     ; ----------------------------------------------------------------
(1) 2923/ 6004390 :                     
(1) 2924/ 6004390 : (MACRO)             			struct MarsRam_Sound
(1) 2924/ 6004390 : =$6004390           GLBL_LASTPC     set *
(1) 2924/   512B0 :                                     dephase
(1) 2924/   512B0 : =$512B0             GLBL_LASTORG    set *
(1) 2924/ 600A788 :                                     phase MARSRAM_SOUND
(1) 2925/ 600A788 :                     MarsSnd_PwmChnls	ds.b sizeof_sndchn*MAX_PWMCHNL
(1) 2926/ 600A884 :                     ; MarsSnd_PwmTrkData	ds.b $80*2
(1) 2927/ 600A884 :                     MarsSnd_PwmPlyData	ds.l 7
(1) 2928/ 600A8A0 :                     sizeof_marssnd		ds.l 0
(1) 2929/ 600A8A0 : (MACRO)             			finish
(1) 2929/ 600A788 :                                     !org GLBL_LASTORG
(1) 2929/ 6004390 :                                     phase GLBL_LASTPC
(1) 2930/ 6004390 :                     
(1) 2931/ 6004390 :                     ; ====================================================================
(1) 2932/ 6004390 :                     ; ----------------------------------------------------------------
(1) 2933/ 6004390 :                     ; MARS Video RAM
(1) 2934/ 6004390 :                     ; ----------------------------------------------------------------
(1) 2935/ 6004390 :                     
(1) 2936/ 6004390 : (MACRO)             			struct MarsRam_Video
(1) 2936/ 6004390 : =$6004390           GLBL_LASTPC     set *
(1) 2936/   512B0 :                                     dephase
(1) 2936/   512B0 : =$512B0             GLBL_LASTORG    set *
(1) 2936/ 600447C :                                     phase MARSRAM_VIDEO
(1) 2937/ 600447C :                     RAM_Mars_Linescroll	ds.l 240			; Each lines' framebuffer position
(1) 2938/ 600483C :                     RAM_Mars_Palette	ds.w 256			; Indexed palette
(1) 2939/ 6004A3C :                     RAM_Mars_ObjCamera	ds.b sizeof_camera		; Camera buffer
(1) 2940/ 6004A64 :                     RAM_Mars_ObjLayout	ds.b sizeof_layout		; Layout buffer
(1) 2941/ 6004A84 :                     ; RAM_Mars_Objects	ds.b sizeof_mdlobj*MAX_MODELS	; Objects list
(1) 2942/ 6004A84 :                     RAM_Mars_Polygons_0	ds.b sizeof_polygn*MAX_MPLGN	; Polygon list 0
(1) 2943/ 6005E84 :                     RAM_Mars_Polygons_1	ds.b sizeof_polygn*MAX_MPLGN	; Polygon list 1
(1) 2944/ 6007284 :                     RAM_Mars_VdpDrwList	ds.b sizeof_plypz*MAX_SVDP_PZ	; Pieces list
(1) 2945/ 6009F84 :                     RAM_Mars_VdpDrwList_e	ds.l 0				; (end-of-list label)
(1) 2946/ 6009F84 :                     RAM_Mars_Plgn_ZList_0	ds.l MAX_MPLGN*2		; Z value / foward faces
(1) 2947/ 600A384 :                     RAM_Mars_Plgn_ZList_1	ds.l MAX_MPLGN*2		; Z value / foward faces
(1) 2948/ 600A784 :                     RAM_Mars_PlgnNum_0	ds.w 1				; Number of polygons to read, both buffers
(1) 2949/ 600A786 :                     RAM_Mars_PlgnNum_1	ds.w 1				;
(1) 2950/ 600A788 :                     ; RAM_Mars_Bg_X		ds.w 1
(1) 2951/ 600A788 :                     ; RAM_Mars_Bg_XHead	ds.w 1
(1) 2952/ 600A788 :                     ; RAM_Mars_Bg_Y		ds.w 1
(1) 2953/ 600A788 :                     sizeof_marsvid		ds.l 0
(1) 2954/ 600A788 : (MACRO)             			finish
(1) 2954/ 600447C :                                     !org GLBL_LASTORG
(1) 2954/ 6004390 :                                     phase GLBL_LASTPC
(1) 2955/ 6004390 :                     
(1) 2956/ 6004390 :                     ; ====================================================================
(1) 2957/ 6004390 :                     ; ----------------------------------------------------------------
(1) 2958/ 6004390 :                     ; MARS System RAM
(1) 2959/ 6004390 :                     ; ----------------------------------------------------------------
(1) 2960/ 6004390 :                     
(1) 2961/ 6004390 : (MACRO)             			struct MarsRam_System
(1) 2961/ 6004390 : =$6004390           GLBL_LASTPC     set *
(1) 2961/   512B0 :                                     dephase
(1) 2961/   512B0 : =$512B0             GLBL_LASTORG    set *
(1) 2961/ 6004390 :                                     phase MARSRAM_SYSTEM
(1) 2962/ 6004390 :                     RAM_Mars_Global		ds.w sizeof_MarsGbl		; keep it as a word
(1) 2963/ 600447C :                     sizeof_marssys		ds.l 0
(1) 2964/ 600447C : (MACRO)             			finish
(1) 2964/ 6004390 :                                     !org GLBL_LASTORG
(1) 2964/ 6004390 :                                     phase GLBL_LASTPC
(1) 2965/ 6004390 :                     
     113/ 6004390 :                     		cpu 68000
     114/ 6004390 :                     		padding off
     115/   512B0 :                     		dephase
     116/   512B0 :                     MARS_RAMDATA_E:
     117/   512B0 :                     		align 4
     118/   512B0 :                     
     119/   512B0 :                     ; --------------------------------------------------------
     120/   512B0 :                     ; MARS data for SH2's ROM view
     121/   512B0 :                     ; This section will be gone if RV=1
     122/   512B0 :                     ; --------------------------------------------------------
     123/   512B0 :                     
     124/ 20512B0 :                     		phase CS1+*
     125/ 20512B0 :                     		align 4
     126/ 20512B0 :                     		include "data/mars_rom.asm"
(1)    1/ 20512B0 :                     ; ====================================================================
(1)    2/ 20512B0 :                     ; ----------------------------------------------------------------
(1)    3/ 20512B0 :                     ; SH2 ROM user data
(1)    4/ 20512B0 :                     ; 
(1)    5/ 20512B0 :                     ; If your data is too much for SDRAM, place it here.
(1)    6/ 20512B0 :                     ; Note that this section will be gone if the Genesis side is
(1)    7/ 20512B0 :                     ; perfoming a DMA ROM-to-VDP Transfer (setting RV=1)
(1)    8/ 20512B0 :                     ; 
(1)    9/ 20512B0 :                     ; Note: Reading data from here is slow on hardware
(1)   10/ 20512B0 :                     ; ----------------------------------------------------------------
(1)   11/ 20512B0 :                     
(1)   12/ 20512B0 :                     ; --------------------------------------------------------
(1)   13/ 20512B0 :                     ; Textures
(1)   14/ 20512B0 :                     ; --------------------------------------------------------
(1)   15/ 20512B0 :                     
(1)   16/ 20512B0 :                     ; 		align 4
(1)   17/ 20512B0 :                     ; 		include "data/mars/maps/map_marscity.asm"
(1)   18/ 20512B0 :                     ; 		align 4
(1)   19/ 20512B0 :                     ; 		include "data/mars/objects/mdl/projname/head.asm"
(1)   20/ 20512B0 :                     ; 		align 4
(1)   21/ 20512B0 :                     
(1)   22/ 20512B0 :                     ; Textr_marscity:
(1)   23/ 20512B0 :                     ; 		binclude "data/mars/maps/mtrl/marscity_art.bin"
(1)   24/ 20512B0 :                     ; 		align 4
(1)   25/ 20512B0 :                     ; Textr_projname:
(1)   26/ 20512B0 :                     ; 		binclude "data/mars/objects/mtrl/projname_art.bin"
(1)   27/ 20512B0 :                     ; 		align 4
(1)   28/ 20512B0 :                     ; Textr_intro:
(1)   29/ 20512B0 :                     ; 		binclude "data/mars/objects/mtrl/intro_art.bin"
(1)   30/ 20512B0 :                     ; 		align 4
(1)   31/ 20512B0 :                     
(1)   32/ 20512B0 :                     TESTMARS_BG:
(1)   33/ 20512B0 :                     		binclude "data/mars/test_art.bin"
(1)   34/ 209C2B0 :                     		align 4
(1)   35/ 209C2B0 :                     TESTMARS_BG_PAL:
(1)   36/ 209C2B0 :                     		binclude "data/mars/test_pal.bin"
(1)   37/ 209C4B0 :                     		align 4
(1)   38/ 209C4B0 :                     
(1)   39/ 209C4B0 :                     ; MARSANI_INTRO_1:
(1)   40/ 209C4B0 :                     ; 		binclude "data/mars/objects/anim/logo_1_anim.bin"
(1)   41/ 209C4B0 :                     ; 		align 4
(1)   42/ 209C4B0 :                     
(1)   43/ 209C4B0 :                     ; PWM_STEREO:	binclude "data/sound/test.wav",$2C,$200000
(1)   44/ 209C4B0 :                     ; PWM_STEREO_e:
(1)   45/ 209C4B0 :                     ; 		align 4
(1)   46/ 209C4B0 :                     ; PwmInsWav_SPHEAVY1:
(1)   47/ 209C4B0 :                     ; 		binclude "data/sound/instr/smpl/SPHEAVY1.wav",$2C
(1)   48/ 209C4B0 :                     ; PwmInsWav_SPHEAVY1_e:
(1)   49/ 209C4B0 :                     ; 		align 4
(1)   50/ 209C4B0 :                     ; PwmInsWav_MCLSTRNG:
(1)   51/ 209C4B0 :                     ; 		binclude "data/sound/instr/smpl/MCLSTRNG.wav",$2C
(1)   52/ 209C4B0 :                     ; PwmInsWav_MCLSTRNG_e:
(1)   53/ 209C4B0 :                     ; 		align 4
(1)   54/ 209C4B0 :                     ; PwmInsWav_WHODSNARE:
(1)   55/ 209C4B0 :                     ; 		binclude "data/sound/instr/smpl/ST-79_whodini-snare.wav",$2C
(1)   56/ 209C4B0 :                     ; PwmInsWav_WHODSNARE_e:
(1)   57/ 209C4B0 :                     ; 		align 4
(1)   58/ 209C4B0 :                     ; PwmInsWav_TECHNOBASSD:
(1)   59/ 209C4B0 :                     ; 		binclude "data/sound/instr/smpl/ST-72_techno-bassd3.wav",$2C
(1)   60/ 209C4B0 :                     ; PwmInsWav_TECHNOBASSD_e:
(1)   61/ 209C4B0 :                     ; 		align 4
(1)   62/ 209C4B0 :                     ; PwmInsWav_Synth:
(1)   63/ 209C4B0 :                     ; 		binclude "data/sound/instr/smpl/amiga_synth.wav",$2C
(1)   64/ 209C4B0 :                     ; PwmInsWav_Synth_e:
(1)   65/ 209C4B0 :                     ; 		align 4
(1)   66/ 209C4B0 :                     ; PwmInsWav_Piano:
(1)   67/ 209C4B0 :                     ; 		binclude "data/sound/instr/smpl/piano_1.wav",$2C
(1)   68/ 209C4B0 :                     ; PwmInsWav_Piano_e:
(1)   69/ 209C4B0 :                     ; 		align 4
(1)   70/ 209C4B0 :                     ; PwmInsWav_String:
(1)   71/ 209C4B0 :                     ; 		binclude "data/sound/instr/smpl/string_1.wav",$2C
(1)   72/ 209C4B0 :                     ; PwmInsWav_String_e:
(1)   73/ 209C4B0 :                     ; 		align 4
(1)   74/ 209C4B0 :                     
     127/   9C4B0 :                     		dephase
     128/   9C4B0 :                     
     129/   9C4B0 :                     ; ====================================================================
     130/   9C4B0 :                     ; ---------------------------------------------
     131/   9C4B0 :                     ; End
     132/   9C4B0 :                     ; ---------------------------------------------
     133/   9C4B0 :                     		
     134/   9C4B0 :                     ROM_END:
     135/   9C4B0 :                     		align $8000
     136/   A0000 :                     
 AS V1.42 Beta [Bld 118] - source file mars.asm - page 2 - 8/28/2021 21:49:44


  symbol table (* = unused):
  ------------------------

 ADAPTER :                        0 - | *ADEN :                           2 - |
 ALV :                           24 - |
*ARCHITECTURE :                                        x86_64-unknown-linux - |
 ASCII_FONT :                FF07BC C |  ASCII_FONT_E :              FF17BC C |
 ASCII_PAL :                 FF079C C | *ASCII_PAL_E :               FF07BC C |
 ATK :                            8 - | *BIGENDIAN :                      0 - |
 BITDISPENBL :                    6 - |  BITDMA :                         1 - |
 BITDMAENBL :                     4 - | *BITHINT :                        2 - |
*BITHINTENBL :                    4 - | *BITHVSTOP :                      1 - |
*BITJOYA :                        6 - | *BITJOYB :                        4 - |
*BITJOYC :                        5 - |  BITJOYDOWN :                     1 - |
 BITJOYLEFT :                     2 - | *BITJOYMODE :                     3 - |
 BITJOYRIGHT :                    3 - | *BITJOYSTART :                    7 - |
 BITJOYUP :                       0 - | *BITJOYX :                        2 - |
*BITJOYY :                        1 - | *BITJOYZ :                        0 - |
 BITMAPMD :                       1 - | *BITV30 :                         3 - |
 BITVINT :                        3 - | *BITVINTENBL :                    5 - |
 BLKHEADC :                    1A00 C | *BRANCHEXT :                      0 - |
 CACHE_MASTER :             6001598 C |  CACHE_MASTER_E :           6001B60 C |
 CACHE_SLAVE :              6001B60 C |  CACHE_SLAVE_E :            6001B8C C |
*CACHJMP_DRWUPDOWN :                                       FFFFFFFFC00001C0 C |
 CACH_BGFBPOSLR :  FFFFFFFFC000051C C |  CACH_BGFBPOS_D :  FFFFFFFFC0000524 C |
 CACH_BGFBPOS_U :  FFFFFFFFC0000520 C | *CACH_CURRPLYGN :  FFFFFFFFC0000000 C |
 CACH_DDA_LAST :   FFFFFFFFC0000540 C |  CACH_DDA_SRC :    FFFFFFFFC0000550 C |
 CACH_DDA_SRC_L :  FFFFFFFFC0000570 C |  CACH_DDA_SRC_R :  FFFFFFFFC0000580 C |
 CACH_DDA_TOP :    FFFFFFFFC0000530 C | *CACH_LNDRW_L :    FFFFFFFFC0000590 C |
 CACH_LNDRW_S :    FFFFFFFFC00005C8 C |
 CACH_LNDRW_S.END :                                        FFFFFFFFC00005C8 C |
 CACH_LR_LINES :   FFFFFFFFC0000528 C | *CACH_TESTTIMER :  FFFFFFFFC0000028 C |
 CACH_TESTTIMER.END :                                      FFFFFFFFC000002C C |
 CACH_UD_LINES :   FFFFFFFFC000052C C |  CACH_XHEAD_L :    FFFFFFFFC0000500 C |
 CACH_XHEAD_R :    FFFFFFFFC0000504 C | *CACH_XHEAD_UD :   FFFFFFFFC0000518 C |
 CACH_YHEAD_D :    FFFFFFFFC0000508 C |  CACH_YHEAD_LR :   FFFFFFFFC0000510 C |
 CACH_YHEAD_U :    FFFFFFFFC000050C C |  CACH_YREAD_LR :   FFFFFFFFC0000514 C |
*CAM_ANIMDATA :                  18 C | *CAM_ANIMFRAME :                 1C C |
*CAM_ANIMSPD :                   24 C | *CAM_ANIMTIMER :                 20 C |
*CAM_X_POS :                      0 C | *CAM_X_ROT :                      C C |
*CAM_Y_POS :                      4 C | *CAM_Y_ROT :                     10 C |
*CAM_Z_POS :                      8 C | *CAM_Z_ROT :                     14 C |
*CART :                           1 - | *CASESENSITIVE :                  0 - |
 CHECK_TICK :                   BAF C |  CHECK_TICK.CTNOTICK :          BD6 C |
 CHNL_CHIP :                      0 - |  CHNL_EFFARG :                    6 - |
 CHNL_EFFID :                     5 - |  CHNL_INS :                       3 - |
 CHNL_NOTE :                      2 - |  CHNL_STATUS :                    7 - |
 CHNL_TYPE :                      1 - |  CHNL_VOL :                       4 - |
 CMDINTCLR :                     1A - |  CMDIRQ_ON :                      2 - |
*CMDTASKMD_LOADSPAL :       60014F4 C | *CMDTASKMD_SETBITMAP :      60014E4 C |
 CMDTASKMD_SETBITMAP.WAIT_FB :                                      60014E6 C |
 COM :                            0 - |  COMM0 :                         20 - |
 COMM10 :                        2A - |  COMM12 :                        2C - |
 COMM14 :                        2E - |  COMM15 :                        2F - |
 COMM2 :                         22 - |  COMM4 :                         24 - |
 COMM6 :                         26 - |  COMM8 :                         28 - |
 COMMZFIFO :                   1D00 C |  COMMZREAD :                     2B C |
 COMMZROMBLK :                   2D C |  COMMZROMRD :                    2E C |
 COMMZWRITE :                    2C C | *CONSTPI :        3.141592653589793 - |
 CONTROLLER_1 :    FFFFFFFFFFFF91BA - | *CONTROLLER_2 :    FFFFFFFFFFFF91C0 - |
*CS0 :                            0 - |  CS1 :                      2000000 - |
 CS2 :                      4000000 - |  CS3 :                      6000000 - |
 CURRINSDATA :                   18 C |  CURRTBLSRCH :                   32 C |
 CURRTICKBITS :                  21 C |  CURRTRKBLKHD :                  14 C |
 CURRTRKDATA :                   16 C |  CYCLE :                         32 - |
 DACINS_MAGIC1 :               1268 C |  DACINS_MAGIC2 :               1272 C |
 DACINS_MYTIME :               127C C |  DAC_FILL :                     E9C C |
 DAC_FIRSTFILL :                EAA C |  DAC_ME :                       E88 C |
 DAC_OFF :                      CDB C |  DAC_ON :                       CC6 C |
 DAC_PLAY :                     E54 C |  DAC_REFILL :                   EAE C |
 DAC_REFILL.FDF4DONE :          EFE C |  DAC_REFILL.FDF7 :              F70 C |
 DAC_REFILL.FDF72 :             F29 C |  DAC_REFILL.FDFRETURN :         F73 C |
*DAC_REFILL.KEEPCNTR :          ED7 C | *DATE :                   8/28/2021 - |
 DDACCNTR :                      25 C |  DDACFIFOMID :                   28 C |
 DDACPNTR :                      22 C |  DEFAULT_BOOT :                4240 C |
 DEST_DATA :                6001480 C | *DISPENBL :                      40 - |
 DKY :                            C - | *DMAENBL :                       10 - |
*DOTTEDSTRUCTS :                  0 - |  DO_MULTIPLY :                  BEC C |
 DO_MULTIPLY.MULBITCLR :        BF4 C |  DO_MULTIPLY.MUL_ADD :          BEF C |
 DREQCTL :                        6 - | *DREQDEST :                       C - |
*DREQFIFO :                      12 - | *DREQLEN :                       10 - |
*DREQSOURCE :                     8 - |  DRV_LOOP :                      42 C |
 DRV_LOOP.CMND_0 :               FF C |  DRV_LOOP.CMND_TRKPLAY :        104 C |
 DRV_LOOP.CMND_WAV_PITCH :      1C7 C |  DRV_LOOP.CMND_WAV_SET :        15D C |
 DRV_LOOP.LIST :                 B9 C |  DRV_LOOP.NEITHER :              8A C |
 DRV_LOOP.NEXT_CMD :             8A C |  DRV_LOOP.NOBEATS :              74 C |
 DRV_LOOP.NOTICKS :              62 C |  DRWSLD_NEXTPZ :   FFFFFFFFC0000488 C |
 DRWSLD_NEXTPZ.ACTIV :                                     FFFFFFFFC00004A4 C |
*DRWSLD_NEXTPZ.FINISH_IT :                                 FFFFFFFFC00004A0 C |
 DRWSLD_NEXTPZ.RESET_RD :                                  FFFFFFFFC0000494 C |
 DRWSLD_NXTLINE :  FFFFFFFFC00003DC C |
 DRWSLD_NXTLINE.L_FIX :                                    FFFFFFFFC000041E C |
 DRWSLD_NXTLINE.REVERS :                                   FFFFFFFFC0000408 C |
 DRWSLD_NXTLINE.R_FIX :                                    FFFFFFFFC0000418 C |
 DRWSLD_NXTLINE.WAIT :                                     FFFFFFFFC000042C C |
 DRWSLD_NXTLINE_TEX :                                      FFFFFFFFC0000298 C |
 DRWSLD_NXTLINE_TEX.TEX_SKIP_LINE :                        FFFFFFFFC000037C C |
 DRWSLD_NXTLINE_TEX.TEX_XLOOP :                            FFFFFFFFC000035C C |
 DRWSLD_NXTLINE_TEX.TL_FIX :                               FFFFFFFFC0000322 C |
 DRWSLD_NXTLINE_TEX.TR_FIX :                               FFFFFFFFC000030E C |
 DRWSLD_NXTLINE_TEX.TXREVERS :                             FFFFFFFFC00002DC C |
 DRWSLD_NXTLINE_TEX.XL_L :                                 FFFFFFFFC000034A C |
 DRWSLD_NXTLINE_TEX.XL_R :                                 FFFFFFFFC0000344 C |
 DRWSLD_UPDLINE :  FFFFFFFFC000047E C |
 DRWSLD_UPDLINE_TEX :                                      FFFFFFFFC0000390 C |
 DRWTASK_EXIT :    FFFFFFFFC00004CE C |  DRWTASK_RETURN :  FFFFFFFFC00004B2 C |
 DRWTEX_GONXTPZ :  FFFFFFFFC00003AC C | *DRWTSK02_NEWPZ :  FFFFFFFFC0000236 C |
 DRWTSK02_NEWPZ.INVLD_Y :                                  FFFFFFFFC000025C C |
 DRWTSK02_NEWPZ.LEN_MAX :                                  FFFFFFFFC0000256 C |
 DRWTSK1_VLD_Y :   FFFFFFFFC0000266 C |  DRWTSK_00 :       FFFFFFFFC00004A8 C |
 DRWTSK_01 :       FFFFFFFFC0000028 C |
 DRWTSK_01.DTSK01_DLEFT :                                  FFFFFFFFC0000054 C |
 DRWTSK_01.DTSK01_DRIGHT :                                 FFFFFFFFC000008E C |
 DRWTSK_01.GET_OUT :                                       FFFFFFFFC000004E C |
 DRWTSK_01.LASTLINE_L :                                    FFFFFFFFC000006E C |
 DRWTSK_01.LASTLINE_R :                                    FFFFFFFFC00000AE C |
 DRWTSK_01.PREFIX_L :                                      FFFFFFFFC0000062 C |
 DRWTSK_01.PREFIX_R :                                      FFFFFFFFC000009C C |
 DRWTSK_01.TAG_SCRLWDTH :                                  FFFFFFFFC00000D0 C |
 DRWTSK_01.TAG_SCRNWDTH :                                  FFFFFFFFC00000D4 C |
 DRWTSK_02 :       FFFFFFFFC0000204 C |  DRWTSK_02.EXIT :  FFFFFFFFC0000216 C |
 DRWTSK_02.HAS_PZ :                                        FFFFFFFFC000021A C |
 DRWTSK_SOLIDMODE :                                        FFFFFFFFC00003C8 C |
 DRWTSK_SOLIDMODE.WAIT :                                   FFFFFFFFC00003D6 C |
 DRWTSK_TEXMODE :  FFFFFFFFC0000284 C |
 DRWTSK_TEXMODE.TEXVALID :                                 FFFFFFFFC0000290 C |
 DRW_UD_EXIT :              6001004 C |  DRW_UD_EXIT.WAITFB :       6001018 C |
 DRW_UD_EXIT.WAIT_PZ :      6001004 C |  DRW_UD_EXIT.WAIT_TASK :    600100A C |
 DTH :                           20 - |  DTL :                           1C - |
 DTSK01_EXIT :     FFFFFFFFC0000178 C |
 DTSK01_EXIT.NDRW_R :                                      FFFFFFFFC000019A C |
 DTSK01_LRDRAW :   FFFFFFFFC00000D8 C |
 DTSK01_LRDRAW.FBMUCH :                                    FFFFFFFFC0000176 C |
 DTSK01_LRDRAW.NOT_LN0 :                                   FFFFFFFFC000013C C |
 DTSK01_LRDRAW.RESETY :                                    FFFFFFFFC0000160 C |
 DWAVEBUFF :                   1500 C | *FALSE :                          0 - |
*FEN :                            2 - | *FILLDATA :                       8 - |
*FILLLENGTH :                     5 - | *FILLSTART :                      6 - |
 FLG :                           28 - |  FM :                            80 - |
 FM3VTBL :                     11DC C |  FM6VTBL :                     11ED C |
 FMFREQ_LIST :                 1068 C | *FMINS_AMBIENT_3 :             141C C |
*FMINS_AMBIENT_DARK :          13DC C | *FMINS_AMBIENT_SPOOK :         13FC C |
 FMINS_BASS_CALM :             133C C | *FMINS_BRASS_GEM :             135C C |
*FMINS_DRUMKICK :              131C C | *FMINS_FM3_CLOSEDHAT :         12F4 C |
*FMINS_FM3_OPENHAT :           12CC C | *FMINS_GUITAR_HEAVY :          12A4 C |
*FMINS_PIANO :                 139C C | *FMINS_PIANO_SMALL :           137C C |
*FMINS_TRUMPET_2 :             13BC C |  FMVTBL :                      1198 C |
 FM_AUTOSET :                   E37 C |  FM_SEND_1 :                    E3E C |
 FM_SEND_2 :                    E49 C |  FRAMECTL :                       B - |
*FS :                             1 - | *FULLPMMU :                       1 - |
*GEMATRK_DEMO_BLK :          908000 C | *GEMATRK_DEMO_INS :          908271 C |
*GEMATRK_DEMO_PATT :         908005 C |  GEMA_INIT :                    B31 C |
 GET_CMDBYTE :                  B86 C |  GET_CMDBYTE.GETCBYTEL :        B89 C |
 GFXMD1_STEP2 :             6000E6E C |  GFXMD1_STEP2.CONT_PLGN :   6000F12 C |
 GFXMD1_STEP2.DRWY_GO :     6000FA0 C |  GFXMD1_STEP2.INVALID :     6000F28 C |
 GFXMD1_STEP2.LN_LOOP :     6000EC0 C |  GFXMD1_STEP2.LOOP :        6000F18 C |
 GFXMD1_STEP2.NOT_L2 :      6000FEA C |  GFXMD1_STEP2.NO_SCRLDATA : 6000EB0 C |
 GFXMD1_STEP2.PAGE_2 :      6000F0A C |  GFXMD1_STEP2.REPT_X :      6000FC8 C |
 GFXMD1_STEP2.REPT_Y :      6000FA2 C |  GFXMD1_STEP2.RES_X :       6000FD0 C |
 GFXMD1_STEP2.SKIP :        6000F32 C |  GFXMD1_STEP2.TSK00_DOWN :  6000F56 C |
 GFXMD1_STEP2.TSK00_UP :    6000F7C C |  GFXMD1_STEP2.XLON1 :       6000FD6 C |
 GFXMD1_STEP2.XL_L :        6000ED2 C |  GFXMD1_STEP2.XL_R :        6000ECC C |
 GFXMD1_STEP2.YBGEND :      6000FAE C |  GLBL_LASTORG :               512B0 - |
 GLBL_LASTPC :              6004390 - |
 GO_DRWSLD_UPDLINE_TEX :                                   FFFFFFFFC000027C C |
 GO_DRWTEX_GONXTPZ :                                       FFFFFFFFC0000280 C |
*HAS64 :                          1 - | *HASDSP :                         0 - |
*HASFPU :                         0 - | *HASPMMU :                        0 - |
*HBLK :                          40 - | *HCOUNT :                         5 - |
 HINTCLR :                       18 - | *HINTENBL :                      10 - |
 HINT_DEFAULT :              FF1B88 C | *HINT_DEFAULT.HERE :         FF1B8A C |
*HIRQ_ON :                        4 - | *HVSTOP :                         2 - |
*INEXTMODE :                      0 - | *INLWORDMODE :                    0 - |
*INMAXMODE :                      0 - |  INSDATAC :                    1C00 C |
*INSRCMODE :                      0 - | *INSUPMODE :                      1 - |
 INTMASK :                        1 - |  INT_M_LIST :               600026C C |
 INT_S_LIST :               60002CC C | *JOYA :                          40 - |
*JOYB :                          10 - | *JOYC :                          20 - |
*JOYDOWN :                        2 - | *JOYLEFT :                        4 - |
*JOYMODE :                      800 - | *JOYRIGHT :                       8 - |
*JOYSTART :                      80 - | *JOYUP :                          1 - |
*JOYX :                         400 - |  JOYY :                         200 - |
 JOYZ :                         100 - |  LCHWIDTH :                      34 - |
 LEV :                            4 - | *LISTON :                         3 - |
 LIST_VDPREGS :              FF0788 C |  LITERAL_F_00000000_1 :     6000268 C |
 LITERAL_F_00000001_1 :     6000358 C |  LITERAL_F_00000002_1 :     6000440 C |
 LITERAL_F_00000003_1 :     60004C0 C |  LITERAL_F_00000004_1 :     6000520 C |
 LITERAL_F_00000005_1 :     60005D4 C |  LITERAL_F_00000006_1 :     60006C4 C |
 LITERAL_F_00000007_1 :     60006C8 C |  LITERAL_F_00000008_1 :     60006CC C |
 LITERAL_F_00000009_1 :     60006D4 C |  LITERAL_F_0000000A_1 :     60006D8 C |
 LITERAL_F_0000000B_1 :     60007F0 C |  LITERAL_F_0000000C_1 :     60007F4 C |
 LITERAL_F_0000000D_1 :     60007F8 C |  LITERAL_F_0000000E_1 :     60007FC C |
 LITERAL_F_0000000F_1 :     6000800 C |  LITERAL_F_00000010_1 :     6000804 C |
 LITERAL_F_00000011_1 :     60008CC C |  LITERAL_F_00000012_1 :     60008D0 C |
 LITERAL_F_00000013_1 :     60008D4 C |  LITERAL_F_00000014_1 :     60008D8 C |
 LITERAL_F_00000015_1 :     60008DC C |  LITERAL_F_00000016_1 :     60008E0 C |
 LITERAL_F_00000017_1 :     60009D8 C |  LITERAL_F_00000018_1 :     60009DC C |
 LITERAL_F_00000019_1 :     6000AA4 C |  LITERAL_F_0000001A_1 :     6000AA8 C |
 LITERAL_F_0000001B_1 :     6000AAC C |  LITERAL_F_0000001C_1 :     6000AB0 C |
 LITERAL_F_0000001D_1 :     6000AB4 C |  LITERAL_F_0000001E_1 :     6000AB8 C |
 LITERAL_F_0000001F_1 :     6000ABC C |  LITERAL_F_00000020_1 :     6000AC0 C |
 LITERAL_F_00000021_1 :     6000BA0 C |  LITERAL_F_00000022_1 :     6000C68 C |
 LITERAL_F_00000023_1 :     6000C6C C |  LITERAL_F_00000024_1 :     6000C74 C |
 LITERAL_F_00000025_1 :     6000C78 C |  LITERAL_F_00000026_1 :     6000E18 C |
 LITERAL_F_00000027_1 :     6000E20 C |  LITERAL_F_00000028_1 :     6000E62 C |
 LITERAL_F_00000029_1 :     6000E2C C |  LITERAL_F_0000002A_1 :     6000E30 C |
 LITERAL_F_0000002B_1 :     6000E38 C |  LITERAL_F_0000002C_1 :     6000E44 C |
 LITERAL_F_0000002D_1 :     6000E48 C |  LITERAL_F_0000002E_1 :     6000E4C C |
 LITERAL_F_0000002F_1 :     6000E50 C |  LITERAL_F_00000030_1 :     6000E54 C |
 LITERAL_F_00000031_1 :     6001038 C |  LITERAL_F_00000032_1 :     600103C C |
 LITERAL_F_00000033_1 :     600104C C |  LITERAL_F_00000034_1 :     6001050 C |
 LITERAL_F_00000035_1 :     6001054 C |  LITERAL_F_00000036_1 :     6001058 C |
 LITERAL_F_00000037_1 :     6001060 C |  LITERAL_F_00000038_1 :     6001064 C |
 LITERAL_F_00000039_1 :     6001068 C |  LITERAL_F_0000003A_1 :     600106C C |
 LITERAL_F_0000003B_1 :     6001070 C |  LITERAL_F_0000003C_1 :     6001148 C |
 LITERAL_F_0000003D_1 :     6001308 C |  LITERAL_F_0000003E_1 :     600130C C |
 LITERAL_F_0000003F_1 :     6001310 C |  LITERAL_F_00000040_1 :     6001314 C |
 LITERAL_F_00000041_1 :     6001428 C |  LITERAL_F_00000042_1 :     6001430 C |
 LITERAL_F_00000043_1 :     6001472 C |  LITERAL_F_00000044_1 :     6001444 C |
 LITERAL_F_00000045_1 :     6001448 C |  LITERAL_F_00000046_1 :     600144C C |
 LITERAL_F_00000047_1 :     6001450 C |  LITERAL_F_00000048_1 :     6001454 C |
 LITERAL_F_00000049_1 :     6001458 C |  LITERAL_F_0000004A_1 :     600145C C |
 LITERAL_F_0000004B_1 :     6001460 C |  LITERAL_F_0000004C_1 :     6001464 C |
 LITERAL_F_0000004D_1 :     60014DC C |  LITERAL_F_0000004E_1 :     60014E0 C |
 LITERAL_F_0000004F_1 :     6001588 C |  LITERAL_F_00000050_1 :     600158C C |
 LITERAL_F_00000051_1 :                                    FFFFFFFFC00001C4 C |
 LITERAL_F_00000052_1 :                                    FFFFFFFFC00001C8 C |
 LITERAL_F_00000053_1 :                                    FFFFFFFFC00001D8 C |
 LITERAL_F_00000054_1 :                                    FFFFFFFFC00001DC C |
 LITERAL_F_00000055_1 :                                    FFFFFFFFC00001E0 C |
 LITERAL_F_00000056_1 :                                    FFFFFFFFC00001E4 C |
 LITERAL_F_00000057_1 :                                    FFFFFFFFC00001E8 C |
 LITERAL_F_00000058_1 :                                    FFFFFFFFC00001EC C |
 LITERAL_F_00000059_1 :                                    FFFFFFFFC00001F0 C |
 LITERAL_F_0000005A_1 :                                    FFFFFFFFC00001F4 C |
 LITERAL_F_0000005B_1 :                                    FFFFFFFFC00001F8 C |
 LITERAL_F_0000005C_1 :                                    FFFFFFFFC00003B0 C |
 LITERAL_F_0000005D_1 :                                    FFFFFFFFC00004E8 C |
 LITERAL_F_0000005E_1 :                                    FFFFFFFFC00004EC C |
 LITERAL_F_0000005F_1 :                                    FFFFFFFFC00004F0 C |
 LITERAL_L_0000FFFF_1 :                                    FFFFFFFFC0000260 C |
 LITERAL_L_00010000_1 :     6000E34 C |  LITERAL_L_00015000_1 :     6001044 C |
 LITERAL_L_00015000_2 :     600114C C |  LITERAL_L_00015000_3 :     6001318 C |
 LITERAL_L_00015000_4 :                                    FFFFFFFFC00001CC C |
 LITERAL_L_00015000_5 :                                    FFFFFFFFC00003B4 C |
 LITERAL_L_001E0000_1 :     600143C C |  LITERAL_L_00FFFFFF_1 :     6000BA4 C |
 LITERAL_L_060005DE_1 :     6000E28 C |  LITERAL_L_060005FE_1 :     600105C C |
 LITERAL_L_060009A4_1 :     6000E3C C |  LITERAL_L_060009A4_2 :     600150C C |
 LITERAL_L_06000A24_1 :     6001048 C |  LITERAL_L_0603EFF8_1 :     60005D0 C |
 LITERAL_L_0603F000_1 :     600141C C |  LITERAL_L_0603FFF8_1 :     60004BC C |
 LITERAL_L_06040000_1 :     6000E0C C |  LITERAL_L_20004000_1 :     60004AC C |
 LITERAL_L_20004000_2 :     60005C0 C |  LITERAL_L_20004000_3 :     60005F4 C |
 LITERAL_L_20004000_4 :     6000C64 C |  LITERAL_L_20004000_5 :     6000E1C C |
 LITERAL_L_20004000_6 :     600142C C |  LITERAL_L_20004016_1 :     6000438 C |
 LITERAL_L_20004016_2 :     60005BC C |  LITERAL_L_20004018_1 :     6000434 C |
 LITERAL_L_20004018_2 :     60005B8 C |  LITERAL_L_2000401A_1 :     6000360 C |
 LITERAL_L_2000401A_2 :     6000528 C |  LITERAL_L_2000401C_1 :     600035C C |
 LITERAL_L_2000401C_2 :     6000524 C |  LITERAL_L_20004020_1 :     6000E10 C |
 LITERAL_L_20004020_2 :     600102C C |  LITERAL_L_20004020_3 :     6001300 C |
 LITERAL_L_20004020_4 :     6001420 C |  LITERAL_L_20004024_1 :     6001034 C |
 LITERAL_L_2000402E_1 :     6001304 C |  LITERAL_L_2000402E_2 :     6001438 C |
 LITERAL_L_20004034_1 :     6000BA8 C |  LITERAL_L_20004036_1 :     6000BAC C |
 LITERAL_L_20004038_1 :     600051C C |  LITERAL_L_20004100_1 :     600043C C |
 LITERAL_L_20004100_2 :     60005F8 C |  LITERAL_L_20004100_3 :     6000990 C |
 LITERAL_L_20004100_4 :     6000AC4 C |  LITERAL_L_20004100_5 :     6000E40 C |
 LITERAL_L_20004100_6 :     600107C C |  LITERAL_L_20004100_7 :     6001508 C |
 LITERAL_L_20004100_8 :                                    FFFFFFFFC00004E4 C |
 LITERAL_L_20004102_1 :     6001030 C |  LITERAL_L_20004200_1 :     6000444 C |
 LITERAL_L_24000000_1 :     6001040 C |  LITERAL_L_24000200_1 :     6000994 C |
 LITERAL_L_24000200_2 :     6001074 C |  LITERAL_L_24000200_3 :     6001150 C |
 LITERAL_L_24000200_4 :                                    FFFFFFFFC00001D4 C |
 LITERAL_L_24015200_1 :     6000998 C |  LITERAL_L_24015200_2 :     6001078 C |
 LITERAL_L_24015200_3 :     6001154 C |
 LITERAL_L_24015200_4 :                                    FFFFFFFFC00001D0 C |
 LITERAL_L_24020200_1 :                                    FFFFFFFFC00003B8 C |
 LITERAL_L_36385550_1 :     60004B0 C |  LITERAL_L_36385550_2 :     60005C4 C |
 LITERAL_L_4D5F4F4B_1 :     60004B8 C |  LITERAL_L_4D5F4F4B_2 :     60005CC C |
 LITERAL_L_534C4156_1 :     6000E14 C |  LITERAL_L_534C4156_2 :     6001424 C |
 LITERAL_L_535F4F4B_1 :     60004B4 C |  LITERAL_L_535F4F4B_2 :     60005C8 C |
 LITERAL_L_7FFFFFFF_1 :     60006D0 C |
 LITERAL_L_FFFFFFFFC0000000_1 :                                     6000E24 C |
 LITERAL_L_FFFFFFFFC0000000_2 :                                     6001434 C |
 LITERAL_L_FFFFFFFFFF000000_1 :                                     6000C70 C |
 LITERAL_L_FFFFFFFFFFE20000_1 :                                     6001440 C |
 LITERAL_W_0080_1 :         60005FC C |  LITERAL_W_00A0_1 :         60006DC C |
 LITERAL_W_00A0_2 :         6000E6C C |  LITERAL_W_00A1_1 :         6000AD4 C |
 LITERAL_W_00E0_1 :         60006DE C |
 LITERAL_W_00E0_2 :                                        FFFFFFFFC0000264 C |
 LITERAL_W_00E0_3 :                                        FFFFFFFFC00003BC C |
 LITERAL_W_00E0_4 :                                        FFFFFFFFC00004F6 C |
 LITERAL_W_00F0_1 :         6000366 C |  LITERAL_W_00F0_2 :         600044A C |
 LITERAL_W_00F0_3 :         60004C4 C |  LITERAL_W_00F0_4 :         600052E C |
 LITERAL_W_00F0_5 :         60005DA C |  LITERAL_W_00F0_6 :         60009A0 C |
 LITERAL_W_00F0_7 :         6000A22 C |  LITERAL_W_00F0_8 :         6000AC8 C |
 LITERAL_W_00F0_9 :         6000C80 C |  LITERAL_W_00F0_A :         6000E5E C |
 LITERAL_W_00F0_B :         6001082 C |  LITERAL_W_00F0_C :         600146E C |
 LITERAL_W_00FF_1 :         600099C C |
 LITERAL_W_00FF_2 :                                        FFFFFFFFC00003C6 C |
 LITERAL_W_00FF_3 :                                        FFFFFFFFC00004F4 C |
 LITERAL_W_0100_1 :         600099E C |  LITERAL_W_0100_2 :         60009E0 C |
 LITERAL_W_0100_3 :         6000ACA C |  LITERAL_W_0100_4 :         6000E6A C |
 LITERAL_W_0105_1 :         6000C7C C |
 LITERAL_W_013E_1 :                                        FFFFFFFFC00004F8 C |
 LITERAL_W_0140_1 :         6000A20 C |  LITERAL_W_0140_2 :         6001088 C |
 LITERAL_W_0140_3 :         600115A C |
 LITERAL_W_0140_4 :                                        FFFFFFFFC00003BE C |
 LITERAL_W_0150_1 :         60009A2 C |  LITERAL_W_0150_2 :         6000ACC C |
 LITERAL_W_0150_3 :         6000E64 C |  LITERAL_W_0150_4 :         6001084 C |
 LITERAL_W_0150_5 :         6001158 C |
 LITERAL_W_0150_6 :                                        FFFFFFFFC00001FC C |
 LITERAL_W_0150_7 :                                        FFFFFFFFC00003C2 C |
 LITERAL_W_01E0_1 :         6000E68 C |  LITERAL_W_0200_1 :         6001080 C |
 LITERAL_W_0280_1 :         6000E66 C |  LITERAL_W_03FF_1 :         6000BB0 C |
 LITERAL_W_0415_1 :         6000C7E C |  LITERAL_W_07FF_1 :         6001476 C |
 LITERAL_W_1FFF_1 :                                        FFFFFFFFC00003C4 C |
 LITERAL_W_44E0_1 :         60004CA C |  LITERAL_W_44E0_2 :         60005DC C |
 LITERAL_W_474F_1 :         6001474 C |  LITERAL_W_5A00_1 :         6001596 C |
 LITERAL_W_5A00_2 :                                        FFFFFFFFC00004FE C |
 LITERAL_W_5A10_1 :                                        FFFFFFFFC0000202 C |
 LITERAL_W_5A20_1 :         6000AD0 C |  LITERAL_W_7FFF_1 :         60009E2 C |
 LITERAL_W_A518_1 :         60004C8 C |  LITERAL_W_A518_2 :         600108C C |
 LITERAL_W_A518_3 :         6001594 C |
 LITERAL_W_A518_4 :                                        FFFFFFFFC0000200 C |
 LITERAL_W_A518_5 :                                        FFFFFFFFC00004FC C |
 LITERAL_W_A538_1 :         6000AD2 C |  LITERAL_W_FE10_1 :         6000364 C |
 LITERAL_W_FE10_2 :         6000448 C |  LITERAL_W_FE10_3 :         60004CC C |
 LITERAL_W_FE10_4 :         600052C C |  LITERAL_W_FE10_5 :         60005D8 C |
 LITERAL_W_FE10_6 :         6000E58 C |  LITERAL_W_FE10_7 :         6001468 C |
 LITERAL_W_FE10_8 :         6001590 C |  LITERAL_W_FE80_1 :         60004C6 C |
 LITERAL_W_FE80_2 :         6000ACE C |  LITERAL_W_FE80_3 :         600108A C |
 LITERAL_W_FE80_4 :         6001592 C |
 LITERAL_W_FE80_5 :                                        FFFFFFFFC00001FE C |
 LITERAL_W_FE80_6 :                                        FFFFFFFFC00004FA C |
 LITERAL_W_FE92_1 :         6000E60 C |  LITERAL_W_FE92_2 :         6001086 C |
 LITERAL_W_FE92_3 :         6001470 C |  LITERAL_W_FEE2_1 :         6000E5A C |
 LITERAL_W_FEE2_2 :         600146A C |  LITERAL_W_FEE4_1 :         6000E5C C |
 LITERAL_W_FEE4_2 :         600146C C |  LITERAL_W_FF00_1 :         6000808 C |
 LITERAL_W_FF00_2 :                                        FFFFFFFFC00003C0 C |
*MACEXP :                         7 - | *MARS :                           1 - |
*MARSCD :                         0 - |  MARSGBL_BGDATA :                 0 C |
 MARSGBL_BGDATA_R :               4 C |  MARSGBL_BGHEIGHT :              3A C |
 MARSGBL_BGWIDTH :               38 C |  MARSGBL_BG_DRWREQD :            52 C |
 MARSGBL_BG_DRWREQFULL :         58 C |  MARSGBL_BG_DRWREQL :            54 C |
 MARSGBL_BG_DRWREQR :            56 C |  MARSGBL_BG_DRWREQU :            50 C |
 MARSGBL_BG_FBBASE :             30 C |  MARSGBL_BG_XBGINC_L :           46 C |
 MARSGBL_BG_XBGINC_R :           48 C |  MARSGBL_BG_XPOS :               18 C |
 MARSGBL_BG_XPOS_OLD :           20 C |  MARSGBL_BG_XSET :               3C C |
*MARSGBL_BG_XSHIFT :             34 C |  MARSGBL_BG_YBGINC_D :           4A C |
 MARSGBL_BG_YBGINC_LR :          4E C |  MARSGBL_BG_YBGINC_U :           4C C |
 MARSGBL_BG_YFBPOS_D :           42 C |  MARSGBL_BG_YFBPOS_LR :          44 C |
 MARSGBL_BG_YFBPOS_U :           40 C |  MARSGBL_BG_YPOS :               1C C |
 MARSGBL_BG_YPOS_OLD :           24 C |  MARSGBL_BG_YSET :               3E C |
*MARSGBL_CURRFACEPOS :           14 C |  MARSGBL_CURRFB :                6E C |
 MARSGBL_CURRGFXMODE :           60 C | *MARSGBL_CURRZLIST :             10 C |
 MARSGBL_DIVSTOP_M :             6C C |  MARSGBL_DRWPAUSE :              66 C |
 MARSGBL_DRWTASK :               64 C | *MARSGBL_GRAPHMODE :             36 C |
 MARSGBL_MDLFACESCNTR :          5A C |  MARSGBL_MSTRREQDRAW :           5E C |
 MARSGBL_PALDMAMIDWR :           74 C |  MARSGBL_PLGNBUFFNUM :           5C C |
*MARSGBL_PLGN_READ :             28 C | *MARSGBL_PLGN_WRITE :            2C C |
 MARSGBL_PLYPZLIST_R :            8 C |  MARSGBL_PLYPZLIST_W :            C C |
*MARSGBL_PWMTRKUPD :             72 C |  MARSGBL_PZLISTCNTR :            62 C |
 MARSGBL_VINTFLAG_M :            68 C |  MARSGBL_VINTFLAG_S :            6A C |
 MARSGBL_ZSORTREQ :              70 C |  MARSRAM_SOUND :            600A788 C |
 MARSRAM_SYSTEM :           6004390 C |  MARSRAM_VIDEO :            600447C C |
 MARSSND_PWMCHNLS :         600A788 C | *MARSSND_PWMPLYDATA :       600A884 C |
 MARSSOUND_INIT :           6000BB2 C |  MARSSOUND_INIT.CLR_ENBL :  6000BD2 C |
*MARSSOUND_PWMENABLE :      6000C4C C |  MARSSOUND_READPWM :        6000AD6 C |
 MARSSOUND_READPWM.LMUCH :  6000B7C C |  MARSSOUND_READPWM.LOOP :   6000AF0 C |
 MARSSOUND_READPWM.LOOP_ME :                                        6000B16 C |
 MARSSOUND_READPWM.MONO :   6000B3C C |  MARSSOUND_READPWM.MONO_A : 6000B28 C |
 MARSSOUND_READPWM.NO_L :   6000B60 C |  MARSSOUND_READPWM.ON :     6000AFE C |
 MARSSOUND_READPWM.READ :   6000B1A C |  MARSSOUND_READPWM.RMUCH :  6000B82 C |
 MARSSOUND_READPWM.SILENT : 6000AF6 C |  MARSSOUND_READPWM.SKIP :   6000B66 C |
*MARSSOUND_SETPWM :         6000BE4 C |  MARSSOUND_SETPWM.ENDMRK :  6000C12 C |
*MARSSOUND_SETPWMPITCH :    6000C2C C |
 MARSSOUND_SETPWMPITCH.OFF_1 :                                      6000C46 C |
*MARSVIDEO_CLEARFRAME :     60008E4 C |
 MARSVIDEO_CLEARFRAME.LOOP :                                        60008F8 C |
 MARSVIDEO_CLEARFRAME.WAIT :                                        6000906 C |
 MARSVIDEO_CLEARFRAME.WAIT2 :                                       60008E6 C |
 MARSVIDEO_DRAWALLBG :      6000918 C |  MARSVIDEO_DRAWALLBG.NOLM : 6000946 C |
 MARSVIDEO_DRAWALLBG.NOLM_L :                                       6000982 C |
*MARSVIDEO_DRAWALLBG.STOP : 600098C C |
 MARSVIDEO_DRAWALLBG.X_NEXT :                                       6000940 C |
 MARSVIDEO_DRAWALLBG.X_NEXT_L :                                     600097C C |
 MARSVIDEO_DRAWALLBG.YLRGE :                                        6000964 C |
 MARSVIDEO_DRAWALLBG.Y_NEXT :                                       600093C C |
 MARSVIDEO_INIT :           60005DE C |  MARSVIDEO_LOADPAL :        60009A4 C |
*MARSVIDEO_LOADPAL.BADLEN : 60009CA C |  MARSVIDEO_LOADPAL.LOOP :   60009BE C |
 MARSVIDEO_SETBG :          60009E4 C |  MARSVIDEO_SETWATCHDOG :    6000A24 C |
 MARSVIDEO_SETWATCHDOG.WAIT_FB :                                    6000A94 C |
 MARSVIDEO_SLICEPLGN :      60005FE C |
 MARSVIDEO_SLICEPLGN.DONTRESET :                                    600069E C |
 MARSVIDEO_SLICEPLGN.EXIT : 60006BE C |
 MARSVIDEO_SLICEPLGN.FIND_TOP :                                     6000650 C |
 MARSVIDEO_SLICEPLGN.IS_HIGH :                                      6000662 C |
 MARSVIDEO_SLICEPLGN.IS_LOW :                                       6000658 C |
 MARSVIDEO_SLICEPLGN.LEFTH2 :                                       60006B6 C |
 MARSVIDEO_SLICEPLGN.NEXT_PZ :                                      6000684 C |
 MARSVIDEO_SLICEPLGN.SETPNTS :                                      600061E C |
 MARSVIDEO_SLICEPLGN.SRC_PNTS :                                     6000632 C |
*MARSVIDEO_SLICEPLGN.START_MATH :                                   6000640 C |
 MARSVIDEO_SLICEPLGN.TRINGL :                                       6000610 C |
 MARSVIDEO_SLICEPLGN.YTRINGL :                                      6000648 C |
 MARS_ENTRY :                   800 C |  MARS_ENTRY.ADAPTERENABLE :     872 C |
 MARS_ENTRY.CLRRAM :            8F0 C |  MARS_ENTRY.COPYME :            90C C |
 MARS_ENTRY.HOTSTART :          8BE C |  MARS_ENTRY.INIT :              880 C |
 MARS_ENTRY.NO_MARS :           930 C |  MARS_ENTRY.RAMCODE :           84A C |
 MARS_ENTRY.RESTARTICD :        85A C |  MARS_ENTRY.WAITFRAME :         8D0 C |
 MARS_ENTRY.WM :                892 C |  MARS_ENTRY.WS :                89C C |
 MARS_RAMDATA :               4CF20 C |  MARS_RAMDATA_E :             512B0 C |
 MASTER_IRQ :               6000248 C |  MASTER_LOOP :              6000D36 C |
 MASTER_LOOP.LIST :         6000D50 C |  MASTER_LOOP.WAIT_FRMSWP :  6000D46 C |
 MAX_MDERAM :                   800 - |  MAX_MDTASKS :                   10 - |
 MAX_MDTSKARG :                   8 - |  MAX_MPLGN :                     80 - |
*MAX_MSPR :                      80 - |  MAX_PWMCHNL :                    7 - |
 MAX_SVDP_PZ :                   C0 - |  MAX_TRKCHN :                    12 - |
 MAX_TRKS :                       2 - | *MCD :                            0 - |
 MCHNSND_BANK :                   8 C |  MCHNSND_ENBL :                   0 C |
 MCHNSND_END :                   10 C |  MCHNSND_FLAGS :                 1C C |
 MCHNSND_LOOP :                  14 C |  MCHNSND_PITCH :                 18 C |
 MCHNSND_READ :                   4 C |  MCHNSND_START :                  C C |
 MCHNSND_VOL :                   20 C | *MDGFX_BGTESTB :              4A980 C |
*MDGFX_BGTESTB_E :            4CF20 C | *MDGFX_BGTESTT :              48000 C |
*MDGFX_BGTESTT_E :            4A980 C | *MDLLAY_DATA :                    0 C |
*MDLLAY_X :                       4 C | *MDLLAY_XR_LAST :                1C C |
*MDLLAY_X_LAST :                 10 C | *MDLLAY_Y :                       8 C |
*MDLLAY_Y_LAST :                 14 C | *MDLLAY_Z :                       C C |
*MDLLAY_Z_LAST :                 18 C | *MDL_ANIMDATA :                  20 C |
*MDL_ANIMFRAME :                 24 C | *MDL_ANIMSPD :                   2C C |
*MDL_ANIMTIMER :                 28 C | *MDL_DATA :                       0 C |
*MDL_OPTION :                     4 C | *MDL_X_POS :                      8 C |
*MDL_X_ROT :                     14 C | *MDL_Y_POS :                      C C |
*MDL_Y_ROT :                     18 C | *MDL_Z_POS :                     10 C |
*MDL_Z_ROT :                     1C C | *MDMAP_BGTESTB :             9082A4 C |
*MDMAP_BGTESTT :             9092A4 C | *MDMDL_SETNEWCAMERA :        FF1C8E C |
*MDPAL_BGTESTB :             FF1D06 C | *MDPAL_BGTESTB.END :         FF1D44 C |
 MDRAMCODE :                    94A C |  MDRAMCODE_END :               24D4 C |
 MDRAM_START :             FFFF8800 - |  MD_BANK_SRAM :              A130F1 - |
 MD_ERRADDR :                   948 C |  MD_ERRBUS :                    948 C |
 MD_ERRCHK :                    948 C |  MD_ERRILL :                    948 C |
 MD_ERROREX :                   948 C |  MD_ERRORTRAP :                 948 C |
 MD_ERRPRIVL :                  948 C |  MD_ERRTRAPV :                  948 C |
 MD_ERRZDIV :                   948 C |  MD_LINE1010 :                  948 C |
 MD_LINE1111 :                  948 C |  MD_TRACE :                     948 C |
*MINFO_RAM_S :               FF0000 C |  MODE :                          18 - |
 MODE_INIT :                 FF1B5A C |  MODE_INIT.CLR :             FF1B68 C |
 MOMCPU :                     68000 - | *MOMCPUNAME :                 68000 - |
 MONOWIDTH :                     38 - |  MSCRL_BLKSIZE :                 10 - |
 MSCRL_HEIGHT :                 100 - |  MSCRL_WIDTH :                  150 - |
 MSTR_BGFILL :              600108E C |  MSTR_BGFILL.LEN_OFF :      600113E C |
 MSTR_BGFILL.NOT_HDN :      600112C C |  MSTR_BGFILL.NOXRES :       60010FE C |
 MSTR_BGFILL.NOYREST :      60010DE C |  MSTR_BGFILL.XBGRES :       6001110 C |
 MSTR_BGFILL.X_NXT :        600110A C |  MSTR_BGFILL.YBGRES :       60010EA C |
 MSTR_BGFILL.YLARG :        6001118 C |  MSTR_BGFILL.Y_NXT :        60010E4 C |
 MSTR_GFX0 :                6000D58 C |  MSTR_GFX0.BADP :           6000DFA C |
 MSTR_GFX0.FIND_TOP :       6000DCC C |  MSTR_GFX0.FIND_X :         6000DAC C |
 MSTR_GFX0.GO_RFLL :        6000D82 C |  MSTR_GFX0.IS_HIGH :        6000DDC C |
 MSTR_GFX0.IS_LOW :         6000DD4 C |  MSTR_GFX0.NO_NUM :         6000E00 C |
 MSTR_GFX0.NO_REDRAW :      6000D66 C | *MSTR_GFX0.NO_REQ :         6000E06 C |
 MSTR_GFX0.NXT_RFLL :       6000D88 C |  MSTR_GFX0.P2_RFL :         6000D7A C |
 MSTR_GFX0.TRINGL :         6000DA2 C |  MSTR_GFX0.XIS_HIGH :       6000DBC C |
 MSTR_GFX0.XIS_LOW :        6000DB4 C | *MSTR_GFX0_INIT :           6000D58 C |
 MSTR_MOVEBG :              600115C C |  MSTR_MOVEBG.NEGTV :        6001290 C |
 MSTR_MOVEBG.NEGTVL :       60012AC C |  MSTR_MOVEBG.POSTV :        600129C C |
 MSTR_MOVEBG.POSTVL :       60012B6 C |  MSTR_MOVEBG.REQD_B :       6001232 C |
 MSTR_MOVEBG.REQR_B :       60012DC C | *MSTR_MOVEBG.SKIPYSET :     600125C C |
 MSTR_MOVEBG.XEQU :         6001170 C |  MSTR_MOVEBG.X_STEND :      600118C C |
 MSTR_MOVEBG.YDL_BUSY :     60012F4 C |  MSTR_MOVEBG.YDR_BUSY :     6001256 C |
 MSTR_MOVEBG.YENEGTV :      60011F6 C |  MSTR_MOVEBG.YEPOSTV :      6001200 C |
 MSTR_MOVEBG.YEQU :         6001182 C |  MSTR_MOVEBG.YNEGTV :       60011C2 C |
 MSTR_MOVEBG.YNEGTVL :      60011DC C |  MSTR_MOVEBG.YPOSTV :       60011CC C |
 MSTR_MOVEBG.YPOSTVL :      60011E6 C |  MSTR_MOVEBG.YX_NEGTV :     600126C C |
 MSTR_MOVEBG.YX_POSTV :     6001276 C |  MSTR_MOVEBG.Y_STEND :      6001192 C |
 M_IRQ_BAD :                6000314 C |  M_IRQ_CMD :                6000334 C |
*M_IRQ_CMD.FINISH :         600034C C |  M_IRQ_CUSTOM :    FFFFFFFFC0000000 C |
 M_IRQ_CUSTOM.LIST :                                       FFFFFFFFC0000018 C |
 M_IRQ_CUSTOM.TAG_FRT :                                    FFFFFFFFC0000024 C |
 M_IRQ_H :                  6000368 C |  M_IRQ_PWM :                6000318 C |
 M_IRQ_V :                  6000384 C |  M_IRQ_V.COPY_PAL :         60003B8 C |
*M_IRQ_V.MID_PWRITE :       600042C C |  M_IRQ_V.WAIT :             6000398 C |
 M_IRQ_V.WAIT_FB :          6000392 C |  M_IRQ_VRES :               600044C C |
 M_IRQ_VRES.MARS_RESET :    600049E C |  M_IRQ_VRES.MD_RESET :      6000464 C |
 M_IRQ_VRES.SH_WAIT :       600046C C |  M_IRQ_VRES.VRESLOOP :      60004A6 C |
*NESTMAX :                      100 - |  ON_HOLD :                        2 C |
 ON_PRESS :                       4 C | *PACKING :                        0 - |
*PADDING :                        0 - | *PADDINGSOFAR :                   0 - |
 PAD_ID :                         0 C |  PAD_VER :                        1 C |
*PEN :                           20 - |  PLAYONCHIP :                   1E0 C |
 PLAYONCHIP.CONT_PSG :          2E6 C |  PLAYONCHIP.COPYBYTES :         3AA C |
 PLAYONCHIP.DAC_INS :           394 C |  PLAYONCHIP.DO_CHNL :           22D C |
 PLAYONCHIP.EFF_X_FM :          281 C |  PLAYONCHIP.FMPAN_LIST :        2A4 C |
 PLAYONCHIP.FM_EFF :            278 C |  PLAYONCHIP.FM_INS :            320 C |
 PLAYONCHIP.F_LP :              746 C |  PLAYONCHIP.GETOCT :            649 C |
 PLAYONCHIP.GET_INSTYPE :       6C6 C |  PLAYONCHIP.INS_NS :            2D7 C |
 PLAYONCHIP.INS_PSG :           2C3 C |  PLAYONCHIP.KEYOFF :            6AE C |
 PLAYONCHIP.L_LP :              724 C |  PLAYONCHIP.NEWP :              755 C |
 PLAYONCHIP.NGOOD :             740 C |  PLAYONCHIP.NOLNK :             743 C |
 PLAYONCHIP.NORMLPSG :          596 C |  PLAYONCHIP.NOTE_DAC :          6B9 C |
 PLAYONCHIP.NOTE_FM :           5CB C |  PLAYONCHIP.NOTE_FM3 :          6AD C |
 PLAYONCHIP.NOTE_PWM :          6C5 C |  PLAYONCHIP.NOTNSE :            4D7 C |
 PLAYONCHIP.NOTNSEV :           3D5 C |  PLAYONCHIP.NXT_CHNL :          1F6 C |
 PLAYONCHIP.NXT_TRACK :         1F2 C |  PLAYONCHIP.PNCONT :            4DA C |
 PLAYONCHIP.POFF :              5B3 C |  PLAYONCHIP.PSGCHNL3 :          58B C |
*PLAYONCHIP.PSGVOLTBL :         70A C |  PLAYONCHIP.PSTOP :             59B C |
 PLAYONCHIP.PVCONT :            3D8 C |  PLAYONCHIP.REQ_EFF :           25E C |
 PLAYONCHIP.REQ_INS :           2A8 C |  PLAYONCHIP.REQ_NOTE :          4AE C |
 PLAYONCHIP.REQ_VOL :           3B6 C |  PLAYONCHIP.SETGOOD :           762 C |
 PLAYONCHIP.SETLV :             356 C |  PLAYONCHIP.SRCH_CHNLTBL :      71B C |
 PLAYONCHIP.SRCH_FM :           6EA C | *PLAYONCHIP.SRCH_FM3 :          6F2 C |
*PLAYONCHIP.SRCH_FM6 :          6FA C |  PLAYONCHIP.SRCH_PSG :          6E2 C |
 PLAYONCHIP.SRCH_PSGN :         6DA C |  PLAYONCHIP.SRCH_PWM :          702 C |
 PLAYONCHIP.TLV_LV1 :           436 C |  PLAYONCHIP.TLV_LV2 :           45D C |
 PLAYONCHIP.TLV_LV2_OK :        454 C |  PLAYONCHIP.TLV_LV3 :           47C C |
 PLAYONCHIP.TLV_LV4 :           48F C |  PLAYONCHIP.VOL_FM :            3EE C |
 PLAYONCHIP.VOL_PWM :           495 C |  PLGN_TEXURE :                   80 - |
 PLGN_TRI :                      40 - |  PLYPZ_MTRL :                    34 C |
 PLYPZ_SRC_XL :                  14 C |  PLYPZ_SRC_XL_DX :               18 C |
 PLYPZ_SRC_XR :                  24 C |  PLYPZ_SRC_XR_DX :               28 C |
 PLYPZ_SRC_YL :                  1C C |  PLYPZ_SRC_YL_DX :               20 C |
 PLYPZ_SRC_YR :                  2C C |  PLYPZ_SRC_YR_DX :               30 C |
 PLYPZ_TYPE :                    38 C |  PLYPZ_XL :                       4 C |
 PLYPZ_XL_DX :                    8 C |  PLYPZ_XR :                       C C |
 PLYPZ_XR_DX :                   10 C |  PLYPZ_YPOS :                     0 C |
 POLYGN_MTRL :                    4 C |  POLYGN_POINTS :                  8 C |
*POLYGN_SRCPNTS :                18 C |  POLYGN_TYPE :                    0 C |
*PSGALV :                      125C C | *PSGATK :                      1240 C |
 PSGCOM :                      1238 C | *PSGDEC :                      1244 C |
*PSGDTH :                      1258 C | *PSGDTL :                      1254 C |
*PSGENV :                      1250 C |  PSGFREQ_LIST :                1080 C |
 PSGHATMODE :                    2F C | *PSGINS_00 :                   1286 C |
*PSGINS_01 :                   128B C | *PSGINS_02 :                   1290 C |
*PSGINS_03 :                   1295 C | *PSGINS_BASS :                 129A C |
*PSGINS_SNARE :                129F C | *PSGLEV :                      123C C |
 PSGNVTBL :                    118E C | *PSGRRT :                      124C C |
*PSGSLV :                      1248 C | *PSGTIM :                      1264 C |
 PSGVTBL :                     1172 C | *PSG_CTRL :                  C00011 - |
 PSG_ENV :                      CF0 C |  PSG_ENV.ATKEND :               D98 C |
 PSG_ENV.CHK2 :                 DA2 C |  PSG_ENV.CHK4 :                 DD6 C |
 PSG_ENV.CKOF :                 D15 C |  PSG_ENV.CKON :                 D27 C |
*PSG_ENV.DECTMR :               DA7 C |  PSG_ENV.DKADD :                DC0 C |
 PSG_ENV.DKSAV :                DC8 C |  PSG_ENV.DKYEND :               DCD C |
 PSG_ENV.ENVPROC :              D6E C |  PSG_ENV.FLGOFF :               E2E C |
 PSG_ENV.KILLENV :              DEB C |  PSG_ENV.NEXTPSG :              E15 C |
 PSG_ENV.NSKIP :                D66 C |  PSG_ENV.PSTEAL :               D57 C |
 PSG_ENV.SETHAT :               D61 C |  PSG_ENV.TNMODE :               D4B C |
 PSG_ENV.VEDLP :                DF8 C |  PSG_ENV.VLOOP :                CFB C |
 PSG_ENV.WRFREQ :               D3A C |  PUT_PIECE :                600080A C |
 PUT_PIECE.BAD_PIECE :      60008BA C |  PUT_PIECE.DONTRESET_PZ :   60008B2 C |
 PUT_PIECE.LEFTH :          600081A C |  PUT_PIECE.TOP_NEG :        600089C C |
*PWMCTL :                        31 - |  PWMINTCLR :                     1C - |
 PWMIRQ_ON :                      1 - |  PWMVTBL :                     11FF C |
 RAMCODE_USER :              FF1B8A C |  RAM_BGCAMCURR :   FFFFFFFFFFFF8C2C C |
*RAM_BGCAMERA :    FFFFFFFFFFFF8C2A C |  RAM_CAMDATA :     FFFFFFFFFFFF8C18 C |
 RAM_CAMFRAME :    FFFFFFFFFFFF8C1C C |  RAM_CAMSPEED :    FFFFFFFFFFFF8C24 C |
 RAM_CAMTIMER :    FFFFFFFFFFFF8C20 C |  RAM_CAM_XPOS :    FFFFFFFFFFFF8C00 C |
 RAM_CAM_XROT :    FFFFFFFFFFFF8C0C C |  RAM_CAM_YPOS :    FFFFFFFFFFFF8C04 C |
 RAM_CAM_YROT :    FFFFFFFFFFFF8C10 C |  RAM_CAM_ZPOS :    FFFFFFFFFFFF8C08 C |
 RAM_CAM_ZROT :    FFFFFFFFFFFF8C14 C |  RAM_FRAMECOUNT :  FFFFFFFFFFFF97F2 C |
 RAM_INITFLUG :    FFFFFFFFFFFF97FE C |  RAM_INPUTDATA :   FFFFFFFFFFFF91BA C |
*RAM_LAYOUT_X :    FFFFFFFFFFFF8C2E C | *RAM_LAYOUT_Y :    FFFFFFFFFFFF8C30 C |
*RAM_MARSFADE :    FFFFFFFFFFFF8A00 C | *RAM_MARSPAL :     FFFFFFFFFFFF8800 C |
 RAM_MARS_GLOBAL :          6004390 C |  RAM_MARS_LINESCROLL :      600447C C |
*RAM_MARS_OBJCAMERA :       6004A3C C | *RAM_MARS_OBJLAYOUT :       6004A64 C |
 RAM_MARS_PALETTE :         600483C C |  RAM_MARS_PLGNNUM_0 :       600A784 C |
 RAM_MARS_PLGNNUM_1 :       600A786 C |  RAM_MARS_PLGN_ZLIST_0 :    6009F84 C |
 RAM_MARS_PLGN_ZLIST_1 :    600A384 C | *RAM_MARS_POLYGONS_0 :      6004A84 C |
*RAM_MARS_POLYGONS_1 :      6005E84 C |  RAM_MARS_VDPDRWLIST :      6007284 C |
 RAM_MARS_VDPDRWLIST_E :    6009F84 C |  RAM_MDGLOBAL :    FFFFFFFFFFFF9814 C |
 RAM_MDLCURRMD :   FFFFFFFFFFFF8C28 C |  RAM_MDMARSHINT :  FFFFFFFFFFFF9808 C |
 RAM_MDMARSTCNTM : FFFFFFFFFFFF980E C |  RAM_MDMARSTCNTS : FFFFFFFFFFFF9810 C |
 RAM_MDMARSTSKM :  FFFFFFFFFFFF93D2 C |  RAM_MDMARSTSKS :  FFFFFFFFFFFF95D2 C |
 RAM_MDMARSTSSGL : FFFFFFFFFFFF97D2 C |  RAM_MDMARSVINT :  FFFFFFFFFFFF9802 C |
 RAM_MDSOUND :     FFFFFFFFFFFF9000 C |  RAM_MDSYSTEM :    FFFFFFFFFFFF91BA C |
 RAM_MDVIDEO :     FFFFFFFFFFFF9020 C |  RAM_MODEBUFF :    FFFFFFFFFFFF8800 C |
*RAM_SAVEDATA :    FFFFFFFFFFFF91D2 C |  RAM_SNDSAVEREG :  FFFFFFFFFFFF9000 C |
*RAM_SYSFLAGS :    FFFFFFFFFFFF9812 C |  RAM_SYSRANDSEED : FFFFFFFFFFFF97FA C |
 RAM_SYSRANDVAL :  FFFFFFFFFFFF97F6 C |  RAM_VDPREGS :     FFFFFFFFFFFF91A2 C |
 RAM_VIDPRNTLIST : FFFFFFFFFFFF9022 C |  RAM_VIDPRNTVRAM : FFFFFFFFFFFF9020 C |
 RCHWIDTH :                      36 - | *RELAXED :                        0 - |
 REQSAMPL :                      34 C |  ROM_END :                    9C4B0 C |
 ROTATE_POINT :             60014A4 C |  ROT_ANGLE :                60014A0 C |
 RRT :                           14 - |  SAMPL_MAGIC1 :              90A2A4 C |
 SAMPL_MAGIC1_END :          923132 C |  SAMPL_MAGIC2 :              923132 C |
 SAMPL_MAGIC2_END :          93BF66 C |  SAMPL_MYTIME :              93BF66 C |
 SAMPL_MYTIME_END :          946F3B C |  SBEATACC :                      1F C |
 SBEATPTCK :                     1D C |  SCREEN_HEIGHT :                 E0 - |
 SCREEN_WIDTH :                 140 - |  SET_LEFT :                 60006E0 C |
 SET_LEFT.LFT_OK :          6000702 C |  SET_LEFT.LFT_SKIP :        6000762 C |
 SET_RIGHT :                6000768 C |  SET_RIGHT.RGT_OK :         600078A C |
 SET_RIGHT.RGT_SKIP :       60007EA C | *SET_TEMPO :                    BDA C |
 SH2_ERROR :                600030C C |  SH2_MASTER :               6000000 C |
 SH2_M_ENTRY :              6000C84 C |  SH2_M_ENTRY.WAIT_MD :      6000CB4 C |
 SH2_M_ENTRY.WAIT_SLAVE :   6000CBE C |  SH2_M_HOTSTART :           6000CCA C |
 SH2_M_HOTSTART.COPY :      6000CEA C |  SH2_M_HOTSTART.COPYLN :    6000D06 C |
 SH2_RAM :                  6004390 C |  SH2_SLAVE :                6000124 C |
 SH2_S_ENTRY :              600131C C |  SH2_S_ENTRY.WAIT_MD :      600134C C |
 SH2_S_HOTSTART :           6001358 C |  SH2_S_HOTSTART.COPY :      6001378 C |
 SH2_S_HOTSTART.LEL :       600138E C |  SHIFT :                          2 - |
 SIN_TABLE :                6001B8C C |  SIZEOF_CAMERA :                 28 C |
 SIZEOF_INPUT :                   6 C |  SIZEOF_LAYOUT :                 20 C |
 SIZEOF_MARSGBL :                76 C | *SIZEOF_MARSRAM :           600A8A0 C |
*SIZEOF_MARSRAM.HERE :      600A8A0 C |  SIZEOF_MARSSND :           600A8A0 C |
 SIZEOF_MARSSYS :           600447C C |  SIZEOF_MARSVID :           600A788 C |
 SIZEOF_MDGLBL :   FFFFFFFFFFFF8C32 C | *SIZEOF_MDLOBJ :                 30 C |
 SIZEOF_MDRAM :    FFFFFFFFFFFF8C32 C |  SIZEOF_MDSND :    FFFFFFFFFFFF9020 C |
 SIZEOF_MDSYS :    FFFFFFFFFFFF9814 C |  SIZEOF_MDVID :    FFFFFFFFFFFF91BA C |
 SIZEOF_PLYPZ :                  3C C |  SIZEOF_POLYGN :                 28 C |
 SIZEOF_SNDCHN :                 24 C |  SLAVE_IRQ :                60002AC C |
 SLAVE_LOOP :               600139A C |  SLAVE_LOOP.WAIT_DRW :      6001418 C |
 SLV :                           10 - |  SNDLOCKZ80 :                FF0150 C |
 SNDLOCKZ80.WAIT :           FF0158 C |  SNDREQ_ENTER :              FF0170 C |
 SNDREQ_ENTER.WAIT :         FF0196 C |  SNDREQ_EXIT :               FF01A6 C |
 SNDREQ_SADDR :              FF01CE C |  SNDREQ_SBYTE :              FF01D6 C |
 SNDREQ_SCMD :               FF01BC C | *SNDREQ_SLONG :              FF01CA C |
 SNDREQ_SWORD :              FF01D2 C | *SNDSENDCMD :                FF016E C |
 SNDUNLOCKZ80 :              FF0164 C | *SOUNDREQ_SETSAMPLE :        FF0126 C |
*SOUNDREQ_SETTRACK :         FF00FA C | *SOUND_DMA_PAUSE :           FF0090 C |
 SOUND_DMA_PAUSE.RETRY :     FF0096 C |  SOUND_DMA_PAUSE.SAFE :      FF00C2 C |
 SOUND_DMA_PAUSE.WAIT :      FF009E C | *SOUND_DMA_RESUME :          FF00CE C |
 SOUND_INIT :                FF0036 C |  SOUND_INIT.CLEANUP :        FF005C C |
 SOUND_INIT.COPY :           FF0072 C |  SOUND_INIT.WAIT :           FF0046 C |
*SOUND_REQUEST :             FF00E6 C |  STANDBY :                        2 - |
 STR_STATUS :                FF1CCE C | *SYSMARS_ID :                A130EC - |
 SYSMARS_REG :               A15100 - |  SYSMDMARS_INSTASK :         FF1AD8 C |
 SYSMDMARS_INSTASK.RAN_OUT : FF1AE8 C |  SYSMDMARS_TRANSFER :        FF1AEA C |
 SYSMDMARS_TRANSFER.EXIT :   FF1B52 C |  SYSMDMARS_TRANSFER.LOOP :   FF1B20 C |
*SYSMDMARS_TRANSFER.MID_WRITE :                                      FF1B58 C |
 SYSMDMARS_TRANSFER.WAIT_CMD :                                       FF1B18 C |
 SYSTEM_INIT :               FF17BC C |  SYSTEM_INIT.CLRINPUT :      FF17FA C |
 SYSTEM_INIT.WAIT :          FF17CA C |  SYSTEM_INPUT :              FF183E C |
 SYSTEM_INPUT.EXIT :         FF186C C |  SYSTEM_INPUT.ID_0D :        FF1892 C |
 SYSTEM_INPUT.LIST :         FF1872 C |  SYSTEM_INPUT.OLDPAD :       FF18F0 C |
 SYSTEM_INPUT.PICK_ID :      FF1928 C |  SYSTEM_INPUT.READ :         FF193E C |
 SYSTEM_INPUT.STEP_1 :       FF194A C |  SYSTEM_INPUT.STEP_2 :       FF1956 C |
 SYSTEM_INPUT.THIS_ONE :     FF1852 C | *SYSTEM_INPUT.WAIT :         FF183E C |
 SYSTEM_JUMPRAMCODE :        FF19EC C |
 SYSTEM_JUMPRAMCODE.COPYME2 :                                        FF19FE C |
*SYSTEM_MDMARS_MSTADDTASK :  FF1A0A C | *SYSTEM_MDMARS_MSTSENDALL :  FF1A56 C |
*SYSTEM_MDMARS_MSTSENDDROP : FF1A86 C |
 SYSTEM_MDMARS_MSTSENDDROP.GO_M :                                    FF1AA6 C |
*SYSTEM_MDMARS_MSTTASK :     FF1A22 C | *SYSTEM_MDMARS_SLVADDTASK :  FF1A16 C |
*SYSTEM_MDMARS_SLVSENDALL :  FF1A6E C | *SYSTEM_MDMARS_SLVSENDDROP : FF1AAC C |
 SYSTEM_MDMARS_SLVSENDDROP.GO_S :                                    FF1ACE C |
*SYSTEM_MDMARS_SLVTASK :     FF1A3C C | *SYSTEM_RANDOM :             FF1958 C |
 SYSTEM_SETINTS :            FF1976 C |  SYSTEM_SETINTS.NOHINT :     FF199A C |
 SYSTEM_SETINTS.NOVINT :     FF1988 C | *SYSTEM_SRAMINIT :           FF199C C |
 SYSTEM_SRAMINIT.INITSAVE :  FF19B0 C |  SYSTEM_VSYNC :              FF19C4 C |
 SYSTEM_VSYNC.INSIDE :       FF19DE C |  SYS_CTRL_1 :                A10009 - |
 SYS_CTRL_2 :                A1000B - |  SYS_CTRL_3 :                A1000D - |
*SYS_DATA_1 :                A10003 - | *SYS_DATA_2 :                A10005 - |
*SYS_DATA_3 :                A10007 - | *SYS_EXRAM :                 200000 - |
*SYS_IO :                    A10001 - | *SYS_TMSS :                  A14000 - |
 S_IRQ_BAD :                60004CE C |  S_IRQ_CMD :                60004F8 C |
 S_IRQ_CUSTOM :             6001510 C |  S_IRQ_CUSTOM.NO_FACES :    6001560 C |
 S_IRQ_CUSTOM.NO_REQ :      6001564 C |  S_IRQ_CUSTOM.PAGE_2 :      600153E C |
 S_IRQ_CUSTOM.Z_KEEP :      600155A C |  S_IRQ_CUSTOM.Z_NEXT :      6001546 C |
 S_IRQ_H :                  6000530 C |  S_IRQ_PWM :                60004D4 C |
 S_IRQ_PWM.EXIT :           60004E6 C |  S_IRQ_V :                  600054C C |
 S_IRQ_VRES :               6000560 C |  S_IRQ_VRES.MARS_RESET :    60005AA C |
 S_IRQ_VRES.MD_RESET :      6000578 C |  S_IRQ_VRES.SH_WAIT :       6000584 C |
 S_IRQ_VRES.VRESLOOP :      60005B2 C |  TESTMARS_BG :              20512B0 C |
 TESTMARS_BG_PAL :          209C2B0 C |  TH :                      20000000 - |
*THISCODE_TOP :              FF1B8A C | *THISCODE_TOP.BUSY :         FF1C8C C |
*THISCODE_TOP.BUSY_MSTR :    FF1C8C C |  THISCODE_TOP.INSIDE :       FF1BB6 C |
 THISCODE_TOP.LIST :         FF1C04 C |  THISCODE_TOP.LOOP :         FF1BA6 C |
 THISCODE_TOP.MODE0 :        FF1C10 C |  THISCODE_TOP.MODE0_LOOP :   FF1C34 C |
 THISCODE_TOP.NO_DW :        FF1C6C C |  THISCODE_TOP.NO_LF :        FF1C76 C |
 THISCODE_TOP.NO_RF :        FF1C80 C |  THISCODE_TOP.NO_UP :        FF1C62 C |
 THISCODE_TOP.NO_X :         FF1C48 C |  THISCODE_TOP.NO_Y :         FF1C54 C |
*THIS_POLYGON :             6001478 C |  TICKCNT :                       1C C |
 TICKFLAG :                      1A C | *TIME :                    21:49:44 - |
 TIMERCTL :                      30 - | *TMR :                           2C - |
 TRANSFERROM :                  BFB C |  TRANSFERROM.DOUBLE :           C1C C |
 TRANSFERROM.TRANSFER :         C45 C |  TRANSFERROM.X68KLAST :         C88 C |
 TRANSFERROM.X68KLOOP :         C74 C |  TRANSFERROM.X68KLPCONT :       C7C C |
 TRANSFERROM.X68KLPWT :         C9C C |  TRANSFERROM.X68KLSTCONT :      C92 C |
 TRANSFERROM.X68KLSTWT :        CB1 C |  TRANSFERROM.X68KLSTWTLP :      CB5 C |
 TRANSFERROM.X68KNOCARRY :      C3F C |  TRANSFERROM.X68KPWTLP :        CA0 C |
 TRKBUFF :                     1800 C |  TRKDATAC :                    1600 C |
 TRK_CURRBLK :                   11 - |  TRK_HALFWAY :                   10 - |
 TRK_READ :                       C - |  TRK_ROMBLK :                     0 - |
 TRK_ROMINS :                     6 - |  TRK_ROMPATT :                    3 - |
 TRK_ROMPATTRD :                  9 - |  TRK_ROWS :                       E - |
 TRK_SETBLK :                    12 - |  TRK_STATUS :                    13 - |
 TRK_TICKSET :                   15 - |  TRK_TICKTMR :                   14 - |
*TRUE :                           1 - |  TSK00_EXIT :      FFFFFFFFC00001A8 C |
 TSK00_GONEXT :    FFFFFFFFC00001A4 C | *TVMODE :                         0 - |
 UPDTRACK :                     764 C |  UPDTRACK.CHLST_UNLK :          B28 C |
 UPDTRACK.CLRF :                9D3 C |  UPDTRACK.CLRF2 :               907 C |
 UPDTRACK.CLRFE :               9AB C |  UPDTRACK.DECROW :              8A9 C |
 UPDTRACK.EFF_B :               8F2 C |  UPDTRACK.EXIT :                8A0 C |
 UPDTRACK.FIRST_FILL :          9BA C |  UPDTRACK.INC_CPATT :           8B4 C |
 UPDTRACK.IS_NOTE :             802 C |  UPDTRACK.NEXT :                781 C |
 UPDTRACK.NEXT_NOTE :           7F1 C |  UPDTRACK.NEXT_TRACK :          921 C |
 UPDTRACK.NO_EFF :              869 C |  UPDTRACK.NO_INS :              84A C |
 UPDTRACK.NO_NOTE :             83E C |  UPDTRACK.NO_UPDST :            897 C |
 UPDTRACK.NO_VOL :              856 C |  UPDTRACK.OLD_TYPE :            82F C |
 UPDTRACK.READ_TRACK :          7AF C |  UPDTRACK.SET_TRACK :           928 C |
 UPDTRACK.SFXMD :               7C3 C |  UPDTRACK.SILNC_CHIP :          A9F C |
 UPDTRACK.SIL_FM :              AE6 C |  UPDTRACK.TRACK_END :           99C C |
 UPDTRACK.UNLKNOW :             AC8 C |  VARNULLVRAM :                  7FF - |
*VAR_MOVESPD :                 4000 - | *VBLK :                          80 - |
 VDPSTS :                         A - |  VDP_CTRL :                  C00004 - |
 VDP_DATA :                  C00000 - | *VERSION :                     142F - |
*VIDEO_AUTOMAP_VERT :        FF037A C |  VIDEO_AUTOMAP_VERT.XLOOP :  FF038A C |
 VIDEO_AUTOMAP_VERT.YLOOP :  FF039C C |  VIDEO_CLEAR :               FF021A C |
*VIDEO_COPY :                FF0628 C |  VIDEO_COPY.DMAW :           FF063C C |
 VIDEO_COPY.DMAWE :          FF0696 C |  VIDEO_FILL :                FF05B4 C |
 VIDEO_FILL.DMAW :           FF05C8 C |  VIDEO_FILL.DMAWE :          FF0610 C |
 VIDEO_INIT :                FF01E4 C |  VIDEO_INIT.CLRRAM :         FF01EE C |
*VIDEO_INIT.EXIT :           FF0218 C |  VIDEO_INIT.LOOP :           FF020A C |
 VIDEO_LOADART :             FF06AE C |  VIDEO_LOADART.FROM_RAM :    FF0776 C |
 VIDEO_LOADART.WAIT :        FF0726 C | *VIDEO_LOADMAP :             FF02B2 C |
 VIDEO_LOADMAP.CONT :        FF02D8 C |  VIDEO_LOADMAP.NODBLE :      FF02F8 C |
 VIDEO_LOADMAP.NONULL :      FF02D6 C |  VIDEO_LOADMAP.XLOOP :       FF02C8 C |
 VIDEO_LOADMAP.YLOOP :       FF02BE C | *VIDEO_LOADMAP_VERT :        FF030A C |
 VIDEO_LOADMAP_VERT.CONT :   FF033E C |  VIDEO_LOADMAP_VERT.NODBLE : FF0360 C |
 VIDEO_LOADMAP_VERT.NONULL : FF033C C | *VIDEO_LOADMAP_VERT.OUTDBL : FF036A C |
 VIDEO_LOADMAP_VERT.XLOOP :  FF0318 C |  VIDEO_LOADMAP_VERT.YLOOP :  FF032A C |
 VIDEO_LOADPAL :             FF0288 C |  VIDEO_LOADPAL.LOOP :        FF02AA C |
 VIDEO_LOADPAL.OUTV :        FF02A0 C |  VIDEO_PRINT :               FF03E0 C |
 VIDEO_PRINT.DONIBL :        FF04FA C |  VIDEO_PRINT.EXIT :          FF046A C |
 VIDEO_PRINT.ISBYTE :        FF0434 C |  VIDEO_PRINT.ISLONG :        FF0458 C |
 VIDEO_PRINT.ISWORD :        FF0446 C |  VIDEO_PRINT.LNGLOOP :       FF04EA C |
 VIDEO_PRINT.LOOP :          FF03F4 C |  VIDEO_PRINT.LOWR :          FF050A C |
 VIDEO_PRINT.NEWJUMP :       FF03EE C |  VIDEO_PRINT.NEXT :          FF0416 C |
 VIDEO_PRINT.NEXTV :         FF0474 C |  VIDEO_PRINT.NOTHING :       FF0516 C |
 VIDEO_PRINT.PUTTEXT :       FF0408 C |  VIDEO_PRINT.SPECIAL :       FF041A C |
 VIDEO_PRINT.VBYTE :         FF04A6 C |  VIDEO_PRINT.VLONG :         FF04F2 C |
 VIDEO_PRINT.VWORD :         FF04C8 C |  VIDEO_PRINTINIT :           FF03BC C |
 VIDEO_UPDATE :              FF0268 C | *VIDEO_UPDATE.EXIT :         FF0286 C |
 VIDEO_UPDATE.LOOP :         FF027A C |  VID_PICKLAYER :             FF0518 C |
 VID_PICKLAYER.GOLYR :       FF0568 C |  VID_PICKLAYER.NOWD :        FF0552 C |
 VID_PICKLAYER.PLAWND :      FF0540 C |  VID_PICKLAYER.THISSZ :      FF0588 C |
 VID_PICKLAYER.THISSZJ :     FF05B0 C |  VINTCLR :                       16 - |
*VINTENBL :                      20 - |  VINT_DEFAULT :              FF1B70 C |
 VIRQ_ON :                        8 - |  VRESINTCLR :                    14 - |
 WAVE_FLAGS :                    13 C |  WAVE_LEN :                       B C |
 WAVE_LOOP :                      E C |  WAVE_PITCH :                    11 C |
 WAVE_START :                     8 C | *WAVFREQ_PWM :                  F78 C |
*WHDFLG :                      1260 C |  X68KSRCLSB :                    29 C |
 X68KSRCMID :                    2A C | *YM_CTRL_1 :                 A04000 - |
*YM_CTRL_2 :                 A04002 - | *YM_DATA_1 :                 A04001 - |
*YM_DATA_2 :                 A04003 - |  Z80_BUS :                   A11100 - |
 Z80_CODE :                    2500 C |  Z80_CODE_END :                4240 C |
 Z80_CPU :                   A00000 - |  Z80_INIT :                      3E C |
 Z80_RESET :                 A11200 - | *ZBANK :                       6000 - |
*ZOPCEX :                         8 - |  ZOPCEXX :                       D9 - |
*ZOPCNOP :                        0 - |  ZOPCPUSHAF :                    F5 - |
 ZOPCRET :                       C9 - |  ZPSG_CTRL :                   7F11 - |
 ZYM_CTRL_1 :                  4000 - |  ZYM_CTRL_2 :                  4002 - |
 ZYM_DATA_1 :                  4001 - |  ZYM_DATA_2 :                  4003 - |
 _CCR :                    FFFFFE92 - |  _DMACHANNEL0 :            FFFFFF8C - |
*_DMACHANNEL1 :            FFFFFF9C - | *_DMACOUNT0 :              FFFFFF88 - |
*_DMACOUNT1 :              FFFFFF98 - | *_DMADEST0 :               FFFFFF84 - |
*_DMADEST1 :               FFFFFF94 - |  _DMAOPERATION :           FFFFFFB0 - |
*_DMAREQACK0 :             FFFFFFB4 - | *_DMAREQACK1 :             FFFFFFB8 - |
*_DMASOURCE0 :             FFFFFF80 - | *_DMASOURCE1 :             FFFFFF90 - |
*_DMAVECTORE0 :            FFFFFFA4 - | *_DMAVECTORE1 :            FFFFFFAC - |
*_DMAVECTORN0 :            FFFFFFA0 - | *_DMAVECTORN1 :            FFFFFFA8 - |
 _FRAMEBUFFER :            24000000 - | *_FRC_H :                         2 - |
*_FRC_L :                         3 - |  _FRT :                    FFFFFE10 - |
*_HRH :                    FFFFFF10 - | *_HRL :                    FFFFFF14 - |
*_HRL32 :                  FFFFFF04 - |  _JR :                     FFFFFF00 - |
*_OCR_H :                         4 - | *_OCR_L :                         5 - |
 _OVERWRITE :              24020000 - |  _PALETTE :                20004200 - |
*_SERIAL :                 FFFFFE00 - |  _SYSREG :                 20004000 - |
*_TCR :                           6 - | *_TCSR :                          1 - |
*_TIER :                          0 - |  _TOCR :                          7 - |
 _VDPREG :                 20004100 - |

   1396 symbols
    276 unused symbols

 AS V1.42 Beta [Bld 118] - source file mars.asm - page 3 - 8/28/2021 21:49:44


  defined macros:
  ---------------

FINISH                                | GEMAINSDAC                           
GEMAINSFM                             | GEMAINSFM3                           
GEMAINSNULL                           | GEMAINSPSG                           
GEMAINSPSGN                           | ORG                                  
STRUCT                                | ZSMPL                                

     10 macros

 AS V1.42 Beta [Bld 118] - source file mars.asm - page 4 - 8/28/2021 21:49:44


  defined functions:
  ------------------

NOTZ80                                | LOCATE                               
MAPSIZE                               |

 AS V1.42 Beta [Bld 118] - source file mars.asm - page 5 - 8/28/2021 21:49:44


  codepages:
  ----------

STANDARD (0 changed characters)


0.20 seconds assembly time

  13387 lines source file
  13721 lines incl. macro expansions
      7 passes
      0 errors
      0 warnings
