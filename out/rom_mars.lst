 AS V1.42 Beta [Bld 118] - source file mars.asm - page 1 - 12/10/2021 18:46:49


       1/       0 :                     ; ===========================================================================
       2/       0 :                     ; +-----------------------------------------------------------------+
       3/       0 :                     ; PROJECT MARSIANO
       4/       0 :                     ; +-----------------------------------------------------------------+
       5/       0 :                     
       6/       0 :                     		include	"system/macros.asm"	; Assembler macros
(1)    1/       0 :                     ; ===========================================================================
(1)    2/       0 :                     ; ----------------------------------------------------------------
(1)    3/       0 :                     ; MACROS
(1)    4/       0 :                     ; ----------------------------------------------------------------
(1)    5/       0 :                     
(1)    6/       0 :                     ; --------------------------------------------------------
(1)    7/       0 :                     ; AS Main settings
(1)    8/       0 :                     ; --------------------------------------------------------
(1)    9/       0 :                     
(1)   10/       0 :                     		!org 0				; Start at 0
(1)   11/       0 :                     		cpu 		68000		; Current CPU is 68k, gets changed later
(1)   12/       0 :                     		padding		off		; Dont pad dc.b
(1)   13/       0 :                     		listing 	purecode	; Want listing file, but only the final code in expanded macros
(1)   14/       0 :                     		supmode 	on 		; Supervisor mode
(1)   15/       0 :                     		dottedstructs	off		; If needed
(1)   16/       0 :                     		page 		0
(1)   17/       0 :                     
(1)   18/       0 :                     ; ====================================================================
(1)   19/       0 :                     ; ---------------------------------------------
(1)   20/       0 :                     ; Functions
(1)   21/       0 :                     ; ---------------------------------------------
(1)   22/       0 :                     
(1)   23/       0 :                     ; doubleword 	function l,r,(l<<16&$FFFF0000|r&$FFFF)			; LLLL RRRR
(1)   24/       0 :                     mapsize		function l,r,(((l-1)/8)<<16&$FFFF0000|((r-1)/8)&$FFFF)	; for cells w/h use doubleword
(1)   25/       0 :                     locate		function a,b,c,(c&$FF)|(b<<8&$FF00)|(a<<16&$FF0000)	; VDP locate: Layer|X pos|Y pos for some video routines
(1)   26/       0 :                     
(1)   27/       0 :                     ; ====================================================================
(1)   28/       0 :                     ; ---------------------------------------------
(1)   29/       0 :                     ; Macros
(1)   30/       0 :                     ; ---------------------------------------------
(1)   31/       0 :                     
(1)   32/       0 : =$0                 paddingSoFar set 0
(1)   33/       0 :                     notZ80 function cpu,(cpu<>128)&&(cpu<>32988)
(1)   34/       0 :                     
(1)   35/       0 :                     ; -------------------------------------
(1)   36/       0 :                     ; Reserve memory section
(1)   37/       0 :                     ;
(1)   38/       0 :                     ; NOTE: This doesn't work for Z80
(1)   39/       0 :                     ; -------------------------------------
(1)   40/       0 :                     
(1)   41/       0 :                     struct		macro thisinput			; Reserve memory address
(1)   42/       0 :                     GLBL_LASTPC	set *
(1)   43/       0 :                     		dephase
(1)   44/       0 :                     GLBL_LASTORG	set *
(1)   45/       0 :                     		phase thisinput
(1)   46/       0 :                     		endm
(1)   47/       0 :                     		
(1)   48/       0 :                     ; -------------------------------------
(1)   49/       0 :                     ; Finish
(1)   50/       0 :                     ; -------------------------------------
(1)   51/       0 :                     
(1)   52/       0 :                     finish		macro				; Then finish custom struct.
(1)   53/       0 :                     		!org GLBL_LASTORG
(1)   54/       0 :                     		phase GLBL_LASTPC
(1)   55/       0 :                     		endm
(1)   56/       0 :                     
(1)   57/       0 :                     ; -------------------------------------
(1)   58/       0 :                     ; Custom ORG
(1)   59/       0 :                     ;
(1)   60/       0 :                     ; (from s2disasm)
(1)   61/       0 :                     ; -------------------------------------
(1)   62/       0 :                     
(1)   63/       0 :                     org macro address
(1)   64/       0 :                     	if notZ80(MOMCPU)
(1)   65/       0 :                     		if address < *
(1)   66/       0 :                     			error "too much stuff before org $\{address} ($\{(*-address)} bytes)"
(1)   67/       0 :                     		elseif address > *
(1)   68/       0 :                     paddingSoFar	set paddingSoFar + address - *
(1)   69/       0 :                     			!org address
(1)   70/       0 :                     		endif
(1)   71/       0 :                     	else
(1)   72/       0 :                     		if address < $
(1)   73/       0 :                     			error "too much stuff before org 0\{address}h (0\{($-address)}h bytes)"
(1)   74/       0 :                     		else
(1)   75/       0 :                     			while address > $
(1)   76/       0 :                     				db 0
(1)   77/       0 :                     			endm
(1)   78/       0 :                     		endif
(1)   79/       0 :                     	endif
(1)   80/       0 :                         endm
(1)   81/       0 :                     
       7/       0 :                     		include	"system/md/const.asm"	; MD variables and shared vars
(1)    1/       0 :                     ; ====================================================================
(1)    2/       0 :                     ; ----------------------------------------------------------------
(1)    3/       0 :                     ; MD/MARS shared constants
(1)    4/       0 :                     ; ----------------------------------------------------------------
(1)    5/       0 :                     
(1)    6/       0 : =$10                MAX_MDDMATSK	equ 16			; MAX DMA transfer requests for VBlank
(1)    7/       0 :                     
(1)    8/       0 :                     ; ====================================================================
(1)    9/       0 :                     ; --------------------------------------------------------
(1)   10/       0 :                     ; Settings
(1)   11/       0 :                     ; --------------------------------------------------------
(1)   12/       0 :                     
(1)   13/       0 : =$FFFFC000          MDRAM_START	equ $FFFFC000		; Start of working MD RAM (below that is for CODE or decompression output)
(1)   14/       0 : =$800               MAX_MDERAM	equ $800		; MAX RAM for current screen mode (title,menu,or gameplay...)
(1)   15/       0 : =$7FF               varNullVram	equ $7FF		; Default Blank tile for some video routines
(1)   16/       0 :                     
(1)   17/       0 :                     ; ====================================================================
(1)   18/       0 :                     ; ----------------------------------------------------------------
(1)   19/       0 :                     ; Structures
(1)   20/       0 :                     ; ----------------------------------------------------------------
(1)   21/       0 :                     
(1)   22/       0 :                     ; --------------------------------------------------------
(1)   23/       0 :                     ; Variables
(1)   24/       0 :                     ; --------------------------------------------------------
(1)   25/       0 :                     
(1)   26/       0 :                     ; Read as (Controller_1)
(1)   27/       0 : =$FFFFFFFFFF..      Controller_1	equ RAM_InputData
(1)   28/       0 : =$FFFFFFFFFF..      Controller_2	equ RAM_InputData+sizeof_input
(1)   29/       0 :                     
(1)   30/       0 :                     ; read as full WORD (on_hold or on_press)
(1)   31/       0 : =$1                 JoyUp		equ $0001
(1)   32/       0 : =$2                 JoyDown		equ $0002
(1)   33/       0 : =$4                 JoyLeft		equ $0004
(1)   34/       0 : =$8                 JoyRight	equ $0008
(1)   35/       0 : =$10                JoyB		equ $0010
(1)   36/       0 : =$20                JoyC		equ $0020
(1)   37/       0 : =$40                JoyA		equ $0040
(1)   38/       0 : =$80                JoyStart	equ $0080
(1)   39/       0 : =$100               JoyZ		equ $0100
(1)   40/       0 : =$200               JoyY		equ $0200
(1)   41/       0 : =$400               JoyX		equ $0400
(1)   42/       0 : =$800               JoyMode		equ $0800
(1)   43/       0 :                     
(1)   44/       0 :                     ; right byte $00xx
(1)   45/       0 : =$0                 bitJoyUp	equ 0
(1)   46/       0 : =$1                 bitJoyDown	equ 1
(1)   47/       0 : =$2                 bitJoyLeft	equ 2
(1)   48/       0 : =$3                 bitJoyRight	equ 3
(1)   49/       0 : =$4                 bitJoyB		equ 4
(1)   50/       0 : =$5                 bitJoyC		equ 5
(1)   51/       0 : =$6                 bitJoyA		equ 6
(1)   52/       0 : =$7                 bitJoyStart	equ 7
(1)   53/       0 :                     
(1)   54/       0 :                     ; left byte $xx00
(1)   55/       0 : =$0                 bitJoyZ		equ 0
(1)   56/       0 : =$1                 bitJoyY		equ 1
(1)   57/       0 : =$2                 bitJoyX		equ 2
(1)   58/       0 : =$3                 bitJoyMode	equ 3
(1)   59/       0 :                     
(1)   60/       0 :                     ; Controller buffer data (after calling System_Input)
(1)   61/       0 : (MACRO)             		struct 0
(1)   61/       0 : =$0                 GLBL_LASTPC     set *
(1)   61/       0 :                                     dephase
(1)   61/       0 : =$0                 GLBL_LASTORG    set *
(1)   61/       0 :                                     phase 0
(1)   62/       0 :                     pad_id		ds.b 1			; Controller ID
(1)   63/       1 :                     pad_ver		ds.b 1			; Controller type/revision: (ex. 0-3button 1-6button)
(1)   64/       2 :                     on_hold		ds.w 1			; User HOLD bits
(1)   65/       4 :                     on_press	ds.w 1			; User PRESSED bits
(1)   66/       6 :                     sizeof_input	ds.l 0
(1)   67/       8 : (MACRO)             		finish
(1)   67/       0 :                                     !org GLBL_LASTORG
(1)   67/       0 :                                     phase GLBL_LASTPC
(1)   68/       0 :                     
(1)   69/       0 :                     ; ====================================================================
(1)   70/       0 :                     ; ----------------------------------------------------------------
(1)   71/       0 :                     ; System RAM
(1)   72/       0 :                     ; ----------------------------------------------------------------
(1)   73/       0 :                     
(1)   74/       0 : (MACRO)             		struct RAM_MdSystem
(1)   74/       0 : =$0                 GLBL_LASTPC     set *
(1)   74/       0 :                                     dephase
(1)   74/       0 : =$0                 GLBL_LASTORG    set *
(1)   74/FFFFFFFFFFFFD30E :                                     phase RAM_MDSYSTEM
(1)   75/FFFFFFFFFFFFD30E :                     RAM_MdMarsDreq	ds.l 128			; RAM sent to Master CPU using DREQ
(1)   76/FFFFFFFFFFFFD50E :                     RAM_InputData	ds.b sizeof_input*4		; Input data section
(1)   77/FFFFFFFFFFFFD526 :                     RAM_SaveData	ds.b $200			; SRAM data cache
(1)   78/FFFFFFFFFFFFD726 :                     RAM_Objects	ds.b $10*32
(1)   79/FFFFFFFFFFFFD926 :                     RAM_FrameCount	ds.l 1				; Global frame counter
(1)   80/FFFFFFFFFFFFD92A :                     RAM_SysRandVal	ds.l 1				; Random value
(1)   81/FFFFFFFFFFFFD92E :                     RAM_SysRandSeed	ds.l 1				; Randomness seed
(1)   82/FFFFFFFFFFFFD932 :                     RAM_initflug	ds.l 1				; "INIT" flag
(1)   83/FFFFFFFFFFFFD936 :                     RAM_MdMarsVInt	ds.w 3				; VBlank jump (JMP xxxx xxxx)
(1)   84/FFFFFFFFFFFFD93C :                     RAM_MdMarsHint	ds.w 3				; HBlank jump (JMP xxxx xxxx)
(1)   85/FFFFFFFFFFFFD942 :                     RAM_MdMarsTCntM	ds.w 1				; Counter for MASTER CPU's task list
(1)   86/FFFFFFFFFFFFD944 :                     RAM_MdMarsTCntS	ds.w 1				; Counter for SLAVE CPU's task list
(1)   87/FFFFFFFFFFFFD946 :                     RAM_SysFlags	ds.w 1				; Game engine flags (note: it's a byte)
(1)   88/FFFFFFFFFFFFD948 :                     sizeof_mdsys	ds.l 0
(1)   89/FFFFFFFFFFFFD94A : (MACRO)             		finish
(1)   89/FFFFFFFFFFFFD30E :                                     !org GLBL_LASTORG
(1)   89/       0 :                                     phase GLBL_LASTPC
(1)   90/       0 :                     
(1)   91/       0 :                     ; ====================================================================
(1)   92/       0 :                     ; ----------------------------------------------------------------
(1)   93/       0 :                     ; Sound 68k RAM
(1)   94/       0 :                     ; ----------------------------------------------------------------
(1)   95/       0 :                     
(1)   96/       0 : (MACRO)             		struct RAM_MdSound
(1)   96/       0 : =$0                 GLBL_LASTPC     set *
(1)   96/       0 :                                     dephase
(1)   96/       0 : =$0                 GLBL_LASTORG    set *
(1)   96/FFFFFFFFFFFFC800 :                                     phase RAM_MDSOUND
(1)   97/FFFFFFFFFFFFC800 :                     RAM_SndSaveReg	ds.l 8
(1)   98/FFFFFFFFFFFFC820 :                     sizeof_mdsnd	ds.l 0
(1)   99/FFFFFFFFFFFFC820 : (MACRO)             		finish
(1)   99/FFFFFFFFFFFFC800 :                                     !org GLBL_LASTORG
(1)   99/       0 :                                     phase GLBL_LASTPC
(1)  100/       0 :                     		
(1)  101/       0 :                     ; ====================================================================
(1)  102/       0 :                     ; ----------------------------------------------------------------
(1)  103/       0 :                     ; Video RAM
(1)  104/       0 :                     ; ----------------------------------------------------------------
(1)  105/       0 :                     
(1)  106/       0 : (MACRO)             		struct RAM_MdVideo
(1)  106/       0 : =$0                 GLBL_LASTPC     set *
(1)  106/       0 :                                     dephase
(1)  106/       0 : =$0                 GLBL_LASTORG    set *
(1)  106/FFFFFFFFFFFFC820 :                                     phase RAM_MDVIDEO
(1)  107/FFFFFFFFFFFFC820 :                     RAM_SpriteData	ds.w 8*70		; DMA'd Sprites
(1)  108/FFFFFFFFFFFFCC80 :                     RAM_HorScroll	ds.l 240		; DMA'd Horizontal scroll data
(1)  109/FFFFFFFFFFFFD040 :                     RAM_VerScroll	ds.l 320/16		; DMA'd Vertical scroll data
(1)  110/FFFFFFFFFFFFD090 :                     RAM_VdpDmaList	ds.w 7*MAX_MDDMATSK
(1)  111/FFFFFFFFFFFFD170 :                     RAM_VdpDmaIndx	ds.w 1
(1)  112/FFFFFFFFFFFFD172 :                     RAM_VdpDmaMod	ds.w 1
(1)  113/FFFFFFFFFFFFD174 :                     RAM_VidPrntVram	ds.w 1			; Default VRAM location for ASCII text used by Video_Print
(1)  114/FFFFFFFFFFFFD176 :                     RAM_VidPrntList	ds.w 3*64		; Video_Print list: Address, Type
(1)  115/FFFFFFFFFFFFD2F6 :                     RAM_VdpRegs	ds.b 24			; VDP Register cache
(1)  116/FFFFFFFFFFFFD30E :                     sizeof_mdvid	ds.l 0
(1)  117/FFFFFFFFFFFFD310 : (MACRO)             		finish
(1)  117/FFFFFFFFFFFFC820 :                                     !org GLBL_LASTORG
(1)  117/       0 :                                     phase GLBL_LASTPC
(1)  118/       0 :                     
(1)  119/       0 :                     ; ====================================================================
(1)  120/       0 :                     ; ----------------------------------------------------------------
(1)  121/       0 :                     ; MD RAM
(1)  122/       0 :                     ;
(1)  123/       0 :                     ; *** NOTE ***
(1)  124/       0 :                     ; For SEGA CD support:
(1)  125/       0 :                     ; $FFFD00 to $FFFDFF is reserved for the MAIN-CPU's vectors
(1)  126/       0 :                     ; ----------------------------------------------------------------
(1)  127/       0 :                     
(1)  128/       0 : (MACRO)             		struct MDRAM_START
(1)  128/       0 : =$0                 GLBL_LASTPC     set *
(1)  128/       0 :                                     dephase
(1)  128/       0 : =$0                 GLBL_LASTORG    set *
(1)  128/FFFFFFFFFFFFC000 :                                     phase MDRAM_START
(1)  137/FFFFFFFFFFFFC000 :                     RAM_ModeBuff	ds.b MAX_MDERAM			; Second pass: sizes are set
(1)  138/FFFFFFFFFFFFC800 :                     RAM_MdSound	ds.b sizeof_mdsnd-RAM_MdSound
(1)  139/FFFFFFFFFFFFC820 :                     RAM_MdVideo	ds.b sizeof_mdvid-RAM_MdVideo
(1)  140/FFFFFFFFFFFFD30E :                     RAM_MdSystem	ds.b sizeof_mdsys-RAM_MdSystem
(1)  141/FFFFFFFFFFFFD948 :                     RAM_MdGlobal	ds.b sizeof_mdglbl-RAM_MdGlobal
(1)  142/FFFFFFFFFFFFD94C :                     sizeof_mdram	ds.l 0
(1)  144/FFFFFFFFFFFFD94C :                     
MD RAM: FFC000-FFD94C
(1)  146/FFFFFFFFFFFFD94C :                     		message "MD RAM: \{(MDRAM_START)&$FFFFFF}-\{(sizeof_mdram)&$FFFFFF}"
(1)  148/FFFFFFFFFFFFD94C : (MACRO)             		finish
(1)  148/FFFFFFFFFFFFC000 :                                     !org GLBL_LASTORG
(1)  148/       0 :                                     phase GLBL_LASTPC
(1)  149/       0 :                     
       8/       0 :                     		include	"system/md/map.asm"	; Genesis hardware map
(1)    1/       0 :                     ; ====================================================================
(1)    2/       0 :                     ; ----------------------------------------------------------------
(1)    3/       0 :                     ; Genesis / MegaDrive 68k map
(1)    4/       0 :                     ; ----------------------------------------------------------------
(1)    5/       0 :                     
(1)    6/       0 : =$200000            sys_exram	equ	$200000		; Second half of 4MB rom or external RAM (Normal or save data)
(1)    7/       0 : =$A00000            z80_cpu		equ	$A00000		; Z80 CPU area, size: $2000
(1)    8/       0 : =$A04000            ym_ctrl_1	equ	$A04000		; YM2612 reg 1
(1)    9/       0 : =$A04001            ym_data_1	equ	$A04001		; YM2612 reg 2
(1)   10/       0 : =$A04002            ym_ctrl_2	equ	$A04002		; YM2612 reg 1
(1)   11/       0 : =$A04003            ym_data_2	equ	$A04003		; YM2612 reg 2
(1)   12/       0 : =$A10001            sys_io		equ	$A10001		; bits: OVRSEAS(7)|PAL(6)|DISK(5)|VER(3-0)
(1)   13/       0 : =$A10003            sys_data_1	equ	$A10003		; Port 1 DATA
(1)   14/       0 : =$A10005            sys_data_2	equ	$A10005		; Port 2 DATA
(1)   15/       0 : =$A10007            sys_data_3	equ	$A10007		; Modem DATA
(1)   16/       0 : =$A10009            sys_ctrl_1	equ	$A10009		; Port 1 CTRL
(1)   17/       0 : =$A1000B            sys_ctrl_2	equ	$A1000B		; Port 2 CTRL
(1)   18/       0 : =$A1000D            sys_ctrl_3	equ	$A1000D		; Modem CTRL
(1)   19/       0 : =$A11100            z80_bus 	equ	$A11100		; only use bit 0 (bit 8 as WORD)
(1)   20/       0 : =$A11200            z80_reset	equ	$A11200		; WRITE only ($0000 reset/$0100 cancel)
(1)   21/       0 : =$A130F1            md_bank_sram	equ	$A130F1		; Make SRAM visible at $200000
(1)   22/       0 : =$A14000            sys_tmss	equ	$A14000		; write "SEGA" here for ver > 0
(1)   23/       0 : =$C00000            vdp_data	equ	$C00000		; video data port
(1)   24/       0 : =$C00004            vdp_ctrl	equ	$C00004		; video control port
(1)   25/       0 : =$C00011            psg_ctrl	equ	$C00011		; PSG control
(1)   26/       0 :                     
(1)   27/       0 :                     ; ----------------------------------------------------------------
(1)   28/       0 :                     ; Genesis / Mega drive Z80 map
(1)   29/       0 :                     ; ----------------------------------------------------------------
(1)   30/       0 :                     
(1)   31/       0 : =$4000              zym_ctrl_1	equ	$4000		; YM2612 reg 1
(1)   32/       0 : =$4001              zym_data_1	equ	$4001		; YM2612 reg 2
(1)   33/       0 : =$4002              zym_ctrl_2	equ	$4002		; YM2612 reg 1
(1)   34/       0 : =$4003              zym_data_2	equ	$4003		; YM2612 reg 2
(1)   35/       0 : =$6000              zbank		equ	$6000		; Z80 ROM BANK 24bits, %XXXXXXXX X0000000 00000000 (9 writes)
(1)   36/       0 :                     ; zvdp_data	equ	$7F00		; video data port
(1)   37/       0 :                     ; zvdp_ctrl	equ	$7F04		; video control port
(1)   38/       0 : =$7F11              zpsg_ctrl	equ	$7F11		; PSG control
(1)   39/       0 :                     
(1)   40/       0 :                     ; ----------------------------------------------------------------
(1)   41/       0 :                     ; 32X registers
(1)   42/       0 :                     ; ----------------------------------------------------------------
(1)   43/       0 :                     
(1)   44/       0 : =$A130EC            sysmars_id	equ	$A130EC		; 32X's ID String: "MARS"
(1)   45/       0 : =$A15100            sysmars_reg	equ	$A15100		; MARS 32X registers section, see system/mars/map.asm for variables
(1)   46/       0 :                     
       9/       0 :                     		include	"system/mars/map.asm"	; MARS map
(1)    1/       0 :                     ; ====================================================================
(1)    2/       0 :                     ; ----------------------------------------------------------------
(1)    3/       0 :                     ; SH2 MAP
(1)    4/       0 :                     ; ----------------------------------------------------------------
(1)    5/       0 :                     
(1)    6/       0 :                     ; --------------------------------------------------------
(1)    7/       0 :                     ; SH2 SIDE MAP
(1)    8/       0 :                     ; --------------------------------------------------------
(1)    9/       0 :                     
(1)   10/       0 : =$0                 CS0		equ	$00000000	; Boot rom & system registers
(1)   11/       0 : =$2000000           CS1		equ	$02000000	; ROM data (all 4MB), Locked if RV=1
(1)   12/       0 : =$4000000           CS2		equ	$04000000	; Framebuffer section
(1)   13/       0 : =$6000000           CS3		equ	$06000000	; SDRAM
(1)   14/       0 : =$20000000          TH		equ	$20000000	; Cache-thru OR|value
(1)   15/       0 : =$20004000          _sysreg		equ	$00004000|TH	; MARS System registers, for MD: sysmars_reg
(1)   16/       0 : =$20004100          _vdpreg		equ	$00004100|TH	; SuperVDP registers
(1)   17/       0 : =$20004200          _palette	equ	$00004200|TH	; Palette RAM for Pixel-Packed or RLE mode
(1)   18/       0 : =$24000000          _framebuffer:	equ	CS2|TH		; Framebuffer, first 240 are the linetable
(1)   19/       0 : =$24020000          _overwrite:	equ	CS2|TH+$20000	; Overwrite, $00-byte writes are ignored
(1)   20/       0 :                     
(1)   21/       0 :                     ; --------------------------------------------------------
(1)   22/       0 :                     ; Variables
(1)   23/       0 :                     ; --------------------------------------------------------
(1)   24/       0 :                     
(1)   25/       0 :                     ; ------------------------------------------------
(1)   26/       0 :                     ; System
(1)   27/       0 :                     ; ------------------------------------------------
(1)   28/       0 :                     
(1)   29/       0 :                     ; _sysreg
(1)   30/       0 : =$0                 adapter		equ	$00		; adapter control register
(1)   31/       0 : =$1                 intmask		equ	$01		; interrupts mask
(1)   32/       0 : =$2                 standby		equ	$02		; CMD interrupt request bit by MD side (slave|master)
(1)   33/       0 : =$5                 hcount		equ	$05		; H Counter
(1)   34/       0 : =$6                 dreqctl		equ	$06		; DREQ control
(1)   35/       0 : =$8                 dreqsource	equ	$08		; DREQ source address
(1)   36/       0 : =$C                 dreqdest	equ	$0C		; DREQ destination address
(1)   37/       0 : =$10                dreqlen		equ	$10		; DREQ length
(1)   38/       0 : =$12                dreqfifo	equ	$12		; DREQ FIFO
(1)   39/       0 : =$14                vresintclr	equ	$14		; VRES interrupt clear
(1)   40/       0 : =$16                vintclr		equ	$16		; V interrupt clear
(1)   41/       0 : =$18                hintclr		equ	$18		; H interrupt clear
(1)   42/       0 : =$1A                cmdintclr	equ	$1a		; CMD interrupt clear
(1)   43/       0 : =$1C                pwmintclr	equ	$1C		; PWM interrupt clear
(1)   44/       0 : =$20                comm0		equ	$20		; Communication ports
(1)   45/       0 : =$22                comm2		equ	$22		; (If 2 CPUs either SH2 or 68K writes to
(1)   46/       0 : =$24                comm4		equ	$24		; the same location, it will freeze the
(1)   47/       0 : =$26                comm6		equ	$26		; system)
(1)   48/       0 : =$28                comm8		equ	$28		;
(1)   49/       0 : =$2A                comm10		equ	$2A		;
(1)   50/       0 : =$2C                comm12		equ	$2C		;
(1)   51/       0 : =$2E                comm14		equ	$2E		;
(1)   52/       0 : =$2F                comm15		equ	$2F		;
(1)   53/       0 : =$30                timerctl	equ	$30		; PWM Timer Control
(1)   54/       0 : =$31                pwmctl		equ	$31		; PWM Control
(1)   55/       0 : =$32                cycle		equ	$32		; PWM Cycle
(1)   56/       0 : =$34                lchwidth	equ	$34		; PWM L ch Width
(1)   57/       0 : =$36                rchwidth	equ	$36		; PWM R ch Width
(1)   58/       0 : =$38                monowidth	equ	$38		; PWM Monaural Width
(1)   59/       0 :                     
(1)   60/       0 :                     ; _sysreg
(1)   61/       0 :                     ; adapter
(1)   62/       0 : =$1                 CART		equ	%00000001	; CD or Cartridge
(1)   63/       0 : =$2                 ADEN		equ	%00000010	; MARS Enabled: No/Yes
(1)   64/       0 : =$80                FM		equ	%10000000	; SuperVDP permission: MD or SH
(1)   65/       0 :                     ; framectl
(1)   66/       0 : =$1                 FS		equ	%00000001	; Current framebuffer DRAM pixel data
(1)   67/       0 : =$2                 FEN		equ	%00000010	; Can write to Framebuffer: Yes/No
(1)   68/       0 :                     ; vdpsts
(1)   69/       0 : =$80                VBLK		equ	%10000000	; VBlank bit
(1)   70/       0 : =$40                HBLK		equ	%01000000	; HBlank bit
(1)   71/       0 : =$20                PEN		equ	%00100000	; Can write to Palette: Yes/No
(1)   72/       0 :                     ; intmask
(1)   73/       0 : =$8                 VIRQ_ON		equ	$08		; IRQ masks for IRQ mask register
(1)   74/       0 : =$4                 HIRQ_ON		equ	$04
(1)   75/       0 : =$2                 CMDIRQ_ON	equ	$02
(1)   76/       0 : =$1                 PWMIRQ_ON	equ	$01
(1)   77/       0 :                     
(1)   78/       0 :                     ; _vdpreg
(1)   79/       0 : =$0                 tvmode		equ	$00		; TV mode register
(1)   80/       0 : =$1                 bitmapmd	equ	$01		; Bitmap mode register
(1)   81/       0 : =$2                 shift		equ	$02		; Shift Control register
(1)   82/       0 : =$5                 filllength	equ	$05		; Auto Fill Length register
(1)   83/       0 : =$6                 fillstart	equ	$06		; Auto Fill Start Address register
(1)   84/       0 : =$8                 filldata	equ	$08		; Auto Fill Data register
(1)   85/       0 : =$A                 vdpsts		equ	$0a		; VDP Status register
(1)   86/       0 : =$B                 framectl	equ	$0b		; Frame Buffer Control register
(1)   87/       0 :                     
(1)   88/       0 :                     ; --------------------------------------------------------
(1)   89/       0 :                     ; SH2 Internal registers, independent for each CPU
(1)   90/       0 :                     ; --------------------------------------------------------
(1)   91/       0 :                     
(1)   92/       0 :                     ; DMA Channel 0: General data transfer
(1)   93/       0 :                     ; DMA Channel 1: PWM exclusive
(1)   94/       0 : =$FFFFFE00          _SERIAL		equ	$FFFFFE00	; Serial Control
(1)   95/       0 : =$FFFFFE10          _FRT		equ	$FFFFFE10	; Free run timer
(1)   96/       0 : =$0                 _TIER		equ	$00		; Timer interrupt enable register
(1)   97/       0 : =$1                 _TCSR		equ	$01		; Timer control & status register
(1)   98/       0 : =$2                 _FRC_H		equ	$02		; free running counter High
(1)   99/       0 : =$3                 _FRC_L		equ	$03		; free running counter Low
(1)  100/       0 : =$4                 _OCR_H		equ	$04		; Output compare register High
(1)  101/       0 : =$5                 _OCR_L		equ	$05		; Output compare register Low
(1)  102/       0 : =$6                 _TCR		equ	$06		; Timer control register
(1)  103/       0 : =$7                 _TOCR		equ	$07		; timer output compare control register
(1)  104/       0 : =$FFFFFE92          _CCR:		equ	$FFFFFE92
(1)  105/       0 : =$FFFFFF00          _JR		equ	$FFFFFF00	; DIVU (--- / val)
(1)  106/       0 : =$FFFFFF04          _HRL32		equ	$FFFFFF04	; DIVU (val / ---) or LOW Result if read
(1)  107/       0 : =$FFFFFF10          _HRH		equ	$FFFFFF10	; DIVU Result, HIGH
(1)  108/       0 : =$FFFFFF14          _HRL		equ	$FFFFFF14	; DIVU Result, LOW
(1)  109/       0 : =$FFFFFF80          _DMASOURCE0	equ	$FFFFFF80	; DMA source address 0
(1)  110/       0 : =$FFFFFF84          _DMADEST0	equ	$FFFFFF84	; DMA destination address 0
(1)  111/       0 : =$FFFFFF88          _DMACOUNT0	equ	$FFFFFF88	; DMA transfer count 0
(1)  112/       0 : =$FFFFFF8C          _DMACHANNEL0	equ	$FFFFFF8C	; DMA channel control 0
(1)  113/       0 : =$FFFFFF90          _DMASOURCE1	equ	$FFFFFF90	; DMA source address 1
(1)  114/       0 : =$FFFFFF94          _DMADEST1	equ	$FFFFFF94	; DMA destination address 1
(1)  115/       0 : =$FFFFFF98          _DMACOUNT1	equ	$FFFFFF98	; DMA transfer count 1
(1)  116/       0 : =$FFFFFF9C          _DMACHANNEL1	equ	$FFFFFF9C	; DMA channel control 1
(1)  117/       0 : =$FFFFFFA0          _DMAVECTORN0	equ	$FFFFFFA0	; DMA vector number N0
(1)  118/       0 : =$FFFFFFA4          _DMAVECTORE0	equ	$FFFFFFA4	; DMA vector number E0
(1)  119/       0 : =$FFFFFFA8          _DMAVECTORN1	equ	$FFFFFFA8	; DMA vector number N1
(1)  120/       0 : =$FFFFFFAC          _DMAVECTORE1	equ	$FFFFFFAC	; DMA vector number E1
(1)  121/       0 : =$FFFFFFB0          _DMAOPERATION	equ	$FFFFFFB0	; DMA operation
(1)  122/       0 : =$FFFFFFB4          _DMAREQACK0	equ	$FFFFFFB4	; DMA request/ack select control 0
(1)  123/       0 : =$FFFFFFB8          _DMAREQACK1	equ	$FFFFFFB8	; DMA request/ack select control 1
(1)  124/       0 :                     
      10/       0 :                     		include	"system/head.asm"	; 32X header
(1)    1/       0 :                     ; ====================================================================
(1)    2/       0 :                     ; ----------------------------------------------------------------
(1)    3/       0 :                     ; ROM HEADER FOR 32X
(1)    4/       0 :                     ; 
(1)    5/       0 :                     ; These labels still work even if the 32X isn't present
(1)    6/       0 :                     ; ----------------------------------------------------------------
(1)    7/       0 :                     
(1)    8/       0 : 0000 0000           		dc.l 0				; Stack point
(1)    9/       4 : 0000 03F0           		dc.l $3F0			; Entry point (always $3F0)
(1)   10/       8 : 0000 0898           		dc.l MD_ErrBus			; Bus error
(1)   11/       C : 0000 0898           		dc.l MD_ErrAddr			; Address error
(1)   12/      10 : 0000 0898           		dc.l MD_ErrIll			; ILLEGAL Instruction
(1)   13/      14 : 0000 0898           		dc.l MD_ErrZDiv			; Divide by 0
(1)   14/      18 : 0000 0898           		dc.l MD_ErrChk			; CHK Instruction
(1)   15/      1C : 0000 0898           		dc.l MD_ErrTrapV		; TRAPV Instruction
(1)   16/      20 : 0000 0898           		dc.l MD_ErrPrivl		; Privilege violation
(1)   17/      24 : 0000 0898           		dc.l MD_Trace			; Trace
(1)   18/      28 : 0000 0898           		dc.l MD_Line1010		; Line 1010 Emulator
(1)   19/      2C : 0000 0898           		dc.l MD_Line1111		; Line 1111 Emulator
(1)   20/      30 : 0000 0898           		dc.l MD_ErrorEx			; Error exception
(1)   21/      34 : 0000 0898           		dc.l MD_ErrorEx
(1)   22/      38 : 0000 0898           		dc.l MD_ErrorEx
(1)   23/      3C : 0000 0898           		dc.l MD_ErrorEx
(1)   24/      40 : 0000 0898           		dc.l MD_ErrorEx	
(1)   25/      44 : 0000 0898           		dc.l MD_ErrorEx
(1)   26/      48 : 0000 0898           		dc.l MD_ErrorEx
(1)   27/      4C : 0000 0898           		dc.l MD_ErrorEx
(1)   28/      50 : 0000 0898           		dc.l MD_ErrorEx
(1)   29/      54 : 0000 0898           		dc.l MD_ErrorEx
(1)   30/      58 : 0000 0898           		dc.l MD_ErrorEx
(1)   31/      5C : 0000 0898           		dc.l MD_ErrorEx
(1)   32/      60 : 0000 0898           		dc.l MD_ErrorEx		
(1)   33/      64 : 0000 0898           		dc.l MD_ErrorTrap
(1)   34/      68 : 0000 0898           		dc.l MD_ErrorTrap
(1)   35/      6C : 0000 0898           		dc.l MD_ErrorTrap
(1)   36/      70 : FFFF D93C           		dc.l RAM_MdMarsHInt		; RAM jump for HBlank (JMP xxxx xxxx)
(1)   37/      74 : 0000 0898           		dc.l MD_ErrorTrap
(1)   38/      78 : FFFF D936           		dc.l RAM_MdMarsVInt		; RAM jump for VBlank (JMP xxxx xxxx)
(1)   39/      7C : 0000 0898           		dc.l MD_ErrorTrap
(1)   40/      80 : 0000 0898           		dc.l MD_ErrorTrap
(1)   41/      84 : 0000 0898           		dc.l MD_ErrorTrap
(1)   42/      88 : 0000 0898           		dc.l MD_ErrorTrap
(1)   43/      8C : 0000 0898           		dc.l MD_ErrorTrap
(1)   44/      90 : 0000 0898           		dc.l MD_ErrorTrap
(1)   45/      94 : 0000 0898           		dc.l MD_ErrorTrap
(1)   46/      98 : 0000 0898           		dc.l MD_ErrorTrap
(1)   47/      9C : 0000 0898           		dc.l MD_ErrorTrap
(1)   48/      A0 : 0000 0898           		dc.l MD_ErrorTrap
(1)   49/      A4 : 0000 0898           		dc.l MD_ErrorTrap
(1)   50/      A8 : 0000 0898           		dc.l MD_ErrorTrap
(1)   51/      AC : 0000 0898           		dc.l MD_ErrorTrap
(1)   52/      B0 : 0000 0898           		dc.l MD_ErrorTrap
(1)   53/      B4 : 0000 0898           		dc.l MD_ErrorTrap
(1)   54/      B8 : 0000 0898           		dc.l MD_ErrorTrap
(1)   55/      BC : 0000 0898           		dc.l MD_ErrorTrap
(1)   56/      C0 : 0000 0898           		dc.l MD_ErrorTrap
(1)   57/      C4 : 0000 0898           		dc.l MD_ErrorTrap
(1)   58/      C8 : 0000 0898           		dc.l MD_ErrorTrap
(1)   59/      CC : 0000 0898           		dc.l MD_ErrorTrap
(1)   60/      D0 : 0000 0898           		dc.l MD_ErrorTrap
(1)   61/      D4 : 0000 0898           		dc.l MD_ErrorTrap
(1)   62/      D8 : 0000 0898           		dc.l MD_ErrorTrap
(1)   63/      DC : 0000 0898           		dc.l MD_ErrorTrap
(1)   64/      E0 : 0000 0898           		dc.l MD_ErrorTrap
(1)   65/      E4 : 0000 0898           		dc.l MD_ErrorTrap
(1)   66/      E8 : 0000 0898           		dc.l MD_ErrorTrap
(1)   67/      EC : 0000 0898           		dc.l MD_ErrorTrap
(1)   68/      F0 : 0000 0898           		dc.l MD_ErrorTrap
(1)   69/      F4 : 0000 0898           		dc.l MD_ErrorTrap
(1)   70/      F8 : 0000 0898           		dc.l MD_ErrorTrap
(1)   71/      FC : 0000 0898           		dc.l MD_ErrorTrap
(1)   72/     100 : 5345 4741 2033 3258 		dc.b "SEGA 32X        "
                    2020 2020 2020 2020 
(1)   73/     110 : 2843 2947 4636 3420 		dc.b "(C)GF64 2022.???"
                    3230 3232 2E3F 3F3F 
(1)   74/     120 : 5072 6F79 6563 746F 		dc.b "Proyecto MARSIANO                               "
                    204D 4152 5349 414E 
                    4F20 2020 2020 2020 
                    2020 2020 2020 2020 
                    2020 2020 2020 2020 
                    2020 2020 2020 2020 
(1)   75/     150 : 5072 6F6A 6563 7420 		dc.b "Project MARSIANO                                "
                    4D41 5253 4941 4E4F 
                    2020 2020 2020 2020 
                    2020 2020 2020 2020 
                    2020 2020 2020 2020 
                    2020 2020 2020 2020 
(1)   76/     180 : 474D 2048 4F4D 4542 		dc.b "GM HOMEBREW-00"
                    5245 572D 3030      
(1)   77/     18E : 0000                		dc.w 0
(1)   78/     190 : 4A36 2020 2020 2020 		dc.b "J6              "
                    2020 2020 2020 2020 
(1)   79/     1A0 : 0000 0000           		dc.l 0
(1)   80/     1A4 : 0006 A888           		dc.l ROM_END
(1)   81/     1A8 : 00FF 0000           		dc.l $FF0000
(1)   82/     1AC : 00FF FFFF           		dc.l $FFFFFF
(1)   83/     1B0 : 2020 2020           		dc.l $20202020		; dc.b "RA",$F8,$20
(1)   84/     1B4 : 2020 2020           		dc.l $20202020		; $200000
(1)   85/     1B8 : 2020 2020           		dc.l $20202020		; $203FFF
(1)   86/     1BC :                     		align $1F0
(1)   87/     1F0 : 5520 2020 2020 2020 		dc.b "U               "
                    2020 2020 2020 2020 
(1)   88/     200 :                     
(1)   89/     200 :                     ; ====================================================================
(1)   90/     200 :                     ; ----------------------------------------------------------------
(1)   91/     200 :                     ; Second header for 32X
(1)   92/     200 :                     ; 
(1)   93/     200 :                     ; These new jumps are for the 68K if the 32X is currently
(1)   94/     200 :                     ; active.
(1)   95/     200 :                     ; ----------------------------------------------------------------
(1)   96/     200 :                     
(1)   97/     200 : 4EF9 0088 0800      		jmp	($880000|MARS_Entry).l
(1)   98/     206 : 4EF9 0088 0898      		jmp	($880000|MD_ErrBus).l			; Bus error
(1)   99/     20C : 4EF9 0088 0898      		jmp	($880000|MD_ErrAddr).l			; Address error
(1)  100/     212 : 4EF9 0088 0898      		jmp	($880000|MD_ErrIll).l			; ILLEGAL Instruction
(1)  101/     218 : 4EF9 0088 0898      		jmp	($880000|MD_ErrZDiv).l			; Divide by 0
(1)  102/     21E : 4EF9 0088 0898      		jmp	($880000|MD_ErrChk).l			; CHK Instruction
(1)  103/     224 : 4EF9 0088 0898      		jmp	($880000|MD_ErrTrapV).l			; TRAPV Instruction
(1)  104/     22A : 4EF9 0088 0898      		jmp	($880000|MD_ErrPrivl).l			; Privilege violation
(1)  105/     230 : 4EF9 0088 0898      		jmp	($880000|MD_Trace).l			; Trace
(1)  106/     236 : 4EF9 0088 0898      		jmp	($880000|MD_Line1010).l			; Line 1010 Emulator
(1)  107/     23C : 4EF9 0088 0898      		jmp	($880000|MD_Line1111).l			; Line 1111 Emulator
(1)  108/     242 : 4EF9 0088 0898      		jmp	($880000|MD_ErrorEx).l			; Error exception
(1)  109/     248 : 4EF9 0088 0898      		jmp	($880000|MD_ErrorEx).l
(1)  110/     24E : 4EF9 0088 0898      		jmp	($880000|MD_ErrorEx).l
(1)  111/     254 : 4EF9 0088 0898      		jmp	($880000|MD_ErrorEx).l
(1)  112/     25A : 4EF9 0088 0898      		jmp	($880000|MD_ErrorEx).l	
(1)  113/     260 : 4EF9 0088 0898      		jmp	($880000|MD_ErrorEx).l
(1)  114/     266 : 4EF9 0088 0898      		jmp	($880000|MD_ErrorEx).l
(1)  115/     26C : 4EF9 0088 0898      		jmp	($880000|MD_ErrorEx).l
(1)  116/     272 : 4EF9 0088 0898      		jmp	($880000|MD_ErrorEx).l
(1)  117/     278 : 4EF9 0088 0898      		jmp	($880000|MD_ErrorEx).l
(1)  118/     27E : 4EF9 0088 0898      		jmp	($880000|MD_ErrorEx).l
(1)  119/     284 : 4EF9 0088 0898      		jmp	($880000|MD_ErrorEx).l
(1)  120/     28A : 4EF9 0088 0898      		jmp	($880000|MD_ErrorEx).l		
(1)  121/     290 : 4EF9 0088 0898      		jmp	($880000|MD_ErrorTrap).l
(1)  122/     296 : 4EF9 0088 0898      		jmp	($880000|MD_ErrorTrap).l
(1)  123/     29C : 4EF9 0088 0898      		jmp	($880000|MD_ErrorTrap).l
(1)  124/     2A2 : 4EF9 FFFF D93C      		jmp	(RAM_MdMarsHInt).l			; RAM jump for HBlank (JMP xxxx xxxx)
(1)  125/     2A8 : 4EF9 0088 0898      		jmp	($880000|MD_ErrorTrap).l
(1)  126/     2AE : 4EF9 FFFF D936      		jmp	(RAM_MdMarsVInt).l			; RAM jump for VBlank (JMP xxxx xxxx)
(1)  127/     2B4 : 4EF9 0088 0898      		jmp	($880000|MD_ErrorTrap).l
(1)  128/     2BA : 4EF9 0088 0898      		jmp	($880000|MD_ErrorTrap).l
(1)  129/     2C0 : 4EF9 0088 0898      		jmp	($880000|MD_ErrorTrap).l
(1)  130/     2C6 : 4EF9 0088 0898      		jmp	($880000|MD_ErrorTrap).l
(1)  131/     2CC : 4EF9 0088 0898      		jmp	($880000|MD_ErrorTrap).l
(1)  132/     2D2 : 4EF9 0088 0898      		jmp	($880000|MD_ErrorTrap).l
(1)  133/     2D8 : 4EF9 0088 0898      		jmp	($880000|MD_ErrorTrap).l
(1)  134/     2DE : 4EF9 0088 0898      		jmp	($880000|MD_ErrorTrap).l
(1)  135/     2E4 : 4EF9 0088 0898      		jmp	($880000|MD_ErrorTrap).l
(1)  136/     2EA : 4EF9 0088 0898      		jmp	($880000|MD_ErrorTrap).l
(1)  137/     2F0 : 4EF9 0088 0898      		jmp	($880000|MD_ErrorTrap).l
(1)  138/     2F6 : 4EF9 0088 0898      		jmp	($880000|MD_ErrorTrap).l
(1)  139/     2FC : 4EF9 0088 0898      		jmp	($880000|MD_ErrorTrap).l
(1)  140/     302 : 4EF9 0088 0898      		jmp	($880000|MD_ErrorTrap).l
(1)  141/     308 : 4EF9 0088 0898      		jmp	($880000|MD_ErrorTrap).l
(1)  142/     30E : 4EF9 0088 0898      		jmp	($880000|MD_ErrorTrap).l
(1)  143/     314 : 4EF9 0088 0898      		jmp	($880000|MD_ErrorTrap).l
(1)  144/     31A : 4EF9 0088 0898      		jmp	($880000|MD_ErrorTrap).l
(1)  145/     320 : 4EF9 0088 0898      		jmp	($880000|MD_ErrorTrap).l
(1)  146/     326 : 4EF9 0088 0898      		jmp	($880000|MD_ErrorTrap).l
(1)  147/     32C : 4EF9 0088 0898      		jmp	($880000|MD_ErrorTrap).l
(1)  148/     332 : 4EF9 0088 0898      		jmp	($880000|MD_ErrorTrap).l
(1)  149/     338 : 4EF9 0088 0898      		jmp	($880000|MD_ErrorTrap).l
(1)  150/     33E : 4EF9 0088 0898      		jmp	($880000|MD_ErrorTrap).l
(1)  151/     344 : 4EF9 0088 0898      		jmp	($880000|MD_ErrorTrap).l
(1)  152/     34A : 4EF9 0088 0898      		jmp	($880000|MD_ErrorTrap).l
(1)  153/     350 : 4EF9 0088 0898      		jmp	($880000|MD_ErrorTrap).l
(1)  154/     356 : 4EF9 0088 0898      		jmp	($880000|MD_ErrorTrap).l
(1)  155/     35C : 4EF9 0088 0898      		jmp	($880000|MD_ErrorTrap).l
(1)  156/     362 : 4EF9 0088 0898      		jmp	($880000|MD_ErrorTrap).l
(1)  157/     368 : 4EF9 0088 0898      		jmp	($880000|MD_ErrorTrap).l
(1)  158/     36E : 4EF9 0088 0898      		jmp	($880000|MD_ErrorTrap).l
(1)  159/     374 : 4EF9 0088 0898      		jmp	($880000|MD_ErrorTrap).l
(1)  160/     37A :                     
(1)  161/     37A :                     ; ----------------------------------------------------------------
(1)  162/     37A :                     
(1)  163/     37A :                     		align $3C0
(1)  164/     3C0 : 4D41 5253 2043 4845 		dc.b "MARS CHECK MODE "			; Module name
                    434B 204D 4F44 4520 
(1)  165/     3D0 : 0000 0000           		dc.l 0					; Version (always 0)
(1)  166/     3D4 : 0003 AA60           		dc.l MARS_RAMDATA			; Set to 0 if SH2 code points to ROM
(1)  167/     3D8 : 0000 0000           		dc.l 0					; Zero.
(1)  168/     3DC : 0000 4210           		dc.l MARS_RAMDATA_e-MARS_RAMDATA	; Set to 4 if SH2 code points to ROM
(1)  169/     3E0 : 0600 0DA4           		dc.l SH2_M_Entry			; Master SH2 PC (SH2 map area)
(1)  170/     3E4 : 0600 0F68           		dc.l SH2_S_Entry			; Slave SH2 PC (SH2 map area)
(1)  171/     3E8 : 0600 0000           		dc.l SH2_Master				; Master SH2 default vector table (vbr)
(1)  172/     3EC : 0600 0124           		dc.l SH2_Slave				; Slave SH2 default vector table (vbr)
(1)  173/     3F0 :                     		binclude "system/mars/data/security.bin"
(1)  174/     800 :                     
(1)  175/     800 :                     ; ====================================================================
(1)  176/     800 :                     ; ----------------------------------------------------------------
(1)  177/     800 :                     ; Entry point, this must be located at $3F0
(1)  178/     800 :                     ; 
(1)  179/     800 :                     ; At this point, the initialization
(1)  180/     800 :                     ; returns the following bits:
(1)  181/     800 :                     ; 
(1)  182/     800 :                     ; d0: %h0000000 rsc000ti
(1)  183/     800 :                     ; 	h - Cold start / Hot Start
(1)  184/     800 :                     ; 	r - SDRAM Self Check pass or error
(1)  185/     800 :                     ; 	s - Security check pass or error
(1)  186/     800 :                     ; 	c - Checksum pass or error
(1)  187/     800 :                     ; 	t - TV mode pass or error
(1)  188/     800 :                     ; 	i - MARS ID pass or error
(1)  189/     800 :                     ; 
(1)  190/     800 :                     ; d1: %m0000000 jdk0vvv
(1)  191/     800 :                     ; 	m - MARS TV mode
(1)  192/     800 :                     ; 	j - Country: Japan / Overseas
(1)  193/     800 :                     ; 	d - MD TV mode
(1)  194/     800 :                     ; 	k - DISK connected: Yes / No
(1)  195/     800 :                     ; 	v - Version
(1)  196/     800 :                     ; 
(1)  197/     800 :                     ; Carry flag: "MARS ID" and Self Check result
(1)  198/     800 :                     ; 	cc: Test passed
(1)  199/     800 :                     ; 	cs: Test failed
(1)  200/     800 :                     ; ----------------------------------------------------------------
(1)  201/     800 :                     
(1)  202/     800 :                     MARS_Entry:
(1)  203/     800 : 657E                		bcs	.no_mars		; if Carry set, 32X is not present
(1)  204/     802 : 23FC 0000 0000 FFFF 		move.l	#0,(RAM_initflug).l	; Reset "INIT" flag
                    D932                
(1)  205/     80C : 0800 000F           		btst	#15,d0			; Soft reset?
(1)  206/     810 : 6700 0088           		beq	MD_Init
(1)  207/     814 : 4BF9 00A1 5100      		lea	(sysmars_reg).l,a5	; a5 - MARS register
(1)  208/     81A : 0815 0000           		btst.b	#0,adapter(a5)		; 32X enabled?
(1)  209/     81E : 6652                		bne	.adapterenable		; If yes, start booting
(1)  210/     820 : 2B7C 0000 0000 0028 		move.l	#0,comm8(a5)		; If not, we can't use 32X or something went wrong
(1)  211/     828 : 41FA 0020           		lea	.ramcode(pc),a0			; Copy the adapter-retry code to RAM
(1)  212/     82C : 43F9 00FF 0000      		lea	($FF0000).l,a1			; and jump there.
(1)  213/     832 : 22D8                		move.l	(a0)+,(a1)+
(1)  214/     834 : 22D8                		move.l	(a0)+,(a1)+
(1)  215/     836 : 22D8                		move.l	(a0)+,(a1)+
(1)  216/     838 : 22D8                		move.l	(a0)+,(a1)+
(1)  217/     83A : 22D8                		move.l	(a0)+,(a1)+
(1)  218/     83C : 22D8                		move.l	(a0)+,(a1)+
(1)  219/     83E : 22D8                		move.l	(a0)+,(a1)+
(1)  220/     840 : 22D8                		move.l	(a0)+,(a1)+
(1)  221/     842 : 41F9 00FF 0000      		lea	($FF0000).l,a0
(1)  222/     848 : 4ED0                		jmp	(a0)
(1)  223/     84A :                     .ramcode:
(1)  224/     84A : 1ABC 0001           		move.b	#1,adapter(a5)		; Enable adapter.
(1)  225/     84E : 41FA 000A           		lea	.restarticd(pc),a0	; JUMP to the following code in
(1)  226/     852 : D1FC 0088 0000      		adda.l	#$880000,a0		; the new 68k location
(1)  227/     858 : 4ED0                		jmp	(a0)
(1)  228/     85A :                     .restarticd:
(1)  229/     85A : 4BF9 00A1 0000      		lea	($A10000).l,a5		; a5 - MD's I/O area
(1)  230/     860 : 287C FFFF FFC0      		move.l	#-64,a4			; a4 - $FFFFFF9C
(1)  231/     866 : 3E3C 0F3C           		move.w	#3900,d7		; d7 - loop this many times
(1)  232/     86A : 43F9 0088 06E4      		lea	($880000+$6E4),a1	; Jump to ?res_wait (check ICD_MARS.PRG)
(1)  233/     870 : 4ED1                		jmp	(a1)
(1)  234/     872 :                     .adapterenable:
(1)  235/     872 : 4BF9 00A1 5100      		lea	(sysmars_reg),a5
(1)  236/     878 : 0815 0001           		btst.b	#1,adapter(a5)		; SH2 Reset request?
(1)  237/     87C : 665A                		bne.s	MD_HotStart		; If not, we are on hotstart
(1)  238/     87E : 60DA                		bra.s	.restarticd
(1)  239/     880 :                     
(1)  240/     880 :                     ; ====================================================================
(1)  241/     880 :                     ; ----------------------------------------------------------------
(1)  242/     880 :                     ; If 32X is not detected...
(1)  243/     880 :                     ;
(1)  244/     880 :                     ; This only works in emulators, though.
(1)  245/     880 :                     ; ----------------------------------------------------------------
(1)  246/     880 :                     
(1)  247/     880 :                     .no_mars:
(1)  248/     880 : 46FC 2700           		move.w	#$2700,sr			; Disable interrupts
(1)  249/     884 : 23FC C000 0000 00C0 		move.l	#$C0000000,(vdp_ctrl).l		; VDP: Point to Color 0
                    0004                
(1)  250/     88E : 33FC 0E00 00C0 0000 		move.w	#$0E00,(vdp_data).l		; Write blue
(1)  251/     896 : 60FE                		bra.s	*				; Infinite loop.
(1)  252/     898 :                     
(1)  253/     898 :                     ; ====================================================================
(1)  254/     898 :                     ; ----------------------------------------------------------------
(1)  255/     898 :                     ; Error traps
(1)  256/     898 :                     ; ----------------------------------------------------------------
(1)  257/     898 :                     
(1)  258/     898 :                     MD_ErrBus:		; Bus error
(1)  259/     898 :                     MD_ErrAddr:		; Address error
(1)  260/     898 :                     MD_ErrIll:		; ILLEGAL Instruction
(1)  261/     898 :                     MD_ErrZDiv:		; Divide by 0
(1)  262/     898 :                     MD_ErrChk:		; CHK Instruction
(1)  263/     898 :                     MD_ErrTrapV:		; TRAPV Instruction
(1)  264/     898 :                     MD_ErrPrivl:		; Privilege violation
(1)  265/     898 :                     MD_Trace:		; Trace
(1)  266/     898 :                     MD_Line1010:		; Line 1010 Emulator
(1)  267/     898 :                     MD_Line1111:		; Line 1111 Emulator
(1)  268/     898 :                     MD_ErrorEx:		; Error exception
(1)  269/     898 :                     MD_ErrorTrap:
(1)  270/     898 : 4E73                		rte
(1)  271/     89A :                     
(1)  272/     89A :                     ; ------------------------------------------------
(1)  273/     89A :                     ; Init
(1)  274/     89A :                     ; ------------------------------------------------
(1)  275/     89A :                     
(1)  276/     89A :                     MD_Init:
(1)  277/     89A : 46FC 2700           		move.w	#$2700,sr			; Disable interrupts
(1)  278/     89E : 4BF9 00A1 5100      		lea	(sysmars_reg).l,a5
(1)  279/     8A4 : 2B7C 3638 5550 002C 		move.l	#"68UP",comm12(a5)		; comm12: Report to SH2 that we are active.
(1)  280/     8AC : 0CAD 4D5F 4F4B 0020 .wm:		cmp.l	#"M_OK",comm0(a5)		; SH2 Master active?
(1)  281/     8B4 : 66F6                		bne.s	.wm
(1)  282/     8B6 : 0CAD 535F 4F4B 0024 .ws:		cmp.l	#"S_OK",comm4(a5)		; SH2 Slave active?
(1)  283/     8BE : 66F6                		bne.s	.ws
(1)  284/     8C0 : 7000                		moveq	#0,d0				; Reset comm values
(1)  285/     8C2 : 2B40 0020           		move.l	d0,comm0(a5)
(1)  286/     8C6 : 2B40 0024           		move.l	d0,comm4(a5)
(1)  287/     8CA : 2B40 002C           		move.l	d0,comm12(a5)
(1)  288/     8CE : 23FC 494E 4954 FFFF 		move.l	#"INIT",(RAM_initflug).l	; Set "INIT" as our boot flag
                    D932                
(1)  289/     8D8 :                     MD_HotStart:
(1)  290/     8D8 : 0CB9 494E 4954 FFFF 		cmp.l	#"INIT",(RAM_initflug).l	; Did it write?
                    D932                
(1)  291/     8E2 : 66B6                		bne.s	MD_Init				; If not, restart everything and try again.
(1)  292/     8E4 : 7000                		moveq	#0,d0				; Clear USP
(1)  293/     8E6 : 2C40                		movea.l	d0,a6
(1)  294/     8E8 : 4E66                		move.l	a6,usp
(1)  295/     8EA : 3039 00C0 0004      .waitframe:	move.w	(vdp_ctrl).l,d0			; Wait a frame
(1)  296/     8F0 : 0800 0007           		btst	#7,d0
(1)  297/     8F4 : 67F4                		beq.s	.waitframe
(1)  298/     8F6 : 23FC 8004 8144 00C0 		move.l	#$80048144,(vdp_ctrl).l		; Keep display
                    0004                
(1)  299/     900 : 41F9 00FF 0000      		lea	($FF0000),a0			; Clear RAM until $FFF000
(1)  300/     906 : 303C 3BFF           		move.w	#($F000/4)-1,d0
(1)  301/     90A :                     .clrram:
(1)  302/     90A : 4298                		clr.l	(a0)+
(1)  303/     90C : 51C8 FFFC           		dbf	d0,.clrram
(1)  304/     910 : 4CF9 7FFF 00FF 0000 		movem.l	($FF0000),d0-a6			; Clear registers (using zeros from RAM)
(1)  305/     918 :                     
      11/     918 :                     		include "code/global.asm"	; Global user variables for the Genesis
(1)    1/     918 :                     ; ====================================================================
(1)    2/     918 :                     ; ----------------------------------------------------------------
(1)    3/     918 :                     ; Global variables on the Genesis side
(1)    4/     918 :                     ; ----------------------------------------------------------------
(1)    5/     918 :                     
(1)    6/     918 : (MACRO)             		struct RAM_MdGlobal
(1)    6/     918 : =$918               GLBL_LASTPC     set *
(1)    6/     918 :                                     dephase
(1)    6/     918 : =$918               GLBL_LASTORG    set *
(1)    6/FFFFFFFFFFFFD948 :                                     phase RAM_MDGLOBAL
(1)    7/FFFFFFFFFFFFD948 :                     RAM_MdGlbl_Null	ds.l 1
(1)    8/FFFFFFFFFFFFD94C :                     sizeof_mdglbl	ds.l 0
(1)    9/FFFFFFFFFFFFD94C : (MACRO)             		finish
(1)    9/FFFFFFFFFFFFD948 :                                     !org GLBL_LASTORG
(1)    9/     918 :                                     phase GLBL_LASTPC
(1)   10/     918 :                     
(1)   11/     918 :                     
      12/     918 :                     
      13/     918 :                     ; ====================================================================
      14/     918 :                     ; ----------------------------------------------------------------
      15/     918 :                     ; Main boot code
      16/     918 :                     ; ----------------------------------------------------------------
      17/     918 :                     
      18/     918 : 41FA 001E           		lea	MdRamCode(pc),a0
      19/     91C : 43F9 00FF 0000      		lea	($FF0000),a1
      20/     922 : 303C 1BE3           		move.w	#((MdRamCode_end-MdRamCode))-1,d0
      21/     926 :                     .copyme:
      22/     926 : 12D8                		move.b	(a0)+,(a1)+
      23/     928 : 51C8 FFFC           		dbf	d0,.copyme
      24/     92C : 203C 0002 F2CC      		move.l	#RamCode_Default,d0
      25/     932 : 4EF9 00FF 1B96      		jmp	(System_JumpRamCode).l
      26/     938 :                     
      27/     938 :                     ; --------------------------------------------------------
      28/     938 :                     ; Top-common code stored on RAM
      29/     938 :                     ; --------------------------------------------------------
      30/     938 :                     
      31/     938 :                     MdRamCode:
      32/  FF0000 :                     		phase $FF0000
      33/  FF0000 :                     minfo_ram_s:
      34/  FF0000 :                     		include	"system/md/sound.asm"
(1)    1/  FF0000 :                     ; ====================================================================
(1)    2/  FF0000 :                     ; ----------------------------------------------------------------
(1)    3/  FF0000 :                     ; MD Sound
(1)    4/  FF0000 :                     ; ----------------------------------------------------------------
(1)    5/  FF0000 :                     
(1)    6/  FF0000 :                     ; --------------------------------------------------------
(1)    7/  FF0000 :                     ; Init Sound
(1)    8/  FF0000 :                     ;
(1)    9/  FF0000 :                     ; Uses:
(1)   10/  FF0000 :                     ; a0-a1,d0-d1
(1)   11/  FF0000 :                     ; --------------------------------------------------------
(1)   12/  FF0000 :                     
(1)   13/  FF0000 :                     ; 		align $80	; GENS emu only: comment or uncomment if it freezes
(1)   14/  FF0000 :                     Sound_Init:
(1)   15/  FF0000 : 33FC 0100 00A1 1100 		move.w	#$0100,(z80_bus).l		; Stop Z80
(1)   16/  FF0008 : 13FC 0001 00A1 1200 		move.b	#1,(z80_reset).l		; Reset
(1)   17/  FF0010 :                     .wait:
(1)   18/  FF0010 : 0839 0000 00A1 1100 		btst	#0,(z80_bus).l
(1)   19/  FF0018 : 66F6                		bne.s	.wait
(1)   20/  FF001A : 41F9 00A0 0000      		lea	(z80_cpu).l,a0
(1)   21/  FF0020 : 303C 1FFF           		move.w	#$1FFF,d0
(1)   22/  FF0024 : 7200                		moveq	#0,d1
(1)   23/  FF0026 :                     .cleanup:
(1)   24/  FF0026 : 10C1                		move.b	d1,(a0)+
(1)   25/  FF0028 : 51C8 FFFC           		dbf	d0,.cleanup
(1)   26/  FF002C : 41F9 0088 251C      		lea	(Z80_CODE|$880000).l,a0		; a0 - Z80 code (on $880000 area)
(1)   27/  FF0032 : 43F9 00A0 0000      		lea	(z80_cpu).l,a1			; a1 - Z80 area
(1)   28/  FF0038 : 303C 1FAF           		move.w	#(Z80_CODE_END-Z80_CODE)-1,d0	; d0 - Size
(1)   29/  FF003C :                     .copy:
(1)   30/  FF003C : 12D8                		move.b	(a0)+,(a1)+
(1)   31/  FF003E : 51C8 FFFC           		dbf	d0,.copy
(1)   32/  FF0042 : 13FC 0001 00A1 1200 		move.b	#1,(z80_reset).l		; Reset
(1)   33/  FF004A : 4E71                		nop
(1)   34/  FF004C : 4E71                		nop
(1)   35/  FF004E : 4E71                		nop
(1)   36/  FF0050 : 33FC 0000 00A1 1100 		move.w	#0,(z80_bus).l
(1)   37/  FF0058 : 4E75                		rts
(1)   38/  FF005A :                     
(1)   39/  FF005A :                     ; ====================================================================
(1)   40/  FF005A :                     ; ----------------------------------------------------------------
(1)   41/  FF005A :                     ; Subroutines
(1)   42/  FF005A :                     ; ----------------------------------------------------------------
(1)   43/  FF005A :                     
(1)   44/  FF005A :                     ; ------------------------------------------------
(1)   45/  FF005A :                     ; Lock Z80, get bus
(1)   46/  FF005A :                     ; ------------------------------------------------
(1)   47/  FF005A :                     
(1)   48/  FF005A :                     sndLockZ80:
(1)   49/  FF005A : 33FC 0100 00A1 1100 		move.w	#$0100,(z80_bus).l
(1)   50/  FF0062 :                     .wait:
(1)   51/  FF0062 : 0839 0000 00A1 1100 		btst	#0,(z80_bus).l
(1)   52/  FF006A : 66F6                		bne.s	.wait
(1)   53/  FF006C : 4E75                		rts
(1)   54/  FF006E :                     
(1)   55/  FF006E :                     ; ------------------------------------------------
(1)   56/  FF006E :                     ; Unlock Z80, return bus
(1)   57/  FF006E :                     ; ------------------------------------------------
(1)   58/  FF006E :                     
(1)   59/  FF006E :                     sndUnlockZ80:
(1)   60/  FF006E : 33FC 0000 00A1 1100 		move.w	#0,(z80_bus).l
(1)   61/  FF0076 : 4E75                		rts
(1)   62/  FF0078 :                     
(1)   63/  FF0078 :                     ; ------------------------------------------------
(1)   64/  FF0078 :                     ; 68k-to-z80 Sound request
(1)   65/  FF0078 :                     ; enter/exit routines
(1)   66/  FF0078 :                     ;
(1)   67/  FF0078 :                     ; d6 - commFifo index
(1)   68/  FF0078 :                     ; ------------------------------------------------
(1)   69/  FF0078 :                     
(1)   70/  FF0078 :                     sndReq_Enter:
(1)   71/  FF0078 : 48F9 60C0 FFFF C800 		movem.l	d6-d7/a5-a6,(RAM_SndSaveReg).l
(1)   72/  FF0080 : 7C00                		moveq	#0,d6
(1)   73/  FF0082 : 40C6                		move.w	sr,d6
(1)   74/  FF0084 : 33FC 0100 00A1 1100 		move.w	#$0100,(z80_bus).l		; Request Z80 Stop
(1)   75/  FF008C : 4846                		swap	d6
(1)   76/  FF008E : 007C 0700           		or.w	#$0700,sr			; disable ints
(1)   77/  FF0092 : 4BF9 00A0 001F      		lea	(z80_cpu+commZWrite),a5		; a5 - commZWrite
(1)   78/  FF0098 : 4DF9 00A0 1EB0      		lea	(z80_cpu+commZfifo),a6		; a6 - fifo command list
(1)   79/  FF009E :                     .wait:
(1)   80/  FF009E : 0839 0000 00A1 1100 		btst	#0,(z80_bus).l			; Wait for Z80
(1)   81/  FF00A6 : 66F6                		bne.s	.wait
(1)   82/  FF00A8 : 1C15                		move.b	(a5),d6				; d6 - index fifo position
(1)   83/  FF00AA : 4886                		ext.w	d6				; extend to 16 bits
(1)   84/  FF00AC : 4E75                		rts
(1)   85/  FF00AE :                     ; JUMP ONLY
(1)   86/  FF00AE :                     sndReq_Exit:
(1)   87/  FF00AE : 33FC 0000 00A1 1100 		move.w	#0,(z80_bus).l
(1)   88/  FF00B6 : 4846                		swap	d6
(1)   89/  FF00B8 : 46C6                		move.w	d6,sr
(1)   90/  FF00BA : 4CF9 60C0 FFFF C800 		movem.l	(RAM_SndSaveReg).l,d6-d7/a5-a6
(1)   91/  FF00C2 : 4E75                		rts
(1)   92/  FF00C4 :                     
(1)   93/  FF00C4 :                     ; ------------------------------------------------
(1)   94/  FF00C4 :                     ; Send request id and arguments
(1)   95/  FF00C4 :                     ;
(1)   96/  FF00C4 :                     ; Input:
(1)   97/  FF00C4 :                     ; d7 - byte to write
(1)   98/  FF00C4 :                     ; d6 - index pointer
(1)   99/  FF00C4 :                     ; a5 - commZWrite, update index
(1)  100/  FF00C4 :                     ; a6 - commZfifo command list
(1)  101/  FF00C4 :                     ;
(1)  102/  FF00C4 :                     ; *** CALL sndReq_Enter FIRST ***
(1)  103/  FF00C4 :                     ; ------------------------------------------------
(1)  104/  FF00C4 :                     
(1)  105/  FF00C4 :                     sndReq_scmd:
(1)  106/  FF00C4 : 1DBC 00FF 6000      		move.b	#-1,(a6,d6.w)			; write command-start flag
(1)  107/  FF00CA : 5206                		addq.b	#1,d6				; next fifo pos
(1)  108/  FF00CC : 0206 003F           		andi.b	#$3F,d6
(1)  109/  FF00D0 : 600C                		bra.s	sndReq_sbyte
(1)  110/  FF00D2 :                     sndReq_slong:
(1)  111/  FF00D2 : 610A                		bsr	sndReq_sbyte
(1)  112/  FF00D4 : E09F                		ror.l	#8,d7
(1)  113/  FF00D6 :                     sndReq_saddr:
(1)  114/  FF00D6 : 6106                		bsr	sndReq_sbyte
(1)  115/  FF00D8 : E09F                		ror.l	#8,d7
(1)  116/  FF00DA :                     sndReq_sword:
(1)  117/  FF00DA : 6102                		bsr	sndReq_sbyte
(1)  118/  FF00DC : E09F                		ror.l	#8,d7
(1)  119/  FF00DE :                     sndReq_sbyte:
(1)  120/  FF00DE : 1D87 6000           		move.b	d7,(a6,d6.w)			; write byte
(1)  121/  FF00E2 : 5206                		addq.b	#1,d6				; next fifo pos
(1)  122/  FF00E4 : 0206 003F           		andi.b	#$3F,d6
(1)  123/  FF00E8 : 1A86                		move.b	d6,(a5)				; update commZWrite
(1)  124/  FF00EA : 4E75                		rts
(1)  125/  FF00EC :                     
(1)  126/  FF00EC :                     ; --------------------------------------------------------
(1)  127/  FF00EC :                     ; Sound_DMA_Pause
(1)  128/  FF00EC :                     ;
(1)  129/  FF00EC :                     ; Call this BEFORE doing any DMA task
(1)  130/  FF00EC :                     ;
(1)  131/  FF00EC :                     ; Uses:
(1)  132/  FF00EC :                     ; d7
(1)  133/  FF00EC :                     ; --------------------------------------------------------
(1)  134/  FF00EC :                     
(1)  135/  FF00EC :                     Sound_DMA_Pause:
(1)  136/  FF00EC : 4847                		swap	d7
(1)  137/  FF00EE :                     .retry:
(1)  138/  FF00EE : 6100 FF6A           		bsr	sndLockZ80
(1)  139/  FF00F2 : 1E39 00A0 001D      		move.b	(z80_cpu+commZRomRd),d7		; Get mid-read bit
(1)  140/  FF00F8 : 6100 FF74           		bsr	sndUnlockZ80
(1)  141/  FF00FC : 4A07                		tst.b	d7
(1)  142/  FF00FE : 6708                		beq.s	.safe
(1)  143/  FF0100 : 7E44                		moveq	#68,d7
(1)  144/  FF0102 : 51CF FFFE           		dbf	d7,*
(1)  145/  FF0106 : 60E6                		bra.s	.retry
(1)  146/  FF0108 :                     	; TODO: ver si necesito un timeout...
(1)  147/  FF0108 :                     		;rts
(1)  148/  FF0108 :                     .safe:
(1)  149/  FF0108 : 6100 FF50           		bsr	sndLockZ80
(1)  150/  FF010C : 13FC 0001 00A0 001C 		move.b	#1,(z80_cpu+commZRomBlk)	; Block flag for Z80
(1)  151/  FF0114 : 6100 FF58           		bsr	sndUnlockZ80
(1)  152/  FF0118 :                     
(1)  153/  FF0118 :                     	; Make a data-backup of the current
(1)  154/  FF0118 :                     	; PWM's
(1)  155/  FF0118 : 1E39 00A1 512F      .wait_mars1:	move.b	(sysmars_reg+comm15),d7		; Wait for
(1)  156/  FF011E : CE7C 00D0           		and.w	#%11010000,d7			; BUSY/CLOCK/0/RESTORE
(1)  157/  FF0122 : 66F4                		bne.s	.wait_mars1
(1)  158/  FF0124 : 1E39 00A1 512F      		move.b	(sysmars_reg+comm15),d7		; Request PWM Backup
(1)  159/  FF012A : 08C7 0005           		bset	#5,d7
(1)  160/  FF012E : 13C7 00A1 512F      		move.b	d7,(sysmars_reg+comm15)
(1)  161/  FF0134 : 4E71                		nop
(1)  162/  FF0136 : 4E71                		nop
(1)  163/  FF0138 : 1E39 00A1 512F      .wait_mars2:	move.b	(sysmars_reg+comm15),d7		; Wait for
(1)  164/  FF013E : CE7C 00E0           		and.w	#%11100000,d7			; BUSY/CLOCK/BACKUP
(1)  165/  FF0142 : 66F4                		bne.s	.wait_mars2
(1)  166/  FF0144 : 4847                		swap	d7
(1)  167/  FF0146 : 4E75                		rts
(1)  168/  FF0148 :                     
(1)  169/  FF0148 :                     ; --------------------------------------------------------
(1)  170/  FF0148 :                     ; Sound_DMA_Resume
(1)  171/  FF0148 :                     ;
(1)  172/  FF0148 :                     ; Call this AFTER finishing DMA
(1)  173/  FF0148 :                     ; --------------------------------------------------------
(1)  174/  FF0148 :                     
(1)  175/  FF0148 :                     Sound_DMA_Resume:
(1)  176/  FF0148 : 4847                		swap	d7
(1)  177/  FF014A : 6100 FF0E           		bsr	sndLockZ80
(1)  178/  FF014E : 13FC 0000 00A0 001C 		move.b	#0,(z80_cpu+commZRomBlk)
(1)  179/  FF0156 : 6100 FF16           		bsr	sndUnlockZ80
(1)  180/  FF015A : 1E39 00A1 512F      .wait_mars1:	move.b	(sysmars_reg+comm15),d7		; Wait for
(1)  181/  FF0160 : CE7C 00E0           		and.w	#%11100000,d7			; BUSY/CLOCK/BACKUP
(1)  182/  FF0164 : 66F4                		bne.s	.wait_mars1
(1)  183/  FF0166 : 1E39 00A1 512F      		move.b	(sysmars_reg+comm15),d7		; Request PWM Restore
(1)  184/  FF016C : 08C7 0004           		bset	#4,d7
(1)  185/  FF0170 : 13C7 00A1 512F      		move.b	d7,(sysmars_reg+comm15)
(1)  186/  FF0176 : 4E71                		nop
(1)  187/  FF0178 : 4E71                		nop
(1)  188/  FF017A : 1E39 00A1 512F      .wait_mars2:	move.b	(sysmars_reg+comm15),d7		; Wait for
(1)  189/  FF0180 : CE7C 00D0           		and.w	#%11010000,d7			; BUSY/CLOCK/0/RESTORE
(1)  190/  FF0184 : 66F4                		bne.s	.wait_mars2
(1)  191/  FF0186 : 4847                		swap	d7
(1)  192/  FF0188 : 4E75                		rts
(1)  193/  FF018A :                     
(1)  194/  FF018A :                     ; --------------------------------------------------------
(1)  195/  FF018A :                     ; SoundReq_SetTrack
(1)  196/  FF018A :                     ;
(1)  197/  FF018A :                     ; a0 - Pointer to Pattern, Blocks and Instruments list
(1)  198/  FF018A :                     ;  	dc.l pattern_data
(1)  199/  FF018A :                     ;  	dc.l block_data
(1)  200/  FF018A :                     ;  	dc.l instrument_data
(1)  201/  FF018A :                     ;
(1)  202/  FF018A :                     ; d0 - Slot
(1)  203/  FF018A :                     ; d1 - Ticks
(1)  204/  FF018A :                     ; d2 - From block
(1)  205/  FF018A :                     ; d3 - Flags: %00004321
(1)  206/  FF018A :                     ; 	1234 - Use global tempos 1,2,3 or 4
(1)  207/  FF018A :                     ;
(1)  208/  FF018A :                     ; Uses:
(1)  209/  FF018A :                     ; d6-d7,a5-a6
(1)  210/  FF018A :                     ; --------------------------------------------------------
(1)  211/  FF018A :                     
(1)  212/  FF018A :                     Sound_TrkPlay:
(1)  213/  FF018A : 6100 FEEC           		bsr	sndReq_Enter
(1)  214/  FF018E : 3E3C 0000           		move.w	#$00,d7		; Command $00
(1)  215/  FF0192 : 6100 FF30           		bsr	sndReq_scmd
(1)  216/  FF0196 : 1E00                		move.b	d0,d7		; d0 - Slot
(1)  217/  FF0198 : 6100 FF44           		bsr	sndReq_sbyte
(1)  218/  FF019C : 1E01                		move.b	d1,d7		; d1 - Ticks
(1)  219/  FF019E : 6100 FF3E           		bsr	sndReq_sbyte
(1)  220/  FF01A2 : 1E02                		move.b	d2,d7		; d2 - Start block
(1)  221/  FF01A4 : 6100 FF38           		bsr	sndReq_sbyte
(1)  222/  FF01A8 : 1E03                		move.b	d3,d7		; d3 - Flags
(1)  223/  FF01AA : 6100 FF32           		bsr	sndReq_sbyte
(1)  224/  FF01AE : 2E18                		move.l	(a0)+,d7	; Patt data point
(1)  225/  FF01B0 : 6100 FF24           		bsr	sndReq_saddr
(1)  226/  FF01B4 : 2E18                		move.l	(a0)+,d7	; Block data point
(1)  227/  FF01B6 : 6100 FF1E           		bsr	sndReq_saddr
(1)  228/  FF01BA : 2E18                		move.l	(a0)+,d7	; Intrument data
(1)  229/  FF01BC : 6100 FF18           		bsr	sndReq_saddr
(1)  230/  FF01C0 : 6000 FEEC           		bra 	sndReq_Exit
(1)  231/  FF01C4 :                     
(1)  232/  FF01C4 :                     ; --------------------------------------------------------
(1)  233/  FF01C4 :                     ; SoundReq_StopTrack
(1)  234/  FF01C4 :                     ;
(1)  235/  FF01C4 :                     ; d0 - Slot
(1)  236/  FF01C4 :                     ; --------------------------------------------------------
(1)  237/  FF01C4 :                     
(1)  238/  FF01C4 :                     Sound_TrkStop:
(1)  239/  FF01C4 : 6100 FEB2           		bsr	sndReq_Enter
(1)  240/  FF01C8 : 3E3C 0001           		move.w	#$01,d7		; Command $01
(1)  241/  FF01CC : 6100 FEF6           		bsr	sndReq_scmd
(1)  242/  FF01D0 : 1E00                		move.b	d0,d7		; d0 - Slot
(1)  243/  FF01D2 : 6100 FF0A           		bsr	sndReq_sbyte
(1)  244/  FF01D6 : 6000 FED6           		bra 	sndReq_Exit
(1)  245/  FF01DA :                     
(1)  246/  FF01DA :                     ; --------------------------------------------------------
(1)  247/  FF01DA :                     ; Sound_TrkPause
(1)  248/  FF01DA :                     ;
(1)  249/  FF01DA :                     ; d0 - Slot
(1)  250/  FF01DA :                     ; --------------------------------------------------------
(1)  251/  FF01DA :                     
(1)  252/  FF01DA :                     Sound_TrkPause:
(1)  253/  FF01DA : 6100 FE9C           		bsr	sndReq_Enter
(1)  254/  FF01DE : 3E3C 0002           		move.w	#$02,d7		; Command $01
(1)  255/  FF01E2 : 6100 FEE0           		bsr	sndReq_scmd
(1)  256/  FF01E6 : 1E00                		move.b	d0,d7		; d0 - Slot
(1)  257/  FF01E8 : 6100 FEF4           		bsr	sndReq_sbyte
(1)  258/  FF01EC : 6000 FEC0           		bra 	sndReq_Exit
(1)  259/  FF01F0 :                     
(1)  260/  FF01F0 :                     ; --------------------------------------------------------
(1)  261/  FF01F0 :                     ; Sound_TrkResume
(1)  262/  FF01F0 :                     ;
(1)  263/  FF01F0 :                     ; d0 - Slot
(1)  264/  FF01F0 :                     ; --------------------------------------------------------
(1)  265/  FF01F0 :                     
(1)  266/  FF01F0 :                     Sound_TrkResume:
(1)  267/  FF01F0 : 6100 FE86           		bsr	sndReq_Enter
(1)  268/  FF01F4 : 3E3C 0003           		move.w	#$03,d7		; Command $01
(1)  269/  FF01F8 : 6100 FECA           		bsr	sndReq_scmd
(1)  270/  FF01FC : 1E00                		move.b	d0,d7		; d0 - Slot
(1)  271/  FF01FE : 6100 FEDE           		bsr	sndReq_sbyte
(1)  272/  FF0202 : 6000 FEAA           		bra 	sndReq_Exit
(1)  273/  FF0206 :                     
(1)  274/  FF0206 :                     ; --------------------------------------------------------
(1)  275/  FF0206 :                     ; Sound_TrkTicks
(1)  276/  FF0206 :                     ;
(1)  277/  FF0206 :                     ; d0 - Slot
(1)  278/  FF0206 :                     ; d1 - Ticks
(1)  279/  FF0206 :                     ; --------------------------------------------------------
(1)  280/  FF0206 :                     
(1)  281/  FF0206 :                     Sound_TrkTicks:
(1)  282/  FF0206 : 6100 FE70           		bsr	sndReq_Enter
(1)  283/  FF020A : 3E3C 0008           		move.w	#$08,d7		; Command $08
(1)  284/  FF020E : 6100 FEB4           		bsr	sndReq_scmd
(1)  285/  FF0212 : 1E00                		move.b	d0,d7		; d0 - Slot
(1)  286/  FF0214 : 6100 FEC8           		bsr	sndReq_sbyte
(1)  287/  FF0218 : 1E01                		move.b	d1,d7		; d1 - Ticks
(1)  288/  FF021A : 6100 FEC2           		bsr	sndReq_sbyte
(1)  289/  FF021E : 6000 FE8E           		bra 	sndReq_Exit
(1)  290/  FF0222 :                     
(1)  291/  FF0222 :                     ; --------------------------------------------------------
(1)  292/  FF0222 :                     ; Sound_GlbTempo
(1)  293/  FF0222 :                     ;
(1)  294/  FF0222 :                     ; d0 - Slot
(1)  295/  FF0222 :                     ; d1 - Tempo (WORD)
(1)  296/  FF0222 :                     ; --------------------------------------------------------
(1)  297/  FF0222 :                     
(1)  298/  FF0222 :                     Sound_GlbTempo:
(1)  299/  FF0222 : 6100 FE54           		bsr	sndReq_Enter
(1)  300/  FF0226 : 3E3C 0010           		move.w	#$10,d7		; Command $10
(1)  301/  FF022A : 6100 FE98           		bsr	sndReq_scmd
(1)  302/  FF022E : 1E00                		move.b	d0,d7		; d0 - Slot
(1)  303/  FF0230 : 6100 FEAC           		bsr	sndReq_sbyte
(1)  304/  FF0234 : 3E01                		move.w	d1,d7		; d1 - Tempo MSB
(1)  305/  FF0236 : 6100 FEA2           		bsr	sndReq_sword
(1)  306/  FF023A : 6000 FE72           		bra 	sndReq_Exit
(1)  307/  FF023E :                     
      35/  FF023E :                     		include	"system/md/video.asm"
(1)    1/  FF023E :                     ; ====================================================================
(1)    2/  FF023E :                     ; ----------------------------------------------------------------
(1)    3/  FF023E :                     ; MD Video
(1)    4/  FF023E :                     ; ----------------------------------------------------------------
(1)    5/  FF023E :                     
(1)    6/  FF023E :                     ; ------------------------------------------------
(1)    7/  FF023E :                     ; vdp_ctrl READ bits
(1)    8/  FF023E :                     ; ------------------------------------------------
(1)    9/  FF023E :                     
(1)   10/  FF023E : =$2                 bitHint		equ 2
(1)   11/  FF023E : =$3                 bitVint		equ 3
(1)   12/  FF023E : =$1                 bitDma		equ 1
(1)   13/  FF023E :                     
(1)   14/  FF023E :                     ; ------------------------------------------------
(1)   15/  FF023E :                     ; VDP register variables
(1)   16/  FF023E :                     ; ------------------------------------------------
(1)   17/  FF023E :                     
(1)   18/  FF023E :                     ; Register $80
(1)   19/  FF023E : =$2                 HVStop		equ $02
(1)   20/  FF023E : =$10                HintEnbl	equ $10
(1)   21/  FF023E : =$1                 bitHVStop	equ 1
(1)   22/  FF023E : =$4                 bitHintEnbl	equ 4
(1)   23/  FF023E :                     
(1)   24/  FF023E :                     ; Register $81
(1)   25/  FF023E : =$40                DispEnbl 	equ $40
(1)   26/  FF023E : =$20                VintEnbl 	equ $20
(1)   27/  FF023E : =$10                DmaEnbl		equ $10
(1)   28/  FF023E : =$6                 bitDispEnbl	equ 6
(1)   29/  FF023E : =$5                 bitVintEnbl	equ 5
(1)   30/  FF023E : =$4                 bitDmaEnbl	equ 4
(1)   31/  FF023E : =$3                 bitV30		equ 3
(1)   32/  FF023E :                     
(1)   33/  FF023E :                     ; --------------------------------------------------------
(1)   34/  FF023E :                     ; Init Video
(1)   35/  FF023E :                     ; 
(1)   36/  FF023E :                     ; Uses:
(1)   37/  FF023E :                     ; a0-a2,d0-d1
(1)   38/  FF023E :                     ; --------------------------------------------------------
(1)   39/  FF023E :                     
(1)   40/  FF023E :                     Video_Init:		
(1)   41/  FF023E : 4DF8 C820           		lea	(RAM_MdVideo),a6	; Clear RAM
(1)   42/  FF0242 : 7C00                		moveq	#0,d6
(1)   43/  FF0244 : 3E3C 0AED           		move.w	#(sizeof_mdvid-RAM_MdVideo)-1,d7
(1)   44/  FF0248 :                     .clrram:
(1)   45/  FF0248 : 1CC6                		move.b	d6,(a6)+
(1)   46/  FF024A : 51CF FFFC           		dbf	d7,.clrram
(1)   47/  FF024E : 4DFA 05BC           		lea	list_vdpregs(pc),a6	; Init registers
(1)   48/  FF0252 : 4BF8 D2F6           		lea	(RAM_VdpRegs).w,a5
(1)   49/  FF0256 : 49F9 00C0 0004      		lea	(vdp_ctrl),a4
(1)   50/  FF025C : 3C3C 8000           		move.w	#$8000,d6
(1)   51/  FF0260 : 3E3C 0012           		move.w	#19-1,d7
(1)   52/  FF0264 :                     .loop:
(1)   53/  FF0264 : 1C1E                		move.b	(a6)+,d6
(1)   54/  FF0266 : 1AC6                		move.b	d6,(a5)+
(1)   55/  FF0268 : 3886                		move.w	d6,(a4)
(1)   56/  FF026A : DC7C 0100           		add.w	#$100,d6
(1)   57/  FF026E : 51CF FFF4           		dbf	d7,.loop
(1)   58/  FF0272 :                     .exit:
(1)   59/  FF0272 : 4E75                		rts
(1)   60/  FF0274 :                     
(1)   61/  FF0274 :                     ; ====================================================================
(1)   62/  FF0274 :                     ; ----------------------------------------------------------------
(1)   63/  FF0274 :                     ; Video subroutines
(1)   64/  FF0274 :                     ; ----------------------------------------------------------------
(1)   65/  FF0274 :                     
(1)   66/  FF0274 :                     ; --------------------------------------------------------
(1)   67/  FF0274 :                     ; Video_Clear
(1)   68/  FF0274 :                     ; 
(1)   69/  FF0274 :                     ; Clear all video data from VRAM
(1)   70/  FF0274 :                     ; --------------------------------------------------------
(1)   71/  FF0274 :                     
(1)   72/  FF0274 :                     Video_Clear:
(1)   73/  FF0274 : 303C 0000           		move.w	#0,d0			; Clears until $57F
(1)   74/  FF0278 : 323C 0000           		move.w	#0,d1
(1)   75/  FF027C : 343C AFE0           		move.w	#$57F*$20,d2
(1)   76/  FF0280 : 6100 02DE           		bsr	Video_Fill
(1)   77/  FF0284 :                     
(1)   78/  FF0284 : 343C 0FFF           		move.w	#$FFF,d2		; FG/BG size
(1)   79/  FF0288 : 1239 FFFF D2F8      		move.b	(RAM_VdpRegs+2).l,d1	; FG
(1)   80/  FF028E : 0241 0038           		andi.w	#%111000,d1
(1)   81/  FF0292 : E149                		lsl.w	#8,d1
(1)   82/  FF0294 : E549                		lsl.w	#2,d1
(1)   83/  FF0296 : 6100 02C8           		bsr	Video_Fill
(1)   84/  FF029A : 1239 FFFF D2F9      		move.b	(RAM_VdpRegs+3).l,d1	; BG
(1)   85/  FF02A0 : 0241 0007           		andi.w	#%000111,d1
(1)   86/  FF02A4 : E149                		lsl.w	#8,d1
(1)   87/  FF02A6 : EB49                		lsl.w	#5,d1
(1)   88/  FF02A8 : 6100 02B6           		bsr	Video_Fill
(1)   89/  FF02AC :                     
(1)   90/  FF02AC : 343C 0FFF           		move.w	#$FFF,d2		; WD Size
(1)   91/  FF02B0 : 1239 FFFF D2FA      		move.b	(RAM_VdpRegs+4).l,d1	; Window
(1)   92/  FF02B6 : 0241 003E           		andi.w	#%111110,d1
(1)   93/  FF02BA : E149                		lsl.w	#8,d1
(1)   94/  FF02BC : E549                		lsl.w	#2,d1
(1)   95/  FF02BE : 6000 02A0           		bra	Video_Fill
(1)   96/  FF02C2 :                     		
(1)   97/  FF02C2 :                     ; --------------------------------------------------------
(1)   98/  FF02C2 :                     ; Video_Update
(1)   99/  FF02C2 :                     ; 
(1)  100/  FF02C2 :                     ; Writes register data stored in RAM to VDP
(1)  101/  FF02C2 :                     ; from Registers $80 to $90
(1)  102/  FF02C2 :                     ; 
(1)  103/  FF02C2 :                     ; Uses:
(1)  104/  FF02C2 :                     ; d6-d7,a5-a6
(1)  105/  FF02C2 :                     ; --------------------------------------------------------
(1)  106/  FF02C2 :                     
(1)  107/  FF02C2 :                     Video_Update:
(1)  108/  FF02C2 : 4DF8 D2F6           		lea	(RAM_VdpRegs).w,a6
(1)  109/  FF02C6 : 4BF9 00C0 0004      		lea	(vdp_ctrl),a5
(1)  110/  FF02CC : 3C3C 8000           		move.w	#$8000,d6
(1)  111/  FF02D0 : 3E3C 0010           		move.w	#17-1,d7
(1)  112/  FF02D4 :                     .loop:
(1)  113/  FF02D4 : 1C1E                		move.b	(a6)+,d6
(1)  114/  FF02D6 : 3A86                		move.w	d6,(a5)
(1)  115/  FF02D8 : DC7C 0100           		add.w	#$100,d6
(1)  116/  FF02DC : 51CF FFF6           		dbf	d7,.loop
(1)  117/  FF02E0 :                     .exit:
(1)  118/  FF02E0 : 4E75                		rts
(1)  119/  FF02E2 :                     		
(1)  120/  FF02E2 :                     ; --------------------------------------------------------
(1)  121/  FF02E2 :                     ; Video_LoadPal
(1)  122/  FF02E2 :                     ; Load palette to VDP directly
(1)  123/  FF02E2 :                     ; 
(1)  124/  FF02E2 :                     ; Input:
(1)  125/  FF02E2 :                     ; a0 - Palette data
(1)  126/  FF02E2 :                     ; d0 - Start position
(1)  127/  FF02E2 :                     ; d1 - Number of colors
(1)  128/  FF02E2 :                     ; 
(1)  129/  FF02E2 :                     ; Uses:
(1)  130/  FF02E2 :                     ; d5-d7,a6
(1)  131/  FF02E2 :                     ; 
(1)  132/  FF02E2 :                     ; Note:
(1)  133/  FF02E2 :                     ; It waits for VBlank so the CRAM dots doesn't get
(1)  134/  FF02E2 :                     ; in the middle of the screen.
(1)  135/  FF02E2 :                     ; --------------------------------------------------------
(1)  136/  FF02E2 :                     
(1)  137/  FF02E2 :                     Video_LoadPal:
(1)  138/  FF02E2 : 4DF9 00C0 0000      		lea	(vdp_data),a6
(1)  139/  FF02E8 : 7E00                		moveq	#0,d7
(1)  140/  FF02EA : 3E00                		move.w	d0,d7
(1)  141/  FF02EC : DE47                		add.w	d7,d7
(1)  142/  FF02EE : 0047 C000           		ori.w	#$C000,d7
(1)  143/  FF02F2 : 4847                		swap	d7
(1)  144/  FF02F4 : 2D47 0004           		move.l	d7,4(a6)
(1)  145/  FF02F8 : 3E01                		move.w	d1,d7
(1)  146/  FF02FA : 3C2E 0004           .outv: 		move.w	4(a6),d6
(1)  147/  FF02FE : 0806 0003           		btst	#bitVint,d6
(1)  148/  FF0302 : 67F6                		beq.s	.outv
(1)  149/  FF0304 :                     .loop:
(1)  150/  FF0304 : 3C98                		move.w	(a0)+,(a6)
(1)  151/  FF0306 : 51CF FFFC           		dbf	d7,.loop
(1)  152/  FF030A : 4E75                		rts
(1)  153/  FF030C :                     		
(1)  154/  FF030C :                     ; --------------------------------------------------------
(1)  155/  FF030C :                     ; Video_LoadMap
(1)  156/  FF030C :                     ; 
(1)  157/  FF030C :                     ; Load map data, Horizontal order
(1)  158/  FF030C :                     ; 
(1)  159/  FF030C :                     ; a0 - Map data
(1)  160/  FF030C :                     ; d0 | LONG - 00|Layer|X|Y, locate(lyr,x,y)  
(1)  161/  FF030C :                     ; d1 | LONG - Width|Height (in cells),  mapsize(x,y)
(1)  162/  FF030C :                     ; d2 | WORD - VRAM
(1)  163/  FF030C :                     ;
(1)  164/  FF030C :                     ; Can autodetect layer width.
(1)  165/  FF030C :                     ;
(1)  166/  FF030C :                     ; Uses:
(1)  167/  FF030C :                     ; d4-d7,a6
(1)  168/  FF030C :                     ; --------------------------------------------------------
(1)  169/  FF030C :                     
(1)  170/  FF030C :                     Video_LoadMap:
(1)  171/  FF030C : 4DF9 00C0 0000      		lea	(vdp_data),a6
(1)  172/  FF0312 : 6100 01B0           		bsr	vid_PickLayer
(1)  173/  FF0316 : 3A01                		move.w	d1,d5		; Start here
(1)  174/  FF0318 :                     .yloop:
(1)  175/  FF0318 : 4845                		swap	d5
(1)  176/  FF031A : 2D44 0004           		move.l	d4,4(a6)
(1)  177/  FF031E : 2E01                		move.l	d1,d7
(1)  178/  FF0320 : 4847                		swap	d7
(1)  179/  FF0322 :                     .xloop:
(1)  180/  FF0322 : 3A18                		move.w	(a0)+,d5
(1)  181/  FF0324 : BA7C FFFF           		cmp.w	#-1,d5
(1)  182/  FF0328 : 6606                		bne.s	.nonull
(1)  183/  FF032A : 3A3C 07FF           		move.w	#varNullVram,d5
(1)  184/  FF032E : 6002                		bra.s	.cont
(1)  185/  FF0330 :                     .nonull:
(1)  186/  FF0330 : DA42                		add.w	d2,d5
(1)  187/  FF0332 :                     .cont:
(1)  188/  FF0332 : 4847                		swap	d7
(1)  189/  FF0334 : 1E39 FFFF D302      		move.b	(RAM_VdpRegs+$C).l,d7
(1)  190/  FF033A : CE7C 0006           		and.w	#%110,d7
(1)  191/  FF033E : BE7C 0006           		cmp.w	#%110,d7
(1)  192/  FF0342 : 660E                		bne.s	.nodble
(1)  193/  FF0344 : 3E05                		move.w	d5,d7
(1)  194/  FF0346 : E24F                		lsr.w	#1,d7
(1)  195/  FF0348 : CE7C 07FF           		and.w	#$7FF,d7
(1)  196/  FF034C : CA7C F800           		and.w	#$F800,d5
(1)  197/  FF0350 : 8A47                		or.w	d7,d5
(1)  198/  FF0352 :                     .nodble:
(1)  199/  FF0352 : 4847                		swap	d7
(1)  200/  FF0354 : 3C85                		move.w	d5,(a6)
(1)  201/  FF0356 : 51CF FFCA           		dbf	d7,.xloop
(1)  202/  FF035A : D886                		add.l	d6,d4
(1)  203/  FF035C : 4845                		swap	d5
(1)  204/  FF035E : 51CD FFB8           		dbf	d5,.yloop
(1)  205/  FF0362 : 4E75                		rts
(1)  206/  FF0364 :                     
(1)  207/  FF0364 :                     ; ; --------------------------------------------------------
(1)  208/  FF0364 :                     ; ; Video_LoadMap_Vert
(1)  209/  FF0364 :                     ; ;
(1)  210/  FF0364 :                     ; ; Load map data, Vertical order
(1)  211/  FF0364 :                     ; ;
(1)  212/  FF0364 :                     ; ; a0 - Map data
(1)  213/  FF0364 :                     ; ; d0 | LONG - 00|Lyr|X|Y,  locate(lyr,x,y)
(1)  214/  FF0364 :                     ; ; d1 | LONG - Width|Height (cells),  mapsize(x,y)
(1)  215/  FF0364 :                     ; ; d2 | WORD - VRAM
(1)  216/  FF0364 :                     ;
(1)  217/  FF0364 :                     ; ; Uses:
(1)  218/  FF0364 :                     ; ; a4-a5,d4-d7
(1)  219/  FF0364 :                     ; ; --------------------------------------------------------
(1)  220/  FF0364 :                     ;
(1)  221/  FF0364 :                     ; Video_LoadMap_Vert:
(1)  222/  FF0364 :                     ; 		lea	(vdp_data),a4
(1)  223/  FF0364 :                     ; 		bsr	vid_PickLayer
(1)  224/  FF0364 :                     ; 		move.l	d1,d5		; Start here
(1)  225/  FF0364 :                     ; 		swap	d5
(1)  226/  FF0364 :                     ; .xloop:
(1)  227/  FF0364 :                     ; 		swap	d5
(1)  228/  FF0364 :                     ; 		move.l	d4,-(sp)
(1)  229/  FF0364 :                     ; 		move.w	d1,d7
(1)  230/  FF0364 :                     ; 		btst	#2,(RAM_VdpRegs+$C).l
(1)  231/  FF0364 :                     ; 		beq.s	.yloop
(1)  232/  FF0364 :                     ; 		lsr.w	#1,d7
(1)  233/  FF0364 :                     ; .yloop:
(1)  234/  FF0364 :                     ; 		move.l	d4,4(a4)
(1)  235/  FF0364 :                     ; 		move.w	(a0),d5
(1)  236/  FF0364 :                     ; 		cmp.w	#-1,d5
(1)  237/  FF0364 :                     ; 		bne.s	.nonull
(1)  238/  FF0364 :                     ; 		move.w	#varNullVram,d5
(1)  239/  FF0364 :                     ; 		bra.s	.cont
(1)  240/  FF0364 :                     ; .nonull:
(1)  241/  FF0364 :                     ; 		add.w	d2,d5
(1)  242/  FF0364 :                     ; .cont:
(1)  243/  FF0364 :                     ; 		swap	d7
(1)  244/  FF0364 :                     ; 		adda	#2,a0
(1)  245/  FF0364 :                     ; 		btst	#2,(RAM_VdpRegs+$C).l
(1)  246/  FF0364 :                     ; 		beq.s	.nodble
(1)  247/  FF0364 :                     ; 		adda	#2,a0
(1)  248/  FF0364 :                     ; 		move.w	d5,d7
(1)  249/  FF0364 :                     ; 		lsr.w	#1,d7
(1)  250/  FF0364 :                     ; 		and.w	#$7FF,d7
(1)  251/  FF0364 :                     ; 		and.w	#$F800,d5
(1)  252/  FF0364 :                     ; 		or.w	d7,d5
(1)  253/  FF0364 :                     ; .nodble:
(1)  254/  FF0364 :                     ; 		swap	d7
(1)  255/  FF0364 :                     ; 		move.w	d5,(a4)
(1)  256/  FF0364 :                     ; 		add.l	d6,d4
(1)  257/  FF0364 :                     ; 		dbf	d7,.yloop
(1)  258/  FF0364 :                     ; .outdbl:
(1)  259/  FF0364 :                     ; 		move.l	(sp)+,d4
(1)  260/  FF0364 :                     ; 		add.l	#$20000,d4
(1)  261/  FF0364 :                     ; 		swap	d5
(1)  262/  FF0364 :                     ; 		dbf	d5,.xloop
(1)  263/  FF0364 :                     ; 		rts
(1)  264/  FF0364 :                     		
(1)  265/  FF0364 :                     ; ; --------------------------------------------------------
(1)  266/  FF0364 :                     ; ; Video_AutoMap_Vert
(1)  267/  FF0364 :                     ; ;
(1)  268/  FF0364 :                     ; ; Make automatic map, Vertical order
(1)  269/  FF0364 :                     ; ;
(1)  270/  FF0364 :                     ; ; MCD: Use this to make a virtual screen
(1)  271/  FF0364 :                     ; ; for Stamps
(1)  272/  FF0364 :                     ; ;
(1)  273/  FF0364 :                     ; ; d0 | LONG - 00|Lyr|X|Y,  locate(lyr,x,y)
(1)  274/  FF0364 :                     ; ; d1 | LONG - Width|Height (cells),  mapsize(x,y)
(1)  275/  FF0364 :                     ; ; d2 | WORD - VRAM
(1)  276/  FF0364 :                     ;
(1)  277/  FF0364 :                     ; ; Uses:
(1)  278/  FF0364 :                     ; ; a4-a5,d4-d7
(1)  279/  FF0364 :                     ; ; --------------------------------------------------------
(1)  280/  FF0364 :                     ;
(1)  281/  FF0364 :                     ; ; TODO: double interlace
(1)  282/  FF0364 :                     ; Video_AutoMap_Vert:
(1)  283/  FF0364 :                     ; 		lea	(vdp_data),a4
(1)  284/  FF0364 :                     ; 		bsr	vid_PickLayer
(1)  285/  FF0364 :                     ; 		move.w	d2,d7		; Start here
(1)  286/  FF0364 :                     ; 		move.l	d1,d5
(1)  287/  FF0364 :                     ; 		swap	d5
(1)  288/  FF0364 :                     ; .xloop:
(1)  289/  FF0364 :                     ; 		swap	d5
(1)  290/  FF0364 :                     ; 		move.l	d4,-(sp)
(1)  291/  FF0364 :                     ; 		move.w	d1,d5
(1)  292/  FF0364 :                     ; 		btst	#2,(RAM_VdpRegs+$C).l
(1)  293/  FF0364 :                     ; 		beq.s	.yloop
(1)  294/  FF0364 :                     ; 		lsr.w	#1,d5
(1)  295/  FF0364 :                     ; .yloop:
(1)  296/  FF0364 :                     ; 		move.l	d4,4(a4)
(1)  297/  FF0364 :                     ; 		move.w	d7,(a4)
(1)  298/  FF0364 :                     ; 		add.w	#1,d7
(1)  299/  FF0364 :                     ; 		add.l	d6,d4
(1)  300/  FF0364 :                     ; 		dbf	d5,.yloop
(1)  301/  FF0364 :                     ;
(1)  302/  FF0364 :                     ; 		move.l	(sp)+,d4
(1)  303/  FF0364 :                     ; 		add.l	#$20000,d4
(1)  304/  FF0364 :                     ; 		swap	d5
(1)  305/  FF0364 :                     ; 		dbf	d5,.xloop
(1)  306/  FF0364 :                     ; 		rts
(1)  307/  FF0364 :                     
(1)  308/  FF0364 :                     ; --------------------------------------------------------
(1)  309/  FF0364 :                     ; Video_PrintInit
(1)  310/  FF0364 :                     ; 
(1)  311/  FF0364 :                     ; Load palette and font for printing text
(1)  312/  FF0364 :                     ; --------------------------------------------------------
(1)  313/  FF0364 :                     
(1)  314/  FF0364 :                     Video_PrintInit:
(1)  315/  FF0364 : 41FA 04BA           		lea	ASCII_PAL(pc),a0
(1)  316/  FF0368 : 7030                		moveq	#$30,d0
(1)  317/  FF036A : 323C 000F           		move.w	#$F,d1
(1)  318/  FF036E : 6100 FF72           		bsr	Video_LoadPal
(1)  319/  FF0372 : 203C 00FF 0840      		move.l	#ASCII_FONT,d0
(1)  320/  FF0378 : 323C B000           		move.w	#$580*$20,d1
(1)  321/  FF037C : 343C 1000           		move.w	#ASCII_FONT_e-ASCII_FONT,d2
(1)  322/  FF0380 : 363C 6580           		move.w	#$580|$6000,d3
(1)  323/  FF0384 : 31C3 D174           		move.w	d3,(RAM_VidPrntVram).w
(1)  324/  FF0388 : 6000 03C0           		bra	Video_LoadArt
(1)  325/  FF038C :                     
(1)  326/  FF038C :                     ; --------------------------------------------------------
(1)  327/  FF038C :                     ; Video_Print
(1)  328/  FF038C :                     ;
(1)  329/  FF038C :                     ; Prints string to layer
(1)  330/  FF038C :                     ; requires ASCII font
(1)  331/  FF038C :                     ; 
(1)  332/  FF038C :                     ; a0 - string data + RAM address to peek (optional)
(1)  333/  FF038C :                     ; d0 | LONG - 00|Lyr|X|Y, locate(lyr,x,y)
(1)  334/  FF038C :                     ; 
(1)  335/  FF038C :                     ; Special characters:
(1)  336/  FF038C :                     ; "//b" - Shows BYTE value
(1)  337/  FF038C :                     ; "//w" - Shows WORD value
(1)  338/  FF038C :                     ; "//l" - Shows LONG value
(1)  339/  FF038C :                     ;   $0A - Next line
(1)  340/  FF038C :                     ;   $00 - End of line
(1)  341/  FF038C :                     ;
(1)  342/  FF038C :                     ; After $00, put your RAM addresses in LONGS
(1)  343/  FF038C :                     ; don't forget to put align 2 at the end.
(1)  344/  FF038C :                     ;
(1)  345/  FF038C :                     ; CALL Video_PrintInit ONCE to use this feature.
(1)  346/  FF038C :                     ;
(1)  347/  FF038C :                     ; Uses:
(1)  348/  FF038C :                     ; d4-d7,a4-a6
(1)  349/  FF038C :                     ; --------------------------------------------------------
(1)  350/  FF038C :                     
(1)  351/  FF038C :                     Video_Print:
(1)  352/  FF038C :                     ; 		movem.l	d3-d7,-(sp)
(1)  353/  FF038C :                     ; 		movem.l	a4-a6,-(sp)
(1)  354/  FF038C :                     		
(1)  355/  FF038C : 4DF9 00C0 0000      		lea	(vdp_data),a6
(1)  356/  FF0392 : 6100 0130           		bsr	vid_PickLayer
(1)  357/  FF0396 : 4BF8 D176           		lea	(RAM_VidPrntList),a5
(1)  358/  FF039A :                     .newjump:
(1)  359/  FF039A : 2D44 0004           		move.l	d4,4(a6)
(1)  360/  FF039E : 2A04                		move.l	d4,d5
(1)  361/  FF03A0 :                     .loop:
(1)  362/  FF03A0 : 1E18                		move.b	(a0)+,d7
(1)  363/  FF03A2 : 6772                		beq	.exit
(1)  364/  FF03A4 : 0C07 000A           		cmpi.b	#$A,d7			; $A - next line?
(1)  365/  FF03A8 : 6718                		beq.s	.next
(1)  366/  FF03AA : 0C07 005C           		cmpi.b	#$5C,d7			; $27 ("\") special?
(1)  367/  FF03AE : 6716                		beq.s	.special
(1)  368/  FF03B0 : 0247 00FF           		andi.w	#$FF,d7
(1)  369/  FF03B4 :                     .puttext:
(1)  370/  FF03B4 : DE78 D174           		add.w	(RAM_VidPrntVram).w,d7	; VRAM add
(1)  371/  FF03B8 : 3C87                		move.w	d7,(a6)
(1)  372/  FF03BA : DABC 0002 0000      		add.l	#$20000,d5
(1)  373/  FF03C0 : 60DE                		bra.s	.loop
(1)  374/  FF03C2 :                     ; Next line
(1)  375/  FF03C2 :                     .next:
(1)  376/  FF03C2 : D886                		add.l	d6,d4
(1)  377/  FF03C4 : 60D4                		bra.s	.newjump
(1)  378/  FF03C6 :                     
(1)  379/  FF03C6 :                     ; Specials
(1)  380/  FF03C6 :                     .special:
(1)  381/  FF03C6 : 1E18                		move.b	(a0)+,d7
(1)  382/  FF03C8 : 0C07 0062           		cmpi.b	#"b",d7
(1)  383/  FF03CC : 6712                		beq.s	.isbyte
(1)  384/  FF03CE : 0C07 0077           		cmpi.b	#"w",d7
(1)  385/  FF03D2 : 671E                		beq.s	.isword
(1)  386/  FF03D4 : 0C07 006C           		cmpi.b	#"l",d7
(1)  387/  FF03D8 : 672A                		beq.s	.islong
(1)  388/  FF03DA : 3E3C 005C           		move.w	#"\\",d7			; nothing to do
(1)  389/  FF03DE : 60D4                		bra.s	.puttext
(1)  390/  FF03E0 :                     		
(1)  391/  FF03E0 :                     	; TEMPORAL VALUES
(1)  392/  FF03E0 :                     .isbyte:
(1)  393/  FF03E0 : 2AC5                		move.l	d5,(a5)+
(1)  394/  FF03E2 : 3AFC 0001           		move.w	#1,(a5)+
(1)  395/  FF03E6 : DABC 0004 0000      		add.l	#$40000,d5
(1)  396/  FF03EC : 2D45 0004           		move.l	d5,4(a6)
(1)  397/  FF03F0 : 60AE                		bra	.loop
(1)  398/  FF03F2 :                     .isword:
(1)  399/  FF03F2 : 2AC5                		move.l	d5,(a5)+
(1)  400/  FF03F4 : 3AFC 0002           		move.w	#2,(a5)+
(1)  401/  FF03F8 : DABC 0008 0000      		add.l	#$80000,d5
(1)  402/  FF03FE : 2D45 0004           		move.l	d5,4(a6)
(1)  403/  FF0402 : 609C                		bra	.loop
(1)  404/  FF0404 :                     .islong:
(1)  405/  FF0404 : 2AC5                		move.l	d5,(a5)+
(1)  406/  FF0406 : 3AFC 0003           		move.w	#3,(a5)+
(1)  407/  FF040A : DABC 0010 0000      		add.l	#$100000,d5
(1)  408/  FF0410 : 2D45 0004           		move.l	d5,4(a6)
(1)  409/  FF0414 : 608A                		bra	.loop
(1)  410/  FF0416 :                     .exit:
(1)  411/  FF0416 :                     
(1)  412/  FF0416 :                     ; --------------------------------------------------------
(1)  413/  FF0416 :                     ; Print values
(1)  414/  FF0416 :                     ; 
(1)  415/  FF0416 :                     ; vvvv vvvv tttt
(1)  416/  FF0416 :                     ; v - vdp pos
(1)  417/  FF0416 :                     ; t - value type
(1)  418/  FF0416 :                     ; --------------------------------------------------------
(1)  419/  FF0416 :                     
(1)  420/  FF0416 :                     ; reading byte by byte because longs doens't get
(1)  421/  FF0416 :                     ; aligned after $00...
(1)  422/  FF0416 :                     
(1)  423/  FF0416 : 7800                		moveq	#0,d4
(1)  424/  FF0418 : 7A00                		moveq	#0,d5
(1)  425/  FF041A : 7C00                		moveq	#0,d6
(1)  426/  FF041C : 4BF8 D176           		lea	(RAM_VidPrntList),a5
(1)  427/  FF0420 :                     .nextv:
(1)  428/  FF0420 : 4A95                		tst.l	(a5)
(1)  429/  FF0422 : 6700 009E           		beq	.nothing
(1)  430/  FF0426 :                     	; grab value
(1)  431/  FF0426 : 7800                		moveq	#0,d4
(1)  432/  FF0428 : 1818                		move.b	(a0)+,d4
(1)  433/  FF042A : E19C                		rol.l	#8,d4
(1)  434/  FF042C : 1818                		move.b	(a0)+,d4
(1)  435/  FF042E : E19C                		rol.l	#8,d4
(1)  436/  FF0430 : 1818                		move.b	(a0)+,d4
(1)  437/  FF0432 : E19C                		rol.l	#8,d4
(1)  438/  FF0434 : 1818                		move.b	(a0)+,d4
(1)  439/  FF0436 : 2844                		movea.l	d4,a4
(1)  440/  FF0438 : 7800                		moveq	#0,d4
(1)  441/  FF043A :                     
(1)  442/  FF043A :                     	; get value
(1)  443/  FF043A : 3C2D 0004           		move.w	4(a5),d6
(1)  444/  FF043E : BC7C 0001           		cmp.w	#1,d6		; byte?
(1)  445/  FF0442 : 660E                		bne.s	.vbyte
(1)  446/  FF0444 : 1814                		move.b	(a4),d4
(1)  447/  FF0446 : 2D55 0004           		move.l	(a5),4(a6)
(1)  448/  FF044A : E91C                		rol.b	#4,d4
(1)  449/  FF044C : 6158                		bsr.s	.donibl
(1)  450/  FF044E : E91C                		rol.b	#4,d4
(1)  451/  FF0450 : 6154                		bsr.s	.donibl
(1)  452/  FF0452 :                     .vbyte:
(1)  453/  FF0452 : BC7C 0002           		cmp.w	#2,d6		; word?
(1)  454/  FF0456 : 661C                		bne.s	.vword
(1)  455/  FF0458 : 1814                		move.b	(a4),d4
(1)  456/  FF045A : E15C                		rol.w	#8,d4
(1)  457/  FF045C : 182C 0001           		move.b	1(a4),d4
(1)  458/  FF0460 : 2D55 0004           		move.l	(a5),4(a6)
(1)  459/  FF0464 : E95C                		rol.w	#4,d4
(1)  460/  FF0466 : 613E                		bsr.s	.donibl
(1)  461/  FF0468 : E95C                		rol.w	#4,d4
(1)  462/  FF046A : 613A                		bsr.s	.donibl
(1)  463/  FF046C : E95C                		rol.w	#4,d4
(1)  464/  FF046E : 6136                		bsr.s	.donibl
(1)  465/  FF0470 : E95C                		rol.w	#4,d4
(1)  466/  FF0472 : 6132                		bsr.s	.donibl
(1)  467/  FF0474 :                     .vword:
(1)  468/  FF0474 : BC7C 0003           		cmp.w	#3,d6		; long?
(1)  469/  FF0478 : 6624                		bne.s	.vlong
(1)  470/  FF047A : 1814                		move.b	(a4),d4
(1)  471/  FF047C : E19C                		rol.l	#8,d4
(1)  472/  FF047E : 182C 0001           		move.b	1(a4),d4
(1)  473/  FF0482 : E19C                		rol.l	#8,d4
(1)  474/  FF0484 : 182C 0002           		move.b	2(a4),d4
(1)  475/  FF0488 : E19C                		rol.l	#8,d4
(1)  476/  FF048A : 182C 0003           		move.b	3(a4),d4
(1)  477/  FF048E : 2D55 0004           		move.l	(a5),4(a6)
(1)  478/  FF0492 : 3C3C 0007           		move.w	#7,d6
(1)  479/  FF0496 : E99C                .lngloop:	rol.l	#4,d4
(1)  480/  FF0498 : 610C                		bsr.s	.donibl
(1)  481/  FF049A : 51CE FFFA           		dbf	d6,.lngloop
(1)  482/  FF049E :                     .vlong:
(1)  483/  FF049E : 429D                		clr.l	(a5)+
(1)  484/  FF04A0 : 425D                		clr.w	(a5)+
(1)  485/  FF04A2 : 6000 FF7C           		bra	.nextv
(1)  486/  FF04A6 :                     
(1)  487/  FF04A6 :                     ; make nibble byte
(1)  488/  FF04A6 :                     .donibl:
(1)  489/  FF04A6 : 3A04                		move.w	d4,d5
(1)  490/  FF04A8 : 0245 000F           		andi.w	#%1111,d5
(1)  491/  FF04AC : BA3C 000A           		cmp.b	#$A,d5
(1)  492/  FF04B0 : 6D04                		blt.s	.lowr
(1)  493/  FF04B2 : DA3C 0007           		add.b	#7,d5
(1)  494/  FF04B6 :                     .lowr:
(1)  495/  FF04B6 : DA7C 0030           		add.w	#"0",d5
(1)  496/  FF04BA : DA78 D174           		add.w	(RAM_VidPrntVram),d5
(1)  497/  FF04BE : 3C85                		move.w	d5,(a6)
(1)  498/  FF04C0 : 4E75                		rts
(1)  499/  FF04C2 :                     ; exit
(1)  500/  FF04C2 :                     .nothing:
(1)  501/  FF04C2 :                     ; 		movem.l	(sp)+,a4-a6
(1)  502/  FF04C2 :                     ; 		movem.l	(sp)+,d3-d7
(1)  503/  FF04C2 : 4E75                		rts
(1)  504/  FF04C4 :                     
(1)  505/  FF04C4 :                     ; --------------------------------------------------------
(1)  506/  FF04C4 :                     ; Shared: pick layer / x pos / y pos and set size
(1)  507/  FF04C4 :                     ; --------------------------------------------------------
(1)  508/  FF04C4 :                     
(1)  509/  FF04C4 :                     vid_PickLayer:
(1)  510/  FF04C4 : 2C00                		move.l	d0,d6			; Pick layer
(1)  511/  FF04C6 : 4846                		swap	d6
(1)  512/  FF04C8 : 0806 0000           		btst	#0,d6
(1)  513/  FF04CC : 671E                		beq.s	.plawnd
(1)  514/  FF04CE : 1839 FFFF D2FA      		move.b	(RAM_VdpRegs+4).l,d4	; BG
(1)  515/  FF04D4 : 3A04                		move.w	d4,d5
(1)  516/  FF04D6 : E24D                		lsr.w	#1,d5
(1)  517/  FF04D8 : 0245 0003           		andi.w	#%11,d5
(1)  518/  FF04DC : 4844                		swap	d4
(1)  519/  FF04DE : 3805                		move.w	d5,d4
(1)  520/  FF04E0 : 4844                		swap	d4
(1)  521/  FF04E2 : 0244 0001           		andi.w	#1,d4
(1)  522/  FF04E6 : E14C                		lsl.w	#8,d4
(1)  523/  FF04E8 : EB4C                		lsl.w	#5,d4
(1)  524/  FF04EA : 6028                		bra.s	.golyr
(1)  525/  FF04EC :                     .plawnd:
(1)  526/  FF04EC : 1839 FFFF D2F8      		move.b	(RAM_VdpRegs+2).l,d4	; FG
(1)  527/  FF04F2 : 0806 0001           		btst	#1,d6
(1)  528/  FF04F6 : 6706                		beq.s	.nowd
(1)  529/  FF04F8 : 1839 FFFF D2F9      		move.b	(RAM_VdpRegs+3).l,d4	; WINDOW
(1)  530/  FF04FE :                     .nowd:		
(1)  531/  FF04FE : 3A04                		move.w	d4,d5
(1)  532/  FF0500 : E84D                		lsr.w	#4,d5
(1)  533/  FF0502 : 0245 0003           		andi.w	#%11,d5
(1)  534/  FF0506 : 4844                		swap	d4
(1)  535/  FF0508 : 3805                		move.w	d5,d4
(1)  536/  FF050A : 4844                		swap	d4
(1)  537/  FF050C : 0244 000E           		andi.w	#%00001110,d4
(1)  538/  FF0510 : E14C                		lsl.w	#8,d4
(1)  539/  FF0512 : E54C                		lsl.w	#2,d4
(1)  540/  FF0514 :                     .golyr:
(1)  541/  FF0514 : 0044 4000           		ori.w	#$4000,d4
(1)  542/  FF0518 : 3A00                		move.w	d0,d5			; Y start pos
(1)  543/  FF051A : 0245 00FF           		andi.w	#$FF,d5			; Y only
(1)  544/  FF051E : ED4D                		lsl.w	#6,d5			
(1)  545/  FF0520 : 1C38 D306           		move.b	(RAM_VdpRegs+$10).w,d6
(1)  546/  FF0524 : 0246 0003           		andi.w	#%11,d6
(1)  547/  FF0528 : 670A                		beq.s	.thissz
(1)  548/  FF052A : DA45                		add.w	d5,d5			; H64
(1)  549/  FF052C : 0246 0002           		andi.w	#%10,d6
(1)  550/  FF0530 : 6702                		beq.s	.thissz
(1)  551/  FF0532 : DA45                		add.w	d5,d5			; H128		
(1)  552/  FF0534 :                     .thissz:
(1)  553/  FF0534 : D845                		add.w	d5,d4
(1)  554/  FF0536 : 3A00                		move.w	d0,d5
(1)  555/  FF0538 : 0245 FF00           		andi.w	#$FF00,d5		; X only
(1)  556/  FF053C : EE4D                		lsr.w	#7,d5
(1)  557/  FF053E : D845                		add.w	d5,d4			; X add
(1)  558/  FF0540 : 4844                		swap	d4
(1)  559/  FF0542 : 7C00                		moveq	#0,d6
(1)  560/  FF0544 : 3C3C 0040           		move.w	#$40,d6			; Set jump size
(1)  561/  FF0548 : 1A38 D306           		move.b	(RAM_VdpRegs+$10).w,d5
(1)  562/  FF054C : 0245 0003           		andi.w	#%11,d5
(1)  563/  FF0550 : 670A                		beq.s	.thisszj
(1)  564/  FF0552 : DC46                		add.w	d6,d6			; H64
(1)  565/  FF0554 : 0245 0002           		andi.w	#%10,d5
(1)  566/  FF0558 : 6702                		beq.s	.thisszj
(1)  567/  FF055A : DC46                		add.w	d6,d6			; H128		
(1)  568/  FF055C :                     .thisszj:
(1)  569/  FF055C : 4846                		swap	d6
(1)  570/  FF055E : 4E75                		rts
(1)  571/  FF0560 :                     		
(1)  572/  FF0560 :                     ; --------------------------------------------------------
(1)  573/  FF0560 :                     ; Video_Fill
(1)  574/  FF0560 :                     ; 
(1)  575/  FF0560 :                     ; Fill data to VRAM
(1)  576/  FF0560 :                     ;
(1)  577/  FF0560 :                     ; d0 | WORD - Bytes to fill
(1)  578/  FF0560 :                     ; d1 | WORD - VRAM position
(1)  579/  FF0560 :                     ; d2 | WORD - Size
(1)  580/  FF0560 :                     ;
(1)  581/  FF0560 :                     ; Uses:
(1)  582/  FF0560 :                     ; d6-d7,a6
(1)  583/  FF0560 :                     ; --------------------------------------------------------
(1)  584/  FF0560 :                     
(1)  585/  FF0560 :                     Video_Fill:
(1)  586/  FF0560 : 4DF9 00C0 0004      		lea	(vdp_ctrl),a6
(1)  587/  FF0566 : 3E3C 8100           		move.w	#$8100,d7
(1)  588/  FF056A : 1E38 D2F7           		move.b	(RAM_VdpRegs+1),d7
(1)  589/  FF056E : 08C7 0004           		bset	#bitDmaEnbl,d7
(1)  590/  FF0572 : 3C87                		move.w	d7,(a6)
(1)  591/  FF0574 : 3E16                .dmaw:		move.w	(a6),d7
(1)  592/  FF0576 : 0807 0001           		btst	#bitDma,d7
(1)  593/  FF057A : 66F8                		bne.s	.dmaw
(1)  594/  FF057C : 3CBC 8F01           		move.w	#$8F01,(a6)	; Increment $01
(1)  595/  FF0580 : 3E02                		move.w	d2,d7		; d2 - Size
(1)  596/  FF0582 : 2C3C 9400 9300      		move.l	#$94009300,d6
(1)  597/  FF0588 : E24F                		lsr.w	#1,d7
(1)  598/  FF058A : 1C07                		move.b	d7,d6
(1)  599/  FF058C : 4846                		swap	d6
(1)  600/  FF058E : E04F                		lsr.w	#8,d7
(1)  601/  FF0590 : 1C07                		move.b	d7,d6
(1)  602/  FF0592 : 4846                		swap	d6
(1)  603/  FF0594 : 2C86                		move.l	d6,(a6)
(1)  604/  FF0596 : 3CBC 9780           		move.w	#$9780,(a6)	; DMA Fill mode
(1)  605/  FF059A : 3E01                		move.w	d1,d7		; d1 - Destination
(1)  606/  FF059C :                     ; 		lsl.w	#5,d7
(1)  607/  FF059C : 3C07                		move.w	d7,d6
(1)  608/  FF059E : 0246 3FFF           		andi.w	#$3FFF,d6
(1)  609/  FF05A2 : 0046 4000           		ori.w	#$4000,d6
(1)  610/  FF05A6 : 4846                		swap	d6
(1)  611/  FF05A8 : 3C07                		move.w	d7,d6
(1)  612/  FF05AA : E04E                		lsr.w	#8,d6
(1)  613/  FF05AC : EC4E                		lsr.w	#6,d6
(1)  614/  FF05AE : 0246 0003           		andi.w	#%11,d6
(1)  615/  FF05B2 : 0046 0080           		ori.w	#$80,d6
(1)  616/  FF05B6 : 2C86                		move.l	d6,(a6)
(1)  617/  FF05B8 : 3D40 FFFC           		move.w	d0,-4(a6)
(1)  618/  FF05BC : 3E16                .dmawe:		move.w	(a6),d7
(1)  619/  FF05BE : 0807 0001           		btst	#bitDma,d7
(1)  620/  FF05C2 : 66F8                		bne.s	.dmawe
(1)  621/  FF05C4 : 3CBC 8F02           		move.w	#$8F02,(a6)	; Increment $02
(1)  622/  FF05C8 : 3E3C 8100           		move.w	#$8100,d7
(1)  623/  FF05CC : 1E38 D2F7           		move.b	(RAM_VdpRegs+1),d7
(1)  624/  FF05D0 : 3C87                		move.w	d7,(a6)
(1)  625/  FF05D2 : 4E75                		rts
(1)  626/  FF05D4 :                     
(1)  627/  FF05D4 :                     ; --------------------------------------------------------
(1)  628/  FF05D4 :                     ; Video_Copy
(1)  629/  FF05D4 :                     ; 
(1)  630/  FF05D4 :                     ; Copy VRAM data to another location
(1)  631/  FF05D4 :                     ;
(1)  632/  FF05D4 :                     ; d0 | WORD - VRAM Source
(1)  633/  FF05D4 :                     ; d1 | WORD - VRAM Destination
(1)  634/  FF05D4 :                     ; d2 | WORD - Size
(1)  635/  FF05D4 :                     ;
(1)  636/  FF05D4 :                     ; Uses:
(1)  637/  FF05D4 :                     ; d6-d7,a6
(1)  638/  FF05D4 :                     ; --------------------------------------------------------
(1)  639/  FF05D4 :                     
(1)  640/  FF05D4 :                     ; TODO: test if this works again...
(1)  641/  FF05D4 :                     
(1)  642/  FF05D4 :                     Video_Copy:
(1)  643/  FF05D4 : 4DF9 00C0 0004      		lea	(vdp_ctrl),a6
(1)  644/  FF05DA : 3E3C 8100           		move.w	#$8100,d7
(1)  645/  FF05DE : 1E38 D2F7           		move.b	(RAM_VdpRegs+1),d7
(1)  646/  FF05E2 : 08C7 0004           		bset	#bitDmaEnbl,d7
(1)  647/  FF05E6 : 3C87                		move.w	d7,(a6)
(1)  648/  FF05E8 : 3E16                .dmaw:		move.w	(a6),d7
(1)  649/  FF05EA : 0807 0001           		btst	#bitDma,d7
(1)  650/  FF05EE : 66F8                		bne.s	.dmaw
(1)  651/  FF05F0 : 3CBC 8F01           		move.w	#$8F01,(a6)		; Increment $01
(1)  652/  FF05F4 : 3E02                		move.w	d2,d7			; SIZE
(1)  653/  FF05F6 : 2C3C 9400 9300      		move.l	#$94009300,d6
(1)  654/  FF05FC : E24F                		lsr.w	#1,d7
(1)  655/  FF05FE : 1C07                		move.b	d7,d6
(1)  656/  FF0600 : 4846                		swap	d6
(1)  657/  FF0602 : E04F                		lsr.w	#8,d7
(1)  658/  FF0604 : 1C07                		move.b	d7,d6
(1)  659/  FF0606 : 4846                		swap	d6
(1)  660/  FF0608 : 2C86                		move.l	d6,(a6)
(1)  661/  FF060A : 2C3C 9600 9500      		move.l	#$96009500,d6		; SOURCE
(1)  662/  FF0610 : 3E00                		move.w	d0,d7
(1)  663/  FF0612 : 1C07                		move.b	d7,d6
(1)  664/  FF0614 : 4846                		swap	d6
(1)  665/  FF0616 : E04F                		lsr.w	#8,d7
(1)  666/  FF0618 : 1C07                		move.b	d7,d6
(1)  667/  FF061A : 2C86                		move.l	d6,(a6)
(1)  668/  FF061C : 3CBC 97C0           		move.w	#$97C0,(a6)		; DMA Copy mode
(1)  669/  FF0620 : 2E02                		move.l	d2,d7			; DESTINATION
(1)  670/  FF0622 :                     ; 		lsl.w	#5,d7
(1)  671/  FF0622 : 3C07                		move.w	d7,d6
(1)  672/  FF0624 : 0246 3FFF           		andi.w	#$3FFF,d6
(1)  673/  FF0628 : 0046 4000           		ori.w	#$4000,d6
(1)  674/  FF062C : 4846                		swap	d6
(1)  675/  FF062E : 3C07                		move.w	d7,d6
(1)  676/  FF0630 : E04E                		lsr.w	#8,d6
(1)  677/  FF0632 : EC4E                		lsr.w	#6,d6
(1)  678/  FF0634 : 0246 0003           		andi.w	#%11,d6
(1)  679/  FF0638 : 0046 00C0           		ori.w	#$C0,d6
(1)  680/  FF063C : 2C86                		move.l	d6,(a6)
(1)  681/  FF063E : 3D41 FFFC           		move.w	d1,-4(a6)
(1)  682/  FF0642 : 3E16                .dmawe:		move.w	(a6),d7
(1)  683/  FF0644 : 0807 0001           		btst	#bitDma,d7
(1)  684/  FF0648 : 66F8                		bne.s	.dmawe
(1)  685/  FF064A : 3CBC 8F02           		move.w	#$8F02,(a6)		; Increment $02
(1)  686/  FF064E : 3E3C 8100           		move.w	#$8100,d7
(1)  687/  FF0652 : 1E38 D2F7           		move.b	(RAM_VdpRegs+1),d7
(1)  688/  FF0656 : 3C87                		move.w	d7,(a6)
(1)  689/  FF0658 : 4E75                		rts
(1)  690/  FF065A :                     
(1)  691/  FF065A :                     ; ====================================================================
(1)  692/  FF065A :                     ; --------------------------------------------------------
(1)  693/  FF065A :                     ; DMA ROM to VDP Transfer, sets RV=1
(1)  694/  FF065A :                     ; --------------------------------------------------------
(1)  695/  FF065A :                     
(1)  696/  FF065A :                     ; --------------------------------------------------------
(1)  697/  FF065A :                     ; Video_DmaBlast
(1)  698/  FF065A :                     ;
(1)  699/  FF065A :                     ; Process DMA tasks from a predefined list in RAM
(1)  700/  FF065A :                     ; **CALL THIS DURING VBLANK ONLY**
(1)  701/  FF065A :                     ;
(1)  702/  FF065A :                     ; Uses:
(1)  703/  FF065A :                     ; d5-d7,a3-a4
(1)  704/  FF065A :                     ; --------------------------------------------------------
(1)  705/  FF065A :                     
(1)  706/  FF065A :                     ; Entry format:
(1)  707/  FF065A :                     ; $94xx,$93xx,$95xx,$96xx,$97xx (SIZE,SOURCE)
(1)  708/  FF065A :                     ; $40000080 (vdp destination + dma bit)
(1)  709/  FF065A :                     
(1)  710/  FF065A :                     Video_DmaBlast:
(1)  711/  FF065A : 4A78 D172           		tst.w	(RAM_VdpDmaMod).w		; Got mid-write?
(1)  712/  FF065E : 6676                		bne.s	.exit
(1)  713/  FF0660 : 4A78 D170           		tst.w	(RAM_VdpDmaIndx).w		; Index != 0?
(1)  714/  FF0664 : 6770                		beq.s	.exit
(1)  715/  FF0666 : 49F9 00C0 0004      		lea	(vdp_ctrl),a4
(1)  716/  FF066C : 47F8 D090           		lea	(RAM_VdpDmaList).w,a3
(1)  717/  FF0670 : 3E3C 8100           		move.w	#$8100,d7			; DMA ON
(1)  718/  FF0674 : 1E38 D2F7           		move.b	(RAM_VdpRegs+1),d7
(1)  719/  FF0678 : 08C7 0004           		bset	#bitDmaEnbl,d7
(1)  720/  FF067C : 3887                		move.w	d7,(a4)
(1)  721/  FF067E : 6100 FA6C           		bsr	Sound_DMA_Pause			; Request Z80 stop and SH2 backup
(1)  722/  FF0682 : 3E39 00A1 5106      		move.w	(sysmars_reg+dreqctl).l,d7	; Set RV=1
(1)  723/  FF0688 : 8E7C 0001           		or.w	#%00000001,d7
(1)  724/  FF068C : 33C7 00A1 5106      		move.w	d7,(sysmars_reg+dreqctl).l
(1)  725/  FF0692 :                     
(1)  726/  FF0692 : 4A78 D170           .next:		tst.w	(RAM_VdpDmaIndx).w
(1)  727/  FF0696 : 6720                		beq.s	.end
(1)  728/  FF0698 : 2893                		move.l	(a3),(a4)			; Size
(1)  729/  FF069A : 429B                		clr.l	(a3)+
(1)  730/  FF069C : 2893                		move.l	(a3),(a4)			; Source
(1)  731/  FF069E : 429B                		clr.l	(a3)+
(1)  732/  FF06A0 : 3893                		move.w	(a3),(a4)
(1)  733/  FF06A2 : 425B                		clr.w	(a3)+
(1)  734/  FF06A4 : 3C13                		move.w	(a3),d6				; Destination
(1)  735/  FF06A6 : 425B                		clr.w	(a3)+
(1)  736/  FF06A8 : 3A13                		move.w	(a3),d5
(1)  737/  FF06AA : 425B                		clr.w	(a3)+
(1)  738/  FF06AC :                     ; 		bsr	Sound_DMA_Pause
(1)  739/  FF06AC :                     ; 		move.w	(sysmars_reg+dreqctl).l,d7	; Set RV=1
(1)  740/  FF06AC :                     ; 		or.w	#%00000001,d7			; 68k ROM map moves to $000000, $880000/$900000=trash
(1)  741/  FF06AC :                     ; 		move.w	d7,(sysmars_reg+dreqctl).l
(1)  742/  FF06AC : 3886                		move.w	d6,(a4)
(1)  743/  FF06AE : 3885                		move.w	d5,(a4)
(1)  744/  FF06B0 :                     ; 		move.w	(sysmars_reg+dreqctl).l,d7	; Set RV=0
(1)  745/  FF06B0 :                     ; 		and.w	#%11111110,d7
(1)  746/  FF06B0 :                     ; 		move.w	d7,(sysmars_reg+dreqctl).l
(1)  747/  FF06B0 :                     ; 		bsr	Sound_DMA_Resume
(1)  748/  FF06B0 : 0478 000E D170      		sub.w	#7*2,(RAM_VdpDmaIndx).w
(1)  749/  FF06B6 : 60DA                		bra.s	.next
(1)  750/  FF06B8 :                     .end:
(1)  751/  FF06B8 : 3E39 00A1 5106      		move.w	(sysmars_reg+dreqctl).l,d7	; Set RV=0
(1)  752/  FF06BE : CE7C 00FE           		and.w	#%11111110,d7
(1)  753/  FF06C2 : 33C7 00A1 5106      		move.w	d7,(sysmars_reg+dreqctl).l
(1)  754/  FF06C8 : 6100 FA7E           		bsr	Sound_DMA_Resume		; Resume Z80 and SH2 direct
(1)  755/  FF06CC : 3E3C 8100           		move.w	#$8100,d7			; DMA OFF
(1)  756/  FF06D0 : 1E38 D2F7           		move.b	(RAM_VdpRegs+1).w,d7
(1)  757/  FF06D4 : 3887                		move.w	d7,(a4)
(1)  758/  FF06D6 :                     .exit:
(1)  759/  FF06D6 : 4E75                		rts
(1)  760/  FF06D8 :                     
(1)  761/  FF06D8 :                     ; --------------------------------------------------------
(1)  762/  FF06D8 :                     ; Sets a new DMA transfer task to the Blast list
(1)  763/  FF06D8 :                     ;
(1)  764/  FF06D8 :                     ; *** ONLY CALL THIS OUTSIDE OF VBLANK ***
(1)  765/  FF06D8 :                     ;
(1)  766/  FF06D8 :                     ; d0 | LONG - Art data
(1)  767/  FF06D8 :                     ; d1 | WORD - VRAM location
(1)  768/  FF06D8 :                     ; d2 | WORD - Size
(1)  769/  FF06D8 :                     ;
(1)  770/  FF06D8 :                     ; Uses:
(1)  771/  FF06D8 :                     ; d6-d7,a6
(1)  772/  FF06D8 :                     ; --------------------------------------------------------
(1)  773/  FF06D8 :                     
(1)  774/  FF06D8 :                     Video_DmaSet:
(1)  775/  FF06D8 : 31FC 0001 D172      		move.w	#1,(RAM_VdpDmaMod).w
(1)  776/  FF06DE : 4DF8 D090           		lea	(RAM_VdpDmaList).w,a6
(1)  777/  FF06E2 : 3E38 D170           		move.w	(RAM_VdpDmaIndx).w,d7
(1)  778/  FF06E6 : DCC7                		adda	d7,a6
(1)  779/  FF06E8 : DE7C 000E           		add.w	#7*2,d7
(1)  780/  FF06EC : 31C7 D170           		move.w	d7,(RAM_VdpDmaIndx).w
(1)  781/  FF06F0 : 3E02                		move.w	d2,d7			; Length
(1)  782/  FF06F2 : 2C3C 9400 9300      		move.l	#$94009300,d6
(1)  783/  FF06F8 : E24F                		lsr.w	#1,d7
(1)  784/  FF06FA : 1C07                		move.b	d7,d6
(1)  785/  FF06FC : 4846                		swap	d6
(1)  786/  FF06FE : E04F                		lsr.w	#8,d7
(1)  787/  FF0700 : 1C07                		move.b	d7,d6
(1)  788/  FF0702 : 4846                		swap	d6
(1)  789/  FF0704 : 2CC6                		move.l	d6,(a6)+
(1)  790/  FF0706 : 2E00                		move.l	d0,d7			; Source
(1)  791/  FF0708 : E28F                  		lsr.l	#1,d7
(1)  792/  FF070A : 2C3C 9600 9500       		move.l	#$96009500,d6
(1)  793/  FF0710 : 1C07                 		move.b	d7,d6
(1)  794/  FF0712 : E08F                 		lsr.l	#8,d7
(1)  795/  FF0714 : 4846                 		swap	d6
(1)  796/  FF0716 : 1C07                 		move.b	d7,d6
(1)  797/  FF0718 : 2CC6                 		move.l	d6,(a6)+
(1)  798/  FF071A : 3C3C 9700            		move.w	#$9700,d6
(1)  799/  FF071E : E08F                 		lsr.l	#8,d7
(1)  800/  FF0720 : 1C07                 		move.b	d7,d6
(1)  801/  FF0722 : 3CC6                 		move.w	d6,(a6)+
(1)  802/  FF0724 : 3E01                		move.w	d1,d7			; Destination
(1)  803/  FF0726 :                     ; 		and.w	#$7FF,d7
(1)  804/  FF0726 :                     ; 		lsl.w	#5,d7
(1)  805/  FF0726 : 3C07                		move.w	d7,d6
(1)  806/  FF0728 : CEBC 0000 3FE0      		and.l	#$3FE0,d7
(1)  807/  FF072E : 0047 4000           		ori.w	#$4000,d7
(1)  808/  FF0732 : E04E                		lsr.w	#8,d6
(1)  809/  FF0734 : EC4E                		lsr.w	#6,d6
(1)  810/  FF0736 : 0246 0003           		andi.w	#%11,d6
(1)  811/  FF073A : 0046 0080           		ori.w	#$80,d6
(1)  812/  FF073E : 3CC7                		move.w	d7,(a6)+
(1)  813/  FF0740 : 3CC6                		move.w	d6,(a6)+
(1)  814/  FF0742 : 31FC 0000 D172      		move.w	#0,(RAM_VdpDmaMod).w
(1)  815/  FF0748 : 4E75                		rts
(1)  816/  FF074A :                     
(1)  817/  FF074A :                     ; --------------------------------------------------------
(1)  818/  FF074A :                     ; Load graphics using DMA, direct
(1)  819/  FF074A :                     ;
(1)  820/  FF074A :                     ; d0 | LONG - Art data
(1)  821/  FF074A :                     ; d1 | WORD - VRAM location
(1)  822/  FF074A :                     ; d2 | WORD - Size
(1)  823/  FF074A :                     ;
(1)  824/  FF074A :                     ; *** For faster transfers call this during VBlank ***
(1)  825/  FF074A :                     ;
(1)  826/  FF074A :                     ; Uses:
(1)  827/  FF074A :                     ; d5-d7,a4-a6
(1)  828/  FF074A :                     ; --------------------------------------------------------
(1)  829/  FF074A :                     
(1)  830/  FF074A :                     Video_LoadArt:
(1)  831/  FF074A : 40E7                		move.w	sr,-(sp)
(1)  832/  FF074C : 007C 0700           		or	#$700,sr
(1)  833/  FF0750 : 49F9 00C0 0004      		lea	(vdp_ctrl),a4
(1)  834/  FF0756 : 3C3C 8100           		move.w	#$8100,d6		; DMA ON
(1)  835/  FF075A : 1C38 D2F7           		move.b	(RAM_VdpRegs+1),d6
(1)  836/  FF075E : 08C6 0004           		bset	#bitDmaEnbl,d6
(1)  837/  FF0762 : 3886                		move.w	d6,(a4)
(1)  838/  FF0764 : 3C02                		move.w	d2,d6			; Length
(1)  839/  FF0766 : 2A3C 9400 9300      		move.l	#$94009300,d5
(1)  840/  FF076C : E24E                		lsr.w	#1,d6
(1)  841/  FF076E : 1A06                		move.b	d6,d5
(1)  842/  FF0770 : 4845                		swap	d5
(1)  843/  FF0772 : E04E                		lsr.w	#8,d6
(1)  844/  FF0774 : 1A06                		move.b	d6,d5
(1)  845/  FF0776 : 4845                		swap	d5
(1)  846/  FF0778 : 2885                		move.l	d5,(a4)
(1)  847/  FF077A : 2C00                		move.l	d0,d6			; Source
(1)  848/  FF077C : E28E                  		lsr.l	#1,d6
(1)  849/  FF077E : 2A3C 9600 9500       		move.l	#$96009500,d5
(1)  850/  FF0784 : 1A06                 		move.b	d6,d5
(1)  851/  FF0786 : E08E                 		lsr.l	#8,d6
(1)  852/  FF0788 : 4845                 		swap	d5
(1)  853/  FF078A : 1A06                 		move.b	d6,d5
(1)  854/  FF078C : 2885                 		move.l	d5,(a4)
(1)  855/  FF078E : 3A3C 9700            		move.w	#$9700,d5
(1)  856/  FF0792 : E08E                 		lsr.l	#8,d6
(1)  857/  FF0794 : 1A06                 		move.b	d6,d5
(1)  858/  FF0796 : 3885                 		move.w	d5,(a4)
(1)  859/  FF0798 : 3C01                		move.w	d1,d6			; Destination
(1)  860/  FF079A :                     ; 		and.w	#$7FF,d6
(1)  861/  FF079A :                     ; 		lsl.w	#5,d6
(1)  862/  FF079A : 3A06                		move.w	d6,d5
(1)  863/  FF079C : CCBC 0000 3FE0      		and.l	#$3FE0,d6
(1)  864/  FF07A2 : 0046 4000           		ori.w	#$4000,d6
(1)  865/  FF07A6 :                     
(1)  866/  FF07A6 : E04D                		lsr.w	#8,d5
(1)  867/  FF07A8 : EC4D                		lsr.w	#6,d5
(1)  868/  FF07AA : 0245 0003           		andi.w	#%11,d5
(1)  869/  FF07AE : 0045 0080           		ori.w	#$80,d5
(1)  870/  FF07B2 : 2E00                		move.l	d0,d7
(1)  871/  FF07B4 : 4847                		swap	d7
(1)  872/  FF07B6 : E04F                		lsr.w	#8,d7
(1)  873/  FF07B8 : BE3C 00FF           		cmp.b	#$FF,d7
(1)  874/  FF07BC : 673A                		beq.s	.from_ram
(1)  875/  FF07BE : 6100 F92C           		bsr	Sound_DMA_Pause
(1)  876/  FF07C2 : 3E39 00A1 5106      		move.w	(sysmars_reg+dreqctl).l,d7	; Set RV=1
(1)  877/  FF07C8 : 8E7C 0001           		or.w	#%00000001,d7			; 68k ROM map moves to $000000, $880000/$900000=trash
(1)  878/  FF07CC : 33C7 00A1 5106      		move.w	d7,(sysmars_reg+dreqctl).l
(1)  879/  FF07D2 : 3F05                 		move.w	d5,-(sp)
(1)  880/  FF07D4 : 3886                		move.w	d6,(a4)				; d6 - First word
(1)  881/  FF07D6 : 389F                		move.w	(sp)+,(a4)			; *** Second write, CPU freezes until it DMA ends
(1)  882/  FF07D8 : 3C39 00A1 5106      		move.w	(sysmars_reg+dreqctl).l,d6	; Set RV=0
(1)  883/  FF07DE : CC7C 00FE           		and.w	#%11111110,d6			; 68k ROM map returns to $880000/$900000
(1)  884/  FF07E2 : 33C6 00A1 5106      		move.w	d6,(sysmars_reg+dreqctl).l
(1)  885/  FF07E8 : 3C3C 8100           		move.w	#$8100,d6			; DMA OFF
(1)  886/  FF07EC : 1C38 D2F7           		move.b	(RAM_VdpRegs+1),d6
(1)  887/  FF07F0 : 3886                		move.w	d6,(a4)
(1)  888/  FF07F2 : 46DF                		move.w	(sp)+,sr
(1)  889/  FF07F4 : 6000 F952           		bra	Sound_DMA_Resume
(1)  890/  FF07F8 :                     
(1)  891/  FF07F8 :                     ; TODO: check if Source RAM transfers are safe without turining off Z80
(1)  892/  FF07F8 :                     .from_ram:
(1)  893/  FF07F8 : 3887                		move.w	d7,(a4)
(1)  894/  FF07FA : 3F05                 		move.w	d5,-(sp)
(1)  895/  FF07FC : 389F                		move.w	(sp)+,(a4)			; Second write
(1)  896/  FF07FE : 3E3C 8100           		move.w	#$8100,d7
(1)  897/  FF0802 : 1E38 D2F7           		move.b	(RAM_VdpRegs+1),d7
(1)  898/  FF0806 : 3887                		move.w	d7,(a4)
(1)  899/  FF0808 : 46DF                		move.w	(sp)+,sr
(1)  900/  FF080A : 4E75                		rts
(1)  901/  FF080C :                     
(1)  902/  FF080C :                     ; ====================================================================
(1)  903/  FF080C :                     ; --------------------------------------------------------
(1)  904/  FF080C :                     ; Video data
(1)  905/  FF080C :                     ; --------------------------------------------------------
(1)  906/  FF080C :                     
(1)  907/  FF080C :                     list_vdpregs:
(1)  908/  FF080C : 04                  		dc.b $04			; HBlank int off, HV Counter on
(1)  909/  FF080D : 44                  		dc.b $44			; Display ON, VBlank int off
(1)  910/  FF080E : 30                  		dc.b (($C000)>>10)		; ForeGrd at VRAM $C000 (%00xxx000)
(1)  911/  FF080F : 34                  		dc.b (($D000)>>10)		; Window  at VRAM $D000 (%00xxxxy0)
(1)  912/  FF0810 : 07                  		dc.b (($E000)>>13)		; BackGrd at VRAM $E000 (%00000xxx)
(1)  913/  FF0811 : 7C                  		dc.b (($F800)>>9)		; Sprites at VRAM $F800 (%0xxxxxxy)
(1)  914/  FF0812 : 00                  		dc.b $00			; Unused
(1)  915/  FF0813 : 00                  		dc.b $00			; Background color: 0
(1)  916/  FF0814 : 00                  		dc.b $00			; Unused
(1)  917/  FF0815 : 00                  		dc.b $00			; Unused
(1)  918/  FF0816 : 00                  		dc.b $00			; HInt value
(1)  919/  FF0817 : 00                  		dc.b (%000|%00)			; No ExtInt, Scroll: VSCR:full HSCR:full
(1)  920/  FF0818 : 81                  		dc.b $81			; H40, No shadow mode, Normal resolution
(1)  921/  FF0819 : 3F                  		dc.b (($FC00)>>10)		; HScroll at VRAM $FC00 (%00xxxxxx)
(1)  922/  FF081A : 00                  		dc.b $00			; Unused
(1)  923/  FF081B : 02                  		dc.b $02			; VDP Auto increment by $02
(1)  924/  FF081C : 01                  		dc.b (%00<<4)|%01		; Layer size: V32 H64
(1)  925/  FF081D : 00                  		dc.b $00
(1)  926/  FF081E : 00                  		dc.b $00
(1)  927/  FF081F :                     		align 2
(1)  928/  FF0820 : 0000 0EEE 0CCC 0AAA ASCII_PAL:	dc.w $0000,$0EEE,$0CCC,$0AAA,$0888,$0444,$000E,$0008
                    0888 0444 000E 0008 
(1)  929/  FF0830 : 00EE 0088 00E0 0080 		dc.w $00EE,$0088,$00E0,$0080,$0E00,$0800,$0000,$0000
                    0E00 0800 0000 0000 
(1)  930/  FF0840 :                     ASCII_PAL_e:
(1)  931/  FF0840 :                     ASCII_FONT:	binclude "system/md/data/font.bin"
(1)  932/  FF1840 :                     ASCII_FONT_e:
(1)  933/  FF1840 :                     		align 2
(1)  934/  FF1840 :                     
      36/  FF1840 :                     		include	"system/md/system.asm"
(1)    1/  FF1840 :                     ; ====================================================================
(1)    2/  FF1840 :                     ; ----------------------------------------------------------------
(1)    3/  FF1840 :                     ; System
(1)    4/  FF1840 :                     ; ----------------------------------------------------------------
(1)    5/  FF1840 :                     
(1)    6/  FF1840 :                     ; --------------------------------------------------------
(1)    7/  FF1840 :                     ; Init System
(1)    8/  FF1840 :                     ; 
(1)    9/  FF1840 :                     ; Uses:
(1)   10/  FF1840 :                     ; a0-a2,d0-d1
(1)   11/  FF1840 :                     ; --------------------------------------------------------
(1)   12/  FF1840 :                     
(1)   13/  FF1840 :                     System_Init:
(1)   14/  FF1840 : 46FC 2700           		move.w	#$2700,sr		; Disable interrupts
(1)   15/  FF1844 : 40E7                		move.w	sr,-(sp)
(1)   16/  FF1846 : 33FC 0100 00A1 1100 		move.w	#$0100,(z80_bus).l	; Stop Z80
(1)   17/  FF184E :                     .wait:
(1)   18/  FF184E : 0839 0000 00A1 1100 		btst	#0,(z80_bus).l		; Wait for it
(1)   19/  FF1856 : 66F6                		bne.s	.wait
(1)   20/  FF1858 : 7040                		moveq	#%01000000,d0		; Init ports, TH=1
(1)   21/  FF185A : 13C0 00A1 0009      		move.b	d0,(sys_ctrl_1).l	; Controller 1
(1)   22/  FF1860 : 13C0 00A1 000B      		move.b	d0,(sys_ctrl_2).l	; Controller 2
(1)   23/  FF1866 : 13C0 00A1 000D      		move.b	d0,(sys_ctrl_3).l	; Modem
(1)   24/  FF186C : 33FC 0000 00A1 1100 		move.w	#0,(z80_bus).l		; Enable Z80
(1)   25/  FF1874 : 41F8 D50E           		lea	(RAM_InputData),a0	; Clear input data buffer
(1)   26/  FF1878 : 323C 0006           		move.w	#sizeof_input-1/2,d1
(1)   27/  FF187C : 7000                		moveq	#0,d0
(1)   28/  FF187E :                     .clrinput:
(1)   29/  FF187E : 30FC 0000           		move.w	#0,(a0)+
(1)   30/  FF1882 : 51C9 FFFA           		dbf	d1,.clrinput
(1)   31/  FF1886 : 303C 4EF9           		move.w	#$4EF9,d0		; Set JMP opcode for the Hblank/VBlank jumps
(1)   32/  FF188A : 33C0 FFFF D936       		move.w	d0,(RAM_MdMarsVInt).l
(1)   33/  FF1890 : 33C0 FFFF D93C      		move.w	d0,(RAM_MdMarsHInt).l
(1)   34/  FF1896 : 203C 5625 5769      		move.l	#$56255769,d0		; Set these random values
(1)   35/  FF189C : 223C 9511 6102      		move.l	#$95116102,d1
(1)   36/  FF18A2 : 23C0 FFFF D92A      		move.l	d0,(RAM_SysRandVal).l
(1)   37/  FF18A8 : 23C1 FFFF D92E      		move.l	d1,(RAM_SysRandSeed).l
(1)   38/  FF18AE : 203C 00FF 1BCA      		move.l	#VInt_Default,d0	; Set default ints
(1)   39/  FF18B4 : 223C 00FF 1BE2      		move.l	#Hint_Default,d1
(1)   40/  FF18BA : 6100 0264           		bsr	System_SetInts
(1)   41/  FF18BE : 46DF                		move.w	(sp)+,sr
(1)   42/  FF18C0 : 4E75                		rts
(1)   43/  FF18C2 :                     
(1)   44/  FF18C2 :                     ; ====================================================================
(1)   45/  FF18C2 :                     ; --------------------------------------------------------
(1)   46/  FF18C2 :                     ; System_Input (VBLANK ONLY)
(1)   47/  FF18C2 :                     ; 
(1)   48/  FF18C2 :                     ; Uses:
(1)   49/  FF18C2 :                     ; d4-d6,a4-a5
(1)   50/  FF18C2 :                     ; --------------------------------------------------------
(1)   51/  FF18C2 :                     
(1)   52/  FF18C2 :                     ; TODO:
(1)   53/  FF18C2 :                     ; Check if it still required to turn OFF the Z80
(1)   54/  FF18C2 :                     ; while reading the controller
(1)   55/  FF18C2 :                     
(1)   56/  FF18C2 :                     System_Input:
(1)   57/  FF18C2 :                     ; 		move.w	#$0100,(z80_bus).l	; Stop Z80
(1)   58/  FF18C2 :                     .wait:
(1)   59/  FF18C2 :                     ; 		btst	#0,(z80_bus).l		; Wait for it
(1)   60/  FF18C2 :                     ; 		bne.s	.wait
(1)   61/  FF18C2 : 49F9 00A1 0003      		lea	($A10003),a4
(1)   62/  FF18C8 : 4BF8 D50E           		lea	(RAM_InputData),a5
(1)   63/  FF18CC : 6108                		bsr.s	.this_one
(1)   64/  FF18CE : D8FC 0002           		adda	#2,a4
(1)   65/  FF18D2 : DAFC 0006           		adda	#sizeof_input,a5
(1)   66/  FF18D6 :                     ; 		bsr.s	.this_one
(1)   67/  FF18D6 :                     ; 		move.w	#0,(z80_bus).l
(1)   68/  FF18D6 :                     ; 		rts
(1)   69/  FF18D6 :                     
(1)   70/  FF18D6 :                     ; --------------------------------------------------------	
(1)   71/  FF18D6 :                     ; Read port
(1)   72/  FF18D6 :                     ; 
(1)   73/  FF18D6 :                     ; a4 - Current port
(1)   74/  FF18D6 :                     ; a5 - Output data
(1)   75/  FF18D6 :                     ; --------------------------------------------------------
(1)   76/  FF18D6 :                     
(1)   77/  FF18D6 :                     .this_one:
(1)   78/  FF18D6 : 6100 00BC           		bsr	.pick_id
(1)   79/  FF18DA : 1A84                		move.b	d4,pad_id(a5)
(1)   80/  FF18DC : B87C 000F           		cmp.w	#$F,d4
(1)   81/  FF18E0 : 670E                		beq.s	.exit
(1)   82/  FF18E2 : C87C 000F           		and.w	#$F,d4
(1)   83/  FF18E6 : D844                		add.w	d4,d4
(1)   84/  FF18E8 : 3A3B 400C           		move.w	.list(pc,d4.w),d5
(1)   85/  FF18EC : 4EFB 5008           		jmp	.list(pc,d5.w)
(1)   86/  FF18F0 :                     .exit:
(1)   87/  FF18F0 : 422D 0001           		clr.b	pad_ver(a5)
(1)   88/  FF18F4 : 4E75                		rts
(1)   89/  FF18F6 :                     
(1)   90/  FF18F6 :                     ; --------------------------------------------------------
(1)   91/  FF18F6 :                     ; Grab ID
(1)   92/  FF18F6 :                     ; --------------------------------------------------------
(1)   93/  FF18F6 :                     
(1)   94/  FF18F6 : FFFA                .list:		dc.w .exit-.list	; $0
(1)   95/  FF18F8 : FFFA                		dc.w .exit-.list
(1)   96/  FF18FA : FFFA                		dc.w .exit-.list
(1)   97/  FF18FC : FFFA                		dc.w .exit-.list
(1)   98/  FF18FE : FFFA                		dc.w .exit-.list	; $4
(1)   99/  FF1900 : FFFA                		dc.w .exit-.list
(1)  100/  FF1902 : FFFA                		dc.w .exit-.list
(1)  101/  FF1904 : FFFA                		dc.w .exit-.list
(1)  102/  FF1906 : FFFA                		dc.w .exit-.list	; $8
(1)  103/  FF1908 : FFFA                		dc.w .exit-.list
(1)  104/  FF190A : FFFA                		dc.w .exit-.list
(1)  105/  FF190C : FFFA                		dc.w .exit-.list
(1)  106/  FF190E : FFFA                		dc.w .exit-.list	; $C
(1)  107/  FF1910 : 0020                		dc.w .id_0D-.list
(1)  108/  FF1912 : FFFA                		dc.w .exit-.list
(1)  109/  FF1914 : FFFA                		dc.w .exit-.list
(1)  110/  FF1916 :                     
(1)  111/  FF1916 :                     ; --------------------------------------------------------
(1)  112/  FF1916 :                     ; ID $0D
(1)  113/  FF1916 :                     ; 
(1)  114/  FF1916 :                     ; Normal controller, Old or New
(1)  115/  FF1916 :                     ; --------------------------------------------------------
(1)  116/  FF1916 :                     
(1)  117/  FF1916 :                     .id_0D:
(1)  118/  FF1916 : 18BC 0040           		move.b	#$40,(a4)	; Show CB|RLDU
(1)  119/  FF191A : 4E71                		nop
(1)  120/  FF191C : 4E71                		nop
(1)  121/  FF191E : 1A14                		move.b	(a4),d5
(1)  122/  FF1920 : CA7C 003F           		and.w	#%00111111,d5
(1)  123/  FF1924 : 18BC 0000           		move.b	#$00,(a4)	; Show SA|RLDU
(1)  124/  FF1928 : 4E71                		nop
(1)  125/  FF192A : 4E71                		nop
(1)  126/  FF192C : 1814                		move.b	(a4),d4
(1)  127/  FF192E : E54C                		lsl.w	#2,d4
(1)  128/  FF1930 : C87C 00C0           		and.w	#%11000000,d4
(1)  129/  FF1934 : 8845                		or.w	d5,d4
(1)  130/  FF1936 : 18BC 0040           		move.b	#$40,(a4)	; Show CB|RLDU
(1)  131/  FF193A : 4644                		not.w	d4
(1)  132/  FF193C : 1A2D 0003           		move.b	on_hold+1(a5),d5
(1)  133/  FF1940 : B905                		eor.b	d4,d5
(1)  134/  FF1942 : 18BC 0000           		move.b	#$00,(a4)	; Show SA|RLDU
(1)  135/  FF1946 : 1B44 0003           		move.b	d4,on_hold+1(a5)
(1)  136/  FF194A : CA04                		and.b	d4,d5
(1)  137/  FF194C : 1B45 0005           		move.b	d5,on_press+1(a5)
(1)  138/  FF1950 : 18BC 0040           		move.b	#$40,(a4)	; 6 button responds
(1)  139/  FF1954 : 4E71                		nop
(1)  140/  FF1956 : 4E71                		nop
(1)  141/  FF1958 : 1814                		move.b	(a4),d4		; Grab ??|MXYZ
(1)  142/  FF195A : 18BC 0000            		move.b	#$00,(a4)
(1)  143/  FF195E : 4E71                  		nop
(1)  144/  FF1960 : 4E71                  		nop
(1)  145/  FF1962 : 1C14                 		move.b	(a4),d6		; Type: $03 old, $0F new
(1)  146/  FF1964 : 18BC 0040            		move.b	#$40,(a4)
(1)  147/  FF1968 : 4E71                 		nop
(1)  148/  FF196A : 4E71                 		nop
(1)  149/  FF196C : CC7C 000F           		and.w	#$F,d6
(1)  150/  FF1970 : E44E                		lsr.w	#2,d6
(1)  151/  FF1972 : CC7C 0001           		and.w	#1,d6
(1)  152/  FF1976 : 6716                		beq.s	.oldpad
(1)  153/  FF1978 : 4604                		not.b	d4
(1)  154/  FF197A : C87C 000F            		and.w	#%1111,d4
(1)  155/  FF197E : 1A2D 0002           		move.b	on_hold(a5),d5
(1)  156/  FF1982 : B905                		eor.b	d4,d5
(1)  157/  FF1984 : 1B44 0002           		move.b	d4,on_hold(a5)
(1)  158/  FF1988 : CA04                		and.b	d4,d5
(1)  159/  FF198A : 1B45 0004           		move.b	d5,on_press(a5)
(1)  160/  FF198E :                     .oldpad:
(1)  161/  FF198E : 1B46 0001           		move.b	d6,pad_ver(a5)
(1)  162/  FF1992 : 4E75                		rts
(1)  163/  FF1994 :                     		
(1)  164/  FF1994 :                     ; --------------------------------------------------------
(1)  165/  FF1994 :                     ; Grab ID
(1)  166/  FF1994 :                     ; --------------------------------------------------------
(1)  167/  FF1994 :                     
(1)  168/  FF1994 :                     .pick_id:
(1)  169/  FF1994 : 7800                		moveq	#0,d4
(1)  170/  FF1996 : 18BC 0070           		move.b	#%01110000,(a4)		; TH=1,TR=1,TL=1
(1)  171/  FF199A : 4E71                		nop
(1)  172/  FF199C : 4E71                		nop
(1)  173/  FF199E : 610A                		bsr	.read
(1)  174/  FF19A0 : 18BC 0030           		move.b	#%00110000,(a4)		; TH=0,TR=1,TL=1
(1)  175/  FF19A4 : 4E71                		nop
(1)  176/  FF19A6 : 4E71                		nop
(1)  177/  FF19A8 : D844                		add.w	d4,d4
(1)  178/  FF19AA :                     .read:
(1)  179/  FF19AA : 1A14                		move.b	(a4),d5
(1)  180/  FF19AC : 1C05                		move.b	d5,d6
(1)  181/  FF19AE : CC3C 000C           		and.b	#$C,d6
(1)  182/  FF19B2 : 6702                		beq.s	.step_1
(1)  183/  FF19B4 : 5244                		addq.w	#1,d4
(1)  184/  FF19B6 :                     .step_1:
(1)  185/  FF19B6 : D844                		add.w	d4,d4
(1)  186/  FF19B8 : 1C05                		move.b	d5,d6
(1)  187/  FF19BA : CC7C 0003           		and.w	#3,d6
(1)  188/  FF19BE : 6702                		beq.s	.step_2
(1)  189/  FF19C0 : 5244                		addq.w	#1,d4
(1)  190/  FF19C2 :                     .step_2:
(1)  191/  FF19C2 : 4E75                		rts
(1)  192/  FF19C4 :                     
(1)  193/  FF19C4 :                     ; --------------------------------------------------------
(1)  194/  FF19C4 :                     ; System_Random
(1)  195/  FF19C4 :                     ; 
(1)  196/  FF19C4 :                     ; Set random value
(1)  197/  FF19C4 :                     ; 
(1)  198/  FF19C4 :                     ; Output:
(1)  199/  FF19C4 :                     ; d0 | LONG
(1)  200/  FF19C4 :                     ; --------------------------------------------------------
(1)  201/  FF19C4 :                     
(1)  202/  FF19C4 :                     ; TODO: rewrite this
(1)  203/  FF19C4 :                     System_Random:
(1)  204/  FF19C4 : 2A38 D92E           		move.l	(RAM_SysRandSeed),d5
(1)  205/  FF19C8 : 2838 D92A           		move.l	(RAM_SysRandVal),d4
(1)  206/  FF19CC : E39D                		rol.l	#1,d5
(1)  207/  FF19CE : EAA4                		asr.l	d5,d4
(1)  208/  FF19D0 : D885                		add.l	d5,d4
(1)  209/  FF19D2 : 23C5 FFFF D92E      		move.l	d5,(RAM_SysRandSeed).l
(1)  210/  FF19D8 : 23C4 FFFF D92A      		move.l	d4,(RAM_SysRandVal).l
(1)  211/  FF19DE : 2004                		move.l	d4,d0
(1)  212/  FF19E0 : 4E75                		rts
(1)  213/  FF19E2 :                     
(1)  214/  FF19E2 :                     ; --------------------------------------------------------
(1)  215/  FF19E2 :                     ; System_SineWave_Cos / System_SineWave
(1)  216/  FF19E2 :                     ;
(1)  217/  FF19E2 :                     ; Read sinewave value
(1)  218/  FF19E2 :                     ;
(1)  219/  FF19E2 :                     ; Input:
(1)  220/  FF19E2 :                     ; d0 | WORD - Tan
(1)  221/  FF19E2 :                     ; d1 | WORD - Multiply by
(1)  222/  FF19E2 :                     ;
(1)  223/  FF19E2 :                     ; Output:
(1)  224/  FF19E2 :                     ; d2 | LONG - Result (as 0000.0000)
(1)  225/  FF19E2 :                     ; --------------------------------------------------------
(1)  226/  FF19E2 :                     
(1)  227/  FF19E2 :                     System_SineWave_Cos:
(1)  228/  FF19E2 : 48A7 8000           		movem.w	d0,-(sp)
(1)  229/  FF19E6 : 7400                		moveq	#0,d2
(1)  230/  FF19E8 : D03C 0040           		add.b	#$40,d0
(1)  231/  FF19EC : 1400                		move.b	d0,d2
(1)  232/  FF19EE : E302                		asl.b	#1,d2
(1)  233/  FF19F0 : 343B 202E           		move.w	MdSys_SineData(pc,d2.w),d2
(1)  234/  FF19F4 : C4C1                		mulu.w	d1,d2
(1)  235/  FF19F6 : 8000                		or.b	d0,d0
(1)  236/  FF19F8 : 6A02                		bpl.s	.dont_neg
(1)  237/  FF19FA : 4482                		neg.l	d2
(1)  238/  FF19FC :                     .dont_neg:
(1)  239/  FF19FC : 4C9F 0001           		movem.w	(sp)+,d0
(1)  240/  FF1A00 : 4E75                		rts
(1)  241/  FF1A02 :                     
(1)  242/  FF1A02 :                     System_SineWave:
(1)  243/  FF1A02 : 48A7 8000           		movem.w	d0,-(sp)
(1)  244/  FF1A06 : C07C 007F           		and.w	#$7F,d0
(1)  245/  FF1A0A : E340                		asl.w	#1,d0
(1)  246/  FF1A0C : 343B 0012           		move.w	MdSys_SineData(pc,d0.w),d2
(1)  247/  FF1A10 : C4C1                		mulu.w	d1,d2
(1)  248/  FF1A12 : 4C9F 0001           		movem.w	(sp)+,d0
(1)  249/  FF1A16 : 5182                		subq.l	#8,d2
(1)  250/  FF1A18 : 8000                		or.b	d0,d0
(1)  251/  FF1A1A : 6A02                		bpl.s	.dont_neg
(1)  252/  FF1A1C : 4482                		neg.l	d2
(1)  253/  FF1A1E :                     .dont_neg:
(1)  254/  FF1A1E : 4E75                		rts
(1)  255/  FF1A20 :                     
(1)  256/  FF1A20 : 0000 0006 000D 0013 MdSys_SineData:	dc.w 0,	6, $D, $13, $19, $1F, $26, $2C,	$32, $38, $3E
                    0019 001F 0026 002C 
                    0032 0038 003E      
(1)  257/  FF1A36 : 0044 004A 0050 0056 		dc.w $44, $4A, $50, $56, $5C, $62, $68,	$6D, $73, $79
                    005C 0062 0068 006D 
                    0073 0079           
(1)  258/  FF1A4A : 007E 0084 0089 008E 		dc.w $7E, $84, $89, $8E, $93, $98, $9D,	$A2, $A7, $AC
                    0093 0098 009D 00A2 
                    00A7 00AC           
(1)  259/  FF1A5E : 00B1 00B5 00B9 00BE 		dc.w $B1, $B5, $B9, $BE, $C2, $C6, $CA,	$CE, $D1, $D5
                    00C2 00C6 00CA 00CE 
                    00D1 00D5           
(1)  260/  FF1A72 : 00D8 00DC 00DF 00E2 		dc.w $D8, $DC, $DF, $E2, $E5, $E7, $EA,	$ED, $EF, $F1
                    00E5 00E7 00EA 00ED 
                    00EF 00F1           
(1)  261/  FF1A86 : 00F3 00F5 00F7 00F8 		dc.w $F3, $F5, $F7, $F8, $FA, $FB, $FC,	$FD, $FE, $FF
                    00FA 00FB 00FC 00FD 
                    00FE 00FF           
(1)  262/  FF1A9A : 00FF 0100 0100 0100 		dc.w $FF, $100,	$100, $100, $100, $100,	$FF, $FF, $FE
                    0100 0100 00FF 00FF 
                    00FE                
(1)  263/  FF1AAC : 00FD 00FC 00FB 00FA 		dc.w $FD, $FC, $FB, $FA, $F8, $F7, $F5,	$F3, $F1, $EF
                    00F8 00F7 00F5 00F3 
                    00F1 00EF           
(1)  264/  FF1AC0 : 00ED 00EA 00E7 00E5 		dc.w $ED, $EA, $E7, $E5, $E2, $DF, $DC,	$D8, $D5, $D1
                    00E2 00DF 00DC 00D8 
                    00D5 00D1           
(1)  265/  FF1AD4 : 00CE 00CA 00C6 00C2 		dc.w $CE, $CA, $C6, $C2, $BE, $B9, $B5,	$B1, $AC, $A7
                    00BE 00B9 00B5 00B1 
                    00AC 00A7           
(1)  266/  FF1AE8 : 00A2 009D 0098 0093 		dc.w $A2, $9D, $98, $93, $8E, $89, $84,	$7E, $79, $73
                    008E 0089 0084 007E 
                    0079 0073           
(1)  267/  FF1AFC : 006D 0068 0062 005C 		dc.w $6D, $68, $62, $5C, $56, $50, $4A,	$44, $3E, $38
                    0056 0050 004A 0044 
                    003E 0038           
(1)  268/  FF1B10 : 0032 002C 0026 001F 		dc.w $32, $2C, $26, $1F, $19, $13, $D, 6
                    0019 0013 000D 0006 
(1)  269/  FF1B20 :                     
(1)  270/  FF1B20 :                     ; --------------------------------------------------------
(1)  271/  FF1B20 :                     ; System_SetInts
(1)  272/  FF1B20 :                     ;
(1)  273/  FF1B20 :                     ; Set new interrputs
(1)  274/  FF1B20 :                     ;
(1)  275/  FF1B20 :                     ; d0 | LONG - VBlank
(1)  276/  FF1B20 :                     ; d1 | LONG - HBlank
(1)  277/  FF1B20 :                     ;
(1)  278/  FF1B20 :                     ; Uses:
(1)  279/  FF1B20 :                     ; d4
(1)  280/  FF1B20 :                     ;
(1)  281/  FF1B20 :                     ; Notes:
(1)  282/  FF1B20 :                     ; Writing 0 or a negative number will skip change
(1)  283/  FF1B20 :                     ; to the interrupt pointer
(1)  284/  FF1B20 :                     ; --------------------------------------------------------
(1)  285/  FF1B20 :                     
(1)  286/  FF1B20 :                     System_SetInts:
(1)  287/  FF1B20 : 2800                		move.l	d0,d4
(1)  288/  FF1B22 : 670E                		beq.s	.novint
(1)  289/  FF1B24 : 6B0C                		bmi.s	.novint
(1)  290/  FF1B26 : 88BC 0088 0000      		or.l	#$880000,d4
(1)  291/  FF1B2C : 23C4 FFFF D938       		move.l	d4,(RAM_MdMarsVInt+2).l
(1)  292/  FF1B32 :                     .novint:
(1)  293/  FF1B32 : 2801                		move.l	d1,d4
(1)  294/  FF1B34 : 670E                		beq.s	.nohint
(1)  295/  FF1B36 : 6B0C                		bmi.s	.nohint
(1)  296/  FF1B38 : 88BC 0088 0000      		or.l	#$880000,d4
(1)  297/  FF1B3E : 23C4 FFFF D93E      		move.l	d4,(RAM_MdMarsHInt+2).l
(1)  298/  FF1B44 :                     .nohint:
(1)  299/  FF1B44 : 4E75                		rts
(1)  300/  FF1B46 :                     
(1)  301/  FF1B46 :                     ; --------------------------------------------------------
(1)  302/  FF1B46 :                     ; System_SramInit
(1)  303/  FF1B46 :                     ; 
(1)  304/  FF1B46 :                     ; Init save data
(1)  305/  FF1B46 :                     ; 
(1)  306/  FF1B46 :                     ; Uses:
(1)  307/  FF1B46 :                     ; a4,d4-d5
(1)  308/  FF1B46 :                     ; --------------------------------------------------------
(1)  309/  FF1B46 :                     
(1)  310/  FF1B46 :                     ; TODO: Check if RV bit is needed here...
(1)  311/  FF1B46 :                     System_SramInit:
(1)  312/  FF1B46 : 13FC 0001 00A1 30F1 		move.b	#1,(md_bank_sram).l
(1)  313/  FF1B4E : 49F9 0020 0001      		lea	($200001).l,a4
(1)  314/  FF1B54 : 7800                		moveq	#0,d4
(1)  315/  FF1B56 : 3A3C 1FFF           		move.w	#($4000/2)-1,d5
(1)  316/  FF1B5A :                     .initsave:
(1)  317/  FF1B5A : 1884                		move.b	d4,(a4)
(1)  318/  FF1B5C : D8FC 0002           		adda	#2,a4
(1)  319/  FF1B60 : 51CD FFF8           		dbf	d5,.initsave
(1)  320/  FF1B64 : 13FC 0000 00A1 30F1 		move.b	#0,(md_bank_sram).l
(1)  321/  FF1B6C : 4E75                		rts
(1)  322/  FF1B6E :                     
(1)  323/  FF1B6E :                     ; --------------------------------------------------------
(1)  324/  FF1B6E :                     ; System_VSync
(1)  325/  FF1B6E :                     ; 
(1)  326/  FF1B6E :                     ; Waits for VBlank manually
(1)  327/  FF1B6E :                     ; 
(1)  328/  FF1B6E :                     ; Uses:
(1)  329/  FF1B6E :                     ; d4
(1)  330/  FF1B6E :                     ; --------------------------------------------------------
(1)  331/  FF1B6E :                     
(1)  332/  FF1B6E :                     System_VSync:
(1)  333/  FF1B6E : 3839 00C0 0004      		move.w	(vdp_ctrl),d4
(1)  334/  FF1B74 : 0804 0003           		btst	#bitVint,d4
(1)  335/  FF1B78 : 67F4                		beq.s	System_VSync
(1)  336/  FF1B7A : 6100 FD46           		bsr	System_Input
(1)  337/  FF1B7E :                     ; 		bsr	Sound_Update
(1)  338/  FF1B7E : 06B9 0000 0001 FFFF 		add.l	#1,(RAM_FrameCount).l
                    D926                
(1)  339/  FF1B88 : 3839 00C0 0004      .inside:	move.w	(vdp_ctrl),d4
(1)  340/  FF1B8E : 0804 0003           		btst	#bitVint,d4
(1)  341/  FF1B92 : 66F4                		bne.s	.inside
(1)  342/  FF1B94 : 4E75                		rts
(1)  343/  FF1B96 :                     
(1)  344/  FF1B96 :                     ; --------------------------------------------------------
(1)  345/  FF1B96 :                     ; System_JumpRamCode
(1)  346/  FF1B96 :                     ;
(1)  347/  FF1B96 :                     ; Transfer user code to RAM and jump to it.
(1)  348/  FF1B96 :                     ;
(1)  349/  FF1B96 :                     ; Input:
(1)  350/  FF1B96 :                     ; d0 - Location of the RAM code
(1)  351/  FF1B96 :                     ; --------------------------------------------------------
(1)  352/  FF1B96 :                     
(1)  353/  FF1B96 :                     System_JumpRamCode:
(1)  354/  FF1B96 : 80BC 0088 0000      		or.l	#$880000,d0
(1)  355/  FF1B9C : 2040                		move.l	d0,a0
(1)  356/  FF1B9E : 43F9 00FF 1BE4      		lea	(RAMCODE_USER),a1
(1)  357/  FF1BA4 : 3E3C 3FFF           		move.w	#$4000-1,d7
(1)  358/  FF1BA8 :                     .copyme2:
(1)  359/  FF1BA8 : 12D8                		move.b	(a0)+,(a1)+
(1)  360/  FF1BAA : 51CF FFFC           		dbf	d7,.copyme2
(1)  361/  FF1BAE : 4EF9 00FF 1BE4      		jmp	(RAMCODE_USER).l
(1)  362/  FF1BB4 :                     
(1)  363/  FF1BB4 :                     ; --------------------------------------------------------
(1)  364/  FF1BB4 :                     ; Initialize current screen mode
(1)  365/  FF1BB4 :                     ; --------------------------------------------------------
(1)  366/  FF1BB4 :                     
(1)  367/  FF1BB4 :                     Mode_Init:
(1)  368/  FF1BB4 : 6100 E6BE           		bsr	Video_Clear
(1)  369/  FF1BB8 : 49F8 C000           		lea	(RAM_ModeBuff),a4
(1)  370/  FF1BBC : 3A3C 03FF           		move.w	#(MAX_MDERAM/2)-1,d5
(1)  371/  FF1BC0 : 7800                		moveq	#0,d4
(1)  372/  FF1BC2 :                     .clr:
(1)  373/  FF1BC2 : 38C4                		move.w	d4,(a4)+
(1)  374/  FF1BC4 : 51CD FFFC           		dbf	d5,.clr
(1)  375/  FF1BC8 : 4E75                		rts
(1)  376/  FF1BCA :                     
(1)  377/  FF1BCA :                     ; ====================================================================
(1)  378/  FF1BCA :                     ; ----------------------------------------------------------------
(1)  379/  FF1BCA :                     ; Default interrupts
(1)  380/  FF1BCA :                     ; ----------------------------------------------------------------
(1)  381/  FF1BCA :                     
(1)  382/  FF1BCA :                     ; --------------------------------------------------------
(1)  383/  FF1BCA :                     ; VBlank
(1)  384/  FF1BCA :                     ; --------------------------------------------------------
(1)  385/  FF1BCA :                     
(1)  386/  FF1BCA :                     VInt_Default:
(1)  387/  FF1BCA : 48E7 FFFE           		movem.l	d0-a6,-(sp)
(1)  388/  FF1BCE : 6100 FCF2           		bsr	System_Input
(1)  389/  FF1BD2 :                     ; 		bsr	Sound_Update
(1)  390/  FF1BD2 : 06B9 0000 0001 FFFF 		add.l	#1,(RAM_FrameCount).l
                    D926                
(1)  391/  FF1BDC : 4CDF 7FFF           		movem.l	(sp)+,d0-a6		
(1)  392/  FF1BE0 : 4E73                		rte
(1)  393/  FF1BE2 :                     
(1)  394/  FF1BE2 :                     ; --------------------------------------------------------
(1)  395/  FF1BE2 :                     ; HBlank
(1)  396/  FF1BE2 :                     ; --------------------------------------------------------
(1)  397/  FF1BE2 :                     
(1)  398/  FF1BE2 :                     HInt_Default:
(1)  399/  FF1BE2 : 4E73                		rte
(1)  400/  FF1BE4 :                     		
(1)  401/  FF1BE4 :                     ; ====================================================================
(1)  402/  FF1BE4 :                     ; --------------------------------------------------------
(1)  403/  FF1BE4 :                     ; 32X Communication, using DREQ
(1)  404/  FF1BE4 :                     ; --------------------------------------------------------
(1)  405/  FF1BE4 :                     
(1)  406/  FF1BE4 :                     ; ; ------------------------------------------------
(1)  407/  FF1BE4 :                     ; ; Add new task to the list
(1)  408/  FF1BE4 :                     ; ; ------------------------------------------------
(1)  409/  FF1BE4 :                     ;
(1)  410/  FF1BE4 :                     ; System_MdMars_MstAddTask:
(1)  411/  FF1BE4 :                     ; 		lea	(RAM_MdMarsTskM).w,a0
(1)  412/  FF1BE4 :                     ; 		lea	(RAM_MdMarsTCntM).w,a1
(1)  413/  FF1BE4 :                     ; 		bra	sysMdMars_instask
(1)  414/  FF1BE4 :                     ;
(1)  415/  FF1BE4 :                     ; System_MdMars_SlvAddTask:
(1)  416/  FF1BE4 :                     ; 		lea	(RAM_MdMarsTskS).w,a0
(1)  417/  FF1BE4 :                     ; 		lea	(RAM_MdMarsTCntS).w,a1
(1)  418/  FF1BE4 :                     ; 		bra	sysMdMars_instask
(1)  419/  FF1BE4 :                     ;
(1)  420/  FF1BE4 :                     ; ; ------------------------------------------------
(1)  421/  FF1BE4 :                     ; ; Single task
(1)  422/  FF1BE4 :                     ; ; ------------------------------------------------
(1)  423/  FF1BE4 :                     ;
(1)  424/  FF1BE4 :                     ; System_MdMars_MstTask:
(1)  425/  FF1BE4 :                     ; 		lea	(RAM_MdMarsTsSgl),a0
(1)  426/  FF1BE4 :                     ; 		lea	(sysmars_reg+comm14),a1
(1)  427/  FF1BE4 :                     ; 		movem.l	d0-d7,(a0)
(1)  428/  FF1BE4 :                     ; 		move.w	#(MAX_MDTSKARG*4),d0
(1)  429/  FF1BE4 :                     ; 		moveq	#1,d1
(1)  430/  FF1BE4 :                     ; 		moveq	#0,d2
(1)  431/  FF1BE4 :                     ; 		bra	sysMdMars_Transfer
(1)  432/  FF1BE4 :                     ;
(1)  433/  FF1BE4 :                     ; System_MdMars_SlvTask:
(1)  434/  FF1BE4 :                     ; 		lea	(RAM_MdMarsTsSgl),a0
(1)  435/  FF1BE4 :                     ; 		lea	(sysmars_reg+comm15),a1
(1)  436/  FF1BE4 :                     ; 		movem.l	d0-d7,(a0)
(1)  437/  FF1BE4 :                     ; 		move.w	#(MAX_MDTSKARG*4),d0
(1)  438/  FF1BE4 :                     ; 		moveq	#1,d1
(1)  439/  FF1BE4 :                     ; 		moveq	#1,d2
(1)  440/  FF1BE4 :                     ; 		bra	sysMdMars_Transfer
(1)  441/  FF1BE4 :                     ;
(1)  442/  FF1BE4 :                     ; ; ------------------------------------------------
(1)  443/  FF1BE4 :                     ; ; Queued tasks
(1)  444/  FF1BE4 :                     ; ; ------------------------------------------------
(1)  445/  FF1BE4 :                     ;
(1)  446/  FF1BE4 :                     ; System_MdMars_MstSendAll:
(1)  447/  FF1BE4 :                     ; 		lea	(RAM_MdMarsTskM),a0
(1)  448/  FF1BE4 :                     ; 		lea	(sysmars_reg+comm14),a1
(1)  449/  FF1BE4 :                     ; 		move.w	(RAM_MdMarsTCntM).w,d0
(1)  450/  FF1BE4 :                     ; 		clr.w	(RAM_MdMarsTCntM).w
(1)  451/  FF1BE4 :                     ; 		moveq	#1,d1
(1)  452/  FF1BE4 :                     ; 		moveq	#0,d2
(1)  453/  FF1BE4 :                     ; 		bra	sysMdMars_Transfer
(1)  454/  FF1BE4 :                     ;
(1)  455/  FF1BE4 :                     ; System_MdMars_SlvSendAll:
(1)  456/  FF1BE4 :                     ; 		lea	(RAM_MdMarsTskS),a0
(1)  457/  FF1BE4 :                     ; 		lea	(sysmars_reg+comm15),a1
(1)  458/  FF1BE4 :                     ; 		move.w	(RAM_MdMarsTCntS).w,d0
(1)  459/  FF1BE4 :                     ; 		clr.w	(RAM_MdMarsTCntS).w
(1)  460/  FF1BE4 :                     ; 		moveq	#1,d1
(1)  461/  FF1BE4 :                     ; 		moveq	#1,d2
(1)  462/  FF1BE4 :                     ; 		bra.s	sysMdMars_Transfer
(1)  463/  FF1BE4 :                     ;
(1)  464/  FF1BE4 :                     ; System_MdMars_MstSendDrop:
(1)  465/  FF1BE4 :                     ; 		lea	(RAM_MdMarsTskM),a0
(1)  466/  FF1BE4 :                     ; 		lea	(sysmars_reg+comm14),a1
(1)  467/  FF1BE4 :                     ; 		move.w	(RAM_MdMarsTCntM).w,d0
(1)  468/  FF1BE4 :                     ; 		moveq	#1,d1
(1)  469/  FF1BE4 :                     ; 		moveq	#0,d2
(1)  470/  FF1BE4 :                     ; 		nop
(1)  471/  FF1BE4 :                     ; 		nop
(1)  472/  FF1BE4 :                     ; 		move.b	(a1),d7
(1)  473/  FF1BE4 :                     ; 		and.w	#$80,d7
(1)  474/  FF1BE4 :                     ; 		beq.s	.go_m
(1)  475/  FF1BE4 :                     ; 		rts
(1)  476/  FF1BE4 :                     ; .go_m:		clr.w	(RAM_MdMarsTCntM).w
(1)  477/  FF1BE4 :                     ; 		bra	sysMdMars_Transfer
(1)  478/  FF1BE4 :                     ;
(1)  479/  FF1BE4 :                     ; System_MdMars_SlvSendDrop:
(1)  480/  FF1BE4 :                     ; 		lea	(RAM_MdMarsTskS),a0
(1)  481/  FF1BE4 :                     ; 		lea	(sysmars_reg+comm15),a1
(1)  482/  FF1BE4 :                     ; 		move.w	(RAM_MdMarsTCntS).w,d0
(1)  483/  FF1BE4 :                     ; 		moveq	#1,d1
(1)  484/  FF1BE4 :                     ; 		moveq	#1,d2
(1)  485/  FF1BE4 :                     ; 		nop
(1)  486/  FF1BE4 :                     ; 		nop
(1)  487/  FF1BE4 :                     ; 		move.b	(a1),d7
(1)  488/  FF1BE4 :                     ; 		and.w	#$80,d7
(1)  489/  FF1BE4 :                     ; 		beq.s	.go_s
(1)  490/  FF1BE4 :                     ; 		moveq	#-1,d7
(1)  491/  FF1BE4 :                     ; 		rts
(1)  492/  FF1BE4 :                     ; .go_s:		clr.w	(RAM_MdMarsTCntS).w
(1)  493/  FF1BE4 :                     ; 		bsr	sysMdMars_Transfer
(1)  494/  FF1BE4 :                     ; 		moveq	#0,d7
(1)  495/  FF1BE4 :                     ; 		rts
(1)  496/  FF1BE4 :                     ;
(1)  497/  FF1BE4 :                     ; ; a0 - task pointer and args
(1)  498/  FF1BE4 :                     ; ; a1 - task list counter
(1)  499/  FF1BE4 :                     ; sysMdMars_instask:
(1)  500/  FF1BE4 :                     ; 		cmp.w	#(MAX_MDTSKARG*MAX_MDTASKS)*4,(a1)
(1)  501/  FF1BE4 :                     ; 		bge.s	.ran_out
(1)  502/  FF1BE4 :                     ; 		adda.w	(a1),a0
(1)  503/  FF1BE4 :                     ; 		movem.l	d0-d7,(a0)		; Set variables to RAM (d0 is the label to jump)
(1)  504/  FF1BE4 :                     ; 		add.w	#MAX_MDTSKARG*4,(a1)
(1)  505/  FF1BE4 :                     ; .ran_out:
(1)  506/  FF1BE4 :                     ; 		rts
(1)  507/  FF1BE4 :                     ;
(1)  508/  FF1BE4 :                     ; ; ------------------------------------------------
(1)  509/  FF1BE4 :                     ; ; sysMdMars_Transfer
(1)  510/  FF1BE4 :                     ; ;
(1)  511/  FF1BE4 :                     ; ; a0 - Data to transfer
(1)  512/  FF1BE4 :                     ; ; a1 - Status byte from the target CPU
(1)  513/  FF1BE4 :                     ; ; d0 - Num of LONGS(4bytes) to transfer
(1)  514/  FF1BE4 :                     ; ; d1 - Transfer type ID
(1)  515/  FF1BE4 :                     ; ; d2 - CMD Interrupt bitset value
(1)  516/  FF1BE4 :                     ; ; 	($00-Master/$01-Slave)
(1)  517/  FF1BE4 :                     ; ; ------------------------------------------------
(1)  518/  FF1BE4 :                     ;
(1)  519/  FF1BE4 :                     ; sysMdMars_Transfer:
(1)  520/  FF1BE4 :                     ; 		nop
(1)  521/  FF1BE4 :                     ; 		nop
(1)  522/  FF1BE4 :                     ; 		move.b	(a1),d4
(1)  523/  FF1BE4 :                     ; 		and.w	#$80,d4
(1)  524/  FF1BE4 :                     ; 		bne.s	sysMdMars_Transfer
(1)  525/  FF1BE4 :                     ; 		lea	(sysmars_reg),a4
(1)  526/  FF1BE4 :                     ; 		move.w	sr,d5
(1)  527/  FF1BE4 :                     ; 		move.w	#$2700,sr		; Disable interrupts
(1)  528/  FF1BE4 :                     ; 		lea	comm8(a4),a3		; comm transfer method
(1)  529/  FF1BE4 :                     ; 		move.b	d1,(a3)			; Set MD task ID
(1)  530/  FF1BE4 :                     ; 		move.b	#$01,1(a3)		; Set SH as busy first
(1)  531/  FF1BE4 :                     ; 		move.w	standby(a4),d4		; Request CMD interrupt
(1)  532/  FF1BE4 :                     ; 		bset	d2,d4
(1)  533/  FF1BE4 :                     ; 		move.w	d4,standby(a4)
(1)  534/  FF1BE4 :                     ; .wait_cmd:	move.w	standby(a4),d4		; CMD cleared?
(1)  535/  FF1BE4 :                     ; 		btst    d2,d4
(1)  536/  FF1BE4 :                     ; 		bne.s   .wait_cmd
(1)  537/  FF1BE4 :                     ; .loop:
(1)  538/  FF1BE4 :                     ; 		cmpi.b	#2,1(a3)		; SH ready?
(1)  539/  FF1BE4 :                     ; 		bne.s	.loop
(1)  540/  FF1BE4 :                     ; 		move.w	d1,d4
(1)  541/  FF1BE4 :                     ; 		or.w	#$80,d4
(1)  542/  FF1BE4 :                     ; 		move.b	d4,(a3)			; MD is busy
(1)  543/  FF1BE4 :                     ; 		tst.w	d0
(1)  544/  FF1BE4 :                     ; 		beq.s	.exit
(1)  545/  FF1BE4 :                     ; 		bmi.s	.exit
(1)  546/  FF1BE4 :                     ; 		move.l	(a0),d4
(1)  547/  FF1BE4 :                     ; 		clr.l	(a0)+
(1)  548/  FF1BE4 :                     ; 		move.w	d4,4(a3)
(1)  549/  FF1BE4 :                     ; 		swap	d4
(1)  550/  FF1BE4 :                     ; 		move.w	d4,2(a3)
(1)  551/  FF1BE4 :                     ; 		move.w	d1,d4
(1)  552/  FF1BE4 :                     ; 		or.w	#$40,d4
(1)  553/  FF1BE4 :                     ; 		move.b	d4,(a3)			; MD is ready
(1)  554/  FF1BE4 :                     ; 		sub.w	#4,d0
(1)  555/  FF1BE4 :                     ; 		bra.s	.loop
(1)  556/  FF1BE4 :                     ; .exit:
(1)  557/  FF1BE4 :                     ; 		move.b	#0,(a3)			; MD finished
(1)  558/  FF1BE4 :                     ; 		move.w	d5,sr
(1)  559/  FF1BE4 :                     ; .mid_write:
(1)  560/  FF1BE4 :                     ; 		rts
(1)  561/  FF1BE4 :                     
(1)  562/  FF1BE4 :                     ; MdMars_FIFO:
(1)  563/  FF1BE4 :                     ; 		move.w	#$100,d4
(1)  564/  FF1BE4 :                     ; 		move.w	d4,($A15110).l
(1)  565/  FF1BE4 :                     ; 		move.b	#%100,($A15107).l
(1)  566/  FF1BE4 :                     ; loc_0_28E2:
(1)  567/  FF1BE4 :                     ; 		btst	#1,(sysmars_reg+comm14).l
(1)  568/  FF1BE4 :                     ; 		beq.s	loc_0_28E2
(1)  569/  FF1BE4 :                     ; 		bclr	#1,(sysmars_reg+comm14).l
(1)  570/  FF1BE4 :                     ; 		lea	($FF0000).l,a4
(1)  571/  FF1BE4 :                     ; 		lea	($A15112).l,a5
(1)  572/  FF1BE4 :                     ; 		lsr.w	#2,d4
(1)  573/  FF1BE4 :                     ; 		beq.s	.exit
(1)  574/  FF1BE4 :                     ; .fifo_blast:
(1)  575/  FF1BE4 :                     ; 		btst	#7,($A15107).l
(1)  576/  FF1BE4 :                     ; 		bne.s	.fifo_blast
(1)  577/  FF1BE4 :                     ; 		move.w	(a4)+,(a5)
(1)  578/  FF1BE4 :                     ; 		dbf	d4,.fifo_blast
(1)  579/  FF1BE4 :                     ; .exit:
(1)  580/  FF1BE4 :                     ; 		rts
(1)  581/  FF1BE4 :                     
(1)  582/  FF1BE4 :                     ; ====================================================================
(1)  583/  FF1BE4 :                     ; ----------------------------------------------------------------
(1)  584/  FF1BE4 :                     ; System data
(1)  585/  FF1BE4 :                     ; ----------------------------------------------------------------
(1)  586/  FF1BE4 :                     
(1)  587/  FF1BE4 :                     
(1)  588/  FF1BE4 :                     
      37/  FF1BE4 :                     RAMCODE_USER:
      38/    251C :                     		dephase
      39/    251C :                     MdRamCode_end:
      40/    251C :                     		align 2
      41/    251C :                     
      42/    251C :                     ; ----------------------------------------------------------------
      43/    251C :                     ; Z80 code
      44/    251C :                     ; Located at the 880000 area
      45/    251C :                     ; ----------------------------------------------------------------
      46/    251C :                     
      47/    251C :                     		align 4
      48/    251C :                     Z80_CODE:
      49/    251C :                     		include "system/md/z_driver.asm"
(1)    1/    251C :                     ; --------------------------------------------------------
(1)    2/    251C :                     ; GEMA sound driver, inspired by GEMS (kinda)
(1)    3/    251C :                     ;
(1)    4/    251C :                     ; Two playable track slots: BGM(0) and SFX(1)
(1)    5/    251C :                     ;
(1)    6/    251C :                     ; Slot 1 can either overwrite chip channels or
(1)    7/    251C :                     ; if possible grab unused slots
(1)    8/    251C :                     ;
(1)    9/    251C :                     ; WARNING: DAC sample playback has to be sync'd manually
(1)   10/    251C :                     ; on every code change, sample rate is at the
(1)   11/    251C :                     ; 18000hz range
(1)   12/    251C :                     ; --------------------------------------------------------
(1)   13/    251C :                     
(1)   14/    251C :                     		cpu Z80			; Set Z80 here
(1)   15/       0 :                     		phase 0			; And set PC to 0
(1)   16/       0 :                     
(1)   17/       0 :                     ; --------------------------------------------------------
(1)   18/       0 :                     ; User settings
(1)   19/       0 :                     ; --------------------------------------------------------
(1)   20/       0 :                     
(1)   21/       0 : =12H                MAX_TRKCHN	equ 18		; Max internal tracker channels (4PSG + 6FM + 7PWM)
(1)   22/       0 : =FFFFFFFFFFF..      ZSET_WTUNE	equ -24		; Manual frequency adjustment for DAC WAVE playback
(1)   23/       0 : =0H                 ZSET_TESTME	equ 0		; ***TESTING*** Set to 1 to hear-test DAC playback
(1)   24/       0 :                     
(1)   25/       0 :                     ; --------------------------------------------------------
(1)   26/       0 :                     ; Structs
(1)   27/       0 :                     ;
(1)   28/       0 :                     ; NOTE: struct doesn't work here. use equs instead
(1)   29/       0 :                     ; --------------------------------------------------------
(1)   30/       0 :                     
(1)   31/       0 :                     ; trkBuff struct
(1)   32/       0 :                     ; LIMIT: 20h (32) bytes
(1)   33/       0 : =0H                 trk_romBlk	equ 0		; 24-bit base block data
(1)   34/       0 : =3H                 trk_romPatt	equ 3		; 24-bit base patt data
(1)   35/       0 : =6H                 trk_romIns	equ 6		; 24-bit ROM instrument pointers
(1)   36/       0 : =9H                 trk_romPattRd	equ 9		; same but for reading
(1)   37/       0 : =CH                 trk_Read	equ 12		; Current track position (in cache)
(1)   38/       0 : =EH                 trk_Rows	equ 14		; Current track length
(1)   39/       0 : =10H                trk_Halfway	equ 16		; Only 00h or 80h
(1)   40/       0 : =11H                trk_currBlk	equ 17		; Current block
(1)   41/       0 : =12H                trk_setBlk	equ 18		; Start on this block
(1)   42/       0 : =13H                trk_status	equ 19		; %ERPB xxxx | E-enabled / R-Init|Restart track / P-refill-on-playback / B-use global beats
(1)   43/       0 : =14H                trk_tickTmr	equ 20		; Ticks timer
(1)   44/       0 : =15H                trk_tickSet	equ 21		; Ticks set for this track
(1)   45/       0 : =16H                trk_numChnls	equ 22		; Number of channels for this track slot (max: MAX_TRKCHN)
(1)   46/       0 : =17H                trk_sizeIns	equ 23		; Max instruments used
(1)   47/       0 : =18H                trk_rowPause	equ 24
(1)   48/       0 : =19H                trk_HdHalfway	equ 25		; Track heads reload byte
(1)   49/       0 : =1AH                trk_CachNotes	equ 26		; Track pattern buffer location (100h bytes)
(1)   50/       0 :                     ; trk_CachHeads	equ 28		; Buff'd Track heads
(1)   51/       0 :                     ; trk_CachIns	equ 30
(1)   52/       0 :                     
(1)   53/       0 :                     ; Track data: 8 bytes only
(1)   54/       0 : =0H                 chnl_Chip	equ 0		; MUST BE at 0
(1)   55/       0 : =1H                 chnl_Note	equ 1
(1)   56/       0 : =2H                 chnl_Ins	equ 2
(1)   57/       0 : =3H                 chnl_Vol	equ 3
(1)   58/       0 : =4H                 chnl_EffId	equ 4
(1)   59/       0 : =5H                 chnl_EffArg	equ 5
(1)   60/       0 : =6H                 chnl_Type	equ 6		; Impulse-note bits
(1)   61/       0 : =7H                 chnl_Flags	equ 7		; playback requests and other specific bits
(1)   62/       0 :                     
(1)   63/       0 :                     ; --------------------------------------------------------
(1)   64/       0 :                     ; Variables
(1)   65/       0 :                     ; --------------------------------------------------------
(1)   66/       0 :                     
(1)   67/       0 :                     ; To brute force DAC playback
(1)   68/       0 :                     ; on or off
(1)   69/       0 : =0H                 zopcNop		equ	00h
(1)   70/       0 : =8H                 zopcEx		equ	08h
(1)   71/       0 : =C9H                zopcRet		equ 	0C9h
(1)   72/       0 : =D9H                zopcExx		equ	0D9h		; (dac_me ONLY)
(1)   73/       0 : =F5H                zopcPushAf	equ	0F5h		; (dac_fill ONLY)
(1)   74/       0 :                     
(1)   75/       0 :                     ; PSG external control
(1)   76/       0 : =0H                 COM		equ	0
(1)   77/       0 : =4H                 LEV		equ	4
(1)   78/       0 : =8H                 ATK		equ	8
(1)   79/       0 : =CH                 DKY		equ	12
(1)   80/       0 : =10H                SLV		equ	16
(1)   81/       0 : =14H                RRT		equ	20
(1)   82/       0 : =18H                MODE		equ	24
(1)   83/       0 : =1CH                DTL		equ	28
(1)   84/       0 : =20H                DTH		equ	32
(1)   85/       0 : =24H                ALV		equ	36
(1)   86/       0 : =28H                FLG		equ	40
(1)   87/       0 : =2CH                TMR		equ	44
(1)   88/       0 : =30H                PVOL		equ	48
(1)   89/       0 :                     
(1)   90/       0 :                     ; FMCOM		equ	0
(1)   91/       0 : =6H                 FMKEYS		equ	6
(1)   92/       0 : =CH                 FMVOL		equ	12
(1)   93/       0 : =12H                FMPAN 		equ	18
(1)   94/       0 : =18H                FMFRQH		equ	24
(1)   95/       0 : =1EH                FMFRQL		equ	30
(1)   96/       0 :                     
(1)   97/       0 : =0H                 PWCOM		equ	0
(1)   98/       0 : =8H                 PWPTH_V		equ	8	; Volume | Pitch MSB
(1)   99/       0 : =10H                PWPHL		equ	16	; Pitch LSB
(1)  100/       0 : =18H                PWOUTF		equ	24	; Output mode/bits | SH2 section (ROM $02 or SDRAM $06)
(1)  101/       0 : =20H                PWINSH		equ	32	; 24-bit sample address
(1)  102/       0 : =28H                PWINSM		equ	40
(1)  103/       0 : =30H                PWINSL		equ	48
(1)  104/       0 :                     
(1)  105/       0 :                     ; ====================================================================
(1)  106/       0 :                     ; --------------------------------------------------------
(1)  107/       0 :                     ; Code starts here
(1)  108/       0 :                     ; --------------------------------------------------------
(1)  109/       0 :                     
(1)  110/       0 : F3                  		di			; Disable interrputs
(1)  111/       1 : ED 56               		im	1		; Interrupt mode 1
(1)  112/       3 : 31 00 20            		ld	sp,2000h	; Set stack at the end of Z80
(1)  113/       6 : 18 36               		jr	z80_init	; Jump to z80_init
(1)  114/       8 :                     
(1)  115/       8 :                     ; --------------------------------------------------------
(1)  116/       8 :                     ; RST 8 (dac_me)
(1)  117/       8 :                     ;
(1)  118/       8 :                     ; Writes wave data to DAC using the data stored
(1)  119/       8 :                     ; on the wave buffer.
(1)  120/       8 :                     ; call this routine every 6 or more lines of code to
(1)  121/       8 :                     ; keep playing the sample while processing code
(1)  122/       8 :                     ;
(1)  123/       8 :                     ; Input (EXX):
(1)  124/       8 :                     ;  c - WAVEFIFO MSB
(1)  125/       8 :                     ; de - Pitch (xx.00)
(1)  126/       8 :                     ; h  - WAVEFIFO LSB (as xx.00)
(1)  127/       8 :                     ;
(1)  128/       8 :                     ; Uses (EXX):
(1)  129/       8 :                     ; b
(1)  130/       8 :                     ;
(1)  131/       8 :                     ; *** self-modifiable code ***
(1)  132/       8 :                     ; call dac_on to enable WAVE playback
(1)  133/       8 :                     ; or
(1)  134/       8 :                     ; call dac_off to disable it
(1)  135/       8 :                     ; (check for FM6 manually)
(1)  136/       8 :                     ; --------------------------------------------------------
(1)  137/       8 :                     
(1)  138/       8 :                     ; NOTE: This plays at 18000hz
(1)  139/       8 : (MACRO)             		org	8
(1)  140/       8 : D9                  dac_me:		exx			; <-- opcode changes between EXX(play) and RET(stop)
(1)  141/       9 : 08                  		ex	af,af'		; get our alt A/F
(1)  142/       A : 45                  		ld	b,l		; save l to b
(1)  143/       B : 3E 2A               		ld	a,2Ah		; Prepare DAC register
(1)  144/       D : 32 00 40            		ld	(Zym_ctrl_1),a
(1)  145/      10 : 6C                  		ld	l,h		; xx.00 to 00xx
(1)  146/      11 : 61                  		ld	h,c		; Buffer MSB | 00xx
(1)  147/      12 : 7E                  		ld	a,(hl)		; Write WAVE byte
(1)  148/      13 : 32 01 40            		ld	(Zym_data_1),a
(1)  149/      16 : 65                  		ld	h,l		; get hl back
(1)  150/      17 : 68                  		ld	l,b
(1)  151/      18 : 19                  		add	hl,de		; Add pitch for next byte
(1)  152/      19 : 08                  		ex	af,af'
(1)  153/      1A : D9                  		exx
(1)  154/      1B : C9                  		ret
(1)  155/      1C : 00                  commZRomBlk	db 0		; 68k ROM block flag
(1)  156/      1D : 00                  commZRomRd	db 0		; Z80 ROM reading flag
(1)  157/      1E : 00                  commZRead	db 0		; cmd read pointer (here)
(1)  158/      1F : 00                  commZWrite	db 0		; cmd fifo wptr (from 68k)
(1)  159/      20 : 00                  marsBlock	db 0		; 1 - to disable PWM comm
(1)  160/      21 : 00                  palMode		db 0
(1)  161/      22 : E0 00               sbeatPtck	dw 224		; Sub beats per tick (8frac), default is 120bpm
(1)  162/      24 : 00 00               sbeatAcc	dw 0		; Accumulates ^^ each tick to track sub beats
(1)  163/      26 :                     
(1)  164/      26 :                     ; --------------------------------------------------------
(1)  165/      26 :                     ; Z80 Interrupt at 0038h
(1)  166/      26 :                     ;
(1)  167/      26 :                     ; Sets the TICK flag
(1)  168/      26 :                     ; --------------------------------------------------------
(1)  169/      26 :                     
(1)  170/      26 : (MACRO)             		org 38h			; Align 38h
(1)  170/      26 : 00                                                  db 0
(1)  170/      27 : 00                                                  db 0
(1)  170/      28 : 00                                                  db 0
(1)  170/      29 : 00                                                  db 0
(1)  170/      2A : 00                                                  db 0
(1)  170/      2B : 00                                                  db 0
(1)  170/      2C : 00                                                  db 0
(1)  170/      2D : 00                                                  db 0
(1)  170/      2E : 00                                                  db 0
(1)  170/      2F : 00                                                  db 0
(1)  170/      30 : 00                                                  db 0
(1)  170/      31 : 00                                                  db 0
(1)  170/      32 : 00                                                  db 0
(1)  170/      33 : 00                                                  db 0
(1)  170/      34 : 00                                                  db 0
(1)  170/      35 : 00                                                  db 0
(1)  170/      36 : 00                                                  db 0
(1)  170/      37 : 00                                                  db 0
(1)  170/      38 :                     
(1)  171/      38 : ED 73 CD 19         		ld	(tickFlag),sp	; Use sp to set TICK flag (xx1F, read as tickFlag+1)
(1)  172/      3C : F3                  		di			; Disable interrupt until next request
(1)  173/      3D : C9                  		ret
(1)  174/      3E :                     
(1)  175/      3E :                     ; --------------------------------------------------------
(1)  176/      3E :                     ; Initilize
(1)  177/      3E :                     ; --------------------------------------------------------
(1)  178/      3E :                     
(1)  179/      3E :                     z80_init:
(1)  180/      3E : CD 63 0F            		call	gema_init	; Initilize VBLANK sound driver
(1)  181/      41 : FB                  		ei
(1)  182/      42 :                     
(1)  183/      42 :                     ; --------------------------------------------------------
(1)  184/      42 :                     ; MAIN LOOP
(1)  185/      42 :                     ; --------------------------------------------------------
(1)  186/      42 :                     
(1)  187/      42 :                     drv_loop:
(1)  188/      42 : CF                  		rst	8
(1)  189/      43 : CD CB 0F            		call	get_tick	; Check for tick on VBlank
(1)  190/      46 : CD 94 14            		call	dac_fill
(1)  191/      49 : CF                  		rst	8
(1)  192/      4A : 06 00               		ld	b,0		; b - Reset current flags (beat|tick)
(1)  193/      4C : 3A CF 19            		ld	a,(tickCnt)
(1)  194/      4F : D6 01               		sub	1
(1)  195/      51 : 38 0C               		jr	c,.noticks
(1)  196/      53 : 32 CF 19            		ld	(tickCnt),a
(1)  197/      56 : CF                  		rst	8
(1)  198/      57 : CD D5 10            		call	chip_env	; Process PSG volume and freqs manually
(1)  199/      5A : CD CB 0F            		call	get_tick	; Check for another tick
(1)  200/      5D : 06 01               		ld 	b,01b		; Set TICK (01b) flag, and clear BEAT
(1)  201/      5F :                     .noticks:
(1)  202/      5F : 3A 25 00            		ld	a,(sbeatAcc+1)	; check beat counter (scaled by tempo)
(1)  203/      62 : D6 01               		sub	1
(1)  204/      64 : 38 06               		jr	c,.nobeats
(1)  205/      66 : 32 25 00            		ld	(sbeatAcc+1),a	; 1/24 beat passed.
(1)  206/      69 : CB C8               		set	1,b		; Set BEAT (10b) flag
(1)  207/      6B : CF                  		rst	8
(1)  208/      6C :                     .nobeats:
(1)  209/      6C : CF                  		rst	8
(1)  210/      6D : 78                  		ld	a,b
(1)  211/      6E : B7                  		or	a
(1)  212/      6F : 28 13               		jr	z,.neither
(1)  213/      71 : 32 CB 19            		ld	(currTickBits),a; Save BEAT/TICK bits
(1)  214/      74 : CD CB 0F            		call	get_tick
(1)  215/      77 : CD D0 05            		call	setupchip	; Setup note changes to soundchips
(1)  216/      7A : CD CB 0F            		call	get_tick
(1)  217/      7D : CD CF 01            		call	updtrack	; Update track data
(1)  218/      80 : CD CB 0F            		call	get_tick
(1)  219/      83 : CF                  		rst	8
(1)  220/      84 :                     .neither:
(1)  221/      84 : CD 4C 05            		call	mars_scomm
(1)  222/      87 : CD CB 0F            		call	get_tick
(1)  223/      8A : CF                  		rst	8
(1)  224/      8B :                     .next_cmd:
(1)  225/      8B :                     ; 		call	dac_fill	; Critical for syncing wave
(1)  226/      8B : 3A 1F 00            		ld	a,(commZWrite)
(1)  227/      8E : 47                  		ld	b,a
(1)  228/      8F : 3A 1E 00            		ld	a,(commZRead)
(1)  229/      92 : B8                  		cp	b
(1)  230/      93 : 28 AD               		jr	z,drv_loop
(1)  231/      95 : CD AE 01            		call	get_cmdbyte
(1)  232/      98 : FE FF               		cp	-1		; Get -1 (Start of command)
(1)  233/      9A : 20 A6               		jr	nz,drv_loop
(1)  234/      9C : CD AE 01            		call	get_cmdbyte	; Read cmd number
(1)  235/      9F : 87                  		add	a,a
(1)  236/      A0 : 21 AC 00            		ld	hl,.list
(1)  237/      A3 : 16 00               		ld	d,0
(1)  238/      A5 : 5F                  		ld	e,a
(1)  239/      A6 : 19                  		add	hl,de
(1)  240/      A7 :                     ; 		call	dac_fill
(1)  241/      A7 : 7E                  		ld	a,(hl)
(1)  242/      A8 : 23                  		inc	hl
(1)  243/      A9 : 66                  		ld	h,(hl)
(1)  244/      AA : 6F                  		ld	l,a
(1)  245/      AB : E9                  		jp	(hl)
(1)  246/      AC :                     .list:
(1)  247/      AC : F0 00               		dw .cmnd_trkplay	; $00 - Play
(1)  248/      AE : 4C 01               		dw .cmnd_trkstop	; $01 - Stop
(1)  249/      B0 : 5C 01               		dw .cmnd_trkpause	; $02 - Pause
(1)  250/      B2 : 69 01               		dw .cmnd_trkresume	; $03 - Resume
(1)  251/      B4 : EC 00               		dw .cmnd_0		; $04 - Fade out
(1)  252/      B6 : EC 00               		dw .cmnd_0		; $05 - Fade in
(1)  253/      B8 : EC 00               		dw .cmnd_0		; $06 - Set master volume
(1)  254/      BA : EC 00               		dw .cmnd_0		; $07 -
(1)  255/      BC : 76 01               		dw .cmnd_trkticks	; $08 - Set ticks
(1)  256/      BE : EC 00               		dw .cmnd_0		; $09 -
(1)  257/      C0 : EC 00               		dw .cmnd_0		; $0A -
(1)  258/      C2 : EC 00               		dw .cmnd_0		; $0B -
(1)  259/      C4 : EC 00               		dw .cmnd_0		; $0C -
(1)  260/      C6 : EC 00               		dw .cmnd_0		; $0D -
(1)  261/      C8 : EC 00               		dw .cmnd_0		; $0E -
(1)  262/      CA : EC 00               		dw .cmnd_0		; $0F -
(1)  263/      CC : 88 01               		dw .cmnd_trktempo	; $10 - Set global tempo
(1)  264/      CE : EC 00               		dw .cmnd_0
(1)  265/      D0 : EC 00               		dw .cmnd_0
(1)  266/      D2 : EC 00               		dw .cmnd_0
(1)  267/      D4 : EC 00               		dw .cmnd_0		; $14
(1)  268/      D6 : EC 00               		dw .cmnd_0
(1)  269/      D8 : EC 00               		dw .cmnd_0
(1)  270/      DA : EC 00               		dw .cmnd_0
(1)  271/      DC : EC 00               		dw .cmnd_0		; $18
(1)  272/      DE : EC 00               		dw .cmnd_0
(1)  273/      E0 : EC 00               		dw .cmnd_0
(1)  274/      E2 : EC 00               		dw .cmnd_0
(1)  275/      E4 : EC 00               		dw .cmnd_0		; $1C
(1)  276/      E6 : EC 00               		dw .cmnd_0
(1)  277/      E8 : EC 00               		dw .cmnd_0
(1)  278/      EA : EC 00               		dw .cmnd_0
(1)  279/      EC :                     
(1)  280/      EC :                     ; --------------------------------------------------------
(1)  281/      EC :                     ; Command list
(1)  282/      EC :                     ; --------------------------------------------------------
(1)  283/      EC :                     
(1)  284/      EC :                     .cmnd_0:
(1)  285/      EC : 18 FE               		jr	$
(1)  286/      EE : 18 9B               		jr	.next_cmd
(1)  287/      F0 :                     
(1)  288/      F0 :                     ; --------------------------------------------------------
(1)  289/      F0 :                     ; $01 - Set NEW track
(1)  290/      F0 :                     ; --------------------------------------------------------
(1)  291/      F0 :                     
(1)  292/      F0 :                     ; Slot
(1)  293/      F0 :                     ; Ticks
(1)  294/      F0 :                     ; 24-bit patt data
(1)  295/      F0 :                     ; 24-bit block data
(1)  296/      F0 :                     .cmnd_trkplay:
(1)  297/      F0 : CD AE 01            		call	get_cmdbyte		; Get track slot
(1)  298/      F3 : CD 9D 01            		call	get_trkindx		; and read index iy
(1)  299/      F6 : CD AE 01            		call	get_cmdbyte		; Get ticks
(1)  300/      F9 : FD 77 15            		ld	(iy+trk_tickSet),a
(1)  301/      FC : CD AE 01            		call	get_cmdbyte		; Start block
(1)  302/      FF : FD 77 12            		ld	(iy+trk_setBlk),a
(1)  303/     102 : CD AE 01            		call	get_cmdbyte		; Flag bits
(1)  304/     105 : F6 C0               		or	11000000b		; Enable + First fill bits
(1)  305/     107 : FD 77 13            		ld	(iy+trk_status),a
(1)  306/     10A : CD AE 01            		call	get_cmdbyte		; Pattern data
(1)  307/     10D : FD 77 03            		ld	(iy+trk_romPatt),a
(1)  308/     110 : CD AE 01            		call	get_cmdbyte
(1)  309/     113 : FD 77 04            		ld	(iy+(trk_romPatt+1)),a
(1)  310/     116 : CD AE 01            		call	get_cmdbyte
(1)  311/     119 : FD 77 05            		ld	(iy+(trk_romPatt+2)),a
(1)  312/     11C : CD AE 01            		call	get_cmdbyte		; Block data
(1)  313/     11F : FD 77 00            		ld	(iy+trk_romBlk),a
(1)  314/     122 : CD AE 01            		call	get_cmdbyte
(1)  315/     125 : FD 77 01            		ld	(iy+(trk_romBlk+1)),a
(1)  316/     128 : CD AE 01            		call	get_cmdbyte
(1)  317/     12B : CD CB 0F            		call	get_tick
(1)  318/     12E : FD 77 02            		ld	(iy+(trk_romBlk+2)),a
(1)  319/     131 : CD AE 01            		call	get_cmdbyte		; Instrument data
(1)  320/     134 : FD 77 06            		ld	(iy+trk_romIns),a
(1)  321/     137 : CD AE 01            		call	get_cmdbyte
(1)  322/     13A : FD 77 07            		ld	(iy+(trk_romIns+1)),a
(1)  323/     13D : CD AE 01            		call	get_cmdbyte
(1)  324/     140 : FD 77 08            		ld	(iy+(trk_romIns+2)),a
(1)  325/     143 : 3E 01               		ld	a,1
(1)  326/     145 : FD 77 14            		ld	(iy+trk_tickTmr),a
(1)  327/     148 : CF                  		rst	8
(1)  328/     149 : C3 8B 00            		jp	.next_cmd
(1)  329/     14C :                     
(1)  330/     14C :                     ; --------------------------------------------------------
(1)  331/     14C :                     ; $02 - STOP track
(1)  332/     14C :                     ; --------------------------------------------------------
(1)  333/     14C :                     
(1)  334/     14C :                     .cmnd_trkstop:
(1)  335/     14C : CD AE 01            		call	get_cmdbyte		; Get track slot
(1)  336/     14F : CD 9D 01            		call	get_trkindx		; and read index iy
(1)  337/     152 : FD 36 13 00         		ld	(iy+trk_status),0
(1)  338/     156 : CD AA 04            		call	track_out
(1)  339/     159 : C3 8B 00            		jp	.next_cmd
(1)  340/     15C :                     
(1)  341/     15C :                     ; --------------------------------------------------------
(1)  342/     15C :                     ; $03 - Pause track
(1)  343/     15C :                     ; --------------------------------------------------------
(1)  344/     15C :                     
(1)  345/     15C :                     .cmnd_trkpause:
(1)  346/     15C : CD AE 01            		call	get_cmdbyte		; Get track slot
(1)  347/     15F : CD 9D 01            		call	get_trkindx		; and read index iy
(1)  348/     162 : FD CB 13 BE         		res	7,(iy+trk_status)	; Slot OFF
(1)  349/     166 :                     ; 		call	track_out
(1)  350/     166 : C3 8B 00            		jp	.next_cmd
(1)  351/     169 :                     
(1)  352/     169 :                     ; --------------------------------------------------------
(1)  353/     169 :                     ; $04 - Resume track
(1)  354/     169 :                     ; --------------------------------------------------------
(1)  355/     169 :                     
(1)  356/     169 :                     .cmnd_trkresume:
(1)  357/     169 : CD AE 01            		call	get_cmdbyte		; Get track slot
(1)  358/     16C : CD 9D 01            		call	get_trkindx		; and read index iy
(1)  359/     16F : FD CB 13 FE         		set	7,(iy+trk_status)	; Slot ON
(1)  360/     173 :                     ; 		call	track_out
(1)  361/     173 : C3 8B 00            		jp	.next_cmd
(1)  362/     176 :                     
(1)  363/     176 :                     ; --------------------------------------------------------
(1)  364/     176 :                     ; $08 - Set tricks
(1)  365/     176 :                     ; --------------------------------------------------------
(1)  366/     176 :                     
(1)  367/     176 :                     .cmnd_trkticks:
(1)  368/     176 : CD AE 01            		call	get_cmdbyte		; Get track slot
(1)  369/     179 : CD 9D 01            		call	get_trkindx		; and read index iyc
(1)  370/     17C : CD AE 01            		call	get_cmdbyte
(1)  371/     17F : FD 77 15            		ld	(iy+trk_tickSet),a
(1)  372/     182 : FD 77 14            		ld	(iy+trk_tickTmr),a
(1)  373/     185 : C3 8B 00            		jp	.next_cmd
(1)  374/     188 :                     
(1)  375/     188 :                     ; --------------------------------------------------------
(1)  376/     188 :                     ; $10 - Set global tempo
(1)  377/     188 :                     ; --------------------------------------------------------
(1)  378/     188 :                     
(1)  379/     188 :                     .cmnd_trktempo:
(1)  380/     188 : CD AE 01            		call	get_cmdbyte		; Get track slot
(1)  381/     18B : CD 9D 01            		call	get_trkindx		; and read index iyc
(1)  382/     18E : CD AE 01            		call	get_cmdbyte
(1)  383/     191 : 32 22 00            		ld	(sbeatPtck),a
(1)  384/     194 : CD AE 01            		call	get_cmdbyte
(1)  385/     197 : 32 23 00            		ld	(sbeatPtck+1),a
(1)  386/     19A : C3 8B 00            		jp	.next_cmd
(1)  387/     19D :                     
(1)  388/     19D :                     ; --------------------------------------------------------
(1)  389/     19D :                     ; a - track index
(1)  390/     19D :                     
(1)  391/     19D :                     get_trkindx:
(1)  392/     19D : 21 BD 18            		ld	hl,trkPointers
(1)  393/     1A0 : 87                  		add	a,a
(1)  394/     1A1 : 16 00               		ld	d,0
(1)  395/     1A3 : 5F                  		ld	e,a
(1)  396/     1A4 : CF                  		rst	8
(1)  397/     1A5 : 19                  		add	hl,de
(1)  398/     1A6 : 7E                  		ld	a,(hl)
(1)  399/     1A7 : 23                  		inc	hl
(1)  400/     1A8 : 66                  		ld	h,(hl)
(1)  401/     1A9 : 6F                  		ld	l,a
(1)  402/     1AA : E5                  		push	hl
(1)  403/     1AB : FD E1               		pop	iy
(1)  404/     1AD : C9                  		ret
(1)  405/     1AE :                     
(1)  406/     1AE :                     ; --------------------------------------------------------
(1)  407/     1AE :                     ; Read cmd byte, auto re-aligns to 7Fh
(1)  408/     1AE :                     ; --------------------------------------------------------
(1)  409/     1AE :                     
(1)  410/     1AE :                     get_cmdbyte:
(1)  411/     1AE : C5                  		push	bc
(1)  412/     1AF : D5                  		push	de
(1)  413/     1B0 : E5                  		push	hl
(1)  414/     1B1 :                     .getcbytel:
(1)  415/     1B1 : 3A 1F 00            		ld	a,(commZWrite)
(1)  416/     1B4 : 47                  		ld	b,a
(1)  417/     1B5 : 3A 1E 00            		ld	a,(commZRead)
(1)  418/     1B8 : B8                  		cp	b
(1)  419/     1B9 : 28 F6               		jr	z,.getcbytel	; wait for a command from 68k
(1)  420/     1BB : CF                  		rst	8
(1)  421/     1BC : 06 00               		ld	b,0
(1)  422/     1BE : 4F                  		ld	c,a
(1)  423/     1BF : 21 B0 1E            		ld	hl,commZfifo
(1)  424/     1C2 : 09                  		add	hl,bc
(1)  425/     1C3 : 3C                  		inc	a
(1)  426/     1C4 : E6 3F               		and	3Fh		; command list limit
(1)  427/     1C6 : CF                  		rst	8
(1)  428/     1C7 : 32 1E 00            		ld	(commZRead),a
(1)  429/     1CA : 7E                  		ld	a,(hl)		; a - the byte we got
(1)  430/     1CB : E1                  		pop	hl
(1)  431/     1CC : D1                  		pop	de
(1)  432/     1CD : C1                  		pop	bc
(1)  433/     1CE : C9                  		ret
(1)  434/     1CF :                     
(1)  435/     1CF :                     ; ====================================================================
(1)  436/     1CF :                     ; ----------------------------------------------------------------
(1)  437/     1CF :                     ; Sound playback code
(1)  438/     1CF :                     ; ----------------------------------------------------------------
(1)  439/     1CF :                     
(1)  440/     1CF :                     ; --------------------------------------------------------
(1)  441/     1CF :                     ; Read track data
(1)  442/     1CF :                     ; --------------------------------------------------------
(1)  443/     1CF :                     
(1)  444/     1CF :                     updtrack:
(1)  445/     1CF : CD 94 14            		call	dac_fill
(1)  446/     1D2 : FD 21 00 1E         		ld	iy,trkBuff_0		; BGM
(1)  447/     1D6 : CF                  		rst	8
(1)  448/     1D7 : 11 C1 18            		ld	de,insDataC_0
(1)  449/     1DA : CD E9 01            		call	.read_track
(1)  450/     1DD : FD 21 00 1F         		ld	iy,trkBuff_1		; SFX
(1)  451/     1E1 : 11 41 19            		ld	de,insDataC_1
(1)  452/     1E4 : CF                  		rst	8
(1)  453/     1E5 : CD E9 01            		call	.read_track
(1)  454/     1E8 : C9                  		ret
(1)  455/     1E9 :                     
(1)  456/     1E9 :                     ; ----------------------------------------
(1)  457/     1E9 :                     ; Read current track
(1)  458/     1E9 :                     ;
(1)  459/     1E9 :                     ; iy - Track control
(1)  460/     1E9 :                     ; ix - Track channels
(1)  461/     1E9 :                     ; de - Instrument CACHE point
(1)  462/     1E9 :                     ; ----------------------------------------
(1)  463/     1E9 :                     
(1)  464/     1E9 :                     .read_track:
(1)  465/     1E9 : FD 46 13            		ld	b,(iy+trk_status)	; b - Track status
(1)  466/     1EC : CB 78               		bit	7,b			; Active?
(1)  467/     1EE : C8                  		ret	z
(1)  468/     1EF : ED 53 C3 19         		ld	(currInsData),de	; save temporal InsData
(1)  469/     1F3 : CF                  		rst	8
(1)  470/     1F4 : 3A CB 19            		ld	a,(currTickBits)	; a - Tick/Beat bits
(1)  471/     1F7 : CB 40               		bit	0,b			; This track uses Beats?
(1)  472/     1F9 : 28 03               		jr	z,.sfxmd		; Nope
(1)  473/     1FB : CB 4F               		bit	1,a			; BEAT passed?
(1)  474/     1FD : C8                  		ret	z
(1)  475/     1FE :                     .sfxmd:
(1)  476/     1FE : CB 47               		bit	0,a			; TICK passed?
(1)  477/     200 : C8                  		ret	z
(1)  478/     201 : FD 7E 14            		ld	a,(iy+trk_tickTmr)	; TICK timer for this track
(1)  479/     204 : 3D                  		dec	a
(1)  480/     205 : FD 77 14            		ld	(iy+trk_tickTmr),a
(1)  481/     208 : CF                  		rst	8
(1)  482/     209 : B7                  		or	a
(1)  483/     20A : C0                  		ret	nz			; If != 0, exit
(1)  484/     20B : CB 68               		bit	5,b			; Effect-requested track set?
(1)  485/     20D : C4 20 04            		call	nz,.effect_fill
(1)  486/     210 : CB 70               		bit	6,b			; Restart/First time?
(1)  487/     212 : C4 2C 04            		call	nz,.first_fill
(1)  488/     215 : FD 7E 15            		ld	a,(iy+trk_tickSet)	; Set new tick timer
(1)  489/     218 : FD 77 14            		ld	(iy+trk_tickTmr),a
(1)  490/     21B : CF                  		rst	8
(1)  491/     21C : FD 6E 0C            		ld	l,(iy+trk_Read)		; hl - Pattern data to read in cache
(1)  492/     21F : FD 66 0D            		ld	h,(iy+((trk_Read+1)))
(1)  493/     222 : FD 4E 0E            		ld	c,(iy+trk_Rows)		; bc - Set row counter
(1)  494/     225 : FD 46 0F            		ld	b,(iy+(trk_Rows+1))
(1)  495/     228 : 79                  		ld	a,c
(1)  496/     229 : B0                  		or	b
(1)  497/     22A : CC 78 03            		call	z,.next_track		; If rowtimer == 0, get next track data
(1)  498/     22D : FE FF               		cp	-1			; or exit.
(1)  499/     22F : C8                  		ret	z
(1)  500/     230 : CF                  		rst	8
(1)  501/     231 :                     
(1)  502/     231 :                     ; --------------------------------
(1)  503/     231 :                     ; Main reading loop
(1)  504/     231 :                     ; --------------------------------
(1)  505/     231 :                     
(1)  506/     231 :                     .next_note:
(1)  507/     231 : FD 7E 18            		ld	a,(iy+trk_rowPause)	; Check rowtimer
(1)  508/     234 : B7                  		or	a
(1)  509/     235 : 20 17               		jr	nz,.decrow
(1)  510/     237 : 7E                  		ld	a,(hl)			; Check if timer or note
(1)  511/     238 : B7                  		or	a
(1)  512/     239 : 28 08               		jr	z,.exit			; If == 00h: exit
(1)  513/     23B : FA 5A 02            		jp	m,.has_note		; 80h-0FFh: note data
(1)  514/     23E : FD 77 18            		ld	(iy+trk_rowPause),a
(1)  515/     241 : 18 00               		jr	.exit			; make row-timer, set hl+1
(1)  516/     243 :                     
(1)  517/     243 :                     ; --------------------------------
(1)  518/     243 :                     ; Exit
(1)  519/     243 :                     ; --------------------------------
(1)  520/     243 :                     
(1)  521/     243 :                     .exit:
(1)  522/     243 : CD FD 02            		call	.inc_cpatt
(1)  523/     246 : FD 75 0C            		ld	(iy+trk_Read),l		; Update read location
(1)  524/     249 : FD 74 0D            		ld	(iy+((trk_Read+1))),h
(1)  525/     24C : 18 03               		jr	.decrow_e
(1)  526/     24E :                     .decrow:
(1)  527/     24E : FD 35 18            		dec	(iy+trk_rowPause)
(1)  528/     251 :                     .decrow_e:
(1)  529/     251 : CF                  		rst	8
(1)  530/     252 : 0B                  		dec	bc			; Decrement this row
(1)  531/     253 : FD 71 0E            		ld	(iy+trk_Rows),c		; And update it
(1)  532/     256 : FD 70 0F            		ld	(iy+(trk_Rows+1)),b
(1)  533/     259 : C9                  		ret
(1)  534/     25A :                     
(1)  535/     25A :                     ; --------------------------------
(1)  536/     25A :                     ; New note request
(1)  537/     25A :                     ; --------------------------------
(1)  538/     25A :                     
(1)  539/     25A :                     .has_note:
(1)  540/     25A : C5                  		push	bc		; Save rowcount
(1)  541/     25B : 4F                  		ld	c,a		; c - Copy of control+channel
(1)  542/     25C : CD FD 02            		call	.inc_cpatt
(1)  543/     25F : 79                  		ld	a,c
(1)  544/     260 : FD E5               		push	iy
(1)  545/     262 : DD E1               		pop	ix
(1)  546/     264 : 11 20 00            		ld	de,20h		; Point to track-data
(1)  547/     267 : DD 19               		add	ix,de
(1)  548/     269 : CF                  		rst	8
(1)  549/     26A : 16 00               		ld 	d,0
(1)  550/     26C : E6 3F               		and	00111111b
(1)  551/     26E : FD 46 16            		ld	b,(iy+trk_numChnls)
(1)  552/     271 : B8                  		cp	b
(1)  553/     272 : D2 F9 02            		jp	nc,.rnout_chnls
(1)  554/     275 : 87                  		add	a,a		; * 8
(1)  555/     276 : 87                  		add	a,a
(1)  556/     277 : 87                  		add	a,a
(1)  557/     278 : 5F                  		ld	e,a
(1)  558/     279 : DD 19               		add	ix,de
(1)  559/     27B : CF                  		rst	8
(1)  560/     27C : DD 46 06            		ld	b,(ix+chnl_Type); b - our current Note type
(1)  561/     27F : CB 71               		bit	6,c		; Next byte is new type?
(1)  562/     281 : 28 06               		jr	z,.old_type
(1)  563/     283 : 7E                  		ld	a,(hl)
(1)  564/     284 : DD 77 06            		ld	(ix+chnl_Type),a
(1)  565/     287 : 47                  		ld	b,a
(1)  566/     288 : 2C                  		inc 	l
(1)  567/     289 :                     .old_type:
(1)  568/     289 :                     	; b - evinEVIN
(1)  569/     289 :                     	;     E-effect/V-volume/I-instrument/N-note
(1)  570/     289 :                     	;     evin: byte is already stored on track-channel buffer
(1)  571/     289 :                     	;     EVIN: next byte(s) contain a new value, for eff:2 bytes
(1)  572/     289 : CF                  		rst	8
(1)  573/     28A : CB 40               		bit	0,b
(1)  574/     28C : 28 07               		jr	z,.no_note
(1)  575/     28E : 7E                  		ld	a,(hl)
(1)  576/     28F : DD 77 01            		ld	(ix+chnl_Note),a
(1)  577/     292 : CD FD 02            		call	.inc_cpatt
(1)  578/     295 :                     .no_note:
(1)  579/     295 : CB 48               		bit	1,b
(1)  580/     297 : 28 07               		jr	z,.no_ins
(1)  581/     299 : 7E                  		ld	a,(hl)
(1)  582/     29A : DD 77 02            		ld	(ix+chnl_Ins),a
(1)  583/     29D : CD FD 02            		call	.inc_cpatt
(1)  584/     2A0 :                     .no_ins:
(1)  585/     2A0 : CF                  		rst	8
(1)  586/     2A1 : CB 50               		bit	2,b
(1)  587/     2A3 : 28 07               		jr	z,.no_vol
(1)  588/     2A5 : 7E                  		ld	a,(hl)
(1)  589/     2A6 : DD 77 03            		ld	(ix+chnl_Vol),a
(1)  590/     2A9 : CD FD 02            		call	.inc_cpatt
(1)  591/     2AC :                     .no_vol:
(1)  592/     2AC : CB 58               		bit	3,b
(1)  593/     2AE : 28 0E               		jr	z,.no_eff
(1)  594/     2B0 : 7E                  		ld	a,(hl)
(1)  595/     2B1 : DD 77 04            		ld	(ix+chnl_EffId),a
(1)  596/     2B4 : CD FD 02            		call	.inc_cpatt
(1)  597/     2B7 : 7E                  		ld	a,(hl)
(1)  598/     2B8 : DD 77 05            		ld	(ix+chnl_EffArg),a
(1)  599/     2BB : CD FD 02            		call	.inc_cpatt
(1)  600/     2BE :                     .no_eff:
(1)  601/     2BE : CF                  		rst	8
(1)  602/     2BF : 78                  		ld	a,b		; Merge Impulse recycle bits to main bits
(1)  603/     2C0 : CB 3F               		srl	a
(1)  604/     2C2 : CB 3F               		srl	a
(1)  605/     2C4 : CB 3F               		srl	a
(1)  606/     2C6 : CB 3F               		srl	a
(1)  607/     2C8 : E6 0F               		and	00001111b
(1)  608/     2CA : 4F                  		ld	c,a
(1)  609/     2CB : CF                  		rst	8
(1)  610/     2CC : 78                  		ld	a,b
(1)  611/     2CD : E6 0F               		and	00001111b
(1)  612/     2CF : B1                  		or	c
(1)  613/     2D0 : 4F                  		ld	c,a
(1)  614/     2D1 : DD 7E 07            		ld	a,(ix+chnl_Flags)
(1)  615/     2D4 : B1                  		or	c
(1)  616/     2D5 : DD 77 07            		ld	(ix+chnl_Flags),a
(1)  617/     2D8 : CF                  		rst	8
(1)  618/     2D9 : C1                  		pop	bc			; Restore rowcount
(1)  619/     2DA :                     
(1)  620/     2DA :                     	; Check for effects that change things
(1)  621/     2DA :                     	; to internal playback (jump, tempo, etc.)
(1)  622/     2DA : E6 08               		and	1000b		; Filter EFFECT bit only
(1)  623/     2DC : B7                  		or	a
(1)  624/     2DD : CA 31 02            		jp	z,.next_note
(1)  625/     2E0 : DD 7E 04            		ld	a,(ix+chnl_EffId)
(1)  626/     2E3 : B7                  		or	a		; 00h = invalid effect
(1)  627/     2E4 : CA 31 02            		jp	z,.next_note
(1)  628/     2E7 : FE 01               		cp	1		; Effect A: Tick set
(1)  629/     2E9 : CC 49 03            		call	z,.eff_A
(1)  630/     2EC : FE 02               		cp	2		; Effect B: Position Jump
(1)  631/     2EE : CC 53 03            		call	z,.eff_B	; *** a is trashed after this
(1)  632/     2F1 : FE 03               		cp	3		; Effect C: Pattern break
(1)  633/     2F3 : CC 6D 03            		call	z,.eff_C
(1)  634/     2F6 : C3 31 02            		jp	.next_note
(1)  635/     2F9 :                     
(1)  636/     2F9 :                     .rnout_chnls:
(1)  637/     2F9 : C1                  		pop	bc
(1)  638/     2FA : C3 31 02            		jp	.next_note
(1)  639/     2FD :                     
(1)  640/     2FD :                     ; ----------------------------------------
(1)  641/     2FD :                     ; Call this to increment the
(1)  642/     2FD :                     ; cache pattern read pointer (iy+trk_Read)
(1)  643/     2FD :                     ; it also refills the next section to
(1)  644/     2FD :                     ; read if needed.
(1)  645/     2FD :                     ;
(1)  646/     2FD :                     ; NOTE: breaks A
(1)  647/     2FD :                     ; ----------------------------------------
(1)  648/     2FD :                     
(1)  649/     2FD :                     .inc_cpatt:
(1)  650/     2FD : 2C                  		inc	l
(1)  651/     2FE : FD 7E 13            		ld	a,(iy+trk_status)	; Increment-fill enabled?
(1)  652/     301 : E6 10               		and	00010000b
(1)  653/     303 : B7                  		or	a
(1)  654/     304 : C8                  		ret	z
(1)  655/     305 : CF                  		rst	8
(1)  656/     306 : FD 7E 10            		ld	a,(iy+trk_Halfway)
(1)  657/     309 : AD                  		xor	l
(1)  658/     30A : E6 80               		and	080h			; Check for 00h/80h
(1)  659/     30C : C8                  		ret	z
(1)  660/     30D : CF                  		rst	8
(1)  661/     30E : 3A 1C 00            		ld	a,(commZRomBlk)		; Got mid-DMA?
(1)  662/     311 : B7                  		or	a
(1)  663/     312 : 28 06               		jr	z,.grab_asap
(1)  664/     314 : 7D                  		ld	a,l			; Last chance
(1)  665/     315 : E6 7F               		and	07Fh
(1)  666/     317 : FE 70               		cp	070h
(1)  667/     319 : D8                  		ret	c
(1)  668/     31A :                     .grab_asap:
(1)  669/     31A : CD 94 14            		call	dac_fill		; refill request
(1)  670/     31D : FD 7E 10            		ld	a,(iy+trk_Halfway)	; +80h to halfway
(1)  671/     320 : 54                  		ld	d,h
(1)  672/     321 : 5F                  		ld	e,a
(1)  673/     322 : CF                  		rst	8
(1)  674/     323 : C6 80               		add 	a,080h
(1)  675/     325 : FD 77 10            		ld	(iy+trk_Halfway),a
(1)  676/     328 : E5                  		push	hl
(1)  677/     329 : C5                  		push	bc
(1)  678/     32A : 01 80 00            		ld	bc,80h			; 80h size + increment value
(1)  679/     32D : FD 6E 09            		ld	l,(iy+trk_romPattRd)
(1)  680/     330 : FD 66 0A            		ld	h,(iy+(trk_romPattRd+1))
(1)  681/     333 : CF                  		rst	8
(1)  682/     334 : FD 7E 0B            		ld	a,(iy+(trk_romPattRd+2))
(1)  683/     337 : 09                  		add	hl,bc
(1)  684/     338 : CE 00               		adc	a,0
(1)  685/     33A : FD 75 09            		ld	(iy+trk_romPattRd),l
(1)  686/     33D : FD 74 0A            		ld	(iy+(trk_romPattRd+1)),h
(1)  687/     340 : FD 77 0B            		ld	(iy+(trk_romPattRd+2)),a
(1)  688/     343 : CD 3A 10            		call	transferRom
(1)  689/     346 : C1                  		pop	bc
(1)  690/     347 : E1                  		pop	hl
(1)  691/     348 : C9                  		ret
(1)  692/     349 :                     
(1)  693/     349 :                     ; ----------------------------------------
(1)  694/     349 :                     ; Effect A: Set ticks
(1)  695/     349 :                     ; ----------------------------------------
(1)  696/     349 :                     
(1)  697/     349 :                     .eff_A:
(1)  698/     349 : DD 5E 05            		ld	e,(ix+chnl_EffArg)	; e - ticks number
(1)  699/     34C : FD 73 15            		ld	(iy+trk_tickSet),e	; set for both Set and Timer.
(1)  700/     34F : FD 73 14            		ld	(iy+trk_tickTmr),e
(1)  701/     352 : C9                  		ret
(1)  702/     353 :                     
(1)  703/     353 :                     ; ----------------------------------------
(1)  704/     353 :                     ; Effect B: jump to a new block
(1)  705/     353 :                     ; ----------------------------------------
(1)  706/     353 :                     
(1)  707/     353 :                     .eff_B:
(1)  708/     353 : F5                  		push	af
(1)  709/     354 : DD 5E 05            		ld	e,(ix+chnl_EffArg)	; e - Block SLOT to jump
(1)  710/     357 : FD 73 11            		ld 	(iy+trk_currBlk),e
(1)  711/     35A : CF                  		rst	8
(1)  712/     35B :                     ; 		ld	e,(iy+trk_tickSet)	; Reset our Tick timer
(1)  713/     35B :                     ; 		ld	(iy+trk_tickTmr),e
(1)  714/     35B : FD 36 18 00         		ld	(iy+trk_rowPause),0	; Reset rowpause
(1)  715/     35F : DD 36 04 00         		ld	(ix+chnl_EffId),0	; (failsafe)
(1)  716/     363 : DD 36 05 00         		ld	(ix+chnl_EffArg),0
(1)  717/     367 : FD CB 13 EE         		set	5,(iy+trk_status)	; set fill-from-effect flag on exit
(1)  718/     36B : F1                  		pop	af
(1)  719/     36C : C9                  		ret
(1)  720/     36D :                     
(1)  721/     36D :                     ; ----------------------------------------
(1)  722/     36D :                     ; Effect C: Pattern break/exit (custom)
(1)  723/     36D :                     ; ***Not exactly as in Impulse but
(1)  724/     36D :                     ; moves to the next block
(1)  725/     36D :                     ;
(1)  726/     36D :                     ; If set to -1 it will end the track,
(1)  727/     36D :                     ; so you can put multiple SFX into the
(1)  728/     36D :                     ; track file and call them by block.
(1)  729/     36D :                     ;
(1)  730/     36D :                     ; USE THE EFFECT ONLY
(1)  731/     36D :                     ; ----------------------------------------
(1)  732/     36D :                     
(1)  733/     36D :                     .eff_C:
(1)  734/     36D : 01 00 00            		ld	bc,0			; clear rowcount
(1)  735/     370 : DD 7E 05            		ld	a,(ix+chnl_EffArg)	; Arg is 0FFh?
(1)  736/     373 : FE FF               		cp	-1			; Use it as track-end (for SFX)
(1)  737/     375 : CA 94 04            		jp	z,.trkend_effC
(1)  738/     378 :                     
(1)  739/     378 :                     ; ----------------------------------------
(1)  740/     378 :                     ; If pattern finished, load the next one
(1)  741/     378 :                     ; ----------------------------------------
(1)  742/     378 :                     
(1)  743/     378 :                     .next_track:
(1)  744/     378 : FD 7E 11            		ld	a,(iy+trk_currBlk)	; Increment next block
(1)  745/     37B : 3C                  		inc	a
(1)  746/     37C : FD 77 11            		ld 	(iy+trk_currBlk),a
(1)  747/     37F :                     
(1)  748/     37F :                     ; Load track data to cache
(1)  749/     37F :                     ; a - Block
(1)  750/     37F :                     ;
(1)  751/     37F :                     ; hl - trk_read on halfway
(1)  752/     37F :                     .set_track:
(1)  753/     37F : CF                  		rst	8
(1)  754/     380 : FD 36 10 80         		ld	(iy+trk_Halfway),80h	; Reset halfway
(1)  755/     384 :                     ; 		ld	l,(iy+trk_CachNotes)	; Set trk_read point on halfway
(1)  756/     384 :                     ; 		ld	h,(iy+(trk_CachNotes+1))
(1)  757/     384 :                     ; 		ld	de,80h
(1)  758/     384 :                     ; 		add	hl,de
(1)  759/     384 : 2E 00               		ld	l,0			; quick reset trk_read
(1)  760/     386 : FD 75 0C            		ld	(iy+trk_Read),l
(1)  761/     389 : FD 74 0D            		ld	(iy+((trk_Read+1))),h
(1)  762/     38C :                     
(1)  763/     38C : E5                  		push	hl			; Save hl
(1)  764/     38D : 11 00 00            		ld	de,0
(1)  765/     390 : 5F                  		ld	e,a
(1)  766/     391 : CF                  		rst	8
(1)  767/     392 : FD 6E 00            		ld	l,(iy+trk_romBlk)	; Get block position
(1)  768/     395 : FD 66 01            		ld	h,(iy+(trk_romBlk+1))	; directly from ROM
(1)  769/     398 : FD 7E 02            		ld	a,(iy+(trk_romBlk+2))
(1)  770/     39B : 19                  		add	hl,de
(1)  771/     39C : CE 00               		adc	a,0
(1)  772/     39E : 47                  		ld	b,a
(1)  773/     39F : CF                  		rst	8
(1)  774/     3A0 : CD EC 0F            		call	showRom
(1)  775/     3A3 : CD 0D 10            		call	readRomB
(1)  776/     3A6 : FE FF               		cp	-1			; if block == -1, end
(1)  777/     3A8 : CA 93 04            		jp	z,.track_end
(1)  778/     3AB :                     
(1)  779/     3AB :                     	; a - head index
(1)  780/     3AB : 87                  		add	a,a
(1)  781/     3AC : 87                  		add	a,a
(1)  782/     3AD : 16 00               		ld	d,0
(1)  783/     3AF : 5F                  		ld	e,a
(1)  784/     3B0 : FD 6E 03            		ld	l,(iy+trk_romPatt)
(1)  785/     3B3 : CF                  		rst	8
(1)  786/     3B4 : FD 66 04            		ld	h,(iy+(trk_romPatt+1))
(1)  787/     3B7 : FD 7E 05            		ld	a,(iy+(trk_romPatt+2))
(1)  788/     3BA : 19                  		add	hl,de
(1)  789/     3BB : CE 00               		adc	a,0
(1)  790/     3BD : 11 FA 1E            		ld	de,trkHdOut
(1)  791/     3C0 : D5                  		push	de
(1)  792/     3C1 : 01 06 00            		ld	bc,6			; thispoint, rowcount, nextpoint
(1)  793/     3C4 : CD 3A 10            		call	transferRom
(1)  794/     3C7 : E1                  		pop	hl
(1)  795/     3C8 : 5E                  		ld	e,(hl)			; de - pointer increment
(1)  796/     3C9 : 23                  		inc	hl
(1)  797/     3CA : 56                  		ld	d,(hl)
(1)  798/     3CB : 23                  		inc	hl
(1)  799/     3CC : 4E                  		ld	c,(hl)			; bc - row count
(1)  800/     3CD : 23                  		inc	hl
(1)  801/     3CE : 46                  		ld	b,(hl)
(1)  802/     3CF : CF                  		rst	8
(1)  803/     3D0 : FD 71 0E            		ld	(iy+trk_Rows),c		; Save this number of rows to buffer
(1)  804/     3D3 : FD 70 0F            		ld	(iy+(trk_Rows+1)),b	; on Tick pauses
(1)  805/     3D6 : C5                  		push	bc			; Save bc
(1)  806/     3D7 : CD 94 14            		call	dac_fill
(1)  807/     3DA :                     
(1)  808/     3DA :                     	; Detect pattern size... last moment addition
(1)  809/     3DA :                     	; for patterns lower than 80h.
(1)  810/     3DA :                     	; This saves cycles if using SFX
(1)  811/     3DA :                     	; hl - next pattern point (includes final)
(1)  812/     3DA :                     	; de - this pattern
(1)  813/     3DA :                     	; bc - final size for transferRom
(1)  814/     3DA : 3A FE 1E            		ld	a,(trkHdOut+4)	; hl - de
(1)  815/     3DD : 6F                  		ld	l,a
(1)  816/     3DE : 3A FF 1E            		ld	a,(trkHdOut+5)
(1)  817/     3E1 : 67                  		ld	h,a
(1)  818/     3E2 : 3F                  		ccf			; remove carry first
(1)  819/     3E3 : ED 52               		sbc	hl,de
(1)  820/     3E5 : FD 4E 13            		ld	c,(iy+trk_status)
(1)  821/     3E8 : CB A1               		res	4,c
(1)  822/     3EA : 7C                  		ld	a,h		; h == 0?
(1)  823/     3EB : B7                  		or	a
(1)  824/     3EC :                     ; 		jp	m,$
(1)  825/     3EC : 20 04               		jr	nz,.szmuch
(1)  826/     3EE : CB 7D               		bit	7,l
(1)  827/     3F0 : 28 05               		jr	z,.szgood
(1)  828/     3F2 :                     .szmuch:
(1)  829/     3F2 : 21 80 00            		ld	hl,080h			; bc - max transfer size 080h
(1)  830/     3F5 : CB E1               		set	4,c
(1)  831/     3F7 :                     .szgood:
(1)  832/     3F7 : FD 71 13            		ld	(iy+trk_status),c
(1)  833/     3FA : 44                  		ld	b,h
(1)  834/     3FB : 4D                  		ld	c,l
(1)  835/     3FC : FD 6E 03            		ld	l,(iy+trk_romPatt)	; hl - ROM pattern data pointer
(1)  836/     3FF : FD 66 04            		ld	h,(iy+(trk_romPatt+1))
(1)  837/     402 : FD 7E 05            		ld	a,(iy+(trk_romPatt+2))
(1)  838/     405 : 19                  		add	hl,de			; hl + de
(1)  839/     406 : CE 00               		adc	a,0			; and highest byte too.
(1)  840/     408 : CF                  		rst	8
(1)  841/     409 : FD 75 09            		ld	(iy+trk_romPattRd),l	; Save copy of the pointer for READ
(1)  842/     40C : FD 74 0A            		ld	(iy+(trk_romPattRd+1)),h
(1)  843/     40F : FD 77 0B            		ld	(iy+(trk_romPattRd+2)),a
(1)  844/     412 : FD 56 0D            		ld	d,(iy+(trk_Read+1))	; de - destination to data CACHE
(1)  845/     415 : FD 5E 0C            		ld	e,(iy+trk_Read)
(1)  846/     418 :                     ; 		ld	bc,080h			; bc - 080h
(1)  847/     418 : CD 3A 10            		call	transferRom
(1)  848/     41B : CF                  		rst	8
(1)  849/     41C : C1                  		pop	bc			; Get bc back
(1)  850/     41D : E1                  		pop	hl			; hl too.
(1)  851/     41E : AF                  		xor	a			; return 0
(1)  852/     41F : C9                  		ret
(1)  853/     420 :                     
(1)  854/     420 :                     ; ----------------------------------------
(1)  855/     420 :                     ; First time playing or moving
(1)  856/     420 :                     ; to next track.
(1)  857/     420 :                     ; ----------------------------------------
(1)  858/     420 :                     
(1)  859/     420 :                     .effect_fill:
(1)  860/     420 : CD 94 14            		call	dac_fill
(1)  861/     423 : CB A8               		res	5,b			; Reset refill-from-effect flag
(1)  862/     425 : FD 70 13            		ld	(iy+trk_status),b
(1)  863/     428 : CD 66 04            		call	.go_effect
(1)  864/     42B : C9                  		ret
(1)  865/     42C :                     
(1)  866/     42C :                     ; returns bc as row counter
(1)  867/     42C :                     .first_fill:
(1)  868/     42C : CD 94 14            		call	dac_fill
(1)  869/     42F : CB B0               		res	6,b			; Reset FILL flag
(1)  870/     431 : FD 70 13            		ld	(iy+trk_status),b
(1)  871/     434 : FD E5               		push	iy
(1)  872/     436 : DD E1               		pop	ix			; copy iy to ix
(1)  873/     438 : 11 20 00            		ld	de,20h			; go to channel data
(1)  874/     43B : DD 19               		add	ix,de
(1)  875/     43D : CF                  		rst	8
(1)  876/     43E : 01 00 00            		ld	bc,0
(1)  877/     441 : 11 08 00            		ld	de,8
(1)  878/     444 : 06 12               		ld	b,MAX_TRKCHN
(1)  879/     446 :                     .clrf:
(1)  880/     446 : D5                  		push	de
(1)  881/     447 : C5                  		push	bc
(1)  882/     448 : CF                  		rst	8
(1)  883/     449 : CD DE 04            		call	trkout_unlk		; search and unlink last used channels
(1)  884/     44C : DD 36 02 00         		ld	(ix+chnl_Ins),0
(1)  885/     450 :                     ; 		ld	(ix+chnl_Note),-2
(1)  886/     450 :                     ; 		ld	(ix+chnl_Flags),1
(1)  887/     450 : CF                  		rst	8
(1)  888/     451 : C1                  		pop	bc
(1)  889/     452 : D1                  		pop	de
(1)  890/     453 :                     .dntslnce:
(1)  891/     453 : DD 19               		add	ix,de
(1)  892/     455 : 10 EF               		djnz	.clrf
(1)  893/     457 : 3E 01               		ld	a,1			; Request chip cleanup
(1)  894/     459 : 32 F9 1E            		ld	(flagResChip),a
(1)  895/     45C : FD 36 18 00         		ld	(iy+trk_rowPause),0	; Reset row timer
(1)  896/     460 : FD 7E 12            		ld	a,(iy+trk_setBlk)	; Set current block
(1)  897/     463 : FD 77 11            		ld 	(iy+trk_currBlk),a
(1)  898/     466 :                     
(1)  899/     466 :                     .go_effect:
(1)  900/     466 : CF                  		rst	8			; First cache fills
(1)  901/     467 : FD 6E 06            		ld	l,(iy+trk_romIns)	; Recieve almost 100h of instrument pointers
(1)  902/     46A : FD 66 07            		ld	h,(iy+(trk_romIns+1))	; NOTE: transferRom can't do 100h
(1)  903/     46D : FD 7E 08            		ld	a,(iy+(trk_romIns+2))
(1)  904/     470 : ED 5B C3 19         		ld	de,(currInsData)
(1)  905/     474 : 06 00               		ld	b,0
(1)  906/     476 : FD 4E 17            		ld	c,(iy+trk_sizeIns)
(1)  907/     479 : CD 3A 10            		call	transferRom
(1)  908/     47C : CF                  		rst	8
(1)  909/     47D :                     ; 		ld	e,(iy+trk_CachHeads)	; de - Cache headers
(1)  910/     47D :                     ; 		ld	d,(iy+(trk_CachHeads+1))
(1)  911/     47D :                     ; 		ld	l,(iy+trk_romPatt)	; hl - ROM pattern data BASE
(1)  912/     47D :                     ; 		ld	h,(iy+(trk_romPatt+1))
(1)  913/     47D :                     ; 		ld	a,(iy+(trk_romPatt+2))
(1)  914/     47D :                     ; 		ld	bc,MAX_TRKHEADS
(1)  915/     47D :                     ; 		call	transferRom
(1)  916/     47D : FD 6E 1A            		ld	l,(iy+trk_CachNotes)	; Read first cache notes
(1)  917/     480 : FD 66 1B            		ld	h,(iy+(trk_CachNotes+1))
(1)  918/     483 : 11 80 00            		ld	de,80h
(1)  919/     486 : 19                  		add	hl,de
(1)  920/     487 : FD 75 0C            		ld	(iy+trk_Read),l
(1)  921/     48A : FD 74 0D            		ld	(iy+((trk_Read+1))),h
(1)  922/     48D :                     ; 		call	dac_fill
(1)  923/     48D : FD 7E 11            		ld	a,(iy+trk_currBlk)
(1)  924/     490 : C3 7F 03            		jp	.set_track
(1)  925/     493 :                     
(1)  926/     493 :                     ; If -1, track ends
(1)  927/     493 :                     ; Automutes channels too.
(1)  928/     493 :                     .track_end:
(1)  929/     493 : E1                  		pop	hl			; Get hl back
(1)  930/     494 :                     .trkend_effC:
(1)  931/     494 : CD AA 04            		call	track_out
(1)  932/     497 : CF                  		rst	8
(1)  933/     498 : FD 36 13 00         		ld	(iy+trk_status),0	; Track status
(1)  934/     49C : FD 36 18 00         		ld	(iy+trk_rowPause),0
(1)  935/     4A0 : FD 36 14 00         		ld	(iy+trk_tickTmr),0
(1)  936/     4A4 : 01 00 00            		ld	bc,0			; Set bc rowcount to 0
(1)  937/     4A7 : 3E FF               		ld	a,-1			; Return -1
(1)  938/     4A9 : C9                  		ret
(1)  939/     4AA :                     
(1)  940/     4AA :                     ; ----------------------------------------
(1)  941/     4AA :                     ; Delete all track data
(1)  942/     4AA :                     ; ----------------------------------------
(1)  943/     4AA :                     
(1)  944/     4AA :                     track_out:
(1)  945/     4AA : FD E5               		push	iy
(1)  946/     4AC : DD E1               		pop	ix
(1)  947/     4AE : 11 20 00            		ld	de,20h
(1)  948/     4B1 : DD 19               		add	ix,de
(1)  949/     4B3 : CF                  		rst	8
(1)  950/     4B4 : 11 08 00            		ld	de,8
(1)  951/     4B7 : 06 12               		ld	b,MAX_TRKCHN
(1)  952/     4B9 :                     .clrfe:
(1)  953/     4B9 : D5                  		push	de
(1)  954/     4BA : C5                  		push	bc
(1)  955/     4BB : CD DE 04            		call	trkout_unlk
(1)  956/     4BE : DD 7E 00            		ld	a,(ix+chnl_Chip)
(1)  957/     4C1 : B7                  		or	a
(1)  958/     4C2 : 28 0E               		jr	z,.nochip
(1)  959/     4C4 : DD 36 01 FE         		ld	(ix+chnl_Note),-2
(1)  960/     4C8 : DD 7E 07            		ld	a,(ix+chnl_Flags)
(1)  961/     4CB : E6 F0               		and	11110000b
(1)  962/     4CD : F6 01               		or	1
(1)  963/     4CF : DD 77 07            		ld	(ix+chnl_Flags),a
(1)  964/     4D2 :                     .nochip:
(1)  965/     4D2 : C1                  		pop	bc
(1)  966/     4D3 : D1                  		pop	de
(1)  967/     4D4 : DD 19               		add	ix,de
(1)  968/     4D6 : 10 E1               		djnz	.clrfe
(1)  969/     4D8 : 3E 01               		ld	a,1			; Request chip cleanup
(1)  970/     4DA : 32 F9 1E            		ld	(flagResChip),a
(1)  971/     4DD : C9                  		ret
(1)  972/     4DE :                     
(1)  973/     4DE :                     ; ----------------------------------------
(1)  974/     4DE :                     ; Unlink current channel
(1)  975/     4DE :                     ; ----------------------------------------
(1)  976/     4DE :                     
(1)  977/     4DE :                     trkout_unlk:
(1)  978/     4DE : DD 7E 00            		ld	a,(ix+chnl_Chip)
(1)  979/     4E1 : B7                  		or	a
(1)  980/     4E2 : C8                  		ret	z
(1)  981/     4E3 : F0                  		ret	p
(1)  982/     4E4 : DD E5               		push	ix
(1)  983/     4E6 : D1                  		pop	de
(1)  984/     4E7 : 4F                  		ld	c,a
(1)  985/     4E8 : E6 F0               		and	11110000b
(1)  986/     4EA : FE 80               		cp	80h
(1)  987/     4EC : 28 15               		jr	z,.is_psg
(1)  988/     4EE : FE 90               		cp	90h
(1)  989/     4F0 : 28 22               		jr	z,.is_psgn
(1)  990/     4F2 : FE A0               		cp	0A0h		;
(1)  991/     4F4 : 28 39               		jr	z,.is_fm
(1)  992/     4F6 : FE B0               		cp	0B0h		; For FM3 special
(1)  993/     4F8 : 28 35               		jr	z,.is_fm
(1)  994/     4FA : FE C0               		cp	0C0h		; For FM6 DAC
(1)  995/     4FC : 28 31               		jr	z,.is_fm
(1)  996/     4FE : FE D0               		cp	0D0h		; For PWM
(1)  997/     500 : 28 28               		jr	z,.is_pwm
(1)  998/     502 : C9                  		ret
(1)  999/     503 :                     ; PSG/PSGN
(1) 1000/     503 :                     .is_psg:
(1) 1001/     503 : 06 00               		ld	b,0
(1) 1002/     505 : 79                  		ld	a,c
(1) 1003/     506 : E6 03               		and	011b
(1) 1004/     508 : 21 DC 19            		ld	hl,tblPSG
(1) 1005/     50B : CF                  		rst	8
(1) 1006/     50C : 87                  		add	a,a		; *08h
(1) 1007/     50D : 87                  		add	a,a
(1) 1008/     50E : 87                  		add	a,a
(1) 1009/     50F : 4F                  		ld	c,a
(1) 1010/     510 : CF                  		rst	8
(1) 1011/     511 : 09                  		add	hl,bc
(1) 1012/     512 : 18 03               		jr	.ispsg_c
(1) 1013/     514 :                     .is_psgn:
(1) 1014/     514 : 21 F6 19            		ld	hl,tblPSGN
(1) 1015/     517 :                     .ispsg_c:
(1) 1016/     517 : 7E                  		ld	a,(hl)
(1) 1017/     518 : BB                  		cp	e
(1) 1018/     519 : C0                  		ret	nz
(1) 1019/     51A : CF                  		rst	8
(1) 1020/     51B : 23                  		inc	hl
(1) 1021/     51C : 7E                  		ld	a,(hl)
(1) 1022/     51D : BA                  		cp	d
(1) 1023/     51E : C0                  		ret	nz
(1) 1024/     51F : 36 00               		ld	(hl),0
(1) 1025/     521 : 2B                  		dec	hl
(1) 1026/     522 : 36 00               		ld	(hl),0
(1) 1027/     524 : 79                  		ld	a,c
(1) 1028/     525 : FE 90               		cp	90h
(1) 1029/     527 : C8                  		ret	z
(1) 1030/     528 : CF                  		rst	8
(1) 1031/     529 : C9                  		ret
(1) 1032/     52A :                     ; FM
(1) 1033/     52A :                     .is_pwm:
(1) 1034/     52A : 21 30 1A            		ld	hl,tblPWM
(1) 1035/     52D : 18 03               		jr	.tlb_cont
(1) 1036/     52F :                     .is_fm:
(1) 1037/     52F : 21 FE 19            		ld	hl,tblFM
(1) 1038/     532 :                     .tlb_cont:
(1) 1039/     532 : 79                  		ld	a,c
(1) 1040/     533 : E6 07               		and	000111b
(1) 1041/     535 : CF                  		rst	8
(1) 1042/     536 : 87                  		add	a,a		; *08h
(1) 1043/     537 : 87                  		add	a,a
(1) 1044/     538 : 87                  		add	a,a
(1) 1045/     539 : 06 00               		ld	b,0
(1) 1046/     53B : 4F                  		ld	c,a
(1) 1047/     53C : CF                  		rst	8
(1) 1048/     53D : 09                  		add	hl,bc
(1) 1049/     53E : 7E                  		ld	a,(hl)
(1) 1050/     53F : BB                  		cp	e
(1) 1051/     540 : C0                  		ret	nz
(1) 1052/     541 : CF                  		rst	8
(1) 1053/     542 : 23                  		inc	hl
(1) 1054/     543 : 7E                  		ld	a,(hl)
(1) 1055/     544 : BA                  		cp	d
(1) 1056/     545 : C0                  		ret	nz
(1) 1057/     546 : 36 00               		ld	(hl),0
(1) 1058/     548 : 2B                  		dec	hl
(1) 1059/     549 : 36 00               		ld	(hl),0
(1) 1060/     54B : C9                  		ret
(1) 1061/     54C :                     
(1) 1062/     54C :                     ; --------------------------------------------------------
(1) 1063/     54C :                     ; ** 32X ONLY ***
(1) 1064/     54C :                     ; Communicate to Slave SH2 to play
(1) 1065/     54C :                     ; PWM sound channels
(1) 1066/     54C :                     ; --------------------------------------------------------
(1) 1067/     54C :                     
(1) 1068/     54C :                     mars_scomm:
(1) 1069/     54C : 21 00 60            		ld	hl,6000h	; Point BANK closely
(1) 1070/     54F : CF                  		rst	8		; to the 32X area
(1) 1071/     550 : 36 00               		ld	(hl),0
(1) 1072/     552 : 36 01               		ld	(hl),1
(1) 1073/     554 : 36 00               		ld	(hl),0
(1) 1074/     556 : 36 00               		ld	(hl),0
(1) 1075/     558 : CF                  		rst	8
(1) 1076/     559 : 36 00               		ld	(hl),0
(1) 1077/     55B : 36 00               		ld	(hl),0
(1) 1078/     55D : 36 01               		ld	(hl),1
(1) 1079/     55F : 36 00               		ld	(hl),0
(1) 1080/     561 : 36 01               		ld	(hl),1
(1) 1081/     563 : CF                  		rst	8
(1) 1082/     564 : FD 21 00 D1         		ld	iy,5100h|8000h	; iy - mars sysreg
(1) 1083/     568 : DD 21 6A 1A         		ld	ix,pwmcom
(1) 1084/     56C : 3A 20 00            		ld	a,(marsBlock)	; block MARS requests?
(1) 1085/     56F : B7                  		or	a
(1) 1086/     570 : 20 53               		jr	nz,.blocked
(1) 1087/     572 : 3A CC 19            		ld	a,(marsUpd)	; update?
(1) 1088/     575 : B7                  		or	a
(1) 1089/     576 : C8                  		ret	z
(1) 1090/     577 : CF                  		rst	8
(1) 1091/     578 : AF                  		xor	a
(1) 1092/     579 : 32 CC 19            		ld	(marsUpd),a
(1) 1093/     57C :                     .wait_enter:
(1) 1094/     57C : 00                  		nop
(1) 1095/     57D : FD 7E 2F            		ld	a,(iy+comm15)	; check if we got mid-process
(1) 1096/     580 : E6 B0               		and	10110000b
(1) 1097/     582 : B7                  		or	a
(1) 1098/     583 : 20 F7               		jr	nz,.wait_enter
(1) 1099/     585 : CB FF               		set	7,a
(1) 1100/     587 : FD 77 2F            		ld	(iy+comm15),a
(1) 1101/     58A : 00                  		nop
(1) 1102/     58B : 00                  		nop
(1) 1103/     58C :                     .wait_other:
(1) 1104/     58C : 00                  		nop
(1) 1105/     58D : FD 7E 2F            		ld	a,(iy+comm15)
(1) 1106/     590 : E6 30               		and	00110000b
(1) 1107/     592 : B7                  		or	a
(1) 1108/     593 : 20 F7               		jr	nz,.wait_other
(1) 1109/     595 : 0E 04               		ld	c,4		; c - Passes
(1) 1110/     597 :                     .next_pass:
(1) 1111/     597 : FD E5               		push	iy
(1) 1112/     599 : E1                  		pop	hl
(1) 1113/     59A : CF                  		rst	8
(1) 1114/     59B : 11 20 00            		ld	de,comm0
(1) 1115/     59E : 19                  		add	hl,de
(1) 1116/     59F : 06 07               		ld	b,7
(1) 1117/     5A1 :                     .next_comm:
(1) 1118/     5A1 : DD 56 00            		ld	d,(ix)
(1) 1119/     5A4 : DD 5E 01            		ld	e,(ix+1)
(1) 1120/     5A7 : DD 23               		inc	ix
(1) 1121/     5A9 : DD 23               		inc	ix
(1) 1122/     5AB : CF                  		rst	8
(1) 1123/     5AC : 72                  		ld	(hl),d
(1) 1124/     5AD : 23                  		inc	hl
(1) 1125/     5AE : 73                  		ld	(hl),e
(1) 1126/     5AF : 23                  		inc	hl
(1) 1127/     5B0 : 10 EF               		djnz	.next_comm
(1) 1128/     5B2 : FD 7E 2F            		ld	a,(iy+comm15)	; Send CLK to Slave CMD
(1) 1129/     5B5 : CB F7               		set	6,a
(1) 1130/     5B7 : FD 77 2F            		ld	(iy+comm15),a
(1) 1131/     5BA : CF                  		rst	8
(1) 1132/     5BB :                     .w_pass2:
(1) 1133/     5BB : FD 7E 2F            		ld	a,(iy+comm15)	; CLK cleared?
(1) 1134/     5BE : CB 77               		bit	6,a
(1) 1135/     5C0 : 20 F9               		jr	nz,.w_pass2
(1) 1136/     5C2 : 0D                  		dec	c
(1) 1137/     5C3 : 20 D2               		jr	nz,.next_pass
(1) 1138/     5C5 :                     
(1) 1139/     5C5 :                     ; clear COM bits
(1) 1140/     5C5 :                     .blocked:
(1) 1141/     5C5 : 21 6A 1A            		ld	hl,pwmcom
(1) 1142/     5C8 : 06 07               		ld	b,7
(1) 1143/     5CA :                     .clrcom:
(1) 1144/     5CA : 36 00               		ld	(hl),0
(1) 1145/     5CC : 23                  		inc	hl
(1) 1146/     5CD : 10 FB               		djnz	.clrcom
(1) 1147/     5CF : C9                  		ret
(1) 1148/     5D0 :                     
(1) 1149/     5D0 :                     ; --------------------------------------------------------
(1) 1150/     5D0 :                     ; Set and play instruments in their respective channels
(1) 1151/     5D0 :                     ; --------------------------------------------------------
(1) 1152/     5D0 :                     
(1) 1153/     5D0 :                     setupchip:
(1) 1154/     5D0 : 21 C1 18            		ld	hl,insDataC_0
(1) 1155/     5D3 : FD 21 00 1E         		ld	iy,trkBuff_0		; iy - Tracker channels
(1) 1156/     5D7 : CD 2A 06            		call	.mk_chip
(1) 1157/     5DA : 21 41 19            		ld	hl,insDataC_1
(1) 1158/     5DD : FD 21 00 1F         		ld	iy,trkBuff_1
(1) 1159/     5E1 : CD 2A 06            		call	.mk_chip
(1) 1160/     5E4 :                     
(1) 1161/     5E4 :                     	; Check if there's floating
(1) 1162/     5E4 :                     	; channels to auto-mute by request
(1) 1163/     5E4 : 3A F9 1E            		ld	a,(flagResChip)
(1) 1164/     5E7 : B7                  		or	a
(1) 1165/     5E8 : C8                  		ret	z
(1) 1166/     5E9 : AF                  		xor	a
(1) 1167/     5EA : 32 F9 1E            		ld	(flagResChip),a
(1) 1168/     5ED : FD 21 30 1A         		ld	iy,tblPWM	; 32X only
(1) 1169/     5F1 : DD 21 6A 1A         		ld	ix,pwmcom
(1) 1170/     5F5 :                     ; 		ld	b,0D0h
(1) 1171/     5F5 : CD 76 06            		call	.silnc_list
(1) 1172/     5F8 : 3E 01               		ld	a,1
(1) 1173/     5FA : CF                  		rst	8
(1) 1174/     5FB : 32 CC 19            		ld	(marsUpd),a
(1) 1175/     5FE : FD 21 26 1A         		ld	iy,tblFM6
(1) 1176/     602 : DD 21 BC 18         		ld	ix,daccom
(1) 1177/     606 :                     ; 		ld	b,0C0h
(1) 1178/     606 : CD 4F 06            		call	.silnc_singl
(1) 1179/     609 : FD 21 F6 19         		ld	iy,tblPSGN
(1) 1180/     60D : DD 21 6B 17         		ld	ix,psgcom+3
(1) 1181/     611 :                     ; 		ld	b,90h
(1) 1182/     611 : CD 4F 06            		call	.silnc_singl
(1) 1183/     614 : CF                  		rst	8
(1) 1184/     615 : FD 21 FE 19         		ld	iy,tblFM	; silence floating channels
(1) 1185/     619 : DD 21 9C 17         		ld	ix,fmcom	; includes FM3 special
(1) 1186/     61D :                     ; 		ld	b,0A0h
(1) 1187/     61D : CD 76 06            		call	.silnc_list
(1) 1188/     620 : FD 21 DC 19         		ld	iy,tblPSG
(1) 1189/     624 : DD 21 68 17         		ld	ix,psgcom
(1) 1190/     628 :                     ; 		ld	b,080h
(1) 1191/     628 : 18 4C               		jr	.silnc_list
(1) 1192/     62A :                     .mk_chip:
(1) 1193/     62A : FD 7E 13            		ld	a,(iy+trk_status)
(1) 1194/     62D : B7                  		or	a
(1) 1195/     62E : F0                  		ret	p
(1) 1196/     62F : 22 C3 19            		ld	(currInsData),hl
(1) 1197/     632 : FD 22 C9 19         		ld	(currTrkCtrl),iy
(1) 1198/     636 :                     ; 		rst	8
(1) 1199/     636 : 11 20 00            		ld	de,20h
(1) 1200/     639 : FD 19               		add	iy,de
(1) 1201/     63B : 06 12               		ld	b,MAX_TRKCHN
(1) 1202/     63D :                     .nxt_chnl:
(1) 1203/     63D : FD 7E 07            		ld	a,(iy+chnl_Flags)	; Get status bits
(1) 1204/     640 : E6 0F               		and	00001111b
(1) 1205/     642 : B7                  		or	a			; Check for non-zero
(1) 1206/     643 : C4 AE 06            		call	nz,.do_chnl
(1) 1207/     646 : CF                  		rst	8
(1) 1208/     647 : 11 08 00            		ld	de,8			; Next CHANNEL
(1) 1209/     64A : FD 19               		add	iy,de
(1) 1210/     64C : 10 EF               		djnz	.nxt_chnl
(1) 1211/     64E : C9                  		ret
(1) 1212/     64F :                     
(1) 1213/     64F :                     ; ----------------------------------------
(1) 1214/     64F :                     ; iy - table
(1) 1215/     64F :                     ; ix - chip com port
(1) 1216/     64F :                     ;  b - target ID
(1) 1217/     64F :                     ;  c - ignore ID
(1) 1218/     64F :                     .silnc_singl:
(1) 1219/     64F : FD 7E 01            		ld	a,(iy+1)	; Get link MSB
(1) 1220/     652 : CF                  		rst	8
(1) 1221/     653 : 67                  		ld	h,a		; hl - link
(1) 1222/     654 : FD 6E 00            		ld	l,(iy)
(1) 1223/     657 : 7E                  		ld	a,(hl)		; *** DIRECT chnl_Chip
(1) 1224/     658 : 5F                  		ld	e,a
(1) 1225/     659 : B7                  		or	a
(1) 1226/     65A : 28 06               		jr	z,.fltin_s
(1) 1227/     65C : CF                  		rst	8
(1) 1228/     65D : 7B                  		ld	a,e
(1) 1229/     65E : E6 F0               		and	11110000b
(1) 1230/     660 : B8                  		cp	b
(1) 1231/     661 : C0                  		ret 	nz
(1) 1232/     662 :                     .fltin_s:
(1) 1233/     662 : DD E5               		push	ix
(1) 1234/     664 : E1                  		pop	hl
(1) 1235/     665 : 19                  		add	hl,de
(1) 1236/     666 : 7E                  		ld	a,(hl)		; already set?
(1) 1237/     667 : E6 07               		and	0111b
(1) 1238/     669 : B7                  		or	a
(1) 1239/     66A : C0                  		ret	nz
(1) 1240/     66B : 36 04               		ld	(hl),100b
(1) 1241/     66D : FD 36 00 00         		ld	(iy),0
(1) 1242/     671 : FD 36 01 00         		ld	(iy+1),0
(1) 1243/     675 :                     ; 		ld	(iy+3),0
(1) 1244/     675 :                     ; 		ld	(iy+4),0
(1) 1245/     675 :                     ; 		ld	(iy+5),0
(1) 1246/     675 :                     ; 		ld	(iy+6),0
(1) 1247/     675 :                     ; 		ld	(iy+7),0
(1) 1248/     675 : C9                  		ret
(1) 1249/     676 :                     .silnc_list:
(1) 1250/     676 : FD 7E 01            		ld	a,(iy+1)	; Get link MSB
(1) 1251/     679 : FE FF               		cp	-1		; if 0FFxxh, end
(1) 1252/     67B : C8                  		ret	z
(1) 1253/     67C : B7                  		or	a		; if 00xx, mute it
(1) 1254/     67D : 28 0A               		jr	z,.flotin
(1) 1255/     67F : 67                  		ld	h,a		; hl - link
(1) 1256/     680 : FD 6E 00            		ld	l,(iy)
(1) 1257/     683 : 7E                  		ld	a,(hl)		; *** DIRECT chnl_Chip
(1) 1258/     684 : E6 F0               		and	11110000b
(1) 1259/     686 : B7                  		or	a
(1) 1260/     687 : 20 1E               		jr	nz,.busy
(1) 1261/     689 :                     ; 		and	11110000b
(1) 1262/     689 :                     ; 		cp	b
(1) 1263/     689 :                     ; 		jr	z,.busy
(1) 1264/     689 :                     
(1) 1265/     689 :                     .flotin:
(1) 1266/     689 : CF                  		rst	8
(1) 1267/     68A : FD 7E 02            		ld	a,(iy+2)
(1) 1268/     68D : E6 07               		and	000111b		;
(1) 1269/     68F : 16 00               		ld	d,0
(1) 1270/     691 : 5F                  		ld	e,a
(1) 1271/     692 : CF                  		rst	8
(1) 1272/     693 : DD E5               		push	ix
(1) 1273/     695 : E1                  		pop	hl
(1) 1274/     696 : 19                  		add	hl,de
(1) 1275/     697 : 7E                  		ld	a,(hl)		; already set?
(1) 1276/     698 : E6 07               		and	0111b
(1) 1277/     69A : B7                  		or	a
(1) 1278/     69B : 20 0A               		jr	nz,.busy
(1) 1279/     69D : 36 04               		ld	(hl),100b
(1) 1280/     69F : FD 36 00 00         		ld	(iy),0
(1) 1281/     6A3 : FD 36 01 00         		ld	(iy+1),0
(1) 1282/     6A7 :                     ; 		ld	(iy+3),0
(1) 1283/     6A7 :                     ; 		ld	(iy+4),0
(1) 1284/     6A7 :                     ; 		ld	(iy+5),0
(1) 1285/     6A7 :                     ; 		ld	(iy+6),0
(1) 1286/     6A7 :                     ; 		ld	(iy+7),0
(1) 1287/     6A7 :                     .busy:
(1) 1288/     6A7 : 11 08 00            		ld	de,8
(1) 1289/     6AA : FD 19               		add	iy,de
(1) 1290/     6AC : 18 C8               		jr	.silnc_list
(1) 1291/     6AE :                     
(1) 1292/     6AE :                     ; ----------------------------------------
(1) 1293/     6AE :                     ; Channel requested update
(1) 1294/     6AE :                     ;
(1) 1295/     6AE :                     ; iy - Current channel
(1) 1296/     6AE :                     ; ----------------------------------------
(1) 1297/     6AE :                     
(1) 1298/     6AE :                     .do_chnl:
(1) 1299/     6AE : C5                  		push	bc
(1) 1300/     6AF : CD 99 0E            		call	.check_ins
(1) 1301/     6B2 : FE FF               		cp	-1
(1) 1302/     6B4 : 28 3B               		jr	z,.no_chnl
(1) 1303/     6B6 : CD A9 0D            		call	.chip_swap	; check if tracker channel swapped chip
(1) 1304/     6B9 : CD AC 0E            		call	.check_chnl	; a - chip requested
(1) 1305/     6BC : FE FF               		cp	-1		; Ran out of chip channels.
(1) 1306/     6BE : 28 27               		jr	z,.ran_out
(1) 1307/     6C0 : 22 C7 19            		ld	(currInsPos),hl
(1) 1308/     6C3 : DD 22 C5 19         		ld	(currTblPos),ix
(1) 1309/     6C7 : CD 94 14            		call	dac_fill
(1) 1310/     6CA : FD CB 07 4E         		bit	1,(iy+chnl_Flags)
(1) 1311/     6CE : C4 FA 06            		call	nz,.req_ins
(1) 1312/     6D1 : FD CB 07 56         		bit	2,(iy+chnl_Flags)
(1) 1313/     6D5 : C4 57 08            		call	nz,.req_vol
(1) 1314/     6D8 : CF                  		rst	8
(1) 1315/     6D9 : FD CB 07 5E         		bit	3,(iy+chnl_Flags)
(1) 1316/     6DD : C4 F2 08            		call	nz,.req_eff
(1) 1317/     6E0 : FD CB 07 46         		bit	0,(iy+chnl_Flags)
(1) 1318/     6E4 : C4 4E 0B            		call	nz,.req_note
(1) 1319/     6E7 :                     ; 		ld	a,(iy+chnl_Flags)	; Instrument+effect also allowed.
(1) 1320/     6E7 :                     ; 		and	1010b
(1) 1321/     6E7 :                     ; 		or	a
(1) 1322/     6E7 :                     ; 		call	nz,.req_note
(1) 1323/     6E7 :                     
(1) 1324/     6E7 :                     .ran_out:
(1) 1325/     6E7 : FD 7E 07            		ld	a,(iy+chnl_Flags)	; Clear status bits
(1) 1326/     6EA : E6 F0               		and	11110000b
(1) 1327/     6EC : FD 77 07            		ld	(iy+chnl_Flags),a
(1) 1328/     6EF : C1                  		pop	bc
(1) 1329/     6F0 : C9                  		ret
(1) 1330/     6F1 :                     .no_chnl:
(1) 1331/     6F1 : CD A9 0D            		call	.chip_swap		; TODO: check if this breaks.
(1) 1332/     6F4 : FD 36 00 00         		ld	(iy+chnl_Chip),0
(1) 1333/     6F8 :                     ; 		ld	(ix+chnl_Flags),0
(1) 1334/     6F8 : C1                  		pop	bc
(1) 1335/     6F9 : C9                  		ret
(1) 1336/     6FA :                     
(1) 1337/     6FA :                     ; ----------------------------------------
(1) 1338/     6FA :                     ; bit 1: Intrument
(1) 1339/     6FA :                     ; ----------------------------------------
(1) 1340/     6FA :                     
(1) 1341/     6FA :                     .req_ins:
(1) 1342/     6FA : 2A C7 19            		ld	hl,(currInsPos)
(1) 1343/     6FD : DD 2A C5 19         		ld	ix,(currTblPos)
(1) 1344/     701 : 7E                  		ld	a,(hl)
(1) 1345/     702 : E6 F0               		and	11110000b
(1) 1346/     704 : FE 80               		cp	80h		; PSG normal
(1) 1347/     706 : 28 5A               		jr	z,.ins_psg
(1) 1348/     708 : FE 90               		cp	90h		; PSG noise
(1) 1349/     70A : 28 50               		jr	z,.ins_psgn
(1) 1350/     70C : CF                  		rst	8
(1) 1351/     70D : FE A0               		cp	0A0h		; FM normal
(1) 1352/     70F : CA DA 07            		jp	z,.ins_fm
(1) 1353/     712 : FE B0               		cp	0B0h		; FM special
(1) 1354/     714 : CA CB 07            		jp	z,.ins_fm3
(1) 1355/     717 : FE C0               		cp	0C0h		; DAC
(1) 1356/     719 : 28 76               		jr	z,.ins_dac
(1) 1357/     71B : FE D0               		cp	0D0h		; PWM
(1) 1358/     71D : CA 21 07            		jp	z,.ins_pwm
(1) 1359/     720 : C9                  		ret
(1) 1360/     721 :                     
(1) 1361/     721 :                     ; --------------------------------
(1) 1362/     721 :                     ; FM,FM3,FM6
(1) 1363/     721 :                     ; --------------------------------
(1) 1364/     721 :                     
(1) 1365/     721 :                     .ins_pwm:
(1) 1366/     721 : 56                  		ld	d,(hl)		; d - Flags
(1) 1367/     722 : 23                  		inc	hl
(1) 1368/     723 : 7E                  		ld	a,(hl)		; Save pitch
(1) 1369/     724 : 23                  		inc	hl
(1) 1370/     725 : DD 77 03            		ld	(ix+3),a
(1) 1371/     728 : DD 7E 02            		ld	a,(ix+2)
(1) 1372/     72B : DD 21 6A 1A         		ld	ix,pwmcom	; ix - pwmcom
(1) 1373/     72F : E6 07               		and	000111b
(1) 1374/     731 : 06 00               		ld	b,0
(1) 1375/     733 : 4F                  		ld	c,a
(1) 1376/     734 : DD 09               		add	ix,bc
(1) 1377/     736 : 7E                  		ld	a,(hl)		; SH2 BANK
(1) 1378/     737 : 23                  		inc	hl
(1) 1379/     738 : E6 0F               		and	00001111b
(1) 1380/     73A : 47                  		ld	b,a		; b - Section, ROM or SDRAM
(1) 1381/     73B : DD 7E 18            		ld	a,(ix+PWOUTF)
(1) 1382/     73E : E6 30               		and	00110000b	; keep flag LR
(1) 1383/     740 : 4F                  		ld	c,a		; save them as C
(1) 1384/     741 : 7A                  		ld	a,d
(1) 1385/     742 : E6 03               		and	00000011b	; Stereo|Loop bits
(1) 1386/     744 : 0F                  		rrca			; carry...
(1) 1387/     745 : 0F                  		rrca
(1) 1388/     746 : B1                  		or	c
(1) 1389/     747 : B0                  		or	b
(1) 1390/     748 : DD 77 18            		ld	(ix+PWOUTF),a
(1) 1391/     74B : 7E                  		ld	a,(hl)		; Grab the 24-bit address (BIG endian)
(1) 1392/     74C : 23                  		inc	hl
(1) 1393/     74D : DD 77 20            		ld	(ix+PWINSH),a
(1) 1394/     750 : CF                  		rst	8
(1) 1395/     751 : 7E                  		ld	a,(hl)
(1) 1396/     752 : 23                  		inc	hl
(1) 1397/     753 : DD 77 28            		ld	(ix+PWINSM),a
(1) 1398/     756 : 7E                  		ld	a,(hl)
(1) 1399/     757 : 23                  		inc	hl
(1) 1400/     758 : DD 77 30            		ld	(ix+PWINSL),a
(1) 1401/     75B : C9                  		ret
(1) 1402/     75C :                     
(1) 1403/     75C :                     ; --------------------------------
(1) 1404/     75C :                     ; PSG1-3,PSGN
(1) 1405/     75C :                     ; --------------------------------
(1) 1406/     75C :                     
(1) 1407/     75C :                     .ins_psgn:
(1) 1408/     75C : 7E                  		ld	a,(hl)
(1) 1409/     75D : E6 07               		and	111b
(1) 1410/     75F : DD 77 04            		ld	(ix+4),a
(1) 1411/     762 :                     .ins_psg:
(1) 1412/     762 : CF                  		rst	8
(1) 1413/     763 : 23                  		inc	hl		; Skip ID
(1) 1414/     764 : 7E                  		ld	a,(hl)
(1) 1415/     765 : DD 77 03            		ld	(ix+3),a	; Save pitch
(1) 1416/     768 : 23                  		inc	hl
(1) 1417/     769 : DD 7E 02            		ld	a,(ix+2)
(1) 1418/     76C : E6 03               		and	11b
(1) 1419/     76E : 16 00               		ld	d,0
(1) 1420/     770 : 5F                  		ld	e,a
(1) 1421/     771 : DD 21 68 17         		ld	ix,psgcom
(1) 1422/     775 : DD 19               		add	ix,de
(1) 1423/     777 : 7E                  		ld	a,(hl)
(1) 1424/     778 : DD 77 24            		ld	(ix+ALV),a	; ALV
(1) 1425/     77B : 23                  		inc	hl
(1) 1426/     77C : 7E                  		ld	a,(hl)
(1) 1427/     77D : DD 77 08            		ld	(ix+ATK),a	; ATK
(1) 1428/     780 : 23                  		inc	hl
(1) 1429/     781 : CF                  		rst	8
(1) 1430/     782 : 7E                  		ld	a,(hl)
(1) 1431/     783 : DD 77 10            		ld	(ix+SLV),a	; SLV
(1) 1432/     786 : 23                  		inc	hl
(1) 1433/     787 : 7E                  		ld	a,(hl)
(1) 1434/     788 : DD 77 0C            		ld	(ix+DKY),a	; DKY
(1) 1435/     78B : 23                  		inc	hl
(1) 1436/     78C : 7E                  		ld	a,(hl)
(1) 1437/     78D : DD 77 14            		ld	(ix+RRT),a	; RRT
(1) 1438/     790 : C9                  		ret
(1) 1439/     791 :                     
(1) 1440/     791 :                     ; --------------------------------
(1) 1441/     791 :                     ; FM,FM3,FM6
(1) 1442/     791 :                     ; --------------------------------
(1) 1443/     791 :                     
(1) 1444/     791 :                     .ins_dac:
(1) 1445/     791 : DD 36 04 01         		ld	(ix+4),1	; e - alternate mode flag (FM6 as DAC)
(1) 1446/     795 : 7E                  		ld	a,(hl)		; Grab flags from ID
(1) 1447/     796 : E6 01               		and	001b
(1) 1448/     798 : 32 DB 19            		ld	(wave_Flags),a
(1) 1449/     79B : 23                  		inc	hl
(1) 1450/     79C : 7E                  		ld	a,(hl)		; Save pitch
(1) 1451/     79D : DD 77 03            		ld	(ix+3),a
(1) 1452/     7A0 : 23                  		inc	hl
(1) 1453/     7A1 : 4E                  		ld	c,(hl)		; Grab the 24-bit address
(1) 1454/     7A2 : 23                  		inc	hl		; big endian this time.
(1) 1455/     7A3 : CF                  		rst	8
(1) 1456/     7A4 : 56                  		ld	d,(hl)
(1) 1457/     7A5 : 23                  		inc	hl
(1) 1458/     7A6 : 5E                  		ld	e,(hl)
(1) 1459/     7A7 :                     
(1) 1460/     7A7 : CF                  		rst	8
(1) 1461/     7A8 : 6B                  		ld	l,e
(1) 1462/     7A9 : 62                  		ld	h,d
(1) 1463/     7AA : 79                  		ld	a,c
(1) 1464/     7AB : E5                  		push	hl		; Recieve LEN and LOOP
(1) 1465/     7AC : F5                  		push	af		; from the WAVE itself
(1) 1466/     7AD : 11 D3 19            		ld	de,wave_Len
(1) 1467/     7B0 : 01 06 00            		ld	bc,6
(1) 1468/     7B3 : CF                  		rst	8
(1) 1469/     7B4 : CD 3A 10            		call	transferRom
(1) 1470/     7B7 : F1                  		pop	af
(1) 1471/     7B8 : E1                  		pop	hl
(1) 1472/     7B9 : 01 06 00            		ld	bc,6		; skip LEN point
(1) 1473/     7BC : 09                  		add	hl,bc
(1) 1474/     7BD : CE 00               		adc	a,0
(1) 1475/     7BF : 22 D0 19            		ld	(wave_Start),hl	; save START point
(1) 1476/     7C2 : 32 D2 19            		ld	(wave_Start+2),a
(1) 1477/     7C5 : 3E 04               		ld	a,100b		; Force FM6 off
(1) 1478/     7C7 : 32 A1 17            		ld	(fmcom+5),a
(1) 1479/     7CA : C9                  		ret
(1) 1480/     7CB :                     
(1) 1481/     7CB :                     ; FM3 special mode
(1) 1482/     7CB :                     .ins_fm3:
(1) 1483/     7CB : 3E 02               		ld	a,2		; manual index
(1) 1484/     7CD : 1E 01               		ld	e,1		; set as alternate FM
(1) 1485/     7CF : CD 05 08            		call	.rd_fmins
(1) 1486/     7D2 : 21 9E 17            		ld	hl,fmcom+2
(1) 1487/     7D5 : 7E                  		ld	a,(hl)		; instrument update bit
(1) 1488/     7D6 : F6 10               		or	00010000b	; flag
(1) 1489/     7D8 : 77                  		ld	(hl),a
(1) 1490/     7D9 : C9                  		ret
(1) 1491/     7DA :                     ; Regular FM
(1) 1492/     7DA :                     .ins_fm:
(1) 1493/     7DA : CF                  		rst	8
(1) 1494/     7DB : 1E 00               		ld	e,0		; Set as normal FM
(1) 1495/     7DD : DD 7E 02            		ld	a,(ix+2)
(1) 1496/     7E0 : E6 07               		and	00000111b
(1) 1497/     7E2 : FE 05               		cp	5		; Check if we are on FM6
(1) 1498/     7E4 : 20 08               		jr	nz,.not_prdac
(1) 1499/     7E6 : 57                  		ld	d,a
(1) 1500/     7E7 : 3E 04               		ld	a,100b		; Force DAC stop
(1) 1501/     7E9 : CF                  		rst	8
(1) 1502/     7EA : 32 BC 18            		ld	(daccom),a
(1) 1503/     7ED : 7A                  		ld	a,d
(1) 1504/     7EE :                     .not_prdac:
(1) 1505/     7EE : 1E 00               		ld	e,0		; Set as Normal
(1) 1506/     7F0 : CD 05 08            		call	.rd_fmins
(1) 1507/     7F3 : DD 7E 02            		ld	a,(ix+2)
(1) 1508/     7F6 : E6 07               		and	00000111b
(1) 1509/     7F8 : 16 00               		ld	d,0
(1) 1510/     7FA : CF                  		rst	8
(1) 1511/     7FB : 5F                  		ld	e,a
(1) 1512/     7FC : 21 9C 17            		ld	hl,fmcom
(1) 1513/     7FF : 19                  		add	hl,de
(1) 1514/     800 : 7E                  		ld	a,(hl)		; instrument update bit
(1) 1515/     801 : F6 10               		or	00010000b	; flag
(1) 1516/     803 : 77                  		ld	(hl),a
(1) 1517/     804 : C9                  		ret
(1) 1518/     805 :                     
(1) 1519/     805 :                     ; Read FM instrument
(1) 1520/     805 :                     ;
(1) 1521/     805 :                     ; e - alternate mode flag
(1) 1522/     805 :                     .rd_fmins:
(1) 1523/     805 : DD 73 04            		ld	(ix+4),e	; e - alternate mode flag
(1) 1524/     808 : 23                  		inc	hl		; skip ID and pitch
(1) 1525/     809 : 5E                  		ld	e,(hl)
(1) 1526/     80A : DD 73 03            		ld	(ix+3),e	; save pitch
(1) 1527/     80D : 23                  		inc	hl
(1) 1528/     80E : 87                  		add	a,a
(1) 1529/     80F : 16 00               		ld	d,0
(1) 1530/     811 : 5F                  		ld	e,a
(1) 1531/     812 : CF                  		rst	8
(1) 1532/     813 : E5                  		push	hl		; save ins hl
(1) 1533/     814 : 21 4B 08            		ld	hl,.fmpickins
(1) 1534/     817 : 19                  		add	hl,de
(1) 1535/     818 : 5E                  		ld	e,(hl)		; get output location
(1) 1536/     819 : 23                  		inc	hl		; from list
(1) 1537/     81A : 56                  		ld	d,(hl)
(1) 1538/     81B : CF                  		rst	8
(1) 1539/     81C : E1                  		pop	hl
(1) 1540/     81D : 7E                  		ld	a,(hl)		; a - xx0000
(1) 1541/     81E : 23                  		inc	hl
(1) 1542/     81F : 4E                  		ld	c,(hl)		; c - 00xx00
(1) 1543/     820 : 23                  		inc	hl
(1) 1544/     821 : 6E                  		ld	l,(hl)		; l - 0000xx
(1) 1545/     822 : 61                  		ld	h,c		; c to h
(1) 1546/     823 : D5                  		push	de
(1) 1547/     824 : CF                  		rst	8
(1) 1548/     825 : 4F                  		ld	c,a
(1) 1549/     826 : DD 7E 07            		ld	a,(ix+7)
(1) 1550/     829 : B9                  		cp	c
(1) 1551/     82A : 20 0C               		jr	nz,.confm_rd
(1) 1552/     82C : DD 7E 06            		ld	a,(ix+6)
(1) 1553/     82F : BC                  		cp	h
(1) 1554/     830 : 20 06               		jr	nz,.confm_rd
(1) 1555/     832 : DD 7E 05            		ld	a,(ix+5)
(1) 1556/     835 : BD                  		cp	l
(1) 1557/     836 : 28 11               		jr	z,.fmsame_ins
(1) 1558/     838 :                     .confm_rd:
(1) 1559/     838 : CF                  		rst	8
(1) 1560/     839 : DD 75 05            		ld	(ix+5),l
(1) 1561/     83C : DD 74 06            		ld	(ix+6),h
(1) 1562/     83F : DD 71 07            		ld	(ix+7),c
(1) 1563/     842 : 79                  		ld	a,c
(1) 1564/     843 : 01 28 00            		ld	bc,028h		; 28h bytes
(1) 1565/     846 : CD 3A 10            		call	transferRom	; Transfer instrument data from ROM
(1) 1566/     849 :                     .fmsame_ins:
(1) 1567/     849 : E1                  		pop	hl
(1) 1568/     84A : C9                  		ret
(1) 1569/     84B :                     
(1) 1570/     84B :                     ; manual location for each instr cache
(1) 1571/     84B :                     ; 28h bytes each
(1) 1572/     84B :                     .fmpickins:
(1) 1573/     84B : C0 17               		dw fmins_com
(1) 1574/     84D : E8 17               		dw fmins_com2
(1) 1575/     84F : 10 18               		dw fmins_com3
(1) 1576/     851 : 38 18               		dw fmins_com4
(1) 1577/     853 : 60 18               		dw fmins_com5
(1) 1578/     855 : 88 18               		dw fmins_com6
(1) 1579/     857 :                     
(1) 1580/     857 :                     ; ----------------------------------------
(1) 1581/     857 :                     ; bit 2
(1) 1582/     857 :                     ; ----------------------------------------
(1) 1583/     857 :                     
(1) 1584/     857 :                     .req_vol:
(1) 1585/     857 : 2A C7 19            		ld	hl,(currInsPos)
(1) 1586/     85A : DD 2A C5 19         		ld	ix,(currTblPos)
(1) 1587/     85E : 7E                  		ld	a,(hl)
(1) 1588/     85F : E6 F0               		and	11110000b
(1) 1589/     861 : FE 80               		cp	80h		; PSG normal
(1) 1590/     863 : 28 45               		jr	z,.vol_psg
(1) 1591/     865 : FE 90               		cp	90h		; PSG noise
(1) 1592/     867 : 28 41               		jr	z,.vol_psg
(1) 1593/     869 : CF                  		rst	8
(1) 1594/     86A : FE A0               		cp	0A0h		; FM normal
(1) 1595/     86C : 28 5F               		jr	z,.vol_fm
(1) 1596/     86E : FE B0               		cp	0B0h		; FM special (same thing)
(1) 1597/     870 : 28 5B               		jr	z,.vol_fm
(1) 1598/     872 :                     ; 		cp	0C0h		; DAC
(1) 1599/     872 :                     ; 		jr	z,.vol_dac
(1) 1600/     872 : FE D0               		cp	0D0h		; PWM
(1) 1601/     874 : 28 01               		jr	z,.vol_pwm
(1) 1602/     876 : C9                  		ret
(1) 1603/     877 :                     
(1) 1604/     877 :                     ; --------------------------------
(1) 1605/     877 :                     ; FM,FM3,FM6
(1) 1606/     877 :                     .vol_pwm:
(1) 1607/     877 : 01 00 00            		ld	bc,0
(1) 1608/     87A : DD 7E 02            		ld	a,(ix+2)
(1) 1609/     87D : E6 07               		and	00000111b
(1) 1610/     87F : 4F                  		ld	c,a
(1) 1611/     880 : CF                  		rst	8
(1) 1612/     881 : DD 21 6A 1A         		ld	ix,pwmcom
(1) 1613/     885 : DD 09               		add	ix,bc
(1) 1614/     887 : DD 7E 08            		ld	a,(ix+PWPTH_V)
(1) 1615/     88A : E6 03               		and	00000011b
(1) 1616/     88C : 4F                  		ld	c,a		; c - MSB Pitch bits
(1) 1617/     88D : FD 7E 03            		ld	a,(iy+chnl_Vol)
(1) 1618/     890 : D6 40               		sub	a,40h
(1) 1619/     892 : CF                  		rst	8
(1) 1620/     893 : ED 44               		neg	a		; reverse impulse volume
(1) 1621/     895 : 87                  		add	a,a
(1) 1622/     896 : 87                  		add	a,a
(1) 1623/     897 : 30 03               		jr	nc,.pvmuch
(1) 1624/     899 : 3E FF               		ld	a,-1
(1) 1625/     89B : CF                  		rst	8
(1) 1626/     89C :                     .pvmuch:
(1) 1627/     89C : B1                  		or	c
(1) 1628/     89D : DD 77 08            		ld	(ix+PWPTH_V),a
(1) 1629/     8A0 : DD CB 00 EE         		set	5,(ix)		; set volume update bit
(1) 1630/     8A4 : 3E 01               		ld	a,1
(1) 1631/     8A6 : 32 CC 19            		ld	(marsUpd),a
(1) 1632/     8A9 : C9                  		ret
(1) 1633/     8AA :                     
(1) 1634/     8AA :                     ; --------------------------------
(1) 1635/     8AA :                     ; PSG1-3,PSGN
(1) 1636/     8AA :                     
(1) 1637/     8AA :                     .vol_psg:
(1) 1638/     8AA : DD 7E 02            		ld	a,(ix+2)
(1) 1639/     8AD : DD 21 68 17         		ld	ix,psgcom
(1) 1640/     8B1 : E6 03               		and	11b
(1) 1641/     8B3 : 16 00               		ld	d,0
(1) 1642/     8B5 : 5F                  		ld	e,a
(1) 1643/     8B6 : DD 19               		add	ix,de
(1) 1644/     8B8 : FD 7E 03            		ld	a,(iy+chnl_Vol)
(1) 1645/     8BB : D6 40               		sub	a,40h
(1) 1646/     8BD : ED 44               		neg	a
(1) 1647/     8BF : 4F                  		ld	c,a
(1) 1648/     8C0 : FE 40               		cp	40h
(1) 1649/     8C2 : 20 02               		jr	nz,.vmuch
(1) 1650/     8C4 : 0E FF               		ld	c,-1
(1) 1651/     8C6 :                     .vmuch:
(1) 1652/     8C6 : 79                  		ld	a,c
(1) 1653/     8C7 : 87                  		add	a,a
(1) 1654/     8C8 : 87                  		add	a,a
(1) 1655/     8C9 : DD 77 30            		ld	(ix+PVOL),a
(1) 1656/     8CC :                     ; 		ld	a,(ix)
(1) 1657/     8CC :                     ; 		or	00100000b	; Set volume
(1) 1658/     8CC :                     ; 		ld	(ix),a		; update flag
(1) 1659/     8CC : C9                  		ret
(1) 1660/     8CD :                     
(1) 1661/     8CD :                     ; --------------------------------
(1) 1662/     8CD :                     ; FM,FM3,FM6
(1) 1663/     8CD :                     .vol_fm:
(1) 1664/     8CD : 01 00 00            		ld	bc,0
(1) 1665/     8D0 : DD 7E 02            		ld	a,(ix+2)
(1) 1666/     8D3 : E6 07               		and	00000111b
(1) 1667/     8D5 : 4F                  		ld	c,a
(1) 1668/     8D6 : DD 21 9C 17         		ld	ix,fmcom
(1) 1669/     8DA : DD 09               		add	ix,bc
(1) 1670/     8DC : FD 7E 03            		ld	a,(iy+chnl_Vol)
(1) 1671/     8DF : D6 40               		sub	a,40h
(1) 1672/     8E1 : CF                  		rst	8
(1) 1673/     8E2 : ED 44               		neg	a		; reverse impulse volume
(1) 1674/     8E4 : CB 3F               		srl	a		; /2
(1) 1675/     8E6 : DD 77 0C            		ld	(ix+FMVOL),a
(1) 1676/     8E9 : DD 7E 00            		ld	a,(ix)		; volume update
(1) 1677/     8EC : F6 20               		or	00100000b	; flag, plus keyon
(1) 1678/     8EE : DD 77 00            		ld	(ix),a
(1) 1679/     8F1 : C9                  		ret
(1) 1680/     8F2 :                     
(1) 1681/     8F2 :                     ; ----------------------------------------
(1) 1682/     8F2 :                     ; bit 3
(1) 1683/     8F2 :                     ; ----------------------------------------
(1) 1684/     8F2 :                     
(1) 1685/     8F2 :                     .req_eff:
(1) 1686/     8F2 : 2A C7 19            		ld	hl,(currInsPos)
(1) 1687/     8F5 : DD 2A C5 19         		ld	ix,(currTblPos)
(1) 1688/     8F9 : FD 7E 04            		ld	a,(iy+chnl_EffId)	; effect id == 0?
(1) 1689/     8FC : B7                  		or	a
(1) 1690/     8FD : C8                  		ret	z
(1) 1691/     8FE : 57                  		ld	d,a
(1) 1692/     8FF : 7E                  		ld	a,(hl)
(1) 1693/     900 : E6 F0               		and	11110000b
(1) 1694/     902 : FD 5E 05            		ld	e,(iy+chnl_EffArg)
(1) 1695/     905 : CF                  		rst	8
(1) 1696/     906 : FE 80               		cp	80h			; PSG normal
(1) 1697/     908 : 28 16               		jr	z,.eff_psg
(1) 1698/     90A : FE 90               		cp	90h			; PSG noise
(1) 1699/     90C : 28 12               		jr	z,.eff_psg
(1) 1700/     90E : FE A0               		cp	0A0h			; FM Normal
(1) 1701/     910 : 28 21               		jr	z,.eff_fm
(1) 1702/     912 : CF                  		rst	8
(1) 1703/     913 : FE B0               		cp	0B0h			; FM Special
(1) 1704/     915 : 28 1C               		jr	z,.eff_fm
(1) 1705/     917 : FE C0               		cp	0C0h			; DAC
(1) 1706/     919 : 28 2F               		jr	z,.eff_dac
(1) 1707/     91B : FE D0               		cp	0D0h			; PWM
(1) 1708/     91D : 28 3D               		jr	z,.eff_pwm
(1) 1709/     91F : C9                  		ret
(1) 1710/     920 :                     
(1) 1711/     920 :                     ; --------------------------------
(1) 1712/     920 :                     
(1) 1713/     920 :                     .eff_psg:
(1) 1714/     920 : 7A                  		ld	a,d
(1) 1715/     921 : FE 04               		cp	4		; Effect D?
(1) 1716/     923 : CA 73 09            		jp	z,.effPsg_D
(1) 1717/     926 : FE 05               		cp	5		; Effect E?
(1) 1718/     928 : CA F3 09            		jp	z,.effPsg_E
(1) 1719/     92B : CF                  		rst	8
(1) 1720/     92C : FE 06               		cp	6		; Effect F?
(1) 1721/     92E : CA 25 0A            		jp	z,.effPsg_F
(1) 1722/     931 : CF                  		rst	8
(1) 1723/     932 : C9                  		ret
(1) 1724/     933 :                     .eff_fm:
(1) 1725/     933 : 7A                  		ld	a,d
(1) 1726/     934 : FE 04               		cp	4		; Effect D?
(1) 1727/     936 : CA A1 09            		jp	z,.effFm_D
(1) 1728/     939 : FE 05               		cp	5		; Effect E?
(1) 1729/     93B : CA FD 09            		jp	z,.effFm_E
(1) 1730/     93E : CF                  		rst	8
(1) 1731/     93F : FE 06               		cp	6		; Effect F?
(1) 1732/     941 : CA 33 0A            		jp	z,.effFm_F
(1) 1733/     944 : FE 18               		cp	24		; Effect X?
(1) 1734/     946 : CA 10 0B            		jp	z,.effFm_X
(1) 1735/     949 : C9                  		ret
(1) 1736/     94A :                     .eff_dac:
(1) 1737/     94A : 7A                  		ld	a,d
(1) 1738/     94B : FE 05               		cp	5		; Effect E?
(1) 1739/     94D : CA 0B 0A            		jp	z,.effDac_E
(1) 1740/     950 : FE 06               		cp	6		; Effect F?
(1) 1741/     952 : CA 3A 0A            		jp	z,.effDac_F
(1) 1742/     955 : CF                  		rst	8
(1) 1743/     956 : FE 18               		cp	24		; Effect X?
(1) 1744/     958 : CA 10 0B            		jp	z,.effFm_X
(1) 1745/     95B : C9                  		ret
(1) 1746/     95C :                     .eff_pwm:
(1) 1747/     95C : 3E 01               		ld	a,1
(1) 1748/     95E : 32 CC 19            		ld	(marsUpd),a
(1) 1749/     961 : 7A                  		ld	a,d
(1) 1750/     962 :                     ; 		cp	4		; Effect D?
(1) 1751/     962 :                     ; 		jp	z,.effFm_D
(1) 1752/     962 : FE 05               		cp	5		; Effect E?
(1) 1753/     964 : CA 18 0A            		jp	z,.effPwm_E
(1) 1754/     967 : CF                  		rst	8
(1) 1755/     968 : FE 06               		cp	6		; Effect F?
(1) 1756/     96A : CA 40 0A            		jp	z,.effPwm_F
(1) 1757/     96D : FE 18               		cp	24		; Effect X?
(1) 1758/     96F : CA F7 0A            		jp	z,.effPwm_X	; recycle FM's panning
(1) 1759/     972 : C9                  		ret
(1) 1760/     973 :                     
(1) 1761/     973 :                     ; --------------------------------
(1) 1762/     973 :                     ; Effect D
(1) 1763/     973 :                     ; --------------------------------
(1) 1764/     973 :                     
(1) 1765/     973 :                     .effPsg_D:
(1) 1766/     973 : 7B                  		ld	a,e
(1) 1767/     974 : B7                  		or	a
(1) 1768/     975 : C8                  		ret	z
(1) 1769/     976 : 06 00               		ld	b,0
(1) 1770/     978 : DD 7E 02            		ld	a,(ix+2)
(1) 1771/     97B : E6 03               		and	011b
(1) 1772/     97D : 4F                  		ld	c,a
(1) 1773/     97E : DD 21 68 17         		ld	ix,psgcom
(1) 1774/     982 : DD 09               		add	ix,bc
(1) 1775/     984 : CD D0 09            		call	.grab_dval
(1) 1776/     987 : 87                  		add	a,a
(1) 1777/     988 : 87                  		add	a,a
(1) 1778/     989 : 87                  		add	a,a
(1) 1779/     98A : 4F                  		ld	c,a
(1) 1780/     98B : CB 79               		bit	7,c
(1) 1781/     98D : 20 09               		jr	nz,.lowp
(1) 1782/     98F : DD 7E 30            		ld	a,(ix+PVOL)
(1) 1783/     992 : 81                  		add	a,c
(1) 1784/     993 : D8                  		ret	c
(1) 1785/     994 : DD 77 30            		ld	(ix+PVOL),a
(1) 1786/     997 : C9                  		ret
(1) 1787/     998 :                     .lowp:
(1) 1788/     998 : DD 7E 30            		ld	a,(ix+PVOL)
(1) 1789/     99B : 81                  		add	a,c
(1) 1790/     99C : D0                  		ret	nc
(1) 1791/     99D : DD 77 30            		ld	(ix+PVOL),a
(1) 1792/     9A0 : C9                  		ret
(1) 1793/     9A1 :                     .effFm_D:
(1) 1794/     9A1 : 7B                  		ld	a,e
(1) 1795/     9A2 : B7                  		or	a
(1) 1796/     9A3 : C8                  		ret	z
(1) 1797/     9A4 : 06 00               		ld	b,0
(1) 1798/     9A6 : DD 7E 02            		ld	a,(ix+2)
(1) 1799/     9A9 : E6 07               		and	111b
(1) 1800/     9AB : 4F                  		ld	c,a
(1) 1801/     9AC : DD 21 9C 17         		ld	ix,fmcom
(1) 1802/     9B0 : DD 09               		add	ix,bc
(1) 1803/     9B2 : CD D0 09            		call	.grab_dval
(1) 1804/     9B5 :                     ; 		srl	a		; TODO: checar que tanto
(1) 1805/     9B5 :                     ; 		srl	a		; shifteo esto
(1) 1806/     9B5 : 4F                  		ld	c,a
(1) 1807/     9B6 : DD CB 00 EE         		set	5,(ix)
(1) 1808/     9BA : CB 79               		bit	7,c
(1) 1809/     9BC : 20 09               		jr	nz,.lowpf
(1) 1810/     9BE : DD 7E 0C            		ld	a,(ix+FMVOL)
(1) 1811/     9C1 : 81                  		add	a,c
(1) 1812/     9C2 : D8                  		ret	c
(1) 1813/     9C3 : DD 77 0C            		ld	(ix+FMVOL),a
(1) 1814/     9C6 : C9                  		ret
(1) 1815/     9C7 :                     .lowpf:
(1) 1816/     9C7 : DD 7E 0C            		ld	a,(ix+FMVOL)
(1) 1817/     9CA : 81                  		add	a,c
(1) 1818/     9CB : D0                  		ret	nc
(1) 1819/     9CC : DD 77 0C            		ld	(ix+FMVOL),a
(1) 1820/     9CF : C9                  		ret
(1) 1821/     9D0 :                     
(1) 1822/     9D0 :                     ; a - increment/decrement value
(1) 1823/     9D0 :                     .grab_dval:
(1) 1824/     9D0 : 7B                  		ld	a,e
(1) 1825/     9D1 : E6 F0               		and	11110000b
(1) 1826/     9D3 : FE F0               		cp	11110000b
(1) 1827/     9D5 : 28 03               		jr	z,.go_down
(1) 1828/     9D7 : B7                  		or	a
(1) 1829/     9D8 : 20 09               		jr	nz,.go_up
(1) 1830/     9DA :                     .go_down:
(1) 1831/     9DA : 7B                  		ld	a,e
(1) 1832/     9DB : E6 0F               		and	00001111b
(1) 1833/     9DD : CB 7B               		bit	7,e
(1) 1834/     9DF : C0                  		ret	nz
(1) 1835/     9E0 : 87                  		add	a,a
(1) 1836/     9E1 : CF                  		rst	8
(1) 1837/     9E2 : C9                  		ret
(1) 1838/     9E3 :                     .go_up:
(1) 1839/     9E3 : 7B                  		ld	a,e
(1) 1840/     9E4 : 0F                  		rrca
(1) 1841/     9E5 : 0F                  		rrca
(1) 1842/     9E6 : 0F                  		rrca
(1) 1843/     9E7 : 0F                  		rrca
(1) 1844/     9E8 : CF                  		rst	8
(1) 1845/     9E9 : E6 0F               		and	00001111b
(1) 1846/     9EB : ED 44               		neg	a
(1) 1847/     9ED : CB 5B               		bit	3,e
(1) 1848/     9EF : C0                  		ret	nz
(1) 1849/     9F0 : 87                  		add	a,a
(1) 1850/     9F1 : CF                  		rst	8
(1) 1851/     9F2 : C9                  		ret
(1) 1852/     9F3 :                     
(1) 1853/     9F3 :                     ; --------------------------------
(1) 1854/     9F3 :                     ; Effect E
(1) 1855/     9F3 :                     ; --------------------------------
(1) 1856/     9F3 :                     
(1) 1857/     9F3 :                     .effPsg_E:
(1) 1858/     9F3 : CD D8 0A            		call	.grab_prtm
(1) 1859/     9F6 : 16 00               		ld	d,0
(1) 1860/     9F8 : 87                  		add	a,a
(1) 1861/     9F9 : 5F                  		ld	e,a
(1) 1862/     9FA : C3 AE 0A            		jp	.freqinc_psg
(1) 1863/     9FD :                     .effFm_E:
(1) 1864/     9FD : CD D8 0A            		call	.grab_prtm
(1) 1865/     A00 : ED 44               		neg	a
(1) 1866/     A02 : B7                  		or	a
(1) 1867/     A03 : 28 02               		jr	z,.e_neg
(1) 1868/     A05 : 16 FF               		ld	d,-1
(1) 1869/     A07 :                     .e_neg:
(1) 1870/     A07 : 5F                  		ld	e,a
(1) 1871/     A08 : C3 88 0A            		jp	.freqinc_fm
(1) 1872/     A0B :                     .effDac_E:
(1) 1873/     A0B : CD D8 0A            		call	.grab_prtm
(1) 1874/     A0E : ED 44               		neg	a
(1) 1875/     A10 : B7                  		or	a
(1) 1876/     A11 : 28 02               		jr	z,.e_negd
(1) 1877/     A13 : 16 FF               		ld	d,-1
(1) 1878/     A15 :                     .e_negd:
(1) 1879/     A15 : 5F                  		ld	e,a
(1) 1880/     A16 : 18 60               		jr	.freqinc_dac
(1) 1881/     A18 :                     
(1) 1882/     A18 :                     .effPwm_E:
(1) 1883/     A18 : CD D8 0A            		call	.grab_prtm
(1) 1884/     A1B :                     ; 		sra	a
(1) 1885/     A1B :                     ; 		sra	a
(1) 1886/     A1B : ED 44               		neg	a
(1) 1887/     A1D : B7                  		or	a
(1) 1888/     A1E : 28 02               		jr	z,.e_fnegd2
(1) 1889/     A20 : 16 FF               		ld	d,-1
(1) 1890/     A22 :                     .e_fnegd2:
(1) 1891/     A22 : 5F                  		ld	e,a
(1) 1892/     A23 : 18 1F               		jr	.freqinc_pwm
(1) 1893/     A25 :                     
(1) 1894/     A25 :                     ; --------------------------------
(1) 1895/     A25 :                     ; Effect F
(1) 1896/     A25 :                     ; --------------------------------
(1) 1897/     A25 :                     
(1) 1898/     A25 :                     ; PSG
(1) 1899/     A25 :                     .effPsg_F:
(1) 1900/     A25 : CD D8 0A            		call	.grab_prtm
(1) 1901/     A28 : 87                  		add	a,a
(1) 1902/     A29 : ED 44               		neg	a
(1) 1903/     A2B : B7                  		or	a
(1) 1904/     A2C : 28 02               		jr	z,.e_negp
(1) 1905/     A2E : 16 FF               		ld	d,-1
(1) 1906/     A30 :                     .e_negp:
(1) 1907/     A30 : 5F                  		ld	e,a
(1) 1908/     A31 : 18 7B               		jr	.freqinc_psg
(1) 1909/     A33 :                     .effFm_F:
(1) 1910/     A33 : CD D8 0A            		call	.grab_prtm
(1) 1911/     A36 : 87                  		add	a,a
(1) 1912/     A37 : 5F                  		ld	e,a
(1) 1913/     A38 : 18 4E               		jr	.freqinc_fm
(1) 1914/     A3A :                     .effDac_F:
(1) 1915/     A3A : CD D8 0A            		call	.grab_prtm
(1) 1916/     A3D : 5F                  		ld	e,a
(1) 1917/     A3E : 18 38               		jr	.freqinc_dac
(1) 1918/     A40 :                     .effPwm_F:
(1) 1919/     A40 : CD D8 0A            		call	.grab_prtm
(1) 1920/     A43 :                     ; 		sra	a
(1) 1921/     A43 :                     ; 		sra	a
(1) 1922/     A43 : 5F                  		ld	e,a
(1) 1923/     A44 :                     
(1) 1924/     A44 :                     ; --------------------------------
(1) 1925/     A44 :                     ; For effects E and F:
(1) 1926/     A44 :                     ;
(1) 1927/     A44 :                     ; de - freq incr/decr
(1) 1928/     A44 :                     
(1) 1929/     A44 :                     .freqinc_pwm:
(1) 1930/     A44 : DD 7E 02            		ld	a,(ix+2)
(1) 1931/     A47 : E6 07               		and	111b
(1) 1932/     A49 : DD 21 6A 1A         		ld	ix,pwmcom
(1) 1933/     A4D : 06 00               		ld	b,0
(1) 1934/     A4F : 4F                  		ld	c,a
(1) 1935/     A50 : CF                  		rst	8
(1) 1936/     A51 : DD 09               		add	ix,bc
(1) 1937/     A53 : DD 7E 08            		ld	a,(ix+PWPTH_V)
(1) 1938/     A56 : E6 03               		and	00000011b
(1) 1939/     A58 : 67                  		ld	h,a
(1) 1940/     A59 : DD 6E 10            		ld	l,(ix+PWPHL)
(1) 1941/     A5C : 19                  		add	hl,de
(1) 1942/     A5D : DD 7E 08            		ld	a,(ix+PWPTH_V)
(1) 1943/     A60 : E6 FC               		and	11111100b
(1) 1944/     A62 : CF                  		rst	8
(1) 1945/     A63 : B4                  		or	h
(1) 1946/     A64 : DD 77 08            		ld	(ix+PWPTH_V),a
(1) 1947/     A67 : DD 75 10            		ld	(ix+PWPHL),l
(1) 1948/     A6A : DD 7E 00            		ld	a,(ix)			; pitch bend request
(1) 1949/     A6D : F6 10               		or	00010000b
(1) 1950/     A6F : DD 77 00            		ld	(ix),a
(1) 1951/     A72 : 3E 01               		ld	a,1
(1) 1952/     A74 : 32 CC 19            		ld	(marsUpd),a
(1) 1953/     A77 : C9                  		ret
(1) 1954/     A78 :                     
(1) 1955/     A78 :                     .freqinc_dac:
(1) 1956/     A78 : 2A D9 19            		ld	hl,(wave_Pitch)		; tricky one...
(1) 1957/     A7B : 19                  		add	hl,de
(1) 1958/     A7C : 22 D9 19            		ld	(wave_Pitch),hl
(1) 1959/     A7F : 3A BC 18            		ld	a,(daccom)
(1) 1960/     A82 : F6 10               		or	00010000b
(1) 1961/     A84 : 32 BC 18            		ld	(daccom),a
(1) 1962/     A87 : C9                  		ret
(1) 1963/     A88 :                     
(1) 1964/     A88 :                     .freqinc_fm:
(1) 1965/     A88 : DD 7E 02            		ld	a,(ix+2)
(1) 1966/     A8B : E6 07               		and	111b
(1) 1967/     A8D : DD 21 9C 17         		ld	ix,fmcom
(1) 1968/     A91 : 06 00               		ld	b,0
(1) 1969/     A93 : 4F                  		ld	c,a
(1) 1970/     A94 : CF                  		rst	8
(1) 1971/     A95 : DD 09               		add	ix,bc
(1) 1972/     A97 : DD 66 18            		ld	h,(ix+FMFRQH)
(1) 1973/     A9A : DD 6E 1E            		ld	l,(ix+FMFRQL)
(1) 1974/     A9D : 19                  		add	hl,de
(1) 1975/     A9E : DD 74 18            		ld	(ix+FMFRQH),h
(1) 1976/     AA1 : CF                  		rst	8
(1) 1977/     AA2 : DD 75 1E            		ld	(ix+FMFRQL),l
(1) 1978/     AA5 : DD 7E 00            		ld	a,(ix)
(1) 1979/     AA8 : F6 01               		or	00000001b
(1) 1980/     AAA : DD 77 00            		ld	(ix),a
(1) 1981/     AAD : C9                  		ret
(1) 1982/     AAE :                     .freqinc_psg:
(1) 1983/     AAE : DD 7E 02            		ld	a,(ix+2)
(1) 1984/     AB1 : E6 03               		and	011b
(1) 1985/     AB3 : DD 21 68 17         		ld	ix,psgcom
(1) 1986/     AB7 : 06 00               		ld	b,0
(1) 1987/     AB9 : 4F                  		ld	c,a
(1) 1988/     ABA : DD 09               		add	ix,bc
(1) 1989/     ABC : CF                  		rst	8
(1) 1990/     ABD : DD 66 20            		ld	h,(ix+DTH)
(1) 1991/     AC0 : DD 6E 1C            		ld	l,(ix+DTL)
(1) 1992/     AC3 : 19                  		add	hl,de
(1) 1993/     AC4 : 7C                  		ld	a,h
(1) 1994/     AC5 : E6 07               		and	00000111b
(1) 1995/     AC7 : 67                  		ld	h,a
(1) 1996/     AC8 : CF                  		rst	8
(1) 1997/     AC9 : DD 74 20            		ld	(ix+DTH),h
(1) 1998/     ACC : DD 75 1C            		ld	(ix+DTL),l
(1) 1999/     ACF : DD 7E 00            		ld	a,(ix)
(1) 2000/     AD2 : F6 01               		or	00000001b
(1) 2001/     AD4 : DD 77 00            		ld	(ix),a
(1) 2002/     AD7 : C9                  		ret
(1) 2003/     AD8 :                     ; grab portametro value
(1) 2004/     AD8 :                     .grab_prtm:
(1) 2005/     AD8 : 16 00               		ld	d,0
(1) 2006/     ADA : 7B                  		ld	a,e
(1) 2007/     ADB : E6 F0               		and	11110000b
(1) 2008/     ADD : FE F0               		cp	0F0h
(1) 2009/     ADF : 20 07               		jr	nz,.e_nof
(1) 2010/     AE1 : CF                  		rst	8
(1) 2011/     AE2 : 7B                  		ld	a,e
(1) 2012/     AE3 : E6 0F               		and	0Fh
(1) 2013/     AE5 : 87                  		add	a,a
(1) 2014/     AE6 : 18 0E               		jr	.e_go
(1) 2015/     AE8 :                     .e_nof:
(1) 2016/     AE8 : CF                  		rst	8
(1) 2017/     AE9 : FE E0               		cp	0E0h
(1) 2018/     AEB : 20 05               		jr	nz,.e_noef
(1) 2019/     AED : 7B                  		ld	a,e
(1) 2020/     AEE : E6 0F               		and	0Fh
(1) 2021/     AF0 : 18 04               		jr	.e_go
(1) 2022/     AF2 :                     .e_noef:
(1) 2023/     AF2 : CF                  		rst	8
(1) 2024/     AF3 : 7B                  		ld	a,e
(1) 2025/     AF4 : 87                  		add	a,a
(1) 2026/     AF5 : 87                  		add	a,a
(1) 2027/     AF6 :                     .e_go:
(1) 2028/     AF6 : C9                  		ret
(1) 2029/     AF7 :                     
(1) 2030/     AF7 :                     ; --------------------------------
(1) 2031/     AF7 :                     ; Effect X: Panning
(1) 2032/     AF7 :                     ; --------------------------------
(1) 2033/     AF7 :                     
(1) 2034/     AF7 :                     ; PWM points here too.
(1) 2035/     AF7 :                     .effPwm_X:
(1) 2036/     AF7 : 7B                  		ld	a,e
(1) 2037/     AF8 : 07                  		rlca
(1) 2038/     AF9 : 07                  		rlca
(1) 2039/     AFA : E6 03               		and	00000011b
(1) 2040/     AFC : 21 4A 0B            		ld	hl,.fmpan_list
(1) 2041/     AFF : 11 00 00            		ld	de,0
(1) 2042/     B02 : 5F                  		ld	e,a
(1) 2043/     B03 : CF                  		rst	8
(1) 2044/     B04 : 19                  		add	hl,de
(1) 2045/     B05 : 5E                  		ld	e,(hl)
(1) 2046/     B06 : FD 7E 07            		ld	a,(iy+chnl_Flags)
(1) 2047/     B09 : E6 CF               		and	11001111b
(1) 2048/     B0B : B3                  		or	e
(1) 2049/     B0C : FD 77 07            		ld	(iy+chnl_Flags),a
(1) 2050/     B0F : C9                  		ret
(1) 2051/     B10 :                     
(1) 2052/     B10 :                     ; PWM points here too.
(1) 2053/     B10 :                     .effFm_X:
(1) 2054/     B10 : DD 7E 02            		ld	a,(ix+2)
(1) 2055/     B13 : E6 07               		and	111b
(1) 2056/     B15 : 06 00               		ld	b,0
(1) 2057/     B17 : 4F                  		ld	c,a
(1) 2058/     B18 : DD 21 9C 17         		ld	ix,fmcom
(1) 2059/     B1C : DD 09               		add	ix,bc
(1) 2060/     B1E : 7B                  		ld	a,e
(1) 2061/     B1F : 07                  		rlca
(1) 2062/     B20 : 07                  		rlca
(1) 2063/     B21 : E6 03               		and	00000011b
(1) 2064/     B23 : 21 4A 0B            		ld	hl,.fmpan_list
(1) 2065/     B26 : 11 00 00            		ld	de,0
(1) 2066/     B29 : 5F                  		ld	e,a
(1) 2067/     B2A : CF                  		rst	8
(1) 2068/     B2B : 19                  		add	hl,de
(1) 2069/     B2C : 5E                  		ld	e,(hl)
(1) 2070/     B2D : FD 7E 07            		ld	a,(iy+chnl_Flags)
(1) 2071/     B30 : E6 CF               		and	11001111b
(1) 2072/     B32 : B3                  		or	e
(1) 2073/     B33 : FD 77 07            		ld	(iy+chnl_Flags),a
(1) 2074/     B36 : FD 7E 07            		ld	a,(iy+chnl_Flags)
(1) 2075/     B39 : 87                  		add	a,a		; move LR bits
(1) 2076/     B3A : 87                  		add	a,a
(1) 2077/     B3B : 2F                  		cpl
(1) 2078/     B3C : E6 C0               		and	11000000b	; Set Panning ENABLE bits
(1) 2079/     B3E : DD 77 12            		ld	(ix+FMPAN),a
(1) 2080/     B41 :                     
(1) 2081/     B41 :                     ; 		ld	a,(iy+chnl_Flags)
(1) 2082/     B41 :                     ; 		add	a,a		; move LR bits
(1) 2083/     B41 :                     ; 		add	a,a
(1) 2084/     B41 :                     ; 		cpl
(1) 2085/     B41 :                     ; 		and	11000000b	; Set Panning ENABLE bits
(1) 2086/     B41 :                     ; 		ld	(ix+FMPAN),a
(1) 2087/     B41 :                     ; 		ld	e,11110000b	; ALLOWED keys (TEMPORAL)
(1) 2088/     B41 :                     ; 		rst	8
(1) 2089/     B41 :                     ; 		ld	(ix+FMKEYS),e
(1) 2090/     B41 : DD 7E 00            		ld	a,(ix)		; key on
(1) 2091/     B44 : F6 40               		or	01000000b
(1) 2092/     B46 : DD 77 00            		ld	(ix),a
(1) 2093/     B49 :                     
(1) 2094/     B49 : C9                  		ret
(1) 2095/     B4A :                     .fmpan_list:
(1) 2096/     B4A : 10                  		db 00010000b	; 000h
(1) 2097/     B4B : 10                  		db 00010000b	; 040h
(1) 2098/     B4C : 00                  		db 00000000b	; 080h
(1) 2099/     B4D : 20                  		db 00100000b	; 0C0h
(1) 2100/     B4E :                     
(1) 2101/     B4E :                     ; ----------------------------------------
(1) 2102/     B4E :                     ; bit 0
(1) 2103/     B4E :                     ; ----------------------------------------
(1) 2104/     B4E :                     
(1) 2105/     B4E :                     .req_note:
(1) 2106/     B4E : 2A C7 19            		ld	hl,(currInsPos)
(1) 2107/     B51 : DD 2A C5 19         		ld	ix,(currTblPos)
(1) 2108/     B55 : 7E                  		ld	a,(hl)
(1) 2109/     B56 : 4F                  		ld	c,a		; special copy
(1) 2110/     B57 : E6 F0               		and	11110000b
(1) 2111/     B59 : FE 80               		cp	80h		; PSG normal
(1) 2112/     B5B : CA 37 0C            		jp	z,.note_psg
(1) 2113/     B5E : FE 90               		cp	90h		; PSG noise
(1) 2114/     B60 : CA 0A 0C            		jp	z,.note_psgn
(1) 2115/     B63 : FE A0               		cp	0A0h
(1) 2116/     B65 : CA 08 0D            		jp	z,.note_fm
(1) 2117/     B68 : CF                  		rst	8
(1) 2118/     B69 : FE B0               		cp	0B0h
(1) 2119/     B6B : CA E4 0C            		jp	z,.note_fm3
(1) 2120/     B6E : FE C0               		cp	0C0h
(1) 2121/     B70 : CA A1 0C            		jp	z,.note_dac
(1) 2122/     B73 : FE D0               		cp	0D0h
(1) 2123/     B75 : CA 79 0B            		jp	z,.note_pwm
(1) 2124/     B78 : C9                  		ret
(1) 2125/     B79 :                     
(1) 2126/     B79 :                     ; --------------------------------
(1) 2127/     B79 :                     ; Note: PWM
(1) 2128/     B79 :                     ; --------------------------------
(1) 2129/     B79 :                     
(1) 2130/     B79 :                     .note_pwm:
(1) 2131/     B79 : 3E 01               		ld	a,1			; Send MARS request
(1) 2132/     B7B : 32 CC 19            		ld	(marsUpd),a
(1) 2133/     B7E : 21 6A 1A            		ld	hl,pwmcom
(1) 2134/     B81 : DD 7E 02            		ld	a,(ix+2)
(1) 2135/     B84 : E6 07               		and	000111b
(1) 2136/     B86 : 06 00               		ld	b,0
(1) 2137/     B88 : 4F                  		ld	c,a
(1) 2138/     B89 : 09                  		add	hl,bc
(1) 2139/     B8A : CF                  		rst	8
(1) 2140/     B8B : FD 7E 01            		ld	a,(iy+chnl_Note)
(1) 2141/     B8E : FE FF               		cp	-1
(1) 2142/     B90 : CA DB 0B            		jp	z,.pwm_keyoff
(1) 2143/     B93 : FE FE               		cp	-2
(1) 2144/     B95 : CA DF 0B            		jp	z,.pwm_keycut
(1) 2145/     B98 : 11 00 00            		ld	de,0
(1) 2146/     B9B : DD 5E 03            		ld	e,(ix+3)		; Get pitch
(1) 2147/     B9E : 83                  		add	a,e
(1) 2148/     B9F : 87                  		add	a,a
(1) 2149/     BA0 : CF                  		rst	8
(1) 2150/     BA1 : 5F                  		ld	e,a
(1) 2151/     BA2 : 79                  		ld	a,c
(1) 2152/     BA3 : F6 D0               		or	0D0h
(1) 2153/     BA5 : FD 77 00            		ld	(iy+chnl_Chip),a	; Set as PWM
(1) 2154/     BA8 : E5                  		push	hl
(1) 2155/     BA9 : DD E1               		pop	ix
(1) 2156/     BAB : 21 78 16            		ld	hl,wavFreq_List
(1) 2157/     BAE : 19                  		add	hl,de
(1) 2158/     BAF : 5E                  		ld	e,(hl)
(1) 2159/     BB0 : 23                  		inc	hl
(1) 2160/     BB1 : 56                  		ld	d,(hl)			; note: max 111b
(1) 2161/     BB2 : CF                  		rst	8
(1) 2162/     BB3 : DD CB 00 C6         		set	0,(ix)			; Note-on
(1) 2163/     BB7 : 7A                  		ld	a,d
(1) 2164/     BB8 : FD CB 07 56         		bit	2,(iy+chnl_Flags)	; check if volume is being used
(1) 2165/     BBC : 28 06               		jr	z,.pwmn_kpv
(1) 2166/     BBE : DD 7E 08            		ld	a,(ix+PWPTH_V)
(1) 2167/     BC1 : E6 FC               		and	11111100b
(1) 2168/     BC3 : B2                  		or	d
(1) 2169/     BC4 :                     .pwmn_kpv:
(1) 2170/     BC4 : DD 77 08            		ld	(ix+PWPTH_V),a
(1) 2171/     BC7 : DD 73 10            		ld	(ix+PWPHL),e
(1) 2172/     BCA : DD 7E 18            		ld	a,(ix+PWOUTF)
(1) 2173/     BCD : E6 CF               		and	11001111b		; Keep other bits
(1) 2174/     BCF : 4F                  		ld	c,a
(1) 2175/     BD0 : FD 7E 07            		ld	a,(iy+chnl_Flags)	; 00LR 0000
(1) 2176/     BD3 : 2F                  		cpl
(1) 2177/     BD4 : E6 30               		and	00110000b
(1) 2178/     BD6 : B1                  		or	c
(1) 2179/     BD7 : DD 77 18            		ld	(ix+PWOUTF),a
(1) 2180/     BDA : C9                  		ret
(1) 2181/     BDB :                     
(1) 2182/     BDB :                     ; PSG Keyoff
(1) 2183/     BDB :                     .pwm_keyoff:
(1) 2184/     BDB : 0E 02               		ld	c,010b
(1) 2185/     BDD : 71                  		ld	(hl),c
(1) 2186/     BDE : C9                  		ret
(1) 2187/     BDF :                     .pwm_keycut:
(1) 2188/     BDF : 0E 04               		ld	c,100b
(1) 2189/     BE1 : 18 06               		jr	.chnl_unlink
(1) 2190/     BE3 :                     
(1) 2191/     BE3 :                     ; 		ld	a,100b			; Request DAC stop
(1) 2192/     BE3 :                     ; 		ld	(daccom),a
(1) 2193/     BE3 :                     ; .doff:
(1) 2194/     BE3 :                     ; 		ld	hl,0
(1) 2195/     BE3 :                     ; 		ld	(tblFM6),hl
(1) 2196/     BE3 :                     ; 		ld	(iy+chnl_Chip),0
(1) 2197/     BE3 :                     ; 		ret
(1) 2198/     BE3 :                     
(1) 2199/     BE3 :                     ; --------------------------------
(1) 2200/     BE3 :                     ; Note: PSG1-3,PSGN
(1) 2201/     BE3 :                     ; --------------------------------
(1) 2202/     BE3 :                     
(1) 2203/     BE3 :                     ; PSG Keyoff
(1) 2204/     BE3 :                     .poff:
(1) 2205/     BE3 : 0E 02               		ld	c,010b
(1) 2206/     BE5 : 71                  		ld	(hl),c
(1) 2207/     BE6 : C9                  		ret
(1) 2208/     BE7 :                     ; PSG Keycut
(1) 2209/     BE7 :                     .pcut:
(1) 2210/     BE7 : 0E 04               		ld	c,100b
(1) 2211/     BE9 :                     .chnl_unlink:
(1) 2212/     BE9 : CF                  		rst	8
(1) 2213/     BEA : FD E5               		push	iy
(1) 2214/     BEC : D1                  		pop	de
(1) 2215/     BED : DD 7E 00            		ld	a,(ix)
(1) 2216/     BF0 : BB                  		cp	e
(1) 2217/     BF1 : C0                  		ret	nz
(1) 2218/     BF2 : DD 7E 01            		ld	a,(ix+1)
(1) 2219/     BF5 : BA                  		cp	d
(1) 2220/     BF6 : C0                  		ret	nz
(1) 2221/     BF7 : CF                  		rst	8
(1) 2222/     BF8 : 71                  		ld	(hl),c
(1) 2223/     BF9 : DD 36 00 00         		ld	(ix),0
(1) 2224/     BFD : DD 36 01 00         		ld	(ix+1),0
(1) 2225/     C01 : DD 36 03 00         		ld	(ix+3),0	; pitch zero
(1) 2226/     C05 : FD 36 00 00         		ld	(iy+chnl_Chip),0
(1) 2227/     C09 :                     ; 		ld	a,(iy+chnl_Flags)
(1) 2228/     C09 :                     ; 		and	11001111b
(1) 2229/     C09 :                     ; 		ld	(iy+chnl_Flags),a
(1) 2230/     C09 : C9                  		ret
(1) 2231/     C0A :                     
(1) 2232/     C0A :                     ; Play PSG note
(1) 2233/     C0A :                     .note_psgn:
(1) 2234/     C0A : DD 7E 02            		ld	a,(ix+2)
(1) 2235/     C0D : F6 90               		or	90h
(1) 2236/     C0F : FD 77 00            		ld	(iy+chnl_Chip),a
(1) 2237/     C12 : 21 6B 17            		ld 	hl,psgcom+3
(1) 2238/     C15 : FD 7E 01            		ld	a,(iy+chnl_Note)
(1) 2239/     C18 : FE FE               		cp	-2
(1) 2240/     C1A : CA E7 0B            		jp	z,.pcut
(1) 2241/     C1D : FE FF               		cp	-1
(1) 2242/     C1F : CA E3 0B            		jp	z,.poff
(1) 2243/     C22 : 5F                  		ld	e,a
(1) 2244/     C23 : DD 7E 04            		ld 	a,(ix+4)
(1) 2245/     C26 : 32 F7 1E            		ld	(psgHatMode),a
(1) 2246/     C29 : E6 03               		and	011b
(1) 2247/     C2B : FE 03               		cp	011b
(1) 2248/     C2D : 20 05               		jr	nz,.np2_n
(1) 2249/     C2F : 3E 04               		ld	a,100b
(1) 2250/     C31 : 32 6A 17            		ld	(psgcom+2),a
(1) 2251/     C34 :                     .np2_n:
(1) 2252/     C34 : 7B                  		ld	a,e
(1) 2253/     C35 : 18 32               		jr	.notepsg_fn
(1) 2254/     C37 :                     .note_psg:
(1) 2255/     C37 : DD 7E 02            		ld	a,(ix+2)
(1) 2256/     C3A : F6 80               		or	80h
(1) 2257/     C3C : FD 77 00            		ld	(iy+chnl_Chip),a
(1) 2258/     C3F : DD 7E 02            		ld	a,(ix+2)
(1) 2259/     C42 : CF                  		rst	8
(1) 2260/     C43 : E6 03               		and	11b
(1) 2261/     C45 : 16 00               		ld	d,0
(1) 2262/     C47 : 5F                  		ld	e,a
(1) 2263/     C48 : 21 68 17            		ld 	hl,psgcom
(1) 2264/     C4B : 19                  		add	hl,de
(1) 2265/     C4C : FE 02               		cp	2
(1) 2266/     C4E : 20 0C               		jr	nz,.notepsg_c
(1) 2267/     C50 : 3A F7 1E            		ld	a,(psgHatMode)
(1) 2268/     C53 : E6 03               		and	011b
(1) 2269/     C55 : FE 03               		cp	011b
(1) 2270/     C57 : 20 03               		jr	nz,.notepsg_c
(1) 2271/     C59 : 36 04               		ld	(hl),100b	; key-cut PSG3 but dont unlink
(1) 2272/     C5B : C9                  		ret
(1) 2273/     C5C :                     .notepsg_c:
(1) 2274/     C5C : FD 7E 01            		ld	a,(iy+chnl_Note)
(1) 2275/     C5F : FE FE               		cp	-2
(1) 2276/     C61 : CA E7 0B            		jp	z,.pcut
(1) 2277/     C64 : FE FF               		cp	-1
(1) 2278/     C66 : CA E3 0B            		jp	z,.poff
(1) 2279/     C69 :                     .notepsg_fn:
(1) 2280/     C69 : CF                  		rst	8
(1) 2281/     C6A : E5                  		push	hl		; save psgcom
(1) 2282/     C6B : 21 86 15            		ld	hl,psgFreq_List
(1) 2283/     C6E : DD 4E 03            		ld	c,(ix+3)
(1) 2284/     C71 : 81                  		add	a,c
(1) 2285/     C72 : 87                  		add	a,a
(1) 2286/     C73 : 11 00 00            		ld	de,0
(1) 2287/     C76 : 5F                  		ld	e,a
(1) 2288/     C77 : 19                  		add	hl,de
(1) 2289/     C78 : 5E                  		ld	e,(hl)
(1) 2290/     C79 : 23                  		inc	hl
(1) 2291/     C7A : 56                  		ld	d,(hl)
(1) 2292/     C7B : 01 00 00            		ld	bc,0
(1) 2293/     C7E : E6 03               		and	11b
(1) 2294/     C80 : 4F                  		ld	c,a
(1) 2295/     C81 : DD E5               		push	ix		; swap ix to hl
(1) 2296/     C83 : E1                  		pop	hl
(1) 2297/     C84 : CF                  		rst	8
(1) 2298/     C85 : 23                  		inc	hl		; skip link
(1) 2299/     C86 : 23                  		inc	hl
(1) 2300/     C87 : 23                  		inc 	hl		; channel id
(1) 2301/     C88 : 23                  		inc	hl		; pitch
(1) 2302/     C89 :                     ; 		ld	a,c
(1) 2303/     C89 :                     ; 		cp	3
(1) 2304/     C89 :                     ; 		jr	nz,.npsg2
(1) 2305/     C89 :                     ; 		ld 	a,(ix+4)
(1) 2306/     C89 :                     ; 		ld	(psgHatMode),a
(1) 2307/     C89 :                     ; .npsg2:
(1) 2308/     C89 : DD E1               		pop	ix			; restore psgcom as ix
(1) 2309/     C8B : FD 7E 07            		ld	a,(iy+chnl_Flags)	; Check is volume bit
(1) 2310/     C8E : CB 57               		bit	2,a			; is being used
(1) 2311/     C90 : 20 04               		jr	nz,.nodefv
(1) 2312/     C92 : DD 36 30 00         		ld	(ix+PVOL),0		; if not, set max volume
(1) 2313/     C96 :                     .nodefv:
(1) 2314/     C96 : DD 73 1C            		ld	(ix+DTL),e
(1) 2315/     C99 : DD 72 20            		ld	(ix+DTH),d
(1) 2316/     C9C : DD 36 00 01         		ld	(ix+COM),001b	; Key ON
(1) 2317/     CA0 : C9                  		ret
(1) 2318/     CA1 :                     
(1) 2319/     CA1 :                     ; --------------------------------
(1) 2320/     CA1 :                     ; Note: FM,FM3,FM6
(1) 2321/     CA1 :                     ; --------------------------------
(1) 2322/     CA1 :                     
(1) 2323/     CA1 :                     .note_dac:
(1) 2324/     CA1 : 21 BC 18            		ld	hl,daccom
(1) 2325/     CA4 : FD 7E 01            		ld	a,(iy+chnl_Note)
(1) 2326/     CA7 : FE FF               		cp	-1
(1) 2327/     CA9 : CA A0 0D            		jp	z,.fm_keyoff
(1) 2328/     CAC : FE FE               		cp	-2
(1) 2329/     CAE : CA A4 0D            		jp	z,.fm_keycut
(1) 2330/     CB1 : FD 36 00 C0         		ld	(iy+chnl_Chip),0C0h	; Set as DAC
(1) 2331/     CB5 : 11 00 00            		ld	de,0
(1) 2332/     CB8 : DD 5E 03            		ld	e,(ix+3)		; Get pitch
(1) 2333/     CBB : 83                  		add	a,e
(1) 2334/     CBC : 87                  		add	a,a
(1) 2335/     CBD : 5F                  		ld	e,a
(1) 2336/     CBE : 21 78 16            		ld	hl,wavFreq_List
(1) 2337/     CC1 : 19                  		add	hl,de
(1) 2338/     CC2 : 7E                  		ld	a,(hl)
(1) 2339/     CC3 : 23                  		inc	hl
(1) 2340/     CC4 : 66                  		ld	h,(hl)
(1) 2341/     CC5 : CF                  		rst	8
(1) 2342/     CC6 : 6F                  		ld	l,a
(1) 2343/     CC7 : 11 E8 FF            		ld	de,ZSET_WTUNE		; Fine-tune to desired
(1) 2344/     CCA : 19                  		add	hl,de			; WAVE frequency
(1) 2345/     CCB : 22 D9 19            		ld	(wave_Pitch),hl
(1) 2346/     CCE :                     ; 		ld	a,1
(1) 2347/     CCE :                     ; 		and	001b
(1) 2348/     CCE :                     ; 		ld	(wave_Flags),a
(1) 2349/     CCE : 3E 01               		ld	a,001b			; Request DAC play
(1) 2350/     CD0 : 32 BC 18            		ld	(daccom),a
(1) 2351/     CD3 : C9                  		ret
(1) 2352/     CD4 :                     .dcut:
(1) 2353/     CD4 : 3E 04               		ld	a,100b			; Request DAC stop
(1) 2354/     CD6 : 32 BC 18            		ld	(daccom),a
(1) 2355/     CD9 :                     .doff:
(1) 2356/     CD9 : 21 00 00            		ld	hl,0
(1) 2357/     CDC : 22 26 1A            		ld	(tblFM6),hl
(1) 2358/     CDF : FD 36 00 00         		ld	(iy+chnl_Chip),0
(1) 2359/     CE3 : C9                  		ret
(1) 2360/     CE4 :                     ; FM3 special
(1) 2361/     CE4 :                     .note_fm3:
(1) 2362/     CE4 : 21 9E 17            		ld	hl,fmcom+2		; Channel 3 fmcom
(1) 2363/     CE7 : FD 7E 01            		ld	a,(iy+chnl_Note)
(1) 2364/     CEA : FE FF               		cp	-1
(1) 2365/     CEC : CA A0 0D            		jp	z,.fm_keyoff
(1) 2366/     CEF : FE FE               		cp	-2
(1) 2367/     CF1 : CA A4 0D            		jp	z,.fm_keycut
(1) 2368/     CF4 : FD 36 00 B0         		ld	(iy+chnl_Chip),0B0h	; Set as FM3 special
(1) 2369/     CF8 : 16 27               		ld	d,27h
(1) 2370/     CFA : 3E 40               		ld	a,01000000b
(1) 2371/     CFC : 32 F8 1E            		ld	(fmSpcMode),a
(1) 2372/     CFF : 5F                  		ld	e,a
(1) 2373/     D00 : CD 20 14            		call	fm_send_1
(1) 2374/     D03 : E5                  		push	hl
(1) 2375/     D04 : DD E1               		pop	ix
(1) 2376/     D06 : 18 74               		jr	.fm_chnlkon
(1) 2377/     D08 :                     ; Normal FM
(1) 2378/     D08 :                     .note_fm:
(1) 2379/     D08 : FD 7E 01            		ld	a,(iy+chnl_Note)
(1) 2380/     D0B : 57                  		ld	d,a
(1) 2381/     D0C : DD 5E 03            		ld	e,(ix+3)
(1) 2382/     D0F : 83                  		add	a,e
(1) 2383/     D10 : CF                  		rst	8
(1) 2384/     D11 : 4F                  		ld	c,a			; c - Note+pitch
(1) 2385/     D12 : DD 7E 02            		ld	a,(ix+2)
(1) 2386/     D15 : 47                  		ld	b,a
(1) 2387/     D16 : E6 07               		and	00000111b
(1) 2388/     D18 : 21 9C 17            		ld	hl,fmcom		; hl - fmcom list
(1) 2389/     D1B : 11 00 00            		ld	de,0
(1) 2390/     D1E : E6 07               		and	111b
(1) 2391/     D20 : 5F                  		ld	e,a
(1) 2392/     D21 : 19                  		add	hl,de
(1) 2393/     D22 : CF                  		rst	8
(1) 2394/     D23 : FD 7E 01            		ld	a,(iy+chnl_Note)
(1) 2395/     D26 : FE FF               		cp	-1
(1) 2396/     D28 : 28 76               		jr	z,.fm_keyoff
(1) 2397/     D2A : FE FE               		cp	-2
(1) 2398/     D2C : 28 76               		jr	z,.fm_keycut
(1) 2399/     D2E : 78                  		ld	a,b			; Set chip as FM
(1) 2400/     D2F : E6 07               		and	111b
(1) 2401/     D31 : FE 02               		cp	2			; Check if we got into channel 3
(1) 2402/     D33 : 20 0E               		jr	nz,.rd_nt3
(1) 2403/     D35 : 47                  		ld	b,a
(1) 2404/     D36 : 16 27               		ld	d,27h			; Disable CH3 special mode
(1) 2405/     D38 : 3E 00               		ld	a,00000000b
(1) 2406/     D3A : 32 F8 1E            		ld	(fmSpcMode),a
(1) 2407/     D3D : CF                  		rst	8
(1) 2408/     D3E : 5F                  		ld	e,a
(1) 2409/     D3F : CD 20 14            		call	fm_send_1
(1) 2410/     D42 : 78                  		ld	a,b
(1) 2411/     D43 :                     .rd_nt3:
(1) 2412/     D43 : F6 A0               		or	0A0h
(1) 2413/     D45 : FD 77 00            		ld	(iy+chnl_Chip),a
(1) 2414/     D48 : 79                  		ld	a,c
(1) 2415/     D49 : CF                  		rst	8
(1) 2416/     D4A : 06 00               		ld	b,0			; b - octave
(1) 2417/     D4C : 1E 07               		ld	e,7
(1) 2418/     D4E :                     .get_oct:
(1) 2419/     D4E : 4F                  		ld	c,a
(1) 2420/     D4F : D6 0C               		sub	12
(1) 2421/     D51 : B7                  		or	a
(1) 2422/     D52 : FA 59 0D            		jp	m,.fnd_oct
(1) 2423/     D55 : 04                  		inc	b
(1) 2424/     D56 : 1D                  		dec	e
(1) 2425/     D57 : 20 F5               		jr	nz,.get_oct
(1) 2426/     D59 :                     .fnd_oct:
(1) 2427/     D59 :                     	; b - octave / c - note
(1) 2428/     D59 : D5                  		push	de
(1) 2429/     D5A : CF                  		rst	8		; ix - current fmcom
(1) 2430/     D5B : 79                  		ld	a,c
(1) 2431/     D5C : 87                  		add	a,a
(1) 2432/     D5D : 4F                  		ld	c,a		; c - freq word
(1) 2433/     D5E : 78                  		ld	a,b
(1) 2434/     D5F : 87                  		add	a,a
(1) 2435/     D60 : 87                  		add	a,a
(1) 2436/     D61 : 87                  		add	a,a
(1) 2437/     D62 : 06 00               		ld	b,0
(1) 2438/     D64 : E5                  		push	hl
(1) 2439/     D65 : CF                  		rst	8
(1) 2440/     D66 : DD E1               		pop	ix
(1) 2441/     D68 : 21 6E 15            		ld	hl,fmFreq_List
(1) 2442/     D6B : 09                  		add	hl,bc
(1) 2443/     D6C : 23                  		inc	hl
(1) 2444/     D6D : 4F                  		ld	c,a		; c - octave << 3
(1) 2445/     D6E : 7E                  		ld	a,(hl)		; Note MSB
(1) 2446/     D6F : B1                  		or	c		; add octave
(1) 2447/     D70 : 57                  		ld	d,a
(1) 2448/     D71 : 2B                  		dec	hl
(1) 2449/     D72 : CF                  		rst	8
(1) 2450/     D73 : 7E                  		ld	a,(hl)
(1) 2451/     D74 : 5F                  		ld	e,a
(1) 2452/     D75 : DD 72 18            		ld	(ix+FMFRQH),d	; Save freq MSB
(1) 2453/     D78 : DD 73 1E            		ld	(ix+FMFRQL),e	; Save freq LSB
(1) 2454/     D7B : D1                  		pop	de
(1) 2455/     D7C :                     .fm_chnlkon:
(1) 2456/     D7C : FD 7E 07            		ld	a,(iy+chnl_Flags)
(1) 2457/     D7F : 87                  		add	a,a		; move LR bits
(1) 2458/     D80 : 87                  		add	a,a
(1) 2459/     D81 : 2F                  		cpl
(1) 2460/     D82 : E6 C0               		and	11000000b	; Set Panning ENABLE bits
(1) 2461/     D84 : DD 77 12            		ld	(ix+FMPAN),a
(1) 2462/     D87 : 1E F0               		ld	e,11110000b	; ALLOWED keys (TEMPORAL)
(1) 2463/     D89 : CF                  		rst	8
(1) 2464/     D8A : DD 73 06            		ld	(ix+FMKEYS),e
(1) 2465/     D8D : DD 7E 00            		ld	a,(ix)		; key on
(1) 2466/     D90 : F6 41               		or	01000001b
(1) 2467/     D92 : DD 77 00            		ld	(ix),a
(1) 2468/     D95 : FD CB 07 56         		bit	2,(iy+chnl_Flags)	; check if volume is being used
(1) 2469/     D99 : 20 04               		jr	nz,.fm_kpv
(1) 2470/     D9B : DD 36 0C 00         		ld	(ix+FMVOL),0
(1) 2471/     D9F :                     .fm_kpv:
(1) 2472/     D9F : C9                  		ret
(1) 2473/     DA0 :                     
(1) 2474/     DA0 :                     ; keyoff/cut
(1) 2475/     DA0 :                     .fm_keyoff:
(1) 2476/     DA0 : 0E 02               		ld	c,010b
(1) 2477/     DA2 : 71                  		ld	(hl),c
(1) 2478/     DA3 : C9                  		ret
(1) 2479/     DA4 :                     .fm_keycut:
(1) 2480/     DA4 : 0E 04               		ld	c,100b
(1) 2481/     DA6 :                     .fm_dlink:
(1) 2482/     DA6 : C3 E9 0B            		jp	.chnl_unlink
(1) 2483/     DA9 :                     
(1) 2484/     DA9 :                     ; ----------------------------------------
(1) 2485/     DA9 :                     ; Channel chip swap
(1) 2486/     DA9 :                     ; ----------------------------------------
(1) 2487/     DA9 :                     
(1) 2488/     DA9 :                     .chip_swap:
(1) 2489/     DA9 : 4F                  		ld	c,a		; c - New chip ID
(1) 2490/     DAA : E6 F0               		and	11110000b
(1) 2491/     DAC : 47                  		ld	b,a
(1) 2492/     DAD : FD 7E 00            		ld	a,(iy+chnl_Chip)
(1) 2493/     DB0 : CF                  		rst	8
(1) 2494/     DB1 : 5F                  		ld	e,a		; e - Old chip ID
(1) 2495/     DB2 : E6 F0               		and	11110000b
(1) 2496/     DB4 : B8                  		cp	b
(1) 2497/     DB5 : 28 2E               		jr	z,.chip_out
(1) 2498/     DB7 : 57                  		ld	d,a		; d - reuse last ID
(1) 2499/     DB8 : 79                  		ld	a,c		; New chip-ins is null?
(1) 2500/     DB9 : FE FF               		cp	-1
(1) 2501/     DBB : 20 05               		jr	nz,.from_nl
(1) 2502/     DBD : 7B                  		ld	a,e		; Reuse OLD ID
(1) 2503/     DBE : CF                  		rst	8
(1) 2504/     DBF : E6 F0               		and	11110000b
(1) 2505/     DC1 : 57                  		ld	d,a		; new id to check
(1) 2506/     DC2 :                     .from_nl:
(1) 2507/     DC2 : 7A                  		ld	a,d
(1) 2508/     DC3 : 16 00               		ld	d,0
(1) 2509/     DC5 : FE 80               		cp	80h
(1) 2510/     DC7 : CC 34 0E            		call	z,.psg_out
(1) 2511/     DCA : FE 90               		cp	90h
(1) 2512/     DCC : CC 26 0E            		call	z,.psgn_out
(1) 2513/     DCF : CF                  		rst	8
(1) 2514/     DD0 : FE A0               		cp	0A0h
(1) 2515/     DD2 : CC 54 0E            		call	z,.fm_out
(1) 2516/     DD5 : FE B0               		cp	0B0h
(1) 2517/     DD7 : CC 18 0E            		call	z,.fm3_out
(1) 2518/     DDA : FE C0               		cp	0C0h
(1) 2519/     DDC : CC 0A 0E            		call	z,.dac_out
(1) 2520/     DDF : FE D0               		cp	0D0h
(1) 2521/     DE1 : CC E7 0D            		call	z,.pwm_out
(1) 2522/     DE4 : CF                  		rst	8
(1) 2523/     DE5 :                     .chip_out:
(1) 2524/     DE5 : 79                  		ld	a,c
(1) 2525/     DE6 : C9                  		ret
(1) 2526/     DE7 :                     
(1) 2527/     DE7 :                     .pwm_out:
(1) 2528/     DE7 : E5                  		push	hl
(1) 2529/     DE8 : 7B                  		ld	a,e
(1) 2530/     DE9 : E6 07               		and	111b
(1) 2531/     DEB : 47                  		ld	b,a
(1) 2532/     DEC : 5F                  		ld	e,a
(1) 2533/     DED : CF                  		rst	8
(1) 2534/     DEE : 87                  		add	a,a
(1) 2535/     DEF : 87                  		add	a,a
(1) 2536/     DF0 : 87                  		add	a,a
(1) 2537/     DF1 : 5F                  		ld	e,a
(1) 2538/     DF2 : 21 30 1A            		ld	hl,tblPWM
(1) 2539/     DF5 : 19                  		add	hl,de
(1) 2540/     DF6 : CD 72 0E            		call	.chp_unlk
(1) 2541/     DF9 : CF                  		rst	8
(1) 2542/     DFA : 16 00               		ld	d,0
(1) 2543/     DFC : 58                  		ld	e,b
(1) 2544/     DFD : 21 6A 1A            		ld	hl,pwmcom
(1) 2545/     E00 : 19                  		add	hl,de
(1) 2546/     E01 : 36 04               		ld	(hl),100b
(1) 2547/     E03 : 3E 01               		ld	a,1
(1) 2548/     E05 : 32 CC 19            		ld	(marsUpd),a
(1) 2549/     E08 : 18 48               		jr	.p_out
(1) 2550/     E0A :                     
(1) 2551/     E0A :                     .dac_out:
(1) 2552/     E0A : E5                  		push	hl
(1) 2553/     E0B : 21 26 1A            		ld	hl,tblFM6
(1) 2554/     E0E : CD 72 0E            		call	.chp_unlk
(1) 2555/     E11 : 21 BC 18            		ld	hl,daccom
(1) 2556/     E14 : 36 04               		ld	(hl),100b
(1) 2557/     E16 : E1                  		pop	hl
(1) 2558/     E17 : C9                  		ret
(1) 2559/     E18 :                     .fm3_out:
(1) 2560/     E18 : E5                  		push	hl
(1) 2561/     E19 : 21 1E 1A            		ld	hl,tblFM3
(1) 2562/     E1C : CD 72 0E            		call	.chp_unlk
(1) 2563/     E1F : 21 9E 17            		ld	hl,fmcom+2
(1) 2564/     E22 : 36 04               		ld	(hl),100b
(1) 2565/     E24 : E1                  		pop	hl
(1) 2566/     E25 : C9                  		ret
(1) 2567/     E26 :                     .psgn_out:
(1) 2568/     E26 : E5                  		push	hl
(1) 2569/     E27 : 21 F6 19            		ld	hl,tblPSGN
(1) 2570/     E2A : CD 72 0E            		call	.chp_unlk
(1) 2571/     E2D : 21 6B 17            		ld	hl,psgcom+3
(1) 2572/     E30 : 36 04               		ld	(hl),100b
(1) 2573/     E32 : E1                  		pop	hl
(1) 2574/     E33 : C9                  		ret
(1) 2575/     E34 :                     .psg_out:
(1) 2576/     E34 : E5                  		push	hl
(1) 2577/     E35 : 7B                  		ld	a,e
(1) 2578/     E36 : E6 03               		and	011b
(1) 2579/     E38 : 47                  		ld	b,a
(1) 2580/     E39 : 5F                  		ld	e,a
(1) 2581/     E3A : 87                  		add	a,a
(1) 2582/     E3B : CF                  		rst	8
(1) 2583/     E3C : 87                  		add	a,a
(1) 2584/     E3D : 87                  		add	a,a
(1) 2585/     E3E : 5F                  		ld	e,a
(1) 2586/     E3F : 21 DC 19            		ld	hl,tblPSG
(1) 2587/     E42 : 19                  		add	hl,de
(1) 2588/     E43 : CD 72 0E            		call	.chp_unlk
(1) 2589/     E46 : 20 0A               		jr	nz,.p_out
(1) 2590/     E48 : CF                  		rst	8
(1) 2591/     E49 : 16 00               		ld	d,0
(1) 2592/     E4B : 58                  		ld	e,b
(1) 2593/     E4C : 21 68 17            		ld	hl,psgcom
(1) 2594/     E4F : 19                  		add	hl,de
(1) 2595/     E50 : 36 04               		ld	(hl),100b
(1) 2596/     E52 :                     .p_out:
(1) 2597/     E52 : E1                  		pop	hl
(1) 2598/     E53 : C9                  		ret
(1) 2599/     E54 :                     .fm_out:
(1) 2600/     E54 : E5                  		push	hl
(1) 2601/     E55 : 7B                  		ld	a,e
(1) 2602/     E56 : E6 07               		and	111b
(1) 2603/     E58 : 47                  		ld	b,a
(1) 2604/     E59 : 5F                  		ld	e,a
(1) 2605/     E5A : CF                  		rst	8
(1) 2606/     E5B : 87                  		add	a,a
(1) 2607/     E5C : 87                  		add	a,a
(1) 2608/     E5D : 87                  		add	a,a
(1) 2609/     E5E : 5F                  		ld	e,a
(1) 2610/     E5F : 21 FE 19            		ld	hl,tblFM
(1) 2611/     E62 : 19                  		add	hl,de
(1) 2612/     E63 : CD 72 0E            		call	.chp_unlk
(1) 2613/     E66 : CF                  		rst	8
(1) 2614/     E67 : 16 00               		ld	d,0
(1) 2615/     E69 : 58                  		ld	e,b
(1) 2616/     E6A : 21 9C 17            		ld	hl,fmcom
(1) 2617/     E6D : 19                  		add	hl,de
(1) 2618/     E6E : 36 04               		ld	(hl),100b
(1) 2619/     E70 : 18 E0               		jr	.p_out
(1) 2620/     E72 :                     
(1) 2621/     E72 :                     .chp_unlk:
(1) 2622/     E72 : FD E5               		push	iy
(1) 2623/     E74 : D1                  		pop	de
(1) 2624/     E75 : CF                  		rst	8
(1) 2625/     E76 : 7E                  		ld	a,(hl)
(1) 2626/     E77 : BB                  		cp	e
(1) 2627/     E78 : C0                  		ret	nz
(1) 2628/     E79 : 23                  		inc	hl
(1) 2629/     E7A : 7E                  		ld	a,(hl)
(1) 2630/     E7B : BA                  		cp	d
(1) 2631/     E7C : C0                  		ret	nz
(1) 2632/     E7D : 2B                  		dec	hl
(1) 2633/     E7E : CF                  		rst	8
(1) 2634/     E7F : 36 00               		ld	(hl),0
(1) 2635/     E81 : 23                  		inc	hl
(1) 2636/     E82 : 36 00               		ld	(hl),0
(1) 2637/     E84 : 23                  		inc	hl
(1) 2638/     E85 : 5E                  		ld	e,(hl)	; c - ID
(1) 2639/     E86 : 23                  		inc	hl
(1) 2640/     E87 : 36 00               		ld	(hl),0	; reset 5 bytes of settings
(1) 2641/     E89 : CF                  		rst	8
(1) 2642/     E8A : 23                  		inc	hl
(1) 2643/     E8B : 36 00               		ld	(hl),0
(1) 2644/     E8D : 23                  		inc	hl
(1) 2645/     E8E : 36 00               		ld	(hl),0
(1) 2646/     E90 : 23                  		inc	hl
(1) 2647/     E91 : 36 00               		ld	(hl),0
(1) 2648/     E93 : 23                  		inc	hl
(1) 2649/     E94 : 36 00               		ld	(hl),0
(1) 2650/     E96 : AF                  		xor	a
(1) 2651/     E97 : B7                  		or	a
(1) 2652/     E98 : C9                  		ret
(1) 2653/     E99 :                     
(1) 2654/     E99 :                     ; ----------------------------------------
(1) 2655/     E99 :                     ; Sets current instrument data
(1) 2656/     E99 :                     ;
(1) 2657/     E99 :                     ;   -1 - Null instrument
(1) 2658/     E99 :                     ;  80h - PSG
(1) 2659/     E99 :                     ;  90h - PSG Noise
(1) 2660/     E99 :                     ; 0A0h - FM
(1) 2661/     E99 :                     ; 0B0h - FM3 Special
(1) 2662/     E99 :                     ; 0C0h - FM6 Sample
(1) 2663/     E99 :                     ; 0D0h - PWM (or extra)
(1) 2664/     E99 :                     ; ----------------------------------------
(1) 2665/     E99 :                     
(1) 2666/     E99 :                     .check_ins:
(1) 2667/     E99 : FD 7E 02            		ld	a,(iy+chnl_Ins)
(1) 2668/     E9C : 3D                  		dec	a		; minus 1
(1) 2669/     E9D : F8                  		ret	m		; return as -1 if no ins is used.
(1) 2670/     E9E : 87                  		add	a,a		; * 08h
(1) 2671/     E9F : 87                  		add	a,a
(1) 2672/     EA0 : CF                  		rst	8
(1) 2673/     EA1 : 87                  		add	a,a
(1) 2674/     EA2 : 2A C3 19            		ld	hl,(currInsData)
(1) 2675/     EA5 : 11 00 00            		ld	de,0
(1) 2676/     EA8 : 5F                  		ld	e,a
(1) 2677/     EA9 : 19                  		add	hl,de
(1) 2678/     EAA : 7E                  		ld	a,(hl)
(1) 2679/     EAB : C9                  		ret
(1) 2680/     EAC :                     
(1) 2681/     EAC :                     ; ----------------------------------------
(1) 2682/     EAC :                     ; Checks which channel type is using
(1) 2683/     EAC :                     ; auto-set channel
(1) 2684/     EAC :                     ;
(1) 2685/     EAC :                     ; a - sound chip
(1) 2686/     EAC :                     ; ----------------------------------------
(1) 2687/     EAC :                     
(1) 2688/     EAC :                     .check_chnl:
(1) 2689/     EAC : FE FF               		cp	-1		; if -1: Null
(1) 2690/     EAE : C8                  		ret	z
(1) 2691/     EAF : CF                  		rst	8
(1) 2692/     EB0 : 4F                  		ld	c,a		; save copy to c
(1) 2693/     EB1 : 87                  		add	a,a		; * 2
(1) 2694/     EB2 : 16 00               		ld	d,0
(1) 2695/     EB4 : 0F                  		rrca
(1) 2696/     EB5 : 0F                  		rrca
(1) 2697/     EB6 : 0F                  		rrca
(1) 2698/     EB7 : 0F                  		rrca
(1) 2699/     EB8 : E6 0F               		and	00001111b
(1) 2700/     EBA : 5F                  		ld	e,a
(1) 2701/     EBB : DD 21 DD 0E         		ld	ix,.tbllist	; get table from list
(1) 2702/     EBF : DD 19               		add	ix,de
(1) 2703/     EC1 : DD 5E 00            		ld	e,(ix)
(1) 2704/     EC4 : DD 56 01            		ld	d,(ix+1)
(1) 2705/     EC7 : CF                  		rst	8
(1) 2706/     EC8 : D5                  		push	de
(1) 2707/     EC9 : DD E1               		pop	ix
(1) 2708/     ECB : 79                  		ld	a,c		; restore from c
(1) 2709/     ECC : FE 90               		cp	90h		; type PSGN?
(1) 2710/     ECE : 28 19               		jr	z,.chk_tbln
(1) 2711/     ED0 : FE B0               		cp	0B0h		; type FM3?
(1) 2712/     ED2 : 28 15               		jr	z,.chk_tbln
(1) 2713/     ED4 : FE C0               		cp	0C0h		; type DAC?
(1) 2714/     ED6 : 28 11               		jr	z,.chk_tbln
(1) 2715/     ED8 : 18 2A               		jr	.chk_tbl
(1) 2716/     EDA :                     .bad_ins:
(1) 2717/     EDA : 3E FF               		ld	a,-1
(1) 2718/     EDC : C9                  		ret
(1) 2719/     EDD :                     
(1) 2720/     EDD :                     ; --------------------------------------------
(1) 2721/     EDD :                     
(1) 2722/     EDD :                     .tbllist:
(1) 2723/     EDD : DC 19               		dw tblPSG	;  80h
(1) 2724/     EDF : F6 19               		dw tblPSGN	;  90h
(1) 2725/     EE1 : FE 19               		dw tblFM	; 0A0h
(1) 2726/     EE3 : 1E 1A               		dw tblFM3	; 0B0h
(1) 2727/     EE5 : 26 1A               		dw tblFM6	; 0C0h
(1) 2728/     EE7 : 30 1A               		dw tblPWM	; 0D0h
(1) 2729/     EE9 :                     
(1) 2730/     EE9 :                     ; --------------------------------------------
(1) 2731/     EE9 :                     ; Check SINGLE channel table
(1) 2732/     EE9 :                     ; (FM3,FM6,PSGN)
(1) 2733/     EE9 :                     ; --------------------------------------------
(1) 2734/     EE9 :                     
(1) 2735/     EE9 :                     ; This auto-replaces the LINKED channel
(1) 2736/     EE9 :                     .chk_tbln:
(1) 2737/     EE9 : FD E5               		push	iy
(1) 2738/     EEB : D1                  		pop	de		; de - Copy of curr track-channel
(1) 2739/     EEC : CF                  		rst	8
(1) 2740/     EED : DD 7E 01            		ld	a,(ix+1)
(1) 2741/     EF0 : B7                  		or	a
(1) 2742/     EF1 : 28 05               		jr	z,.new
(1) 2743/     EF3 : BA                  		cp	d		; Same Channel MSB?
(1) 2744/     EF4 : 28 02               		jr	z,.new
(1) 2745/     EF6 : 30 09               		jr	nc,.busy_s	; If not, skip
(1) 2746/     EF8 :                     .new:
(1) 2747/     EF8 : CF                  		rst	8
(1) 2748/     EF9 : DD 73 00            		ld	(ix),e		; NEW slot
(1) 2749/     EFC : DD 72 01            		ld	(ix+1),d
(1) 2750/     EFF : AF                  		xor	a		; Found free slot, pick it.
(1) 2751/     F00 : C9                  		ret
(1) 2752/     F01 :                     .busy_s:
(1) 2753/     F01 : 3E FF               		ld	a,-1
(1) 2754/     F03 : C9                  		ret
(1) 2755/     F04 :                     
(1) 2756/     F04 :                     ; --------------------------------------------
(1) 2757/     F04 :                     ; Check available channel slot from list
(1) 2758/     F04 :                     ; --------------------------------------------
(1) 2759/     F04 :                     
(1) 2760/     F04 :                     .chk_tbl:
(1) 2761/     F04 : 01 00 00            		ld	bc,0		; bc - Free slot point
(1) 2762/     F07 :                     .next:
(1) 2763/     F07 : DD 7E 01            		ld	a,(ix+1)	; Check MSB first
(1) 2764/     F0A : FE FF               		cp	-1		; End of list? (as WORD: 0FFxxh)
(1) 2765/     F0C : 28 3F               		jr	z,.chkfree
(1) 2766/     F0E : FD E5               		push	iy
(1) 2767/     F10 : D1                  		pop	de		; de - Copy of curr track-channel
(1) 2768/     F11 : CF                  		rst	8
(1) 2769/     F12 : BA                  		cp	d
(1) 2770/     F13 : 20 08               		jr	nz,.diffr
(1) 2771/     F15 : DD 7E 00            		ld	a,(ix)
(1) 2772/     F18 : BB                  		cp	e
(1) 2773/     F19 : 20 02               		jr	nz,.diffr
(1) 2774/     F1B : AF                  		xor	a		; return 0
(1) 2775/     F1C : C9                  		ret
(1) 2776/     F1D :                     
(1) 2777/     F1D :                     ; d - MSB to check for auto-priority
(1) 2778/     F1D :                     .diffr:
(1) 2779/     F1D : 79                  		ld	a,c		; already found link at bc?
(1) 2780/     F1E : B0                  		or	b
(1) 2781/     F1F : 20 25               		jr	nz,.alrdfnd
(1) 2782/     F21 : CF                  		rst	8
(1) 2783/     F22 : DD 5E 01            		ld	e,(ix+1)	; Check if this link == 0
(1) 2784/     F25 : DD 7E 00            		ld	a,(ix)
(1) 2785/     F28 : B3                  		or	e
(1) 2786/     F29 : 28 17               		jr	z,.fndlink
(1) 2787/     F2B : D5                  		push	de		; Check if this link is
(1) 2788/     F2C : DD 56 01            		ld	d,(ix+1)	; floating.
(1) 2789/     F2F : DD 5E 00            		ld	e,(ix)
(1) 2790/     F32 : 13                  		inc	de
(1) 2791/     F33 : CF                  		rst	8
(1) 2792/     F34 : 1A                  		ld	a,(de)
(1) 2793/     F35 : D1                  		pop	de
(1) 2794/     F36 : FE FE               		cp	-2
(1) 2795/     F38 : 28 08               		jr	z,.fndlink
(1) 2796/     F3A : FE FF               		cp	-1
(1) 2797/     F3C : 28 04               		jr	z,.fndlink
(1) 2798/     F3E : 7B                  		ld	a,e		; Check if MSB is higher
(1) 2799/     F3F : BA                  		cp	d
(1) 2800/     F40 : 30 04               		jr	nc,.alrdfnd
(1) 2801/     F42 :                     .fndlink:
(1) 2802/     F42 : DD E5               		push	ix		; bc - got new link
(1) 2803/     F44 : C1                  		pop	bc
(1) 2804/     F45 : CF                  		rst	8
(1) 2805/     F46 :                     .alrdfnd:
(1) 2806/     F46 : 11 08 00            		ld	de,8		; Next channel table
(1) 2807/     F49 : DD 19               		add	ix,de
(1) 2808/     F4B : 18 BA               		jr	.next
(1) 2809/     F4D :                     
(1) 2810/     F4D :                     ; free link slot
(1) 2811/     F4D :                     .chkfree:
(1) 2812/     F4D : 79                  		ld	a,c		; found free link?
(1) 2813/     F4E : B0                  		or	b
(1) 2814/     F4F : 28 0F               		jr	z,.fndslot
(1) 2815/     F51 :                     
(1) 2816/     F51 :                     
(1) 2817/     F51 :                     ; 		cp	d		; Same Channel MSB?
(1) 2818/     F51 :                     ; 		jr	z,.fndslot	; If not, skip
(1) 2819/     F51 :                     ; 		jr	c,.fndslot
(1) 2820/     F51 : C5                  		push	bc
(1) 2821/     F52 : DD E1               		pop	ix		; tell ix is the new slot
(1) 2822/     F54 : FD E5               		push	iy
(1) 2823/     F56 : D1                  		pop	de		; and mark it on buffer
(1) 2824/     F57 : CF                  		rst	8
(1) 2825/     F58 : DD 73 00            		ld	(ix),e
(1) 2826/     F5B : DD 72 01            		ld	(ix+1),d
(1) 2827/     F5E : AF                  		xor	a
(1) 2828/     F5F : C9                  		ret
(1) 2829/     F60 :                     .fndslot:
(1) 2830/     F60 : 3E FF               		ld	a,-1		; linksteal check goes here
(1) 2831/     F62 : C9                  		ret
(1) 2832/     F63 :                     
(1) 2833/     F63 :                     ; ====================================================================
(1) 2834/     F63 :                     ; ----------------------------------------------------------------
(1) 2835/     F63 :                     ; Subroutines
(1) 2836/     F63 :                     ; ----------------------------------------------------------------
(1) 2837/     F63 :                     
(1) 2838/     F63 :                     ; --------------------------------------------------------
(1) 2839/     F63 :                     ; Init sound engine
(1) 2840/     F63 :                     ; --------------------------------------------------------
(1) 2841/     F63 :                     
(1) 2842/     F63 :                     gema_init:
(1) 2843/     F63 : CD 4B 14            		call	dac_off
(1) 2844/     F66 : 21 00 1B            		ld	hl,dWaveBuff	; hl - Wave buffer START
(1) 2845/     F69 : 11 01 1B            		ld	de,dWaveBuff+1	; de - Wave next byte
(1) 2846/     F6C : 01 FF 00            		ld	bc,100h-1	; bc - length for copying
(1) 2847/     F6F : 36 80               		ld	(hl),80h	; Set first byte
(1) 2848/     F71 : ED B0               		ldir			; Start copying
(1) 2849/     F73 : 21 11 7F            		ld	hl,Zpsg_ctrl	; Silence PSG channels
(1) 2850/     F76 : 36 9F               		ld	(hl),09Fh
(1) 2851/     F78 : 36 BF               		ld	(hl),0BFh
(1) 2852/     F7A : 36 DF               		ld	(hl),0DFh
(1) 2853/     F7C : 36 FF               		ld	(hl),0FFh
(1) 2854/     F7E : 11 0B 22            		ld	de,2208h|3	; Set default LFO
(1) 2855/     F81 : CD 20 14            		call	fm_send_1
(1) 2856/     F84 : 11 00 27            		ld	de,2700h	; CH3 special and timers off
(1) 2857/     F87 : CD 20 14            		call	fm_send_1
(1) 2858/     F8A : 11 00 28            		ld	de,2800h	; FM KEYS off
(1) 2859/     F8D : CD 20 14            		call	fm_send_1
(1) 2860/     F90 : 1C                  		inc	e
(1) 2861/     F91 : CD 20 14            		call	fm_send_1
(1) 2862/     F94 : 1C                  		inc	e
(1) 2863/     F95 : CD 20 14            		call	fm_send_1
(1) 2864/     F98 : 1C                  		inc	e
(1) 2865/     F99 : 1C                  		inc	e
(1) 2866/     F9A : CD 20 14            		call	fm_send_1
(1) 2867/     F9D : 1C                  		inc	e
(1) 2868/     F9E : CD 20 14            		call	fm_send_1
(1) 2869/     FA1 : 1C                  		inc	e
(1) 2870/     FA2 : CD 20 14            		call	fm_send_1
(1) 2871/     FA5 :                     
(1) 2872/     FA5 :                     	; set each tracks' settings
(1) 2873/     FA5 : FD 21 00 1E         		ld	iy,trkBuff_0
(1) 2874/     FA9 : 21 00 1C            		ld	hl,trkData_0
(1) 2875/     FAC : 1E 12               		ld	e,MAX_TRKCHN
(1) 2876/     FAE : 16 80               		ld	d,8*16			; maximum size
(1) 2877/     FB0 : CD BE 0F            		call	.set_it
(1) 2878/     FB3 : FD 21 00 1F         		ld	iy,trkBuff_1
(1) 2879/     FB7 : 21 00 1D            		ld	hl,trkData_1
(1) 2880/     FBA : 1E 12               		ld	e,MAX_TRKCHN
(1) 2881/     FBC : 16 80               		ld	d,8*16
(1) 2882/     FBE :                     .set_it:
(1) 2883/     FBE : FD 75 1A            		ld	(iy+trk_CachNotes),l
(1) 2884/     FC1 : FD 74 1B            		ld	(iy+(trk_CachNotes+1)),h
(1) 2885/     FC4 : FD 73 16            		ld	(iy+trk_numChnls),e
(1) 2886/     FC7 : FD 72 17            		ld	(iy+trk_sizeIns),d
(1) 2887/     FCA : C9                  		ret
(1) 2888/     FCB :                     
(1) 2889/     FCB :                     ; --------------------------------------------------------
(1) 2890/     FCB :                     ; get_tick
(1) 2891/     FCB :                     ;
(1) 2892/     FCB :                     ; Checks if VBlank triggred a TICK
(1) 2893/     FCB :                     ; (1/150 NTSC, 1/120 PAL)
(1) 2894/     FCB :                     ; --------------------------------------------------------
(1) 2895/     FCB :                     
(1) 2896/     FCB :                     get_tick:
(1) 2897/     FCB : F3                  		di				; Disable ints
(1) 2898/     FCC : F5                  		push	af
(1) 2899/     FCD : E5                  		push	hl
(1) 2900/     FCE : 21 CE 19            		ld	hl,tickFlag+1		; read last TICK flag
(1) 2901/     FD1 : 7E                  		ld	a,(hl)			; non-zero value (1Fh)?
(1) 2902/     FD2 : B7                  		or 	a
(1) 2903/     FD3 : 28 13               		jr	z,.ctnotick
(1) 2904/     FD5 : 36 00               		ld	(hl),0			; Reset TICK flag
(1) 2905/     FD7 : 23                  		inc	hl			; Move to tickCnt
(1) 2906/     FD8 : 34                  		inc	(hl)			; and increment
(1) 2907/     FD9 : CF                  		rst	8
(1) 2908/     FDA : D5                  		push	de
(1) 2909/     FDB : 2A 24 00            		ld	hl,(sbeatAcc)		; Increment subbeats
(1) 2910/     FDE : ED 5B 22 00         		ld	de,(sbeatPtck)
(1) 2911/     FE2 : CF                  		rst	8
(1) 2912/     FE3 : 19                  		add	hl,de
(1) 2913/     FE4 : 22 24 00            		ld	(sbeatAcc),hl
(1) 2914/     FE7 : D1                  		pop	de
(1) 2915/     FE8 :                     .ctnotick:
(1) 2916/     FE8 : E1                  		pop	hl
(1) 2917/     FE9 : F1                  		pop	af
(1) 2918/     FEA : FB                  		ei				; Enable ints again
(1) 2919/     FEB : C9                  		ret
(1) 2920/     FEC :                     
(1) 2921/     FEC :                     ; --------------------------------------------------------
(1) 2922/     FEC :                     ; showRom:
(1) 2923/     FEC :                     ; Get ROM position visible for reading
(1) 2924/     FEC :                     ;
(1) 2925/     FEC :                     ; Input:
(1) 2926/     FEC :                     ;  b - ROM address $xx0000
(1) 2927/     FEC :                     ; hl - ROM address $00xxxx
(1) 2928/     FEC :                     ;
(1) 2929/     FEC :                     ; Output:
(1) 2930/     FEC :                     ; hl - ROM position ready to use for reading
(1) 2931/     FEC :                     ; --------------------------------------------------------
(1) 2932/     FEC :                     
(1) 2933/     FEC :                     showRom:
(1) 2934/     FEC : CF                  		rst	8
(1) 2935/     FED : D5                  		push	de
(1) 2936/     FEE : C5                  		push	bc
(1) 2937/     FEF : 11 00 60            		ld	de,6000h
(1) 2938/     FF2 : 7C                  		ld	a,h
(1) 2939/     FF3 : 07                  		rlca
(1) 2940/     FF4 : CF                  		rst	8
(1) 2941/     FF5 : 12                  		ld	(de),a
(1) 2942/     FF6 : 78                  		ld	a,b
(1) 2943/     FF7 : 12                  		ld	(de),a
(1) 2944/     FF8 : 1F                  		rra
(1) 2945/     FF9 : 12                  		ld	(de),a
(1) 2946/     FFA : 1F                  		rra
(1) 2947/     FFB : 12                  		ld	(de),a
(1) 2948/     FFC : 1F                  		rra
(1) 2949/     FFD : CF                  		rst	8
(1) 2950/     FFE : 12                  		ld	(de),a
(1) 2951/     FFF : 1F                  		rra
(1) 2952/    1000 : 12                  		ld	(de),a
(1) 2953/    1001 : 1F                  		rra
(1) 2954/    1002 : 12                  		ld	(de),a
(1) 2955/    1003 : 1F                  		rra
(1) 2956/    1004 : 12                  		ld	(de),a
(1) 2957/    1005 : 1F                  		rra
(1) 2958/    1006 : 12                  		ld	(de),a
(1) 2959/    1007 : CF                  		rst	8
(1) 2960/    1008 : C1                  		pop	bc
(1) 2961/    1009 : D1                  		pop	de
(1) 2962/    100A : CB FC               		set	7,h
(1) 2963/    100C : C9                  		ret
(1) 2964/    100D :                     
(1) 2965/    100D :                     ; --------------------------------------------------------
(1) 2966/    100D :                     ; readRomB:
(1) 2967/    100D :                     ; Reads a byte from ROM safetly, for a single and quick
(1) 2968/    100D :                     ; byte-read only, NOT autoswitchable.
(1) 2969/    100D :                     ; CALL showRom FIRST, DO NOT CALL dac_fill BEFORE
(1) 2970/    100D :                     ; GETTING HERE
(1) 2971/    100D :                     ;
(1) 2972/    100D :                     ; Input:
(1) 2973/    100D :                     ; hl - ROM position in Z80's area
(1) 2974/    100D :                     ;      (BANK must be set already)
(1) 2975/    100D :                     ;
(1) 2976/    100D :                     ; Output:
(1) 2977/    100D :                     ; a - byte recieved
(1) 2978/    100D :                     ; --------------------------------------------------------
(1) 2979/    100D :                     
(1) 2980/    100D :                     ; ALL this code just to read one byte without bothering
(1) 2981/    100D :                     ; the DMA from the 68k side
(1) 2982/    100D :                     
(1) 2983/    100D :                     readRomB:
(1) 2984/    100D : DD E5               		push	ix
(1) 2985/    100F : DD 21 1C 00         		ld	ix,commZRomBlk
(1) 2986/    1013 : DD CB 01 C6         		set	0,(ix+1)	; ROM read request
(1) 2987/    1017 : DD CB 00 46         		bit	0,(ix)		; 68k is on DMA?
(1) 2988/    101B : 20 09               		jr	nz,.wait
(1) 2989/    101D : 7E                  .imback:	ld	a,(hl)		; Read the byte.
(1) 2990/    101E : DD CB 01 86         		res	0,(ix+1)
(1) 2991/    1022 : CF                  		rst	8
(1) 2992/    1023 : DD E1               		pop	ix
(1) 2993/    1025 : C9                  		ret
(1) 2994/    1026 :                     .wait:
(1) 2995/    1026 : DD CB 01 86         		res	0,(ix+1)	; Not reading ROM
(1) 2996/    102A :                     .w2:
(1) 2997/    102A : CF                  		rst	8
(1) 2998/    102B : 00                  		nop
(1) 2999/    102C : 00                  		nop
(1) 3000/    102D : CF                  		rst	8
(1) 3001/    102E : DD CB 00 46         		bit	0,(ix)		; Is ROM free from 68K?
(1) 3002/    1032 : 20 F6               		jr	nz,.w2
(1) 3003/    1034 : DD CB 01 C6         		set	0,(ix+1)	; Reading ROM again.
(1) 3004/    1038 : 18 E3               		jr	.imback
(1) 3005/    103A :                     
(1) 3006/    103A :                     ; --------------------------------------------------------
(1) 3007/    103A :                     ; transferRom
(1) 3008/    103A :                     ;
(1) 3009/    103A :                     ; Transfer bytes from ROM to Z80, this also tells
(1) 3010/    103A :                     ; to 68k that we are reading fom ROM
(1) 3011/    103A :                     ;
(1) 3012/    103A :                     ; Input:
(1) 3013/    103A :                     ; a  - Source ROM address $xx0000
(1) 3014/    103A :                     ;  c - Byte count (size 0 NOT allowed, MAX: 0FFh)
(1) 3015/    103A :                     ; hl - Source ROM address $00xxxx
(1) 3016/    103A :                     ; de - Destination address
(1) 3017/    103A :                     ;
(1) 3018/    103A :                     ; Uses:
(1) 3019/    103A :                     ; b, ix
(1) 3020/    103A :                     ;
(1) 3021/    103A :                     ; Notes:
(1) 3022/    103A :                     ; call dac_fill first if transfering anything other than
(1) 3023/    103A :                     ; sample data, just to be safe
(1) 3024/    103A :                     ; --------------------------------------------------------
(1) 3025/    103A :                     
(1) 3026/    103A :                     ; Note: got this from GEMS...
(1) 3027/    103A :                     
(1) 3028/    103A :                     transferRom:
(1) 3029/    103A : CF                  		rst	8
(1) 3030/    103B : DD E5               		push	ix
(1) 3031/    103D : DD 21 1C 00         		ld	ix,commZRomBlk	; ix - rom read/block flags
(1) 3032/    1041 : 22 C1 19            		ld	(x68ksrclsb),hl	; save hl copy
(1) 3033/    1044 : CB BC               		res	7,h
(1) 3034/    1046 : 06 00               		ld	b,0
(1) 3035/    1048 : 0B                  		dec	bc
(1) 3036/    1049 : 09                  		add	hl,bc
(1) 3037/    104A : CB 7C               		bit	7,h
(1) 3038/    104C : 20 0B               		jr	nz,.double
(1) 3039/    104E : 2A C1 19            		ld	hl,(x68ksrclsb)	; single transfer
(1) 3040/    1051 : 0C                  		inc	c
(1) 3041/    1052 : 47                  		ld	b,a
(1) 3042/    1053 : CD 7E 10            		call	.transfer
(1) 3043/    1056 : DD E1               		pop	ix
(1) 3044/    1058 : C9                  		ret
(1) 3045/    1059 :                     .double:
(1) 3046/    1059 : CF                  		rst	8
(1) 3047/    105A : 47                  		ld	b,a		; double transfer
(1) 3048/    105B : C5                  		push	bc
(1) 3049/    105C : E5                  		push	hl
(1) 3050/    105D : 79                  		ld	a,c
(1) 3051/    105E : 95                  		sub	a,l
(1) 3052/    105F : 4F                  		ld	c,a
(1) 3053/    1060 : 2A C1 19            		ld	hl,(x68ksrclsb)
(1) 3054/    1063 : CD 7E 10            		call	.transfer
(1) 3055/    1066 : E1                  		pop	hl
(1) 3056/    1067 : C1                  		pop	bc
(1) 3057/    1068 : CF                  		rst	8
(1) 3058/    1069 : 4D                  		ld	c,l
(1) 3059/    106A : 0C                  		inc	c
(1) 3060/    106B : 3A C2 19            		ld	a,(x68ksrcmid)
(1) 3061/    106E : E6 80               		and	80h
(1) 3062/    1070 : C6 80               		add	a,80h
(1) 3063/    1072 : 67                  		ld	h,a
(1) 3064/    1073 : 2E 00               		ld	l,0
(1) 3065/    1075 : 30 01               		jr	nc,.x68knocarry
(1) 3066/    1077 : 04                  		inc	b
(1) 3067/    1078 :                     .x68knocarry:
(1) 3068/    1078 : CD 7E 10            		call	.transfer
(1) 3069/    107B : DD E1               		pop	ix
(1) 3070/    107D : C9                  		ret
(1) 3071/    107E :                     
(1) 3072/    107E :                     ; ------------------------------------------------
(1) 3073/    107E :                     ; b  - Source ROM xx0000
(1) 3074/    107E :                     ;  c - Bytes to transfer (00h not allowed)
(1) 3075/    107E :                     ; hl - Source ROM 00xxxx (OR'd with 8000h)
(1) 3076/    107E :                     ; de - Destination address
(1) 3077/    107E :                     ;
(1) 3078/    107E :                     ; Uses:
(1) 3079/    107E :                     ; a
(1) 3080/    107E :                     ; ------------------------------------------------
(1) 3081/    107E :                     
(1) 3082/    107E :                     .transfer:
(1) 3083/    107E : CD EC 0F            		call	showRom
(1) 3084/    1081 :                     
(1) 3085/    1081 :                     	; Transfer data in packs of bytes
(1) 3086/    1081 :                     	; while playing cache WAV in the process
(1) 3087/    1081 :                     	; *** CRITICAL PROCESS FOR WAV PLAYBACK ***
(1) 3088/    1081 :                     	;
(1) 3089/    1081 :                     	; pseudo-ref for ldir:
(1) 3090/    1081 :                     	; ld (de),(hl)
(1) 3091/    1081 :                     	; inc de
(1) 3092/    1081 :                     	; inc hl
(1) 3093/    1081 :                     	; dec bc
(1) 3094/    1081 :                     	;
(1) 3095/    1081 : 06 00               		ld	b,0
(1) 3096/    1083 : 79                  		ld	a,c		; a - pieces counter
(1) 3097/    1084 : DD CB 01 C6         		set	0,(ix+1)	; Tell to 68k that we are reading from ROM
(1) 3098/    1088 : D6 06               		sub	6		; LENGHT lower than 6?
(1) 3099/    108A : 38 11               		jr	c,.x68klast	; Process single piece only
(1) 3100/    108C :                     .x68kloop:
(1) 3101/    108C : CF                  		rst	8
(1) 3102/    108D : 0E 05               		ld	c,6-1
(1) 3103/    108F : DD CB 00 46         		bit	0,(ix)		; If 68k requested ROM block from here
(1) 3104/    1093 : 20 1A               		jr	nz,.x68klpwt
(1) 3105/    1095 :                     .x68klpcont:
(1) 3106/    1095 : CF                  		rst	8
(1) 3107/    1096 : ED B0               		ldir			; (de) to (hl) until bc==0
(1) 3108/    1098 : D6 05               		sub	a,6-1
(1) 3109/    109A : D2 8C 10            		jp	nc,.x68kloop
(1) 3110/    109D :                     ; last block
(1) 3111/    109D :                     .x68klast:
(1) 3112/    109D : C6 06               		add	a,6
(1) 3113/    109F : 4F                  		ld	c,a
(1) 3114/    10A0 : DD CB 00 46         		bit	0,(ix)		; If 68k requested ROM block from here
(1) 3115/    10A4 : C2 C2 10            		jp	nz,.x68klstwt
(1) 3116/    10A7 :                     .x68klstcont:
(1) 3117/    10A7 : CF                  		rst	8
(1) 3118/    10A8 : ED B0               		ldir
(1) 3119/    10AA : DD CB 01 86         		res	0,(ix+1)	; Tell 68k we are done reading
(1) 3120/    10AE : C9                  		ret
(1) 3121/    10AF :                     
(1) 3122/    10AF :                     ; If Genesis wants to do DMA, loop indef here until it finishes.
(1) 3123/    10AF :                     ; if on mid-loop
(1) 3124/    10AF :                     .x68klpwt:
(1) 3125/    10AF : DD CB 01 86         		res	0,(ix+1)	; Tell 68k we are out, waiting.
(1) 3126/    10B3 :                     .x68kpwtlp:
(1) 3127/    10B3 : CF                  		rst	8
(1) 3128/    10B4 : 00                  		nop
(1) 3129/    10B5 : CF                  		rst	8
(1) 3130/    10B6 : DD CB 00 46         		bit	0,(ix)		; 68k finished?
(1) 3131/    10BA : 20 F7               		jr	nz,.x68kpwtlp
(1) 3132/    10BC : DD CB 01 C6         		set	0,(ix+1)	; Set Z80 read flag again, and return
(1) 3133/    10C0 : 18 D3               		jr	.x68klpcont
(1) 3134/    10C2 :                     
(1) 3135/    10C2 :                     ; or in the last piece
(1) 3136/    10C2 :                     .x68klstwt:
(1) 3137/    10C2 : DD CB 01 86         		res	0,(ix+1)	; Tell 68k we are out, waiting.
(1) 3138/    10C6 :                     .x68klstwtlp:
(1) 3139/    10C6 : CF                  		rst	8
(1) 3140/    10C7 : 00                  		nop
(1) 3141/    10C8 : CF                  		rst	8
(1) 3142/    10C9 : DD CB 00 46         		bit	0,(ix)		; 68k finished?
(1) 3143/    10CD : 20 F7               		jr	nz,.x68klstwtlp
(1) 3144/    10CF : DD CB 01 C6         		set	0,(ix+1)	; Set Z80 read flag again, and return
(1) 3145/    10D3 : 18 D2               		jr	.x68klstcont
(1) 3146/    10D5 :                     
(1) 3147/    10D5 :                     ; ====================================================================
(1) 3148/    10D5 :                     ; ----------------------------------------------------------------
(1) 3149/    10D5 :                     ; Sound chip routines
(1) 3150/    10D5 :                     ; ----------------------------------------------------------------
(1) 3151/    10D5 :                     
(1) 3152/    10D5 :                     ; --------------------------------------------------------
(1) 3153/    10D5 :                     ; chip_env
(1) 3154/    10D5 :                     ;
(1) 3155/    10D5 :                     ; Process PSG and FM
(1) 3156/    10D5 :                     ; --------------------------------------------------------
(1) 3157/    10D5 :                     
(1) 3158/    10D5 :                     ; Read PSG list backwards so it autodetects
(1) 3159/    10D5 :                     ; Tone3 mode
(1) 3160/    10D5 :                     
(1) 3161/    10D5 :                     chip_env:
(1) 3162/    10D5 : FD 21 6B 17         		ld	iy,psgcom+3		; Start from NOISE first
(1) 3163/    10D9 : 21 11 7F            		ld	hl,Zpsg_ctrl
(1) 3164/    10DC : 16 E0               		ld	d,0E0h			; PSG first ctrl command
(1) 3165/    10DE : 1E 04               		ld	e,4			; 4 channels
(1) 3166/    10E0 :                     .vloop:
(1) 3167/    10E0 : CF                  		rst	8
(1) 3168/    10E1 : FD 4E 00            		ld	c,(iy+COM)		; c - current command
(1) 3169/    10E4 : FD 36 00 00         		ld	(iy+COM),0
(1) 3170/    10E8 : CB 51               		bit	2,c			; bit 2 - stop sound
(1) 3171/    10EA : 28 17               		jr	z,.ckof
(1) 3172/    10EC : FD 36 04 FF         		ld	(iy+LEV),-1		; reset level
(1) 3173/    10F0 : FD 36 28 01         		ld	(iy+FLG),1		; and update
(1) 3174/    10F4 : FD 36 18 00         		ld	(iy+MODE),0		; envelope off
(1) 3175/    10F8 : 7B                  		ld	a,e
(1) 3176/    10F9 : FE 04               		cp	4
(1) 3177/    10FB : 20 06               		jr	nz,.ckof
(1) 3178/    10FD : 3E 00               		ld	a,0
(1) 3179/    10FF : 32 F7 1E            		ld	(psgHatMode),a
(1) 3180/    1102 : CF                  		rst	8
(1) 3181/    1103 :                     .ckof:
(1) 3182/    1103 : CB 49               		bit	1,c			; bit 1 - key off
(1) 3183/    1105 : 28 19               		jr      z,.ckon
(1) 3184/    1107 : FD 7E 18            		ld	a,(iy+MODE)		; mode 0?
(1) 3185/    110A : B7                  		or	a
(1) 3186/    110B : 28 13               		jr	z,.ckon
(1) 3187/    110D : FD 36 28 01         		ld	(iy+FLG),1		; psg update flag
(1) 3188/    1111 : FD 36 18 04         		ld	(iy+MODE),100b		; set envelope mode 100b
(1) 3189/    1115 : 7B                  		ld	a,e
(1) 3190/    1116 : FE 04               		cp	4
(1) 3191/    1118 : 20 06               		jr	nz,.ckon
(1) 3192/    111A : 3E 00               		ld	a,0
(1) 3193/    111C : 32 F7 1E            		ld	(psgHatMode),a
(1) 3194/    111F : CF                  		rst	8
(1) 3195/    1120 :                     .ckon:
(1) 3196/    1120 : CB 41               		bit	0,c			; bit 0 - key on
(1) 3197/    1122 : 28 57               		jr	z,.envproc
(1) 3198/    1124 : FD 36 04 FF         		ld	(iy+LEV),-1		; reset level
(1) 3199/    1128 : 3A F7 1E            		ld	a,(psgHatMode)		; check if using tone3 mode.
(1) 3200/    112B : 4F                  		ld	c,a
(1) 3201/    112C : E6 03               		and	11b
(1) 3202/    112E : FE 03               		cp	11b
(1) 3203/    1130 : 28 24               		jr	z,.tnmode
(1) 3204/    1132 :                     .wrfreq:
(1) 3205/    1132 : 7B                  		ld	a,e
(1) 3206/    1133 : FE 04               		cp	4
(1) 3207/    1135 : 28 35               		jr	z,.sethat
(1) 3208/    1137 : CF                  		rst	8
(1) 3209/    1138 :                     
(1) 3210/    1138 : FD 7E 1C            		ld	a,(iy+DTL)	; Grab LSB 4 right bits
(1) 3211/    113B : E6 0F               		and	00001111b
(1) 3212/    113D : B2                  		or	d		; OR with current channel
(1) 3213/    113E : 77                  		ld	(hl),a		; write it
(1) 3214/    113F : FD 7E 1C            		ld	a,(iy+DTL)	; Grab LSB 4 left bits
(1) 3215/    1142 : 0F                  		rrca
(1) 3216/    1143 : 0F                  		rrca
(1) 3217/    1144 : 0F                  		rrca
(1) 3218/    1145 : 0F                  		rrca
(1) 3219/    1146 : E6 0F               		and	00001111b
(1) 3220/    1148 : 4F                  		ld	c,a
(1) 3221/    1149 : FD 7E 20            		ld	a,(iy+DTH)	; Grab MSB bits
(1) 3222/    114C : 07                  		rlca
(1) 3223/    114D : 07                  		rlca
(1) 3224/    114E : 07                  		rlca
(1) 3225/    114F : 07                  		rlca
(1) 3226/    1150 : E6 30               		and	00110000b
(1) 3227/    1152 : B1                  		or	c
(1) 3228/    1153 : 77                  		ld	(hl),a
(1) 3229/    1154 :                     
(1) 3230/    1154 : 18 1C               		jr	.nskip
(1) 3231/    1156 :                     ; Tone3 mode
(1) 3232/    1156 :                     .tnmode:
(1) 3233/    1156 : 7B                  		ld	a,e
(1) 3234/    1157 : FE 04               		cp	4			; NOISE
(1) 3235/    1159 : 28 06               		jr	z,.psteal
(1) 3236/    115B : FE 03               		cp	3			; PSG3, can't play
(1) 3237/    115D : 28 13               		jr	z,.nskip
(1) 3238/    115F : 18 D1               		jr	.wrfreq
(1) 3239/    1161 :                     .psteal:
(1) 3240/    1161 : CF                  		rst	8
(1) 3241/    1162 : FD 7E 1C            		ld	a,(iy+DTL)		; Steal PSG3's freq
(1) 3242/    1165 : F6 C0               		or	0C0h
(1) 3243/    1167 : 77                  		ld	(hl),a
(1) 3244/    1168 : FD 7E 20            		ld	a,(iy+DTH)
(1) 3245/    116B : 77                  		ld	(hl),a
(1) 3246/    116C :                     .sethat:
(1) 3247/    116C : CF                  		rst	8
(1) 3248/    116D : 3A F7 1E            		ld	a,(psgHatMode)		; write hat mode only.
(1) 3249/    1170 : B2                  		or	d
(1) 3250/    1171 : 77                  		ld	(hl),a
(1) 3251/    1172 :                     .nskip:
(1) 3252/    1172 : FD 36 28 01         		ld	(iy+FLG),1		; psg update flag
(1) 3253/    1176 : FD 36 18 01         		ld	(iy+MODE),001b		; set to attack mode
(1) 3254/    117A : CF                  		rst	8
(1) 3255/    117B :                     
(1) 3256/    117B :                     ; ----------------------------
(1) 3257/    117B :                     ; Process effects
(1) 3258/    117B :                     ; ----------------------------
(1) 3259/    117B :                     
(1) 3260/    117B :                     .envproc:
(1) 3261/    117B : CF                  		rst	8
(1) 3262/    117C : FD 7E 18            		ld	a,(iy+MODE)
(1) 3263/    117F : B7                  		or	a			; no modes
(1) 3264/    1180 : CA 06 12            		jp	z,.vedlp
(1) 3265/    1183 : FE 01               		cp 	001b			; Attack mode
(1) 3266/    1185 : 20 2C               		jr	nz,.chk2
(1) 3267/    1187 : FD 36 28 01         		ld	(iy+FLG),1		; psg update flag
(1) 3268/    118B : FD 46 24            		ld	b,(iy+ALV)
(1) 3269/    118E : FD 7E 08            		ld	a,(iy+ATK)		; if ATK == 0, don't use
(1) 3270/    1191 : B7                  		or	a
(1) 3271/    1192 : 28 16               		jr	z,.atkend
(1) 3272/    1194 : 4F                  		ld	c,a			; c - attack rate
(1) 3273/    1195 : 78                  		ld	a,b			; a - attack level
(1) 3274/    1196 : CF                  		rst	8
(1) 3275/    1197 : FD 46 24            		ld	b,(iy+ALV)		; b - OLD attack level
(1) 3276/    119A : 91                  		sub	a,c			; (attack rate) - (level)
(1) 3277/    119B : 38 0D               		jr	c,.atkend		; if carry: already finished
(1) 3278/    119D : 28 0B               		jr	z,.atkend		; if zero: no attack rate
(1) 3279/    119F : B8                  		cp	b			; attack rate == level?
(1) 3280/    11A0 : 38 08               		jr	c,.atkend
(1) 3281/    11A2 : 28 06               		jr	z,.atkend
(1) 3282/    11A4 : FD 77 04            		ld	(iy+LEV),a		; set new level
(1) 3283/    11A7 : CF                  		rst	8
(1) 3284/    11A8 : 18 5C               		jr	.vedlp
(1) 3285/    11AA :                     .atkend:
(1) 3286/    11AA : FD 70 04            		ld	(iy+LEV),b		; attack level = new level
(1) 3287/    11AD :                     .atkzero:
(1) 3288/    11AD : FD 36 18 02         		ld	(iy+MODE),010b		; set to decay mode
(1) 3289/    11B1 : 18 53               		jr	.vedlp
(1) 3290/    11B3 :                     .chk2:
(1) 3291/    11B3 :                     
(1) 3292/    11B3 : FE 02               		cp	010b			; Decay mode
(1) 3293/    11B5 : 20 31               		jr	nz,.chk4
(1) 3294/    11B7 :                     .dectmr:
(1) 3295/    11B7 : FD 36 28 01         		ld	(iy+FLG),1		; psg update flag
(1) 3296/    11BB : FD 7E 04            		ld	a,(iy+LEV)		; a - Level
(1) 3297/    11BE : FD 46 10            		ld	b,(iy+SLV)		; b - Sustain
(1) 3298/    11C1 : B8                  		cp	b
(1) 3299/    11C2 : 38 0D               		jr	c,.dkadd		; if carry: add
(1) 3300/    11C4 : 28 18               		jr	z,.dkyend		; if zero:  finish
(1) 3301/    11C6 : CF                  		rst	8
(1) 3302/    11C7 : FD 96 0C            		sub	(iy+DKY)		; substract decay rate
(1) 3303/    11CA : 38 12               		jr	c,.dkyend		; finish if wraped.
(1) 3304/    11CC : B8                  		cp	b			; compare level
(1) 3305/    11CD : 38 0F               		jr	c,.dkyend		; and finish
(1) 3306/    11CF : 18 08               		jr	.dksav
(1) 3307/    11D1 :                     .dkadd:
(1) 3308/    11D1 : FD 86 0C            		add	a,(iy+DKY)		;  (level) + (decay rate)
(1) 3309/    11D4 : 38 08               		jr	c,.dkyend		; finish if wraped.
(1) 3310/    11D6 : B8                  		cp	b			; compare level
(1) 3311/    11D7 : 30 05               		jr	nc,.dkyend
(1) 3312/    11D9 :                     .dksav:
(1) 3313/    11D9 : FD 77 04            		ld	(iy+LEV),a		; save new level
(1) 3314/    11DC : 18 28               		jr	.vedlp
(1) 3315/    11DE :                     .dkyend:
(1) 3316/    11DE : CF                  		rst	8
(1) 3317/    11DF : FD 70 04            		ld	(iy+LEV),b		; save last attack
(1) 3318/    11E2 : FD 36 18 04         		ld	(iy+MODE),100b		; and set to sustain
(1) 3319/    11E6 : 18 1E               		jr	.vedlp
(1) 3320/    11E8 :                     .chk4:
(1) 3321/    11E8 : FE 04               		cp	100b			; Sustain phase
(1) 3322/    11EA : 20 1A               		jr	nz,.vedlp
(1) 3323/    11EC : FD 36 28 01         		ld	(iy+FLG),1		; psg update flag
(1) 3324/    11F0 : FD 7E 04            		ld	a,(iy+LEV)		; a - Level
(1) 3325/    11F3 : CF                  		rst	8
(1) 3326/    11F4 : FD 86 14            		add 	a,(iy+RRT)		; add Release Rate
(1) 3327/    11F7 : 38 05               		jr	c,.killenv		; release done
(1) 3328/    11F9 : FD 77 04            		ld	(iy+LEV),a		; set new Level
(1) 3329/    11FC : 18 08               		jr	.vedlp
(1) 3330/    11FE :                     .killenv:
(1) 3331/    11FE : FD 36 04 FF         		ld	(iy+LEV),-1		; Silence this channel
(1) 3332/    1202 : FD 36 18 00         		ld	(iy+MODE),0		; Reset mode
(1) 3333/    1206 :                     .vedlp:
(1) 3334/    1206 : FD 7E 28            		ld	a,(iy+FLG)
(1) 3335/    1209 : B7                  		or	a
(1) 3336/    120A : 28 1E               		jr	z,.noupd
(1) 3337/    120C : FD 36 28 00         		ld	(iy+FLG),0	; Reset until next one
(1) 3338/    1210 : CF                  		rst	8
(1) 3339/    1211 : FD 7E 04            		ld	a,(iy+LEV)	; a - Level
(1) 3340/    1214 : FD 86 30            		add	a,(iy+PVOL)	; Level + master volume
(1) 3341/    1217 : 30 02               		jr	nc,.vlmuch
(1) 3342/    1219 : 3E FF               		ld	a,-1
(1) 3343/    121B :                     .vlmuch:
(1) 3344/    121B : CB 3F               		srl	a		; (Level >> 4)
(1) 3345/    121D : CB 3F               		srl	a
(1) 3346/    121F : CB 3F               		srl	a
(1) 3347/    1221 : CF                  		rst	8
(1) 3348/    1222 : CB 3F               		srl	a
(1) 3349/    1224 : E6 0F               		and	00001111b
(1) 3350/    1226 : F6 90               		or	90h		; Set volume-set mode
(1) 3351/    1228 : B2                  		or	d		; add current channel
(1) 3353/    1229 : 77                  		ld	(hl),a		; Write volume
(1) 3355/    122A :                     
(1) 3356/    122A :                     .noupd:
(1) 3357/    122A : FD 2B               		dec	iy		; next COM to check
(1) 3358/    122C : 7A                  		ld	a,d
(1) 3359/    122D : CF                  		rst	8
(1) 3360/    122E : D6 20               		sub	a,20h		; next PSG (backwards)
(1) 3361/    1230 : 57                  		ld	d,a
(1) 3362/    1231 : 1D                  		dec	e
(1) 3363/    1232 : C2 E0 10            		jp	nz,.vloop
(1) 3364/    1235 :                     
(1) 3365/    1235 :                     ; ----------------------------
(1) 3366/    1235 :                     ; FM section
(1) 3367/    1235 :                     ; ----------------------------
(1) 3368/    1235 :                     
(1) 3369/    1235 :                     	; Read FM channels
(1) 3370/    1235 :                     	; iy - FM com
(1) 3371/    1235 :                     	; ix - FM current instrument data
(1) 3372/    1235 :                     	;  c - FM channel ID
(1) 3373/    1235 :                     
(1) 3374/    1235 :                     
(1) 3375/    1235 : FD 21 9C 17         		ld	iy,fmcom
(1) 3376/    1239 : DD 21 C0 17         		ld	ix,fmins_com
(1) 3377/    123D : 01 00 05            		ld	bc,0500h
(1) 3378/    1240 : C5                  .nextfm_1:	push	bc
(1) 3379/    1241 : CD 97 12            		call	.fm_chnl	; Channel 1
(1) 3380/    1244 : C1                  		pop	bc
(1) 3381/    1245 : 11 28 00            		ld	de,28h
(1) 3382/    1248 : DD 19               		add	ix,de
(1) 3383/    124A : FD 23               		inc	iy
(1) 3384/    124C : CF                  		rst	8
(1) 3385/    124D : 0C                  		inc	c
(1) 3386/    124E : 79                  		ld	a,c
(1) 3387/    124F : FE 03               		cp	3		; c == 3?
(1) 3388/    1251 : 20 02               		jr	nz,.nomidc
(1) 3389/    1253 : 0C                  		inc	c
(1) 3390/    1254 : CF                  		rst	8
(1) 3391/    1255 :                     .nomidc:
(1) 3392/    1255 : 10 E9               		djnz	.nextfm_1
(1) 3393/    1257 :                     
(1) 3394/    1257 :                     	; Special check for Channel 6
(1) 3395/    1257 : 3A BC 18            		ld	a,(daccom)	; Channel 6 / DAC
(1) 3396/    125A : 5F                  		ld	e,a
(1) 3397/    125B : AF                  		xor	a
(1) 3398/    125C : 32 BC 18            		ld	(daccom),a
(1) 3399/    125F : CB 43               		bit	0,e		; WAVE sample request
(1) 3400/    1261 : 20 21               		jr	nz,.req_dac
(1) 3401/    1263 : CB 63               		bit	4,e
(1) 3402/    1265 : 20 2A               		jr	nz,.req_pitch
(1) 3403/    1267 : CF                  		rst	8
(1) 3404/    1268 : CB 53               		bit	2,e		; key-cut?
(1) 3405/    126A : C2 4B 14            		jp	nz,dac_off
(1) 3406/    126D : CB 4B               		bit	1,e		; key-off?
(1) 3407/    126F : C0                  		ret	nz
(1) 3408/    1270 : 3A 08 00            		ld 	a,(dac_me)	; manually check if
(1) 3409/    1273 : FE D9               		cp	zopcExx		; WAVE playback is active
(1) 3410/    1275 : C8                  		ret	z
(1) 3411/    1276 : 11 28 00            		ld	de,28h
(1) 3412/    1279 : DD 19               		add	ix,de
(1) 3413/    127B : CF                  		rst	8
(1) 3414/    127C : DD 7E 00            		ld	a,(ix)
(1) 3415/    127F : FD 23               		inc	iy
(1) 3416/    1281 : 0C                  		inc	c
(1) 3417/    1282 : 18 13               		jr	.fm_chnl			; Channel 6 (normal)
(1) 3418/    1284 :                     .req_dac:
(1) 3419/    1284 : 16 B6               		ld	d,0B6h			; Panning for DAC
(1) 3420/    1286 : 3A B3 17            		ld	a,((fmcom+5)+FMPAN)	; Reuse FM6's panning
(1) 3421/    1289 : 1E C0               		ld	e,11000000b
(1) 3422/    128B : CD 2B 14            		call	fm_send_2
(1) 3423/    128E : C3 60 14            		jp	dac_play		; Set playback
(1) 3424/    1291 :                     .req_pitch:
(1) 3425/    1291 : D9                  		exx
(1) 3426/    1292 : 2A D9 19            		ld	hl,(wave_Pitch)
(1) 3427/    1295 : D9                  		exx
(1) 3428/    1296 :                     ; 		bit	4,c
(1) 3429/    1296 :                     ; 		ret	nz
(1) 3430/    1296 :                     ; 		exx
(1) 3431/    1296 :                     ; 		push	de
(1) 3432/    1296 :                     ; 		exx
(1) 3433/    1296 :                     ; 		pop	hl
(1) 3434/    1296 :                     ; 		rst	8
(1) 3435/    1296 :                     ; 		add	hl,de
(1) 3436/    1296 :                     ; 		push	hl
(1) 3437/    1296 :                     ; 		exx
(1) 3438/    1296 :                     ; 		pop	de
(1) 3439/    1296 :                     ; 		exx
(1) 3440/    1296 : C9                  		ret
(1) 3441/    1297 :                     
(1) 3442/    1297 :                     ; ----------------------------------------
(1) 3443/    1297 :                     ; Control current FM channel
(1) 3444/    1297 :                     ;
(1) 3445/    1297 :                     ; iy - fmcom
(1) 3446/    1297 :                     ; ix - Instrument data pointer
(1) 3447/    1297 :                     ;  c - FM chip ID
(1) 3448/    1297 :                     ; ----------------------------------------
(1) 3449/    1297 :                     
(1) 3450/    1297 :                     	; 0pvi 0cop
(1) 3451/    1297 :                     	; pvi - update bits:
(1) 3452/    1297 :                     	;      volume(v)
(1) 3453/    1297 :                     	;      instrument(i)
(1) 3454/    1297 :                     	;      panning(p)
(1) 3455/    1297 :                     	;
(1) 3456/    1297 :                     	; c/o/p key cut, key off, key on
(1) 3457/    1297 :                     .fm_chnl:
(1) 3458/    1297 : FD 7E 00            		ld	a,(iy)		; Get comm bits
(1) 3459/    129A : B7                  		or	a
(1) 3460/    129B : C8                  		ret	z
(1) 3461/    129C : FD 36 00 00         		ld	(iy),0		; Reset
(1) 3462/    12A0 :                     
(1) 3463/    12A0 : CB 57               		bit	2,a		; Key-cut (010b) bit?
(1) 3464/    12A2 : C2 2A 13            		jp	nz,.fm_keycut
(1) 3465/    12A5 : CB 4F               		bit	1,a		; Key-off (100b) bit?
(1) 3466/    12A7 : C2 3F 13            		jp	nz,.fm_keyoff
(1) 3467/    12AA : 47                  		ld	b,a		; b - other update bits
(1) 3468/    12AB : 79                  		ld	a,c		; check for Channel 6
(1) 3469/    12AC : FE 06               		cp	6
(1) 3470/    12AE : CC 4B 14            		call	z,dac_off	; auto-mute WAVE playback
(1) 3471/    12B1 : CF                  		rst	8
(1) 3472/    12B2 : CB 60               		bit	4,b		; Instrument-update bit?  (%0001xxxx)
(1) 3473/    12B4 : C4 5F 13            		call	nz,.fm_insupd
(1) 3474/    12B7 : CB 68               		bit	5,b		; Volume-update bit? (%0010xxxx)
(1) 3475/    12B9 : C4 C6 13            		call	nz,.fm_volupd	;
(1) 3476/    12BC : CB 70               		bit	6,b		; Panning update bit? (%0100xxxx)
(1) 3477/    12BE : C4 46 13            		call	nz,.fm_panupd
(1) 3478/    12C1 : CB 40               		bit	0,b		; Key-on (001b) bit?
(1) 3479/    12C3 : C8                  		ret	z
(1) 3480/    12C4 :                     	; freq update
(1) 3481/    12C4 :                     	; all this code is for OP4 (if FM3 is in special)
(1) 3482/    12C4 : CF                  		rst	8
(1) 3483/    12C5 : 79                  		ld	a,c
(1) 3484/    12C6 : E6 03               		and	11b
(1) 3485/    12C8 : F6 A4               		or	0A4h
(1) 3486/    12CA : 57                  		ld	d,a
(1) 3487/    12CB : FD 5E 18            		ld	e,(iy+FMFRQH)
(1) 3488/    12CE : CB 51               		bit	2,c
(1) 3489/    12D0 : C4 2B 14            		call	nz,fm_send_2
(1) 3490/    12D3 : CC 20 14            		call	z,fm_send_1
(1) 3491/    12D6 : CF                  		rst	8
(1) 3492/    12D7 : 15                  		dec	d
(1) 3493/    12D8 : 15                  		dec	d
(1) 3494/    12D9 : 15                  		dec	d
(1) 3495/    12DA : 15                  		dec	d
(1) 3496/    12DB : FD 5E 1E            		ld	e,(iy+FMFRQL)
(1) 3497/    12DE : CB 51               		bit	2,c
(1) 3498/    12E0 : C4 2B 14            		call	nz,fm_send_2
(1) 3499/    12E3 : CC 20 14            		call	z,fm_send_1
(1) 3500/    12E6 : CF                  		rst	8
(1) 3501/    12E7 :                     
(1) 3502/    12E7 : 79                  		ld	a,c
(1) 3503/    12E8 : E6 03               		and	11b
(1) 3504/    12EA : F6 B0               		or	0B0h
(1) 3505/    12EC : 57                  		ld	d,a
(1) 3506/    12ED : DD 5E 1C            		ld	e,(ix+1Ch)
(1) 3507/    12F0 : CB 51               		bit	2,c
(1) 3508/    12F2 : C4 2B 14            		call	nz,fm_send_2
(1) 3509/    12F5 : CC 20 14            		call	z,fm_send_1
(1) 3510/    12F8 : 14                  		inc	d
(1) 3511/    12F9 : 14                  		inc	d
(1) 3512/    12FA : CF                  		rst	8
(1) 3513/    12FB : 14                  		inc	d
(1) 3514/    12FC : 14                  		inc	d
(1) 3515/    12FD :                     ; 		call	.fm_panset
(1) 3516/    12FD :                     
(1) 3517/    12FD :                     	; For Special FM3 mode it just copy-pastes regs
(1) 3518/    12FD :                     	; from a separate list
(1) 3519/    12FD : 79                  		ld	a,c		; FM3 special check
(1) 3520/    12FE : FE 02               		cp	2
(1) 3521/    1300 : 20 19               		jr	nz,.notfm3
(1) 3522/    1302 : 3A F8 1E            		ld	a,(fmSpcMode)
(1) 3523/    1305 : E6 40               		and	01000000b
(1) 3524/    1307 : B7                  		or	a
(1) 3525/    1308 : 28 11               		jr	z,.notfm3
(1) 3526/    130A : CF                  		rst	8
(1) 3527/    130B : 21 B0 18            		ld	hl,fm3reg
(1) 3528/    130E : 06 06               		ld	b,3*2
(1) 3529/    1310 :                     .copyops:
(1) 3530/    1310 : 5E                  		ld	e,(hl)
(1) 3531/    1311 : 23                  		inc	hl
(1) 3532/    1312 : 56                  		ld	d,(hl)
(1) 3533/    1313 : 23                  		inc	hl
(1) 3534/    1314 : 00                  		nop
(1) 3535/    1315 : CF                  		rst	8
(1) 3536/    1316 : CD 20 14            		call	fm_send_1
(1) 3537/    1319 : 10 F5               		djnz	.copyops
(1) 3538/    131B :                     .notfm3:
(1) 3539/    131B :                     
(1) 3540/    131B : CF                  		rst	8
(1) 3541/    131C : 16 28               		ld	d,28h		; Keys
(1) 3542/    131E : DD 7E 1F            		ld	a,(ix+01Fh)	; a - Read this ins keys
(1) 3543/    1321 : FD 46 06            		ld	b,(iy+FMKEYS)	; b - ALLOWED bits from fmcom
(1) 3544/    1324 : A0                  		and	b
(1) 3545/    1325 : B1                  		or	c
(1) 3546/    1326 : 5F                  		ld	e,a
(1) 3550/    1327 : C3 20 14            		jp	fm_send_1
(1) 3551/    132A :                     
(1) 3552/    132A :                     .fm_keycut:
(1) 3553/    132A : 79                  		ld	a,c
(1) 3554/    132B : E6 03               		and	11b
(1) 3555/    132D : F6 B4               		or	0B4h
(1) 3556/    132F : 57                  		ld	d,a
(1) 3557/    1330 : CF                  		rst	8
(1) 3558/    1331 : DD 7E 1D            		ld	a,(ix+1Dh)
(1) 3559/    1334 : E6 07               		and	00000111b
(1) 3560/    1336 : 5F                  		ld	e,a
(1) 3561/    1337 : CB 51               		bit	2,c
(1) 3562/    1339 : CC 20 14            		call	z,fm_send_1
(1) 3563/    133C : C4 2B 14            		call	nz,fm_send_2
(1) 3564/    133F :                     .fm_keyoff:
(1) 3565/    133F : CF                  		rst	8
(1) 3566/    1340 : 59                  		ld	e,c
(1) 3567/    1341 : 16 28               		ld	d,28h
(1) 3568/    1343 : C3 20 14            		jp	fm_send_1
(1) 3569/    1346 :                     
(1) 3570/    1346 :                     ; d - 0B4h+
(1) 3571/    1346 :                     .fm_panupd:
(1) 3572/    1346 : 79                  		ld	a,c
(1) 3573/    1347 : E6 03               		and	11b
(1) 3574/    1349 : F6 B4               		or	0B4h
(1) 3575/    134B : 57                  		ld	d,a
(1) 3576/    134C :                     .fm_panset:
(1) 3577/    134C : DD 5E 1D            		ld	e,(ix+1Dh)
(1) 3578/    134F : FD 7E 12            		ld	a,(iy+FMPAN)
(1) 3579/    1352 : E6 C0               		and	11000000b
(1) 3580/    1354 : B3                  		or	e
(1) 3581/    1355 : 5F                  		ld	e,a
(1) 3582/    1356 : CB 51               		bit	2,c
(1) 3583/    1358 : C4 2B 14            		call	nz,fm_send_2
(1) 3584/    135B : CC 20 14            		call	z,fm_send_1
(1) 3585/    135E : C9                  		ret
(1) 3586/    135F :                     
(1) 3587/    135F :                     ; CPU-intense
(1) 3588/    135F :                     ; only call this if needed
(1) 3589/    135F :                     .fm_insupd:
(1) 3590/    135F : C5                  		push	bc
(1) 3591/    1360 : CD 3F 13            		call	.fm_keyoff	; restart chip channel
(1) 3592/    1363 : CD 94 14            		call	dac_fill	; TODO: check if it slowdowns here...
(1) 3593/    1366 : DD E5               		push	ix		; copy ix to hl
(1) 3594/    1368 : E1                  		pop	hl
(1) 3595/    1369 : 79                  		ld	a,c
(1) 3596/    136A : E6 03               		and	011b
(1) 3597/    136C : F6 30               		or	30h
(1) 3598/    136E : CF                  		rst	8
(1) 3599/    136F : 57                  		ld	d,a
(1) 3600/    1370 : 06 1C               		ld	b,4*7
(1) 3601/    1372 :                     .copy_1:
(1) 3602/    1372 : CF                  		rst	8
(1) 3603/    1373 : 5E                  		ld	e,(hl)
(1) 3604/    1374 : CB 51               		bit	2,c
(1) 3605/    1376 : CC 20 14            		call	z,fm_send_1
(1) 3606/    1379 : C4 2B 14            		call	nz,fm_send_2
(1) 3607/    137C : 23                  		inc	hl
(1) 3608/    137D : 14                  		inc	d
(1) 3609/    137E : CF                  		rst	8
(1) 3610/    137F : 00                  		nop
(1) 3611/    1380 : 14                  		inc	d
(1) 3612/    1381 : 14                  		inc	d
(1) 3613/    1382 : 14                  		inc	d
(1) 3614/    1383 : 10 ED               		djnz	.copy_1
(1) 3615/    1385 : 11 04 00            		ld	de,4		; skip AMS, FMS,
(1) 3616/    1388 : 19                  		add	hl,de		; old FM3 check (oops) and keys
(1) 3617/    1389 : 79                  		ld	a,c		; check for Channel 3
(1) 3618/    138A : FE 02               		cp	2
(1) 3619/    138C : 20 36               		jr	nz,.fm_ins_ex
(1) 3620/    138E : CF                  		rst	8
(1) 3621/    138F : 3A F8 1E            		ld	a,(fmSpcMode)	; Is it in special mode?
(1) 3622/    1392 : CB 77               		bit	6,a
(1) 3623/    1394 : 28 2E               		jr	z,.fm_ins_ex
(1) 3624/    1396 : DD E5               		push	ix
(1) 3625/    1398 : DD 21 B0 18         		ld	ix,fm3reg
(1) 3626/    139C : 06 03               		ld	b,3
(1) 3627/    139E :                     .copyops3:
(1) 3628/    139E : 56                  		ld	d,(hl)		; Read OP1-3 freqs
(1) 3629/    139F : 23                  		inc	hl
(1) 3630/    13A0 : CF                  		rst	8
(1) 3631/    13A1 : 5E                  		ld	e,(hl)
(1) 3632/    13A2 : 23                  		inc	hl
(1) 3633/    13A3 : DD 72 00            		ld	(ix),d
(1) 3634/    13A6 : DD 73 02            		ld	(ix+2),e
(1) 3635/    13A9 : DD 23               		inc	ix
(1) 3636/    13AB : CF                  		rst	8
(1) 3637/    13AC : DD 23               		inc	ix
(1) 3638/    13AE : DD 23               		inc	ix
(1) 3639/    13B0 : DD 23               		inc	ix
(1) 3640/    13B2 : 10 EA               		djnz	.copyops3
(1) 3641/    13B4 : DD 21 9E 17         		ld	ix,fmcom+2	; Read OP4 freq
(1) 3642/    13B8 : 56                  		ld	d,(hl)
(1) 3643/    13B9 : 23                  		inc	hl
(1) 3644/    13BA : CF                  		rst	8
(1) 3645/    13BB : 5E                  		ld	e,(hl)
(1) 3646/    13BC : DD 72 18            		ld	(ix+FMFRQH),d
(1) 3647/    13BF : DD 73 1E            		ld	(ix+FMFRQL),e
(1) 3648/    13C2 : DD E1               		pop	ix
(1) 3649/    13C4 :                     .fm_ins_ex:
(1) 3650/    13C4 : C1                  		pop	bc
(1) 3651/    13C5 : C9                  		ret
(1) 3652/    13C6 :                     
(1) 3653/    13C6 :                     ; b - Volume decrement
(1) 3654/    13C6 :                     ; c - Channel id
(1) 3655/    13C6 :                     ; d - 40h+ base reg
(1) 3656/    13C6 :                     ; h - Algorithm
(1) 3657/    13C6 :                     .fm_volupd:
(1) 3658/    13C6 : C5                  		push	bc
(1) 3659/    13C7 : FD 46 0C            		ld	b,(iy+FMVOL)
(1) 3660/    13CA :                     .fm_chnlvol:
(1) 3661/    13CA : DD E5               		push	ix
(1) 3662/    13CC : DD 7E 1C            		ld	a,(ix+1Ch)
(1) 3663/    13CF : E6 07               		and	111b
(1) 3664/    13D1 : 67                  		ld	h,a
(1) 3665/    13D2 : 11 04 00            		ld	de,4
(1) 3666/    13D5 : DD 19               		add	ix,de
(1) 3667/    13D7 : 79                  		ld	a,c
(1) 3668/    13D8 : E6 03               		and	11b
(1) 3669/    13DA : CF                  		rst	8
(1) 3670/    13DB : F6 40               		or	40h
(1) 3671/    13DD : 57                  		ld	d,a
(1) 3672/    13DE : 7C                  		ld	a,h		; Check 40h
(1) 3673/    13DF : FE 07               		cp	7		; Algorithm == 07h?
(1) 3674/    13E1 : CC 0C 14            		call	z,.do_vol
(1) 3675/    13E4 : 7A                  		ld	a,d
(1) 3676/    13E5 : C6 04               		add	a,4
(1) 3677/    13E7 : CF                  		rst	8
(1) 3678/    13E8 : 57                  		ld	d,a
(1) 3679/    13E9 : DD 23               		inc	ix
(1) 3680/    13EB : 7C                  		ld	a,h		; Check 44h
(1) 3681/    13EC : FE 05               		cp	5		; Algorithm > 05h?
(1) 3682/    13EE : D4 0C 14            		call	nc,.do_vol
(1) 3683/    13F1 : 7A                  		ld	a,d
(1) 3684/    13F2 : C6 04               		add	a,4
(1) 3685/    13F4 : 57                  		ld	d,a
(1) 3686/    13F5 : DD 23               		inc	ix
(1) 3687/    13F7 : CF                  		rst	8
(1) 3688/    13F8 : 7C                  		ld	a,h		; Check 48h
(1) 3689/    13F9 : FE 04               		cp	4		; Algorithm > 04h?
(1) 3690/    13FB : D4 0C 14            		call	nc,.do_vol
(1) 3691/    13FE : 7A                  		ld	a,d
(1) 3692/    13FF : C6 04               		add	a,4
(1) 3693/    1401 : 57                  		ld	d,a
(1) 3694/    1402 : DD 23               		inc	ix
(1) 3695/    1404 : CD 0C 14            		call	.do_vol		; Do 4Ch
(1) 3696/    1407 : DD E1               		pop	ix
(1) 3697/    1409 : C1                  		pop	bc
(1) 3698/    140A : CF                  		rst	8
(1) 3699/    140B : C9                  		ret
(1) 3700/    140C :                     .do_vol:
(1) 3701/    140C : DD 7E 00            		ld	a,(ix)
(1) 3702/    140F : 80                  		add	a,b
(1) 3703/    1410 : FE 7F               		cp	7Fh
(1) 3704/    1412 : 38 02               		jr	c,.vmuch
(1) 3705/    1414 : 3E 7F               		ld	a,7Fh
(1) 3706/    1416 :                     .vmuch:
(1) 3707/    1416 : 5F                  		ld	e,a
(1) 3708/    1417 : CB 51               		bit	2,c
(1) 3709/    1419 : CC 20 14            		call	z,fm_send_1
(1) 3710/    141C : C4 2B 14            		call	nz,fm_send_2
(1) 3711/    141F : C9                  		ret
(1) 3712/    1420 :                     
(1) 3713/    1420 :                     ; ---------------------------------------------
(1) 3714/    1420 :                     ; FM send registers
(1) 3715/    1420 :                     ;
(1) 3716/    1420 :                     ; Input:
(1) 3717/    1420 :                     ; d - ctrl
(1) 3718/    1420 :                     ; e - data
(1) 3719/    1420 :                     ; ---------------------------------------------
(1) 3720/    1420 :                     
(1) 3721/    1420 :                     ; Channels 1-3 and global registers
(1) 3722/    1420 :                     fm_send_1:
(1) 3723/    1420 : 7A                  		ld	a,d
(1) 3724/    1421 : 32 00 40            		ld	(Zym_ctrl_1),a
(1) 3725/    1424 : 00                  		nop
(1) 3726/    1425 : 7B                  		ld	a,e
(1) 3727/    1426 : 32 01 40            		ld	(Zym_data_1),a
(1) 3728/    1429 : 00                  		nop
(1) 3729/    142A : C9                  		ret
(1) 3730/    142B :                     ; Channels 4-6
(1) 3731/    142B :                     fm_send_2:
(1) 3732/    142B : 7A                  		ld	a,d
(1) 3733/    142C : 32 02 40            		ld	(Zym_ctrl_2),a
(1) 3734/    142F : 00                  		nop
(1) 3735/    1430 : 7B                  		ld	a,e
(1) 3736/    1431 : 32 03 40            		ld	(Zym_data_2),a
(1) 3737/    1434 : 00                  		nop
(1) 3738/    1435 : C9                  		ret
(1) 3739/    1436 :                     
(1) 3740/    1436 :                     ; --------------------------------------------------------
(1) 3741/    1436 :                     ; brute-force WAVE ON/OFF playback
(1) 3742/    1436 :                     ; --------------------------------------------------------
(1) 3743/    1436 :                     
(1) 3744/    1436 :                     dac_on:
(1) 3745/    1436 : 3E 2B               		ld	a,2Bh
(1) 3746/    1438 : 32 00 40            		ld	(Zym_ctrl_1),a
(1) 3747/    143B : 3E 80               		ld	a,80h
(1) 3748/    143D : 32 01 40            		ld	(Zym_data_1),a
(1) 3749/    1440 : 3E D9               		ld 	a,zopcExx
(1) 3750/    1442 : 32 08 00            		ld	(dac_me),a
(1) 3751/    1445 : 3E F5               		ld 	a,zopcPushAf
(1) 3752/    1447 : 32 94 14            		ld	(dac_fill),a
(1) 3753/    144A : C9                  		ret
(1) 3754/    144B :                     dac_off:
(1) 3755/    144B : 3E 2B               		ld	a,2Bh
(1) 3756/    144D : 32 00 40            		ld	(Zym_ctrl_1),a
(1) 3757/    1450 : 3E 00               		ld	a,00h
(1) 3758/    1452 : 32 01 40            		ld	(Zym_data_1),a
(1) 3759/    1455 : 3E C9               		ld 	a,zopcRet
(1) 3760/    1457 : 32 08 00            		ld	(dac_me),a
(1) 3761/    145A : 3E C9               		ld 	a,zopcRet
(1) 3762/    145C : 32 94 14            		ld	(dac_fill),a
(1) 3763/    145F : C9                  		ret
(1) 3764/    1460 :                     
(1) 3765/    1460 :                     ; --------------------------------------------------------
(1) 3766/    1460 :                     ; dac_play
(1) 3767/    1460 :                     ;
(1) 3768/    1460 :                     ; Plays a new sample
(1) 3769/    1460 :                     ; --------------------------------------------------------
(1) 3770/    1460 :                     
(1) 3771/    1460 :                     dac_play:
(1) 3772/    1460 : F3                  		di
(1) 3773/    1461 : CD 4B 14            		call	dac_off
(1) 3774/    1464 : D9                  		exx				; get exx regs
(1) 3775/    1465 : 01 1B 00            		ld	bc,dWaveBuff>>8		; bc - WAVFIFO MSB
(1) 3776/    1468 : ED 5B D9 19         		ld	de,(wave_Pitch)		; de - Pitch
(1) 3777/    146C : 21 00 00            		ld	hl,(dWaveBuff&0FFh)<<8	; hl - WAVFIFO LSB pointer (xx.00)
(1) 3778/    146F : D9                  		exx				; move them back
(1) 3779/    1470 : 2A D0 19            		ld	hl,(wave_Start)
(1) 3780/    1473 : 3A D2 19            		ld 	a,(wave_Start+2)
(1) 3781/    1476 : 22 F0 1E            		ld	(dDacPntr),hl
(1) 3782/    1479 : 32 F2 1E            		ld	(dDacPntr+2),a
(1) 3783/    147C : 2A D3 19            		ld	hl,(wave_Len)
(1) 3784/    147F : 3A D5 19            		ld 	a,(wave_Len+2)
(1) 3785/    1482 : 22 F3 1E            		ld	(dDacCntr),hl
(1) 3786/    1485 : 32 F5 1E            		ld	(dDacCntr+2),a
(1) 3787/    1488 : AF                  		xor	a
(1) 3788/    1489 : 32 F6 1E            		ld	(dDacFifoMid),a
(1) 3789/    148C : CD A2 14            		call	dac_firstfill
(1) 3790/    148F : CD 36 14            		call	dac_on
(1) 3791/    1492 : FB                  		ei
(1) 3792/    1493 : C9                  		ret
(1) 3793/    1494 :                     
(1) 3794/    1494 :                     ; --------------------------------------------------------
(1) 3795/    1494 :                     ; dac_fill
(1) 3796/    1494 :                     ;
(1) 3797/    1494 :                     ; Refills a half of the WAVE FIFO data, automatic
(1) 3798/    1494 :                     ;
(1) 3799/    1494 :                     ; *** self-modifiable code ***
(1) 3800/    1494 :                     ; --------------------------------------------------------
(1) 3801/    1494 :                     
(1) 3802/    1494 : F5                  dac_fill:	push	af		; <-- code changes between PUSH AF(playing) and RET(stopped)
(1) 3803/    1495 : 3A F6 1E            		ld	a,(dDacFifoMid)
(1) 3804/    1498 : D9                  		exx
(1) 3805/    1499 : AC                  		xor	h		; xx.00
(1) 3806/    149A : D9                  		exx
(1) 3807/    149B : E6 80               		and	80h
(1) 3808/    149D : C2 A6 14            		jp	nz,dac_refill
(1) 3809/    14A0 : F1                  		pop	af
(1) 3810/    14A1 : C9                  		ret
(1) 3811/    14A2 :                     
(1) 3812/    14A2 :                     ; First wave fill
(1) 3813/    14A2 :                     dac_firstfill:
(1) 3814/    14A2 : CD CB 0F            		call	get_tick
(1) 3815/    14A5 : F5                  		push	af
(1) 3816/    14A6 :                     
(1) 3817/    14A6 :                     ; Wave refill request
(1) 3818/    14A6 :                     ; Got this from GEMS, but I changed it to play
(1) 3819/    14A6 :                     ; larger samples (7FFFFFh maximum)
(1) 3820/    14A6 :                     dac_refill:
(1) 3821/    14A6 : CF                  		rst	8
(1) 3822/    14A7 : C5                  		push	bc
(1) 3823/    14A8 : D5                  		push	de
(1) 3824/    14A9 : E5                  		push	hl
(1) 3825/    14AA : 3A DB 19            		ld	a,(wave_Flags)
(1) 3826/    14AD : FE 07               		cp	111b
(1) 3827/    14AF : D2 66 15            		jp	nc,.FDF7
(1) 3828/    14B2 : 3A F5 1E            		ld	a,(dDacCntr+2)	; Last bytes
(1) 3829/    14B5 : 2A F3 1E            		ld	hl,(dDacCntr)
(1) 3830/    14B8 : 01 80 00            		ld	bc,80h
(1) 3831/    14BB : 37                  		scf
(1) 3832/    14BC : 3F                  		ccf
(1) 3833/    14BD : ED 42               		sbc	hl,bc
(1) 3834/    14BF : DE 00               		sbc	a,0
(1) 3835/    14C1 : 32 F5 1E            		ld	(dDacCntr+2),a
(1) 3836/    14C4 : 22 F3 1E            		ld	(dDacCntr),hl
(1) 3837/    14C7 : 16 1B               		ld	d,dWaveBuff>>8
(1) 3838/    14C9 : B7                  		or	a
(1) 3839/    14CA : FA F4 14            		jp	m,.dac_over
(1) 3840/    14CD :                     .keepcntr:
(1) 3841/    14CD : 3A F6 1E            		ld	a,(dDacFifoMid)
(1) 3842/    14D0 : 5F                  		ld	e,a
(1) 3843/    14D1 : C6 80               		add 	a,80h
(1) 3844/    14D3 : 32 F6 1E            		ld	(dDacFifoMid),a
(1) 3845/    14D6 : 2A F0 1E            		ld	hl,(dDacPntr)
(1) 3846/    14D9 : 3A F2 1E            		ld	a,(dDacPntr+2)
(1) 3847/    14DC : CD 3A 10            		call	transferRom
(1) 3848/    14DF : 2A F0 1E            		ld	hl,(dDacPntr)
(1) 3849/    14E2 : 3A F2 1E            		ld	a,(dDacPntr+2)
(1) 3850/    14E5 : 01 80 00            		ld	bc,80h
(1) 3851/    14E8 : 09                  		add	hl,bc
(1) 3852/    14E9 : CE 00               		adc	a,0
(1) 3853/    14EB : 22 F0 1E            		ld	(dDacPntr),hl
(1) 3854/    14EE : 32 F2 1E            		ld	(dDacPntr+2),a
(1) 3855/    14F1 : C3 69 15            		jp	.FDFreturn
(1) 3856/    14F4 :                     
(1) 3857/    14F4 :                     ; if wav's len-timer finished:
(1) 3858/    14F4 :                     .dac_over:
(1) 3859/    14F4 : 16 1B               		ld	d,dWaveBuff>>8
(1) 3860/    14F6 : 3A DB 19            		ld	a,(wave_Flags)
(1) 3861/    14F9 : E6 01               		and	01b
(1) 3862/    14FB : B7                  		or	a
(1) 3863/    14FC : C2 1F 15            		jp	nz,.FDF72
(1) 3864/    14FF : 7D                  		ld	a,l
(1) 3865/    1500 : C6 80               		add	a,80h
(1) 3866/    1502 : 4F                  		ld	c,a
(1) 3867/    1503 : 06 00               		ld	b,0
(1) 3868/    1505 : C5                  		push	bc
(1) 3869/    1506 : 3A F6 1E            		ld	a,(dDacFifoMid)
(1) 3870/    1509 : 5F                  		ld	e,a
(1) 3871/    150A : C6 80               		add	a,80h
(1) 3872/    150C : 32 F6 1E            		ld	(dDacFifoMid),a
(1) 3873/    150F : C1                  		pop	bc			; C <- # just xfered
(1) 3874/    1510 : 79                  		ld	a,c
(1) 3875/    1511 : B0                  		or	b
(1) 3876/    1512 : 28 52               		jr	z,.FDF7
(1) 3877/    1514 : 2A F0 1E            		ld	hl,(dDacPntr)
(1) 3878/    1517 : 3A F2 1E            		ld	a,(dDacPntr+2)
(1) 3879/    151A : CD 3A 10            		call	transferRom
(1) 3880/    151D : 18 47               		jr	.FDF7
(1) 3881/    151F :                     .FDF72:
(1) 3882/    151F :                     
(1) 3883/    151F :                     	; loop sample
(1) 3884/    151F : C5                  		push	bc
(1) 3885/    1520 : D5                  		push	de
(1) 3886/    1521 : 3A D8 19            		ld	a,(wave_Loop+2)
(1) 3887/    1524 : 4F                  		ld	c,a
(1) 3888/    1525 : ED 5B D6 19         		ld	de,(wave_Loop)
(1) 3889/    1529 : 2A D0 19            		ld	hl,(wave_Start)
(1) 3890/    152C : 3A D2 19            		ld 	a,(wave_Start+2)
(1) 3891/    152F : 81                  		add	a,c
(1) 3892/    1530 : 19                  		add	hl,de
(1) 3893/    1531 : CE 00               		adc	a,0
(1) 3894/    1533 : 22 F0 1E            		ld	(dDacPntr),hl
(1) 3895/    1536 : 32 F2 1E            		ld	(dDacPntr+2),a
(1) 3896/    1539 : 2A D3 19            		ld	hl,(wave_Len)
(1) 3897/    153C : 3A D5 19            		ld 	a,(wave_Len+2)
(1) 3898/    153F : 91                  		sub	a,c
(1) 3899/    1540 : 37                  		scf
(1) 3900/    1541 : 3F                  		ccf
(1) 3901/    1542 : ED 52               		sbc	hl,de
(1) 3902/    1544 : DE 00               		sbc	a,0
(1) 3903/    1546 : 22 F3 1E            		ld	(dDacCntr),hl
(1) 3904/    1549 : 32 F5 1E            		ld	(dDacCntr+2),a
(1) 3905/    154C : D1                  		pop	de
(1) 3906/    154D : C1                  		pop	bc
(1) 3907/    154E : 78                  		ld	a,b
(1) 3908/    154F : B1                  		or	c
(1) 3909/    1550 : 28 17               		jr	z,.FDFreturn
(1) 3910/    1552 : 3A F6 1E            		ld	a,(dDacFifoMid)
(1) 3911/    1555 : 5F                  		ld	e,a
(1) 3912/    1556 : C6 80               		add	a,80h
(1) 3913/    1558 : 32 F6 1E            		ld	(dDacFifoMid),a
(1) 3914/    155B : 2A F0 1E            		ld	hl,(dDacPntr)
(1) 3915/    155E : 3A F2 1E            		ld	a,(dDacPntr+2)
(1) 3916/    1561 : CD 3A 10            		call	transferRom
(1) 3917/    1564 : 18 03               		jr	.FDFreturn
(1) 3918/    1566 :                     .FDF7:
(1) 3919/    1566 : CD 4B 14            		call	dac_off		; DAC finished
(1) 3920/    1569 :                     .FDFreturn:
(1) 3921/    1569 : E1                  		pop	hl
(1) 3922/    156A : D1                  		pop	de
(1) 3923/    156B : C1                  		pop	bc
(1) 3924/    156C : F1                  		pop	af
(1) 3925/    156D : C9                  		ret
(1) 3926/    156E :                     
(1) 3927/    156E :                     ; ====================================================================
(1) 3928/    156E :                     ; ----------------------------------------------------------------
(1) 3929/    156E :                     ; Tables
(1) 3930/    156E :                     ; ----------------------------------------------------------------
(1) 3931/    156E :                     
(1) 3932/    156E : 84 02               fmFreq_List:	dw 644
(1) 3933/    1570 : A9 02               		dw 681
(1) 3934/    1572 : D2 02               		dw 722
(1) 3935/    1574 : FD 02               		dw 765
(1) 3936/    1576 : 2A 03               		dw 810
(1) 3937/    1578 : 5A 03               		dw 858
(1) 3938/    157A : 8E 03               		dw 910
(1) 3939/    157C : C4 03               		dw 964
(1) 3940/    157E : FD 03               		dw 1021
(1) 3941/    1580 : 39 04               		dw 1081
(1) 3942/    1582 : 7A 04               		dw 1146
(1) 3943/    1584 : BE 04               		dw 1214
(1) 3944/    1586 :                     psgFreq_List:
(1) 3945/    1586 : FF FF               		dw -1		; C-0 $0
(1) 3946/    1588 : FF FF               		dw -1
(1) 3947/    158A : FF FF               		dw -1
(1) 3948/    158C : FF FF               		dw -1
(1) 3949/    158E : FF FF               		dw -1
(1) 3950/    1590 : FF FF               		dw -1
(1) 3951/    1592 : FF FF               		dw -1
(1) 3952/    1594 : FF FF               		dw -1
(1) 3953/    1596 : FF FF               		dw -1
(1) 3954/    1598 : FF FF               		dw -1
(1) 3955/    159A : FF FF               		dw -1
(1) 3956/    159C : FF FF               		dw -1
(1) 3957/    159E : FF FF               		dw -1		; C-1 $C
(1) 3958/    15A0 : FF FF               		dw -1
(1) 3959/    15A2 : FF FF               		dw -1
(1) 3960/    15A4 : FF FF               		dw -1
(1) 3961/    15A6 : FF FF               		dw -1
(1) 3962/    15A8 : FF FF               		dw -1
(1) 3963/    15AA : FF FF               		dw -1
(1) 3964/    15AC : FF FF               		dw -1
(1) 3965/    15AE : FF FF               		dw -1
(1) 3966/    15B0 : FF FF               		dw -1
(1) 3967/    15B2 : FF FF               		dw -1
(1) 3968/    15B4 : FF FF               		dw -1
(1) 3969/    15B6 : FF FF               		dw -1		; C-2 $18
(1) 3970/    15B8 : FF FF               		dw -1
(1) 3971/    15BA : FF FF               		dw -1
(1) 3972/    15BC : FF FF               		dw -1
(1) 3973/    15BE : FF FF               		dw -1
(1) 3974/    15C0 : FF FF               		dw -1
(1) 3975/    15C2 : FF FF               		dw -1
(1) 3976/    15C4 : FF FF               		dw -1
(1) 3977/    15C6 : FF FF               		dw -1
(1) 3978/    15C8 : FF FF               		dw -1
(1) 3979/    15CA : FF FF               		dw -1
(1) 3980/    15CC : FF FF               		dw -1
(1) 3981/    15CE : FF FF               		dw -1		; C-3 $24
(1) 3982/    15D0 : FF FF               		dw -1
(1) 3983/    15D2 : FF FF               		dw -1
(1) 3984/    15D4 : FF FF               		dw -1
(1) 3985/    15D6 : FF FF               		dw -1
(1) 3986/    15D8 : FF FF               		dw -1
(1) 3987/    15DA : FF FF               		dw -1
(1) 3988/    15DC : FF FF               		dw -1
(1) 3989/    15DE : FF FF               		dw -1
(1) 3990/    15E0 : F8 03               		dw 3F8h
(1) 3991/    15E2 : BF 03               		dw 3BFh
(1) 3992/    15E4 : 89 03               		dw 389h
(1) 3993/    15E6 : 56 03               		dw 356h		;C-4 30
(1) 3994/    15E8 : 26 03               		dw 326h
(1) 3995/    15EA : F9 02               		dw 2F9h
(1) 3996/    15EC : CE 02               		dw 2CEh
(1) 3997/    15EE : A5 02               		dw 2A5h
(1) 3998/    15F0 : 80 02               		dw 280h
(1) 3999/    15F2 : 5C 02               		dw 25Ch
(1) 4000/    15F4 : 3A 02               		dw 23Ah
(1) 4001/    15F6 : 1A 02               		dw 21Ah
(1) 4002/    15F8 : FB 01               		dw 1FBh
(1) 4003/    15FA : DF 01               		dw 1DFh
(1) 4004/    15FC : C4 01               		dw 1C4h
(1) 4005/    15FE : AB 01               		dw 1ABh		;C-5 3C
(1) 4006/    1600 : 93 01               		dw 193h
(1) 4007/    1602 : 7D 01               		dw 17Dh
(1) 4008/    1604 : 67 01               		dw 167h
(1) 4009/    1606 : 53 01               		dw 153h
(1) 4010/    1608 : 40 01               		dw 140h
(1) 4011/    160A : 2E 01               		dw 12Eh
(1) 4012/    160C : 1D 01               		dw 11Dh
(1) 4013/    160E : 0D 01               		dw 10Dh
(1) 4014/    1610 : FE 00               		dw 0FEh
(1) 4015/    1612 : EF 00               		dw 0EFh
(1) 4016/    1614 : E2 00               		dw 0E2h
(1) 4017/    1616 : D6 00               		dw 0D6h		;C-6 48
(1) 4018/    1618 : C9 00               		dw 0C9h
(1) 4019/    161A : BE 00               		dw 0BEh
(1) 4020/    161C : B4 00               		dw 0B4h
(1) 4021/    161E : A9 00               		dw 0A9h
(1) 4022/    1620 : A0 00               		dw 0A0h
(1) 4023/    1622 : 97 00               		dw 97h
(1) 4024/    1624 : 8F 00               		dw 8Fh
(1) 4025/    1626 : 87 00               		dw 87h
(1) 4026/    1628 : 7F 00               		dw 7Fh
(1) 4027/    162A : 78 00               		dw 78h
(1) 4028/    162C : 71 00               		dw 71h
(1) 4029/    162E : 6B 00               		dw 6Bh		; C-7 54
(1) 4030/    1630 : 65 00               		dw 65h
(1) 4031/    1632 : 5F 00               		dw 5Fh
(1) 4032/    1634 : 5A 00               		dw 5Ah
(1) 4033/    1636 : 55 00               		dw 55h
(1) 4034/    1638 : 50 00               		dw 50h
(1) 4035/    163A : 4B 00               		dw 4Bh
(1) 4036/    163C : 47 00               		dw 47h
(1) 4037/    163E : 43 00               		dw 43h
(1) 4038/    1640 : 40 00               		dw 40h
(1) 4039/    1642 : 3C 00               		dw 3Ch
(1) 4040/    1644 : 39 00               		dw 39h
(1) 4041/    1646 : 36 00               		dw 36h		; C-8 $60
(1) 4042/    1648 : 33 00               		dw 33h
(1) 4043/    164A : 30 00               		dw 30h
(1) 4044/    164C : 2D 00               		dw 2Dh
(1) 4045/    164E : 2B 00               		dw 2Bh
(1) 4046/    1650 : 28 00               		dw 28h
(1) 4047/    1652 : 26 00               		dw 26h
(1) 4048/    1654 : 24 00               		dw 24h
(1) 4049/    1656 : 22 00               		dw 22h
(1) 4050/    1658 : 20 00               		dw 20h
(1) 4051/    165A : 1F 00               		dw 1Fh
(1) 4052/    165C : 1D 00               		dw 1Dh
(1) 4053/    165E : 1B 00               		dw 1Bh		; C-9 $6C
(1) 4054/    1660 : 1A 00               		dw 1Ah
(1) 4055/    1662 : 18 00               		dw 18h
(1) 4056/    1664 : 17 00               		dw 17h
(1) 4057/    1666 : 16 00               		dw 16h
(1) 4058/    1668 : 15 00               		dw 15h
(1) 4059/    166A : 13 00               		dw 13h
(1) 4060/    166C : 12 00               		dw 12h
(1) 4061/    166E : 11 00               		dw 11h
(1) 4062/    1670 : 10 00                		dw 10h
(1) 4063/    1672 : 09 00                		dw 9h
(1) 4064/    1674 : 08 00                		dw 8h
(1) 4065/    1676 : 00 00               		dw 0
(1) 4066/    1678 :                     
(1) 4067/    1678 :                     ; TODO: some of these freqs need checking
(1) 4068/    1678 : 00 01               wavFreq_List:	dw 100h		; C-0
(1) 4069/    167A : 00 01               		dw 100h
(1) 4070/    167C : 00 01               		dw 100h
(1) 4071/    167E : 00 01               		dw 100h
(1) 4072/    1680 : 00 01               		dw 100h
(1) 4073/    1682 : 00 01               		dw 100h
(1) 4074/    1684 : 00 01               		dw 100h
(1) 4075/    1686 : 00 01               		dw 100h
(1) 4076/    1688 : 00 01               		dw 100h
(1) 4077/    168A : 00 01               		dw 100h
(1) 4078/    168C : 00 01               		dw 100h
(1) 4079/    168E : 00 01               		dw 100h
(1) 4080/    1690 : 00 01               		dw 100h		; C-1
(1) 4081/    1692 : 00 01               		dw 100h
(1) 4082/    1694 : 00 01               		dw 100h
(1) 4083/    1696 : 00 01               		dw 100h
(1) 4084/    1698 : 00 01               		dw 100h
(1) 4085/    169A : 00 01               		dw 100h
(1) 4086/    169C : 00 01               		dw 100h
(1) 4087/    169E : 00 01               		dw 100h
(1) 4088/    16A0 : 00 01               		dw 100h
(1) 4089/    16A2 : 00 01               		dw 100h
(1) 4090/    16A4 : 00 01               		dw 100h
(1) 4091/    16A6 : 00 01               		dw 100h
(1) 4092/    16A8 : 00 01               		dw 100h		; C-2
(1) 4093/    16AA : 00 01               		dw 100h
(1) 4094/    16AC : 00 01               		dw 100h
(1) 4095/    16AE : 00 01               		dw 100h
(1) 4096/    16B0 : 00 01               		dw 100h
(1) 4097/    16B2 : 00 01               		dw 100h
(1) 4098/    16B4 : 00 01               		dw 100h
(1) 4099/    16B6 : 00 01               		dw 100h
(1) 4100/    16B8 : 00 01               		dw 100h
(1) 4101/    16BA : 00 01               		dw 100h
(1) 4102/    16BC : 36 00               		dw 036h
(1) 4103/    16BE : 3B 00               		dw 03Bh
(1) 4104/    16C0 : 3E 00               		dw 03Eh		; C-3 5512
(1) 4105/    16C2 : 43 00               		dw 043h		; C#3
(1) 4106/    16C4 : 46 00               		dw 046h		; D-3
(1) 4107/    16C6 : 49 00               		dw 049h		; D#3
(1) 4108/    16C8 : 4E 00               		dw 04Eh		; E-3
(1) 4109/    16CA : 54 00               		dw 054h		; F-3
(1) 4110/    16CC : 58 00               		dw 058h		; F#3
(1) 4111/    16CE : 5E 00               		dw 05Eh		; G-3 8363 -17
(1) 4112/    16D0 : 63 00               		dw 063h		; G#3
(1) 4113/    16D2 : 68 00               		dw 068h		; A-3
(1) 4114/    16D4 : 70 00               		dw 070h		; A#3
(1) 4115/    16D6 : 75 00               		dw 075h		; B-3
(1) 4116/    16D8 : 81 00               		dw 081h		; C-4 11025 -12
(1) 4117/    16DA : 87 00               		dw 087h		; C#4
(1) 4118/    16DC : 8C 00               		dw 08Ch		; D-4
(1) 4119/    16DE : 9A 00               		dw 09Ah		; D#4
(1) 4120/    16E0 : 9E 00               		dw 09Eh		; E-4
(1) 4121/    16E2 : AD 00               		dw 0ADh		; F-4
(1) 4122/    16E4 : B2 00               		dw 0B2h		; F#4
(1) 4123/    16E6 : C0 00               		dw 0C0h		; G-4
(1) 4124/    16E8 : CC 00               		dw 0CCh		; G#4
(1) 4125/    16EA : D7 00               		dw 0D7h		; A-4
(1) 4126/    16EC : E6 00               		dw 0E6h		; A#4
(1) 4127/    16EE : F0 00               		dw 0F0h		; B-4
(1) 4128/    16F0 : 00 01               		dw 100h		; C-5 22050
(1) 4129/    16F2 : 10 01               		dw 110h		; C#5
(1) 4130/    16F4 : 20 01               		dw 120h		; D-5
(1) 4131/    16F6 : 2C 01               		dw 12Ch		; D#5
(1) 4132/    16F8 : 42 01               		dw 142h		; E-5
(1) 4133/    16FA : 58 01               		dw 158h		; F-5
(1) 4134/    16FC : 6A 01               		dw 16Ah		; F#5 32000 +6
(1) 4135/    16FE : 7E 01               		dw 17Eh		; G-5
(1) 4136/    1700 : 90 01               		dw 190h		; G#5
(1) 4137/    1702 : AC 01               		dw 1ACh		; A-5
(1) 4138/    1704 : C2 01               		dw 1C2h		; A#5
(1) 4139/    1706 : E0 01               		dw 1E0h		; B-5
(1) 4140/    1708 : F8 01               		dw 1F8h		; C-6 44100 +12
(1) 4141/    170A : 10 02               		dw 210h		; C#6
(1) 4142/    170C : 40 02               		dw 240h		; D-6
(1) 4143/    170E : 60 02               		dw 260h		; D#6
(1) 4144/    1710 : 80 02               		dw 280h		; E-6
(1) 4145/    1712 : A0 02               		dw 2A0h		; F-6
(1) 4146/    1714 : D0 02               		dw 2D0h		; F#6
(1) 4147/    1716 : F8 02               		dw 2F8h		; G-6
(1) 4148/    1718 : 20 03               		dw 320h		; G#6
(1) 4149/    171A : 50 03               		dw 350h		; A-6
(1) 4150/    171C : 80 03               		dw 380h		; A#6
(1) 4151/    171E : C0 03               		dw 3C0h		; B-6
(1) 4152/    1720 : 00 04               		dw 400h		; C-7 88200
(1) 4153/    1722 : 00 01               		dw 100h
(1) 4154/    1724 : 00 01               		dw 100h
(1) 4155/    1726 : 00 01               		dw 100h
(1) 4156/    1728 : 00 01               		dw 100h
(1) 4157/    172A : 00 01               		dw 100h
(1) 4158/    172C : 00 01               		dw 100h
(1) 4159/    172E : 00 01               		dw 100h
(1) 4160/    1730 : 00 01               		dw 100h
(1) 4161/    1732 : 00 01               		dw 100h
(1) 4162/    1734 : 00 01               		dw 100h
(1) 4163/    1736 : 00 01               		dw 100h
(1) 4164/    1738 : 00 01               		dw 100h		; C-8
(1) 4165/    173A : 00 01               		dw 100h
(1) 4166/    173C : 00 01               		dw 100h
(1) 4167/    173E : 00 01               		dw 100h
(1) 4168/    1740 : 00 01               		dw 100h
(1) 4169/    1742 : 00 01               		dw 100h
(1) 4170/    1744 : 00 01               		dw 100h
(1) 4171/    1746 : 00 01               		dw 100h
(1) 4172/    1748 : 00 01               		dw 100h
(1) 4173/    174A : 00 01               		dw 100h
(1) 4174/    174C : 00 01               		dw 100h
(1) 4175/    174E : 00 01               		dw 100h
(1) 4176/    1750 : 00 01               		dw 100h		; C-9
(1) 4177/    1752 : 00 01               		dw 100h
(1) 4178/    1754 : 00 01               		dw 100h
(1) 4179/    1756 : 00 01               		dw 100h
(1) 4180/    1758 : 00 01               		dw 100h
(1) 4181/    175A : 00 01               		dw 100h
(1) 4182/    175C : 00 01               		dw 100h
(1) 4183/    175E : 00 01               		dw 100h
(1) 4184/    1760 : 00 01               		dw 100h
(1) 4185/    1762 : 00 01               		dw 100h
(1) 4186/    1764 : 00 01               		dw 100h
(1) 4187/    1766 : 00 01               		dw 100h
(1) 4188/    1768 :                     
(1) 4189/    1768 :                     ; --------------------------------------------------------
(1) 4190/    1768 :                     
(1) 4191/    1768 :                     	; PSG psuedo-controls
(1) 4192/    1768 : 00 00 00 00         psgcom		db 00h,00h,00h,00h	;  0 command 1 = key on, 2 = key off, 4 = stop snd
(1) 4193/    176C : FF FF FF FF         psglev		db -1, -1, -1, -1	;  4 output level attenuation (%llll.0000, -1 = silent)
(1) 4194/    1770 : 00 00 00 00         psgatk		db 00h,00h,00h,00h	;  8 attack rate
(1) 4195/    1774 : 00 00 00 00         psgdec		db 00h,00h,00h,00h	; 12 decay rate
(1) 4196/    1778 : 00 00 00 00         psgslv		db 00h,00h,00h,00h	; 16 sustain level attenuation
(1) 4197/    177C : 00 00 00 00         psgrrt		db 00h,00h,00h,00h	; 20 release rate
(1) 4198/    1780 : 00 00 00 00         psgenv		db 00h,00h,00h,00h	; 24 envelope mode 0 = off, 1 = attack, 2 = decay, 3 = sustain, 4
(1) 4199/    1784 : 00 00 00 00         psgdtl		db 00h,00h,00h,00h	; 28 tone bottom 4 bits
(1) 4200/    1788 : 00 00 00 00         psgdth		db 00h,00h,00h,00h	; 32 tone upper 6 bits
(1) 4201/    178C : 00 00 00 00         psgalv		db 00h,00h,00h,00h	; 36 attack level attenuation
(1) 4202/    1790 : 00 00 00 00         whdflg		db 00h,00h,00h,00h	; 40 flags to indicate hardware should be updated
(1) 4203/    1794 : 00 00 00 00         psgtim		db 00h,00h,00h,00h	; 44 timer for sustain
(1) 4204/    1798 : 00 00 00 00         psgvol		db 00h,00h,00h,00h
(1) 4205/    179C : 00 00 00 00 00 00   fmcom:		db 00h,00h,00h,00h,00h,00h	;  0 - play bits: 2-cut 1-off 0-play
(1) 4206/    17A2 : 00 00 00 00 00 00   		db 00h,00h,00h,00h,00h,00h	;  6 - keys xxxx0000b
(1) 4207/    17A8 : 00 00 00 00 00 00   		db 00h,00h,00h,00h,00h,00h	; 12 - volume (for 40h+)
(1) 4208/    17AE : 00 00 00 00 00 00   		db 00h,00h,00h,00h,00h,00h	; 18 - panning (%LR000000)
(1) 4209/    17B4 : 00 00 00 00 00 00   		db 00h,00h,00h,00h,00h,00h	; 24 - A4h+ (MSB FIRST)
(1) 4210/    17BA : 00 00 00 00 00 00   		db 00h,00h,00h,00h,00h,00h	; 30 - A0h+
(1) 4211/    17C0 :                     fmins_com:	ds 028h			; Current instrument data for each FM
(1) 4212/    17E8 :                     fmins_com2:	ds 028h
(1) 4213/    1810 :                     fmins_com3:	ds 028h
(1) 4214/    1838 :                     fmins_com4:	ds 028h
(1) 4215/    1860 :                     fmins_com5:	ds 028h
(1) 4216/    1888 :                     fmins_com6:	ds 028h
(1) 4217/    18B0 : 00 AC 00 A8         fm3reg:		dw 0AC00h,0A800h	; S3-S1, S4 is at A6/A2
(1) 4218/    18B4 : 00 AD 00 A9         		dw 0AD00h,0A900h
(1) 4219/    18B8 : 00 AE 00 AA         		dw 0AE00h,0AA00h
(1) 4220/    18BC : 00                  daccom:		db 0			; single byte for key on, off and cut
(1) 4221/    18BD :                     
(1) 4222/    18BD :                     trkPointers:
(1) 4223/    18BD : 00 1E               		dw trkBuff_0
(1) 4224/    18BF : 00 1F               		dw trkBuff_1
(1) 4225/    18C1 :                     
(1) 4226/    18C1 :                     ; ====================================================================
(1) 4227/    18C1 :                     ; ----------------------------------------------------------------
(1) 4228/    18C1 :                     ; Z80 RAM
(1) 4229/    18C1 :                     ; ----------------------------------------------------------------
(1) 4230/    18C1 :                     
(1) 4231/    18C1 :                     insDataC_0	ds 8*16		; Instrument data for each Track slot
(1) 4232/    1941 :                     insDataC_1	ds 8*16		; 8*MAX_INS
(1) 4233/    19C1 : 00                  x68ksrclsb	db 0			; transferRom temporal LSB
(1) 4234/    19C2 : 00                  x68ksrcmid	db 0			; transferRom temporal MID
(1) 4235/    19C3 : 00 00               currInsData	dw 0
(1) 4236/    19C5 : 00 00               currTblPos	dw 0
(1) 4237/    19C7 : 00 00               currInsPos	dw 0
(1) 4238/    19C9 : 00 00               currTrkCtrl	dw 0
(1) 4239/    19CB : 00                  currTickBits	db 0		; Current Tick/Tempo bitflags (000000BTb B-beat, T-tick)
(1) 4240/    19CC : 00                  marsUpd		db 0		; update PWM sound
(1) 4241/    19CD : 00 00               tickFlag	dw 0			; Tick flag from VBlank, Read as (tickFlag+1) for reading/reseting
(1) 4242/    19CF : 00                  tickCnt		db 0			; Tick counter (PUT THIS TAG AFTER tickFlag)
(1) 4243/    19D0 : 00 00               wave_Start	dw 0		; START: 68k 24-bit pointer
(1) 4244/    19D2 : 00                  		db 0
(1) 4245/    19D3 : 00 00               wave_Len	dw 0		; LENGTH 24-bit
(1) 4246/    19D5 : 00                  		db 0
(1) 4247/    19D6 : 00 00               wave_Loop	dw 0		; LOOP POINT 24-bit (MUST BE BELOW wave_Len)
(1) 4248/    19D8 : 00                  		db 0
(1) 4249/    19D9 : 00 01               wave_Pitch	dw 0100h	; 01.00h
(1) 4250/    19DB : 00                  wave_Flags	db 0		; WAVE playback flags (%10x: 1 loop / 0 no loop)
(1) 4251/    19DC :                     
(1) 4252/    19DC :                     	; Channel tables: 10h bytes
(1) 4253/    19DC :                     	; 0  - Link addr (0000h = free, used chnls start from +0020h)
(1) 4254/    19DC :                     	; 2  - Channel index (ID is set extrenally)
(1) 4255/    19DC :                     	; 3  - Pitch
(1) 4256/    19DC :                     	; 4+ - Channel specific...
(1) 4257/    19DC :                     
(1) 4258/    19DC :                     	; PSG (80h+)
(1) 4259/    19DC :                     	;  4 - psgNoise mode
(1) 4260/    19DC : 00 00 00 00 00 00   tblPSG:		db 00h,00h,00h,00h,00h,00h,00h,00h	; Channel 1
                    00 00 
(1) 4261/    19E4 : 00 00 01 00 00 00   		db 00h,00h,01h,00h,00h,00h,00h,00h	; Channel 2
                    00 00 
(1) 4262/    19EC : 00 00 02 00 00 00   		db 00h,00h,02h,00h,00h,00h,00h,00h	; Channel 3
                    00 00 
(1) 4263/    19F4 : FF FF               		dw -1	; end-of-list
(1) 4264/    19F6 : 00 00 03 00 00 00   tblPSGN:	db 00h,00h,03h,00h,00h,00h,00h,00h	; Noise (DIRECT CHECK only)
                    00 00 
(1) 4265/    19FE :                     
(1) 4266/    19FE :                     	; FM: 90h+ FM3: 0A0h DAC: 0B0h
(1) 4267/    19FE :                     	;  4 - Special mode (FM3: Special, FM6: DAC)
(1) 4268/    19FE :                     	;  5 - 24-bit copy of ROM instrument pointer
(1) 4269/    19FE : 00 00 00 00 00 00   tblFM:		db 00h,00h,00h,00h,00h,00h,00h,00h	; Channel 1
                    00 00 
(1) 4270/    1A06 : 00 00 01 00 00 00   		db 00h,00h,01h,00h,00h,00h,00h,00h	; Channel 2
                    00 00 
(1) 4271/    1A0E : 00 00 03 00 00 00   		db 00h,00h,03h,00h,00h,00h,00h,00h	; Channel 4
                    00 00 
(1) 4272/    1A16 : 00 00 04 00 00 00   		db 00h,00h,04h,00h,00h,00h,00h,00h	; Channel 5
                    00 00 
(1) 4273/    1A1E : 00 00 02 00 00 00   tblFM3:		db 00h,00h,02h,00h,00h,00h,00h,00h	; Channel 3
                    00 00 
(1) 4274/    1A26 : 00 00 05 00 00 00   tblFM6:		db 00h,00h,05h,00h,00h,00h,00h,00h	; Channel 6
                    00 00 
(1) 4275/    1A2E : FF FF               		dw -1	; end-of-list
(1) 4276/    1A30 :                     
(1) 4277/    1A30 : 00 00 00 00 00 00   tblPWM:		db 00h,00h,00h,00h,00h,00h,00h,00h	; Channel 1
                    00 00 
(1) 4278/    1A38 : 00 00 01 00 00 00   		db 00h,00h,01h,00h,00h,00h,00h,00h	; Channel 2
                    00 00 
(1) 4279/    1A40 : 00 00 02 00 00 00   		db 00h,00h,02h,00h,00h,00h,00h,00h	; Channel 3
                    00 00 
(1) 4280/    1A48 : 00 00 03 00 00 00   		db 00h,00h,03h,00h,00h,00h,00h,00h	; Channel 4
                    00 00 
(1) 4281/    1A50 : 00 00 04 00 00 00   		db 00h,00h,04h,00h,00h,00h,00h,00h	; Channel 5
                    00 00 
(1) 4282/    1A58 : 00 00 05 00 00 00   		db 00h,00h,05h,00h,00h,00h,00h,00h	; Channel 6
                    00 00 
(1) 4283/    1A60 : 00 00 06 00 00 00   		db 00h,00h,06h,00h,00h,00h,00h,00h	; Channel 7
                    00 00 
(1) 4284/    1A68 : FF FF               		dw -1
(1) 4285/    1A6A :                     
(1) 4286/    1A6A :                     	; Format:
(1) 4287/    1A6A :                     	; %00VP0CFO
(1) 4288/    1A6A :                     	; $vp
(1) 4289/    1A6A :                     	; $pp
(1) 4290/    1A6A :                     	; $fi + flags
(1) 4291/    1A6A :                     	; $ii
(1) 4292/    1A6A :                     	; $ii
(1) 4293/    1A6A :                     	; $ii
(1) 4294/    1A6A :                     ; 	 align 8
(1) 4295/    1A6A : 00 00 00 00 00 00   pwmcom:		db 00h,00h,00h,00h,00h,00h,00h,00h	; Playback bits: KeyOn/KeyOff/KeyCut/other update bits
                    00 00 
(1) 4296/    1A72 : 00 00 00 00 00 00   		db 00h,00h,00h,00h,00h,00h,00h,00h	; Volume | Pitch MSB
                    00 00 
(1) 4297/    1A7A : 00 00 00 00 00 00   		db 00h,00h,00h,00h,00h,00h,00h,00h	; Pitch LSB
                    00 00 
(1) 4298/    1A82 : 00 00 00 00 00 00   		db 00h,00h,00h,00h,00h,00h,00h,00h	; Playback flags: Loop/Stereo/Left/Right | 32-bit
                    00 00 
(1) 4299/    1A8A : 00 00 00 00 00 00   		db 00h,00h,00h,00h,00h,00h,00h,00h	; sample location
                    00 00 
(1) 4300/    1A92 : 00 00 00 00 00 00   		db 00h,00h,00h,00h,00h,00h,00h,00h
                    00 00 
(1) 4301/    1A9A : 00 00 00 00 00 00   		db 00h,00h,00h,00h,00h,00h,00h,00h
                    00 00 
(1) 4302/    1AA2 :                     
(1) 4303/    1AA2 : (MACRO)             		org 1B00h
(1) 4303/    1AA2 : 00                                                  db 0
(1) 4303/    1AA3 : 00                                                  db 0
(1) 4303/    1AA4 : 00                                                  db 0
(1) 4303/    1AA5 : 00                                                  db 0
(1) 4303/    1AA6 : 00                                                  db 0
(1) 4303/    1AA7 : 00                                                  db 0
(1) 4303/    1AA8 : 00                                                  db 0
(1) 4303/    1AA9 : 00                                                  db 0
(1) 4303/    1AAA : 00                                                  db 0
(1) 4303/    1AAB : 00                                                  db 0
(1) 4303/    1AAC : 00                                                  db 0
(1) 4303/    1AAD : 00                                                  db 0
(1) 4303/    1AAE : 00                                                  db 0
(1) 4303/    1AAF : 00                                                  db 0
(1) 4303/    1AB0 : 00                                                  db 0
(1) 4303/    1AB1 : 00                                                  db 0
(1) 4303/    1AB2 : 00                                                  db 0
(1) 4303/    1AB3 : 00                                                  db 0
(1) 4303/    1AB4 : 00                                                  db 0
(1) 4303/    1AB5 : 00                                                  db 0
(1) 4303/    1AB6 : 00                                                  db 0
(1) 4303/    1AB7 : 00                                                  db 0
(1) 4303/    1AB8 : 00                                                  db 0
(1) 4303/    1AB9 : 00                                                  db 0
(1) 4303/    1ABA : 00                                                  db 0
(1) 4303/    1ABB : 00                                                  db 0
(1) 4303/    1ABC : 00                                                  db 0
(1) 4303/    1ABD : 00                                                  db 0
(1) 4303/    1ABE : 00                                                  db 0
(1) 4303/    1ABF : 00                                                  db 0
(1) 4303/    1AC0 : 00                                                  db 0
(1) 4303/    1AC1 : 00                                                  db 0
(1) 4303/    1AC2 : 00                                                  db 0
(1) 4303/    1AC3 : 00                                                  db 0
(1) 4303/    1AC4 : 00                                                  db 0
(1) 4303/    1AC5 : 00                                                  db 0
(1) 4303/    1AC6 : 00                                                  db 0
(1) 4303/    1AC7 : 00                                                  db 0
(1) 4303/    1AC8 : 00                                                  db 0
(1) 4303/    1AC9 : 00                                                  db 0
(1) 4303/    1ACA : 00                                                  db 0
(1) 4303/    1ACB : 00                                                  db 0
(1) 4303/    1ACC : 00                                                  db 0
(1) 4303/    1ACD : 00                                                  db 0
(1) 4303/    1ACE : 00                                                  db 0
(1) 4303/    1ACF : 00                                                  db 0
(1) 4303/    1AD0 : 00                                                  db 0
(1) 4303/    1AD1 : 00                                                  db 0
(1) 4303/    1AD2 : 00                                                  db 0
(1) 4303/    1AD3 : 00                                                  db 0
(1) 4303/    1AD4 : 00                                                  db 0
(1) 4303/    1AD5 : 00                                                  db 0
(1) 4303/    1AD6 : 00                                                  db 0
(1) 4303/    1AD7 : 00                                                  db 0
(1) 4303/    1AD8 : 00                                                  db 0
(1) 4303/    1AD9 : 00                                                  db 0
(1) 4303/    1ADA : 00                                                  db 0
(1) 4303/    1ADB : 00                                                  db 0
(1) 4303/    1ADC : 00                                                  db 0
(1) 4303/    1ADD : 00                                                  db 0
(1) 4303/    1ADE : 00                                                  db 0
(1) 4303/    1ADF : 00                                                  db 0
(1) 4303/    1AE0 : 00                                                  db 0
(1) 4303/    1AE1 : 00                                                  db 0
(1) 4303/    1AE2 : 00                                                  db 0
(1) 4303/    1AE3 : 00                                                  db 0
(1) 4303/    1AE4 : 00                                                  db 0
(1) 4303/    1AE5 : 00                                                  db 0
(1) 4303/    1AE6 : 00                                                  db 0
(1) 4303/    1AE7 : 00                                                  db 0
(1) 4303/    1AE8 : 00                                                  db 0
(1) 4303/    1AE9 : 00                                                  db 0
(1) 4303/    1AEA : 00                                                  db 0
(1) 4303/    1AEB : 00                                                  db 0
(1) 4303/    1AEC : 00                                                  db 0
(1) 4303/    1AED : 00                                                  db 0
(1) 4303/    1AEE : 00                                                  db 0
(1) 4303/    1AEF : 00                                                  db 0
(1) 4303/    1AF0 : 00                                                  db 0
(1) 4303/    1AF1 : 00                                                  db 0
(1) 4303/    1AF2 : 00                                                  db 0
(1) 4303/    1AF3 : 00                                                  db 0
(1) 4303/    1AF4 : 00                                                  db 0
(1) 4303/    1AF5 : 00                                                  db 0
(1) 4303/    1AF6 : 00                                                  db 0
(1) 4303/    1AF7 : 00                                                  db 0
(1) 4303/    1AF8 : 00                                                  db 0
(1) 4303/    1AF9 : 00                                                  db 0
(1) 4303/    1AFA : 00                                                  db 0
(1) 4303/    1AFB : 00                                                  db 0
(1) 4303/    1AFC : 00                                                  db 0
(1) 4303/    1AFD : 00                                                  db 0
(1) 4303/    1AFE : 00                                                  db 0
(1) 4303/    1AFF : 00                                                  db 0
(1) 4303/    1B00 :                     
(1) 4304/    1B00 :                     dWaveBuff	ds 100h			; WAVE data buffer: 100h bytes, updates every 80h
(1) 4305/    1C00 :                     trkData_0	ds 100h			; Track note-cache buffers: 100h bytes, updates every 80h
(1) 4306/    1D00 :                     trkData_1	ds 100h
(1) 4307/    1E00 :                     trkBuff_0	ds 20h+(MAX_TRKCHN*8)	;  *** TRACK BUFFER 0, 100h aligned ****
(1) 4308/    1EB0 :                     commZfifo	ds 40h			; Buffer for command requests from 68k (40h bytes, loops)
(1) 4309/    1EF0 : 00 00 00            dDacPntr	db 0,0,0		; WAVE play current ROM position
(1) 4310/    1EF3 : 00 00 00            dDacCntr	db 0,0,0		; WAVE play length counter
(1) 4311/    1EF6 : 00                  dDacFifoMid	db 0			; WAVE play halfway refill flag (00h/80h)
(1) 4312/    1EF7 : 00                  psgHatMode	db 0
(1) 4313/    1EF8 : 00                  fmSpcMode	db 0
(1) 4314/    1EF9 : 00                  flagResChip	db 0			; reset chips flag
(1) 4315/    1EFA :                     trkHdOut	ds 6			; temporal Header for reading Track position/row count
(1) 4316/    1F00 :                     trkBuff_1	ds 20h+(MAX_TRKCHN*8)	;  *** TRACK BUFFER 1, 100h aligned ****
(1) 4317/    1FB0 :                     
(1) 4318/    1FB0 :                     ; Stack area
(1) 4319/    1FB0 :                     
      50/    1FB0 :                     		cpu 68000
      51/    1FB0 :                     		padding off
      52/    44CC :                     		phase Z80_CODE+*
      53/    44CC :                     Z80_CODE_END:
      54/    44CC :                     		align 2
      55/    44CC :                     		include "sound/instr.asm"
(1)    1/    44CC :                     ; ====================================================================
(1)    2/    44CC :                     ; ----------------------------------------------------------------
(1)    3/    44CC :                     ; PSG, FM, DAC and PWM instruments go here
(1)    4/    44CC :                     ;
(1)    5/    44CC :                     ; Any 68k BANK must be set externally if required.
(1)    6/    44CC :                     ; (macros add the bank automaticly)
(1)    7/    44CC :                     ; ----------------------------------------------------------------
(1)    8/    44CC :                     
(1)    9/    44CC :                     ; Special include macro for samples
(1)   10/    44CC :                     ; Works for both DAC and PWM
(1)   11/    44CC :                     ;
(1)   12/    44CC :                     ; aligns by 4 at the end so the sample can recycled on 32X
(1)   13/    44CC :                     gSmpl macro locate,loop
(1)   14/    44CC :                     .start
(1)   15/    44CC :                     	dc.b ((.end-.start)&$FF),(((.end-.start)>>8)&$FF),(((.end-.start)>>16)&$FF)	; length
(1)   16/    44CC :                     	dc.b ((loop)&$FF),(((loop)>>8)&$FF),(((loop)>>16)&$FF)
(1)   17/    44CC :                     	binclude locate,$2C	; actual data
(1)   18/    44CC :                     .end
(1)   19/    44CC :                     	align 4			; align 4 for pwm's
(1)   20/    44CC :                     	endm
(1)   21/    44CC :                     
(1)   22/    44CC :                     ; --------------------------------------------------------
(1)   23/    44CC :                     ; DAC samples
(1)   24/    44CC :                     ; --------------------------------------------------------
(1)   25/    44CC :                     
(1)   26/    44CC :                     	align 4			; FIRST ALIGN FOR PWMs
(1)   27/    44CC :                     DacIns_Magic2:
(1)   28/    44CC : (MACRO)             	gSmpl "sound/instr/smpl/magic_2.wav",0
(1)   28/    44CC :                     .start
(1)   28/    44CC : 3A8E 01                     dc.b ((.end-.start)&$FF),(((.end-.start)>>8)&$FF),(((.end-.start)>>16)&$FF)     ; length
(1)   28/    44CF : 0000 00                     dc.b ((0)&$FF),(((0)>>8)&$FF),(((0)>>16)&$FF)
(1)   28/    44D2 :                             binclude "sound/instr/smpl/magic_2.wav",$2C     ; actual data
(1)   28/   1D306 :                     .end
(1)   28/   1D306 :                             align 4                 ; align 4 for pwm's
(1)   29/   1D308 :                     DacIns_Snare_Gem:
(1)   30/   1D308 : (MACRO)             	gSmpl "sound/instr/smpl/snare_lobo.wav",0
(1)   30/   1D308 :                     .start
(1)   30/   1D308 : 2A11 00                     dc.b ((.end-.start)&$FF),(((.end-.start)>>8)&$FF),(((.end-.start)>>16)&$FF)     ; length
(1)   30/   1D30B : 0000 00                     dc.b ((0)&$FF),(((0)>>8)&$FF),(((0)>>16)&$FF)
(1)   30/   1D30E :                             binclude "sound/instr/smpl/snare_lobo.wav",$2C     ; actual data
(1)   30/   1E432 :                     .end
(1)   30/   1E432 :                             align 4                 ; align 4 for pwm's
(1)   31/   1E434 :                     DacIns_CdSnare:
(1)   32/   1E434 : (MACRO)             	gSmpl "sound/instr/smpl/cd_snare.wav",0
(1)   32/   1E434 :                     .start
(1)   32/   1E434 : FA19 00                     dc.b ((.end-.start)&$FF),(((.end-.start)>>8)&$FF),(((.end-.start)>>16)&$FF)     ; length
(1)   32/   1E437 : 0000 00                     dc.b ((0)&$FF),(((0)>>8)&$FF),(((0)>>16)&$FF)
(1)   32/   1E43A :                             binclude "sound/instr/smpl/cd_snare.wav",$2C     ; actual data
(1)   32/   1FE2E :                     .end
(1)   32/   1FE2E :                             align 4                 ; align 4 for pwm's
(1)   33/   1FE30 :                     DacIns_SaurKick:
(1)   34/   1FE30 : (MACRO)             	gSmpl "sound/instr/smpl/sauron_kick.wav",0
(1)   34/   1FE30 :                     .start
(1)   34/   1FE30 : 940F 00                     dc.b ((.end-.start)&$FF),(((.end-.start)>>8)&$FF),(((.end-.start)>>16)&$FF)     ; length
(1)   34/   1FE33 : 0000 00                     dc.b ((0)&$FF),(((0)>>8)&$FF),(((0)>>16)&$FF)
(1)   34/   1FE36 :                             binclude "sound/instr/smpl/sauron_kick.wav",$2C     ; actual data
(1)   34/   20DC4 :                     .end
(1)   34/   20DC4 :                             align 4                 ; align 4 for pwm's
(1)   35/   20DC4 :                     DacIns_SaurSnare:
(1)   36/   20DC4 : (MACRO)             	gSmpl "sound/instr/smpl/sauron_snare.wav",0
(1)   36/   20DC4 :                     .start
(1)   36/   20DC4 : E60C 00                     dc.b ((.end-.start)&$FF),(((.end-.start)>>8)&$FF),(((.end-.start)>>16)&$FF)     ; length
(1)   36/   20DC7 : 0000 00                     dc.b ((0)&$FF),(((0)>>8)&$FF),(((0)>>16)&$FF)
(1)   36/   20DCA :                             binclude "sound/instr/smpl/sauron_snare.wav",$2C     ; actual data
(1)   36/   21AAA :                     .end
(1)   36/   21AAA :                             align 4                 ; align 4 for pwm's
(1)   37/   21AAC :                     DacIns_String1:
(1)   38/   21AAC : (MACRO)             	gSmpl "sound/instr/smpl/string_1.wav",0
(1)   38/   21AAC :                     .start
(1)   38/   21AAC : 5C48 00                     dc.b ((.end-.start)&$FF),(((.end-.start)>>8)&$FF),(((.end-.start)>>16)&$FF)     ; length
(1)   38/   21AAF : 0000 00                     dc.b ((0)&$FF),(((0)>>8)&$FF),(((0)>>16)&$FF)
(1)   38/   21AB2 :                             binclude "sound/instr/smpl/string_1.wav",$2C     ; actual data
(1)   38/   26308 :                     .end
(1)   38/   26308 :                             align 4                 ; align 4 for pwm's
(1)   39/   26308 :                     DacIns_LowString:
(1)   40/   26308 : (MACRO)             	gSmpl "sound/instr/smpl/lowstring.wav",1200
(1)   40/   26308 :                     .start
(1)   40/   26308 : 8A8B 00                     dc.b ((.end-.start)&$FF),(((.end-.start)>>8)&$FF),(((.end-.start)>>16)&$FF)     ; length
(1)   40/   2630B : B004 00                     dc.b ((1200)&$FF),(((1200)>>8)&$FF),(((1200)>>16)&$FF)
(1)   40/   2630E :                             binclude "sound/instr/smpl/lowstring.wav",$2C     ; actual data
(1)   40/   2EE92 :                     .end
(1)   40/   2EE92 :                             align 4                 ; align 4 for pwm's
(1)   41/   2EE94 :                     
(1)   42/   2EE94 :                     ; --------------------------------------------------------
(1)   43/   2EE94 :                     ; FM instruments/patches
(1)   44/   2EE94 :                     ; --------------------------------------------------------
(1)   45/   2EE94 :                     
(1)   46/   2EE94 :                     ; Sizes
(1)   47/   2EE94 :                     ; Normal FM ins: $20
(1)   48/   2EE94 :                     ; Special FM ins: $28
(1)   49/   2EE94 :                     ;
(1)   50/   2EE94 :                     
(1)   51/   2EE94 :                     ; FM3 Special
(1)   52/   2EE94 :                     FmIns_Fm3_OpenHat:
(1)   53/   2EE94 :                     		binclude "sound/instr/fm/fm3_openhat.gsx",$2478,$28
(1)   54/   2EEBC :                     FmIns_Fm3_ClosedHat:
(1)   55/   2EEBC :                     		binclude "sound/instr/fm/fm3_closedhat.gsx",$2478,$28
(1)   56/   2EEE4 :                     FmIns_Fm3_Explosion:
(1)   57/   2EEE4 :                     		binclude "sound/instr/fm/fm3_sfx_boomworm.gsx",$2478,$28
(1)   58/   2EF0C :                     
(1)   59/   2EF0C :                     ; Normal
(1)   60/   2EF0C :                     FmIns_Guitar_gem:
(1)   61/   2EF0C :                     		binclude "sound/instr/fm/guitar_gem.gsx",$2478,$20
(1)   62/   2EF2C :                     Fmins_Guitar_Heavy:
(1)   63/   2EF2C :                     		binclude "sound/instr/fm/guitar_heavy.gsx",$2478,$20
(1)   64/   2EF4C :                     Fmins_Guitar_puy:
(1)   65/   2EF4C :                     		binclude "sound/instr/fm/guitar_puy.gsx",$2478,$20
(1)   66/   2EF6C :                     Fmins_Guitar_puy_2:
(1)   67/   2EF6C :                     		binclude "sound/instr/fm/guitar_puy_2.gsx",$2478,$20
(1)   68/   2EF8C :                     FmIns_DrumKick_gem:
(1)   69/   2EF8C :                     		binclude "sound/instr/fm/drum_kick_gem.gsx",$2478,$20
(1)   70/   2EFAC :                     
(1)   71/   2EFAC :                     ; FmIns_DrumKick:
(1)   72/   2EFAC :                     ; 		binclude "sound/instr/fm/drum_kick.gsx",$2478,$20
(1)   73/   2EFAC :                     ; FmIns_DrumSnare:
(1)   74/   2EFAC :                     ; 		binclude "sound/instr/fm/drum_snare.gsx",$2478,$20
(1)   75/   2EFAC :                     ; ; ; FmIns_DrumCloseHat:
(1)   76/   2EFAC :                     ; ; ; 		binclude "sound/instr/fm/drum_closehat.gsx",$2478,$20
(1)   77/   2EFAC :                     FmIns_PianoM1:
(1)   78/   2EFAC :                     		binclude "sound/instr/fm/piano_m1.gsx",$2478,$20
(1)   79/   2EFCC :                     ; FmIns_PianoM116:
(1)   80/   2EFCC :                     ; 		binclude "sound/instr/fm/piano_m116.gsx",$2478,$20
(1)   81/   2EFCC :                     
(1)   82/   2EFCC :                     ; ;
(1)   83/   2EFCC :                     ; ; ; FmIns_Bass_gum:
(1)   84/   2EFCC :                     ; ; ; 		binclude "sound/instr/fm/bass_gum.gsx",$2478,$20
(1)   85/   2EFCC :                     FmIns_Bass_calm:
(1)   86/   2EFCC :                     		binclude "sound/instr/fm/bass_calm.gsx",$2478,$20
(1)   87/   2EFEC :                     FmIns_Bass_heavy:
(1)   88/   2EFEC :                     		binclude "sound/instr/fm/bass_heavy.gsx",$2478,$20
(1)   89/   2F00C :                     ; FmIns_Bass_ambient:
(1)   90/   2F00C :                     ; 		binclude "sound/instr/fm/bass_ambient.gsx",$2478,$20
(1)   91/   2F00C :                     ; ; ; FmIns_Brass_gummy:
(1)   92/   2F00C :                     ; ; ; 		binclude "sound/instr/fm/brass_gummy.gsx",$2478,$20
(1)   93/   2F00C :                     ; ; ; FmIns_Flaute_1:
(1)   94/   2F00C :                     ; ; ; 		binclude "sound/instr/fm/flaute_1.gsx",$2478,$20
(1)   95/   2F00C :                     ; FmIns_Bass_1:
(1)   96/   2F00C :                     ; 		binclude "sound/instr/fm/bass_1.gsx",$2478,$20
(1)   97/   2F00C :                     ; FmIns_Bass_2:
(1)   98/   2F00C :                     ; 		binclude "sound/instr/fm/bass_2.gsx",$2478,$20
(1)   99/   2F00C :                     FmIns_Bass_3:
(1)  100/   2F00C :                     		binclude "sound/instr/fm/bass_3.gsx",$2478,$20
(1)  101/   2F02C :                     ; FmIns_Bass_4:
(1)  102/   2F02C :                     ; 		binclude "sound/instr/fm/bass_4.gsx",$2478,$20
(1)  103/   2F02C :                     ; FmIns_Bass_5:
(1)  104/   2F02C :                     ; 		binclude "sound/instr/fm/bass_5.gsx",$2478,$20
(1)  105/   2F02C :                     ; FmIns_Bass_6:
(1)  106/   2F02C :                     ; 		binclude "sound/instr/fm/bass_6.gsx",$2478,$20
(1)  107/   2F02C :                     FmIns_Bass_groove:
(1)  108/   2F02C :                     		binclude "sound/instr/fm/bass_groove.gsx",$2478,$20
(1)  109/   2F04C :                     FmIns_Bass_groove_2:
(1)  110/   2F04C :                     		binclude "sound/instr/fm/bass_groove_2.gsx",$2478,$20
(1)  111/   2F06C :                     FmIns_Bass_groove_gem:
(1)  112/   2F06C :                     		binclude "sound/instr/fm/bass_groove_gem.gsx",$2478,$20
(1)  113/   2F08C :                     FmIns_Bass_italo:
(1)  114/   2F08C :                     		binclude "sound/instr/fm/bass_italo.gsx",$2478,$20
(1)  115/   2F0AC :                     FmIns_Bass_kon:
(1)  116/   2F0AC :                     		binclude "sound/instr/fm/bass_kon.gsx",$2478,$20
(1)  117/   2F0CC :                     
(1)  118/   2F0CC :                     ; FmIns_Bass_mecan:
(1)  119/   2F0CC :                     ; 		binclude "sound/instr/fm/bass_mecan.gsx",$2478,$20
(1)  120/   2F0CC :                     ;
(1)  121/   2F0CC :                     ; ; ; FmIns_Bass_heavy:
(1)  122/   2F0CC :                     ; ; ; 		binclude "sound/instr/fm/bass_heavy.gsx",$2478,$20
(1)  123/   2F0CC :                     ; ; ; FmIns_Bass_metal:
(1)  124/   2F0CC :                     ; ; ; 		binclude "sound/instr/fm/bass_metal.gsx",$2478,$20
(1)  125/   2F0CC :                     FmIns_Bass_synth:
(1)  126/   2F0CC :                     		binclude "sound/instr/fm/bass_synth_1.gsx",$2478,$20
(1)  127/   2F0EC :                     ; FmIns_Guitar_1:
(1)  128/   2F0EC :                     ; 		binclude "sound/instr/fm/guitar_1.gsx",$2478,$20
(1)  129/   2F0EC :                     ; ; ; FmIns_Horn_1:
(1)  130/   2F0EC :                     ; ; ; 		binclude "sound/instr/fm/horn_1.gsx",$2478,$20
(1)  131/   2F0EC :                     FmIns_Organ_M1:
(1)  132/   2F0EC :                     		binclude "sound/instr/fm/organ_m1.gsx",$2478,$20
(1)  133/   2F10C :                     ; ; ; FmIns_Bass_Beach:
(1)  134/   2F10C :                     ; ; ; 		binclude "sound/instr/fm/bass_beach.gsx",$2478,$20
(1)  135/   2F10C :                     ; ; ; FmIns_Bass_Beach_2:
(1)  136/   2F10C :                     ; ; ; 		binclude "sound/instr/fm/bass_beach_2.gsx",$2478,$20
(1)  137/   2F10C :                     ; ; ; FmIns_Brass_Cave:
(1)  138/   2F10C :                     ; ; ; 		binclude "sound/instr/fm/brass_cave.gsx",$2478,$20
(1)  139/   2F10C :                     ; ; FmIns_Brass_Gem:
(1)  140/   2F10C :                     ; ; 		binclude "sound/instr/fm/brass_gem.gsx",$2478,$20
(1)  141/   2F10C :                     ; ; FmIns_Piano_Small:
(1)  142/   2F10C :                     ; ; 		binclude "sound/instr/fm/piano_small.gsx",$2478,$20
(1)  143/   2F10C :                     ; ; FmIns_Piano:
(1)  144/   2F10C :                     ; ; 		binclude "sound/instr/fm/piano_m1.gsx",$2478,$20
(1)  145/   2F10C :                     FmIns_Trumpet_1:
(1)  146/   2F10C :                     		binclude "sound/instr/fm/trumpet_1.gsx",$2478,$20
(1)  147/   2F12C :                     FmIns_Trumpet_2:
(1)  148/   2F12C :                     		binclude "sound/instr/fm/trumpet_2.gsx",$2478,$20
(1)  149/   2F14C :                     FmIns_Trumpet_kon:
(1)  150/   2F14C :                     		binclude "sound/instr/fm/trumpet_kon.gsx",$2478,$20
(1)  151/   2F16C :                     FmIns_Trumpet_puy:
(1)  152/   2F16C :                     		binclude "sound/instr/fm/trumpet_puy.gsx",$2478,$20
(1)  153/   2F18C :                     FmIns_Trumpet_carnival:
(1)  154/   2F18C :                     		binclude "sound/instr/fm/trumpet_carnivl.gsx",$2478,$20
(1)  155/   2F1AC :                     
(1)  156/   2F1AC :                     ; ; ; FmIns_Bell_Glass:
(1)  157/   2F1AC :                     ; ; ; 		binclude "sound/instr/fm/bell_glass.gsx",$2478,$20
(1)  158/   2F1AC :                     ; ; ; FmIns_Marimba_1:
(1)  159/   2F1AC :                     ; ; ; 		binclude "sound/instr/fm/marimba_1.gsx",$2478,$20
(1)  160/   2F1AC :                     
(1)  161/   2F1AC :                     FmIns_Ambient_dark:
(1)  162/   2F1AC :                     		binclude "sound/instr/fm/ambient_dark.gsx",$2478,$20
(1)  163/   2F1CC :                     FmIns_Ambient_spook:
(1)  164/   2F1CC :                     		binclude "sound/instr/fm/ambient_spook.gsx",$2478,$20
(1)  165/   2F1EC :                     ; FmIns_Ambient_3:
(1)  166/   2F1EC :                     ; 		binclude "sound/instr/fm/ambient_3.gsx",$2478,$20
(1)  167/   2F1EC :                     FmIns_Ding_toy:
(1)  168/   2F1EC :                     		binclude "sound/instr/fm/ding_toy.gsx",$2478,$20
(1)  169/   2F20C :                     FmIns_Bell_China:
(1)  170/   2F20C :                     		binclude "sound/instr/fm/bell_china.gsx",$2478,$20
(1)  171/   2F22C :                     FmIns_Brass_Eur:
(1)  172/   2F22C :                     		binclude "sound/instr/fm/brass_eur.gsx",$2478,$20
(1)  173/   2F24C :                     FmIns_Brass_Puy:
(1)  174/   2F24C :                     		binclude "sound/instr/fm/brass_puy.gsx",$2478,$20
(1)  175/   2F26C :                     FmIns_Flaute_cave:
(1)  176/   2F26C :                     		binclude "sound/instr/fm/flaute_cave.gsx",$2478,$20
(1)  177/   2F28C :                     FmIns_Banjo_puy:
(1)  178/   2F28C :                     		binclude "sound/instr/fm/banjo_puy.gsx",$2478,$20
(1)  179/   2F2AC :                     FmIns_Violin_gem:
(1)  180/   2F2AC :                     		binclude "sound/instr/fm/violin_gem.gsx",$2478,$20
(1)  181/   2F2CC :                     
      56/   2F2CC :                     
      57/   2F2CC :                     ; ====================================================================
      58/   2F2CC :                     ; ----------------------------------------------------------------
      59/   2F2CC :                     ; 68k code-sections for RAM
      60/   2F2CC :                     ; ----------------------------------------------------------------
      61/   2F2CC :                     
      62/   2F2CC :                     RamCode_Default:
      63/  FF1BE4 :                     		phase RAMCODE_USER
      64/  FF1BE4 :                     		include "code/default.asm"
(1)    1/  FF1BE4 :                     ; ====================================================================
(1)    2/  FF1BE4 :                     ; ----------------------------------------------------------------
(1)    3/  FF1BE4 :                     ; Default gamemode
(1)    4/  FF1BE4 :                     ; ----------------------------------------------------------------
(1)    5/  FF1BE4 :                     
(1)    6/  FF1BE4 :                     ; ====================================================================
(1)    7/  FF1BE4 :                     ; ------------------------------------------------------
(1)    8/  FF1BE4 :                     ; Variables
(1)    9/  FF1BE4 :                     ; ------------------------------------------------------
(1)   10/  FF1BE4 :                     
(1)   11/  FF1BE4 : =$4000              var_MoveSpd	equ	$4000
(1)   12/  FF1BE4 : =$3                 MAX_TSTTRKS	equ	3
(1)   13/  FF1BE4 : =$5                 MAX_TSTENTRY	equ	5
(1)   14/  FF1BE4 :                     
(1)   15/  FF1BE4 :                     ; ====================================================================
(1)   16/  FF1BE4 :                     ; ------------------------------------------------------
(1)   17/  FF1BE4 :                     ; Structs
(1)   18/  FF1BE4 :                     ; ------------------------------------------------------
(1)   19/  FF1BE4 :                     
(1)   20/  FF1BE4 :                     ; 		struct 0
(1)   21/  FF1BE4 :                     ; strc_xpos	ds.w 1
(1)   22/  FF1BE4 :                     ; strc_ypos	ds.w 1
(1)   23/  FF1BE4 :                     ; 		finish
(1)   24/  FF1BE4 :                     
(1)   25/  FF1BE4 :                     ; ====================================================================
(1)   26/  FF1BE4 :                     ; ------------------------------------------------------
(1)   27/  FF1BE4 :                     ; This mode's RAM
(1)   28/  FF1BE4 :                     ; ------------------------------------------------------
(1)   29/  FF1BE4 :                     
(1)   30/  FF1BE4 : (MACRO)             		struct RAM_ModeBuff
(1)   30/  FF1BE4 : =$FF1BE4            GLBL_LASTPC     set *
(1)   30/   2F2CC :                                     dephase
(1)   30/   2F2CC : =$2F2CC             GLBL_LASTORG    set *
(1)   30/FFFFFFFFFFFFC000 :                                     phase RAM_MODEBUFF
(1)   31/FFFFFFFFFFFFC000 :                     RAM_EmiPosX	ds.l 1
(1)   32/FFFFFFFFFFFFC004 :                     RAM_EmiPosY	ds.l 1
(1)   33/FFFFFFFFFFFFC008 :                     RAM_XposFg	ds.l 1
(1)   34/FFFFFFFFFFFFC00C :                     RAM_XposBg	ds.l 1
(1)   35/FFFFFFFFFFFFC010 :                     RAM_EmiChar	ds.w 1
(1)   36/FFFFFFFFFFFFC012 :                     RAM_EmiAnim	ds.w 1
(1)   37/FFFFFFFFFFFFC014 :                     RAM_EmiHide	ds.w 1
(1)   38/FFFFFFFFFFFFC016 :                     RAM_ShakeMe	ds.w 1
(1)   39/FFFFFFFFFFFFC018 :                     RAM_BoardUpd	ds.w 1
(1)   40/FFFFFFFFFFFFC01A :                     RAM_CurrType	ds.w 1
(1)   41/FFFFFFFFFFFFC01C :                     RAM_BgCamera	ds.w 1
(1)   42/FFFFFFFFFFFFC01E :                     RAM_CurrSelc	ds.w 1
(1)   43/FFFFFFFFFFFFC020 :                     RAM_CurrIndx	ds.w 1
(1)   44/FFFFFFFFFFFFC022 :                     RAM_CurrTrack	ds.w 1
(1)   45/FFFFFFFFFFFFC024 :                     RAM_CurrTicks	ds.w 1
(1)   46/FFFFFFFFFFFFC026 :                     RAM_CurrTempo	ds.w 1
(1)   47/FFFFFFFFFFFFC028 :                     RAM_WindowCurr	ds.w 1
(1)   48/FFFFFFFFFFFFC02A :                     RAM_WindowNew	ds.w 1
(1)   49/FFFFFFFFFFFFC02C :                     ; RAM_BoardBlocks	dc.b 6*6
(1)   50/FFFFFFFFFFFFC02C : (MACRO)             		finish
(1)   50/FFFFFFFFFFFFC000 :                                     !org GLBL_LASTORG
(1)   50/  FF1BE4 :                                     phase GLBL_LASTPC
(1)   51/  FF1BE4 :                     
(1)   52/  FF1BE4 :                     ; ====================================================================
(1)   53/  FF1BE4 :                     ; ------------------------------------------------------
(1)   54/  FF1BE4 :                     ; Code start
(1)   55/  FF1BE4 :                     ; ------------------------------------------------------
(1)   56/  FF1BE4 :                     
(1)   57/  FF1BE4 :                     thisCode_Top:
(1)   58/  FF1BE4 : 46FC 2700           		move.w	#$2700,sr
(1)   59/  FF1BE8 : 6100 E416           		bsr	Sound_init
(1)   60/  FF1BEC : 6100 E650           		bsr	Video_init
(1)   61/  FF1BF0 : 6100 FC4E           		bsr	System_Init
(1)   62/  FF1BF4 : 61BE                		bsr	Mode_Init
(1)   63/  FF1BF6 : 6100 E76C           		bsr	Video_PrintInit
(1)   64/  FF1BFA : 31FC 0000 C01A      		move.w	#0,(RAM_CurrType).w
(1)   65/  FF1C00 : 31FC 00D0 C026      		move.w	#208,(RAM_CurrTempo).w
(1)   66/  FF1C06 : 303C 9200           		move.w	#$9200,d0
(1)   67/  FF1C0A : 31C0 C028           		move.w	d0,(RAM_WindowCurr).w
(1)   68/  FF1C0E : 31C0 C02A           		move.w	d0,(RAM_WindowNew).w
(1)   69/  FF1C12 :                     
(1)   70/  FF1C12 :                     ; 	; Default Emilie vars
(1)   71/  FF1C12 :                     ; 		move.w	#(320/2)-80,d0
(1)   72/  FF1C12 :                     ; 		move.w	d0,(RAM_EmiPosX).w
(1)   73/  FF1C12 :                     ; 		move.w	#(224/2)+48,d0
(1)   74/  FF1C12 :                     ; 		move.w	d0,(RAM_EmiPosY).w
(1)   75/  FF1C12 :                     ;
(1)   76/  FF1C12 :                     ; 		move.l	#ART_FGTEST,d0
(1)   77/  FF1C12 :                     ; 		move.w	#$40*$20,d1
(1)   78/  FF1C12 :                     ; 		move.w	#ART_FGTEST_e-ART_FGTEST,d2
(1)   79/  FF1C12 :                     ; 		bsr	Video_LoadArt
(1)   80/  FF1C12 :                     ; 		move.l	#ART_BGTEST,d0
(1)   81/  FF1C12 :                     ; 		move.w	#$60*$20,d1
(1)   82/  FF1C12 :                     ; 		move.w	#ART_BGTEST_e-ART_BGTEST,d2
(1)   83/  FF1C12 :                     ; 		bsr	Video_LoadArt
(1)   84/  FF1C12 :                     ;
(1)   85/  FF1C12 :                     ; 		lea	(MAP_BGTEST),a0
(1)   86/  FF1C12 :                     ; 		move.l	#locate(1,0,0),d0
(1)   87/  FF1C12 :                     ; 		move.l	#mapsize(512,256),d1
(1)   88/  FF1C12 :                     ; 		move.w	#$60+$4000,d2
(1)   89/  FF1C12 :                     ; 		bsr	Video_LoadMap
(1)   90/  FF1C12 :                     ; 		lea	(MAP_FGTEST),a0
(1)   91/  FF1C12 :                     ; 		move.l	#locate(0,0,0),d0
(1)   92/  FF1C12 :                     ; 		move.l	#mapsize(512,256),d1
(1)   93/  FF1C12 :                     ; 		move.w	#$40+$2000,d2
(1)   94/  FF1C12 :                     ; 		bsr	Video_LoadMap
(1)   95/  FF1C12 :                     
(1)   96/  FF1C12 :                     ; 		lea	str_Title(pc),a0
(1)   97/  FF1C12 :                     ; 		move.l	#locate(0,2,2),d0
(1)   98/  FF1C12 :                     ; 		bsr	Video_Print
(1)   99/  FF1C12 : 41FA 051E           		lea	str_Gema(pc),a0			; GEMA tester text on WINDOW
(1)  100/  FF1C16 : 203C 0002 0202      		move.l	#locate(2,2,2),d0
(1)  101/  FF1C1C : 6100 E76E           		bsr	Video_Print
(1)  102/  FF1C20 :                     
(1)  103/  FF1C20 :                     ; 		lea	PAL_EMI(pc),a0
(1)  104/  FF1C20 :                     ; 		moveq	#0,d0
(1)  105/  FF1C20 :                     ; 		move.w	#$F,d1
(1)  106/  FF1C20 :                     ; 		bsr	Video_LoadPal
(1)  107/  FF1C20 :                     ; 		lea	PAL_TESTBOARD(pc),a0		; ON palette
(1)  108/  FF1C20 :                     ; 		moveq	#$10,d0
(1)  109/  FF1C20 :                     ; 		move.w	#$F,d1
(1)  110/  FF1C20 :                     ; 		bsr	Video_LoadPal
(1)  111/  FF1C20 :                     ; 		lea	PAL_BG(pc),a0		; ON palette
(1)  112/  FF1C20 :                     ; 		moveq	#$20,d0
(1)  113/  FF1C20 :                     ; 		move.w	#$F,d1
(1)  114/  FF1C20 :                     ; 		bsr	Video_LoadPal
(1)  115/  FF1C20 :                     
(1)  116/  FF1C20 : 08F9 0006 FFFF D2F7 		bset	#bitDispEnbl,(RAM_VdpRegs+1).l	; Enable display
(1)  117/  FF1C28 : 6100 E698           		bsr	Video_Update
(1)  118/  FF1C2C :                     
(1)  119/  FF1C2C :                     ; 		move.b	(sysmars_reg+comm15),d7
(1)  120/  FF1C2C :                     ; 		or.w	#1,d7
(1)  121/  FF1C2C :                     ; 		move.b	d7,(sysmars_reg+comm15)
(1)  122/  FF1C2C :                     
(1)  123/  FF1C2C : 41FA 02E8           		lea	MasterTrkList(pc),a0
(1)  124/  FF1C30 : 7000                		moveq	#0,d0
(1)  125/  FF1C32 : 323C 000A           		move.w	#$A,d1
(1)  126/  FF1C36 : 7400                		moveq	#0,d2
(1)  127/  FF1C38 : 363C 0000           		move.w	#0,d3
(1)  128/  FF1C3C : 6100 E54C           		bsr	Sound_TrkPlay
(1)  129/  FF1C40 : 13FC 0080 00A1 512E 		move.b	#$80,(sysmars_reg+comm14)	; Unlock MASTER
(1)  130/  FF1C48 :                     
(1)  131/  FF1C48 :                     ; ====================================================================
(1)  132/  FF1C48 :                     ; ------------------------------------------------------
(1)  133/  FF1C48 :                     ; Loop
(1)  134/  FF1C48 :                     ; ------------------------------------------------------
(1)  135/  FF1C48 :                     
(1)  136/  FF1C48 :                     .loop:
(1)  137/  FF1C48 : 3839 00C0 0004      		move.w	(vdp_ctrl),d4
(1)  138/  FF1C4E : 0804 0003           		btst	#bitVint,d4
(1)  139/  FF1C52 : 67F4                		beq.s	.loop
(1)  140/  FF1C54 : 6100 EA04           		bsr	Video_DmaBlast
(1)  141/  FF1C58 :                     ; 		bsr	Emilie_Show
(1)  142/  FF1C58 : 6100 FC68           		bsr	System_Input
(1)  143/  FF1C5C :                     
(1)  144/  FF1C5C : 06B9 0000 0001 FFFF 		add.l	#1,(RAM_Framecount).l
                    D926                
(1)  145/  FF1C66 : 23FC 7C00 0003 00C0 		move.l	#$7C000003,(vdp_ctrl).l
                    0004                
(1)  146/  FF1C70 : 2039 FFFF C008      		move.l	(RAM_XposFg).l,d0
(1)  147/  FF1C76 : 2239 FFFF C00C      		move.l	(RAM_XposBg).l,d1
(1)  148/  FF1C7C : 4841                		swap	d1
(1)  149/  FF1C7E : 3001                		move.w	d1,d0
(1)  150/  FF1C80 : 23C0 00C0 0000      		move.l	d0,(vdp_data).l
(1)  151/  FF1C86 : 23FC 4000 0010 00C0 		move.l	#$40000010,(vdp_ctrl).l
                    0004                
(1)  152/  FF1C90 : 3638 C016           		move.w	(RAM_ShakeMe).w,d3
(1)  153/  FF1C94 : 3803                		move.w	d3,d4
(1)  154/  FF1C96 : E64B                		lsr.w	#3,d3
(1)  155/  FF1C98 : 0804 0001           		btst	#1,d4
(1)  156/  FF1C9C : 6602                		bne.s	.midshk
(1)  157/  FF1C9E : 4443                		neg.w	d3
(1)  158/  FF1CA0 :                     .midshk:
(1)  159/  FF1CA0 : 33C3 00C0 0000      		move.w	d3,(vdp_data).l
(1)  160/  FF1CA6 : 3438 C028           		move.w	(RAM_WindowCurr).w,d2
(1)  161/  FF1CAA : 3238 C02A           		move.w	(RAM_WindowNew).w,d1
(1)  162/  FF1CAE : B242                		cmp.w	d2,d1
(1)  163/  FF1CB0 : 6718                		beq.s	.same_w
(1)  164/  FF1CB2 : 303C 0001           		move.w	#1,d0
(1)  165/  FF1CB6 : 9242                		sub.w	d2,d1
(1)  166/  FF1CB8 : 6A04                		bpl.s	.revers
(1)  167/  FF1CBA : 303C FFFF           		move.w	#-1,d0
(1)  168/  FF1CBE :                     .revers:
(1)  169/  FF1CBE : D178 C028           		add.w	d0,(RAM_WindowCurr).w
(1)  170/  FF1CC2 : 33F8 C028 00C0 0004 		move.w	(RAM_WindowCurr).w,(vdp_ctrl).l
(1)  171/  FF1CCA :                     .same_w:
(1)  172/  FF1CCA : 3839 00C0 0004      .inside:	move.w	(vdp_ctrl),d4
(1)  173/  FF1CD0 : 0804 0003           		btst	#bitVint,d4
(1)  174/  FF1CD4 : 66F4                		bne.s	.inside
(1)  175/  FF1CD6 :                     
(1)  176/  FF1CD6 : 3038 C01A           		move.w	(RAM_CurrType).w,d0
(1)  177/  FF1CDA : C07C 001F           		and.w	#%11111,d0
(1)  178/  FF1CDE : D040                		add.w	d0,d0
(1)  179/  FF1CE0 : D040                		add.w	d0,d0
(1)  180/  FF1CE2 : 4EBB 0006           		jsr	.list(pc,d0.w)
(1)  181/  FF1CE6 : 6000 FF60           		bra	.loop
(1)  182/  FF1CEA :                     
(1)  183/  FF1CEA :                     ; ====================================================================
(1)  184/  FF1CEA :                     ; ------------------------------------------------------
(1)  185/  FF1CEA :                     ; Mode sections
(1)  186/  FF1CEA :                     ; ------------------------------------------------------
(1)  187/  FF1CEA :                     
(1)  188/  FF1CEA :                     .list:
(1)  189/  FF1CEA : 6000 000A           		bra.w	.mode0
(1)  190/  FF1CEE : 6000 0080           		bra.w	.mode1
(1)  191/  FF1CF2 : 6000 0002           		bra.w	.mode0
(1)  192/  FF1CF6 :                     
(1)  193/  FF1CF6 :                     ; --------------------------------------------------
(1)  194/  FF1CF6 :                     ; Mode 0
(1)  195/  FF1CF6 :                     ; --------------------------------------------------
(1)  196/  FF1CF6 :                     
(1)  197/  FF1CF6 :                     .mode0:
(1)  198/  FF1CF6 : 4A78 C01A           		tst.w	(RAM_CurrType).w
(1)  199/  FF1CFA : 6B0C                		bmi	.mode0_loop
(1)  200/  FF1CFC : 0078 8000 C01A      		or.w	#$8000,(RAM_CurrType).w
(1)  201/  FF1D02 : 31FC 0000 C014      		move.w	#0,(RAM_EmiHide).w
(1)  202/  FF1D08 :                     ; 		move.w	#1,(RAM_EmiUpd).w
(1)  203/  FF1D08 :                     
(1)  204/  FF1D08 :                     ; Mode 0 mainloop
(1)  205/  FF1D08 :                     .mode0_loop:
(1)  206/  FF1D08 : 3E38 D512           		move.w	(Controller_1+on_press),d7
(1)  207/  FF1D0C : 0807 0007           		btst	#bitJoyStart,d7
(1)  208/  FF1D10 : 670C                		beq.s	.no_mode0
(1)  209/  FF1D12 : 31FC 0001 C01A      		move.w	#1,(RAM_CurrType).w
(1)  210/  FF1D18 : 31FC 920D C02A      		move.w	#$920D,(RAM_WindowNew).w
(1)  211/  FF1D1E :                     .no_mode0:
(1)  212/  FF1D1E :                     ; 		move.w	(RAM_ShakeMe),d7
(1)  213/  FF1D1E :                     ; 		tst.w	(RAM_ShakeMe).w
(1)  214/  FF1D1E :                     ; 		beq.s	.no_shake
(1)  215/  FF1D1E :                     ; 		sub.w	#1,(RAM_ShakeMe).w
(1)  216/  FF1D1E :                     ; 		bset	#0,(RAM_BoardUpd).w
(1)  217/  FF1D1E :                     ; .no_shake:
(1)  218/  FF1D1E :                     
(1)  219/  FF1D1E : 1C39 00A1 512E      		move.b	(sysmars_reg+comm14),d6
(1)  220/  FF1D24 : CC7C 000F           		and.w	#%00001111,d6
(1)  221/  FF1D28 : 6644                		bne.s	.lel
(1)  222/  FF1D2A : 3E38 D510           		move.w	(Controller_1+on_hold),d7
(1)  223/  FF1D2E : 0807 0003           		btst	#bitJoyRight,d7
(1)  224/  FF1D32 : 670A                		beq.s	.nor_m
(1)  225/  FF1D34 : 08C6 0000           		bset	#0,d6
(1)  226/  FF1D38 : 13C6 00A1 512E      		move.b	d6,(sysmars_reg+comm14)
(1)  227/  FF1D3E :                     .nor_m:
(1)  228/  FF1D3E : 0807 0002           		btst	#bitJoyLeft,d7
(1)  229/  FF1D42 : 670A                		beq.s	.nol_m
(1)  230/  FF1D44 : 08C6 0001           		bset	#1,d6
(1)  231/  FF1D48 : 13C6 00A1 512E      		move.b	d6,(sysmars_reg+comm14)
(1)  232/  FF1D4E :                     .nol_m:
(1)  233/  FF1D4E : 0807 0001           		btst	#bitJoyDown,d7
(1)  234/  FF1D52 : 670A                		beq.s	.nod_m
(1)  235/  FF1D54 : 08C6 0002           		bset	#2,d6
(1)  236/  FF1D58 : 13C6 00A1 512E      		move.b	d6,(sysmars_reg+comm14)
(1)  237/  FF1D5E :                     .nod_m:
(1)  238/  FF1D5E : 0807 0000           		btst	#bitJoyUp,d7
(1)  239/  FF1D62 : 670A                		beq.s	.nou_m
(1)  240/  FF1D64 : 08C6 0003           		bset	#3,d6
(1)  241/  FF1D68 : 13C6 00A1 512E      		move.b	d6,(sysmars_reg+comm14)
(1)  242/  FF1D6E :                     .nou_m:
(1)  243/  FF1D6E :                     
(1)  244/  FF1D6E :                     .lel:
(1)  245/  FF1D6E :                     
(1)  246/  FF1D6E :                     ; .noz_r:
(1)  247/  FF1D6E :                     ; 		bsr	Emilie_Move
(1)  248/  FF1D6E :                     ; 		bsr	Emilie_MkSprite
(1)  249/  FF1D6E : 4E75                		rts
(1)  250/  FF1D70 :                     
(1)  251/  FF1D70 :                     ; 		lea	str_TempVal(pc),a0		; Main title
(1)  252/  FF1D70 :                     ; 		move.l	#locate(0,0,0),d0
(1)  253/  FF1D70 :                     ; 		bsr	Video_Print
(1)  254/  FF1D70 :                     
(1)  255/  FF1D70 :                     	; BOOM TEST
(1)  256/  FF1D70 :                     ; 		move.w	(Controller_1+on_press),d7
(1)  257/  FF1D70 :                     ; 		btst	#bitJoyA,d7
(1)  258/  FF1D70 :                     ; 		beq.s	.noah
(1)  259/  FF1D70 :                     ; 		move.w	#$20,(RAM_ShakeMe).w
(1)  260/  FF1D70 :                     ; 		moveq	#0,d2
(1)  261/  FF1D70 :                     ; 		bsr	PlayThisSfx
(1)  262/  FF1D70 :                     ; .noah:
(1)  263/  FF1D70 :                     
(1)  264/  FF1D70 :                     
(1)  265/  FF1D70 :                     ; 		bset	#0,(RAM_BoardUpd).w
(1)  266/  FF1D70 :                     
(1)  267/  FF1D70 :                     ; 	; Emilie player input
(1)  268/  FF1D70 :                     ; 		move.b	(RAM_EmiFlags).w,d7
(1)  269/  FF1D70 :                     
(1)  270/  FF1D70 :                     ; 		btst	#7,(RAM_EmiFlags).w
(1)  271/  FF1D70 :                     ; 		bne	.lockcontrl
(1)  272/  FF1D70 :                     ; 		btst	#7,d7
(1)  273/  FF1D70 :                     ; 		beq.s	.after
(1)  274/  FF1D70 :                     ; 		lea	(RAM_BoardBlocks),a6
(1)  275/  FF1D70 :                     ; 		move.w	(RAM_EmiBlockX).w,d7
(1)  276/  FF1D70 :                     ; 		or.w	(RAM_EmiBlockY).w,d7
(1)  277/  FF1D70 :                     ; 		bmi.s	.after
(1)  278/  FF1D70 :                     ; 		move.w	(RAM_EmiBlockX).w,d0
(1)  279/  FF1D70 :                     ; 		cmp.w	#6,d0
(1)  280/  FF1D70 :                     ; 		bge.s	.after
(1)  281/  FF1D70 :                     ; 		move.w	(RAM_EmiBlockY).w,d1
(1)  282/  FF1D70 :                     ; 		cmp.w	#6,d1
(1)  283/  FF1D70 :                     ; 		bge.s	.after
(1)  284/  FF1D70 :                     ; 		mulu.w	#6,d1
(1)  285/  FF1D70 :                     ; 		add.w	d1,d0
(1)  286/  FF1D70 :                     ; 		adda	d0,a6
(1)  287/  FF1D70 :                     ; 		bchg	#0,(a6)
(1)  288/  FF1D70 :                     ; 		bset	#0,(RAM_BoardUpd).w
(1)  289/  FF1D70 :                     ; 		moveq	#1,d2
(1)  290/  FF1D70 :                     ; 		bsr	PlayThisSfx
(1)  291/  FF1D70 :                     ; 		bsr	Board_CheckMatch
(1)  292/  FF1D70 :                     ; .after:
(1)  293/  FF1D70 :                     ;
(1)  294/  FF1D70 :                     ; 	; UDLR
(1)  295/  FF1D70 :                     ; 		move.w	#0,d4
(1)  296/  FF1D70 :                     ; 		move.w	(Controller_1+on_press),d7
(1)  297/  FF1D70 :                     ; 		btst	#bitJoyDown,d7
(1)  298/  FF1D70 :                     ; 		beq.s	.noz_down
(1)  299/  FF1D70 :                     ; 		add.w	#$18,(RAM_EmiMoveY).w
(1)  300/  FF1D70 :                     ; 		add.w	#1,(RAM_EmiBlockY).w
(1)  301/  FF1D70 :                     ; 		move.w	d4,(RAM_EmiChar).w
(1)  302/  FF1D70 :                     ; 		move.l	#-$20000,(RAM_EmiJumpSpd).l
(1)  303/  FF1D70 :                     ; .noz_down:
(1)  304/  FF1D70 :                     ; 		move.w	#4,d4
(1)  305/  FF1D70 :                     ; 		move.w	(Controller_1+on_press),d7
(1)  306/  FF1D70 :                     ; 		btst	#bitJoyUp,d7
(1)  307/  FF1D70 :                     ; 		beq.s	.noz_up
(1)  308/  FF1D70 :                     ; 		add.w	#-$18,(RAM_EmiMoveY).w
(1)  309/  FF1D70 :                     ; 		sub.w	#1,(RAM_EmiBlockY).w
(1)  310/  FF1D70 :                     ; 		move.w	d4,(RAM_EmiChar).w
(1)  311/  FF1D70 :                     ; 		move.l	#-$20000,(RAM_EmiJumpSpd).l
(1)  312/  FF1D70 :                     ; .noz_up:
(1)  313/  FF1D70 :                     ; 		move.w	#8,d4
(1)  314/  FF1D70 :                     ; 		move.w	(Controller_1+on_press),d7
(1)  315/  FF1D70 :                     ; 		btst	#bitJoyRight,d7
(1)  316/  FF1D70 :                     ; 		beq.s	.noz_r
(1)  317/  FF1D70 :                     ; 		add.w	#$20,(RAM_EmiMoveX).w
(1)  318/  FF1D70 :                     ; 		add.w	#1,(RAM_EmiBlockX).w
(1)  319/  FF1D70 :                     ; 		move.w	d4,(RAM_EmiChar).w
(1)  320/  FF1D70 :                     ; 		move.l	#-$20000,(RAM_EmiJumpSpd).l
(1)  321/  FF1D70 :                     ; .noz_r:
(1)  322/  FF1D70 :                     ; 		move.w	#$C,d4
(1)  323/  FF1D70 :                     ; 		move.w	(Controller_1+on_press),d7
(1)  324/  FF1D70 :                     ; 		btst	#bitJoyLeft,d7
(1)  325/  FF1D70 :                     ; 		beq.s	.noz_l
(1)  326/  FF1D70 :                     ; 		add.w	#-$20,(RAM_EmiMoveX).w
(1)  327/  FF1D70 :                     ; 		sub.w	#1,(RAM_EmiBlockX).w
(1)  328/  FF1D70 :                     ; 		move.w	d4,(RAM_EmiChar).w
(1)  329/  FF1D70 :                     ; 		move.l	#-$20000,(RAM_EmiJumpSpd).l
(1)  330/  FF1D70 :                     ; .noz_l:
(1)  331/  FF1D70 :                     ; 		rts
(1)  332/  FF1D70 :                     ;
(1)  333/  FF1D70 :                     ; .lockcontrl:
(1)  334/  FF1D70 :                     ; 		add.w	#6,(RAM_EmiJumpTan).w
(1)  335/  FF1D70 :                     ; 		rts
(1)  336/  FF1D70 :                     
(1)  337/  FF1D70 :                     ; --------------------------------------------------
(1)  338/  FF1D70 :                     ; Mode 1
(1)  339/  FF1D70 :                     ; --------------------------------------------------
(1)  340/  FF1D70 :                     
(1)  341/  FF1D70 :                     .mode1:
(1)  342/  FF1D70 : 4A78 C01A           		tst.w	(RAM_CurrType).w
(1)  343/  FF1D74 : 6B10                		bmi	.mode1_loop
(1)  344/  FF1D76 : 0078 8000 C01A      		or.w	#$8000,(RAM_CurrType).w
(1)  345/  FF1D7C : 6100 0122           		bsr	.print_cursor
(1)  346/  FF1D80 : 31FC 0001 C014      		move.w	#1,(RAM_EmiHide).w
(1)  347/  FF1D86 :                     ; 		move.w	#1,(RAM_EmiUpd).w
(1)  348/  FF1D86 :                     
(1)  349/  FF1D86 :                     .mode1_loop:
(1)  350/  FF1D86 : 3E38 D512           		move.w	(Controller_1+on_press),d7
(1)  351/  FF1D8A : 0807 0007           		btst	#bitJoyStart,d7
(1)  352/  FF1D8E : 670C                		beq.s	.no_mode1
(1)  353/  FF1D90 : 31FC 0000 C01A      		move.w	#0,(RAM_CurrType).w
(1)  354/  FF1D96 : 31FC 9200 C02A      		move.w	#$9200,(RAM_WindowNew).w
(1)  355/  FF1D9C :                     .no_mode1:
(1)  356/  FF1D9C : 3E38 D512           		move.w	(Controller_1+on_press),d7
(1)  357/  FF1DA0 : E04F                		lsr.w	#8,d7
(1)  358/  FF1DA2 : 0807 0000           		btst	#bitJoyZ,d7
(1)  359/  FF1DA6 : 671C                		beq.s	.noc_up
(1)  360/  FF1DA8 : 1E39 00A1 512F      .wait:		move.b	(sysmars_reg+comm15),d7
(1)  361/  FF1DAE : CE7C 00F0           		and.w	#%11110000,d7
(1)  362/  FF1DB2 : 66F4                		bne.s	.wait
(1)  363/  FF1DB4 : 1E39 00A1 512F      		move.b	(sysmars_reg+comm15),d7
(1)  364/  FF1DBA : 8E7C 0001           		or.w	#1,d7
(1)  365/  FF1DBE : 13C7 00A1 512F      		move.b	d7,(sysmars_reg+comm15)
(1)  366/  FF1DC4 :                     .noc_up:
(1)  367/  FF1DC4 : 3E38 D512           		move.w	(Controller_1+on_press),d7
(1)  368/  FF1DC8 : E04F                		lsr.w	#8,d7
(1)  369/  FF1DCA : 0807 0001           		btst	#bitJoyY,d7
(1)  370/  FF1DCE : 6712                		beq.s	.noy2
(1)  371/  FF1DD0 : 0C78 0001 C020      		cmp.w	#1,(RAM_CurrIndx).w
(1)  372/  FF1DD6 : 670A                		beq.	.noy2
(1)  373/  FF1DD8 : 0678 0001 C020      		add.w	#1,(RAM_CurrIndx).w
(1)  374/  FF1DDE : 6100 00C0           		bsr	.print_cursor
(1)  375/  FF1DE2 :                     .noy2:
(1)  376/  FF1DE2 : 3E38 D510           		move.w	(Controller_1+on_hold),d7
(1)  377/  FF1DE6 : E04F                		lsr.w	#8,d7
(1)  378/  FF1DE8 : 0807 0002           		btst	#bitJoyX,d7
(1)  379/  FF1DEC : 6710                		beq.s	.nox2
(1)  380/  FF1DEE : 4A78 C020           		tst.w	(RAM_CurrIndx).w
(1)  381/  FF1DF2 : 670A                		beq.s	.nox2
(1)  382/  FF1DF4 : 0478 0001 C020      		sub.w	#1,(RAM_CurrIndx).w
(1)  383/  FF1DFA : 6100 00A4           		bsr	.print_cursor
(1)  384/  FF1DFE :                     .nox2:
(1)  385/  FF1DFE : 3E38 D512           		move.w	(Controller_1+on_press),d7
(1)  386/  FF1E02 : 0807 0000           		btst	#bitJoyUp,d7
(1)  387/  FF1E06 : 6710                		beq.s	.nou2
(1)  388/  FF1E08 : 4A78 C01E           		tst.w	(RAM_CurrSelc).w
(1)  389/  FF1E0C : 670A                		beq.s	.nou2
(1)  390/  FF1E0E : 0478 0001 C01E      		sub.w	#1,(RAM_CurrSelc).w
(1)  391/  FF1E14 : 6100 008A           		bsr	.print_cursor
(1)  392/  FF1E18 :                     .nou2:
(1)  393/  FF1E18 : 3E38 D512           		move.w	(Controller_1+on_press),d7
(1)  394/  FF1E1C : 0807 0001           		btst	#bitJoyDown,d7
(1)  395/  FF1E20 : 6710                		beq.s	.nod2
(1)  396/  FF1E22 : 0C78 0005 C01E      		cmp.w	#MAX_TSTENTRY,(RAM_CurrSelc).w
(1)  397/  FF1E28 : 6C08                		bge.s	.nod2
(1)  398/  FF1E2A : 0678 0001 C01E      		add.w	#1,(RAM_CurrSelc).w
(1)  399/  FF1E30 : 616E                		bsr	.print_cursor
(1)  400/  FF1E32 :                     .nod2:
(1)  401/  FF1E32 :                     
(1)  402/  FF1E32 :                     	; LEFT/RIGHT
(1)  403/  FF1E32 : 43F8 C022           		lea	(RAM_CurrTrack),a1
(1)  404/  FF1E36 : 0C78 0004 C01E      		cmp.w	#4,(RAM_CurrSelc).w
(1)  405/  FF1E3C : 6604                		bne.s	.toptrk
(1)  406/  FF1E3E : D2FC 0002           		add	#2,a1
(1)  407/  FF1E42 :                     .toptrk:
(1)  408/  FF1E42 : 0C78 0005 C01E      		cmp.w	#5,(RAM_CurrSelc).w
(1)  409/  FF1E48 : 6604                		bne.s	.toptrk2
(1)  410/  FF1E4A : D2FC 0004           		add	#2*2,a1
(1)  411/  FF1E4E :                     .toptrk2:
(1)  412/  FF1E4E :                     
(1)  413/  FF1E4E : 3E38 D510           		move.w	(Controller_1+on_hold),d7
(1)  414/  FF1E52 : CE7C 0010           		and.w	#JoyB,d7
(1)  415/  FF1E56 : 6706                		beq.s	.nob
(1)  416/  FF1E58 : 0651 0001           		add.w	#1,(a1)
(1)  417/  FF1E5C : 6142                		bsr	.print_cursor
(1)  418/  FF1E5E :                     .nob:
(1)  419/  FF1E5E : 3E38 D510           		move.w	(Controller_1+on_hold),d7
(1)  420/  FF1E62 : CE7C 0040           		and.w	#JoyA,d7
(1)  421/  FF1E66 : 6706                		beq.s	.noa
(1)  422/  FF1E68 : 0451 0001           		sub.w	#1,(a1)
(1)  423/  FF1E6C : 6132                		bsr	.print_cursor
(1)  424/  FF1E6E :                     .noa:
(1)  425/  FF1E6E :                     
(1)  426/  FF1E6E :                     
(1)  427/  FF1E6E :                     
(1)  428/  FF1E6E : 3E38 D512           		move.w	(Controller_1+on_press),d7
(1)  429/  FF1E72 : 0807 0002           		btst	#bitJoyLeft,d7
(1)  430/  FF1E76 : 6706                		beq.s	.nol
(1)  431/  FF1E78 :                     ; 		tst.w	(a1)
(1)  432/  FF1E78 :                     ; 		beq.s	.nol
(1)  433/  FF1E78 : 0451 0001           		sub.w	#1,(a1)
(1)  434/  FF1E7C : 6122                		bsr	.print_cursor
(1)  435/  FF1E7E :                     .nol:
(1)  436/  FF1E7E : 3E38 D512           		move.w	(Controller_1+on_press),d7
(1)  437/  FF1E82 : 0807 0003           		btst	#bitJoyRight,d7
(1)  438/  FF1E86 : 6706                		beq.s	.nor
(1)  439/  FF1E88 :                     ; 		cmp.w	#MAX_TSTTRKS,(a1)
(1)  440/  FF1E88 :                     ; 		bge.s	.nor
(1)  441/  FF1E88 : 0651 0001           		add.w	#1,(a1)
(1)  442/  FF1E8C : 6112                		bsr	.print_cursor
(1)  443/  FF1E8E :                     .nor:
(1)  444/  FF1E8E :                     
(1)  445/  FF1E8E : 3E38 D512           		move.w	(Controller_1+on_press),d7
(1)  446/  FF1E92 : CE7C 0020           		and.w	#JoyC,d7
(1)  447/  FF1E96 : 6706                		beq.s	.noc_c
(1)  448/  FF1E98 : 3038 C020           		move.w	(RAM_CurrIndx).w,d0
(1)  449/  FF1E9C : 6126                		bsr	.procs_task
(1)  450/  FF1E9E :                     .noc_c:
(1)  451/  FF1E9E :                     
(1)  452/  FF1E9E :                     
(1)  453/  FF1E9E :                     ; 		lea	str_COMM(pc),a0
(1)  454/  FF1E9E :                     ; 		move.l	#locate(0,2,9),d0
(1)  455/  FF1E9E :                     ; 		bsr	Video_Print
(1)  456/  FF1E9E : 4E75                		rts
(1)  457/  FF1EA0 :                     
(1)  458/  FF1EA0 :                     ; --------------------------------------------------
(1)  459/  FF1EA0 :                     
(1)  460/  FF1EA0 :                     .print_cursor:
(1)  461/  FF1EA0 : 41FA 0270           		lea	str_Status(pc),a0
(1)  462/  FF1EA4 : 203C 0002 1404      		move.l	#locate(2,20,4),d0
(1)  463/  FF1EAA : 6100 E4E0           		bsr	Video_Print
(1)  464/  FF1EAE : 41FA 025C           		lea	str_Cursor(pc),a0
(1)  465/  FF1EB2 : 7000                		moveq	#0,d0
(1)  466/  FF1EB4 : 3038 C01E           		move.w	(RAM_CurrSelc).w,d0
(1)  467/  FF1EB8 : D0BC 0002 0205      		add.l	#locate(2,2,5),d0
(1)  468/  FF1EBE : 6100 E4CC           		bsr	Video_Print
(1)  469/  FF1EC2 : 4E75                		rts
(1)  470/  FF1EC4 :                     
(1)  471/  FF1EC4 :                     ; d1 - Track slot
(1)  472/  FF1EC4 :                     .procs_task:
(1)  473/  FF1EC4 : 3E38 C01E           		move.w	(RAM_CurrSelc).w,d7
(1)  474/  FF1EC8 : DE47                		add.w	d7,d7
(1)  475/  FF1ECA : 3E3B 7006           		move.w	.tasklist(pc,d7.w),d7
(1)  476/  FF1ECE : 4EFB 7002           		jmp	.tasklist(pc,d7.w)
(1)  477/  FF1ED2 :                     .tasklist:
(1)  478/  FF1ED2 : 000C                		dc.w .task_00-.tasklist
(1)  479/  FF1ED4 : 0028                		dc.w .task_01-.tasklist
(1)  480/  FF1ED6 : 002C                		dc.w .task_02-.tasklist
(1)  481/  FF1ED8 : 0030                		dc.w .task_03-.tasklist
(1)  482/  FF1EDA : 0034                		dc.w .task_04-.tasklist
(1)  483/  FF1EDC : 003C                		dc.w .task_05-.tasklist
(1)  484/  FF1EDE :                     
(1)  485/  FF1EDE :                     ; d0 - Track slot
(1)  486/  FF1EDE :                     .task_00:
(1)  487/  FF1EDE : 41FA 0036           		lea	MasterTrkList(pc),a0
(1)  488/  FF1EE2 : 3E38 C022           		move.w	(RAM_CurrTrack).w,d7
(1)  489/  FF1EE6 : E94F                		lsl.w	#4,d7
(1)  490/  FF1EE8 : 41F0 7000           		lea	(a0,d7.w),a0
(1)  491/  FF1EEC : 3228 000C           		move.w	$C(a0),d1
(1)  492/  FF1EF0 : 7400                		moveq	#0,d2
(1)  493/  FF1EF2 : 3628 000E           		move.w	$E(a0),d3
(1)  494/  FF1EF6 : 6000 E292           		bra	Sound_TrkPlay
(1)  495/  FF1EFA :                     .task_01:
(1)  496/  FF1EFA : 6000 E2C8           		bra	Sound_TrkStop
(1)  497/  FF1EFE :                     .task_02:
(1)  498/  FF1EFE : 6000 E2DA           		bra	Sound_TrkPause
(1)  499/  FF1F02 :                     .task_03:
(1)  500/  FF1F02 : 6000 E2EC           		bra	Sound_TrkResume
(1)  501/  FF1F06 :                     .task_04:
(1)  502/  FF1F06 : 3238 C024           		move.w	(RAM_CurrTicks).w,d1
(1)  503/  FF1F0A : 6000 E2FA           		bra	Sound_TrkTicks
(1)  504/  FF1F0E :                     .task_05:
(1)  505/  FF1F0E : 3238 C026           		move.w	(RAM_CurrTempo).w,d1
(1)  506/  FF1F12 : 6000 E30E           		bra	Sound_GlbTempo
(1)  507/  FF1F16 :                     
(1)  508/  FF1F16 :                     ; test playlist
(1)  509/  FF1F16 :                     MasterTrkList:
(1)  510/  FF1F16 : 0092 FBC6 0092 FBB5 	dc.l GemaTrk_patt_bemine,GemaTrk_blk_bemine,GemaTrk_ins_bemine
                    0093 0CB8           
(1)  511/  FF1F22 : 000A 0000           	dc.w $A,0
(1)  512/  FF1F26 : 0093 0D8C 0093 0D80 	dc.l GemaTrk_patt_HILLS,GemaTrk_blk_HILLS,GemaTrk_ins_HILLS
                    0093 1903           
(1)  513/  FF1F32 : 0007 0000           	dc.w 7,0
(1)  514/  FF1F36 :                     ; 	dc.l GemaTrk_patt_TEST2,GemaTrk_blk_TEST2,GemaTrk_ins_TEST2
(1)  515/  FF1F36 :                     ; 	dc.w 2,1
(1)  516/  FF1F36 :                     ; 	dc.l GemaTrk_patt_chrono,GemaTrk_blk_chrono,GemaTrk_ins_chrono
(1)  517/  FF1F36 :                     ; 	dc.w 3,1
(1)  518/  FF1F36 :                     ; 	dc.l GemaTrk_mecano_patt,GemaTrk_mecano_blk,GemaTrk_mecano_ins
(1)  519/  FF1F36 :                     ; 	dc.w 1,1
(1)  520/  FF1F36 :                     	align 2
(1)  521/  FF1F36 :                     
(1)  522/  FF1F36 :                     ; ====================================================================
(1)  523/  FF1F36 :                     ; ------------------------------------------------------
(1)  524/  FF1F36 :                     ; Subroutines
(1)  525/  FF1F36 :                     ; ------------------------------------------------------
(1)  526/  FF1F36 :                     
(1)  527/  FF1F36 :                     ; d2 - BLOCK
(1)  528/  FF1F36 :                     PlayThisSfx:
(1)  529/  FF1F36 : 41F9 0092 FB3A      		lea	(GemaTrkData_Sfx),a0
(1)  530/  FF1F3C : 7001                		moveq	#1,d0
(1)  531/  FF1F3E : 7206                		moveq	#6,d1
(1)  532/  FF1F40 :                     ; 		moveq	#0,d2
(1)  533/  FF1F40 : 7600                		moveq	#0,d3
(1)  534/  FF1F42 : 6000 E246           		bra	Sound_TrkPlay
(1)  535/  FF1F46 :                     
(1)  536/  FF1F46 :                     Emilie_Move:
(1)  537/  FF1F46 :                     
(1)  538/  FF1F46 :                     
(1)  539/  FF1F46 :                     ; 		sub.l
(1)  540/  FF1F46 :                     ; 		move.b	(RAM_EmiFlags),d2
(1)  541/  FF1F46 :                     ; 		bclr	#7,d2
(1)  542/  FF1F46 :                     ; 		move.w	(RAM_EmiPosX).w,d0
(1)  543/  FF1F46 :                     ; 		move.w	(RAM_EmiMoveX).w,d1
(1)  544/  FF1F46 :                     ; 		bsr	.move_it
(1)  545/  FF1F46 :                     ; 		move.w	d0,(RAM_EmiPosX).w
(1)  546/  FF1F46 :                     ; 		move.w	(RAM_EmiPosY).w,d0
(1)  547/  FF1F46 :                     ; 		move.w	(RAM_EmiMoveY).w,d1
(1)  548/  FF1F46 :                     ; 		bsr	.move_it
(1)  549/  FF1F46 :                     ; 		move.w	d0,(RAM_EmiPosY).w
(1)  550/  FF1F46 :                     ; 		move.b	d2,(RAM_EmiFlags).w
(1)  551/  FF1F46 :                     ;
(1)  552/  FF1F46 :                     ; 		move.l	(RAM_EmiJumpSpd).l,d5
(1)  553/  FF1F46 :                     ; 		move.l	(RAM_EmiJumpY),d6
(1)  554/  FF1F46 :                     ; 		add.l	d5,d6
(1)  555/  FF1F46 :                     ; 		move.l	d6,(RAM_EmiJumpY)
(1)  556/  FF1F46 :                     ;
(1)  557/  FF1F46 :                     ; 		move.l	(RAM_EmiJumpSpd).l,d5
(1)  558/  FF1F46 :                     ; 		add.l	#$2000,d5
(1)  559/  FF1F46 :                     ; ; 		bmi.s	.toomuch
(1)  560/  FF1F46 :                     ; 		move.l	(RAM_EmiJumpY),d6
(1)  561/  FF1F46 :                     ; 		bmi.s	.toomuch
(1)  562/  FF1F46 :                     ; 		clr.l	d5
(1)  563/  FF1F46 :                     ; 		bra.s	.eximuch
(1)  564/  FF1F46 :                     ; .toomuch:
(1)  565/  FF1F46 :                     ; 		move.w	#1,(RAM_EmiUpd).w
(1)  566/  FF1F46 :                     ; .eximuch:
(1)  567/  FF1F46 :                     ; 		move.l	d5,(RAM_EmiJumpSpd).l
(1)  568/  FF1F46 :                     ; 		rts
(1)  569/  FF1F46 :                     ; .move_it:
(1)  570/  FF1F46 :                     ; 		move.w	d0,d5
(1)  571/  FF1F46 :                     ; 		move.w	d1,d4
(1)  572/  FF1F46 :                     ; 		cmp.w	d5,d4
(1)  573/  FF1F46 :                     ; 		beq.s	.same_x
(1)  574/  FF1F46 :                     ; 		move.w	#1,d6
(1)  575/  FF1F46 :                     ; 		sub.w	d5,d4
(1)  576/  FF1F46 :                     ; 		bpl.s	.reversx
(1)  577/  FF1F46 :                     ; 		move.w	#-1,d6
(1)  578/  FF1F46 :                     ; .reversx:
(1)  579/  FF1F46 :                     ; 		bset	#7,d2
(1)  580/  FF1F46 :                     ; 		add.w	#1,(RAM_EmiAnim).w
(1)  581/  FF1F46 :                     ; 		add.w	d6,d0
(1)  582/  FF1F46 :                     ; .same_x:
(1)  583/  FF1F46 : 4E75                		rts
(1)  584/  FF1F48 :                     
(1)  585/  FF1F48 :                     Emilie_MkSprite:
(1)  586/  FF1F48 : 4DF9 00C0 0000      		lea	(vdp_data),a6
(1)  587/  FF1F4E : 4A78 C014           		tst.w	(RAM_EmiHide).w
(1)  588/  FF1F52 : 6600 00C4           		bne	.hidefuji
(1)  589/  FF1F56 :                     
(1)  590/  FF1F56 :                     ; 		move.w	(RAM_EmiChar),d2
(1)  591/  FF1F56 :                     ; 		move.w	(RAM_EmiAnim),d3
(1)  592/  FF1F56 :                     ; 		lsr.w	#3,d3
(1)  593/  FF1F56 :                     ; 		and.w	#7,d3
(1)  594/  FF1F56 :                     ; 		add.w	d3,d2
(1)  595/  FF1F56 :                     ; 		move.w	#$20*$20,d1
(1)  596/  FF1F56 :                     ; 		mulu.w	d1,d2
(1)  597/  FF1F56 :                     ; 		move.l	#ART_EMI,d0
(1)  598/  FF1F56 :                     ; 		add.l	d2,d0
(1)  599/  FF1F56 :                     ; 		and.l	#-2,d0
(1)  600/  FF1F56 :                     ; 		move.w	#1,d2
(1)  601/  FF1F56 :                     ; 		bsr	Video_DmaSet
(1)  602/  FF1F56 :                     .no_updgfx:
(1)  603/  FF1F56 : 4DF8 C820           		lea	(RAM_SpriteData),a6
(1)  604/  FF1F5A : 2038 C004           		move.l	(RAM_EmiPosY),d0
(1)  605/  FF1F5E : 2238 C000           		move.l	(RAM_EmiPosX),d1
(1)  606/  FF1F62 : 4840                		swap	d0
(1)  607/  FF1F64 : 4841                		swap	d1
(1)  608/  FF1F66 : D07C 00A0           		add.w	#$80+32,d0
(1)  609/  FF1F6A : D27C 00A0           		add.w	#$80+32,d1
(1)  610/  FF1F6E : 3438 C012           		move.w	(RAM_EmiAnim),d2
(1)  611/  FF1F72 : E64A                		lsr.w	#3,d2
(1)  612/  FF1F74 : C47C 0007           		and.w	#7,d2
(1)  613/  FF1F78 : D442                		add.w	d2,d2
(1)  614/  FF1F7A : 41FA 02C2           		lea	Map_Nicole(pc),a0
(1)  615/  FF1F7E : 3430 2000           		move.w	(a0,d2.w),d2
(1)  616/  FF1F82 : D0C2                		adda	d2,a0
(1)  617/  FF1F84 : 1818                		move.b	(a0)+,d4
(1)  618/  FF1F86 : C87C 00FF           		and.w	#$FF,d4
(1)  619/  FF1F8A : 987C 0001           		sub.w	#1,d4
(1)  620/  FF1F8E : 3A3C 0001           		move.w	#$0001,d5
(1)  621/  FF1F92 : 3C3C 0001           		move.w	#$0001,d6
(1)  622/  FF1F96 :                     .nxt_pz:
(1)  623/  FF1F96 : 1618                		move.b	(a0)+,d3
(1)  624/  FF1F98 : 4883                		ext.w	d3
(1)  625/  FF1F9A : D640                		add.w	d0,d3
(1)  626/  FF1F9C : 3CC3                		move.w	d3,(a6)+
(1)  627/  FF1F9E :                     
(1)  628/  FF1F9E : 1618                		move.b	(a0)+,d3
(1)  629/  FF1FA0 : E14B                		lsl.w	#8,d3
(1)  630/  FF1FA2 : D645                		add.w	d5,d3
(1)  631/  FF1FA4 : 3CC3                		move.w	d3,(a6)+
(1)  632/  FF1FA6 :                     
(1)  633/  FF1FA6 : 1618                		move.b	(a0)+,d3
(1)  634/  FF1FA8 : E14B                		lsl.w	#8,d3
(1)  635/  FF1FAA : 1418                		move.b	(a0)+,d2
(1)  636/  FF1FAC : C47C 00FF           		and.w	#$FF,d2
(1)  637/  FF1FB0 : D443                		add.w	d3,d2
(1)  638/  FF1FB2 : D446                		add.w	d6,d2
(1)  639/  FF1FB4 : 3CC2                		move.w	d2,(a6)+
(1)  640/  FF1FB6 :                     
(1)  641/  FF1FB6 : 1618                		move.b	(a0)+,d3
(1)  642/  FF1FB8 : 4883                		ext.w	d3
(1)  643/  FF1FBA : D641                		add.w	d1,d3
(1)  644/  FF1FBC : 3CC3                		move.w	d3,(a6)+
(1)  645/  FF1FBE : DA7C 0001           		add.w	#1,d5
(1)  646/  FF1FC2 : 51CC FFD2           		dbf	d4,.nxt_pz
(1)  647/  FF1FC6 : 429E                		clr.l	(a6)+
(1)  648/  FF1FC8 : 429E                		clr.l	(a6)+
(1)  649/  FF1FCA :                     
(1)  650/  FF1FCA :                     	; DPLC
(1)  651/  FF1FCA : 3438 C012           		move.w	(RAM_EmiAnim),d2
(1)  652/  FF1FCE : E64A                		lsr.w	#3,d2
(1)  653/  FF1FD0 : C47C 0007           		and.w	#7,d2
(1)  654/  FF1FD4 : D442                		add.w	d2,d2
(1)  655/  FF1FD6 : 41FA 03D2           		lea	Dplc_Nicole(pc),a0
(1)  656/  FF1FDA : 3430 2000           		move.w	(a0,d2.w),d2
(1)  657/  FF1FDE : D0C2                		adda	d2,a0
(1)  658/  FF1FE0 : 3818                		move.w	(a0)+,d4
(1)  659/  FF1FE2 : C87C 00FF           		and.w	#$FF,d4
(1)  660/  FF1FE6 : 987C 0001           		sub.w	#1,d4
(1)  661/  FF1FEA : 3A3C 0001           		move.w	#1,d5
(1)  662/  FF1FEE :                     
(1)  663/  FF1FEE :                     
(1)  664/  FF1FEE :                     	; d0 - graphics
(1)  665/  FF1FEE :                     	; d5 - VRAM OUTPUT
(1)  666/  FF1FEE : EB4D                		lsl.w	#5,d5
(1)  667/  FF1FF0 :                     .nxt_dpz:
(1)  668/  FF1FF0 : 203C 0003 8800      		move.l	#ART_EMI,d0
(1)  669/  FF1FF6 : 3218                		move.w	(a0)+,d1
(1)  670/  FF1FF8 : 3401                		move.w	d1,d2
(1)  671/  FF1FFA : C27C 07FF           		and.w	#$7FF,d1
(1)  672/  FF1FFE : EB49                		lsl.w	#5,d1
(1)  673/  FF2000 : D081                		add.l	d1,d0
(1)  674/  FF2002 : 3205                		move.w	d5,d1
(1)  675/  FF2004 : EE4A                		lsr.w	#7,d2
(1)  676/  FF2006 : D47C 0020           		add.w	#$20,d2
(1)  677/  FF200A : 3602                		move.w	d2,d3
(1)  678/  FF200C : 6100 E6CA           		bsr	Video_DmaSet
(1)  679/  FF2010 : DA43                		add.w	d3,d5
(1)  680/  FF2012 : 51CC FFDC           		dbf	d4,.nxt_dpz
(1)  681/  FF2016 :                     .no_upd:
(1)  682/  FF2016 : 4E75                		rts
(1)  683/  FF2018 :                     ;
(1)  684/  FF2018 :                     .hidefuji:
(1)  685/  FF2018 : 4DF8 C820           		lea	(RAM_SpriteData),a6
(1)  686/  FF201C : 2CFC 0000 0000      		move.l	#0,(a6)+
(1)  687/  FF2022 : 2CFC 0000 0000      		move.l	#0,(a6)+
(1)  688/  FF2028 : 2CFC 0000 0000      		move.l	#0,(a6)+
(1)  689/  FF202E : 2CFC 0000 0000      		move.l	#0,(a6)+
(1)  690/  FF2034 : 4E75                		rts
(1)  691/  FF2036 :                     
(1)  692/  FF2036 :                     ; VBLANK only
(1)  693/  FF2036 :                     Emilie_Show:
(1)  694/  FF2036 : 4DF9 00C0 0000      		lea	(vdp_data),a6
(1)  695/  FF203C : 2D7C 7800 0003 0004 		move.l	#$78000003,4(a6)
(1)  696/  FF2044 : 4BF8 C820           		lea	(RAM_SpriteData),a5
(1)  697/  FF2048 : 3E3C 0007           		move.w	#8-1,d7
(1)  698/  FF204C :                     .sprdata:
(1)  699/  FF204C : 2C9D                		move.l	(a5)+,(a6)
(1)  700/  FF204E : 2C9D                		move.l	(a5)+,(a6)
(1)  701/  FF2050 : 2C9D                		move.l	(a5)+,(a6)
(1)  702/  FF2052 : 2C9D                		move.l	(a5)+,(a6)
(1)  703/  FF2054 : 51CF FFF6           		dbf	d7,.sprdata
(1)  704/  FF2058 : 4E75                		rts
(1)  705/  FF205A :                     
(1)  706/  FF205A :                     ; ====================================================================
(1)  707/  FF205A :                     ; ------------------------------------------------------
(1)  708/  FF205A :                     ; FIFO TEST
(1)  709/  FF205A :                     ; ------------------------------------------------------
(1)  710/  FF205A :                     
(1)  711/  FF205A :                     ; TODO: ver como fregados consigo mandar
(1)  712/  FF205A :                     ; RAM al 32X sin que se trabe
(1)  713/  FF205A :                     
(1)  714/  FF205A :                     MD_FifoMars:
(1)  715/  FF205A : 4DF8 D926           		lea	(RAM_FrameCount),a6
(1)  716/  FF205E : 3C3C 0100           		move.w	#$100,d6
(1)  717/  FF2062 :                     
(1)  718/  FF2062 : 4BF9 00A1 5100      		lea	(sysmars_reg),a5
(1)  719/  FF2068 : 40C7                		move.w	sr,d7			; Backup current SR
(1)  720/  FF206A : 46FC 2700           		move.w	#$2700,sr		; Disable interrupts
(1)  721/  FF206E : 3A3C 000E           		move.w	#$00E,d5
(1)  722/  FF2072 :                     .retry:
(1)  723/  FF2072 : 23FC C000 0000 00C0 		move.l	#$C0000000,(vdp_ctrl).l	; DEBUG ENTER
                    0004                
(1)  724/  FF207C : 33C5 00C0 0000      		move.w	d5,(vdp_data).l
(1)  725/  FF2082 : 13FC 0000 00A1 5107 		move.b	#%000,($A15107).l	; 68S bit
(1)  726/  FF208A : 33C6 00A1 5110      		move.w	d6,($A15110).l		; DREQ len
(1)  727/  FF2090 : 13FC 0004 00A1 5107 		move.b	#%100,($A15107).l	; 68S bit
(1)  728/  FF2098 : 49F9 00A1 5112      		lea	($A15112).l,a4
(1)  729/  FF209E : 4E71                		nop
(1)  730/  FF20A0 : 4E71                		nop
(1)  731/  FF20A2 : 4E71                		nop
(1)  732/  FF20A4 : 4E71                		nop
(1)  733/  FF20A6 : 4E71                		nop
(1)  734/  FF20A8 : 4E71                		nop
(1)  735/  FF20AA : 4E71                		nop
(1)  736/  FF20AC : 4E71                		nop
(1)  737/  FF20AE : 302D 0002           		move.w	standby(a5),d0		; Request SLAVE CMD interrupt
(1)  738/  FF20B2 : 08C0 0001           		bset	#1,d0
(1)  739/  FF20B6 : 3B40 0002           		move.w	d0,standby(a5)
(1)  740/  FF20BA : 302D 0002           .wait_cmd:	move.w	standby(a5),d0		; interrupt is ready?
(1)  741/  FF20BE : 0800 0001           		btst    #1,d0
(1)  742/  FF20C2 : 66F6                		bne.s   .wait_cmd
(1)  743/  FF20C4 :                     ; .wait_dma:	move.b	comm15(a5),d0		; Another flag to check
(1)  744/  FF20C4 :                     ; 		btst	#6,d0
(1)  745/  FF20C4 :                     ; 		beq.s	.wait_dma
(1)  746/  FF20C4 :                     ; 		move.b	#1,d0
(1)  747/  FF20C4 :                     ; 		move.b	d0,comm15(a5)
(1)  748/  FF20C4 :                     
(1)  749/  FF20C4 :                     ; 	; blast
(1)  750/  FF20C4 :                     ; 	rept $200/128
(1)  751/  FF20C4 :                     ; 		bsr.s	.blast
(1)  752/  FF20C4 :                     ; 	endm
(1)  753/  FF20C4 :                     ; 		move.l	#$C0000000,(vdp_ctrl).l	; DEBUG EXIT
(1)  754/  FF20C4 :                     ; 		move.w	#$000,(vdp_data).l
(1)  755/  FF20C4 :                     ; 		move.w	d7,sr			; Restore SR
(1)  756/  FF20C4 :                     ; 		rts
(1)  757/  FF20C4 :                     ; .blast:
(1)  758/  FF20C4 :                     ; 	rept 128
(1)  759/  FF20C4 :                     ; 		move.w	(a6)+,(a4)
(1)  760/  FF20C4 :                     ; 	endm
(1)  761/  FF20C4 :                     ; 		rts
(1)  762/  FF20C4 :                     
(1)  763/  FF20C4 :                     ; 	safer
(1)  764/  FF20C4 : 389E                .l0:		move.w	(a6)+,(a4)		; Data Transfer
(1)  765/  FF20C6 : 389E                		move.w	(a6)+,(a4)		;
(1)  766/  FF20C8 : 389E                		move.w	(a6)+,(a4)		;
(1)  767/  FF20CA : 389E                		move.w	(a6)+,(a4)		;
(1)  768/  FF20CC : 082D 0007 0007      .l1:		btst	#7,dreqctl+1(a5)	; FIFO Full ?
(1)  769/  FF20D2 : 66F8                		bne.s	.l1
(1)  770/  FF20D4 : 5946                		subq	#4,d6
(1)  771/  FF20D6 : 64EC                		bcc.s	.l0
(1)  772/  FF20D8 : 3A3C 0E00           		move.w	#$E00,d5
(1)  773/  FF20DC : 082D 0002 0006      		btst	#2,dreqctl(a5)		; DMA All OK ?
(1)  774/  FF20E2 : 668E                		bne.s	.retry
(1)  775/  FF20E4 : 23FC C000 0000 00C0 		move.l	#$C0000000,(vdp_ctrl).l	; DEBUG EXIT
                    0004                
(1)  776/  FF20EE : 33FC 0000 00C0 0000 		move.w	#$000,(vdp_data).l
(1)  777/  FF20F6 : 46C7                		move.w	d7,sr			; Restore SR
(1)  778/  FF20F8 : 4E75                		rts
(1)  779/  FF20FA :                     
(1)  780/  FF20FA :                     ; ====================================================================
(1)  781/  FF20FA :                     ; ------------------------------------------------------
(1)  782/  FF20FA :                     ; VBlank
(1)  783/  FF20FA :                     ; ------------------------------------------------------
(1)  784/  FF20FA :                     
(1)  785/  FF20FA :                     ; ------------------------------------------------------
(1)  786/  FF20FA :                     ; HBlank
(1)  787/  FF20FA :                     ; ------------------------------------------------------
(1)  788/  FF20FA :                     
(1)  789/  FF20FA :                     ; ====================================================================
(1)  790/  FF20FA :                     ; ------------------------------------------------------
(1)  791/  FF20FA :                     ; DATA
(1)  792/  FF20FA :                     ;
(1)  793/  FF20FA :                     ; Small stuff goes here
(1)  794/  FF20FA :                     ; ------------------------------------------------------
(1)  795/  FF20FA :                     
(1)  796/  FF20FA :                     str_Title:
(1)  797/  FF20FA : 5072 6F6A 6563 7420 		dc.b "Project MARSIANO",0
                    4D41 5253 4941 4E4F 
                    00                  
(1)  798/  FF210B :                     		align 2
(1)  799/  FF210C :                     
(1)  800/  FF210C : 200A                str_Cursor:	dc.b " ",$A
(1)  801/  FF210E : 3E0A                		dc.b ">",$A
(1)  802/  FF2110 : 2000                		dc.b " ",0
(1)  803/  FF2112 :                     
(1)  804/  FF2112 :                     str_Status:
(1)  805/  FF2112 : 5C77 0A0A           		dc.b "\\w",$A,$A
(1)  806/  FF2116 : 5C77 0A0A 0A0A      		dc.b "\\w",$A,$A,$A,$A
(1)  807/  FF211C : 5C77 0A             		dc.b "\\w",$A
(1)  808/  FF211F : 5C77 00             		dc.b "\\w",0
(1)  809/  FF2122 : FFFF C020           		dc.l RAM_CurrIndx
(1)  810/  FF2126 : FFFF C022           		dc.l RAM_CurrTrack
(1)  811/  FF212A : FFFF C024           		dc.l RAM_CurrTicks
(1)  812/  FF212E : FFFF C026           		dc.l RAM_CurrTempo
(1)  813/  FF2132 :                     		align 2
(1)  814/  FF2132 :                     str_Gema:
(1)  815/  FF2132 : 4745 4D41 2053 4F55 		dc.b "GEMA SOUND DRIVER",$A
                    4E44 2044 5249 5645 
                    520A                
(1)  816/  FF2144 : 0A                  		dc.b $A
(1)  817/  FF2145 : 5472 6163 6B20 696E 		dc.b "Track index -----",$A,$A
                    6465 7820 2D2D 2D2D 
                    2D0A 0A             
(1)  818/  FF2158 : 2020 536F 756E 645F 		dc.b "  Sound_TrkPlay",$A
                    5472 6B50 6C61 790A 
(1)  819/  FF2168 : 2020 536F 756E 645F 		dc.b "  Sound_TrkStop",$A
                    5472 6B53 746F 700A 
(1)  820/  FF2178 : 2020 536F 756E 645F 		dc.b "  Sound_TrkPause**",$A
                    5472 6B50 6175 7365 
                    2A2A 0A             
(1)  821/  FF218B : 2020 536F 756E 645F 		dc.b "  Sound_TrkResume**",$A
                    5472 6B52 6573 756D 
                    652A 2A0A           
(1)  822/  FF219F : 2020 536F 756E 645F 		dc.b "  Sound_TrkTicks",$A
                    5472 6B54 6963 6B73 
                    0A                  
(1)  823/  FF21B0 : 2020 536F 756E 645F 		dc.b "  Sound_GlbTempo",0
                    476C 6254 656D 706F 
                    00                  
(1)  824/  FF21C1 :                     		align 2
(1)  825/  FF21C2 :                     str_COMM:
(1)  826/  FF21C2 : 5C77 205C 7720 5C77 		dc.b "\\w \\w \\w \\w",$A
                    205C 770A           
(1)  827/  FF21CE : 5C77 205C 7720 5C77 		dc.b "\\w \\w \\w \\w",0
                    205C 7700           
(1)  828/  FF21DA : 00A1 5120           		dc.l sysmars_reg+comm0
(1)  829/  FF21DE : 00A1 5122           		dc.l sysmars_reg+comm2
(1)  830/  FF21E2 : 00A1 5124           		dc.l sysmars_reg+comm4
(1)  831/  FF21E6 : 00A1 5126           		dc.l sysmars_reg+comm6
(1)  832/  FF21EA : 00A1 5128           		dc.l sysmars_reg+comm8
(1)  833/  FF21EE : 00A1 512A           		dc.l sysmars_reg+comm10
(1)  834/  FF21F2 : 00A1 512C           		dc.l sysmars_reg+comm12
(1)  835/  FF21F6 : 00A1 512E           		dc.l sysmars_reg+comm14
(1)  836/  FF21FA :                     		align 2
(1)  837/  FF21FA :                     
(1)  838/  FF21FA :                     ; str_TempVal:
(1)  839/  FF21FA :                     ; 		dc.b "\\w",0
(1)  840/  FF21FA :                     ; 		dc.l RAM_EmiFlags
(1)  841/  FF21FA :                     ; 		align 2
(1)  842/  FF21FA :                     
(1)  843/  FF21FA :                     PAL_EMI:
(1)  844/  FF21FA : 0000                		dc.w 0
(1)  845/  FF21FC :                     		binclude "data/md/sprites/emi_pal.bin",2
(1)  846/  FF221A :                     		align 2
(1)  847/  FF221A :                     
(1)  848/  FF221A :                     PAL_TESTBOARD:
(1)  849/  FF221A :                     		binclude "data/md/bg/fg_pal.bin"
(1)  850/  FF2232 :                     		align 2
(1)  851/  FF2232 :                     PAL_BG:
(1)  852/  FF2232 :                     		binclude "data/md/bg/bg_pal.bin"
(1)  853/  FF223E :                     		align 2
(1)  854/  FF223E :                     
(1)  855/  FF223E :                     Map_Nicole:
(1)  856/  FF223E :                     		include "data/md/sprites/emi_map.asm"
(2)    1/  FF223E :                     .mappings:
(2)    2/  FF223E : 0010                		dc.w .frame_0-.mappings
(2)    3/  FF2240 : 0048                		dc.w .frame_1-.mappings
(2)    4/  FF2242 : 007B                		dc.w .frame_2-.mappings
(2)    5/  FF2244 : 00A4                		dc.w .frame_3-.mappings
(2)    6/  FF2246 : 00C8                		dc.w .frame_4-.mappings
(2)    7/  FF2248 : 00F6                		dc.w .frame_5-.mappings
(2)    8/  FF224A : 0115                		dc.w .frame_6-.mappings
(2)    9/  FF224C : 013E                		dc.w .frame_7-.mappings
(2)   10/  FF224E :                     .frame_0:
(2)   11/  FF224E : 0B                  		dc.b $B
(2)   12/  FF224F :                     
(2)   13/  FF224F : E80C 0000 C0        		dc.b $E8,$C,$0,$0,$C0
(2)   14/  FF2254 : E00C 0004 C8        		dc.b $E0,$C,$0,$4,$C8
(2)   15/  FF2259 : D80C 0008 D0        		dc.b $D8,$C,$0,$8,$D0
(2)   16/  FF225E : F00C 000C D0        		dc.b $F0,$C,$0,$C,$D0
(2)   17/  FF2263 : C80D 0010 D8        		dc.b $C8,$D,$0,$10,$D8
(2)   18/  FF2268 : C008 0018 E0        		dc.b $C0,$8,$0,$18,$E0
(2)   19/  FF226D : E804 001B E0        		dc.b $E8,$4,$0,$1B,$E0
(2)   20/  FF2272 : E008 001D E8        		dc.b $E0,$8,$0,$1D,$E8
(2)   21/  FF2277 : F808 0020 E8        		dc.b $F8,$8,$0,$20,$E8
(2)   22/  FF227C : D804 0023 F0        		dc.b $D8,$4,$0,$23,$F0
(2)   23/  FF2281 : F004 0025 F0        		dc.b $F0,$4,$0,$25,$F0
(2)   24/  FF2286 :                     .frame_1:
(2)   25/  FF2286 : 0A                  		dc.b $A
(2)   26/  FF2287 :                     
(2)   27/  FF2287 : E80D 0000 C8        		dc.b $E8,$D,$0,$0,$C8
(2)   28/  FF228C : D00C 0008 D0        		dc.b $D0,$C,$0,$8,$D0
(2)   29/  FF2291 : E00C 000C D0        		dc.b $E0,$C,$0,$C,$D0
(2)   30/  FF2296 : C80C 0010 D8        		dc.b $C8,$C,$0,$10,$D8
(2)   31/  FF229B : D80C 0014 D8        		dc.b $D8,$C,$0,$14,$D8
(2)   32/  FF22A0 : F808 0018 D8        		dc.b $F8,$8,$0,$18,$D8
(2)   33/  FF22A5 : C008 001B E0        		dc.b $C0,$8,$0,$1B,$E0
(2)   34/  FF22AA : E804 001E E8        		dc.b $E8,$4,$0,$1E,$E8
(2)   35/  FF22AF : D000 0020 F0        		dc.b $D0,$0,$0,$20,$F0
(2)   36/  FF22B4 : E000 0021 F0        		dc.b $E0,$0,$0,$21,$F0
(2)   37/  FF22B9 :                     .frame_2:
(2)   38/  FF22B9 : 08                  		dc.b $8
(2)   39/  FF22BA :                     
(2)   40/  FF22BA : D00C 0000 D0        		dc.b $D0,$C,$0,$0,$D0
(2)   41/  FF22BF : E007 0004 D0        		dc.b $E0,$7,$0,$4,$D0
(2)   42/  FF22C4 : C00D 000C D8        		dc.b $C0,$D,$0,$C,$D8
(2)   43/  FF22C9 : D80C 0014 D8        		dc.b $D8,$C,$0,$14,$D8
(2)   44/  FF22CE : E001 0018 E0        		dc.b $E0,$1,$0,$18,$E0
(2)   45/  FF22D3 : F800 001A E0        		dc.b $F8,$0,$0,$1A,$E0
(2)   46/  FF22D8 : E000 001B E8        		dc.b $E0,$0,$0,$1B,$E8
(2)   47/  FF22DD : D000 001C F0        		dc.b $D0,$0,$0,$1C,$F0
(2)   48/  FF22E2 :                     .frame_3:
(2)   49/  FF22E2 : 07                  		dc.b $7
(2)   50/  FF22E3 :                     
(2)   51/  FF22E3 : F00D 0000 C8        		dc.b $F0,$D,$0,$0,$C8
(2)   52/  FF22E8 : D80E 0008 D0        		dc.b $D8,$E,$0,$8,$D0
(2)   53/  FF22ED : C80D 0014 D8        		dc.b $C8,$D,$0,$14,$D8
(2)   54/  FF22F2 : C008 001C E0        		dc.b $C0,$8,$0,$1C,$E0
(2)   55/  FF22F7 : F001 001F E8        		dc.b $F0,$1,$0,$1F,$E8
(2)   56/  FF22FC : D802 0021 F0        		dc.b $D8,$2,$0,$21,$F0
(2)   57/  FF2301 : F800 0024 F0        		dc.b $F8,$0,$0,$24,$F0
(2)   58/  FF2306 :                     .frame_4:
(2)   59/  FF2306 : 09                  		dc.b $9
(2)   60/  FF2307 :                     
(2)   61/  FF2307 : E809 0000 C0        		dc.b $E8,$9,$0,$0,$C0
(2)   62/  FF230C : E00C 0006 C8        		dc.b $E0,$C,$0,$6,$C8
(2)   63/  FF2311 : D00D 000A D0        		dc.b $D0,$D,$0,$A,$D0
(2)   64/  FF2316 : C80C 0012 D8        		dc.b $C8,$C,$0,$12,$D8
(2)   65/  FF231B : E804 0016 D8        		dc.b $E8,$4,$0,$16,$D8
(2)   66/  FF2320 : C008 0018 E0        		dc.b $C0,$8,$0,$18,$E0
(2)   67/  FF2325 : F009 001B E0        		dc.b $F0,$9,$0,$1B,$E0
(2)   68/  FF232A : E004 0021 E8        		dc.b $E0,$4,$0,$21,$E8
(2)   69/  FF232F : D001 0023 F0        		dc.b $D0,$1,$0,$23,$F0
(2)   70/  FF2334 :                     .frame_5:
(2)   71/  FF2334 : 06                  		dc.b $6
(2)   72/  FF2335 :                     
(2)   73/  FF2335 : F00C 0000 C8        		dc.b $F0,$C,$0,$0,$C8
(2)   74/  FF233A : D00F 0004 D0        		dc.b $D0,$F,$0,$4,$D0
(2)   75/  FF233F : C80C 0014 D8        		dc.b $C8,$C,$0,$14,$D8
(2)   76/  FF2344 : F808 0018 D8        		dc.b $F8,$8,$0,$18,$D8
(2)   77/  FF2349 : C008 001B E0        		dc.b $C0,$8,$0,$1B,$E0
(2)   78/  FF234E : D003 001E F0        		dc.b $D0,$3,$0,$1E,$F0
(2)   79/  FF2353 :                     .frame_6:
(2)   80/  FF2353 : 08                  		dc.b $8
(2)   81/  FF2354 :                     
(2)   82/  FF2354 : D00C 0000 D0        		dc.b $D0,$C,$0,$0,$D0
(2)   83/  FF2359 : E007 0004 D0        		dc.b $E0,$7,$0,$4,$D0
(2)   84/  FF235E : C00D 000C D8        		dc.b $C0,$D,$0,$C,$D8
(2)   85/  FF2363 : D80C 0014 D8        		dc.b $D8,$C,$0,$14,$D8
(2)   86/  FF2368 : E001 0018 E0        		dc.b $E0,$1,$0,$18,$E0
(2)   87/  FF236D : F800 001A E0        		dc.b $F8,$0,$0,$1A,$E0
(2)   88/  FF2372 : E000 001B E8        		dc.b $E0,$0,$0,$1B,$E8
(2)   89/  FF2377 : D000 001C F0        		dc.b $D0,$0,$0,$1C,$F0
(2)   90/  FF237C :                     .frame_7:
(2)   91/  FF237C : 09                  		dc.b $9
(2)   92/  FF237D :                     
(2)   93/  FF237D : F00D 0000 C8        		dc.b $F0,$D,$0,$0,$C8
(2)   94/  FF2382 : D00C 0008 D0        		dc.b $D0,$C,$0,$8,$D0
(2)   95/  FF2387 : E00D 000C D0        		dc.b $E0,$D,$0,$C,$D0
(2)   96/  FF238C : C80C 0014 D8        		dc.b $C8,$C,$0,$14,$D8
(2)   97/  FF2391 : D80C 0018 D8        		dc.b $D8,$C,$0,$18,$D8
(2)   98/  FF2396 : C008 001C E0        		dc.b $C0,$8,$0,$1C,$E0
(2)   99/  FF239B : F001 001F E8        		dc.b $F0,$1,$0,$1F,$E8
(2)  100/  FF23A0 : D000 0021 F0        		dc.b $D0,$0,$0,$21,$F0
(2)  101/  FF23A5 : E001 0022 F0        		dc.b $E0,$1,$0,$22,$F0
(2)  102/  FF23AA :                     
(1)  857/  FF23AA :                     		align 2
(1)  858/  FF23AA :                     Dplc_Nicole:
(1)  859/  FF23AA :                     		include "data/md/sprites/emi_plc.asm"
(2)    1/  FF23AA :                     .dplc:
(2)    2/  FF23AA : 0010                		dc.w .frame_0-.dplc
(2)    3/  FF23AC : 0028                		dc.w .frame_1-.dplc
(2)    4/  FF23AE : 003E                		dc.w .frame_2-.dplc
(2)    5/  FF23B0 : 0050                		dc.w .frame_3-.dplc
(2)    6/  FF23B2 : 0060                		dc.w .frame_4-.dplc
(2)    7/  FF23B4 : 0074                		dc.w .frame_5-.dplc
(2)    8/  FF23B6 : 0082                		dc.w .frame_6-.dplc
(2)    9/  FF23B8 : 0094                		dc.w .frame_7-.dplc
(2)   10/  FF23BA :                     .frame_0:
(2)   11/  FF23BA : 000B                		dc.w $B
(2)   12/  FF23BC :                     
(2)   13/  FF23BC : 3000                		dc.w $3000
(2)   14/  FF23BE : 3004                		dc.w $3004
(2)   15/  FF23C0 : 3008                		dc.w $3008
(2)   16/  FF23C2 : 300C                		dc.w $300C
(2)   17/  FF23C4 : 7010                		dc.w $7010
(2)   18/  FF23C6 : 2018                		dc.w $2018
(2)   19/  FF23C8 : 101B                		dc.w $101B
(2)   20/  FF23CA : 201D                		dc.w $201D
(2)   21/  FF23CC : 2020                		dc.w $2020
(2)   22/  FF23CE : 1023                		dc.w $1023
(2)   23/  FF23D0 : 1025                		dc.w $1025
(2)   24/  FF23D2 :                     .frame_1:
(2)   25/  FF23D2 : 000A                		dc.w $A
(2)   26/  FF23D4 :                     
(2)   27/  FF23D4 : 7027                		dc.w $7027
(2)   28/  FF23D6 : 302F                		dc.w $302F
(2)   29/  FF23D8 : 3033                		dc.w $3033
(2)   30/  FF23DA : 3037                		dc.w $3037
(2)   31/  FF23DC : 303B                		dc.w $303B
(2)   32/  FF23DE : 203F                		dc.w $203F
(2)   33/  FF23E0 : 2042                		dc.w $2042
(2)   34/  FF23E2 : 1045                		dc.w $1045
(2)   35/  FF23E4 : 0047                		dc.w $47
(2)   36/  FF23E6 : 0048                		dc.w $48
(2)   37/  FF23E8 :                     .frame_2:
(2)   38/  FF23E8 : 0008                		dc.w $8
(2)   39/  FF23EA :                     
(2)   40/  FF23EA : 3049                		dc.w $3049
(2)   41/  FF23EC : 704D                		dc.w $704D
(2)   42/  FF23EE : 7055                		dc.w $7055
(2)   43/  FF23F0 : 305D                		dc.w $305D
(2)   44/  FF23F2 : 1061                		dc.w $1061
(2)   45/  FF23F4 : 0063                		dc.w $63
(2)   46/  FF23F6 : 0064                		dc.w $64
(2)   47/  FF23F8 : 0065                		dc.w $65
(2)   48/  FF23FA :                     .frame_3:
(2)   49/  FF23FA : 0007                		dc.w $7
(2)   50/  FF23FC :                     
(2)   51/  FF23FC : 7066                		dc.w $7066
(2)   52/  FF23FE : B06E                		dc.w $B06E
(2)   53/  FF2400 : 707A                		dc.w $707A
(2)   54/  FF2402 : 2082                		dc.w $2082
(2)   55/  FF2404 : 1085                		dc.w $1085
(2)   56/  FF2406 : 2087                		dc.w $2087
(2)   57/  FF2408 : 008A                		dc.w $8A
(2)   58/  FF240A :                     .frame_4:
(2)   59/  FF240A : 0009                		dc.w $9
(2)   60/  FF240C :                     
(2)   61/  FF240C : 508B                		dc.w $508B
(2)   62/  FF240E : 3091                		dc.w $3091
(2)   63/  FF2410 : 7095                		dc.w $7095
(2)   64/  FF2412 : 309D                		dc.w $309D
(2)   65/  FF2414 : 10A1                		dc.w $10A1
(2)   66/  FF2416 : 20A3                		dc.w $20A3
(2)   67/  FF2418 : 50A6                		dc.w $50A6
(2)   68/  FF241A : 10AC                		dc.w $10AC
(2)   69/  FF241C : 10AE                		dc.w $10AE
(2)   70/  FF241E :                     .frame_5:
(2)   71/  FF241E : 0006                		dc.w $6
(2)   72/  FF2420 :                     
(2)   73/  FF2420 : 30B0                		dc.w $30B0
(2)   74/  FF2422 : F0B4                		dc.w $F0B4
(2)   75/  FF2424 : 30C4                		dc.w $30C4
(2)   76/  FF2426 : 20C8                		dc.w $20C8
(2)   77/  FF2428 : 20CB                		dc.w $20CB
(2)   78/  FF242A : 30CE                		dc.w $30CE
(2)   79/  FF242C :                     .frame_6:
(2)   80/  FF242C : 0008                		dc.w $8
(2)   81/  FF242E :                     
(2)   82/  FF242E : 30D2                		dc.w $30D2
(2)   83/  FF2430 : 70D6                		dc.w $70D6
(2)   84/  FF2432 : 70DE                		dc.w $70DE
(2)   85/  FF2434 : 30E6                		dc.w $30E6
(2)   86/  FF2436 : 10EA                		dc.w $10EA
(2)   87/  FF2438 : 00EC                		dc.w $EC
(2)   88/  FF243A : 00ED                		dc.w $ED
(2)   89/  FF243C : 00EE                		dc.w $EE
(2)   90/  FF243E :                     .frame_7:
(2)   91/  FF243E : 0009                		dc.w $9
(2)   92/  FF2440 :                     
(2)   93/  FF2440 : 70EF                		dc.w $70EF
(2)   94/  FF2442 : 30F7                		dc.w $30F7
(2)   95/  FF2444 : 70FB                		dc.w $70FB
(2)   96/  FF2446 : 3103                		dc.w $3103
(2)   97/  FF2448 : 3107                		dc.w $3107
(2)   98/  FF244A : 210B                		dc.w $210B
(2)   99/  FF244C : 110E                		dc.w $110E
(2)  100/  FF244E : 0110                		dc.w $110
(2)  101/  FF2450 : 1111                		dc.w $1111
(2)  102/  FF2452 :                     
(1)  860/  FF2452 :                     		align 2
(1)  861/  FF2452 :                     
(1)  862/  FF2452 :                     ; ====================================================================
(1)  863/  FF2452 :                     ; Report size
(1)  868/  FF2452 :                     
      65/   2FB3A :                     		dephase
      66/   2FB3A :                     
      67/   2FB3A :                     ; ====================================================================
      68/   2FB3A :                     ; ----------------------------------------------------------------
      69/   2FB3A :                     ; 68k DATA BANKs at $900000 1MB max
      70/   2FB3A :                     ; ----------------------------------------------------------------
      71/   2FB3A :                     
      72/   2FB3A :                     	; First one is smaller than the others...
      73/  92FB3A :                     		phase $900000+*				; Only one currently
      74/  92FB3A :                     		include "sound/tracks.asm"
(1)    1/  92FB3A :                     ; ================================================================
(1)    2/  92FB3A :                     ; ------------------------------------------------------------
(1)    3/  92FB3A :                     ; DATA SECTION
(1)    4/  92FB3A :                     ; 
(1)    5/  92FB3A :                     ; SOUND
(1)    6/  92FB3A :                     ; ------------------------------------------------------------
(1)    7/  92FB3A :                     
(1)    8/  92FB3A :                     ; PWM pitches:
(1)    9/  92FB3A :                     ; -17 - 8000
(1)   10/  92FB3A :                     
(1)   11/  92FB3A :                     ; Instrument macros
(1)   12/  92FB3A :                     ; do note that some 24-bit pointers add 90h to the MSB
(1)   13/  92FB3A :                     ;
(1)   14/  92FB3A :                     ; TODO: this might fail to work. if possible use ALL instruments
(1)   15/  92FB3A :                     ; on your tracks
(1)   16/  92FB3A :                     gInsNull macro
(1)   17/  92FB3A :                     	dc.b  -1,$00,$00,$00
(1)   18/  92FB3A :                     	dc.b $00,$00,$00,$00
(1)   19/  92FB3A :                     	endm
(1)   20/  92FB3A :                     
(1)   21/  92FB3A :                     ; alv: attack level (00=high)
(1)   22/  92FB3A :                     ; atk: attack rate
(1)   23/  92FB3A :                     ; slv: sustain (00=high)
(1)   24/  92FB3A :                     ; dky: decay rate (up)
(1)   25/  92FB3A :                     ; rrt: release rate (down)
(1)   26/  92FB3A :                     gInsPsg	macro pitch,alv,atk,slv,dky,rrt
(1)   27/  92FB3A :                     	dc.b $80,pitch,alv,atk
(1)   28/  92FB3A :                     	dc.b slv,dky,rrt,$00
(1)   29/  92FB3A :                     	endm
(1)   30/  92FB3A :                     
(1)   31/  92FB3A :                     ; same arguments as gInsPsg, but for the last one:
(1)   32/  92FB3A :                     ; mode: noise mode %tmm (PSGN only) t-Bass(0)|Noise(1) mm-Clock(0)|Clock/2(1)|Clock/4(2)|Tone3(3)
(1)   33/  92FB3A :                     gInsPsgN macro pitch,alv,atk,slv,dky,rrt,mode
(1)   34/  92FB3A :                     	dc.b $90|mode,pitch,alv,atk
(1)   35/  92FB3A :                     	dc.b slv,dky,rrt,0
(1)   36/  92FB3A :                     	endm
(1)   37/  92FB3A :                     
(1)   38/  92FB3A :                     ; fmins - 24-bit ROM pointer to patch data
(1)   39/  92FB3A :                     ; automaticly sets to the $900000 area
(1)   40/  92FB3A :                     gInsFm macro pitch,fmins
(1)   41/  92FB3A :                     	dc.b $A0,pitch,((fmins>>16)&$FF)|$90,((fmins>>8)&$FF)
(1)   42/  92FB3A :                     	dc.b fmins&$FF,$00,$00,$00
(1)   43/  92FB3A :                     	endm
(1)   44/  92FB3A :                     
(1)   45/  92FB3A :                     ; Same as gInsFm
(1)   46/  92FB3A :                     ; But the last 4 words are manually-set frequencies
(1)   47/  92FB3A :                     ; for each operator in this order: OP1 OP2 OP3 OP4
(1)   48/  92FB3A :                     gInsFm3	macro pitch,fmins
(1)   49/  92FB3A :                     	dc.b $B0,pitch,((fmins>>16)&$FF)|$90,((fmins>>8)&$FF)
(1)   50/  92FB3A :                     	dc.b fmins&$FF,$00,$00,$00
(1)   51/  92FB3A :                     	endm
(1)   52/  92FB3A :                     
(1)   53/  92FB3A :                     ; start: Pointer to sample data:
(1)   54/  92FB3A :                     ;        dc.b end,end,end	; 24-bit LENGTH of the sample
(1)   55/  92FB3A :                     ;        dc.b loop,loop,loop	; 24-bit Loop point
(1)   56/  92FB3A :                     ;        dc.b (sound data)	; Then the actual sound data
(1)   57/  92FB3A :                     ;
(1)   58/  92FB3A :                     ; flags: %0-dont loop, %1-loop
(1)   59/  92FB3A :                     gInsDac	macro pitch,start,flags
(1)   60/  92FB3A :                     	dc.b $C0|flags,pitch,((start>>16)&$FF)|$90,((start>>8)&$FF)
(1)   61/  92FB3A :                     	dc.b start&$FF,0,0,0
(1)   62/  92FB3A :                     	endm
(1)   63/  92FB3A :                     
(1)   64/  92FB3A :                     ; start: Pointer to sample data:
(1)   65/  92FB3A :                     ;        dc.b end,end,end	; 24-bit LENGTH of the sample
(1)   66/  92FB3A :                     ;        dc.b loop,loop,loop	; 24-bit Loop point
(1)   67/  92FB3A :                     ;        dc.b (sound data)	; Then the actual sound data
(1)   68/  92FB3A :                     ;
(1)   69/  92FB3A :                     ; flags: %00SL
(1)   70/  92FB3A :                     ;        L - Loop sample
(1)   71/  92FB3A :                     ;        S - Sample is in stereo
(1)   72/  92FB3A :                     gInsPwm	macro pitch,start,flags
(1)   73/  92FB3A :                     	dc.b $D0|flags,pitch,((start>>24)&$FF),((start>>16)&$FF)
(1)   74/  92FB3A :                     	dc.b ((start>>8)&$FF),start&$FF,0,0
(1)   75/  92FB3A :                     	endm
(1)   76/  92FB3A :                     
(1)   77/  92FB3A :                     ; ------------------------------------------------------------
(1)   78/  92FB3A :                     ; SFX tracks
(1)   79/  92FB3A :                     ; ------------------------------------------------------------
(1)   80/  92FB3A :                     
(1)   81/  92FB3A :                     GemaTrkData_Sfx:
(1)   82/  92FB3A : 0092 FB49           	dc.l GemaSfxPat_Boom
(1)   83/  92FB3E : 0092 FB46           	dc.l GemaSfxBlk_Boom
(1)   84/  92FB42 : 0092 FB9D           	dc.l GemaSfxIns_Boom
(1)   85/  92FB46 :                     GemaSfxBlk_Boom:
(1)   86/  92FB46 :                     	binclude "sound/tracks/sfxpack_blk.bin"
(1)   87/  92FB49 :                     GemaSfxPat_Boom:
(1)   88/  92FB49 :                     	binclude "sound/tracks/sfxpack_patt.bin"
(1)   89/  92FB9D :                     GemaSfxIns_Boom:
(1)   90/  92FB9D : (MACRO)             	gInsFm3 0,FmIns_Fm3_Explosion
(1)   90/  92FB9D : B000 92EE                   dc.b $B0,0,((FMINS_FM3_EXPLOSION>>16)&$FF)|$90,((FMINS_FM3_EXPLOSION>>8)&$FF)
(1)   90/  92FBA1 : E400 0000                   dc.b FMINS_FM3_EXPLOSION&$FF,$00,$00,$00
(1)   91/  92FBA5 : (MACRO)             	gInsPsgN 0,$00,$00,$00,$00,$02,%110
(1)   91/  92FBA5 : 9600 0000                   dc.b $90|%110,0,$00,$00
(1)   91/  92FBA9 : 0000 0200                   dc.b $00,$00,$02,0
(1)   92/  92FBAD : (MACRO)             	gInsFm 0,FmIns_Ding_toy
(1)   92/  92FBAD : A000 92F1                   dc.b $A0,0,((FMINS_DING_TOY>>16)&$FF)|$90,((FMINS_DING_TOY>>8)&$FF)
(1)   92/  92FBB1 : EC00 0000                   dc.b FMINS_DING_TOY&$FF,$00,$00,$00
(1)   93/  92FBB5 :                     
(1)   94/  92FBB5 :                     GemaTrk_blk_BeMine:
(1)   95/  92FBB5 :                     	binclude "sound/tracks/bemine_blk.bin"
(1)   96/  92FBC6 :                     GemaTrk_patt_BeMine:
(1)   97/  92FBC6 :                     	binclude "sound/tracks/bemine_patt.bin"
(1)   98/  930CB8 :                     GemaTrk_ins_BeMine:
(1)   99/  930CB8 : (MACRO)             	gInsPwm -17,SmpIns_Bell_Ice,0
(1)   99/  930CB8 : D0EF 0203                   dc.b $D0|0,-17,((SMPINS_BELL_ICE>>24)&$FF),((SMPINS_BELL_ICE>>16)&$FF)
(1)   99/  930CBC : EC70 0000                   dc.b ((SMPINS_BELL_ICE>>8)&$FF),SMPINS_BELL_ICE&$FF,0,0
(1)  100/  930CC0 : (MACRO)             	gInsPwm -17,SmpIns_Brass1_Hi,%01
(1)  100/  930CC0 : D1EF 0204                   dc.b $D0|%01,-17,((SMPINS_BRASS1_HI>>24)&$FF),((SMPINS_BRASS1_HI>>16)&$FF)
(1)  100/  930CC4 : 279C 0000                   dc.b ((SMPINS_BRASS1_HI>>8)&$FF),SMPINS_BRASS1_HI&$FF,0,0
(1)  101/  930CC8 : (MACRO)             	gInsPwm -17,SmpIns_Brass1_Low,%01
(1)  101/  930CC8 : D1EF 0204                   dc.b $D0|%01,-17,((SMPINS_BRASS1_LOW>>24)&$FF),((SMPINS_BRASS1_LOW>>16)&$FF)
(1)  101/  930CCC : A368 0000                   dc.b ((SMPINS_BRASS1_LOW>>8)&$FF),SMPINS_BRASS1_LOW&$FF,0,0
(1)  102/  930CD0 : (MACRO)             	gInsFm  -24,FmIns_Bass_groove
(1)  102/  930CD0 : A0E8 92F0                   dc.b $A0,-24,((FMINS_BASS_GROOVE>>16)&$FF)|$90,((FMINS_BASS_GROOVE>>8)&$FF)
(1)  102/  930CD4 : 2C00 0000                   dc.b FMINS_BASS_GROOVE&$FF,$00,$00,$00
(1)  103/  930CD8 : (MACRO)             	gInsFm3   0,FmIns_Fm3_OpenHat
(1)  103/  930CD8 : B000 92EE                   dc.b $B0,0,((FMINS_FM3_OPENHAT>>16)&$FF)|$90,((FMINS_FM3_OPENHAT>>8)&$FF)
(1)  103/  930CDC : 9400 0000                   dc.b FMINS_FM3_OPENHAT&$FF,$00,$00,$00
(1)  104/  930CE0 : (MACRO)             	gInsPwm -17,SmpIns_Snare_jam,0
(1)  104/  930CE0 : D0EF 0205                   dc.b $D0|0,-17,((SMPINS_SNARE_JAM>>24)&$FF),((SMPINS_SNARE_JAM>>16)&$FF)
(1)  104/  930CE4 : 72EC 0000                   dc.b ((SMPINS_SNARE_JAM>>8)&$FF),SMPINS_SNARE_JAM&$FF,0,0
(1)  105/  930CE8 : (MACRO)             	gInsPwm -17,SmpIns_Kick_jam,0
(1)  105/  930CE8 : D0EF 0205                   dc.b $D0|0,-17,((SMPINS_KICK_JAM>>24)&$FF),((SMPINS_KICK_JAM>>16)&$FF)
(1)  105/  930CEC : 6820 0000                   dc.b ((SMPINS_KICK_JAM>>8)&$FF),SMPINS_KICK_JAM&$FF,0,0
(1)  106/  930CF0 : (MACRO)             	gInsPwm -17,SmpIns_SnrTom_1,0
(1)  106/  930CF0 : D0EF 0205                   dc.b $D0|0,-17,((SMPINS_SNRTOM_1>>24)&$FF),((SMPINS_SNRTOM_1>>16)&$FF)
(1)  106/  930CF4 : 7C58 0000                   dc.b ((SMPINS_SNRTOM_1>>8)&$FF),SMPINS_SNRTOM_1&$FF,0,0
(1)  107/  930CF8 : (MACRO)             	gInsPwm -17,SmpIns_Forest_1,0
(1)  107/  930CF8 : D0EF 0205                   dc.b $D0|0,-17,((SMPINS_FOREST_1>>24)&$FF),((SMPINS_FOREST_1>>16)&$FF)
(1)  107/  930CFC : 1F34 0000                   dc.b ((SMPINS_FOREST_1>>8)&$FF),SMPINS_FOREST_1&$FF,0,0
(1)  108/  930D00 : (MACRO)             	gInsNull
(1)  108/  930D00 : FF00 0000                   dc.b  -1,$00,$00,$00
(1)  108/  930D04 : 0000 0000                   dc.b $00,$00,$00,$00
(1)  109/  930D08 : (MACRO)             	gInsNull
(1)  109/  930D08 : FF00 0000                   dc.b  -1,$00,$00,$00
(1)  109/  930D0C : 0000 0000                   dc.b $00,$00,$00,$00
(1)  110/  930D10 : (MACRO)             	gInsNull
(1)  110/  930D10 : FF00 0000                   dc.b  -1,$00,$00,$00
(1)  110/  930D14 : 0000 0000                   dc.b $00,$00,$00,$00
(1)  111/  930D18 : (MACRO)             	gInsNull
(1)  111/  930D18 : FF00 0000                   dc.b  -1,$00,$00,$00
(1)  111/  930D1C : 0000 0000                   dc.b $00,$00,$00,$00
(1)  112/  930D20 : (MACRO)             	gInsNull
(1)  112/  930D20 : FF00 0000                   dc.b  -1,$00,$00,$00
(1)  112/  930D24 : 0000 0000                   dc.b $00,$00,$00,$00
(1)  113/  930D28 : (MACRO)             	gInsNull
(1)  113/  930D28 : FF00 0000                   dc.b  -1,$00,$00,$00
(1)  113/  930D2C : 0000 0000                   dc.b $00,$00,$00,$00
(1)  114/  930D30 : (MACRO)             	gInsNull
(1)  114/  930D30 : FF00 0000                   dc.b  -1,$00,$00,$00
(1)  114/  930D34 : 0000 0000                   dc.b $00,$00,$00,$00
(1)  115/  930D38 : (MACRO)             	gInsNull
(1)  115/  930D38 : FF00 0000                   dc.b  -1,$00,$00,$00
(1)  115/  930D3C : 0000 0000                   dc.b $00,$00,$00,$00
(1)  116/  930D40 : (MACRO)             	gInsNull
(1)  116/  930D40 : FF00 0000                   dc.b  -1,$00,$00,$00
(1)  116/  930D44 : 0000 0000                   dc.b $00,$00,$00,$00
(1)  117/  930D48 : (MACRO)             	gInsNull
(1)  117/  930D48 : FF00 0000                   dc.b  -1,$00,$00,$00
(1)  117/  930D4C : 0000 0000                   dc.b $00,$00,$00,$00
(1)  118/  930D50 : (MACRO)             	gInsNull
(1)  118/  930D50 : FF00 0000                   dc.b  -1,$00,$00,$00
(1)  118/  930D54 : 0000 0000                   dc.b $00,$00,$00,$00
(1)  119/  930D58 : (MACRO)             	gInsNull
(1)  119/  930D58 : FF00 0000                   dc.b  -1,$00,$00,$00
(1)  119/  930D5C : 0000 0000                   dc.b $00,$00,$00,$00
(1)  120/  930D60 : (MACRO)             	gInsNull
(1)  120/  930D60 : FF00 0000                   dc.b  -1,$00,$00,$00
(1)  120/  930D64 : 0000 0000                   dc.b $00,$00,$00,$00
(1)  121/  930D68 : (MACRO)             	gInsNull
(1)  121/  930D68 : FF00 0000                   dc.b  -1,$00,$00,$00
(1)  121/  930D6C : 0000 0000                   dc.b $00,$00,$00,$00
(1)  122/  930D70 : (MACRO)             	gInsNull
(1)  122/  930D70 : FF00 0000                   dc.b  -1,$00,$00,$00
(1)  122/  930D74 : 0000 0000                   dc.b $00,$00,$00,$00
(1)  123/  930D78 : (MACRO)             	gInsNull
(1)  123/  930D78 : FF00 0000                   dc.b  -1,$00,$00,$00
(1)  123/  930D7C : 0000 0000                   dc.b $00,$00,$00,$00
(1)  124/  930D80 :                     
(1)  125/  930D80 :                     GemaTrk_blk_HILLS:
(1)  126/  930D80 :                     	binclude "sound/tracks/hill_blk.bin"
(1)  127/  930D8C :                     GemaTrk_patt_HILLS:
(1)  128/  930D8C :                     	binclude "sound/tracks/hill_patt.bin"
(1)  129/  931903 :                     GemaTrk_ins_HILLS:
(1)  130/  931903 : (MACRO)             	gInsPsg +2,$40,$02,$30,$10,$00
(1)  130/  931903 : 8002 4002                   dc.b $80,+2,$40,$02
(1)  130/  931907 : 3010 0000                   dc.b $30,$10,$00,$00
(1)  131/  93190B : (MACRO)             	gInsFm -10,FmIns_Trumpet_1
(1)  131/  93190B : A0F6 92F1                   dc.b $A0,-10,((FMINS_TRUMPET_1>>16)&$FF)|$90,((FMINS_TRUMPET_1>>8)&$FF)
(1)  131/  93190F : 0C00 0000                   dc.b FMINS_TRUMPET_1&$FF,$00,$00,$00
(1)  132/  931913 : (MACRO)             	gInsPsgN 0,$00,$00,$00,$00,$04,%110
(1)  132/  931913 : 9600 0000                   dc.b $90|%110,0,$00,$00
(1)  132/  931917 : 0000 0400                   dc.b $00,$00,$04,0
(1)  133/  93191B : (MACRO)             	gInsDac -3,DacIns_LowString,1;gInsPwm -8,DacIns_LowString,1
(1)  133/  93191B : C1FD 9263                   dc.b $C0|1,-3,((DACINS_LOWSTRING>>16)&$FF)|$90,((DACINS_LOWSTRING>>8)&$FF)
(1)  133/  93191F : 0800 0000                   dc.b DACINS_LOWSTRING&$FF,0,0,0
(1)  134/  931923 : (MACRO)             	gInsFm -8-12,FmIns_Ding_Toy
(1)  134/  931923 : A0EC 92F1                   dc.b $A0,-8-12,((FMINS_DING_TOY>>16)&$FF)|$90,((FMINS_DING_TOY>>8)&$FF)
(1)  134/  931927 : EC00 0000                   dc.b FMINS_DING_TOY&$FF,$00,$00,$00
(1)  135/  93192B : (MACRO)             	gInsFm -25,FmIns_Bass_3
(1)  135/  93192B : A0E7 92F0                   dc.b $A0,-25,((FMINS_BASS_3>>16)&$FF)|$90,((FMINS_BASS_3>>8)&$FF)
(1)  135/  93192F : 0C00 0000                   dc.b FMINS_BASS_3&$FF,$00,$00,$00
(1)  136/  931933 : (MACRO)             	gInsNull
(1)  136/  931933 : FF00 0000                   dc.b  -1,$00,$00,$00
(1)  136/  931937 : 0000 0000                   dc.b $00,$00,$00,$00
(1)  137/  93193B : (MACRO)             	gInsNull
(1)  137/  93193B : FF00 0000                   dc.b  -1,$00,$00,$00
(1)  137/  93193F : 0000 0000                   dc.b $00,$00,$00,$00
(1)  138/  931943 : (MACRO)             	gInsNull
(1)  138/  931943 : FF00 0000                   dc.b  -1,$00,$00,$00
(1)  138/  931947 : 0000 0000                   dc.b $00,$00,$00,$00
(1)  139/  93194B : (MACRO)             	gInsNull
(1)  139/  93194B : FF00 0000                   dc.b  -1,$00,$00,$00
(1)  139/  93194F : 0000 0000                   dc.b $00,$00,$00,$00
(1)  140/  931953 : (MACRO)             	gInsNull
(1)  140/  931953 : FF00 0000                   dc.b  -1,$00,$00,$00
(1)  140/  931957 : 0000 0000                   dc.b $00,$00,$00,$00
(1)  141/  93195B : (MACRO)             	gInsNull
(1)  141/  93195B : FF00 0000                   dc.b  -1,$00,$00,$00
(1)  141/  93195F : 0000 0000                   dc.b $00,$00,$00,$00
(1)  142/  931963 : (MACRO)             	gInsNull
(1)  142/  931963 : FF00 0000                   dc.b  -1,$00,$00,$00
(1)  142/  931967 : 0000 0000                   dc.b $00,$00,$00,$00
(1)  143/  93196B :                     
      75/  93196B :                     		include "data/md_bank0.asm"
(1)    1/  93196B :                     ; ====================================================================
(1)    2/  93196B :                     ; ----------------------------------------------------------------
(1)    3/  93196B :                     ; BANK 0 of 68k data ($900000-$9FFFFF)
(1)    4/  93196B :                     ; for big stuff like maps, levels, etc.
(1)    5/  93196B :                     ;
(1)    6/  93196B :                     ; For the graphics see md_dma.asm
(1)    7/  93196B :                     ;
(1)    8/  93196B :                     ; Maximum size: $0FFFFF bytes per bank
(1)    9/  93196B :                     ; ----------------------------------------------------------------
(1)   10/  93196B :                     
(1)   11/  93196B :                     		align 2
(1)   12/  93196C :                     MAP_FGTEST:	binclude "data/md/bg/fg_map.bin"
(1)   13/  93296C :                     		align 2
(1)   14/  93296C :                     MAP_BGTEST:	binclude "data/md/bg/bg_map.bin"
(1)   15/  93396C :                     		align 2
(1)   16/  93396C :                     
      76/   3396C :                     		dephase
      77/   3396C :                     ; 		org $100000-4				; Fill this bank and
      78/   3396C :                     ; 		dc.b "BNK0"				; add a tag at the end
      79/   3396C :                     
      80/   3396C :                     ; 		phase $900000;+*
      81/   3396C :                     ; 		include "data/md_bank1.asm"
      82/   3396C :                     ; 		dephase
      83/   3396C :                     ; 		org $200000-4
      84/   3396C :                     ; 		dc.b "BNK1"
      85/   3396C :                     
      86/   3396C :                     ; 		phase $900000;+*
      87/   3396C :                     ; 		include "data/md_bank2.asm"
      88/   3396C :                     ; 		dephase
      89/   3396C :                     ; 		org $300000-4
      90/   3396C :                     ; 		dc.b "BNK2"
      91/   3396C :                     
      92/   3396C :                     ; 		phase $900000;+*
      93/   3396C :                     ; 		include "data/md_bank3.asm"
      94/   3396C :                     ; 		dephase
      95/   3396C :                     ; 		org $400000-4
      96/   3396C :                     ; 		dc.b "BNK3"
      97/   3396C :                     
      98/   3396C :                     ; ====================================================================
      99/   3396C :                     ; ----------------------------------------------------------------
     100/   3396C :                     ; MD DMA data, BANK-free but requres RV=1
     101/   3396C :                     ; ----------------------------------------------------------------
     102/   3396C :                     
     103/   3396C :                     		align 4
     104/   3396C :                     		include "data/md_dma.asm"
(1)    1/   3396C :                     ; ====================================================================
(1)    2/   3396C :                     ; ----------------------------------------------------------------
(1)    3/   3396C :                     ; DMA ROM DATA Transfer section
(1)    4/   3396C :                     ; 
(1)    5/   3396C :                     ; RV bit must be enabled to read from here
(1)    6/   3396C :                     ; ----------------------------------------------------------------
(1)    7/   3396C :                     
(1)    8/   3396C :                     		align $8000
(1)    9/   38000 :                     ART_BGTEST:	binclude "data/md/bg/bg_art.bin"
(1)   10/   38540 :                     ART_BGTEST_e:
(1)   11/   38540 :                     ART_FGTEST:	binclude "data/md/bg/fg_art.bin"
(1)   12/   38800 :                     ART_FGTEST_e:
(1)   13/   38800 :                     ART_EMI:	binclude "data/md/sprites/emi_art.bin"
(1)   14/   3AA60 :                     ART_EMI_e:
(1)   15/   3AA60 :                     
(1)   16/   3AA60 :                     
     105/   3AA60 :                     
     106/   3AA60 :                     ; ====================================================================
     107/   3AA60 :                     ; ----------------------------------------------------------------
     108/   3AA60 :                     ; SH2 CODE
     109/   3AA60 :                     ; ----------------------------------------------------------------
     110/   3AA60 :                     
     111/   3AA60 :                     		align 4
     112/   3AA60 :                     MARS_RAMDATA:
     113/   3AA60 :                     		include "system/mars/code.asm"
(1)    1/   3AA60 :                     ; ====================================================================
(1)    2/   3AA60 :                     ; ----------------------------------------------------------------
(1)    3/   3AA60 :                     ; MARS SH2 Section
(1)    4/   3AA60 :                     ;
(1)    5/   3AA60 :                     ; CODE for both CPUs
(1)    6/   3AA60 :                     ; RAM and some DATA go here
(1)    7/   3AA60 :                     ; ----------------------------------------------------------------
(1)    8/   3AA60 :                     
(1)    9/ 6000000 :                     		phase CS3		; now we are at SDRAM
(1)   10/ 6000000 :                     		cpu SH7600		; should be SH7095 but this works.
(1)   11/ 6000000 :                     
(1)   12/ 6000000 :                     ; ====================================================================
(1)   13/ 6000000 :                     ; ----------------------------------------------------------------
(1)   14/ 6000000 :                     ; User settings
(1)   15/ 6000000 :                     ; ----------------------------------------------------------------
(1)   16/ 6000000 :                     
(1)   17/ 6000000 :                     ; Third scrolling layer settings:
(1)   18/ 6000000 :                     ;
(1)   19/ 6000000 :                     ; Do note that drawing the new sections takes TWO frames
(1)   20/ 6000000 :                     
(1)   21/ 6000000 :                     ; The maximum moving speed is divided by 2 depending of
(1)   22/ 6000000 :                     ; the BLKSIZE setting. (BLKSIZE/2)
(1)   23/ 6000000 :                     ;
(1)   24/ 6000000 :                     ; Map data can be either ROM data or a RAM section,
(1)   25/ 6000000 :                     ; Background's WIDTH and HEIGHT are defined by gbr variables (BgWidth and BgHeight)
(1)   26/ 6000000 :                     ; but the sizes must be aligned by the same value as BLKSIZE
(1)   27/ 6000000 :                     ;
(1)   28/ 6000000 :                     ; ROM data will be trashed if the Genesis side is doing DMA
(1)   29/ 6000000 :                     
(1)   30/ 6000000 : =$10                MSCRL_BLKSIZE		equ $10		; Block size for both directions, aligned by 4
(1)   31/ 6000000 : =$150               MSCRL_WIDTH		equ 320+$10	; Internal width for scrolldata
(1)   32/ 6000000 : =$100               MSCRL_HEIGHT		equ 240+$10	; Internal height for scrolldata
(1)   33/ 6000000 :                     
(1)   34/ 6000000 :                     ; ----------------------------------------
(1)   35/ 6000000 :                     ; Polygon settings
(1)   36/ 6000000 :                     ; (can manipulate 3 or 4 points)
(1)   37/ 6000000 :                     ; ----------------------------------------
(1)   38/ 6000000 :                     
(1)   39/ 6000000 :                     ; MAX_MPLGN	equ	128		; Maximum polygon faces to store on buffer(s)
(1)   40/ 6000000 :                     ; MAX_SVDP_PZ	equ	128+64		; Polygon pieces r/w list, loops
(1)   41/ 6000000 :                     ; MAX_MODELS	equ	24		; Note: First 9 models are reserved for layout map
(1)   42/ 6000000 :                     ; MAX_ZDIST	equ	-$2400		; Max drawing distance (-Z max)
(1)   43/ 6000000 :                     ; LAY_WIDTH	equ	$20*2		; Layout data width * 2
(1)   44/ 6000000 :                     
(1)   45/ 6000000 :                     ; ----------------------------------------
(1)   46/ 6000000 :                     ; Normal sprite settings
(1)   47/ 6000000 :                     ; ----------------------------------------
(1)   48/ 6000000 :                     
(1)   49/ 6000000 : =$80                MAX_MSPR	equ	128		; Maximum sprites
(1)   50/ 6000000 :                     
(1)   51/ 6000000 :                     ; ====================================================================
(1)   52/ 6000000 :                     ; ----------------------------------------------------------------
(1)   53/ 6000000 :                     ; MARS GBR variables for both SH2
(1)   54/ 6000000 :                     ; ----------------------------------------------------------------
(1)   55/ 6000000 :                     
(1)   56/ 6000000 : (MACRO)             			struct 0
(1)   56/ 6000000 : =$6000000           GLBL_LASTPC     set *
(1)   56/   3AA60 :                                     dephase
(1)   56/   3AA60 : =$3AA60             GLBL_LASTORG    set *
(1)   56/       0 :                                     phase 0
(1)   57/       0 :                     marsGbl_XShift		ds.w 1		; Xshift bit set at the start of master_loop
(1)   58/       2 :                     marsGbl_MstrReqDraw	ds.w 1
(1)   59/       4 :                     marsGbl_CurrGfxMode	ds.w 1
(1)   60/       6 :                     marsGbl_VIntFlag_M	ds.w 1		; Sets to 0 after Masters's VBlank ends
(1)   61/       8 :                     marsGbl_VIntFlag_S	ds.w 1		; Sets to 0 after Slave's VBlank ends
(1)   62/       A :                     marsGbl_CurrFb		ds.w 1		; Current framebuffer number (byte)
(1)   63/       C :                     marsGbl_PalDmaMidWr	ds.w 1		; Flag to tell we are in middle of transfering palette
(1)   64/       E :                     ; marsGbl_FbMaxLines	ds.w 1		; Max lines to output to screen (MAX: 240 lines)
(1)   65/       E :                     marsGbl_PwmCtrlUpd	ds.w 1		; Flag to update Pwm tracker channels
(1)   66/      10 :                     sizeof_MarsGbl		ds.l 0
(1)   67/      10 : (MACRO)             			finish
(1)   67/       0 :                                     !org GLBL_LASTORG
(1)   67/ 6000000 :                                     phase GLBL_LASTPC
(1)   68/ 6000000 :                     
(1)   69/ 6000000 :                     ; ====================================================================
(1)   70/ 6000000 :                     ; ----------------------------------------------------------------
(1)   71/ 6000000 :                     ; MASTER CPU VECTOR LIST (vbr)
(1)   72/ 6000000 :                     ; ----------------------------------------------------------------
(1)   73/ 6000000 :                     
(1)   74/ 6000000 :                     		align 4
(1)   75/ 6000000 :                     SH2_Master:
(1)   76/ 6000000 : 0600 0DA4 0604 0000 		dc.l SH2_M_Entry,CS3|$40000	; Power PC, Stack
(1)   77/ 6000008 : 0600 0DA4 0604 0000 		dc.l SH2_M_Entry,CS3|$40000	; Reset PC, Stack
(1)   78/ 6000010 :                     
(1)   79/ 6000010 : 0600 030C           		dc.l SH2_Error			; Illegal instruction
(1)   80/ 6000014 : 0000 0000           		dc.l 0				; reserved
(1)   81/ 6000018 : 0600 030C           		dc.l SH2_Error			; Invalid slot instruction
(1)   82/ 600001C : 2010 0400           		dc.l $20100400			; reserved
(1)   83/ 6000020 : 2010 0420           		dc.l $20100420			; reserved
(1)   84/ 6000024 : 0600 030C           		dc.l SH2_Error			; CPU address error
(1)   85/ 6000028 : 0600 030C           		dc.l SH2_Error			; DMA address error
(1)   86/ 600002C : 0600 030C           		dc.l SH2_Error			; NMI vector
(1)   87/ 6000030 : 0600 030C           		dc.l SH2_Error			; User break vector
(1)   88/ 6000034 :                     
(1)   89/ 6000034 : 0000 0000 0000 0000 		dc.l 0,0,0,0,0,0,0,0,0,0	; reserved
                    0000 0000 0000 0000 
                    0000 0000 0000 0000 
                    0000 0000 0000 0000 
                    0000 0000 0000 0000 
(1)   90/ 600005C : 0000 0000 0000 0000 		dc.l 0,0,0,0,0,0,0,0,0
                    0000 0000 0000 0000 
                    0000 0000 0000 0000 
                    0000 0000 0000 0000 
                    0000 0000           
(1)   91/ 6000080 :                     
(1)   92/ 6000080 : 0600 030C           		dc.l SH2_Error			; Trap user vectors
(1)   93/ 6000084 : 0600 030C           		dc.l SH2_Error
(1)   94/ 6000088 : 0600 030C           		dc.l SH2_Error
(1)   95/ 600008C : 0600 030C           		dc.l SH2_Error
(1)   96/ 6000090 : 0600 030C           		dc.l SH2_Error
(1)   97/ 6000094 : 0600 030C           		dc.l SH2_Error
(1)   98/ 6000098 : 0600 030C           		dc.l SH2_Error
(1)   99/ 600009C : 0600 030C           		dc.l SH2_Error
(1)  100/ 60000A0 : 0600 030C           		dc.l SH2_Error
(1)  101/ 60000A4 : 0600 030C           		dc.l SH2_Error
(1)  102/ 60000A8 : 0600 030C           		dc.l SH2_Error
(1)  103/ 60000AC : 0600 030C           		dc.l SH2_Error
(1)  104/ 60000B0 : 0600 030C           		dc.l SH2_Error
(1)  105/ 60000B4 : 0600 030C           		dc.l SH2_Error
(1)  106/ 60000B8 : 0600 030C           		dc.l SH2_Error
(1)  107/ 60000BC : 0600 030C           		dc.l SH2_Error
(1)  108/ 60000C0 : 0600 030C           		dc.l SH2_Error
(1)  109/ 60000C4 : 0600 030C           		dc.l SH2_Error
(1)  110/ 60000C8 : 0600 030C           		dc.l SH2_Error
(1)  111/ 60000CC : 0600 030C           		dc.l SH2_Error
(1)  112/ 60000D0 : 0600 030C           		dc.l SH2_Error
(1)  113/ 60000D4 : 0600 030C           		dc.l SH2_Error
(1)  114/ 60000D8 : 0600 030C           		dc.l SH2_Error
(1)  115/ 60000DC : 0600 030C           		dc.l SH2_Error
(1)  116/ 60000E0 : 0600 030C           		dc.l SH2_Error
(1)  117/ 60000E4 : 0600 030C           		dc.l SH2_Error
(1)  118/ 60000E8 : 0600 030C           		dc.l SH2_Error
(1)  119/ 60000EC : 0600 030C           		dc.l SH2_Error
(1)  120/ 60000F0 : 0600 030C           		dc.l SH2_Error
(1)  121/ 60000F4 : 0600 030C           		dc.l SH2_Error
(1)  122/ 60000F8 : 0600 030C           		dc.l SH2_Error
(1)  123/ 60000FC : 0600 030C           		dc.l SH2_Error
(1)  124/ 6000100 : 0600 0248            		dc.l master_irq			; Level 1 IRQ
(1)  125/ 6000104 : 0600 0248           		dc.l master_irq			; Level 2 & 3 IRQ
(1)  126/ 6000108 : 0600 0248           		dc.l master_irq			; Level 4 & 5 IRQ
(1)  127/ 600010C : 0600 0248           		dc.l master_irq			; Level 6 & 7 IRQ: PWM interupt
(1)  128/ 6000110 : 0600 0248           		dc.l master_irq			; Level 8 & 9 IRQ: Command interupt
(1)  129/ 6000114 : 0600 0248           		dc.l master_irq			; Level 10 & 11 IRQ: H Blank interupt
(1)  130/ 6000118 : 0600 0248           		dc.l master_irq			; Level 12 & 13 IRQ: V Blank interupt
(1)  131/ 600011C : 0600 0248           		dc.l master_irq			; Level 14 & 15 IRQ: Reset Button
(1)  132/ 6000120 :                     
(1)  133/ 6000120 :                     	; ON-chip interrupts go here (vbr+$120)
(1)  134/ 6000120 : 0600 0248           		dc.l master_irq			; Watchdog (custom)
(1)  135/ 6000124 :                     
(1)  136/ 6000124 :                     ; ====================================================================
(1)  137/ 6000124 :                     ; ----------------------------------------------------------------
(1)  138/ 6000124 :                     ; SLAVE CPU VECTOR LIST (vbr)
(1)  139/ 6000124 :                     ; ----------------------------------------------------------------
(1)  140/ 6000124 :                     
(1)  141/ 6000124 :                     		align 4
(1)  142/ 6000124 :                     SH2_Slave:
(1)  143/ 6000124 : 0600 0F68 0603 F000 		dc.l SH2_S_Entry,CS3|$3F000	; Cold PC,SP
(1)  144/ 600012C : 0600 0F68 0603 F000 		dc.l SH2_S_Entry,CS3|$3F000	; Manual PC,SP
(1)  145/ 6000134 :                     
(1)  146/ 6000134 : 0600 030C           		dc.l SH2_Error			; Illegal instruction
(1)  147/ 6000138 : 0000 0000           		dc.l 0				; reserved
(1)  148/ 600013C : 0600 030C           		dc.l SH2_Error			; Invalid slot instruction
(1)  149/ 6000140 : 2010 0400           		dc.l $20100400			; reserved
(1)  150/ 6000144 : 2010 0420           		dc.l $20100420			; reserved
(1)  151/ 6000148 : 0600 030C           		dc.l SH2_Error			; CPU address error
(1)  152/ 600014C : 0600 030C           		dc.l SH2_Error			; DMA address error
(1)  153/ 6000150 : 0600 030C           		dc.l SH2_Error			; NMI vector
(1)  154/ 6000154 : 0600 030C           		dc.l SH2_Error			; User break vector
(1)  155/ 6000158 :                     
(1)  156/ 6000158 : 0000 0000 0000 0000 		dc.l 0,0,0,0,0,0,0,0,0,0	; reserved
                    0000 0000 0000 0000 
                    0000 0000 0000 0000 
                    0000 0000 0000 0000 
                    0000 0000 0000 0000 
(1)  157/ 6000180 : 0000 0000 0000 0000 		dc.l 0,0,0,0,0,0,0,0,0
                    0000 0000 0000 0000 
                    0000 0000 0000 0000 
                    0000 0000 0000 0000 
                    0000 0000           
(1)  158/ 60001A4 :                     
(1)  159/ 60001A4 : 0600 030C           		dc.l SH2_Error			; Trap user vectors
(1)  160/ 60001A8 : 0600 030C           		dc.l SH2_Error
(1)  161/ 60001AC : 0600 030C           		dc.l SH2_Error
(1)  162/ 60001B0 : 0600 030C           		dc.l SH2_Error
(1)  163/ 60001B4 : 0600 030C           		dc.l SH2_Error
(1)  164/ 60001B8 : 0600 030C           		dc.l SH2_Error
(1)  165/ 60001BC : 0600 030C           		dc.l SH2_Error
(1)  166/ 60001C0 : 0600 030C           		dc.l SH2_Error
(1)  167/ 60001C4 : 0600 030C           		dc.l SH2_Error
(1)  168/ 60001C8 : 0600 030C           		dc.l SH2_Error
(1)  169/ 60001CC : 0600 030C           		dc.l SH2_Error
(1)  170/ 60001D0 : 0600 030C           		dc.l SH2_Error
(1)  171/ 60001D4 : 0600 030C           		dc.l SH2_Error
(1)  172/ 60001D8 : 0600 030C           		dc.l SH2_Error
(1)  173/ 60001DC : 0600 030C           		dc.l SH2_Error
(1)  174/ 60001E0 : 0600 030C           		dc.l SH2_Error
(1)  175/ 60001E4 : 0600 030C           		dc.l SH2_Error
(1)  176/ 60001E8 : 0600 030C           		dc.l SH2_Error
(1)  177/ 60001EC : 0600 030C           		dc.l SH2_Error
(1)  178/ 60001F0 : 0600 030C           		dc.l SH2_Error
(1)  179/ 60001F4 : 0600 030C           		dc.l SH2_Error
(1)  180/ 60001F8 : 0600 030C           		dc.l SH2_Error
(1)  181/ 60001FC : 0600 030C           		dc.l SH2_Error
(1)  182/ 6000200 : 0600 030C           		dc.l SH2_Error
(1)  183/ 6000204 : 0600 030C           		dc.l SH2_Error
(1)  184/ 6000208 : 0600 030C           		dc.l SH2_Error
(1)  185/ 600020C : 0600 030C           		dc.l SH2_Error
(1)  186/ 6000210 : 0600 030C           		dc.l SH2_Error
(1)  187/ 6000214 : 0600 030C           		dc.l SH2_Error
(1)  188/ 6000218 : 0600 030C           		dc.l SH2_Error
(1)  189/ 600021C : 0600 030C           		dc.l SH2_Error
(1)  190/ 6000220 : 0600 030C           		dc.l SH2_Error
(1)  191/ 6000224 : 0600 02AC            		dc.l slave_irq			; Level 1 IRQ
(1)  192/ 6000228 : 0600 02AC           		dc.l slave_irq			; Level 2 & 3 IRQ
(1)  193/ 600022C : 0600 02AC           		dc.l slave_irq			; Level 4 & 5 IRQ
(1)  194/ 6000230 : 0600 02AC           		dc.l slave_irq			; Level 6 & 7 IRQ: PWM interupt
(1)  195/ 6000234 : 0600 02AC           		dc.l slave_irq			; Level 8 & 9 IRQ: Command interupt
(1)  196/ 6000238 : 0600 02AC           		dc.l slave_irq			; Level 10 & 11 IRQ: H Blank interupt
(1)  197/ 600023C : 0600 02AC           		dc.l slave_irq			; Level 12 & 13 IRQ: V Blank interupt
(1)  198/ 6000240 : 0600 02AC           		dc.l slave_irq			; Level 14 & 15 IRQ: Reset Button
(1)  199/ 6000244 :                     
(1)  200/ 6000244 :                     	; ON-chip interrupts go here (vbr+$120)
(1)  201/ 6000244 : 0600 02AC           		dc.l slave_irq			; Watchdog (custom)
(1)  202/ 6000248 :                     
(1)  203/ 6000248 :                     ; ====================================================================
(1)  204/ 6000248 :                     ; ----------------------------------------------------------------
(1)  205/ 6000248 :                     ; irq
(1)  206/ 6000248 :                     ;
(1)  207/ 6000248 :                     ; r0-r1 are safe
(1)  208/ 6000248 :                     ; ----------------------------------------------------------------
(1)  209/ 6000248 :                     
(1)  210/ 6000248 :                     		align 4
(1)  211/ 6000248 :                     master_irq:
(1)  212/ 6000248 : 2F06                		mov.l	r0,@-r15
(1)  213/ 600024A : 2F16                		mov.l	r1,@-r15
(1)  214/ 600024C : 4F22                		sts.l	pr,@-r15
(1)  215/ 600024E :                     
(1)  216/ 600024E : 0002                		stc	sr,r0
(1)  217/ 6000250 : 4009                		shlr2	r0
(1)  218/ 6000252 : C93C                		and	#$3C,r0
(1)  219/ 6000254 : D104                		mov	#int_m_list,r1
(1)  220/ 6000256 : 301C                		add	r1,r0
(1)  221/ 6000258 : 6102                		mov	@r0,r1
(1)  222/ 600025A : 410B                		jsr	@r1
(1)  223/ 600025C : 0009                		nop
(1)  224/ 600025E :                     
(1)  225/ 600025E : 4F26                		lds.l	@r15+,pr
(1)  226/ 6000260 : 61F6                		mov.l	@r15+,r1
(1)  227/ 6000262 : 60F6                		mov.l	@r15+,r0
(1)  228/ 6000264 : 002B                		rte
(1)  229/ 6000266 : 0009                		nop
(1)  230/ 6000268 :                     		align 4
(1)  231/ 6000268 : 0600 026C           		ltorg
(1)  232/ 600026C :                     
(1)  233/ 600026C :                     ; ------------------------------------------------
(1)  234/ 600026C :                     ; irq list
(1)  235/ 600026C :                     ; ------------------------------------------------
(1)  236/ 600026C :                     
(1)  237/ 600026C :                     		align 4
(1)  238/ 600026C :                     int_m_list:
(1)  239/ 600026C : 0600 0318 0600 0318 		dc.l m_irq_bad,m_irq_bad
(1)  240/ 6000274 : 0600 0318 0600 0318 		dc.l m_irq_bad,m_irq_bad
(1)  241/ 600027C : 0600 0318 C000 0000 		dc.l m_irq_bad,m_irq_custom
(1)  242/ 6000284 : 0600 031C 0600 031C 		dc.l m_irq_pwm,m_irq_pwm
(1)  243/ 600028C : 0600 0338 0600 0338 		dc.l m_irq_cmd,m_irq_cmd
(1)  244/ 6000294 : 0600 0368 0600 0368 		dc.l m_irq_h,m_irq_h
(1)  245/ 600029C : 0600 0384 0600 0384 		dc.l m_irq_v,m_irq_v
(1)  246/ 60002A4 : 0600 044C 0600 044C 		dc.l m_irq_vres,m_irq_vres
(1)  247/ 60002AC :                     
(1)  248/ 60002AC :                     ; ====================================================================
(1)  249/ 60002AC :                     ; ----------------------------------------------------------------
(1)  250/ 60002AC :                     ; irq
(1)  251/ 60002AC :                     ;
(1)  252/ 60002AC :                     ; r0-r1 are safe
(1)  253/ 60002AC :                     ; ----------------------------------------------------------------
(1)  254/ 60002AC :                     
(1)  255/ 60002AC :                     slave_irq:
(1)  256/ 60002AC : 2F06                		mov.l	r0,@-r15
(1)  257/ 60002AE : 2F16                		mov.l	r1,@-r15
(1)  258/ 60002B0 : 4F22                		sts.l	pr,@-r15
(1)  259/ 60002B2 :                     
(1)  260/ 60002B2 : 0002                		stc	sr,r0
(1)  261/ 60002B4 : 4009                		shlr2	r0
(1)  262/ 60002B6 : C93C                		and	#$3C,r0
(1)  263/ 60002B8 : D126                		mov	#int_s_list,r1
(1)  264/ 60002BA : 301C                		add	r1,r0
(1)  265/ 60002BC : 6102                		mov	@r0,r1
(1)  266/ 60002BE : 410B                		jsr	@r1
(1)  267/ 60002C0 : 0009                		nop
(1)  268/ 60002C2 :                     
(1)  269/ 60002C2 : 4F26                		lds.l	@r15+,pr
(1)  270/ 60002C4 : 61F6                		mov.l	@r15+,r1
(1)  271/ 60002C6 : 60F6                		mov.l	@r15+,r0
(1)  272/ 60002C8 : 002B                		rte
(1)  273/ 60002CA : 0009                		nop
(1)  274/ 60002CC :                     		align 4
(1)  275/ 60002CC :                     
(1)  276/ 60002CC :                     ; ------------------------------------------------
(1)  277/ 60002CC :                     ; irq list
(1)  278/ 60002CC :                     ; ------------------------------------------------
(1)  279/ 60002CC :                     
(1)  280/ 60002CC :                     int_s_list:
(1)  281/ 60002CC : 0600 04CE 0600 04CE 		dc.l s_irq_bad,s_irq_bad
(1)  282/ 60002D4 : 0600 04CE 0600 04CE 		dc.l s_irq_bad,s_irq_bad
(1)  283/ 60002DC : 0600 04CE 0600 1254 		dc.l s_irq_bad,s_irq_custom
(1)  284/ 60002E4 : 0600 04D4 0600 04D4 		dc.l s_irq_pwm,s_irq_pwm
(1)  285/ 60002EC : 0600 04F8 0600 04F8 		dc.l s_irq_cmd,s_irq_cmd
(1)  286/ 60002F4 : 0600 0542 0600 0542 		dc.l s_irq_h,s_irq_h
(1)  287/ 60002FC : 0600 055C 0600 055C 		dc.l s_irq_v,s_irq_v
(1)  288/ 6000304 : 0600 0570 0600 0570 		dc.l s_irq_vres,s_irq_vres
(1)  289/ 600030C :                     
(1)  290/ 600030C :                     ; ====================================================================
(1)  291/ 600030C :                     ; ----------------------------------------------------------------
(1)  292/ 600030C :                     ; Noraml error trap
(1)  293/ 600030C :                     ; ----------------------------------------------------------------
(1)  294/ 600030C :                     
(1)  295/ 600030C :                     SH2_Error:
(1)  296/ 600030C : D112                		mov	#_sysreg+comm14,r1
(1)  297/ 600030E : 9029                		mov	#$1234,r0
(1)  298/ 6000310 : 2101                		mov.w	r0,@r1
(1)  299/ 6000312 :                     
(1)  300/ 6000312 : 0009                .infin:		nop
(1)  301/ 6000314 : AFFD                		bra	.infin
(1)  302/ 6000316 : 0009                		nop
(1)  303/ 6000318 :                     		align 4
(1)  304/ 6000318 :                     
(1)  305/ 6000318 :                     ; ====================================================================
(1)  306/ 6000318 :                     ; ----------------------------------------------------------------
(1)  307/ 6000318 :                     ; MARS Interrupts
(1)  308/ 6000318 :                     ; ----------------------------------------------------------------
(1)  309/ 6000318 :                     
(1)  310/ 6000318 :                     ; =================================================================
(1)  311/ 6000318 :                     ; ------------------------------------------------
(1)  312/ 6000318 :                     ; Master | Unused interrupt
(1)  313/ 6000318 :                     ; ------------------------------------------------
(1)  314/ 6000318 :                     
(1)  315/ 6000318 :                     m_irq_bad:
(1)  316/ 6000318 : 000B                		rts
(1)  317/ 600031A : 0009                		nop
(1)  318/ 600031C :                     		align 4
(1)  319/ 600031C :                     
(1)  320/ 600031C :                     ; =================================================================
(1)  321/ 600031C :                     ; ------------------------------------------------
(1)  322/ 600031C :                     ; Master | PWM Interrupt
(1)  323/ 600031C :                     ; ------------------------------------------------
(1)  324/ 600031C :                     
(1)  325/ 600031C :                     m_irq_pwm:
(1)  326/ 600031C : 9123                		mov	#_FRT,r1
(1)  327/ 600031E : 8417                		mov.b	@(7,r1),r0
(1)  328/ 6000320 : CA02                		xor	#2,r0
(1)  329/ 6000322 : 8017                		mov.b	r0,@(7,r1)
(1)  330/ 6000324 : D10D                		mov	#_sysreg+pwmintclr,r1
(1)  331/ 6000326 : 2101                		mov.w	r0,@r1
(1)  332/ 6000328 : 0009                		nop
(1)  333/ 600032A : 0009                		nop
(1)  334/ 600032C : 0009                		nop
(1)  335/ 600032E : 0009                		nop
(1)  336/ 6000330 : 0009                		nop
(1)  337/ 6000332 : 000B                		rts
(1)  338/ 6000334 : 0009                		nop
(1)  339/ 6000336 :                     		align 4
(1)  340/ 6000338 :                     
(1)  341/ 6000338 :                     ; =================================================================
(1)  342/ 6000338 :                     ; ------------------------------------------------
(1)  343/ 6000338 :                     ; Master | CMD Interrupt
(1)  344/ 6000338 :                     ; ------------------------------------------------
(1)  345/ 6000338 :                     
(1)  346/ 6000338 :                     m_irq_cmd:
(1)  347/ 6000338 : 9115                		mov	#_FRT,r1
(1)  348/ 600033A : 8417                		mov.b	@(7,r1),r0
(1)  349/ 600033C : CA02                		xor	#2,r0
(1)  350/ 600033E : 8017                		mov.b	r0,@(7,r1)
(1)  351/ 6000340 : D107                		mov	#_sysreg+cmdintclr,r1
(1)  352/ 6000342 : 2101                		mov.w	r0,@r1
(1)  353/ 6000344 : 0009                		nop
(1)  354/ 6000346 : 0009                		nop
(1)  355/ 6000348 : 0009                		nop
(1)  356/ 600034A : 0009                		nop
(1)  357/ 600034C : 0009                		nop
(1)  358/ 600034E : 000B                		rts
(1)  359/ 6000350 : 0009                		nop
(1)  360/ 6000352 :                     		align 4
(1)  361/ 6000354 : 0600 02CC 2000 402E 		ltorg
                    2000 401C 2000 401A 
                    1234 FE10           
(1)  362/ 6000368 :                     
(1)  363/ 6000368 :                     ; =================================================================
(1)  364/ 6000368 :                     ; ------------------------------------------------
(1)  365/ 6000368 :                     ; Master | HBlank
(1)  366/ 6000368 :                     ; ------------------------------------------------
(1)  367/ 6000368 :                     
(1)  368/ 6000368 :                     m_irq_h:
(1)  369/ 6000368 : 916E                		mov	#_FRT,r1
(1)  370/ 600036A : 8417                		mov.b	@(7,r1),r0
(1)  371/ 600036C : CA02                		xor	#2,r0
(1)  372/ 600036E : 8017                		mov.b	r0,@(7,r1)
(1)  373/ 6000370 : D130                		mov	#_sysreg+hintclr,r1
(1)  374/ 6000372 : 2101                		mov.w	r0,@r1
(1)  375/ 6000374 : 0009                		nop
(1)  376/ 6000376 : 0009                		nop
(1)  377/ 6000378 : 0009                		nop
(1)  378/ 600037A : 0009                		nop
(1)  379/ 600037C : 0009                		nop
(1)  380/ 600037E : 000B                		rts
(1)  381/ 6000380 : 0009                		nop
(1)  382/ 6000382 :                     		align 4
(1)  383/ 6000384 :                     
(1)  384/ 6000384 :                     ; =================================================================
(1)  385/ 6000384 :                     ; ------------------------------------------------
(1)  386/ 6000384 :                     ; Master | VBlank
(1)  387/ 6000384 :                     ; ------------------------------------------------
(1)  388/ 6000384 :                     
(1)  389/ 6000384 :                     m_irq_v:
(1)  390/ 6000384 : 9160                		mov	#_FRT,r1
(1)  391/ 6000386 : 8417                		mov.b	@(7,r1),r0
(1)  392/ 6000388 : CA02                		xor	#2,r0
(1)  393/ 600038A : 8017                		mov.b	r0,@(7,r1)
(1)  394/ 600038C : D12A                		mov	#_sysreg+vintclr,r1
(1)  395/ 600038E : 2101                		mov.w	r0,@r1
(1)  396/ 6000390 :                     
(1)  397/ 6000390 : D12A                		mov	#_vdpreg,r1		; Wait for palette access
(1)  398/ 6000392 : 8515                .wait_fb:	mov.w	@(vdpsts,r1),r0		; Read status as WORD
(1)  399/ 6000394 : C802                		tst	#2,r0			; Framebuffer busy? (wait for FEN=1)
(1)  400/ 6000396 : 8BFC                		bf	.wait_fb
(1)  401/ 6000398 : 841A                .wait		mov.b	@(vdpsts,r1),r0		; Now read as a BYTE
(1)  402/ 600039A : C820                		tst	#$20,r0			; Palette unlocked? (wait for PEN=0)
(1)  403/ 600039C : 89FC                		bt	.wait
(1)  404/ 600039E : 4F03                		stc	sr,@-r15
(1)  405/ 60003A0 : 2F26                		mov	r2,@-r15
(1)  406/ 60003A2 : 2F36                		mov	r3,@-r15
(1)  407/ 60003A4 : 2F46                		mov	r4,@-r15
(1)  408/ 60003A6 : 2F56                		mov	r5,@-r15
(1)  409/ 60003A8 : 4F12                		sts	macl,@-r15
(1)  410/ 60003AA : 904E                		mov	#$F0,r0			; Disable interrupts
(1)  411/ 60003AC : 400E                		ldc	r0,sr
(1)  412/ 60003AE :                     
(1)  413/ 60003AE :                     	; Copy palette manually to SuperVDP
(1)  414/ 60003AE : E001                		mov	#1,r0
(1)  415/ 60003B0 : C106                		mov.w	r0,@(marsGbl_PalDmaMidWr,gbr)
(1)  416/ 60003B2 : D123                		mov	#RAM_Mars_Palette,r1
(1)  417/ 60003B4 : D223                		mov	#_palette,r2
(1)  418/ 60003B6 : E310                 		mov	#256/16,r3
(1)  419/ 60003B8 :                     .copy_pal:
(1)  420/ 60003B8 :                     	rept 16
(1)  421/ 60003B8 :                     		mov.w	@r1+,r0
(1)  422/ 60003B8 :                     		mov.w	r0,@r2
(1)  423/ 60003B8 :                     		add	#2,r2
(1)  424/ 60003B8 :                     	endm
(1)  421/ 60003B8 : 6015                		mov.w	@r1+,r0
(1)  422/ 60003BA : 2201                		mov.w	r0,@r2
(1)  423/ 60003BC : 7202                		add	#2,r2
(1)  421/ 60003BE : 6015                		mov.w	@r1+,r0
(1)  422/ 60003C0 : 2201                		mov.w	r0,@r2
(1)  423/ 60003C2 : 7202                		add	#2,r2
(1)  421/ 60003C4 : 6015                		mov.w	@r1+,r0
(1)  422/ 60003C6 : 2201                		mov.w	r0,@r2
(1)  423/ 60003C8 : 7202                		add	#2,r2
(1)  421/ 60003CA : 6015                		mov.w	@r1+,r0
(1)  422/ 60003CC : 2201                		mov.w	r0,@r2
(1)  423/ 60003CE : 7202                		add	#2,r2
(1)  421/ 60003D0 : 6015                		mov.w	@r1+,r0
(1)  422/ 60003D2 : 2201                		mov.w	r0,@r2
(1)  423/ 60003D4 : 7202                		add	#2,r2
(1)  421/ 60003D6 : 6015                		mov.w	@r1+,r0
(1)  422/ 60003D8 : 2201                		mov.w	r0,@r2
(1)  423/ 60003DA : 7202                		add	#2,r2
(1)  421/ 60003DC : 6015                		mov.w	@r1+,r0
(1)  422/ 60003DE : 2201                		mov.w	r0,@r2
(1)  423/ 60003E0 : 7202                		add	#2,r2
(1)  421/ 60003E2 : 6015                		mov.w	@r1+,r0
(1)  422/ 60003E4 : 2201                		mov.w	r0,@r2
(1)  423/ 60003E6 : 7202                		add	#2,r2
(1)  421/ 60003E8 : 6015                		mov.w	@r1+,r0
(1)  422/ 60003EA : 2201                		mov.w	r0,@r2
(1)  423/ 60003EC : 7202                		add	#2,r2
(1)  421/ 60003EE : 6015                		mov.w	@r1+,r0
(1)  422/ 60003F0 : 2201                		mov.w	r0,@r2
(1)  423/ 60003F2 : 7202                		add	#2,r2
(1)  421/ 60003F4 : 6015                		mov.w	@r1+,r0
(1)  422/ 60003F6 : 2201                		mov.w	r0,@r2
(1)  423/ 60003F8 : 7202                		add	#2,r2
(1)  421/ 60003FA : 6015                		mov.w	@r1+,r0
(1)  422/ 60003FC : 2201                		mov.w	r0,@r2
(1)  423/ 60003FE : 7202                		add	#2,r2
(1)  421/ 6000400 : 6015                		mov.w	@r1+,r0
(1)  422/ 6000402 : 2201                		mov.w	r0,@r2
(1)  423/ 6000404 : 7202                		add	#2,r2
(1)  421/ 6000406 : 6015                		mov.w	@r1+,r0
(1)  422/ 6000408 : 2201                		mov.w	r0,@r2
(1)  423/ 600040A : 7202                		add	#2,r2
(1)  421/ 600040C : 6015                		mov.w	@r1+,r0
(1)  422/ 600040E : 2201                		mov.w	r0,@r2
(1)  423/ 6000410 : 7202                		add	#2,r2
(1)  421/ 6000412 : 6015                		mov.w	@r1+,r0
(1)  422/ 6000414 : 2201                		mov.w	r0,@r2
(1)  423/ 6000416 : 7202                		add	#2,r2
(1)  425/ 6000418 : 4310                		dt	r3
(1)  426/ 600041A : 8BCD                		bf	.copy_pal
(1)  427/ 600041C : E000                		mov	#0,r0
(1)  428/ 600041E : C106                		mov.w	r0,@(marsGbl_PalDmaMidWr,gbr)
(1)  429/ 6000420 :                     
(1)  430/ 6000420 :                             ; OLD method: doesn't work on hardware
(1)  431/ 6000420 :                     ; 		mov	r4,@-r15
(1)  432/ 6000420 :                     ; 		mov	r5,@-r15
(1)  433/ 6000420 :                     ; 		mov	r6,@-r15
(1)  434/ 6000420 :                     ; 		mov	#RAM_Mars_Palette,r1		; Send palette stored on RAM
(1)  435/ 6000420 :                     ; 		mov	#_palette,r2
(1)  436/ 6000420 :                     ;  		mov	#256,r3
(1)  437/ 6000420 :                     ; 		mov	#%0101011011110001,r4		; transfer size 2 / burst
(1)  438/ 6000420 :                     ; 		mov	#_DMASOURCE0,r5 		; _DMASOURCE = $ffffff80
(1)  439/ 6000420 :                     ; 		mov	#_DMAOPERATION,r6 		; _DMAOPERATION = $ffffffb0
(1)  440/ 6000420 :                     ; 		mov	r1,@r5				; set source address
(1)  441/ 6000420 :                     ; 		mov	r2,@(4,r5)			; set destination address
(1)  442/ 6000420 :                     ; 		mov	r3,@(8,r5)			; set length
(1)  443/ 6000420 :                     ; 		xor	r0,r0
(1)  444/ 6000420 :                     ; 		mov	r0,@r6				; Stop OPERATION
(1)  445/ 6000420 :                     ; 		xor	r0,r0
(1)  446/ 6000420 :                     ; 		mov	r0,@($C,r5)			; clear TE bit
(1)  447/ 6000420 :                     ; 		mov	r4,@($C,r5)			; load mode
(1)  448/ 6000420 :                     ; 		add	#1,r0
(1)  449/ 6000420 :                     ; 		mov	r0,@r6				; Start OPERATION
(1)  450/ 6000420 :                     ; 		mov	@r15+,r6
(1)  451/ 6000420 :                     ; 		mov	@r15+,r5
(1)  452/ 6000420 :                     ; 		mov	@r15+,r4
(1)  453/ 6000420 :                     
(1)  454/ 6000420 : 4F16                		lds	@r15+,macl
(1)  455/ 6000422 : 65F6                		mov	@r15+,r5
(1)  456/ 6000424 : 64F6                		mov	@r15+,r4
(1)  457/ 6000426 : 63F6                		mov	@r15+,r3
(1)  458/ 6000428 : 62F6                		mov	@r15+,r2
(1)  459/ 600042A : 4F07                		ldc	@r15+,sr
(1)  460/ 600042C :                     .mid_pwrite:
(1)  461/ 600042C : E000                		mov 	#0,r0				; Clear VintFlag for Master
(1)  462/ 600042E : C103                		mov.w	r0,@(marsGbl_VIntFlag_M,gbr)
(1)  463/ 6000430 : 000B                		rts
(1)  464/ 6000432 : 0009                		nop
(1)  465/ 6000434 :                     		align 4
(1)  466/ 6000434 : 2000 4018 2000 4016 		ltorg
                    2000 4100 0600 4430 
                    2000 4200 FE10 00F0 
(1)  467/ 600044C :                     
(1)  468/ 600044C :                     ; =================================================================
(1)  469/ 600044C :                     ; ------------------------------------------------
(1)  470/ 600044C :                     ; Master | VRES Interrupt (RESET on Genesis)
(1)  471/ 600044C :                     ; ------------------------------------------------
(1)  472/ 600044C :                     
(1)  473/ 600044C :                     ; TODO: Breaks on many RESETs
(1)  474/ 600044C :                     
(1)  475/ 600044C :                     m_irq_vres:
(1)  476/ 600044C : D017                		mov.l	#_sysreg,r0
(1)  477/ 600044E : 401E                		ldc	r0,gbr
(1)  478/ 6000450 : C10A                		mov.w	r0,@(vresintclr,gbr)	; V interrupt clear
(1)  479/ 6000452 : 0009                		nop
(1)  480/ 6000454 : 0009                		nop
(1)  481/ 6000456 : 0009                		nop
(1)  482/ 6000458 : 0009                		nop
(1)  483/ 600045A : 9033                		mov	#$F0,r0
(1)  484/ 600045C : 400E                		ldc	r0,sr
(1)  485/ 600045E : C406                		mov.b	@(dreqctl,gbr),r0
(1)  486/ 6000460 : C801                		tst	#1,r0
(1)  487/ 6000462 : 8B1C                		bf	.mars_reset
(1)  488/ 6000464 :                     .md_reset:
(1)  489/ 6000464 : D112                		mov.l	#"68UP",r1		; wait for the 68K to show up
(1)  490/ 6000466 : C60B                		mov.l	@(comm12,gbr),r0
(1)  491/ 6000468 : 3100                		cmp/eq	r0,r1
(1)  492/ 600046A : 8BFB                		bf	.md_reset
(1)  493/ 600046C :                     .sh_wait:
(1)  494/ 600046C : D111                		mov.l	#"S_OK",r1		; wait for the Slave CPU to show up
(1)  495/ 600046E : C609                		mov.l	@(comm4,gbr),r0
(1)  496/ 6000470 : 3100                		cmp/eq	r0,r1
(1)  497/ 6000472 : 8BFB                		bf	.sh_wait
(1)  498/ 6000474 : D010                		mov.l	#"M_OK",r0		; let the others know master ready
(1)  499/ 6000476 : C208                		mov.l	r0,@(comm0,gbr)
(1)  500/ 6000478 : 9125                		mov.l   #$FFFFFE80,r1		; Stop watchdog
(1)  501/ 600047A : 9025                		mov.w   #$A518,r0
(1)  502/ 600047C : 2101                		mov.w   r0,@r1
(1)  503/ 600047E :                     ; 		mov	#_vdpreg,r1		; Framebuffer swap request
(1)  504/ 600047E :                     ; 		mov.b	@(framectl,r1),r0	; watchdog will check for it later
(1)  505/ 600047E :                     ; 		xor	#1,r0
(1)  506/ 600047E :                     ; 		mov.b	r0,@(framectl,r1)
(1)  507/ 600047E :                     ; 		mov	#RAM_Mars_Global+marsGbl_CurrFb,r1
(1)  508/ 600047E : 2100                		mov.b	r0,@r1
(1)  509/ 6000480 : DF0E                		mov.l	#CS3|$40000-8,r15	; Set reset values
(1)  510/ 6000482 : D00F                		mov.l	#SH2_M_HotStart,r0
(1)  511/ 6000484 : 2F02                		mov.l	r0,@r15
(1)  512/ 6000486 : 901D                		mov.w	#$F0,r0
(1)  513/ 6000488 : 1F01                		mov.l	r0,@(4,r15)
(1)  514/ 600048A : E1B0                		mov.l	#_DMAOPERATION,r1
(1)  515/ 600048C : E000                		mov.l	#0,r0
(1)  516/ 600048E : 2102                		mov.l	r0,@r1			; Turn any DMA tasks OFF
(1)  517/ 6000490 : E18C                		mov.l	#_DMACHANNEL0,r1
(1)  518/ 6000492 : E000                		mov.l	#0,r0
(1)  519/ 6000494 : 2102                		mov.l	r0,@r1
(1)  520/ 6000496 : 9118                		mov.l	#%0100010011100000,r1
(1)  521/ 6000498 : 2102                		mov.l	r0,@r1			; Channel control
(1)  522/ 600049A : 002B                		rte
(1)  523/ 600049C : 0009                		nop
(1)  524/ 600049E :                     .mars_reset:
(1)  525/ 600049E : 9115                		mov	#_FRT,r1
(1)  526/ 60004A0 : 8417                		mov.b	@(_TOCR,r1),r0
(1)  527/ 60004A2 : CB01                		or	#$01,r0
(1)  528/ 60004A4 : 8017                		mov.b	r0,@(_TOCR,r1)
(1)  529/ 60004A6 :                     .vresloop:
(1)  530/ 60004A6 : AFFE                		bra	.vresloop
(1)  531/ 60004A8 : 0009                		nop
(1)  532/ 60004AA :                     		align 4
(1)  533/ 60004AC : 2000 4000 3638 5550 		ltorg				; Save MASTER IRQ literals here
                    535F 4F4B 4D5F 4F4B 
                    0603 FFF8 0600 0DEA 
                    00F0 FE80 A518 44E0 
                    FE10                
(1)  534/ 60004CE :                     
(1)  535/ 60004CE :                     ; =================================================================
(1)  536/ 60004CE :                     ; ------------------------------------------------
(1)  537/ 60004CE :                     ; Unused
(1)  538/ 60004CE :                     ; ------------------------------------------------
(1)  539/ 60004CE :                     
(1)  540/ 60004CE :                     s_irq_bad:
(1)  541/ 60004CE : 000B                		rts
(1)  542/ 60004D0 : 0009                		nop
(1)  543/ 60004D2 :                     		align 4
(1)  544/ 60004D4 :                     
(1)  545/ 60004D4 :                     ; =================================================================
(1)  546/ 60004D4 :                     ; ------------------------------------------------
(1)  547/ 60004D4 :                     ; Slave | PWM Interrupt
(1)  548/ 60004D4 :                     ; ------------------------------------------------
(1)  549/ 60004D4 :                     
(1)  550/ 60004D4 :                     s_irq_pwm:
(1)  551/ 60004D4 : D116                		mov	#_sysreg+monowidth,r1
(1)  552/ 60004D6 : 6010                		mov.b	@r1,r0
(1)  553/ 60004D8 : C880                 		tst	#$80,r0
(1)  554/ 60004DA : 8B04                 		bf	.exit
(1)  555/ 60004DC : 4F22                		sts	pr,@-r15
(1)  556/ 60004DE : D015                		mov	#MarsSound_ReadPwm,r0
(1)  557/ 60004E0 : 400B                		jsr	@r0
(1)  558/ 60004E2 : 0009                		nop
(1)  559/ 60004E4 : 4F26                		lds	@r15+,pr
(1)  560/ 60004E6 : 912B                .exit:		mov	#_FRT,r1
(1)  561/ 60004E8 : 8417                		mov.b	@(7,r1),r0
(1)  562/ 60004EA : CA02                		xor	#2,r0
(1)  563/ 60004EC : 8017                		mov.b	r0,@(7,r1)
(1)  564/ 60004EE : D112                		mov	#_sysreg+pwmintclr,r1
(1)  565/ 60004F0 : 2101                		mov.w	r0,@r1
(1)  566/ 60004F2 : 000B                		rts
(1)  567/ 60004F4 : 0009                		nop
(1)  568/ 60004F6 :                     		align 4
(1)  569/ 60004F8 :                     
(1)  570/ 60004F8 :                     ; 		mov	#_FRT,r1
(1)  571/ 60004F8 :                     ; 		mov.b	@(7,r1),r0
(1)  572/ 60004F8 :                     ; 		xor	#2,r0
(1)  573/ 60004F8 :                     ; 		mov.b	r0,@(7,r1)
(1)  574/ 60004F8 :                     ; 		mov	#_sysreg+pwmintclr,r1
(1)  575/ 60004F8 :                     ; 		mov.w	r0,@r1
(1)  576/ 60004F8 :                     ; 		nop
(1)  577/ 60004F8 :                     ; 		nop
(1)  578/ 60004F8 :                     ; 		nop
(1)  579/ 60004F8 :                     ; 		nop
(1)  580/ 60004F8 :                     ; 		nop
(1)  581/ 60004F8 :                     ; 		rts
(1)  582/ 60004F8 :                     ; 		nop
(1)  583/ 60004F8 :                     ; 		align 4
(1)  584/ 60004F8 :                     
(1)  585/ 60004F8 :                     ; =================================================================
(1)  586/ 60004F8 :                     ; ------------------------------------------------
(1)  587/ 60004F8 :                     ; Slave | CMD Interrupt
(1)  588/ 60004F8 :                     ;
(1)  589/ 60004F8 :                     ; Recieve data from Genesis using DREQ
(1)  590/ 60004F8 :                     ; ------------------------------------------------
(1)  591/ 60004F8 :                     
(1)  592/ 60004F8 :                     s_irq_cmd:
(1)  593/ 60004F8 : 4F03                		stc	sr,@-r15
(1)  594/ 60004FA : 9121                		mov	#_FRT,r1
(1)  595/ 60004FC : 8417                		mov.b	@(7,r1),r0
(1)  596/ 60004FE : CA02                		xor	#2,r0
(1)  597/ 6000500 : 8017                		mov.b	r0,@(7,r1)
(1)  598/ 6000502 :                     
(1)  599/ 6000502 :                     ; ----------------------------------
(1)  600/ 6000502 :                     
(1)  601/ 6000502 : 2F26                		mov	r2,@-r15
(1)  602/ 6000504 : 2F36                		mov	r3,@-r15
(1)  603/ 6000506 : 2F46                		mov	r4,@-r15
(1)  604/ 6000508 : 2F56                		mov	r5,@-r15
(1)  605/ 600050A : 2F66                		mov	r6,@-r15
(1)  606/ 600050C : 2F76                		mov	r7,@-r15
(1)  607/ 600050E : 2F86                		mov	r8,@-r15
(1)  608/ 6000510 : 2F96                		mov	r9,@-r15
(1)  609/ 6000512 : 4F22                		sts	pr,@-r15
(1)  610/ 6000514 :                     ; 		mov	#MarsSnd_PwmControl,r9
(1)  611/ 6000514 :                     ; 		mov	#_sysreg+comm15,r7	; control comm
(1)  612/ 6000514 :                     ; 		mov	#4,r5			; number of passes
(1)  613/ 6000514 :                     ; .wait_1:
(1)  614/ 6000514 :                     ; 		nop
(1)  615/ 6000514 :                     ; 		nop
(1)  616/ 6000514 :                     ; 		mov.b	@r7,r0			; wait first CLOCK
(1)  617/ 6000514 :                     ; 		and	#%00100000,r0		; from Z80
(1)  618/ 6000514 :                     ; 		cmp/pl	r0
(1)  619/ 6000514 :                     ; 		bf	.wait_1
(1)  620/ 6000514 :                     ; 		mov	#7,r6
(1)  621/ 6000514 :                     ; 		mov	#_sysreg+comm0,r8
(1)  622/ 6000514 :                     ; .copy_1:
(1)  623/ 6000514 :                     ; 		mov.w	@r8+,r0
(1)  624/ 6000514 :                     ; 		mov.w	r0,@r9
(1)  625/ 6000514 :                     ; 		dt	r6
(1)  626/ 6000514 :                     ; 		bf/s	.copy_1
(1)  627/ 6000514 :                     ; 		add	#2,r9
(1)  628/ 6000514 :                     ; 		mov.b	@r7,r0			; tell Z80 CLK finished
(1)  629/ 6000514 :                     ; 		and	#%11011111,r0
(1)  630/ 6000514 :                     ; 		mov.b	r0,@r7
(1)  631/ 6000514 :                     ; 		dt	r5
(1)  632/ 6000514 :                     ; 		bf	.wait_1
(1)  633/ 6000514 :                     ; 		mov.w	#1,r0			; request SOUND update to main loop
(1)  634/ 6000514 :                     ; 		mov.w	r0,@(marsGbl_PwmCtrlUpd,gbr)
(1)  635/ 6000514 :                     .cantupd:
(1)  636/ 6000514 : D109                		mov	#_sysreg+cmdintclr,r1	; Clear CMD flag
(1)  637/ 6000516 : 2101                		mov.w	r0,@r1
(1)  638/ 6000518 :                     ; 		mov.w	@r1,r0
(1)  639/ 6000518 : 4F26                		lds	@r15+,pr
(1)  640/ 600051A : 69F6                		mov 	@r15+,r9
(1)  641/ 600051C : 68F6                		mov 	@r15+,r8
(1)  642/ 600051E : 67F6                		mov 	@r15+,r7
(1)  643/ 6000520 : 66F6                		mov 	@r15+,r6
(1)  644/ 6000522 : 65F6                		mov 	@r15+,r5
(1)  645/ 6000524 : 64F6                		mov 	@r15+,r4
(1)  646/ 6000526 : 63F6                		mov 	@r15+,r3
(1)  647/ 6000528 : 62F6                		mov 	@r15+,r2
(1)  648/ 600052A : 4F07                		ldc 	@r15+,sr
(1)  649/ 600052C : 000B                		rts
(1)  650/ 600052E : 0009                		nop
(1)  651/ 6000530 :                     		align 4
(1)  652/ 6000530 : 2000 4038 C000 0380 		ltorg
                    2000 401C 2000 401A 
                    FE10                
(1)  653/ 6000542 :                     
(1)  654/ 6000542 :                     ; ; 		mov	#_sysreg+comm15,r1	; comm15 at bit 6
(1)  655/ 6000542 :                     ; ; 		mov.b	@r1,r0			; Clear DMA signal for MD
(1)  656/ 6000542 :                     ; ; 		and	#%10111111,r0
(1)  657/ 6000542 :                     ; ; 		mov.b	r0,@r1
(1)  658/ 6000542 :                     ; 		mov	#RAM_Mars_DREQ,r1	; r1 - Output destination
(1)  659/ 6000542 :                     ; 		mov	#$20004010,r2		; r2 - DREQ length address
(1)  660/ 6000542 :                     ; 		mov	#_DMASOURCE0,r3		; r3 - DMA Channel 0
(1)  661/ 6000542 :                     ; 		mov	#0,r0
(1)  662/ 6000542 :                     ; 		mov	r0,@($30,r3)		; DMA Stop (_DMAOPERATION)
(1)  663/ 6000542 :                     ; 		mov	r0,@($C,r3)		; _DMACHANNEL0
(1)  664/ 6000542 :                     ; 		mov	#%0100010011100000,r0
(1)  665/ 6000542 :                     ; 		mov	r0,@($C,r3)
(1)  666/ 6000542 :                     ; 		mov	#$20004012,r0		; Source data (DREQ FIFO)
(1)  667/ 6000542 :                     ; 		mov	r0,@(0,r3)
(1)  668/ 6000542 :                     ; 		mov	r1,@(4,r3)
(1)  669/ 6000542 :                     ; 		mov.w	@r2,r0
(1)  670/ 6000542 :                     ; 		mov	r0,@(8,r3)
(1)  671/ 6000542 :                     ; 		mov	#%0100010011100001,r0
(1)  672/ 6000542 :                     ; 		mov	r0,@($C,r3)
(1)  673/ 6000542 :                     ; 		mov	#1,r0
(1)  674/ 6000542 :                     ; 		mov	r0,@($30,r3)		; DMA Start (_DMAOPERATION)
(1)  675/ 6000542 :                     ; ; 		mov	#_sysreg+comm15,r1	; comm15 at bit 6
(1)  676/ 6000542 :                     ; ; 		mov.b	@r1,r0			; Tell MD to push FIFO
(1)  677/ 6000542 :                     ; ; 		or	#%01000000,r0
(1)  678/ 6000542 :                     ; ; 		mov.b	r0,@r1
(1)  679/ 6000542 :                     ;
(1)  680/ 6000542 :                     ; 		mov	#_sysreg+comm4,r2	; DEBUG
(1)  681/ 6000542 :                     ; 		mov	#RAM_Mars_DREQ,r1
(1)  682/ 6000542 :                     ; 		mov	@r1,r0
(1)  683/ 6000542 :                     ; 		mov	r0,@r2
(1)  684/ 6000542 :                     
(1)  685/ 6000542 :                     ; 		mov 	@r15+,r4
(1)  686/ 6000542 :                     ; 		mov 	@r15+,r3
(1)  687/ 6000542 :                     ; 		mov 	@r15+,r2
(1)  688/ 6000542 :                     
(1)  689/ 6000542 :                     ; =================================================================
(1)  690/ 6000542 :                     ; ------------------------------------------------
(1)  691/ 6000542 :                     ; Slave | HBlank
(1)  692/ 6000542 :                     ; ------------------------------------------------
(1)  693/ 6000542 :                     
(1)  694/ 6000542 :                     s_irq_h:
(1)  695/ 6000542 : 9151                		mov	#_FRT,r1
(1)  696/ 6000544 : 8417                		mov.b	@(7,r1),r0
(1)  697/ 6000546 : CA02                		xor	#2,r0
(1)  698/ 6000548 : 8017                		mov.b	r0,@(7,r1)
(1)  699/ 600054A : D11F                		mov	#_sysreg+hintclr,r1
(1)  700/ 600054C : 2101                		mov.w	r0,@r1
(1)  701/ 600054E : 0009                		nop
(1)  702/ 6000550 : 0009                		nop
(1)  703/ 6000552 : 0009                		nop
(1)  704/ 6000554 : 0009                		nop
(1)  705/ 6000556 : 0009                		nop
(1)  706/ 6000558 : 000B                		rts
(1)  707/ 600055A : 0009                		nop
(1)  708/ 600055C :                     		align 4
(1)  709/ 600055C :                     
(1)  710/ 600055C :                     ; =================================================================
(1)  711/ 600055C :                     ; ------------------------------------------------
(1)  712/ 600055C :                     ; Slave | VBlank
(1)  713/ 600055C :                     ; ------------------------------------------------
(1)  714/ 600055C :                     
(1)  715/ 600055C :                     s_irq_v:
(1)  716/ 600055C : E000                		mov 	#0,r0				; Clear VintFlag for Slave
(1)  717/ 600055E : C104                		mov.w	r0,@(marsGbl_VIntFlag_S,gbr)
(1)  718/ 6000560 : 9142                		mov	#_FRT,r1
(1)  719/ 6000562 : 8417                		mov.b	@(7,r1),r0
(1)  720/ 6000564 : CA02                		xor	#2,r0
(1)  721/ 6000566 : 8017                		mov.b	r0,@(7,r1)
(1)  722/ 6000568 : D118                		mov	#_sysreg+vintclr,r1
(1)  723/ 600056A : 000B                		rts
(1)  724/ 600056C : 2101                		mov.w	r0,@r1
(1)  725/ 600056E :                     		align 4
(1)  726/ 6000570 :                     
(1)  727/ 6000570 :                     ; =================================================================
(1)  728/ 6000570 :                     ; ------------------------------------------------
(1)  729/ 6000570 :                     ; Slave | VRES Interrupt (Pressed RESET on Genesis)
(1)  730/ 6000570 :                     ; ------------------------------------------------
(1)  731/ 6000570 :                     
(1)  732/ 6000570 :                     s_irq_vres:
(1)  733/ 6000570 : D017                		mov.l	#_sysreg,r0
(1)  734/ 6000572 : 401E                		ldc	r0,gbr
(1)  735/ 6000574 : C10A                		mov.w	r0,@(vresintclr,gbr)	; V interrupt clear
(1)  736/ 6000576 : 0009                		nop
(1)  737/ 6000578 : 0009                		nop
(1)  738/ 600057A : 0009                		nop
(1)  739/ 600057C : 0009                		nop
(1)  740/ 600057E : 9034                		mov	#$F0,r0
(1)  741/ 6000580 : 400E                		ldc	r0,sr
(1)  742/ 6000582 : C406                		mov.b	@(dreqctl,gbr),r0
(1)  743/ 6000584 : C801                		tst	#1,r0
(1)  744/ 6000586 : 8B18                		bf	.mars_reset
(1)  745/ 6000588 :                     .md_reset:
(1)  746/ 6000588 : D112                		mov.l	#"68UP",r1		; wait for the 68k to show up
(1)  747/ 600058A : C60B                		mov.l	@(comm12,gbr),r0
(1)  748/ 600058C : 3100                		cmp/eq	r0,r1
(1)  749/ 600058E : 8BFB                		bf	.md_reset
(1)  750/ 6000590 : D011                		mov.l	#"S_OK",r0		; tell the others slave is ready
(1)  751/ 6000592 : C209                		mov.l	r0,@(comm4,gbr)
(1)  752/ 6000594 :                     .sh_wait:
(1)  753/ 6000594 : D111                		mov.l	#"M_OK",r1		; wait for the slave to show up
(1)  754/ 6000596 : C608                		mov.l	@(comm0,gbr),r0
(1)  755/ 6000598 : 3100                		cmp/eq	r0,r1
(1)  756/ 600059A : 8BFB                		bf	.sh_wait
(1)  757/ 600059C : DF10                		mov.l	#CS3|$3F000-8,r15
(1)  758/ 600059E : D011                		mov.l	#SH2_S_HotStart,r0
(1)  759/ 60005A0 : 2F02                		mov.l	r0,@r15
(1)  760/ 60005A2 : 9022                		mov.w	#$F0,r0
(1)  761/ 60005A4 : 1F01                		mov.l	r0,@(4,r15)
(1)  762/ 60005A6 : E1B0                		mov.l	#_DMAOPERATION,r1
(1)  763/ 60005A8 : E000                		mov.l	#0,r0
(1)  764/ 60005AA : 2102                		mov.l	r0,@r1			; DMA off
(1)  765/ 60005AC : E18C                		mov.l	#_DMACHANNEL0,r1
(1)  766/ 60005AE : E000                		mov.l	#0,r0
(1)  767/ 60005B0 : 2102                		mov.l	r0,@r1
(1)  768/ 60005B2 : 911B                		mov.l	#%0100010011100000,r1
(1)  769/ 60005B4 : 2102                		mov.l	r0,@r1			; Channel control
(1)  770/ 60005B6 : 002B                		rte
(1)  771/ 60005B8 : 0009                		nop
(1)  772/ 60005BA :                     .mars_reset:
(1)  773/ 60005BA : 9115                		mov	#_FRT,r1
(1)  774/ 60005BC : 8417                		mov.b	@(_TOCR,r1),r0
(1)  775/ 60005BE : CB01                		or	#$01,r0
(1)  776/ 60005C0 : 8017                		mov.b	r0,@(_TOCR,r1)
(1)  777/ 60005C2 :                     .vresloop:
(1)  778/ 60005C2 : AFFE                		bra	.vresloop
(1)  779/ 60005C4 : 0009                		nop
(1)  780/ 60005C6 :                     		align 4
(1)  781/ 60005C8 : 2000 4018 2000 4016 		ltorg			; Save Slave IRQ literals
                    2000 4000 3638 5550 
                    535F 4F4B 4D5F 4F4B 
                    0603 EFF8 0600 0FA4 
                    FE10 00F0 44E0      
(1)  782/ 60005EE :                     
(1)  783/ 60005EE :                     ; ====================================================================
(1)  784/ 60005EE :                     ; ----------------------------------------------------------------
(1)  785/ 60005EE :                     ; MARS System features
(1)  786/ 60005EE :                     ; ----------------------------------------------------------------
(1)  787/ 60005EE :                     
(1)  788/ 60005EE :                     		include "system/mars/video.asm"
(2)    1/ 60005EE :                     ; ====================================================================
(2)    2/ 60005EE :                     ; ----------------------------------------------------------------
(2)    3/ 60005EE :                     ; MARS Video
(2)    4/ 60005EE :                     ; ----------------------------------------------------------------
(2)    5/ 60005EE :                     
(2)    6/ 60005EE :                     ; ----------------------------------------
(2)    7/ 60005EE :                     ; Variables
(2)    8/ 60005EE :                     ; ----------------------------------------
(2)    9/ 60005EE :                     
(2)   10/ 60005EE :                     ; SCREEN_WIDTH	equ	320
(2)   11/ 60005EE :                     ; SCREEN_HEIGHT	equ	224
(2)   12/ 60005EE :                     
(2)   13/ 60005EE :                     ; MSB
(2)   14/ 60005EE :                     ; PLGN_TEXURE	equ	%10000000
(2)   15/ 60005EE :                     ; PLGN_TRI	equ	%01000000
(2)   16/ 60005EE :                     
(2)   17/ 60005EE :                     ; ----------------------------------------
(2)   18/ 60005EE :                     ; Structs
(2)   19/ 60005EE :                     ; ----------------------------------------
(2)   20/ 60005EE :                     
(2)   21/ 60005EE : (MACRO)             		struct 0
(2)   21/ 60005EE : =$60005EE           GLBL_LASTPC     set *
(2)   21/   3B04E :                                     dephase
(2)   21/   3B04E : =$3B04E             GLBL_LASTORG    set *
(2)   21/       0 :                                     phase 0
(2)   22/       0 :                     mbg_draw_all	ds.b 1		; Write 2 to request FULL redraw
(2)   23/       1 :                     mbg_draw_r	ds.b 1		; Write 2 to draw to the right
(2)   24/       2 :                     mbg_draw_l	ds.b 1		; ***** left
(2)   25/       3 :                     mbg_draw_d	ds.b 1		; ***** down
(2)   26/       4 :                     mbg_draw_u	ds.b 1		; ***** up
(2)   27/       5 :                     mbg_xset	ds.b 1		; X-counter
(2)   28/       6 :                     mbg_yset	ds.b 1		; Y-counter
(2)   29/       7 :                     mbg_free	ds.b 1		; --align--
(2)   30/       8 :                     mbg_xpos_old	ds.w 1
(2)   31/       A :                     mbg_ypos_old	ds.w 1
(2)   32/       C :                     mbg_xinc_l	ds.w 1
(2)   33/       E :                     mbg_xinc_r	ds.w 1
(2)   34/      10 :                     mbg_yinc_u	ds.w 1
(2)   35/      12 :                     mbg_yinc_d	ds.w 1
(2)   36/      14 :                     mbg_width	ds.w 1
(2)   37/      16 :                     mbg_height	ds.w 1
(2)   38/      18 :                     mbg_yfb		ds.w 1		; TOP Y position, multiply by WIDTH externally
(2)   39/      1A :                     mbg_yfb_d	ds.w 1		; BOTTOM Y
(2)   40/      1C :                     mbg_maxlines	ds.w 1
(2)   41/      1E :                     mbg_4		ds.w 1
(2)   42/      20 :                     mbg_5		ds.w 1
(2)   43/      22 :                     mbg_6		ds.w 1
(2)   44/      24 :                     mbg_7		ds.w 1
(2)   45/      26 :                     mbg_8		ds.w 1
(2)   46/      28 :                     mbg_data	ds.l 1
(2)   47/      2C :                     mbg_size	ds.l 1		; Background FULL size, Width MUST be larger than 320.
(2)   48/      30 :                     mbg_xpos	ds.l 1		; 0000.0000
(2)   49/      34 :                     mbg_ypos	ds.l 1		; 0000.0000
(2)   50/      38 :                     mbg_fb		ds.l 1		; Framebuffer TOPLEFT position
(2)   51/      3C :                     sizeof_marsbg	ds.l 0
(2)   52/      3E : (MACRO)             		finish
(2)   52/       0 :                                     !org GLBL_LASTORG
(2)   52/ 60005EE :                                     phase GLBL_LASTPC
(2)   53/ 60005EE :                     
(2)   54/ 60005EE :                     ; ====================================================================
(2)   55/ 60005EE :                     ; ----------------------------------------------------------------
(2)   56/ 60005EE :                     ; Init MARS Video
(2)   57/ 60005EE :                     ; ----------------------------------------------------------------
(2)   58/ 60005EE :                     
(2)   59/ 60005EE :                     MarsVideo_Init:
(2)   60/ 60005EE : 4F22                		sts	pr,@-r15
(2)   61/ 60005F0 : D104                		mov	#_sysreg,r1
(2)   62/ 60005F2 : 900B                		mov 	#FM,r0			; Set SVDP permission to SH2
(2)   63/ 60005F4 : 8010                  		mov.b	r0,@(adapter,r1)
(2)   64/ 60005F6 : D104                		mov 	#_vdpreg,r1
(2)   65/ 60005F8 : E000                		mov	#0,r0			; Start at blank
(2)   66/ 60005FA : 8011                		mov.b	r0,@(bitmapmd,r1)
(2)   67/ 60005FC : 4F26                		lds	@r15+,pr
(2)   68/ 60005FE : 000B                		rts
(2)   69/ 6000600 : 0009                		nop
(2)   70/ 6000602 :                     		align 4
(2)   71/ 6000604 : 2000 4000 2000 4100 		ltorg
                    0080                
(2)   72/ 600060E :                     
(2)   73/ 600060E :                     ; ====================================================================
(2)   74/ 600060E :                     ; ----------------------------------------------------------------
(2)   75/ 600060E :                     ; 256-color Scrolling background
(2)   76/ 600060E :                     ; ----------------------------------------------------------------
(2)   77/ 600060E :                     
(2)   78/ 600060E :                     ; ---------------------------------------
(2)   79/ 600060E :                     ; Draw ALL the pixel data on
(2)   80/ 600060E :                     ; current framebuffer
(2)   81/ 600060E :                     ;
(2)   82/ 600060E :                     ; r1 - X pos
(2)   83/ 600060E :                     ; r2 - Y pos
(2)   84/ 600060E :                     ; ---------------------------------------
(2)   85/ 600060E :                     
(2)   86/ 600060E :                     MarsVideo_DrawAllBg:
(2)   87/ 600060E : 4F22                		sts	pr,@-r15
(2)   88/ 6000610 :                     
(2)   89/ 6000610 : 6013                		mov	r1,r0
(2)   90/ 6000612 : 81E4                		mov.w	r0,@(mbg_xpos_old,r14)
(2)   91/ 6000614 : 4028                		shll16	r0
(2)   92/ 6000616 : 1E0C                		mov	r0,@(mbg_xpos,r14)
(2)   93/ 6000618 : 6023                		mov	r2,r0
(2)   94/ 600061A : 81E5                		mov.w	r0,@(mbg_ypos_old,r14)
(2)   95/ 600061C : 4028                		shll16	r0
(2)   96/ 600061E : 1E0D                		mov	r0,@(mbg_ypos,r14)
(2)   97/ 6000620 :                     
(2)   98/ 6000620 : E000                		mov	#0,r0
(2)   99/ 6000622 : 81EC                		mov.w	r0,@(mbg_yfb,r14)
(2)  100/ 6000624 : 1E0E                		mov	r0,@(mbg_fb,r14)
(2)  101/ 6000626 : 90A9                		mov	#MSCRL_HEIGHT-MSCRL_BLKSIZE,r0
(2)  102/ 6000628 : 81ED                		mov.w	r0,@(mbg_yfb_d,r14)
(2)  103/ 600062A : DE51                		mov	#RAM_Mars_Background,r14
(2)  104/ 600062C : 50EA                		mov	@(mbg_data,r14),r0
(2)  105/ 600062E : 6D03                		mov	r0,r13				; r13 - pixel data
(2)  106/ 6000630 : DC50                		mov	#_framebuffer+$200,r12		; r12 - framebuffer topleft
(2)  107/ 6000632 : 85EA                		mov.w	@(mbg_width,r14),r0		; r11 - pixel-data WIDTH
(2)  108/ 6000634 : 6B03                		mov	r0,r11
(2)  109/ 6000636 : 9AA2                		mov	#MSCRL_WIDTH,r10		; r10 - internal WIDTH
(2)  110/ 6000638 : 85EB                		mov.w	@(mbg_height,r14),r0
(2)  111/ 600063A : 6903                		mov	r0,r9
(2)  112/ 600063C : 98A0                		mov	#MSCRL_HEIGHT,r8
(2)  113/ 600063E : E0F0                		mov	#-MSCRL_BLKSIZE,r0
(2)  114/ 6000640 : 2109                		and	r0,r1
(2)  115/ 6000642 : 2209                		and	r0,r2
(2)  116/ 6000644 :                     	; Set draw heads
(2)  117/ 6000644 :                     .xinit_l:
(2)  118/ 6000644 : 31B3                		cmp/ge	r11,r1			; First X limiter
(2)  119/ 6000646 : 8B01                		bf	.xbg_inc
(2)  120/ 6000648 : AFFC                		bra	.xinit_l
(2)  121/ 600064A : 31B8                		sub	r11,r1
(2)  122/ 600064C :                     .xbg_inc:
(2)  123/ 600064C : 3293                		cmp/ge	r9,r2			; First Y limiter
(2)  124/ 600064E : 8B01                		bf	.ybg_inc
(2)  125/ 6000650 : AFFC                		bra	.xbg_inc
(2)  126/ 6000652 : 3298                		sub	r9,r2
(2)  127/ 6000654 :                     .ybg_inc:
(2)  128/ 6000654 : 6013                		mov	r1,r0
(2)  129/ 6000656 : 81E6                		mov.w	r0,@(mbg_xinc_l,r14)
(2)  130/ 6000658 : 9393                		mov	#320,r3
(2)  131/ 600065A : 303C                		add	r3,r0
(2)  132/ 600065C : 81E7                		mov.w	r0,@(mbg_xinc_r,r14)
(2)  133/ 600065E : 6023                		mov	r2,r0
(2)  134/ 6000660 : 81E8                		mov.w	r0,@(mbg_yinc_u,r14)
(2)  135/ 6000662 : 938B                		mov	#MSCRL_HEIGHT-MSCRL_BLKSIZE,r3
(2)  136/ 6000664 : 303C                		add	r3,r0
(2)  137/ 6000666 : 81E9                		mov.w	r0,@(mbg_yinc_d,r14)
(2)  138/ 6000668 :                     
(2)  139/ 6000668 :                     	; *** MAIN draw loop ***
(2)  140/ 6000668 : 2F16                		mov	r1,@-r15
(2)  141/ 600066A : 2F26                		mov	r2,@-r15
(2)  142/ 600066C : 2F36                		mov	r3,@-r15
(2)  143/ 600066E : 2F46                		mov	r4,@-r15
(2)  144/ 6000670 : E300                		mov	#0,r3
(2)  145/ 6000672 : E400                		mov	#0,r4
(2)  146/ 6000674 : E710                		mov	#MSCRL_HEIGHT/MSCRL_BLKSIZE,r7
(2)  147/ 6000676 :                     .y_loop:
(2)  148/ 6000676 : 3293                		cmp/ge	r9,r2		; Y limiters
(2)  149/ 6000678 : 8B00                		bf	.ybg_l
(2)  150/ 600067A : 3298                		sub	r9,r2
(2)  151/ 600067C :                     .ybg_l:
(2)  152/ 600067C : 3483                		cmp/ge	r8,r4
(2)  153/ 600067E : 8B00                		bf	.yfb_l
(2)  154/ 6000680 : 3488                		sub	r8,r4
(2)  155/ 6000682 :                     .yfb_l:
(2)  156/ 6000682 :                     	; X draw
(2)  157/ 6000682 : 2F16                		mov	r1,@-r15
(2)  158/ 6000684 : 2F36                		mov	r3,@-r15
(2)  159/ 6000686 : E615                		mov	#(MSCRL_WIDTH/MSCRL_BLKSIZE),r6
(2)  160/ 6000688 :                     .x_loop:
(2)  161/ 6000688 : 31B3                		cmp/ge	r11,r1		; X limiters
(2)  162/ 600068A : 8B00                		bf	.xbg_l
(2)  163/ 600068C : 31B8                		sub	r11,r1
(2)  164/ 600068E :                     .xbg_l:
(2)  165/ 600068E : 33A3                		cmp/ge	r10,r3
(2)  166/ 6000690 : 8B00                		bf	.xfb_l
(2)  167/ 6000692 : 33A8                		sub	r10,r3
(2)  168/ 6000694 :                     .xfb_l:
(2)  169/ 6000694 : B040                		bsr	.mk_piece
(2)  170/ 6000696 : 0009                		nop
(2)  171/ 6000698 : E010                		mov	#MSCRL_BLKSIZE,r0
(2)  172/ 600069A : 310C                		add	r0,r1
(2)  173/ 600069C : 4610                		dt	r6
(2)  174/ 600069E : 8FF3                		bf/s	.x_loop
(2)  175/ 60006A0 : 330C                		add	r0,r3
(2)  176/ 60006A2 : 63F6                		mov	@r15+,r3
(2)  177/ 60006A4 : 61F6                		mov	@r15+,r1
(2)  178/ 60006A6 : E010                		mov	#MSCRL_BLKSIZE,r0
(2)  179/ 60006A8 : 320C                		add	r0,r2
(2)  180/ 60006AA : 4710                		dt	r7
(2)  181/ 60006AC : 8FE3                		bf/s	.y_loop
(2)  182/ 60006AE : 340C                		add	r0,r4
(2)  183/ 60006B0 : 64F6                		mov	@r15+,r4
(2)  184/ 60006B2 : 63F6                		mov	@r15+,r3
(2)  185/ 60006B4 : 62F6                		mov	@r15+,r2
(2)  186/ 60006B6 : 61F6                		mov	@r15+,r1
(2)  187/ 60006B8 :                     
(2)  188/ 60006B8 :                     	; Now for the hidden line at the bottom:
(2)  189/ 60006B8 : D02F                		mov	#MSCRL_WIDTH*MSCRL_HEIGHT,r0	; Point to the bottom FB
(2)  190/ 60006BA : 3C0C                		add	r0,r12
(2)  191/ 60006BC : E300                		mov	#0,r3
(2)  192/ 60006BE : E400                		mov	#0,r4
(2)  193/ 60006C0 : E915                		mov	#(MSCRL_WIDTH/MSCRL_BLKSIZE),r9
(2)  194/ 60006C2 :                     .lnx_loop:
(2)  195/ 60006C2 : 31B3                		cmp/ge	r11,r1		; X limiters
(2)  196/ 60006C4 : 8B00                		bf	.lnxbg_l
(2)  197/ 60006C6 : 31B8                		sub	r11,r1
(2)  198/ 60006C8 :                     .lnxbg_l:
(2)  199/ 60006C8 : 33A3                		cmp/ge	r10,r3
(2)  200/ 60006CA : 8B00                		bf	.lnxfb_l
(2)  201/ 60006CC : 33A8                		sub	r10,r3
(2)  202/ 60006CE :                     .lnxfb_l:
(2)  203/ 60006CE : B009                		bsr	.mk_pzline
(2)  204/ 60006D0 : 0009                		nop
(2)  205/ 60006D2 : E010                		mov	#MSCRL_BLKSIZE,r0
(2)  206/ 60006D4 : 310C                		add	r0,r1
(2)  207/ 60006D6 : 330C                		add	r0,r3
(2)  208/ 60006D8 : 4910                		dt	r9
(2)  209/ 60006DA : 8BF2                		bf	.lnx_loop
(2)  210/ 60006DC :                     
(2)  211/ 60006DC : 4F26                		lds	@r15+,pr
(2)  212/ 60006DE : 000B                		rts
(2)  213/ 60006E0 : 0009                		nop
(2)  214/ 60006E2 :                     		align 4
(2)  215/ 60006E4 :                     
(2)  216/ 60006E4 :                     .mk_pzline:
(2)  217/ 60006E4 :                     ; 		mov	r5,@-r15
(2)  218/ 60006E4 :                     ; 		mov	r6,@-r15
(2)  219/ 60006E4 :                     ; 		mov	r7,@-r15
(2)  220/ 60006E4 :                     ; 		mov	r8,@-r15
(2)  221/ 60006E4 :                     ; 		mov	r9,@-r15
(2)  222/ 60006E4 :                     
(2)  223/ 60006E4 :                     	; Framebuffer X/Y add
(2)  224/ 60006E4 : 68D3                		mov	r13,r8		; BG X/Y add
(2)  225/ 60006E6 : 22BE                		mulu	r11,r2
(2)  226/ 60006E8 : 001A                		sts	macl,r0
(2)  227/ 60006EA : 380C                		add	r0,r8
(2)  228/ 60006EC : 381C                		add	r1,r8
(2)  229/ 60006EE : 67C3                		mov	r12,r7		; FB X/Y add
(2)  230/ 60006F0 : 24AE                		mulu	r10,r4
(2)  231/ 60006F2 : 001A                		sts	macl,r0
(2)  232/ 60006F4 : 370C                		add	r0,r7
(2)  233/ 60006F6 : 373C                		add	r3,r7
(2)  234/ 60006F8 :                     ; 		mov	#MSCRL_BLKSIZE,r9
(2)  235/ 60006F8 :                     ; .yblk_loop:
(2)  236/ 60006F8 : 6583                		mov	r8,r5
(2)  237/ 60006FA : 6673                		mov	r7,r6
(2)  238/ 60006FC :                     	rept MSCRL_BLKSIZE/4
(2)  239/ 60006FC :                     		mov	@r5+,r0
(2)  240/ 60006FC :                     		mov	r0,@r6
(2)  241/ 60006FC :                     		add	#4,r6
(2)  242/ 60006FC :                     	endm
(2)  239/ 60006FC : 6056                		mov	@r5+,r0
(2)  240/ 60006FE : 2602                		mov	r0,@r6
(2)  241/ 6000700 : 7604                		add	#4,r6
(2)  239/ 6000702 : 6056                		mov	@r5+,r0
(2)  240/ 6000704 : 2602                		mov	r0,@r6
(2)  241/ 6000706 : 7604                		add	#4,r6
(2)  239/ 6000708 : 6056                		mov	@r5+,r0
(2)  240/ 600070A : 2602                		mov	r0,@r6
(2)  241/ 600070C : 7604                		add	#4,r6
(2)  239/ 600070E : 6056                		mov	@r5+,r0
(2)  240/ 6000710 : 2602                		mov	r0,@r6
(2)  241/ 6000712 : 7604                		add	#4,r6
(2)  243/ 6000714 :                     
(2)  244/ 6000714 :                     ; 		mov	@r15+,r9
(2)  245/ 6000714 :                     ; 		mov	@r15+,r8
(2)  246/ 6000714 :                     ; 		mov	@r15+,r7
(2)  247/ 6000714 :                     ; 		mov	@r15+,r6
(2)  248/ 6000714 :                     ; 		mov	@r15+,r5
(2)  249/ 6000714 : 000B                		rts
(2)  250/ 6000716 : 0009                		nop
(2)  251/ 6000718 :                     		align 4
(2)  252/ 6000718 :                     
(2)  253/ 6000718 :                     ; r1 - X pos
(2)  254/ 6000718 :                     ; r2 - Y pos
(2)  255/ 6000718 :                     .mk_piece:
(2)  256/ 6000718 : 2F56                		mov	r5,@-r15
(2)  257/ 600071A : 2F66                		mov	r6,@-r15
(2)  258/ 600071C : 2F76                		mov	r7,@-r15
(2)  259/ 600071E : 2F86                		mov	r8,@-r15
(2)  260/ 6000720 : 2F96                		mov	r9,@-r15
(2)  261/ 6000722 :                     
(2)  262/ 6000722 :                     	; Framebuffer X/Y add
(2)  263/ 6000722 : 68D3                		mov	r13,r8		; BG X/Y add
(2)  264/ 6000724 : 22BE                		mulu	r11,r2
(2)  265/ 6000726 : 001A                		sts	macl,r0
(2)  266/ 6000728 : 380C                		add	r0,r8
(2)  267/ 600072A : 381C                		add	r1,r8
(2)  268/ 600072C :                     
(2)  269/ 600072C : 67C3                		mov	r12,r7		; FB X/Y add
(2)  270/ 600072E : 24AE                		mulu	r10,r4
(2)  271/ 6000730 : 001A                		sts	macl,r0
(2)  272/ 6000732 : 370C                		add	r0,r7
(2)  273/ 6000734 : 373C                		add	r3,r7
(2)  274/ 6000736 : E910                		mov	#MSCRL_BLKSIZE,r9
(2)  275/ 6000738 :                     .yblk_loop:
(2)  276/ 6000738 : 6583                		mov	r8,r5
(2)  277/ 600073A : 6673                		mov	r7,r6
(2)  278/ 600073C :                     	rept MSCRL_BLKSIZE/4
(2)  279/ 600073C :                     		mov	@r5+,r0
(2)  280/ 600073C :                     		mov	r0,@r6
(2)  281/ 600073C :                     		add	#4,r6
(2)  282/ 600073C :                     	endm
(2)  279/ 600073C : 6056                		mov	@r5+,r0
(2)  280/ 600073E : 2602                		mov	r0,@r6
(2)  281/ 6000740 : 7604                		add	#4,r6
(2)  279/ 6000742 : 6056                		mov	@r5+,r0
(2)  280/ 6000744 : 2602                		mov	r0,@r6
(2)  281/ 6000746 : 7604                		add	#4,r6
(2)  279/ 6000748 : 6056                		mov	@r5+,r0
(2)  280/ 600074A : 2602                		mov	r0,@r6
(2)  281/ 600074C : 7604                		add	#4,r6
(2)  279/ 600074E : 6056                		mov	@r5+,r0
(2)  280/ 6000750 : 2602                		mov	r0,@r6
(2)  281/ 6000752 : 7604                		add	#4,r6
(2)  283/ 6000754 : 38BC                		add	r11,r8
(2)  284/ 6000756 : 4910                		dt	r9
(2)  285/ 6000758 : 8FEE                		bf/s	.yblk_loop
(2)  286/ 600075A : 37AC                		add	r10,r7
(2)  287/ 600075C :                     
(2)  288/ 600075C : 69F6                		mov	@r15+,r9
(2)  289/ 600075E : 68F6                		mov	@r15+,r8
(2)  290/ 6000760 : 67F6                		mov	@r15+,r7
(2)  291/ 6000762 : 66F6                		mov	@r15+,r6
(2)  292/ 6000764 : 65F6                		mov	@r15+,r5
(2)  293/ 6000766 : 000B                		rts
(2)  294/ 6000768 : 0009                		nop
(2)  295/ 600076A :                     		align 4
(2)  296/ 600076C :                     
(2)  297/ 600076C :                     ; OLD, stable
(2)  298/ 600076C :                     ; 		sts	pr,@-r15
(2)  299/ 600076C :                     ; 		mov	#RAM_Mars_Background,r14
(2)  300/ 600076C :                     ; 		mov	@(mbg_data,r14),r0
(2)  301/ 600076C :                     ; 		mov	r0,r13
(2)  302/ 600076C :                     ; 		mov	#_framebuffer+$200,r12
(2)  303/ 600076C :                     ; 		mov.w	@(mbg_width,r14),r0
(2)  304/ 600076C :                     ; 		mov	r0,r11
(2)  305/ 600076C :                     ; 		mov	#MSCRL_WIDTH,r10
(2)  306/ 600076C :                     ; 		mov	#MSCRL_HEIGHT,r9
(2)  307/ 600076C :                     ; 		mov	#1,r8
(2)  308/ 600076C :                     ; 		mov	r12,r3
(2)  309/ 600076C :                     ; 		mov	#(MSCRL_WIDTH*MSCRL_HEIGHT),r0
(2)  310/ 600076C :                     ; 		add	r0,r3
(2)  311/ 600076C :                     ; .y_loop:
(2)  312/ 600076C :                     ; 		mov	r13,r5
(2)  313/ 600076C :                     ; 		mov	r12,r6
(2)  314/ 600076C :                     ; 		mov	#MSCRL_WIDTH/4,r7
(2)  315/ 600076C :                     ; .x_loop:
(2)  316/ 600076C :                     ; 		mov	@r5+,r0
(2)  317/ 600076C :                     ; 		mov	r0,@r6
(2)  318/ 600076C :                     ; 		cmp/pl	r8
(2)  319/ 600076C :                     ; 		bf	.notopln
(2)  320/ 600076C :                     ; 		mov	r0,@r3
(2)  321/ 600076C :                     ; 		add	#4,r3
(2)  322/ 600076C :                     ; .notopln
(2)  323/ 600076C :                     ; 		dt	r7
(2)  324/ 600076C :                     ; 		bf/s	.x_loop
(2)  325/ 600076C :                     ; 		add	#4,r6
(2)  326/ 600076C :                     ; 		add	r10,r12
(2)  327/ 600076C :                     ; 		add	r11,r13
(2)  328/ 600076C :                     ; 		dt	r9
(2)  329/ 600076C :                     ; 		bf/s	.y_loop
(2)  330/ 600076C :                     ; 		add	#-1,r8
(2)  331/ 600076C :                     ;
(2)  332/ 600076C :                     ; 		mov	#0,r0
(2)  333/ 600076C :                     ; 		mov.w	r0,@(mbg_xinc_l,r14)
(2)  334/ 600076C :                     ; 		mov	#MSCRL_WIDTH-MSCRL_BLKSIZE,r0
(2)  335/ 600076C :                     ; 		mov.w	r0,@(mbg_xinc_r,r14)
(2)  336/ 600076C :                     ; 		mov	#0,r0
(2)  337/ 600076C :                     ; 		mov.w	r0,@(mbg_yfb,r14)
(2)  338/ 600076C :                     ; 		mov	#MSCRL_HEIGHT-MSCRL_BLKSIZE,r0
(2)  339/ 600076C :                     ; 		mov.w	r0,@(mbg_yinc_d,r14)
(2)  340/ 600076C :                     ; 		mov.w	r0,@(mbg_yfb_d,r14)
(2)  341/ 600076C :                     ;
(2)  342/ 600076C :                     ; 		lds	@r15+,pr
(2)  343/ 600076C :                     ; 		rts
(2)  344/ 600076C :                     ; 		nop
(2)  345/ 600076C :                     ; 		align 4
(2)  346/ 600076C : 000B                		rts
(2)  347/ 600076E : 0009                		nop
(2)  348/ 6000770 :                     		align 4
(2)  349/ 6000770 : 0600 4630 2400 0200 		ltorg
                    0001 5000 00F0 0150 
                    0100 0140           
(2)  350/ 6000784 :                     
(2)  351/ 6000784 :                     ; 		mov	#-2,r4
(2)  352/ 6000784 :                     ; 		mov	@(mbg_data,r14),r0
(2)  353/ 6000784 :                     ; 		mov	r0,r8
(2)  354/ 6000784 :                     ; 		mov	r0,r9
(2)  355/ 6000784 :                     ; 		mov.w	@(mbg_height,r14),r0
(2)  356/ 6000784 :                     ; 		mov	r0,r1
(2)  357/ 6000784 :                     ; 		mov.w	@(mbg_width,r14),r0
(2)  358/ 6000784 :                     ; 		mulu	r1,r0
(2)  359/ 6000784 :                     ; 		sts	macl,r0
(2)  360/ 6000784 :                     ; 		add	r0,r9
(2)  361/ 6000784 :                     ;
(2)  362/ 6000784 :                     ; 		mov	@(mbg_data,r14),r0
(2)  363/ 6000784 :                     ; 		mov	r0,r1			; r1 - read
(2)  364/ 6000784 :                     ; 		mov	r0,r2			; r2 - start
(2)  365/ 6000784 :                     ; 		mov	r0,r3			; r3 - end
(2)  366/ 6000784 :                     ; 		mov.w	@(mbg_width,r14),r0
(2)  367/ 6000784 :                     ; 		add	r0,r3
(2)  368/ 6000784 :                     ; 		mov	#_framebuffer+$200,r5
(2)  369/ 6000784 :                     ; 		mov	#MSCRL_HEIGHT,r7
(2)  370/ 6000784 :                     ; .y_next:
(2)  371/ 6000784 :                     ; 		mov	r5,r4
(2)  372/ 6000784 :                     ; 		mov	#(MSCRL_WIDTH)/4,r6
(2)  373/ 6000784 :                     ; .x_next:
(2)  374/ 6000784 :                     ; 		cmp/ge	r3,r1
(2)  375/ 6000784 :                     ; 		bf	.nolm
(2)  376/ 6000784 :                     ; 		mov	r2,r1
(2)  377/ 6000784 :                     ; .nolm:
(2)  378/ 6000784 :                     ; 		mov	@r1+,r0
(2)  379/ 6000784 :                     ; 		mov	r0,@r4
(2)  380/ 6000784 :                     ; 		add	#4,r4
(2)  381/ 6000784 :                     ; 		dt	r6
(2)  382/ 6000784 :                     ; 		bf	.x_next
(2)  383/ 6000784 :                     ; 		mov	#MSCRL_WIDTH,r0
(2)  384/ 6000784 :                     ; 		add	r0,r5
(2)  385/ 6000784 :                     ; 		mov.w	@(mbg_width,r14),r0
(2)  386/ 6000784 :                     ; 		add	r0,r2
(2)  387/ 6000784 :                     ; 		add	r0,r3
(2)  388/ 6000784 :                     ; 		cmp/ge	r9,r2
(2)  389/ 6000784 :                     ; 		bf	.ylrge
(2)  390/ 6000784 :                     ; 		mov	r8,r2
(2)  391/ 6000784 :                     ; 		mov	r8,r3
(2)  392/ 6000784 :                     ; 		add	r0,r3
(2)  393/ 6000784 :                     ; .ylrge:
(2)  394/ 6000784 :                     ; 		mov	r2,r1
(2)  395/ 6000784 :                     ; 		dt	r7
(2)  396/ 6000784 :                     ; 		bf	.y_next
(2)  397/ 6000784 :                     
(2)  398/ 6000784 :                     ; 	; Copy-paste but for hidden line
(2)  399/ 6000784 :                     ; 	; (TODO: improve this)
(2)  400/ 6000784 :                     ; 		mov	@(mbg_data,r14),r0
(2)  401/ 6000784 :                     ; 		mov	r0,r1			; r1 - read
(2)  402/ 6000784 :                     ; 		mov	r0,r2			; r2 - start
(2)  403/ 6000784 :                     ; 		mov	r0,r3			; r3 - end
(2)  404/ 6000784 :                     ; 		mov.w	@(mbg_width,r14),r0
(2)  405/ 6000784 :                     ; 		add	r0,r3
(2)  406/ 6000784 :                     ; 		mov	#(_framebuffer+$200)+(MSCRL_WIDTH*MSCRL_HEIGHT),r5
(2)  407/ 6000784 :                     ; 		mov	r5,r4
(2)  408/ 6000784 :                     ; 		mov	#(320+16)/4,r6
(2)  409/ 6000784 :                     ; .x_next_l:
(2)  410/ 6000784 :                     ; 		cmp/ge	r3,r1
(2)  411/ 6000784 :                     ; 		bf	.nolm_l
(2)  412/ 6000784 :                     ; 		mov	r2,r1
(2)  413/ 6000784 :                     ; .nolm_l:
(2)  414/ 6000784 :                     ; 		mov	@r1+,r0
(2)  415/ 6000784 :                     ; 		mov	r0,@r4
(2)  416/ 6000784 :                     ; 		add	#4,r4
(2)  417/ 6000784 :                     ; 		dt	r6
(2)  418/ 6000784 :                     ; 		bf	.x_next_l
(2)  419/ 6000784 :                     ; .stop:
(2)  420/ 6000784 :                     
(2)  421/ 6000784 :                     ; ---------------------------------------
(2)  422/ 6000784 :                     ; Move background and update it with
(2)  423/ 6000784 :                     ; the new values
(2)  424/ 6000784 :                     ;
(2)  425/ 6000784 :                     ; r14 - Background data
(2)  426/ 6000784 :                     ; ---------------------------------------
(2)  427/ 6000784 :                     
(2)  428/ 6000784 :                     MarsVideo_MoveBg:
(2)  429/ 6000784 : DE6C                		mov	#RAM_Mars_Background,r14
(2)  430/ 6000786 : E100                		mov	#0,r1
(2)  431/ 6000788 : E200                		mov	#0,r2
(2)  432/ 600078A : 50EC                		mov	@(mbg_xpos,r14),r0	; 0000.0000
(2)  433/ 600078C : 4029                		shlr16	r0
(2)  434/ 600078E : 600F                		exts.w	r0,r0
(2)  435/ 6000790 : 6303                		mov	r0,r3
(2)  436/ 6000792 : 85E4                		mov.w	@(mbg_xpos_old,r14),r0
(2)  437/ 6000794 : 3300                		cmp/eq	r0,r3
(2)  438/ 6000796 : 8901                		bt	.xequ
(2)  439/ 6000798 : 6133                		mov	r3,r1
(2)  440/ 600079A : 3108                		sub	r0,r1
(2)  441/ 600079C :                     .xequ:
(2)  442/ 600079C : 6033                		mov	r3,r0
(2)  443/ 600079E : 81E4                		mov.w	r0,@(mbg_xpos_old,r14)
(2)  444/ 60007A0 : 50ED                		mov	@(mbg_ypos,r14),r0	; 0000.0000
(2)  445/ 60007A2 : 4029                		shlr16	r0
(2)  446/ 60007A4 : 600F                		exts.w	r0,r0
(2)  447/ 60007A6 : 6303                		mov	r0,r3
(2)  448/ 60007A8 : 85E5                		mov.w	@(mbg_ypos_old,r14),r0
(2)  449/ 60007AA : 3300                		cmp/eq	r0,r3
(2)  450/ 60007AC : 8901                		bt	.yequ
(2)  451/ 60007AE : 6233                		mov	r3,r2
(2)  452/ 60007B0 : 3208                		sub	r0,r2
(2)  453/ 60007B2 :                     .yequ:
(2)  454/ 60007B2 : 6033                		mov	r3,r0
(2)  455/ 60007B4 : 81E5                		mov.w	r0,@(mbg_ypos_old,r14)
(2)  456/ 60007B6 : 4111                		cmp/pz	r1
(2)  457/ 60007B8 : 8900                		bt	.x_stend
(2)  458/ 60007BA : 611F                		exts	r1,r1
(2)  459/ 60007BC :                     .x_stend:
(2)  460/ 60007BC : 4211                		cmp/pz	r2
(2)  461/ 60007BE : 8900                		bt	.y_stend
(2)  462/ 60007C0 : 622F                		exts	r2,r2
(2)  463/ 60007C2 :                     .y_stend:
(2)  464/ 60007C2 : C500                		mov.w	@(marsGbl_XShift,gbr),r0	; Also update the XShift
(2)  465/ 60007C4 : 301C                		add	r1,r0				; bit for 256-color mode
(2)  466/ 60007C6 : C100                		mov.w	r0,@(marsGbl_XShift,gbr)
(2)  467/ 60007C8 :                     
(2)  468/ 60007C8 :                     	; ---------------------------------------
(2)  469/ 60007C8 :                     	; Y Framebuffer position (direct)
(2)  470/ 60007C8 :                     	; ---------------------------------------
(2)  471/ 60007C8 :                     
(2)  473/ 60007C8 : 85EC                		mov.w	@(mbg_yfb,r14),r0
(2)  474/ 60007CA : 302C                		add	r2,r0
(2)  475/ 60007CC : C9FF                		and	#$FF,r0
(2)  476/ 60007CE : 81EC                		mov.w	r0,@(mbg_yfb,r14)
(2)  477/ 60007D0 : 85ED                		mov.w	@(mbg_yfb_d,r14),r0
(2)  478/ 60007D2 : 302C                		add	r2,r0
(2)  479/ 60007D4 : C9FF                		and	#$FF,r0
(2)  480/ 60007D6 : 81ED                		mov.w	r0,@(mbg_yfb_d,r14)
(2)  519/ 60007D8 :                     
(2)  520/ 60007D8 :                     	; ---------------------------------------
(2)  521/ 60007D8 :                     	; Update Framebuffer TOP-LEFT position
(2)  522/ 60007D8 :                     	; ---------------------------------------
(2)  523/ 60007D8 :                     
(2)  524/ 60007D8 : D058                		mov	#(MSCRL_WIDTH*MSCRL_HEIGHT),r0
(2)  525/ 60007DA : 6303                		mov	r0,r3
(2)  526/ 60007DC : 50EE                		mov	@(mbg_fb,r14),r0
(2)  527/ 60007DE : 301C                		add	r1,r0
(2)  528/ 60007E0 : 4115                		cmp/pl	r1
(2)  529/ 60007E2 : 8B02                		bf	.yx_negtv
(2)  530/ 60007E4 : 3037                		cmp/gt	r3,r0
(2)  531/ 60007E6 : 8B00                		bf	.yx_negtv
(2)  532/ 60007E8 : 3038                		sub	r3,r0
(2)  533/ 60007EA :                     .yx_negtv:
(2)  534/ 60007EA : 4111                		cmp/pz	r1
(2)  535/ 60007EC : 8902                		bt	.yx_postv
(2)  536/ 60007EE : 4011                		cmp/pz	r0
(2)  537/ 60007F0 : 8900                		bt	.yx_postv
(2)  538/ 60007F2 : 303C                		add	r3,r0
(2)  539/ 60007F4 :                     .yx_postv:
(2)  540/ 60007F4 : 1E0E                		mov	r0,@(mbg_fb,r14)
(2)  541/ 60007F6 :                     
(2)  542/ 60007F6 :                     	; ---------------------------------------
(2)  543/ 60007F6 :                     	; Update background draw-heads
(2)  544/ 60007F6 :                     	; r1 - X left/right
(2)  545/ 60007F6 :                     	; r2 - Y up/down
(2)  546/ 60007F6 :                     	; ---------------------------------------
(2)  547/ 60007F6 :                     
(2)  548/ 60007F6 : 85EA                		mov.w	@(mbg_width,r14),r0
(2)  549/ 60007F8 : 6303                		mov	r0,r3
(2)  550/ 60007FA : 85EB                		mov.w	@(mbg_height,r14),r0
(2)  551/ 60007FC : 6403                		mov	r0,r4
(2)  552/ 60007FE : 85E7                		mov.w	@(mbg_xinc_r,r14),r0
(2)  553/ 6000800 : 6503                		mov	r0,r5
(2)  554/ 6000802 : 85E6                		mov.w	@(mbg_xinc_l,r14),r0
(2)  555/ 6000804 : 6603                		mov	r0,r6
(2)  556/ 6000806 : 85E8                		mov.w	@(mbg_yinc_u,r14),r0
(2)  557/ 6000808 : 6703                		mov	r0,r7
(2)  558/ 600080A : 85E9                		mov.w	@(mbg_yinc_d,r14),r0
(2)  559/ 600080C : 6803                		mov	r0,r8
(2)  560/ 600080E : 351C                		add	r1,r5
(2)  561/ 6000810 : 4115                		cmp/pl	r1
(2)  562/ 6000812 : 8B02                		bf	.xnegtv
(2)  563/ 6000814 : 3533                		cmp/ge	r3,r5
(2)  564/ 6000816 : 8B00                		bf	.xnegtv
(2)  565/ 6000818 : 3538                		sub	r3,r5
(2)  566/ 600081A :                     .xnegtv:
(2)  567/ 600081A : 4111                		cmp/pz	r1
(2)  568/ 600081C : 8902                		bt	.xpostv
(2)  569/ 600081E : 4511                		cmp/pz	r5
(2)  570/ 6000820 : 8900                		bt	.xpostv
(2)  571/ 6000822 : 353C                		add	r3,r5
(2)  572/ 6000824 :                     .xpostv:
(2)  573/ 6000824 : 361C                		add	r1,r6
(2)  574/ 6000826 : 4115                		cmp/pl	r1
(2)  575/ 6000828 : 8B02                		bf	.xnegtvl
(2)  576/ 600082A : 3633                		cmp/ge	r3,r6
(2)  577/ 600082C : 8B00                		bf	.xnegtvl
(2)  578/ 600082E : 3638                		sub	r3,r6
(2)  579/ 6000830 :                     .xnegtvl:
(2)  580/ 6000830 : 4111                		cmp/pz	r1
(2)  581/ 6000832 : 8902                		bt	.xpostvl
(2)  582/ 6000834 : 4611                		cmp/pz	r6
(2)  583/ 6000836 : 8900                		bt	.xpostvl
(2)  584/ 6000838 : 363C                		add	r3,r6
(2)  585/ 600083A :                     .xpostvl:
(2)  586/ 600083A :                     
(2)  587/ 600083A : 372C                		add	r2,r7
(2)  588/ 600083C : 4215                		cmp/pl	r2
(2)  589/ 600083E : 8B02                		bf	.ynegtv
(2)  590/ 6000840 : 3743                		cmp/ge	r4,r7
(2)  591/ 6000842 : 8B00                		bf	.ynegtv
(2)  592/ 6000844 : 3748                		sub	r4,r7
(2)  593/ 6000846 :                     .ynegtv:
(2)  594/ 6000846 : 4211                		cmp/pz	r2
(2)  595/ 6000848 : 8902                		bt	.ypostv
(2)  596/ 600084A : 4711                		cmp/pz	r7
(2)  597/ 600084C : 8900                		bt	.ypostv
(2)  598/ 600084E : 374C                		add	r4,r7
(2)  599/ 6000850 :                     .ypostv:
(2)  600/ 6000850 : 382C                		add	r2,r8
(2)  601/ 6000852 : 4215                		cmp/pl	r2
(2)  602/ 6000854 : 8B02                		bf	.ynegtvl
(2)  603/ 6000856 : 3843                		cmp/ge	r4,r8
(2)  604/ 6000858 : 8B00                		bf	.ynegtvl
(2)  605/ 600085A : 3848                		sub	r4,r8
(2)  606/ 600085C :                     .ynegtvl:
(2)  607/ 600085C : 4211                		cmp/pz	r2
(2)  608/ 600085E : 8902                		bt	.ypostvl
(2)  609/ 6000860 : 4811                		cmp/pz	r8
(2)  610/ 6000862 : 8900                		bt	.ypostvl
(2)  611/ 6000864 : 384C                		add	r4,r8
(2)  612/ 6000866 :                     .ypostvl:
(2)  613/ 6000866 : 6053                		mov	r5,r0
(2)  614/ 6000868 : 81E7                		mov.w	r0,@(mbg_xinc_r,r14)
(2)  615/ 600086A : 6063                		mov	r6,r0
(2)  616/ 600086C : 81E6                		mov.w	r0,@(mbg_xinc_l,r14)
(2)  617/ 600086E : 6073                		mov	r7,r0
(2)  618/ 6000870 : 81E8                		mov.w	r0,@(mbg_yinc_u,r14)
(2)  619/ 6000872 : 6083                		mov	r8,r0
(2)  620/ 6000874 : 81E9                		mov.w	r0,@(mbg_yinc_d,r14)
(2)  621/ 6000876 :                     
(2)  622/ 6000876 :                     	; ---------------------------------------
(2)  623/ 6000876 :                     
(2)  624/ 6000876 : E500                		mov	#0,r5
(2)  625/ 6000878 : 84E6                		mov.b	@(mbg_yset,r14),r0
(2)  626/ 600087A : 302C                		add	r2,r0
(2)  627/ 600087C : 6603                		mov	r0,r6
(2)  628/ 600087E : C8F0                		tst	#(-MSCRL_BLKSIZE)&$FF,r0
(2)  629/ 6000880 : 8916                		bt	.ydr_busy
(2)  630/ 6000882 : E3F0                		mov	#-MSCRL_BLKSIZE,r3
(2)  631/ 6000884 : 4215                		cmp/pl	r2
(2)  632/ 6000886 : 8B08                		bf	.reqd_b
(2)  633/ 6000888 : 84E4                		mov.b	@(mbg_draw_u,r14),r0
(2)  634/ 600088A : 6403                		mov	r0,r4
(2)  635/ 600088C : 84E3                		mov.b	@(mbg_draw_d,r14),r0
(2)  636/ 600088E : 204B                		or	r4,r0
(2)  637/ 6000890 : 8800                		cmp/eq	#0,r0
(2)  638/ 6000892 : 8B0D                		bf	.ydr_busy
(2)  639/ 6000894 : E002                		mov	#2,r0
(2)  640/ 6000896 : 80E3                		mov.b	r0,@(mbg_draw_d,r14)
(2)  641/ 6000898 : 7501                		add	#$01,r5
(2)  642/ 600089A :                     .reqd_b:
(2)  643/ 600089A : 4211                		cmp/pz	r2
(2)  644/ 600089C : 8908                		bt	.ydr_busy
(2)  645/ 600089E : 84E4                		mov.b	@(mbg_draw_u,r14),r0
(2)  646/ 60008A0 : 6403                		mov	r0,r4
(2)  647/ 60008A2 : 84E3                		mov.b	@(mbg_draw_d,r14),r0
(2)  648/ 60008A4 : 204B                		or	r4,r0
(2)  649/ 60008A6 : 8800                		cmp/eq	#0,r0
(2)  650/ 60008A8 : 8B02                		bf	.ydr_busy
(2)  651/ 60008AA : E002                		mov	#2,r0
(2)  652/ 60008AC : 80E4                		mov.b	r0,@(mbg_draw_u,r14)
(2)  653/ 60008AE : 7501                		add	#$01,r5
(2)  654/ 60008B0 :                     .ydr_busy:
(2)  655/ 60008B0 : 6063                		mov	r6,r0
(2)  656/ 60008B2 : C90F                		and	#MSCRL_BLKSIZE-1,r0
(2)  657/ 60008B4 : 80E6                		mov.b	r0,@(mbg_yset,r14)
(2)  658/ 60008B6 : 84E5                		mov.b	@(mbg_xset,r14),r0
(2)  659/ 60008B8 : 301C                		add	r1,r0
(2)  660/ 60008BA : 6603                		mov	r0,r6
(2)  661/ 60008BC : C8F0                		tst	#(-MSCRL_BLKSIZE)&$FF,r0
(2)  662/ 60008BE : 8916                		bt	.ydl_busy
(2)  663/ 60008C0 : E3F0                		mov	#-MSCRL_BLKSIZE,r3
(2)  664/ 60008C2 : 4115                		cmp/pl	r1
(2)  665/ 60008C4 : 8B08                		bf	.reqr_b
(2)  666/ 60008C6 : 84E2                		mov.b	@(mbg_draw_l,r14),r0
(2)  667/ 60008C8 : 6403                		mov	r0,r4
(2)  668/ 60008CA : 84E1                		mov.b	@(mbg_draw_r,r14),r0
(2)  669/ 60008CC : 204B                		or	r4,r0
(2)  670/ 60008CE : 8800                		cmp/eq	#0,r0
(2)  671/ 60008D0 : 8B0D                		bf	.ydl_busy
(2)  672/ 60008D2 :                     
(2)  673/ 60008D2 : E002                		mov	#2,r0
(2)  674/ 60008D4 : 80E1                		mov.b	r0,@(mbg_draw_r,r14)
(2)  675/ 60008D6 : 7502                		add	#$02,r5
(2)  676/ 60008D8 :                     .reqr_b:
(2)  677/ 60008D8 : 4111                		cmp/pz	r1
(2)  678/ 60008DA : 8908                		bt	.ydl_busy
(2)  679/ 60008DC : 84E2                		mov.b	@(mbg_draw_l,r14),r0
(2)  680/ 60008DE : 6403                		mov	r0,r4
(2)  681/ 60008E0 : 84E1                		mov.b	@(mbg_draw_r,r14),r0
(2)  682/ 60008E2 : 204B                		or	r4,r0
(2)  683/ 60008E4 : 8800                		cmp/eq	#0,r0
(2)  684/ 60008E6 : 8B02                		bf	.ydl_busy
(2)  685/ 60008E8 :                     
(2)  686/ 60008E8 : E002                		mov	#2,r0
(2)  687/ 60008EA : 80E2                		mov.b	r0,@(mbg_draw_l,r14)
(2)  688/ 60008EC : 7502                		add	#$02,r5
(2)  689/ 60008EE :                     .ydl_busy:
(2)  690/ 60008EE : 6063                		mov	r6,r0
(2)  691/ 60008F0 : C90F                		and	#MSCRL_BLKSIZE-1,r0
(2)  692/ 60008F2 : 80E5                		mov.b	r0,@(mbg_xset,r14)
(2)  693/ 60008F4 :                     
(2)  694/ 60008F4 :                     	; Make snapshot of scroll variables
(2)  695/ 60008F4 :                     	; to CACHE
(2)  696/ 60008F4 : 4515                		cmp/pl	r5
(2)  697/ 60008F6 : 8B1C                		bf	.dont_snap
(2)  698/ 60008F8 : E4F0                		mov	#-MSCRL_BLKSIZE,r4
(2)  699/ 60008FA :                     
(2)  700/ 60008FA : D111                		mov	#Cach_XHead_L,r1
(2)  701/ 60008FC : D211                		mov	#Cach_XHead_R,r2
(2)  702/ 60008FE : 85E6                		mov.w	@(mbg_xinc_l,r14),r0
(2)  703/ 6000900 : 2049                		and	r4,r0
(2)  704/ 6000902 : 2102                		mov	r0,@r1
(2)  705/ 6000904 : 85E7                		mov.w	@(mbg_xinc_r,r14),r0
(2)  706/ 6000906 : 2049                		and	r4,r0
(2)  707/ 6000908 : 2202                		mov	r0,@r2
(2)  708/ 600090A :                     
(2)  709/ 600090A : D10F                		mov	#Cach_YHead_U,r1
(2)  710/ 600090C : D20F                		mov	#Cach_YHead_D,r2
(2)  711/ 600090E : 85E8                		mov.w	@(mbg_yinc_u,r14),r0
(2)  712/ 6000910 : 2049                		and	r4,r0
(2)  713/ 6000912 : 2102                		mov	r0,@r1
(2)  714/ 6000914 : 85E9                		mov.w	@(mbg_yinc_d,r14),r0
(2)  715/ 6000916 : 2049                		and	r4,r0
(2)  716/ 6000918 : 2202                		mov	r0,@r2
(2)  717/ 600091A :                     
(2)  718/ 600091A : 85EC                		mov.w	@(mbg_yfb,r14),r0
(2)  719/ 600091C : D10C                		mov	#Cach_BgFbPos_U,r1
(2)  720/ 600091E : 2049                		and	r4,r0
(2)  721/ 6000920 : 2102                		mov	r0,@r1
(2)  722/ 6000922 : 85ED                		mov.w	@(mbg_yfb_d,r14),r0
(2)  723/ 6000924 : D10B                		mov	#Cach_BgFbPos_D,r1
(2)  724/ 6000926 : 2049                		and	r4,r0
(2)  725/ 6000928 : 2102                		mov	r0,@r1
(2)  726/ 600092A : 50EE                		mov	@(mbg_fb,r14),r0
(2)  727/ 600092C : D10A                		mov	#Cach_BgFbPos_LR,r1
(2)  728/ 600092E : 2049                		and	r4,r0
(2)  729/ 6000930 : 2102                		mov	r0,@r1
(2)  730/ 6000932 :                     
(2)  731/ 6000932 :                     .dont_snap:
(2)  732/ 6000932 :                     
(2)  733/ 6000932 : 000B                		rts
(2)  734/ 6000934 : 0009                		nop
(2)  735/ 6000936 :                     		align 4
(2)  736/ 6000938 : 0600 4630 0001 5000 		ltorg
                    C000 0010 C000 0014 
                    C000 001C C000 0018 
                    C000 0020 C000 0024 
                    C000 0028           
(2)  737/ 600095C :                     
(2)  738/ 600095C :                     ; ---------------------------------------
(2)  739/ 600095C :                     ; Build the linetable
(2)  740/ 600095C :                     ;
(2)  741/ 600095C :                     ; r14 - Background buffer
(2)  742/ 600095C :                     ; ---------------------------------------
(2)  743/ 600095C :                     
(2)  744/ 600095C :                     MarsVideo_MakeTbl:
(2)  745/ 600095C : DE2D                		mov	#RAM_Mars_Background,r14
(2)  746/ 600095E :                     
(2)  747/ 600095E :                     ; 		mov	#rot_angle,r1
(2)  748/ 600095E :                     ; 		mov	@r1,r2
(2)  749/ 600095E :                     ; 		mov	r2,r4
(2)  750/ 600095E :                     ; 		mov	#$7FF,r3
(2)  751/ 600095E :                     ; 		add	#4,r4		; wave speed
(2)  752/ 600095E :                     ; 		and	r3,r4
(2)  753/ 600095E :                     ; 		mov	r4,@r1
(2)  754/ 600095E : E300                		mov	#0,r3
(2)  755/ 6000960 : E400                		mov	#0,r4
(2)  756/ 6000962 : DA2D                		mov	#_framebuffer,r10
(2)  757/ 6000964 : 9864                		mov	#$200,r8			; TOP FB position
(2)  758/ 6000966 : D72D                		mov	#(MSCRL_WIDTH*MSCRL_HEIGHT),r7	; Last line point
(2)  759/ 6000968 : 85EC                		mov.w	@(mbg_yfb,r14),r0
(2)  760/ 600096A : 9662                		mov	#MSCRL_WIDTH,r6
(2)  761/ 600096C : 206E                		mulu	r6,r0
(2)  762/ 600096E : 051A                		sts	macl,r5
(2)  763/ 6000970 : 50EE                		mov	@(mbg_fb,r14),r0
(2)  764/ 6000972 : 6103                		mov	r0,r1
(2)  765/ 6000974 : 6913                		mov	r1,r9
(2)  766/ 6000976 : 395C                		add	r5,r9
(2)  767/ 6000978 : 85EE                		mov.w	@(mbg_maxlines,r14),r0	; Number of lines to show
(2)  768/ 600097A : 4015                		cmp/pl	r0
(2)  769/ 600097C : 8B0F                		bf	.no_lines
(2)  770/ 600097E : 6503                		mov	r0,r5
(2)  771/ 6000980 :                     .ln_loop:
(2)  772/ 6000980 :                     ; 		mov	#$7FF,r3
(2)  773/ 6000980 :                     ; 		mov	r2,r0
(2)  774/ 6000980 :                     ; 		add	#16,r2		; wave distord
(2)  775/ 6000980 :                     ; 		and	r3,r2
(2)  776/ 6000980 :                     ; 		shll2	r0
(2)  777/ 6000980 :                     ; 		mov	#sin_table,r3
(2)  778/ 6000980 :                     ; 		mov	@(r0,r3),r4
(2)  779/ 6000980 :                     ; 		mov	#8,r0		; wave max X
(2)  780/ 6000980 :                     ; 		dmuls	r0,r4
(2)  781/ 6000980 :                     ; 		sts	macl,r4
(2)  782/ 6000980 :                     ; 		shlr16	r4
(2)  783/ 6000980 :                     ; 		exts.w	r4,r4
(2)  784/ 6000980 : 6193                		mov	r9,r1
(2)  785/ 6000982 : 3173                		cmp/ge	r7,r1
(2)  786/ 6000984 : 8B00                		bf	.xl_r
(2)  787/ 6000986 : 3178                		sub	r7,r1
(2)  788/ 6000988 :                     .xl_r:
(2)  789/ 6000988 : 4111                		cmp/pz	r1
(2)  790/ 600098A : 8900                		bt	.xl_l
(2)  791/ 600098C : 317C                		add	r7,r1
(2)  792/ 600098E :                     .xl_l:
(2)  793/ 600098E : 6913                		mov	r1,r9
(2)  794/ 6000990 : 396C                		add	r6,r9		; Add Y
(2)  795/ 6000992 : 318C                		add	r8,r1		; Add FB base pos
(2)  796/ 6000994 : 4101                		shlr	r1		; divide by 2 (shift reg does the missing bit 0)
(2)  797/ 6000996 :                     ; 		add	r4,r1
(2)  798/ 6000996 : 2A11                		mov.w	r1,@r10		; send to FB's table
(2)  799/ 6000998 : 4510                		dt	r5
(2)  800/ 600099A : 8FF1                		bf/s	.ln_loop
(2)  801/ 600099C : 7A02                		add	#2,r10
(2)  802/ 600099E :                     .no_lines:
(2)  803/ 600099E : 000B                		rts
(2)  804/ 60009A0 : 0009                		nop
(2)  805/ 60009A2 :                     		align 4
(2)  806/ 60009A4 :                     
(2)  807/ 60009A4 :                     ; ---------------------------------------
(2)  808/ 60009A4 :                     ; Draw Left/Right sections
(2)  809/ 60009A4 :                     ; ---------------------------------------
(2)  810/ 60009A4 :                     
(2)  811/ 60009A4 :                     MarsVideo_BgDrawLR:
(2)  812/ 60009A4 : DE1E                		mov	#RAM_Mars_Background,r14
(2)  813/ 60009A6 : 50EA                		mov	@(mbg_data,r14),r0
(2)  814/ 60009A8 : 4015                		cmp/pl	r0
(2)  815/ 60009AA : 8B66                		bf	nxt_drawud
(2)  816/ 60009AC : E4F0                		mov	#-MSCRL_BLKSIZE,r4
(2)  817/ 60009AE : 9D41                		mov	#256,r13
(2)  818/ 60009B0 : EC04                		mov	#MSCRL_BLKSIZE/4,r12
(2)  819/ 60009B2 : DB1C                		mov	#Cach_BgFbPos_LR,r11
(2)  820/ 60009B4 : 6BB2                		mov	@r11,r11
(2)  821/ 60009B6 : 85EC                		mov.w	@(mbg_yfb,r14),r0
(2)  822/ 60009B8 : 2049                		and	r4,r0
(2)  823/ 60009BA : 933A                		mov	#MSCRL_WIDTH,r3
(2)  824/ 60009BC : 203E                		mulu	r3,r0
(2)  825/ 60009BE : 001A                		sts	macl,r0
(2)  826/ 60009C0 : 3B0C                		add	r0,r11
(2)  827/ 60009C2 : DA16                		mov	#(MSCRL_WIDTH*MSCRL_HEIGHT),r10
(2)  828/ 60009C4 : D918                		mov	#_framebuffer+$200,r9
(2)  829/ 60009C6 : 50EA                		mov	@(mbg_data,r14),r0
(2)  830/ 60009C8 : 6803                		mov	r0,r8
(2)  831/ 60009CA : 6703                		mov	r0,r7
(2)  832/ 60009CC : 85EB                		mov.w	@(mbg_height,r14),r0
(2)  833/ 60009CE : 6603                		mov	r0,r6
(2)  834/ 60009D0 : 85EA                		mov.w	@(mbg_width,r14),r0
(2)  835/ 60009D2 : 206E                		mulu	r6,r0
(2)  836/ 60009D4 : 061A                		sts	macl,r6
(2)  837/ 60009D6 : 367C                		add	r7,r6
(2)  838/ 60009D8 : 6303                		mov	r0,r3
(2)  839/ 60009DA : 85E8                		mov.w	@(mbg_yinc_u,r14),r0
(2)  840/ 60009DC : 2049                		and	r4,r0
(2)  841/ 60009DE : 203E                		mulu	r3,r0
(2)  842/ 60009E0 : 001A                		sts	macl,r0
(2)  843/ 60009E2 : 380C                		add	r0,r8
(2)  844/ 60009E4 : 84E1                		mov.b	@(mbg_draw_r,r14),r0
(2)  845/ 60009E6 : 8800                		cmp/eq	#0,r0
(2)  846/ 60009E8 : 8B0A                		bf	.dtsk01_dright
(2)  847/ 60009EA : 84E2                		mov.b	@(mbg_draw_l,r14),r0
(2)  848/ 60009EC : 8800                		cmp/eq	#0,r0
(2)  849/ 60009EE : 8B01                		bf	.dtsk01_dleft
(2)  850/ 60009F0 : A043                		bra	nxt_drawud
(2)  851/ 60009F2 : 0009                		nop
(2)  852/ 60009F4 :                     		align 4
(2)  853/ 60009F4 :                     .dtsk01_dleft:
(2)  854/ 60009F4 : 4010                		dt	r0
(2)  855/ 60009F6 : 80E2                		mov.b	r0,@(mbg_draw_l,r14)
(2)  856/ 60009F8 : 85E6                		mov.w	@(mbg_xinc_l,r14),r0
(2)  857/ 60009FA : 2049                		and	r4,r0
(2)  858/ 60009FC : A01C                		bra	dtsk01_lrdraw
(2)  859/ 60009FE : 6503                		mov	r0,r5
(2)  860/ 6000A00 :                     .dtsk01_dright:
(2)  861/ 6000A00 : 4010                		dt	r0
(2)  862/ 6000A02 : 80E1                		mov.b	r0,@(mbg_draw_r,r14)
(2)  863/ 6000A04 : 9017                		mov	#320,r0			; Set FB position
(2)  864/ 6000A06 : 3B0C                		add	r0,r11
(2)  865/ 6000A08 : 2B49                		and	r4,r11
(2)  866/ 6000A0A : D008                		mov	#Cach_XHead_R,r0
(2)  867/ 6000A0C : 6002                		mov	@r0,r0
(2)  868/ 6000A0E :                     ; 		mov.w	@(mbg_xinc_r,r14),r0
(2)  869/ 6000A0E :                     ; 		and	r4,r0
(2)  870/ 6000A0E : A013                		bra	dtsk01_lrdraw
(2)  871/ 6000A10 : 6503                		mov	r0,r5
(2)  872/ 6000A12 :                     		align 4
(2)  873/ 6000A14 : 0600 4630 2400 0000 		ltorg
                    0001 5000 0600 4630 
                    C000 0028 2400 0200 
                    C000 0014 0200 0150 
                    0100 0140           
(2)  874/ 6000A38 :                     
(2)  875/ 6000A38 :                     	; r13 - Y lines
(2)  876/ 6000A38 :                     	; r12 - X block width
(2)  877/ 6000A38 :                     	; r11 - drawzone pos
(2)  878/ 6000A38 :                     	; r10 - drawzone size
(2)  879/ 6000A38 :                     	;  r9 - Framebuffer
(2)  880/ 6000A38 :                     	;  r8 - Pixeldata Y-Current
(2)  881/ 6000A38 :                     	;  r7 - Pixeldata Y-Start
(2)  882/ 6000A38 :                     	;  r6 - Pixeldata Y-End
(2)  883/ 6000A38 :                     	;  r5 - Xadd
(2)  884/ 6000A38 :                     dtsk01_lrdraw:
(2)  885/ 6000A38 : 3863                		cmp/ge	r6,r8
(2)  886/ 6000A3A : 8B00                		bf	.yres
(2)  887/ 6000A3C : 6873                		mov	r7,r8
(2)  888/ 6000A3E :                     .yres:
(2)  889/ 6000A3E : 64C3                		mov	r12,r4
(2)  890/ 6000A40 : 63B3                		mov	r11,r3
(2)  891/ 6000A42 : 6283                		mov	r8,r2
(2)  892/ 6000A44 : 325C                		add	r5,r2
(2)  893/ 6000A46 :                     ; X draw
(2)  894/ 6000A46 :                     .xline:
(2)  895/ 6000A46 : 33A3                		cmp/ge	r10,r3
(2)  896/ 6000A48 : 8B01                		bf	.prefix_r
(2)  897/ 6000A4A : 33A8                		sub	r10,r3
(2)  898/ 6000A4C : 6B33                		mov	r3,r11
(2)  899/ 6000A4E :                     .prefix_r:
(2)  900/ 6000A4E : 6133                		mov	r3,r1
(2)  901/ 6000A50 : 319C                		add	r9,r1
(2)  902/ 6000A52 : 6022                		mov	@r2,r0
(2)  903/ 6000A54 : 2102                		mov	r0,@r1
(2)  904/ 6000A56 : 9093                		mov	#320,r0		; Ex-line
(2)  905/ 6000A58 : 3307                		cmp/gt	r0,r3
(2)  906/ 6000A5A : 8904                		bt	.not_l2
(2)  907/ 6000A5C : 6133                		mov	r3,r1
(2)  908/ 6000A5E : 319C                		add	r9,r1
(2)  909/ 6000A60 : 31AC                		add	r10,r1
(2)  910/ 6000A62 : 6022                		mov	@r2,r0
(2)  911/ 6000A64 : 2102                		mov	r0,@r1
(2)  912/ 6000A66 :                     .not_l2:
(2)  913/ 6000A66 : 7204                		add	#4,r2
(2)  914/ 6000A68 : 4410                		dt	r4
(2)  915/ 6000A6A : 8FEC                		bf/s	.xline
(2)  916/ 6000A6C : 7304                		add	#4,r3
(2)  917/ 6000A6E : 85EA                		mov.w	@(mbg_width,r14),r0
(2)  918/ 6000A70 : 380C                		add	r0,r8
(2)  919/ 6000A72 : 9086                		mov	#MSCRL_WIDTH,r0
(2)  920/ 6000A74 : 4D10                		dt	r13
(2)  921/ 6000A76 : 8FDF                		bf/s	dtsk01_lrdraw
(2)  922/ 6000A78 : 3B0C                		add	r0,r11
(2)  923/ 6000A7A :                     nxt_drawud:
(2)  924/ 6000A7A : 000B                		rts
(2)  925/ 6000A7C : 0009                		nop
(2)  926/ 6000A7E :                     		align 4
(2)  927/ 6000A80 :                     
(2)  928/ 6000A80 :                     ; ---------------------------------------
(2)  929/ 6000A80 :                     ; Draw Up/Down sections
(2)  930/ 6000A80 :                     ; ---------------------------------------
(2)  931/ 6000A80 :                     
(2)  932/ 6000A80 :                     MarsVideo_BgDrawUD:
(2)  933/ 6000A80 : DE34                		mov	#RAM_Mars_Background,r14
(2)  934/ 6000A82 :                     
(2)  935/ 6000A82 : 50EA                		mov	@(mbg_data,r14),r0
(2)  936/ 6000A84 : 6B03                		mov	r0,r11
(2)  937/ 6000A86 : 6C03                		mov	r0,r12
(2)  938/ 6000A88 : 85EA                		mov.w	@(mbg_width,r14),r0
(2)  939/ 6000A8A : 6103                		mov	r0,r1
(2)  940/ 6000A8C : 85EB                		mov.w	@(mbg_height,r14),r0
(2)  941/ 6000A8E : 201E                		mulu	r1,r0
(2)  942/ 6000A90 : 001A                		sts	macl,r0
(2)  943/ 6000A92 : 3C0C                		add	r0,r12
(2)  944/ 6000A94 : 84E3                		mov.b	@(mbg_draw_d,r14),r0
(2)  945/ 6000A96 : 8800                		cmp/eq	#0,r0
(2)  946/ 6000A98 : 8B04                		bf	.tsk00_down
(2)  947/ 6000A9A : 84E4                		mov.b	@(mbg_draw_u,r14),r0
(2)  948/ 6000A9C : 8800                		cmp/eq	#0,r0
(2)  949/ 6000A9E : 8B13                		bf	.tsk00_up
(2)  950/ 6000AA0 : A055                		bra	drw_ud_exit
(2)  951/ 6000AA2 : 0009                		nop
(2)  952/ 6000AA4 :                     
(2)  953/ 6000AA4 :                     	; r2 - Start bg line
(2)  954/ 6000AA4 :                     	; r3 - End bg line
(2)  955/ 6000AA4 :                     	; r6 - Y current
(2)  956/ 6000AA4 :                     	; r5 - FB current base
(2)  957/ 6000AA4 :                     .tsk00_down:
(2)  958/ 6000AA4 : 4010                		dt	r0
(2)  959/ 6000AA6 : 80E3                		mov.b	r0,@(mbg_draw_d,r14)
(2)  960/ 6000AA8 :                     
(2)  961/ 6000AA8 : D22B                		mov	#Cach_YHead_D,r2
(2)  962/ 6000AAA : 6222                		mov	@r2,r2
(2)  963/ 6000AAC : 85EA                		mov.w	@(mbg_width,r14),r0
(2)  964/ 6000AAE : 6403                		mov	r0,r4
(2)  965/ 6000AB0 : 220F                		muls	r0,r2
(2)  966/ 6000AB2 : 021A                		sts	macl,r2
(2)  967/ 6000AB4 : 50EA                		mov	@(mbg_data,r14),r0
(2)  968/ 6000AB6 : 320C                		add	r0,r2
(2)  969/ 6000AB8 : 6323                		mov	r2,r3
(2)  970/ 6000ABA : 334C                		add	r4,r3
(2)  971/ 6000ABC : D527                		mov	#Cach_BgFbPos_LR,r5
(2)  972/ 6000ABE : 6552                		mov	@r5,r5
(2)  973/ 6000AC0 : D027                		mov	#Cach_BgFbPos_D,r0
(2)  974/ 6000AC2 : 6002                		mov	@r0,r0
(2)  975/ 6000AC4 : A011                		bra	.drwy_go
(2)  976/ 6000AC6 : 6603                		mov	r0,r6
(2)  977/ 6000AC8 :                     
(2)  978/ 6000AC8 :                     .tsk00_up:
(2)  979/ 6000AC8 : 4010                		dt	r0
(2)  980/ 6000ACA : 80E4                		mov.b	r0,@(mbg_draw_u,r14)
(2)  981/ 6000ACC :                     
(2)  982/ 6000ACC : D225                		mov	#Cach_YHead_U,r2
(2)  983/ 6000ACE : 6222                		mov	@r2,r2
(2)  984/ 6000AD0 : 85EA                		mov.w	@(mbg_width,r14),r0
(2)  985/ 6000AD2 : 6403                		mov	r0,r4
(2)  986/ 6000AD4 : 220F                		muls	r0,r2
(2)  987/ 6000AD6 : 021A                		sts	macl,r2
(2)  988/ 6000AD8 : 50EA                		mov	@(mbg_data,r14),r0
(2)  989/ 6000ADA : 320C                		add	r0,r2
(2)  990/ 6000ADC : 6323                		mov	r2,r3
(2)  991/ 6000ADE : 334C                		add	r4,r3
(2)  992/ 6000AE0 : D521                		mov	#Cach_BgFbPos_LR,r5
(2)  993/ 6000AE2 : 6552                		mov	@r5,r5
(2)  994/ 6000AE4 : D021                		mov	#Cach_BgFbPos_U,r0
(2)  995/ 6000AE6 : 6002                		mov	@r0,r0
(2)  996/ 6000AE8 : 6603                		mov	r0,r6
(2)  997/ 6000AEA :                     
(2)  998/ 6000AEA :                     .drwy_go:
(2)  999/ 6000AEA : E810                		mov	#MSCRL_BLKSIZE,r8
(2) 1000/ 6000AEC :                     .rept_y:
(2) 1001/ 6000AEC : 32C3                		cmp/ge	r12,r2
(2) 1002/ 6000AEE : 8B03                		bf	.ybgend
(2) 1003/ 6000AF0 : 62B3                		mov	r11,r2
(2) 1004/ 6000AF2 : 63B3                		mov	r11,r3
(2) 1005/ 6000AF4 : 85EA                		mov.w	@(mbg_width,r14),r0
(2) 1006/ 6000AF6 : 330C                		add	r0,r3
(2) 1007/ 6000AF8 :                     .ybgend:
(2) 1008/ 6000AF8 :                     
(2) 1009/ 6000AF8 : 6123                		mov	r2,r1		; r1 - bg pixel data
(2) 1010/ 6000AFA : E7F0                		mov	#-MSCRL_BLKSIZE,r7
(2) 1011/ 6000AFC : D01C                		mov	#Cach_XHead_L,r0
(2) 1012/ 6000AFE : 6002                		mov	@r0,r0
(2) 1013/ 6000B00 : 2079                		and	r7,r0
(2) 1014/ 6000B02 : 310C                		add	r0,r1
(2) 1015/ 6000B04 :                     
(2) 1016/ 6000B04 : 6453                		mov	r5,r4		; r4 - X
(2) 1017/ 6000B06 : 6063                		mov	r6,r0
(2) 1018/ 6000B08 : 973B                		mov	#MSCRL_WIDTH,r7
(2) 1019/ 6000B0A : 207E                		mulu	r7,r0
(2) 1020/ 6000B0C : 001A                		sts	macl,r0
(2) 1021/ 6000B0E :                     ; 		shll8	r0
(2) 1022/ 6000B0E :                     ; 		shll	r0
(2) 1023/ 6000B0E : 340C                		add	r0,r4		; X + Y
(2) 1024/ 6000B10 : E754                		mov	#(MSCRL_WIDTH)/4,r7
(2) 1025/ 6000B12 :                     .rept_x:
(2) 1026/ 6000B12 : D018                		mov	#(MSCRL_WIDTH*MSCRL_HEIGHT),r0
(2) 1027/ 6000B14 : 3403                		cmp/ge	r0,r4
(2) 1028/ 6000B16 : 8B00                		bf	.res_x
(2) 1029/ 6000B18 : 3408                		sub	r0,r4
(2) 1030/ 6000B1A :                     .res_x:
(2) 1031/ 6000B1A : 3133                		cmp/ge	r3,r1
(2) 1032/ 6000B1C : 8B00                		bf	.xlon1
(2) 1033/ 6000B1E : 6123                		mov	r2,r1
(2) 1034/ 6000B20 :                     .xlon1:
(2) 1035/ 6000B20 : 6A16                		mov	@r1+,r10
(2) 1036/ 6000B22 :                     
(2) 1037/ 6000B22 : 6943                		mov	r4,r9
(2) 1038/ 6000B24 : D014                		mov	#_framebuffer+$200,r0
(2) 1039/ 6000B26 : 390C                		add	r0,r9
(2) 1040/ 6000B28 : 902A                		mov	#320,r0
(2) 1041/ 6000B2A : 3407                		cmp/gt	r0,r4
(2) 1042/ 6000B2C : 8902                		bt	.not_l2
(2) 1043/ 6000B2E : D013                		mov	#(_framebuffer+$200)+(MSCRL_WIDTH*MSCRL_HEIGHT),r0
(2) 1044/ 6000B30 : 304C                		add	r4,r0
(2) 1045/ 6000B32 : 20A2                		mov	r10,@r0
(2) 1046/ 6000B34 :                     .not_l2:
(2) 1047/ 6000B34 : 29A2                		mov	r10,@r9
(2) 1048/ 6000B36 : 4710                		dt	r7
(2) 1049/ 6000B38 : 8FEB                		bf/s	.rept_x
(2) 1050/ 6000B3A : 7404                		add	#4,r4
(2) 1051/ 6000B3C :                     
(2) 1052/ 6000B3C : 85EA                		mov.w	@(mbg_width,r14),r0
(2) 1053/ 6000B3E : 320C                		add	r0,r2
(2) 1054/ 6000B40 : 330C                		add	r0,r3
(2) 1056/ 6000B42 : 6063                		mov	r6,r0
(2) 1057/ 6000B44 : 7001                		add	#1,r0
(2) 1058/ 6000B46 : C9FF                		and	#$FF,r0
(2) 1059/ 6000B48 : 6603                		mov	r0,r6
(2) 1068/ 6000B4A : 4810                		dt	r8
(2) 1069/ 6000B4C : 8BCE                		bf	.rept_y
(2) 1070/ 6000B4E :                     drw_ud_exit:
(2) 1071/ 6000B4E : 000B                		rts
(2) 1072/ 6000B50 : 0009                		nop
(2) 1073/ 6000B52 :                     		align 4
(2) 1074/ 6000B54 : 0600 4630 C000 0018 		ltorg
                    C000 0028 C000 0024 
                    C000 001C C000 0028 
                    C000 0020 C000 0010 
                    0001 5000 2400 0200 
                    2401 5200 0140 0150 
(2) 1075/ 6000B84 :                     
(2) 1076/ 6000B84 :                     
(2) 1077/ 6000B84 :                     ; ---------------------------------------
(2) 1078/ 6000B84 :                     ;	Print Text
(2) 1079/ 6000B84 :                     ;
(2) 1080/ 6000B84 :                     ; IN	r1	X position
(2) 1081/ 6000B84 :                     ;	r2	Y position
(2) 1082/ 6000B84 :                     ;	r8	pointer of text data
(2) 1083/ 6000B84 :                     ;	r9	pointer of scroll buffer
(2) 1084/ 6000B84 :                     ;	r10	pointer of ascii data
(2) 1085/ 6000B84 :                     ;	r14	VDPREG Base Address (h'20004100)
(2) 1086/ 6000B84 :                     ; ---------------------------------------
(2) 1087/ 6000B84 :                     
(2) 1088/ 6000B84 :                     printf:
(2) 1089/ 6000B84 :                     ; 		push	0,10
(2) 1090/ 6000B84 :                     
(2) 1091/ 6000B84 : E33F                		mov	#$3F,r3
(2) 1092/ 6000B86 : 2139                		and	r3,r1
(2) 1093/ 6000B88 : 2239                		and	r3,r2
(2) 1094/ 6000B8A : 4108                		shll2	r1
(2) 1095/ 6000B8C : 4100                		shll	r1			; x 8
(2) 1096/ 6000B8E : 4218                		shll8	r2
(2) 1097/ 6000B90 : 4208                		shll2	r2
(2) 1098/ 6000B92 : 4208                		shll2	r2			; x 512 x 8
(2) 1099/ 6000B94 : 391C                		add	r1,r9
(2) 1100/ 6000B96 : 392C                		add	r2,r9			; screen position
(2) 1101/ 6000B98 :                     
(2) 1102/ 6000B98 : E10A                		mov	#$0A,r1		; LF
(2) 1103/ 6000B9A : 6293                		mov	r9,r2
(2) 1104/ 6000B9C : 9340                		mov.l	#512,r3
(2) 1105/ 6000B9E :                     printf00:
(2) 1106/ 6000B9E : 6084                		mov.b	@r8+,r0
(2) 1107/ 6000BA0 : 8800                		cmp/eq	#0,r0
(2) 1108/ 6000BA2 : 891C                		bt	printf_end		; end of data ?
(2) 1109/ 6000BA4 : 3010                		cmp/eq	r1,r0
(2) 1110/ 6000BA6 : 8915                		bt	print_lf		; line feed ?
(2) 1111/ 6000BA8 :                     
(2) 1112/ 6000BA8 : E620                		mov	#$20,r6
(2) 1113/ 6000BAA : 3068                		sub	r6,r0
(2) 1114/ 6000BAC : 4018                		shll8	r0
(2) 1115/ 6000BAE : 4009                		shlr2	r0			; x 64
(2) 1116/ 6000BB0 :                     
(2) 1117/ 6000BB0 : 30AC                		add	r10,r0
(2) 1118/ 6000BB2 : 6503                		mov	r0,r5
(2) 1119/ 6000BB4 : 6093                		mov	r9,r0
(2) 1120/ 6000BB6 : E400                		mov	#0,r4
(2) 1121/ 6000BB8 : E708                		mov	#8,r7
(2) 1122/ 6000BBA :                     printf01:
(2) 1123/ 6000BBA : 6656                		mov.l	@r5+,r6
(2) 1124/ 6000BBC : 0466                		mov.l	r6,@(r0,r4)
(2) 1125/ 6000BBE : 7404                		add	#4,r4
(2) 1126/ 6000BC0 : 6656                		mov.l	@r5+,r6
(2) 1127/ 6000BC2 : 0466                		mov.l	r6,@(r0,r4)
(2) 1128/ 6000BC4 : E604                		mov	#4,r6
(2) 1129/ 6000BC6 : 3468                		sub	r6,r4
(2) 1130/ 6000BC8 : 343C                		add	r3,r4
(2) 1131/ 6000BCA : 4710                		dt	r7
(2) 1132/ 6000BCC : 8BF5                		bf	printf01
(2) 1133/ 6000BCE : 7908                		add	#8,r9
(2) 1134/ 6000BD0 : AFE5                		bra	printf00
(2) 1135/ 6000BD2 : 0009                		nop
(2) 1136/ 6000BD4 :                     print_lf:
(2) 1137/ 6000BD4 : 9025                		mov.l	#512*8,r0
(2) 1138/ 6000BD6 : 320C                		add	r0,r2
(2) 1139/ 6000BD8 : 6923                		mov	r2,r9
(2) 1140/ 6000BDA : AFE0                		bra	printf00
(2) 1141/ 6000BDC : 0009                		nop
(2) 1142/ 6000BDE :                     printf_end:
(2) 1143/ 6000BDE :                     ; 		pop	0,10
(2) 1144/ 6000BDE : 000B                		rts
(2) 1145/ 6000BE0 : 0009                		nop
(2) 1146/ 6000BE2 :                     		align 4
(2) 1147/ 6000BE4 :                     
(2) 1148/ 6000BE4 :                     ; ; ------------------------------------------------
(2) 1149/ 6000BE4 :                     ; ; Init current framebuffer
(2) 1150/ 6000BE4 :                     ; ; ------------------------------------------------
(2) 1151/ 6000BE4 :                     ;
(2) 1152/ 6000BE4 :                     ; .this_fb:
(2) 1153/ 6000BE4 :                     ;  		mov	#_framebuffer,r1
(2) 1154/ 6000BE4 :                     ; 		mov	#$200/2,r0	; START line data
(2) 1155/ 6000BE4 :                     ; 		mov	#240,r2		; Vertical lines to set
(2) 1156/ 6000BE4 :                     ; 		mov	r0,r3		; Increment by (copy from r0)
(2) 1157/ 6000BE4 :                     ; .loop:		mov.w	r0,@r1
(2) 1158/ 6000BE4 :                     ; 		add	#2,r1
(2) 1159/ 6000BE4 :                     ; 		add	r3,r0
(2) 1160/ 6000BE4 :                     ; 		dt	r2
(2) 1161/ 6000BE4 :                     ; 		bf	.loop
(2) 1162/ 6000BE4 :                     ; .fb_wait1:	mov.w   @($A,r4),r0	; Swap for next table
(2) 1163/ 6000BE4 :                     ; 		tst     #2,r0
(2) 1164/ 6000BE4 :                     ; 		bf      .fb_wait1
(2) 1165/ 6000BE4 :                     ; 		mov.w   @($A,r4), r0
(2) 1166/ 6000BE4 :                     ; 		xor     #1,r0
(2) 1167/ 6000BE4 :                     ; 		mov.w   r0,@($A,r4)
(2) 1168/ 6000BE4 :                     ; 		and     #1,r0
(2) 1169/ 6000BE4 :                     ; 		mov     r0,r1
(2) 1170/ 6000BE4 :                     ; .wait_result:
(2) 1171/ 6000BE4 :                     ; 		mov.w   @($A,r4),r0
(2) 1172/ 6000BE4 :                     ; 		and     #1,r0
(2) 1173/ 6000BE4 :                     ; 		cmp/eq  r0,r1
(2) 1174/ 6000BE4 :                     ; 		bf      .wait_result
(2) 1175/ 6000BE4 :                     ; 		rts
(2) 1176/ 6000BE4 :                     ; 		nop
(2) 1177/ 6000BE4 :                     ; 		align 4
(2) 1178/ 6000BE4 :                     
(2) 1179/ 6000BE4 :                     ; ; ------------------------------------------------
(2) 1180/ 6000BE4 :                     ; ; Read polygon and build pieces
(2) 1181/ 6000BE4 :                     ; ;
(2) 1182/ 6000BE4 :                     ; ; Input:
(2) 1183/ 6000BE4 :                     ; ; r14 - Polygon data
(2) 1184/ 6000BE4 :                     ; ;
(2) 1185/ 6000BE4 :                     ; ; polygn_type bits:
(2) 1186/ 6000BE4 :                     ; ; %tsp----- -------- -------- --------
(2) 1187/ 6000BE4 :                     ; ;
(2) 1188/ 6000BE4 :                     ; ; p - Polygon type: Quad (0) or Triangle (1)
(2) 1189/ 6000BE4 :                     ; ; s - Corrds are Normal (0) or Sprite (1) <-- Unused.
(2) 1190/ 6000BE4 :                     ; ; t - Polygon has texture data (1):
(2) 1191/ 6000BE4 :                     ; ;     polygn_mtrlopt: Texture width
(2) 1192/ 6000BE4 :                     ; ;     polygn_mtrl   : Texture data address
(2) 1193/ 6000BE4 :                     ; ;     polygn_srcpnts: Texture X/Y positions for
(2) 1194/ 6000BE4 :                     ; ;                     each edge (3 or 4)
(2) 1195/ 6000BE4 :                     ; ; ------------------------------------------------
(2) 1196/ 6000BE4 :                     ;
(2) 1197/ 6000BE4 :                     ; MarsVideo_SlicePlgn:
(2) 1198/ 6000BE4 :                     ; 		sts	pr,@-r15
(2) 1199/ 6000BE4 :                     ; 		mov	#Cach_DDA_Last,r13		; r13 - DDA last point
(2) 1200/ 6000BE4 :                     ; 		mov	#Cach_DDA_Top,r12		; r12 - DDA first point
(2) 1201/ 6000BE4 :                     ; 		mov	@(polygn_type,r14),r0
(2) 1202/ 6000BE4 :                     ; 		shlr16	r0
(2) 1203/ 6000BE4 :                     ; 		shlr8	r0
(2) 1204/ 6000BE4 :                     ; 		tst	#PLGN_TRI,r0			; PLGN_TRI set?
(2) 1205/ 6000BE4 :                     ; 		bf	.tringl
(2) 1206/ 6000BE4 :                     ; 		add	#8,r13				; If quad: add 8
(2) 1207/ 6000BE4 :                     ; .tringl:
(2) 1208/ 6000BE4 :                     ; 		mov	r14,r1
(2) 1209/ 6000BE4 :                     ; 		mov	r12,r2
(2) 1210/ 6000BE4 :                     ; 		mov	#Cach_DDA_Src,r3
(2) 1211/ 6000BE4 :                     ; 		add	#polygn_points,r1
(2) 1212/ 6000BE4 :                     ; ; 		tst	#PLGN_SPRITE,r0			; PLGN_SPRITE set?
(2) 1213/ 6000BE4 :                     ; ; 		bt	.plgn_pnts
(2) 1214/ 6000BE4 :                     ; ;
(2) 1215/ 6000BE4 :                     ; ; ; ----------------------------------------
(2) 1216/ 6000BE4 :                     ; ; ; Sprite points
(2) 1217/ 6000BE4 :                     ; ; ; ----------------------------------------
(2) 1218/ 6000BE4 :                     ; ;
(2) 1219/ 6000BE4 :                     ; ; ; TODO: rework or get rid of this
(2) 1220/ 6000BE4 :                     ; ; .spr_pnts:
(2) 1221/ 6000BE4 :                     ; ; 		mov.w	@r1+,r8		; X pos
(2) 1222/ 6000BE4 :                     ; ; 		mov.w	@r1+,r9		; Y pos
(2) 1223/ 6000BE4 :                     ; ;
(2) 1224/ 6000BE4 :                     ; ; 		mov.w	@r1+,r4
(2) 1225/ 6000BE4 :                     ; ; 		mov.w	@r1+,r6
(2) 1226/ 6000BE4 :                     ; ; 		mov.w	@r1+,r5
(2) 1227/ 6000BE4 :                     ; ; 		mov.w	@r1+,r7
(2) 1228/ 6000BE4 :                     ; ; 		add	#2*2,r1
(2) 1229/ 6000BE4 :                     ; ; 		add	r8,r4
(2) 1230/ 6000BE4 :                     ; ; 		add 	r8,r5
(2) 1231/ 6000BE4 :                     ; ; 		add	r9,r6
(2) 1232/ 6000BE4 :                     ; ; 		add 	r9,r7
(2) 1233/ 6000BE4 :                     ; ; 		mov	r5,@r2		; TR
(2) 1234/ 6000BE4 :                     ; ; 		add	#4,r2
(2) 1235/ 6000BE4 :                     ; ; 		mov	r6,@r2
(2) 1236/ 6000BE4 :                     ; ; 		add	#4,r2
(2) 1237/ 6000BE4 :                     ; ; 		mov	r4,@r2		; TL
(2) 1238/ 6000BE4 :                     ; ; 		add	#4,r2
(2) 1239/ 6000BE4 :                     ; ; 		mov	r6,@r2
(2) 1240/ 6000BE4 :                     ; ; 		add	#4,r2
(2) 1241/ 6000BE4 :                     ; ; 		mov	r4,@r2		; BL
(2) 1242/ 6000BE4 :                     ; ; 		add	#4,r2
(2) 1243/ 6000BE4 :                     ; ; 		mov	r7,@r2
(2) 1244/ 6000BE4 :                     ; ; 		add	#4,r2
(2) 1245/ 6000BE4 :                     ; ; 		mov	r5,@r2		; BR
(2) 1246/ 6000BE4 :                     ; ; 		add	#4,r2
(2) 1247/ 6000BE4 :                     ; ; 		mov	r7,@r2
(2) 1248/ 6000BE4 :                     ; ; 		add	#4,r2
(2) 1249/ 6000BE4 :                     ; ;
(2) 1250/ 6000BE4 :                     ; ; 		mov.w	@r1+,r4
(2) 1251/ 6000BE4 :                     ; ; 		mov.w	@r1+,r6
(2) 1252/ 6000BE4 :                     ; ; 		mov.w	@r1+,r5
(2) 1253/ 6000BE4 :                     ; ; 		mov.w	@r1+,r7
(2) 1254/ 6000BE4 :                     ; ; 		mov	r5,@r3		; TR
(2) 1255/ 6000BE4 :                     ; ; 		add	#4,r3
(2) 1256/ 6000BE4 :                     ; ; 		mov	r6,@r3
(2) 1257/ 6000BE4 :                     ; ; 		add	#4,r3
(2) 1258/ 6000BE4 :                     ; ; 		mov	r4,@r3		; TL
(2) 1259/ 6000BE4 :                     ; ; 		add	#4,r3
(2) 1260/ 6000BE4 :                     ; ; 		mov	r6,@r3
(2) 1261/ 6000BE4 :                     ; ; 		add	#4,r3
(2) 1262/ 6000BE4 :                     ; ; 		mov	r4,@r3		; BL
(2) 1263/ 6000BE4 :                     ; ; 		add	#4,r3
(2) 1264/ 6000BE4 :                     ; ; 		mov	r7,@r3
(2) 1265/ 6000BE4 :                     ; ; 		add	#4,r3
(2) 1266/ 6000BE4 :                     ; ; 		mov	r5,@r3		; BR
(2) 1267/ 6000BE4 :                     ; ; 		add	#4,r3
(2) 1268/ 6000BE4 :                     ; ; 		mov	r7,@r3
(2) 1269/ 6000BE4 :                     ; ; 		add	#4,r3
(2) 1270/ 6000BE4 :                     ; ; ; 		mov	#4*2,r0
(2) 1271/ 6000BE4 :                     ; ; ; .sprsrc_pnts:
(2) 1272/ 6000BE4 :                     ; ; ; 		mov.w	@r1+,r0
(2) 1273/ 6000BE4 :                     ; ; ; 		mov.w	@r1+,r4
(2) 1274/ 6000BE4 :                     ; ; ; 		mov	r0,@r3
(2) 1275/ 6000BE4 :                     ; ; ; 		mov	r4,@(4,r3)
(2) 1276/ 6000BE4 :                     ; ; ; 		dt	r0
(2) 1277/ 6000BE4 :                     ; ; ; 		bf/s	.sprsrc_pnts
(2) 1278/ 6000BE4 :                     ; ; ; 		add	#8,r3
(2) 1279/ 6000BE4 :                     ; ; 		bra	.start_math
(2) 1280/ 6000BE4 :                     ; ; 		nop
(2) 1281/ 6000BE4 :                     ; ;
(2) 1282/ 6000BE4 :                     ; ; ; ----------------------------------------
(2) 1283/ 6000BE4 :                     ; ; ; Polygon points
(2) 1284/ 6000BE4 :                     ; ; ; ----------------------------------------
(2) 1285/ 6000BE4 :                     ; ;
(2) 1286/ 6000BE4 :                     ; ; .plgn_pnts:
(2) 1287/ 6000BE4 :                     ;
(2) 1288/ 6000BE4 :                     ; 	; Copy polygon points Cache's DDA
(2) 1289/ 6000BE4 :                     ; 		mov	#4,r8
(2) 1290/ 6000BE4 :                     ; 		mov	#SCREEN_WIDTH/2,r6
(2) 1291/ 6000BE4 :                     ; 		mov	#SCREEN_HEIGHT/2,r7
(2) 1292/ 6000BE4 :                     ; .setpnts:
(2) 1293/ 6000BE4 :                     ; 		mov.w	@r1+,r4			; Get X
(2) 1294/ 6000BE4 :                     ; 		mov.w	@r1+,r5			; Get Y
(2) 1295/ 6000BE4 :                     ; 		add	r6,r4			; X + width
(2) 1296/ 6000BE4 :                     ; 		add	r7,r5			; Y + height
(2) 1297/ 6000BE4 :                     ; 		mov	r4,@r2
(2) 1298/ 6000BE4 :                     ; 		mov	r5,@(4,r2)
(2) 1299/ 6000BE4 :                     ; 		dt	r8
(2) 1300/ 6000BE4 :                     ; 		bf/s	.setpnts
(2) 1301/ 6000BE4 :                     ; 		add	#8,r2
(2) 1302/ 6000BE4 :                     ;
(2) 1303/ 6000BE4 :                     ; 	; Copy texture source points
(2) 1304/ 6000BE4 :                     ; 	; to Cache
(2) 1305/ 6000BE4 :                     ; 		mov	#4,r8
(2) 1306/ 6000BE4 :                     ; .src_pnts:
(2) 1307/ 6000BE4 :                     ; 		mov.w	@r1+,r4
(2) 1308/ 6000BE4 :                     ; 		mov.w	@r1+,r5
(2) 1309/ 6000BE4 :                     ; 		mov	r4,@r3
(2) 1310/ 6000BE4 :                     ; 		mov	r5,@(4,r3)
(2) 1311/ 6000BE4 :                     ; 		dt	r8
(2) 1312/ 6000BE4 :                     ; 		bf/s	.src_pnts
(2) 1313/ 6000BE4 :                     ; 		add	#8,r3
(2) 1314/ 6000BE4 :                     ;
(2) 1315/ 6000BE4 :                     ; 	; Here we search for the lowest Y point
(2) 1316/ 6000BE4 :                     ; 	; and highest Y
(2) 1317/ 6000BE4 :                     ; 	; r10 - Top Y
(2) 1318/ 6000BE4 :                     ; 	; r11 - Bottom Y
(2) 1319/ 6000BE4 :                     ; .start_math:
(2) 1320/ 6000BE4 :                     ; 		mov	#3,r9
(2) 1321/ 6000BE4 :                     ; 		tst	#PLGN_TRI,r0			; PLGN_TRI set?
(2) 1322/ 6000BE4 :                     ; 		bf	.ytringl
(2) 1323/ 6000BE4 :                     ; 		add	#1,r9
(2) 1324/ 6000BE4 :                     ; .ytringl:
(2) 1325/ 6000BE4 :                     ; 		mov	#$7FFFFFFF,r10
(2) 1326/ 6000BE4 :                     ; 		mov	#$FFFFFFFF,r11
(2) 1327/ 6000BE4 :                     ; 		mov 	r12,r7
(2) 1328/ 6000BE4 :                     ; 		mov	r12,r8
(2) 1329/ 6000BE4 :                     ; .find_top:
(2) 1330/ 6000BE4 :                     ; 		mov	@(4,r7),r0
(2) 1331/ 6000BE4 :                     ; 		cmp/gt	r11,r0
(2) 1332/ 6000BE4 :                     ; 		bf	.is_low
(2) 1333/ 6000BE4 :                     ; 		mov 	r0,r11
(2) 1334/ 6000BE4 :                     ; .is_low:
(2) 1335/ 6000BE4 :                     ; 		mov	@(4,r8),r0
(2) 1336/ 6000BE4 :                     ; 		cmp/gt	r10,r0
(2) 1337/ 6000BE4 :                     ; 		bt	.is_high
(2) 1338/ 6000BE4 :                     ; 		mov 	r0,r10
(2) 1339/ 6000BE4 :                     ; 		mov	r8,r1
(2) 1340/ 6000BE4 :                     ; .is_high:
(2) 1341/ 6000BE4 :                     ; 		add 	#8,r7
(2) 1342/ 6000BE4 :                     ; 		dt	r9
(2) 1343/ 6000BE4 :                     ; 		bf/s	.find_top
(2) 1344/ 6000BE4 :                     ; 		add	#8,r8
(2) 1345/ 6000BE4 :                     ; 		cmp/ge	r11,r10			; Top larger than Bottom?
(2) 1346/ 6000BE4 :                     ; 		bt	.exit
(2) 1347/ 6000BE4 :                     ; 		cmp/pl	r11			; Bottom < 0?
(2) 1348/ 6000BE4 :                     ; 		bf	.exit
(2) 1349/ 6000BE4 :                     ; 		mov	#SCREEN_HEIGHT,r0	; Top > 224?
(2) 1350/ 6000BE4 :                     ; 		cmp/ge	r0,r10
(2) 1351/ 6000BE4 :                     ; 		bt	.exit
(2) 1352/ 6000BE4 :                     ;
(2) 1353/ 6000BE4 :                     ; 	; r2 - Left DDA READ pointer
(2) 1354/ 6000BE4 :                     ; 	; r3 - Right DDA READ pointer
(2) 1355/ 6000BE4 :                     ; 	; r4 - Left X
(2) 1356/ 6000BE4 :                     ; 	; r5 - Left DX
(2) 1357/ 6000BE4 :                     ; 	; r6 - Right X
(2) 1358/ 6000BE4 :                     ; 	; r7 - Right DX
(2) 1359/ 6000BE4 :                     ; 	; r8 - Left width
(2) 1360/ 6000BE4 :                     ; 	; r9 - Right width
(2) 1361/ 6000BE4 :                     ; 	; r10 - Top Y, gets updated after calling put_piece
(2) 1362/ 6000BE4 :                     ; 	; r11 - Bottom Y
(2) 1363/ 6000BE4 :                     ; 	; r12 - First DST point
(2) 1364/ 6000BE4 :                     ; 	; r13 - Last DST point
(2) 1365/ 6000BE4 :                     ; 		mov	r1,r2				; r2 - X left to process
(2) 1366/ 6000BE4 :                     ; 		mov	r1,r3				; r3 - X right to process
(2) 1367/ 6000BE4 :                     ; 		bsr	set_left
(2) 1368/ 6000BE4 :                     ; 		nop
(2) 1369/ 6000BE4 :                     ; 		bsr	set_right
(2) 1370/ 6000BE4 :                     ; 		nop
(2) 1371/ 6000BE4 :                     ; .next_pz:
(2) 1372/ 6000BE4 :                     ; 		mov	#SCREEN_HEIGHT,r0		; Current Y > 224?
(2) 1373/ 6000BE4 :                     ; 		cmp/gt	r0,r10
(2) 1374/ 6000BE4 :                     ; 		bt	.exit
(2) 1375/ 6000BE4 :                     ; 		cmp/ge	r11,r10				; Y top => Y bottom?
(2) 1376/ 6000BE4 :                     ; 		bt	.exit
(2) 1377/ 6000BE4 :                     ; 		mov	@(marsGbl_PlyPzList_W,gbr),r0	; r1 - Current piece to WRITE
(2) 1378/ 6000BE4 :                     ; 		mov	r0,r1
(2) 1379/ 6000BE4 :                     ; 		mov	#RAM_Mars_VdpDrwList_e,r0	; pointer reached end of the list?
(2) 1380/ 6000BE4 :                     ; 		cmp/ge	r0,r1
(2) 1381/ 6000BE4 :                     ; 		bf	.dontreset
(2) 1382/ 6000BE4 :                     ; 		mov	#RAM_Mars_VdpDrwList,r0		; Return WRITE pointer to the top of the list
(2) 1383/ 6000BE4 :                     ; 		mov	r0,r1
(2) 1384/ 6000BE4 :                     ; 		mov	r0,@(marsGbl_PlyPzList_W,gbr)
(2) 1385/ 6000BE4 :                     ; .dontreset:
(2) 1386/ 6000BE4 :                     ; 		mov	#1,r0
(2) 1387/ 6000BE4 :                     ; 		mov.w	r0,@(marsGbl_WdDrwPause,gbr)	; Tell watchdog we are mid-write
(2) 1388/ 6000BE4 :                     ; 		bsr	put_piece
(2) 1389/ 6000BE4 :                     ; 		nop
(2) 1390/ 6000BE4 :                     ; 		mov	#0,r0
(2) 1391/ 6000BE4 :                     ; 		mov.w	r0,@(marsGbl_WdDrwPause,gbr)	; Unlock.
(2) 1392/ 6000BE4 :                     ;
(2) 1393/ 6000BE4 :                     ; 	; X direction update
(2) 1394/ 6000BE4 :                     ; 		cmp/gt	r9,r8				; Left width > Right width?
(2) 1395/ 6000BE4 :                     ; 		bf	.lefth2
(2) 1396/ 6000BE4 :                     ; 		bsr	set_right
(2) 1397/ 6000BE4 :                     ; 		nop
(2) 1398/ 6000BE4 :                     ; 		bra	.next_pz
(2) 1399/ 6000BE4 :                     ; 		nop
(2) 1400/ 6000BE4 :                     ; .lefth2:
(2) 1401/ 6000BE4 :                     ; 		bsr	set_left
(2) 1402/ 6000BE4 :                     ; 		nop
(2) 1403/ 6000BE4 :                     ; 		bra	.next_pz
(2) 1404/ 6000BE4 :                     ; 		nop
(2) 1405/ 6000BE4 :                     ; .exit:
(2) 1406/ 6000BE4 :                     ; 		lds	@r15+,pr
(2) 1407/ 6000BE4 :                     ; 		rts
(2) 1408/ 6000BE4 :                     ; 		nop
(2) 1409/ 6000BE4 :                     ; 		align 4
(2) 1410/ 6000BE4 :                     ; 		ltorg
(2) 1411/ 6000BE4 :                     ;
(2) 1412/ 6000BE4 :                     ; ; --------------------------------
(2) 1413/ 6000BE4 :                     ;
(2) 1414/ 6000BE4 :                     ; set_left:
(2) 1415/ 6000BE4 :                     ; 		mov	r2,r8			; Get a copy of Xleft pointer
(2) 1416/ 6000BE4 :                     ; 		add	#$20,r8			; To read Texture SRC points
(2) 1417/ 6000BE4 :                     ; 		mov	@r8,r4
(2) 1418/ 6000BE4 :                     ; 		mov	@(4,r8),r5
(2) 1419/ 6000BE4 :                     ; 		mov	#Cach_DDA_Src_L,r8
(2) 1420/ 6000BE4 :                     ; 		mov	r4,r0
(2) 1421/ 6000BE4 :                     ; 		shll16	r0
(2) 1422/ 6000BE4 :                     ; 		mov	r0,@r8
(2) 1423/ 6000BE4 :                     ; 		mov	r5,r0
(2) 1424/ 6000BE4 :                     ; 		shll16	r0
(2) 1425/ 6000BE4 :                     ; 		mov	r0,@(8,r8)
(2) 1426/ 6000BE4 :                     ; 		mov	@r2,r1
(2) 1427/ 6000BE4 :                     ; 		mov	@(4,r2),r8
(2) 1428/ 6000BE4 :                     ; 		add	#8,r2
(2) 1429/ 6000BE4 :                     ; 		cmp/gt	r13,r2
(2) 1430/ 6000BE4 :                     ; 		bf	.lft_ok
(2) 1431/ 6000BE4 :                     ; 		mov 	r12,r2
(2) 1432/ 6000BE4 :                     ; .lft_ok:
(2) 1433/ 6000BE4 :                     ; 		mov	@(4,r2),r0
(2) 1434/ 6000BE4 :                     ; 		sub	r8,r0
(2) 1435/ 6000BE4 :                     ; 		cmp/eq	#0,r0
(2) 1436/ 6000BE4 :                     ; 		bt	set_left
(2) 1437/ 6000BE4 :                     ; 		cmp/pz	r0
(2) 1438/ 6000BE4 :                     ; 		bf	.lft_skip
(2) 1439/ 6000BE4 :                     ;
(2) 1440/ 6000BE4 :                     ; 		lds	r0,mach
(2) 1441/ 6000BE4 :                     ; 		mov	r2,r8
(2) 1442/ 6000BE4 :                     ; 		add	#$20,r8
(2) 1443/ 6000BE4 :                     ; 		mov 	@r8,r0
(2) 1444/ 6000BE4 :                     ; 		sub 	r4,r0
(2) 1445/ 6000BE4 :                     ; 		mov 	@(4,r8),r4
(2) 1446/ 6000BE4 :                     ; 		sub 	r5,r4
(2) 1447/ 6000BE4 :                     ; 		mov	r0,r5
(2) 1448/ 6000BE4 :                     ; 		shll8	r4
(2) 1449/ 6000BE4 :                     ; 		shll8	r5
(2) 1450/ 6000BE4 :                     ; 		sts	mach,r8
(2) 1451/ 6000BE4 :                     ; 		mov	#1,r0				; Tell WD we are using
(2) 1452/ 6000BE4 :                     ; 		mov.w	r0,@(marsGbl_DivStop_M,gbr)	; HW Division
(2) 1453/ 6000BE4 :                     ; 		mov	#_JR,r0
(2) 1454/ 6000BE4 :                     ; 		mov	r8,@r0
(2) 1455/ 6000BE4 :                     ; 		mov	r5,@(4,r0)
(2) 1456/ 6000BE4 :                     ; 		nop
(2) 1457/ 6000BE4 :                     ; 		mov	@(4,r0),r5
(2) 1458/ 6000BE4 :                     ; 		mov	#_JR,r0
(2) 1459/ 6000BE4 :                     ; 		mov	r8,@r0
(2) 1460/ 6000BE4 :                     ; 		mov	r4,@(4,r0)
(2) 1461/ 6000BE4 :                     ; 		nop
(2) 1462/ 6000BE4 :                     ; 		mov	@(4,r0),r4
(2) 1463/ 6000BE4 :                     ; 		shll8	r4
(2) 1464/ 6000BE4 :                     ; 		shll8	r5
(2) 1465/ 6000BE4 :                     ; 		mov	#Cach_DDA_Src_L+$C,r0
(2) 1466/ 6000BE4 :                     ; 		mov	r4,@r0
(2) 1467/ 6000BE4 :                     ; 		mov	#Cach_DDA_Src_L+4,r0
(2) 1468/ 6000BE4 :                     ; 		mov	r5,@r0
(2) 1469/ 6000BE4 :                     ; 		mov	@r2,r5
(2) 1470/ 6000BE4 :                     ; 		sub 	r1,r5
(2) 1471/ 6000BE4 :                     ; 		mov 	r1,r4
(2) 1472/ 6000BE4 :                     ; 		shll8	r5
(2) 1473/ 6000BE4 :                     ; 		shll16	r4
(2) 1474/ 6000BE4 :                     ; 		mov	#_JR,r0
(2) 1475/ 6000BE4 :                     ; 		mov	r8,@r0
(2) 1476/ 6000BE4 :                     ; 		mov	r5,@(4,r0)
(2) 1477/ 6000BE4 :                     ; 		nop
(2) 1478/ 6000BE4 :                     ; 		mov	@(4,r0),r5
(2) 1479/ 6000BE4 :                     ; 		mov	#0,r0				; Unlock HW division
(2) 1480/ 6000BE4 :                     ; 		mov.w	r0,@(marsGbl_DivStop_M,gbr)
(2) 1481/ 6000BE4 :                     ; 		shll8	r5
(2) 1482/ 6000BE4 :                     ; .lft_skip:
(2) 1483/ 6000BE4 :                     ; 		rts
(2) 1484/ 6000BE4 :                     ; 		nop
(2) 1485/ 6000BE4 :                     ; 		align 4
(2) 1486/ 6000BE4 :                     ;
(2) 1487/ 6000BE4 :                     ; ; --------------------------------
(2) 1488/ 6000BE4 :                     ;
(2) 1489/ 6000BE4 :                     ; set_right:
(2) 1490/ 6000BE4 :                     ; 		mov	r3,r9
(2) 1491/ 6000BE4 :                     ; 		add	#$20,r9
(2) 1492/ 6000BE4 :                     ; 		mov	@r9,r6
(2) 1493/ 6000BE4 :                     ; 		mov	@(4,r9),r7
(2) 1494/ 6000BE4 :                     ; 		mov	#Cach_DDA_Src_R,r9
(2) 1495/ 6000BE4 :                     ; 		mov	r6,r0
(2) 1496/ 6000BE4 :                     ; 		shll16	r0
(2) 1497/ 6000BE4 :                     ; 		mov	r0,@r9
(2) 1498/ 6000BE4 :                     ; 		mov	r7,r0
(2) 1499/ 6000BE4 :                     ; 		shll16	r0
(2) 1500/ 6000BE4 :                     ; 		mov	r0,@(8,r9)
(2) 1501/ 6000BE4 :                     ;
(2) 1502/ 6000BE4 :                     ; 		mov	@r3,r1
(2) 1503/ 6000BE4 :                     ; 		mov	@(4,r3),r9
(2) 1504/ 6000BE4 :                     ; 		add	#-8,r3
(2) 1505/ 6000BE4 :                     ; 		cmp/ge	r12,r3
(2) 1506/ 6000BE4 :                     ; 		bt	.rgt_ok
(2) 1507/ 6000BE4 :                     ; 		mov 	r13,r3
(2) 1508/ 6000BE4 :                     ; .rgt_ok:
(2) 1509/ 6000BE4 :                     ; 		mov	@(4,r3),r0
(2) 1510/ 6000BE4 :                     ; 		sub	r9,r0
(2) 1511/ 6000BE4 :                     ; 		cmp/eq	#0,r0
(2) 1512/ 6000BE4 :                     ; 		bt	set_right
(2) 1513/ 6000BE4 :                     ; 		cmp/pz	r0
(2) 1514/ 6000BE4 :                     ; 		bf	.rgt_skip
(2) 1515/ 6000BE4 :                     ; 		lds	r0,mach
(2) 1516/ 6000BE4 :                     ; 		mov	r3,r9
(2) 1517/ 6000BE4 :                     ; 		add	#$20,r9
(2) 1518/ 6000BE4 :                     ; 		mov 	@r9,r0
(2) 1519/ 6000BE4 :                     ; 		sub 	r6,r0
(2) 1520/ 6000BE4 :                     ; 		mov 	@(4,r9),r6
(2) 1521/ 6000BE4 :                     ; 		sub 	r7,r6
(2) 1522/ 6000BE4 :                     ; 		mov	r0,r7
(2) 1523/ 6000BE4 :                     ; 		shll8	r6
(2) 1524/ 6000BE4 :                     ; 		shll8	r7
(2) 1525/ 6000BE4 :                     ; 		sts	mach,r9
(2) 1526/ 6000BE4 :                     ; 		mov	#1,r0				; Tell WD we are using
(2) 1527/ 6000BE4 :                     ; 		mov.w	r0,@(marsGbl_DivStop_M,gbr)	; HW Division
(2) 1528/ 6000BE4 :                     ; 		mov	#_JR,r0
(2) 1529/ 6000BE4 :                     ; 		mov	r9,@r0
(2) 1530/ 6000BE4 :                     ; 		mov	r7,@(4,r0)
(2) 1531/ 6000BE4 :                     ; 		nop
(2) 1532/ 6000BE4 :                     ; 		mov	@(4,r0),r7
(2) 1533/ 6000BE4 :                     ; 		mov	#_JR,r0
(2) 1534/ 6000BE4 :                     ; 		mov	r9,@r0
(2) 1535/ 6000BE4 :                     ; 		mov	r6,@(4,r0)
(2) 1536/ 6000BE4 :                     ; 		nop
(2) 1537/ 6000BE4 :                     ; 		mov	@(4,r0),r6
(2) 1538/ 6000BE4 :                     ; 		shll8	r6
(2) 1539/ 6000BE4 :                     ; 		shll8	r7
(2) 1540/ 6000BE4 :                     ; 		mov	#Cach_DDA_Src_R+4,r0
(2) 1541/ 6000BE4 :                     ; 		mov	r7,@r0
(2) 1542/ 6000BE4 :                     ; 		mov	#Cach_DDA_Src_R+$C,r0
(2) 1543/ 6000BE4 :                     ; 		mov	r6,@r0
(2) 1544/ 6000BE4 :                     ; 		mov	@r3,r7
(2) 1545/ 6000BE4 :                     ; 		sub 	r1,r7
(2) 1546/ 6000BE4 :                     ; 		mov 	r1,r6
(2) 1547/ 6000BE4 :                     ; 		shll16	r6
(2) 1548/ 6000BE4 :                     ; 		shll8	r7
(2) 1549/ 6000BE4 :                     ; 		mov	#_JR,r0
(2) 1550/ 6000BE4 :                     ; 		mov	r9,@r0
(2) 1551/ 6000BE4 :                     ; 		mov	r7,@(4,r0)
(2) 1552/ 6000BE4 :                     ; 		nop
(2) 1553/ 6000BE4 :                     ; 		mov	@(4,r0),r7
(2) 1554/ 6000BE4 :                     ; 		mov	#0,r0				; Unlock HW division
(2) 1555/ 6000BE4 :                     ; 		mov.w	r0,@(marsGbl_DivStop_M,gbr)
(2) 1556/ 6000BE4 :                     ; 		shll8	r7
(2) 1557/ 6000BE4 :                     ; .rgt_skip:
(2) 1558/ 6000BE4 :                     ; 		rts
(2) 1559/ 6000BE4 :                     ; 		nop
(2) 1560/ 6000BE4 :                     ; 		align 4
(2) 1561/ 6000BE4 :                     ; 		ltorg
(2) 1562/ 6000BE4 :                     ;
(2) 1563/ 6000BE4 :                     ; ; --------------------------------
(2) 1564/ 6000BE4 :                     ; ; Mark piece
(2) 1565/ 6000BE4 :                     ; ; --------------------------------
(2) 1566/ 6000BE4 :                     ;
(2) 1567/ 6000BE4 :                     ; put_piece:
(2) 1568/ 6000BE4 :                     ; 		mov	@(4,r2),r8
(2) 1569/ 6000BE4 :                     ; 		mov	@(4,r3),r9
(2) 1570/ 6000BE4 :                     ; 		sub	r10,r8
(2) 1571/ 6000BE4 :                     ; 		sub	r10,r9
(2) 1572/ 6000BE4 :                     ; 		mov	r8,r0
(2) 1573/ 6000BE4 :                     ; 		cmp/gt	r8,r9
(2) 1574/ 6000BE4 :                     ; 		bt	.lefth
(2) 1575/ 6000BE4 :                     ; 		mov	r9,r0
(2) 1576/ 6000BE4 :                     ; .lefth:
(2) 1577/ 6000BE4 :                     ; 		mov	r2,@-r15
(2) 1578/ 6000BE4 :                     ; 		mov	r3,@-r15
(2) 1579/ 6000BE4 :                     ; 		mov	r5,@-r15
(2) 1580/ 6000BE4 :                     ; 		mov	r7,@-r15
(2) 1581/ 6000BE4 :                     ; 		mov	r8,@-r15
(2) 1582/ 6000BE4 :                     ; 		mov	r9,@-r15
(2) 1583/ 6000BE4 :                     ; 		mov 	r4,@(plypz_xl,r1)
(2) 1584/ 6000BE4 :                     ; 		mov 	r5,@(plypz_xl_dx,r1)
(2) 1585/ 6000BE4 :                     ; 		mov 	r6,@(plypz_xr,r1)
(2) 1586/ 6000BE4 :                     ; 		mov 	r7,@(plypz_xr_dx,r1)
(2) 1587/ 6000BE4 :                     ; 		dmuls	r0,r5
(2) 1588/ 6000BE4 :                     ; 		sts	macl,r2
(2) 1589/ 6000BE4 :                     ; 		dmuls	r0,r7
(2) 1590/ 6000BE4 :                     ; 		sts	macl,r3
(2) 1591/ 6000BE4 :                     ; 		add 	r2,r4
(2) 1592/ 6000BE4 :                     ; 		add	r3,r6
(2) 1593/ 6000BE4 :                     ; 		mov	r10,r2
(2) 1594/ 6000BE4 :                     ; 		add	r0,r10
(2) 1595/ 6000BE4 :                     ; 		mov	r10,r3
(2) 1596/ 6000BE4 :                     ; 		shll16	r2
(2) 1597/ 6000BE4 :                     ; 		or	r2,r3
(2) 1598/ 6000BE4 :                     ; 		mov	r3,@(plypz_ypos,r1)
(2) 1599/ 6000BE4 :                     ; 		mov	r3,@-r15
(2) 1600/ 6000BE4 :                     ; 		mov	#Cach_DDA_Src_L,r2
(2) 1601/ 6000BE4 :                     ; 		mov	@r2,r5
(2) 1602/ 6000BE4 :                     ; 		mov	r5,@(plypz_src_xl,r1)
(2) 1603/ 6000BE4 :                     ; 		mov	@(4,r2),r7
(2) 1604/ 6000BE4 :                     ; 		mov	r7,@(plypz_src_xl_dx,r1)
(2) 1605/ 6000BE4 :                     ; 		mov	@(8,r2),r8
(2) 1606/ 6000BE4 :                     ; 		mov	r8,@(plypz_src_yl,r1)
(2) 1607/ 6000BE4 :                     ; 		mov	@($C,r2),r9
(2) 1608/ 6000BE4 :                     ; 		mov	r9,@(plypz_src_yl_dx,r1)
(2) 1609/ 6000BE4 :                     ; 		dmuls	r0,r7
(2) 1610/ 6000BE4 :                     ; 		sts	macl,r2
(2) 1611/ 6000BE4 :                     ; 		dmuls	r0,r9
(2) 1612/ 6000BE4 :                     ; 		sts	macl,r3
(2) 1613/ 6000BE4 :                     ; 		add 	r2,r5
(2) 1614/ 6000BE4 :                     ; 		add	r3,r8
(2) 1615/ 6000BE4 :                     ; 		mov	#Cach_DDA_Src_L,r2
(2) 1616/ 6000BE4 :                     ; 		mov	r5,@r2
(2) 1617/ 6000BE4 :                     ; 		mov	r8,@(8,r2)
(2) 1618/ 6000BE4 :                     ; 		mov	#Cach_DDA_Src_R,r2
(2) 1619/ 6000BE4 :                     ; 		mov	@r2,r5
(2) 1620/ 6000BE4 :                     ; 		mov	r5,@(plypz_src_xr,r1)
(2) 1621/ 6000BE4 :                     ; 		mov	@(4,r2),r7
(2) 1622/ 6000BE4 :                     ; 		mov	r7,@(plypz_src_xr_dx,r1)
(2) 1623/ 6000BE4 :                     ; 		mov	@(8,r2),r8
(2) 1624/ 6000BE4 :                     ; 		mov	r8,@(plypz_src_yr,r1)
(2) 1625/ 6000BE4 :                     ; 		mov	@($C,r2),r9
(2) 1626/ 6000BE4 :                     ; 		mov	r9,@(plypz_src_yr_dx,r1)
(2) 1627/ 6000BE4 :                     ; 		dmuls	r0,r7
(2) 1628/ 6000BE4 :                     ; 		sts	macl,r2
(2) 1629/ 6000BE4 :                     ; 		dmuls	r0,r9
(2) 1630/ 6000BE4 :                     ; 		sts	macl,r3
(2) 1631/ 6000BE4 :                     ; 		add 	r2,r5
(2) 1632/ 6000BE4 :                     ; 		add	r3,r8
(2) 1633/ 6000BE4 :                     ; 		mov	#Cach_DDA_Src_R,r2
(2) 1634/ 6000BE4 :                     ; 		mov	r5,@r2
(2) 1635/ 6000BE4 :                     ; 		mov	r8,@(8,r2)
(2) 1636/ 6000BE4 :                     ; 		mov	@r15+,r3
(2) 1637/ 6000BE4 :                     ; 		cmp/pl	r3			; TOP check, 2 steps
(2) 1638/ 6000BE4 :                     ; 		bt	.top_neg
(2) 1639/ 6000BE4 :                     ; 		shll16	r3
(2) 1640/ 6000BE4 :                     ; 		cmp/pl	r3
(2) 1641/ 6000BE4 :                     ; 		bf	.bad_piece
(2) 1642/ 6000BE4 :                     ; .top_neg:
(2) 1643/ 6000BE4 :                     ; 		mov	@(polygn_mtrl,r14),r0
(2) 1644/ 6000BE4 :                     ; 		mov 	r0,@(plypz_mtrl,r1)
(2) 1645/ 6000BE4 :                     ; 		mov	@(polygn_type,r14),r0
(2) 1646/ 6000BE4 :                     ; 		mov 	r0,@(plypz_type,r1)
(2) 1647/ 6000BE4 :                     ; 		add	#sizeof_plypz,r1
(2) 1648/ 6000BE4 :                     ; 		mov	r1,r0
(2) 1649/ 6000BE4 :                     ; 		mov	#RAM_Mars_VdpDrwList_e,r8
(2) 1650/ 6000BE4 :                     ; 		cmp/ge	r8,r0
(2) 1651/ 6000BE4 :                     ; 		bf	.dontreset_pz
(2) 1652/ 6000BE4 :                     ; 		mov	#RAM_Mars_VdpDrwList,r0
(2) 1653/ 6000BE4 :                     ; 		mov	r0,r1
(2) 1654/ 6000BE4 :                     ; .dontreset_pz:
(2) 1655/ 6000BE4 :                     ; 		mov	r0,@(marsGbl_PlyPzList_W,gbr)
(2) 1656/ 6000BE4 :                     ; 		mov.w	@(marsGbl_PzListCntr,gbr),r0
(2) 1657/ 6000BE4 :                     ; 		add	#1,r0
(2) 1658/ 6000BE4 :                     ; 		mov.w	r0,@(marsGbl_PzListCntr,gbr)
(2) 1659/ 6000BE4 :                     ; .bad_piece:
(2) 1660/ 6000BE4 :                     ; 		mov	@r15+,r9
(2) 1661/ 6000BE4 :                     ; 		mov	@r15+,r8
(2) 1662/ 6000BE4 :                     ; 		mov	@r15+,r7
(2) 1663/ 6000BE4 :                     ; 		mov	@r15+,r5
(2) 1664/ 6000BE4 :                     ; 		mov	@r15+,r3
(2) 1665/ 6000BE4 :                     ; 		mov	@r15+,r2
(2) 1666/ 6000BE4 :                     ; 		rts
(2) 1667/ 6000BE4 :                     ; 		nop
(2) 1668/ 6000BE4 :                     ; 		align 4
(2) 1669/ 6000BE4 :                     ; 		ltorg
(2) 1670/ 6000BE4 :                     
(2) 1671/ 6000BE4 :                     ; ; ------------------------------------
(2) 1672/ 6000BE4 :                     ; ; MarsVideo_ClearFrame
(2) 1673/ 6000BE4 :                     ; ;
(2) 1674/ 6000BE4 :                     ; ; Clear the current framebuffer
(2) 1675/ 6000BE4 :                     ; ; ------------------------------------
(2) 1676/ 6000BE4 :                     ;
(2) 1677/ 6000BE4 :                     ; MarsVideo_ClearFrame:
(2) 1678/ 6000BE4 :                     ; 		mov	#_vdpreg,r1
(2) 1679/ 6000BE4 :                     ; .wait2		mov.w	@(10,r1),r0		; Wait for FEN to clear
(2) 1680/ 6000BE4 :                     ; 		and	#%10,r0
(2) 1681/ 6000BE4 :                     ; 		cmp/eq	#2,r0
(2) 1682/ 6000BE4 :                     ; 		bt	.wait2
(2) 1683/ 6000BE4 :                     ;
(2) 1684/ 6000BE4 :                     ; 		mov	#255,r2			; r2 - lenght: 256 words per pass
(2) 1685/ 6000BE4 :                     ; 		mov	#$200/2,r3		; r3 - Start address / 2
(2) 1686/ 6000BE4 :                     ; 		mov	#0,r4			; r4 - data (zero)
(2) 1687/ 6000BE4 :                     ; 		mov	#256,r5			; Increment address by 256
(2) 1688/ 6000BE4 :                     ; 		mov	#((512*240)/256)/2,r6	; 140 passes
(2) 1689/ 6000BE4 :                     ; .loop
(2) 1690/ 6000BE4 :                     ; 		mov	r2,r0
(2) 1691/ 6000BE4 :                     ; 		mov.w	r0,@(4,r1)		; Set length
(2) 1692/ 6000BE4 :                     ; 		mov	r3,r0
(2) 1693/ 6000BE4 :                     ; 		mov.w	r0,@(6,r1)		; Set address
(2) 1694/ 6000BE4 :                     ; 		mov	r4,r0
(2) 1695/ 6000BE4 :                     ; 		mov.w	r0,@(8,r1)		; Set data
(2) 1696/ 6000BE4 :                     ; 		add	r5,r3
(2) 1697/ 6000BE4 :                     ;
(2) 1698/ 6000BE4 :                     ; .wait		mov.w	@(10,r1),r0		; Wait for FEN to clear
(2) 1699/ 6000BE4 :                     ; 		and	#%10,r0
(2) 1700/ 6000BE4 :                     ; 		cmp/eq	#2,r0
(2) 1701/ 6000BE4 :                     ; 		bt	.wait
(2) 1702/ 6000BE4 :                     ; 		dt	r6
(2) 1703/ 6000BE4 :                     ; 		bf	.loop
(2) 1704/ 6000BE4 :                     ; 		rts
(2) 1705/ 6000BE4 :                     ; 		nop
(2) 1706/ 6000BE4 :                     ; 		align 4
(2) 1707/ 6000BE4 :                     
(2) 1708/ 6000BE4 :                     ; ------------------------------------
(2) 1709/ 6000BE4 :                     ; MarsVideo_FrameSwap
(2) 1710/ 6000BE4 :                     ; ------------------------------------
(2) 1711/ 6000BE4 :                     
(2) 1712/ 6000BE4 :                     ; MarsVideo_FrameSwap:
(2) 1713/ 6000BE4 :                     ; 		mov.l	#_vdpreg,r2
(2) 1714/ 6000BE4 :                     ; .wait_fb:
(2) 1715/ 6000BE4 :                     ; 		mov.w	@($A,r2),r0
(2) 1716/ 6000BE4 :                     ; 		tst	#2,r0
(2) 1717/ 6000BE4 :                     ; 		bf	.wait_fb
(2) 1718/ 6000BE4 :                     ; 		mov.w	@($A,r2),r0
(2) 1719/ 6000BE4 :                     ; 		xor	#1,r0
(2) 1720/ 6000BE4 :                     ; 		mov.w	r0,@($A,r2)
(2) 1721/ 6000BE4 :                     ; 		and	#1,r0
(2) 1722/ 6000BE4 :                     ; 		mov	r0,r1
(2) 1723/ 6000BE4 :                     ; .wait_result:
(2) 1724/ 6000BE4 :                     ; 		mov.w	@($A,r2),r0
(2) 1725/ 6000BE4 :                     ; 		and	#1,r0
(2) 1726/ 6000BE4 :                     ; 		cmp/eq	r0,r1
(2) 1727/ 6000BE4 :                     ; 		bf	.wait_result
(2) 1728/ 6000BE4 :                     ; 		rts
(2) 1729/ 6000BE4 :                     ; 		nop
(2) 1730/ 6000BE4 :                     ; 		align 4
(2) 1731/ 6000BE4 :                     
(2) 1732/ 6000BE4 :                     ; ------------------------------------
(2) 1733/ 6000BE4 :                     ; MarsVdp_LoadPal
(2) 1734/ 6000BE4 :                     ;
(2) 1735/ 6000BE4 :                     ; Load palette to RAM
(2) 1736/ 6000BE4 :                     ; then the Palette will be transfered
(2) 1737/ 6000BE4 :                     ; on VBlank
(2) 1738/ 6000BE4 :                     ;
(2) 1739/ 6000BE4 :                     ; Input:
(2) 1740/ 6000BE4 :                     ; r1 - Palette data
(2) 1741/ 6000BE4 :                     ; r2 - Start index
(2) 1742/ 6000BE4 :                     ; r3 - Number of colors
(2) 1743/ 6000BE4 :                     ; r4 - OR value ($0000 or $8000)
(2) 1744/ 6000BE4 :                     ;
(2) 1745/ 6000BE4 :                     ; Uses:
(2) 1746/ 6000BE4 :                     ; r0,r4-r6
(2) 1747/ 6000BE4 :                     ; ------------------------------------
(2) 1748/ 6000BE4 :                     
(2) 1749/ 6000BE4 :                     MarsVideo_LoadPal:
(2) 1750/ 6000BE4 : C506                		mov.w	@(marsGbl_PalDmaMidWr,gbr),r0
(2) 1751/ 6000BE6 : 8801                		cmp/eq	#1,r0
(2) 1752/ 6000BE8 : 89FC                		bt	MarsVideo_LoadPal
(2) 1753/ 6000BEA : 6513                		mov 	r1,r5
(2) 1754/ 6000BEC : D60A                		mov 	#RAM_Mars_Palette,r6
(2) 1755/ 6000BEE : 6023                		mov 	r2,r0
(2) 1756/ 6000BF0 : 4000                		shll	r0
(2) 1757/ 6000BF2 : 360C                		add 	r0,r6
(2) 1758/ 6000BF4 : 6033                		mov 	r3,r0
(2) 1759/ 6000BF6 :                     ; 		and	#$FF,r0
(2) 1760/ 6000BF6 :                     ; 		cmp/pl	r0
(2) 1761/ 6000BF6 :                     ; 		bf	.badlen
(2) 1762/ 6000BF6 : 9715                		mov	#256,r7
(2) 1763/ 6000BF8 : 3077                		cmp/gt	r7,r0
(2) 1764/ 6000BFA : 8900                		bt	.loop
(2) 1765/ 6000BFC : 6703                		mov	r0,r7
(2) 1766/ 6000BFE :                     .loop:
(2) 1767/ 6000BFE : 6055                		mov.w	@r5+,r0
(2) 1768/ 6000C00 : 204B                		or	r4,r0
(2) 1769/ 6000C02 : 2601                		mov.w	r0,@r6
(2) 1770/ 6000C04 : 4710                		dt	r7
(2) 1771/ 6000C06 : 8FFA                		bf/s	.loop
(2) 1772/ 6000C08 : 7602                		add 	#2,r6
(2) 1773/ 6000C0A :                     .badlen:
(2) 1774/ 6000C0A : D104                		mov	#RAM_Mars_Palette,r1	; lazy fix
(2) 1775/ 6000C0C : 6011                		mov.w	@r1,r0			; for background
(2) 1776/ 6000C0E : 920A                		mov	#$7FFF,r2
(2) 1777/ 6000C10 : 2029                		and	r2,r0
(2) 1778/ 6000C12 : 2101                		mov.w	r0,@r1
(2) 1779/ 6000C14 : 000B                		rts
(2) 1780/ 6000C16 : 0009                		nop
(2) 1781/ 6000C18 :                     		align 4
(2) 1782/ 6000C18 : 0600 4430 0600 4430 		ltorg
                    0200 1000 0100 7FFF 
(2) 1783/ 6000C28 :                     
(2) 1784/ 6000C28 :                     ; ------------------------------------------------
(2) 1785/ 6000C28 :                     ; Sets SuperVDP's background settings
(2) 1786/ 6000C28 :                     ; ------------------------------------------------
(2) 1787/ 6000C28 :                     
(2) 1788/ 6000C28 :                     MarsVideo_SetBg:
(2) 1789/ 6000C28 : DE05                		mov	#RAM_Mars_Background,r14
(2) 1790/ 6000C2A : 6013                		mov	r1,r0
(2) 1791/ 6000C2C : 1E0A                		mov	r0,@(mbg_data,r14)
(2) 1792/ 6000C2E : 6023                		mov	r2,r0
(2) 1793/ 6000C30 : 81EA                		mov.w	r0,@(mbg_width,r14)
(2) 1794/ 6000C32 : 6033                		mov	r3,r0
(2) 1795/ 6000C34 : 81EB                		mov.w	r0,@(mbg_height,r14)
(2) 1796/ 6000C36 :                     
(2) 1797/ 6000C36 : 9005                		mov	#240,r0
(2) 1798/ 6000C38 : 81EE                		mov.w	r0,@(mbg_maxlines,r14)
(2) 1799/ 6000C3A : 000B                		rts
(2) 1800/ 6000C3C : 0009                		nop
(2) 1801/ 6000C3E :                     		align 4
(2) 1802/ 6000C40 : 0600 4630 00F0      		ltorg
(2) 1803/ 6000C46 :                     
(2) 1804/ 6000C46 :                     ; ------------------------------------------------
(2) 1805/ 6000C46 :                     ; MarsVideo_SetWatchdog
(2) 1806/ 6000C46 :                     ;
(2) 1807/ 6000C46 :                     ; Initialize watchdog interrupt with
(2) 1808/ 6000C46 :                     ; default settings
(2) 1809/ 6000C46 :                     ; ------------------------------------------------
(2) 1810/ 6000C46 :                     
(2) 1811/ 6000C46 :                     MarsVideo_SetWatchdog:
(2) 1812/ 6000C46 : 4F03                		stc	sr,@-r15			; Save interrupts
(2) 1813/ 6000C48 : 9010                		mov	#$F0,r0
(2) 1814/ 6000C4A : 400E                		ldc	r0,sr
(2) 1815/ 6000C4C :                     
(2) 1816/ 6000C4C :                     ; 	; Polygon start-values
(2) 1817/ 6000C4C :                     ; ; 		mov	#RAM_Mars_VdpDrwList,r0		; Reset the piece-drawing pointer
(2) 1818/ 6000C4C :                     ; ; 		mov	r0,@(marsGbl_PlyPzList_R,gbr)	; on both READ and WRITE pointers
(2) 1819/ 6000C4C :                     ; ; 		mov	r0,@(marsGbl_PlyPzList_W,gbr)
(2) 1820/ 6000C4C :                     ; ; 		mov	#0,r0				; Reset polygon pieces counter
(2) 1821/ 6000C4C :                     ; ; 		mov.w	r0,@(marsGbl_PzListCntr,gbr)
(2) 1822/ 6000C4C :                     ;
(2) 1823/ 6000C4C :                     ; 	; Vars that require reset
(2) 1824/ 6000C4C :                     ; 		mov	#MSCRL_HEIGHT,r2
(2) 1825/ 6000C4C :                     ; 		mov.w	@(marsGbl_CurrGfxMode,gbr),r0
(2) 1826/ 6000C4C :                     ; 		and	#$7F,r0
(2) 1827/ 6000C4C :                     ; 		cmp/eq	#1,r0
(2) 1828/ 6000C4C :                     ; 		bt	.mde1
(2) 1829/ 6000C4C :                     ; 		mov	#224,r2
(2) 1830/ 6000C4C :                     ; .mde1:
(2) 1831/ 6000C4C :                     ; 		mov	#Cach_LR_Lines,r1		; L/R lines to process
(2) 1832/ 6000C4C :                     ; 		mov	r2,@r1
(2) 1833/ 6000C4C :                     ; 		mov	#_framebuffer+$200,r0
(2) 1834/ 6000C4C :                     ; 		mov	r0,@(marsGbl_Bg_FbCurrR,gbr)
(2) 1835/ 6000C4C :                     ; 		mov	#Cach_Xadd,r1
(2) 1836/ 6000C4C :                     ; 		mov	#Cach_Yadd,r2
(2) 1837/ 6000C4C :                     ; 		mov.w	@(marsGbl_Bg_Xscale,gbr),r0
(2) 1838/ 6000C4C :                     ; 		shll8	r0
(2) 1839/ 6000C4C :                     ; 		mov	r0,@r1
(2) 1840/ 6000C4C :                     ; 		mov.w	@(marsGbl_Bg_Yscale,gbr),r0
(2) 1841/ 6000C4C :                     ; 		shll8	r0
(2) 1842/ 6000C4C :                     ; 		mov	r0,@r2
(2) 1843/ 6000C4C :                     ; 		mov.w	@(mbg_xinc_l,r14),r0
(2) 1844/ 6000C4C :                     ; 		mov	#Cach_Xpos,r1
(2) 1845/ 6000C4C :                     ; 		mov	r0,@r1
(2) 1846/ 6000C4C :                     ; 		mov.w	@(mbg_yinc_u,r14),r0
(2) 1847/ 6000C4C :                     ; 		shll16	r0
(2) 1848/ 6000C4C :                     ; 		mov	#Cach_Ycurr,r1
(2) 1849/ 6000C4C :                     ; 		mov	r0,@r1
(2) 1850/ 6000C4C :                     ;
(2) 1851/ 6000C4C :                     ; 	; X draw settings
(2) 1852/ 6000C4C :                     ; 		mov	@(marsGbl_BgData,gbr),r0
(2) 1853/ 6000C4C :                     ; 		mov	r0,@(marsGbl_BgData_R,gbr)
(2) 1854/ 6000C4C :                     
(2) 1855/ 6000C4C :                     ; 	; Y draw settings
(2) 1856/ 6000C4C :                     ; 		mov	#1,r0				; Set first task $01
(2) 1857/ 6000C4C :                     ; 		mov.w	r0,@(marsGbl_WdDrwTask,gbr)
(2) 1858/ 6000C4C : 4F07                		ldc	@r15+,sr			; Restore interrupts
(2) 1859/ 6000C4E : 910E                		mov	#$FFFFFE80,r1
(2) 1860/ 6000C50 : 900E                		mov.w	#$5A20,r0			; Watchdog timer
(2) 1861/ 6000C52 : 2101                		mov.w	r0,@r1
(2) 1862/ 6000C54 : 900D                		mov.w	#$A538,r0			; Enable this watchdog
(2) 1863/ 6000C56 : 2101                		mov.w	r0,@r1
(2) 1864/ 6000C58 : D103                		mov	#_vdpreg,r1
(2) 1865/ 6000C5A : 8515                .wait_fb:	mov.w	@($A,r1),r0			; Wait until framebuffer is unlocked
(2) 1866/ 6000C5C : C802                		tst	#2,r0
(2) 1867/ 6000C5E : 8BFC                		bf	.wait_fb
(2) 1868/ 6000C60 : 9008                		mov.w	#$A1,r0				; ClearOnly: Pre-start at $A1
(2) 1869/ 6000C62 :                     ; 		mov.w	#$100,r0			; BG: Pre-start at $100
(2) 1870/ 6000C62 : 8113                		mov.w	r0,@(6,r1)			;
(2) 1871/ 6000C64 :                     
(2) 1872/ 6000C64 : 000B                		rts
(2) 1873/ 6000C66 : 0009                		nop
(2) 1874/ 6000C68 :                     		align 4
(2) 1875/ 6000C68 : 2000 4100 00F0 FE80 		ltorg
                    5A20 A538 00A1      
(2) 1876/ 6000C76 :                     
(2) 1877/ 6000C76 :                     ; ====================================================================
(2) 1878/ 6000C76 :                     ; ----------------------------------------------------------------
(2) 1879/ 6000C76 :                     ; 3D MODELS SYSTEM
(2) 1880/ 6000C76 :                     ; ----------------------------------------------------------------
(2) 1881/ 6000C76 :                     
(2) 1882/ 6000C76 :                     ; ; ------------------------------------------------
(2) 1883/ 6000C76 :                     ; ; Object layout routines
(2) 1884/ 6000C76 :                     ; ; ------------------------------------------------
(2) 1885/ 6000C76 :                     ;
(2) 1886/ 6000C76 :                     ; ; ----------------------------------------
(2) 1887/ 6000C76 :                     ; ; Read layout
(2) 1888/ 6000C76 :                     ; ; ----------------------------------------
(2) 1889/ 6000C76 :                     ;
(2) 1890/ 6000C76 :                     ; MarsLay_Read:
(2) 1891/ 6000C76 :                     ; 		sts	pr,@-r15
(2) 1892/ 6000C76 :                     ; 		mov	#RAM_Mars_ObjLayout,r14
(2) 1893/ 6000C76 :                     ; 		mov	#RAM_Mars_ObjCamera,r13
(2) 1894/ 6000C76 :                     ; 		mov	#RAM_Mars_Objects,r12
(2) 1895/ 6000C76 :                     ; 		mov	@(mdllay_data,r14),r0
(2) 1896/ 6000C76 :                     ; 		cmp/pl	r0
(2) 1897/ 6000C76 :                     ; 		bf	.no_lay
(2) 1898/ 6000C76 :                     ; 		mov	r0,r11
(2) 1899/ 6000C76 :                     ;
(2) 1900/ 6000C76 :                     ; 		mov	#0,r10				; r10 - Update counter
(2) 1901/ 6000C76 :                     ; 		mov	#-$100000,r9			;  r9 - MAX Z block size
(2) 1902/ 6000C76 :                     ; 		mov	#-$100000,r8			;  r8 - MAX Y block size
(2) 1903/ 6000C76 :                     ; 		mov	#-$100000,r7			;  r7 - MAX X block size
(2) 1904/ 6000C76 :                     ; 		mov	#-$8000,r6			;  r6 - X Rotation update point
(2) 1905/ 6000C76 :                     ;
(2) 1906/ 6000C76 :                     ; 		mov	@(mdllay_z_last,r14),r5
(2) 1907/ 6000C76 :                     ; 		mov	@(cam_z_pos,r13),r0
(2) 1908/ 6000C76 :                     ; 		and	r9,r0
(2) 1909/ 6000C76 :                     ; 		and	r9,r5
(2) 1910/ 6000C76 :                     ; 		cmp/eq	r0,r5
(2) 1911/ 6000C76 :                     ; 		bt	.no_z_upd
(2) 1912/ 6000C76 :                     ; ; 		add	r9,r5
(2) 1913/ 6000C76 :                     ; ; 		neg	r5,r4
(2) 1914/ 6000C76 :                     ; ; 		cmp/gt	r5,r0
(2) 1915/ 6000C76 :                     ; ; 		bf	.set_z_upd
(2) 1916/ 6000C76 :                     ; ; 		cmp/ge	r4,r0
(2) 1917/ 6000C76 :                     ; ; 		bf	.no_z_upd
(2) 1918/ 6000C76 :                     ; ; .set_z_upd:
(2) 1919/ 6000C76 :                     ; 		and	r9,r0
(2) 1920/ 6000C76 :                     ; 		mov	r0,@(mdllay_z_last,r14)
(2) 1921/ 6000C76 :                     ; 		add	#1,r10
(2) 1922/ 6000C76 :                     ; .no_z_upd:
(2) 1923/ 6000C76 :                     ;
(2) 1924/ 6000C76 :                     ; 		mov	@(mdllay_y_last,r14),r5
(2) 1925/ 6000C76 :                     ; 		mov	@(cam_y_pos,r13),r0
(2) 1926/ 6000C76 :                     ; 		and	r8,r0
(2) 1927/ 6000C76 :                     ; 		and	r8,r5
(2) 1928/ 6000C76 :                     ; 		cmp/eq	r0,r5
(2) 1929/ 6000C76 :                     ; 		bt	.no_y_upd
(2) 1930/ 6000C76 :                     ; ; 		add	r8,r5
(2) 1931/ 6000C76 :                     ; ; 		neg	r5,r4
(2) 1932/ 6000C76 :                     ; ; 		cmp/gt	r5,r0
(2) 1933/ 6000C76 :                     ; ; 		bf	.set_y_upd
(2) 1934/ 6000C76 :                     ; ; 		cmp/ge	r4,r0
(2) 1935/ 6000C76 :                     ; ; 		bf	.no_y_upd
(2) 1936/ 6000C76 :                     ; ; .set_y_upd:
(2) 1937/ 6000C76 :                     ; 		and	r8,r0
(2) 1938/ 6000C76 :                     ; 		mov	r0,@(mdllay_y_last,r14)
(2) 1939/ 6000C76 :                     ; 		add	#1,r10
(2) 1940/ 6000C76 :                     ; .no_y_upd:
(2) 1941/ 6000C76 :                     ;
(2) 1942/ 6000C76 :                     ; 		mov	@(mdllay_x_last,r14),r5
(2) 1943/ 6000C76 :                     ; 		mov	@(cam_x_pos,r13),r0
(2) 1944/ 6000C76 :                     ; 		and	r7,r0
(2) 1945/ 6000C76 :                     ; 		and	r7,r5
(2) 1946/ 6000C76 :                     ; 		cmp/eq	r0,r5
(2) 1947/ 6000C76 :                     ; 		bt	.no_x_upd
(2) 1948/ 6000C76 :                     ; ; 		add	r7,r5
(2) 1949/ 6000C76 :                     ; ; 		neg	r5,r4
(2) 1950/ 6000C76 :                     ; ; 		cmp/gt	r5,r0
(2) 1951/ 6000C76 :                     ; ; 		bf	.set_x_upd
(2) 1952/ 6000C76 :                     ; ; 		cmp/ge	r4,r0
(2) 1953/ 6000C76 :                     ; ; 		bf	.no_x_upd
(2) 1954/ 6000C76 :                     ; ; .set_x_upd:
(2) 1955/ 6000C76 :                     ; 		and	r7,r0
(2) 1956/ 6000C76 :                     ; 		mov	r0,@(mdllay_x_last,r14)
(2) 1957/ 6000C76 :                     ; 		add	#1,r10
(2) 1958/ 6000C76 :                     ; .no_x_upd:
(2) 1959/ 6000C76 :                     ;
(2) 1960/ 6000C76 :                     ; 		mov	@(mdllay_xr_last,r14),r5
(2) 1961/ 6000C76 :                     ; 		mov	@(cam_x_rot,r13),r0
(2) 1962/ 6000C76 :                     ; 		and	r6,r0
(2) 1963/ 6000C76 :                     ; 		and	r6,r5
(2) 1964/ 6000C76 :                     ; 		cmp/eq	r0,r5
(2) 1965/ 6000C76 :                     ; 		bt	.no_xr_upd
(2) 1966/ 6000C76 :                     ; ; 		add	r6,r5
(2) 1967/ 6000C76 :                     ; ; 		neg	r5,r4
(2) 1968/ 6000C76 :                     ; ; 		cmp/gt	r5,r0
(2) 1969/ 6000C76 :                     ; ; 		bf	.set_xr_upd
(2) 1970/ 6000C76 :                     ; ; 		cmp/ge	r4,r0
(2) 1971/ 6000C76 :                     ; ; 		bf	.no_xr_upd
(2) 1972/ 6000C76 :                     ; ; .set_xr_upd:
(2) 1973/ 6000C76 :                     ; 		and	r6,r0
(2) 1974/ 6000C76 :                     ; 		mov	r0,@(mdllay_xr_last,r14)
(2) 1975/ 6000C76 :                     ; 		add	#1,r10
(2) 1976/ 6000C76 :                     ; .no_xr_upd:
(2) 1977/ 6000C76 :                     ;
(2) 1978/ 6000C76 :                     ; 		cmp/pl	r10
(2) 1979/ 6000C76 :                     ; 		bf	.no_lay
(2) 1980/ 6000C76 :                     ; 		bsr	MarsLay_Draw
(2) 1981/ 6000C76 :                     ; 		nop
(2) 1982/ 6000C76 :                     ; .no_lay:
(2) 1983/ 6000C76 :                     ; 		lds	@r15+,pr
(2) 1984/ 6000C76 :                     ; 		rts
(2) 1985/ 6000C76 :                     ; 		nop
(2) 1986/ 6000C76 :                     ; 		align 4
(2) 1987/ 6000C76 :                     ; 		ltorg
(2) 1988/ 6000C76 :                     ;
(2) 1989/ 6000C76 :                     ; ; r1 - layout data pointer
(2) 1990/ 6000C76 :                     ; MarsLay_Make:
(2) 1991/ 6000C76 :                     ; 		mov	#RAM_Mars_ObjLayout,r14
(2) 1992/ 6000C76 :                     ; 		mov	#RAM_Mars_ObjCamera,r13
(2) 1993/ 6000C76 :                     ; 		xor	r0,r0
(2) 1994/ 6000C76 :                     ; 		mov	r1,@(mdllay_data,r14)
(2) 1995/ 6000C76 :                     ; 		mov	r0,@(mdllay_x_last,r14)
(2) 1996/ 6000C76 :                     ; 		mov	r0,@(mdllay_y_last,r14)
(2) 1997/ 6000C76 :                     ; 		mov	r0,@(mdllay_z_last,r14)
(2) 1998/ 6000C76 :                     ; 		mov	r0,@(mdllay_x,r14)
(2) 1999/ 6000C76 :                     ; 		mov	r0,@(mdllay_y,r14)
(2) 2000/ 6000C76 :                     ; 		mov	r0,@(mdllay_z,r14)
(2) 2001/ 6000C76 :                     ; 		rts
(2) 2002/ 6000C76 :                     ; 		nop
(2) 2003/ 6000C76 :                     ; 		align 4
(2) 2004/ 6000C76 :                     ;
(2) 2005/ 6000C76 :                     ; MarsLay_Draw:
(2) 2006/ 6000C76 :                     ; 		mov	#RAM_Mars_Objects,r10
(2) 2007/ 6000C76 :                     ; 		mov	r10,r2
(2) 2008/ 6000C76 :                     ; 		mov	#sizeof_mdlobj,r3
(2) 2009/ 6000C76 :                     ; 		mov	#0,r0
(2) 2010/ 6000C76 :                     ; 		mov	#9,r4
(2) 2011/ 6000C76 :                     ; .clrold:
(2) 2012/ 6000C76 :                     ; 		mov	r0,@(mdl_data,r2)
(2) 2013/ 6000C76 :                     ; 		mov	r0,@(mdl_x_pos,r2)
(2) 2014/ 6000C76 :                     ; 		mov	r0,@(mdl_y_pos,r2)
(2) 2015/ 6000C76 :                     ; 		mov	r0,@(mdl_z_pos,r2)
(2) 2016/ 6000C76 :                     ; 		mov	r0,@(mdl_x_rot,r2)
(2) 2017/ 6000C76 :                     ; 		mov	r0,@(mdl_y_rot,r2)
(2) 2018/ 6000C76 :                     ; 		mov	r0,@(mdl_z_rot,r2)
(2) 2019/ 6000C76 :                     ; 		dt	r4
(2) 2020/ 6000C76 :                     ; 		bf/s	.clrold
(2) 2021/ 6000C76 :                     ; 		add	r3,r2
(2) 2022/ 6000C76 :                     ;
(2) 2023/ 6000C76 :                     ; 	; r13 - Layout Ids
(2) 2024/ 6000C76 :                     ; 	; r12 - Layout model list
(2) 2025/ 6000C76 :                     ; 		mov	#0,r4
(2) 2026/ 6000C76 :                     ; 		mov	@(mdllay_data,r14),r13
(2) 2027/ 6000C76 :                     ; 		mov	@r13+,r12
(2) 2028/ 6000C76 :                     ; 		mov	.center_val,r0			; list center point
(2) 2029/ 6000C76 :                     ; 		add	r0,r13
(2) 2030/ 6000C76 :                     ;
(2) 2031/ 6000C76 :                     ; 	; X/Y add
(2) 2032/ 6000C76 :                     ; 		mov	@(mdllay_x_last,r14),r1
(2) 2033/ 6000C76 :                     ; 		mov	@(mdllay_z_last,r14),r2
(2) 2034/ 6000C76 :                     ; 		mov	#LAY_WIDTH,r0
(2) 2035/ 6000C76 :                     ; 		shlr16	r1
(2) 2036/ 6000C76 :                     ; 		shlr16	r2
(2) 2037/ 6000C76 :                     ; 		exts	r1,r1
(2) 2038/ 6000C76 :                     ; 		exts	r2,r2
(2) 2039/ 6000C76 :                     ; 	rept 3
(2) 2040/ 6000C76 :                     ; 		shar	r1
(2) 2041/ 6000C76 :                     ; 		shar	r2
(2) 2042/ 6000C76 :                     ; 	endm
(2) 2043/ 6000C76 :                     ; 		shar	r2			; extra shift
(2) 2044/ 6000C76 :                     ; 		muls	r0,r2
(2) 2045/ 6000C76 :                     ; 		sts	macl,r0
(2) 2046/ 6000C76 :                     ; 		add	r1,r13			; X add
(2) 2047/ 6000C76 :                     ; 		sub	r0,r13			; Y add
(2) 2048/ 6000C76 :                     ;
(2) 2049/ 6000C76 :                     ; 	; Rotation
(2) 2050/ 6000C76 :                     ; 		mov	@(mdllay_xr_last,r14),r0
(2) 2051/ 6000C76 :                     ; 		shlr16	r0
(2) 2052/ 6000C76 :                     ; 		and	#$3F,r0
(2) 2053/ 6000C76 :                     ; 		shll2	r0
(2) 2054/ 6000C76 :                     ; 		mov	#.list,r1
(2) 2055/ 6000C76 :                     ; 		mov	@(r0,r1),r0
(2) 2056/ 6000C76 :                     ; 		jmp	@r0
(2) 2057/ 6000C76 :                     ; 		nop
(2) 2058/ 6000C76 :                     ; 		align 4
(2) 2059/ 6000C76 :                     ; .center_val:	dc.l ($E*LAY_WIDTH)+($C*2)
(2) 2060/ 6000C76 :                     ;
(2) 2061/ 6000C76 :                     ; .list:
(2) 2062/ 6000C76 :                     ; 		dc.l .front
(2) 2063/ 6000C76 :                     ; 		dc.l .front_fr
(2) 2064/ 6000C76 :                     ; 		dc.l .front_fr
(2) 2065/ 6000C76 :                     ; 		dc.l .front_fr
(2) 2066/ 6000C76 :                     ; 		dc.l .front_fr
(2) 2067/ 6000C76 :                     ; 		dc.l .front_fr
(2) 2068/ 6000C76 :                     ; 		dc.l .front_fr
(2) 2069/ 6000C76 :                     ; 		dc.l .front_fr
(2) 2070/ 6000C76 :                     ; 		dc.l .front_fr
(2) 2071/ 6000C76 :                     ; 		dc.l .front_fr
(2) 2072/ 6000C76 :                     ; 		dc.l .front_fr
(2) 2073/ 6000C76 :                     ; 		dc.l .front_fr
(2) 2074/ 6000C76 :                     ; 		dc.l .front_fr
(2) 2075/ 6000C76 :                     ; 		dc.l .front_fr
(2) 2076/ 6000C76 :                     ; 		dc.l .front_fr
(2) 2077/ 6000C76 :                     ; 		dc.l .front_fr
(2) 2078/ 6000C76 :                     ;
(2) 2079/ 6000C76 :                     ; 		dc.l .front_fr
(2) 2080/ 6000C76 :                     ; 		dc.l .front_fr
(2) 2081/ 6000C76 :                     ; 		dc.l .right_dw
(2) 2082/ 6000C76 :                     ; 		dc.l .right_dw
(2) 2083/ 6000C76 :                     ; 		dc.l .right_dw
(2) 2084/ 6000C76 :                     ; 		dc.l .right_dw
(2) 2085/ 6000C76 :                     ; 		dc.l .right_dw
(2) 2086/ 6000C76 :                     ; 		dc.l .right_dw
(2) 2087/ 6000C76 :                     ; 		dc.l .right_dw
(2) 2088/ 6000C76 :                     ; 		dc.l .right_dw
(2) 2089/ 6000C76 :                     ; 		dc.l .right_dw
(2) 2090/ 6000C76 :                     ; 		dc.l .right_dw
(2) 2091/ 6000C76 :                     ; 		dc.l .right_dw
(2) 2092/ 6000C76 :                     ; 		dc.l .right_dw
(2) 2093/ 6000C76 :                     ; 		dc.l .right_dw
(2) 2094/ 6000C76 :                     ; 		dc.l .right_dw
(2) 2095/ 6000C76 :                     ;
(2) 2096/ 6000C76 :                     ; 		dc.l .right_dw
(2) 2097/ 6000C76 :                     ; 		dc.l .right_dw
(2) 2098/ 6000C76 :                     ; 		dc.l .down_left
(2) 2099/ 6000C76 :                     ; 		dc.l .down_left
(2) 2100/ 6000C76 :                     ; 		dc.l .down_left
(2) 2101/ 6000C76 :                     ; 		dc.l .down_left
(2) 2102/ 6000C76 :                     ; 		dc.l .down_left
(2) 2103/ 6000C76 :                     ; 		dc.l .down_left
(2) 2104/ 6000C76 :                     ; 		dc.l .down_left
(2) 2105/ 6000C76 :                     ; 		dc.l .down_left
(2) 2106/ 6000C76 :                     ; 		dc.l .down_left
(2) 2107/ 6000C76 :                     ; 		dc.l .down_left
(2) 2108/ 6000C76 :                     ; 		dc.l .down_left
(2) 2109/ 6000C76 :                     ; 		dc.l .down_left
(2) 2110/ 6000C76 :                     ; 		dc.l .down_left
(2) 2111/ 6000C76 :                     ; 		dc.l .down_left
(2) 2112/ 6000C76 :                     ;
(2) 2113/ 6000C76 :                     ; 		dc.l .down_left
(2) 2114/ 6000C76 :                     ; 		dc.l .down_left
(2) 2115/ 6000C76 :                     ; 		dc.l .front_lf
(2) 2116/ 6000C76 :                     ; 		dc.l .front_lf
(2) 2117/ 6000C76 :                     ; 		dc.l .front_lf
(2) 2118/ 6000C76 :                     ; 		dc.l .front_lf
(2) 2119/ 6000C76 :                     ; 		dc.l .front_lf
(2) 2120/ 6000C76 :                     ; 		dc.l .front_lf
(2) 2121/ 6000C76 :                     ; 		dc.l .front_lf
(2) 2122/ 6000C76 :                     ; 		dc.l .front_lf
(2) 2123/ 6000C76 :                     ; 		dc.l .front_lf
(2) 2124/ 6000C76 :                     ; 		dc.l .front_lf
(2) 2125/ 6000C76 :                     ; 		dc.l .front_lf
(2) 2126/ 6000C76 :                     ; 		dc.l .front
(2) 2127/ 6000C76 :                     ; 		dc.l .front
(2) 2128/ 6000C76 :                     ; 		dc.l .front
(2) 2129/ 6000C76 :                     ;
(2) 2130/ 6000C76 :                     ; ; r5 - numof pieces
(2) 2131/ 6000C76 :                     ; ; uses: r6,r7
(2) 2132/ 6000C76 :                     ; .do_piece:
(2) 2133/ 6000C76 :                     ; 		mov	r1,@-r15
(2) 2134/ 6000C76 :                     ; 		mov	r13,@-r15
(2) 2135/ 6000C76 :                     ; 		mov	#$100000,r6
(2) 2136/ 6000C76 :                     ; .nxt_one:
(2) 2137/ 6000C76 :                     ; 		xor	r4,r4
(2) 2138/ 6000C76 :                     ; 		mov.w	@r13+,r0
(2) 2139/ 6000C76 :                     ; 		cmp/pl 	r0
(2) 2140/ 6000C76 :                     ; 		bf	.blank_mdl
(2) 2141/ 6000C76 :                     ; ; 		mov	r0,r7
(2) 2142/ 6000C76 :                     ; ; 		shlr8	r0
(2) 2143/ 6000C76 :                     ; ; 		shlr2	r0
(2) 2144/ 6000C76 :                     ; ; 		shlr	r0
(2) 2145/ 6000C76 :                     ; ; 		and	#%11100,r0
(2) 2146/ 6000C76 :                     ; ; 		mov	#.xrotlist,r8
(2) 2147/ 6000C76 :                     ; ; 		mov	@(r8,r0),r8
(2) 2148/ 6000C76 :                     ; ; 		mov	r7,r0
(2) 2149/ 6000C76 :                     ; 		add	#-1,r0
(2) 2150/ 6000C76 :                     ; 		shll2	r0
(2) 2151/ 6000C76 :                     ; ; 		shll	r0
(2) 2152/ 6000C76 :                     ; ; 		mov	#$1FFF,r7
(2) 2153/ 6000C76 :                     ; ; 		and	r7,r0
(2) 2154/ 6000C76 :                     ; 		mov	@(r12,r0),r4
(2) 2155/ 6000C76 :                     ; 		mov	#$40000000,r0	; OR val: set special object mode
(2) 2156/ 6000C76 :                     ; 		or	r0,r4
(2) 2157/ 6000C76 :                     ; .blank_mdl:
(2) 2158/ 6000C76 :                     ; 		mov	r1,@(mdl_x_pos,r10)
(2) 2159/ 6000C76 :                     ; 		mov	r2,@(mdl_y_pos,r10)
(2) 2160/ 6000C76 :                     ; 		mov	r3,@(mdl_z_pos,r10)
(2) 2161/ 6000C76 :                     ; ; 		mov	r8,@(mdl_x_rot,r10)
(2) 2162/ 6000C76 :                     ; 		mov	r4,@(mdl_data,r10)
(2) 2163/ 6000C76 :                     ; 		add	#sizeof_mdlobj,r10
(2) 2164/ 6000C76 :                     ; 		dt	r5
(2) 2165/ 6000C76 :                     ; 		bf/s	.nxt_one
(2) 2166/ 6000C76 :                     ; 		add	r6,r1
(2) 2167/ 6000C76 :                     ; 		mov	@r15+,r13
(2) 2168/ 6000C76 :                     ; 		mov	@r15+,r1
(2) 2169/ 6000C76 :                     ; 		rts
(2) 2170/ 6000C76 :                     ; 		nop
(2) 2171/ 6000C76 :                     ; 		align 4
(2) 2172/ 6000C76 :                     ; ; .xrotlist:	dc.l 0
(2) 2173/ 6000C76 :                     ; ; 		dc.l $100000
(2) 2174/ 6000C76 :                     ; ; 		dc.l $200000
(2) 2175/ 6000C76 :                     ; ; 		dc.l $300000
(2) 2176/ 6000C76 :                     ;
(2) 2177/ 6000C76 :                     ; ; o X X X o
(2) 2178/ 6000C76 :                     ; ; o X X X o
(2) 2179/ 6000C76 :                     ; ; o X C X o
(2) 2180/ 6000C76 :                     ; ; o - - - o
(2) 2181/ 6000C76 :                     ; ; o o o o o
(2) 2182/ 6000C76 :                     ; .front:
(2) 2183/ 6000C76 :                     ; 		mov	#-$100000,r1
(2) 2184/ 6000C76 :                     ; 		mov	#0,r2
(2) 2185/ 6000C76 :                     ; 		mov	#-$200000,r3
(2) 2186/ 6000C76 :                     ; 		add	#(1*2),r13
(2) 2187/ 6000C76 :                     ; 		mov	#$100000,r11
(2) 2188/ 6000C76 :                     ;
(2) 2189/ 6000C76 :                     ; 		sts	pr,@-r15
(2) 2190/ 6000C76 :                     ; 		bsr	.do_piece
(2) 2191/ 6000C76 :                     ; 		mov	#3,r5
(2) 2192/ 6000C76 :                     ; 		add	#LAY_WIDTH,r13
(2) 2193/ 6000C76 :                     ; 		add	r11,r3
(2) 2194/ 6000C76 :                     ; 		bsr	.do_piece
(2) 2195/ 6000C76 :                     ; 		mov	#3,r5
(2) 2196/ 6000C76 :                     ; 		add	#LAY_WIDTH,r13
(2) 2197/ 6000C76 :                     ; 		add	r11,r3
(2) 2198/ 6000C76 :                     ; 		bsr	.do_piece
(2) 2199/ 6000C76 :                     ; 		mov	#3,r5
(2) 2200/ 6000C76 :                     ; 		lds	@r15+,pr
(2) 2201/ 6000C76 :                     ; 		rts
(2) 2202/ 6000C76 :                     ; 		nop
(2) 2203/ 6000C76 :                     ; 		align 4
(2) 2204/ 6000C76 :                     ;
(2) 2205/ 6000C76 :                     ; ; front right view
(2) 2206/ 6000C76 :                     ; ; o o X X X
(2) 2207/ 6000C76 :                     ; ; o - X X X
(2) 2208/ 6000C76 :                     ; ; o - C X X
(2) 2209/ 6000C76 :                     ; ; o - - - o
(2) 2210/ 6000C76 :                     ; ; o o o o o
(2) 2211/ 6000C76 :                     ; .front_fr:
(2) 2212/ 6000C76 :                     ; 		mov	#0,r1
(2) 2213/ 6000C76 :                     ; 		mov	#0,r2
(2) 2214/ 6000C76 :                     ; 		mov	#-$200000,r3
(2) 2215/ 6000C76 :                     ; 		add	#(2*2),r13
(2) 2216/ 6000C76 :                     ; 		mov	#$100000,r11
(2) 2217/ 6000C76 :                     ; 		sts	pr,@-r15
(2) 2218/ 6000C76 :                     ; 		bsr	.do_piece
(2) 2219/ 6000C76 :                     ; 		mov	#3,r5
(2) 2220/ 6000C76 :                     ; 		add	#LAY_WIDTH,r13
(2) 2221/ 6000C76 :                     ; 		add	r11,r3
(2) 2222/ 6000C76 :                     ; 		bsr	.do_piece
(2) 2223/ 6000C76 :                     ; 		mov	#3,r5
(2) 2224/ 6000C76 :                     ; 		add	#LAY_WIDTH,r13
(2) 2225/ 6000C76 :                     ; 		add	r11,r3
(2) 2226/ 6000C76 :                     ; 		bsr	.do_piece
(2) 2227/ 6000C76 :                     ; 		mov	#3,r5
(2) 2228/ 6000C76 :                     ; 		lds	@r15+,pr
(2) 2229/ 6000C76 :                     ; 		rts
(2) 2230/ 6000C76 :                     ; 		nop
(2) 2231/ 6000C76 :                     ; 		align 4
(2) 2232/ 6000C76 :                     ;
(2) 2233/ 6000C76 :                     ;
(2) 2234/ 6000C76 :                     ; ; right view/down
(2) 2235/ 6000C76 :                     ; ; o o o o o
(2) 2236/ 6000C76 :                     ; ; o - - - o
(2) 2237/ 6000C76 :                     ; ; o - C X X
(2) 2238/ 6000C76 :                     ; ; o - X X X
(2) 2239/ 6000C76 :                     ; ; o o X X X
(2) 2240/ 6000C76 :                     ; .right_dw:
(2) 2241/ 6000C76 :                     ; 		mov	#0,r1
(2) 2242/ 6000C76 :                     ; 		mov	#0,r2
(2) 2243/ 6000C76 :                     ; 		mov	#-$100000,r3
(2) 2244/ 6000C76 :                     ; 		mov	#(2*2)+(LAY_WIDTH),r0
(2) 2245/ 6000C76 :                     ; 		add	r0,r13
(2) 2246/ 6000C76 :                     ; 		mov	#$100000,r11
(2) 2247/ 6000C76 :                     ; 		sts	pr,@-r15
(2) 2248/ 6000C76 :                     ; 		bsr	.do_piece
(2) 2249/ 6000C76 :                     ; 		mov	#3,r5
(2) 2250/ 6000C76 :                     ; 		add	#LAY_WIDTH,r13
(2) 2251/ 6000C76 :                     ; 		add	r11,r3
(2) 2252/ 6000C76 :                     ; 		bsr	.do_piece
(2) 2253/ 6000C76 :                     ; 		mov	#3,r5
(2) 2254/ 6000C76 :                     ; 		add	#LAY_WIDTH,r13
(2) 2255/ 6000C76 :                     ; 		add	r11,r3
(2) 2256/ 6000C76 :                     ; 		bsr	.do_piece
(2) 2257/ 6000C76 :                     ; 		mov	#3,r5
(2) 2258/ 6000C76 :                     ; 		lds	@r15+,pr
(2) 2259/ 6000C76 :                     ; 		rts
(2) 2260/ 6000C76 :                     ; 		nop
(2) 2261/ 6000C76 :                     ; 		align 4
(2) 2262/ 6000C76 :                     ;
(2) 2263/ 6000C76 :                     ; ; o o o o o
(2) 2264/ 6000C76 :                     ; ; o - - - o
(2) 2265/ 6000C76 :                     ; ; o X C X o
(2) 2266/ 6000C76 :                     ; ; o X X X o
(2) 2267/ 6000C76 :                     ; ; o X X X o
(2) 2268/ 6000C76 :                     ; .down:
(2) 2269/ 6000C76 :                     ; 		mov	#0,r1
(2) 2270/ 6000C76 :                     ; 		mov	#0,r2
(2) 2271/ 6000C76 :                     ; 		mov	#-$100000,r3
(2) 2272/ 6000C76 :                     ; 		mov	#(2*2)+(LAY_WIDTH*1),r0
(2) 2273/ 6000C76 :                     ; 		add	r0,r13
(2) 2274/ 6000C76 :                     ; 		mov	#$100000,r11
(2) 2275/ 6000C76 :                     ; 		sts	pr,@-r15
(2) 2276/ 6000C76 :                     ; 		bsr	.do_piece
(2) 2277/ 6000C76 :                     ; 		mov	#3,r5
(2) 2278/ 6000C76 :                     ; 		add	#LAY_WIDTH,r13
(2) 2279/ 6000C76 :                     ; 		add	r11,r3
(2) 2280/ 6000C76 :                     ; 		bsr	.do_piece
(2) 2281/ 6000C76 :                     ; 		mov	#3,r5
(2) 2282/ 6000C76 :                     ; 		add	#LAY_WIDTH,r13
(2) 2283/ 6000C76 :                     ; 		add	r11,r3
(2) 2284/ 6000C76 :                     ; 		bsr	.do_piece
(2) 2285/ 6000C76 :                     ; 		mov	#3,r5
(2) 2286/ 6000C76 :                     ; 		lds	@r15+,pr
(2) 2287/ 6000C76 :                     ; 		rts
(2) 2288/ 6000C76 :                     ; 		nop
(2) 2289/ 6000C76 :                     ; 		align 4
(2) 2290/ 6000C76 :                     ;
(2) 2291/ 6000C76 :                     ; ; o o o o o
(2) 2292/ 6000C76 :                     ; ; o - - - o
(2) 2293/ 6000C76 :                     ; ; X X C - o
(2) 2294/ 6000C76 :                     ; ; X X X - o
(2) 2295/ 6000C76 :                     ; ; X X X o o
(2) 2296/ 6000C76 :                     ; .down_left:
(2) 2297/ 6000C76 :                     ; 		mov	#-$100000,r1
(2) 2298/ 6000C76 :                     ; 		mov	#0,r2
(2) 2299/ 6000C76 :                     ; 		mov	#-$100000,r3
(2) 2300/ 6000C76 :                     ; 		mov	#(1*2)+(LAY_WIDTH*1),r0
(2) 2301/ 6000C76 :                     ; 		add	r0,r13
(2) 2302/ 6000C76 :                     ; 		mov	#$100000,r11
(2) 2303/ 6000C76 :                     ; 		sts	pr,@-r15
(2) 2304/ 6000C76 :                     ; 		bsr	.do_piece
(2) 2305/ 6000C76 :                     ; 		mov	#3,r5
(2) 2306/ 6000C76 :                     ; 		add	#LAY_WIDTH,r13
(2) 2307/ 6000C76 :                     ; 		add	r11,r3
(2) 2308/ 6000C76 :                     ; 		bsr	.do_piece
(2) 2309/ 6000C76 :                     ; 		mov	#3,r5
(2) 2310/ 6000C76 :                     ; 		add	#LAY_WIDTH,r13
(2) 2311/ 6000C76 :                     ; 		add	r11,r3
(2) 2312/ 6000C76 :                     ; 		bsr	.do_piece
(2) 2313/ 6000C76 :                     ; 		mov	#3,r5
(2) 2314/ 6000C76 :                     ; 		lds	@r15+,pr
(2) 2315/ 6000C76 :                     ; 		rts
(2) 2316/ 6000C76 :                     ; 		nop
(2) 2317/ 6000C76 :                     ; 		align 4
(2) 2318/ 6000C76 :                     ;
(2) 2319/ 6000C76 :                     ;
(2) 2320/ 6000C76 :                     ; ; X X X o o
(2) 2321/ 6000C76 :                     ; ; X X X - o
(2) 2322/ 6000C76 :                     ; ; X X C - o
(2) 2323/ 6000C76 :                     ; ; o - - - o
(2) 2324/ 6000C76 :                     ; ; o o o o o
(2) 2325/ 6000C76 :                     ; .front_lf:
(2) 2326/ 6000C76 :                     ; 		mov	#-$100000,r1
(2) 2327/ 6000C76 :                     ; 		mov	#0,r2
(2) 2328/ 6000C76 :                     ; 		mov	#-$200000,r3
(2) 2329/ 6000C76 :                     ; 		add	#(1*2),r13
(2) 2330/ 6000C76 :                     ; 		mov	#$100000,r11
(2) 2331/ 6000C76 :                     ; 		sts	pr,@-r15
(2) 2332/ 6000C76 :                     ; 		bsr	.do_piece
(2) 2333/ 6000C76 :                     ; 		mov	#3,r5
(2) 2334/ 6000C76 :                     ; 		add	#LAY_WIDTH,r13
(2) 2335/ 6000C76 :                     ; 		add	r11,r3
(2) 2336/ 6000C76 :                     ; 		bsr	.do_piece
(2) 2337/ 6000C76 :                     ; 		mov	#3,r5
(2) 2338/ 6000C76 :                     ; 		add	#LAY_WIDTH,r13
(2) 2339/ 6000C76 :                     ; 		add	r11,r3
(2) 2340/ 6000C76 :                     ; 		bsr	.do_piece
(2) 2341/ 6000C76 :                     ; 		mov	#3,r5
(2) 2342/ 6000C76 :                     ; 		lds	@r15+,pr
(2) 2343/ 6000C76 :                     ; 		rts
(2) 2344/ 6000C76 :                     ; 		nop
(2) 2345/ 6000C76 :                     ; 		align 4
(2) 2346/ 6000C76 :                     ; 		ltorg
(2) 2347/ 6000C76 :                     ;
(2) 2348/ 6000C76 :                     ; ; ------------------------------------------------
(2) 2349/ 6000C76 :                     ; ; MarsMdl_Init
(2) 2350/ 6000C76 :                     ; ;
(2) 2351/ 6000C76 :                     ; ; Reset ALL objects
(2) 2352/ 6000C76 :                     ; ; ------------------------------------------------
(2) 2353/ 6000C76 :                     ;
(2) 2354/ 6000C76 :                     ; MarsMdl_Init:
(2) 2355/ 6000C76 :                     ; 		mov	#RAM_Mars_Objects,r1
(2) 2356/ 6000C76 :                     ; 		mov	#MAX_MODELS,r2
(2) 2357/ 6000C76 :                     ; 		mov	#0,r0
(2) 2358/ 6000C76 :                     ; .clnup:
(2) 2359/ 6000C76 :                     ; 		mov	r0,@(mdl_data,r1)
(2) 2360/ 6000C76 :                     ; 		mov	r0,@(mdl_animdata,r1)
(2) 2361/ 6000C76 :                     ; 		mov	r0,@(mdl_x_pos,r1)
(2) 2362/ 6000C76 :                     ; 		mov	r0,@(mdl_x_rot,r1)
(2) 2363/ 6000C76 :                     ; 		mov	r0,@(mdl_y_pos,r1)
(2) 2364/ 6000C76 :                     ; 		mov	r0,@(mdl_y_rot,r1)
(2) 2365/ 6000C76 :                     ; 		mov	r0,@(mdl_y_pos,r1)
(2) 2366/ 6000C76 :                     ; 		mov	r0,@(mdl_y_rot,r1)
(2) 2367/ 6000C76 :                     ; 		dt	r2
(2) 2368/ 6000C76 :                     ; 		bf/s	.clnup
(2) 2369/ 6000C76 :                     ; 		add	#sizeof_mdlobj,r1
(2) 2370/ 6000C76 :                     ; 		rts
(2) 2371/ 6000C76 :                     ; 		nop
(2) 2372/ 6000C76 :                     ; 		align 4
(2) 2373/ 6000C76 :                     ; 		ltorg
(2) 2374/ 6000C76 :                     ;
(2) 2375/ 6000C76 :                     ; ; ------------------------------------------------
(2) 2376/ 6000C76 :                     ; ; Read model
(2) 2377/ 6000C76 :                     ; ; ------------------------------------------------
(2) 2378/ 6000C76 :                     ;
(2) 2379/ 6000C76 :                     ; MarsMdl_ReadModel:
(2) 2380/ 6000C76 :                     ; 		sts	pr,@-r15
(2) 2381/ 6000C76 :                     ; 		mov	@(mdl_animdata,r14),r13
(2) 2382/ 6000C76 :                     ; 		cmp/pl	r13
(2) 2383/ 6000C76 :                     ; 		bf	.no_anim
(2) 2384/ 6000C76 :                     ; 		mov	@(mdl_animtimer,r14),r0
(2) 2385/ 6000C76 :                     ; 		add	#-1,r0
(2) 2386/ 6000C76 :                     ; 		cmp/pl 	r0
(2) 2387/ 6000C76 :                     ; 		bt	.wait_camanim
(2) 2388/ 6000C76 :                     ; 		mov	@r13+,r2
(2) 2389/ 6000C76 :                     ; 		mov	@(mdl_animframe,r14),r0
(2) 2390/ 6000C76 :                     ; 		add	#1,r0
(2) 2391/ 6000C76 :                     ; 		cmp/eq	r2,r0
(2) 2392/ 6000C76 :                     ; 		bf	.on_frames
(2) 2393/ 6000C76 :                     ; 		xor	r0,r0
(2) 2394/ 6000C76 :                     ; .on_frames:
(2) 2395/ 6000C76 :                     ; 		mov	r0,r1
(2) 2396/ 6000C76 :                     ; 		mov	r0,@(mdl_animframe,r14)
(2) 2397/ 6000C76 :                     ; 		mov	#$18,r0
(2) 2398/ 6000C76 :                     ; 		mulu	r0,r1
(2) 2399/ 6000C76 :                     ; 		sts	macl,r0
(2) 2400/ 6000C76 :                     ; 		add	r0,r13
(2) 2401/ 6000C76 :                     ; 		mov	@r13+,r1
(2) 2402/ 6000C76 :                     ; 		mov	@r13+,r2
(2) 2403/ 6000C76 :                     ; 		mov	@r13+,r3
(2) 2404/ 6000C76 :                     ; 		mov	@r13+,r4
(2) 2405/ 6000C76 :                     ; 		mov	@r13+,r5
(2) 2406/ 6000C76 :                     ; 		mov	@r13+,r6
(2) 2407/ 6000C76 :                     ; ; 		neg	r4,r4
(2) 2408/ 6000C76 :                     ; 		mov	r1,@(mdl_x_pos,r14)
(2) 2409/ 6000C76 :                     ; 		mov	r2,@(mdl_y_pos,r14)
(2) 2410/ 6000C76 :                     ; 		mov	r3,@(mdl_z_pos,r14)
(2) 2411/ 6000C76 :                     ; 		mov	r4,@(mdl_x_rot,r14)
(2) 2412/ 6000C76 :                     ; 		mov	r5,@(mdl_y_rot,r14)
(2) 2413/ 6000C76 :                     ; 		mov	r6,@(mdl_z_rot,r14)
(2) 2414/ 6000C76 :                     ; 		mov	@(mdl_animspd,r14),r0		; TODO: make a timer setting
(2) 2415/ 6000C76 :                     ; .wait_camanim:
(2) 2416/ 6000C76 :                     ; 		mov	r0,@(mdl_animtimer,r14)
(2) 2417/ 6000C76 :                     ; .no_anim:
(2) 2418/ 6000C76 :                     ; 	; Now start reading
(2) 2419/ 6000C76 :                     ; 		mov	#$3FFFFFFF,r0
(2) 2420/ 6000C76 :                     ; 		mov	#Cach_CurrPlygn,r13		; r13 - temporal face output
(2) 2421/ 6000C76 :                     ; 		mov	@(mdl_data,r14),r12		; r12 - model header
(2) 2422/ 6000C76 :                     ; 		and	r0,r12
(2) 2423/ 6000C76 :                     ; 		mov 	@(8,r12),r11			; r11 - face data
(2) 2424/ 6000C76 :                     ; 		mov 	@(4,r12),r10			; r10 - vertice data (X,Y,Z)
(2) 2425/ 6000C76 :                     ; 		mov.w	@r12,r9				;  r9 - Number of faces used on model
(2) 2426/ 6000C76 :                     ; 		mov	@(marsGbl_CurrZList,gbr),r0	;  r8 - Zlist for sorting
(2) 2427/ 6000C76 :                     ; 		mov	r0,r8
(2) 2428/ 6000C76 :                     ; .next_face:
(2) 2429/ 6000C76 :                     ; 		mov.w	@(marsGbl_MdlFacesCntr,gbr),r0	; Ran out of space to store faces?
(2) 2430/ 6000C76 :                     ; 		mov	.tag_maxfaces,r1
(2) 2431/ 6000C76 :                     ; 		cmp/ge	r1,r0
(2) 2432/ 6000C76 :                     ; 		bf	.can_build
(2) 2433/ 6000C76 :                     ; 		bra	.exit_model
(2) 2434/ 6000C76 :                     ; 		nop
(2) 2435/ 6000C76 :                     ; 		align 4
(2) 2436/ 6000C76 :                     ; .tag_maxfaces:	dc.l	MAX_FACES
(2) 2437/ 6000C76 :                     ;
(2) 2438/ 6000C76 :                     ; ; --------------------------------
(2) 2439/ 6000C76 :                     ;
(2) 2440/ 6000C76 :                     ; .can_build:
(2) 2441/ 6000C76 :                     ; 		mov.w	@r11+,r4		; Read type
(2) 2442/ 6000C76 :                     ; 		mov	#3,r7			; r7 - Current polygon type: triangle (3)
(2) 2443/ 6000C76 :                     ; 		mov	r4,r0
(2) 2444/ 6000C76 :                     ; 		shlr8	r0
(2) 2445/ 6000C76 :                     ; 		tst	#PLGN_TRI,r0		; Model face uses triangle?
(2) 2446/ 6000C76 :                     ; 		bf	.set_tri
(2) 2447/ 6000C76 :                     ; 		add	#1,r7			; Face is quad, r7 = 4 points
(2) 2448/ 6000C76 :                     ; .set_tri:
(2) 2449/ 6000C76 :                     ; 		cmp/pl	r4			; Faces uses texture? ($8xxx)
(2) 2450/ 6000C76 :                     ; 		bt	.solid_type
(2) 2451/ 6000C76 :                     ;
(2) 2452/ 6000C76 :                     ; ; --------------------------------
(2) 2453/ 6000C76 :                     ; ; Set texture material
(2) 2454/ 6000C76 :                     ; ; --------------------------------
(2) 2455/ 6000C76 :                     ;
(2) 2456/ 6000C76 :                     ; 		mov	@($C,r12),r6		; r6 - Material data
(2) 2457/ 6000C76 :                     ; 		mov	r13,r5			; r5 - Go to UV section
(2) 2458/ 6000C76 :                     ; 		add 	#polygn_srcpnts,r5
(2) 2459/ 6000C76 :                     ; 		mov	r7,r3			; r3 - copy of current face points (3 or 4)
(2) 2460/ 6000C76 :                     ;
(2) 2461/ 6000C76 :                     ; 	; New method
(2) 2462/ 6000C76 :                     ; 	rept 3
(2) 2463/ 6000C76 :                     ; 		mov.w	@r11+,r0			; Read UV index
(2) 2464/ 6000C76 :                     ; 		extu	r0,r0
(2) 2465/ 6000C76 :                     ; 		shll2	r0
(2) 2466/ 6000C76 :                     ; 		mov	@(r6,r0),r0
(2) 2467/ 6000C76 :                     ; 		mov.w	r0,@(2,r5)
(2) 2468/ 6000C76 :                     ; 		shlr16	r0
(2) 2469/ 6000C76 :                     ; 		mov.w	r0,@r5
(2) 2470/ 6000C76 :                     ; 		add	#4,r5
(2) 2471/ 6000C76 :                     ; 	endm
(2) 2472/ 6000C76 :                     ; 		mov	#3,r0			; Triangle?
(2) 2473/ 6000C76 :                     ; 		cmp/eq	r0,r7
(2) 2474/ 6000C76 :                     ; 		bt	.alluvdone		; If yes, skip this
(2) 2475/ 6000C76 :                     ; 		mov.w	@r11+,r0		; Read extra UV index
(2) 2476/ 6000C76 :                     ; 		extu	r0,r0
(2) 2477/ 6000C76 :                     ; 		shll2	r0
(2) 2478/ 6000C76 :                     ; 		mov	@(r6,r0),r0
(2) 2479/ 6000C76 :                     ; 		mov.w	r0,@(2,r5)
(2) 2480/ 6000C76 :                     ; 		shlr16	r0
(2) 2481/ 6000C76 :                     ; 		mov.w	r0,@r5
(2) 2482/ 6000C76 :                     ; .alluvdone:
(2) 2483/ 6000C76 :                     ;
(2) 2484/ 6000C76 :                     ; 		mov	@(mdl_option,r14),r0
(2) 2485/ 6000C76 :                     ; 		and	#$FF,r0
(2) 2486/ 6000C76 :                     ; 		mov	r0,r1
(2) 2487/ 6000C76 :                     ; 		mov	r4,r0
(2) 2488/ 6000C76 :                     ; 		mov	.tag_andmtrl,r5
(2) 2489/ 6000C76 :                     ; 		and	r5,r0
(2) 2490/ 6000C76 :                     ; 		shll2	r0
(2) 2491/ 6000C76 :                     ; 		shll	r0
(2) 2492/ 6000C76 :                     ; 		mov	@($10,r12),r6
(2) 2493/ 6000C76 :                     ; 		add	r0,r6
(2) 2494/ 6000C76 :                     ; 		mov	#$E000,r0		; grab special bits
(2) 2495/ 6000C76 :                     ; 		and	r0,r4
(2) 2496/ 6000C76 :                     ; 		shll16	r4
(2) 2497/ 6000C76 :                     ; 		mov	@(4,r6),r0
(2) 2498/ 6000C76 :                     ; 		or	r0,r4
(2) 2499/ 6000C76 :                     ; 		add	r1,r4
(2) 2500/ 6000C76 :                     ; 		mov	r4,@(polygn_type,r13)
(2) 2501/ 6000C76 :                     ; 		mov	@r6,r0
(2) 2502/ 6000C76 :                     ; 		mov	r0,@(polygn_mtrl,r13)
(2) 2503/ 6000C76 :                     ; 		bra	.go_faces
(2) 2504/ 6000C76 :                     ; 		nop
(2) 2505/ 6000C76 :                     ; 		align 4
(2) 2506/ 6000C76 :                     ; .tag_andmtrl:
(2) 2507/ 6000C76 :                     ; 		dc.l $1FFF
(2) 2508/ 6000C76 :                     ;
(2) 2509/ 6000C76 :                     ; ; --------------------------------
(2) 2510/ 6000C76 :                     ; ; Set texture material
(2) 2511/ 6000C76 :                     ; ; --------------------------------
(2) 2512/ 6000C76 :                     ;
(2) 2513/ 6000C76 :                     ; .solid_type:
(2) 2514/ 6000C76 :                     ; 		mov	@(mdl_option,r14),r0
(2) 2515/ 6000C76 :                     ; 		and	#$FF,r0
(2) 2516/ 6000C76 :                     ; 		mov	r0,r1
(2) 2517/ 6000C76 :                     ; 		mov	r4,r0
(2) 2518/ 6000C76 :                     ; 		mov	#$E000,r5
(2) 2519/ 6000C76 :                     ; 		and	r5,r4
(2) 2520/ 6000C76 :                     ; 		shll16	r4
(2) 2521/ 6000C76 :                     ; 		add	r1,r4
(2) 2522/ 6000C76 :                     ; 		mov	r4,@(polygn_type,r13)		; Set type 0 (tri) or quad (1)
(2) 2523/ 6000C76 :                     ; 		and	#$FF,r0
(2) 2524/ 6000C76 :                     ; 		mov	r0,@(polygn_mtrl,r13)		; Set pixel color (0-255)
(2) 2525/ 6000C76 :                     ;
(2) 2526/ 6000C76 :                     ; ; --------------------------------
(2) 2527/ 6000C76 :                     ; ; Read faces
(2) 2528/ 6000C76 :                     ; ; --------------------------------
(2) 2529/ 6000C76 :                     ;
(2) 2530/ 6000C76 :                     ; .go_faces:
(2) 2531/ 6000C76 :                     ; 		mov	r13,r1
(2) 2532/ 6000C76 :                     ; 		add 	#polygn_points,r1
(2) 2533/ 6000C76 :                     ; 		mov	r11,r6
(2) 2534/ 6000C76 :                     ; 		mov	r7,r0
(2) 2535/ 6000C76 :                     ; 		shll	r0
(2) 2536/ 6000C76 :                     ; 		add	r0,r11
(2) 2537/ 6000C76 :                     ; 		mov 	r8,@-r15
(2) 2538/ 6000C76 :                     ; 		mov 	r9,@-r15
(2) 2539/ 6000C76 :                     ; 		mov 	r11,@-r15
(2) 2540/ 6000C76 :                     ; 		mov 	r12,@-r15
(2) 2541/ 6000C76 :                     ; 		mov 	r13,@-r15
(2) 2542/ 6000C76 :                     ; 		mov	.tag_xl,r8
(2) 2543/ 6000C76 :                     ; 		neg	r8,r9
(2) 2544/ 6000C76 :                     ; 		mov	#-112,r11
(2) 2545/ 6000C76 :                     ; 		neg	r11,r12
(2) 2546/ 6000C76 :                     ; 		mov	#$7FFFFFFF,r5
(2) 2547/ 6000C76 :                     ; 		mov	#$FFFFFFFF,r13
(2) 2548/ 6000C76 :                     ;
(2) 2549/ 6000C76 :                     ; 	; Do 3 points
(2) 2550/ 6000C76 :                     ; 	rept 3
(2) 2551/ 6000C76 :                     ; 		mov	#0,r0
(2) 2552/ 6000C76 :                     ; 		mov.w 	@r6+,r0
(2) 2553/ 6000C76 :                     ; 		mov	#$C,r4
(2) 2554/ 6000C76 :                     ; 		mulu	r4,r0
(2) 2555/ 6000C76 :                     ; 		sts	macl,r0
(2) 2556/ 6000C76 :                     ; 		mov	r10,r4
(2) 2557/ 6000C76 :                     ; 		add 	r0,r4
(2) 2558/ 6000C76 :                     ; 		mov	@r4,r2
(2) 2559/ 6000C76 :                     ; 		mov	@(4,r4),r3
(2) 2560/ 6000C76 :                     ; 		mov	@(8,r4),r4
(2) 2561/ 6000C76 :                     ; 		bsr	mdlrd_setpoint
(2) 2562/ 6000C76 :                     ; 		nop
(2) 2563/ 6000C76 :                     ; 		mov	r2,@r1
(2) 2564/ 6000C76 :                     ; 		mov	r3,@(4,r1)
(2) 2565/ 6000C76 :                     ; 		add	#8,r1
(2) 2566/ 6000C76 :                     ; 	endm
(2) 2567/ 6000C76 :                     ; 		mov	#3,r0			; Triangle?
(2) 2568/ 6000C76 :                     ; 		cmp/eq	r0,r7
(2) 2569/ 6000C76 :                     ; 		bt	.alldone		; If yes, skip this
(2) 2570/ 6000C76 :                     ; 		mov	#0,r0
(2) 2571/ 6000C76 :                     ; 		mov.w 	@r6+,r0
(2) 2572/ 6000C76 :                     ; 		mov	#$C,r4
(2) 2573/ 6000C76 :                     ; 		mulu	r4,r0
(2) 2574/ 6000C76 :                     ; 		sts	macl,r0
(2) 2575/ 6000C76 :                     ; 		mov	r10,r4
(2) 2576/ 6000C76 :                     ; 		add 	r0,r4
(2) 2577/ 6000C76 :                     ; 		mov	@r4,r2
(2) 2578/ 6000C76 :                     ; 		mov	@(4,r4),r3
(2) 2579/ 6000C76 :                     ; 		mov	@(8,r4),r4
(2) 2580/ 6000C76 :                     ; 		bsr	mdlrd_setpoint
(2) 2581/ 6000C76 :                     ; 		nop
(2) 2582/ 6000C76 :                     ; 		mov	r2,@r1
(2) 2583/ 6000C76 :                     ; 		mov	r3,@(4,r1)
(2) 2584/ 6000C76 :                     ; .alldone:
(2) 2585/ 6000C76 :                     ; 		mov	r8,r1
(2) 2586/ 6000C76 :                     ; 		mov	r9,r2
(2) 2587/ 6000C76 :                     ; 		mov	r11,r3
(2) 2588/ 6000C76 :                     ; 		mov	r12,r4
(2) 2589/ 6000C76 :                     ; 		mov	r13,r6
(2) 2590/ 6000C76 :                     ; 		mov	@r15+,r13
(2) 2591/ 6000C76 :                     ; 		mov	@r15+,r12
(2) 2592/ 6000C76 :                     ; 		mov	@r15+,r11
(2) 2593/ 6000C76 :                     ; 		mov	@r15+,r9
(2) 2594/ 6000C76 :                     ; 		mov	@r15+,r8
(2) 2595/ 6000C76 :                     ;
(2) 2596/ 6000C76 :                     ; 	; NOTE: if you don't like how the perspective works
(2) 2597/ 6000C76 :                     ; 	; change this register depending how you want to ignore
(2) 2598/ 6000C76 :                     ; 	; faces closer to the camera:
(2) 2599/ 6000C76 :                     ; 	;
(2) 2600/ 6000C76 :                     ; 	; r5 - Back Z point, keep affine limitations
(2) 2601/ 6000C76 :                     ; 	; r6 - Front Z point, skip face but larger faces are affected
(2) 2602/ 6000C76 :                     ;
(2) 2603/ 6000C76 :                     ; 		cmp/pz	r5
(2) 2604/ 6000C76 :                     ; 		bt	.go_fout
(2) 2605/ 6000C76 :                     ; ; 		cmp/pz	r6
(2) 2606/ 6000C76 :                     ; ; 		bt	.go_fout
(2) 2607/ 6000C76 :                     ;
(2) 2608/ 6000C76 :                     ;
(2) 2609/ 6000C76 :                     ; ; 		mov	#RAM_Mars_ObjCamera,r0
(2) 2610/ 6000C76 :                     ; ; 		mov	@(cam_y_pos,r0),r7
(2) 2611/ 6000C76 :                     ; ; 		shlr2	r7
(2) 2612/ 6000C76 :                     ; ; 		shlr2	r7
(2) 2613/ 6000C76 :                     ; ; 		shlr2	r7
(2) 2614/ 6000C76 :                     ; ; 		shlr	r7
(2) 2615/ 6000C76 :                     ; ; 		exts	r7,r7
(2) 2616/ 6000C76 :                     ; ; 		cmp/pl	r7
(2) 2617/ 6000C76 :                     ; ; 		bf	.revrscam
(2) 2618/ 6000C76 :                     ; ; 		neg	r7,r7
(2) 2619/ 6000C76 :                     ; ; .revrscam:
(2) 2620/ 6000C76 :                     ; ; 		mov	#MAX_ZDIST,r0
(2) 2621/ 6000C76 :                     ; ; 		cmp/ge	r0,r7
(2) 2622/ 6000C76 :                     ; ; 		bt	.camlimit
(2) 2623/ 6000C76 :                     ; ; 		mov	r0,r7
(2) 2624/ 6000C76 :                     ; ; .camlimit:
(2) 2625/ 6000C76 :                     ; ; 		cmp/pl	r6
(2) 2626/ 6000C76 :                     ; ; 		bt	.face_out
(2) 2627/ 6000C76 :                     ; 		mov	#MAX_ZDIST,r0		; Draw distance
(2) 2628/ 6000C76 :                     ; ; 		add 	r7,r0
(2) 2629/ 6000C76 :                     ; 		cmp/ge	r0,r5
(2) 2630/ 6000C76 :                     ; 		bf	.go_fout
(2) 2631/ 6000C76 :                     ; 		mov	#-(SCREEN_WIDTH/2),r0
(2) 2632/ 6000C76 :                     ; 		cmp/gt	r0,r1
(2) 2633/ 6000C76 :                     ; 		bf	.go_fout
(2) 2634/ 6000C76 :                     ; 		neg	r0,r0
(2) 2635/ 6000C76 :                     ; 		cmp/ge	r0,r2
(2) 2636/ 6000C76 :                     ; 		bt	.go_fout
(2) 2637/ 6000C76 :                     ; 		mov	#-(SCREEN_HEIGHT/2),r0
(2) 2638/ 6000C76 :                     ; 		cmp/gt	r0,r3
(2) 2639/ 6000C76 :                     ; 		bf	.go_fout
(2) 2640/ 6000C76 :                     ; 		neg	r0,r0
(2) 2641/ 6000C76 :                     ; 		cmp/ge	r0,r4
(2) 2642/ 6000C76 :                     ; 		bf	.face_ok
(2) 2643/ 6000C76 :                     ; .go_fout:	bra	.face_out
(2) 2644/ 6000C76 :                     ; 		nop
(2) 2645/ 6000C76 :                     ; 		align 4
(2) 2646/ 6000C76 :                     ; .tag_xl:	dc.l -160
(2) 2647/ 6000C76 :                     ;
(2) 2648/ 6000C76 :                     ; ; --------------------------------
(2) 2649/ 6000C76 :                     ;
(2) 2650/ 6000C76 :                     ; .face_ok:
(2) 2651/ 6000C76 :                     ; 		mov.w	@(marsGbl_MdlFacesCntr,gbr),r0	; Add 1 face to the list
(2) 2652/ 6000C76 :                     ; 		add	#1,r0
(2) 2653/ 6000C76 :                     ; 		mov.w	r0,@(marsGbl_MdlFacesCntr,gbr)
(2) 2654/ 6000C76 :                     ; 		mov	@(marsGbl_CurrFacePos,gbr),r0
(2) 2655/ 6000C76 :                     ; 		mov	r0,r1
(2) 2656/ 6000C76 :                     ; 		mov	r13,r2
(2) 2657/ 6000C76 :                     ; 		mov	r5,@r8				; Store current Z to Zlist
(2) 2658/ 6000C76 :                     ; 		mov	r1,@(4,r8)			; And it's address
(2) 2659/ 6000C76 :                     ;
(2) 2660/ 6000C76 :                     ; ; 	Sort this face, SLOW
(2) 2661/ 6000C76 :                     ; ; 	r7 - Curr Z
(2) 2662/ 6000C76 :                     ; ; 	r6 - Past Z
(2) 2663/ 6000C76 :                     ; 		mov.w	@(marsGbl_MdlFacesCntr,gbr),r0
(2) 2664/ 6000C76 :                     ; 		cmp/eq	#1,r0
(2) 2665/ 6000C76 :                     ; 		bt	.first_face
(2) 2666/ 6000C76 :                     ; 		cmp/eq	#2,r0
(2) 2667/ 6000C76 :                     ; 		bt	.first_face
(2) 2668/ 6000C76 :                     ; 		mov	r8,r7
(2) 2669/ 6000C76 :                     ; 		add	#-8,r7
(2) 2670/ 6000C76 :                     ; ; 		mov	@(marsGbl_CurrZList,gbr),r0
(2) 2671/ 6000C76 :                     ; ; 		mov	r0,r6
(2) 2672/ 6000C76 :                     ; 		mov	#RAM_Mars_Plgn_ZList_0,r6
(2) 2673/ 6000C76 :                     ; 		mov.w   @(marsGbl_PlgnBuffNum,gbr),r0
(2) 2674/ 6000C76 :                     ; 		tst     #1,r0
(2) 2675/ 6000C76 :                     ; 		bt	.page_2
(2) 2676/ 6000C76 :                     ; 		mov	#RAM_Mars_Plgn_ZList_1,r6
(2) 2677/ 6000C76 :                     ; .page_2:
(2) 2678/ 6000C76 :                     ; 		cmp/ge	r6,r7
(2) 2679/ 6000C76 :                     ; 		bf	.first_face
(2) 2680/ 6000C76 :                     ; 		mov	@(8,r7),r4
(2) 2681/ 6000C76 :                     ; 		mov	@r7,r5
(2) 2682/ 6000C76 :                     ; 		cmp/eq	r4,r5
(2) 2683/ 6000C76 :                     ; 		bt	.first_face
(2) 2684/ 6000C76 :                     ; 		cmp/gt	r4,r5
(2) 2685/ 6000C76 :                     ; 		bf	.swap_me
(2) 2686/ 6000C76 :                     ; 		mov	@r7,r4
(2) 2687/ 6000C76 :                     ; 		mov	@(8,r7),r5
(2) 2688/ 6000C76 :                     ; 		mov	r5,@r7
(2) 2689/ 6000C76 :                     ; 		mov	r4,@(8,r7)
(2) 2690/ 6000C76 :                     ; 		mov	@(4,r7),r4
(2) 2691/ 6000C76 :                     ; 		mov	@($C,r7),r5
(2) 2692/ 6000C76 :                     ; 		mov	r5,@(4,r7)
(2) 2693/ 6000C76 :                     ; 		mov	r4,@($C,r7)
(2) 2694/ 6000C76 :                     ; .swap_me:
(2) 2695/ 6000C76 :                     ; 		bra	.page_2
(2) 2696/ 6000C76 :                     ; 		add	#-8,r7
(2) 2697/ 6000C76 :                     ; .first_face:
(2) 2698/ 6000C76 :                     ;
(2) 2699/ 6000C76 :                     ;
(2) 2700/ 6000C76 :                     ; 		add	#8,r8				; Next Zlist entry
(2) 2701/ 6000C76 :                     ; 	rept sizeof_polygn/2				; Copy words manually
(2) 2702/ 6000C76 :                     ; 		mov.w	@r2+,r0
(2) 2703/ 6000C76 :                     ; 		mov.w	r0,@r1
(2) 2704/ 6000C76 :                     ; 		add	#2,r1
(2) 2705/ 6000C76 :                     ; 	endm
(2) 2706/ 6000C76 :                     ; 		mov	r1,r0
(2) 2707/ 6000C76 :                     ; 		mov	r0,@(marsGbl_CurrFacePos,gbr)
(2) 2708/ 6000C76 :                     ;
(2) 2709/ 6000C76 :                     ; ; 		mov	r0,r1
(2) 2710/ 6000C76 :                     ; ; 		mov	@(marsGbl_ZSortReq,gbr),r0
(2) 2711/ 6000C76 :                     ; ; 		cmp/eq	#1,r0
(2) 2712/ 6000C76 :                     ; ; 		bt	.face_out
(2) 2713/ 6000C76 :                     ; ; 		mov	#1,r0
(2) 2714/ 6000C76 :                     ; ; 		mov.w	r0,@(marsGbl_ZSortReq,gbr)
(2) 2715/ 6000C76 :                     ; .face_out:
(2) 2716/ 6000C76 :                     ; 		dt	r9
(2) 2717/ 6000C76 :                     ; 		bt	.finish_this
(2) 2718/ 6000C76 :                     ; 		bra	.next_face
(2) 2719/ 6000C76 :                     ; 		nop
(2) 2720/ 6000C76 :                     ; .finish_this:
(2) 2721/ 6000C76 :                     ; 		mov	r8,r0
(2) 2722/ 6000C76 :                     ; 		mov	r0,@(marsGbl_CurrZList,gbr)
(2) 2723/ 6000C76 :                     ;
(2) 2724/ 6000C76 :                     ; .exit_model:
(2) 2725/ 6000C76 :                     ; 		lds	@r15+,pr
(2) 2726/ 6000C76 :                     ; 		rts
(2) 2727/ 6000C76 :                     ; 		nop
(2) 2728/ 6000C76 :                     ; 		align 4
(2) 2729/ 6000C76 :                     ; 		ltorg
(2) 2730/ 6000C76 :                     ;
(2) 2731/ 6000C76 :                     ; ; ----------------------------------------
(2) 2732/ 6000C76 :                     ; ; Modify position to current point
(2) 2733/ 6000C76 :                     ; ; ----------------------------------------
(2) 2734/ 6000C76 :                     ;
(2) 2735/ 6000C76 :                     ; 		align 4
(2) 2736/ 6000C76 :                     ; mdlrd_setpoint:
(2) 2737/ 6000C76 :                     ; 		sts	pr,@-r15
(2) 2738/ 6000C76 :                     ; 		mov 	r5,@-r15
(2) 2739/ 6000C76 :                     ; 		mov 	r6,@-r15
(2) 2740/ 6000C76 :                     ; 		mov 	r7,@-r15
(2) 2741/ 6000C76 :                     ; 		mov 	r8,@-r15
(2) 2742/ 6000C76 :                     ; 		mov 	r9,@-r15
(2) 2743/ 6000C76 :                     ; 		mov 	r10,@-r15
(2) 2744/ 6000C76 :                     ; 		mov 	r11,@-r15
(2) 2745/ 6000C76 :                     ;
(2) 2746/ 6000C76 :                     ; 	; Object rotation
(2) 2747/ 6000C76 :                     ; 		mov	r2,r5			; r5 - X
(2) 2748/ 6000C76 :                     ; 		mov	r4,r6			; r6 - Z
(2) 2749/ 6000C76 :                     ;   		mov 	@(mdl_x_rot,r14),r0
(2) 2750/ 6000C76 :                     ;   		shlr2	r0
(2) 2751/ 6000C76 :                     ;   		shlr	r0
(2) 2752/ 6000C76 :                     ;   		bsr	mdlrd_rotate
(2) 2753/ 6000C76 :                     ; 		shlr8	r0
(2) 2754/ 6000C76 :                     ;    		mov	r7,r2
(2) 2755/ 6000C76 :                     ;    		mov	r3,r5
(2) 2756/ 6000C76 :                     ;   		mov	r8,r6
(2) 2757/ 6000C76 :                     ;   		mov 	@(mdl_y_rot,r14),r0
(2) 2758/ 6000C76 :                     ;   		shlr2	r0
(2) 2759/ 6000C76 :                     ;   		shlr	r0
(2) 2760/ 6000C76 :                     ;   		bsr	mdlrd_rotate
(2) 2761/ 6000C76 :                     ; 		shlr8	r0
(2) 2762/ 6000C76 :                     ;    		mov	r8,r4
(2) 2763/ 6000C76 :                     ;    		mov	r2,r5
(2) 2764/ 6000C76 :                     ;    		mov	r7,r6
(2) 2765/ 6000C76 :                     ;    		mov 	@(mdl_z_rot,r14),r0
(2) 2766/ 6000C76 :                     ;   		shlr2	r0
(2) 2767/ 6000C76 :                     ;   		shlr	r0
(2) 2768/ 6000C76 :                     ;   		bsr	mdlrd_rotate
(2) 2769/ 6000C76 :                     ; 		shlr8	r0
(2) 2770/ 6000C76 :                     ;    		mov	r7,r2
(2) 2771/ 6000C76 :                     ;    		mov	r8,r3
(2) 2772/ 6000C76 :                     ; 		mov	@(mdl_x_pos,r14),r5
(2) 2773/ 6000C76 :                     ; 		mov	@(mdl_y_pos,r14),r6
(2) 2774/ 6000C76 :                     ; 		mov	@(mdl_z_pos,r14),r7
(2) 2775/ 6000C76 :                     ; 		shlr8	r5
(2) 2776/ 6000C76 :                     ; 		shlr8	r6
(2) 2777/ 6000C76 :                     ; 		shlr8	r7
(2) 2778/ 6000C76 :                     ; 		exts	r5,r5
(2) 2779/ 6000C76 :                     ; 		exts	r6,r6
(2) 2780/ 6000C76 :                     ; 		exts	r7,r7
(2) 2781/ 6000C76 :                     ; 		add 	r5,r2
(2) 2782/ 6000C76 :                     ; 		add 	r6,r3
(2) 2783/ 6000C76 :                     ; 		add 	r7,r4
(2) 2784/ 6000C76 :                     ;
(2) 2785/ 6000C76 :                     ; 	; Include camera changes
(2) 2786/ 6000C76 :                     ; 		mov 	#RAM_Mars_ObjCamera,r11
(2) 2787/ 6000C76 :                     ; 		mov	@(cam_x_pos,r11),r5
(2) 2788/ 6000C76 :                     ; 		mov	@(cam_y_pos,r11),r6
(2) 2789/ 6000C76 :                     ; 		mov	@(cam_z_pos,r11),r7
(2) 2790/ 6000C76 :                     ; 		mov	@(mdl_data,r14),r0		; Layout object?
(2) 2791/ 6000C76 :                     ; 		shll	r0
(2) 2792/ 6000C76 :                     ; 		cmp/pl	r0
(2) 2793/ 6000C76 :                     ; 		bt	.lay_move
(2) 2794/ 6000C76 :                     ; 		mov	#$FFFFF,r0			; Limit camera movement
(2) 2795/ 6000C76 :                     ; 		and	r0,r5
(2) 2796/ 6000C76 :                     ; ; 		and	r0,r6
(2) 2797/ 6000C76 :                     ; 		and	r0,r7
(2) 2798/ 6000C76 :                     ; .lay_move:
(2) 2799/ 6000C76 :                     ; 		shlr8	r5
(2) 2800/ 6000C76 :                     ; 		shlr8	r6
(2) 2801/ 6000C76 :                     ; 		shlr8	r7
(2) 2802/ 6000C76 :                     ; 		exts	r5,r5
(2) 2803/ 6000C76 :                     ; 		exts	r6,r6
(2) 2804/ 6000C76 :                     ; 		exts	r7,r7
(2) 2805/ 6000C76 :                     ; 		sub 	r5,r2
(2) 2806/ 6000C76 :                     ; 		sub 	r6,r3
(2) 2807/ 6000C76 :                     ; 		add 	r7,r4
(2) 2808/ 6000C76 :                     ;
(2) 2809/ 6000C76 :                     ; 		mov	r2,r5
(2) 2810/ 6000C76 :                     ; 		mov	r4,r6
(2) 2811/ 6000C76 :                     ;   		mov 	@(cam_x_rot,r11),r0
(2) 2812/ 6000C76 :                     ;   		shlr2	r0
(2) 2813/ 6000C76 :                     ;   		shlr	r0
(2) 2814/ 6000C76 :                     ;   		bsr	mdlrd_rotate
(2) 2815/ 6000C76 :                     ; 		shlr8	r0
(2) 2816/ 6000C76 :                     ;    		mov	r7,r2
(2) 2817/ 6000C76 :                     ;    		mov	r8,r4
(2) 2818/ 6000C76 :                     ;    		mov	r3,r5
(2) 2819/ 6000C76 :                     ;   		mov	r8,r6
(2) 2820/ 6000C76 :                     ;   		mov 	@(cam_y_rot,r11),r0
(2) 2821/ 6000C76 :                     ;   		shlr2	r0
(2) 2822/ 6000C76 :                     ;   		shlr	r0
(2) 2823/ 6000C76 :                     ;   		bsr	mdlrd_rotate
(2) 2824/ 6000C76 :                     ; 		shlr8	r0
(2) 2825/ 6000C76 :                     ;    		mov	r8,r4
(2) 2826/ 6000C76 :                     ;    		mov	r2,r5
(2) 2827/ 6000C76 :                     ;    		mov	r7,r6
(2) 2828/ 6000C76 :                     ;    		mov 	@(cam_z_rot,r11),r0
(2) 2829/ 6000C76 :                     ;   		shlr2	r0
(2) 2830/ 6000C76 :                     ;   		shlr	r0
(2) 2831/ 6000C76 :                     ;   		bsr	mdlrd_rotate
(2) 2832/ 6000C76 :                     ; 		shlr8	r0
(2) 2833/ 6000C76 :                     ;    		mov	r7,r2
(2) 2834/ 6000C76 :                     ;    		mov	r8,r3
(2) 2835/ 6000C76 :                     ;
(2) 2836/ 6000C76 :                     ; ; 		mov	#-(SCREEN_WIDTH/2)<<4,r6
(2) 2837/ 6000C76 :                     ; ; 		cmp/ge	r6,r2
(2) 2838/ 6000C76 :                     ; ; 		bf	.x_forz
(2) 2839/ 6000C76 :                     ; ; 		neg	r6,r6
(2) 2840/ 6000C76 :                     ; ; 		cmp/ge	r6,r2
(2) 2841/ 6000C76 :                     ; ; 		bf	.x_rsd
(2) 2842/ 6000C76 :                     ; ; .x_forz:
(2) 2843/ 6000C76 :                     ; ; 		mov	r6,r2
(2) 2844/ 6000C76 :                     ; ; .x_rsd:
(2) 2845/ 6000C76 :                     ;
(2) 2846/ 6000C76 :                     ; ; 		mov	#-(SCREEN_HEIGHT/2),r6
(2) 2847/ 6000C76 :                     ; ; 		cmp/ge	r6,r3
(2) 2848/ 6000C76 :                     ; ; 		bf	.y_forz
(2) 2849/ 6000C76 :                     ; ; 		neg	r6,r6
(2) 2850/ 6000C76 :                     ; ; 		cmp/ge	r6,r3
(2) 2851/ 6000C76 :                     ; ; 		bf	.y_rsd
(2) 2852/ 6000C76 :                     ; ; .y_forz:
(2) 2853/ 6000C76 :                     ; ; 		mov	r6,r3
(2) 2854/ 6000C76 :                     ; ; .y_rsd:
(2) 2855/ 6000C76 :                     ;
(2) 2856/ 6000C76 :                     ; 	; Weak perspective projection
(2) 2857/ 6000C76 :                     ; 	; this is the best I got,
(2) 2858/ 6000C76 :                     ; 	; It breaks on large faces
(2) 2859/ 6000C76 :                     ; 		mov 	#_JR,r8
(2) 2860/ 6000C76 :                     ; 		mov	#320<<16,r7
(2) 2861/ 6000C76 :                     ; 		neg	r4,r0		; reverse Z
(2) 2862/ 6000C76 :                     ; ; 		add	#-16,r0
(2) 2863/ 6000C76 :                     ; 		cmp/pl	r0
(2) 2864/ 6000C76 :                     ; 		bt	.inside
(2) 2865/ 6000C76 :                     ; 		shlr	r7
(2) 2866/ 6000C76 :                     ;
(2) 2867/ 6000C76 :                     ; 		dmuls	r7,r2
(2) 2868/ 6000C76 :                     ; 		sts	mach,r0
(2) 2869/ 6000C76 :                     ; 		sts	macl,r2
(2) 2870/ 6000C76 :                     ; 		xtrct	r0,r2
(2) 2871/ 6000C76 :                     ; 		dmuls	r7,r3
(2) 2872/ 6000C76 :                     ; 		sts	mach,r0
(2) 2873/ 6000C76 :                     ; 		sts	macl,r3
(2) 2874/ 6000C76 :                     ; 		xtrct	r0,r3
(2) 2875/ 6000C76 :                     ; 		bra	.zmulti
(2) 2876/ 6000C76 :                     ; 		nop
(2) 2877/ 6000C76 :                     ; .inside:
(2) 2878/ 6000C76 :                     ; 		mov 	r0,@r8
(2) 2879/ 6000C76 :                     ; 		mov 	r7,@(4,r8)
(2) 2880/ 6000C76 :                     ; 		nop
(2) 2881/ 6000C76 :                     ; 		mov 	@(4,r8),r7
(2) 2882/ 6000C76 :                     ; 		dmuls	r7,r2
(2) 2883/ 6000C76 :                     ; 		sts	mach,r0
(2) 2884/ 6000C76 :                     ; 		sts	macl,r2
(2) 2885/ 6000C76 :                     ; 		xtrct	r0,r2
(2) 2886/ 6000C76 :                     ; 		dmuls	r7,r3
(2) 2887/ 6000C76 :                     ; 		sts	mach,r0
(2) 2888/ 6000C76 :                     ; 		sts	macl,r3
(2) 2889/ 6000C76 :                     ; 		xtrct	r0,r3
(2) 2890/ 6000C76 :                     ; .zmulti:
(2) 2891/ 6000C76 :                     ;
(2) 2892/ 6000C76 :                     ; 		mov	@r15+,r11
(2) 2893/ 6000C76 :                     ; 		mov	@r15+,r10
(2) 2894/ 6000C76 :                     ; 		mov	@r15+,r9
(2) 2895/ 6000C76 :                     ; 		mov	@r15+,r8
(2) 2896/ 6000C76 :                     ; 		mov	@r15+,r7
(2) 2897/ 6000C76 :                     ; 		mov	@r15+,r6
(2) 2898/ 6000C76 :                     ; 		mov	@r15+,r5
(2) 2899/ 6000C76 :                     ;
(2) 2900/ 6000C76 :                     ; 	; Set the most far points
(2) 2901/ 6000C76 :                     ; 	; for each direction (X,Y,Z)
(2) 2902/ 6000C76 :                     ; 		cmp/gt	r13,r4
(2) 2903/ 6000C76 :                     ; 		bf	.save_z2
(2) 2904/ 6000C76 :                     ; 		mov	r4,r13
(2) 2905/ 6000C76 :                     ; .save_z2:
(2) 2906/ 6000C76 :                     ; 		cmp/gt	r5,r4
(2) 2907/ 6000C76 :                     ; 		bt	.save_z
(2) 2908/ 6000C76 :                     ; 		mov	r4,r5
(2) 2909/ 6000C76 :                     ; .save_z:
(2) 2910/ 6000C76 :                     ; 		cmp/gt	r8,r2
(2) 2911/ 6000C76 :                     ; 		bf	.x_lw
(2) 2912/ 6000C76 :                     ; 		mov	r2,r8
(2) 2913/ 6000C76 :                     ; .x_lw:
(2) 2914/ 6000C76 :                     ; 		cmp/gt	r9,r2
(2) 2915/ 6000C76 :                     ; 		bt	.x_rw
(2) 2916/ 6000C76 :                     ; 		mov	r2,r9
(2) 2917/ 6000C76 :                     ; .x_rw:
(2) 2918/ 6000C76 :                     ; 		cmp/gt	r11,r3
(2) 2919/ 6000C76 :                     ; 		bf	.y_lw
(2) 2920/ 6000C76 :                     ; 		mov	r3,r11
(2) 2921/ 6000C76 :                     ; .y_lw:
(2) 2922/ 6000C76 :                     ; 		cmp/gt	r12,r3
(2) 2923/ 6000C76 :                     ; 		bt	.y_rw
(2) 2924/ 6000C76 :                     ; 		mov	r3,r12
(2) 2925/ 6000C76 :                     ; .y_rw:
(2) 2926/ 6000C76 :                     ;
(2) 2927/ 6000C76 :                     ; 		lds	@r15+,pr
(2) 2928/ 6000C76 :                     ; 		rts
(2) 2929/ 6000C76 :                     ; 		nop
(2) 2930/ 6000C76 :                     ; 		align 4
(2) 2931/ 6000C76 :                     ; 		ltorg
(2) 2932/ 6000C76 :                     ;
(2) 2933/ 6000C76 :                     ; ; ------------------------------
(2) 2934/ 6000C76 :                     ; ; Rotate point
(2) 2935/ 6000C76 :                     ; ;
(2) 2936/ 6000C76 :                     ; ; Entry:
(2) 2937/ 6000C76 :                     ; ; r5: x
(2) 2938/ 6000C76 :                     ; ; r6: y
(2) 2939/ 6000C76 :                     ; ; r0: theta
(2) 2940/ 6000C76 :                     ; ;
(2) 2941/ 6000C76 :                     ; ; Returns:
(2) 2942/ 6000C76 :                     ; ; r7: (x  cos @) + (y sin @)
(2) 2943/ 6000C76 :                     ; ; r8: (x -sin @) + (y cos @)
(2) 2944/ 6000C76 :                     ; ; ------------------------------
(2) 2945/ 6000C76 :                     ;
(2) 2946/ 6000C76 :                     ; mdlrd_rotate:
(2) 2947/ 6000C76 :                     ;     		mov	#$7FF,r7
(2) 2948/ 6000C76 :                     ;     		and	r7,r0
(2) 2949/ 6000C76 :                     ;    		shll2	r0
(2) 2950/ 6000C76 :                     ; 		mov	#sin_table,r7
(2) 2951/ 6000C76 :                     ; 		mov	#sin_table+$800,r8
(2) 2952/ 6000C76 :                     ; 		mov	@(r0,r7),r9
(2) 2953/ 6000C76 :                     ; 		mov	@(r0,r8),r10
(2) 2954/ 6000C76 :                     ;
(2) 2955/ 6000C76 :                     ; 		dmuls	r5,r10		; x cos @
(2) 2956/ 6000C76 :                     ; 		sts	macl,r7
(2) 2957/ 6000C76 :                     ; 		sts	mach,r0
(2) 2958/ 6000C76 :                     ; 		xtrct	r0,r7
(2) 2959/ 6000C76 :                     ; 		dmuls	r6,r9		; y sin @
(2) 2960/ 6000C76 :                     ; 		sts	macl,r8
(2) 2961/ 6000C76 :                     ; 		sts	mach,r0
(2) 2962/ 6000C76 :                     ; 		xtrct	r0,r8
(2) 2963/ 6000C76 :                     ; 		add	r8,r7
(2) 2964/ 6000C76 :                     ;
(2) 2965/ 6000C76 :                     ; 		neg	r9,r9
(2) 2966/ 6000C76 :                     ; 		dmuls	r5,r9		; x -sin @
(2) 2967/ 6000C76 :                     ; 		sts	macl,r8
(2) 2968/ 6000C76 :                     ; 		sts	mach,r0
(2) 2969/ 6000C76 :                     ; 		xtrct	r0,r8
(2) 2970/ 6000C76 :                     ; 		dmuls	r6,r10		; y cos @
(2) 2971/ 6000C76 :                     ; 		sts	macl,r9
(2) 2972/ 6000C76 :                     ; 		sts	mach,r0
(2) 2973/ 6000C76 :                     ; 		xtrct	r0,r9
(2) 2974/ 6000C76 :                     ; 		add	r9,r8
(2) 2975/ 6000C76 :                     ;  		rts
(2) 2976/ 6000C76 :                     ; 		nop
(2) 2977/ 6000C76 :                     ; 		align 4
(2) 2978/ 6000C76 :                     
(1)  789/ 6000C76 :                     		include "system/mars/sound.asm"
(2)    1/ 6000C76 :                     ; ====================================================================
(2)    2/ 6000C76 :                     ; ----------------------------------------------------------------
(2)    3/ 6000C76 :                     ; MARS Sound
(2)    4/ 6000C76 :                     ; ----------------------------------------------------------------
(2)    5/ 6000C76 :                     
(2)    6/ 6000C76 : =$7                 MAX_PWMCHNL	equ	7
(2)    7/ 6000C76 :                     
(2)    8/ 6000C76 :                     ; 32X sound channel
(2)    9/ 6000C76 : (MACRO)             		struct 0
(2)    9/ 6000C76 : =$6000C76           GLBL_LASTPC     set *
(2)    9/   3B6D6 :                                     dephase
(2)    9/   3B6D6 : =$3B6D6             GLBL_LASTORG    set *
(2)    9/       0 :                                     phase 0
(2)   10/       0 :                     mchnsnd_enbl	ds.l 1
(2)   11/       4 :                     mchnsnd_read	ds.l 1		; 0 - off
(2)   12/       8 :                     mchnsnd_cchread	ds.l 1
(2)   13/       C :                     mchnsnd_bank	ds.l 1		; CS0-3 OR value
(2)   14/      10 :                     mchnsnd_start	ds.l 1
(2)   15/      14 :                     mchnsnd_end	ds.l 1
(2)   16/      18 :                     mchnsnd_loop	ds.l 1
(2)   17/      1C :                     mchnsnd_pitch	ds.l 1
(2)   18/      20 :                     mchnsnd_flags	ds.l 1		; %SLR S-wave format mono/stereo | LR-wave output bits
(2)   19/      24 :                     mchnsnd_vol	ds.l 1
(2)   20/      28 :                     sizeof_sndchn	ds.l 0
(2)   21/      2A : (MACRO)             		finish
(2)   21/       0 :                                     !org GLBL_LASTORG
(2)   21/ 6000C76 :                                     phase GLBL_LASTPC
(2)   22/ 6000C76 :                     
(2)   23/ 6000C76 :                     ; *** PWM INTERRUPT MOVED TO SLAVE'S CACHE (see cache.asm)
(2)   24/ 6000C76 :                     ; Perfoms better in there.
(2)   25/ 6000C76 :                     
(2)   26/ 6000C76 :                     ; ====================================================================
(2)   27/ 6000C76 :                     ; ----------------------------------------------------------------
(2)   28/ 6000C76 :                     ; Subroutines
(2)   29/ 6000C76 :                     ; ----------------------------------------------------------------
(2)   30/ 6000C76 :                     
(2)   31/ 6000C76 :                     ; --------------------------------------------------------
(2)   32/ 6000C76 :                     ; Init Sound PWM
(2)   33/ 6000C76 :                     ;
(2)   34/ 6000C76 :                     ; Frequency values:
(2)   35/ 6000C76 :                     ; 23011361 NTSC
(2)   36/ 6000C76 :                     ; 22801467 PAL
(2)   37/ 6000C76 :                     ;
(2)   38/ 6000C76 :                     ; NOTE: cycle causes a CLICK to sound
(2)   39/ 6000C76 :                     ; --------------------------------------------------------
(2)   40/ 6000C76 :                     
(2)   41/ 6000C76 :                     MarsSound_Init:
(2)   42/ 6000C76 : 4F22                		sts	pr,@-r15
(2)   43/ 6000C78 : 4F13                		stc	gbr,@-r15
(2)   44/ 6000C7A : D03E                		mov	#_sysreg,r0
(2)   45/ 6000C7C : 401E                		ldc	r0,gbr
(2)   46/ 6000C7E : 908D                		mov	#$0105,r0
(2)   47/ 6000C80 : C118                		mov.w	r0,@(timerctl,gbr)
(2)   48/ 6000C82 : 908C                		mov	#((((23011361<<1)/22050+1)>>1)+1),r0	; 22050 best
(2)   49/ 6000C84 : C119                		mov.w	r0,@(cycle,gbr)
(2)   50/ 6000C86 : E001                		mov	#1,r0
(2)   51/ 6000C88 : C11C                		mov.w	r0,@(monowidth,gbr)
(2)   52/ 6000C8A : C11C                		mov.w	r0,@(monowidth,gbr)
(2)   53/ 6000C8C : C11C                		mov.w	r0,@(monowidth,gbr)
(2)   54/ 6000C8E : E000                		mov	#0,r0
(2)   55/ 6000C90 : D139                		mov	#MarsSnd_PwmChnls,r1
(2)   56/ 6000C92 : E207                		mov	#MAX_PWMCHNL,r2
(2)   57/ 6000C94 : E328                		mov	#sizeof_sndchn,r3
(2)   58/ 6000C96 :                     .clr_enbl:
(2)   59/ 6000C96 : 1100                		mov	r0,@(mchnsnd_enbl,r1)
(2)   60/ 6000C98 : 4210                		dt	r2
(2)   61/ 6000C9A : 8FFC                		bf/s	.clr_enbl
(2)   62/ 6000C9C : 313C                		add	r3,r1
(2)   63/ 6000C9E : 4F17                		ldc	@r15+,gbr
(2)   64/ 6000CA0 : 4F26                		lds	@r15+,pr
(2)   65/ 6000CA2 : 000B                		rts
(2)   66/ 6000CA4 : 0009                		nop
(2)   67/ 6000CA6 :                     		align 4
(2)   68/ 6000CA8 :                     
(2)   69/ 6000CA8 :                     ; --------------------------------------------------------
(2)   70/ 6000CA8 :                     ; MarsSound_SetPwm
(2)   71/ 6000CA8 :                     ;
(2)   72/ 6000CA8 :                     ; Set new sound data to a single channel
(2)   73/ 6000CA8 :                     ;
(2)   74/ 6000CA8 :                     ; Input:
(2)   75/ 6000CA8 :                     ; r1 | Channel
(2)   76/ 6000CA8 :                     ; r2 | Start address
(2)   77/ 6000CA8 :                     ; r3 | End address
(2)   78/ 6000CA8 :                     ; r4 | Loop address (ignored if loop flag isn't set)
(2)   79/ 6000CA8 :                     ; r5 | Pitch ($xxxxxx.xx)
(2)   80/ 6000CA8 :                     ; r6 | Volume
(2)   81/ 6000CA8 :                     ; r7 | Flags (Currently: %xxxxslLR)
(2)   82/ 6000CA8 :                     ;      LR - output
(2)   83/ 6000CA8 :                     ;      l - LOOP flag
(2)   84/ 6000CA8 :                     ;      s - Sample is in stereo
(2)   85/ 6000CA8 :                     ;
(2)   86/ 6000CA8 :                     ; Uses:
(2)   87/ 6000CA8 :                     ; r0,r8-r9
(2)   88/ 6000CA8 :                     ; --------------------------------------------------------
(2)   89/ 6000CA8 :                     
(2)   90/ 6000CA8 :                     MarsSound_SetPwm:
(2)   91/ 6000CA8 : D834                		mov	#MarsSnd_PwmChnls,r8
(2)   92/ 6000CAA : E028                		mov 	#sizeof_sndchn,r0
(2)   93/ 6000CAC : 201E                		mulu	r1,r0
(2)   94/ 6000CAE : 001A                		sts	macl,r0
(2)   95/ 6000CB0 : 380C                		add 	r0,r8
(2)   96/ 6000CB2 : E000                		mov 	#0,r0
(2)   97/ 6000CB4 : 1800                		mov 	r0,@(mchnsnd_enbl,r8)
(2)   98/ 6000CB6 :                     ; 		mov 	r0,@(mchnsnd_read,r8)
(2)   99/ 6000CB6 :                     ; 		mov 	r0,@(mchnsnd_bank,r8)
(2)  100/ 6000CB6 : 1857                		mov 	r5,@(mchnsnd_pitch,r8)
(2)  101/ 6000CB8 : 1869                		mov 	r6,@(mchnsnd_vol,r8)
(2)  102/ 6000CBA : 1878                		mov 	r7,@(mchnsnd_flags,r8)
(2)  103/ 6000CBC : 6023                		mov 	r2,r0				; Set MSB
(2)  104/ 6000CBE : D930                		mov 	#$FF000000,r9
(2)  105/ 6000CC0 : 2099                		and 	r9,r0
(2)  106/ 6000CC2 : 1803                		mov 	r0,@(mchnsnd_bank,r8)
(2)  107/ 6000CC4 : 6043                		mov 	r4,r0				; Set POINTS
(2)  108/ 6000CC6 : 88FF                		cmp/eq	#-1,r0
(2)  109/ 6000CC8 : 8900                		bt	.endmrk
(2)  110/ 6000CCA : 4018                		shll8	r0
(2)  111/ 6000CCC :                     .endmrk:
(2)  112/ 6000CCC : 1806                		mov	r0,@(mchnsnd_loop,r8)
(2)  113/ 6000CCE : 6033                		mov 	r3,r0
(2)  114/ 6000CD0 : 4018                		shll8	r0
(2)  115/ 6000CD2 : 1805                		mov	r0,@(mchnsnd_end,r8)
(2)  116/ 6000CD4 : 6023                		mov 	r2,r0
(2)  117/ 6000CD6 : 4018                		shll8	r0
(2)  118/ 6000CD8 : 1804                		mov 	r0,@(mchnsnd_start,r8)
(2)  119/ 6000CDA : 1801                		mov 	r0,@(mchnsnd_read,r8)
(2)  120/ 6000CDC : E001                		mov 	#1,r0
(2)  121/ 6000CDE : 1800                		mov 	r0,@(mchnsnd_enbl,r8)
(2)  122/ 6000CE0 : 000B                		rts
(2)  123/ 6000CE2 : 0009                		nop
(2)  124/ 6000CE4 :                     		align 4
(2)  125/ 6000CE4 :                     
(2)  126/ 6000CE4 :                     ; --------------------------------------------------------
(2)  127/ 6000CE4 :                     ; MarsSound_MulPwmPitch
(2)  128/ 6000CE4 :                     ;
(2)  129/ 6000CE4 :                     ; Set pitch data to 8 consecutive sound channels
(2)  130/ 6000CE4 :                     ; starting from specific slot
(2)  131/ 6000CE4 :                     ;
(2)  132/ 6000CE4 :                     ; Input:
(2)  133/ 6000CE4 :                     ; r1 | Channel pitch slot 0
(2)  134/ 6000CE4 :                     ; r2 | Pitch data
(2)  135/ 6000CE4 :                     ;
(2)  136/ 6000CE4 :                     ; Uses:
(2)  137/ 6000CE4 :                     ; r3,r4
(2)  138/ 6000CE4 :                     ; --------------------------------------------------------
(2)  139/ 6000CE4 :                     
(2)  140/ 6000CE4 :                     MarsSound_SetPwmPitch:
(2)  141/ 6000CE4 : D827                		mov	#MarsSnd_PwmChnls,r8
(2)  142/ 6000CE6 : E028                		mov 	#sizeof_sndchn,r0
(2)  143/ 6000CE8 : 201E                		mulu	r1,r0
(2)  144/ 6000CEA : 001A                		sts	macl,r0
(2)  145/ 6000CEC : 380C                		add 	r0,r8
(2)  146/ 6000CEE : 5080                		mov	@(mchnsnd_enbl,r8),r0
(2)  147/ 6000CF0 : 8801                		cmp/eq	#1,r0
(2)  148/ 6000CF2 : 8B01                		bf	.off_1
(2)  149/ 6000CF4 : 5081                		mov	@(mchnsnd_read,r8),r0
(2)  150/ 6000CF6 : 1827                		mov	r2,@(mchnsnd_pitch,r8)
(2)  151/ 6000CF8 :                     .off_1:
(2)  152/ 6000CF8 : 000B                		rts
(2)  153/ 6000CFA : 0009                		nop
(2)  154/ 6000CFC :                     		align 4
(2)  155/ 6000CFC :                     
(2)  156/ 6000CFC :                     ; --------------------------------------------------------
(2)  157/ 6000CFC :                     ; MarsSound_SetVolume
(2)  158/ 6000CFC :                     ;
(2)  159/ 6000CFC :                     ; Input:
(2)  160/ 6000CFC :                     ; r1 | Channel pitch slot 0
(2)  161/ 6000CFC :                     ; r2 | Pitch data
(2)  162/ 6000CFC :                     ;
(2)  163/ 6000CFC :                     ; Uses:
(2)  164/ 6000CFC :                     ; r3,r4
(2)  165/ 6000CFC :                     ; --------------------------------------------------------
(2)  166/ 6000CFC :                     
(2)  167/ 6000CFC :                     MarsSound_SetVolume:
(2)  168/ 6000CFC : D822                		mov	#MarsSnd_PwmChnls,r8
(2)  169/ 6000CFE : E028                		mov 	#sizeof_sndchn,r0
(2)  170/ 6000D00 : 201E                		mulu	r1,r0
(2)  171/ 6000D02 : 001A                		sts	macl,r0
(2)  172/ 6000D04 : 380C                		add 	r0,r8
(2)  173/ 6000D06 : 5080                		mov	@(mchnsnd_enbl,r8),r0
(2)  174/ 6000D08 : 8801                		cmp/eq	#1,r0
(2)  175/ 6000D0A : 8B01                		bf	.off_1
(2)  176/ 6000D0C : 6023                		mov	r2,r0
(2)  177/ 6000D0E : 1809                		mov	r0,@(mchnsnd_vol,r8)
(2)  178/ 6000D10 :                     .off_1:
(2)  179/ 6000D10 : 000B                		rts
(2)  180/ 6000D12 : 0009                		nop
(2)  181/ 6000D14 :                     		align 4
(2)  182/ 6000D14 :                     
(2)  183/ 6000D14 :                     ; --------------------------------------------------------
(2)  184/ 6000D14 :                     ; MarsSound_PwmEnable
(2)  185/ 6000D14 :                     ;
(2)  186/ 6000D14 :                     ; Turns ON or OFF Current PWM slot
(2)  187/ 6000D14 :                     ;
(2)  188/ 6000D14 :                     ; Input:
(2)  189/ 6000D14 :                     ; r1 | Slot
(2)  190/ 6000D14 :                     ; r2 | Enable/Disable
(2)  191/ 6000D14 :                     ;
(2)  192/ 6000D14 :                     ; Uses:
(2)  193/ 6000D14 :                     ; r8
(2)  194/ 6000D14 :                     ; --------------------------------------------------------
(2)  195/ 6000D14 :                     
(2)  196/ 6000D14 :                     MarsSound_PwmEnable:
(2)  197/ 6000D14 : D81D                		mov	#MarsSnd_PwmChnls,r8
(2)  198/ 6000D16 : E028                		mov 	#sizeof_sndchn,r0
(2)  199/ 6000D18 : 201E                		mulu	r1,r0
(2)  200/ 6000D1A : 001A                		sts	macl,r0
(2)  201/ 6000D1C : 380C                		add 	r0,r8
(2)  202/ 6000D1E : 1820                		mov 	r2,@(mchnsnd_enbl,r8)
(2)  203/ 6000D20 :                     ; 		mov 	#0,r0
(2)  204/ 6000D20 :                     ; 		mov 	r0,@(mchnsnd_read,r8)
(2)  205/ 6000D20 :                     ; 		mov 	r0,@(mchnsnd_bank,r8)
(2)  206/ 6000D20 : 000B                		rts
(2)  207/ 6000D22 : 0009                		nop
(2)  208/ 6000D24 :                     		align 4
(2)  209/ 6000D24 :                     
(2)  210/ 6000D24 :                     ; --------------------------------------------------------
(2)  211/ 6000D24 :                     ; MarsSound_Refill
(2)  212/ 6000D24 :                     ;
(2)  213/ 6000D24 :                     ; Call this if MD wants to do DMA, which sets RV=1
(2)  214/ 6000D24 :                     ; starting from specific slot
(2)  215/ 6000D24 :                     ;
(2)  216/ 6000D24 :                     ; Uses:
(2)  217/ 6000D24 :                     ; r1-r8
(2)  218/ 6000D24 :                     ; --------------------------------------------------------
(2)  219/ 6000D24 :                     
(2)  220/ 6000D24 :                     ; PWM interrupt is still enabled while doing this.
(2)  221/ 6000D24 :                     
(2)  222/ 6000D24 :                     MarsSnd_Refill:
(2)  223/ 6000D24 : D81A                		mov	#MarsSnd_PwmChnls,r8
(2)  224/ 6000D26 : E607                		mov	#MAX_PWMCHNL,r6
(2)  225/ 6000D28 : E728                		mov	#sizeof_sndchn,r7
(2)  226/ 6000D2A : D51A                		mov	#MarsSnd_PwmCache,r5
(2)  227/ 6000D2C :                     .next_one:
(2)  228/ 6000D2C : 5080                		mov	@(mchnsnd_enbl,r8),r0	; Finished already?
(2)  229/ 6000D2E : 8801                		cmp/eq	#1,r0
(2)  230/ 6000D30 : 8B19                		bf	.not_enbl
(2)  231/ 6000D32 : 5083                		mov	@(mchnsnd_bank,r8),r0
(2)  232/ 6000D34 : D218                		mov	#CS1,r2
(2)  233/ 6000D36 : 3020                		cmp/eq	r2,r0
(2)  234/ 6000D38 : 8B15                		bf	.not_activ
(2)  235/ 6000D3A :                     
(2)  236/ 6000D3A : E100                		mov	#0,r1
(2)  237/ 6000D3C : 1812                		mov	r1,@(mchnsnd_cchread,r8)
(2)  238/ 6000D3E : 6153                		mov	r5,r1
(2)  239/ 6000D40 : E220                		mov	#$80/4,r2
(2)  240/ 6000D42 : 5481                		mov	@(mchnsnd_read,r8),r4	; r4 - OLD READ pos
(2)  241/ 6000D44 : 6343                		mov	r4,r3
(2)  242/ 6000D46 : 4319                		shlr8	r3
(2)  243/ 6000D48 : 330C                		add	r0,r3
(2)  244/ 6000D4A :                     .copy_now:
(2)  245/ 6000D4A : 6034                		mov.b	@r3+,r0
(2)  246/ 6000D4C : 2100                		mov.b	r0,@r1
(2)  247/ 6000D4E : 7101                		add	#1,r1
(2)  248/ 6000D50 : 6034                		mov.b	@r3+,r0
(2)  249/ 6000D52 : 2100                		mov.b	r0,@r1
(2)  250/ 6000D54 : 7101                		add	#1,r1
(2)  251/ 6000D56 : 6034                		mov.b	@r3+,r0
(2)  252/ 6000D58 : 2100                		mov.b	r0,@r1
(2)  253/ 6000D5A : 7101                		add	#1,r1
(2)  254/ 6000D5C : 6034                		mov.b	@r3+,r0
(2)  255/ 6000D5E : 2100                		mov.b	r0,@r1
(2)  256/ 6000D60 : 4210                		dt	r2
(2)  257/ 6000D62 : 8FF2                		bf/s	.copy_now
(2)  258/ 6000D64 : 7101                		add	#1,r1
(2)  259/ 6000D66 :                     
(2)  260/ 6000D66 :                     ; 		mov	#0,r1
(2)  261/ 6000D66 :                     ; 		mov	@(mchnsnd_enbl,r8),r0	; Finished already?
(2)  262/ 6000D66 :                     ; 		cmp/eq	#1,r0
(2)  263/ 6000D66 :                     ; 		bf	.got_low
(2)  264/ 6000D66 :                     ; 		mov	@(mchnsnd_read,r8),r1
(2)  265/ 6000D66 :                     ; 		sub	r4,r1
(2)  266/ 6000D66 :                     ; .got_low:
(2)  267/ 6000D66 :                     ; 		mov	r1,@(mchnsnd_cchread,r8)
(2)  268/ 6000D66 :                     .not_enbl:
(2)  269/ 6000D66 :                     
(2)  270/ 6000D66 :                     ; 		mov	#_DMASOURCE0,r1
(2)  271/ 6000D66 :                     ; 		mov	#_DMAOPERATION,r2
(2)  272/ 6000D66 :                     ; 		mov	r0,@r1			; set source address
(2)  273/ 6000D66 :                     ; 		add	#4,r1
(2)  274/ 6000D66 :                     ; 		mov	r5,@r1			; set destination address
(2)  275/ 6000D66 :                     ; 		add	#4,r1
(2)  276/ 6000D66 :                     ; 		mov	#$100,r0
(2)  277/ 6000D66 :                     ; 		mov	r0,@r1			; set length
(2)  278/ 6000D66 :                     ; 		add	#4,r1
(2)  279/ 6000D66 :                     ; 		mov	#0,r0
(2)  280/ 6000D66 :                     ; 		mov	r0,@r2			; Stop OPERATION
(2)  281/ 6000D66 :                     ; 		xor	r0,r0
(2)  282/ 6000D66 :                     ; 		mov	r0,@r1			; clear TE bit
(2)  283/ 6000D66 :                     ; 		mov	#%0101001011100001,r0	; transfer mode bits, ON
(2)  284/ 6000D66 :                     ; 		mov	r0,@r1			; load mode
(2)  285/ 6000D66 :                     ; 		stc	sr,@-r15
(2)  286/ 6000D66 :                     ; 		mov	#$F0,r0
(2)  287/ 6000D66 :                     ; 		ldc	r0,sr
(2)  288/ 6000D66 :                     ; 		mov	#1,r0
(2)  289/ 6000D66 :                     ; 		mov	r0,@r2			; Start OPERATION
(2)  290/ 6000D66 :                     ; .wait_dma:
(2)  291/ 6000D66 :                     ; 		mov	@r1,r0
(2)  292/ 6000D66 :                     ; 		and	#%10,r0
(2)  293/ 6000D66 :                     ; 		tst	r0,r0
(2)  294/ 6000D66 :                     ; 		bt	.wait_dma
(2)  295/ 6000D66 :                     ; 		ldc	@r15+,sr
(2)  296/ 6000D66 :                     ; 		mov	@r1,r0
(2)  297/ 6000D66 :                     ; 		mov	#-1,r2
(2)  298/ 6000D66 :                     ; 		and	r2,r0
(2)  299/ 6000D66 :                     ; 		mov	r0,@r1
(2)  300/ 6000D66 :                     .not_activ:
(2)  301/ 6000D66 : 901B                		mov	#$80,r0
(2)  302/ 6000D68 : 350C                		add	r0,r5
(2)  303/ 6000D6A : 4610                		dt	r6
(2)  304/ 6000D6C : 8FDE                		bf/s	.next_one
(2)  305/ 6000D6E : 387C                		add	r7,r8
(2)  306/ 6000D70 : 000B                		rts
(2)  307/ 6000D72 : 0009                		nop
(2)  308/ 6000D74 :                     		align 4
(2)  309/ 6000D74 : 2000 4000 0600 46A8 		ltorg
                    0600 46A8 FF00 0000 
                    0600 46A8 0600 46A8 
                    0600 46A8 0600 46A8 
                    C000 0000 0200 0000 
                    0105 0415 0080      
(2)  310/ 6000DA2 :                     
(2)  311/ 6000DA2 :                     ; 		mov 	#sizeof_sndchn,r0
(2)  312/ 6000DA2 :                     ; 		mulu	r1,r0
(2)  313/ 6000DA2 :                     ; 		sts	macl,r0
(2)  314/ 6000DA2 :                     ; 		add 	r0,r8
(2)  315/ 6000DA2 :                     ; 		mov	@(mchnsnd_enbl,r8),r0
(2)  316/ 6000DA2 :                     ; 		cmp/eq	#1,r0
(2)  317/ 6000DA2 :                     ; 		bf	.off_1
(2)  318/ 6000DA2 :                     ; ; 		mov	@(mchnsnd_read,r8),r0
(2)  319/ 6000DA2 :                     ; 		mov	r2,@(mchnsnd_pitch,r8)
(2)  320/ 6000DA2 :                     ; .off_1:
(2)  321/ 6000DA2 :                     ; ; 		ldc	@r15+,sr
(2)  322/ 6000DA2 :                     ; 		rts
(2)  323/ 6000DA2 :                     ; 		nop
(2)  324/ 6000DA2 :                     ; 		align 4
(2)  325/ 6000DA2 :                     
(2)  326/ 6000DA2 :                     ; ====================================================================
(2)  327/ 6000DA2 :                     
(2)  328/ 6000DA2 :                     		ltorg			; Save literals
(2)  329/ 6000DA2 :                     
(1)  790/ 6000DA2 :                     		align 4
(1)  791/ 6000DA4 :                     
(1)  792/ 6000DA4 :                     ; ====================================================================
(1)  793/ 6000DA4 :                     ; ----------------------------------------------------------------
(1)  794/ 6000DA4 :                     ; Master entry
(1)  795/ 6000DA4 :                     ; ----------------------------------------------------------------
(1)  796/ 6000DA4 :                     
(1)  797/ 6000DA4 :                     		align 4
(1)  798/ 6000DA4 :                     SH2_M_Entry:
(1)  799/ 6000DA4 : DF22                		mov	#CS3|$40000,r15			; Set default Stack for Master
(1)  800/ 6000DA6 : 9155                		mov	#_FRT,r1
(1)  801/ 6000DA8 : E000                		mov     #0,r0
(1)  802/ 6000DAA : 8010                		mov.b   r0,@(0,r1)
(1)  803/ 6000DAC : E0E2                		mov     #$FFFFFFE2,r0
(1)  804/ 6000DAE : 8017                		mov.b   r0,@(7,r1)
(1)  805/ 6000DB0 : E000                		mov     #0,r0
(1)  806/ 6000DB2 : 8014                		mov.b   r0,@(4,r1)
(1)  807/ 6000DB4 : E001                		mov     #1,r0
(1)  808/ 6000DB6 : 8015                		mov.b   r0,@(5,r1)
(1)  809/ 6000DB8 : E000                		mov     #0,r0
(1)  810/ 6000DBA : 8016                		mov.b   r0,@(6,r1)
(1)  811/ 6000DBC : E001                		mov     #1,r0
(1)  812/ 6000DBE : 8011                		mov.b   r0,@(1,r1)
(1)  813/ 6000DC0 : E000                		mov     #0,r0
(1)  814/ 6000DC2 : 8013                		mov.b   r0,@(3,r1)
(1)  815/ 6000DC4 : 8012                		mov.b   r0,@(2,r1)
(1)  816/ 6000DC6 : 9046                		mov.l   #$FFFFFEE2,r0		; Watchdog: Set interrupt priority bits (IPRA)
(1)  817/ 6000DC8 : E150                		mov     #%0101<<4,r1
(1)  818/ 6000DCA : 2011                		mov.w   r1,@r0
(1)  819/ 6000DCC : 9044                		mov.l   #$FFFFFEE4,r0
(1)  820/ 6000DCE : E148                		mov     #$120/4,r1		; Watchdog: Set jump pointer (VBR + this/4) (WITV)
(1)  821/ 6000DD0 : 4118                		shll8   r1
(1)  822/ 6000DD2 : 2011                		mov.w   r1,@r0
(1)  823/ 6000DD4 :                     
(1)  824/ 6000DD4 :                     ; ------------------------------------------------
(1)  825/ 6000DD4 :                     ; Wait for Genesis and Slave CPU
(1)  826/ 6000DD4 :                     ; ------------------------------------------------
(1)  827/ 6000DD4 :                     
(1)  828/ 6000DD4 :                     .wait_md:
(1)  829/ 6000DD4 : D217                		mov 	#_sysreg+comm0,r2	; Wait for Genesis
(1)  830/ 6000DD6 : 6022                		mov.l	@r2,r0
(1)  831/ 6000DD8 : 8800                		cmp/eq	#0,r0
(1)  832/ 6000DDA : 8BFB                		bf	.wait_md
(1)  833/ 6000DDC : D116                		mov.l	#"SLAV",r1
(1)  834/ 6000DDE :                     .wait_slave:
(1)  835/ 6000DDE : 5022                		mov.l	@(8,r2),r0		; Wait for Slave CPU to finish booting
(1)  836/ 6000DE0 : 3010                		cmp/eq	r1,r0
(1)  837/ 6000DE2 : 8BFC                		bf	.wait_slave
(1)  838/ 6000DE4 : E000                		mov	#0,r0			; clear "SLAV"
(1)  839/ 6000DE6 : 1202                		mov	r0,@(8,r2)
(1)  840/ 6000DE8 : 2202                		mov	r0,@r2
(1)  841/ 6000DEA :                     
(1)  842/ 6000DEA :                     ; ====================================================================
(1)  843/ 6000DEA :                     ; ----------------------------------------------------------------
(1)  844/ 6000DEA :                     ; Master main code
(1)  845/ 6000DEA :                     ;
(1)  846/ 6000DEA :                     ; This CPU is exclusively used for visual tasks:
(1)  847/ 6000DEA :                     ; Polygons, Sprites, Backgrounds...
(1)  848/ 6000DEA :                     ;
(1)  849/ 6000DEA :                     ; To interact with the models use the Slave CPU
(1)  850/ 6000DEA :                     ; ----------------------------------------------------------------
(1)  851/ 6000DEA :                     
(1)  852/ 6000DEA :                     SH2_M_HotStart:
(1)  853/ 6000DEA : DF11                		mov	#CS3|$40000,r15			; Stack again if coming from RESET
(1)  854/ 6000DEC : DE13                		mov	#RAM_Mars_Global,r14		; GBR - Global values/variables go here.
(1)  855/ 6000DEE : 4E1E                		ldc	r14,gbr
(1)  856/ 6000DF0 : 9033                		mov	#$F0,r0				; Interrupts OFF
(1)  857/ 6000DF2 : 400E                		ldc	r0,sr
(1)  858/ 6000DF4 : 9132                		mov.l	#_CCR,r1
(1)  859/ 6000DF6 : E008                		mov	#%00001000,r0			; Cache OFF
(1)  860/ 6000DF8 : 2101                		mov.w	r0,@r1
(1)  861/ 6000DFA : E019                		mov	#%00011001,r0			; Cache purge / Two-way mode / Cache ON
(1)  862/ 6000DFC : 2101                		mov.w	r0,@r1
(1)  863/ 6000DFE : D110                		mov	#_sysreg,r1
(1)  864/ 6000E00 : E008                		mov	#VIRQ_ON,r0			; Enable usage of these interrupts
(1)  865/ 6000E02 : 8011                    		mov.b	r0,@(intmask,r1)		; (Watchdog is external)
(1)  866/ 6000E04 : D10F                		mov 	#CACHE_MASTER,r1		; Transfer Master's "fast code" to CACHE
(1)  867/ 6000E06 : D210                		mov 	#$C0000000,r2
(1)  868/ 6000E08 : 9329                		mov 	#(CACHE_MASTER_E-CACHE_MASTER)/4,r3
(1)  869/ 6000E0A :                     .copy:
(1)  870/ 6000E0A : 6016                		mov 	@r1+,r0
(1)  871/ 6000E0C : 2202                		mov 	r0,@r2
(1)  872/ 6000E0E : 7204                		add 	#4,r2
(1)  873/ 6000E10 : 4310                		dt	r3
(1)  874/ 6000E12 : 8BFA                		bf	.copy
(1)  875/ 6000E14 : D00D                		mov	#MarsVideo_Init,r0		; Init Video
(1)  876/ 6000E16 : 400B                		jsr	@r0
(1)  877/ 6000E18 : 0009                		nop
(1)  878/ 6000E1A : E000                		mov	#0,r0
(1)  879/ 6000E1C : C102                		mov.w	r0,@(marsGbl_CurrGfxMode,gbr)
(1)  880/ 6000E1E :                     
(1)  881/ 6000E1E : D10C                		mov	#_sysreg+comm14,r1
(1)  882/ 6000E20 : 6010                .lel:		mov.b	@r1,r0
(1)  883/ 6000E22 : 4011                		cmp/pz	r0
(1)  884/ 6000E24 : 89FC                		bt	.lel
(1)  885/ 6000E26 :                     
(1)  886/ 6000E26 : E020                		mov.l	#$20,r0				; Interrupts ON
(1)  887/ 6000E28 : 400E                		ldc	r0,sr
(1)  888/ 6000E2A : A019                		bra	master_loop
(1)  889/ 6000E2C : 0009                		nop
(1)  890/ 6000E2E :                     		align 4
(1)  891/ 6000E30 : 0604 0000 2000 4020 		ltorg
                    534C 4156 0600 4210 
                    2000 4000 0600 1280 
                    C000 0000 0600 05EE 
                    2000 402E FE10 FEE2 
                    FEE4 00F0 FE92 0032 
(1)  892/ 6000E60 :                     
(1)  893/ 6000E60 :                     ; ---------------------------------------
(1)  894/ 6000E60 :                     
(1)  895/ 6000E60 :                     master_loop:
(1)  896/ 6000E60 :                     ; 		mov	#_sysreg+comm0,r1
(1)  897/ 6000E60 :                     ; 		mov.w	@r1,r0
(1)  898/ 6000E60 :                     ; 		add	#1,r0
(1)  899/ 6000E60 :                     ; 		mov.w	r0,@r1
(1)  900/ 6000E60 :                     
(1)  901/ 6000E60 : C502                		mov.w	@(marsGbl_CurrGfxMode,gbr),r0
(1)  902/ 6000E62 : 6103                		mov	r0,r1
(1)  903/ 6000E64 : 6013                		mov	r1,r0
(1)  904/ 6000E66 : C980                		and	#$80,r0
(1)  905/ 6000E68 : 8800                		cmp/eq	#0,r0
(1)  906/ 6000E6A : 8B14                		bf	mstr_gfx1_loop
(1)  907/ 6000E6C : 6013                		mov	r1,r0
(1)  908/ 6000E6E : CB80                		or	#$80,r0
(1)  909/ 6000E70 : C102                		mov.w	r0,@(marsGbl_CurrGfxMode,gbr)
(1)  910/ 6000E72 :                     
(1)  911/ 6000E72 :                     ; 		mov	#240,r0
(1)  912/ 6000E72 :                     ; 		mov.w	r0,@(marsGbl_FbMaxLines,gbr)
(1)  913/ 6000E72 : D131                		mov	#TESTMARS_BG,r1			; SET image
(1)  914/ 6000E74 : 9274                		mov	#208,r2
(1)  915/ 6000E76 : 9373                		mov	#208,r3
(1)  916/ 6000E78 : BED6                		bsr	MarsVideo_SetBg
(1)  917/ 6000E7A : 0009                		nop
(1)  918/ 6000E7C : D12F                		mov	#TESTMARS_BG_PAL,r1		; Load palette
(1)  919/ 6000E7E : E200                		mov	#0,r2
(1)  920/ 6000E80 : 936F                		mov	#256,r3
(1)  921/ 6000E82 : E400                		mov	#$0000,r4
(1)  922/ 6000E84 : D02E                		mov	#MarsVideo_LoadPal,r0
(1)  923/ 6000E86 : 400B                		jsr	@r0
(1)  924/ 6000E88 : 0009                		nop
(1)  925/ 6000E8A :                     
(1)  926/ 6000E8A : D12E                		mov	#RAM_Mars_Background,r1
(1)  927/ 6000E8C : E002                		mov	#2,r0
(1)  928/ 6000E8E : 8010                		mov.b	r0,@(mbg_draw_all,r1)
(1)  929/ 6000E90 :                     
(1)  930/ 6000E90 : D12D                		mov 	#_vdpreg,r1
(1)  931/ 6000E92 : E001                		mov	#1,r0
(1)  932/ 6000E94 : 8011                		mov.b	r0,@(bitmapmd,r1)
(1)  933/ 6000E96 :                     
(1)  934/ 6000E96 :                     ; ---------------------------------------
(1)  935/ 6000E96 :                     ; Mode0 loop
(1)  936/ 6000E96 :                     ; ---------------------------------------
(1)  937/ 6000E96 :                     
(1)  938/ 6000E96 :                     mstr_gfx1_loop:
(1)  939/ 6000E96 : C40A                		mov.b	@(marsGbl_CurrFb,gbr),r0
(1)  940/ 6000E98 : 6303                		mov	r0,r3
(1)  941/ 6000E9A : D42B                		mov	#_vdpreg,r4			; Wait if frameswap is done
(1)  942/ 6000E9C : 844B                .wait_frmswp:	mov.b	@(framectl,r4),r0
(1)  943/ 6000E9E : 3300                		cmp/eq	r0,r3
(1)  944/ 6000EA0 : 8BFC                		bf	.wait_frmswp
(1)  945/ 6000EA2 : C500                 		mov.w	@(marsGbl_XShift,gbr),r0	; Set SHIFT bit first
(1)  946/ 6000EA4 : D129                		mov	#_vdpreg+shift,r1
(1)  947/ 6000EA6 : C901                		and	#1,r0
(1)  948/ 6000EA8 : 2101                		mov.w	r0,@r1
(1)  949/ 6000EAA :                     
(1)  950/ 6000EAA :                     	; ---------------------------------------
(1)  951/ 6000EAA :                     	; TESTING
(1)  952/ 6000EAA :                     	; ---------------------------------------
(1)  953/ 6000EAA :                     
(1)  954/ 6000EAA : DE29                		mov	#RAM_Mars_Background,r14
(1)  955/ 6000EAC : D129                		mov	#_sysreg+comm14,r1
(1)  956/ 6000EAE : 6010                		mov.b	@r1,r0
(1)  957/ 6000EB0 : C9FF                		and	#$FF,r0
(1)  958/ 6000EB2 : 8800                		cmp/eq	#0,r0
(1)  959/ 6000EB4 : 8922                		bt	.TEST_1
(1)  960/ 6000EB6 : 4F03                		stc	sr,@-r15		; Interrupts OFF
(1)  961/ 6000EB8 : 9054                		mov	#$F0,r0
(1)  962/ 6000EBA : 400E                		ldc	r0,sr
(1)  963/ 6000EBC : D125                		mov	#_sysreg+comm14,r1
(1)  964/ 6000EBE : D226                		mov	#$40000,r2
(1)  965/ 6000EC0 : D325                		mov	#$40000,r3
(1)  966/ 6000EC2 : 6410                		mov.b	@r1,r4
(1)  967/ 6000EC4 : 6043                		mov	r4,r0
(1)  968/ 6000EC6 : C801                		tst	#%0001,r0
(1)  969/ 6000EC8 : 8902                		bt	.right
(1)  970/ 6000ECA : 50EC                		mov	@(mbg_xpos,r14),r0
(1)  971/ 6000ECC : 302C                		add	r2,r0
(1)  972/ 6000ECE : 1E0C                		mov	r0,@(mbg_xpos,r14)
(1)  973/ 6000ED0 :                     .right:
(1)  974/ 6000ED0 : 6043                		mov	r4,r0
(1)  975/ 6000ED2 : C802                		tst	#%0010,r0
(1)  976/ 6000ED4 : 8902                		bt	.left
(1)  977/ 6000ED6 : 50EC                		mov	@(mbg_xpos,r14),r0
(1)  978/ 6000ED8 : 3028                		sub	r2,r0
(1)  979/ 6000EDA : 1E0C                		mov	r0,@(mbg_xpos,r14)
(1)  980/ 6000EDC :                     .left:
(1)  981/ 6000EDC : 6043                		mov	r4,r0
(1)  982/ 6000EDE : C804                		tst	#%0100,r0
(1)  983/ 6000EE0 : 8902                		bt	.down
(1)  984/ 6000EE2 : 50ED                		mov	@(mbg_ypos,r14),r0
(1)  985/ 6000EE4 : 303C                		add	r3,r0
(1)  986/ 6000EE6 : 1E0D                		mov	r0,@(mbg_ypos,r14)
(1)  987/ 6000EE8 :                     .down:
(1)  988/ 6000EE8 : 6043                		mov	r4,r0
(1)  989/ 6000EEA : C808                		tst	#%1000,r0
(1)  990/ 6000EEC : 8902                		bt	.up
(1)  991/ 6000EEE : 50ED                		mov	@(mbg_ypos,r14),r0
(1)  992/ 6000EF0 : 3038                		sub	r3,r0
(1)  993/ 6000EF2 : 1E0D                		mov	r0,@(mbg_ypos,r14)
(1)  994/ 6000EF4 :                     .up:
(1)  995/ 6000EF4 : D117                		mov	#_sysreg+comm14,r1
(1)  996/ 6000EF6 : C9F0                		and	#%11110000,r0
(1)  997/ 6000EF8 : 2100                		mov.b	r0,@r1
(1)  998/ 6000EFA : 4F07                		ldc	@r15+,sr
(1)  999/ 6000EFC :                     .TEST_1:
(1) 1000/ 6000EFC :                     
(1) 1001/ 6000EFC :                     	; ---------------------------------------
(1) 1002/ 6000EFC :                     	; Move and update background values
(1) 1003/ 6000EFC :                     	; ---------------------------------------
(1) 1004/ 6000EFC :                     
(1) 1005/ 6000EFC : DE17                		mov	#RAM_Mars_Background,r14
(1) 1006/ 6000EFE : 84E0                		mov.b	@(mbg_draw_all,r14),r0
(1) 1007/ 6000F00 : 4015                		cmp/pl	r0
(1) 1008/ 6000F02 : 8B05                		bf	.no_redraw
(1) 1009/ 6000F04 : 4010                		dt	r0
(1) 1010/ 6000F06 : 80E0                		mov.b	r0,@(mbg_draw_all,r14)
(1) 1011/ 6000F08 : E100                		mov	#0,r1			; *** TEMPORAL
(1) 1012/ 6000F0A : E200                		mov	#0,r2				; VARIABLES ***
(1) 1013/ 6000F0C : BB7F                		bsr	MarsVideo_DrawAllBg
(1) 1014/ 6000F0E : 0009                		nop
(1) 1015/ 6000F10 :                     .no_redraw:
(1) 1016/ 6000F10 :                     
(1) 1017/ 6000F10 : 50EA                		mov	@(mbg_data,r14),r0
(1) 1018/ 6000F12 : 8800                		cmp/eq	#0,r0
(1) 1019/ 6000F14 : 8901                		bt	.no_scrldata
(1) 1020/ 6000F16 : BC35                		bsr	MarsVideo_MoveBg
(1) 1021/ 6000F18 : 0009                		nop
(1) 1022/ 6000F1A :                     .no_scrldata:
(1) 1023/ 6000F1A : BD1F                		bsr	MarsVideo_MakeTbl
(1) 1024/ 6000F1C : 0009                		nop
(1) 1025/ 6000F1E :                     
(1) 1026/ 6000F1E :                     	; ---------------------------------------
(1) 1027/ 6000F1E :                     
(1) 1028/ 6000F1E :                     ; 		mov	#RAM_Mars_Background,r14
(1) 1029/ 6000F1E : BD41                		bsr	MarsVideo_BgDrawLR
(1) 1030/ 6000F20 : 0009                		nop
(1) 1031/ 6000F22 : BDAD                		bsr	MarsVideo_BgDrawUD
(1) 1032/ 6000F24 : 0009                		nop
(1) 1033/ 6000F26 :                     
(1) 1034/ 6000F26 :                     ; 		mov.l   #$FFFFFE80,r1			; Stop watchdog
(1) 1035/ 6000F26 :                     ; 		mov.w   #$A518,r0
(1) 1036/ 6000F26 :                     ; 		mov.w   r0,@r1
(1) 1037/ 6000F26 :                     ; 		mov	#_vdpreg,r1
(1) 1038/ 6000F26 :                     ; .waitfb:	mov.w	@(vdpsts,r1),r0			; Wait for any line-fill finishes.
(1) 1039/ 6000F26 :                     ; 		tst	#%10,r0
(1) 1040/ 6000F26 :                     ; 		bf	.waitfb
(1) 1041/ 6000F26 : D108                		mov	#_vdpreg,r1
(1) 1042/ 6000F28 : 841B                		mov.b	@(framectl,r1),r0		; Framebuffer swap REQUEST
(1) 1043/ 6000F2A : CA01                		xor	#1,r0				; (swap is done during VBlank)
(1) 1044/ 6000F2C : 801B                		mov.b	r0,@(framectl,r1)		; Save new bit
(1) 1045/ 6000F2E : C00A                		mov.b	r0,@(marsGbl_CurrFb,gbr)	; And a copy for checking
(1) 1046/ 6000F30 : 200A                		xor	r0,r0
(1) 1047/ 6000F32 : C101                		mov.w	r0,@(marsGbl_MstrReqDraw,gbr)
(1) 1048/ 6000F34 : AF94                		bra	master_loop
(1) 1049/ 6000F36 : 0009                		nop
(1) 1050/ 6000F38 :                     		align 4
(1) 1051/ 6000F38 : 0205 FF88 0600 400C 		ltorg
                    0600 0BE4 0600 4630 
                    2000 4100 2000 4102 
                    0600 4630 2000 402E 
                    0004 0000 0600 4630 
                    00D0 0100 00F0      
(1) 1052/ 6000F66 :                     
(1) 1053/ 6000F66 :                     ; ; ---------------------------------------
(1) 1054/ 6000F66 :                     ; ; Custom graphics mode 0
(1) 1055/ 6000F66 :                     ; ;
(1) 1056/ 6000F66 :                     ; ; Single 256-color scrolling layer
(1) 1057/ 6000F66 :                     ; ; using dirty-section method,
(1) 1058/ 6000F66 :                     ; ; ---------------------------------------
(1) 1059/ 6000F66 :                     ;
(1) 1060/ 6000F66 :                     ; mstr_gfx2:
(1) 1061/ 6000F66 :                     ; 		mov	r1,r0
(1) 1062/ 6000F66 :                     ; 		and	#$80,r0
(1) 1063/ 6000F66 :                     ; 		cmp/eq	#0,r0
(1) 1064/ 6000F66 :                     ; 		bf	mstr_gfx2_loop
(1) 1065/ 6000F66 :                     ; 		mov	r1,r0
(1) 1066/ 6000F66 :                     ; 		or	#$80,r0
(1) 1067/ 6000F66 :                     ; 		mov.w	r0,@(marsGbl_CurrGfxMode,gbr)
(1) 1068/ 6000F66 :                     ; 		mov	#TESTMARS_BG,r1			; SET image
(1) 1069/ 6000F66 :                     ; 		mov	#320,r2
(1) 1070/ 6000F66 :                     ; 		mov	#240,r3
(1) 1071/ 6000F66 :                     ; 		mov	#$00010000,r4
(1) 1072/ 6000F66 :                     ; 		mov	#$00010000,r5
(1) 1073/ 6000F66 :                     ; 		bsr	MarsVideo_SetBg
(1) 1074/ 6000F66 :                     ; 		nop
(1) 1075/ 6000F66 :                     ; 		mov	#TESTMARS_BG_PAL,r1		; Load palette
(1) 1076/ 6000F66 :                     ; 		mov	#0,r2
(1) 1077/ 6000F66 :                     ; 		mov	#256,r3
(1) 1078/ 6000F66 :                     ; 		mov	#$0000,r4
(1) 1079/ 6000F66 :                     ; 		mov	#MarsVideo_LoadPal,r0
(1) 1080/ 6000F66 :                     ; 		jsr	@r0
(1) 1081/ 6000F66 :                     ; 		nop
(1) 1082/ 6000F66 :                     ; 		mov 	#_vdpreg,r1
(1) 1083/ 6000F66 :                     ; 		mov	#1,r0
(1) 1084/ 6000F66 :                     ; 		mov.b	r0,@(bitmapmd,r1)
(1) 1085/ 6000F66 :                     ;
(1) 1086/ 6000F66 :                     ; ; ---------------------------------------
(1) 1087/ 6000F66 :                     ; ; Mode0 loop
(1) 1088/ 6000F66 :                     ; ; ---------------------------------------
(1) 1089/ 6000F66 :                     ;
(1) 1090/ 6000F66 :                     ; mstr_gfx2_loop:
(1) 1091/ 6000F66 :                     ; 		mov.b	@(marsGbl_CurrFb,gbr),r0
(1) 1092/ 6000F66 :                     ; 		mov	r0,r3
(1) 1093/ 6000F66 :                     ; 		mov	#_vdpreg,r4			; Wait if frameswap is done
(1) 1094/ 6000F66 :                     ; .wait_frmswp:	mov.b	@(framectl,r4),r0
(1) 1095/ 6000F66 :                     ; 		cmp/eq	r0,r3
(1) 1096/ 6000F66 :                     ; 		bf	.wait_frmswp
(1) 1097/ 6000F66 :                     ;
(1) 1098/ 6000F66 :                     ; 		mov	@(marsGbl_BgData,gbr),r0
(1) 1099/ 6000F66 :                     ; 		cmp/eq	#0,r0
(1) 1100/ 6000F66 :                     ; 		bt	.no_scrldata
(1) 1101/ 6000F66 :                     ; 		bsr	mstr_movebg
(1) 1102/ 6000F66 :                     ; 		nop
(1) 1103/ 6000F66 :                     ; .no_scrldata:
(1) 1104/ 6000F66 :                     ;  		mov	#_framebuffer,r1
(1) 1105/ 6000F66 :                     ; 		mov	#$200/2,r0	; START line data
(1) 1106/ 6000F66 :                     ; 		mov	#240,r2		; Vertical lines to set
(1) 1107/ 6000F66 :                     ; 		mov	r0,r3		; Increment by (copy from r0)
(1) 1108/ 6000F66 :                     ; .loopfb:	mov.w	r0,@r1
(1) 1109/ 6000F66 :                     ; 		add	#2,r1
(1) 1110/ 6000F66 :                     ; 		add	r3,r0
(1) 1111/ 6000F66 :                     ; 		dt	r2
(1) 1112/ 6000F66 :                     ; 		bf	.loopfb
(1) 1113/ 6000F66 :                     ; 		mov	#_CCR,r3			; <-- Required for Watchdog
(1) 1114/ 6000F66 :                     ; 		mov	#%00001000,r0			; Two-way mode
(1) 1115/ 6000F66 :                     ; 		mov.w	r0,@r3
(1) 1116/ 6000F66 :                     ; 		mov	#%00011001,r0			; Cache purge / Two-way mode / Cache ON
(1) 1117/ 6000F66 :                     ; 		mov.w	r0,@r3
(1) 1118/ 6000F66 :                     ; 		mov	#MarsVideo_SetWatchdog,r0
(1) 1119/ 6000F66 :                     ; 		jsr	@r0
(1) 1120/ 6000F66 :                     ; 		nop
(1) 1121/ 6000F66 :                     ;
(1) 1122/ 6000F66 :                     ; ; 	TODO: broken
(1) 1123/ 6000F66 :                     ; 	; Start slicing polygons
(1) 1124/ 6000F66 :                     ; 	; r14 - Polygon pointers list
(1) 1125/ 6000F66 :                     ; 	; r13 - Number of polygons to build
(1) 1126/ 6000F66 :                     ; 		mov.w	@(marsGbl_MstrReqDraw,gbr),r0
(1) 1127/ 6000F66 :                     ; 		cmp/eq	#0,r0
(1) 1128/ 6000F66 :                     ; 		bt	.skip
(1) 1129/ 6000F66 :                     ; 		xor	r0,r0
(1) 1130/ 6000F66 :                     ; 		mov.w	r0,@(marsGbl_MstrReqDraw,gbr)
(1) 1131/ 6000F66 :                     ; 		mov.w   @(marsGbl_PlgnBuffNum,gbr),r0	; Start drawing polygons from the READ buffer
(1) 1132/ 6000F66 :                     ; 		tst     #1,r0				; Check for which buffer to use
(1) 1133/ 6000F66 :                     ; 		bt	.page_2
(1) 1134/ 6000F66 :                     ; 		mov 	#RAM_Mars_Plgn_ZList_0,r14
(1) 1135/ 6000F66 :                     ; 		mov	#RAM_Mars_PlgnNum_0,r13
(1) 1136/ 6000F66 :                     ; 		bra	.cont_plgn
(1) 1137/ 6000F66 :                     ; 		nop
(1) 1138/ 6000F66 :                     ; .page_2:
(1) 1139/ 6000F66 :                     ; 		mov 	#RAM_Mars_Plgn_ZList_1,r14
(1) 1140/ 6000F66 :                     ; 		mov	#RAM_Mars_PlgnNum_1,r13
(1) 1141/ 6000F66 :                     ; 		nop
(1) 1142/ 6000F66 :                     ; 		nop
(1) 1143/ 6000F66 :                     ; .cont_plgn:
(1) 1144/ 6000F66 :                     ; 		mov.w	@r13,r13			; read from memory to register
(1) 1145/ 6000F66 :                     ; 		cmp/pl	r13				; zero?
(1) 1146/ 6000F66 :                     ; 		bf	.skip
(1) 1147/ 6000F66 :                     ; .loop:
(1) 1148/ 6000F66 :                     ; 		mov	r14,@-r15
(1) 1149/ 6000F66 :                     ; 		mov	r13,@-r15
(1) 1150/ 6000F66 :                     ; 		mov	@r14,r14			; Get location of the polygon
(1) 1151/ 6000F66 :                     ; 		cmp/pl	r14				; Zero?
(1) 1152/ 6000F66 :                     ; 		bf	.invalid			; if yes, skip
(1) 1153/ 6000F66 :                     ; 		mov 	#MarsVideo_SlicePlgn,r0
(1) 1154/ 6000F66 :                     ; 		jsr	@r0
(1) 1155/ 6000F66 :                     ; 		nop
(1) 1156/ 6000F66 :                     ; .invalid:
(1) 1157/ 6000F66 :                     ; 		mov	@r15+,r13
(1) 1158/ 6000F66 :                     ; 		mov	@r15+,r14
(1) 1159/ 6000F66 :                     ; 		dt	r13				; Decrement numof_polygons
(1) 1160/ 6000F66 :                     ; 		bf/s	.loop
(1) 1161/ 6000F66 :                     ; 		add	#8,r14				; Move to next entry
(1) 1162/ 6000F66 :                     ; .skip:
(1) 1163/ 6000F66 :                     ; 		bra	mstgfx_exit
(1) 1164/ 6000F66 :                     ; 		nop
(1) 1165/ 6000F66 :                     
(1) 1166/ 6000F66 :                     ; 	; --------------------------------------
(1) 1167/ 6000F66 :                     ; .wait_pz:
(1) 1168/ 6000F66 :                     ; 		mov.w	@(marsGbl_PzListCntr,gbr),r0	; Any pieces remaining on Watchdog?
(1) 1169/ 6000F66 :                     ; 		cmp/eq	#0,r0
(1) 1170/ 6000F66 :                     ; 		bf	.wait_pz
(1) 1171/ 6000F66 :                     ; .wait_task:
(1) 1172/ 6000F66 :                     ; 		mov.w	@(marsGbl_WdDrwTask,gbr),r0	; Any drawing task active?
(1) 1173/ 6000F66 :                     ; 		cmp/eq	#0,r0
(1) 1174/ 6000F66 :                     ; 		bf	.wait_task
(1) 1175/ 6000F66 :                     ; 		mov.l   #$FFFFFE80,r1			; Stop watchdog
(1) 1176/ 6000F66 :                     ; 		mov.w   #$A518,r0
(1) 1177/ 6000F66 :                     ; 		mov.w   r0,@r1
(1) 1178/ 6000F66 :                     ; 		mov	#_vdpreg,r1
(1) 1179/ 6000F66 :                     ; .waitfb:	mov.w	@(vdpsts,r1),r0			; Wait until any line-fill finishes.
(1) 1180/ 6000F66 :                     ; 		tst	#%10,r0
(1) 1181/ 6000F66 :                     ; 		bf	.waitfb
(1) 1182/ 6000F66 :                     ; 		mov	#_vdpreg,r1
(1) 1183/ 6000F66 :                     ; 		mov.b	@(framectl,r1),r0		; Frameswap request, Next Watchdog will
(1) 1184/ 6000F66 :                     ; 		xor	#1,r0				; check for it later.
(1) 1185/ 6000F66 :                     ; 		mov.b	r0,@(framectl,r1)		; Save new bit
(1) 1186/ 6000F66 :                     ; 		mov.b	r0,@(marsGbl_CurrFb,gbr)	; And a copy for checking
(1) 1187/ 6000F66 :                     ; 		bra	master_loop
(1) 1188/ 6000F66 :                     ; 		nop
(1) 1189/ 6000F66 :                     		align 4
(1) 1190/ 6000F68 :                     		ltorg
(1) 1191/ 6000F68 :                     
(1) 1192/ 6000F68 :                     ; ====================================================================
(1) 1193/ 6000F68 :                     ; ----------------------------------------------------------------
(1) 1194/ 6000F68 :                     ; Slave entry
(1) 1195/ 6000F68 :                     ; ----------------------------------------------------------------
(1) 1196/ 6000F68 :                     
(1) 1197/ 6000F68 :                     		align 4
(1) 1198/ 6000F68 :                     SH2_S_Entry:
(1) 1199/ 6000F68 : DF1C                		mov.l	#CS3|$3F000,r15			; Reset stack
(1) 1200/ 6000F6A : 9145                		mov	#_FRT,r1
(1) 1201/ 6000F6C : E000                		mov     #0,r0
(1) 1202/ 6000F6E : 8010                		mov.b   r0,@(0,r1)
(1) 1203/ 6000F70 : E0E2                		mov     #$FFFFFFE2,r0
(1) 1204/ 6000F72 : 8017                		mov.b   r0,@(7,r1)
(1) 1205/ 6000F74 : E000                		mov     #0,r0
(1) 1206/ 6000F76 : 8014                		mov.b   r0,@(4,r1)
(1) 1207/ 6000F78 : E001                		mov     #1,r0
(1) 1208/ 6000F7A : 8015                		mov.b   r0,@(5,r1)
(1) 1209/ 6000F7C : E000                		mov     #0,r0
(1) 1210/ 6000F7E : 8016                		mov.b   r0,@(6,r1)
(1) 1211/ 6000F80 : E001                		mov     #1,r0
(1) 1212/ 6000F82 : 8011                		mov.b   r0,@(1,r1)
(1) 1213/ 6000F84 : E000                		mov     #0,r0
(1) 1214/ 6000F86 : 8013                		mov.b   r0,@(3,r1)
(1) 1215/ 6000F88 : 8012                		mov.b   r0,@(2,r1)
(1) 1216/ 6000F8A : 9036                		mov.l   #$FFFFFEE2,r0			; Watchdog: Set interrupt priority bits (IPRA)
(1) 1217/ 6000F8C : E150                		mov     #%0101<<4,r1
(1) 1218/ 6000F8E : 2011                		mov.w   r1,@r0
(1) 1219/ 6000F90 : 9034                		mov.l   #$FFFFFEE4,r0
(1) 1220/ 6000F92 : E148                		mov     #$120/4,r1			; Watchdog: Set jump pointer (VBR + this/4) (WITV)
(1) 1221/ 6000F94 : 4118                		shll8   r1
(1) 1222/ 6000F96 : 2011                		mov.w   r1,@r0
(1) 1223/ 6000F98 :                     
(1) 1224/ 6000F98 :                     ; ------------------------------------------------
(1) 1225/ 6000F98 :                     ; Wait for Genesis, report to Master SH2
(1) 1226/ 6000F98 :                     ; ------------------------------------------------
(1) 1227/ 6000F98 :                     
(1) 1228/ 6000F98 :                     .wait_md:
(1) 1229/ 6000F98 : D211                		mov 	#_sysreg+comm0,r2
(1) 1230/ 6000F9A : 6022                		mov.l	@r2,r0
(1) 1231/ 6000F9C : 8800                		cmp/eq	#0,r0
(1) 1232/ 6000F9E : 8BFB                		bf	.wait_md
(1) 1233/ 6000FA0 : D010                		mov.l	#"SLAV",r0
(1) 1234/ 6000FA2 : 1202                		mov.l	r0,@(8,r2)
(1) 1235/ 6000FA4 :                     
(1) 1236/ 6000FA4 :                     ; ====================================================================
(1) 1237/ 6000FA4 :                     ; ----------------------------------------------------------------
(1) 1238/ 6000FA4 :                     ; Slave main code
(1) 1239/ 6000FA4 :                     ; ----------------------------------------------------------------
(1) 1240/ 6000FA4 :                     
(1) 1241/ 6000FA4 :                     SH2_S_HotStart:
(1) 1242/ 6000FA4 : DF0D                		mov.l	#CS3|$3F000,r15			; Reset stack
(1) 1243/ 6000FA6 : DE10                		mov.l	#RAM_Mars_Global,r14		; Reset gbr
(1) 1244/ 6000FA8 : 4E1E                		ldc	r14,gbr
(1) 1245/ 6000FAA : 9028                		mov.l	#$F0,r0				; Interrupts OFF
(1) 1246/ 6000FAC : 400E                		ldc	r0,sr
(1) 1247/ 6000FAE : 9127                		mov.l	#_CCR,r1
(1) 1248/ 6000FB0 : E008                		mov	#%00001000,r0			; Cache OFF
(1) 1249/ 6000FB2 : 2101                		mov.w	r0,@r1
(1) 1250/ 6000FB4 : E019                		mov	#%00011001,r0			; Cache purge / Two-way mode / Cache ON
(1) 1251/ 6000FB6 : 2101                		mov.w	r0,@r1
(1) 1252/ 6000FB8 : D10C                		mov	#_sysreg,r1
(1) 1253/ 6000FBA : E003                		mov	#PWMIRQ_ON|CMDIRQ_ON,r0		; Enable these interrupts
(1) 1254/ 6000FBC : 8011                    		mov.b	r0,@(intmask,r1)		; (Watchdog is external)
(1) 1255/ 6000FBE : D10C                		mov 	#CACHE_SLAVE,r1			; Transfer Slave's fast-code to CACHE
(1) 1256/ 6000FC0 : D20C                		mov 	#$C0000000,r2
(1) 1257/ 6000FC2 : 931E                		mov 	#(CACHE_SLAVE_E-CACHE_SLAVE)/4,r3
(1) 1258/ 6000FC4 :                     .copy:
(1) 1259/ 6000FC4 : 6016                		mov 	@r1+,r0
(1) 1260/ 6000FC6 : 2202                		mov 	r0,@r2
(1) 1261/ 6000FC8 : 7204                		add 	#4,r2
(1) 1262/ 6000FCA : 4310                		dt	r3
(1) 1263/ 6000FCC : 8BFA                		bf	.copy
(1) 1264/ 6000FCE : BE52                		bsr	MarsSound_Init			; Init Sound
(1) 1265/ 6000FD0 : 0009                		nop
(1) 1266/ 6000FD2 :                     ; 		mov	#MarsMdl_Init,r0		; REMINDER: 1 meter = $10000
(1) 1267/ 6000FD2 :                     ; 		jsr	@r0
(1) 1268/ 6000FD2 :                     ; 		nop
(1) 1269/ 6000FD2 :                     
(1) 1270/ 6000FD2 : E020                		mov.l	#$20,r0				; Interrupts ON
(1) 1271/ 6000FD4 : 400E                		ldc	r0,sr
(1) 1272/ 6000FD6 :                     
(1) 1273/ 6000FD6 :                     ; --------------------------------------------------------
(1) 1274/ 6000FD6 :                     ; Loop
(1) 1275/ 6000FD6 :                     ; --------------------------------------------------------
(1) 1276/ 6000FD6 :                     
(1) 1277/ 6000FD6 :                     ; 		mov	#_sysreg+comm15,r1
(1) 1278/ 6000FD6 :                     ; .wait_s:	mov.b	@r1,r0
(1) 1279/ 6000FD6 :                     ; 		cmp/pz	r0
(1) 1280/ 6000FD6 :                     ; 		bt	.wait_s
(1) 1281/ 6000FD6 :                     ; 		xor	r0,r0
(1) 1282/ 6000FD6 :                     ; 		mov.b	r0,@r1
(1) 1283/ 6000FD6 : A015                		bra	slave_loop
(1) 1284/ 6000FD8 : 0009                		nop
(1) 1285/ 6000FDA :                     		align 4
(1) 1286/ 6000FDC : 0603 F000 2000 4020 		ltorg
                    534C 4156 0600 4210 
                    2000 4000 0600 1348 
                    C000 0000 FE10 FEE2 
                    FEE4 00F0 FE92 0131 
(1) 1287/ 6001004 :                     
(1) 1288/ 6001004 :                     slave_loop:
(1) 1289/ 6001004 : D168                		mov	#_sysreg+comm15,r1
(1) 1290/ 6001006 : 6010                		mov.b	@r1,r0
(1) 1291/ 6001008 : C901                		and	#$01,r0
(1) 1292/ 600100A : 8800                		cmp/eq	#0,r0
(1) 1293/ 600100C : 890E                		bt	.TEST_1
(1) 1294/ 600100E : C9FE                		and	#%11111110,r0
(1) 1295/ 6001010 :                     ; 		xor	r0,r0
(1) 1296/ 6001010 : 2100                		mov.b	r0,@r1
(1) 1297/ 6001012 : 4F03                		stc	sr,@-r15		; Interrupts OFF
(1) 1298/ 6001014 : 90E2                		mov	#$F0,r0
(1) 1299/ 6001016 : E100                		mov	#0,r1
(1) 1300/ 6001018 : D264                		mov	#SmpIns_Bell_Ice+6,r2
(1) 1301/ 600101A : D365                		mov	#SmpIns_Bell_Ice+$3B2A,r3
(1) 1302/ 600101C : E400                		mov	#0,r4
(1) 1303/ 600101E : 95DE                		mov	#$80,r5
(1) 1304/ 6001020 : E600                		mov	#0,r6
(1) 1305/ 6001022 : E70B                		mov	#%1011,r7
(1) 1306/ 6001024 : D063                		mov	#MarsSound_SetPwm,r0
(1) 1307/ 6001026 : 400B                		jsr	@r0
(1) 1308/ 6001028 : 0009                		nop
(1) 1309/ 600102A :                     ; 		mov	#1,r1
(1) 1310/ 600102A :                     ; 		mov	#SmpIns_Brass1_Low+6,r2
(1) 1311/ 600102A :                     ; 		mov	#SmpIns_Brass1_Low+$3FD8,r3
(1) 1312/ 600102A :                     ; 		mov	#0,r4
(1) 1313/ 600102A :                     ; 		mov	#$30,r5
(1) 1314/ 600102A :                     ; 		mov	#0,r6
(1) 1315/ 600102A :                     ; 		mov	#%1011,r7
(1) 1316/ 600102A :                     ; 		mov	#MarsSound_SetPwm,r0
(1) 1317/ 600102A :                     ; 		jsr	@r0
(1) 1318/ 600102A :                     ; 		nop
(1) 1319/ 600102A :                     ; 		mov	#0,r1
(1) 1320/ 600102A :                     ; 		mov	#PWM_STEREO+6,r2
(1) 1321/ 600102A :                     ; 		mov	#PWM_STEREO_e,r3
(1) 1322/ 600102A :                     ; 		mov	#0,r4
(1) 1323/ 600102A :                     ; 		mov	#$100,r5
(1) 1324/ 600102A :                     ; 		mov	#0,r6
(1) 1325/ 600102A :                     ; 		mov	#%1111,r7
(1) 1326/ 600102A :                     ; 		mov	#MarsSound_SetPwm,r0
(1) 1327/ 600102A :                     ; 		jsr	@r0
(1) 1328/ 600102A :                     ; 		nop
(1) 1329/ 600102A :                     ; 		mov	#1,r1
(1) 1330/ 600102A :                     ; 		mov	#PWM_STEREO+6,r2
(1) 1331/ 600102A :                     ; 		mov	#PWM_STEREO_e,r3
(1) 1332/ 600102A :                     ; 		mov	#0,r4
(1) 1333/ 600102A :                     ; 		mov	#$100,r5
(1) 1334/ 600102A :                     ; 		mov	#0,r6
(1) 1335/ 600102A :                     ; 		mov	#%1111,r7
(1) 1336/ 600102A :                     ; 		mov	#MarsSound_SetPwm,r0
(1) 1337/ 600102A :                     ; 		jsr	@r0
(1) 1338/ 600102A :                     ; 		nop
(1) 1339/ 600102A : 4F07                		ldc	@r15+,sr
(1) 1340/ 600102C :                     .TEST_1:
(1) 1341/ 600102C :                     
(1) 1342/ 600102C :                     	; *** GEMA PWM DRIVER
(1) 1343/ 600102C :                     	; %RCIOxxxx
(1) 1344/ 600102C :                     	; R - REQUEST
(1) 1345/ 600102C :                     	;     Request new PWM channels to play from the Z80,
(1) 1346/ 600102C :                     	;     requires usage of the next bit:
(1) 1347/ 600102C :                     	; C - CLOCK, for the Z80-to-SH2 transfer part
(1) 1348/ 600102C :                     	;     The Z80 will copy the pwmcom buffer to
(1) 1349/ 600102C :                     	;     comms 0,2,4,6,8,10,12, write CLOCK and the SH2 side
(1) 1350/ 600102C :                     	;     will copy those bytes to the MarsSnd_PwmControl buffer
(1) 1351/ 600102C :                     	;     in packs of 4 (hardcoded on both CPUs),
(1) 1352/ 600102C :                     	;     clears when it finished processing
(1) 1353/ 600102C :                     	; I - PWM RV-protection enter
(1) 1354/ 600102C :                     	;     Makes a temporal backup of the playing sample in
(1) 1355/ 600102C :                     	;     CACHE and sets a RV-backup flag so it keeps playing
(1) 1356/ 600102C :                     	;     the sample even if the Genesis side is doing DMA
(1) 1357/ 600102C :                     	;     (Only for samples stored in the ROM area)
(1) 1358/ 600102C :                     	; O - PWM RV-protection exit
(1) 1359/ 600102C :                     	;     Set this after ALL DMA task from the Genesis side
(1) 1360/ 600102C :                     	;     are finished.
(1) 1361/ 600102C :                     	;
(1) 1362/ 600102C :                     	; xxxx bits are free to use
(1) 1363/ 600102C :                     	;
(1) 1364/ 600102C : D95E                		mov	#_sysreg+comm15,r9	; control comm
(1) 1365/ 600102E : 6090                		mov.b	@r9,r0
(1) 1366/ 6001030 : 91D5                		mov	#%10000000,r1
(1) 1367/ 6001032 : 2019                		and	r1,r0
(1) 1368/ 6001034 : 3010                		cmp/eq	r1,r0
(1) 1369/ 6001036 : 8901                		bt	.non_zero
(1) 1370/ 6001038 : A09A                		bra	.no_ztrnsfr
(1) 1371/ 600103A : 0009                		nop
(1) 1372/ 600103C :                     .non_zero:
(1) 1373/ 600103C :                     	; TRANSFER START
(1) 1374/ 600103C : D75E                		mov	#MarsSnd_PwmControl,r7
(1) 1375/ 600103E : E504                		mov	#4,r5			; number of passes
(1) 1376/ 6001040 :                     .wait_1:
(1) 1377/ 6001040 : 0009                		nop
(1) 1378/ 6001042 : 0009                		nop
(1) 1379/ 6001044 : 6090                		mov.b	@r9,r0			; wait first CLOCK
(1) 1380/ 6001046 : C940                		and	#%01000000,r0		; from Z80
(1) 1381/ 6001048 : 4015                		cmp/pl	r0
(1) 1382/ 600104A : 8BF9                		bf	.wait_1
(1) 1383/ 600104C : E607                		mov	#7,r6
(1) 1384/ 600104E : D85B                		mov	#_sysreg+comm0,r8
(1) 1385/ 6001050 :                     .copy_1:
(1) 1386/ 6001050 : 6085                		mov.w	@r8+,r0
(1) 1387/ 6001052 : 2701                		mov.w	r0,@r7
(1) 1388/ 6001054 : 4610                		dt	r6
(1) 1389/ 6001056 : 8FFB                		bf/s	.copy_1
(1) 1390/ 6001058 : 7702                		add	#2,r7
(1) 1391/ 600105A : 6090                		mov.b	@r9,r0			; tell Z80 CLK finished
(1) 1392/ 600105C : C9BF                		and	#%10111111,r0
(1) 1393/ 600105E : 2900                		mov.b	r0,@r9
(1) 1394/ 6001060 : 4510                		dt	r5
(1) 1395/ 6001062 : 8BED                		bf	.wait_1
(1) 1396/ 6001064 :                     	; *** TRANSFER END
(1) 1397/ 6001064 :                     
(1) 1398/ 6001064 : E100                		mov	#0,r1			; r1 - PWM slot
(1) 1399/ 6001066 : DE56                		mov	#MarsSnd_PwmControl,r14
(1) 1400/ 6001068 : EA07                		mov	#7,r10
(1) 1401/ 600106A :                     .next_chnl:
(1) 1402/ 600106A : 60E0                		mov.b	@r14,r0
(1) 1403/ 600106C : C9FF                		and	#$FF,r0
(1) 1404/ 600106E : 8800                		cmp/eq	#0,r0
(1) 1405/ 6001070 : 8976                		bt	.no_req
(1) 1406/ 6001072 : 2DDA                		xor	r13,r13
(1) 1407/ 6001074 : 2ED0                		mov.b	r13,@r14
(1) 1408/ 6001076 : 6703                		mov	r0,r7
(1) 1409/ 6001078 : C907                		and	#%111,r0
(1) 1410/ 600107A : 8804                		cmp/eq	#4,r0
(1) 1411/ 600107C : 8901                		bt	.pwm_keycut
(1) 1412/ 600107E : 8802                		cmp/eq	#2,r0
(1) 1413/ 6001080 : 8B05                		bf	.no_keyoff
(1) 1414/ 6001082 :                     .pwm_keycut:
(1) 1415/ 6001082 : E200                		mov	#0,r2
(1) 1416/ 6001084 : D04F                		mov	#MarsSound_PwmEnable,r0
(1) 1417/ 6001086 : 400B                		jsr	@r0
(1) 1418/ 6001088 : 0009                		nop
(1) 1419/ 600108A : A069                		bra	.no_req
(1) 1420/ 600108C : 0009                		nop
(1) 1421/ 600108E :                     
(1) 1422/ 600108E :                     	; Normal playback
(1) 1423/ 600108E :                     .no_keyoff:
(1) 1424/ 600108E : 6073                		mov	r7,r0
(1) 1425/ 6001090 : C810                		tst	#$10,r0
(1) 1426/ 6001092 : 890E                		bt	.no_pitchbnd
(1) 1427/ 6001094 : 6DE3                		mov	r14,r13
(1) 1428/ 6001096 : 7D08                		add	#8,r13		; skip COM
(1) 1429/ 6001098 : 60D0                		mov.b	@r13,r0		; r2 - Get pitch MSB bits
(1) 1430/ 600109A : 7D08                		add	#8,r13
(1) 1431/ 600109C : C903                		and	#%11,r0
(1) 1432/ 600109E : 4018                		shll8	r0
(1) 1433/ 60010A0 : 6203                		mov	r0,r2
(1) 1434/ 60010A2 : 60D0                		mov.b	@r13,r0		; Pitch LSB
(1) 1435/ 60010A4 : 7D08                		add	#8,r13
(1) 1436/ 60010A6 : C9FF                		and	#$FF,r0
(1) 1437/ 60010A8 : 202B                		or	r2,r0
(1) 1438/ 60010AA : 6203                		mov	r0,r2
(1) 1439/ 60010AC : D046                		mov	#MarsSound_SetPwmPitch,r0
(1) 1440/ 60010AE : 400B                		jsr	@r0
(1) 1441/ 60010B0 : 0009                		nop
(1) 1442/ 60010B2 :                     .no_pitchbnd:
(1) 1443/ 60010B2 : 6073                		mov	r7,r0
(1) 1444/ 60010B4 : C820                		tst	#$20,r0
(1) 1445/ 60010B6 : 8908                		bt	.no_volumebnd
(1) 1446/ 60010B8 : 6703                		mov	r0,r7
(1) 1447/ 60010BA : 6DE3                		mov	r14,r13
(1) 1448/ 60010BC : 7D08                		add	#8,r13		; point to volume values
(1) 1449/ 60010BE : 60D0                		mov.b	@r13,r0
(1) 1450/ 60010C0 : C9FC                		and	#%11111100,r0	; skip MSB pitch bits
(1) 1451/ 60010C2 : 6203                		mov	r0,r2
(1) 1452/ 60010C4 : D041                		mov	#MarsSound_SetVolume,r0
(1) 1453/ 60010C6 : 400B                		jsr	@r0
(1) 1454/ 60010C8 : 0009                		nop
(1) 1455/ 60010CA :                     .no_volumebnd:
(1) 1456/ 60010CA :                     
(1) 1457/ 60010CA :                     
(1) 1458/ 60010CA :                     	; TODO: Change reading struct if
(1) 1459/ 60010CA :                     	; it gets too CPU intensive
(1) 1460/ 60010CA : 6073                		mov	r7,r0
(1) 1461/ 60010CC : C801                		tst	#$01,r0		; key-on?
(1) 1462/ 60010CE : 8947                		bt	.no_req
(1) 1463/ 60010D0 : 6DE3                		mov	r14,r13
(1) 1464/ 60010D2 : 7D08                		add	#8,r13		; skip COM
(1) 1465/ 60010D4 :                     
(1) 1466/ 60010D4 : 60D0                		mov.b	@r13,r0
(1) 1467/ 60010D6 : 7D08                		add	#8,r13
(1) 1468/ 60010D8 : 6503                		mov	r0,r5
(1) 1469/ 60010DA : C9FC                		and	#%11111100,r0	; skip MSB pitch bits
(1) 1470/ 60010DC : 6603                		mov	r0,r6		; r6 - Volume
(1) 1471/ 60010DE : 6053                		mov	r5,r0		; r5 - Get pitch MSB bits
(1) 1472/ 60010E0 : C903                		and	#%00000011,r0
(1) 1473/ 60010E2 : 4018                		shll8	r0
(1) 1474/ 60010E4 : 6503                		mov	r0,r5
(1) 1475/ 60010E6 : 60D0                		mov.b	@r13,r0		; Pitch LSB
(1) 1476/ 60010E8 : 7D08                		add	#8,r13
(1) 1477/ 60010EA : C9FF                		and	#$FF,r0
(1) 1478/ 60010EC : 205B                		or	r5,r0
(1) 1479/ 60010EE : 6503                		mov	r0,r5
(1) 1480/ 60010F0 :                     
(1) 1481/ 60010F0 : 60D0                		mov.b	@r13,r0		; flags | SH2 BANK
(1) 1482/ 60010F2 : 7D08                		add	#8,r13
(1) 1483/ 60010F4 : 6703                		mov	r0,r7		; r7 - Flags
(1) 1484/ 60010F6 : C90F                		and	#%1111,r0
(1) 1485/ 60010F8 : 6803                		mov	r0,r8		; r8 - SH2 section (ROM or SDRAM)
(1) 1486/ 60010FA : 4828                		shll16	r8
(1) 1487/ 60010FC : 4818                		shll8	r8
(1) 1488/ 60010FE : 4709                		shlr2	r7
(1) 1489/ 6001100 : 4709                		shlr2	r7
(1) 1490/ 6001102 : 60D0                		mov.b	@r13,r0		; r2 - START point
(1) 1491/ 6001104 : 7D08                		add	#8,r13
(1) 1492/ 6001106 : C9FF                		and	#$FF,r0
(1) 1493/ 6001108 : 4028                		shll16	r0
(1) 1494/ 600110A : 6303                		mov	r0,r3
(1) 1495/ 600110C : 60D0                		mov.b	@r13,r0
(1) 1496/ 600110E : 7D08                		add	#8,r13
(1) 1497/ 6001110 : C9FF                		and	#$FF,r0
(1) 1498/ 6001112 : 4018                		shll8	r0
(1) 1499/ 6001114 : 6203                		mov	r0,r2
(1) 1500/ 6001116 : 60D0                		mov.b	@r13,r0
(1) 1501/ 6001118 : 7D08                		add	#8,r13
(1) 1502/ 600111A : C9FF                		and	#$FF,r0
(1) 1503/ 600111C : 203B                		or	r3,r0
(1) 1504/ 600111E : 202B                		or	r2,r0
(1) 1505/ 6001120 : 6203                		mov	r0,r2
(1) 1506/ 6001122 : 6423                		mov	r2,r4		; r4 - START copy
(1) 1507/ 6001124 : 228B                		or	r8,r2		; add CS2
(1) 1508/ 6001126 : 6024                		mov.b	@r2+,r0		; r3 - Length
(1) 1509/ 6001128 : C9FF                		and	#$FF,r0
(1) 1510/ 600112A : 6303                		mov	r0,r3
(1) 1511/ 600112C : 6024                		mov.b	@r2+,r0
(1) 1512/ 600112E : C9FF                		and	#$FF,r0
(1) 1513/ 6001130 : 4018                		shll8	r0
(1) 1514/ 6001132 : 230B                		or	r0,r3
(1) 1515/ 6001134 : 6024                		mov.b	@r2+,r0
(1) 1516/ 6001136 : C9FF                		and	#$FF,r0
(1) 1517/ 6001138 : 4028                		shll16	r0
(1) 1518/ 600113A : 230B                		or	r0,r3
(1) 1519/ 600113C : 334C                		add	r4,r3		; add end+start
(1) 1520/ 600113E : 238B                		or	r8,r3		; add CS2
(1) 1521/ 6001140 : 6024                		mov.b	@r2+,r0		; get loop point
(1) 1522/ 6001142 : C9FF                		and	#$FF,r0
(1) 1523/ 6001144 : 6403                		mov	r0,r4
(1) 1524/ 6001146 : 6024                		mov.b	@r2+,r0
(1) 1525/ 6001148 : C9FF                		and	#$FF,r0
(1) 1526/ 600114A : 4018                		shll8	r0
(1) 1527/ 600114C : 240B                		or	r0,r4
(1) 1528/ 600114E : 6024                		mov.b	@r2+,r0
(1) 1529/ 6001150 : C9FF                		and	#$FF,r0
(1) 1530/ 6001152 : 4028                		shll16	r0
(1) 1531/ 6001154 : 240B                		or	r0,r4
(1) 1532/ 6001156 : 9043                		mov	#%11111100,r0
(1) 1533/ 6001158 : 2809                		and	r0,r8
(1) 1534/ 600115A : D016                		mov	#MarsSound_SetPwm,r0
(1) 1535/ 600115C : 400B                		jsr	@r0
(1) 1536/ 600115E : 0009                		nop
(1) 1537/ 6001160 :                     .no_req:
(1) 1538/ 6001160 : 7101                		add	#1,r1		; next PWM slot
(1) 1539/ 6001162 : 4A10                		dt	r10
(1) 1540/ 6001164 : 8F81                		bf/s	.next_chnl
(1) 1541/ 6001166 : 7E01                		add	#1,r14		; next PWM entry
(1) 1542/ 6001168 : D10F                		mov	#_sysreg+comm15,r1
(1) 1543/ 600116A : 6010                		mov.b	@r1,r0		; Now we are free.
(1) 1544/ 600116C : C97F                		and	#%01111111,r0
(1) 1545/ 600116E : 2100                		mov.b	r0,@r1
(1) 1546/ 6001170 :                     .no_ztrnsfr:
(1) 1547/ 6001170 :                     
(1) 1548/ 6001170 :                     	; PWM backup enter/exit bits
(1) 1549/ 6001170 :                     	; In case Genesis side wants to do
(1) 1550/ 6001170 :                     	; DMA transfers
(1) 1551/ 6001170 : D90D                		mov	#_sysreg+comm15,r9
(1) 1552/ 6001172 : 6090                		mov.b	@r9,r0
(1) 1553/ 6001174 : C920                		and	#%00100000,r0
(1) 1554/ 6001176 : 8820                		cmp/eq	#%00100000,r0
(1) 1555/ 6001178 : 8B08                		bf	.refill_in
(1) 1556/ 600117A : D015                		mov	#MarsSnd_Refill,r0
(1) 1557/ 600117C : 400B                		jsr	@r0
(1) 1558/ 600117E : 0009                		nop
(1) 1559/ 6001180 : D114                		mov	#MarsSnd_RvMode,r1
(1) 1560/ 6001182 : E001                		mov	#1,r0
(1) 1561/ 6001184 : 2102                		mov	r0,@r1
(1) 1562/ 6001186 : 6090                		mov.b	@r9,r0			; Refill is ready.
(1) 1563/ 6001188 : C9DF                		and	#%11011111,r0
(1) 1564/ 600118A : 2900                		mov.b	r0,@r9
(1) 1565/ 600118C :                     .refill_in:
(1) 1566/ 600118C : D906                		mov	#_sysreg+comm15,r9
(1) 1567/ 600118E : 6090                		mov.b	@r9,r0
(1) 1568/ 6001190 : C910                		and	#%00010000,r0
(1) 1569/ 6001192 : 8810                		cmp/eq	#%00010000,r0
(1) 1570/ 6001194 : 8B05                		bf	.refill_out
(1) 1571/ 6001196 : D110                		mov	#MarsSnd_RvMode,r1
(1) 1572/ 6001198 : E000                		mov	#0,r0
(1) 1573/ 600119A : 2102                		mov	r0,@r1
(1) 1574/ 600119C : 6090                		mov.b	@r9,r0
(1) 1575/ 600119E : C9EF                		and	#%11101111,r0
(1) 1576/ 60011A0 : 2900                		mov.b	r0,@r9
(1) 1577/ 60011A2 :                     .refill_out:
(1) 1578/ 60011A2 :                     	; *** END PWM driver for GEMA
(1) 1579/ 60011A2 :                     
(1) 1580/ 60011A2 : AF2F                		bra	slave_loop
(1) 1581/ 60011A4 : 0009                		nop
(1) 1582/ 60011A6 :                     		align 4
(1) 1583/ 60011A8 : 2000 402F 0203 EC76 		ltorg
                    0204 279A 0600 0CA8 
                    0600 47C0 2000 4020 
                    0600 47C0 0600 0D14 
                    0600 0CE4 0600 0CFC 
                    0600 0D24 C000 04BC 
                    C000 04BC 00F0 0080 
                    00FC                
(1) 1584/ 60011E2 :                     
(1) 1585/ 60011E2 :                     		align 4
(1) 1586/ 60011E4 :                     ; this_polygon:
(1) 1587/ 60011E4 :                     ; 		dc.w $8000
(1) 1588/ 60011E4 :                     ; 		dc.w 320
(1) 1589/ 60011E4 :                     ; 		dc.l TESTMARS_BG
(1) 1590/ 60011E4 :                     ; dest_data:	dc.w  32,-32
(1) 1591/ 60011E4 :                     ; 		dc.w -32,-32
(1) 1592/ 60011E4 :                     ; 		dc.w -32, 32
(1) 1593/ 60011E4 :                     ; 		dc.w  32, 32
(1) 1594/ 60011E4 :                     ; 		dc.w 274, 79
(1) 1595/ 60011E4 :                     ; 		dc.w 199, 79
(1) 1596/ 60011E4 :                     ; 		dc.w 199,142-1
(1) 1597/ 60011E4 :                     ; 		dc.w 274,142-1
(1) 1598/ 60011E4 : 0000 0000           rot_angle	dc.l 0
(1) 1599/ 60011E8 :                     ;
(1) 1600/ 60011E8 :                     ;
(1) 1601/ 60011E8 :                     
(1) 1602/ 60011E8 :                     Rotate_Point
(1) 1603/ 60011E8 :                     
(1) 1604/ 60011E8 : 4708                	shll2	r7
(1) 1605/ 60011EA : 6073                	mov	r7,r0
(1) 1606/ 60011EC : D10C                	mov	#sin_table,r1
(1) 1607/ 60011EE : D20D                	mov	#sin_table+$800,r2
(1) 1608/ 60011F0 : 031E                	mov	@(r0,r1),r3
(1) 1609/ 60011F2 : 042E                	mov	@(r0,r2),r4
(1) 1610/ 60011F4 :                     
(1) 1611/ 60011F4 : 345D                	dmuls.l	r5,r4		; x cos @
(1) 1612/ 60011F6 : 001A                	sts	macl,r0
(1) 1613/ 60011F8 : 010A                	sts	mach,r1
(1) 1614/ 60011FA : 201D                	xtrct	r1,r0
(1) 1615/ 60011FC : 336D                	dmuls.l	r6,r3		; y sin @
(1) 1616/ 60011FE : 011A                	sts	macl,r1
(1) 1617/ 6001200 : 020A                	sts	mach,r2
(1) 1618/ 6001202 : 212D                	xtrct	r2,r1
(1) 1619/ 6001204 : 301C                	add	r1,r0
(1) 1620/ 6001206 :                     
(1) 1621/ 6001206 : 633B                	neg	r3,r3
(1) 1622/ 6001208 : 335D                	dmuls.l	r5,r3		; x -sin @
(1) 1623/ 600120A : 011A                	sts	macl,r1
(1) 1624/ 600120C : 020A                	sts	mach,r2
(1) 1625/ 600120E : 212D                	xtrct	r2,r1
(1) 1626/ 6001210 : 346D                	dmuls.l	r6,r4		; y cos @
(1) 1627/ 6001212 : 021A                	sts	macl,r2
(1) 1628/ 6001214 : 030A                	sts	mach,r3
(1) 1629/ 6001216 : 223D                	xtrct	r3,r2
(1) 1630/ 6001218 : 312C                	add	r2,r1
(1) 1631/ 600121A :                     
(1) 1632/ 600121A : 000B                	rts
(1) 1633/ 600121C : 0009                	nop
(1) 1634/ 600121E :                     	align 4
(1) 1635/ 6001220 : 0600 180C 0600 200C 	ltorg
(1) 1636/ 6001228 :                     
(1) 1637/ 6001228 :                     ; ; ------------------------------------------------
(1) 1638/ 6001228 :                     ; ; Process task requests from Genesis
(1) 1639/ 6001228 :                     ; ; ------------------------------------------------
(1) 1640/ 6001228 :                     ;
(1) 1641/ 6001228 :                     ; 		mov	#_sysreg+comm15,r1
(1) 1642/ 6001228 :                     ; 		mov.b	@r1,r0
(1) 1643/ 6001228 :                     ; 		and	#$80,r0
(1) 1644/ 6001228 :                     ; 		cmp/eq	#0,r0
(1) 1645/ 6001228 :                     ; 		bt	.no_req
(1) 1646/ 6001228 :                     ; 		mov	#MAX_MDTASKS,r13
(1) 1647/ 6001228 :                     ; 		mov	#RAM_Mars_MdTasksFifo_S,r14
(1) 1648/ 6001228 :                     ; .next_req:
(1) 1649/ 6001228 :                     ; 		mov	r13,@-r15
(1) 1650/ 6001228 :                     ; 		mov	@r14,r0
(1) 1651/ 6001228 :                     ; 		cmp/eq	#0,r0
(1) 1652/ 6001228 :                     ; 		bt	.no_task
(1) 1653/ 6001228 :                     ; 		jsr	@r0
(1) 1654/ 6001228 :                     ; 		nop
(1) 1655/ 6001228 :                     ; 		xor	r0,r0
(1) 1656/ 6001228 :                     ; 		mov	r0,@r14
(1) 1657/ 6001228 :                     ; .no_task:
(1) 1658/ 6001228 :                     ; 		mov	#MAX_MDTSKARG*4,r0
(1) 1659/ 6001228 :                     ; 		mov	@r15+,r13
(1) 1660/ 6001228 :                     ; 		dt	r13
(1) 1661/ 6001228 :                     ; 		bf/s	.next_req
(1) 1662/ 6001228 :                     ; 		add	r0,r14
(1) 1663/ 6001228 :                     ; 		mov	#_sysreg+comm15,r1
(1) 1664/ 6001228 :                     ; 		mov.b	@r1,r0
(1) 1665/ 6001228 :                     ; 		and	#$7F,r0
(1) 1666/ 6001228 :                     ; 		mov.b	r0,@r1
(1) 1667/ 6001228 :                     ; .no_req:
(1) 1668/ 6001228 :                     ; 		mov	#_sysreg+comm15,r1
(1) 1669/ 6001228 :                     ; 		mov.b	@r1,r0
(1) 1670/ 6001228 :                     ; 		and	#$7F,r0
(1) 1671/ 6001228 :                     ; 		cmp/eq	#1,r0
(1) 1672/ 6001228 :                     ; 		bf	slave_loop
(1) 1673/ 6001228 :                     
(1) 1674/ 6001228 :                     ; --------------------------------------------------------
(1) 1675/ 6001228 :                     ; Start building polygons from models
(1) 1676/ 6001228 :                     ;
(1) 1677/ 6001228 :                     ; *** CAMERA ANIMATION IS DONE ON THE 68K ***
(1) 1678/ 6001228 :                     ; --------------------------------------------------------
(1) 1679/ 6001228 :                     
(1) 1680/ 6001228 :                     ; 		mov	#0,r0
(1) 1681/ 6001228 :                     ; 		mov.w	r0,@(marsGbl_MdlFacesCntr,gbr)
(1) 1682/ 6001228 :                     ; 		mov 	#RAM_Mars_Polygons_0,r1
(1) 1683/ 6001228 :                     ; 		mov	#RAM_Mars_Plgn_ZList_0,r2
(1) 1684/ 6001228 :                     ; 		mov.w   @(marsGbl_PlgnBuffNum,gbr),r0
(1) 1685/ 6001228 :                     ; 		tst     #1,r0
(1) 1686/ 6001228 :                     ; 		bt	.go_mdl
(1) 1687/ 6001228 :                     ; 		mov 	#RAM_Mars_Polygons_1,r1
(1) 1688/ 6001228 :                     ; 		mov	#RAM_Mars_Plgn_ZList_1,r2
(1) 1689/ 6001228 :                     ; .go_mdl:
(1) 1690/ 6001228 :                     ; 		mov	r1,r0
(1) 1691/ 6001228 :                     ; 		mov	r0,@(marsGbl_CurrFacePos,gbr)
(1) 1692/ 6001228 :                     ; 		mov	r2,r0
(1) 1693/ 6001228 :                     ; 		mov	r0,@(marsGbl_CurrZList,gbr)
(1) 1694/ 6001228 :                     ; 		mov	#$FFFFFE80,r1
(1) 1695/ 6001228 :                     ; 		mov.w	#$5A7F,r0			; Watchdog wait timer
(1) 1696/ 6001228 :                     ; 		mov.w	r0,@r1
(1) 1697/ 6001228 :                     ; 		mov.w	#$A538,r0			; Watchdog ON
(1) 1698/ 6001228 :                     ; 		mov.w	r0,@r1
(1) 1699/ 6001228 :                     ;
(1) 1700/ 6001228 :                     ; ; ----------------------------------------
(1) 1701/ 6001228 :                     ;
(1) 1702/ 6001228 :                     ; 		mov	#_CCR,r1			; <-- Required for Watchdog
(1) 1703/ 6001228 :                     ; 		mov	#%00001000,r0			; Two-way mode
(1) 1704/ 6001228 :                     ; 		mov.w	r0,@r1
(1) 1705/ 6001228 :                     ; 		mov	#%00011001,r0			; Cache purge / Two-way mode / Cache ON
(1) 1706/ 6001228 :                     ; 		mov.w	r0,@r1
(1) 1707/ 6001228 :                     ; 		mov	#MarsLay_Read,r0		; Build layout inside camera
(1) 1708/ 6001228 :                     ; 		jsr	@r0				; takes 9 object slots
(1) 1709/ 6001228 :                     ; 		nop
(1) 1710/ 6001228 :                     ; 		mov	#RAM_Mars_Objects,r14		; Build all objects
(1) 1711/ 6001228 :                     ; 		mov	#MAX_MODELS,r13
(1) 1712/ 6001228 :                     ; .loop:
(1) 1713/ 6001228 :                     ; 		mov	@(mdl_data,r14),r0		; Object model data == 0 or -1?
(1) 1714/ 6001228 :                     ; 		cmp/pl	r0
(1) 1715/ 6001228 :                     ; 		bf	.invlid
(1) 1716/ 6001228 :                     ; 		mov	#MarsMdl_ReadModel,r0
(1) 1717/ 6001228 :                     ; 		jsr	@r0
(1) 1718/ 6001228 :                     ; 		mov	r13,@-r15
(1) 1719/ 6001228 :                     ; 		mov	@r15+,r13
(1) 1720/ 6001228 :                     ; 		mov	#0,r0
(1) 1721/ 6001228 :                     ; 		mov.w	@(marsGbl_MdlFacesCntr,gbr),r0	; Ran out of space to store faces?
(1) 1722/ 6001228 :                     ; 		mov	#MAX_MPLGN,r1
(1) 1723/ 6001228 :                     ; 		cmp/ge	r1,r0
(1) 1724/ 6001228 :                     ; 		bt	.skip
(1) 1725/ 6001228 :                     ; .invlid:
(1) 1726/ 6001228 :                     ; 		dt	r13
(1) 1727/ 6001228 :                     ; 		bf/s	.loop
(1) 1728/ 6001228 :                     ; 		add	#sizeof_mdlobj,r14
(1) 1729/ 6001228 :                     ; .skip:
(1) 1730/ 6001228 :                     ; 		mov	#1,r0
(1) 1731/ 6001228 :                     ; 		mov.w	r0,@(marsGbl_ZSortReq,gbr)
(1) 1732/ 6001228 :                     ;
(1) 1733/ 6001228 :                     ; ; ----------------------------------------
(1) 1734/ 6001228 :                     ;
(1) 1735/ 6001228 :                     ; .wait_z:
(1) 1736/ 6001228 :                     ; 		mov.w	@(marsGbl_ZSortReq,gbr),r0
(1) 1737/ 6001228 :                     ; 		cmp/eq	#1,r0
(1) 1738/ 6001228 :                     ; 		bt	.wait_z
(1) 1739/ 6001228 :                     ; 		mov.l   #$FFFFFE80,r1			; Stop watchdog
(1) 1740/ 6001228 :                     ; 		mov.w   #$A518,r0
(1) 1741/ 6001228 :                     ; 		mov.w   r0,@r1
(1) 1742/ 6001228 :                     ;
(1) 1743/ 6001228 :                     ; ; ----------------------------------------
(1) 1744/ 6001228 :                     ;
(1) 1745/ 6001228 :                     ; ; 		mov 	#RAM_Mars_Plgn_ZList_0,r14
(1) 1746/ 6001228 :                     ; 		mov 	#RAM_Mars_PlgnNum_0,r13
(1) 1747/ 6001228 :                     ; 		mov.w   @(marsGbl_PlgnBuffNum,gbr),r0
(1) 1748/ 6001228 :                     ; 		tst     #1,r0
(1) 1749/ 6001228 :                     ; 		bt	.page_2
(1) 1750/ 6001228 :                     ; ; 		mov 	#RAM_Mars_Plgn_ZList_1,r14
(1) 1751/ 6001228 :                     ; 		mov 	#RAM_Mars_PlgnNum_1,r13
(1) 1752/ 6001228 :                     ; .page_2:
(1) 1753/ 6001228 :                     ; 		mov.w	@(marsGbl_MdlFacesCntr,gbr),r0
(1) 1754/ 6001228 :                     ; 		mov.w	r0,@r13
(1) 1755/ 6001228 :                     ;
(1) 1756/ 6001228 :                     ; 		mov	#_sysreg+comm2,r4		; DEBUG COUNTER
(1) 1757/ 6001228 :                     ; ; 		mov	#0,r0
(1) 1758/ 6001228 :                     ; 		mov.w	r0,@r4
(1) 1759/ 6001228 :                     ; 		mov	#_sysreg+comm14,r2
(1) 1760/ 6001228 :                     ; .mstr_busy:
(1) 1761/ 6001228 :                     ; 		mov.b	@r2,r0
(1) 1762/ 6001228 :                     ; 		and	#$7F,r0
(1) 1763/ 6001228 :                     ; 		cmp/eq	#0,r0
(1) 1764/ 6001228 :                     ; 		bf	.mstr_busy			; Skip frame
(1) 1765/ 6001228 :                     ; 		mov.w	@(marsGbl_PlgnBuffNum,gbr),r0	; Swap polygon buffer
(1) 1766/ 6001228 :                     ;  		xor	#1,r0
(1) 1767/ 6001228 :                     ;  		mov.w	r0,@(marsGbl_PlgnBuffNum,gbr)
(1) 1768/ 6001228 :                     ;  		mov	#1,r1				; Set task $01 to Master
(1) 1769/ 6001228 :                     ; 		mov.b	@r2,r0
(1) 1770/ 6001228 :                     ; 		and	#$80,r0
(1) 1771/ 6001228 :                     ; 		or	r1,r0
(1) 1772/ 6001228 :                     ; 		mov.b	r0,@r2
(1) 1773/ 6001228 :                     ;
(1) 1774/ 6001228 :                     ; 		mov	#_sysreg+comm15,r1
(1) 1775/ 6001228 :                     ; 		mov.b	@r1,r0
(1) 1776/ 6001228 :                     ; 		and	#$80,r0
(1) 1777/ 6001228 :                     ; 		mov.b	r0,@r1
(1) 1778/ 6001228 :                     
(1) 1779/ 6001228 :                     ; ====================================================================
(1) 1780/ 6001228 :                     ; --------------------------------------------------------
(1) 1781/ 6001228 :                     ; Task list for MD-to-MARS tasks, call these 68k side
(1) 1782/ 6001228 :                     ; with the respective arguments
(1) 1783/ 6001228 :                     ;
(1) 1784/ 6001228 :                     ; *** 68k EXAMPLES ***
(1) 1785/ 6001228 :                     ;
(1) 1786/ 6001228 :                     ; Single task:
(1) 1787/ 6001228 :                     ; 	move.l	#CmdTaskMd_SetBitmap,d0		; 32X display ON
(1) 1788/ 6001228 :                     ; 	moveq	#1,d1
(1) 1789/ 6001228 :                     ; 	bsr	System_MdMars_MstAddTask
(1) 1790/ 6001228 :                     ;
(1) 1791/ 6001228 :                     ; Queued task:
(1) 1792/ 6001228 :                     ; 	move.l	#Palette_Intro,d1
(1) 1793/ 6001228 :                     ; 	moveq	#0,d2
(1) 1794/ 6001228 :                     ; 	mov.w	#16,d3
(1) 1795/ 6001228 :                     ; 	moveq	#0,d4
(1) 1796/ 6001228 :                     ; 	move.l	#CmdTaskMd_LoadSPal,d0		; Load palette
(1) 1797/ 6001228 :                     ; 	bsr	System_MdMars_MstAddTask
(1) 1798/ 6001228 :                     ;	; then add more requests
(1) 1799/ 6001228 :                     ; 	bsr	System_MdMars_MstSendAll	; <-- Send all and wait
(1) 1800/ 6001228 :                     ; 	; or
(1) 1801/ 6001228 :                     ; 	bsr	System_MdMars_MstSendDrop	; <-- Send all but skip if busy
(1) 1802/ 6001228 :                     ;
(1) 1803/ 6001228 :                     ; Mst: for Master, processes until all draw-tasks finished
(1) 1804/ 6001228 :                     ; Slv: for Slave, processes after sorting model faces
(1) 1805/ 6001228 :                     ; --------------------------------------------------------
(1) 1806/ 6001228 :                     
(1) 1807/ 6001228 :                     		align 4
(1) 1808/ 6001228 :                     
(1) 1809/ 6001228 :                     ; ------------------------------------------------
(1) 1810/ 6001228 :                     ; CALLS EXCLUSIVE TO MASTER CPU
(1) 1811/ 6001228 :                     ; ------------------------------------------------
(1) 1812/ 6001228 :                     
(1) 1813/ 6001228 :                     ; ------------------------------------------------
(1) 1814/ 6001228 :                     ; Set SuperVDP bitmap value
(1) 1815/ 6001228 :                     ;
(1) 1816/ 6001228 :                     ; @($04,r14) - SuperVDP bitmap number (0-3)
(1) 1817/ 6001228 :                     ; ------------------------------------------------
(1) 1818/ 6001228 :                     
(1) 1819/ 6001228 :                     CmdTaskMd_SetBitmap:
(1) 1820/ 6001228 : D108                		mov 	#_vdpreg,r1
(1) 1821/ 600122A : 8515                .wait_fb:	mov.w   @($A,r1),r0
(1) 1822/ 600122C : C802                		tst     #2,r0
(1) 1823/ 600122E : 8BFC                		bf      .wait_fb
(1) 1824/ 6001230 : 50E1                		mov	@($04,r14),r0
(1) 1825/ 6001232 : 8011                		mov.b	r0,@(bitmapmd,r1)
(1) 1826/ 6001234 : 000B                		rts
(1) 1827/ 6001236 : 0009                		nop
(1) 1828/ 6001238 :                     		align 4
(1) 1829/ 6001238 :                     
(1) 1830/ 6001238 :                     ; ------------------------------------------------
(1) 1831/ 6001238 :                     ; Load palette to SuperVDP from MD
(1) 1832/ 6001238 :                     ;
(1) 1833/ 6001238 :                     ; @($04,r14) - Palette data
(1) 1834/ 6001238 :                     ; @($08,r14) - Start from
(1) 1835/ 6001238 :                     ; @($0C,r14) - Number of colors
(1) 1836/ 6001238 :                     ; @($10,r14) - OR value
(1) 1837/ 6001238 :                     ; ------------------------------------------------
(1) 1838/ 6001238 :                     
(1) 1839/ 6001238 :                     CmdTaskMd_LoadSPal:
(1) 1840/ 6001238 : 6DE3                		mov	r14,r13
(1) 1841/ 600123A : 7D04                		add	#4,r13
(1) 1842/ 600123C : 61D6                		mov	@r13+,r1
(1) 1843/ 600123E : 62D6                		mov	@r13+,r2
(1) 1844/ 6001240 : 63D6                		mov	@r13+,r3
(1) 1845/ 6001242 : 64D6                		mov	@r13+,r4
(1) 1846/ 6001244 : D002                		mov	#MarsVideo_LoadPal,r0
(1) 1847/ 6001246 : 402B                		jmp	@r0
(1) 1848/ 6001248 : 0009                		nop
(1) 1849/ 600124A :                     		align 4
(1) 1850/ 600124C :                     
(1) 1851/ 600124C :                     ; ------------------------------------------------
(1) 1852/ 600124C :                     ; CALLS EXCLUSIVE TO SLAVE CPU
(1) 1853/ 600124C :                     ; ------------------------------------------------
(1) 1854/ 600124C :                     
(1) 1855/ 600124C :                     ; ; ------------------------------------------------
(1) 1856/ 600124C :                     ; ; Make new object and insert it to specific slot
(1) 1857/ 600124C :                     ; ;
(1) 1858/ 600124C :                     ; ; @($04,r14) - Object slot
(1) 1859/ 600124C :                     ; ; @($08,r14) - Object data
(1) 1860/ 600124C :                     ; ; @($0C,r14) - Object animation data
(1) 1861/ 600124C :                     ; ; @($10,r14) - Object animation speed
(1) 1862/ 600124C :                     ; ; @($14,r14) - Object options:
(1) 1863/ 600124C :                     ; ;	       %????????????????????????pppppppp
(1) 1864/ 600124C :                     ; ;		p - index pixel increment value
(1) 1865/ 600124C :                     ; ; ------------------------------------------------
(1) 1866/ 600124C :                     ;
(1) 1867/ 600124C :                     ; CmdTaskMd_ObjectSet:
(1) 1868/ 600124C :                     ; 		mov	#RAM_Mars_Objects+(sizeof_mdlobj*9),r12
(1) 1869/ 600124C :                     ; 		mov	r14,r13
(1) 1870/ 600124C :                     ; 		add	#4,r13
(1) 1871/ 600124C :                     ; 		mov	@r13+,r0
(1) 1872/ 600124C :                     ; 		mov	#sizeof_mdlobj,r1
(1) 1873/ 600124C :                     ; 		mulu	r1,r0
(1) 1874/ 600124C :                     ; 		sts	macl,r0
(1) 1875/ 600124C :                     ; 		add	r0,r12
(1) 1876/ 600124C :                     ; 		xor	r0,r0
(1) 1877/ 600124C :                     ; 		mov	@r13+,r1
(1) 1878/ 600124C :                     ; 		mov	r1,@(mdl_data,r12)
(1) 1879/ 600124C :                     ; 		mov	@r13+,r1
(1) 1880/ 600124C :                     ; 		mov	r1,@(mdl_animdata,r12)
(1) 1881/ 600124C :                     ; 		mov	@r13+,r1
(1) 1882/ 600124C :                     ; 		mov	r1,@(mdl_animspd,r12)
(1) 1883/ 600124C :                     ; 		mov	@r13+,r1
(1) 1884/ 600124C :                     ; 		mov	r1,@(mdl_option,r12)
(1) 1885/ 600124C :                     ; 		xor	r0,r0
(1) 1886/ 600124C :                     ; 		mov	r0,@(mdl_x_pos,r12)
(1) 1887/ 600124C :                     ; 		mov	r0,@(mdl_y_pos,r12)
(1) 1888/ 600124C :                     ; 		mov	r0,@(mdl_z_pos,r12)
(1) 1889/ 600124C :                     ; 		mov	r0,@(mdl_x_rot,r12)
(1) 1890/ 600124C :                     ; 		mov	r0,@(mdl_y_rot,r12)
(1) 1891/ 600124C :                     ; 		mov	r0,@(mdl_z_rot,r12)
(1) 1892/ 600124C :                     ; 		mov	r0,@(mdl_animframe,r12)
(1) 1893/ 600124C :                     ; 		mov	r0,@(mdl_animtimer,r12)
(1) 1894/ 600124C :                     ; 		rts
(1) 1895/ 600124C :                     ; 		nop
(1) 1896/ 600124C :                     ; 		align 4
(1) 1897/ 600124C :                     ;
(1) 1898/ 600124C :                     ; ; ------------------------------------------------
(1) 1899/ 600124C :                     ; ; Move/Rotate object from slot
(1) 1900/ 600124C :                     ; ;
(1) 1901/ 600124C :                     ; ; @($04,r14) - Object slot
(1) 1902/ 600124C :                     ; ; @($08,r14) - Object X pos
(1) 1903/ 600124C :                     ; ; @($0C,r14) - Object Y pos
(1) 1904/ 600124C :                     ; ; @($10,r14) - Object Z pos
(1) 1905/ 600124C :                     ; ; @($14,r14) - Object X rot
(1) 1906/ 600124C :                     ; ; @($18,r14) - Object Y rot
(1) 1907/ 600124C :                     ; ; @($1C,r14) - Object Z rot
(1) 1908/ 600124C :                     ; ; ------------------------------------------------
(1) 1909/ 600124C :                     ;
(1) 1910/ 600124C :                     ; CmdTaskMd_ObjectPos:
(1) 1911/ 600124C :                     ; 		mov	#RAM_Mars_Objects+(sizeof_mdlobj*9),r12
(1) 1912/ 600124C :                     ; 		mov	r14,r13
(1) 1913/ 600124C :                     ; 		add	#4,r13
(1) 1914/ 600124C :                     ; 		mov	@r13+,r0
(1) 1915/ 600124C :                     ; 		mov	#sizeof_mdlobj,r1
(1) 1916/ 600124C :                     ; 		mulu	r1,r0
(1) 1917/ 600124C :                     ; 		sts	macl,r0
(1) 1918/ 600124C :                     ; 		add	r0,r12
(1) 1919/ 600124C :                     ; 		mov	@r13+,r1
(1) 1920/ 600124C :                     ; 		mov	@r13+,r2
(1) 1921/ 600124C :                     ; 		mov	@r13+,r3
(1) 1922/ 600124C :                     ; 		mov	@r13+,r4
(1) 1923/ 600124C :                     ; 		mov	@r13+,r5
(1) 1924/ 600124C :                     ; 		mov	@r13+,r6
(1) 1925/ 600124C :                     ; 		mov	r1,@(mdl_x_pos,r12)
(1) 1926/ 600124C :                     ; 		mov	r2,@(mdl_y_pos,r12)
(1) 1927/ 600124C :                     ; 		mov	r3,@(mdl_z_pos,r12)
(1) 1928/ 600124C :                     ; 		mov	r4,@(mdl_x_rot,r12)
(1) 1929/ 600124C :                     ; 		mov	r5,@(mdl_y_rot,r12)
(1) 1930/ 600124C :                     ; 		mov	r6,@(mdl_z_rot,r12)
(1) 1931/ 600124C :                     ; 		rts
(1) 1932/ 600124C :                     ; 		nop
(1) 1933/ 600124C :                     ; 		align 4
(1) 1934/ 600124C :                     ;
(1) 1935/ 600124C :                     ; ; ------------------------------------------------
(1) 1936/ 600124C :                     ; ; Clear ALL objects, including layout
(1) 1937/ 600124C :                     ; ; ------------------------------------------------
(1) 1938/ 600124C :                     ;
(1) 1939/ 600124C :                     ; CmdTaskMd_ObjectClrAll:
(1) 1940/ 600124C :                     ; 		sts	pr,@-r15
(1) 1941/ 600124C :                     ; 		mov	#MarsMdl_Init,r0
(1) 1942/ 600124C :                     ; 		jsr	@r0
(1) 1943/ 600124C :                     ; 		nop
(1) 1944/ 600124C :                     ; 		lds	@r15+,pr
(1) 1945/ 600124C :                     ; 		rts
(1) 1946/ 600124C :                     ; 		nop
(1) 1947/ 600124C :                     ; 		align 4
(1) 1948/ 600124C :                     ;
(1) 1949/ 600124C :                     ; ; ------------------------------------------------
(1) 1950/ 600124C :                     ; ; Set new map data
(1) 1951/ 600124C :                     ; ;
(1) 1952/ 600124C :                     ; ; @($04,r14) - layout data (set to 0 to clear)
(1) 1953/ 600124C :                     ; ; ------------------------------------------------
(1) 1954/ 600124C :                     ;
(1) 1955/ 600124C :                     ; CmdTaskMd_MakeMap:
(1) 1956/ 600124C :                     ; 		sts	pr,@-r15
(1) 1957/ 600124C :                     ; ; 		bsr	MarsVideo_ClearFrame
(1) 1958/ 600124C :                     ; ; 		nop
(1) 1959/ 600124C :                     ; 		mov	@(4,r14),r1
(1) 1960/ 600124C :                     ; 		mov	#MarsLay_Make,r0
(1) 1961/ 600124C :                     ; 		jsr	@r0
(1) 1962/ 600124C :                     ; 		mov	r14,@-r15
(1) 1963/ 600124C :                     ; 		mov	@r15+,r14
(1) 1964/ 600124C :                     ; 		lds	@r15+,pr
(1) 1965/ 600124C :                     ; 		rts
(1) 1966/ 600124C :                     ; 		nop
(1) 1967/ 600124C :                     ; 		align 4
(1) 1968/ 600124C :                     ;
(1) 1969/ 600124C :                     ; ; ------------------------------------------------
(1) 1970/ 600124C :                     ; ; Set camera position
(1) 1971/ 600124C :                     ; ;
(1) 1972/ 600124C :                     ; ; @($04,r14) - Camera slot (TODO)
(1) 1973/ 600124C :                     ; ; @($08,r14) - Camera X pos
(1) 1974/ 600124C :                     ; ; @($0C,r14) - Camera Y pos
(1) 1975/ 600124C :                     ; ; @($10,r14) - Camera Z pos
(1) 1976/ 600124C :                     ; ; @($14,r14) - Camera X rot
(1) 1977/ 600124C :                     ; ; @($18,r14) - Camera Y rot
(1) 1978/ 600124C :                     ; ; @($1C,r14) - Camera Z rot
(1) 1979/ 600124C :                     ; ; ------------------------------------------------
(1) 1980/ 600124C :                     ;
(1) 1981/ 600124C :                     ; CmdTaskMd_CameraPos:
(1) 1982/ 600124C :                     ; 		mov	#RAM_Mars_ObjCamera,r12
(1) 1983/ 600124C :                     ; 		mov	r14,r13
(1) 1984/ 600124C :                     ; 		add	#8,r13
(1) 1985/ 600124C :                     ; 		mov	@r13+,r1
(1) 1986/ 600124C :                     ; 		mov	@r13+,r2
(1) 1987/ 600124C :                     ; 		mov	@r13+,r3
(1) 1988/ 600124C :                     ; 		mov	@r13+,r4
(1) 1989/ 600124C :                     ; 		mov	@r13+,r5
(1) 1990/ 600124C :                     ; 		mov	@r13+,r6
(1) 1991/ 600124C :                     ; 		mov	r1,@(cam_x_pos,r12)
(1) 1992/ 600124C :                     ; 		mov	r2,@(cam_y_pos,r12)
(1) 1993/ 600124C :                     ; 		mov	r3,@(cam_z_pos,r12)
(1) 1994/ 600124C :                     ; 		mov	r4,@(cam_x_rot,r12)
(1) 1995/ 600124C :                     ; 		mov	r5,@(cam_y_rot,r12)
(1) 1996/ 600124C :                     ; 		mov	r6,@(cam_z_rot,r12)
(1) 1997/ 600124C :                     ; 		rts
(1) 1998/ 600124C :                     ; 		nop
(1) 1999/ 600124C :                     ; 		align 4
(1) 2000/ 600124C :                     ;
(1) 2001/ 600124C :                     ; ; ------------------------------------------------
(1) 2002/ 600124C :                     ; ; Set camera position
(1) 2003/ 600124C :                     ; ;
(1) 2004/ 600124C :                     ; ; @($04,r14) - Camera slot (TODO)
(1) 2005/ 600124C :                     ; ; @($08,r14) - Camera X pos
(1) 2006/ 600124C :                     ; ; @($0C,r14) - Camera Y pos
(1) 2007/ 600124C :                     ; ; @($10,r14) - Camera Z pos
(1) 2008/ 600124C :                     ; ; @($14,r14) - Camera X rot
(1) 2009/ 600124C :                     ; ; @($18,r14) - Camera Y rot
(1) 2010/ 600124C :                     ; ; @($1C,r14) - Camera Z rot
(1) 2011/ 600124C :                     ; ; ------------------------------------------------
(1) 2012/ 600124C :                     ;
(1) 2013/ 600124C :                     ; CmdTaskMd_UpdModels:
(1) 2014/ 600124C :                     ; 		mov	#_sysreg+comm15,r1
(1) 2015/ 600124C :                     ; 		mov	#1,r2
(1) 2016/ 600124C :                     ; 		mov.b	@r1,r0
(1) 2017/ 600124C :                     ; 		and	#$80,r0
(1) 2018/ 600124C :                     ; 		or	r2,r0
(1) 2019/ 600124C :                     ; 		mov.b	r0,@r1
(1) 2020/ 600124C :                     ; 		rts
(1) 2021/ 600124C :                     ; 		nop
(1) 2022/ 600124C :                     ; 		align 4
(1) 2023/ 600124C :                     ;
(1) 2024/ 600124C :                     ; ; ------------------------------------------------
(1) 2025/ 600124C :                     ; ; Set PWM to play
(1) 2026/ 600124C :                     ; ;
(1) 2027/ 600124C :                     ; ; @($04,r14) - Channel slot
(1) 2028/ 600124C :                     ; ; @($08,r14) - Start point
(1) 2029/ 600124C :                     ; ; @($0C,r14) - End point
(1) 2030/ 600124C :                     ; ; @($10,r14) - Loop point
(1) 2031/ 600124C :                     ; ; @($14,r14) - Pitch
(1) 2032/ 600124C :                     ; ; @($18,r14) - Volume
(1) 2033/ 600124C :                     ; ; @($1C,r14) - Settings: %00000000 00000000LR | LR - output bits
(1) 2034/ 600124C :                     ; ; ------------------------------------------------
(1) 2035/ 600124C :                     ;
(1) 2036/ 600124C :                     ; CmdTaskMd_PWM_SetChnl:
(1) 2037/ 600124C :                     ; 		sts	pr,@-r15
(1) 2038/ 600124C :                     ; 		mov	@($04,r14),r1
(1) 2039/ 600124C :                     ; 		mov	@($08,r14),r2
(1) 2040/ 600124C :                     ; 		mov	@($0C,r14),r3
(1) 2041/ 600124C :                     ; 		mov	@($10,r14),r4
(1) 2042/ 600124C :                     ; 		mov	@($14,r14),r5
(1) 2043/ 600124C :                     ; 		mov	@($18,r14),r6
(1) 2044/ 600124C :                     ; 		mov	@($1C,r14),r7
(1) 2045/ 600124C :                     ; 		bsr	MarsSound_SetPwm
(1) 2046/ 600124C :                     ; 		nop
(1) 2047/ 600124C :                     ; 		lds	@r15+,pr
(1) 2048/ 600124C :                     ; 		rts
(1) 2049/ 600124C :                     ; 		nop
(1) 2050/ 600124C :                     ; 		align 4
(1) 2051/ 600124C :                     ;
(1) 2052/ 600124C :                     ; ; ------------------------------------------------
(1) 2053/ 600124C :                     ; ; Set PWM pitch to multiple channels
(1) 2054/ 600124C :                     ; ;
(1) 2055/ 600124C :                     ; ; @($04,r14) - Channel 0 pitch
(1) 2056/ 600124C :                     ; ; @($08,r14) - Channel 1 pitch
(1) 2057/ 600124C :                     ; ; @($0C,r14) - Channel 2 pitch
(1) 2058/ 600124C :                     ; ; @($10,r14) - Channel 3 pitch
(1) 2059/ 600124C :                     ; ; @($14,r14) - Channel 4 pitch
(1) 2060/ 600124C :                     ; ; @($18,r14) - Channel 5 pitch
(1) 2061/ 600124C :                     ; ; @($1C,r14) - Channel 6 pitch
(1) 2062/ 600124C :                     ; ; ------------------------------------------------
(1) 2063/ 600124C :                     ;
(1) 2064/ 600124C :                     ; CmdTaskMd_PWM_MultPitch:
(1) 2065/ 600124C :                     ; 		sts	pr,@-r15
(1) 2066/ 600124C :                     ; 		mov	#$FFFF,r7
(1) 2067/ 600124C :                     ; 		mov	r14,r13
(1) 2068/ 600124C :                     ; 		add	#4,r13
(1) 2069/ 600124C :                     ; 		mov	#0,r1
(1) 2070/ 600124C :                     ; 	rept MAX_PWMCHNL		; MAX: 7
(1) 2071/ 600124C :                     ; 		mov	@r13+,r2
(1) 2072/ 600124C :                     ; 		and	r7,r2
(1) 2073/ 600124C :                     ; 		bsr	MarsSound_SetPwmPitch
(1) 2074/ 600124C :                     ; 		nop
(1) 2075/ 600124C :                     ; 		add	#1,r1
(1) 2076/ 600124C :                     ; 	endm
(1) 2077/ 600124C :                     ; 		lds	@r15+,pr
(1) 2078/ 600124C :                     ; 		rts
(1) 2079/ 600124C :                     ; 		nop
(1) 2080/ 600124C :                     ; 		align 4
(1) 2081/ 600124C :                     ;
(1) 2082/ 600124C :                     ; ; ------------------------------------------------
(1) 2083/ 600124C :                     ; ; Enable/Disable PWM channels from playing
(1) 2084/ 600124C :                     ; ;
(1) 2085/ 600124C :                     ; ; @($04,r14) - Channel slot
(1) 2086/ 600124C :                     ; ; @($08,r14) - Enable/Disable/Restart
(1) 2087/ 600124C :                     ; ; ------------------------------------------------
(1) 2088/ 600124C :                     ;
(1) 2089/ 600124C :                     ; CmdTaskMd_PWM_Enable:
(1) 2090/ 600124C :                     ; 		sts	pr,@-r15
(1) 2091/ 600124C :                     ; 		mov	@($04,r14),r1
(1) 2092/ 600124C :                     ; 		mov	@($08,r14),r2
(1) 2093/ 600124C :                     ; 		bsr	MarsSound_PwmEnable
(1) 2094/ 600124C :                     ; 		nop
(1) 2095/ 600124C :                     ; 		lds	@r15+,pr
(1) 2096/ 600124C :                     ; 		rts
(1) 2097/ 600124C :                     ; 		nop
(1) 2098/ 600124C :                     ; 		align 4
(1) 2099/ 600124C :                     
(1) 2100/ 600124C :                     ; ----------------------------------------
(1) 2101/ 600124C :                     
(1) 2102/ 600124C : 2000 4100 0600 0BE4 		ltorg
(1) 2103/ 6001254 :                     
(1) 2104/ 6001254 :                     ; =================================================================
(1) 2105/ 6001254 :                     ; ------------------------------------------------
(1) 2106/ 6001254 :                     ; Slave | Watchdog interrupt
(1) 2107/ 6001254 :                     ; ------------------------------------------------
(1) 2108/ 6001254 :                     
(1) 2109/ 6001254 :                     s_irq_custom:
(1) 2110/ 6001254 : 2F26                		mov	r2,@-r15
(1) 2111/ 6001256 : 910F                		mov	#_FRT,r1
(1) 2112/ 6001258 : 8417                		mov.b   @(7,r1),r0
(1) 2113/ 600125A : CA02                		xor     #2,r0
(1) 2114/ 600125C : 8017                		mov.b   r0,@(7,r1)
(1) 2115/ 600125E :                     
(1) 2116/ 600125E : 910C                		mov	#$FFFFFE80,r1
(1) 2117/ 6001260 : 900C                		mov.w   #$A518,r0		; Watchdog OFF
(1) 2118/ 6001262 : 2101                		mov.w   r0,@r1
(1) 2119/ 6001264 : CB20                		or      #$20,r0			; ON again
(1) 2120/ 6001266 : 2101                		mov.w   r0,@r1
(1) 2121/ 6001268 : E210                		mov	#$10,r2
(1) 2122/ 600126A : 9008                		mov.w   #$5A00,r0		; Timer for the next one
(1) 2123/ 600126C : 202B                		or	r2,r0
(1) 2124/ 600126E : 2101                		mov.w	r0,@r1
(1) 2125/ 6001270 :                     
(1) 2126/ 6001270 : 62F6                		mov	@r15+,r2
(1) 2127/ 6001272 : 000B                		rts
(1) 2128/ 6001274 : 0009                		nop
(1) 2129/ 6001276 :                     		align 4
(1) 2130/ 6001278 : FE10 FE80 A518 5A00 		ltorg
(1) 2131/ 6001280 :                     
(1) 2132/ 6001280 :                     ; ====================================================================
(1) 2133/ 6001280 :                     ; ----------------------------------------------------------------
(1) 2134/ 6001280 :                     ; Cache routines
(1) 2135/ 6001280 :                     ; ----------------------------------------------------------------
(1) 2136/ 6001280 :                     
(1) 2137/ 6001280 :                     		include "system/mars/cache.asm"
(2)    1/ 6001280 :                     ; ====================================================================
(2)    2/ 6001280 :                     ; ----------------------------------------------------------------
(2)    3/ 6001280 :                     ; CACHE code for Master CPU
(2)    4/ 6001280 :                     ;
(2)    5/ 6001280 :                     ; LIMIT: $800 bytes
(2)    6/ 6001280 :                     ; ----------------------------------------------------------------
(2)    7/ 6001280 :                     
(2)    8/ 6001280 :                     		align 4
(2)    9/ 6001280 :                     CACHE_MASTER:
(2)   10/FFFFFFFFC0000000 :                     		phase $C0000000
(2)   11/FFFFFFFFC0000000 :                     
(2)   12/FFFFFFFFC0000000 :                     ; ------------------------------------------------
(2)   13/FFFFFFFFC0000000 :                     ; Watchdog tasks
(2)   14/FFFFFFFFC0000000 :                     ; ------------------------------------------------
(2)   15/FFFFFFFFC0000000 :                     
(2)   16/FFFFFFFFC0000000 :                     ; Cache_OnInterrupt:
(2)   17/FFFFFFFFC0000000 :                     m_irq_custom:
(2)   18/FFFFFFFFC0000000 : D102                		mov	.tag_FRT,r1
(2)   19/FFFFFFFFC0000002 : 8417                		mov.b	@(7,r1), r0
(2)   20/FFFFFFFFC0000004 : CA02                		xor	#2,r0
(2)   21/FFFFFFFFC0000006 : 8017                		mov.b	r0,@(7,r1)
(2)   22/FFFFFFFFC0000008 : 000B                		rts
(2)   23/FFFFFFFFC000000A : 0009                		nop
(2)   24/FFFFFFFFC000000C :                     		align 4
(2)   25/FFFFFFFFC000000C :                     
(2)   26/FFFFFFFFC000000C :                     ; 		mov.w	@(marsGbl_WdDrwTask,gbr),r0
(2)   27/FFFFFFFFC000000C :                     ; 		and	#$FF,r0
(2)   28/FFFFFFFFC000000C :                     ; 		shll2	r0
(2)   29/FFFFFFFFC000000C :                     ; 		mov	#.list,r1
(2)   30/FFFFFFFFC000000C :                     ; 		mov	@(r1,r0),r0
(2)   31/FFFFFFFFC000000C :                     ; 		jmp	@r0
(2)   32/FFFFFFFFC000000C :                     ; 		nop
(2)   33/FFFFFFFFC000000C :                     ; 		align 4
(2)   34/FFFFFFFFC000000C :                     ; .list:
(2)   35/FFFFFFFFC000000C :                     ; 		dc.l drwtsk_00		; (null entry)
(2)   36/FFFFFFFFC000000C :                     ; 		dc.l drwtsk_01		; Draw background
(2)   37/FFFFFFFFC000000C :                     ; 		dc.l drwtsk_02		; Main polygons jump
(2)   38/FFFFFFFFC000000C :                     ; ; 		dc.l drwtsk_03		; Resume from solid-color
(2)   39/FFFFFFFFC000000C : FFFF FE10           .tag_FRT:	dc.l _FRT
(2)   40/FFFFFFFFC0000010 :                     ;
(2)   41/FFFFFFFFC0000010 :                     ; ; --------------------------------
(2)   42/FFFFFFFFC0000010 :                     ; ; Task $01: Left/Right drawing
(2)   43/FFFFFFFFC0000010 :                     ; ;
(2)   44/FFFFFFFFC0000010 :                     ; ; (Called on Watchdog)
(2)   45/FFFFFFFFC0000010 :                     ; ; --------------------------------
(2)   46/FFFFFFFFC0000010 :                     ;
(2)   47/FFFFFFFFC0000010 :                     ; 		align 4
(2)   48/FFFFFFFFC0000010 :                     ; drwtsk_01:
(2)   49/FFFFFFFFC0000010 :                     ; 		mov	r2,@-r15
(2)   50/FFFFFFFFC0000010 :                     ; 		mov	r3,@-r15
(2)   51/FFFFFFFFC0000010 :                     ; 		mov	r4,@-r15
(2)   52/FFFFFFFFC0000010 :                     ; 		mov	r5,@-r15
(2)   53/FFFFFFFFC0000010 :                     ; 		mov	r6,@-r15
(2)   54/FFFFFFFFC0000010 :                     ; 		mov	r7,@-r15
(2)   55/FFFFFFFFC0000010 :                     ; 		mov	r8,@-r15
(2)   56/FFFFFFFFC0000010 :                     ; 		mov	r9,@-r15
(2)   57/FFFFFFFFC0000010 :                     ; 		sts	macl,@-r15
(2)   58/FFFFFFFFC0000010 :                     ;
(2)   59/FFFFFFFFC0000010 :                     ; 		mov.l   #$FFFFFE80,r1
(2)   60/FFFFFFFFC0000010 :                     ; 		mov.w   #$A518,r0		; OFF
(2)   61/FFFFFFFFC0000010 :                     ; 		mov.w   r0,@r1
(2)   62/FFFFFFFFC0000010 :                     ; 		or      #$20,r0			; ON
(2)   63/FFFFFFFFC0000010 :                     ; 		mov.w   r0,@r1
(2)   64/FFFFFFFFC0000010 :                     ; 		mov.w   #$5A10,r0		; Timer before next watchdog
(2)   65/FFFFFFFFC0000010 :                     ; 		mov.w   r0,@r1
(2)   66/FFFFFFFFC0000010 :                     ; 		mov	#Cach_LR_Lines,r1	; Decrement a line to progress
(2)   67/FFFFFFFFC0000010 :                     ; 		mov	@r1,r0
(2)   68/FFFFFFFFC0000010 :                     ; 		dt	r0
(2)   69/FFFFFFFFC0000010 :                     ; 		bf/s	tsk00_exit
(2)   70/FFFFFFFFC0000010 :                     ; 		mov	r0,@r1
(2)   71/FFFFFFFFC0000010 :                     ;
(2)   72/FFFFFFFFC0000010 :                     ; ; 		mov.w	@(marsGbl_Bg_DrwReqR,gbr),r0
(2)   73/FFFFFFFFC0000010 :                     ; ; 		cmp/pl	r0
(2)   74/FFFFFFFFC0000010 :                     ; ; 		bf	.ndrw_r
(2)   75/FFFFFFFFC0000010 :                     ; ; 		dt	r0
(2)   76/FFFFFFFFC0000010 :                     ; ; 		mov.w	r0,@(marsGbl_Bg_DrwReqR,gbr)
(2)   77/FFFFFFFFC0000010 :                     ; ; .ndrw_r:
(2)   78/FFFFFFFFC0000010 :                     ; ; 		mov.w	@(marsGbl_Bg_DrwReqL,gbr),r0
(2)   79/FFFFFFFFC0000010 :                     ; ; 		cmp/pl	r0
(2)   80/FFFFFFFFC0000010 :                     ; ; 		bf	tsk00_gonext
(2)   81/FFFFFFFFC0000010 :                     ; ; 		dt	r0
(2)   82/FFFFFFFFC0000010 :                     ; ; 		mov.w	r0,@(marsGbl_Bg_DrwReqL,gbr)
(2)   83/FFFFFFFFC0000010 :                     ; tsk00_gonext:
(2)   84/FFFFFFFFC0000010 :                     ; 		mov	#2,r0			; If finished: Set task $02
(2)   85/FFFFFFFFC0000010 :                     ; 		mov.w	r0,@(marsGbl_WdDrwTask,gbr)
(2)   86/FFFFFFFFC0000010 :                     ; tsk00_exit:
(2)   87/FFFFFFFFC0000010 :                     ; 		lds	@r15+,macl
(2)   88/FFFFFFFFC0000010 :                     ; 		mov	@r15+,r9
(2)   89/FFFFFFFFC0000010 :                     ; 		mov	@r15+,r8
(2)   90/FFFFFFFFC0000010 :                     ; 		mov	@r15+,r7
(2)   91/FFFFFFFFC0000010 :                     ; 		mov	@r15+,r6
(2)   92/FFFFFFFFC0000010 :                     ; 		mov	@r15+,r5
(2)   93/FFFFFFFFC0000010 :                     ; 		mov	@r15+,r4
(2)   94/FFFFFFFFC0000010 :                     ; 		mov	@r15+,r3
(2)   95/FFFFFFFFC0000010 :                     ; 		mov	@r15+,r2
(2)   96/FFFFFFFFC0000010 :                     ; 		rts
(2)   97/FFFFFFFFC0000010 :                     ; 		nop
(2)   98/FFFFFFFFC0000010 :                     ; 		align 4
(2)   99/FFFFFFFFC0000010 :                     ; 		ltorg
(2)  100/FFFFFFFFC0000010 :                     ;
(2)  101/FFFFFFFFC0000010 :                     ; ; 		mov.w	@(marsGbl_CurrGfxMode,gbr),r0
(2)  102/FFFFFFFFC0000010 :                     ; ; 		and	#$7F,r0
(2)  103/FFFFFFFFC0000010 :                     ; ; 		cmp/eq	#1,r0
(2)  104/FFFFFFFFC0000010 :                     ; ; 		bt	drtsk_gm1
(2)  105/FFFFFFFFC0000010 :                     ; ; 		cmp/eq	#2,r0
(2)  106/FFFFFFFFC0000010 :                     ; ; 		bt	drtsk_gm2
(2)  107/FFFFFFFFC0000010 :                     ; ; 		mov	#_vdpreg,r1
(2)  108/FFFFFFFFC0000010 :                     ; ; .wait_fb:	mov.w   @($A,r1),r0		; Framebuffer free?
(2)  109/FFFFFFFFC0000010 :                     ; ; 		tst     #2,r0
(2)  110/FFFFFFFFC0000010 :                     ; ; 		bf      .wait_fb
(2)  111/FFFFFFFFC0000010 :                     ; ; 		mov.w   @(6,r1),r0		; SVDP-fill address
(2)  112/FFFFFFFFC0000010 :                     ; ; 		add     #$5F,r0			; Preincrement
(2)  113/FFFFFFFFC0000010 :                     ; ; 		mov.w   r0,@(6,r1)
(2)  114/FFFFFFFFC0000010 :                     ; ; 		mov.w   #320/2,r0		; SVDP-fill size (320 pixels)
(2)  115/FFFFFFFFC0000010 :                     ; ; 		mov.w   r0,@(4,r1)
(2)  116/FFFFFFFFC0000010 :                     ; ; 		mov.w	#$0000,r0		; SVDP-fill pixel data and start filling
(2)  117/FFFFFFFFC0000010 :                     ; ; 		mov.w   r0,@(8,r1)		; After finishing, SVDP-address got updated
(2)  118/FFFFFFFFC0000010 :                     ; ; 		bra	dtsk01_exit
(2)  119/FFFFFFFFC0000010 :                     ; ; 		nop
(2)  120/FFFFFFFFC0000010 :                     ; ; 		align 4
(2)  121/FFFFFFFFC0000010 :                     ; ; 		ltorg
(2)  122/FFFFFFFFC0000010 :                     ; ;
(2)  123/FFFFFFFFC0000010 :                     ; ; ; Mode1 draw routine
(2)  124/FFFFFFFFC0000010 :                     ; ; ; Left/Right scroll
(2)  125/FFFFFFFFC0000010 :                     ; ; drtsk_gm1:
(2)  126/FFFFFFFFC0000010 :                     ; ; 		bra	dtsk01_exit
(2)  127/FFFFFFFFC0000010 :                     ; ; 		nop
(2)  128/FFFFFFFFC0000010 :                     ; ; 		align 4
(2)  129/FFFFFFFFC0000010 :                     ; ;
(2)  130/FFFFFFFFC0000010 :                     ; ; ; Mode2 draw routine
(2)  131/FFFFFFFFC0000010 :                     ; ; ; Full scaling
(2)  132/FFFFFFFFC0000010 :                     ; ; drtsk_gm2:
(2)  133/FFFFFFFFC0000010 :                     ; ; 		mov	#Cach_Ycurr,r1
(2)  134/FFFFFFFFC0000010 :                     ; ; 		mov	@r1,r1
(2)  135/FFFFFFFFC0000010 :                     ; ; 		shlr16	r1
(2)  136/FFFFFFFFC0000010 :                     ; ; 		mov.w	@(marsGbl_BgWidth,gbr),r0
(2)  137/FFFFFFFFC0000010 :                     ; ; 		muls	r1,r0
(2)  138/FFFFFFFFC0000010 :                     ; ; 		sts	macl,r1
(2)  139/FFFFFFFFC0000010 :                     ; ; 		mov	@(marsGbl_Bg_FbCurrR,gbr),r0
(2)  140/FFFFFFFFC0000010 :                     ; ; 		mov	r0,r9
(2)  141/FFFFFFFFC0000010 :                     ; ; 		mov	@(marsGbl_BgData,gbr),r0
(2)  142/FFFFFFFFC0000010 :                     ; ; 		mov	r0,r8
(2)  143/FFFFFFFFC0000010 :                     ; ; 		add	r1,r8
(2)  144/FFFFFFFFC0000010 :                     ; ; 		mov	#Cach_Xpos,r1
(2)  145/FFFFFFFFC0000010 :                     ; ; 		mov 	@r1,r7
(2)  146/FFFFFFFFC0000010 :                     ; ; 		mov.w	@(marsGbl_BgWidth,gbr),r0
(2)  147/FFFFFFFFC0000010 :                     ; ; 		mov	r0,r6
(2)  148/FFFFFFFFC0000010 :                     ; ; 		mov	#-2,r0		; pixel size
(2)  149/FFFFFFFFC0000010 :                     ; ; 		and	r0,r7
(2)  150/FFFFFFFFC0000010 :                     ; ; 		and	r0,r6
(2)  151/FFFFFFFFC0000010 :                     ; ; 		shll16	r7
(2)  152/FFFFFFFFC0000010 :                     ; ; 		shll16	r6
(2)  153/FFFFFFFFC0000010 :                     ; ; 		mov	#Cach_Xadd,r4
(2)  154/FFFFFFFFC0000010 :                     ; ; 		mov	@r4,r4
(2)  155/FFFFFFFFC0000010 :                     ; ; 		shll	r4
(2)  156/FFFFFFFFC0000010 :                     ; ; 		mov	r4,r0
(2)  157/FFFFFFFFC0000010 :                     ; ; 		xor	r5,r5
(2)  158/FFFFFFFFC0000010 :                     ; ; 		mov	#20,r2
(2)  159/FFFFFFFFC0000010 :                     ; ; .x_next:
(2)  160/FFFFFFFFC0000010 :                     ; ; 	rept 8
(2)  161/FFFFFFFFC0000010 :                     ; ; 		cmp/ge	r6,r7
(2)  162/FFFFFFFFC0000010 :                     ; ; 		bf	.lowr
(2)  163/FFFFFFFFC0000010 :                     ; ; 		sub	r6,r7
(2)  164/FFFFFFFFC0000010 :                     ; ; .lowr:
(2)  165/FFFFFFFFC0000010 :                     ; ; 		mov	r7,r1
(2)  166/FFFFFFFFC0000010 :                     ; ; 		shlr16	r1
(2)  167/FFFFFFFFC0000010 :                     ; ; 		mov	#-2,r0
(2)  168/FFFFFFFFC0000010 :                     ; ; 		and	r0,r1
(2)  169/FFFFFFFFC0000010 :                     ; ; 		add	r8,r1
(2)  170/FFFFFFFFC0000010 :                     ; ;
(2)  171/FFFFFFFFC0000010 :                     ; ; ; 		mov.b	@r1,r0
(2)  172/FFFFFFFFC0000010 :                     ; ; ; 		and	#$FF,r0
(2)  173/FFFFFFFFC0000010 :                     ; ; ; 		mov	r0,r5
(2)  174/FFFFFFFFC0000010 :                     ; ; ; 		shll8	r5
(2)  175/FFFFFFFFC0000010 :                     ; ; ; 		or	r0,r5
(2)  176/FFFFFFFFC0000010 :                     ; ; ; 		shll8	r5
(2)  177/FFFFFFFFC0000010 :                     ; ; ; 		or	r0,r5
(2)  178/FFFFFFFFC0000010 :                     ; ; ; 		shll8	r5
(2)  179/FFFFFFFFC0000010 :                     ; ; ; 		or	r0,r5
(2)  180/FFFFFFFFC0000010 :                     ; ; ; 		mov	r5,@r9
(2)  181/FFFFFFFFC0000010 :                     ; ; 		mov.w	@r1,r0
(2)  182/FFFFFFFFC0000010 :                     ; ; 		mov.w	r0,@r9
(2)  183/FFFFFFFFC0000010 :                     ; ; 		add	#2,r9
(2)  184/FFFFFFFFC0000010 :                     ; ; 		add	r4,r7
(2)  185/FFFFFFFFC0000010 :                     ; ; 	endm
(2)  186/FFFFFFFFC0000010 :                     ; ; 		dt	r2
(2)  187/FFFFFFFFC0000010 :                     ; ; 		bt	.x_ex
(2)  188/FFFFFFFFC0000010 :                     ; ; 		bra	.x_next
(2)  189/FFFFFFFFC0000010 :                     ; ; 		nop
(2)  190/FFFFFFFFC0000010 :                     ; ; .x_ex:
(2)  191/FFFFFFFFC0000010 :                     ; ; 		mov	#$200,r1
(2)  192/FFFFFFFFC0000010 :                     ; ; 		mov	@(marsGbl_Bg_FbCurrR,gbr),r0
(2)  193/FFFFFFFFC0000010 :                     ; ; 		add	r1,r0
(2)  194/FFFFFFFFC0000010 :                     ; ; 		mov	r0,@(marsGbl_Bg_FbCurrR,gbr)
(2)  195/FFFFFFFFC0000010 :                     ; ;
(2)  196/FFFFFFFFC0000010 :                     ; ; 		mov.w	@(marsGbl_BgHeight,gbr),r0
(2)  197/FFFFFFFFC0000010 :                     ; ; 		mov	r0,r3
(2)  198/FFFFFFFFC0000010 :                     ; ; 		shll16	r3
(2)  199/FFFFFFFFC0000010 :                     ; ; 		mov	#Cach_Yadd,r2
(2)  200/FFFFFFFFC0000010 :                     ; ; 		mov	@r2,r2
(2)  201/FFFFFFFFC0000010 :                     ; ; ; 		shll	r2
(2)  202/FFFFFFFFC0000010 :                     ; ; 		mov	#Cach_Ycurr,r1
(2)  203/FFFFFFFFC0000010 :                     ; ; 		mov	@r1,r0
(2)  204/FFFFFFFFC0000010 :                     ; ; 		add	r2,r0
(2)  205/FFFFFFFFC0000010 :                     ; ; 		cmp/ge	r3,r0
(2)  206/FFFFFFFFC0000010 :                     ; ; 		bf	.ylarge
(2)  207/FFFFFFFFC0000010 :                     ; ; 		sub	r3,r0
(2)  208/FFFFFFFFC0000010 :                     ; ; .ylarge:
(2)  209/FFFFFFFFC0000010 :                     ; ; 		mov	r0,@r1
(2)  210/FFFFFFFFC0000010 :                     ; ; 		bra	dtsk01_exit
(2)  211/FFFFFFFFC0000010 :                     ; ; 		nop
(2)  212/FFFFFFFFC0000010 :                     ; ; 		align 4
(2)  213/FFFFFFFFC0000010 :                     ; ;
(2)  214/FFFFFFFFC0000010 :                     ; ; dtsk01_exit:
(2)  215/FFFFFFFFC0000010 :                     ;
(2)  216/FFFFFFFFC0000010 :                     ; ; --------------------------------
(2)  217/FFFFFFFFC0000010 :                     ; ; Task $02
(2)  218/FFFFFFFFC0000010 :                     ; ; --------------------------------
(2)  219/FFFFFFFFC0000010 :                     ;
(2)  220/FFFFFFFFC0000010 :                     ; ; TODO: a "not using polygons" flag.
(2)  221/FFFFFFFFC0000010 :                     ;
(2)  222/FFFFFFFFC0000010 :                     ; ; enters-and-exits until marsGbl_PzListCntr != 0
(2)  223/FFFFFFFFC0000010 :                     ; drwtsk_02:
(2)  224/FFFFFFFFC0000010 :                     ; 		mov	r2,@-r15
(2)  225/FFFFFFFFC0000010 :                     ; 		mov.w	@(marsGbl_WdDrwPause,gbr),r0
(2)  226/FFFFFFFFC0000010 :                     ; 		cmp/eq	#1,r0
(2)  227/FFFFFFFFC0000010 :                     ; 		bt	.exit
(2)  228/FFFFFFFFC0000010 :                     ; 		mov.w	@(marsGbl_PzListCntr,gbr),r0	; Any pieces to draw?
(2)  229/FFFFFFFFC0000010 :                     ; 		cmp/pl	r0
(2)  230/FFFFFFFFC0000010 :                     ; 		bt	.has_pz
(2)  231/FFFFFFFFC0000010 :                     ; 		mov	#0,r0
(2)  232/FFFFFFFFC0000010 :                     ; 		mov.w	r0,@(marsGbl_WdDrwTask,gbr)
(2)  233/FFFFFFFFC0000010 :                     ; .exit:		bra	drwtask_exit
(2)  234/FFFFFFFFC0000010 :                     ; 		mov	#$10,r2
(2)  235/FFFFFFFFC0000010 :                     ; .has_pz:
(2)  236/FFFFFFFFC0000010 :                     ; 		mov	r3,@-r15			; Save all these regs
(2)  237/FFFFFFFFC0000010 :                     ; 		mov	r4,@-r15
(2)  238/FFFFFFFFC0000010 :                     ; 		mov	r5,@-r15
(2)  239/FFFFFFFFC0000010 :                     ; 		mov	r6,@-r15
(2)  240/FFFFFFFFC0000010 :                     ; 		mov	r7,@-r15
(2)  241/FFFFFFFFC0000010 :                     ; 		mov	r8,@-r15
(2)  242/FFFFFFFFC0000010 :                     ; 		mov	r9,@-r15
(2)  243/FFFFFFFFC0000010 :                     ; 		mov	r10,@-r15
(2)  244/FFFFFFFFC0000010 :                     ; 		mov	r11,@-r15
(2)  245/FFFFFFFFC0000010 :                     ; 		mov	r12,@-r15
(2)  246/FFFFFFFFC0000010 :                     ; 		mov	r13,@-r15
(2)  247/FFFFFFFFC0000010 :                     ; 		mov	r14,@-r15
(2)  248/FFFFFFFFC0000010 :                     ; 		sts	macl,@-r15
(2)  249/FFFFFFFFC0000010 :                     ; 		sts	mach,@-r15
(2)  250/FFFFFFFFC0000010 :                     ;
(2)  251/FFFFFFFFC0000010 :                     ; ; Piece loop
(2)  252/FFFFFFFFC0000010 :                     ; drwtsk02_newpz:
(2)  253/FFFFFFFFC0000010 :                     ; 		mov	@(marsGbl_PlyPzList_R,gbr),r0	; r14 - Current pieces pointer to READ
(2)  254/FFFFFFFFC0000010 :                     ; 		mov	r0,r14
(2)  255/FFFFFFFFC0000010 :                     ; 		mov	@(plypz_ypos,r14),r9		; Grab StartY/EndY positions
(2)  256/FFFFFFFFC0000010 :                     ; 		mov	r9,r10
(2)  257/FFFFFFFFC0000010 :                     ; 		mov	#$FFFF,r0
(2)  258/FFFFFFFFC0000010 :                     ; 		shlr16	r9
(2)  259/FFFFFFFFC0000010 :                     ; 		exts	r9,r9				;  r9 - Top
(2)  260/FFFFFFFFC0000010 :                     ; 		and	r0,r10				; r10 - Bottom
(2)  261/FFFFFFFFC0000010 :                     ; 		cmp/eq	r9,r0				; if Top==Bottom, exit
(2)  262/FFFFFFFFC0000010 :                     ; 		bt	.invld_y
(2)  263/FFFFFFFFC0000010 :                     ; 		mov	#SCREEN_HEIGHT,r0		; if Top > 224, exit
(2)  264/FFFFFFFFC0000010 :                     ; 		cmp/ge	r0,r9
(2)  265/FFFFFFFFC0000010 :                     ; 		bt	.invld_y			; if Bottom > 224, add limit
(2)  266/FFFFFFFFC0000010 :                     ; 		cmp/gt	r0,r10
(2)  267/FFFFFFFFC0000010 :                     ; 		bf	.len_max
(2)  268/FFFFFFFFC0000010 :                     ; 		mov	r0,r10
(2)  269/FFFFFFFFC0000010 :                     ; .len_max:
(2)  270/FFFFFFFFC0000010 :                     ; 		sub	r9,r10				; Turn r10 into line length (Bottom - Top)
(2)  271/FFFFFFFFC0000010 :                     ; 		cmp/pl	r10
(2)  272/FFFFFFFFC0000010 :                     ; 		bt	drwtsk1_vld_y
(2)  273/FFFFFFFFC0000010 :                     ; .invld_y:
(2)  274/FFFFFFFFC0000010 :                     ; 		bra	drwsld_nextpz			; if LEN < 0 then check next one instead.
(2)  275/FFFFFFFFC0000010 :                     ; 		nop
(2)  276/FFFFFFFFC0000010 :                     ; 		align 4
(2)  277/FFFFFFFFC0000010 :                     ; 		ltorg
(2)  278/FFFFFFFFC0000010 :                     ;
(2)  279/FFFFFFFFC0000010 :                     ; ; ------------------------------------
(2)  280/FFFFFFFFC0000010 :                     ; ; If Y top / Y len are valid:
(2)  281/FFFFFFFFC0000010 :                     ; ; ------------------------------------
(2)  282/FFFFFFFFC0000010 :                     ;
(2)  283/FFFFFFFFC0000010 :                     ; drwtsk1_vld_y:
(2)  284/FFFFFFFFC0000010 :                     ; 		mov	@(plypz_xl,r14),r1		; r1 - X left
(2)  285/FFFFFFFFC0000010 :                     ; 		mov	@(plypz_xl_dx,r14),r2		; r2 - DX left
(2)  286/FFFFFFFFC0000010 :                     ; 		mov	@(plypz_xr,r14),r3		; r3 - X right
(2)  287/FFFFFFFFC0000010 :                     ; 		mov	@(plypz_xr_dx,r14),r4		; r4 - DX right
(2)  288/FFFFFFFFC0000010 :                     ; 		mov	@(plypz_type,r14),r0		; Check material options
(2)  289/FFFFFFFFC0000010 :                     ; 		shlr16	r0
(2)  290/FFFFFFFFC0000010 :                     ; 		shlr8	r0
(2)  291/FFFFFFFFC0000010 :                     ;  		tst	#PLGN_TEXURE,r0			; Texture-enable bit?
(2)  292/FFFFFFFFC0000010 :                     ;  		bf	drwtsk_texmode
(2)  293/FFFFFFFFC0000010 :                     ; 		bra	drwtsk_solidmode
(2)  294/FFFFFFFFC0000010 :                     ; 		nop
(2)  295/FFFFFFFFC0000010 :                     ;
(2)  296/FFFFFFFFC0000010 :                     ; ; ------------------------------------
(2)  297/FFFFFFFFC0000010 :                     ; ; Texture mode
(2)  298/FFFFFFFFC0000010 :                     ; ;
(2)  299/FFFFFFFFC0000010 :                     ; ; r1  - XL
(2)  300/FFFFFFFFC0000010 :                     ; ; r2  - XL DX
(2)  301/FFFFFFFFC0000010 :                     ; ; r3  - XR
(2)  302/FFFFFFFFC0000010 :                     ; ; r4  - XR DX
(2)  303/FFFFFFFFC0000010 :                     ; ; r5  - SRC XL
(2)  304/FFFFFFFFC0000010 :                     ; ; r6  - SRC XR
(2)  305/FFFFFFFFC0000010 :                     ; ; r7  - SRC YL
(2)  306/FFFFFFFFC0000010 :                     ; ; r8  - SRC YR
(2)  307/FFFFFFFFC0000010 :                     ; ; r9  - Y current
(2)  308/FFFFFFFFC0000010 :                     ; ; r10  - Number of lines
(2)  309/FFFFFFFFC0000010 :                     ; ; ------------------------------------
(2)  310/FFFFFFFFC0000010 :                     ;
(2)  311/FFFFFFFFC0000010 :                     ; go_drwsld_updline_tex:
(2)  312/FFFFFFFFC0000010 :                     ; 		bra	drwsld_updline_tex
(2)  313/FFFFFFFFC0000010 :                     ; 		nop
(2)  314/FFFFFFFFC0000010 :                     ;
(2)  315/FFFFFFFFC0000010 :                     ; go_drwtex_gonxtpz:
(2)  316/FFFFFFFFC0000010 :                     ; 		bra	drwtex_gonxtpz
(2)  317/FFFFFFFFC0000010 :                     ; 		nop
(2)  318/FFFFFFFFC0000010 :                     ;
(2)  319/FFFFFFFFC0000010 :                     ; drwtsk_texmode:
(2)  320/FFFFFFFFC0000010 :                     ; 		mov.w	@(marsGbl_DivStop_M,gbr),r0	; Waste interrupt if MarsVideo_MakePolygon is in the
(2)  321/FFFFFFFFC0000010 :                     ; 		cmp/eq	#1,r0				; middle of HW-division
(2)  322/FFFFFFFFC0000010 :                     ; 		bf	.texvalid
(2)  323/FFFFFFFFC0000010 :                     ; 		bra	drwtask_return
(2)  324/FFFFFFFFC0000010 :                     ; 		nop
(2)  325/FFFFFFFFC0000010 :                     ; 		align 4
(2)  326/FFFFFFFFC0000010 :                     ; .texvalid:
(2)  327/FFFFFFFFC0000010 :                     ; 		mov	@(plypz_src_xl,r14),r5		; Texture X left
(2)  328/FFFFFFFFC0000010 :                     ; 		mov	@(plypz_src_xr,r14),r6		; Texture X right
(2)  329/FFFFFFFFC0000010 :                     ; 		mov	@(plypz_src_yl,r14),r7		; Texture Y up
(2)  330/FFFFFFFFC0000010 :                     ; 		mov	@(plypz_src_yr,r14),r8		; Texture Y down
(2)  331/FFFFFFFFC0000010 :                     ;
(2)  332/FFFFFFFFC0000010 :                     ; drwsld_nxtline_tex:
(2)  333/FFFFFFFFC0000010 :                     ; 		cmp/pz	r9				; Y Start below 0?
(2)  334/FFFFFFFFC0000010 :                     ; 		bf	go_drwsld_updline_tex
(2)  335/FFFFFFFFC0000010 :                     ; 		mov	#SCREEN_HEIGHT,r0		; Y Start after 224?
(2)  336/FFFFFFFFC0000010 :                     ; 		cmp/ge	r0,r9
(2)  337/FFFFFFFFC0000010 :                     ; 		bt	go_drwtex_gonxtpz
(2)  338/FFFFFFFFC0000010 :                     ; 		mov	r1,@-r15
(2)  339/FFFFFFFFC0000010 :                     ; 		mov	r2,@-r15
(2)  340/FFFFFFFFC0000010 :                     ; 		mov	r4,@-r15
(2)  341/FFFFFFFFC0000010 :                     ; 		mov	r5,@-r15
(2)  342/FFFFFFFFC0000010 :                     ; 		mov	r6,@-r15
(2)  343/FFFFFFFFC0000010 :                     ; 		mov	r7,@-r15
(2)  344/FFFFFFFFC0000010 :                     ; 		mov	r8,@-r15
(2)  345/FFFFFFFFC0000010 :                     ; 		mov	r9,@-r15
(2)  346/FFFFFFFFC0000010 :                     ; 		mov	r10,@-r15
(2)  347/FFFFFFFFC0000010 :                     ; 		mov	r13,@-r15
(2)  348/FFFFFFFFC0000010 :                     ; 		mov	r1,r11			; r11 - X left copy
(2)  349/FFFFFFFFC0000010 :                     ; 		mov	r3,r12			; r12 - X right copy
(2)  350/FFFFFFFFC0000010 :                     ; 		shlr16	r11
(2)  351/FFFFFFFFC0000010 :                     ; 		shlr16	r12
(2)  352/FFFFFFFFC0000010 :                     ; 		exts	r11,r11
(2)  353/FFFFFFFFC0000010 :                     ; 		exts	r12,r12
(2)  354/FFFFFFFFC0000010 :                     ; 		mov	r12,r0			; r0: X Right - X Left
(2)  355/FFFFFFFFC0000010 :                     ; 		sub	r11,r0
(2)  356/FFFFFFFFC0000010 :                     ; 		cmp/pl	r0			; Line reversed?
(2)  357/FFFFFFFFC0000010 :                     ; 		bt	.txrevers
(2)  358/FFFFFFFFC0000010 :                     ; 		mov	r12,r0			; Swap XL and XR values
(2)  359/FFFFFFFFC0000010 :                     ; 		mov	r11,r12
(2)  360/FFFFFFFFC0000010 :                     ; 		mov	r0,r11
(2)  361/FFFFFFFFC0000010 :                     ; 		mov	r5,r0
(2)  362/FFFFFFFFC0000010 :                     ; 		mov	r6,r5
(2)  363/FFFFFFFFC0000010 :                     ; 		mov	r0,r6
(2)  364/FFFFFFFFC0000010 :                     ; 		mov	r7,r0
(2)  365/FFFFFFFFC0000010 :                     ; 		mov	r8,r7
(2)  366/FFFFFFFFC0000010 :                     ; 		mov	r0,r8
(2)  367/FFFFFFFFC0000010 :                     ; .txrevers:
(2)  368/FFFFFFFFC0000010 :                     ; 		cmp/eq	r11,r12			; Same X position?
(2)  369/FFFFFFFFC0000010 :                     ; 		bt	.tex_skip_line
(2)  370/FFFFFFFFC0000010 :                     ; 		mov	#SCREEN_WIDTH,r0	; X right < 0?
(2)  371/FFFFFFFFC0000010 :                     ; 		cmp/pl	r12
(2)  372/FFFFFFFFC0000010 :                     ; 		bf	.tex_skip_line
(2)  373/FFFFFFFFC0000010 :                     ; 		cmp/gt	r0,r11			; X left > 320?
(2)  374/FFFFFFFFC0000010 :                     ; 		bt	.tex_skip_line
(2)  375/FFFFFFFFC0000010 :                     ; 		mov	r12,r2
(2)  376/FFFFFFFFC0000010 :                     ; 		mov 	r11,r0
(2)  377/FFFFFFFFC0000010 :                     ; 		sub 	r0,r2
(2)  378/FFFFFFFFC0000010 :                     ; 		sub	r5,r6
(2)  379/FFFFFFFFC0000010 :                     ; 		sub	r7,r8
(2)  380/FFFFFFFFC0000010 :                     ;
(2)  381/FFFFFFFFC0000010 :                     ; 	; Calculate new DX values
(2)  382/FFFFFFFFC0000010 :                     ; 	; make sure DIV is available
(2)  383/FFFFFFFFC0000010 :                     ; 	; (marsGbl_DivStop_M == 0)
(2)  384/FFFFFFFFC0000010 :                     ; 		mov	#_JR,r0		; r6 / r2
(2)  385/FFFFFFFFC0000010 :                     ; 		mov	r2,@r0
(2)  386/FFFFFFFFC0000010 :                     ; 		mov	r6,@(4,r0)
(2)  387/FFFFFFFFC0000010 :                     ; 		nop
(2)  388/FFFFFFFFC0000010 :                     ; 		mov	@(4,r0),r6		; r8 / r2
(2)  389/FFFFFFFFC0000010 :                     ; 		mov	r2,@r0
(2)  390/FFFFFFFFC0000010 :                     ; 		mov	r8,@(4,r0)
(2)  391/FFFFFFFFC0000010 :                     ; 		nop
(2)  392/FFFFFFFFC0000010 :                     ; 		mov	@(4,r0),r8
(2)  393/FFFFFFFFC0000010 :                     ;
(2)  394/FFFFFFFFC0000010 :                     ; 	; Limit X destination points
(2)  395/FFFFFFFFC0000010 :                     ; 	; and correct the texture's X positions
(2)  396/FFFFFFFFC0000010 :                     ; 		mov	#SCREEN_WIDTH,r0		; XR point > 320?
(2)  397/FFFFFFFFC0000010 :                     ; 		cmp/gt	r0,r12
(2)  398/FFFFFFFFC0000010 :                     ; 		bf	.tr_fix
(2)  399/FFFFFFFFC0000010 :                     ; 		mov	r0,r12			; Force XR to 320
(2)  400/FFFFFFFFC0000010 :                     ; .tr_fix:
(2)  401/FFFFFFFFC0000010 :                     ; 		cmp/pl	r11			; XL point < 0?
(2)  402/FFFFFFFFC0000010 :                     ; 		bt	.tl_fix
(2)  403/FFFFFFFFC0000010 :                     ; 		neg	r11,r2			; Fix texture positions
(2)  404/FFFFFFFFC0000010 :                     ; 		dmuls	r6,r2
(2)  405/FFFFFFFFC0000010 :                     ; 		sts	macl,r0
(2)  406/FFFFFFFFC0000010 :                     ; 		add	r0,r5
(2)  407/FFFFFFFFC0000010 :                     ; 		dmuls	r8,r2
(2)  408/FFFFFFFFC0000010 :                     ; 		sts	macl,r0
(2)  409/FFFFFFFFC0000010 :                     ; 		add	r0,r7
(2)  410/FFFFFFFFC0000010 :                     ; 		xor	r11,r11			; And reset XL to 0
(2)  411/FFFFFFFFC0000010 :                     ; .tl_fix:
(2)  412/FFFFFFFFC0000010 :                     ; ; 		mov	#-2,r0
(2)  413/FFFFFFFFC0000010 :                     ; ; 		and	r0,r11
(2)  414/FFFFFFFFC0000010 :                     ; ; 		and	r0,r12
(2)  415/FFFFFFFFC0000010 :                     ;
(2)  416/FFFFFFFFC0000010 :                     ; 	; X right - X left
(2)  417/FFFFFFFFC0000010 :                     ; 		sub 	r11,r12
(2)  418/FFFFFFFFC0000010 :                     ; ; 		shar	r12
(2)  419/FFFFFFFFC0000010 :                     ; ; 		shar	r12
(2)  420/FFFFFFFFC0000010 :                     ; 		cmp/pl	r12
(2)  421/FFFFFFFFC0000010 :                     ; 		bf	.tex_skip_line
(2)  422/FFFFFFFFC0000010 :                     ; ; 		mov	#$20,r0			; (Limiter test)
(2)  423/FFFFFFFFC0000010 :                     ; ; 		cmp/ge	r0,r12
(2)  424/FFFFFFFFC0000010 :                     ; ; 		bf	.testlwrit
(2)  425/FFFFFFFFC0000010 :                     ; ; 		mov	r0,r12
(2)  426/FFFFFFFFC0000010 :                     ; ; .testlwrit:
(2)  427/FFFFFFFFC0000010 :                     ;
(2)  428/FFFFFFFFC0000010 :                     ; 	; Mode 1
(2)  429/FFFFFFFFC0000010 :                     ; 		mov.w	@(marsGbl_CurrGfxMode,gbr),r0
(2)  430/FFFFFFFFC0000010 :                     ; 		and	#$7F,r0
(2)  431/FFFFFFFFC0000010 :                     ; 		cmp/eq	#1,r0
(2)  432/FFFFFFFFC0000010 :                     ; 		bf	.not_m1
(2)  433/FFFFFFFFC0000010 :                     ; 		mov.w	@(marsGbl_Bg_YFbPos_U,gbr),r0
(2)  434/FFFFFFFFC0000010 :                     ; 		mov	#MSCRL_WIDTH,r10
(2)  435/FFFFFFFFC0000010 :                     ; 		mulu	r10,r0
(2)  436/FFFFFFFFC0000010 :                     ; 		sts	macl,r10
(2)  437/FFFFFFFFC0000010 :                     ; 		mov	@(marsGbl_Bg_FbBase,gbr),r0
(2)  438/FFFFFFFFC0000010 :                     ; 		add	r10,r0
(2)  439/FFFFFFFFC0000010 :                     ; ; 		mov	#-4,r10
(2)  440/FFFFFFFFC0000010 :                     ; ; 		and	r10,r0
(2)  441/FFFFFFFFC0000010 :                     ; 		mov	r0,r10
(2)  442/FFFFFFFFC0000010 :                     ; 		mov	#MSCRL_WIDTH*MSCRL_HEIGHT,r0
(2)  443/FFFFFFFFC0000010 :                     ; 		cmp/ge	r0,r10
(2)  444/FFFFFFFFC0000010 :                     ; 		bf	.fbbaset
(2)  445/FFFFFFFFC0000010 :                     ; 		sub	r0,r10
(2)  446/FFFFFFFFC0000010 :                     ; .fbbaset:
(2)  447/FFFFFFFFC0000010 :                     ; 	if MSCRL_WIDTH=256
(2)  448/FFFFFFFFC0000010 :                     ; 		shll8	r9
(2)  449/FFFFFFFFC0000010 :                     ; 		shll	r9
(2)  450/FFFFFFFFC0000010 :                     ; 	else
(2)  451/FFFFFFFFC0000010 :                     ; 		mov	#MSCRL_WIDTH,r0
(2)  452/FFFFFFFFC0000010 :                     ; 		muls	r9,r0
(2)  453/FFFFFFFFC0000010 :                     ; 		sts	macl,r9
(2)  454/FFFFFFFFC0000010 :                     ; 	endif
(2)  455/FFFFFFFFC0000010 :                     ; 		add	r9,r10
(2)  456/FFFFFFFFC0000010 :                     ; 		add 	r11,r10				; Add X
(2)  457/FFFFFFFFC0000010 :                     ; 		mov	#(MSCRL_WIDTH*MSCRL_HEIGHT),r0
(2)  458/FFFFFFFFC0000010 :                     ; 		cmp/ge	r0,r10
(2)  459/FFFFFFFFC0000010 :                     ; 		bf	.xl_r
(2)  460/FFFFFFFFC0000010 :                     ; 		sub	r0,r10
(2)  461/FFFFFFFFC0000010 :                     ; .xl_r:
(2)  462/FFFFFFFFC0000010 :                     ; 		cmp/pz	r10
(2)  463/FFFFFFFFC0000010 :                     ; 		bt	.xl_l
(2)  464/FFFFFFFFC0000010 :                     ; 		add	r0,r10
(2)  465/FFFFFFFFC0000010 :                     ; .xl_l:
(2)  466/FFFFFFFFC0000010 :                     ; 		bra	.c_m1
(2)  467/FFFFFFFFC0000010 :                     ; 		nop
(2)  468/FFFFFFFFC0000010 :                     ;
(2)  469/FFFFFFFFC0000010 :                     ; 	; Mode 0 and 2
(2)  470/FFFFFFFFC0000010 :                     ; .not_m1:
(2)  471/FFFFFFFFC0000010 :                     ; 		mov	r11,r10
(2)  472/FFFFFFFFC0000010 :                     ; 		shll8	r9
(2)  473/FFFFFFFFC0000010 :                     ; 		shll	r9
(2)  474/FFFFFFFFC0000010 :                     ; 		add	r9,r10
(2)  475/FFFFFFFFC0000010 :                     ; .c_m1:
(2)  476/FFFFFFFFC0000010 :                     ;
(2)  477/FFFFFFFFC0000010 :                     ; 	; r10 - Framebuff base
(2)  478/FFFFFFFFC0000010 :                     ; 		mov	#_overwrite+$200,r0
(2)  479/FFFFFFFFC0000010 :                     ; 		add	r0,r10
(2)  480/FFFFFFFFC0000010 :                     ; 		mov	#$1FFF,r2
(2)  481/FFFFFFFFC0000010 :                     ; 		mov	#$FF,r0
(2)  482/FFFFFFFFC0000010 :                     ; 		mov	@(plypz_mtrl,r14),r11		; r11 - texture data
(2)  483/FFFFFFFFC0000010 :                     ; 		mov	@(plypz_type,r14),r4		;  r4 - texture palinc|width
(2)  484/FFFFFFFFC0000010 :                     ; 		mov	r4,r13
(2)  485/FFFFFFFFC0000010 :                     ; 		shlr16	r13
(2)  486/FFFFFFFFC0000010 :                     ; 		and	r0,r13
(2)  487/FFFFFFFFC0000010 :                     ;
(2)  488/FFFFFFFFC0000010 :                     ; 	; r5 - X curr
(2)  489/FFFFFFFFC0000010 :                     ; 	; r6 - X inc
(2)  490/FFFFFFFFC0000010 :                     ; 	; r7 - Y Curr
(2)  491/FFFFFFFFC0000010 :                     ; 	; r8 - Y add
(2)  492/FFFFFFFFC0000010 :                     ; .tex_xloop:
(2)  493/FFFFFFFFC0000010 :                     ; 		mov	r7,r2
(2)  494/FFFFFFFFC0000010 :                     ; 		shlr16	r2
(2)  495/FFFFFFFFC0000010 :                     ; 		muls	r2,r4
(2)  496/FFFFFFFFC0000010 :                     ; 		mov	r5,r2	   			; Build column index
(2)  497/FFFFFFFFC0000010 :                     ; 		add	r6,r5				; Update X
(2)  498/FFFFFFFFC0000010 :                     ; 		add	r8,r7				; Update Y
(2)  499/FFFFFFFFC0000010 :                     ; 		sts	macl,r0
(2)  500/FFFFFFFFC0000010 :                     ; 		shlr16	r2
(2)  501/FFFFFFFFC0000010 :                     ; 		add	r2,r0
(2)  502/FFFFFFFFC0000010 :                     ; 		mov.b	@(r0,r11),r0			; Read pixel
(2)  503/FFFFFFFFC0000010 :                     ; 		add	r13,r0
(2)  504/FFFFFFFFC0000010 :                     ; 		and	#$FF,r0
(2)  505/FFFFFFFFC0000010 :                     ; 		mov.b	r0,@r10	   			; Write pixels
(2)  506/FFFFFFFFC0000010 :                     ; 		dt	r12
(2)  507/FFFFFFFFC0000010 :                     ; 		bf/s	.tex_xloop
(2)  508/FFFFFFFFC0000010 :                     ; 		add 	#1,r10
(2)  509/FFFFFFFFC0000010 :                     ;
(2)  510/FFFFFFFFC0000010 :                     ; .tex_skip_line:
(2)  511/FFFFFFFFC0000010 :                     ; 		mov	@r15+,r13
(2)  512/FFFFFFFFC0000010 :                     ; 		mov	@r15+,r10
(2)  513/FFFFFFFFC0000010 :                     ; 		mov	@r15+,r9
(2)  514/FFFFFFFFC0000010 :                     ; 		mov	@r15+,r8
(2)  515/FFFFFFFFC0000010 :                     ; 		mov	@r15+,r7
(2)  516/FFFFFFFFC0000010 :                     ; 		mov	@r15+,r6
(2)  517/FFFFFFFFC0000010 :                     ; 		mov	@r15+,r5
(2)  518/FFFFFFFFC0000010 :                     ; 		mov	@r15+,r4
(2)  519/FFFFFFFFC0000010 :                     ; 		mov	@r15+,r2
(2)  520/FFFFFFFFC0000010 :                     ; 		mov	@r15+,r1
(2)  521/FFFFFFFFC0000010 :                     ; drwsld_updline_tex:
(2)  522/FFFFFFFFC0000010 :                     ; 		mov	@(plypz_src_xl_dx,r14),r0	; Update DX postions
(2)  523/FFFFFFFFC0000010 :                     ; 		add	r0,r5
(2)  524/FFFFFFFFC0000010 :                     ; 		mov	@(plypz_src_xr_dx,r14),r0
(2)  525/FFFFFFFFC0000010 :                     ; 		add	r0,r6
(2)  526/FFFFFFFFC0000010 :                     ; 		mov	@(plypz_src_yl_dx,r14),r0
(2)  527/FFFFFFFFC0000010 :                     ; 		add	r0,r7
(2)  528/FFFFFFFFC0000010 :                     ; 		mov	@(plypz_src_yr_dx,r14),r0
(2)  529/FFFFFFFFC0000010 :                     ; 		add	r0,r8
(2)  530/FFFFFFFFC0000010 :                     ; 		add	r2,r1				; Update X postions
(2)  531/FFFFFFFFC0000010 :                     ; 		dt	r10
(2)  532/FFFFFFFFC0000010 :                     ; 		bt/s	drwtex_gonxtpz
(2)  533/FFFFFFFFC0000010 :                     ; 		add	r4,r3
(2)  534/FFFFFFFFC0000010 :                     ; 		bra	drwsld_nxtline_tex
(2)  535/FFFFFFFFC0000010 :                     ; 		add	#1,r9
(2)  536/FFFFFFFFC0000010 :                     ; drwtex_gonxtpz:
(2)  537/FFFFFFFFC0000010 :                     ; 		bra	drwsld_nextpz			; if LEN < 0 then check next one instead.
(2)  538/FFFFFFFFC0000010 :                     ; 		nop
(2)  539/FFFFFFFFC0000010 :                     ; 		align 4
(2)  540/FFFFFFFFC0000010 :                     ; 		ltorg
(2)  541/FFFFFFFFC0000010 :                     ;
(2)  542/FFFFFFFFC0000010 :                     ; ; ------------------------------------
(2)  543/FFFFFFFFC0000010 :                     ; ; Solid Color
(2)  544/FFFFFFFFC0000010 :                     ; ;
(2)  545/FFFFFFFFC0000010 :                     ; ; r1  - XL
(2)  546/FFFFFFFFC0000010 :                     ; ; r2  - XL DX
(2)  547/FFFFFFFFC0000010 :                     ; ; r3  - XR
(2)  548/FFFFFFFFC0000010 :                     ; ; r4  - XR DX
(2)  549/FFFFFFFFC0000010 :                     ; ; r9  - Y current
(2)  550/FFFFFFFFC0000010 :                     ; ; r10  - Number of lines
(2)  551/FFFFFFFFC0000010 :                     ; ; ------------------------------------
(2)  552/FFFFFFFFC0000010 :                     ;
(2)  553/FFFFFFFFC0000010 :                     ; ; BUG: Not working anymore because
(2)  554/FFFFFFFFC0000010 :                     ; ; of the scrolling system.
(2)  555/FFFFFFFFC0000010 :                     ;
(2)  556/FFFFFFFFC0000010 :                     ; drwtsk_solidmode:
(2)  557/FFFFFFFFC0000010 :                     ; 		mov	#$FF,r0
(2)  558/FFFFFFFFC0000010 :                     ; 		mov	@(plypz_mtrl,r14),r6
(2)  559/FFFFFFFFC0000010 :                     ; 		mov	@(plypz_type,r14),r5
(2)  560/FFFFFFFFC0000010 :                     ; 		and	r0,r5
(2)  561/FFFFFFFFC0000010 :                     ; 		and	r0,r6
(2)  562/FFFFFFFFC0000010 :                     ; 		add	r5,r6
(2)  563/FFFFFFFFC0000010 :                     ; 		mov	#_vdpreg,r13
(2)  564/FFFFFFFFC0000010 :                     ; .wait:		mov.w	@(10,r13),r0
(2)  565/FFFFFFFFC0000010 :                     ; 		tst	#2,r0
(2)  566/FFFFFFFFC0000010 :                     ; 		bf	.wait
(2)  567/FFFFFFFFC0000010 :                     ; drwsld_nxtline:
(2)  568/FFFFFFFFC0000010 :                     ; 		mov	r9,r0
(2)  569/FFFFFFFFC0000010 :                     ; 		add	r10,r0
(2)  570/FFFFFFFFC0000010 :                     ; 		cmp/pl	r0
(2)  571/FFFFFFFFC0000010 :                     ; 		bf	drwsld_nextpz
(2)  572/FFFFFFFFC0000010 :                     ; 		cmp/pz	r9
(2)  573/FFFFFFFFC0000010 :                     ; 		bf	drwsld_updline
(2)  574/FFFFFFFFC0000010 :                     ; 		mov	#SCREEN_HEIGHT,r0
(2)  575/FFFFFFFFC0000010 :                     ; 		cmp/gt	r0,r9
(2)  576/FFFFFFFFC0000010 :                     ; 		bt	drwsld_nextpz
(2)  577/FFFFFFFFC0000010 :                     ;
(2)  578/FFFFFFFFC0000010 :                     ; 		mov	r1,r11
(2)  579/FFFFFFFFC0000010 :                     ; 		mov	r3,r12
(2)  580/FFFFFFFFC0000010 :                     ; 		shlr16	r11
(2)  581/FFFFFFFFC0000010 :                     ; 		shlr16	r12
(2)  582/FFFFFFFFC0000010 :                     ; 		exts	r11,r11
(2)  583/FFFFFFFFC0000010 :                     ; 		exts	r12,r12
(2)  584/FFFFFFFFC0000010 :                     ; 		mov	r12,r0
(2)  585/FFFFFFFFC0000010 :                     ; 		sub	r11,r0
(2)  586/FFFFFFFFC0000010 :                     ; 		cmp/pz	r0
(2)  587/FFFFFFFFC0000010 :                     ; 		bt	.revers
(2)  588/FFFFFFFFC0000010 :                     ; 		mov	r12,r0
(2)  589/FFFFFFFFC0000010 :                     ; 		mov	r11,r12
(2)  590/FFFFFFFFC0000010 :                     ; 		mov	r0,r11
(2)  591/FFFFFFFFC0000010 :                     ; .revers:
(2)  592/FFFFFFFFC0000010 :                     ; 		mov	#SCREEN_WIDTH-2,r0
(2)  593/FFFFFFFFC0000010 :                     ; 		cmp/pl	r12
(2)  594/FFFFFFFFC0000010 :                     ; 		bf	drwsld_updline
(2)  595/FFFFFFFFC0000010 :                     ; 		cmp/gt	r0,r11
(2)  596/FFFFFFFFC0000010 :                     ; 		bt	drwsld_updline
(2)  597/FFFFFFFFC0000010 :                     ; 		cmp/gt	r0,r12
(2)  598/FFFFFFFFC0000010 :                     ; 		bf	.r_fix
(2)  599/FFFFFFFFC0000010 :                     ; 		mov	r0,r12
(2)  600/FFFFFFFFC0000010 :                     ; .r_fix:
(2)  601/FFFFFFFFC0000010 :                     ; 		cmp/pl	r11
(2)  602/FFFFFFFFC0000010 :                     ; 		bt	.l_fix
(2)  603/FFFFFFFFC0000010 :                     ; 		xor	r11,r11
(2)  604/FFFFFFFFC0000010 :                     ; .l_fix:
(2)  605/FFFFFFFFC0000010 :                     ; 		mov	#-2,r0
(2)  606/FFFFFFFFC0000010 :                     ; 		and	r0,r11
(2)  607/FFFFFFFFC0000010 :                     ; 		and	r0,r12
(2)  608/FFFFFFFFC0000010 :                     ; 		mov	r12,r0
(2)  609/FFFFFFFFC0000010 :                     ; 		sub	r11,r0
(2)  610/FFFFFFFFC0000010 :                     ; 		cmp/pl	r0
(2)  611/FFFFFFFFC0000010 :                     ; 		bf	drwsld_updline
(2)  612/FFFFFFFFC0000010 :                     ; .wait:		mov.w	@(10,r13),r0
(2)  613/FFFFFFFFC0000010 :                     ; 		tst	#2,r0
(2)  614/FFFFFFFFC0000010 :                     ; 		bf	.wait
(2)  615/FFFFFFFFC0000010 :                     ; 		mov	r12,r0
(2)  616/FFFFFFFFC0000010 :                     ; 		sub	r11,r0
(2)  617/FFFFFFFFC0000010 :                     ; 		mov	r0,r12
(2)  618/FFFFFFFFC0000010 :                     ; 		shlr	r0
(2)  619/FFFFFFFFC0000010 :                     ; 		mov.w	r0,@(4,r13)	; length
(2)  620/FFFFFFFFC0000010 :                     ; 		mov	r11,r0
(2)  621/FFFFFFFFC0000010 :                     ; 		shlr	r0
(2)  622/FFFFFFFFC0000010 :                     ; 		mov	r9,r5
(2)  623/FFFFFFFFC0000010 :                     ; 		add	#1,r5
(2)  624/FFFFFFFFC0000010 :                     ; 		shll8	r5
(2)  625/FFFFFFFFC0000010 :                     ; 		add	r5,r0
(2)  626/FFFFFFFFC0000010 :                     ; 		mov.w	r0,@(6,r13)	; address
(2)  627/FFFFFFFFC0000010 :                     ; 		mov	r6,r0
(2)  628/FFFFFFFFC0000010 :                     ; 		shll8	r0
(2)  629/FFFFFFFFC0000010 :                     ; 		or	r6,r0
(2)  630/FFFFFFFFC0000010 :                     ; 		mov.w	r0,@(8,r13)	; Set data
(2)  631/FFFFFFFFC0000010 :                     ; ; .wait:		mov.w	@(10,r13),r0
(2)  632/FFFFFFFFC0000010 :                     ; ; 		tst	#2,r0
(2)  633/FFFFFFFFC0000010 :                     ; ; 		bf	.wait
(2)  634/FFFFFFFFC0000010 :                     ;
(2)  635/FFFFFFFFC0000010 :                     ; ; 	If the line is too large, leave it to VDP
(2)  636/FFFFFFFFC0000010 :                     ; ; 	and exit watchdog, we will come back on
(2)  637/FFFFFFFFC0000010 :                     ; ; 	next trigger.
(2)  638/FFFFFFFFC0000010 :                     ; 		mov	#$28,r0
(2)  639/FFFFFFFFC0000010 :                     ; 		cmp/gt	r0,r12
(2)  640/FFFFFFFFC0000010 :                     ; 		bf	drwsld_updline
(2)  641/FFFFFFFFC0000010 :                     ; 		mov	#3,r0
(2)  642/FFFFFFFFC0000010 :                     ; 		mov.w	r0,@(marsGbl_WdDrwTask,gbr)
(2)  643/FFFFFFFFC0000010 :                     ; 		mov	#Cach_LnDrw_S,r0
(2)  644/FFFFFFFFC0000010 :                     ; 		mov	r1,@-r0
(2)  645/FFFFFFFFC0000010 :                     ; 		mov	r2,@-r0
(2)  646/FFFFFFFFC0000010 :                     ; 		mov	r3,@-r0
(2)  647/FFFFFFFFC0000010 :                     ; 		mov	r4,@-r0
(2)  648/FFFFFFFFC0000010 :                     ; 		mov	r5,@-r0
(2)  649/FFFFFFFFC0000010 :                     ; 		mov	r6,@-r0
(2)  650/FFFFFFFFC0000010 :                     ; 		mov	r7,@-r0
(2)  651/FFFFFFFFC0000010 :                     ; 		mov	r8,@-r0
(2)  652/FFFFFFFFC0000010 :                     ; 		mov	r9,@-r0
(2)  653/FFFFFFFFC0000010 :                     ; 		mov	r10,@-r0
(2)  654/FFFFFFFFC0000010 :                     ; 		mov	r11,@-r0
(2)  655/FFFFFFFFC0000010 :                     ; 		mov	r12,@-r0
(2)  656/FFFFFFFFC0000010 :                     ; 		mov	r13,@-r0
(2)  657/FFFFFFFFC0000010 :                     ; 		mov	r14,@-r0
(2)  658/FFFFFFFFC0000010 :                     ; 		bra	drwtask_return
(2)  659/FFFFFFFFC0000010 :                     ; 		mov	#$10,r2			; Exit and re-enter
(2)  660/FFFFFFFFC0000010 :                     ; drwsld_updline:
(2)  661/FFFFFFFFC0000010 :                     ; 		add	r2,r1
(2)  662/FFFFFFFFC0000010 :                     ; 		add	r4,r3
(2)  663/FFFFFFFFC0000010 :                     ; 		dt	r10
(2)  664/FFFFFFFFC0000010 :                     ; 		bf/s	drwsld_nxtline
(2)  665/FFFFFFFFC0000010 :                     ; 		add	#1,r9
(2)  666/FFFFFFFFC0000010 :                     ;
(2)  667/FFFFFFFFC0000010 :                     ; ; ------------------------------------
(2)  668/FFFFFFFFC0000010 :                     ;
(2)  669/FFFFFFFFC0000010 :                     ; drwsld_nextpz:
(2)  670/FFFFFFFFC0000010 :                     ; 		add	#sizeof_plypz,r14		; And set new point
(2)  671/FFFFFFFFC0000010 :                     ; 		mov	r14,r0
(2)  672/FFFFFFFFC0000010 :                     ; 		mov	#RAM_Mars_VdpDrwList_e,r14	; End-of-list?
(2)  673/FFFFFFFFC0000010 :                     ; 		cmp/ge	r14,r0
(2)  674/FFFFFFFFC0000010 :                     ; 		bf	.reset_rd
(2)  675/FFFFFFFFC0000010 :                     ; 		mov	#RAM_Mars_VdpDrwList,r0
(2)  676/FFFFFFFFC0000010 :                     ; .reset_rd:
(2)  677/FFFFFFFFC0000010 :                     ; 		mov	r0,@(marsGbl_PlyPzList_R,gbr)
(2)  678/FFFFFFFFC0000010 :                     ; 		mov.w	@(marsGbl_PzListCntr,gbr),r0	; Decrement piece
(2)  679/FFFFFFFFC0000010 :                     ; 		add	#-1,r0
(2)  680/FFFFFFFFC0000010 :                     ; 		mov.w	r0,@(marsGbl_PzListCntr,gbr)
(2)  681/FFFFFFFFC0000010 :                     ; 		cmp/pl	r0
(2)  682/FFFFFFFFC0000010 :                     ; 		bt	.activ
(2)  683/FFFFFFFFC0000010 :                     ; ; 		bf	.finish_it
(2)  684/FFFFFFFFC0000010 :                     ; ; 		bra	drwtsk02_newpz2
(2)  685/FFFFFFFFC0000010 :                     ; ; 		nop
(2)  686/FFFFFFFFC0000010 :                     ; .finish_it:
(2)  687/FFFFFFFFC0000010 :                     ; 		mov	#0,r0
(2)  688/FFFFFFFFC0000010 :                     ; 		mov.w	r0,@(marsGbl_WdDrwTask,gbr)
(2)  689/FFFFFFFFC0000010 :                     ; .activ:
(2)  690/FFFFFFFFC0000010 :                     ; 		bra	drwtask_return
(2)  691/FFFFFFFFC0000010 :                     ; 		mov	#$10,r2			; Timer for next watchdog
(2)  692/FFFFFFFFC0000010 :                     ;
(2)  693/FFFFFFFFC0000010 :                     ; ; --------------------------------
(2)  694/FFFFFFFFC0000010 :                     ; ; Task $00
(2)  695/FFFFFFFFC0000010 :                     ; ; --------------------------------
(2)  696/FFFFFFFFC0000010 :                     ;
(2)  697/FFFFFFFFC0000010 :                     ; drwtsk_00:
(2)  698/FFFFFFFFC0000010 :                     ; 		mov	r2,@-r15
(2)  699/FFFFFFFFC0000010 :                     ; 		mov	#0,r0
(2)  700/FFFFFFFFC0000010 :                     ; 		mov.w	r0,@(marsGbl_WdDrwTask,gbr)
(2)  701/FFFFFFFFC0000010 :                     ; 		bra	drwtask_exit
(2)  702/FFFFFFFFC0000010 :                     ; 		mov	#$10,r2
(2)  703/FFFFFFFFC0000010 :                     ;
(2)  704/FFFFFFFFC0000010 :                     ; ; --------------------------------
(2)  705/FFFFFFFFC0000010 :                     ;
(2)  706/FFFFFFFFC0000010 :                     ; drwtask_return:
(2)  707/FFFFFFFFC0000010 :                     ; 		lds	@r15+,mach
(2)  708/FFFFFFFFC0000010 :                     ; 		lds	@r15+,macl
(2)  709/FFFFFFFFC0000010 :                     ; 		mov	@r15+,r14
(2)  710/FFFFFFFFC0000010 :                     ; 		mov	@r15+,r13
(2)  711/FFFFFFFFC0000010 :                     ; 		mov	@r15+,r12
(2)  712/FFFFFFFFC0000010 :                     ; 		mov	@r15+,r11
(2)  713/FFFFFFFFC0000010 :                     ; 		mov	@r15+,r10
(2)  714/FFFFFFFFC0000010 :                     ; 		mov	@r15+,r9
(2)  715/FFFFFFFFC0000010 :                     ; 		mov	@r15+,r8
(2)  716/FFFFFFFFC0000010 :                     ; 		mov	@r15+,r7
(2)  717/FFFFFFFFC0000010 :                     ; 		mov	@r15+,r6
(2)  718/FFFFFFFFC0000010 :                     ; 		mov	@r15+,r5
(2)  719/FFFFFFFFC0000010 :                     ; 		mov	@r15+,r4
(2)  720/FFFFFFFFC0000010 :                     ; 		mov	@r15+,r3
(2)  721/FFFFFFFFC0000010 :                     ; drwtask_exit:
(2)  722/FFFFFFFFC0000010 :                     ; 		mov.l   #$FFFFFE80,r1
(2)  723/FFFFFFFFC0000010 :                     ; 		mov.w   #$A518,r0	; OFF
(2)  724/FFFFFFFFC0000010 :                     ; 		mov.w   r0,@r1
(2)  725/FFFFFFFFC0000010 :                     ; 		or      #$20,r0		; ON
(2)  726/FFFFFFFFC0000010 :                     ; 		mov.w   r0,@r1
(2)  727/FFFFFFFFC0000010 :                     ; 		mov.w   #$5A00,r0	; r2 - Timer
(2)  728/FFFFFFFFC0000010 :                     ; 		or	r2,r0
(2)  729/FFFFFFFFC0000010 :                     ; 		mov.w   r0,@r1
(2)  730/FFFFFFFFC0000010 :                     ; 		mov	@r15+,r2
(2)  731/FFFFFFFFC0000010 :                     ; 		rts
(2)  732/FFFFFFFFC0000010 :                     ; 		nop
(2)  733/FFFFFFFFC0000010 :                     ; 		align 4
(2)  734/FFFFFFFFC0000010 :                     ; 		ltorg
(2)  735/FFFFFFFFC0000010 :                     ;
(2)  736/FFFFFFFFC0000010 :                     ; ; ; --------------------------------
(2)  737/FFFFFFFFC0000010 :                     ; ; ; Task $03
(2)  738/FFFFFFFFC0000010 :                     ; ; ; --------------------------------
(2)  739/FFFFFFFFC0000010 :                     ; ;
(2)  740/FFFFFFFFC0000010 :                     ; ; drwtsk_03:
(2)  741/FFFFFFFFC0000010 :                     ; ; 		mov	r2,@-r15
(2)  742/FFFFFFFFC0000010 :                     ; ; 		mov.w	@(marsGbl_WdDrwPause,gbr),r0
(2)  743/FFFFFFFFC0000010 :                     ; ; 		cmp/eq	#1,r0
(2)  744/FFFFFFFFC0000010 :                     ; ; 		bt	.exit
(2)  745/FFFFFFFFC0000010 :                     ; ; 		mov	r3,@-r15
(2)  746/FFFFFFFFC0000010 :                     ; ; 		mov	r4,@-r15
(2)  747/FFFFFFFFC0000010 :                     ; ; 		mov	r5,@-r15
(2)  748/FFFFFFFFC0000010 :                     ; ; 		mov	r6,@-r15
(2)  749/FFFFFFFFC0000010 :                     ; ; 		mov	r7,@-r15
(2)  750/FFFFFFFFC0000010 :                     ; ; 		mov	r8,@-r15
(2)  751/FFFFFFFFC0000010 :                     ; ; 		mov	r9,@-r15
(2)  752/FFFFFFFFC0000010 :                     ; ; 		mov	r10,@-r15
(2)  753/FFFFFFFFC0000010 :                     ; ; 		mov	r11,@-r15
(2)  754/FFFFFFFFC0000010 :                     ; ; 		mov	r12,@-r15
(2)  755/FFFFFFFFC0000010 :                     ; ; 		mov	r13,@-r15
(2)  756/FFFFFFFFC0000010 :                     ; ; 		mov	r14,@-r15
(2)  757/FFFFFFFFC0000010 :                     ; ; 		sts	macl,@-r15
(2)  758/FFFFFFFFC0000010 :                     ; ; 		sts	mach,@-r15
(2)  759/FFFFFFFFC0000010 :                     ; ; 		mov	#Cach_LnDrw_L,r0
(2)  760/FFFFFFFFC0000010 :                     ; ; 		mov	@r0+,r14
(2)  761/FFFFFFFFC0000010 :                     ; ; 		mov	@r0+,r13
(2)  762/FFFFFFFFC0000010 :                     ; ; 		mov	@r0+,r12
(2)  763/FFFFFFFFC0000010 :                     ; ; 		mov	@r0+,r11
(2)  764/FFFFFFFFC0000010 :                     ; ; 		mov	@r0+,r10
(2)  765/FFFFFFFFC0000010 :                     ; ; 		mov	@r0+,r9
(2)  766/FFFFFFFFC0000010 :                     ; ; 		mov	@r0+,r8
(2)  767/FFFFFFFFC0000010 :                     ; ; 		mov	@r0+,r7
(2)  768/FFFFFFFFC0000010 :                     ; ; 		mov	@r0+,r6
(2)  769/FFFFFFFFC0000010 :                     ; ; 		mov	@r0+,r5
(2)  770/FFFFFFFFC0000010 :                     ; ; 		mov	@r0+,r4
(2)  771/FFFFFFFFC0000010 :                     ; ; 		mov	@r0+,r3
(2)  772/FFFFFFFFC0000010 :                     ; ; 		mov	@r0+,r2
(2)  773/FFFFFFFFC0000010 :                     ; ; 		mov	@r0+,r1
(2)  774/FFFFFFFFC0000010 :                     ; ; 		mov	#1,r0
(2)  775/FFFFFFFFC0000010 :                     ; ; 		mov.w	r0,@(marsGbl_WdDrwTask,gbr)
(2)  776/FFFFFFFFC0000010 :                     ; ; 		bra	drwsld_updline
(2)  777/FFFFFFFFC0000010 :                     ; ; 		nop
(2)  778/FFFFFFFFC0000010 :                     ; ; .exit:		bra	drwtask_exit
(2)  779/FFFFFFFFC0000010 :                     ; ; 		mov	#$10,r2
(2)  780/FFFFFFFFC0000010 :                     ; ; 		align 4
(2)  781/FFFFFFFFC0000010 :                     ;
(2)  782/FFFFFFFFC0000010 :                     ; ; ------------------------------------------------
(2)  783/FFFFFFFFC0000010 :                     ;
(2)  784/FFFFFFFFC0000010 :                     		align 4
(2)  785/FFFFFFFFC0000010 :                     Cach_XHead_L	ds.l 1			; Left draw beam
(2)  786/FFFFFFFFC0000014 :                     Cach_XHead_R	ds.l 1			; Right draw beam
(2)  787/FFFFFFFFC0000018 :                     Cach_YHead_D	ds.l 1			; Bottom draw beam
(2)  788/FFFFFFFFC000001C :                     Cach_YHead_U	ds.l 1			; Top draw beam
(2)  789/FFFFFFFFC0000020 :                     Cach_BgFbPos_U	ds.l 1			; Upper Y FB pos
(2)  790/FFFFFFFFC0000024 :                     Cach_BgFbPos_D	ds.l 1			; Lower Y FB pos
(2)  791/FFFFFFFFC0000028 :                     Cach_BgFbPos_LR	ds.l 1			; Left/Right FB pos
(2)  792/FFFFFFFFC000002C :                     ; Cach_LR_Lines	ds.l 1			; (L/R) X Lines to process
(2)  793/FFFFFFFFC000002C :                     
(2)  794/FFFFFFFFC000002C :                     Cach_Md2_Lines	ds.l 1
(2)  795/FFFFFFFFC0000030 :                     Cach_DDA_Top	ds.l 2*2		; First 2 points
(2)  796/FFFFFFFFC0000040 :                     Cach_DDA_Last	ds.l 2*2		; Triangle or Quad (+8)
(2)  797/FFFFFFFFC0000050 :                     Cach_DDA_Src	ds.l 4*2
(2)  798/FFFFFFFFC0000070 :                     Cach_DDA_Src_L	ds.l 4			; X/DX/Y/DX positions for textures
(2)  799/FFFFFFFFC0000080 :                     Cach_DDA_Src_R	ds.l 4
(2)  800/FFFFFFFFC0000090 :                     Cach_LnDrw_L	ds.l 14			; Own stack: Read foward (-->)
(2)  801/FFFFFFFFC00000C8 :                     Cach_LnDrw_S	ds.l 0			; Read this backwards (<--)
(2)  802/FFFFFFFFC00000C8 :                     
(2)  803/FFFFFFFFC00000C8 :                     ; ------------------------------------------------
(2)  804/ 6001348 :                     .end:		phase CACHE_MASTER+.end&$1FFF
(2)  805/ 6001348 :                     CACHE_MASTER_E:
(2)  806/ 6001348 :                     		align 4
(2)  810/ 6001348 :                     
(2)  811/ 6001348 :                     ; ====================================================================
(2)  812/ 6001348 :                     ; ----------------------------------------------------------------
(2)  813/ 6001348 :                     ; CACHE code for Slave CPU
(2)  814/ 6001348 :                     ;
(2)  815/ 6001348 :                     ; LIMIT: $800 bytes
(2)  816/ 6001348 :                     ; ----------------------------------------------------------------
(2)  817/ 6001348 :                     
(2)  818/ 6001348 :                     		align 4
(2)  819/ 6001348 :                     CACHE_SLAVE:
(2)  820/FFFFFFFFC0000000 :                     		phase $C0000000
(2)  821/FFFFFFFFC0000000 :                     ; ------------------------------------------------
(2)  822/FFFFFFFFC0000000 :                     
(2)  823/FFFFFFFFC0000000 :                     MarsSnd_PwmCache	ds.b $80*MAX_PWMCHNL
(2)  824/FFFFFFFFC0000380 :                     
(2)  825/FFFFFFFFC0000380 :                     ; ------------------------------------------------
(2)  826/FFFFFFFFC0000380 :                     ; Mars PWM playback (Runs on PWM interrupt)
(2)  827/FFFFFFFFC0000380 :                     ; r0-r10 only
(2)  828/FFFFFFFFC0000380 :                     ; ------------------------------------------------
(2)  829/FFFFFFFFC0000380 :                     
(2)  830/FFFFFFFFC0000380 :                     ; **** CRITICAL ROUTINE, MUST BE FAST ***
(2)  831/FFFFFFFFC0000380 :                     
(2)  832/FFFFFFFFC0000380 :                     MarsSound_ReadPwm:
(2)  833/FFFFFFFFC0000380 : 2F26                		mov	r2,@-r15
(2)  834/FFFFFFFFC0000382 : 2F36                		mov	r3,@-r15
(2)  835/FFFFFFFFC0000384 : 2F46                		mov	r4,@-r15
(2)  836/FFFFFFFFC0000386 : 2F56                		mov	r5,@-r15
(2)  837/FFFFFFFFC0000388 : 2F66                		mov	r6,@-r15
(2)  838/FFFFFFFFC000038A : 2F76                		mov	r7,@-r15
(2)  839/FFFFFFFFC000038C : 2F86                		mov	r8,@-r15
(2)  840/FFFFFFFFC000038E : 2F96                		mov	r9,@-r15
(2)  841/FFFFFFFFC0000390 : 2FA6                		mov	r10,@-r15
(2)  842/FFFFFFFFC0000392 : 4F12                		sts	macl,@-r15
(2)  843/FFFFFFFFC0000394 :                     
(2)  844/FFFFFFFFC0000394 :                     ; ------------------------------------------------
(2)  845/FFFFFFFFC0000394 :                     
(2)  846/FFFFFFFFC0000394 : DA41                		mov	#MarsSnd_PwmCache,r10
(2)  847/FFFFFFFFC0000396 : D942                		mov	#MarsSnd_PwmChnls,r9	; r9 - Channel list
(2)  848/FFFFFFFFC0000398 : E807                		mov 	#MAX_PWMCHNL,r8		; r8 - Number of channels
(2)  849/FFFFFFFFC000039A : E700                		mov 	#0,r7			; r7 - RIGHT BASE wave
(2)  850/FFFFFFFFC000039C : E600                		mov 	#0,r6			; r6 - LEFT BASE wave
(2)  851/FFFFFFFFC000039E :                     .loop:
(2)  852/FFFFFFFFC000039E : 5090                		mov	@(mchnsnd_enbl,r9),r0	; Channel enabled? (non-Zero)
(2)  853/FFFFFFFFC00003A0 : 8800                		cmp/eq	#0,r0
(2)  854/FFFFFFFFC00003A2 : 8B03                		bf	.on
(2)  855/FFFFFFFFC00003A4 :                     .silent:
(2)  856/FFFFFFFFC00003A4 : E07F                		mov	#$7F,r0
(2)  857/FFFFFFFFC00003A6 : 6203                		mov	r0,r2
(2)  858/FFFFFFFFC00003A8 : A05F                		bra	.skip
(2)  859/FFFFFFFFC00003AA : 6103                		mov	r0,r1
(2)  860/FFFFFFFFC00003AC :                     .on:
(2)  861/FFFFFFFFC00003AC : 5491                		mov 	@(mchnsnd_read,r9),r4
(2)  862/FFFFFFFFC00003AE : 6343                		mov	r4,r3
(2)  863/FFFFFFFFC00003B0 : 5095                		mov 	@(mchnsnd_end,r9),r0
(2)  864/FFFFFFFFC00003B2 : D13C                		mov	#$00FFFFFF,r1
(2)  865/FFFFFFFFC00003B4 : 4319                		shlr8	r3
(2)  866/FFFFFFFFC00003B6 : 4019                		shlr8	r0
(2)  867/FFFFFFFFC00003B8 : 2319                		and	r1,r3
(2)  868/FFFFFFFFC00003BA : 2019                		and	r1,r0
(2)  869/FFFFFFFFC00003BC : 3302                		cmp/hs	r0,r3
(2)  870/FFFFFFFFC00003BE : 8B0D                		bf	.read
(2)  871/FFFFFFFFC00003C0 : 5098                		mov 	@(mchnsnd_flags,r9),r0
(2)  872/FFFFFFFFC00003C2 : C804                		tst	#%00000100,r0
(2)  873/FFFFFFFFC00003C4 : 8B03                		bf	.loop_me
(2)  874/FFFFFFFFC00003C6 : E000                		mov 	#0,r0
(2)  875/FFFFFFFFC00003C8 : 1900                		mov 	r0,@(mchnsnd_enbl,r9)
(2)  876/FFFFFFFFC00003CA :                     ; 		mov	@(mchnsnd_start,r9),r0
(2)  877/FFFFFFFFC00003CA :                     ; 		mov	r0,@(mchnsnd_start,r9)
(2)  878/FFFFFFFFC00003CA : AFEB                		bra	.silent
(2)  879/FFFFFFFFC00003CC : 0009                		nop
(2)  880/FFFFFFFFC00003CE :                     .loop_me:
(2)  881/FFFFFFFFC00003CE : 5098                		mov 	@(mchnsnd_flags,r9),r0
(2)  882/FFFFFFFFC00003D0 : 5196                		mov	@(mchnsnd_loop,r9),r1
(2)  883/FFFFFFFFC00003D2 : 5494                		mov 	@(mchnsnd_start,r9),r4
(2)  884/FFFFFFFFC00003D4 : C808                		tst	#%00001000,r0
(2)  885/FFFFFFFFC00003D6 : 8900                		bt	.mono_l
(2)  886/FFFFFFFFC00003D8 : 4100                		shll	r1
(2)  887/FFFFFFFFC00003DA :                     .mono_l:
(2)  888/FFFFFFFFC00003DA : 341C                		add	r1,r4
(2)  889/FFFFFFFFC00003DC :                     
(2)  890/FFFFFFFFC00003DC :                     ; read wave
(2)  891/FFFFFFFFC00003DC :                     ; r4 - WAVE READ pointer
(2)  892/FFFFFFFFC00003DC :                     .read:
(2)  893/FFFFFFFFC00003DC : 5597                		mov 	@(mchnsnd_pitch,r9),r5	; Check if sample is on ROM
(2)  894/FFFFFFFFC00003DE : 5293                		mov 	@(mchnsnd_bank,r9),r2
(2)  895/FFFFFFFFC00003E0 : D031                		mov	#CS1,r0
(2)  896/FFFFFFFFC00003E2 : 3200                		cmp/eq	r0,r2
(2)  897/FFFFFFFFC00003E4 : 8B11                		bf	.not_rom
(2)  898/FFFFFFFFC00003E6 : D131                		mov	#MarsSnd_RvMode,r1
(2)  899/FFFFFFFFC00003E8 : 6012                		mov	@r1,r0
(2)  900/FFFFFFFFC00003EA : 8801                		cmp/eq	#1,r0
(2)  901/FFFFFFFFC00003EC : 8B0D                		bf	.not_rom
(2)  902/FFFFFFFFC00003EE :                     
(2)  903/FFFFFFFFC00003EE :                     	; r1 - left WAV
(2)  904/FFFFFFFFC00003EE :                     	; r3 - right WAV
(2)  905/FFFFFFFFC00003EE :                     	; r4 - original READ point
(2)  906/FFFFFFFFC00003EE :                     	; r5 - Pitch
(2)  907/FFFFFFFFC00003EE : 5098                		mov 	@(mchnsnd_flags,r9),r0
(2)  908/FFFFFFFFC00003F0 : 6153                		mov	r5,r1
(2)  909/FFFFFFFFC00003F2 : C808                		tst	#%00001000,r0
(2)  910/FFFFFFFFC00003F4 : 8900                		bt	.mono_c
(2)  911/FFFFFFFFC00003F6 : 4100                		shll	r1
(2)  912/FFFFFFFFC00003F8 :                     .mono_c:
(2)  913/FFFFFFFFC00003F8 : 5292                		mov	@(mchnsnd_cchread,r9),r2
(2)  914/FFFFFFFFC00003FA : 4219                		shlr8	r2
(2)  915/FFFFFFFFC00003FC : E17F                		mov	#$7F,r1
(2)  916/FFFFFFFFC00003FE : 2219                		and	r1,r2
(2)  917/FFFFFFFFC0000400 : 32AC                		add	r10,r2
(2)  918/FFFFFFFFC0000402 : 6124                		mov.b	@r2+,r1
(2)  919/FFFFFFFFC0000404 : 6324                		mov.b	@r2+,r3			; null in MONO samples
(2)  920/FFFFFFFFC0000406 : A00B                		bra	.from_rv
(2)  921/FFFFFFFFC0000408 : 0009                		nop
(2)  922/FFFFFFFFC000040A :                     
(2)  923/FFFFFFFFC000040A :                     ; Play as normal
(2)  924/FFFFFFFFC000040A :                     ; r0 - flags
(2)  925/FFFFFFFFC000040A :                     ; r4 - READ pointer
(2)  926/FFFFFFFFC000040A :                     .not_rom:
(2)  927/FFFFFFFFC000040A :                     ; 		mov	#_sysreg+comm15,r0	; *** TESTING
(2)  928/FFFFFFFFC000040A :                     ; 		mov.w	@r0,r0
(2)  929/FFFFFFFFC000040A :                     ; 		and	#%00010000,r0
(2)  930/FFFFFFFFC000040A :                     ; 		tst	r0,r0
(2)  931/FFFFFFFFC000040A :                     ; 		bf	*
(2)  932/FFFFFFFFC000040A :                     ; 		mov	#_sysreg+dreqctl,r0
(2)  933/FFFFFFFFC000040A :                     ; 		mov.w	@r0,r0
(2)  934/FFFFFFFFC000040A :                     ; 		tst	#$01,r0
(2)  935/FFFFFFFFC000040A :                     ; 		bf	*			; *** TESTING
(2)  936/FFFFFFFFC000040A :                     
(2)  937/FFFFFFFFC000040A : 5098                		mov 	@(mchnsnd_flags,r9),r0
(2)  938/FFFFFFFFC000040C : 6343                		mov 	r4,r3
(2)  939/FFFFFFFFC000040E : 4319                		shlr8	r3
(2)  940/FFFFFFFFC0000410 : D124                		mov	#$00FFFFFF,r1
(2)  941/FFFFFFFFC0000412 : C808                		tst	#%00001000,r0
(2)  942/FFFFFFFFC0000414 : 8900                		bt	.mono_a
(2)  943/FFFFFFFFC0000416 : 71FF                		add	#-1,r1
(2)  944/FFFFFFFFC0000418 :                     .mono_a:
(2)  945/FFFFFFFFC0000418 : 2319                		and	r1,r3
(2)  946/FFFFFFFFC000041A : 232B                		or	r2,r3
(2)  947/FFFFFFFFC000041C : 6134                		mov.b	@r3+,r1
(2)  948/FFFFFFFFC000041E : 6334                		mov.b	@r3+,r3
(2)  949/FFFFFFFFC0000420 :                     ; 		mov	#$7F,r2
(2)  950/FFFFFFFFC0000420 :                     ; 		cmp/eq	r2,r1
(2)  951/FFFFFFFFC0000420 :                     ; 		bt	*
(2)  952/FFFFFFFFC0000420 :                     .from_rv:
(2)  953/FFFFFFFFC0000420 : 6213                		mov	r1,r2
(2)  954/FFFFFFFFC0000422 : C808                		tst	#%00001000,r0
(2)  955/FFFFFFFFC0000424 : 8901                		bt	.mono
(2)  956/FFFFFFFFC0000426 : 6233                		mov	r3,r2
(2)  957/FFFFFFFFC0000428 : 4500                		shll	r5
(2)  958/FFFFFFFFC000042A :                     .mono:
(2)  959/FFFFFFFFC000042A : 345C                		add	r5,r4
(2)  960/FFFFFFFFC000042C : 1941                		mov	r4,@(mchnsnd_read,r9)
(2)  961/FFFFFFFFC000042E : 5392                		mov	@(mchnsnd_cchread,r9),r3
(2)  962/FFFFFFFFC0000430 : 335C                		add	r5,r3
(2)  963/FFFFFFFFC0000432 : 1932                		mov	r3,@(mchnsnd_cchread,r9)
(2)  964/FFFFFFFFC0000434 : 9336                		mov	#$FF,r3
(2)  965/FFFFFFFFC0000436 : 2139                		and	r3,r1
(2)  966/FFFFFFFFC0000438 : 2239                		and	r3,r2
(2)  967/FFFFFFFFC000043A : C802                		tst	#%00000010,r0	; LEFT enabled?
(2)  968/FFFFFFFFC000043C : 8B00                		bf	.no_l
(2)  969/FFFFFFFFC000043E : E17F                		mov	#$7F,r1		; Force LEFT off
(2)  970/FFFFFFFFC0000440 :                     .no_l:
(2)  971/FFFFFFFFC0000440 : C801                		tst	#%00000001,r0	; RIGHT enabled?
(2)  972/FFFFFFFFC0000442 : 8B00                		bf	.no_r
(2)  973/FFFFFFFFC0000444 : E27F                		mov	#$7F,r2		; Force RIGHT off
(2)  974/FFFFFFFFC0000446 :                     .no_r:
(2)  975/FFFFFFFFC0000446 : 5099                		mov	@(mchnsnd_vol,r9),r0
(2)  976/FFFFFFFFC0000448 : 4015                		cmp/pl	r0
(2)  977/FFFFFFFFC000044A : 8B0E                		bf	.skip
(2)  978/FFFFFFFFC000044C : 7001                		add	#1,r0
(2)  979/FFFFFFFFC000044E : 210E                		mulu	r0,r1
(2)  980/FFFFFFFFC0000450 : 041A                		sts	macl,r4
(2)  981/FFFFFFFFC0000452 : 4419                		shlr8	r4
(2)  982/FFFFFFFFC0000454 : 3148                		sub	r4,r1
(2)  983/FFFFFFFFC0000456 : 220E                		mulu	r0,r2
(2)  984/FFFFFFFFC0000458 : 041A                		sts	macl,r4
(2)  985/FFFFFFFFC000045A : 4419                		shlr8	r4
(2)  986/FFFFFFFFC000045C : 3248                		sub	r4,r2
(2)  987/FFFFFFFFC000045E : E47F                		mov	#$7F,r4		; align wave to pwm
(2)  988/FFFFFFFFC0000460 : 240E                		mulu	r0,r4
(2)  989/FFFFFFFFC0000462 : 041A                		sts	macl,r4
(2)  990/FFFFFFFFC0000464 : 4419                		shlr8	r4
(2)  991/FFFFFFFFC0000466 : 314C                		add	r4,r1
(2)  992/FFFFFFFFC0000468 : 324C                		add	r4,r2
(2)  993/FFFFFFFFC000046A :                     .skip:
(2)  994/FFFFFFFFC000046A : 7101                		add	#1,r1
(2)  995/FFFFFFFFC000046C : 7201                		add	#1,r2
(2)  996/FFFFFFFFC000046E : 361C                		add	r1,r6
(2)  997/FFFFFFFFC0000470 : 372C                		add	r2,r7
(2)  998/FFFFFFFFC0000472 : 9021                		mov	#$80,r0
(2)  999/FFFFFFFFC0000474 : 3A0C                		add	r0,r10
(2) 1000/FFFFFFFFC0000476 : 4810                		dt	r8
(2) 1001/FFFFFFFFC0000478 : 8F91                		bf/s	.loop
(2) 1002/FFFFFFFFC000047A : 7928                		add	#sizeof_sndchn,r9
(2) 1003/FFFFFFFFC000047C :                     
(2) 1004/FFFFFFFFC000047C :                     	; ***This check is for emus only***
(2) 1005/FFFFFFFFC000047C :                     	; It recreates what happens to the PWM
(2) 1006/FFFFFFFFC000047C :                     	; in real hardware when it overflows
(2) 1007/FFFFFFFFC000047C :                     ; 		mov	#$3FF,r0
(2) 1008/FFFFFFFFC000047C :                     ; 		cmp/gt	r0,r5
(2) 1009/FFFFFFFFC000047C :                     ; 		bf	.lmuch
(2) 1010/FFFFFFFFC000047C :                     ; 		mov	r0,r5
(2) 1011/FFFFFFFFC000047C :                     ; .lmuch:	cmp/gt	r0,r6
(2) 1012/FFFFFFFFC000047C :                     ; 		bf	.rmuch
(2) 1013/FFFFFFFFC000047C :                     ; 		mov	r0,r6
(2) 1014/FFFFFFFFC000047C :                     ; .rmuch:
(2) 1015/FFFFFFFFC000047C : D10C                		mov	#_sysreg+lchwidth,r1	; Write WAVE result
(2) 1016/FFFFFFFFC000047E : D20D                		mov	#_sysreg+rchwidth,r2
(2) 1017/FFFFFFFFC0000480 : 2161                 		mov.w	r6,@r1
(2) 1018/FFFFFFFFC0000482 : 2271                 		mov.w	r7,@r2
(2) 1019/FFFFFFFFC0000484 :                     ; 		mov	#_sysreg+monowidth,r3	; Works fine without this...
(2) 1020/FFFFFFFFC0000484 :                     ; 		mov.b	@r3,r0
(2) 1021/FFFFFFFFC0000484 :                     ; 		tst	#$80,r0
(2) 1022/FFFFFFFFC0000484 :                     ; 		bf	.retry
(2) 1023/FFFFFFFFC0000484 : 4F16                		lds	@r15+,macl
(2) 1024/FFFFFFFFC0000486 : 6AF6                		mov	@r15+,r10
(2) 1025/FFFFFFFFC0000488 : 69F6                		mov	@r15+,r9
(2) 1026/FFFFFFFFC000048A : 68F6                		mov	@r15+,r8
(2) 1027/FFFFFFFFC000048C : 67F6                		mov	@r15+,r7
(2) 1028/FFFFFFFFC000048E : 66F6                		mov	@r15+,r6
(2) 1029/FFFFFFFFC0000490 : 65F6                		mov	@r15+,r5
(2) 1030/FFFFFFFFC0000492 : 64F6                		mov	@r15+,r4
(2) 1031/FFFFFFFFC0000494 : 63F6                		mov	@r15+,r3
(2) 1032/FFFFFFFFC0000496 : 62F6                		mov	@r15+,r2
(2) 1033/FFFFFFFFC0000498 : 000B                		rts
(2) 1034/FFFFFFFFC000049A : 0009                		nop
(2) 1035/FFFFFFFFC000049C :                     		align 4
(2) 1036/FFFFFFFFC000049C : C000 0000 0600 46A8 		ltorg
                    00FF FFFF 0200 0000 
                    C000 04BC 2000 4034 
                    2000 4036 0080      
(2) 1037/FFFFFFFFC00004BA :                     
(2) 1038/FFFFFFFFC00004BA :                     ; ------------------------------------------------
(2) 1039/FFFFFFFFC00004BA :                     		align 4
(2) 1040/FFFFFFFFC00004BC :                     MarsSnd_RvMode	ds.l 1
(2) 1041/FFFFFFFFC00004C0 :                     MarsSnd_Active	ds.l 1
(2) 1042/FFFFFFFFC00004C4 :                     ; ------------------------------------------------
(2) 1043/ 600180C :                     .end:		phase CACHE_SLAVE+.end&$1FFF
(2) 1044/ 600180C :                     CACHE_SLAVE_E:
(2) 1045/ 600180C :                     		align 4
(2) 1049/ 600180C :                     
(1) 2138/ 600180C :                     
(1) 2139/ 600180C :                     ; ====================================================================
(1) 2140/ 600180C :                     ; ----------------------------------------------------------------
(1) 2141/ 600180C :                     ; Data
(1) 2142/ 600180C :                     ; ----------------------------------------------------------------
(1) 2143/ 600180C :                     
(1) 2144/ 600180C :                     		align 4
(1) 2145/ 600180C :                     sin_table	binclude "system/mars/data/sinedata.bin"
(1) 2146/ 600400C :                     		align 4
(1) 2147/ 600400C :                     		include "data/mars_sdram.asm"
(2)    1/ 600400C :                     ; ====================================================================
(2)    2/ 600400C :                     ; ----------------------------------------------------------------
(2)    3/ 600400C :                     ; SH2 SDRAM data
(2)    4/ 600400C :                     ; 
(2)    5/ 600400C :                     ; This data is stored on SDRAM, always available to use on the 32X
(2)    6/ 600400C :                     ; side and can be rewritible, but it is smaller than ROM
(2)    7/ 600400C :                     ;
(2)    8/ 600400C :                     ; Your palettes, textures, models go here
(2)    9/ 600400C :                     ; PWM samples can be used here but those take a lot of space...
(2)   10/ 600400C :                     ; use ROM (mars_rom.asm) instead, those are RV-protected on SH2
(2)   11/ 600400C :                     ; ----------------------------------------------------------------
(2)   12/ 600400C :                     
(2)   13/ 600400C :                     	align 4
(2)   14/ 600400C :                     TESTMARS_BG_PAL:
(2)   15/ 600400C :                     	binclude "data/mars/test_pal.bin"
(2)   16/ 600420C :                     	align 4
(2)   17/ 600420C :                     
(1) 2148/ 600420C :                     
(1) 2149/ 600420C :                     ; ====================================================================
(1) 2150/ 600420C :                     ; ----------------------------------------------------------------
(1) 2151/ 600420C :                     ; MARS SH2 RAM
(1) 2152/ 600420C :                     ; ----------------------------------------------------------------
(1) 2153/ 600420C :                     
(1) 2154/ 600420C :                     		align $10
(1) 2155/ 6004210 :                     SH2_RAM:
(1) 2156/ 6004210 : (MACRO)             		struct SH2_RAM
(1) 2156/ 6004210 : =$6004210           GLBL_LASTPC     set *
(1) 2156/   3EC70 :                                     dephase
(1) 2156/   3EC70 : =$3EC70             GLBL_LASTORG    set *
(1) 2156/ 6004210 :                                     phase SH2_RAM
(1) 2163/ 6004210 :                     MarsRam_System	ds.b (sizeof_marssys-MarsRam_System)
(1) 2164/ 6004430 :                     MarsRam_Video	ds.b (sizeof_marsvid-MarsRam_Video)
(1) 2165/ 60046A8 :                     MarsRam_Sound	ds.b (sizeof_marssnd-MarsRam_Sound)
(1) 2166/ 60047F8 :                     sizeof_marsram	ds.l 0
(1) 2168/ 60047F8 :                     
(1) 2169/ 60047F8 :                     .here:
(1) 2173/ 60047F8 : (MACRO)             		finish
(1) 2173/ 6004210 :                                     !org GLBL_LASTORG
(1) 2173/ 6004210 :                                     phase GLBL_LASTPC
(1) 2174/ 6004210 :                     
(1) 2175/ 6004210 :                     ; ====================================================================
(1) 2176/ 6004210 :                     ; ----------------------------------------------------------------
(1) 2177/ 6004210 :                     ; MARS Sound RAM
(1) 2178/ 6004210 :                     ; ----------------------------------------------------------------
(1) 2179/ 6004210 :                     
(1) 2180/ 6004210 : (MACRO)             			struct MarsRam_Sound
(1) 2180/ 6004210 : =$6004210           GLBL_LASTPC     set *
(1) 2180/   3EC70 :                                     dephase
(1) 2180/   3EC70 : =$3EC70             GLBL_LASTORG    set *
(1) 2180/ 60046A8 :                                     phase MARSRAM_SOUND
(1) 2181/ 60046A8 :                     MarsSnd_PwmChnls	ds.b sizeof_sndchn*MAX_PWMCHNL
(1) 2182/ 60047C0 :                     MarsSnd_PwmControl	ds.b $38	; 7 bytes per channel.
(1) 2183/ 60047F8 :                     ; MarsSnd_PwmCache	ds.b $100*MAX_PWMCHNL
(1) 2184/ 60047F8 :                     ; MarsSnd_PwmTrkData	ds.b $80*2
(1) 2185/ 60047F8 :                     ; MarsSnd_Active		ds.l 1
(1) 2186/ 60047F8 :                     sizeof_marssnd		ds.l 0
(1) 2187/ 60047F8 : (MACRO)             			finish
(1) 2187/ 60046A8 :                                     !org GLBL_LASTORG
(1) 2187/ 6004210 :                                     phase GLBL_LASTPC
(1) 2188/ 6004210 :                     
(1) 2189/ 6004210 :                     ; ====================================================================
(1) 2190/ 6004210 :                     ; ----------------------------------------------------------------
(1) 2191/ 6004210 :                     ; MARS Video RAM
(1) 2192/ 6004210 :                     ; ----------------------------------------------------------------
(1) 2193/ 6004210 :                     
(1) 2194/ 6004210 : (MACRO)             			struct MarsRam_Video
(1) 2194/ 6004210 : =$6004210           GLBL_LASTPC     set *
(1) 2194/   3EC70 :                                     dephase
(1) 2194/   3EC70 : =$3EC70             GLBL_LASTORG    set *
(1) 2194/ 6004430 :                                     phase MARSRAM_VIDEO
(1) 2195/ 6004430 :                     RAM_Mars_Palette	ds.w 256			; Indexed palette
(1) 2196/ 6004630 :                     RAM_Mars_Background	ds.w sizeof_marsbg
(1) 2197/ 60046A8 :                     
(1) 2198/ 60046A8 :                     ; RAM_Mars_ObjCamera	ds.b sizeof_camera		; Camera buffer
(1) 2199/ 60046A8 :                     ; RAM_Mars_ObjLayout	ds.b sizeof_layout		; Layout buffer
(1) 2200/ 60046A8 :                     ; RAM_Mars_Objects	ds.b sizeof_mdlobj*MAX_MODELS	; Objects list
(1) 2201/ 60046A8 :                     ; RAM_Mars_Polygons_0	ds.b sizeof_polygn*MAX_MPLGN	; Polygon list 0
(1) 2202/ 60046A8 :                     ; RAM_Mars_Polygons_1	ds.b sizeof_polygn*MAX_MPLGN	; Polygon list 1
(1) 2203/ 60046A8 :                     ; RAM_Mars_VdpDrwList	ds.b sizeof_plypz*MAX_SVDP_PZ	; Pieces list
(1) 2204/ 60046A8 :                     ; RAM_Mars_VdpDrwList_e	ds.l 0				; (end-of-list label)
(1) 2205/ 60046A8 :                     ; RAM_Mars_Plgn_ZList_0	ds.l MAX_MPLGN*2		; Z value / foward faces
(1) 2206/ 60046A8 :                     ; RAM_Mars_Plgn_ZList_1	ds.l MAX_MPLGN*2		; Z value / foward faces
(1) 2207/ 60046A8 :                     ; RAM_Mars_PlgnNum_0	ds.w 1				; Number of polygons to read, both buffers
(1) 2208/ 60046A8 :                     ; RAM_Mars_PlgnNum_1	ds.w 1				;
(1) 2209/ 60046A8 :                     sizeof_marsvid		ds.l 0
(1) 2210/ 60046A8 : (MACRO)             			finish
(1) 2210/ 6004430 :                                     !org GLBL_LASTORG
(1) 2210/ 6004210 :                                     phase GLBL_LASTPC
(1) 2211/ 6004210 :                     
(1) 2212/ 6004210 :                     ; ====================================================================
(1) 2213/ 6004210 :                     ; ----------------------------------------------------------------
(1) 2214/ 6004210 :                     ; MARS System RAM
(1) 2215/ 6004210 :                     ; ----------------------------------------------------------------
(1) 2216/ 6004210 :                     
(1) 2217/ 6004210 : (MACRO)             			struct MarsRam_System
(1) 2217/ 6004210 : =$6004210           GLBL_LASTPC     set *
(1) 2217/   3EC70 :                                     dephase
(1) 2217/   3EC70 : =$3EC70             GLBL_LASTORG    set *
(1) 2217/ 6004210 :                                     phase MARSRAM_SYSTEM
(1) 2218/ 6004210 :                     RAM_Mars_Global		ds.w sizeof_MarsGbl		; gbr values go here.
(1) 2219/ 6004230 :                     RAM_Mars_DREQ		ds.w 256			; 256 WORDS of MD communication
(1) 2220/ 6004430 :                     sizeof_marssys		ds.l 0
(1) 2221/ 6004430 : (MACRO)             			finish
(1) 2221/ 6004210 :                                     !org GLBL_LASTORG
(1) 2221/ 6004210 :                                     phase GLBL_LASTPC
(1) 2222/ 6004210 :                     
     114/ 6004210 :                     		cpu 68000
     115/ 6004210 :                     		padding off
     116/   3EC70 :                     		dephase
     117/   3EC70 :                     MARS_RAMDATA_E:
     118/   3EC70 :                     		align 4
     119/   3EC70 :                     
     120/   3EC70 :                     ; --------------------------------------------------------
     121/   3EC70 :                     ; MARS data for SH2's ROM view
     122/   3EC70 :                     ; This section will be gone if RV=1
     123/   3EC70 :                     ; --------------------------------------------------------
     124/   3EC70 :                     
     125/ 203EC70 :                     		phase CS1+*
     126/ 203EC70 :                     		align 4
     127/ 203EC70 :                     		include "data/mars_rom.asm"
(1)    1/ 203EC70 :                     ; ====================================================================
(1)    2/ 203EC70 :                     ; ----------------------------------------------------------------
(1)    3/ 203EC70 :                     ; SH2 ROM data
(1)    4/ 203EC70 :                     ;
(1)    5/ 203EC70 :                     ; If your data is too much for SDRAM, place it here.
(1)    6/ 203EC70 :                     ; BUT keep in mind that this entire section will be gone
(1)    7/ 203EC70 :                     ; if the Genesis performs DMA-to-VDP Transfers
(1)    8/ 203EC70 :                     ; which requires RV=1 (Revert ROM to original position)
(1)    9/ 203EC70 :                     ; ***EMULATORS IGNORE THIS LIMITATION***
(1)   10/ 203EC70 :                     ;
(1)   11/ 203EC70 :                     ; Only access here on these conditions:
(1)   12/ 203EC70 :                     ; - Stop all tracks that use PWM samples
(1)   13/ 203EC70 :                     ; - If you wanna keep any tracks active: set 1 to marsBlock
(1)   14/ 203EC70 :                     ;   in the Z80 driver, all tracks will continue playing
(1)   15/ 203EC70 :                     ;   only with PSG and FM instruments
(1)   16/ 203EC70 :                     ;   (TODO: check how it peforms)
(1)   17/ 203EC70 :                     ;
(1)   18/ 203EC70 :                     ; The PWM samples are safe to use with the implementation
(1)   19/ 203EC70 :                     ; of a sample-backup routine that the 68K requests before
(1)   20/ 203EC70 :                     ; doing DMA
(1)   21/ 203EC70 :                     ; ----------------------------------------------------------------
(1)   22/ 203EC70 :                     
(1)   23/ 203EC70 :                     	align 4
(1)   24/ 203EC70 :                     
(1)   25/ 203EC70 :                     ; --------------------------------------------------------
(1)   26/ 203EC70 :                     ; PWM samples
(1)   27/ 203EC70 :                     ; --------------------------------------------------------
(1)   28/ 203EC70 :                     
(1)   29/ 203EC70 :                     SmpIns_Bell_Ice:
(1)   30/ 203EC70 : (MACRO)             	gSmpl "sound/instr/smpl/bell_ice.wav",0
(1)   30/ 203EC70 :                     .start
(1)   30/ 203EC70 : 2A3B 00                     dc.b ((.end-.start)&$FF),(((.end-.start)>>8)&$FF),(((.end-.start)>>16)&$FF)     ; length
(1)   30/ 203EC73 : 0000 00                     dc.b ((0)&$FF),(((0)>>8)&$FF),(((0)>>16)&$FF)
(1)   30/ 203EC76 :                             binclude "sound/instr/smpl/bell_ice.wav",$2C     ; actual data
(1)   30/ 204279A :                     .end
(1)   30/ 204279A :                             align 4                 ; align 4 for pwm's
(1)   31/ 204279C :                     SmpIns_Brass1_Hi:
(1)   32/ 204279C : (MACRO)             	gSmpl "sound/instr/smpl/brass1_hi.wav",0
(1)   32/ 204279C :                     .start
(1)   32/ 204279C : CA7B 00                     dc.b ((.end-.start)&$FF),(((.end-.start)>>8)&$FF),(((.end-.start)>>16)&$FF)     ; length
(1)   32/ 204279F : 0000 00                     dc.b ((0)&$FF),(((0)>>8)&$FF),(((0)>>16)&$FF)
(1)   32/ 20427A2 :                             binclude "sound/instr/smpl/brass1_hi.wav",$2C     ; actual data
(1)   32/ 204A366 :                     .end
(1)   32/ 204A366 :                             align 4                 ; align 4 for pwm's
(1)   33/ 204A368 :                     SmpIns_Brass1_Low:
(1)   34/ 204A368 : (MACRO)             	gSmpl "sound/instr/smpl/brass1_low.wav",0
(1)   34/ 204A368 :                     .start
(1)   34/ 204A368 : CA7B 00                     dc.b ((.end-.start)&$FF),(((.end-.start)>>8)&$FF),(((.end-.start)>>16)&$FF)     ; length
(1)   34/ 204A36B : 0000 00                     dc.b ((0)&$FF),(((0)>>8)&$FF),(((0)>>16)&$FF)
(1)   34/ 204A36E :                             binclude "sound/instr/smpl/brass1_low.wav",$2C     ; actual data
(1)   34/ 2051F32 :                     .end
(1)   34/ 2051F32 :                             align 4                 ; align 4 for pwm's
(1)   35/ 2051F34 :                     SmpIns_Forest_1:
(1)   36/ 2051F34 : (MACRO)             	gSmpl "sound/instr/smpl/forest1.wav",0
(1)   36/ 2051F34 :                     .start
(1)   36/ 2051F34 : EC48 00                     dc.b ((.end-.start)&$FF),(((.end-.start)>>8)&$FF),(((.end-.start)>>16)&$FF)     ; length
(1)   36/ 2051F37 : 0000 00                     dc.b ((0)&$FF),(((0)>>8)&$FF),(((0)>>16)&$FF)
(1)   36/ 2051F3A :                             binclude "sound/instr/smpl/forest1.wav",$2C     ; actual data
(1)   36/ 2056820 :                     .end
(1)   36/ 2056820 :                             align 4                 ; align 4 for pwm's
(1)   37/ 2056820 :                     SmpIns_Kick_jam:
(1)   38/ 2056820 : (MACRO)             	gSmpl "sound/instr/smpl/kick_jam.wav",0
(1)   38/ 2056820 :                     .start
(1)   38/ 2056820 : CA0A 00                     dc.b ((.end-.start)&$FF),(((.end-.start)>>8)&$FF),(((.end-.start)>>16)&$FF)     ; length
(1)   38/ 2056823 : 0000 00                     dc.b ((0)&$FF),(((0)>>8)&$FF),(((0)>>16)&$FF)
(1)   38/ 2056826 :                             binclude "sound/instr/smpl/kick_jam.wav",$2C     ; actual data
(1)   38/ 20572EA :                     .end
(1)   38/ 20572EA :                             align 4                 ; align 4 for pwm's
(1)   39/ 20572EC :                     SmpIns_Snare_jam:
(1)   40/ 20572EC : (MACRO)             	gSmpl "sound/instr/smpl/snare_jam.wav",0
(1)   40/ 20572EC :                     .start
(1)   40/ 20572EC : 6A09 00                     dc.b ((.end-.start)&$FF),(((.end-.start)>>8)&$FF),(((.end-.start)>>16)&$FF)     ; length
(1)   40/ 20572EF : 0000 00                     dc.b ((0)&$FF),(((0)>>8)&$FF),(((0)>>16)&$FF)
(1)   40/ 20572F2 :                             binclude "sound/instr/smpl/snare_jam.wav",$2C     ; actual data
(1)   40/ 2057C56 :                     .end
(1)   40/ 2057C56 :                             align 4                 ; align 4 for pwm's
(1)   41/ 2057C58 :                     SmpIns_SnrTom_1:
(1)   42/ 2057C58 : (MACRO)             	gSmpl "sound/instr/smpl/snrtom_1.wav",0
(1)   42/ 2057C58 :                     .start
(1)   42/ 2057C58 : A614 00                     dc.b ((.end-.start)&$FF),(((.end-.start)>>8)&$FF),(((.end-.start)>>16)&$FF)     ; length
(1)   42/ 2057C5B : 0000 00                     dc.b ((0)&$FF),(((0)>>8)&$FF),(((0)>>16)&$FF)
(1)   42/ 2057C5E :                             binclude "sound/instr/smpl/snrtom_1.wav",$2C     ; actual data
(1)   42/ 20590FE :                     .end
(1)   42/ 20590FE :                             align 4                 ; align 4 for pwm's
(1)   43/ 2059100 :                     SmpIns_PIANO_1:
(1)   44/ 2059100 : (MACRO)             	gSmpl "sound/instr/smpl/PIANO__1.wav",0
(1)   44/ 2059100 :                     .start
(1)   44/ 2059100 : 1A47 00                     dc.b ((.end-.start)&$FF),(((.end-.start)>>8)&$FF),(((.end-.start)>>16)&$FF)     ; length
(1)   44/ 2059103 : 0000 00                     dc.b ((0)&$FF),(((0)>>8)&$FF),(((0)>>16)&$FF)
(1)   44/ 2059106 :                             binclude "sound/instr/smpl/PIANO__1.wav",$2C     ; actual data
(1)   44/ 205D81A :                     .end
(1)   44/ 205D81A :                             align 4                 ; align 4 for pwm's
(1)   45/ 205D81C :                     SmpIns_SSTR162A:
(1)   46/ 205D81C : (MACRO)             	gSmpl "sound/instr/smpl/SSTR162A.wav",0
(1)   46/ 205D81C :                     .start
(1)   46/ 205D81C : 6A27 00                     dc.b ((.end-.start)&$FF),(((.end-.start)>>8)&$FF),(((.end-.start)>>16)&$FF)     ; length
(1)   46/ 205D81F : 0000 00                     dc.b ((0)&$FF),(((0)>>8)&$FF),(((0)>>16)&$FF)
(1)   46/ 205D822 :                             binclude "sound/instr/smpl/SSTR162A.wav",$2C     ; actual data
(1)   46/ 205FF86 :                     .end
(1)   46/ 205FF86 :                             align 4                 ; align 4 for pwm's
(1)   47/ 205FF88 :                     
(1)   48/ 205FF88 :                     ; --------------------------------------------------------
(1)   49/ 205FF88 :                     ; Other
(1)   50/ 205FF88 :                     ; --------------------------------------------------------
(1)   51/ 205FF88 :                     
(1)   52/ 205FF88 :                     TESTMARS_BG:
(1)   53/ 205FF88 :                     	binclude "data/mars/test_art.bin"
(1)   54/ 206A888 :                     	align 4
(1)   55/ 206A888 :                     
     128/   6A888 :                     		dephase
     129/   6A888 :                     
     130/   6A888 :                     ; ====================================================================
     131/   6A888 :                     ; ---------------------------------------------
     132/   6A888 :                     ; End
     133/   6A888 :                     ; ---------------------------------------------
     134/   6A888 :                     		
     135/   6A888 :                     ROM_END:
     136/   6A888 :                     		align $8000
     137/   70000 :                     
 AS V1.42 Beta [Bld 118] - source file mars.asm - page 2 - 12/10/2021 18:46:49


  symbol table (* = unused):
  ------------------------

 ADAPTER :                        0 - | *ADEN :                           2 - |
 ALV :                           24 - |
*ARCHITECTURE :                                        x86_64-unknown-linux - |
*ART_BGTEST :                 38000 C | *ART_BGTEST_E :               38540 C |
 ART_EMI :                    38800 C | *ART_EMI_E :                  3AA60 C |
*ART_FGTEST :                 38540 C | *ART_FGTEST_E :               38800 C |
 ASCII_FONT :                FF0840 C |  ASCII_FONT_E :              FF1840 C |
 ASCII_PAL :                 FF0820 C | *ASCII_PAL_E :               FF0840 C |
 ATK :                            8 - | *BIGENDIAN :                      0 - |
 BITDISPENBL :                    6 - |  BITDMA :                         1 - |
 BITDMAENBL :                     4 - | *BITHINT :                        2 - |
*BITHINTENBL :                    4 - | *BITHVSTOP :                      1 - |
*BITJOYA :                        6 - | *BITJOYB :                        4 - |
*BITJOYC :                        5 - |  BITJOYDOWN :                     1 - |
 BITJOYLEFT :                     2 - | *BITJOYMODE :                     3 - |
 BITJOYRIGHT :                    3 - |  BITJOYSTART :                    7 - |
 BITJOYUP :                       0 - |  BITJOYX :                        2 - |
 BITJOYY :                        1 - |  BITJOYZ :                        0 - |
 BITMAPMD :                       1 - | *BITV30 :                         3 - |
 BITVINT :                        3 - | *BITVINTENBL :                    5 - |
*BRANCHEXT :                      0 - |  CACHE_MASTER :             6001280 C |
 CACHE_MASTER_E :           6001348 C |  CACHE_SLAVE :              6001348 C |
 CACHE_SLAVE_E :            600180C C |  CACH_BGFBPOS_D :  FFFFFFFFC0000024 C |
 CACH_BGFBPOS_LR : FFFFFFFFC0000028 C |  CACH_BGFBPOS_U :  FFFFFFFFC0000020 C |
*CACH_DDA_LAST :   FFFFFFFFC0000040 C | *CACH_DDA_SRC :    FFFFFFFFC0000050 C |
*CACH_DDA_SRC_L :  FFFFFFFFC0000070 C | *CACH_DDA_SRC_R :  FFFFFFFFC0000080 C |
*CACH_DDA_TOP :    FFFFFFFFC0000030 C | *CACH_LNDRW_L :    FFFFFFFFC0000090 C |
*CACH_LNDRW_S :    FFFFFFFFC00000C8 C |
 CACH_LNDRW_S.END :                                        FFFFFFFFC00000C8 C |
*CACH_MD2_LINES :  FFFFFFFFC000002C C |  CACH_XHEAD_L :    FFFFFFFFC0000010 C |
 CACH_XHEAD_R :    FFFFFFFFC0000014 C |  CACH_YHEAD_D :    FFFFFFFFC0000018 C |
 CACH_YHEAD_U :    FFFFFFFFC000001C C | *CART :                           1 - |
*CASESENSITIVE :                  0 - |  CHIP_ENV :                    10D5 C |
 CHIP_ENV.ATKEND :             11AA C | *CHIP_ENV.ATKZERO :            11AD C |
 CHIP_ENV.CHK2 :               11B3 C |  CHIP_ENV.CHK4 :               11E8 C |
 CHIP_ENV.CKOF :               1103 C |  CHIP_ENV.CKON :               1120 C |
 CHIP_ENV.COPYOPS :            1310 C |  CHIP_ENV.COPYOPS3 :           139E C |
 CHIP_ENV.COPY_1 :             1372 C | *CHIP_ENV.DECTMR :             11B7 C |
 CHIP_ENV.DKADD :              11D1 C |  CHIP_ENV.DKSAV :              11D9 C |
 CHIP_ENV.DKYEND :             11DE C |  CHIP_ENV.DO_VOL :             140C C |
 CHIP_ENV.ENVPROC :            117B C |  CHIP_ENV.FM_CHNL :            1297 C |
*CHIP_ENV.FM_CHNLVOL :         13CA C |  CHIP_ENV.FM_INSUPD :          135F C |
 CHIP_ENV.FM_INS_EX :          13C4 C |  CHIP_ENV.FM_KEYCUT :          132A C |
 CHIP_ENV.FM_KEYOFF :          133F C | *CHIP_ENV.FM_PANSET :          134C C |
 CHIP_ENV.FM_PANUPD :          1346 C |  CHIP_ENV.FM_VOLUPD :          13C6 C |
 CHIP_ENV.KILLENV :            11FE C |  CHIP_ENV.NEXTFM_1 :           1240 C |
 CHIP_ENV.NOMIDC :             1255 C |  CHIP_ENV.NOTFM3 :             131B C |
 CHIP_ENV.NOUPD :              122A C |  CHIP_ENV.NSKIP :              1172 C |
 CHIP_ENV.PSTEAL :             1161 C |  CHIP_ENV.REQ_DAC :            1284 C |
 CHIP_ENV.REQ_PITCH :          1291 C |  CHIP_ENV.SETHAT :             116C C |
 CHIP_ENV.TNMODE :             1156 C |  CHIP_ENV.VEDLP :              1206 C |
 CHIP_ENV.VLMUCH :             121B C |  CHIP_ENV.VLOOP :              10E0 C |
 CHIP_ENV.VMUCH :              1416 C |  CHIP_ENV.WRFREQ :             1132 C |
 CHNL_CHIP :                      0 - |  CHNL_EFFARG :                    5 - |
 CHNL_EFFID :                     4 - |  CHNL_FLAGS :                     7 - |
 CHNL_INS :                       2 - |  CHNL_NOTE :                      1 - |
 CHNL_TYPE :                      6 - |  CHNL_VOL :                       3 - |
 CMDINTCLR :                     1A - |  CMDIRQ_ON :                      2 - |
*CMDTASKMD_LOADSPAL :       6001238 C | *CMDTASKMD_SETBITMAP :      6001228 C |
 CMDTASKMD_SETBITMAP.WAIT_FB :                                      600122A C |
 COM :                            0 - |  COMM0 :                         20 - |
 COMM10 :                        2A - |  COMM12 :                        2C - |
 COMM14 :                        2E - |  COMM15 :                        2F - |
 COMM2 :                         22 - |  COMM4 :                         24 - |
 COMM6 :                         26 - |  COMM8 :                         28 - |
 COMMZFIFO :                   1EB0 C |  COMMZREAD :                     1E C |
 COMMZROMBLK :                   1C C |  COMMZROMRD :                    1D C |
 COMMZWRITE :                    1F C | *CONSTPI :        3.141592653589793 - |
 CONTROLLER_1 :    FFFFFFFFFFFFD50E - | *CONTROLLER_2 :    FFFFFFFFFFFFD514 - |
*CS0 :                            0 - |  CS1 :                      2000000 - |
 CS2 :                      4000000 - |  CS3 :                      6000000 - |
 CURRINSDATA :                 19C3 C |  CURRINSPOS :                  19C7 C |
 CURRTBLPOS :                  19C5 C |  CURRTICKBITS :                19CB C |
 CURRTRKCTRL :                 19C9 C |  CYCLE :                         32 - |
 DACCOM :                      18BC C | *DACINS_CDSNARE :             1E434 C |
 DACINS_LOWSTRING :           26308 C | *DACINS_MAGIC2 :               44CC C |
*DACINS_SAURKICK :            1FE30 C | *DACINS_SAURSNARE :           20DC4 C |
*DACINS_SNARE_GEM :           1D308 C | *DACINS_STRING1 :             21AAC C |
 DAC_FILL :                    1494 C |  DAC_FIRSTFILL :               14A2 C |
 DAC_ME :                         8 C |  DAC_OFF :                     144B C |
 DAC_ON :                      1436 C |  DAC_PLAY :                    1460 C |
 DAC_REFILL :                  14A6 C |  DAC_REFILL.DAC_OVER :         14F4 C |
 DAC_REFILL.FDF7 :             1566 C |  DAC_REFILL.FDF72 :            151F C |
 DAC_REFILL.FDFRETURN :        1569 C | *DAC_REFILL.KEEPCNTR :         14CD C |
*DATE :                  12/10/2021 - |  DDACCNTR :                    1EF3 C |
 DDACFIFOMID :                 1EF6 C |  DDACPNTR :                    1EF0 C |
*DISPENBL :                      40 - |  DKY :                            C - |
*DMAENBL :                       10 - | *DOTTEDSTRUCTS :                  0 - |
 DPLC_NICOLE :               FF23AA C |  DPLC_NICOLE.DPLC :          FF23AA C |
*DPLC_NICOLE.END :           FF2452 C |  DPLC_NICOLE.FRAME_0 :       FF23BA C |
 DPLC_NICOLE.FRAME_1 :       FF23D2 C |  DPLC_NICOLE.FRAME_2 :       FF23E8 C |
 DPLC_NICOLE.FRAME_3 :       FF23FA C |  DPLC_NICOLE.FRAME_4 :       FF240A C |
 DPLC_NICOLE.FRAME_5 :       FF241E C |  DPLC_NICOLE.FRAME_6 :       FF242C C |
 DPLC_NICOLE.FRAME_7 :       FF243E C |  DREQCTL :                        6 - |
*DREQDEST :                       C - | *DREQFIFO :                      12 - |
*DREQLEN :                       10 - | *DREQSOURCE :                     8 - |
 DRV_LOOP :                      42 C |  DRV_LOOP.CMND_0 :               EC C |
 DRV_LOOP.CMND_TRKPAUSE :       15C C |  DRV_LOOP.CMND_TRKPLAY :         F0 C |
 DRV_LOOP.CMND_TRKRESUME :      169 C |  DRV_LOOP.CMND_TRKSTOP :        14C C |
 DRV_LOOP.CMND_TRKTEMPO :       188 C |  DRV_LOOP.CMND_TRKTICKS :       176 C |
 DRV_LOOP.LIST :                 AC C |  DRV_LOOP.NEITHER :              84 C |
 DRV_LOOP.NEXT_CMD :             8B C |  DRV_LOOP.NOBEATS :              6C C |
 DRV_LOOP.NOTICKS :              5F C |  DRW_UD_EXIT :              6000B4E C |
 DTH :                           20 - |  DTL :                           1C - |
 DTSK01_LRDRAW :            6000A38 C |  DTSK01_LRDRAW.NOT_L2 :     6000A66 C |
 DTSK01_LRDRAW.PREFIX_R :   6000A4E C |  DTSK01_LRDRAW.XLINE :      6000A46 C |
 DTSK01_LRDRAW.YRES :       6000A3E C |  DWAVEBUFF :                   1B00 C |
*EMILIE_MKSPRITE :           FF1F48 C |  EMILIE_MKSPRITE.HIDEFUJI :  FF2018 C |
*EMILIE_MKSPRITE.NO_UPD :    FF2016 C | *EMILIE_MKSPRITE.NO_UPDGFX : FF1F56 C |
 EMILIE_MKSPRITE.NXT_DPZ :   FF1FF0 C |  EMILIE_MKSPRITE.NXT_PZ :    FF1F96 C |
*EMILIE_MOVE :               FF1F46 C | *EMILIE_SHOW :               FF2036 C |
 EMILIE_SHOW.SPRDATA :       FF204C C | *FALSE :                          0 - |
*FEN :                            2 - | *FILLDATA :                       8 - |
*FILLLENGTH :                     5 - | *FILLSTART :                      6 - |
 FLAGRESCHIP :                 1EF9 C |  FLG :                           28 - |
 FM :                            80 - |  FM3REG :                      18B0 C |
 FMCOM :                       179C C |  FMFREQ_LIST :                 156E C |
 FMFRQH :                        18 - |  FMFRQL :                        1E - |
*FMINS_AMBIENT_DARK :         2F1AC C | *FMINS_AMBIENT_SPOOK :        2F1CC C |
*FMINS_BANJO_PUY :            2F28C C |  FMINS_BASS_3 :               2F00C C |
*FMINS_BASS_CALM :            2EFCC C |  FMINS_BASS_GROOVE :          2F02C C |
*FMINS_BASS_GROOVE_2 :        2F04C C | *FMINS_BASS_GROOVE_GEM :      2F06C C |
*FMINS_BASS_HEAVY :           2EFEC C | *FMINS_BASS_ITALO :           2F08C C |
*FMINS_BASS_KON :             2F0AC C | *FMINS_BASS_SYNTH :           2F0CC C |
*FMINS_BELL_CHINA :           2F20C C | *FMINS_BRASS_EUR :            2F22C C |
*FMINS_BRASS_PUY :            2F24C C |  FMINS_COM :                   17C0 C |
 FMINS_COM2 :                  17E8 C |  FMINS_COM3 :                  1810 C |
 FMINS_COM4 :                  1838 C |  FMINS_COM5 :                  1860 C |
 FMINS_COM6 :                  1888 C |  FMINS_DING_TOY :             2F1EC C |
*FMINS_DRUMKICK_GEM :         2EF8C C | *FMINS_FLAUTE_CAVE :          2F26C C |
*FMINS_FM3_CLOSEDHAT :        2EEBC C |  FMINS_FM3_EXPLOSION :        2EEE4 C |
 FMINS_FM3_OPENHAT :          2EE94 C | *FMINS_GUITAR_GEM :           2EF0C C |
*FMINS_GUITAR_HEAVY :         2EF2C C | *FMINS_GUITAR_PUY :           2EF4C C |
*FMINS_GUITAR_PUY_2 :         2EF6C C | *FMINS_ORGAN_M1 :             2F0EC C |
*FMINS_PIANOM1 :              2EFAC C |  FMINS_TRUMPET_1 :            2F10C C |
*FMINS_TRUMPET_2 :            2F12C C | *FMINS_TRUMPET_CARNIVAL :     2F18C C |
*FMINS_TRUMPET_KON :          2F14C C | *FMINS_TRUMPET_PUY :          2F16C C |
*FMINS_VIOLIN_GEM :           2F2AC C |  FMKEYS :                         6 - |
 FMPAN :                         12 - |  FMSPCMODE :                   1EF8 C |
 FMVOL :                          C - |  FM_SEND_1 :                   1420 C |
 FM_SEND_2 :                   142B C |  FRAMECTL :                       B - |
*FS :                             1 - | *FULLPMMU :                       1 - |
 GEMASFXBLK_BOOM :           92FB46 C |  GEMASFXINS_BOOM :           92FB9D C |
 GEMASFXPAT_BOOM :           92FB49 C |  GEMATRKDATA_SFX :           92FB3A C |
 GEMATRK_BLK_BEMINE :        92FBB5 C |  GEMATRK_BLK_HILLS :         930D80 C |
 GEMATRK_INS_BEMINE :        930CB8 C |  GEMATRK_INS_HILLS :         931903 C |
 GEMATRK_PATT_BEMINE :       92FBC6 C |  GEMATRK_PATT_HILLS :        930D8C C |
 GEMA_INIT :                    F63 C |  GEMA_INIT.SET_IT :             FBE C |
 GET_CMDBYTE :                  1AE C |  GET_CMDBYTE.GETCBYTEL :        1B1 C |
 GET_TICK :                     FCB C |  GET_TICK.CTNOTICK :            FE8 C |
 GET_TRKINDX :                  19D C |  GLBL_LASTORG :               3EC70 - |
 GLBL_LASTPC :              6004210 - | *HAS64 :                          1 - |
*HASDSP :                         0 - | *HASFPU :                         0 - |
*HASPMMU :                        0 - | *HBLK :                          40 - |
*HCOUNT :                         5 - |  HINTCLR :                       18 - |
*HINTENBL :                      10 - |  HINT_DEFAULT :              FF1BE2 C |
*HIRQ_ON :                        4 - | *HVSTOP :                         2 - |
*INEXTMODE :                      0 - | *INLWORDMODE :                    0 - |
*INMAXMODE :                      0 - |  INSDATAC_0 :                  18C1 C |
 INSDATAC_1 :                  1941 C | *INSRCMODE :                      0 - |
*INSUPMODE :                      1 - |  INTMASK :                        1 - |
 INT_M_LIST :               600026C C |  INT_S_LIST :               60002CC C |
 JOYA :                          40 - |  JOYB :                          10 - |
 JOYC :                          20 - | *JOYDOWN :                        2 - |
*JOYLEFT :                        4 - | *JOYMODE :                      800 - |
*JOYRIGHT :                       8 - | *JOYSTART :                      80 - |
*JOYUP :                          1 - | *JOYX :                         400 - |
*JOYY :                         200 - | *JOYZ :                         100 - |
 LCHWIDTH :                      34 - |  LEV :                            4 - |
*LISTON :                         3 - |  LIST_VDPREGS :              FF080C C |
 LITERAL_F_00000000_1 :     6000268 C |  LITERAL_F_00000001_1 :     6000354 C |
 LITERAL_F_00000002_1 :     6000440 C |  LITERAL_F_00000003_1 :     60004C0 C |
 LITERAL_F_00000004_1 :     6000534 C |  LITERAL_F_00000005_1 :     60005E4 C |
 LITERAL_F_00000006_1 :     6000770 C |  LITERAL_F_00000007_1 :     6000938 C |
 LITERAL_F_00000008_1 :     6000940 C |  LITERAL_F_00000009_1 :     6000944 C |
 LITERAL_F_0000000A_1 :     6000948 C |  LITERAL_F_0000000B_1 :     600094C C |
 LITERAL_F_0000000C_1 :     6000950 C |  LITERAL_F_0000000D_1 :     6000954 C |
 LITERAL_F_0000000E_1 :     6000958 C |  LITERAL_F_0000000F_1 :     6000A14 C |
 LITERAL_F_00000010_1 :     6000A20 C |  LITERAL_F_00000011_1 :     6000A24 C |
 LITERAL_F_00000012_1 :     6000A2C C |  LITERAL_F_00000013_1 :     6000B54 C |
 LITERAL_F_00000014_1 :     6000B58 C |  LITERAL_F_00000015_1 :     6000B5C C |
 LITERAL_F_00000016_1 :     6000B60 C |  LITERAL_F_00000017_1 :     6000B64 C |
 LITERAL_F_00000018_1 :     6000B68 C |  LITERAL_F_00000019_1 :     6000B6C C |
 LITERAL_F_0000001A_1 :     6000B70 C |  LITERAL_F_0000001B_1 :     6000C18 C |
 LITERAL_F_0000001C_1 :     6000C1C C |  LITERAL_F_0000001D_1 :     6000C40 C |
 LITERAL_F_0000001E_1 :     6000D78 C |  LITERAL_F_0000001F_1 :     6000D7C C |
 LITERAL_F_00000020_1 :     6000D84 C |  LITERAL_F_00000021_1 :     6000D88 C |
 LITERAL_F_00000022_1 :     6000D8C C |  LITERAL_F_00000023_1 :     6000D90 C |
 LITERAL_F_00000024_1 :     6000D94 C |  LITERAL_F_00000025_1 :     6000E3C C |
 LITERAL_F_00000026_1 :     6000E44 C |  LITERAL_F_00000027_1 :     6000E5E C |
 LITERAL_F_00000028_1 :     6000F38 C |  LITERAL_F_00000029_1 :     6000F3C C |
 LITERAL_F_0000002A_1 :     6000F44 C |  LITERAL_F_0000002B_1 :     6000F50 C |
 LITERAL_F_0000002C_1 :     6000F5C C |  LITERAL_F_0000002D_1 :     6000FE8 C |
 LITERAL_F_0000002E_1 :     6000FF0 C |  LITERAL_F_0000002F_1 :     6001002 C |
 LITERAL_F_00000030_1 :     60011AC C |  LITERAL_F_00000031_1 :     60011B0 C |
 LITERAL_F_00000032_1 :     60011B8 C |  LITERAL_F_00000033_1 :     60011C0 C |
 LITERAL_F_00000034_1 :     60011D4 C |  LITERAL_F_00000035_1 :     60011D8 C |
 LITERAL_F_00000036_1 :     6001220 C |  LITERAL_F_00000037_1 :     6001224 C |
 LITERAL_F_00000038_1 :                                    FFFFFFFFC00004A0 C |
 LITERAL_F_00000039_1 :                                    FFFFFFFFC00004AC C |
 LITERAL_L_00015000_1 :     6000778 C |  LITERAL_L_00015000_2 :     600093C C |
 LITERAL_L_00015000_3 :     6000A1C C |  LITERAL_L_00015000_4 :     6000B74 C |
 LITERAL_L_00040000_1 :     6000F58 C |
 LITERAL_L_00FFFFFF_1 :                                    FFFFFFFFC00004A4 C |
 LITERAL_L_02000000_1 :     6000D98 C |
 LITERAL_L_02000000_2 :                                    FFFFFFFFC00004A8 C |
 LITERAL_L_060005EE_1 :     6000E4C C |  LITERAL_L_06000BE4_1 :     6000F40 C |
 LITERAL_L_06000BE4_2 :     6001250 C |  LITERAL_L_06000CA8_1 :     60011B4 C |
 LITERAL_L_06000CE4_1 :     60011C8 C |  LITERAL_L_06000CFC_1 :     60011CC C |
 LITERAL_L_06000D14_1 :     60011C4 C |  LITERAL_L_06000D24_1 :     60011D0 C |
 LITERAL_L_0603EFF8_1 :     60005E0 C |  LITERAL_L_0603F000_1 :     6000FDC C |
 LITERAL_L_0603FFF8_1 :     60004BC C |  LITERAL_L_06040000_1 :     6000E30 C |
 LITERAL_L_20004000_1 :     60004AC C |  LITERAL_L_20004000_2 :     60005D0 C |
 LITERAL_L_20004000_3 :     6000604 C |  LITERAL_L_20004000_4 :     6000D74 C |
 LITERAL_L_20004000_5 :     6000E40 C |  LITERAL_L_20004000_6 :     6000FEC C |
 LITERAL_L_20004016_1 :     6000438 C |  LITERAL_L_20004016_2 :     60005CC C |
 LITERAL_L_20004018_1 :     6000434 C |  LITERAL_L_20004018_2 :     60005C8 C |
 LITERAL_L_2000401A_1 :     6000360 C |  LITERAL_L_2000401A_2 :     600053C C |
 LITERAL_L_2000401C_1 :     600035C C |  LITERAL_L_2000401C_2 :     6000538 C |
 LITERAL_L_20004020_1 :     6000E34 C |  LITERAL_L_20004020_2 :     6000FE0 C |
 LITERAL_L_20004020_3 :     60011BC C |  LITERAL_L_2000402E_1 :     6000358 C |
 LITERAL_L_2000402E_2 :     6000E50 C |  LITERAL_L_2000402E_3 :     6000F54 C |
 LITERAL_L_2000402F_1 :     60011A8 C |
 LITERAL_L_20004034_1 :                                    FFFFFFFFC00004B0 C |
 LITERAL_L_20004036_1 :                                    FFFFFFFFC00004B4 C |
 LITERAL_L_20004038_1 :     6000530 C |  LITERAL_L_20004100_1 :     600043C C |
 LITERAL_L_20004100_2 :     6000608 C |  LITERAL_L_20004100_3 :     6000C68 C |
 LITERAL_L_20004100_4 :     6000F48 C |  LITERAL_L_20004100_5 :     600124C C |
 LITERAL_L_20004102_1 :     6000F4C C |  LITERAL_L_20004200_1 :     6000444 C |
 LITERAL_L_24000000_1 :     6000A18 C |  LITERAL_L_24000200_1 :     6000774 C |
 LITERAL_L_24000200_2 :     6000A28 C |  LITERAL_L_24000200_3 :     6000B78 C |
 LITERAL_L_24015200_1 :     6000B7C C |  LITERAL_L_36385550_1 :     60004B0 C |
 LITERAL_L_36385550_2 :     60005D4 C |  LITERAL_L_4D5F4F4B_1 :     60004B8 C |
 LITERAL_L_4D5F4F4B_2 :     60005DC C |  LITERAL_L_534C4156_1 :     6000E38 C |
 LITERAL_L_534C4156_2 :     6000FE4 C |  LITERAL_L_535F4F4B_1 :     60004B4 C |
 LITERAL_L_535F4F4B_2 :     60005D8 C |
 LITERAL_L_FFFFFFFFC0000000_1 :                                     6000E48 C |
 LITERAL_L_FFFFFFFFC0000000_2 :                                     6000FF4 C |
 LITERAL_L_FFFFFFFFC0000000_3 :                            FFFFFFFFC000049C C |
 LITERAL_L_FFFFFFFFFF000000_1 :                                     6000D80 C |
 LITERAL_W_0080_1 :         600060C C |  LITERAL_W_0080_2 :         6000DA0 C |
 LITERAL_W_0080_3 :         60011DE C |
 LITERAL_W_0080_4 :                                        FFFFFFFFC00004B8 C |
 LITERAL_W_00A1_1 :         6000C74 C |  LITERAL_W_00D0_1 :         6000F60 C |
 LITERAL_W_00F0_1 :         600044A C |  LITERAL_W_00F0_2 :         60004C4 C |
 LITERAL_W_00F0_3 :         60005EA C |  LITERAL_W_00F0_4 :         600077C C |
 LITERAL_W_00F0_5 :         6000C44 C |  LITERAL_W_00F0_6 :         6000C6C C |
 LITERAL_W_00F0_7 :         6000E5A C |  LITERAL_W_00F0_8 :         6000F64 C |
 LITERAL_W_00F0_9 :         6000FFE C |  LITERAL_W_00F0_A :         60011DC C |
 LITERAL_W_00FC_1 :         60011E0 C |  LITERAL_W_0100_1 :         6000780 C |
 LITERAL_W_0100_2 :         6000A34 C |  LITERAL_W_0100_3 :         6000C24 C |
 LITERAL_W_0100_4 :         6000F62 C |  LITERAL_W_0105_1 :         6000D9C C |
 LITERAL_W_0140_1 :         6000782 C |  LITERAL_W_0140_2 :         6000A36 C |
 LITERAL_W_0140_3 :         6000B80 C |  LITERAL_W_0150_1 :         600077E C |
 LITERAL_W_0150_2 :         6000A32 C |  LITERAL_W_0150_3 :         6000B82 C |
 LITERAL_W_0200_1 :         6000A30 C |  LITERAL_W_0200_2 :         6000C20 C |
 LITERAL_W_0415_1 :         6000D9E C |  LITERAL_W_1000_1 :         6000C22 C |
 LITERAL_W_1234_1 :         6000364 C |  LITERAL_W_44E0_1 :         60004CA C |
 LITERAL_W_44E0_2 :         60005EC C |  LITERAL_W_5A00_1 :         600127E C |
 LITERAL_W_5A20_1 :         6000C70 C |  LITERAL_W_7FFF_1 :         6000C26 C |
 LITERAL_W_A518_1 :         60004C8 C |  LITERAL_W_A518_2 :         600127C C |
 LITERAL_W_A538_1 :         6000C72 C |  LITERAL_W_FE10_1 :         6000366 C |
 LITERAL_W_FE10_2 :         6000448 C |  LITERAL_W_FE10_3 :         60004CC C |
 LITERAL_W_FE10_4 :         6000540 C |  LITERAL_W_FE10_5 :         60005E8 C |
 LITERAL_W_FE10_6 :         6000E54 C |  LITERAL_W_FE10_7 :         6000FF8 C |
 LITERAL_W_FE10_8 :         6001278 C |  LITERAL_W_FE80_1 :         60004C6 C |
 LITERAL_W_FE80_2 :         6000C6E C |  LITERAL_W_FE80_3 :         600127A C |
 LITERAL_W_FE92_1 :         6000E5C C |  LITERAL_W_FE92_2 :         6001000 C |
 LITERAL_W_FEE2_1 :         6000E56 C |  LITERAL_W_FEE2_2 :         6000FFA C |
 LITERAL_W_FEE4_1 :         6000E58 C |  LITERAL_W_FEE4_2 :         6000FFC C |
*MACEXP :                         7 - | *MAP_BGTEST :                93296C C |
*MAP_FGTEST :                93196C C |  MAP_NICOLE :                FF223E C |
 MAP_NICOLE.FRAME_0 :        FF224E C |  MAP_NICOLE.FRAME_1 :        FF2286 C |
 MAP_NICOLE.FRAME_2 :        FF22B9 C |  MAP_NICOLE.FRAME_3 :        FF22E2 C |
 MAP_NICOLE.FRAME_4 :        FF2306 C |  MAP_NICOLE.FRAME_5 :        FF2334 C |
 MAP_NICOLE.FRAME_6 :        FF2353 C |  MAP_NICOLE.FRAME_7 :        FF237C C |
 MAP_NICOLE.MAPPINGS :       FF223E C | *MARS :                           1 - |
 MARSBLOCK :                     20 C | *MARSCD :                         0 - |
 MARSGBL_CURRFB :                 A C |  MARSGBL_CURRGFXMODE :            4 C |
 MARSGBL_MSTRREQDRAW :            2 C |  MARSGBL_PALDMAMIDWR :            C C |
*MARSGBL_PWMCTRLUPD :             E C |  MARSGBL_VINTFLAG_M :             6 C |
 MARSGBL_VINTFLAG_S :             8 C |  MARSGBL_XSHIFT :                 0 C |
 MARSRAM_SOUND :            60046A8 C |  MARSRAM_SYSTEM :           6004210 C |
 MARSRAM_VIDEO :            6004430 C | *MARSSND_ACTIVE :  FFFFFFFFC00004C0 C |
 MARSSND_ACTIVE.END :                                      FFFFFFFFC00004C4 C |
 MARSSND_PWMCACHE :                                        FFFFFFFFC0000000 C |
 MARSSND_PWMCHNLS :         60046A8 C |  MARSSND_PWMCONTROL :       60047C0 C |
 MARSSND_REFILL :           6000D24 C |  MARSSND_REFILL.COPY_NOW :  6000D4A C |
 MARSSND_REFILL.NEXT_ONE :  6000D2C C |  MARSSND_REFILL.NOT_ACTIV : 6000D66 C |
 MARSSND_REFILL.NOT_ENBL :  6000D66 C |  MARSSND_RVMODE :  FFFFFFFFC00004BC C |
 MARSSOUND_INIT :           6000C76 C |  MARSSOUND_INIT.CLR_ENBL :  6000C96 C |
 MARSSOUND_PWMENABLE :      6000D14 C |
 MARSSOUND_READPWM :                                       FFFFFFFFC0000380 C |
 MARSSOUND_READPWM.FROM_RV :                               FFFFFFFFC0000420 C |
 MARSSOUND_READPWM.LOOP :                                  FFFFFFFFC000039E C |
 MARSSOUND_READPWM.LOOP_ME :                               FFFFFFFFC00003CE C |
 MARSSOUND_READPWM.MONO :                                  FFFFFFFFC000042A C |
 MARSSOUND_READPWM.MONO_A :                                FFFFFFFFC0000418 C |
 MARSSOUND_READPWM.MONO_C :                                FFFFFFFFC00003F8 C |
 MARSSOUND_READPWM.MONO_L :                                FFFFFFFFC00003DA C |
 MARSSOUND_READPWM.NOT_ROM :                               FFFFFFFFC000040A C |
 MARSSOUND_READPWM.NO_L :                                  FFFFFFFFC0000440 C |
 MARSSOUND_READPWM.NO_R :                                  FFFFFFFFC0000446 C |
 MARSSOUND_READPWM.ON :                                    FFFFFFFFC00003AC C |
 MARSSOUND_READPWM.READ :                                  FFFFFFFFC00003DC C |
 MARSSOUND_READPWM.SILENT :                                FFFFFFFFC00003A4 C |
 MARSSOUND_READPWM.SKIP :                                  FFFFFFFFC000046A C |
 MARSSOUND_SETPWM :         6000CA8 C |  MARSSOUND_SETPWM.ENDMRK :  6000CCC C |
 MARSSOUND_SETPWMPITCH :    6000CE4 C |
 MARSSOUND_SETPWMPITCH.OFF_1 :                                      6000CF8 C |
 MARSSOUND_SETVOLUME :      6000CFC C |
 MARSSOUND_SETVOLUME.OFF_1 :                                        6000D10 C |
 MARSUPD :                     19CC C |  MARSVIDEO_BGDRAWLR :       60009A4 C |
 MARSVIDEO_BGDRAWLR.DTSK01_DLEFT :                                  60009F4 C |
 MARSVIDEO_BGDRAWLR.DTSK01_DRIGHT :                                 6000A00 C |
 MARSVIDEO_BGDRAWUD :       6000A80 C |
 MARSVIDEO_BGDRAWUD.DRWY_GO :                                       6000AEA C |
 MARSVIDEO_BGDRAWUD.NOT_L2 :                                        6000B34 C |
 MARSVIDEO_BGDRAWUD.REPT_X :                                        6000B12 C |
 MARSVIDEO_BGDRAWUD.REPT_Y :                                        6000AEC C |
 MARSVIDEO_BGDRAWUD.RES_X : 6000B1A C |
 MARSVIDEO_BGDRAWUD.TSK00_DOWN :                                    6000AA4 C |
 MARSVIDEO_BGDRAWUD.TSK00_UP :                                      6000AC8 C |
 MARSVIDEO_BGDRAWUD.XLON1 : 6000B20 C |
 MARSVIDEO_BGDRAWUD.YBGEND :                                        6000AF8 C |
 MARSVIDEO_DRAWALLBG :      600060E C |
 MARSVIDEO_DRAWALLBG.LNXBG_L :                                      60006C8 C |
 MARSVIDEO_DRAWALLBG.LNXFB_L :                                      60006CE C |
 MARSVIDEO_DRAWALLBG.LNX_LOOP :                                     60006C2 C |
 MARSVIDEO_DRAWALLBG.MK_PIECE :                                     6000718 C |
 MARSVIDEO_DRAWALLBG.MK_PZLINE :                                    60006E4 C |
 MARSVIDEO_DRAWALLBG.XBG_INC :                                      600064C C |
 MARSVIDEO_DRAWALLBG.XBG_L :                                        600068E C |
 MARSVIDEO_DRAWALLBG.XFB_L :                                        6000694 C |
 MARSVIDEO_DRAWALLBG.XINIT_L :                                      6000644 C |
 MARSVIDEO_DRAWALLBG.X_LOOP :                                       6000688 C |
 MARSVIDEO_DRAWALLBG.YBG_INC :                                      6000654 C |
 MARSVIDEO_DRAWALLBG.YBG_L :                                        600067C C |
 MARSVIDEO_DRAWALLBG.YBLK_LOOP :                                    6000738 C |
 MARSVIDEO_DRAWALLBG.YFB_L :                                        6000682 C |
 MARSVIDEO_DRAWALLBG.Y_LOOP :                                       6000676 C |
 MARSVIDEO_INIT :           60005EE C |  MARSVIDEO_LOADPAL :        6000BE4 C |
*MARSVIDEO_LOADPAL.BADLEN : 6000C0A C |  MARSVIDEO_LOADPAL.LOOP :   6000BFE C |
 MARSVIDEO_MAKETBL :        600095C C |
 MARSVIDEO_MAKETBL.LN_LOOP :                                        6000980 C |
 MARSVIDEO_MAKETBL.NO_LINES :                                       600099E C |
 MARSVIDEO_MAKETBL.XL_L :   600098E C |  MARSVIDEO_MAKETBL.XL_R :   6000988 C |
 MARSVIDEO_MOVEBG :         6000784 C |
 MARSVIDEO_MOVEBG.DONT_SNAP :                                       6000932 C |
 MARSVIDEO_MOVEBG.REQD_B :  600089A C |  MARSVIDEO_MOVEBG.REQR_B :  60008D8 C |
 MARSVIDEO_MOVEBG.XEQU :    600079C C |  MARSVIDEO_MOVEBG.XNEGTV :  600081A C |
 MARSVIDEO_MOVEBG.XNEGTVL : 6000830 C |  MARSVIDEO_MOVEBG.XPOSTV :  6000824 C |
 MARSVIDEO_MOVEBG.XPOSTVL : 600083A C |  MARSVIDEO_MOVEBG.X_STEND : 60007BC C |
 MARSVIDEO_MOVEBG.YDL_BUSY :                                        60008EE C |
 MARSVIDEO_MOVEBG.YDR_BUSY :                                        60008B0 C |
 MARSVIDEO_MOVEBG.YEQU :    60007B2 C |  MARSVIDEO_MOVEBG.YNEGTV :  6000846 C |
 MARSVIDEO_MOVEBG.YNEGTVL : 600085C C |  MARSVIDEO_MOVEBG.YPOSTV :  6000850 C |
 MARSVIDEO_MOVEBG.YPOSTVL : 6000866 C |
 MARSVIDEO_MOVEBG.YX_NEGTV :                                        60007EA C |
 MARSVIDEO_MOVEBG.YX_POSTV :                                        60007F4 C |
 MARSVIDEO_MOVEBG.Y_STEND : 60007C2 C |  MARSVIDEO_SETBG :          6000C28 C |
*MARSVIDEO_SETWATCHDOG :    6000C46 C |
 MARSVIDEO_SETWATCHDOG.WAIT_FB :                                    6000C5A C |
 MARS_ENTRY :                   800 C |  MARS_ENTRY.ADAPTERENABLE :     872 C |
 MARS_ENTRY.NO_MARS :           880 C |  MARS_ENTRY.RAMCODE :           84A C |
 MARS_ENTRY.RESTARTICD :        85A C |  MARS_RAMDATA :               3AA60 C |
 MARS_RAMDATA_E :             3EC70 C |  MARS_SCOMM :                   54C C |
 MARS_SCOMM.BLOCKED :           5C5 C |  MARS_SCOMM.CLRCOM :            5CA C |
 MARS_SCOMM.NEXT_COMM :         5A1 C |  MARS_SCOMM.NEXT_PASS :         597 C |
 MARS_SCOMM.WAIT_ENTER :        57C C |  MARS_SCOMM.WAIT_OTHER :        58C C |
 MARS_SCOMM.W_PASS2 :           5BB C |  MASTERTRKLIST :             FF1F16 C |
 MASTER_IRQ :               6000248 C |  MASTER_LOOP :              6000E60 C |
 MAX_MDDMATSK :                  10 - |  MAX_MDERAM :                   800 - |
*MAX_MSPR :                      80 - |  MAX_PWMCHNL :                    7 - |
 MAX_TRKCHN :                    12 - |  MAX_TSTENTRY :                   5 - |
*MAX_TSTTRKS :                    3 - | *MBG_4 :                         1E C |
*MBG_5 :                         20 C | *MBG_6 :                         22 C |
*MBG_7 :                         24 C | *MBG_8 :                         26 C |
 MBG_DATA :                      28 C |  MBG_DRAW_ALL :                   0 C |
 MBG_DRAW_D :                     3 C |  MBG_DRAW_L :                     2 C |
 MBG_DRAW_R :                     1 C |  MBG_DRAW_U :                     4 C |
 MBG_FB :                        38 C | *MBG_FREE :                       7 C |
 MBG_HEIGHT :                    16 C |  MBG_MAXLINES :                  1C C |
*MBG_SIZE :                      2C C |  MBG_WIDTH :                     14 C |
 MBG_XINC_L :                     C C |  MBG_XINC_R :                     E C |
 MBG_XPOS :                      30 C |  MBG_XPOS_OLD :                   8 C |
 MBG_XSET :                       5 C |  MBG_YFB :                       18 C |
 MBG_YFB_D :                     1A C |  MBG_YINC_D :                    12 C |
 MBG_YINC_U :                    10 C |  MBG_YPOS :                      34 C |
 MBG_YPOS_OLD :                   A C |  MBG_YSET :                       6 C |
*MCD :                            0 - |  MCHNSND_BANK :                   C C |
 MCHNSND_CCHREAD :                8 C |  MCHNSND_ENBL :                   0 C |
 MCHNSND_END :                   14 C |  MCHNSND_FLAGS :                 20 C |
 MCHNSND_LOOP :                  18 C |  MCHNSND_PITCH :                 1C C |
 MCHNSND_READ :                   4 C |  MCHNSND_START :                 10 C |
 MCHNSND_VOL :                   24 C |  MDRAMCODE :                    938 C |
 MDRAMCODE_END :               251C C |  MDRAM_START :             FFFFC000 - |
 MDSYS_SINEDATA :            FF1A20 C |  MD_BANK_SRAM :              A130F1 - |
 MD_ERRADDR :                   898 C |  MD_ERRBUS :                    898 C |
 MD_ERRCHK :                    898 C |  MD_ERRILL :                    898 C |
 MD_ERROREX :                   898 C |  MD_ERRORTRAP :                 898 C |
 MD_ERRPRIVL :                  898 C |  MD_ERRTRAPV :                  898 C |
 MD_ERRZDIV :                   898 C | *MD_FIFOMARS :               FF205A C |
 MD_FIFOMARS.L0 :            FF20C4 C |  MD_FIFOMARS.L1 :            FF20CC C |
 MD_FIFOMARS.RETRY :         FF2072 C |  MD_FIFOMARS.WAIT_CMD :      FF20BA C |
 MD_HOTSTART :                  8D8 C |  MD_HOTSTART.CLRRAM :           90A C |
 MD_HOTSTART.WAITFRAME :        8EA C |  MD_INIT :                      89A C |
 MD_INIT.WM :                   8AC C |  MD_INIT.WS :                   8B6 C |
 MD_LINE1010 :                  898 C |  MD_LINE1111 :                  898 C |
 MD_TRACE :                     898 C | *MINFO_RAM_S :               FF0000 C |
 MODE :                          18 - |  MODE_INIT :                 FF1BB4 C |
 MODE_INIT.CLR :             FF1BC2 C |  MOMCPU :                     68000 - |
*MOMCPUNAME :                 68000 - |  MONOWIDTH :                     38 - |
 MSCRL_BLKSIZE :                 10 - |  MSCRL_HEIGHT :                 100 - |
 MSCRL_WIDTH :                  150 - |  MSTR_GFX1_LOOP :           6000E96 C |
 MSTR_GFX1_LOOP.DOWN :      6000EE8 C |  MSTR_GFX1_LOOP.LEFT :      6000EDC C |
 MSTR_GFX1_LOOP.NO_REDRAW : 6000F10 C |
 MSTR_GFX1_LOOP.NO_SCRLDATA :                                       6000F1A C |
 MSTR_GFX1_LOOP.RIGHT :     6000ED0 C |  MSTR_GFX1_LOOP.TEST_1 :    6000EFC C |
 MSTR_GFX1_LOOP.UP :        6000EF4 C |
 MSTR_GFX1_LOOP.WAIT_FRMSWP :                                       6000E9C C |
 M_IRQ_BAD :                6000318 C |  M_IRQ_CMD :                6000338 C |
 M_IRQ_CUSTOM :    FFFFFFFFC0000000 C |
 M_IRQ_CUSTOM.TAG_FRT :                                    FFFFFFFFC000000C C |
 M_IRQ_H :                  6000368 C |  M_IRQ_PWM :                600031C C |
 M_IRQ_V :                  6000384 C |  M_IRQ_V.COPY_PAL :         60003B8 C |
*M_IRQ_V.MID_PWRITE :       600042C C |  M_IRQ_V.WAIT :             6000398 C |
 M_IRQ_V.WAIT_FB :          6000392 C |  M_IRQ_VRES :               600044C C |
 M_IRQ_VRES.MARS_RESET :    600049E C |  M_IRQ_VRES.MD_RESET :      6000464 C |
 M_IRQ_VRES.SH_WAIT :       600046C C |  M_IRQ_VRES.VRESLOOP :      60004A6 C |
*NESTMAX :                      100 - |  NXT_DRAWUD :               6000A7A C |
 ON_HOLD :                        2 C |  ON_PRESS :                       4 C |
*PACKING :                        0 - | *PADDING :                        0 - |
*PADDINGSOFAR :                   0 - |  PAD_ID :                         0 C |
 PAD_VER :                        1 C | *PALMODE :                       21 C |
*PAL_BG :                    FF2232 C | *PAL_EMI :                   FF21FA C |
*PAL_TESTBOARD :             FF221A C | *PEN :                           20 - |
*PLAYTHISSFX :               FF1F36 C | *PRINTF :                   6000B84 C |
 PRINTF00 :                 6000B9E C |  PRINTF01 :                 6000BBA C |
 PRINTF_END :               6000BDE C |  PRINT_LF :                 6000BD4 C |
*PSGALV :                      178C C | *PSGATK :                      1770 C |
 PSGCOM :                      1768 C | *PSGDEC :                      1774 C |
*PSGDTH :                      1788 C | *PSGDTL :                      1784 C |
*PSGENV :                      1780 C |  PSGFREQ_LIST :                1586 C |
 PSGHATMODE :                  1EF7 C | *PSGLEV :                      176C C |
*PSGRRT :                      177C C | *PSGSLV :                      1778 C |
*PSGTIM :                      1794 C | *PSGVOL :                      1798 C |
*PSG_CTRL :                  C00011 - |  PVOL :                          30 - |
*PWCOM :                          0 - |  PWINSH :                        20 - |
 PWINSL :                        30 - |  PWINSM :                        28 - |
 PWMCOM :                      1A6A C | *PWMCTL :                        31 - |
 PWMINTCLR :                     1C - |  PWMIRQ_ON :                      1 - |
 PWOUTF :                        18 - |  PWPHL :                         10 - |
 PWPTH_V :                        8 - |  RAMCODE_DEFAULT :            2F2CC C |
 RAMCODE_USER :              FF1BE4 C | *RAM_BGCAMERA :    FFFFFFFFFFFFC01C C |
*RAM_BOARDUPD :    FFFFFFFFFFFFC018 C |  RAM_CURRINDX :    FFFFFFFFFFFFC020 C |
 RAM_CURRSELC :    FFFFFFFFFFFFC01E C |  RAM_CURRTEMPO :   FFFFFFFFFFFFC026 C |
 RAM_CURRTICKS :   FFFFFFFFFFFFC024 C |  RAM_CURRTRACK :   FFFFFFFFFFFFC022 C |
 RAM_CURRTYPE :    FFFFFFFFFFFFC01A C |  RAM_EMIANIM :     FFFFFFFFFFFFC012 C |
*RAM_EMICHAR :     FFFFFFFFFFFFC010 C |  RAM_EMIHIDE :     FFFFFFFFFFFFC014 C |
 RAM_EMIPOSX :     FFFFFFFFFFFFC000 C |  RAM_EMIPOSY :     FFFFFFFFFFFFC004 C |
 RAM_FRAMECOUNT :  FFFFFFFFFFFFD926 C | *RAM_HORSCROLL :   FFFFFFFFFFFFCC80 C |
 RAM_INITFLUG :    FFFFFFFFFFFFD932 C |  RAM_INPUTDATA :   FFFFFFFFFFFFD50E C |
 RAM_MARS_BACKGROUND :      6004630 C | *RAM_MARS_DREQ :            6004230 C |
 RAM_MARS_GLOBAL :          6004210 C |  RAM_MARS_PALETTE :         6004430 C |
*RAM_MDGLBL_NULL : FFFFFFFFFFFFD948 C |  RAM_MDGLOBAL :    FFFFFFFFFFFFD948 C |
*RAM_MDMARSDREQ :  FFFFFFFFFFFFD30E C |  RAM_MDMARSHINT :  FFFFFFFFFFFFD93C C |
*RAM_MDMARSTCNTM : FFFFFFFFFFFFD942 C | *RAM_MDMARSTCNTS : FFFFFFFFFFFFD944 C |
 RAM_MDMARSVINT :  FFFFFFFFFFFFD936 C |  RAM_MDSOUND :     FFFFFFFFFFFFC800 C |
 RAM_MDSYSTEM :    FFFFFFFFFFFFD30E C |  RAM_MDVIDEO :     FFFFFFFFFFFFC820 C |
 RAM_MODEBUFF :    FFFFFFFFFFFFC000 C | *RAM_OBJECTS :     FFFFFFFFFFFFD726 C |
*RAM_SAVEDATA :    FFFFFFFFFFFFD526 C |  RAM_SHAKEME :     FFFFFFFFFFFFC016 C |
 RAM_SNDSAVEREG :  FFFFFFFFFFFFC800 C |  RAM_SPRITEDATA :  FFFFFFFFFFFFC820 C |
*RAM_SYSFLAGS :    FFFFFFFFFFFFD946 C |  RAM_SYSRANDSEED : FFFFFFFFFFFFD92E C |
 RAM_SYSRANDVAL :  FFFFFFFFFFFFD92A C |  RAM_VDPDMAINDX :  FFFFFFFFFFFFD170 C |
 RAM_VDPDMALIST :  FFFFFFFFFFFFD090 C |  RAM_VDPDMAMOD :   FFFFFFFFFFFFD172 C |
 RAM_VDPREGS :     FFFFFFFFFFFFD2F6 C | *RAM_VERSCROLL :   FFFFFFFFFFFFD040 C |
 RAM_VIDPRNTLIST : FFFFFFFFFFFFD176 C |  RAM_VIDPRNTVRAM : FFFFFFFFFFFFD174 C |
 RAM_WINDOWCURR :  FFFFFFFFFFFFC028 C |  RAM_WINDOWNEW :   FFFFFFFFFFFFC02A C |
 RAM_XPOSBG :      FFFFFFFFFFFFC00C C |  RAM_XPOSFG :      FFFFFFFFFFFFC008 C |
 RCHWIDTH :                      36 - |  READROMB :                    100D C |
 READROMB.IMBACK :             101D C |  READROMB.W2 :                 102A C |
 READROMB.WAIT :               1026 C | *RELAXED :                        0 - |
 ROM_END :                    6A888 C | *ROTATE_POINT :             60011E8 C |
*ROT_ANGLE :                60011E4 C |  RRT :                           14 - |
 SBEATACC :                      24 C |  SBEATPTCK :                     22 C |
 SETUPCHIP :                    5D0 C |  SETUPCHIP.ALRDFND :            F46 C |
*SETUPCHIP.BAD_INS :            EDA C |  SETUPCHIP.BUSY :               6A7 C |
 SETUPCHIP.BUSY_S :             F01 C |  SETUPCHIP.CHECK_CHNL :         EAC C |
 SETUPCHIP.CHECK_INS :          E99 C |  SETUPCHIP.CHIP_OUT :           DE5 C |
 SETUPCHIP.CHIP_SWAP :          DA9 C |  SETUPCHIP.CHKFREE :            F4D C |
 SETUPCHIP.CHK_TBL :            F04 C |  SETUPCHIP.CHK_TBLN :           EE9 C |
 SETUPCHIP.CHNL_UNLINK :        BE9 C |  SETUPCHIP.CHP_UNLK :           E72 C |
 SETUPCHIP.CONFM_RD :           838 C |  SETUPCHIP.DAC_OUT :            E0A C |
*SETUPCHIP.DCUT :               CD4 C |  SETUPCHIP.DIFFR :              F1D C |
*SETUPCHIP.DOFF :               CD9 C |  SETUPCHIP.DO_CHNL :            6AE C |
 SETUPCHIP.EFFDAC_E :           A0B C |  SETUPCHIP.EFFDAC_F :           A3A C |
 SETUPCHIP.EFFFM_D :            9A1 C |  SETUPCHIP.EFFFM_E :            9FD C |
 SETUPCHIP.EFFFM_F :            A33 C |  SETUPCHIP.EFFFM_X :            B10 C |
 SETUPCHIP.EFFPSG_D :           973 C |  SETUPCHIP.EFFPSG_E :           9F3 C |
 SETUPCHIP.EFFPSG_F :           A25 C |  SETUPCHIP.EFFPWM_E :           A18 C |
 SETUPCHIP.EFFPWM_F :           A40 C |  SETUPCHIP.EFFPWM_X :           AF7 C |
 SETUPCHIP.EFF_DAC :            94A C |  SETUPCHIP.EFF_FM :             933 C |
 SETUPCHIP.EFF_PSG :            920 C |  SETUPCHIP.EFF_PWM :            95C C |
 SETUPCHIP.E_FNEGD2 :           A22 C |  SETUPCHIP.E_GO :               AF6 C |
 SETUPCHIP.E_NEG :              A07 C |  SETUPCHIP.E_NEGD :             A15 C |
 SETUPCHIP.E_NEGP :             A30 C |  SETUPCHIP.E_NOEF :             AF2 C |
 SETUPCHIP.E_NOF :              AE8 C |  SETUPCHIP.FLOTIN :             689 C |
 SETUPCHIP.FLTIN_S :            662 C |  SETUPCHIP.FM3_OUT :            E18 C |
 SETUPCHIP.FMPAN_LIST :         B4A C |  SETUPCHIP.FMPICKINS :          84B C |
 SETUPCHIP.FMSAME_INS :         849 C |  SETUPCHIP.FM_CHNLKON :         D7C C |
*SETUPCHIP.FM_DLINK :           DA6 C |  SETUPCHIP.FM_KEYCUT :          DA4 C |
 SETUPCHIP.FM_KEYOFF :          DA0 C |  SETUPCHIP.FM_KPV :             D9F C |
 SETUPCHIP.FM_OUT :             E54 C |  SETUPCHIP.FNDLINK :            F42 C |
 SETUPCHIP.FNDSLOT :            F60 C |  SETUPCHIP.FND_OCT :            D59 C |
 SETUPCHIP.FREQINC_DAC :        A78 C |  SETUPCHIP.FREQINC_FM :         A88 C |
 SETUPCHIP.FREQINC_PSG :        AAE C |  SETUPCHIP.FREQINC_PWM :        A44 C |
 SETUPCHIP.FROM_NL :            DC2 C |  SETUPCHIP.GET_OCT :            D4E C |
 SETUPCHIP.GO_DOWN :            9DA C |  SETUPCHIP.GO_UP :              9E3 C |
 SETUPCHIP.GRAB_DVAL :          9D0 C |  SETUPCHIP.GRAB_PRTM :          AD8 C |
 SETUPCHIP.INS_DAC :            791 C |  SETUPCHIP.INS_FM :             7DA C |
 SETUPCHIP.INS_FM3 :            7CB C |  SETUPCHIP.INS_PSG :            762 C |
 SETUPCHIP.INS_PSGN :           75C C |  SETUPCHIP.INS_PWM :            721 C |
 SETUPCHIP.LOWP :               998 C |  SETUPCHIP.LOWPF :              9C7 C |
 SETUPCHIP.MK_CHIP :            62A C |  SETUPCHIP.NEW :                EF8 C |
 SETUPCHIP.NEXT :               F07 C |  SETUPCHIP.NODEFV :             C96 C |
 SETUPCHIP.NOTEPSG_C :          C5C C |  SETUPCHIP.NOTEPSG_FN :         C69 C |
 SETUPCHIP.NOTE_DAC :           CA1 C |  SETUPCHIP.NOTE_FM :            D08 C |
 SETUPCHIP.NOTE_FM3 :           CE4 C |  SETUPCHIP.NOTE_PSG :           C37 C |
 SETUPCHIP.NOTE_PSGN :          C0A C |  SETUPCHIP.NOTE_PWM :           B79 C |
 SETUPCHIP.NOT_PRDAC :          7EE C |  SETUPCHIP.NO_CHNL :            6F1 C |
 SETUPCHIP.NP2_N :              C34 C |  SETUPCHIP.NXT_CHNL :           63D C |
 SETUPCHIP.PCUT :               BE7 C |  SETUPCHIP.POFF :               BE3 C |
 SETUPCHIP.PSGN_OUT :           E26 C |  SETUPCHIP.PSG_OUT :            E34 C |
 SETUPCHIP.PVMUCH :             89C C |  SETUPCHIP.PWMN_KPV :           BC4 C |
 SETUPCHIP.PWM_KEYCUT :         BDF C |  SETUPCHIP.PWM_KEYOFF :         BDB C |
 SETUPCHIP.PWM_OUT :            DE7 C |  SETUPCHIP.P_OUT :              E52 C |
 SETUPCHIP.RAN_OUT :            6E7 C |  SETUPCHIP.RD_FMINS :           805 C |
 SETUPCHIP.RD_NT3 :             D43 C |  SETUPCHIP.REQ_EFF :            8F2 C |
 SETUPCHIP.REQ_INS :            6FA C |  SETUPCHIP.REQ_NOTE :           B4E C |
 SETUPCHIP.REQ_VOL :            857 C |  SETUPCHIP.SILNC_LIST :         676 C |
 SETUPCHIP.SILNC_SINGL :        64F C |  SETUPCHIP.TBLLIST :            EDD C |
 SETUPCHIP.VMUCH :              8C6 C |  SETUPCHIP.VOL_FM :             8CD C |
 SETUPCHIP.VOL_PSG :            8AA C |  SETUPCHIP.VOL_PWM :            877 C |
 SH2_ERROR :                600030C C |  SH2_ERROR.INFIN :          6000312 C |
 SH2_MASTER :               6000000 C |  SH2_M_ENTRY :              6000DA4 C |
 SH2_M_ENTRY.WAIT_MD :      6000DD4 C |  SH2_M_ENTRY.WAIT_SLAVE :   6000DDE C |
 SH2_M_HOTSTART :           6000DEA C |  SH2_M_HOTSTART.COPY :      6000E0A C |
 SH2_M_HOTSTART.LEL :       6000E20 C |  SH2_RAM :                  6004210 C |
 SH2_SLAVE :                6000124 C |  SH2_S_ENTRY :              6000F68 C |
 SH2_S_ENTRY.WAIT_MD :      6000F98 C |  SH2_S_HOTSTART :           6000FA4 C |
 SH2_S_HOTSTART.COPY :      6000FC4 C |  SHIFT :                          2 - |
 SHOWROM :                      FEC C |  SIN_TABLE :                600180C C |
 SIZEOF_INPUT :                   6 C |  SIZEOF_MARSBG :                 3C C |
 SIZEOF_MARSGBL :                10 C | *SIZEOF_MARSRAM :           60047F8 C |
*SIZEOF_MARSRAM.HERE :      60047F8 C |  SIZEOF_MARSSND :           60047F8 C |
 SIZEOF_MARSSYS :           6004430 C |  SIZEOF_MARSVID :           60046A8 C |
 SIZEOF_MDGLBL :   FFFFFFFFFFFFD94C C |  SIZEOF_MDGLBL.COPYME :         926 C |
 SIZEOF_MDRAM :    FFFFFFFFFFFFD94C C |  SIZEOF_MDSND :    FFFFFFFFFFFFC820 C |
 SIZEOF_MDSYS :    FFFFFFFFFFFFD948 C |  SIZEOF_MDVID :    FFFFFFFFFFFFD30E C |
 SIZEOF_SNDCHN :                 28 C |  SLAVE_IRQ :                60002AC C |
 SLAVE_LOOP :               6001004 C |  SLAVE_LOOP.COPY_1 :        6001050 C |
 SLAVE_LOOP.NEXT_CHNL :     600106A C |  SLAVE_LOOP.NON_ZERO :      600103C C |
 SLAVE_LOOP.NO_KEYOFF :     600108E C |  SLAVE_LOOP.NO_PITCHBND :   60010B2 C |
 SLAVE_LOOP.NO_REQ :        6001160 C |  SLAVE_LOOP.NO_VOLUMEBND :  60010CA C |
 SLAVE_LOOP.NO_ZTRNSFR :    6001170 C |  SLAVE_LOOP.PWM_KEYCUT :    6001082 C |
 SLAVE_LOOP.REFILL_IN :     600118C C |  SLAVE_LOOP.REFILL_OUT :    60011A2 C |
 SLAVE_LOOP.TEST_1 :        600102C C |  SLAVE_LOOP.WAIT_1 :        6001040 C |
 SLV :                           10 - |  SMPINS_BELL_ICE :          203EC70 C |
 SMPINS_BRASS1_HI :         204279C C |  SMPINS_BRASS1_LOW :        204A368 C |
 SMPINS_FOREST_1 :          2051F34 C |  SMPINS_KICK_JAM :          2056820 C |
*SMPINS_PIANO_1 :           2059100 C |  SMPINS_SNARE_JAM :         20572EC C |
 SMPINS_SNRTOM_1 :          2057C58 C | *SMPINS_SSTR162A :          205D81C C |
 SNDLOCKZ80 :                FF005A C |  SNDLOCKZ80.WAIT :           FF0062 C |
 SNDREQ_ENTER :              FF0078 C |  SNDREQ_ENTER.WAIT :         FF009E C |
 SNDREQ_EXIT :               FF00AE C |  SNDREQ_SADDR :              FF00D6 C |
 SNDREQ_SBYTE :              FF00DE C |  SNDREQ_SCMD :               FF00C4 C |
*SNDREQ_SLONG :              FF00D2 C |  SNDREQ_SWORD :              FF00DA C |
 SNDUNLOCKZ80 :              FF006E C |  SOUND_DMA_PAUSE :           FF00EC C |
 SOUND_DMA_PAUSE.RETRY :     FF00EE C |  SOUND_DMA_PAUSE.SAFE :      FF0108 C |
 SOUND_DMA_PAUSE.WAIT_MARS1 :                                        FF0118 C |
 SOUND_DMA_PAUSE.WAIT_MARS2 :                                        FF0138 C |
 SOUND_DMA_RESUME :          FF0148 C |
 SOUND_DMA_RESUME.WAIT_MARS1 :                                       FF015A C |
 SOUND_DMA_RESUME.WAIT_MARS2 :                                       FF017A C |
 SOUND_GLBTEMPO :            FF0222 C |  SOUND_INIT :                FF0000 C |
 SOUND_INIT.CLEANUP :        FF0026 C |  SOUND_INIT.COPY :           FF003C C |
 SOUND_INIT.WAIT :           FF0010 C |  SOUND_TRKPAUSE :            FF01DA C |
 SOUND_TRKPLAY :             FF018A C |  SOUND_TRKRESUME :           FF01F0 C |
 SOUND_TRKSTOP :             FF01C4 C |  SOUND_TRKTICKS :            FF0206 C |
 STANDBY :                        2 - | *STR_COMM :                  FF21C2 C |
 STR_CURSOR :                FF210C C |  STR_GEMA :                  FF2132 C |
 STR_STATUS :                FF2112 C | *STR_TITLE :                 FF20FA C |
*SYSMARS_ID :                A130EC - |  SYSMARS_REG :               A15100 - |
 SYSTEM_INIT :               FF1840 C |  SYSTEM_INIT.CLRINPUT :      FF187E C |
 SYSTEM_INIT.WAIT :          FF184E C |  SYSTEM_INPUT :              FF18C2 C |
 SYSTEM_INPUT.EXIT :         FF18F0 C |  SYSTEM_INPUT.ID_0D :        FF1916 C |
 SYSTEM_INPUT.LIST :         FF18F6 C |  SYSTEM_INPUT.OLDPAD :       FF198E C |
 SYSTEM_INPUT.PICK_ID :      FF1994 C |  SYSTEM_INPUT.READ :         FF19AA C |
 SYSTEM_INPUT.STEP_1 :       FF19B6 C |  SYSTEM_INPUT.STEP_2 :       FF19C2 C |
 SYSTEM_INPUT.THIS_ONE :     FF18D6 C | *SYSTEM_INPUT.WAIT :         FF18C2 C |
 SYSTEM_JUMPRAMCODE :        FF1B96 C |
 SYSTEM_JUMPRAMCODE.COPYME2 :                                        FF1BA8 C |
*SYSTEM_RANDOM :             FF19C4 C |  SYSTEM_SETINTS :            FF1B20 C |
 SYSTEM_SETINTS.NOHINT :     FF1B44 C |  SYSTEM_SETINTS.NOVINT :     FF1B32 C |
*SYSTEM_SINEWAVE :           FF1A02 C |  SYSTEM_SINEWAVE.DONT_NEG :  FF1A1E C |
*SYSTEM_SINEWAVE_COS :       FF19E2 C |
 SYSTEM_SINEWAVE_COS.DONT_NEG :                                      FF19FC C |
*SYSTEM_SRAMINIT :           FF1B46 C |  SYSTEM_SRAMINIT.INITSAVE :  FF1B5A C |
 SYSTEM_VSYNC :              FF1B6E C |  SYSTEM_VSYNC.INSIDE :       FF1B88 C |
 SYS_CTRL_1 :                A10009 - |  SYS_CTRL_2 :                A1000B - |
 SYS_CTRL_3 :                A1000D - | *SYS_DATA_1 :                A10003 - |
*SYS_DATA_2 :                A10005 - | *SYS_DATA_3 :                A10007 - |
*SYS_EXRAM :                 200000 - | *SYS_IO :                    A10001 - |
*SYS_TMSS :                  A14000 - |  S_IRQ_BAD :                60004CE C |
 S_IRQ_CMD :                60004F8 C | *S_IRQ_CMD.CANTUPD :        6000514 C |
 S_IRQ_CUSTOM :             6001254 C |  S_IRQ_H :                  6000542 C |
 S_IRQ_PWM :                60004D4 C |  S_IRQ_PWM.EXIT :           60004E6 C |
 S_IRQ_V :                  600055C C |  S_IRQ_VRES :               6000570 C |
 S_IRQ_VRES.MARS_RESET :    60005BA C |  S_IRQ_VRES.MD_RESET :      6000588 C |
 S_IRQ_VRES.SH_WAIT :       6000594 C |  S_IRQ_VRES.VRESLOOP :      60005C2 C |
 TBLFM :                       19FE C |  TBLFM3 :                      1A1E C |
 TBLFM6 :                      1A26 C |  TBLPSG :                      19DC C |
 TBLPSGN :                     19F6 C |  TBLPWM :                      1A30 C |
 TESTMARS_BG :              205FF88 C |  TESTMARS_BG_PAL :          600400C C |
 TH :                      20000000 - | *THISCODE_TOP :              FF1BE4 C |
 THISCODE_TOP.INSIDE :       FF1CCA C |  THISCODE_TOP.LEL :          FF1D6E C |
 THISCODE_TOP.LIST :         FF1CEA C |  THISCODE_TOP.LOOP :         FF1C48 C |
 THISCODE_TOP.MIDSHK :       FF1CA0 C |  THISCODE_TOP.MODE0 :        FF1CF6 C |
 THISCODE_TOP.MODE0_LOOP :   FF1D08 C |  THISCODE_TOP.MODE1 :        FF1D70 C |
 THISCODE_TOP.MODE1_LOOP :   FF1D86 C |  THISCODE_TOP.NOA :          FF1E6E C |
 THISCODE_TOP.NOB :          FF1E5E C |  THISCODE_TOP.NOC_C :        FF1E9E C |
 THISCODE_TOP.NOC_UP :       FF1DC4 C |  THISCODE_TOP.NOD2 :         FF1E32 C |
 THISCODE_TOP.NOD_M :        FF1D5E C |  THISCODE_TOP.NOL :          FF1E7E C |
 THISCODE_TOP.NOL_M :        FF1D4E C |  THISCODE_TOP.NOR :          FF1E8E C |
 THISCODE_TOP.NOR_M :        FF1D3E C |  THISCODE_TOP.NOU2 :         FF1E18 C |
 THISCODE_TOP.NOU_M :        FF1D6E C |  THISCODE_TOP.NOX2 :         FF1DFE C |
 THISCODE_TOP.NOY2 :         FF1DE2 C |  THISCODE_TOP.NO_MODE0 :     FF1D1E C |
 THISCODE_TOP.NO_MODE1 :     FF1D9C C |  THISCODE_TOP.PRINT_CURSOR : FF1EA0 C |
 THISCODE_TOP.PROCS_TASK :   FF1EC4 C |  THISCODE_TOP.REVERS :       FF1CBE C |
 THISCODE_TOP.SAME_W :       FF1CCA C |  THISCODE_TOP.TASKLIST :     FF1ED2 C |
 THISCODE_TOP.TASK_00 :      FF1EDE C |  THISCODE_TOP.TASK_01 :      FF1EFA C |
 THISCODE_TOP.TASK_02 :      FF1EFE C |  THISCODE_TOP.TASK_03 :      FF1F02 C |
 THISCODE_TOP.TASK_04 :      FF1F06 C |  THISCODE_TOP.TASK_05 :      FF1F0E C |
 THISCODE_TOP.TOPTRK :       FF1E42 C |  THISCODE_TOP.TOPTRK2 :      FF1E4E C |
 THISCODE_TOP.WAIT :         FF1DA8 C |  TICKCNT :                     19CF C |
 TICKFLAG :                    19CD C | *TIME :                    18:46:48 - |
 TIMERCTL :                      30 - | *TMR :                           2C - |
 TRACK_OUT :                    4AA C |  TRACK_OUT.CLRFE :              4B9 C |
 TRACK_OUT.NOCHIP :             4D2 C |  TRANSFERROM :                 103A C |
 TRANSFERROM.DOUBLE :          1059 C |  TRANSFERROM.TRANSFER :        107E C |
 TRANSFERROM.X68KLAST :        109D C |  TRANSFERROM.X68KLOOP :        108C C |
 TRANSFERROM.X68KLPCONT :      1095 C |  TRANSFERROM.X68KLPWT :        10AF C |
 TRANSFERROM.X68KLSTCONT :     10A7 C |  TRANSFERROM.X68KLSTWT :       10C2 C |
 TRANSFERROM.X68KLSTWTLP :     10C6 C |  TRANSFERROM.X68KNOCARRY :     1078 C |
 TRANSFERROM.X68KPWTLP :       10B3 C |  TRKBUFF_0 :                   1E00 C |
 TRKBUFF_1 :                   1F00 C |  TRKDATA_0 :                   1C00 C |
 TRKDATA_1 :                   1D00 C |  TRKHDOUT :                    1EFA C |
 TRKOUT_UNLK :                  4DE C |  TRKOUT_UNLK.ISPSG_C :          517 C |
 TRKOUT_UNLK.IS_FM :            52F C |  TRKOUT_UNLK.IS_PSG :           503 C |
 TRKOUT_UNLK.IS_PSGN :          514 C |  TRKOUT_UNLK.IS_PWM :           52A C |
 TRKOUT_UNLK.TLB_CONT :         532 C |  TRKPOINTERS :                 18BD C |
 TRK_CACHNOTES :                 1A - |  TRK_CURRBLK :                   11 - |
 TRK_HALFWAY :                   10 - | *TRK_HDHALFWAY :                 19 - |
 TRK_NUMCHNLS :                  16 - |  TRK_READ :                       C - |
 TRK_ROMBLK :                     0 - |  TRK_ROMINS :                     6 - |
 TRK_ROMPATT :                    3 - |  TRK_ROMPATTRD :                  9 - |
 TRK_ROWPAUSE :                  18 - |  TRK_ROWS :                       E - |
 TRK_SETBLK :                    12 - |  TRK_SIZEINS :                   17 - |
 TRK_STATUS :                    13 - |  TRK_TICKSET :                   15 - |
 TRK_TICKTMR :                   14 - | *TRUE :                           1 - |
*TVMODE :                         0 - |  UPDTRACK :                     1CF C |
 UPDTRACK.CLRF :                446 C |  UPDTRACK.DECROW :              24E C |
 UPDTRACK.DECROW_E :            251 C | *UPDTRACK.DNTSLNCE :            453 C |
 UPDTRACK.EFFECT_FILL :         420 C |  UPDTRACK.EFF_A :               349 C |
 UPDTRACK.EFF_B :               353 C |  UPDTRACK.EFF_C :               36D C |
 UPDTRACK.EXIT :                243 C |  UPDTRACK.FIRST_FILL :          42C C |
 UPDTRACK.GO_EFFECT :           466 C |  UPDTRACK.GRAB_ASAP :           31A C |
 UPDTRACK.HAS_NOTE :            25A C |  UPDTRACK.INC_CPATT :           2FD C |
 UPDTRACK.NEXT_NOTE :           231 C |  UPDTRACK.NEXT_TRACK :          378 C |
 UPDTRACK.NO_EFF :              2BE C |  UPDTRACK.NO_INS :              2A0 C |
 UPDTRACK.NO_NOTE :             295 C |  UPDTRACK.NO_VOL :              2AC C |
 UPDTRACK.OLD_TYPE :            289 C |  UPDTRACK.READ_TRACK :          1E9 C |
 UPDTRACK.RNOUT_CHNLS :         2F9 C |  UPDTRACK.SET_TRACK :           37F C |
 UPDTRACK.SFXMD :               1FE C |  UPDTRACK.SZGOOD :              3F7 C |
 UPDTRACK.SZMUCH :              3F2 C |  UPDTRACK.TRACK_END :           493 C |
 UPDTRACK.TRKEND_EFFC :         494 C |  VARNULLVRAM :                  7FF - |
*VAR_MOVESPD :                 4000 - | *VBLK :                          80 - |
 VDPSTS :                         A - |  VDP_CTRL :                  C00004 - |
 VDP_DATA :                  C00000 - | *VERSION :                     142F - |
 VIDEO_CLEAR :               FF0274 C | *VIDEO_COPY :                FF05D4 C |
 VIDEO_COPY.DMAW :           FF05E8 C |  VIDEO_COPY.DMAWE :          FF0642 C |
 VIDEO_DMABLAST :            FF065A C |  VIDEO_DMABLAST.END :        FF06B8 C |
 VIDEO_DMABLAST.EXIT :       FF06D6 C |  VIDEO_DMABLAST.NEXT :       FF0692 C |
 VIDEO_DMASET :              FF06D8 C |  VIDEO_FILL :                FF0560 C |
 VIDEO_FILL.DMAW :           FF0574 C |  VIDEO_FILL.DMAWE :          FF05BC C |
 VIDEO_INIT :                FF023E C |  VIDEO_INIT.CLRRAM :         FF0248 C |
*VIDEO_INIT.EXIT :           FF0272 C |  VIDEO_INIT.LOOP :           FF0264 C |
 VIDEO_LOADART :             FF074A C |  VIDEO_LOADART.FROM_RAM :    FF07F8 C |
*VIDEO_LOADMAP :             FF030C C |  VIDEO_LOADMAP.CONT :        FF0332 C |
 VIDEO_LOADMAP.NODBLE :      FF0352 C |  VIDEO_LOADMAP.NONULL :      FF0330 C |
 VIDEO_LOADMAP.XLOOP :       FF0322 C |  VIDEO_LOADMAP.YLOOP :       FF0318 C |
 VIDEO_LOADPAL :             FF02E2 C |  VIDEO_LOADPAL.LOOP :        FF0304 C |
 VIDEO_LOADPAL.OUTV :        FF02FA C |  VIDEO_PRINT :               FF038C C |
 VIDEO_PRINT.DONIBL :        FF04A6 C |  VIDEO_PRINT.EXIT :          FF0416 C |
 VIDEO_PRINT.ISBYTE :        FF03E0 C |  VIDEO_PRINT.ISLONG :        FF0404 C |
 VIDEO_PRINT.ISWORD :        FF03F2 C |  VIDEO_PRINT.LNGLOOP :       FF0496 C |
 VIDEO_PRINT.LOOP :          FF03A0 C |  VIDEO_PRINT.LOWR :          FF04B6 C |
 VIDEO_PRINT.NEWJUMP :       FF039A C |  VIDEO_PRINT.NEXT :          FF03C2 C |
 VIDEO_PRINT.NEXTV :         FF0420 C |  VIDEO_PRINT.NOTHING :       FF04C2 C |
 VIDEO_PRINT.PUTTEXT :       FF03B4 C |  VIDEO_PRINT.SPECIAL :       FF03C6 C |
 VIDEO_PRINT.VBYTE :         FF0452 C |  VIDEO_PRINT.VLONG :         FF049E C |
 VIDEO_PRINT.VWORD :         FF0474 C |  VIDEO_PRINTINIT :           FF0364 C |
 VIDEO_UPDATE :              FF02C2 C | *VIDEO_UPDATE.EXIT :         FF02E0 C |
 VIDEO_UPDATE.LOOP :         FF02D4 C |  VID_PICKLAYER :             FF04C4 C |
 VID_PICKLAYER.GOLYR :       FF0514 C |  VID_PICKLAYER.NOWD :        FF04FE C |
 VID_PICKLAYER.PLAWND :      FF04EC C |  VID_PICKLAYER.THISSZ :      FF0534 C |
 VID_PICKLAYER.THISSZJ :     FF055C C |  VINTCLR :                       16 - |
*VINTENBL :                      20 - |  VINT_DEFAULT :              FF1BCA C |
 VIRQ_ON :                        8 - |  VRESINTCLR :                    14 - |
 WAVE_FLAGS :                  19DB C |  WAVE_LEN :                    19D3 C |
 WAVE_LOOP :                   19D6 C |  WAVE_PITCH :                  19D9 C |
 WAVE_START :                  19D0 C |  WAVFREQ_LIST :                1678 C |
*WHDFLG :                      1790 C |  X68KSRCLSB :                  19C1 C |
 X68KSRCMID :                  19C2 C | *YM_CTRL_1 :                 A04000 - |
*YM_CTRL_2 :                 A04002 - | *YM_DATA_1 :                 A04001 - |
*YM_DATA_2 :                 A04003 - |  Z80_BUS :                   A11100 - |
 Z80_CODE :                    251C C |  Z80_CODE_END :                44CC C |
 Z80_CPU :                   A00000 - |  Z80_INIT :                      3E C |
 Z80_RESET :                 A11200 - | *ZBANK :                       6000 - |
*ZOPCEX :                         8 - |  ZOPCEXX :                       D9 - |
*ZOPCNOP :                        0 - |  ZOPCPUSHAF :                    F5 - |
 ZOPCRET :                       C9 - |  ZPSG_CTRL :                   7F11 - |
 ZSET_TESTME :                    0 - |  ZSET_WTUNE :      FFFFFFFFFFFFFFE8 - |
 ZYM_CTRL_1 :                  4000 - |  ZYM_CTRL_2 :                  4002 - |
 ZYM_DATA_1 :                  4001 - |  ZYM_DATA_2 :                  4003 - |
 _CCR :                    FFFFFE92 - |  _DMACHANNEL0 :            FFFFFF8C - |
*_DMACHANNEL1 :            FFFFFF9C - | *_DMACOUNT0 :              FFFFFF88 - |
*_DMACOUNT1 :              FFFFFF98 - | *_DMADEST0 :               FFFFFF84 - |
*_DMADEST1 :               FFFFFF94 - |  _DMAOPERATION :           FFFFFFB0 - |
*_DMAREQACK0 :             FFFFFFB4 - | *_DMAREQACK1 :             FFFFFFB8 - |
*_DMASOURCE0 :             FFFFFF80 - | *_DMASOURCE1 :             FFFFFF90 - |
*_DMAVECTORE0 :            FFFFFFA4 - | *_DMAVECTORE1 :            FFFFFFAC - |
*_DMAVECTORN0 :            FFFFFFA0 - | *_DMAVECTORN1 :            FFFFFFA8 - |
 _FRAMEBUFFER :            24000000 - | *_FRC_H :                         2 - |
*_FRC_L :                         3 - |  _FRT :                    FFFFFE10 - |
*_HRH :                    FFFFFF10 - | *_HRL :                    FFFFFF14 - |
*_HRL32 :                  FFFFFF04 - | *_JR :                     FFFFFF00 - |
*_OCR_H :                         4 - | *_OCR_L :                         5 - |
*_OVERWRITE :              24020000 - |  _PALETTE :                20004200 - |
*_SERIAL :                 FFFFFE00 - |  _SYSREG :                 20004000 - |
*_TCR :                           6 - | *_TCSR :                          1 - |
*_TIER :                          0 - |  _TOCR :                          7 - |
 _VDPREG :                 20004100 - |

   1409 symbols
    254 unused symbols

 AS V1.42 Beta [Bld 118] - source file mars.asm - page 3 - 12/10/2021 18:46:49


  defined macros:
  ---------------

FINISH                                | GINSDAC                              
GINSFM                                | GINSFM3                              
GINSNULL                              | GINSPSG                              
GINSPSGN                              | GINSPWM                              
GSMPL                                 | ORG                                  
STRUCT                                |

     11 macros

 AS V1.42 Beta [Bld 118] - source file mars.asm - page 4 - 12/10/2021 18:46:49


  defined functions:
  ------------------

NOTZ80                                | LOCATE                               
MAPSIZE                               |

 AS V1.42 Beta [Bld 118] - source file mars.asm - page 5 - 12/10/2021 18:46:49


  codepages:
  ----------

STANDARD (0 changed characters)


0.21 seconds assembly time

  15079 lines source file
  15575 lines incl. macro expansions
      7 passes
      0 errors
      0 warnings
