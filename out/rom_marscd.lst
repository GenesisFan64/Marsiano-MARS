 AS V1.42 Beta [Bld 118] - source file main.asm - page 1 - 7/19/2023 0:10:13


       1/       0 :                     ; ===========================================================================
       2/       0 :                     ; +-----------------------------------------------------------------+
       3/       0 :                     ; PROJECT MARSIANO
       4/       0 :                     ; +-----------------------------------------------------------------+
       5/       0 :                     
       6/       0 :                     		!org 0				; Start at 0
       7/       0 :                     		cpu 		68000		; Current CPU is 68k, gets changed later.
       8/       0 :                     		padding		off		; Dont pad dc.b
       9/       0 :                     		listing 	purecode	; Want listing file, but only the final code in expanded macros
      10/       0 :                     		supmode 	on 		; Supervisor mode 68k
      11/       0 :                     		dottedstructs	off		; If needed
      12/       0 :                     		page 		0
      13/       0 :                     
      14/       0 :                     ; ====================================================================
      15/       0 :                     ; ----------------------------------------------------------------
      16/       0 :                     ; USER SETTINGS
      17/       0 :                     ; ----------------------------------------------------------------
      18/       0 :                     
      19/       0 :                     ; RAM Sizes
      20/       0 :                     ;
      21/       0 :                     ; MAKE SURE IT DOESN'T REACH FC00 FOR CROSS-PORTING
      22/       0 :                     ; TO SEGA-CD (And maybe SCD+32X)
      23/       0 :                     
      24/       0 : =$2000              MAX_SysCode	equ $2000
      25/       0 : =$2000              MAX_UserCode	equ $2000
      26/       0 :                     ; MAX_UserData	equ $4000
      27/       0 : =$2000              MAX_MdVideo	equ $2000
      28/       0 : =$800               MAX_MdSystem	equ $0800
      29/       0 : =$2000              MAX_MdOther	equ $2000	; 32X's DREQ data to send
      30/       0 : =$1000              MAX_MdGlobal	equ $1000	; USER Global variables
      31/       0 : =$2000              MAX_ScrnBuff	equ $2000	; RAM section for current screen ONLY
      32/       0 :                     
      33/       0 :                     ; ====================================================================
      34/       0 :                     ; ----------------------------------------------------------------
      35/       0 :                     ; Includes
      36/       0 :                     ; ----------------------------------------------------------------
      37/       0 :                     
      38/       0 :                     		include	"macros.asm"			; Assembler macros
(1)    1/       0 :                     ; ===========================================================================
(1)    2/       0 :                     ; ----------------------------------------------------------------
(1)    3/       0 :                     ; MACROS
(1)    4/       0 :                     ; ----------------------------------------------------------------
(1)    5/       0 :                     
(1)    6/       0 :                     ; ====================================================================
(1)    7/       0 :                     ; ---------------------------------------------
(1)    8/       0 :                     ; Functions
(1)    9/       0 :                     ; ---------------------------------------------
(1)   10/       0 :                     
(1)   11/       0 :                     dword 		function l,r,(l<<16&$FFFF0000|r&$FFFF)			; LLLL RRRR
(1)   12/       0 :                     mapsize		function l,r,(((l-1)/8)<<16&$FFFF0000|((r-1)/8)&$FFFF)	; Full w/h sizes, for cell sizes use doubleword
(1)   13/       0 :                     locate		function a,b,c,(c&$FF)|(b<<8&$FF00)|(a<<16&$FF0000)	; VDP locate: Layer|X pos|Y pos for some video routines
(1)   14/       0 :                     
(1)   15/       0 :                     ; ====================================================================
(1)   16/       0 :                     ; ---------------------------------------------
(1)   17/       0 :                     ; Macros
(1)   18/       0 :                     ; ---------------------------------------------
(1)   19/       0 :                     
(1)   20/       0 : =$0                 paddingSoFar set 0
(1)   21/       0 :                     notZ80 function cpu,(cpu<>128)&&(cpu<>32988)
(1)   22/       0 :                     
(1)   23/       0 :                     ; -------------------------------------
(1)   24/       0 :                     ; Reserve memory section
(1)   25/       0 :                     ;
(1)   26/       0 :                     ; NOTE: This doesn't work for Z80
(1)   27/       0 :                     ; -------------------------------------
(1)   28/       0 :                     
(1)   29/       0 :                     struct		macro thisinput			; Reserve memory address
(1)   30/       0 :                     GLBL_LASTPC	set *
(1)   31/       0 :                     		dephase
(1)   32/       0 :                     GLBL_LASTORG	set *
(1)   33/       0 :                     		phase thisinput
(1)   34/       0 :                     		endm
(1)   35/       0 :                     		
(1)   36/       0 :                     ; -------------------------------------
(1)   37/       0 :                     ; Finish struct
(1)   38/       0 :                     ; -------------------------------------
(1)   39/       0 :                     
(1)   40/       0 :                     endstruct	macro				; Then finish the custom struct.
(1)   41/       0 :                     		!org GLBL_LASTORG
(1)   42/       0 :                     		phase GLBL_LASTPC
(1)   43/       0 :                     		endm
(1)   44/       0 :                     
(1)   45/       0 :                     ; -------------------------------------
(1)   46/       0 :                     ; Report RAM usage
(1)   47/       0 :                     ; -------------------------------------
(1)   48/       0 :                     
(1)   49/       0 :                     report		macro text,dis,dat
(1)   50/       0 :                     	if MOMPASS == 2
(1)   51/       0 :                     		if dat == -1
(1)   52/       0 :                     			message text+": \{(dis)&$FFFFFF}"
(1)   53/       0 :                     		else
(1)   54/       0 :                     			if dis > dat
(1)   55/       0 :                     				error "RAN OUT OF "+text
(1)   56/       0 :                     			else
(1)   57/       0 :                     				message text+" uses \{(dis)&$FFFFFF} of \{(dat)&$FFFFFF}"
(1)   58/       0 :                     			endif
(1)   59/       0 :                     		endif
(1)   60/       0 :                     	endif
(1)   61/       0 :                     		endm
(1)   62/       0 :                     
(1)   63/       0 :                     ; -------------------------------------
(1)   64/       0 :                     ; Color debug
(1)   65/       0 :                     ; -------------------------------------
(1)   66/       0 :                     
(1)   67/       0 :                     colorme		macro this
(1)   68/       0 :                     		move.l	#$C0000000,(vdp_ctrl).l
(1)   69/       0 :                     		move.w	#this,(vdp_data).l
(1)   70/       0 :                     		endm
(1)   71/       0 :                     
(1)   72/       0 :                     ; -------------------------------------
(1)   73/       0 :                     ; Custom ORG-filler
(1)   74/       0 :                     ;
(1)   75/       0 :                     ; (from s2disasm)
(1)   76/       0 :                     ; -------------------------------------
(1)   77/       0 :                     
(1)   78/       0 :                     org macro address
(1)   79/       0 :                     	if notZ80(MOMCPU)
(1)   80/       0 :                     		if address < *
(1)   81/       0 :                     			error "too much stuff before org $\{address} ($\{(*-address)} bytes)"
(1)   82/       0 :                     		elseif address > *
(1)   83/       0 :                     paddingSoFar	set paddingSoFar + address - *
(1)   84/       0 :                     			!org address
(1)   85/       0 :                     		endif
(1)   86/       0 :                     	else
(1)   87/       0 :                     		if address < $
(1)   88/       0 :                     			error "too much stuff before org 0\{address}h (0\{($-address)}h bytes)"
(1)   89/       0 :                     		else
(1)   90/       0 :                     			while address > $
(1)   91/       0 :                     				db 0
(1)   92/       0 :                     			endm
(1)   93/       0 :                     		endif
(1)   94/       0 :                     	endif
(1)   95/       0 :                         endm
(1)   96/       0 :                     
(1)   97/       0 :                     ; ====================================================================
(1)   98/       0 :                     ; ---------------------------------------------
(1)   99/       0 :                     ; ISO filesystem macros
(1)  100/       0 :                     ; ---------------------------------------------
(1)  101/       0 :                     
(1)  102/       0 :                     ; Set a ISO file
(1)  103/       0 :                     ; NOTE: a valid ISO head is required ($8000 to $B7FF)
(1)  104/       0 :                     
(1)  105/       0 :                     iso_setfs	macro type,start,end
(1)  106/       0 :                     .fstrt:		dc.b .fend-.fstrt				; Block size
(1)  107/       0 :                     		dc.b 0						; zero
(1)  108/       0 :                     		dc.b (start>>11&$FF),(start>>19&$FF)		; Start sector, little
(1)  109/       0 :                     		dc.b (start>>27&$FF),(start>>35&$FF)
(1)  110/       0 :                     		dc.l start>>11					; Start sector, big
(1)  111/       0 :                     		dc.b ((end-start)&$FF),((end-start)>>8&$FF)	; Filesize, little
(1)  112/       0 :                     		dc.b ((end-start)>>16&$FF),((end-start)>>24&$FF)
(1)  113/       0 :                     		dc.l end-start					; Filesize, big
(1)  114/       0 :                     		dc.b (2018-1900)+1				; Year
(1)  115/       0 :                     		dc.b 0,0,0,0,0,0				; TODO
(1)  116/       0 :                     		dc.b 2						; File flags
(1)  117/       0 :                     		dc.b 0,0
(1)  118/       0 :                     		dc.b 1,0					; Volume sequence number, little
(1)  119/       0 :                     		dc.b 0,1					; Volume sequence number, big
(1)  120/       0 :                     		dc.b 1,type
(1)  121/       0 :                     .fend:
(1)  122/       0 :                     		endm
(1)  123/       0 :                     
(1)  124/       0 :                     iso_file	macro filename,start,end
(1)  125/       0 :                     .fstrt:		dc.b .fend-.fstrt				; Block size
(1)  126/       0 :                     		dc.b 0						; zero
(1)  127/       0 :                     		dc.b (start>>11&$FF),(start>>19&$FF)		; Start sector, little
(1)  128/       0 :                     		dc.b (start>>27&$FF),(start>>35&$FF)
(1)  129/       0 :                     		dc.l start>>11					; Start sector, big
(1)  130/       0 :                     		dc.b ((end-start)&$FF),((end-start)>>8&$FF)	; Filesize, little
(1)  131/       0 :                     		dc.b ((end-start)>>16&$FF),((end-start)>>24&$FF)
(1)  132/       0 :                     		dc.l end-start					; Filesize, big
(1)  133/       0 :                     		dc.b (2023-1900)+1				; Year
(1)  134/       0 :                     		dc.b 0,0,0,0,0,0				; TODO
(1)  135/       0 :                     		dc.b 0						; File flags
(1)  136/       0 :                     		dc.b 0,0
(1)  137/       0 :                     		dc.b 1,0					; Volume sequence number, little
(1)  138/       0 :                     		dc.b 0,1					; Volume sequence number, big
(1)  139/       0 :                     		dc.b .flend-.flen
(1)  140/       0 :                     .flen:		dc.b filename,";1"
(1)  141/       0 :                     .flend:		dc.b 0
(1)  142/       0 :                     .fend:
(1)  143/       0 :                     		endm
(1)  144/       0 :                     
(1)  145/       0 :                     
      39/       0 :                     		include	"system/shared.asm"		; Shared Genesis/32X variables
(1)    1/       0 :                     ; ====================================================================
(1)    2/       0 :                     ; ----------------------------------------------------------------
(1)    3/       0 :                     ; MD/32X shared structs and values
(1)    4/       0 :                     ; ----------------------------------------------------------------
(1)    5/       0 :                     
(1)    6/       0 :                     ; ====================================================================
(1)    7/       0 :                     ; --------------------------------------------------------
(1)    8/       0 :                     ; Settings
(1)    9/       0 :                     ; --------------------------------------------------------
(1)   10/       0 :                     
(1)   11/       0 : =$10                MAX_MODELS	equ 16		; MAX 3D Models
(1)   12/       0 : =$18                MAX_SUPERSPR	equ 24		; MAX Number of Super Sprites
(1)   13/       0 :                     
(1)   14/       0 :                     ; --------------------------------------------------------
(1)   15/       0 :                     ; Structs
(1)   16/       0 :                     ; --------------------------------------------------------
(1)   17/       0 :                     
(1)   18/       0 :                     ; 3D Models
(1)   19/       0 :                     ; RAM_MdDreq+Dreq_Objects
(1)   20/       0 : (MACRO)             		struct 0
(1)   20/       0 : =$0                 GLBL_LASTPC     set *
(1)   20/       0 :                                     dephase
(1)   20/       0 : =$0                 GLBL_LASTORG    set *
(1)   20/       0 :                                     phase 0
(1)   21/       0 :                     mdl_data	ds.l 1		; Model data pointer, if zero: no model
(1)   22/       4 :                     mdl_option	ds.l 1		; Model options: pixelvalue increment
(1)   23/       8 :                     mdl_x_pos	ds.w 1		; X position $08.00
(1)   24/       A :                     mdl_y_pos	ds.w 1		; Y position $08.00
(1)   25/       C :                     mdl_z_pos	ds.w 1		; Z position $08.00
(1)   26/       E :                     mdl_x_rot	ds.w 1		; X rotation $08.00
(1)   27/      10 :                     mdl_y_rot	ds.w 1		; Y rotation $08.00
(1)   28/      12 :                     mdl_z_rot	ds.w 1		; Z rotation $08.00
(1)   29/      14 :                     mdl_frame	ds.w 1
(1)   30/      16 :                     mdl_flags	ds.w 1
(1)   31/      18 :                     sizeof_mdlobj	ds.l 0
(1)   32/      18 : (MACRO)             		endstruct
(1)   32/       0 :                                     !org GLBL_LASTORG
(1)   32/       0 :                                     phase GLBL_LASTPC
(1)   33/       0 :                     
(1)   34/       0 :                     ; 3D Camera
(1)   35/       0 :                     ; RAM_MdDreq+Dreq_ObjCam
(1)   36/       0 : (MACRO)             		struct 0
(1)   36/       0 : =$0                 GLBL_LASTPC     set *
(1)   36/       0 :                                     dephase
(1)   36/       0 : =$0                 GLBL_LASTORG    set *
(1)   36/       0 :                                     phase 0
(1)   37/       0 :                     cam_x_pos	ds.l 1		; X position $000000.00
(1)   38/       4 :                     cam_y_pos	ds.l 1		; Y position $000000.00
(1)   39/       8 :                     cam_z_pos	ds.l 1		; Z position $000000.00
(1)   40/       C :                     cam_x_rot	ds.l 1		; X rotation $000000.00
(1)   41/      10 :                     cam_y_rot	ds.l 1		; Y rotation $000000.00
(1)   42/      14 :                     cam_z_rot	ds.l 1		; Z rotation $000000.00
(1)   43/      18 :                     sizeof_camera	ds.l 0
(1)   44/      18 : (MACRO)             		endstruct
(1)   44/       0 :                                     !org GLBL_LASTORG
(1)   44/       0 :                                     phase GLBL_LASTPC
(1)   45/       0 :                     
(1)   46/       0 :                     ; "Super" sprites:
(1)   47/       0 :                     ; RAM_MdDreq+Dreq_SuperSpr
(1)   48/       0 :                     ;
(1)   49/       0 :                     ; ** = KEEP the order
(1)   50/       0 : (MACRO)             		struct 0
(1)   50/       0 : =$0                 GLBL_LASTPC     set *
(1)   50/       0 :                                     dephase
(1)   50/       0 : =$0                 GLBL_LASTORG    set *
(1)   50/       0 :                                     phase 0
(1)   51/       0 :                     marsspr_xfrm	ds.b 1		; Animation X frame pos **
(1)   52/       1 :                     marsspr_yfrm	ds.b 1		; Animation Y frame pos **
(1)   53/       2 :                     marsspr_xs	ds.b 1		; Sprite X size **
(1)   54/       3 :                     marsspr_ys	ds.b 1		; Sprite Y size **
(1)   55/       4 :                     marsspr_x	ds.w 1		; Screen X position **
(1)   56/       6 :                     marsspr_y	ds.w 1		; Screen Y position **
(1)   57/       8 :                     marsspr_dwidth	ds.w 1		; Spritesheet WIDTH
(1)   58/       A :                     marsspr_indx	ds.w 1		; Palette index base
(1)   59/       C :                     marsspr_flags	ds.w 1		; Sprite flags: %VH (flip)
(1)   60/       E :                     marsspr_fill	ds.w 1		; <-- 2 FILLER bytes: free to use
(1)   61/      10 :                     marsspr_data	ds.l 1		; Spritesheet address in SH2 area (0 == end-of-supersprites)
(1)   62/      14 :                     ; marsspr_map	ds.l 1		; MAP data
(1)   63/      14 :                     sizeof_marsspr	ds.l 0
(1)   64/      14 : (MACRO)             		endstruct
(1)   64/       0 :                                     !org GLBL_LASTORG
(1)   64/       0 :                                     phase GLBL_LASTPC
(1)   65/       0 :                     
(1)   66/       0 :                     ; ====================================================================
(1)   67/       0 :                     ; ----------------------------------------------------------------
(1)   68/       0 :                     ; MAIN DREQ-RAM control
(1)   69/       0 :                     ;
(1)   70/       0 :                     ; To read these labels:
(1)   71/       0 :                     ;
(1)   72/       0 :                     ; On the Genesis Side:
(1)   73/       0 :                     ; 	lea	(RAM_MdDreq+DREQ_LABEL),a0
(1)   74/       0 :                     ; On the 32X Side:
(1)   75/       0 :                     ; 	mov	#RAM_Mars_DreqRead+DREQ_LABEL,r1
(1)   76/       0 :                     ;
(1)   77/       0 :                     ; Call System_MarsUpdate DURING DISPLAY to transfer your
(1)   78/       0 :                     ; changes.
(1)   79/       0 :                     ; ----------------------------------------------------------------
(1)   80/       0 :                     
(1)   81/       0 :                     ; *** List MUST be aligned in 8bytes, end with 0 or 8 ***
(1)   82/       0 :                     
(1)   83/       0 : (MACRO)             		struct 0
(1)   83/       0 : =$0                 GLBL_LASTPC     set *
(1)   83/       0 :                                     dephase
(1)   83/       0 : =$0                 GLBL_LASTORG    set *
(1)   83/       0 :                                     phase 0
(1)   84/       0 :                     Dreq_Palette	ds.w 256				; 256-color palette
(1)   85/     200 :                     Dreq_BgExBuff	ds.b $80				; Buffer for current screen mode (NOTE: manual size)
(1)   86/     280 :                     Dreq_ObjCam	ds.b sizeof_camera
(1)   87/     298 :                     Dreq_Objects	ds.b sizeof_mdlobj*MAX_MODELS		; 3D Objects
(1)   88/     418 :                     Dreq_SuperSpr	ds.b sizeof_marsspr*MAX_SUPERSPR	; Super sprites
(1)   89/     5F8 :                     sizeof_dreq	ds.l 0
(1)   90/     5F8 : (MACRO)             		endstruct
(1)   90/       0 :                                     !org GLBL_LASTORG
(1)   90/       0 :                                     phase GLBL_LASTPC
(1)   91/       0 :                     
(1)   95/       0 :                     
      40/       0 :                     		include	"system/md/map.asm"		; Genesis hardware map
(1)    1/       0 :                     ; ====================================================================
(1)    2/       0 :                     ; ----------------------------------------------------------------
(1)    3/       0 :                     ; Genesis / MegaDrive 68k map
(1)    4/       0 :                     ; ----------------------------------------------------------------
(1)    5/       0 :                     
(1)    6/       0 : =$200000            sys_exram	equ	$200000		; Second half of 4MB rom or external RAM (Normal or save data)
(1)    7/       0 : =$A00000            z80_cpu		equ	$A00000		; Z80 CPU area, size: $2000
(1)    8/       0 : =$A04000            ym_ctrl_1	equ	$A04000		; YM2612 reg 1
(1)    9/       0 : =$A04001            ym_data_1	equ	$A04001		; YM2612 reg 2
(1)   10/       0 : =$A04002            ym_ctrl_2	equ	$A04002		; YM2612 reg 1
(1)   11/       0 : =$A04003            ym_data_2	equ	$A04003		; YM2612 reg 2
(1)   12/       0 : =$A10001            sys_io		equ	$A10001		; bits: OVRSEAS(7)|PAL(6)|DISK(5)|VER(3-0)
(1)   13/       0 : =$A10003            sys_data_1	equ	$A10003		; Port 1 DATA
(1)   14/       0 : =$A10005            sys_data_2	equ	$A10005		; Port 2 DATA
(1)   15/       0 : =$A10007            sys_data_3	equ	$A10007		; Modem DATA
(1)   16/       0 : =$A10009            sys_ctrl_1	equ	$A10009		; Port 1 CTRL
(1)   17/       0 : =$A1000B            sys_ctrl_2	equ	$A1000B		; Port 2 CTRL
(1)   18/       0 : =$A1000D            sys_ctrl_3	equ	$A1000D		; Modem CTRL
(1)   19/       0 : =$A11100            z80_bus 	equ	$A11100		; only use bit 0 (bit 8 as WORD)
(1)   20/       0 : =$A11200            z80_reset	equ	$A11200		; WRITE only ($0000 reset/$0100 cancel)
(1)   21/       0 : =$A130F1            md_bank_sram	equ	$A130F1		; Make SRAM visible at $200000
(1)   22/       0 : =$A14000            sys_tmss	equ	$A14000		; write "SEGA" here for ver > 0
(1)   23/       0 : =$C00000            vdp_data	equ	$C00000		; video data port
(1)   24/       0 : =$C00004            vdp_ctrl	equ	$C00004		; video control port
(1)   25/       0 : =$C00011            psg_ctrl	equ	$C00011		; PSG control
(1)   26/       0 :                     
(1)   27/       0 :                     ; ----------------------------------------------------------------
(1)   28/       0 :                     ; SEGA CD map
(1)   29/       0 :                     ; ----------------------------------------------------------------
(1)   30/       0 :                     
(1)   31/       0 : =$200000            sysmcd_wram	equ	$200000
(1)   32/       0 : =$A12000            sysmcd_reg	equ	$A12000
(1)   33/       0 :                     
(1)   34/       0 :                     ; ----------------------------------------------------------------
(1)   35/       0 :                     ; 32X map
(1)   36/       0 :                     ; ----------------------------------------------------------------
(1)   37/       0 :                     
(1)   38/       0 : =$A130EC            sysmars_id	equ	$A130EC		; 32X's ID: "MARS"
(1)   39/       0 : =$A15100            sysmars_reg	equ	$A15100		; MARS 32X registers section, see system/mars/map.asm for variables
(1)   40/       0 :                     
(1)   41/       0 :                     ; ----------------------------------------------------------------
(1)   42/       0 :                     ; Genesis / Mega drive Z80 map
(1)   43/       0 :                     ; ----------------------------------------------------------------
(1)   44/       0 :                     
(1)   45/       0 : =$4000              zym_ctrl_1	equ	$4000		; YM2612 reg 1
(1)   46/       0 : =$4001              zym_data_1	equ	$4001		; YM2612 reg 2
(1)   47/       0 : =$4002              zym_ctrl_2	equ	$4002		; YM2612 reg 1
(1)   48/       0 : =$4003              zym_data_2	equ	$4003		; YM2612 reg 2
(1)   49/       0 : =$6000              zbank		equ	$6000		; Z80 ROM BANK: %XXXXXXXX X0000000 00000000 (9-byte writes)
(1)   50/       0 :                     ; zvdp_data	equ	$7F00		; video data port
(1)   51/       0 :                     ; zvdp_ctrl	equ	$7F04		; video control port
(1)   52/       0 : =$7F11              zpsg_ctrl	equ	$7F11		; PSG control
(1)   53/       0 :                     
      41/       0 :                     		include	"system/md/const.asm"		; Genesis variables
(1)    1/       0 :                     ; ====================================================================
(1)    2/       0 :                     ; ----------------------------------------------------------------
(1)    3/       0 :                     ; Genesis side constants
(1)    4/       0 :                     ; ----------------------------------------------------------------
(1)    5/       0 :                     
(1)    6/       0 : =$10                MAX_MDDMATSK	equ 16			; MAX DMA BLAST entries
(1)    7/       0 :                     
(1)    8/       0 :                     ; ====================================================================
(1)    9/       0 :                     ; ----------------------------------------------------------------
(1)   10/       0 :                     ; Input
(1)   11/       0 :                     ; ----------------------------------------------------------------
(1)   12/       0 :                     
(1)   13/       0 :                     ; --------------------------------------------------------
(1)   14/       0 :                     ; Controller
(1)   15/       0 :                     ; --------------------------------------------------------
(1)   16/       0 :                     
(1)   17/       0 :                     ; Controller buffer data (after calling System_Input)
(1)   18/       0 :                     ;
(1)   19/       0 :                     ; Type/Revision byte:
(1)   20/       0 :                     ;
(1)   21/       0 :                     ; ID    |
(1)   22/       0 :                     ; $0D   | $00 - Original 3 button
(1)   23/       0 :                     ;       | $01 - 6 button version: XYZM
(1)   24/       0 :                     
(1)   25/       0 : (MACRO)             		struct 0
(1)   25/       0 : =$0                 GLBL_LASTPC     set *
(1)   25/       0 :                                     dephase
(1)   25/       0 : =$0                 GLBL_LASTORG    set *
(1)   25/       0 :                                     phase 0
(1)   26/       0 :                     pad_id		ds.b 1			; Controller ID
(1)   27/       1 :                     pad_ver		ds.b 1			; Controller type/revision
(1)   28/       2 :                     on_hold		ds.w 1			; User HOLD bits
(1)   29/       4 :                     on_press	ds.w 1			; User PRESSED bits
(1)   30/       6 :                     mouse_x		ds.w 1			; Mouse X add/sub
(1)   31/       8 :                     mouse_y		ds.w 1			; Mouse Y add/sub
(1)   32/       A :                     extr_3		ds.w 1
(1)   33/       C :                     extr_4		ds.w 1
(1)   34/       E :                     extr_5		ds.w 1
(1)   35/      10 :                     sizeof_input	ds.l 0
(1)   36/      10 : (MACRO)             		endstruct
(1)   36/       0 :                                     !org GLBL_LASTORG
(1)   36/       0 :                                     phase GLBL_LASTPC
(1)   37/       0 :                     
(1)   38/       0 :                     ; Read as (Controller_1) then add +on_hold or +on_press
(1)   39/       0 : =$FFFFFFFFFF..      Controller_1	equ RAM_InputData
(1)   40/       0 : =$FFFFFFFFFF..      Controller_2	equ RAM_InputData+sizeof_input
(1)   41/       0 :                     
(1)   42/       0 :                     ; Read WORD in +on_hold or +on_press
(1)   43/       0 : =$1                 JoyUp		equ $0001
(1)   44/       0 : =$2                 JoyDown		equ $0002
(1)   45/       0 : =$4                 JoyLeft		equ $0004
(1)   46/       0 : =$8                 JoyRight	equ $0008
(1)   47/       0 : =$10                JoyB		equ $0010
(1)   48/       0 : =$20                JoyC		equ $0020
(1)   49/       0 : =$40                JoyA		equ $0040
(1)   50/       0 : =$80                JoyStart	equ $0080
(1)   51/       0 : =$100               JoyZ		equ $0100
(1)   52/       0 : =$200               JoyY		equ $0200
(1)   53/       0 : =$400               JoyX		equ $0400
(1)   54/       0 : =$800               JoyMode		equ $0800
(1)   55/       0 : =$0                 bitJoyUp	equ 0		; READ THESE AS A WORD
(1)   56/       0 : =$1                 bitJoyDown	equ 1
(1)   57/       0 : =$2                 bitJoyLeft	equ 2
(1)   58/       0 : =$3                 bitJoyRight	equ 3
(1)   59/       0 : =$4                 bitJoyB		equ 4
(1)   60/       0 : =$5                 bitJoyC		equ 5
(1)   61/       0 : =$6                 bitJoyA		equ 6
(1)   62/       0 : =$7                 bitJoyStart	equ 7
(1)   63/       0 : =$8                 bitJoyZ		equ 8
(1)   64/       0 : =$9                 bitJoyY		equ 9
(1)   65/       0 : =$A                 bitJoyX		equ 10
(1)   66/       0 : =$B                 bitJoyMode	equ 11
(1)   67/       0 :                     
(1)   68/       0 :                     ; Mega Mouse
(1)   69/       0 :                     ; Read WORD as +on_hold or +on_press
(1)   70/       0 : =$1                 ClickR		equ $0001
(1)   71/       0 : =$2                 ClickL		equ $0002
(1)   72/       0 : =$4                 ClickM		equ $0004	; US MOUSE ONLY
(1)   73/       0 : =$8                 ClickS		equ $0008	; (Untested)
(1)   74/       0 : =$0                 bitClickR	equ 0
(1)   75/       0 : =$1                 bitClickL	equ 1
(1)   76/       0 : =$2                 bitClickM	equ 2
(1)   77/       0 : =$3                 bitClickS	equ 3
(1)   78/       0 :                     
      42/       0 :                     ; 		include	"system/mcd/const.asm"		; Sega CD variables
      43/       0 :                     		include	"system/md/ram.asm"		; Genesis RAM sections
(1)    1/       0 :                     ; ====================================================================
(1)    2/       0 :                     ; ----------------------------------------------------------------
(1)    3/       0 :                     ; MD RAM
(1)    4/       0 :                     ;
(1)    5/       0 :                     ; NOTE for porting this to Sega CD (or SegaCD+32X):
(1)    6/       0 :                     ;
(1)    7/       0 :                     ; Area $FFFD00 to $FFFDFF(aprox) is reserved
(1)    8/       0 :                     ; for the MAIN-CPU's vectors and misc things
(1)    9/       0 :                     ; ----------------------------------------------------------------
(1)   10/       0 :                     
(1)   11/       0 :                     ; Sega 32X
(1)   12/       0 : =$FFFFFFFFFF..      RAM_MdDreq		equ	RAM_MdOther
(1)   13/       0 :                     
(1)   14/       0 :                     ; --------------------------------------------------------
(1)   15/       0 :                     ; Settings
(1)   16/       0 :                     ; --------------------------------------------------------
(1)   17/       0 :                     
(1)   18/       0 :                     ; Quick
(1)   19/       0 : (MACRO)             			struct $FFFF0000
(1)   19/       0 : =$0                 GLBL_LASTPC     set *
(1)   19/       0 :                                     dephase
(1)   19/       0 : =$0                 GLBL_LASTORG    set *
(1)   19/FFFFFFFFFFFF0000 :                                     phase $FFFF0000
(1)   20/FFFFFFFFFFFF0000 :                     RAM_SystemCode		ds.b MAX_SysCode	;
(1)   21/FFFFFFFFFFFF2000 :                     RAM_UserCode		ds.b MAX_UserCode	;
(1)   22/FFFFFFFFFFFF4000 :                     ; RAM_UserData		ds.b MAX_UserData	;
(1)   23/FFFFFFFFFFFF4000 : (MACRO)             			endstruct
(1)   23/FFFFFFFFFFFF0000 :                                     !org GLBL_LASTORG
(1)   23/       0 :                                     phase GLBL_LASTPC
(1)   24/       0 : (MACRO)             			struct $FFFF8000
(1)   24/       0 : =$0                 GLBL_LASTPC     set *
(1)   24/       0 :                                     dephase
(1)   24/       0 : =$0                 GLBL_LASTORG    set *
(1)   24/FFFFFFFFFFFF8000 :                                     phase $FFFF8000
(1)   25/FFFFFFFFFFFF8000 :                     RAM_MdVideo		ds.b MAX_MdVideo	; $FF8000 DMA visuals
(1)   26/FFFFFFFFFFFFA000 :                     RAM_MdSystem		ds.b MAX_MdSystem	;
(1)   27/FFFFFFFFFFFFA800 :                     RAM_MdOther		ds.b MAX_MdOther	; 32X's DREQ goes here
(1)   28/FFFFFFFFFFFFC800 :                     RAM_MdGlobal		ds.b MAX_MdGlobal
(1)   29/FFFFFFFFFFFFD800 :                     RAM_ScreenBuff		ds.b MAX_ScrnBuff
(1)   30/FFFFFFFFFFFFF800 :                     sizeof_MdRam		ds.l 0
(1)   31/FFFFFFFFFFFFF800 : (MACRO)             			endstruct
(1)   31/FFFFFFFFFFFF8000 :                                     !org GLBL_LASTORG
(1)   31/       0 :                                     phase GLBL_LASTPC
(1)   32/       0 : (MACRO)             			report "MD RAM",(sizeof_MdRam-$FFFF0000),$FC00
(1)   33/       0 :                     
(1)   34/       0 : =$FFFFFD00          RAM_Stack		equ RAM_MegaCd		; <-- goes backwards
(1)   35/       0 : =$FFFFFD00          RAM_MegaCd		equ $FFFFFD00
(1)   36/       0 : =$FFFFFE00          RAM_ScreenJump		equ $FFFFFE00;$FFFFFE80		; Screen change section
(1)   37/       0 :                     
      44/       0 :                     		include	"system/mcd/const.asm"		; Genesis variables
(1)    1/       0 :                     ; ====================================================================
(1)    2/       0 :                     ; ----------------------------------------------------------------
(1)    3/       0 :                     ; Sega CD shared constants
(1)    4/       0 :                     ; ----------------------------------------------------------------
(1)    5/       0 :                     
(1)    6/       0 :                     ; ====================================================================
(1)    7/       0 :                     ; ----------------------------------------------------------------
(1)    8/       0 :                     ; Register area
(1)    9/       0 :                     ;
(1)   10/       0 :                     ; MAIN-CPU: $A12000 (sysmcd_reg)
(1)   11/       0 :                     ; SUB-CPU:  $FF8000 (scpu_reg)
(1)   12/       0 :                     ; ----------------------------------------------------------------
(1)   13/       0 :                     
(1)   14/       0 :                     ; -------------
(1)   15/       0 :                     ; bits
(1)   16/       0 :                     ; -------------
(1)   17/       0 :                     
(1)   18/       0 : =$2                 bitWRamMode	equ 2		;2M | 1M
(1)   19/       0 :                     
(1)   20/       0 :                     ; -------------
(1)   21/       0 :                     ; Registers
(1)   22/       0 :                     ; -------------
(1)   23/       0 :                     
(1)   24/       0 : =$3                 mcd_memory	equ $03
(1)   25/       0 : =$6                 mcd_hint	equ $06		; [W] HBlank RAM redirection-jump (MAIN CPU ONLY)
(1)   26/       0 : =$E                 mcd_comm_m	equ $0E		; [B] Comm port MAIN R/W | SUB READ ONLY
(1)   27/       0 : =$F                 mcd_comm_s	equ $0F		; [B] Comm port SUB R/W  | MAIN READ ONLY
(1)   28/       0 : =$10                mcd_dcomm_m	equ $10		; [S: $0E] Communication MAIN
(1)   29/       0 : =$20                mcd_dcomm_s	equ $20		; [S: $0E] Communication SUB
(1)   30/       0 :                     
(1)   31/       0 :                     ; MemoryMode	equ	$02		;WORD
(1)   32/       0 :                     ; CommMain	equ	$0E		;BYTE
(1)   33/       0 :                     ; CommSub		equ	$0F		;BYTE
(1)   34/       0 :                     ; CommDataM	equ	$10		;Array (size: $E)
(1)   35/       0 :                     ; CommDataS	equ	$20		;Array (size: $E)
(1)   36/       0 :                     
(1)   37/       0 :                     ; =================================================================
(1)   38/       0 :                     ; ----------------------------------------
(1)   39/       0 :                     ; SUB CPU ONLY
(1)   40/       0 :                     ; ----------------------------------------
(1)   41/       0 :                     
(1)   42/       0 :                     ; -------------
(1)   43/       0 :                     ; PCM
(1)   44/       0 :                     ; -------------
(1)   45/       0 :                     
(1)   46/       0 : =$FF0000            PCM		equ	$FF0000
(1)   47/       0 : =$1                 ENV		equ	$01		; Envelope
(1)   48/       0 : =$3                 PAN		equ	$03		; Panning (%RRRRLLLL, and negative)
(1)   49/       0 : =$5                 FDL		equ	$05		; Sample rate $00xx
(1)   50/       0 : =$7                 FDH		equ	$07		; Sample rate $xx00
(1)   51/       0 : =$9                 LSL		equ	$09		; Loop address $xx00
(1)   52/       0 : =$B                 LSH		equ	$0B		; Loop address $00xx
(1)   53/       0 : =$D                 ST		equ	$0D		; Start address (only $x0, $x000)
(1)   54/       0 : =$F                 Ctrl		equ	$0F		; Control register ($80 - Bank select, $C0 - Channel select)
(1)   55/       0 : =$11                OnOff		equ	$11		; Channel On/Off (BITS: 1 - off, 0 - on)
(1)   56/       0 :                     
(1)   57/       0 :                     ; =================================================================
(1)   58/       0 :                     
      45/       0 :                     		include	"system/mars/map.asm"		; 32X hardware map
(1)    1/       0 :                     ; ====================================================================
(1)    2/       0 :                     ; ----------------------------------------------------------------
(1)    3/       0 :                     ; SH2 MAP
(1)    4/       0 :                     ; ----------------------------------------------------------------
(1)    5/       0 :                     
(1)    6/       0 :                     ; --------------------------------------------------------
(1)    7/       0 :                     ; SH2 SIDE MAP
(1)    8/       0 :                     ; --------------------------------------------------------
(1)    9/       0 :                     
(1)   10/       0 : =$0                 CS0		equ	$00000000	; Boot ROM & System registers
(1)   11/       0 : =$2000000           CS1		equ	$02000000	; ROM data all 4MB, Gone if RV=1
(1)   12/       0 : =$4000000           CS2		equ	$04000000	; Framebuffer area
(1)   13/       0 : =$6000000           CS3		equ	$06000000	; SDRAM
(1)   14/       0 : =$20000000          TH		equ	$20000000	; OR value for CacheThru
(1)   15/       0 : =$20004000          _sysreg		equ	$00004000|TH	; MARS System registers
(1)   16/       0 : =$20004100          _vdpreg		equ	$00004100|TH	; SuperVDP registers
(1)   17/       0 : =$20004200          _palette	equ	$00004200|TH	; Palette RAM for Pixel-Packed or RLE mode
(1)   18/       0 : =$24000000          _framebuffer:	equ	CS2|TH		; Framebuffer: First 240 words are the linetable
(1)   19/       0 : =$24020000          _overwrite:	equ	CS2|TH+$20000	; Overwrite: $00 writes are ignored
(1)   20/       0 :                     
(1)   21/       0 :                     ; --------------------------------------------------------
(1)   22/       0 :                     ; Variables
(1)   23/       0 :                     ; --------------------------------------------------------
(1)   24/       0 :                     
(1)   25/       0 :                     ; ------------------------------------------------
(1)   26/       0 :                     ; System
(1)   27/       0 :                     ; ------------------------------------------------
(1)   28/       0 :                     
(1)   29/       0 :                     ; _sysreg
(1)   30/       0 : =$0                 adapter		equ	$00		; adapter control register (Read as WORD)
(1)   31/       0 : =$1                 intmask		equ	$01		; SH2 CPU ONLY: interrupts mask
(1)   32/       0 : =$3                 standby		equ	$03		; CMD interrupt request bit by MD side (slave|master) (BYTE)
(1)   33/       0 : =$5                 hcount		equ	$05		; H Counter (BYTE)
(1)   34/       0 : =$6                 dreqctl		equ	$06		; DREQ control (WORD)
(1)   35/       0 : =$8                 dreqsource	equ	$08		; DREQ source address
(1)   36/       0 : =$C                 dreqdest	equ	$0C		; DREQ destination address
(1)   37/       0 : =$10                dreqlen		equ	$10		; DREQ length
(1)   38/       0 : =$12                dreqfifo	equ	$12		; DREQ FIFO
(1)   39/       0 : =$14                vresintclr	equ	$14		; VRES interrupt clear
(1)   40/       0 : =$16                vintclr		equ	$16		; V interrupt clear
(1)   41/       0 : =$18                hintclr		equ	$18		; H interrupt clear
(1)   42/       0 : =$1A                cmdintclr	equ	$1a		; CMD interrupt clear
(1)   43/       0 : =$1C                pwmintclr	equ	$1C		; PWM interrupt clear
(1)   44/       0 : =$20                comm0		equ	$20		; Communication ports ***
(1)   45/       0 : =$21                comm1		equ	$21		; ALL CPUs can see this ports: including Z80
(1)   46/       0 : =$22                comm2		equ	$22		; only be careful with the read/write directions.
(1)   47/       0 : =$23                comm3		equ	$23		; ODD addresses (1,3,5...) are BYTE-read only.
(1)   48/       0 : =$24                comm4		equ	$24		; EVEN addresses (0,2,4...) can be read as WORDs
(1)   49/       0 : =$25                comm5		equ	$25		; Writing LONG addreses are possible depending
(1)   50/       0 : =$26                comm6		equ	$26		; of the CPU's aligment limitations.
(1)   51/       0 : =$27                comm7		equ	$27		;
(1)   52/       0 : =$28                comm8		equ	$28		;
(1)   53/       0 : =$29                comm9		equ	$29		;
(1)   54/       0 : =$2A                comm10		equ	$2A		;
(1)   55/       0 : =$2B                comm11		equ	$2B		;
(1)   56/       0 : =$2C                comm12		equ	$2C		;
(1)   57/       0 : =$2D                comm13		equ	$2D		;
(1)   58/       0 : =$2E                comm14		equ	$2E		;
(1)   59/       0 : =$2F                comm15		equ	$2F		;
(1)   60/       0 : =$30                timerctl	equ	$30		; PWM Timer Control
(1)   61/       0 : =$31                pwmctl		equ	$31		; PWM Control
(1)   62/       0 : =$32                cycle		equ	$32		; PWM Cycle
(1)   63/       0 : =$34                lchwidth	equ	$34		; PWM L ch Width
(1)   64/       0 : =$36                rchwidth	equ	$36		; PWM R ch Width
(1)   65/       0 : =$38                monowidth	equ	$38		; PWM Monaural Width
(1)   66/       0 :                     
(1)   67/       0 :                     ; _sysreg
(1)   68/       0 :                     ; adapter
(1)   69/       0 : =$1                 CART		equ	%00000001	; CD or Cartridge
(1)   70/       0 : =$2                 ADEN		equ	%00000010	; MARS Enabled: No/Yes
(1)   71/       0 : =$80                FM		equ	%10000000	; SuperVDP permission: MD or SH
(1)   72/       0 :                     ; framectl
(1)   73/       0 : =$1                 FS		equ	%00000001	; Current framebuffer DRAM pixel data
(1)   74/       0 : =$2                 FEN		equ	%00000010	; Can write to Framebuffer: Yes/No
(1)   75/       0 :                     ; vdpsts
(1)   76/       0 : =$80                VBLK		equ	%10000000	; VBlank bit
(1)   77/       0 : =$40                HBLK		equ	%01000000	; HBlank bit
(1)   78/       0 : =$20                PEN		equ	%00100000	; Can write to Palette: Yes/No
(1)   79/       0 :                     ; intmask
(1)   80/       0 : =$8                 VIRQ_ON		equ	$08		; IRQ masks for IRQ mask register
(1)   81/       0 : =$4                 HIRQ_ON		equ	$04
(1)   82/       0 : =$2                 CMDIRQ_ON	equ	$02
(1)   83/       0 : =$1                 PWMIRQ_ON	equ	$01
(1)   84/       0 :                     
(1)   85/       0 :                     ; _vdpreg
(1)   86/       0 : =$0                 tvmode		equ	$00		; TV mode
(1)   87/       0 : =$1                 bitmapmd	equ	$01		; Bitmap mode
(1)   88/       0 : =$2                 shift		equ	$02		; Lineshift bit
(1)   89/       0 : =$4                 filllength	equ	$04		; Auto Fill Length register
(1)   90/       0 : =$6                 fillstart	equ	$06		; Auto Fill Start Address register
(1)   91/       0 : =$8                 filldata	equ	$08		; Auto Fill Data register
(1)   92/       0 : =$A                 vdpsts		equ	$0A		; VDP Status register
(1)   93/       0 : =$B                 framectl	equ	$0B		; Frame Buffer Control register
(1)   94/       0 :                     
(1)   95/       0 :                     ; --------------------------------------------------------
(1)   96/       0 :                     ; SH2 Internal registers, independent for each CPU
(1)   97/       0 :                     ; --------------------------------------------------------
(1)   98/       0 :                     
(1)   99/       0 :                     ; DMA Channel 0: General data transfer
(1)  100/       0 :                     ; DMA Channel 1: PWM only
(1)  101/       0 :                     
(1)  102/       0 : =$FFFFFE00          _SERIAL		equ	$FFFFFE00	; Serial Control
(1)  103/       0 : =$FFFFFE10          _FRT		equ	$FFFFFE10	; Free run timer
(1)  104/       0 : =$0                 _TIER		equ	$00		; Timer interrupt enable register
(1)  105/       0 : =$1                 _TCSR		equ	$01		; Timer control & status register
(1)  106/       0 : =$2                 _FRC_H		equ	$02		; Free running counter High
(1)  107/       0 : =$3                 _FRC_L		equ	$03		; Free running counter Low
(1)  108/       0 : =$4                 _OCR_H		equ	$04		; Output compare register High
(1)  109/       0 : =$5                 _OCR_L		equ	$05		; Output compare register Low
(1)  110/       0 : =$6                 _TCR		equ	$06		; Timer control register
(1)  111/       0 : =$7                 _TOCR		equ	$07		; Timer output compare control register
(1)  112/       0 : =$FFFFFE92          _CCR		equ	$FFFFFE92	; Cache register (WORD)
(1)  113/       0 : =$FFFFFF00          _JR		equ	$FFFFFF00	; DIVU (--- / val)
(1)  114/       0 : =$FFFFFF04          _HRL32		equ	$FFFFFF04	; DIVU (val / ---) or RIGHT-long result if read
(1)  115/       0 : =$FFFFFF10          _HRH		equ	$FFFFFF10	; DIVU Result: LEFT long
(1)  116/       0 : =$FFFFFF14          _HRL		equ	$FFFFFF14	; DIVU Result: RIGHT long
(1)  117/       0 : =$FFFFFF80          _DMASOURCE0	equ	$FFFFFF80	; DMA source address 0
(1)  118/       0 : =$FFFFFF84          _DMADEST0	equ	$FFFFFF84	; DMA destination address 0
(1)  119/       0 : =$FFFFFF88          _DMACOUNT0	equ	$FFFFFF88	; DMA transfer count 0
(1)  120/       0 : =$FFFFFF8C          _DMACHANNEL0	equ	$FFFFFF8C	; DMA channel control 0
(1)  121/       0 : =$FFFFFF90          _DMASOURCE1	equ	$FFFFFF90	; DMA source address 1
(1)  122/       0 : =$FFFFFF94          _DMADEST1	equ	$FFFFFF94	; DMA destination address 1
(1)  123/       0 : =$FFFFFF98          _DMACOUNT1	equ	$FFFFFF98	; DMA transfer count 1
(1)  124/       0 : =$FFFFFF9C          _DMACHANNEL1	equ	$FFFFFF9C	; DMA channel control 1
(1)  125/       0 : =$FFFFFFA0          _DMAVECTORN0	equ	$FFFFFFA0	; DMA vector number N0
(1)  126/       0 : =$FFFFFFA4          _DMAVECTORE0	equ	$FFFFFFA4	; DMA vector number E0
(1)  127/       0 : =$FFFFFFA8          _DMAVECTORN1	equ	$FFFFFFA8	; DMA vector number N1
(1)  128/       0 : =$FFFFFFAC          _DMAVECTORE1	equ	$FFFFFFAC	; DMA vector number E1
(1)  129/       0 : =$FFFFFFB0          _DMAOPERATION	equ	$FFFFFFB0	; DMA operation
(1)  130/       0 : =$FFFFFFB4          _DMAREQACK0	equ	$FFFFFFB4	; DMA request/ack select control 0
(1)  131/       0 : =$FFFFFFB8          _DMAREQACK1	equ	$FFFFFFB8	; DMA request/ack select control 1
(1)  132/       0 :                     
      46/       0 :                     		include "game/global.asm"		; Global user variables on the Genesis
(1)    1/       0 :                     ; ====================================================================
(1)    2/       0 :                     ; ----------------------------------------------------------------
(1)    3/       0 :                     ; Global RAM variables on the Genesis side
(1)    4/       0 :                     ; (Score, Level, etc.)
(1)    5/       0 :                     ; ----------------------------------------------------------------
(1)    6/       0 :                     
(1)    7/       0 : (MACRO)             		struct RAM_MdGlobal
(1)    7/       0 : =$0                 GLBL_LASTPC     set *
(1)    7/       0 :                                     dephase
(1)    7/       0 : =$0                 GLBL_LASTORG    set *
(1)    7/FFFFFFFFFFFFC800 :                                     phase RAM_MDGLOBAL
(1)    8/FFFFFFFFFFFFC800 :                     RAM_Glbl_Scrn	ds.w 1
(1)    9/FFFFFFFFFFFFC802 :                     sizeof_mdglbl	ds.l 0
(1)   10/FFFFFFFFFFFFC804 : (MACRO)             		endstruct
(1)   10/FFFFFFFFFFFFC800 :                                     !org GLBL_LASTORG
(1)   10/       0 :                                     phase GLBL_LASTPC
(1)   11/       0 :                     
(1)   12/       0 :                     
      47/       0 :                     
      48/       0 :                     ; ====================================================================
      49/       0 :                     ; ----------------------------------------------------------------
      50/       0 :                     ; Init
      51/       0 :                     ; ----------------------------------------------------------------
      52/       0 :                     
      53/       0 :                     ; ---------------------------------------------
      54/       0 :                     ; 32X INIT
      55/       0 :                     ; ---------------------------------------------
      56/       0 :                     
      81/       0 :                     		include	"system/head_mcd.asm"			; Sega CD header
(1)    1/       0 :                     ; ====================================================================
(1)    2/       0 :                     ; ----------------------------------------------------------------
(1)    3/       0 :                     ; SEGA CD header
(1)    4/       0 :                     ; ----------------------------------------------------------------
(1)    5/       0 :                     
(1)    6/       0 : 5345 4741 4449 5343 		dc.b "SEGADISCSYSTEM  "		; Disc Type (Must be SEGADISCSYSTEM)
                    5359 5354 454D 2020 
(1)    7/      10 : 4D41 5253 4941 4E4F 		dc.b "MARSIANO-CD",0		; Disc ID
                    2D43 4400           
(1)    8/      1C : 0100 0001           		dc.w $100,1			; System ID, Type
(1)    9/      20 : 4D41 5253 4941 4E4F 		dc.b "MARSIANO-SY",0		; System Name
                    2D53 5900           
(1)   10/      2C : 0000 0000           		dc.w 0,0			; System Version, Type
(1)   11/      30 : 0000 0784           		dc.l IP_Start
(1)   12/      34 : 0000 0792           		dc.l IP_End
(1)   13/      38 : 0000 0000           		dc.l 0
(1)   14/      3C : 0000 0000           		dc.l 0
(1)   15/      40 : 0000 0800           		dc.l SP_Start
(1)   16/      44 : 0000 0B00           		dc.l SP_End
(1)   17/      48 : 0000 0000           		dc.l 0
(1)   18/      4C : 0000 0000           		dc.l 0
(1)   19/      50 :                     		align $100			; Pad to $100
(1)   20/     100 : 5345 4741 2047 454E 		dc.b "SEGA GENESIS    "
                    4553 4953 2020 2020 
(1)   21/     110 : 2843 2947 4636 3420 		dc.b "(C)GF64 2023.???"
                    3230 3233 2E3F 3F3F 
(1)   23/     120 : 4D61 7273 6961 6E6F 		dc.b "Marsiano CD32X                                  "
                    2043 4433 3258 2020 
                    2020 2020 2020 2020 
                    2020 2020 2020 2020 
                    2020 2020 2020 2020 
                    2020 2020 2020 2020 
(1)   24/     150 : 4D61 7273 6961 6E6F                 dc.b "Marsiano CD32X                                  "
                    2043 4433 3258 2020 
                    2020 2020 2020 2020 
                    2020 2020 2020 2020 
                    2020 2020 2020 2020 
                    2020 2020 2020 2020 
(1)   29/     180 : 474D 2054 4543 4844 		dc.b "GM TECHDEMO-01  "
                    454D 4F2D 3031 2020 
(1)   30/     190 : 4A20 2020 2020 2020 		dc.b "J               "
                    2020 2020 2020 2020 
(1)   31/     1A0 :                     		align $1F0
(1)   32/     1F0 : 5520 2020 2020 2020 		dc.b "U               "
                    2020 2020 2020 2020 
(1)   33/     200 :                     
(1)   34/     200 :                     ; 		binclude "system/mcd/region/jap.bin"
(1)   35/     200 :                     		binclude "system/mcd/region/usa.bin"
(1)   36/     784 :                     ; 		binclude "system/mcd/region/eur.bin"
(1)   37/     784 :                     
(1)   38/     784 :                     ; ========================================================
(1)   39/     784 :                     ; -------------------------------------------------
(1)   40/     784 :                     ; IP
(1)   41/     784 :                     ; -------------------------------------------------
(1)   42/     784 :                     
(1)   43/     784 :                     IP_Start:
(1)   44/     784 : 33FC A452 00A1 2006 		move.w	#(RAM_MdMarsHInt)&$FFFF,(sysmcd_reg+mcd_hint).l
(1)   45/     78C : 4EF9 00FF 2000      		jmp	($FF0600+MCD_Main).l
(1)   46/     792 :                     IP_End:
(1)   47/     792 :                     		align 2
(1)   48/     792 :                     
(1)   49/     792 :                     ; ========================================================
(1)   50/     792 :                     ; -------------------------------------------------
(1)   51/     792 :                     ; SP
(1)   52/     792 :                     ; -------------------------------------------------
(1)   53/     792 :                     
(1)   54/     792 :                     		align $800	; <-- REQUIRED
(1)   55/     800 :                     SP_Start:
(1)   56/     800 :                     		include "system/mcd/subcpu.asm"
(2)    1/     800 :                     ; ====================================================================
(2)    2/     800 :                     ; ----------------------------------------------------------------
(2)    3/     800 :                     ; SegaCD SUB-CPU code
(2)    4/     800 :                     ; ----------------------------------------------------------------
(2)    5/     800 :                     
(2)    6/     800 :                     ; ====================================================================
(2)    7/     800 :                     ; ----------------------------------------------------------------
(2)    8/     800 :                     ; Includes for this section ONLY
(2)    9/     800 :                     ; ----------------------------------------------------------------
(2)   10/     800 :                     
(2)   11/     800 : =$80000             scpu_wram	equ	$80000
(2)   12/     800 : =$FFFF8000          scpu_reg	equ	$FFFF8000
(2)   13/     800 :                     
(2)   14/     800 :                     ; ====================================================================
(2)   15/     800 :                     ; ----------------------------------------------------------------
(2)   16/     800 :                     ; Includes
(2)   17/     800 :                     ; ----------------------------------------------------------------
(2)   18/     800 :                     
(2)   19/     800 :                     ; 		include "system/mcd/const.asm"
(2)   20/     800 :                     		include "system/mcd/cdbios.asm"
(3)    1/     800 : =$2                 MSCSTOP           equ	$0002
(3)    2/     800 : =$3                 MSCPAUSEON        equ	$0003
(3)    3/     800 : =$4                 MSCPAUSEOFF       equ	$0004
(3)    4/     800 : =$5                 MSCSCANFF         equ	$0005
(3)    5/     800 : =$6                 MSCSCANFR         equ	$0006
(3)    6/     800 : =$7                 MSCSCANOFF        equ	$0007
(3)    7/     800 : =$8                 ROMPAUSEON        equ	$0008
(3)    8/     800 : =$9                 ROMPAUSEOFF       equ	$0009
(3)    9/     800 : =$A                 DRVOPEN           equ	$000A
(3)   10/     800 :                     
(3)   11/     800 : =$10                DRVINIT           equ	$0010
(3)   12/     800 : =$11                MSCPLAY           equ	$0011
(3)   13/     800 : =$12                MSCPLAY1          equ	$0012
(3)   14/     800 : =$13                MSCPLAYR          equ	$0013
(3)   15/     800 : =$14                MSCPLAYT          equ	$0014
(3)   16/     800 : =$15                MSCSEEK           equ	$0015
(3)   17/     800 : =$16                MSCSEEKT          equ	$0016
(3)   18/     800 : =$17                ROMREAD           equ	$0017
(3)   19/     800 : =$18                ROMSEEK           equ	$0018
(3)   20/     800 : =$19                MSCSEEK1          equ	$0019
(3)   21/     800 :                     
(3)   22/     800 : =$1E                TESTENTRY         equ	$001E
(3)   23/     800 : =$1F                TESTENTRYLOOP     equ	$001F
(3)   24/     800 : =$20                ROMREADN          equ	$0020
(3)   25/     800 : =$21                ROMREADE          equ	$0021
(3)   26/     800 :                     
(3)   27/     800 : =$80                CDBCHK            equ	$0080
(3)   28/     800 : =$81                CDBSTAT           equ	$0081
(3)   29/     800 : =$82                CDBTOCWRITE       equ	$0082
(3)   30/     800 : =$83                CDBTOCREAD        equ	$0083
(3)   31/     800 : =$84                CDBPAUSE          equ	$0084
(3)   32/     800 : =$85                FDRSET            equ	$0085
(3)   33/     800 : =$86                FDRCHG            equ	$0086
(3)   34/     800 : =$87                CDCSTART          equ	$0087
(3)   35/     800 : =$88                CDCSTARTP         equ	$0088
(3)   36/     800 : =$89                CDCSTOP           equ	$0089
(3)   37/     800 : =$8A                CDCSTAT           equ	$008A
(3)   38/     800 : =$8B                CDCREAD           equ	$008B
(3)   39/     800 : =$8C                CDCTRN            equ	$008C
(3)   40/     800 : =$8D                CDCACK            equ	$008D
(3)   41/     800 : =$8E                SCDINIT           equ	$008E
(3)   42/     800 : =$8F                SCDSTART          equ	$008F
(3)   43/     800 : =$90                SCDSTOP           equ	$0090
(3)   44/     800 : =$91                SCDSTAT           equ	$0091
(3)   45/     800 : =$92                SCDREAD           equ	$0092
(3)   46/     800 : =$93                SCDPQ             equ	$0093
(3)   47/     800 : =$94                SCDPQL            equ	$0094
(3)   48/     800 : =$95                LEDSET            equ	$0095
(3)   49/     800 : =$96                CDCSETMODE        equ	$0096
(3)   50/     800 : =$97                WONDERREQ         equ	$0097
(3)   51/     800 : =$98                WONDERCHK         equ	$0098
(3)   52/     800 :                     
(3)   53/     800 : =$0                 CBTINIT           equ	$0000
(3)   54/     800 : =$1                 CBTINT            equ	$0001
(3)   55/     800 : =$2                 CBTOPENDISC       equ	$0002
(3)   56/     800 : =$3                 CBTOPENSTAT       equ	$0003
(3)   57/     800 : =$4                 CBTCHKDISC        equ	$0004
(3)   58/     800 : =$5                 CBTCHKSTAT        equ	$0005
(3)   59/     800 : =$6                 CBTIPDISC         equ	$0006
(3)   60/     800 : =$7                 CBTIPSTAT         equ	$0007
(3)   61/     800 : =$8                 CBTSPDISC         equ	$0008
(3)   62/     800 : =$9                 CBTSPSTAT         equ	$0009
(3)   63/     800 :                     
(3)   64/     800 : =$0                 BRMINIT           equ	$0000
(3)   65/     800 : =$1                 BRMSTAT           equ	$0001
(3)   66/     800 : =$2                 BRMSERCH          equ	$0002
(3)   67/     800 : =$3                 BRMREAD           equ	$0003
(3)   68/     800 : =$4                 BRMWRITE          equ	$0004
(3)   69/     800 : =$5                 BRMDEL            equ	$0005
(3)   70/     800 : =$6                 BRMFORMAT         equ	$0006
(3)   71/     800 : =$7                 BRMDIR            equ	$0007
(3)   72/     800 : =$8                 BRMVERIFY         equ	$0008
(3)   73/     800 :                     
(3)   74/     800 :                     ;-----------------------------------------------------------------------
(3)   75/     800 :                     ; BIOS ENTRY POINTS
(3)   76/     800 :                     ;-----------------------------------------------------------------------
(3)   77/     800 :                     
(3)   78/     800 : =$5F40              _ADRERR           equ	$00005F40
(3)   79/     800 : =$5EA0              _BOOTSTAT         equ	$00005EA0
(3)   80/     800 : =$5F16              _BURAM            equ	$00005F16
(3)   81/     800 : =$5F22              _CDBIOS           equ	$00005F22
(3)   82/     800 : =$5F1C              _CDBOOT           equ	$00005F1C
(3)   83/     800 : =$5E80              _CDSTAT           equ	$00005E80
(3)   84/     800 : =$5F52              _CHKERR           equ	$00005F52
(3)   85/     800 : =$5F46              _CODERR           equ	$00005F46
(3)   86/     800 : =$5F4C              _DEVERR           equ	$00005F4C
(3)   87/     800 : =$5F76              _LEVEL1           equ	$00005F76
(3)   88/     800 : =$5F7C              _LEVEL2           equ	$00005F7C
(3)   89/     800 : =$5F82              _LEVEL3           equ	$00005F82 ;TIMER INTERRUPT
(3)   90/     800 : =$5F88              _LEVEL4           equ	$00005F88
(3)   91/     800 : =$5F8E              _LEVEL5           equ	$00005F8E
(3)   92/     800 : =$5F94              _LEVEL6           equ	$00005F94
(3)   93/     800 : =$5F9A              _LEVEL7           equ	$00005F9A
(3)   94/     800 : =$5F6A              _NOCOD0           equ	$00005F6A
(3)   95/     800 : =$5F70              _NOCOD1           equ	$00005F70
(3)   96/     800 : =$5F0A              _SETJMPTBL        equ	$00005F0A
(3)   97/     800 : =$5F5E              _SPVERR           equ	$00005F5E
(3)   98/     800 : =$5F64              _TRACE            equ	$00005F64
(3)   99/     800 : =$5FA0              _TRAP00           equ	$00005FA0
(3)  100/     800 : =$5FA6              _TRAP01           equ	$00005FA6
(3)  101/     800 : =$5FAC              _TRAP02           equ	$00005FAC
(3)  102/     800 : =$5FB2              _TRAP03           equ	$00005FB2
(3)  103/     800 : =$5FB8              _TRAP04           equ	$00005FB8
(3)  104/     800 : =$5FBE              _TRAP05           equ	$00005FBE
(3)  105/     800 : =$5FC4              _TRAP06           equ	$00005FC4
(3)  106/     800 : =$5FCA              _TRAP07           equ	$00005FCA
(3)  107/     800 : =$5FD0              _TRAP08           equ	$00005FD0
(3)  108/     800 : =$5FD6              _TRAP09           equ	$00005FD6
(3)  109/     800 : =$5FDC              _TRAP10           equ	$00005FDC
(3)  110/     800 : =$5FE2              _TRAP11           equ	$00005FE2
(3)  111/     800 : =$5FE8              _TRAP12           equ	$00005FE8
(3)  112/     800 : =$5FEE              _TRAP13           equ	$00005FEE
(3)  113/     800 : =$5FF4              _TRAP14           equ	$00005FF4
(3)  114/     800 : =$5FFA              _TRAP15           equ	$00005FFA
(3)  115/     800 : =$5F58              _TRPERR           equ	$00005F58
(3)  116/     800 : =$5F28              _USERCALL0        equ	$00005F28 ;INIT
(3)  117/     800 : =$5F2E              _USERCALL1        equ	$00005F2E ;MAIN
(3)  118/     800 : =$5F34              _USERCALL2        equ	$00005F34 ;VINT
(3)  119/     800 : =$5F3A              _USERCALL3        equ	$00005F3A ;NOT DEFINED
(3)  120/     800 : =$5EA6              _USERMODE         equ	$00005EA6
(3)  121/     800 : =$5F10              _WAITVSYNC        equ	$00005F10
(3)  122/     800 :                     
(3)  123/     800 :                     ;-----------------------------------------------------------------------
(3)  124/     800 :                     ; CDBIOS - Calls the BIOS with a specified function number.  Assumes
(3)  125/     800 :                     ; that all preparatory and cleanup work is done externally.
(3)  126/     800 :                     ;
(3)  127/     800 :                     ; input:
(3)  128/     800 :                     ;   fcode BIOS function code
(3)  129/     800 :                     ;
(3)  130/     800 :                     ; returns:
(3)  131/     800 :                     ;   nothing
(3)  132/     800 :                     ;-----------------------------------------------------------------------
(3)  133/     800 :                     CDBIOS macro fcode
(3)  134/     800 :                           move.w    fcode,d0
(3)  135/     800 :                           jsr       _CDBIOS
(3)  136/     800 :                           endm
(3)  137/     800 :                     
(3)  138/     800 :                     
(3)  139/     800 :                     ;-----------------------------------------------------------------------
(3)  140/     800 :                     ; BURAM - Calls the Backup Ram with a specified function number.
(3)  141/     800 :                     ; Assumes that all preparatory and cleanup work is done externally.
(3)  142/     800 :                     ;
(3)  143/     800 :                     ; input:
(3)  144/     800 :                     ;   fcode Backup Ram function code
(3)  145/     800 :                     ;
(3)  146/     800 :                     ; returns:
(3)  147/     800 :                     ;   nothing
(3)  148/     800 :                     ;-----------------------------------------------------------------------
(3)  149/     800 :                     BURAM macro fcode
(3)  150/     800 :                           move.w    fcode,d0
(3)  151/     800 :                           jsr       _BURAM
(3)  152/     800 :                           endm
(3)  153/     800 :                     
(3)  154/     800 :                     
(3)  155/     800 :                     ;-----------------------------------------------------------------------
(3)  156/     800 :                     ; DRIVE MECHANISM
(3)  157/     800 :                     ;-----------------------------------------------------------------------
(3)  158/     800 :                     
(3)  159/     800 :                     ;-----------------------------------------------------------------------
(3)  160/     800 :                     ; BIOS_DRVINIT - Closes the disk tray and reads the TOC from the CD.
(3)  161/     800 :                     ; Pauses for 2 seconds after reading the TOC.  If bit 7 of the TOC track
(3)  162/     800 :                     ; is set, the BIOS starts playing the first track automatically.  Waits
(3)  163/     800 :                     ; for a DRVOPEN request if there is no disk in the drive.
(3)  164/     800 :                     ;
(3)  165/     800 :                     ; input:
(3)  166/     800 :                     ;   a0.l  address of initialization parameters:
(3)  167/     800 :                     ;           dc.b    $01   ; Track # to read TOC from (normally $01)
(3)  168/     800 :                     ;           dc.b    $FF   ; Last track # ($FF = read all tracks)
(3)  169/     800 :                     ;
(3)  170/     800 :                     ; returns:
(3)  171/     800 :                     ;   nothing
(3)  172/     800 :                     ;-----------------------------------------------------------------------
(3)  173/     800 :                     BIOS_DRVINIT macro
(3)  174/     800 :                           CDBIOS #DRVINIT
(3)  175/     800 :                           endm
(3)  176/     800 :                     
(3)  177/     800 :                     ;-----------------------------------------------------------------------
(3)  178/     800 :                     ; BIOS_DRVOPEN - Opens the drive.
(3)  179/     800 :                     ;
(3)  180/     800 :                     ; input:
(3)  181/     800 :                     ;   none
(3)  182/     800 :                     ;
(3)  183/     800 :                     ; returns:
(3)  184/     800 :                     ;   nothing
(3)  185/     800 :                     ;-----------------------------------------------------------------------
(3)  186/     800 :                     BIOS_DRVOPEN macro
(3)  187/     800 :                           CDBIOS #DRVOPEN
(3)  188/     800 :                           endm
(3)  189/     800 :                     
(3)  190/     800 :                     
(3)  191/     800 :                     ;-----------------------------------------------------------------------
(3)  192/     800 :                     ; MUSIC
(3)  193/     800 :                     ;-----------------------------------------------------------------------
(3)  194/     800 :                     
(3)  195/     800 :                     ;-----------------------------------------------------------------------
(3)  196/     800 :                     ; BIOS_MSCSTOP - Stops playing a track if it's currently playing.
(3)  197/     800 :                     ;
(3)  198/     800 :                     ; input:
(3)  199/     800 :                     ;   none
(3)  200/     800 :                     ;
(3)  201/     800 :                     ; returns:
(3)  202/     800 :                     ;   nothing
(3)  203/     800 :                     ;-----------------------------------------------------------------------
(3)  204/     800 :                     BIOS_MSCSTOP macro
(3)  205/     800 :                           CDBIOS #MSCSTOP
(3)  206/     800 :                           endm
(3)  207/     800 :                     
(3)  208/     800 :                     ;-----------------------------------------------------------------------
(3)  209/     800 :                     ; BIOS_MSCPLAY - Starts playing at a specified track.  Continues playing
(3)  210/     800 :                     ; through subsequent tracks.
(3)  211/     800 :                     ;
(3)  212/     800 :                     ; input:
(3)  213/     800 :                     ;   a0.l  address of 16 bit track number
(3)  214/     800 :                     ;
(3)  215/     800 :                     ; returns:
(3)  216/     800 :                     ;   nothing
(3)  217/     800 :                     ;-----------------------------------------------------------------------
(3)  218/     800 :                     BIOS_MSCPLAY macro
(3)  219/     800 :                           CDBIOS #MSCPLAY
(3)  220/     800 :                           endm
(3)  221/     800 :                     
(3)  222/     800 :                     ;-----------------------------------------------------------------------
(3)  223/     800 :                     ; BIOS_MSCPLAY1 - Plays a track once and pauses.
(3)  224/     800 :                     ;
(3)  225/     800 :                     ; input:
(3)  226/     800 :                     ;   a0.l  address of a 16 bit track number
(3)  227/     800 :                     ;
(3)  228/     800 :                     ; returns:
(3)  229/     800 :                     ;   nothing
(3)  230/     800 :                     ;-----------------------------------------------------------------------
(3)  231/     800 :                     BIOS_MSCPLAY1 macro
(3)  232/     800 :                           CDBIOS #MSCPLAY1
(3)  233/     800 :                           endm
(3)  234/     800 :                     
(3)  235/     800 :                     ;-----------------------------------------------------------------------
(3)  236/     800 :                     ; BIOS_MSCPLAYR - Plays the designated track repeatedly.
(3)  237/     800 :                     ;
(3)  238/     800 :                     ; input:
(3)  239/     800 :                     ;   a0.l  address of a 16 bit track number
(3)  240/     800 :                     ;
(3)  241/     800 :                     ; returns:
(3)  242/     800 :                     ;   nothing
(3)  243/     800 :                     ;-----------------------------------------------------------------------
(3)  244/     800 :                     BIOS_MSCPLAYR macro
(3)  245/     800 :                           CDBIOS #MSCPLAYR
(3)  246/     800 :                           endm
(3)  247/     800 :                     
(3)  248/     800 :                     ;-----------------------------------------------------------------------
(3)  249/     800 :                     ; BIOS_MSCPLAYT - Starts playing from a specified time.
(3)  250/     800 :                     ;
(3)  251/     800 :                     ; input:
(3)  252/     800 :                     ;   a0.l  address of a 32 bit BCD time code in the format mm:ss:ff:00
(3)  253/     800 :                     ;
(3)  254/     800 :                     ; returns:
(3)  255/     800 :                     ;   nothing
(3)  256/     800 :                     ;-----------------------------------------------------------------------
(3)  257/     800 :                     BIOS_MSCPLAYT macro
(3)  258/     800 :                           CDBIOS #MSCPLAYT
(3)  259/     800 :                           endm
(3)  260/     800 :                     
(3)  261/     800 :                     ;-----------------------------------------------------------------------
(3)  262/     800 :                     ; BIOS_MSCSEEK - Seeks to the beginning of the selected track and pauses.
(3)  263/     800 :                     ;
(3)  264/     800 :                     ; input:
(3)  265/     800 :                     ;   a0.l  address of a 16 bit track number
(3)  266/     800 :                     ;
(3)  267/     800 :                     ; returns:
(3)  268/     800 :                     ;   nothing
(3)  269/     800 :                     ;-----------------------------------------------------------------------
(3)  270/     800 :                     BIOS_MSCSEEK macro
(3)  271/     800 :                           CDBIOS #MSCSEEK
(3)  272/     800 :                           endm
(3)  273/     800 :                     
(3)  274/     800 :                     ;-----------------------------------------------------------------------
(3)  275/     800 :                     ; BIOS_MSCSEEK1 - Seeks to the beginning of the selected track and pauses.
(3)  276/     800 :                     ; Once the BIOS detects a pause state, it plays the track once.
(3)  277/     800 :                     ;
(3)  278/     800 :                     ; input:
(3)  279/     800 :                     ;   a0.l  address of a 16 bit track number
(3)  280/     800 :                     ;
(3)  281/     800 :                     ; returns:
(3)  282/     800 :                     ;   nothing
(3)  283/     800 :                     ;-----------------------------------------------------------------------
(3)  284/     800 :                     BIOS_MSCSEEK1 macro
(3)  285/     800 :                           CDBIOS #MSCSEEK1
(3)  286/     800 :                           endm
(3)  287/     800 :                     
(3)  288/     800 :                     ;-----------------------------------------------------------------------
(3)  289/     800 :                     ; BIOS_MSCSEEKT - Seeks to a specified time.
(3)  290/     800 :                     ;
(3)  291/     800 :                     ; input:
(3)  292/     800 :                     ;   a0.l  address of a 32 bit BCD time code in the format mm:ss:ff:00
(3)  293/     800 :                     ;
(3)  294/     800 :                     ; returns:
(3)  295/     800 :                     ;   nothing
(3)  296/     800 :                     ;-----------------------------------------------------------------------
(3)  297/     800 :                     BIOS_MSCSEEKT macro
(3)  298/     800 :                           CDBIOS #MSCSEEKT
(3)  299/     800 :                           endm
(3)  300/     800 :                     
(3)  301/     800 :                     ;-----------------------------------------------------------------------
(3)  302/     800 :                     ; BIOS_MSCPAUSEON - Pauses the drive when a track is playing.  If the
(3)  303/     800 :                     ; drive is left paused it will stop after a programmable delay (see
(3)  304/     800 :                     ; CDBPAUSE).
(3)  305/     800 :                     ;
(3)  306/     800 :                     ; input:
(3)  307/     800 :                     ;   none
(3)  308/     800 :                     ;
(3)  309/     800 :                     ; returns:
(3)  310/     800 :                     ;   nothing
(3)  311/     800 :                     ;-----------------------------------------------------------------------
(3)  312/     800 :                     BIOS_MSCPAUSEON macro
(3)  313/     800 :                           CDBIOS #MSCPAUSEON
(3)  314/     800 :                           endm
(3)  315/     800 :                     
(3)  316/     800 :                     ;-----------------------------------------------------------------------
(3)  317/     800 :                     ; BIOS_MSCPAUSEOFF - Resumes playing a track after a pause.  If the drive
(3)  318/     800 :                     ; has timed out and stopped, the BIOS will seek to the pause time (with
(3)  319/     800 :                     ; the attendant delay) and resume playing.
(3)  320/     800 :                     ;
(3)  321/     800 :                     ; input:
(3)  322/     800 :                     ;   none
(3)  323/     800 :                     ;
(3)  324/     800 :                     ; returns:
(3)  325/     800 :                     ;   nothing
(3)  326/     800 :                     ;-----------------------------------------------------------------------
(3)  327/     800 :                     BIOS_MSCPAUSEOFF macro
(3)  328/     800 :                           CDBIOS #MSCPAUSEOFF
(3)  329/     800 :                           endm
(3)  330/     800 :                     
(3)  331/     800 :                     ;-----------------------------------------------------------------------
(3)  332/     800 :                     ; BIOS_MSCSCANFF - Starts playing from the current position in fast
(3)  333/     800 :                     ; forward.
(3)  334/     800 :                     ;
(3)  335/     800 :                     ; input:
(3)  336/     800 :                     ;   none
(3)  337/     800 :                     ;
(3)  338/     800 :                     ; returns:
(3)  339/     800 :                     ;   nothing
(3)  340/     800 :                     ;-----------------------------------------------------------------------
(3)  341/     800 :                     BIOS_MSCSCANFF macro
(3)  342/     800 :                           CDBIOS #MSCSCANFF
(3)  343/     800 :                           endm
(3)  344/     800 :                     
(3)  345/     800 :                     ;-----------------------------------------------------------------------
(3)  346/     800 :                     ; BIOS_MSCSCANFR - Same as MSCSCANFF, but backwards.
(3)  347/     800 :                     ;
(3)  348/     800 :                     ; input:
(3)  349/     800 :                     ;   none
(3)  350/     800 :                     ;
(3)  351/     800 :                     ; returns:
(3)  352/     800 :                     ;   nothing
(3)  353/     800 :                     ;-----------------------------------------------------------------------
(3)  354/     800 :                     BIOS_MSCSCANFR macro
(3)  355/     800 :                           CDBIOS #MSCSCANFR
(3)  356/     800 :                           endm
(3)  357/     800 :                     
(3)  358/     800 :                     ;-----------------------------------------------------------------------
(3)  359/     800 :                     ; BIOS_MSCSCANOFF - Returns to normal play mode.  If the drive was
(3)  360/     800 :                     ; paused before the scan was initiated, it will be returned to pause.
(3)  361/     800 :                     ;
(3)  362/     800 :                     ; input:
(3)  363/     800 :                     ;   none
(3)  364/     800 :                     ;
(3)  365/     800 :                     ; returns:
(3)  366/     800 :                     ;   nothing
(3)  367/     800 :                     ;-----------------------------------------------------------------------
(3)  368/     800 :                     BIOS_MSCSCANOFF macro
(3)  369/     800 :                           CDBIOS #MSCSCANOFF
(3)  370/     800 :                           endm
(3)  371/     800 :                     
(3)  372/     800 :                     
(3)  373/     800 :                     ;-----------------------------------------------------------------------
(3)  374/     800 :                     ; CD-ROM
(3)  375/     800 :                     ;-----------------------------------------------------------------------
(3)  376/     800 :                     
(3)  377/     800 :                     ;-----------------------------------------------------------------------
(3)  378/     800 :                     ; BIOS_ROMREAD - Begins reading data from the CDROM at the designated
(3)  379/     800 :                     ; logical sector.  Executes a CDCSTART to begin the read, but doesn't
(3)  380/     800 :                     ; stop automatically.
(3)  381/     800 :                     ;
(3)  382/     800 :                     ; Note - ROMREAD actually pre-seeks by 2 sectors, but doesn't start
(3)  383/     800 :                     ; passing data to the CDC until the desired sector is reached.
(3)  384/     800 :                     ;
(3)  385/     800 :                     ; input:
(3)  386/     800 :                     ;   a0.l  address of a 32 bit logical sector number
(3)  387/     800 :                     ;
(3)  388/     800 :                     ; returns:
(3)  389/     800 :                     ;   nothing
(3)  390/     800 :                     ;-----------------------------------------------------------------------
(3)  391/     800 :                     BIOS_ROMREAD macro
(3)  392/     800 :                           CDBIOS #ROMREAD
(3)  393/     800 :                           endm
(3)  394/     800 :                     
(3)  395/     800 :                     ;-----------------------------------------------------------------------
(3)  396/     800 :                     ; BIOS_ROMREADN - Same as ROMREAD, but stops after reading the requested
(3)  397/     800 :                     ; number of sectors.
(3)  398/     800 :                     ;
(3)  399/     800 :                     ; input:
(3)  400/     800 :                     ;   a0.l  address of a 32 bit sector number and 32 bit sector count
(3)  401/     800 :                     ;           dc.l    $00000001   ; First sector to read
(3)  402/     800 :                     ;           dc.l    $00001234   ; Number of sectors to read
(3)  403/     800 :                     ;
(3)  404/     800 :                     ; returns:
(3)  405/     800 :                     ;   nothing
(3)  406/     800 :                     ;-----------------------------------------------------------------------
(3)  407/     800 :                     BIOS_ROMREADN macro
(3)  408/     800 :                           CDBIOS #ROMREADN
(3)  409/     800 :                           endm
(3)  410/     800 :                     
(3)  411/     800 :                     ;-----------------------------------------------------------------------
(3)  412/     800 :                     ; BIOS_ROMREADE - Same as ROMREAD, but reads between two logical sectors.
(3)  413/     800 :                     ;
(3)  414/     800 :                     ; input:
(3)  415/     800 :                     ;   a0.l  address of table of 32 bit logical sector numbers
(3)  416/     800 :                     ;           dc.l    $00000001   ; First sector to read
(3)  417/     800 :                     ;           dc.l    $00000123   ; Last sector to read
(3)  418/     800 :                     ;
(3)  419/     800 :                     ; returns:
(3)  420/     800 :                     ;   nothing
(3)  421/     800 :                     ;-----------------------------------------------------------------------
(3)  422/     800 :                     BIOS_ROMREADE macro
(3)  423/     800 :                           CDBIOS #ROMREADE
(3)  424/     800 :                           endm
(3)  425/     800 :                     
(3)  426/     800 :                     ;-----------------------------------------------------------------------
(3)  427/     800 :                     ; BIOS_ROMSEEK - Seeks to the designated logical sector and pauses.
(3)  428/     800 :                     ;
(3)  429/     800 :                     ; input:
(3)  430/     800 :                     ;   a0.l  address of a 32 bit logical sector number
(3)  431/     800 :                     ;
(3)  432/     800 :                     ; returns:
(3)  433/     800 :                     ;   nothing
(3)  434/     800 :                     ;-----------------------------------------------------------------------
(3)  435/     800 :                     BIOS_ROMSEEK macro
(3)  436/     800 :                           CDBIOS #ROMSEEK
(3)  437/     800 :                           endm
(3)  438/     800 :                     
(3)  439/     800 :                     ;-----------------------------------------------------------------------
(3)  440/     800 :                     ; BIOS_ROMPAUSEON - Stops reading data into the CDC and pauses.
(3)  441/     800 :                     ;
(3)  442/     800 :                     ; input:
(3)  443/     800 :                     ;   none
(3)  444/     800 :                     ;
(3)  445/     800 :                     ; returns:
(3)  446/     800 :                     ;   nothing
(3)  447/     800 :                     ;-----------------------------------------------------------------------
(3)  448/     800 :                     BIOS_ROMPAUSEON macro
(3)  449/     800 :                           CDBIOS #ROMPAUSEON
(3)  450/     800 :                           endm
(3)  451/     800 :                     
(3)  452/     800 :                     ;-----------------------------------------------------------------------
(3)  453/     800 :                     ; BIOS_ROMPAUSEOFF - Resumes reading data into the CDC from the current
(3)  454/     800 :                     ; logical sector.
(3)  455/     800 :                     ;
(3)  456/     800 :                     ; input:
(3)  457/     800 :                     ;   none
(3)  458/     800 :                     ;
(3)  459/     800 :                     ; returns:
(3)  460/     800 :                     ;   nothing
(3)  461/     800 :                     ;-----------------------------------------------------------------------
(3)  462/     800 :                     BIOS_ROMPAUSEOFF macro
(3)  463/     800 :                           CDBIOS #ROMPAUSEOFF
(3)  464/     800 :                           endm
(3)  465/     800 :                     
(3)  466/     800 :                     
(3)  467/     800 :                     ;-----------------------------------------------------------------------
(3)  468/     800 :                     ; MISC BIOS FUNCTIONS
(3)  469/     800 :                     ;-----------------------------------------------------------------------
(3)  470/     800 :                     
(3)  471/     800 :                     ;-----------------------------------------------------------------------
(3)  472/     800 :                     ; BIOS_CDBCHK - Querys the BIOS on the status of the last command.
(3)  473/     800 :                     ; Returns success if the command has been executed, not if it's complete.
(3)  474/     800 :                     ; This means that CDBCHK will return success on a seek command once the
(3)  475/     800 :                     ; seek has started, NOT when the seek is actually finished.
(3)  476/     800 :                     ;
(3)  477/     800 :                     ; input:
(3)  478/     800 :                     ;   none
(3)  479/     800 :                     ;
(3)  480/     800 :                     ; returns:
(3)  481/     800 :                     ;   cc  Command has been executed
(3)  482/     800 :                     ;   cs  BIOS is busy
(3)  483/     800 :                     ;-----------------------------------------------------------------------
(3)  484/     800 :                     BIOS_CDBCHK macro
(3)  485/     800 :                           CDBIOS #CDBCHK
(3)  486/     800 :                           endm
(3)  487/     800 :                     
(3)  488/     800 :                     ;-----------------------------------------------------------------------
(3)  489/     800 :                     ; BIOS_CDBSTAT
(3)  490/     800 :                     ;
(3)  491/     800 :                     ; input:
(3)  492/     800 :                     ;   none
(3)  493/     800 :                     ;
(3)  494/     800 :                     ; returns:
(3)  495/     800 :                     ;   a0.l  address of BIOS status table
(3)  496/     800 :                     ;-----------------------------------------------------------------------
(3)  497/     800 :                     BIOS_CDBSTAT macro
(3)  498/     800 :                           CDBIOS #CDBSTAT
(3)  499/     800 :                           endm
(3)  500/     800 :                     
(3)  501/     800 :                     ;-----------------------------------------------------------------------
(3)  502/     800 :                     ; BIOS_CDBTOCREAD - Gets the time for the specified track from the TOC.
(3)  503/     800 :                     ; If the track isn't in the TOC, the BIOS will either return the time of
(3)  504/     800 :                     ; the last track read or the beginning of the disk.  Don't call this
(3)  505/     800 :                     ; function while the BIOS is loading the TOC (see DRVINIT).
(3)  506/     800 :                     ;
(3)  507/     800 :                     ; input:
(3)  508/     800 :                     ;   d1.w  16 bit track number
(3)  509/     800 :                     ;
(3)  510/     800 :                     ; returns:
(3)  511/     800 :                     ;   d0.l  BCD time of requested track in mm:ss:ff:## format where ## is
(3)  512/     800 :                     ;         the requested track number or 00 if there was an error
(3)  513/     800 :                     ;
(3)  514/     800 :                     ;   d1.b  Track type:
(3)  515/     800 :                     ;           $00 = CD-DA track
(3)  516/     800 :                     ;           $FF = CD-ROM track
(3)  517/     800 :                     ;-----------------------------------------------------------------------
(3)  518/     800 :                     BIOS_CDBTOCREAD macro
(3)  519/     800 :                           CDBIOS #CDBTOCREAD
(3)  520/     800 :                           endm
(3)  521/     800 :                     
(3)  522/     800 :                     ;-----------------------------------------------------------------------
(3)  523/     800 :                     ; BIOS_CDBTOCWRITE - Writes data to the TOC in memory.  Don't write to
(3)  524/     800 :                     ; the TOC while the BIOS is performing a DRVINIT.
(3)  525/     800 :                     ;
(3)  526/     800 :                     ; input:
(3)  527/     800 :                     ;   a0.l  address of a table of TOC entries to write to the TOC.  Format
(3)  528/     800 :                     ;         of the entries is mm:ss:ff:## where ## is the track number.
(3)  529/     800 :                     ;
(3)  530/     800 :                     ; returns:
(3)  531/     800 :                     ;   nothing
(3)  532/     800 :                     ;-----------------------------------------------------------------------
(3)  533/     800 :                     BIOS_CDBTOCWRITE macro
(3)  534/     800 :                           CDBIOS #CDBTOCWRITE
(3)  535/     800 :                           endm
(3)  536/     800 :                     
(3)  537/     800 :                     ;-----------------------------------------------------------------------
(3)  538/     800 :                     ; BIOS_CDBPAUSE - Sets the delay time before the BIOS switches from
(3)  539/     800 :                     ; pause to standby.  Normal ranges for this delay time are $1194 - $FFFE.
(3)  540/     800 :                     ; A delay of $FFFF prevents the drive from stopping, but can  damage the
(3)  541/     800 :                     ; drive if used improperly.
(3)  542/     800 :                     ;
(3)  543/     800 :                     ; input:
(3)  544/     800 :                     ;   d1.w  16 bit delay time
(3)  545/     800 :                     ;
(3)  546/     800 :                     ; returns:
(3)  547/     800 :                     ;   nothing
(3)  548/     800 :                     ;-----------------------------------------------------------------------
(3)  549/     800 :                     BIOS_CDBPAUSE macro
(3)  550/     800 :                           CDBIOS #CDBPAUSE
(3)  551/     800 :                           endm
(3)  552/     800 :                     
(3)  553/     800 :                     
(3)  554/     800 :                     ;-----------------------------------------------------------------------
(3)  555/     800 :                     ; FADER
(3)  556/     800 :                     ;-----------------------------------------------------------------------
(3)  557/     800 :                     
(3)  558/     800 :                     ;-----------------------------------------------------------------------
(3)  559/     800 :                     ; BIOS_FDRSET - Sets the audio volume.  If bit 15 of the volume parameter
(3)  560/     800 :                     ; is 1, sets the master volume level.  There's a delay of up to 13ms
(3)  561/     800 :                     ; before the volume begins to change and another 23ms for the new volume
(3)  562/     800 :                     ; level to take effect.  The master volume sets a maximum level which the
(3)  563/     800 :                     ; volume level can't exceed.
(3)  564/     800 :                     ;
(3)  565/     800 :                     ; input:
(3)  566/     800 :                     ;   d1.w  16 bit volume         ($0000 = min    $0400 = max)
(3)  567/     800 :                     ;         16 bit master volume  ($8000 = min    $8400 = max)
(3)  568/     800 :                     ;
(3)  569/     800 :                     ; returns:
(3)  570/     800 :                     ;   nothing
(3)  571/     800 :                     ;-----------------------------------------------------------------------
(3)  572/     800 :                     BIOS_FDRSET macro
(3)  573/     800 :                           CDBIOS #FDRSET
(3)  574/     800 :                           endm
(3)  575/     800 :                     
(3)  576/     800 :                     ;-----------------------------------------------------------------------
(3)  577/     800 :                     ; BIOS_FDRCHG - Ramps the audio volume from its current level to a new
(3)  578/     800 :                     ; level at the requested rate.  As in FDRSET, there's a delay of up to
(3)  579/     800 :                     ; 13ms before the change starts.
(3)  580/     800 :                     ;
(3)  581/     800 :                     ; input:
(3)  582/     800 :                     ;   d1.l  32 bit volume change
(3)  583/     800 :                     ;         high word:  new 16 bit volume   ($0000 = min    $0400 = max)
(3)  584/     800 :                     ;         low word:   16 bit rate in steps/vblank
(3)  585/     800 :                     ;                     $0001 = slow
(3)  586/     800 :                     ;                     $0200 = fast
(3)  587/     800 :                     ;                     $0400 = set immediately
(3)  588/     800 :                     ;
(3)  589/     800 :                     ; returns:
(3)  590/     800 :                     ;   nothing
(3)  591/     800 :                     ;-----------------------------------------------------------------------
(3)  592/     800 :                     BIOS_FDRCHG macro
(3)  593/     800 :                           CDBIOS #FDRCHG
(3)  594/     800 :                           endm
(3)  595/     800 :                     
(3)  596/     800 :                     
(3)  597/     800 :                     ;-----------------------------------------------------------------------
(3)  598/     800 :                     ; CDC
(3)  599/     800 :                     ;-----------------------------------------------------------------------
(3)  600/     800 :                     
(3)  601/     800 :                     ;-----------------------------------------------------------------------
(3)  602/     800 :                     ; BIOS_CDCSTART - Starts reading data from the current logical sector
(3)  603/     800 :                     ; into the CDC.  The BIOS pre-seeks by 2 to 4 sectors and data read
(3)  604/     800 :                     ; actually begins before the requested sector.  It's up to the caller
(3)  605/     800 :                     ; to identify the correct starting sector (usually by checking the time
(3)  606/     800 :                     ; codes in the headers as they're read from the CDC buffer).
(3)  607/     800 :                     ;
(3)  608/     800 :                     ; input:
(3)  609/     800 :                     ;   none
(3)  610/     800 :                     ;
(3)  611/     800 :                     ; returns:
(3)  612/     800 :                     ;   nothing
(3)  613/     800 :                     ;-----------------------------------------------------------------------
(3)  614/     800 :                     BIOS_CDCSTART macro
(3)  615/     800 :                           CDBIOS #CDCSTART
(3)  616/     800 :                           endm
(3)  617/     800 :                     
(3)  618/     800 :                     ;-----------------------------------------------------------------------
(3)  619/     800 :                     ; BIOS_CDCSTOP - Stops reading data into the CDC.  If a sector is being
(3)  620/     800 :                     ; read when CDCSTOP is called, it's lost.
(3)  621/     800 :                     ;
(3)  622/     800 :                     ; input:
(3)  623/     800 :                     ;   none
(3)  624/     800 :                     ;
(3)  625/     800 :                     ; returns:
(3)  626/     800 :                     ;   nothing
(3)  627/     800 :                     ;-----------------------------------------------------------------------
(3)  628/     800 :                     BIOS_CDCSTOP macro
(3)  629/     800 :                           CDBIOS #CDCSTOP
(3)  630/     800 :                           endm
(3)  631/     800 :                     
(3)  632/     800 :                     ;-----------------------------------------------------------------------
(3)  633/     800 :                     ; BIOS_CDCSTAT - Queries the CDC buffer.  If no sector is ready for
(3)  634/     800 :                     ; read, the carry bit will be set.  Up to 5 sectors can be buffered in
(3)  635/     800 :                     ; the CDC buffer.
(3)  636/     800 :                     ;
(3)  637/     800 :                     ; input:
(3)  638/     800 :                     ;   none
(3)  639/     800 :                     ;
(3)  640/     800 :                     ; returns:
(3)  641/     800 :                     ;   cc  Sector available for read
(3)  642/     800 :                     ;   cs  No sectors available
(3)  643/     800 :                     ;-----------------------------------------------------------------------
(3)  644/     800 :                     BIOS_CDCSTAT macro
(3)  645/     800 :                           CDBIOS #CDCSTAT
(3)  646/     800 :                           endm
(3)  647/     800 :                     
(3)  648/     800 :                     ;-----------------------------------------------------------------------
(3)  649/     800 :                     ; BIOS_CDCREAD - If a sector is ready in the CDC buffer, the BIOS
(3)  650/     800 :                     ; prepares to send the sector to the current device destination.  Make
(3)  651/     800 :                     ; sure to set the device destination BEFORE calling CDCREAD.  If a
(3)  652/     800 :                     ; sector is ready, the carry bit will be cleared on return and it's
(3)  653/     800 :                     ; necessary to respond with a call to CDCACK.
(3)  654/     800 :                     ;
(3)  655/     800 :                     ; input:
(3)  656/     800 :                     ;   none
(3)  657/     800 :                     ;
(3)  658/     800 :                     ; returns:
(3)  659/     800 :                     ;   cc    Sector ready for transfer
(3)  660/     800 :                     ;   d0.l  Sector header in BCD mm:ss:ff:md format where md is sector mode
(3)  661/     800 :                     ;           $00 = CD-DA
(3)  662/     800 :                     ;           $01 = CD-ROM mode 1
(3)  663/     800 :                     ;           $02 = CD-ROM mode 2
(3)  664/     800 :                     ;   cs    Sector not ready
(3)  665/     800 :                     ;-----------------------------------------------------------------------
(3)  666/     800 :                     BIOS_CDCREAD macro
(3)  667/     800 :                           CDBIOS #CDCREAD
(3)  668/     800 :                           endm
(3)  669/     800 :                     
(3)  670/     800 :                     ;-----------------------------------------------------------------------
(3)  671/     800 :                     ; BIOS_CDCTRN - Uses the Sub-CPU to read one sector into RAM.  The
(3)  672/     800 :                     ; device destination must be set to SUB-CPU read before calling CDCTRN.
(3)  673/     800 :                     ;
(3)  674/     800 :                     ; input:
(3)  675/     800 :                     ;   a0.l  address of sector destination buffer (at least 2336 bytes)
(3)  676/     800 :                     ;   a1.l  address of header destination buffer (at least 4 bytes)
(3)  677/     800 :                     ;
(3)  678/     800 :                     ; returns:
(3)  679/     800 :                     ;   cc    Sector successfully transferred
(3)  680/     800 :                     ;   cs    Transfer failed
(3)  681/     800 :                     ;   a0.l  Next sector destination address (a0 + 2336)
(3)  682/     800 :                     ;   a1.l  Next header destination address (a1 + 4)
(3)  683/     800 :                     ;-----------------------------------------------------------------------
(3)  684/     800 :                     BIOS_CDCTRN macro
(3)  685/     800 :                           CDBIOS #CDCTRN
(3)  686/     800 :                           endm
(3)  687/     800 :                     
(3)  688/     800 :                     ;-----------------------------------------------------------------------
(3)  689/     800 :                     ; BIOS_CDCACK - Informs the CDC that the current sector has been read
(3)  690/     800 :                     ; and the caller is ready for the next sector.
(3)  691/     800 :                     ;
(3)  692/     800 :                     ; input:
(3)  693/     800 :                     ;   none
(3)  694/     800 :                     ;
(3)  695/     800 :                     ; returns:
(3)  696/     800 :                     ;   nothing
(3)  697/     800 :                     ;-----------------------------------------------------------------------
(3)  698/     800 :                     BIOS_CDCACK macro
(3)  699/     800 :                           CDBIOS #CDCACK
(3)  700/     800 :                           endm
(3)  701/     800 :                     
(3)  702/     800 :                     
(3)  703/     800 :                     ;-----------------------------------------------------------------------
(3)  704/     800 :                     ; BIOS_CDCSETMODE - Tells the BIOS which mode to read the CD in.  Accepts
(3)  705/     800 :                     ; bit flags that allow selection of the three basic CD modes as follows:
(3)  706/     800 :                     ;
(3)  707/     800 :                     ;       Mode 0 (CD-DA)                              2
(3)  708/     800 :                     ;       Mode 1 (CD-ROM with full error correction)  0
(3)  709/     800 :                     ;       Mode 2 (CD-ROM with CRC only)               1
(3)  710/     800 :                     ;
(3)  711/     800 :                     ; input:
(3)  712/     800 :                     ;   d1.w  FEDCBA9876543210
(3)  713/     800 :                     ;                     ||||
(3)  714/     800 :                     ;                     |||+--> CD Mode 2
(3)  715/     800 :                     ;                     ||+---> CD-DA mode
(3)  716/     800 :                     ;                     |+----> transfer error block with data
(3)  717/     800 :                     ;                     +-----> re-read last data
(3)  718/     800 :                     ;
(3)  719/     800 :                     ; returns:
(3)  720/     800 :                     ;   nothing
(3)  721/     800 :                     ;-----------------------------------------------------------------------
(3)  722/     800 :                     BIOS_CDCSETMODE macro
(3)  723/     800 :                           CDBIOS #CDCSETMODE
(3)  724/     800 :                           endm
(3)  725/     800 :                     
(3)  726/     800 :                     
(3)  727/     800 :                     ;-----------------------------------------------------------------------
(3)  728/     800 :                     ; SUBCODES
(3)  729/     800 :                     ;-----------------------------------------------------------------------
(3)  730/     800 :                     
(3)  731/     800 :                     ;-----------------------------------------------------------------------
(3)  732/     800 :                     ; BIOS_SCDINIT - Initializes the BIOS for subcode reads.
(3)  733/     800 :                     ;
(3)  734/     800 :                     ; input:
(3)  735/     800 :                     ;   a0.l  address of scratch buffer (at least $750 long)
(3)  736/     800 :                     ;
(3)  737/     800 :                     ; returns:
(3)  738/     800 :                     ;   nothing
(3)  739/     800 :                     ;-----------------------------------------------------------------------
(3)  740/     800 :                     BIOS_SCDINIT macro
(3)  741/     800 :                           CDBIOS #SCDINIT
(3)  742/     800 :                           endm
(3)  743/     800 :                     
(3)  744/     800 :                     ;-----------------------------------------------------------------------
(3)  745/     800 :                     ; BIOS_SCDSTART - Enables reading of subcode data by the CDC.
(3)  746/     800 :                     ;
(3)  747/     800 :                     ; input:
(3)  748/     800 :                     ;   d1.w  Subcode processing mode
(3)  749/     800 :                     ;           0 = --------
(3)  750/     800 :                     ;           1 = --RSTUVW
(3)  751/     800 :                     ;           2 = PQ------
(3)  752/     800 :                     ;           3 = PQRSTUVW
(3)  753/     800 :                     ;
(3)  754/     800 :                     ; returns:
(3)  755/     800 :                     ;   nothing
(3)  756/     800 :                     ;-----------------------------------------------------------------------
(3)  757/     800 :                     BIOS_SCDSTART macro
(3)  758/     800 :                           CDBIOS #SCDSTART
(3)  759/     800 :                           endm
(3)  760/     800 :                     
(3)  761/     800 :                     ;-----------------------------------------------------------------------
(3)  762/     800 :                     ; BIOS_SCDSTOP - Disables reading of subcode data by the CDC.
(3)  763/     800 :                     ;
(3)  764/     800 :                     ; input:
(3)  765/     800 :                     ;   none
(3)  766/     800 :                     ;
(3)  767/     800 :                     ; returns:
(3)  768/     800 :                     ;   nothing
(3)  769/     800 :                     ;-----------------------------------------------------------------------
(3)  770/     800 :                     BIOS_SCDSTOP macro
(3)  771/     800 :                           CDBIOS #SCDSTOP
(3)  772/     800 :                           endm
(3)  773/     800 :                     
(3)  774/     800 :                     ;-----------------------------------------------------------------------
(3)  775/     800 :                     ; BIOS_SCDSTAT - Checks subcode error status.
(3)  776/     800 :                     ;
(3)  777/     800 :                     ; input:
(3)  778/     800 :                     ;   none
(3)  779/     800 :                     ;
(3)  780/     800 :                     ; returns:
(3)  781/     800 :                     ;   d0.l  errqcodecrc / errpackcirc / scdflag / restrcnt
(3)  782/     800 :                     ;   d1.l  erroverrun / errpacketbufful / errqcodefufful / errpackfufful
(3)  783/     800 :                     ;-----------------------------------------------------------------------
(3)  784/     800 :                     BIOS_SCDSTAT macro
(3)  785/     800 :                           CDBIOS #SCDSTAT
(3)  786/     800 :                           endm
(3)  787/     800 :                     
(3)  788/     800 :                     ;-----------------------------------------------------------------------
(3)  789/     800 :                     ; BIOS_SCDREAD - Reads R through W subcode channels.
(3)  790/     800 :                     ;
(3)  791/     800 :                     ; input:
(3)  792/     800 :                     ;   a0.l  address of subcode buffer (24 bytes minimum)
(3)  793/     800 :                     ;
(3)  794/     800 :                     ; returns:
(3)  795/     800 :                     ;   cc    Read successful
(3)  796/     800 :                     ;   cs    Read failed
(3)  797/     800 :                     ;   a0.l  address of next subcode buffer (a0.l + 24)
(3)  798/     800 :                     ;-----------------------------------------------------------------------
(3)  799/     800 :                     BIOS_SCDREAD macro
(3)  800/     800 :                           CDBIOS #SCDREAD
(3)  801/     800 :                           endm
(3)  802/     800 :                     
(3)  803/     800 :                     ;-----------------------------------------------------------------------
(3)  804/     800 :                     ; BIOS_SCDPQ - Gets P & Q codes from subcode.
(3)  805/     800 :                     ;
(3)  806/     800 :                     ; input:
(3)  807/     800 :                     ;   a0.l  address of Q code buffer (12 bytes minimum)
(3)  808/     800 :                     ;
(3)  809/     800 :                     ; returns:
(3)  810/     800 :                     ;   cc    Read successful
(3)  811/     800 :                     ;   cs    Read failed
(3)  812/     800 :                     ;   a0.l  address of next Q code buffer (a0.l + 12)
(3)  813/     800 :                     ;-----------------------------------------------------------------------
(3)  814/     800 :                     BIOS_SCDPQ macro
(3)  815/     800 :                           CDBIOS #SCDPQ
(3)  816/     800 :                           endm
(3)  817/     800 :                     
(3)  818/     800 :                     ;-----------------------------------------------------------------------
(3)  819/     800 :                     ; BIOS_SCDPQL - Gets the last P & Q codes.
(3)  820/     800 :                     ;
(3)  821/     800 :                     ; input:
(3)  822/     800 :                     ;   a0.l  address of Q code buffer (12 bytes minimum)
(3)  823/     800 :                     ;
(3)  824/     800 :                     ; returns:
(3)  825/     800 :                     ;   cc    Read successful
(3)  826/     800 :                     ;   cs    Read failed
(3)  827/     800 :                     ;   a0.l  address of next Q code buffer (a0.l + 12)
(3)  828/     800 :                     ;-----------------------------------------------------------------------
(3)  829/     800 :                     BIOS_SCDPQL macro
(3)  830/     800 :                           CDBIOS #SCDPQL
(3)  831/     800 :                           endm
(3)  832/     800 :                     
(3)  833/     800 :                     
(3)  834/     800 :                     ;-----------------------------------------------------------------------
(3)  835/     800 :                     ; FRONT PANEL LEDS
(3)  836/     800 :                     ;-----------------------------------------------------------------------
(3)  837/     800 :                     
(3)  838/     800 :                     ;-----------------------------------------------------------------------
(3)  839/     800 :                     ; BIOS_LEDSET - Controls the Ready and Access LED's on the front panel
(3)  840/     800 :                     ; of the CD unit.
(3)  841/     800 :                     ;
(3)  842/     800 :                     ; input:
(3)  843/     800 :                     ;   d1.w  MODE          Ready (green)   Access (red)    System Indication
(3)  844/     800 :                     ;         ---------------------------------------------------------------
(3)  845/     800 :                     ;                           off             off         only at reset
(3)  846/     800 :                     ;         LEDREADY (0)      on              blink       CD ready / no disk
(3)  847/     800 :                     ;         LEDDISCIN (1)     on              off         CD ready / disk ok
(3)  848/     800 :                     ;         LEDACCESS (2)     on              on          CD accessing
(3)  849/     800 :                     ;         LEDSTANDBY (3)    blink           off         standby mode
(3)  850/     800 :                     ;         LEDERROR (4)      blink           blink       reserved
(3)  851/     800 :                     ;         LEDMODE5 (5)      blink           on          reserved
(3)  852/     800 :                     ;         LEDMODE6 (6)      off             blink       reserved
(3)  853/     800 :                     ;         LEDMODE7 (7)      off             on          reserved
(3)  854/     800 :                     ;         LEDSYSTEM (?)                                 rtn ctrl to BIOS
(3)  855/     800 :                     ;
(3)  856/     800 :                     ; returns:
(3)  857/     800 :                     ;   nothing
(3)  858/     800 :                     ;-----------------------------------------------------------------------
(3)  859/     800 :                     BIOS_LEDSET macro
(3)  860/     800 :                           CDBIOS #LEDSET
(3)  861/     800 :                           endm
(3)  862/     800 :                     
(3)  863/     800 :                     
(3)  864/     800 :                     ;-----------------------------------------------------------------------
(3)  865/     800 :                     ; Back-Up RAM
(3)  866/     800 :                     ;-----------------------------------------------------------------------
(3)  867/     800 :                     
(3)  868/     800 :                     
(3)  869/     800 :                     ;-----------------------------------------------------------------------
(3)  870/     800 :                     ; NOTE:  The backup ram on the super target devlopment systems is write
(3)  871/     800 :                     ;         protected if the production Boot Rom is being used.  A
(3)  872/     800 :                     ;         Development Boot Rom must be obtained before the backup ram can
(3)  873/     800 :                     ;         be used.
(3)  874/     800 :                     ;
(3)  875/     800 :                     ;        The name of the save game files must be registered with SOJ before
(3)  876/     800 :                     ;         a game can be shipped.
(3)  877/     800 :                     ;
(3)  878/     800 :                     ;        Please make sure to read the CD Software Standards section in the
(3)  879/     800 :                     ;         manual.  There is a section on backup ram standards that must be
(3)  880/     800 :                     ;         followed.
(3)  881/     800 :                     ;
(3)  882/     800 :                     ;        For a full description of each Back-Up Ram function, see the BIOS
(3)  883/     800 :                     ;         section of the CD manual.
(3)  884/     800 :                     ;
(3)  885/     800 :                     ;        Some of the Back-Up RAM functions require a string buffer to
(3)  886/     800 :                     ;         be passed into the function.  Some of these functions return
(3)  887/     800 :                     ;         0 terminated text strings.
(3)  888/     800 :                     ;-------------------------------------------------------------------------
(3)  889/     800 :                     
(3)  890/     800 :                     
(3)  891/     800 :                     ;-----------------------------------------------------------------------
(3)  892/     800 :                     ; BIOS_BRMINIT - Prepares to write into and read from Back-Up Ram.
(3)  893/     800 :                     ;
(3)  894/     800 :                     ; input:
(3)  895/     800 :                     ;   a0.l  pointer to scratch ram (size $640 bytes).
(3)  896/     800 :                     ;
(3)  897/     800 :                     ;   a1.l  pointer to the buffer for display strings (size: 12 bytes)
(3)  898/     800 :                     ;
(3)  899/     800 :                     ; returns:
(3)  900/     800 :                     ;   cc    SEGA formatted RAM is present
(3)  901/     800 :                     ;   cs    Not formatted or no RAM
(3)  902/     800 :                     ;   d0.w  size of backup RAM  $2(000) ~ $100(000)  bytes
(3)  903/     800 :                     ;   d1.w  0 : No RAM
(3)  904/     800 :                     ;         1 : Not Formatted
(3)  905/     800 :                     ;         2 : Other Format
(3)  906/     800 :                     ;   a1.l  pointer to display strings
(3)  907/     800 :                     ;-----------------------------------------------------------------------
(3)  908/     800 :                     BIOS_BRMINIT macro
(3)  909/     800 :                           BURAM #BRMINIT
(3)  910/     800 :                           endm
(3)  911/     800 :                     
(3)  912/     800 :                     ;-----------------------------------------------------------------------
(3)  913/     800 :                     ; BIOS_BRMSTAT - Returns how much Back-Up RAM has been used.
(3)  914/     800 :                     ;
(3)  915/     800 :                     ; input:
(3)  916/     800 :                     ;   a1.l  pointer to display string buffer (size: 12 bytes)
(3)  917/     800 :                     ;
(3)  918/     800 :                     ; returns:
(3)  919/     800 :                     ;   d0.w  number of blocks of free area
(3)  920/     800 :                     ;   d1.w  number of files in directory
(3)  921/     800 :                     ;-----------------------------------------------------------------------
(3)  922/     800 :                     BIOS_BRMSTAT macro
(3)  923/     800 :                           BURAM #BRMSTAT
(3)  924/     800 :                           endm
(3)  925/     800 :                     
(3)  926/     800 :                     ;-----------------------------------------------------------------------
(3)  927/     800 :                     ; BIOS_BRMSERCH - Searches for the desired file in Back-Up Ram.  The file
(3)  928/     800 :                     ;                  names are 11 ASCII characters terminated with a 0.
(3)  929/     800 :                     ;
(3)  930/     800 :                     ; input:
(3)  931/     800 :                     ;   a0.l  pointer to parameter (file name) table
(3)  932/     800 :                     ;             file name = 11 ASCII chars [0~9 A~Z_]   0 terminated
(3)  933/     800 :                     ;
(3)  934/     800 :                     ; returns:
(3)  935/     800 :                     ;   cc    file name found
(3)  936/     800 :                     ;   cs    file name not found
(3)  937/     800 :                     ;   d0.w  number of blocks
(3)  938/     800 :                     ;   d1.b  MODE
(3)  939/     800 :                     ;         0 : normal
(3)  940/     800 :                     ;        -1 : data protected (with protect function)
(3)  941/     800 :                     ;   a0.l  backup ram start address for search
(3)  942/     800 :                     ;-----------------------------------------------------------------------
(3)  943/     800 :                     BIOS_BRMSERCH macro
(3)  944/     800 :                           BURAM #BRMSERCH
(3)  945/     800 :                           endm
(3)  946/     800 :                     
(3)  947/     800 :                     ;-----------------------------------------------------------------------
(3)  948/     800 :                     ; BIOS_BRMREAD - reads data from Back-Up RAM.
(3)  949/     800 :                     ;
(3)  950/     800 :                     ; input:
(3)  951/     800 :                     ;   a0.l  pointer to parameter (file name) table
(3)  952/     800 :                     ;   a1.l  pointer to write buffer
(3)  953/     800 :                     ;
(3)  954/     800 :                     ; returns:
(3)  955/     800 :                     ;   cc    Read Okay
(3)  956/     800 :                     ;   cs    Error
(3)  957/     800 :                     ;   d0.w  number of blocks
(3)  958/     800 :                     ;   d1.b  MODE
(3)  959/     800 :                     ;         0 : normal
(3)  960/     800 :                     ;        -1 : data protected
(3)  961/     800 :                     ;-----------------------------------------------------------------------
(3)  962/     800 :                     BIOS_BRMREAD macro
(3)  963/     800 :                           BURAM #BRMREAD
(3)  964/     800 :                           endm
(3)  965/     800 :                     
(3)  966/     800 :                     ;-----------------------------------------------------------------------
(3)  967/     800 :                     ; BIOS_BRMWRITE - Writes data in Back-Up RAM.
(3)  968/     800 :                     ;
(3)  969/     800 :                     ; input:
(3)  970/     800 :                     ;   a0.l  pointer to parameter (file name) table
(3)  971/     800 :                     ;          flag.b       $00: normal
(3)  972/     800 :                     ;                       $FF: encoded (with protect function)
(3)  973/     800 :                     ;          block_size.w $00: 1 block = $40 bytes
(3)  974/     800 :                     ;                       $FF: 1 block = $20 bytes
(3)  975/     800 :                     ;   a1.l  pointer to save data
(3)  976/     800 :                     ;
(3)  977/     800 :                     ; returns:
(3)  978/     800 :                     ;   cc    Okay, complete
(3)  979/     800 :                     ;   cs    Error, cannot write in the file
(3)  980/     800 :                     ;-----------------------------------------------------------------------
(3)  981/     800 :                     BIOS_BRMWRITE macro
(3)  982/     800 :                           BURAM #BRMWRITE
(3)  983/     800 :                           endm
(3)  984/     800 :                     
(3)  985/     800 :                     ;-----------------------------------------------------------------------
(3)  986/     800 :                     ; BIOS_BRMDEL - Deletes data on Back-Up Ram.
(3)  987/     800 :                     ;
(3)  988/     800 :                     ; input:
(3)  989/     800 :                     ;   a0.l  pointer to parameter (file name) table
(3)  990/     800 :                     ;
(3)  991/     800 :                     ; returns:
(3)  992/     800 :                     ;   cc    deleted
(3)  993/     800 :                     ;   cs    not found
(3)  994/     800 :                     ;-----------------------------------------------------------------------
(3)  995/     800 :                     BIOS_BRMDEL macro
(3)  996/     800 :                           BURAM #BRMDEL
(3)  997/     800 :                           endm
(3)  998/     800 :                     
(3)  999/     800 :                     ;-----------------------------------------------------------------------
(3) 1000/     800 :                     ; BIOS_BRMFORMAT - First initializes the directory and then formats the
(3) 1001/     800 :                     ;                   Back-Up RAM
(3) 1002/     800 :                     ;
(3) 1003/     800 :                     ;                  Call BIOS_BRMINIT before calling this function
(3) 1004/     800 :                     ;
(3) 1005/     800 :                     ; input:
(3) 1006/     800 :                     ;   none
(3) 1007/     800 :                     ;
(3) 1008/     800 :                     ; returns:
(3) 1009/     800 :                     ;   cc    Okay, formatted
(3) 1010/     800 :                     ;   cs    Error, cannot format
(3) 1011/     800 :                     ;-----------------------------------------------------------------------
(3) 1012/     800 :                     BIOS_BRMFORMAT macro
(3) 1013/     800 :                           BURAM #BRMFORMAT
(3) 1014/     800 :                           endm
(3) 1015/     800 :                     
(3) 1016/     800 :                     ;-----------------------------------------------------------------------
(3) 1017/     800 :                     ; BIOS_BRMDIR - Reads directory
(3) 1018/     800 :                     ;
(3) 1019/     800 :                     ; input:
(3) 1020/     800 :                     ;   d1.l  H: number of files to skip when all files cannot be read in one try
(3) 1021/     800 :                     ;         L: size of directory buffer (# of files that can be read in the
(3) 1022/     800 :                     ;             directory buffer)
(3) 1023/     800 :                     ;   a0.l  pointer to parameter (file name) table
(3) 1024/     800 :                     ;   a1.l  pointer to directory buffer
(3) 1025/     800 :                     ;
(3) 1026/     800 :                     ; returns:
(3) 1027/     800 :                     ;   cc    Okay, complete
(3) 1028/     800 :                     ;   cs    Full, too much to read into directory buffer
(3) 1029/     800 :                     ;-----------------------------------------------------------------------
(3) 1030/     800 :                     BIOS_BRMDIR macro
(3) 1031/     800 :                           BURAM #BRMDIR
(3) 1032/     800 :                           endm
(3) 1033/     800 :                     
(3) 1034/     800 :                     ;-----------------------------------------------------------------------
(3) 1035/     800 :                     ; BIOS_BRMVERIFY - Checks data written on Back-Up Ram.
(3) 1036/     800 :                     ;
(3) 1037/     800 :                     ; input:
(3) 1038/     800 :                     ;   a0.l  pointer to parameter (file name) table
(3) 1039/     800 :                     ;          flag.b       $00: normal
(3) 1040/     800 :                     ;                       $FF: encoded (with protect function)
(3) 1041/     800 :                     ;          block_size.w $00: 1 block = $40 bytes
(3) 1042/     800 :                     ;                       $FF: 1 block = $20 bytes
(3) 1043/     800 :                     ;   a1.l  pointer to save data
(3) 1044/     800 :                     ;
(3) 1045/     800 :                     ; returns:
(3) 1046/     800 :                     ;   cc    Okay
(3) 1047/     800 :                     ;   cs    Error
(3) 1048/     800 :                     ;   d0.w  Error Number
(3) 1049/     800 :                     ;        -1 : Data does not match
(3) 1050/     800 :                     ;         0 : File not found
(3) 1051/     800 :                     ;-----------------------------------------------------------------------
(3) 1052/     800 :                     BIOS_BRMVERIFY macro
(3) 1053/     800 :                           BURAM #BRMVERIFY
(3) 1054/     800 :                           endm
(3) 1055/     800 :                     
(3) 1056/     800 :                     
(2)   21/     800 :                     		
(2)   22/     800 :                     ; ====================================================================
(2)   23/     800 :                     ; ----------------------------------------------------------------
(2)   24/     800 :                     ; MAIN CODE
(2)   25/     800 :                     ; ----------------------------------------------------------------
(2)   26/     800 :                     
(2)   27/    6000 :                     		phase $6000
(2)   28/    6000 : 4D41 494E 2D42 4F4F 		dc.b "MAIN-BOOT  ",0
                    5420 2000           
(2)   29/    600C : 0000 0000           		dc.w 0,0
(2)   30/    6010 : 0000 0000           		dc.l 0
(2)   31/    6014 : 0000 0000           		dc.l 0
(2)   32/    6018 : 0000 0020           		dc.l $20
(2)   33/    601C : 0000 0000           		dc.l 0
(2)   34/    6020 :                     .table:
(2)   35/    6020 : 0008                		dc.w SP_Init-.table
(2)   36/    6022 : 004C                		dc.w SP_Main-.table
(2)   37/    6024 : 008C                		dc.w SP_IRQ-.table
(2)   38/    6026 : 0000                		dc.w 0
(2)   39/    6028 :                     
(2)   40/    6028 :                     ; ====================================================================
(2)   41/    6028 :                     ; ----------------------------------------------------------------
(2)   42/    6028 :                     ; Init
(2)   43/    6028 :                     ; ----------------------------------------------------------------
(2)   44/    6028 :                     
(2)   45/    6028 :                     SP_Init:
(2)   46/    6028 :                     ; 		move.w	#$2700,sr
(2)   47/    6028 : 1039 FFFF 8003      		move.b	(scpu_reg+mcd_memory).l,d0
(2)   48/    602E : 0880 0002           		bclr	#bitWRamMode,d0
(2)   49/    6032 : 13C0 FFFF 8003      		move.b	d0,(scpu_reg+mcd_memory).l
(2)   50/    6038 : 6100 01B2           		bsr	SP_InitISO
(2)   51/    603C : 11FC 0000 800F      		move.b	#0,(scpu_reg+mcd_comm_s).w	; Reset SUB-status
(2)   52/    6042 :                     
(2)   53/    6042 :                     ; 		lea	(PCM),a0
(2)   54/    6042 :                     ; 		move.b	#$80,d3
(2)   55/    6042 :                     ; 		moveq	#$F,d5
(2)   56/    6042 :                     ; @Next:
(2)   57/    6042 :                     ; 		move.b	d3,Ctrl(a0)
(2)   58/    6042 :                     ; 		bsr	PCM_Wait
(2)   59/    6042 :                     ; 		lea	($FF2001),a2
(2)   60/    6042 :                     ; 		move.w	#$FFF,d0
(2)   61/    6042 :                     ; @loop1:
(2)   62/    6042 :                     ; 		move.b	#$FF,(a2)
(2)   63/    6042 :                     ; 		addq.l	#2,a2
(2)   64/    6042 :                     ; 		dbf	d0,@loop1
(2)   65/    6042 :                     ; 		move.b	d3,Ctrl(a0)
(2)   66/    6042 :                     ; 		bsr	PCM_Wait
(2)   67/    6042 :                     ; 		add.b	#1,d3
(2)   68/    6042 :                     ; 		dbf	d5,@Next
(2)   69/    6042 :                     
(2)   70/    6042 :                     
(2)   71/    6042 :                     ; 		BSET	#1,$FF8033
(2)   72/    6042 :                     ; 		BSET	#2,$FF8033
(2)   73/    6042 :                     ; 		BCLR	#3,$FF8033
(2)   74/    6042 :                     
(2)   75/    6042 :                     	; SCD32X:
(2)   76/    6042 :                     	;
(2)   77/    6042 :                     	; Load the SH2 code from DISC to WORD-RAM
(2)   78/    6042 :                     	;
(2)   79/    6042 :                     	; TODO: I hope SUB has WRAM permission...
(2)   80/    6042 :                     	; I don't have a SCD to test this.
(2)   81/    6042 :                     
(2)   82/    6042 :                     	; TODO IsoRead is broken
(2)   84/    6042 : 41FA 001A           		lea	fname_mars(pc),a0
(2)   85/    6046 : 6100 01E6           		bsr	SP_FindFile
(2)   86/    604A :                     
(2)   87/    604A : 303C 003B           		move.w	#$1D800/$800,d0
(2)   88/    604E : 343C 0800           		move.w	#$800,d2
(2)   89/    6052 : 41F9 0008 0000      		lea	(scpu_wram),a0
(2)   90/    6058 : 6100 011E           		bsr	SP_IsoReadN
(2)   92/    605C : 4E75                		rts
(2)   94/    605E : 4D41 5253 434F 4445 fname_mars:	dc.b "MARSCODE.BIN",0
                    2E42 494E 00        
(2)   95/    606B :                     		align 2
(2)   97/    606C :                     
(2)   98/    606C :                     ; ====================================================================
(2)   99/    606C :                     ; ----------------------------------------------------------------
(2)  100/    606C :                     ; Main
(2)  101/    606C :                     ;
(2)  102/    606C :                     ; mcd_comm_m COMMAND READ ONLY:
(2)  103/    606C :                     ; %lp0iiiii
(2)  104/    606C :                     ;
(2)  105/    606C :                     ; mcd_comm_s STATUS READ/WRITE:
(2)  106/    606C :                     ; %bp000000
(2)  107/    606C :                     ;
(2)  108/    606C :                     ; DONT USE BSET/BCLR/BTST or CLR DIRECTLY
(2)  109/    606C :                     ; TO THE PORTS
(2)  110/    606C :                     ;
(2)  111/    606C :                     ; a6 - comm data MAIN (READ ONLY)
(2)  112/    606C :                     ; a5 - comm data SUB (READ/WRITE)
(2)  113/    606C :                     ; ----------------------------------------------------------------
(2)  114/    606C :                     
(2)  115/    606C :                     SP_Main:
(2)  116/    606C : 4DF8 8010           		lea	(scpu_reg+mcd_dcomm_m),a6
(2)  117/    6070 : 4BF8 8020           		lea	(scpu_reg+mcd_dcomm_s),a5
(2)  118/    6074 :                     .wait_main:
(2)  119/    6074 : 3E2D 000E           		move.w	$E(a5),d7
(2)  120/    6078 : 5247                		addq.w	#1,d7
(2)  121/    607A : 3B47 000E           		move.w	d7,$E(a5)
(2)  122/    607E : 1038 800E           		move.b	(scpu_reg+mcd_comm_m).w,d0	; d7
(2)  123/    6082 : 0240 001F           		andi.w	#%11111,d0			; <-- current limit
(2)  124/    6086 : 67EC                		beq.s	.wait_main
(2)  125/    6088 : 1E38 800F           		move.b	(scpu_reg+mcd_comm_s).w,d7
(2)  126/    608C : 08C7 0007           		bset	#7,d7
(2)  127/    6090 : 11C7 800F           		move.b	d7,(scpu_reg+mcd_comm_s).w	; Set as BUSY
(2)  128/    6094 : D040                		add.w	d0,d0				; * 2
(2)  129/    6096 : 323B 0016           		move.w	SP_cmdlist(pc,d0.w),d1
(2)  130/    609A : 4EBB 1012           		jsr	SP_cmdlist(pc,d1.w)
(2)  131/    609E : 1E38 800F           		move.b	(scpu_reg+mcd_comm_s).w,d7
(2)  132/    60A2 : 0887 0007           		bclr	#7,d7
(2)  133/    60A6 : 11C7 800F           		move.b	d7,(scpu_reg+mcd_comm_s).w	; Remove BUSY bit, finished
(2)  134/    60AA : 60C0                		bra.s	SP_Main
(2)  135/    60AC :                     		
(2)  136/    60AC :                     ; =====================================================================
(2)  137/    60AC :                     ; ----------------------------------------------------------------
(2)  138/    60AC :                     ; Level 2 IRQ
(2)  139/    60AC :                     ; ----------------------------------------------------------------
(2)  140/    60AC :                     
(2)  141/    60AC :                     SP_IRQ:
(2)  142/    60AC : 4E75                		rts
(2)  143/    60AE :                     
(2)  144/    60AE :                     ; =====================================================================
(2)  145/    60AE :                     ; ----------------------------------------------------------------
(2)  146/    60AE :                     ; Commands list
(2)  147/    60AE :                     ; ----------------------------------------------------------------
(2)  148/    60AE :                     
(2)  149/    60AE :                     SP_cmdlist:
(2)  150/    60AE : 0022                		dc.w SP_cmnd00-SP_cmdlist
(2)  151/    60B0 : 0024                		dc.w SP_cmnd01-SP_cmdlist
(2)  152/    60B2 : 0094                		dc.w SP_cmnd02-SP_cmdlist
(2)  153/    60B4 : 0022                		dc.w SP_cmnd00-SP_cmdlist
(2)  154/    60B6 : 0022                		dc.w SP_cmnd00-SP_cmdlist
(2)  155/    60B8 : 0022                		dc.w SP_cmnd00-SP_cmdlist
(2)  156/    60BA : 0022                		dc.w SP_cmnd00-SP_cmdlist
(2)  157/    60BC : 0022                		dc.w SP_cmnd00-SP_cmdlist
(2)  158/    60BE :                     
(2)  159/    60BE : 0022                		dc.w SP_cmnd00-SP_cmdlist
(2)  160/    60C0 : 0022                		dc.w SP_cmnd00-SP_cmdlist
(2)  161/    60C2 : 0022                		dc.w SP_cmnd00-SP_cmdlist
(2)  162/    60C4 : 0022                		dc.w SP_cmnd00-SP_cmdlist
(2)  163/    60C6 : 0022                		dc.w SP_cmnd00-SP_cmdlist
(2)  164/    60C8 : 0022                		dc.w SP_cmnd00-SP_cmdlist
(2)  165/    60CA : 0022                		dc.w SP_cmnd00-SP_cmdlist
(2)  166/    60CC : 0022                		dc.w SP_cmnd00-SP_cmdlist
(2)  167/    60CE :                     
(2)  168/    60CE : 00BA                		dc.w SP_cmnd10-SP_cmdlist
(2)  169/    60D0 :                     
(2)  170/    60D0 :                     ; --------------------------------------------------------
(2)  171/    60D0 :                     ; NULL COMMAND
(2)  172/    60D0 :                     ; --------------------------------------------------------
(2)  173/    60D0 :                     
(2)  174/    60D0 :                     SP_cmnd00:
(2)  175/    60D0 : 4E75                		rts
(2)  176/    60D2 :                     
(2)  177/    60D2 :                     ; --------------------------------------------------------
(2)  178/    60D2 :                     ; Command $01
(2)  179/    60D2 :                     ;
(2)  180/    60D2 :                     ; Read data from disc and transfer through
(2)  181/    60D2 :                     ; dcomm_s as packets of $10 bytes
(2)  182/    60D2 :                     ;
(2)  183/    60D2 :                     ; mcd_comm_m: %lp------
(2)  184/    60D2 :                     ; l - Lock bit, unlocking breaks data-loop.
(2)  185/    60D2 :                     ; p - MAIN response bit
(2)  186/    60D2 :                     ;
(2)  187/    60D2 :                     ; mcd_comm_s: %-p------
(2)  188/    60D2 :                     ; p - PASS bit
(2)  189/    60D2 :                     ;
(2)  190/    60D2 :                     ; mcd_dcomm_m:
(2)  191/    60D2 :                     ; dc.b "FILENAME.BIN",0
(2)  192/    60D2 :                     ;
(2)  193/    60D2 :                     ; mcd_dcomm_s:
(2)  194/    60D2 :                     ; packed data, all bytes used.
(2)  195/    60D2 :                     ; --------------------------------------------------------
(2)  196/    60D2 :                     
(2)  197/    60D2 :                     SP_cmnd01:
(2)  198/    60D2 : 204E                		move.l	a6,a0			; a0 - filename
(2)  199/    60D4 : 6100 0158           		bsr	SP_FindFile
(2)  200/    60D8 : 343C 0800           		move.w	#$800,d2
(2)  201/    60DC : 5241                		addq.w	#1,d1			; TODO: check if 0 counts
(2)  202/    60DE : 41F9 0000 E500      		lea	(ISO_Output),a0
(2)  203/    60E4 : 6100 0092           		bsr	SP_IsoReadN
(2)  204/    60E8 : 41F9 0000 E500      		lea	(ISO_Output),a0
(2)  205/    60EE :                     .next_packet:
(2)  206/    60EE : 224D                		move.l	a5,a1
(2)  207/    60F0 : 32D8                		move.w	(a0)+,(a1)+	; WORD writes to be safe...
(2)  208/    60F2 : 32D8                		move.w	(a0)+,(a1)+
(2)  209/    60F4 : 32D8                		move.w	(a0)+,(a1)+
(2)  210/    60F6 : 32D8                		move.w	(a0)+,(a1)+
(2)  211/    60F8 : 32D8                		move.w	(a0)+,(a1)+
(2)  212/    60FA : 32D8                		move.w	(a0)+,(a1)+
(2)  213/    60FC : 32D8                		move.w	(a0)+,(a1)+
(2)  214/    60FE : 32D8                		move.w	(a0)+,(a1)+
(2)  215/    6100 : 1E38 800F           		move.b	(scpu_reg+mcd_comm_s).w,d7	; PASS bit
(2)  216/    6104 : 08C7 0006           		bset	#6,d7
(2)  217/    6108 : 11C7 800F           		move.b	d7,(scpu_reg+mcd_comm_s).w
(2)  218/    610C : 1E38 800E           .wait_main:	move.b	(scpu_reg+mcd_comm_m).w,d7	; MAIN got data?
(2)  219/    6110 : 0807 0007           		btst	#7,d7				; Unlocked?
(2)  220/    6114 : 671E                		beq.s	.exit_now
(2)  221/    6116 : 0807 0006           		btst	#6,d7				; MAIN got the data?
(2)  222/    611A : 67F0                		beq.s	.wait_main
(2)  223/    611C : 1E38 800F           		move.b	(scpu_reg+mcd_comm_s).w,d7	; Clear PASS
(2)  224/    6120 : 0887 0006           		bclr	#6,d7
(2)  225/    6124 : 11C7 800F           		move.b	d7,(scpu_reg+mcd_comm_s).w
(2)  226/    6128 : 1E38 800E           .wait_main_o:	move.b	(scpu_reg+mcd_comm_m).w,d7	; Wait MAIN response.
(2)  227/    612C : 0807 0006           		btst	#6,d7
(2)  228/    6130 : 66F6                		bne.s	.wait_main_o
(2)  229/    6132 : 60BA                		bra.s	.next_packet
(2)  230/    6134 : 1E38 800F           .exit_now:	move.b	(scpu_reg+mcd_comm_s).w,d7	; Clear PASS
(2)  231/    6138 : 0887 0006           		bclr	#6,d7
(2)  232/    613C : 11C7 800F           		move.b	d7,(scpu_reg+mcd_comm_s).w
(2)  233/    6140 : 4E75                		rts
(2)  234/    6142 :                     
(2)  235/    6142 :                     ; --------------------------------------------------------
(2)  236/    6142 :                     ; Command $02
(2)  237/    6142 :                     ;
(2)  238/    6142 :                     ; Read data from disc and sends it to WORD-RAM
(2)  239/    6142 :                     ;
(2)  240/    6142 :                     ; mcd_dcomm_m:
(2)  241/    6142 :                     ; dc.b "FILENAME.BIN",0
(2)  242/    6142 :                     ; --------------------------------------------------------
(2)  243/    6142 :                     
(2)  244/    6142 :                     SP_cmnd02:
(2)  245/    6142 : 204E                		move.l	a6,a0				; a0 - filename
(2)  246/    6144 : 6100 00E8           		bsr	SP_FindFile
(2)  247/    6148 : 343C 0800           		move.w	#$800,d2
(2)  248/    614C : 5241                		addq.w	#1,d1				; TODO: check if 0 counts
(2)  249/    614E : 41F9 0008 0000      		lea	(scpu_wram),a0
(2)  250/    6154 : 6122                		bsr	SP_IsoReadN
(2)  251/    6156 : 1039 FFFF 8003      		move.b	(scpu_reg+mcd_memory).l,d0	; Return WORDRAM to MAIN, RET=1
(2)  252/    615C : 08C0 0000           		bset	#0,d0
(2)  253/    6160 : 13C0 FFFF 8003      		move.b	d0,(scpu_reg+mcd_memory).l
(2)  254/    6166 : 4E75                		rts
(2)  255/    6168 :                     
(2)  256/    6168 :                     
(2)  257/    6168 :                     SP_cmnd10:
(2)  258/    6168 :                     ; 		movea.l	a6,a0
(2)  259/    6168 : 41FA 000C           		lea	.this(pc),a0
(2)  260/    616C : (MACRO)             		BIOS_MSCPLAYR
(2)  260/    616C :  (MACRO-2)                CDBIOS #MSCPLAYR
(2)  260/    616C : 303C 0013                 move.w    #MSCPLAYR,d0
(2)  260/    6170 : 4EB8 5F22                 jsr       _CDBIOS
(2)  261/    6174 : 4E75                		rts
(2)  262/    6176 :                     
(2)  263/    6176 :                     		align 2
(2)  264/    6176 : 0002                .this:		dc.w 2
(2)  265/    6178 :                     
(2)  266/    6178 :                     ; =====================================================================
(2)  267/    6178 :                     ; ----------------------------------------------------------------
(2)  268/    6178 :                     ; Subroutines
(2)  269/    6178 :                     ; ----------------------------------------------------------------
(2)  270/    6178 :                     
(2)  271/    6178 :                     ; --------------------------------------------------------
(2)  272/    6178 :                     ; CD-ROM data
(2)  273/    6178 :                     ; --------------------------------------------------------
(2)  274/    6178 :                     
(2)  275/    6178 :                     ; ------------------------------------------------
(2)  276/    6178 :                     ; SP_IsoReadN
(2)  277/    6178 :                     ;
(2)  278/    6178 :                     ; Input:
(2)  279/    6178 :                     ; a0 - Destination
(2)  280/    6178 :                     ; d0 - Sector start
(2)  281/    6178 :                     ; d1 - Number of sectors
(2)  282/    6178 :                     ; d2 - Destination increment ($0 or $800)
(2)  283/    6178 :                     ; ------------------------------------------------
(2)  284/    6178 :                     
(2)  285/    6178 :                     SP_IsoReadN:
(2)  286/    6178 : 48E7 1E00           		movem.l	d3-d6,-(sp)
(2)  287/    617C : 0280 0000 FFFF      		andi.l	#$FFFF,d0
(2)  288/    6182 : 0281 0000 FFFF      		andi.l	#$FFFF,d1
(2)  289/    6188 : 21C0 6300           		move.l	d0,(Sub_BiosArgs)
(2)  290/    618C : 21C1 6304           		move.l	d1,(Sub_BiosArgs+4)
(2)  291/    6190 : 2448                		movea.l	a0,a2
(2)  292/    6192 : (MACRO)             		BIOS_CDCSTOP			; Stop disc
(2)  292/    6192 :  (MACRO-2)                CDBIOS #CDCSTOP
(2)  292/    6192 : 303C 0089                 move.w    #CDCSTOP,d0
(2)  292/    6196 : 4EB8 5F22                 jsr       _CDBIOS
(2)  293/    619A : 41F8 6300           		lea	(Sub_BiosArgs),a0
(2)  294/    619E : (MACRO)             		BIOS_ROMREADN			; Start from this sector
(2)  294/    619E :  (MACRO-2)                CDBIOS #ROMREADN
(2)  294/    619E : 303C 0020                 move.w    #ROMREADN,d0
(2)  294/    61A2 : 4EB8 5F22                 jsr       _CDBIOS
(2)  295/    61A6 :                     .waitSTAT:
(2)  296/    61A6 : (MACRO)              		BIOS_CDCSTAT			; Ready?
(2)  296/    61A6 :  (MACRO-2)                CDBIOS #CDCSTAT
(2)  296/    61A6 : 303C 008A                 move.w    #CDCSTAT,d0
(2)  296/    61AA : 4EB8 5F22                 jsr       _CDBIOS
(2)  297/    61AE : 65F6                 		bcs.s	.waitSTAT
(2)  298/    61B0 :                     .waitREAD:
(2)  299/    61B0 : (MACRO)             		BIOS_CDCREAD			; Read data
(2)  299/    61B0 :  (MACRO-2)                CDBIOS #CDCREAD
(2)  299/    61B0 : 303C 008B                 move.w    #CDCREAD,d0
(2)  299/    61B4 : 4EB8 5F22                 jsr       _CDBIOS
(2)  300/    61B8 : 64F6                		bcc.s	.waitREAD		; If not done, branch
(2)  301/    61BA :                     .WaitTransfer:
(2)  302/    61BA : 204A                		movea.l	a2,a0			; Set destination address
(2)  303/    61BC : 43F8 6310           		lea	(Sub_BiosArgs+$10),a1	; Set head buffer
(2)  304/    61C0 : (MACRO)             		BIOS_CDCTRN			; Transfer sector
(2)  304/    61C0 :  (MACRO-2)                CDBIOS #CDCTRN
(2)  304/    61C0 : 303C 008C                 move.w    #CDCTRN,d0
(2)  304/    61C4 : 4EB8 5F22                 jsr       _CDBIOS
(2)  305/    61C8 : 64F0                		bcc.s	.waitTransfer		; If not done, branch
(2)  306/    61CA : (MACRO)             		BIOS_CDCACK			; Acknowledge transfer
(2)  306/    61CA :  (MACRO-2)                CDBIOS #CDCACK
(2)  306/    61CA : 303C 008D                 move.w    #CDCACK,d0
(2)  306/    61CE : 4EB8 5F22                 jsr       _CDBIOS
(2)  307/    61D2 : D4C2                		adda	d2,a2
(2)  308/    61D4 : 06B8 0000 0001 6300 		add.l	#1,(Sub_BiosArgs)
(2)  309/    61DC : 04B8 0000 0001 6304 		sub.l	#1,(Sub_BiosArgs+4)
(2)  310/    61E4 : 66C0                		bne.s	.waitSTAT
(2)  311/    61E6 : 4CDF 0078           		movem.l	(sp)+,d3-d6
(2)  312/    61EA : 4E75                		rts
(2)  313/    61EC :                     
(2)  314/    61EC :                     ; ------------------------------------------------
(2)  315/    61EC :                     ; ISO9660 Driver
(2)  316/    61EC :                     ; ------------------------------------------------
(2)  317/    61EC :                     
(2)  318/    61EC :                     SP_InitISO:
(2)  319/    61EC : 48E7 FFFE           		movem.l	d0-d7/a0-a6,-(a7)
(2)  320/    61F0 :                     	; Load Volume VolumeDescriptor
(2)  321/    61F0 : 7010                		moveq	#$10,d0			; Start Sector (at $8000)
(2)  322/    61F2 : 7210                		moveq	#$10,d1			; Sector size
(2)  323/    61F4 : 343C 0800           		move.w	#$800,d2
(2)  324/    61F8 : 41F8 6500           		lea	(ISO_Files),a0		; Destination
(2)  325/    61FC : 6100 FF7A           		bsr	SP_IsoReadN
(2)  326/    6200 :                     	; Load Root Directory
(2)  327/    6200 : 41F8 6500           		lea	(ISO_Files),a0		; Get pointer to sector buffer
(2)  328/    6204 : 43E8 009C           		lea.l	$9C(a0),a1		; Get root directory record
(2)  329/    6208 : 1029 0006           		move.b	6(a1),d0		; Get first part of Sector address
(2)  330/    620C : E188                		lsl.l	#8,d0			; bitshift
(2)  331/    620E : 1029 0007           		move.b	7(a1),d0		; Get next part of sector address
(2)  332/    6212 : E188                		lsl.l	#8,d0			; bitshift
(2)  333/    6214 : 1029 0008           		move.b	8(a1),d0		; get next part of sector address
(2)  334/    6218 : E188                		lsl.l	#8,d0			; bitshift
(2)  335/    621A : 1029 0009           		move.b	9(a1),d0		; get final part of sector address.
(2)  336/    621E :                     	; d0 now contains start sector address
(2)  337/    621E : 7220                		moveq	#$20,d1			; Size ($20 Sectors)
(2)  338/    6220 : 343C 0800           		move.w	#$800,d2
(2)  339/    6224 : 6100 FF52           		bsr	SP_IsoReadN
(2)  340/    6228 : 4CDF 7FFF           		movem.l	(a7)+,d0-d7/a0-a6	; Restore all registers
(2)  341/    622C : 4E75                		rts
(2)  342/    622E :                     
(2)  343/    622E :                     ; ------------------------------------------------
(2)  344/    622E :                     ;  Find File (ISO9660)
(2)  345/    622E :                     ;  Input:  a0.l - Pointer to filename
(2)  346/    622E :                     ;  Output: d0.l - Start sector
(2)  347/    622E :                     ;	   d1.l - Number of sectors
(2)  348/    622E :                     ;          d2.l - Filesize
(2)  349/    622E :                     ; ------------------------------------------------
(2)  350/    622E :                     
(2)  351/    622E :                     SP_FindFile:
(2)  352/    622E : 48E7 0062           		movem.l	a1/a2/a6,-(a7)
(2)  353/    6232 : 43F8 6500           		lea	(ISO_Files),a1		; Get sector buffer
(2)  354/    6236 :                     .next_file:
(2)  355/    6236 : 2C48                		movea.l	a0,a6			; Store filename pointer
(2)  356/    6238 : 101E                		move.b	(a6)+,d0		; Read character from filename
(2)  357/    623A :                     .findFirstChar:
(2)  358/    623A : 2449                		movea.l	a1,a2			; Store Sector buffer pointer
(2)  359/    623C : B019                		cmp.b	(a1)+,d0		; Compare with first letter of filename and increment
(2)  360/    623E : 66FA                		bne.b	.findFirstChar		; If not matched, branch
(2)  361/    6240 :                     .checkChars:
(2)  362/    6240 : 101E                		move.b	(a6)+,d0		; Read next charactor of filename and increment
(2)  363/    6242 : 6706                		beq.s	.getInfo		; If all characters were matched, branch
(2)  364/    6244 : B019                		cmp.b	(a1)+,d0		; Else, check next character
(2)  365/    6246 : 66EE                		bne.b	.next_file		; If not matched, find next file
(2)  366/    6248 : 60F6                		bra.s	.checkChars		; else, check next character
(2)  367/    624A :                     .getInfo:
(2)  368/    624A : 95FC 0000 0021      		sub.l	#$21,a2			; Move to beginning of directory entry
(2)  369/    6250 : 102A 0006           		move.b	6(a2),d0		; Get first part of Sector address
(2)  370/    6254 : E188                		lsl.l	#8,d0			; bitshift
(2)  371/    6256 : 102A 0007           		move.b	7(a2),d0		; Get next part of sector address
(2)  372/    625A : E188                		lsl.l	#8,d0			; bitshift
(2)  373/    625C : 102A 0008           		move.b	8(a2),d0		; get next part of sector address
(2)  374/    6260 : E188                		lsl.l	#8,d0			; bitshift
(2)  375/    6262 : 102A 0009           		move.b	9(a2),d0		; get final part of sector address.
(2)  376/    6266 :                     						; d0 now contains start sector address
(2)  377/    6266 : 122A 000E           		move.b	$E(a2),d1		; Same as above, but for FileSize
(2)  378/    626A : E189                		lsl.l	#8,d1
(2)  379/    626C : 122A 000F           		move.b	$F(a2),d1
(2)  380/    6270 : E189                		lsl.l	#8,d1
(2)  381/    6272 : 122A 0010           		move.b	$10(a2),d1
(2)  382/    6276 : E189                		lsl.l	#8,d1
(2)  383/    6278 : 122A 0011           		move.b	$11(a2),d1
(2)  384/    627C : 2401                		move.l	d1,d2
(2)  385/    627E : E089                		lsr.l	#8,d1			; Bitshift filesize (to get sector count)
(2)  386/    6280 : E689                		lsr.l	#3,d1
(2)  387/    6282 : 4CDF 4600           		movem.l	(a7)+,a1/a2/a6		; Restore used registers
(2)  388/    6286 : 4E75                		rts
(2)  389/    6288 :                     
(2)  390/    6288 :                     ; --------------------------------------------------------
(2)  391/    6288 :                     ; PCM sound
(2)  392/    6288 :                     ; --------------------------------------------------------
(2)  393/    6288 :                     
(2)  394/    6288 :                     ; -------------------------------------------
(2)  395/    6288 :                     ; PCM_Wait
(2)  396/    6288 :                     ; -------------------------------------------
(2)  397/    6288 :                     
(2)  398/    6288 :                     PCM_Wait:
(2)  399/    6288 : 48E7 8000           		movem.l	d0,-(sp)
(2)  400/    628C : 303C 0006           		move.w	#6,d0
(2)  401/    6290 :                     .WaitLoop:
(2)  402/    6290 : 51C8 FFFE           		dbf	d0,.WaitLoop
(2)  403/    6294 : 4CDF 0001           		movem.l	(sp)+,d0
(2)  404/    6298 : 4E75                		rts  
(2)  405/    629A :                     
(2)  406/    629A :                     ; ====================================================================
(2)  407/    629A :                     ; ----------------------------------------------------------------
(2)  408/    629A :                     ; RAM
(2)  409/    629A :                     ; ----------------------------------------------------------------
(2)  410/    629A :                     
(2)  411/    629A :                     		align $100
(2)  412/    6300 :                     SP_RAM:
(2)  413/    6300 : (MACRO)             		struct SP_RAM
(2)  413/    6300 : =$6300              GLBL_LASTPC     set *
(2)  413/     B00 :                                     dephase
(2)  413/     B00 : =$B00               GLBL_LASTORG    set *
(2)  413/    6300 :                                     phase SP_RAM
(2)  414/    6300 :                     Sub_BiosArgs:	ds.l $40
(2)  415/    6400 :                     Sub_BiosOut:	ds.l $40
(2)  416/    6500 :                     ISO_Files:	ds.b $800*$10
(2)  417/    E500 :                     ISO_Output:	ds.b $800*$10
(2)  418/   16500 : (MACRO)             		endstruct
(2)  418/    6300 :                                     !org GLBL_LASTORG
(2)  418/    6300 :                                     phase GLBL_LASTPC
(2)  419/     B00 :                     		dephase
(2)  420/     B00 :                     
(1)   57/     B00 :                     SP_End:
(1)   58/     B00 :                     		align 2
(1)   59/     B00 :                     
(1)   60/     B00 :                     ; ========================================================
(1)   61/     B00 :                     ; -------------------------------------------------
(1)   62/     B00 :                     ; Super-jump...
(1)   63/     B00 :                     ; -------------------------------------------------
(1)   64/     B00 :                     
(1)   65/     B00 :                     		align $2000-$600
(1)   66/    1A00 :                     MCD_Main:
(1)   67/    1A00 :                     
      82/    1A00 :                     mcdin_top:
      83/    1A00 : 1039 00A1 2004      		move.b	(sysmcd_reg+mcd_memory+1).l,d0		; Set WORDRAM to SUB, DMNA=1
      84/    1A06 : 08C0 0001           		bset	#1,d0
      85/    1A0A : 13C0 00A1 2004      		move.b	d0,(sysmcd_reg+mcd_memory+1).l
      87/    1A10 :                     		include "system/mcd/marscd.asm"
(1)    1/    1A10 :                     ; ====================================================================
(1)    2/    1A10 :                     ; ----------------------------------------------------------------
(1)    3/    1A10 :                     ; 32X BOOT ON SEGA CD
(1)    4/    1A10 :                     ; ----------------------------------------------------------------
(1)    5/    1A10 :                     
(1)    6/    1A10 : 600C                		bra.s	.normal
(1)    7/    1A12 :                     .retry:
(1)    8/    1A12 : 4BF9 00A1 5100      		lea	($A15100),a5
(1)    9/    1A18 : 1B7C 0000 0001      		move.b	#0,1(a5)
(1)   10/    1A1E :                     .normal:
(1)   11/    1A1E : 4BF9 00A1 0000      		lea	($A10000),a5
(1)   12/    1A24 : 7001                		moveq	#1,d0
(1)   13/    1A26 :                     ID_loop:
(1)   14/    1A26 : 0CAD 4D41 5253 30EC 		cmp.l	#"MARS",$30EC(a5)	; check MARS ID
(1)   15/    1A2E : 66F6                		bne	ID_loop
(1)   16/    1A30 :                     ;		bne	MarsError
(1)   17/    1A30 :                     .sh_wait:
(1)   18/    1A30 : 082D 0007 5101      		btst.b	#7,$5101(a5)		; adapter control reg. REN=1 ?
(1)   19/    1A36 : 67F8                		beq.b	.sh_wait
(1)   20/    1A38 : 082D 0000 5101      		btst.b	#0,$5101(a5)		; check adapter mode
(1)   21/    1A3E : 6600 01DA           		bne	Hot_Start
(1)   22/    1A42 :                     .cold_start:					; power on (cold_start)
(1)   23/    1A42 : 1B7C 0001 5101      		move.b	#1,$5101(a5)		; MARS mode
(1)   24/    1A48 :                     						; SH2 reset - wait 10ms -
(1)   25/    1A48 : 6000 0106           		bra	RestartPrg
(1)   26/    1A4C :                     		align 4
(1)   27/    1A4C :                     
(1)   28/    1A4C :                     ; ----------------------------------------------------------------
(1)   29/    1A4C :                     ;	Copyright
(1)   30/    1A4C :                     ; ----------------------------------------------------------------
(1)   31/    1A4C :                     CopyrightData:
(1)   32/    1A4C : 3332 5820 496E 6974 	dc.b	"32X Initial Program            "
                    6961 6C20 5072 6F67 
                    7261 6D20 2020 2020 
                    2020 2020 2020 20   
(1)   33/    1A6B : 2020 2020 2020 2020 	dc.b	"             CD-ROM Version    "
                    2020 2020 2043 442D 
                    524F 4D20 5665 7273 
                    696F 6E20 2020 20   
(1)   34/    1A8A : 436F 7079 7269 6768 	dc.b	"Copyright SEGA ENTERPRISES,LTD."
                    7420 5345 4741 2045 
                    4E54 4552 5052 4953 
                    4553 2C4C 5444 2E   
(1)   35/    1AA9 : 2031 3939 3420 2020 	dc.b	" 1994                          "
                    2020 2020 2020 2020 
                    2020 2020 2020 2020 
                    2020 2020 2020 20   
(1)   36/    1AC8 : 2020 2020 2020 2020 	dc.b	"                  Version 1.0"
                    2020 2020 2020 2020 
                    2020 5665 7273 696F 
                    6E20 312E 30        
(1)   37/    1AE5 :                     
(1)   38/    1AE5 :                     ; ----------------------------------------------------------------
(1)   39/    1AE5 :                     ;	Frame Buffer Clear
(1)   40/    1AE5 :                     ; ----------------------------------------------------------------
(1)   41/    1AE5 :                     
(1)   42/    1AE5 :                     		align 4
(1)   43/    1AE8 :                     FrameClear:
(1)   44/    1AE8 : 48E7 C140           		movem.l	d0/d1/d7/a1,-(a7)
(1)   45/    1AEC :                     
(1)   46/    1AEC : 43F9 00A1 5180      		lea	$a15180,a1
(1)   47/    1AF2 :                     .fm1
(1)   48/    1AF2 : 08A9 0007 FF80      		bclr.b	#7,-$80(a1)		; MD access
(1)   49/    1AF8 : 66F8                		bne.b	.fm1
(1)   50/    1AFA :                     
(1)   51/    1AFA : 3E3C 00FF           		move.w	#($20000/$200-1),d7
(1)   52/    1AFE : 7000                		moveq	#0,d0
(1)   53/    1B00 : 7200                		moveq	#0,d1
(1)   54/    1B02 : 337C FFFF 0004      		move.w	#-1,$4(a1)		; Fill Length Reg.
(1)   55/    1B08 :                     .fill0:
(1)   56/    1B08 : 3341 0006           		move.w	d1,$6(a1)		; Fill Start Address Reg.
(1)   57/    1B0C : 3340 0008           		move.w	d0,$8(a1)		; Fill Data Reg.
(1)   58/    1B10 : 4E71                		nop
(1)   59/    1B12 :                     .fen0:
(1)   60/    1B12 : 0829 0001 000B      		btst.b	#1,$b(a1)		; FEN = 0 ?
(1)   61/    1B18 : 66F8                		bne.b	.fen0
(1)   62/    1B1A : D27C 0100           		add.w	#$100,d1		; Address = +200H
(1)   63/    1B1E : 51CF FFE8           		dbra	d7,.fill0
(1)   64/    1B22 :                     
(1)   65/    1B22 : 4CDF 0283           		movem.l	(a7)+,d0/d1/d7/a1
(1)   66/    1B26 : 4E75                		rts
(1)   67/    1B28 :                     
(1)   68/    1B28 :                     ; ----------------------------------------------------------------
(1)   69/    1B28 :                     ;	Palette RAM Clear
(1)   70/    1B28 :                     ; ----------------------------------------------------------------
(1)   71/    1B28 :                     
(1)   72/    1B28 :                     PaletteClear:
(1)   73/    1B28 : 48E7 8180           		movem.l	d0/d7/a0,-(a7)
(1)   74/    1B2C :                     
(1)   75/    1B2C : 41F9 00A1 5200      		lea	$a15200,a0
(1)   76/    1B32 :                     .fm2
(1)   77/    1B32 : 08A8 0007 FF00      		bclr.b	#7,-$100(a0)		; MD access
(1)   78/    1B38 : 66F8                		bne.b	.fm2
(1)   79/    1B3A :                     
(1)   80/    1B3A : 3E3C 001F           		move.w	#(256/2/4-1),d7
(1)   81/    1B3E :                     .pl:
(1)   82/    1B3E : 20C0                		move.l	d0,(a0)+
(1)   83/    1B40 : 20C0                		move.l	d0,(a0)+
(1)   84/    1B42 : 20C0                		move.l	d0,(a0)+
(1)   85/    1B44 : 20C0                		move.l	d0,(a0)+
(1)   86/    1B46 : 51CF FFF6           		dbra	d7,.pl
(1)   87/    1B4A :                     
(1)   88/    1B4A : 4CDF 0181           		movem.l	(a7)+,d0/d7/a0
(1)   89/    1B4E : 4E75                		rts
(1)   90/    1B50 :                     
(1)   91/    1B50 :                     ; ----------------------------------------------------------------
(1)   92/    1B50 :                     ; (Re)Start
(1)   93/    1B50 :                     ; ----------------------------------------------------------------
(1)   94/    1B50 :                     
(1)   95/    1B50 :                     RestartPrg:
(1)   96/    1B50 : 3E3C 4AE2           		move.w	#19170,d7		; 8
(1)   97/    1B54 :                     .res_wait:
(1)   98/    1B54 : 51CF FFFE           		dbra	d7,.res_wait		; 12*d7+10
(1)   99/    1B58 :                     
(1)  100/    1B58 :                     ; ----	Mars Register Initialize
(1)  101/    1B58 :                     
(1)  102/    1B58 : 43F9 00A1 5100      		lea	($A15100),a1
(1)  103/    1B5E :                     
(1)  104/    1B5E :                     ; ----	Communication Reg. Clear
(1)  105/    1B5E :                     
(1)  106/    1B5E : 7000                		moveq	#0,d0
(1)  107/    1B60 : 2340 0020           		move.l	d0,$20(a1)		; 0
(1)  108/    1B64 : 2340 0024           		move.l	d0,$24(a1)		; 4
(1)  109/    1B68 : 1B7C 0003 5101      		move.b	#3,$5101(a5)		; SH2 start
(1)  110/    1B6E :                     .fm3
(1)  111/    1B6E : 0891 0007           		bclr.b	#7,(a1)			; MD access
(1)  112/    1B72 : 66FA                		bne.b	.fm3
(1)  113/    1B74 : 7000                		moveq	#0,d0
(1)  114/    1B76 : 3340 0002           		move.w	d0,2(a1)		; Interrupt Reg.
(1)  115/    1B7A : 3340 0004           		move.w	d0,4(a1)		; Bank Reg.
(1)  116/    1B7E : 3340 0006           		move.w	d0,6(a1)		; DREQ Control Reg.
(1)  117/    1B82 : 2340 0008           		move.l	d0,8(a1)		; DREQ Source Address Reg.
(1)  118/    1B86 : 2340 000C           		move.l	d0,$c(a1)		; DREQ Destination Address Reg.
(1)  119/    1B8A : 3340 0010           		move.w	d0,$10(a1)		; DREQ Length Reg.
(1)  120/    1B8E : 3340 0030           		move.w	d0,$30(a1)		; PWM Control
(1)  121/    1B92 : 3340 0032           		move.w	d0,$32(a1)		; PWM fs Reg.
(1)  122/    1B96 : 3340 0038           		move.w	d0,$38(a1)		; PWM Mono Reg.
(1)  123/    1B9A : 3340 0080           		move.w	d0,$80(a1)		; Bitmap Mode Reg.
(1)  124/    1B9E : 3340 0082           		move.w	d0,$82(a1)		; Shift Reg.
(1)  125/    1BA2 :                     
(1)  126/    1BA2 :                     ; ----	Mars Frame Buffer Clear
(1)  127/    1BA2 :                     .fs0:
(1)  128/    1BA2 : 08A9 0000 008B      		bclr.b	#0,$8b(a1)		; FS = 0
(1)  129/    1BA8 : 66F8                		bne.b	.fs0
(1)  130/    1BAA : 6100 FF3C           		bsr	FrameClear
(1)  131/    1BAE :                     .fs1:
(1)  132/    1BAE : 08E9 0000 008B      		bset.b	#0,$8b(a1)		; FS = 1
(1)  133/    1BB4 : 67F8                		beq.b	.fs1
(1)  134/    1BB6 : 6100 FF30           		bsr	FrameClear
(1)  135/    1BBA : 08A9 0000 008B      		bclr.b	#0,$8b(a1)		; FS = 0
(1)  136/    1BC0 :                     
(1)  137/    1BC0 :                     ; ----	Palette RAM Clear
(1)  138/    1BC0 : 6100 FF66           		bsr	PaletteClear
(1)  139/    1BC4 :                     
(1)  140/    1BC4 :                     	; *** SLAM CITY CD32X code
(1)  141/    1BC4 : 303C 0002           		move.w	#2,d0
(1)  142/    1BC8 : 7200                		moveq	#0,d1
(1)  143/    1BCA : 122D 0001           		move.b	1(a5),d1
(1)  144/    1BCE : 1429 0080           		move.b	$80(a1),d2
(1)  145/    1BD2 : E14A                		lsl.w	#8,d2
(1)  146/    1BD4 : 8242                		or.w	d2,d1
(1)  147/    1BD6 : 0801 000F           		btst	#$F,d1
(1)  148/    1BDA : 660A                		bne.s	loc_1DA
(1)  149/    1BDC : 0801 0006           		btst	#6,d1
(1)  150/    1BE0 : 6700 0048           		beq.w	loc_21E
(1)  151/    1BE4 : 6008                		bra.s	loc_1E2
(1)  152/    1BE6 :                     loc_1DA:
(1)  153/    1BE6 : 0801 0006           		btst	#6,d1
(1)  154/    1BEA : 6600 003E           		bne.w	loc_21E
(1)  155/    1BEE :                     loc_1E2:
(1)  156/    1BEE :                     	; ***
(1)  157/    1BEE :                     
(1)  158/    1BEE :                     ; ----	SH2 Check
(1)  159/    1BEE : 303C 0080           		move	#$80,d0
(1)  160/    1BF2 : 2229 0020           		move.l	$20(a1),d1		; SDRAM Self Check
(1)  161/    1BF6 : B2BC 5344 4552      		cmp.l	#"SDER",d1
(1)  162/    1BFC : 6700 00BA           		beq	MarsError
(1)  163/    1C00 :                     
(1)  164/    1C00 :                     ; ----	Communication Reg. Clear
(1)  165/    1C00 : 7000                		moveq	#0,d0
(1)  166/    1C02 : 2340 0028           		move.l	d0,$28(a1)		; 8
(1)  167/    1C06 : 2340 002C           		move.l	d0,$2c(a1)		; 12
(1)  168/    1C0A :                     
(1)  169/    1C0A : 2C7C FFFF FFC0      		movea.l	#-64,a6
(1)  170/    1C10 : 4CD6 7FF9           		movem.l	(a6),d0/d3-d7/a0-a6
(1)  171/    1C14 : 44FC 0000           		move	#0,ccr			; Complete
(1)  172/    1C18 : 6014                		bra.b	IcdAllEnd
(1)  173/    1C1A :                     
(1)  174/    1C1A :                     Hot_Start:
(1)  175/    1C1A : 43F9 00A1 5100      		lea	($a15100),a1
(1)  176/    1C20 : 3340 0006           		move.w	d0,6(a1)		; DREQ Control Reg.
(1)  177/    1C24 :                     
(1)  178/    1C24 : 303C 8000           		move.w	#$8000,d0
(1)  179/    1C28 : 6004                		bra.b	IcdAllEnd
(1)  180/    1C2A :                     loc_21E:
(1)  181/    1C2A : 44FC 0001           		move	#1,ccr			; Error
(1)  182/    1C2E :                     IcdAllEnd:
(1)  183/    1C2E :                     ; 		bcs	_error
(1)  184/    1C2E :                     
(1)  185/    1C2E :                     ; ----------------------------------------------------------------
(1)  186/    1C2E :                     ;
(1)  187/    1C2E :                     ; ----------------------------------------------------------------
(1)  188/    1C2E :                     ; Sending the SH2 data through the
(1)  189/    1C2E :                     ; framebuffer...
(1)  190/    1C2E :                     
(1)  191/    1C2E : 4BF9 00A1 5100      		lea	($A15100).l,a5
(1)  192/    1C34 :                     loc_2EE:
(1)  193/    1C34 : 0895 0007           		bclr	#7,(a5)
(1)  194/    1C38 : 66FA                		bne.s	loc_2EE
(1)  195/    1C3A : 41F9 0084 0000      		lea	($840000).l,a0
(1)  196/    1C40 : 45FA 0078           		lea	MarsInitHeader(pc),a2	; "MARS	DP GAME	   "
(1)  197/    1C44 : 3E3C 000D           		move.w	#$D,d7
(1)  198/    1C48 :                     loc_302:
(1)  199/    1C48 : 20DA                		move.l	(a2)+,(a0)+
(1)  200/    1C4A : 51CF FFFC           		dbf	d7,loc_302
(1)  201/    1C4E : 4280                		clr.l	d0
(1)  202/    1C50 : 247C 0020 0800      		movea.l	#$200800,a2
(1)  203/    1C56 : 3E3C 53FF           		move.w	#((CD32_End-CD32_Start)/4)-1,d7
(1)  204/    1C5A :                     
(1)  205/    1C5A : 2212                		move.l	(a2),d1
(1)  206/    1C5C : 23C1 00FF FFF0      		move.l	d1,$FFFFF0
(1)  207/    1C62 :                     ; 		cmp.l	#$06000710,d1
(1)  208/    1C62 :                     ; 		beq.s	*
(1)  209/    1C62 :                     loc_314:
(1)  210/    1C62 : 221A                		move.l	(a2)+,d1
(1)  211/    1C64 :                     ; 		eor.l	d1,d0
(1)  212/    1C64 : 20C1                		move.l	d1,(a0)+
(1)  213/    1C66 : 51CF FFFA           		dbf	d7,loc_314
(1)  214/    1C6A : 23F9 0020 0860 0084 		move.l	($200860).l,($840020).l
                    0020                
(1)  215/    1C74 : 23F9 0020 0864 0084 		move.l	($200864).l,($840024).l
                    0024                
(1)  216/    1C7E :                     loc_332:
(1)  217/    1C7E : 08D5 0007           		bset	#7,(a5)
(1)  218/    1C82 : 67FA                		beq.s	loc_332
(1)  219/    1C84 :                     
(1)  220/    1C84 :                     ; 		lea	($840000),a0		; First the header
(1)  221/    1C84 :                     ; 		lea	MarsInitHeader(pc),a2
(1)  222/    1C84 :                     ; 		move.w	#$E-1,d7
(1)  223/    1C84 :                     ; .shprg:
(1)  224/    1C84 :                     ; 		move.l	(a2)+,(a0)+
(1)  225/    1C84 :                     ; 		dbf	d7,.shprg
(1)  226/    1C84 :                     ;         	lea	(sysmcd_wram),a2	; Now the code
(1)  227/    1C84 :                     ; 		move.w	#(((CD32_End-CD32_Start)/4)/4)-1,d7
(1)  228/    1C84 :                     ; .shprg2:
(1)  229/    1C84 :                     ; 		move.l	(a2)+,(a0)+
(1)  230/    1C84 :                     ; 		move.l	(a2)+,(a0)+
(1)  231/    1C84 :                     ; 		move.l	(a2)+,(a0)+
(1)  232/    1C84 :                     ; 		move.l	(a2)+,(a0)+
(1)  233/    1C84 :                     ; 		dbra	d7,.shprg2
(1)  234/    1C84 :                     ; loc_332:
(1)  235/    1C84 :                     ; 		bset	#7,(a5)
(1)  236/    1C84 :                     ; 		beq.s	loc_332
(1)  237/    1C84 :                     
(1)  238/    1C84 : 4BF9 00A1 5100      		lea	($A15100).l,a5
(1)  239/    1C8A : 2B7C 5F43 445F 0020 		move.l	#"_CD_",$20(a5)		; SH2 Application Start
(1)  240/    1C92 :                     	; Then proceed like normal...
(1)  241/    1C92 :                     .master:
(1)  242/    1C92 : 0CAD 4D5F 4F4B 0020 		cmp.l	#"M_OK",$20(a5)
(1)  243/    1C9A : 66F6                		bne.b	.master
(1)  244/    1C9C :                     .slave:
(1)  245/    1C9C : 0CAD 535F 4F4B 0024 		cmp.l	#"S_OK",$24(a5)
(1)  246/    1CA4 : 66F6                		bne.b	.slave
(1)  247/    1CA6 : 4DF9 00C0 0004      		lea	(vdp_ctrl).l,a6
(1)  248/    1CAC : 2CBC 8004 8104      		move.l	#$80048104,(a6)		; Default top VDP regs
(1)  249/    1CB2 : 7000                		moveq	#0,d0			; Clear both Master and Slave comm's
(1)  250/    1CB4 : 2B40 002C           		move.l	d0,comm12(a5)
(1)  251/    1CB8 :                     MarsError:
(1)  252/    1CB8 : 6038                		bra	MarsJumpHere
(1)  253/    1CBA :                     
(1)  254/    1CBA :                     ; --------------------------------------------------------------------------------
(1)  255/    1CBA :                     ;	MARS User Header
(1)  256/    1CBA :                     ; --------------------------------------------------------------------------------
(1)  257/    1CBA :                     
(1)  258/    1CBA :                     MarsInitHeader:
(1)  259/    1CBA : 4D41 5253 2043 4452 		dc.b "MARS CDROM      "		; module name
                    4F4D 2020 2020 2020 
(1)  260/    1CCA : 0000 0000           		dc.l $00000000			; version
(1)  261/    1CCE : 0000 0000           		dc.l $00000000			; Not Used
(1)  262/    1CD2 : 0600 0000           		dc.l $06000000			; SH2 (SDRAM)
(1)  263/    1CD6 : 0001 5000           		dc.l CD32_End-CD32_Start	; SH2
(1)  264/    1CDA : 0600 0710           		dc.l SH2_M_Entry		; Master SH2 PC (SH2 area)
(1)  265/    1CDE : 0600 0888           		dc.l SH2_S_Entry		; Slave SH2 PC (SH2 area)
(1)  266/    1CE2 : 0600 0000           		dc.l SH2_Master			; Master SH2 default VBR
(1)  267/    1CE6 : 0600 0128           		dc.l SH2_Slave			; Slave SH2 default VBR
(1)  268/    1CEA : 0000 0000           		dc.l $00000000			; Not Used
(1)  269/    1CEE : 0000 0000           		dc.l $00000000			; Not Used
(1)  270/    1CF2 :                     		align 2
(1)  271/    1CF2 :                     MarsJumpHere:
(1)  272/    1CF2 :                     
      89/    1CF2 : 41FA 1F66           		lea	Md_SysCode(pc),a0			; Transfer SYSTEM code
      90/    1CF6 : 43F9 FFFF 0000      		lea	(RAM_SystemCode),a1
      91/    1CFC : 303C 1B67           		move.w	#((Md_SysCode_e-Md_SysCode))-1,d0
      92/    1D00 :                     .copyme:
      93/    1D00 : 12D8                		move.b	(a0)+,(a1)+
      94/    1D02 : 51C8 FFFC           		dbf	d0,.copyme
      95/    1D06 : 41FA 3ABA           		lea	Md_JumpCode(pc),a0			; Transfer JUMP code
      96/    1D0A : 43F8 FE00           		lea	(RAM_ScreenJump),a1
      97/    1D0E : 303C 0057           		move.w	#((Md_JumpCode_e-Md_JumpCode))-1,d0
      98/    1D12 :                     .copyme_2:
      99/    1D12 : 12D8                		move.b	(a0)+,(a1)+
     100/    1D14 : 51C8 FFFC           		dbf	d0,.copyme_2
     101/    1D18 :                     
     102/    1D18 : 41F9 00A1 2010      		lea	(sysmcd_reg+mcd_dcomm_m),a0
     103/    1D1E : 20FC 574F 5244      		move.l	#"WORD",(a0)+
     104/    1D24 : 20FC 4441 5441      		move.l	#"DATA",(a0)+
     105/    1D2A : 20FC 2E42 494E      		move.l	#".BIN",(a0)+
     106/    1D30 : 30FC 0000           		move.w	#0,(a0)+
     107/    1D34 : 7002                		moveq	#$02,d0
     108/    1D36 : 4EB9 FFFF 1668      		jsr	(System_McdSubTask).l
     109/    1D3C : 4EB9 FFFF 0000      		jsr	(Sound_init).l
     110/    1D42 : 4EB9 FFFF 01FE      		jsr	(Video_init).l
     111/    1D48 : 4EB9 FFFF 1534      		jsr	(System_Init).l
     112/    1D4E : 31FC 0000 C800      		move.w	#0,(RAM_Glbl_Scrn).w			; *** TEMPORAL ***
     113/    1D54 : 4EF9 FFFF FE00      		jmp	(Md_ReadModes).l
     114/    1D5A :                     mcdin_end:
     115/FFFFFFFFFFFF235A :                     		phase $FFFF2000+(mcdin_end-mcdin_top)
     116/FFFFFFFFFFFF235A :                     Z80_CODE:	include "sound/gema_zdrv.asm"			; Called once
(1)    1/FFFFFFFFFFFF235A :                     ; ====================================================================
(1)    2/FFFFFFFFFFFF235A :                     ; --------------------------------------------------------
(1)    3/FFFFFFFFFFFF235A :                     ; GEMA/Nikona Z80 code v0.5
(1)    4/FFFFFFFFFFFF235A :                     ; (C)2023 GenesisFan64
(1)    5/FFFFFFFFFFFF235A :                     ;
(1)    6/FFFFFFFFFFFF235A :                     ; TIP:
(1)    7/FFFFFFFFFFFF235A :                     ; For the 32X place this code on the 880000 area
(1)    8/FFFFFFFFFFFF235A :                     ; as this is only loaded once.
(1)    9/FFFFFFFFFFFF235A :                     ; --------------------------------------------------------
(1)   10/FFFFFFFFFFFF235A :                     
(1)   11/FFFFFFFFFFFF235A :                     Z80_TOP:
(1)   12/FFFFFFFFFFFF235A :                     		cpu Z80		; [AS] Enter Z80
(1)   13/       0 :                     		phase 0		; [AS]
(1)   14/       0 : (MACRO)             		org 0
(1)   15/       0 :                     
(1)   16/       0 :                     ; --------------------------------------------------------
(1)   17/       0 :                     ; SETTINGS
(1)   18/       0 :                     ; --------------------------------------------------------
(1)   19/       0 :                     
(1)   20/       0 :                     ; !! = leave as-is unless you know what you are doing.
(1)   21/       0 : =11H                MAX_TRKCHN	equ 17		; !! Max Internal tracker channels: 4PSG + 6FM + 7PWM (**AFFECTS 32X SIDE)
(1)   22/       0 : =8H                 MAX_TRFRPZ	equ 8		; !! Max transferRom packets(bytes) (**AFFECTS WAVE QUALITY)
(1)   23/       0 : =40H                MAX_RCACH	equ 40h		; Max storage for ROM pattern data *1-BIT SIZES ONLY, MUST BE ALIGNED*
(1)   24/       0 : =10H                MAX_TBLSIZE	equ 10h		; Max size for chip tables
(1)   25/       0 : =FH                 MAX_INS		equ 15		; Max Cache'd ROM instruments per track
(1)   26/       0 : =18H                MAX_BLOCKS	equ 24		; Max Cache'd ROM blocks per track
(1)   27/       0 : =FH                 MAX_HEADS	equ 15		; Max Cache'd ROM headers per track
(1)   28/       0 : =0H                 ZSET_TESTME	equ 0		; Set to 1 to "hear"-test the DAC playback
(1)   29/       0 :                     
(1)   30/       0 :                     ; --------------------------------------------------------
(1)   31/       0 :                     ; Structs
(1)   32/       0 :                     ; --------------------------------------------------------
(1)   33/       0 :                     
(1)   34/       0 :                     ; trkBuff struct: 00h-30h
(1)   35/       0 :                     ; unused bytes are free.
(1)   36/       0 :                     ;
(1)   37/       0 :                     ; trk_Status: %ERPx xxx0
(1)   38/       0 :                     ; E - enabled
(1)   39/       0 :                     ; R - Init|Restart track
(1)   40/       0 :                     ; P - refill-on-playback
(1)   41/       0 :                     ; 0 - Use global sub-beat
(1)   42/       0 : =0H                 trk_status	equ 00h	; ** Track Status and flags (MUST BE at 00h)
(1)   43/       0 : =1H                 trk_seqId	equ 01h ; ** Track ID to play.
(1)   44/       0 : =2H                 trk_setBlk	equ 02h	; ** Start on this block
(1)   45/       0 : =3H                 trk_tickSet	equ 03h	; ** Ticks for this track
(1)   46/       0 : =4H                 trk_Blocks	equ 04h ; [W] Current track's blocks
(1)   47/       0 : =6H                 trk_Patt	equ 06h ; [W] Current track's heads and patterns
(1)   48/       0 : =8H                 trk_Instr	equ 08h ; [W] Current track's instruments
(1)   49/       0 : =AH                 trk_Read	equ 0Ah	; [W] Track current pattern-read pos
(1)   50/       0 : =CH                 trk_Rows	equ 0Ch	; [W] Track current row length
(1)   51/       0 : =EH                 trk_cachHalf	equ 0Eh ; ROM-cache halfcheck
(1)   52/       0 : =FH                 trk_cachInc	equ 0Fh ; ROM-cache increment
(1)   53/       0 : =10H                trk_rowPause	equ 10h	; Row-pause timer
(1)   54/       0 : =11H                trk_tickTmr	equ 11h	; Ticks timer
(1)   55/       0 : =12H                trk_currBlk	equ 12h	; Current block
(1)   56/       0 : =13H                trk_Panning	equ 13h ; Global panning for this track %LR000000
(1)   57/       0 : =14H                trk_Priority	equ 14h ; Priority level for this buffer
(1)   58/       0 : =15H                trk_BankIns	equ 15h
(1)   59/       0 : =16H                trk_BankBlk	equ 16h
(1)   60/       0 : =17H                trk_BankHead	equ 17h
(1)   61/       0 : =1CH                trk_MaxChnls	equ 1Ch	; MAX avaialble channels
(1)   62/       0 : =1DH                trk_MaxBlks	equ 1Dh ;     ----      blocks
(1)   63/       0 : =1EH                trk_MaxHdrs	equ 1Eh ;     ----      headers
(1)   64/       0 : =1FH                trk_MaxIns	equ 1Fh ;     ----      intruments
(1)   65/       0 : =20H                trk_RomCPatt	equ 20h ; [3b] ROM current pattern data to be cache'd
(1)   66/       0 : =23H                trk_RomPatt	equ 23h ; [3b] ROM TOP pattern data
(1)   67/       0 : =26H                trk_ChnList	equ 26h ; ** [W] Pointer to channel list for this buffer
(1)   68/       0 : =28H                trk_ChnCBlk	equ 28h ; ** [W] Pointer to block storage
(1)   69/       0 : =2AH                trk_ChnCHead	equ 2Ah ; ** [W] Pointer to header storage
(1)   70/       0 : =2CH                trk_ChnCIns	equ 2Ch	; ** [W] Pointer to intrument storage (ALWAYS used)
(1)   71/       0 : =2EH                trk_ChnCach	equ 2Eh	; ** [W] Pointer to pattern storage
(1)   72/       0 :                     
(1)   73/       0 :                     ; chnBuff struct, 8 bytes ONLY
(1)   74/       0 :                     ;
(1)   75/       0 :                     ; chnl_Flags: LR00evin
(1)   76/       0 :                     ; LR - Left/Right panning bits (REVERSE: 0-ON 1-OFF)
(1)   77/       0 :                     ; e  - Effect*
(1)   78/       0 :                     ; v  - Volume*
(1)   79/       0 :                     ; i  - Intrument*
(1)   80/       0 :                     ; n  - Note*
(1)   81/       0 :                     ; * Gets cleared later.
(1)   82/       0 :                     
(1)   83/       0 : =0H                 chnl_Flags	equ 0	; Playback flags
(1)   84/       0 : =1H                 chnl_Chip	equ 1	; Current Chip ID + priority for this channel
(1)   85/       0 : =2H                 chnl_Note	equ 2
(1)   86/       0 : =3H                 chnl_Ins	equ 3	; Starting from 01h
(1)   87/       0 : =4H                 chnl_Vol	equ 4	; MAX to MIN: 40h-00h
(1)   88/       0 : =5H                 chnl_EffId	equ 5
(1)   89/       0 : =6H                 chnl_EffArg	equ 6
(1)   90/       0 : =7H                 chnl_Type	equ 7	; Impulse-note update bits
(1)   91/       0 :                     
(1)   92/       0 :                     ; --------------------------------------------------------
(1)   93/       0 :                     ; Variables
(1)   94/       0 :                     ; --------------------------------------------------------
(1)   95/       0 :                     
(1)   96/       0 :                     ; Z80 opcode labels for the wave playback routines:
(1)   97/       0 : =0H                 zopcNop		equ	00h
(1)   98/       0 : =8H                 zopcEx		equ	08h
(1)   99/       0 : =C9H                zopcRet		equ 	0C9h
(1)  100/       0 : =D9H                zopcExx		equ	0D9h		; (dac_me ONLY)
(1)  101/       0 : =F5H                zopcPushAf	equ	0F5h		; (dac_fill ONLY)
(1)  102/       0 :                     
(1)  103/       0 :                     ; PSG external control
(1)  104/       0 :                     ; GEMS style.
(1)  105/       0 : =0H                 COM		equ	0
(1)  106/       0 : =4H                 LEV		equ	4
(1)  107/       0 : =8H                 ATK		equ	8
(1)  108/       0 : =CH                 DKY		equ	12
(1)  109/       0 : =10H                SLV		equ	16
(1)  110/       0 : =14H                RRT		equ	20
(1)  111/       0 : =18H                MODE		equ	24
(1)  112/       0 : =1CH                DTL		equ	28
(1)  113/       0 : =20H                DTH		equ	32
(1)  114/       0 : =24H                ALV		equ	36
(1)  115/       0 : =28H                FLG		equ	40
(1)  116/       0 : =2CH                TMR		equ	44
(1)  117/       0 : =30H                PVOL		equ	48
(1)  118/       0 : =34H                PARP		equ	52
(1)  119/       0 : =38H                PTMR		equ	56
(1)  120/       0 :                     
(1)  121/       0 :                     ; PWM control
(1)  122/       0 : =0H                 PWCOM		equ	0
(1)  123/       0 : =8H                 PWPTH_V		equ	8	; Volume | Pitch MSB (VVVVVVPPb)
(1)  124/       0 : =10H                PWPHL		equ	16	; Pitch LSB
(1)  125/       0 : =18H                PWOUTF		equ	24	; Output mode/bits | 32-bit address (%SlLRxiix) ii=$02 or $06
(1)  126/       0 : =20H                PWINSH		equ	32	; **
(1)  127/       0 : =28H                PWINSM		equ	40	; **
(1)  128/       0 : =30H                PWINSL		equ	48	; **
(1)  129/       0 :                     
(1)  130/       0 :                     ; ====================================================================
(1)  131/       0 :                     ; --------------------------------------------------------
(1)  132/       0 :                     ; Code starts here
(1)  133/       0 :                     ; --------------------------------------------------------
(1)  134/       0 :                     
(1)  135/       0 : F3                  		di			; Disable interrputs
(1)  136/       1 : ED 56               		im	1		; Interrupt mode 1
(1)  137/       3 : 31 00 20            		ld	sp,2000h	; Set stack at the end of Z80
(1)  138/       6 : 18 7B               		jr	z80_init	; Jump to z80_init
(1)  139/       8 :                     
(1)  140/       8 :                     ; --------------------------------------------------------
(1)  141/       8 :                     ; RST 8 (dac_me)
(1)  142/       8 :                     ; *** self-modifiable code ***
(1)  143/       8 :                     ;
(1)  144/       8 :                     ; Writes wave data to DAC using data stored
(1)  145/       8 :                     ; on the wave buffer, call this routine every 6 or 8
(1)  146/       8 :                     ; opcodes to keep the samplerate stable.
(1)  147/       8 :                     ;
(1)  148/       8 :                     ; Input (EXX):
(1)  149/       8 :                     ;  c - WAVE buffer MSB
(1)  150/       8 :                     ; de - Pitch (xx.00)
(1)  151/       8 :                     ; h  - WAVE buffer LSB (as xx.00)
(1)  152/       8 :                     ;
(1)  153/       8 :                     ; Uses (EXX):
(1)  154/       8 :                     ; b
(1)  155/       8 :                     ;
(1)  156/       8 :                     ; Notes:
(1)  157/       8 :                     ; ONLY USE dac_on and dac_off to control
(1)  158/       8 :                     ; wave playback.
(1)  159/       8 :                     ;
(1)  160/       8 :                     ; call dac_on to enable wave playback, locks FM6
(1)  161/       8 :                     ; and
(1)  162/       8 :                     ; call dac_off to disable and enable FM6.
(1)  163/       8 :                     ; --------------------------------------------------------
(1)  164/       8 :                     
(1)  165/       8 :                     ; Samplerate is at 16000hz with minimal quality loss.
(1)  166/       8 : (MACRO)             		org 8
(1)  167/       8 : D9                  dac_me:		exx			; <-- this changes between EXX(play) and RET(stop)
(1)  168/       9 : 08                  		ex	af,af'		; Swap af
(1)  169/       A : 45                  		ld	b,l		; Save pitch .00 to b
(1)  170/       B : 6C                  		ld	l,h		; l - xx.00 to 00xx
(1)  171/       C : 61                  		ld	h,c		; h - Wave buffer MSB + 00xx
(1)  172/       D : 3E 2A               		ld	a,2Ah		; YM register 2Ah
(1)  173/       F : 32 00 40            		ld	(Zym_ctrl_1),a	; Set DAC write
(1)  174/      12 : 7E                  		ld	a,(hl)		; Now read byte from the wave buffer
(1)  175/      13 : 32 01 40            		ld	(Zym_data_1),a	; and write it to DAC
(1)  176/      16 : 65                  		ld	h,l		; get hl back
(1)  177/      17 : 68                  		ld	l,b		; Get .00 back from b to l
(1)  178/      18 : 19                  		add	hl,de		; Pitch increment hl
(1)  179/      19 : 08                  		ex	af,af'		; return af
(1)  180/      1A : D9                  		exx
(1)  181/      1B : C9                  		ret
(1)  182/      1C :                     
(1)  183/      1C :                     ; --------------------------------------------------------
(1)  184/      1C :                     ; 1Ch
(1)  185/      1C : 00 00               sbeatAcc	dw 0		; Accumulates on each tick to trigger the sub beats
(1)  186/      1E : E8 00               sbeatPtck	dw 200+32	; Default global subbeats (-32 for PAL)
(1)  187/      20 :                     
(1)  188/      20 :                     ; --------------------------------------------------------
(1)  189/      20 :                     ; RST 20h (dac_me)
(1)  190/      20 :                     ; *** self-modifiable code ***
(1)  191/      20 :                     ;
(1)  192/      20 :                     ; Checks if the WAVE cache needs refilling to keep
(1)  193/      20 :                     ; it playing.
(1)  194/      20 :                     ;
(1)  195/      20 :                     ; *** THIS BREAKS ALL REGISTERS IF REFILL
(1)  196/      20 :                     ; IS REQUESTED ***
(1)  197/      20 :                     ; --------------------------------------------------------
(1)  198/      20 :                     
(1)  199/      20 : (MACRO)             		org 20h
(1)  200/      20 : F5                  dac_fill:	push	af		; <-- changes between PUSH AF(playing) and RET(stopped)
(1)  201/      21 : 3A 2F 00            		ld	a,(dDacFifoMid)	; a - Get mid-way value
(1)  202/      24 : D9                  		exx
(1)  203/      25 : AC                  		xor	h		; Grab LSB.00
(1)  204/      26 : D9                  		exx
(1)  205/      27 : E6 80               		and	80h		; Check if bit changed
(1)  206/      29 : C4 29 11            		call	nz,dac_refill	; If yes: Refill and update LSB to check
(1)  207/      2C : F1                  		pop	af
(1)  208/      2D : C9                  		ret
(1)  209/      2E :                     
(1)  210/      2E :                     ; --------------------------------------------------------
(1)  211/      2E :                     ; 02Eh
(1)  212/      2E : 00                  currTickBits	db 0			; 2Eh: Current Tick/Subbeat flags (000000BTb B-beat, T-tick)
(1)  213/      2F : 00                  dDacFifoMid	db 0			; 2Fh: WAVE play halfway refill flag (00h/80h)
(1)  214/      30 : 00 00 00            dDacPntr	db 0,0,0		; 30h: WAVE play current ROM position
(1)  215/      33 : 00 00 00            dDacCntr	db 0,0,0		; 33h: WAVE play length counter
(1)  216/      36 : 00                  x68ksrclsb	db 0			; 36h: transferRom temporal LSB
(1)  217/      37 : 00                  x68ksrcmid	db 0			; 37h: transferRom temporal MID
(1)  218/      38 :                     
(1)  219/      38 :                     ; --------------------------------------------------------
(1)  220/      38 :                     ; Z80 Interrupt at 0038h
(1)  221/      38 :                     ; --------------------------------------------------------
(1)  222/      38 :                     
(1)  223/      38 : (MACRO)             		org 38h			; Align 38h
(1)  224/      38 : ED 73 03 17         		ld	(tickSpSet),sp	; Write TICK flag using sp (xx1F, use tickFlag+1)
(1)  225/      3C : F3                  		di			; Disable interrupt
(1)  226/      3D : C9                  		ret
(1)  227/      3E :                     
(1)  228/      3E :                     ; --------------------------------------------------------
(1)  229/      3E :                     ; 03Eh
(1)  230/      3E : 00                  trkListPage	db 0			; 3Eh: Current tracklist page/bank
(1)  231/      3F : 00                  marsUpd		db 0			; 3Fh: Flag to request a PWM transfer
(1)  232/      40 :                     
(1)  233/      40 :                     ; --------------------------------------------------------
(1)  234/      40 :                     ; 68K Read/Write area at 40h
(1)  235/      40 :                     ; --------------------------------------------------------
(1)  236/      40 :                     
(1)  237/      40 : (MACRO)             		org 40h
(1)  238/      40 :                     commZfifo	ds 40h			; Buffer for commands: 40h bytes
(1)  239/      80 : 00                  commZWrite	db 0			; 80h: cmd fifo wptr (from 68k)
(1)  240/      81 : 00                  commZRomBlk	db 0			; 81h: 68k ROM block flag
(1)  241/      82 : 00                  marsBlock	db 0			; 82h: flag to BLOCK PWM transfers.
(1)  242/      83 :                     
(1)  243/      83 :                     ; --------------------------------------------------------
(1)  244/      83 :                     ; Initilize
(1)  245/      83 :                     ; --------------------------------------------------------
(1)  246/      83 :                     
(1)  247/      83 :                     z80_init:
(1)  248/      83 : CD DC 0D            		call	gema_init		; Init values
(1)  249/      86 : FB                  		ei
(1)  250/      87 :                     
(1)  251/      87 :                     ; --------------------------------------------------------
(1)  252/      87 :                     ; MAIN LOOP
(1)  253/      87 :                     ; --------------------------------------------------------
(1)  254/      87 :                     
(1)  255/      87 :                     drv_loop:
(1)  256/      87 : CF                  		rst	8
(1)  257/      88 : CD 87 0E            		call	get_tick		; Check for Tick on VBlank
(1)  258/      8B : E7                  		rst	20h			; Refill wave
(1)  259/      8C : CF                  		rst	8
(1)  260/      8D : 06 00               		ld	b,0			; b - Reset current flags (beat|tick)
(1)  261/      8F : 3A 05 17            		ld	a,(tickCnt)
(1)  262/      92 : D6 01               		sub	1
(1)  263/      94 : 38 0B               		jr	c,.noticks
(1)  264/      96 : 32 05 17            		ld	(tickCnt),a
(1)  265/      99 : CD 49 0F            		call	chip_env		; Process PSG and YM
(1)  266/      9C : CD 87 0E            		call	get_tick		; Check for another tick
(1)  267/      9F : 06 01               		ld 	b,01b			; Set TICK (01b) flag, and clear BEAT
(1)  268/      A1 :                     .noticks:
(1)  269/      A1 : 3A 1D 00            		ld	a,(sbeatAcc+1)		; check beat counter (scaled by tempo)
(1)  270/      A4 : D6 01               		sub	1
(1)  271/      A6 : 38 06               		jr	c,.nobeats
(1)  272/      A8 : CF                  		rst	8
(1)  273/      A9 : 32 1D 00            		ld	(sbeatAcc+1),a		; 1/24 beat passed.
(1)  274/      AC : CB C8               		set	1,b			; Set BEAT (10b) flag
(1)  275/      AE :                     .nobeats:
(1)  276/      AE : CF                  		rst	8
(1)  277/      AF : 78                  		ld	a,b			; Any beat/tick change?
(1)  278/      B0 : B7                  		or	a
(1)  279/      B1 : 28 14               		jr	z,.neither
(1)  280/      B3 : 32 2E 00            		ld	(currTickBits),a	; Save BEAT/TICK bits
(1)  281/      B6 : CF                  		rst	8
(1)  282/      B7 : CD 87 0E            		call	get_tick
(1)  283/      BA : CD FE 04            		call	set_chips		; Send changes to sound chips
(1)  284/      BD : CD 87 0E            		call	get_tick
(1)  285/      C0 : CF                  		rst	8
(1)  286/      C1 : CD CF 01            		call	upd_track		; Update track data
(1)  287/      C4 : CD 87 0E            		call	get_tick
(1)  288/      C7 :                     .neither:
(1)  289/      C7 : CD D9 0D            		call	ex_comm			; External communication
(1)  290/      CA : CD 87 0E            		call	get_tick
(1)  291/      CD :                     .next_cmd:
(1)  292/      CD : 3A 80 00            		ld	a,(commZWrite)		; Check command READ and WRITE indexes
(1)  293/      D0 : 47                  		ld	b,a
(1)  294/      D1 : 3A 1C 17            		ld	a,(commZRead)
(1)  295/      D4 : B8                  		cp	b
(1)  296/      D5 : 28 B0               		jr	z,drv_loop		; If both are equal: no requests
(1)  297/      D7 : CF                  		rst	8
(1)  298/      D8 : CD F0 00            		call	.grab_arg
(1)  299/      DB : FE FF               		cp	-1			; Got -1? (Start of command)
(1)  300/      DD : 20 A8               		jr	nz,drv_loop
(1)  301/      DF : CD F0 00            		call	.grab_arg		; Read command number
(1)  302/      E2 : 87                  		add	a,a			; * 2
(1)  303/      E3 : 21 0F 01            		ld	hl,.list		; Then jump to one of these...
(1)  304/      E6 : 16 00               		ld	d,0
(1)  305/      E8 : 5F                  		ld	e,a
(1)  306/      E9 : 19                  		add	hl,de
(1)  307/      EA : 7E                  		ld	a,(hl)
(1)  308/      EB : 23                  		inc	hl
(1)  309/      EC : 66                  		ld	h,(hl)
(1)  310/      ED : CF                  		rst	8
(1)  311/      EE : 6F                  		ld	l,a
(1)  312/      EF : E9                  		jp	(hl)
(1)  313/      F0 :                     
(1)  314/      F0 :                     ; --------------------------------------------------------
(1)  315/      F0 :                     ; Read cmd byte, auto re-rolls to 3Fh
(1)  316/      F0 :                     ; --------------------------------------------------------
(1)  317/      F0 :                     
(1)  318/      F0 :                     .grab_arg:
(1)  319/      F0 : D5                  		push	de
(1)  320/      F1 : E5                  		push	hl
(1)  321/      F2 :                     .getcbytel:
(1)  322/      F2 : 3A 80 00            		ld	a,(commZWrite)
(1)  323/      F5 : 57                  		ld	d,a
(1)  324/      F6 : CF                  		rst	8
(1)  325/      F7 : 3A 1C 17            		ld	a,(commZRead)
(1)  326/      FA : BA                  		cp	d
(1)  327/      FB : 28 F5               		jr	z,.getcbytel	; wait until these counters change.
(1)  328/      FD : 16 00               		ld	d,0
(1)  329/      FF : 5F                  		ld	e,a
(1)  330/     100 : 21 40 00            		ld	hl,commZfifo
(1)  331/     103 : 19                  		add	hl,de
(1)  332/     104 : CF                  		rst	8
(1)  333/     105 : 3C                  		inc	a
(1)  334/     106 : E6 3F               		and	3Fh		; ** command list limit
(1)  335/     108 : 32 1C 17            		ld	(commZRead),a
(1)  336/     10B : 7E                  		ld	a,(hl)		; a - the byte we got
(1)  337/     10C : E1                  		pop	hl
(1)  338/     10D : D1                  		pop	de
(1)  339/     10E : C9                  		ret
(1)  340/     10F :                     
(1)  341/     10F :                     ; --------------------------------------------------------
(1)  342/     10F :                     
(1)  343/     10F :                     .list:
(1)  344/     10F : 2F 01               		dw .cmnd_0		; 00h -
(1)  345/     111 : 32 01               		dw .cmnd_1		; 01h - Play by track number
(1)  346/     113 : 4F 01               		dw .cmnd_2		; 02h - Stop by track number
(1)  347/     115 : 2F 01               		dw .cmnd_0		; 03h - Resume by track number
(1)  348/     117 : 2F 01               		dw .cmnd_0		; 04h -
(1)  349/     119 : 2F 01               		dw .cmnd_0		; 05h -
(1)  350/     11B : 2F 01               		dw .cmnd_0		; 06h -
(1)  351/     11D : 2F 01               		dw .cmnd_0		; 07h -
(1)  352/     11F : 6C 01               		dw .cmnd_8		; 08h - Stop ALL
(1)  353/     121 : 2F 01               		dw .cmnd_0		; 09h -
(1)  354/     123 : 2F 01               		dw .cmnd_0		; 0Ah -
(1)  355/     125 : 2F 01               		dw .cmnd_0		; 0Bh -
(1)  356/     127 : 8E 01               		dw .cmnd_C		; 0Ch - Set GLOBAL sub-beats
(1)  357/     129 : 2F 01               		dw .cmnd_0		; 0Dh -
(1)  358/     12B : 2F 01               		dw .cmnd_0		; 0Eh -
(1)  359/     12D : 2F 01               		dw .cmnd_0		; 0Fh -
(1)  360/     12F :                     
(1)  361/     12F :                     ; --------------------------------------------------------
(1)  362/     12F :                     ; Command 00h
(1)  363/     12F :                     ;
(1)  364/     12F :                     ; Reserved for TESTING purposes.
(1)  365/     12F :                     ; --------------------------------------------------------
(1)  366/     12F :                     
(1)  367/     12F :                     ; TEST COMMAND
(1)  368/     12F :                     
(1)  369/     12F :                     .cmnd_0:
(1)  370/     12F : C3 CD 00            		jp	.next_cmd
(1)  371/     132 :                     
(1)  372/     132 :                     ; 	if MARS
(1)  373/     132 :                     ; 		ld	iy,pwmcom
(1)  374/     132 :                     ; 		ld	hl,.tempset
(1)  375/     132 :                     ; 		ld	de,8
(1)  376/     132 :                     ; 		ld	b,e
(1)  377/     132 :                     ; 		dec	b
(1)  378/     132 :                     ; .copyme:
(1)  379/     132 :                     ; 		ld	a,(hl)
(1)  380/     132 :                     ; 		ld	(iy),a
(1)  381/     132 :                     ; 		inc	hl
(1)  382/     132 :                     ; 		add	iy,de
(1)  383/     132 :                     ; 		djnz	.copyme
(1)  384/     132 :                     ; 		ld	a,1
(1)  385/     132 :                     ; 		ld	(marsUpd),a
(1)  386/     132 :                     ; 		jp	.next_cmd
(1)  387/     132 :                     ; .tempset:
(1)  388/     132 :                     ; 		db 0001b
(1)  389/     132 :                     ; 		db 01h
(1)  390/     132 :                     ; 		db 00h
(1)  391/     132 :                     ; 		db 11110000b|02h
(1)  392/     132 :                     ; 		db (SmpIns_TEST>>16)&0FFh
(1)  393/     132 :                     ; 		db (SmpIns_TEST>>8)&0FFh
(1)  394/     132 :                     ; 		db (SmpIns_TEST)&0FFh
(1)  395/     132 :                     ; 	else
(1)  396/     132 :                     ; 		jp	.next_cmd
(1)  397/     132 :                     ; 	endif
(1)  398/     132 :                     
(1)  399/     132 :                     ; 		call	dac_off
(1)  400/     132 :                     ; 		ld	iy,wave_Start
(1)  401/     132 :                     ; 		ld	hl,.tempset
(1)  402/     132 :                     ; 		ld	b,0Bh
(1)  403/     132 :                     ; .copyme:
(1)  404/     132 :                     ; 		ld	a,(hl)
(1)  405/     132 :                     ; 		ld	(iy),a
(1)  406/     132 :                     ; 		inc	hl
(1)  407/     132 :                     ; 		inc	iy
(1)  408/     132 :                     ; 		djnz	.copyme
(1)  409/     132 :                     ; 		ld	hl,100h
(1)  410/     132 :                     ; 		ld	(wave_Pitch),hl
(1)  411/     132 :                     ; 		ld	a,1
(1)  412/     132 :                     ; 		ld	(wave_Flags),a
(1)  413/     132 :                     ; 		call	dac_play
(1)  414/     132 :                     ; 		jp	.next_cmd
(1)  415/     132 :                     ; .tempset:
(1)  416/     132 :                     ; 		dw TEST_WAVE&0FFFFh
(1)  417/     132 :                     ; 		db TEST_WAVE>>16&0FFh
(1)  418/     132 :                     ; 		dw (TEST_WAVE_E-TEST_WAVE)&0FFFFh
(1)  419/     132 :                     ; 		db (TEST_WAVE_E-TEST_WAVE)>>16&0FFh
(1)  420/     132 :                     ; 		dw 0
(1)  421/     132 :                     ; 		db 0
(1)  422/     132 :                     ; 		dw 0100h;+(ZSET_WTUNE)
(1)  423/     132 :                     
(1)  424/     132 :                     ; --------------------------------------------------------
(1)  425/     132 :                     ; Command 01h:
(1)  426/     132 :                     ;
(1)  427/     132 :                     ; Make new track by sequence number
(1)  428/     132 :                     ; --------------------------------------------------------
(1)  429/     132 :                     
(1)  430/     132 :                     .cmnd_1:
(1)  431/     132 : CD F0 00            		call	.grab_arg	; d0: Sequence ID
(1)  432/     135 : 4F                  		ld	c,a		; copy to c
(1)  433/     136 : CD F0 00            		call	.grab_arg	; d1: Block from
(1)  434/     139 : 47                  		ld	b,a
(1)  435/     13A : CD 9F 01            		call	.srch_frid	; Search buffer with same ID or FREE to use.
(1)  436/     13D : FE FF               		cp	-1
(1)  437/     13F : CA CD 00            		jp	z,.next_cmd	; Return if failed.
(1)  438/     142 : 36 C0               		ld	(hl),0C0h	; ** Write trk_status flags: Enable+Restart
(1)  439/     144 : 23                  		inc	hl
(1)  440/     145 : 71                  		ld	(hl),c		; ** write trk_seqId
(1)  441/     146 : 23                  		inc	hl
(1)  442/     147 : 70                  		ld	(hl),b		; ** write trk_setBlk
(1)  443/     148 : 79                  		ld	a,c
(1)  444/     149 : CD D1 04            		call	get_RomTrcks
(1)  445/     14C : C3 CD 00            		jp	.next_cmd
(1)  446/     14F :                     
(1)  447/     14F :                     ; --------------------------------------------------------
(1)  448/     14F :                     ; Command 02h:
(1)  449/     14F :                     ;
(1)  450/     14F :                     ; Stop track by sequence number
(1)  451/     14F :                     ; --------------------------------------------------------
(1)  452/     14F :                     
(1)  453/     14F :                     .cmnd_2:
(1)  454/     14F : CD F0 00            		call	.grab_arg	; d0: Sequence ID
(1)  455/     152 : 4F                  		ld	c,a		; copy to c
(1)  456/     153 : 06 FF               		ld	b,-1
(1)  457/     155 : CD 9F 01            		call	.srch_frid
(1)  458/     158 : FE FF               		cp	-1
(1)  459/     15A : CA CD 00            		jp	z,.next_cmd
(1)  460/     15D : 7E                  		ld	a,(hl)
(1)  461/     15E : CB 7F               		bit	7,a
(1)  462/     160 : CA CD 00            		jp	z,.next_cmd
(1)  463/     163 : 36 FF               		ld	(hl),-1		; Flags | Enable+Restart bits
(1)  464/     165 : 23                  		inc	hl
(1)  465/     166 : 36 FF               		ld	(hl),-1		; Reset seqId
(1)  466/     168 : CF                  		rst	8
(1)  467/     169 : C3 CD 00            		jp	.next_cmd
(1)  468/     16C :                     
(1)  469/     16C :                     ; --------------------------------------------------------
(1)  470/     16C :                     ; Command 08h:
(1)  471/     16C :                     ;
(1)  472/     16C :                     ; Stop ALL tracks
(1)  473/     16C :                     ; --------------------------------------------------------
(1)  474/     16C :                     
(1)  475/     16C :                     .cmnd_8:
(1)  476/     16C : DD 21 F7 13         		ld	ix,nikona_BuffList
(1)  477/     170 :                     .next_sall:
(1)  478/     170 : DD 7E 00            		ld	a,(ix)
(1)  479/     173 : FE FF               		cp	-1
(1)  480/     175 : CA CD 00            		jp	z,.next_cmd
(1)  481/     178 : DD 66 01            		ld	h,(ix+1)
(1)  482/     17B : 6F                  		ld	l,a
(1)  483/     17C : 7E                  		ld	a,(hl)		; *** trk_status
(1)  484/     17D : CB 7F               		bit	7,a
(1)  485/     17F : 28 05               		jr	z,.not_on
(1)  486/     181 : 36 FF               		ld	(hl),-1		; *** trk_status: -1 request
(1)  487/     183 : 23                  		inc	hl
(1)  488/     184 : 36 FF               		ld	(hl),-1		; Reset seqId
(1)  489/     186 :                     ; 		inc	hl
(1)  490/     186 :                     ; 		ld	(hl),0
(1)  491/     186 :                     .not_on:
(1)  492/     186 : 11 10 00            		ld	de,10h
(1)  493/     189 : DD 19               		add	ix,de
(1)  494/     18B : C3 70 01            		jp	.next_sall
(1)  495/     18E :                     
(1)  496/     18E :                     ; --------------------------------------------------------
(1)  497/     18E :                     ; Command 0Ch:
(1)  498/     18E :                     ;
(1)  499/     18E :                     ; Set global sub-beats
(1)  500/     18E :                     ; --------------------------------------------------------
(1)  501/     18E :                     
(1)  502/     18E :                     .cmnd_C:
(1)  503/     18E : CD F0 00            		call	.grab_arg	; d0.w: $00xx
(1)  504/     191 : 4F                  		ld	c,a
(1)  505/     192 : CD F0 00            		call	.grab_arg	; d0.w: $xx00
(1)  506/     195 : 32 1F 00            		ld	(sbeatPtck+1),a
(1)  507/     198 : 79                  		ld	a,c
(1)  508/     199 : 32 1E 00            		ld	(sbeatPtck),a
(1)  509/     19C : C3 CD 00            		jp	.next_cmd
(1)  510/     19F :                     
(1)  511/     19F :                     ; ------------------------------------------------
(1)  512/     19F :                     
(1)  513/     19F :                     ; c - trk_currId
(1)  514/     19F :                     ; b - trk_setBlk (-1: ignore)
(1)  515/     19F :                     .srch_frid:
(1)  516/     19F : DD 21 F7 13         		ld	ix,nikona_BuffList
(1)  517/     1A3 : 11 10 00            		ld	de,10h
(1)  518/     1A6 :                     .next:
(1)  519/     1A6 : DD 7E 00            		ld	a,(ix)
(1)  520/     1A9 : FE FF               		cp	-1
(1)  521/     1AB : C8                  		ret	z
(1)  522/     1AC : DD 66 01            		ld	h,(ix+1)
(1)  523/     1AF : 6F                  		ld	l,a
(1)  524/     1B0 : 1E 10               		ld	e,10h
(1)  525/     1B2 : DD 19               		add	ix,de
(1)  526/     1B4 : 23                  		inc	hl
(1)  527/     1B5 : CF                  		rst	8
(1)  528/     1B6 : 23                  		inc	hl
(1)  529/     1B7 : 5E                  		ld	e,(hl)		; ** e - trk_currId
(1)  530/     1B8 : 2B                  		dec	hl
(1)  531/     1B9 :                     
(1)  532/     1B9 : 7E                  		ld	a,(hl)		; ** a - trk_Id
(1)  533/     1BA : 2B                  		dec	hl
(1)  534/     1BB : B9                  		cp	c
(1)  535/     1BC : 20 09               		jr	nz,.not_fnd
(1)  536/     1BE : 78                  		ld	a,b
(1)  537/     1BF : FE FF               		cp	-1
(1)  538/     1C1 : 28 09               		jr	z,.found
(1)  539/     1C3 : 7B                  		ld	a,e
(1)  540/     1C4 : B8                  		cp	b
(1)  541/     1C5 : 28 05               		jr	z,.found
(1)  542/     1C7 :                     .not_fnd:
(1)  543/     1C7 : 7E                  		ld	a,(hl)		; ** a - trk_status
(1)  544/     1C8 : B7                  		or	a
(1)  545/     1C9 : FA A6 01            		jp	m,.next
(1)  546/     1CC :                     .found:
(1)  547/     1CC : CF                  		rst	8
(1)  548/     1CD : AF                  		xor	a
(1)  549/     1CE : C9                  		ret
(1)  550/     1CF :                     
(1)  551/     1CF :                     ; ====================================================================
(1)  552/     1CF :                     ; ----------------------------------------------------------------
(1)  553/     1CF :                     ; MAIN Playback section
(1)  554/     1CF :                     ; ----------------------------------------------------------------
(1)  555/     1CF :                     
(1)  556/     1CF :                     ; ============================================================
(1)  557/     1CF :                     ; --------------------------------------------------------
(1)  558/     1CF :                     ; Read INTERNAL mini-impulse-tracker data
(1)  559/     1CF :                     ; --------------------------------------------------------
(1)  560/     1CF :                     
(1)  561/     1CF :                     upd_track:
(1)  562/     1CF : E7                  		rst	20h
(1)  563/     1D0 : FD 21 F7 13         		ld	iy,nikona_BuffList
(1)  564/     1D4 :                     .trk_buffrs:
(1)  565/     1D4 : CF                  		rst	8
(1)  566/     1D5 : FD 7E 00            		ld	a,(iy)
(1)  567/     1D8 : FE FF               		cp	-1
(1)  568/     1DA : C8                  		ret	z
(1)  569/     1DB : FD E5               		push	iy
(1)  570/     1DD : FD 6E 00            		ld	l,(iy)
(1)  571/     1E0 : FD 66 01            		ld	h,(iy+1)
(1)  572/     1E3 : CD F0 01            		call	.read_track
(1)  573/     1E6 : CF                  		rst	8
(1)  574/     1E7 : FD E1               		pop	iy
(1)  575/     1E9 : 11 10 00            		ld	de,10h
(1)  576/     1EC : FD 19               		add	iy,de
(1)  577/     1EE : 18 E4               		jr	.trk_buffrs
(1)  578/     1F0 :                     ; ----------------------------------------
(1)  579/     1F0 :                     ; iy - Track buffer
(1)  580/     1F0 :                     
(1)  581/     1F0 :                     .read_track:
(1)  582/     1F0 : CF                  		rst	8
(1)  583/     1F1 : E5                  		push	hl
(1)  584/     1F2 : FD E1               		pop	iy
(1)  585/     1F4 : FD 46 00            		ld	b,(iy+trk_status)	; b - Track status and settings
(1)  586/     1F7 : CB 78               		bit	7,b			; bit7: Track active?
(1)  587/     1F9 : C8                  		ret	z
(1)  588/     1FA : 78                  		ld	a,b
(1)  589/     1FB : FE FF               		cp	-1			; Mid-silence request?
(1)  590/     1FD : C8                  		ret	z
(1)  591/     1FE : 3A 2E 00            		ld	a,(currTickBits)	; a - Tick/Beat bits
(1)  592/     201 : CB 40               		bit	0,b			; bit0: This track uses Beats?
(1)  593/     203 : 28 04               		jr	z,.sfxmd
(1)  594/     205 : CB 4F               		bit	1,a			; BEAT passed?
(1)  595/     207 : C8                  		ret	z			;
(1)  596/     208 : CF                  		rst	8
(1)  597/     209 :                     .sfxmd:
(1)  598/     209 : CB 47               		bit	0,a			; TICK passed?
(1)  599/     20B : C8                  		ret	z
(1)  600/     20C :                     	; *** Start reading notes ***
(1)  601/     20C : CB 70               		bit	6,b			; bit6: Restart/First time?
(1)  602/     20E : C4 E2 03            		call	nz,.first_fill
(1)  603/     211 : CB 68               		bit	5,b			; bit5: FILL request by effect?
(1)  604/     213 : C4 DB 03            		call	nz,.effect_fill
(1)  605/     216 : FD 7E 11            		ld	a,(iy+trk_tickTmr)	; TICK ex-timer for this track
(1)  606/     219 : 3D                  		dec	a
(1)  607/     21A : FD 77 11            		ld	(iy+trk_tickTmr),a
(1)  608/     21D : B7                  		or	a
(1)  609/     21E : C0                  		ret	nz			; If TICK != 0, Exit
(1)  610/     21F : FD 7E 03            		ld	a,(iy+trk_tickSet)	; Set new tick timer
(1)  611/     222 : FD 77 11            		ld	(iy+trk_tickTmr),a
(1)  612/     225 : FD 4E 0C            		ld	c,(iy+trk_Rows)		; bc - Set row counter
(1)  613/     228 : FD 46 0D            		ld	b,(iy+(trk_Rows+1))
(1)  614/     22B : 79                  		ld	a,c			; Check rowcount
(1)  615/     22C : B0                  		or	b
(1)  616/     22D : 20 13               		jr	nz,.row_active
(1)  617/     22F : FD 7E 12            		ld	a,(iy+trk_currBlk)	; If bc == 0: Next block
(1)  618/     232 : 3C                  		inc	a
(1)  619/     233 : FD 77 12            		ld 	(iy+trk_currBlk),a
(1)  620/     236 : CD 66 03            		call	.set_track
(1)  621/     239 : FE FF               		cp	-1			; Track finished?
(1)  622/     23B : C8                  		ret	z
(1)  623/     23C : FD 4E 0C            		ld	c,(iy+trk_Rows)
(1)  624/     23F : FD 46 0D            		ld	b,(iy+(trk_Rows+1))
(1)  625/     242 :                     .row_active:
(1)  626/     242 : CF                  		rst	8
(1)  627/     243 : FD 6E 0A            		ld	l,(iy+trk_Read)		; hl - CURRENT pattern to read
(1)  628/     246 : FD 66 0B            		ld	h,(iy+((trk_Read+1)))
(1)  629/     249 :                     
(1)  630/     249 :                     ; --------------------------------
(1)  631/     249 :                     ; Main reading loop
(1)  632/     249 :                     ; --------------------------------
(1)  633/     249 :                     
(1)  634/     249 :                     .next_note:
(1)  635/     249 : FD 7E 10            		ld	a,(iy+trk_rowPause)	; Check rowtimer
(1)  636/     24C : B7                  		or	a
(1)  637/     24D : 20 16               		jr	nz,.decrow
(1)  638/     24F : 7E                  		ld	a,(hl)			; Check if timer or note
(1)  639/     250 : B7                  		or	a
(1)  640/     251 : 28 06               		jr	z,.exit			; If == 00h: exit
(1)  641/     253 : FA 70 02            		jp	m,.has_note		; 80h-0FFh: note data
(1)  642/     256 : FD 77 10            		ld	(iy+trk_rowPause),a
(1)  643/     259 :                     
(1)  644/     259 :                     ; --------------------------------
(1)  645/     259 :                     ; Exit
(1)  646/     259 :                     ; --------------------------------
(1)  647/     259 :                     
(1)  648/     259 :                     .exit:
(1)  649/     259 : CF                  		rst	8
(1)  650/     25A : CD 2E 03            		call	.inc_cpatt
(1)  651/     25D : FD 75 0A            		ld	(iy+trk_Read),l		; Update read location
(1)  652/     260 : FD 74 0B            		ld	(iy+((trk_Read+1))),h
(1)  653/     263 : 18 03               		jr	.decrow_e
(1)  654/     265 :                     .decrow:
(1)  655/     265 : FD 35 10            		dec	(iy+trk_rowPause)
(1)  656/     268 :                     .decrow_e:
(1)  657/     268 : 0B                  		dec	bc			; Decrement this row
(1)  658/     269 : FD 71 0C            		ld	(iy+trk_Rows),c		; Write last row and exit.
(1)  659/     26C : FD 70 0D            		ld	(iy+(trk_Rows+1)),b
(1)  660/     26F : C9                  		ret
(1)  661/     270 :                     
(1)  662/     270 :                     ; --------------------------------
(1)  663/     270 :                     ; New note request
(1)  664/     270 :                     ; --------------------------------
(1)  665/     270 :                     
(1)  666/     270 :                     .has_note:
(1)  667/     270 : CF                  		rst	8
(1)  668/     271 : C5                  		push	bc			; Save rowcount
(1)  669/     272 : 4F                  		ld	c,a			; Backup control|channel to c
(1)  670/     273 : CD 2E 03            		call	.inc_cpatt		; Increment hl
(1)  671/     276 : 79                  		ld	a,c			; Read control|channel
(1)  672/     277 : FD 5E 26            		ld	e,(iy+trk_ChnList)	; Point to track-data
(1)  673/     27A : FD 56 27            		ld	d,(iy+(trk_ChnList+1))
(1)  674/     27D : D5                  		push	de
(1)  675/     27E : DD E1               		pop	ix
(1)  676/     280 : E6 3F               		and	00111111b		; Filter channel bits
(1)  677/     282 : 87                  		add	a,a
(1)  678/     283 : 87                  		add	a,a
(1)  679/     284 : 87                  		add	a,a			; * 8
(1)  680/     285 : 16 00               		ld 	d,0
(1)  681/     287 : 5F                  		ld	e,a
(1)  682/     288 : CF                  		rst	8
(1)  683/     289 : DD 19               		add	ix,de
(1)  684/     28B : DD 46 07            		ld	b,(ix+chnl_Type)	; b - Current TYPE byte
(1)  685/     28E : CB 71               		bit	6,c			; Next byte is new type?
(1)  686/     290 : 28 08               		jr	z,.old_type
(1)  687/     292 : 7E                  		ld	a,(hl)
(1)  688/     293 : DD 77 07            		ld	(ix+chnl_Type),a	; Update TYPE byte
(1)  689/     296 : 47                  		ld	b,a			; Set to b
(1)  690/     297 : CD 2E 03            		call	.inc_cpatt
(1)  691/     29A :                     .old_type:
(1)  692/     29A :                     	; b - evinEVIN
(1)  693/     29A :                     	;     E-effect/V-volume/I-instrument/N-note
(1)  694/     29A :                     	;     evin: byte is already stored on track-channel buffer
(1)  695/     29A :                     	;     EVIN: next byte(s) contain a new value. for eff:2 bytes
(1)  696/     29A : CF                  		rst	8
(1)  697/     29B : CB 40               		bit	0,b
(1)  698/     29D : 28 07               		jr	z,.no_note
(1)  699/     29F : 7E                  		ld	a,(hl)
(1)  700/     2A0 : DD 77 02            		ld	(ix+chnl_Note),a
(1)  701/     2A3 : CD 2E 03            		call	.inc_cpatt
(1)  702/     2A6 :                     .no_note:
(1)  703/     2A6 : CB 48               		bit	1,b
(1)  704/     2A8 : 28 07               		jr	z,.no_ins
(1)  705/     2AA : 7E                  		ld	a,(hl)
(1)  706/     2AB : DD 77 03            		ld	(ix+chnl_Ins),a
(1)  707/     2AE : CD 2E 03            		call	.inc_cpatt
(1)  708/     2B1 :                     .no_ins:
(1)  709/     2B1 : CB 50               		bit	2,b
(1)  710/     2B3 : 28 07               		jr	z,.no_vol
(1)  711/     2B5 : 7E                  		ld	a,(hl)
(1)  712/     2B6 : DD 77 04            		ld	(ix+chnl_Vol),a
(1)  713/     2B9 : CD 2E 03            		call	.inc_cpatt
(1)  714/     2BC :                     .no_vol:
(1)  715/     2BC : CB 58               		bit	3,b
(1)  716/     2BE : 28 0F               		jr	z,.no_eff
(1)  717/     2C0 : 7E                  		ld	a,(hl)
(1)  718/     2C1 : DD 77 05            		ld	(ix+chnl_EffId),a
(1)  719/     2C4 : CD 2E 03            		call	.inc_cpatt
(1)  720/     2C7 : CF                  		rst	8
(1)  721/     2C8 : 7E                  		ld	a,(hl)
(1)  722/     2C9 : DD 77 06            		ld	(ix+chnl_EffArg),a
(1)  723/     2CC : CD 2E 03            		call	.inc_cpatt
(1)  724/     2CF :                     .no_eff:
(1)  725/     2CF : 78                  		ld	a,b		; Merge the Impulse recycle bits into main bits
(1)  726/     2D0 : 0F                  		rrca
(1)  727/     2D1 : 0F                  		rrca
(1)  728/     2D2 : 0F                  		rrca
(1)  729/     2D3 : 0F                  		rrca
(1)  730/     2D4 : E6 0F               		and	00001111b
(1)  731/     2D6 : 4F                  		ld	c,a
(1)  732/     2D7 : 78                  		ld	a,b
(1)  733/     2D8 : E6 0F               		and	00001111b
(1)  734/     2DA : B1                  		or	c
(1)  735/     2DB : CF                  		rst	8
(1)  736/     2DC : 4F                  		ld	c,a
(1)  737/     2DD : DD 7E 00            		ld	a,(ix+chnl_Flags)
(1)  738/     2E0 : B1                  		or	c
(1)  739/     2E1 : DD 77 00            		ld	(ix+chnl_Flags),a
(1)  740/     2E4 : C1                  		pop	bc		; Restore rowcount
(1)  741/     2E5 :                     
(1)  742/     2E5 :                     	; Check for effects that affect
(1)  743/     2E5 :                     	; internal playback:
(1)  744/     2E5 :                     	; Jump, Ticks, etc.
(1)  745/     2E5 : E6 08               		and	1000b		; Only check for the EFFECT bit
(1)  746/     2E7 : CA 49 02            		jp	z,.next_note
(1)  747/     2EA : DD 7E 05            		ld	a,(ix+chnl_EffId)
(1)  748/     2ED : B7                  		or	a		; 00h = invalid effect
(1)  749/     2EE : CA 49 02            		jp	z,.next_note
(1)  750/     2F1 : FE 01               		cp	1		; Effect A: Tick set
(1)  751/     2F3 : CC 03 03            		call	z,.eff_A
(1)  752/     2F6 : FE 02               		cp	2		; Effect B: Position Jump
(1)  753/     2F8 : CC 15 03            		call	z,.eff_B
(1)  754/     2FB : FE 03               		cp	3		; Effect C: Pattern break
(1)  755/     2FD : CA 2B 03            		jp	z,.eff_C	; <-- JUMP and exit.
(1)  756/     300 : C3 49 02            		jp	.next_note
(1)  757/     303 :                     
(1)  758/     303 :                     ; ----------------------------------------
(1)  759/     303 :                     ; Effect A: Set ticks
(1)  760/     303 :                     ; ----------------------------------------
(1)  761/     303 :                     
(1)  762/     303 :                     .eff_A:
(1)  763/     303 : F5                  		push	af
(1)  764/     304 : CF                  		rst	8
(1)  765/     305 : DD 5E 06            		ld	e,(ix+chnl_EffArg)	; e - ticks number
(1)  766/     308 : 1D                  		dec	e			; TODO: no minus protection
(1)  767/     309 : FD 73 03            		ld	(iy+trk_tickSet),e	; set for both Set and Timer.
(1)  768/     30C : FD 73 11            		ld	(iy+trk_tickTmr),e
(1)  769/     30F : DD CB 00 9E         		res	3,(ix+chnl_Flags)	; <-- Clear EFFECT bit
(1)  770/     313 : F1                  		pop	af
(1)  771/     314 : C9                  		ret
(1)  772/     315 :                     
(1)  773/     315 :                     ; ----------------------------------------
(1)  774/     315 :                     ; Effect B: jump to a new block
(1)  775/     315 :                     ; ----------------------------------------
(1)  776/     315 :                     
(1)  777/     315 :                     .eff_B:
(1)  778/     315 : F5                  		push	af			; Save Flagbits
(1)  779/     316 : DD 5E 06            		ld	e,(ix+chnl_EffArg)	; e - Block SLOT to jump
(1)  780/     319 : FD 73 12            		ld 	(iy+trk_currBlk),e
(1)  781/     31C : CF                  		rst	8
(1)  782/     31D : FD 36 10 00         		ld	(iy+trk_rowPause),0	; Reset rowpause
(1)  783/     321 : DD CB 00 9E         		res	3,(ix+chnl_Flags)	; <-- Clear EFFECT bit
(1)  784/     325 : FD CB 00 EE         		set	5,(iy+trk_status)	; set fill-from-effect flag on exit
(1)  785/     329 : F1                  		pop	af
(1)  786/     32A : C9                  		ret
(1)  787/     32B :                     
(1)  788/     32B :                     ; ----------------------------------------
(1)  789/     32B :                     ; Effect C: Pattern break/exit
(1)  790/     32B :                     ;
(1)  791/     32B :                     ; Only used on SFX, arguments ignored.
(1)  792/     32B :                     ; ----------------------------------------
(1)  793/     32B :                     
(1)  794/     32B :                     .eff_C:
(1)  795/     32B : C3 CA 03            		jp	.track_end
(1)  796/     32E :                     
(1)  797/     32E :                     ; ----------------------------------------
(1)  798/     32E :                     ; Increment the current patt position
(1)  799/     32E :                     ; and recieve more data
(1)  800/     32E :                     ;
(1)  801/     32E :                     ; Breaks:
(1)  802/     32E :                     ; a,e
(1)  803/     32E :                     ; ----------------------------------------
(1)  804/     32E :                     
(1)  805/     32E :                     .inc_cpatt:
(1)  806/     32E : FD 5E 2E            		ld	e,(iy+trk_ChnCach)
(1)  807/     331 : 7D                  		ld	a,l
(1)  808/     332 : 3C                  		inc	a
(1)  809/     333 : E6 3F               		and	MAX_RCACH-1
(1)  810/     335 : FE 3E               		cp	MAX_RCACH-2	; RAN OUT of bytes?
(1)  811/     337 : 30 03               		jr	nc,.ran_out
(1)  812/     339 : B3                  		or	e
(1)  813/     33A : 6F                  		ld	l,a
(1)  814/     33B : C9                  		ret
(1)  815/     33C :                     .ran_out:
(1)  816/     33C : FD 6E 2E            		ld	l,(iy+trk_ChnCach)
(1)  817/     33F : E5                  		push	hl
(1)  818/     340 : C5                  		push	bc
(1)  819/     341 : 06 00               		ld	b,0
(1)  820/     343 : 4F                  		ld	c,a
(1)  821/     344 : CF                  		rst	8
(1)  822/     345 : 5D                  		ld	e,l
(1)  823/     346 : 54                  		ld	d,h
(1)  824/     347 : FD 6E 20            		ld	l,(iy+trk_RomCPatt)
(1)  825/     34A : FD 66 21            		ld	h,(iy+(trk_RomCPatt+1))
(1)  826/     34D : FD 7E 22            		ld	a,(iy+(trk_RomCPatt+2))
(1)  827/     350 : 09                  		add	hl,bc
(1)  828/     351 : CE 00               		adc	a,0
(1)  829/     353 : FD 75 20            		ld	(iy+trk_RomCPatt),l
(1)  830/     356 : FD 74 21            		ld	(iy+(trk_RomCPatt+1)),h
(1)  831/     359 : CF                  		rst	8
(1)  832/     35A : FD 77 22            		ld	(iy+(trk_RomCPatt+2)),a
(1)  833/     35D : 01 40 00            		ld	bc,MAX_RCACH
(1)  834/     360 : CD C8 0E            		call	transferRom	; *** ROM ACCESS ***
(1)  835/     363 : C1                  		pop	bc
(1)  836/     364 : E1                  		pop	hl
(1)  837/     365 : C9                  		ret
(1)  838/     366 :                     
(1)  839/     366 :                     ; ----------------------------------------
(1)  840/     366 :                     ; Set track pattern by trk_currBlk
(1)  841/     366 :                     ; ----------------------------------------
(1)  842/     366 :                     
(1)  843/     366 :                     .set_track:
(1)  844/     366 : CF                  		rst	8
(1)  845/     367 : 16 00               		ld	d,0
(1)  846/     369 : FD 5E 12            		ld	e,(iy+trk_currBlk)	; e - current block
(1)  847/     36C : FD 6E 04            		ld	l,(iy+trk_Blocks)	; hl - block data
(1)  848/     36F : FD 66 05            		ld	h,(iy+(trk_Blocks+1))
(1)  849/     372 : 19                  		add	hl,de
(1)  850/     373 : 7E                  		ld	a,(hl)			; Read byte
(1)  851/     374 : FE FF               		cp	-1			; If block == -1, end track
(1)  852/     376 : CA CA 03            		jp	z,.track_end
(1)  853/     379 : E7                  		rst	20h			; dacfill
(1)  854/     37A : 07                  		rlca
(1)  855/     37B : 07                  		rlca
(1)  856/     37C : 57                  		ld	d,a
(1)  857/     37D : E6 FC               		and	11111100b
(1)  858/     37F : 5F                  		ld	e,a
(1)  859/     380 : 7A                  		ld	a,d
(1)  860/     381 : E6 03               		and	00000011b
(1)  861/     383 : 57                  		ld	d,a
(1)  862/     384 : FD 6E 06            		ld	l,(iy+trk_Patt)		; Read CACHE patt heads
(1)  863/     387 : FD 66 07            		ld	h,(iy+(trk_Patt+1))
(1)  864/     38A : CF                  		rst	8
(1)  865/     38B : 19                  		add	hl,de
(1)  866/     38C : 5E                  		ld	e,(hl)			; de - Pos
(1)  867/     38D : 23                  		inc	hl
(1)  868/     38E : 56                  		ld	d,(hl)
(1)  869/     38F : 23                  		inc	hl
(1)  870/     390 : 7E                  		ld	a,(hl)
(1)  871/     391 : 23                  		inc	hl
(1)  872/     392 : FD 77 0C            		ld	(iy+trk_Rows),a
(1)  873/     395 : 7E                  		ld	a,(hl)
(1)  874/     396 : 23                  		inc	hl
(1)  875/     397 : FD 77 0D            		ld	(iy+(trk_Rows+1)),a
(1)  876/     39A : FD 6E 23            		ld	l,(iy+trk_RomPatt)	; Transfer FIRST patt
(1)  877/     39D : FD 66 24            		ld	h,(iy+(trk_RomPatt+1))	; packet
(1)  878/     3A0 : CF                  		rst	8
(1)  879/     3A1 : FD 7E 25            		ld	a,(iy+(trk_RomPatt+2))
(1)  880/     3A4 : 19                  		add	hl,de
(1)  881/     3A5 : CE 00               		adc	a,0
(1)  882/     3A7 : FD 75 20            		ld	(iy+trk_RomCPatt),l
(1)  883/     3AA : FD 74 21            		ld	(iy+(trk_RomCPatt+1)),h
(1)  884/     3AD : FD 77 22            		ld	(iy+(trk_RomCPatt+2)),a
(1)  885/     3B0 : FD 5E 2E            		ld	e,(iy+trk_ChnCach)
(1)  886/     3B3 : FD 56 2F            		ld	d,(iy+(trk_ChnCach+1))
(1)  887/     3B6 : CF                  		rst	8
(1)  888/     3B7 : FD 73 0A            		ld	(iy+trk_Read),e
(1)  889/     3BA : FD 72 0B            		ld	(iy+(trk_Read+1)),d
(1)  890/     3BD : 0E 40               		ld	c,MAX_RCACH
(1)  891/     3BF : FD 36 0E 00         		ld	(iy+trk_cachHalf),0
(1)  892/     3C3 : FD 36 10 00         		ld	(iy+trk_rowPause),0
(1)  893/     3C7 : C3 C8 0E            		jp	transferRom		; ** ROM access **
(1)  894/     3CA :                     
(1)  895/     3CA :                     ; ----------------------------------------
(1)  896/     3CA :                     ; **JUMP ONLY**
(1)  897/     3CA :                     
(1)  898/     3CA :                     .track_end:
(1)  899/     3CA : CD 93 04            		call	track_out
(1)  900/     3CD : CF                  		rst	8
(1)  901/     3CE : FD 36 10 00         		ld	(iy+trk_rowPause),0
(1)  902/     3D2 : FD 36 11 00         		ld	(iy+trk_tickTmr),0
(1)  903/     3D6 : FD 36 00 00         		ld	(iy+trk_Status),0	; Disable track slot
(1)  904/     3DA : C9                  		ret
(1)  905/     3DB :                     
(1)  906/     3DB :                     ; ----------------------------------------
(1)  907/     3DB :                     ; Track refill
(1)  908/     3DB :                     ; ----------------------------------------
(1)  909/     3DB :                     
(1)  910/     3DB :                     .effect_fill:
(1)  911/     3DB : FD CB 00 AE         		res	5,(iy+trk_status)	; Reset refill-from-effect flag
(1)  912/     3DF : C3 66 03            		jp	.set_track
(1)  913/     3E2 :                     
(1)  914/     3E2 :                     ; ----------------------------------------
(1)  915/     3E2 :                     ; Track Start/Reset
(1)  916/     3E2 :                     ;
(1)  917/     3E2 :                     ; iy - Track buffer
(1)  918/     3E2 :                     ; ----------------------------------------
(1)  919/     3E2 :                     
(1)  920/     3E2 :                     .first_fill:
(1)  921/     3E2 :                     ; 		rst	20h
(1)  922/     3E2 : FD CB 00 B6         		res	6,(iy+trk_status)	; Reset FILL flag
(1)  923/     3E6 : CD 93 04            		call	track_out
(1)  924/     3E9 : FD 36 11 01         		ld	(iy+trk_tickTmr),1	; <-- Reset tick timer
(1)  925/     3ED : FD 7E 02            		ld	a,(iy+trk_setBlk)	; Make start block as current block
(1)  926/     3F0 : CF                  		rst	8
(1)  927/     3F1 : FD 77 12            		ld 	(iy+trk_currBlk),a	; block
(1)  928/     3F4 : 11 00 00            		ld	de,0
(1)  929/     3F7 : 21 B7 16            		ld	hl,trkListCach		; Read MASTER Nicona track list
(1)  930/     3FA : FD 7E 01            		ld	a,(iy+trk_seqId)
(1)  931/     3FD : E6 0F               		and	00001111b		; Filter sequence bits
(1)  932/     3FF : 87                  		add	a,a			; *4
(1)  933/     400 : 87                  		add	a,a
(1)  934/     401 : 5F                  		ld	e,a
(1)  935/     402 : 19                  		add	hl,de
(1)  936/     403 : 7E                  		ld	a,(hl)
(1)  937/     404 : 23                  		inc	hl
(1)  938/     405 : CB 7F               		bit	7,a
(1)  939/     407 : 28 04               		jr	z,.no_glbl
(1)  940/     409 : FD CB 00 C6         		set	0,(iy+trk_status)	; Enable GLOBAL sub-beats
(1)  941/     40D :                     .no_glbl:
(1)  942/     40D : E6 7F               		and	01111111b
(1)  943/     40F : FD 77 03            		ld	(iy+trk_tickSet),a
(1)  944/     412 : 7E                  		ld	a,(hl)			; Read and temporally
(1)  945/     413 : 23                  		inc	hl			; grab it's pointers
(1)  946/     414 : 4E                  		ld	c,(hl)
(1)  947/     415 : CF                  		rst	8
(1)  948/     416 : 23                  		inc	hl
(1)  949/     417 : 6E                  		ld	l,(hl)
(1)  950/     418 : 61                  		ld	h,c
(1)  951/     419 : 11 08 17            		ld	de,headerOut
(1)  952/     41C : 0E 0C               		ld	c,0Ch
(1)  953/     41E : CD C8 0E            		call	transferRom		; ** ROM access **
(1)  954/     421 : DD 21 13 17         		ld	ix,headerOut_e-1
(1)  955/     425 :                     
(1)  956/     425 :                     	; headerOut:
(1)  957/     425 :                     	; dc.l .blk,.pat,.ins
(1)  958/     425 :                     	; *** READING BACKWARDS
(1)  959/     425 : CD 7F 04            		call	.grab_rhead		; Instrument data
(1)  960/     428 : FD 4E 1F            		ld	c,(iy+trk_MaxIns)
(1)  961/     42B : CB 21               		sla	c			; *8
(1)  962/     42D : CB 21               		sla	c
(1)  963/     42F : CB 21               		sla	c
(1)  964/     431 : 78                  		ld	a,b
(1)  965/     432 : FD 5E 2C            		ld	e,(iy+trk_ChnCIns)
(1)  966/     435 : FD 56 2D            		ld	d,(iy+(trk_ChnCIns+1))
(1)  967/     438 : FD 73 08            		ld	(iy+trk_Instr),e
(1)  968/     43B : FD 72 09            		ld	(iy+(trk_Instr+1)),d
(1)  969/     43E : CF                  		rst	8
(1)  970/     43F : CD C8 0E            		call	transferRom		; ** ROM access **
(1)  971/     442 : CD 7F 04            		call	.grab_rhead		; Pattern data
(1)  972/     445 : FD 4E 1E            		ld	c,(iy+trk_MaxHdrs)
(1)  973/     448 : CB 21               		sla	c			; *4
(1)  974/     44A : CB 21               		sla	c
(1)  975/     44C : 78                  		ld	a,b
(1)  976/     44D : FD 75 23            		ld	(iy+trk_RomPatt),l	; Save ROM patt base
(1)  977/     450 : FD 74 24            		ld	(iy+(trk_RomPatt+1)),h
(1)  978/     453 : FD 77 25            		ld	(iy+(trk_RomPatt+2)),a
(1)  979/     456 : CF                  		rst	8
(1)  980/     457 : FD 5E 2A            		ld	e,(iy+trk_ChnCHead)
(1)  981/     45A : FD 56 2B            		ld	d,(iy+(trk_ChnCHead+1))
(1)  982/     45D : FD 73 06            		ld	(iy+trk_Patt),e
(1)  983/     460 : FD 72 07            		ld	(iy+(trk_Patt+1)),d
(1)  984/     463 : CD C8 0E            		call	transferRom		; ** ROM access **
(1)  985/     466 : CD 7F 04            		call	.grab_rhead		; Block data
(1)  986/     469 : FD 4E 1D            		ld	c,(iy+trk_MaxBlks)
(1)  987/     46C : 78                  		ld	a,b
(1)  988/     46D : FD 5E 28            		ld	e,(iy+trk_ChnCBlk)
(1)  989/     470 : FD 56 29            		ld	d,(iy+(trk_ChnCBlk+1))
(1)  990/     473 : FD 73 04            		ld	(iy+trk_Blocks),e
(1)  991/     476 : FD 72 05            		ld	(iy+(trk_Blocks+1)),d
(1)  992/     479 : CD C8 0E            		call	transferRom		; ** ROM access **
(1)  993/     47C : C3 66 03            		jp	.set_track
(1)  994/     47F :                     
(1)  995/     47F :                     ; Read 68K pointer:
(1)  996/     47F :                     ; hl - 00xxxx
(1)  997/     47F :                     ;  b - xx0000
(1)  998/     47F :                     .grab_rhead:
(1)  999/     47F : DD 6E 00            		ld	l,(ix)
(1) 1000/     482 : DD 2B               		dec	ix
(1) 1001/     484 : CF                  		rst	8
(1) 1002/     485 : DD 66 00            		ld	h,(ix)
(1) 1003/     488 : DD 2B               		dec	ix
(1) 1004/     48A : DD 46 00            		ld	b,(ix)
(1) 1005/     48D : DD 2B               		dec	ix
(1) 1006/     48F :                     ; 		ld	c,(ix)
(1) 1007/     48F : CF                  		rst	8
(1) 1008/     490 : DD 2B               		dec	ix
(1) 1009/     492 : C9                  		ret
(1) 1010/     493 :                     
(1) 1011/     493 :                     ; ----------------------------------------
(1) 1012/     493 :                     ; Reset tracker channels
(1) 1013/     493 :                     ;
(1) 1014/     493 :                     ; iy - Track buffer
(1) 1015/     493 :                     ;
(1) 1016/     493 :                     ; Breaks:
(1) 1017/     493 :                     ; ix
(1) 1018/     493 :                     ; ----------------------------------------
(1) 1019/     493 :                     
(1) 1020/     493 :                     ; ----------------------------------------
(1) 1021/     493 :                     ; Reset tracker channels
(1) 1022/     493 :                     ;
(1) 1023/     493 :                     ; iy - Track buffer
(1) 1024/     493 :                     ;
(1) 1025/     493 :                     ; Breaks:
(1) 1026/     493 :                     ; de,ix
(1) 1027/     493 :                     ; ----------------------------------------
(1) 1028/     493 :                     
(1) 1029/     493 :                     track_out:
(1) 1030/     493 : FD 5E 26            		ld	e,(iy+trk_ChnList)	; Point to track-data
(1) 1031/     496 : FD 56 27            		ld	d,(iy+(trk_ChnList+1))
(1) 1032/     499 : D5                  		push	de
(1) 1033/     49A : DD E1               		pop	ix
(1) 1034/     49C : CF                  		rst	8
(1) 1035/     49D : 11 08 00            		ld	de,8
(1) 1036/     4A0 : FD 46 1C            		ld	b,(iy+trk_MaxChnls)	; MAX_TRKCHN
(1) 1037/     4A3 : AF                  		xor	a
(1) 1038/     4A4 :                     .clrfe:
(1) 1039/     4A4 : DD 7E 01            		ld	a,(ix+chnl_Chip)
(1) 1040/     4A7 : B7                  		or	a
(1) 1041/     4A8 : 28 1D               		jr	z,.nochip
(1) 1042/     4AA : DD 36 02 FE         		ld	(ix+chnl_Note),-2
(1) 1043/     4AE : DD 36 00 01         		ld	(ix+chnl_Flags),1
(1) 1044/     4B2 : DD 36 04 40         		ld	(ix+chnl_Vol),64
(1) 1045/     4B6 : CF                  		rst	8
(1) 1046/     4B7 : FD 36 05 00         		ld	(iy+chnl_EffId),0
(1) 1047/     4BB : FD 36 06 00         		ld	(iy+chnl_EffArg),0
(1) 1048/     4BF : FD 36 03 00         		ld	(iy+chnl_Ins),0
(1) 1049/     4C3 : FD 36 07 00         		ld	(iy+chnl_Type),0
(1) 1050/     4C7 :                     .nochip:
(1) 1051/     4C7 : DD 19               		add	ix,de
(1) 1052/     4C9 : 10 D9               		djnz	.clrfe
(1) 1053/     4CB : 3E 01               		ld	a,1
(1) 1054/     4CD : 32 3F 00            		ld	(marsUpd),a
(1) 1055/     4D0 : C9                  		ret
(1) 1056/     4D1 :                     
(1) 1057/     4D1 :                     ; ----------------------------------------
(1) 1058/     4D1 :                     ; Load tracklist from ROM
(1) 1059/     4D1 :                     ;
(1) 1060/     4D1 :                     ; a - SeqID
(1) 1061/     4D1 :                     ; ----------------------------------------
(1) 1062/     4D1 :                     
(1) 1063/     4D1 :                     get_RomTrcks:
(1) 1064/     4D1 : E6 F0               		and	11110000b
(1) 1065/     4D3 : 5F                  		ld	e,a
(1) 1066/     4D4 : 3A 3E 00            		ld	a,(trkListPage)
(1) 1067/     4D7 : BB                  		cp	e
(1) 1068/     4D8 : C8                  		ret	z
(1) 1069/     4D9 :                     init_RomTrcks:
(1) 1070/     4D9 : 7B                  		ld	a,e
(1) 1071/     4DA : 32 3E 00            		ld	(trkListPage),a
(1) 1072/     4DD : 07                  		rlca
(1) 1073/     4DE : 07                  		rlca			; 10h*4=40h
(1) 1074/     4DF : E6 C0               		and	11000000b
(1) 1075/     4E1 : 5F                  		ld	e,a
(1) 1076/     4E2 : 7A                  		ld	a,d
(1) 1077/     4E3 : CF                  		rst	8
(1) 1078/     4E4 : E6 03               		and	00000011b	; * 40h
(1) 1079/     4E6 : 57                  		ld	d,a
(1) 1080/     4E7 : 21 29 14            		ld	hl,nikona_SetMstrList
(1) 1081/     4EA : 23                  		inc	hl
(1) 1082/     4EB : 7E                  		ld	a,(hl)
(1) 1083/     4EC : 23                  		inc	hl
(1) 1084/     4ED : 4E                  		ld	c,(hl)
(1) 1085/     4EE : 23                  		inc	hl
(1) 1086/     4EF : 6E                  		ld	l,(hl)
(1) 1087/     4F0 : CF                  		rst	8
(1) 1088/     4F1 : 61                  		ld	h,c
(1) 1089/     4F2 : 19                  		add	hl,de
(1) 1090/     4F3 : CE 00               		adc	a,0
(1) 1091/     4F5 : 11 B7 16            		ld	de,trkListCach
(1) 1092/     4F8 : 01 40 00            		ld	bc,4*10h
(1) 1093/     4FB : C3 C8 0E            		jp	transferRom	; *** ROM ACCESS ***
(1) 1094/     4FE :                     
(1) 1095/     4FE :                     ; ============================================================
(1) 1096/     4FE :                     ; --------------------------------------------------------
(1) 1097/     4FE :                     ; Convert notes to soundchips
(1) 1098/     4FE :                     ; --------------------------------------------------------
(1) 1099/     4FE :                     
(1) 1100/     4FE :                     set_chips:
(1) 1101/     4FE : E7                  		rst	20h			; Refill wave
(1) 1102/     4FF : CD 87 0E            		call	get_tick
(1) 1103/     502 : FD 21 F7 13         		ld	iy,nikona_BuffList
(1) 1104/     506 :                     .trk_buffrs:
(1) 1105/     506 : CF                  		rst	8
(1) 1106/     507 : FD 7E 00            		ld	a,(iy)
(1) 1107/     50A : FE FF               		cp	-1
(1) 1108/     50C : 28 15               		jr	z,proc_chips
(1) 1109/     50E : FD E5               		push	iy
(1) 1110/     510 : FD 6E 00            		ld	l,(iy)
(1) 1111/     513 : FD 66 01            		ld	h,(iy+1)
(1) 1112/     516 : CD 43 05            		call	tblbuff_read
(1) 1113/     519 : CF                  		rst	8
(1) 1114/     51A : FD E1               		pop	iy
(1) 1115/     51C : 11 10 00            		ld	de,10h
(1) 1116/     51F : FD 19               		add	iy,de
(1) 1117/     521 : 18 E3               		jr	.trk_buffrs
(1) 1118/     523 :                     proc_chips:
(1) 1119/     523 : E7                  		rst	20h
(1) 1120/     524 : FD 21 6F 14         		ld	iy,tblPSGN		; PSG Noise (FIRST)
(1) 1121/     528 : CD E6 06            		call	dtbl_singl
(1) 1122/     52B : 00                  		nop
(1) 1123/     52C : 00                  		nop
(1) 1124/     52D : FD 21 3D 14         		ld	iy,tblPSG		; PSG Squares
(1) 1125/     531 : CD D0 06            		call	dtbl_multi
(1) 1126/     534 : FD 21 7F 14         		ld	iy,tblFM
(1) 1127/     538 : CD D0 06            		call	dtbl_multi
(1) 1128/     53B : FD 21 E1 14         		ld	iy,tblPWM
(1) 1129/     53F : CD D0 06            		call	dtbl_multi
(1) 1130/     542 : C9                  		ret
(1) 1131/     543 :                     
(1) 1132/     543 :                     ; ----------------------------------------
(1) 1133/     543 :                     ; Read current track
(1) 1134/     543 :                     tblbuff_read:
(1) 1135/     543 : E5                  		push	hl
(1) 1136/     544 : FD E1               		pop	iy
(1) 1137/     546 : FD 46 00            		ld	b,(iy+trk_status)	; bit7: Track active?
(1) 1138/     549 : CB 78               		bit	7,b
(1) 1139/     54B : C8                  		ret	z
(1) 1140/     54C :                     ; 		ret
(1) 1141/     54C :                     ; .go_read:
(1) 1142/     54C : 78                  		ld	a,b			; trk_Status == -1?
(1) 1143/     54D : FE FF               		cp	-1
(1) 1144/     54F : C2 59 05            		jp	nz,.track_cont
(1) 1145/     552 : CD 93 04            		call	track_out
(1) 1146/     555 : FD 36 00 00         		ld	(iy+trk_Status),0
(1) 1147/     559 :                     .track_cont:
(1) 1148/     559 : CF                  		rst	8
(1) 1149/     55A : FD 6E 26            		ld	l,(iy+trk_ChnList)
(1) 1150/     55D : FD 66 27            		ld	h,(iy+(trk_ChnList+1))
(1) 1151/     560 : E5                  		push	hl
(1) 1152/     561 : DD E1               		pop	ix			; iy - channel list
(1) 1153/     563 : FD 46 1C            		ld	b,(iy+trk_MaxChnls)	;MAX_TRKCHN
(1) 1154/     566 :                     
(1) 1155/     566 :                     ; ** Needs special delays to
(1) 1156/     566 :                     ; keep the samplerate
(1) 1157/     566 :                     .next_chnl:
(1) 1158/     566 : C5                  		push	bc
(1) 1159/     567 : DD 7E 00            		ld	a,(ix)			; ** chnl_Flags
(1) 1160/     56A : E6 0F               		and	00001111b
(1) 1161/     56C : C4 79 05            		call	nz,.do_chip
(1) 1162/     56F : C1                  		pop	bc
(1) 1163/     570 : 11 08 00            		ld	de,8
(1) 1164/     573 : DD 19               		add	ix,de
(1) 1165/     575 : CF                  		rst	8	; wave sync
(1) 1166/     576 : 10 EE               		djnz	.next_chnl
(1) 1167/     578 : C9                  		ret
(1) 1168/     579 :                     
(1) 1169/     579 :                     ; ----------------------------------------
(1) 1170/     579 :                     ; iy - Track buffer
(1) 1171/     579 :                     ; ix - Current channel
(1) 1172/     579 :                     
(1) 1173/     579 :                     .do_chip:
(1) 1174/     579 : DD 7E 03            		ld	a,(ix+chnl_Ins)		; Check intrument type FIRST
(1) 1175/     57C : B7                  		or	a
(1) 1176/     57D : C8                  		ret	z
(1) 1177/     57E : FD 56 1F            		ld	d,(iy+trk_MaxIns)
(1) 1178/     581 : BA                  		cp	d
(1) 1179/     582 : C8                  		ret	z
(1) 1180/     583 : D0                  		ret	nc
(1) 1181/     584 : 3D                  		dec	a			; ins-1
(1) 1182/     585 : 0F                  		rrca				; * 08h
(1) 1183/     586 : 0F                  		rrca
(1) 1184/     587 : 0F                  		rrca
(1) 1185/     588 : 0F                  		rrca
(1) 1186/     589 : CF                  		rst	8
(1) 1187/     58A : 0F                  		rrca
(1) 1188/     58B : 57                  		ld	d,a
(1) 1189/     58C : E6 F8               		and	11111000b
(1) 1190/     58E : 5F                  		ld	e,a
(1) 1191/     58F : 7A                  		ld	a,d
(1) 1192/     590 : E6 07               		and	00000111b
(1) 1193/     592 : 57                  		ld	d,a
(1) 1194/     593 : FD 6E 08            		ld	l,(iy+trk_Instr)	; hl - Intrument data
(1) 1195/     596 : FD 66 09            		ld	h,(iy+(trk_Instr+1))
(1) 1196/     599 : 7B                  		ld	a,e
(1) 1197/     59A : 19                  		add	hl,de
(1) 1198/     59B : CF                  		rst	8
(1) 1199/     59C : E5                  		push	hl			; <-- save ins pos
(1) 1200/     59D : CD AF 05            		call	.grab_link
(1) 1201/     5A0 : D1                  		pop	de			; --> recover as de
(1) 1202/     5A1 : FE FF               		cp	-1			; Found any link?
(1) 1203/     5A3 : C8                  		ret	z
(1) 1204/     5A4 : FD 7E 14            		ld	a,(iy+trk_Priority)	; a - Set priority level
(1) 1205/     5A7 : 23                  		inc	hl			; Skip link
(1) 1206/     5A8 : 23                  		inc	hl
(1) 1207/     5A9 : 77                  		ld	(hl),a			; Write priority
(1) 1208/     5AA : 23                  		inc	hl
(1) 1209/     5AB : 73                  		ld	(hl),e			; Write Instrument pointer
(1) 1210/     5AC : 23                  		inc	hl
(1) 1211/     5AD : 72                  		ld	(hl),d
(1) 1212/     5AE : C9                  		ret
(1) 1213/     5AF :                     
(1) 1214/     5AF :                     ; ----------------------------------------
(1) 1215/     5AF :                     ; Search for a linked channel on the
(1) 1216/     5AF :                     ; chip table
(1) 1217/     5AF :                     ;
(1) 1218/     5AF :                     ; Input:
(1) 1219/     5AF :                     ; iy - Track buffer
(1) 1220/     5AF :                     ; ix - Current channel
(1) 1221/     5AF :                     ; hl - Intrument position
(1) 1222/     5AF :                     ;
(1) 1223/     5AF :                     ; Returns:
(1) 1224/     5AF :                     ; hl - Channel table to use
(1) 1225/     5AF :                     ;  a - Return value:
(1) 1226/     5AF :                     ;       0 - Found
(1) 1227/     5AF :                     ;      -1 - Not found
(1) 1228/     5AF :                     ; ----------------------------------------
(1) 1229/     5AF :                     
(1) 1230/     5AF :                     .grab_link:
(1) 1231/     5AF : 7E                  		ld	a,(hl)			; Check INSTRUMENT type
(1) 1232/     5B0 : E6 F0               		and	11110000b		; Filter 0F0h
(1) 1233/     5B2 : F2 9B 06            		jp	p,.set_asfull		; Set -1 if non-minus.
(1) 1234/     5B5 : 5F                  		ld	e,a			; Save NEW chip to e
(1) 1235/     5B6 : CF                  		rst	8
(1) 1236/     5B7 : DD 7E 01            		ld	a,(ix+chnl_Chip)	; a - check OUR chip
(1) 1237/     5BA : E6 F0               		and	11110000b		; Filter bits too.
(1) 1238/     5BC : CA 33 06            		jp	z,.new_chip		; If zero: Set NEW chip
(1) 1239/     5BF : BB                  		cp 	e
(1) 1240/     5C0 : CA D6 05            		jp	z,.srch_link		; If same: Grab our link
(1) 1241/     5C3 : 57                  		ld	d,a			; d - OLD chip
(1) 1242/     5C4 : D5                  		push	de
(1) 1243/     5C5 : CD D6 05            		call	.srch_link		; Search our link (first)
(1) 1244/     5C8 : D1                  		pop	de
(1) 1245/     5C9 : FE FF               		cp	-1
(1) 1246/     5CB : C8                  		ret	z
(1) 1247/     5CC : CD B8 06            		call	.reset_link
(1) 1248/     5CF : DD 36 01 00         		ld	(ix+chnl_Chip),0
(1) 1249/     5D3 : C3 32 06            		jp	.do_newchip
(1) 1250/     5D6 :                     
(1) 1251/     5D6 :                     ; ** RELINK **
(1) 1252/     5D6 :                     ; e - Our current chip
(1) 1253/     5D6 :                     .srch_link:
(1) 1254/     5D6 : CD 9E 06            		call	.pick_tbl	; Pick our table
(1) 1255/     5D9 : B7                  		or	a
(1) 1256/     5DA : FA 1F 06            		jp	m,.singl_link
(1) 1257/     5DD : DD E5               		push	ix		; copy ix to bc
(1) 1258/     5DF : C1                  		pop	bc
(1) 1259/     5E0 :                     .srch_lloop:
(1) 1260/     5E0 : CF                  		rst	8
(1) 1261/     5E1 : 7E                  		ld	a,(hl)		; Read LSB
(1) 1262/     5E2 : FE FF               		cp	-1		; If -1, return -1
(1) 1263/     5E4 : 28 49               		jr	z,.refill
(1) 1264/     5E6 : B9                  		cp	c
(1) 1265/     5E7 : 20 07               		jr	nz,.invldl
(1) 1266/     5E9 : 23                  		inc	hl
(1) 1267/     5EA : CF                  		rst	8
(1) 1268/     5EB : 7E                  		ld	a,(hl)
(1) 1269/     5EC : 2B                  		dec	hl
(1) 1270/     5ED : B8                  		cp	b
(1) 1271/     5EE : 28 09               		jr	z,.reroll
(1) 1272/     5F0 :                     .invldl:
(1) 1273/     5F0 : D5                  		push	de
(1) 1274/     5F1 : 11 10 00            		ld	de,MAX_TBLSIZE
(1) 1275/     5F4 : CF                  		rst	8
(1) 1276/     5F5 : 19                  		add	hl,de
(1) 1277/     5F6 : D1                  		pop	de
(1) 1278/     5F7 : 18 E7               		jr	.srch_lloop
(1) 1279/     5F9 :                     .reroll:
(1) 1280/     5F9 :                     	; *** Special re-roll check ***
(1) 1281/     5F9 : E5                  		push	hl
(1) 1282/     5FA : 01 05 00            		ld	bc,5		; <-- fake "iy+05h"
(1) 1283/     5FD : 09                  		add	hl,bc
(1) 1284/     5FE : 4E                  		ld	c,(hl)		; c - ID
(1) 1285/     5FF : E1                  		pop	hl
(1) 1286/     600 : 7B                  		ld	a,e
(1) 1287/     601 : FE 80               		cp	80h		; PSG?
(1) 1288/     603 : 28 02               		jr	z,.chk_psg
(1) 1289/     605 :                     ; 		cp	0A0h		; FM normal?
(1) 1290/     605 :                     ; 		jr	z,.chk_fm
(1) 1291/     605 : 18 26               		jr	.rnot_psg
(1) 1292/     607 :                     .chk_psg:
(1) 1293/     607 : 3A 06 17            		ld	a,(psgHatMode)
(1) 1294/     60A : E6 03               		and	011b
(1) 1295/     60C : FE 03               		cp	011b
(1) 1296/     60E : 20 1D               		jr	nz,.rnot_psg
(1) 1297/     610 : 79                  		ld	a,c
(1) 1298/     611 : FE 02               		cp	2
(1) 1299/     613 : 20 18               		jr	nz,.rnot_psg
(1) 1300/     615 : CF                  		rst	8
(1) 1301/     616 : 16 80               		ld	d,80h		; Set PSG silence
(1) 1302/     618 : CD B8 06            		call	.reset_link	; on PSG3
(1) 1303/     61B : C3 9B 06            		jp	.set_asfull
(1) 1304/     61E : 00                  		nop
(1) 1305/     61F :                     
(1) 1306/     61F :                     ; ----------------------
(1) 1307/     61F :                     ; PSGN/FM3/FM6
(1) 1308/     61F :                     .singl_link:
(1) 1309/     61F : DD E5               		push	ix			; copy ix to bc
(1) 1310/     621 : C1                  		pop	bc
(1) 1311/     622 : 23                  		inc	hl			; Read MSB first
(1) 1312/     623 : CF                  		rst	8
(1) 1313/     624 : 7E                  		ld	a,(hl)
(1) 1314/     625 : 2B                  		dec	hl
(1) 1315/     626 : B8                  		cp	b			; MSB match?
(1) 1316/     627 : 20 06               		jr	nz,.refill
(1) 1317/     629 : 7E                  		ld	a,(hl)			; Read LSB
(1) 1318/     62A : B9                  		cp	c
(1) 1319/     62B : 20 02               		jr	nz,.refill
(1) 1320/     62D :                     
(1) 1321/     62D :                     ; ----------------------
(1) 1322/     62D :                     
(1) 1323/     62D :                     .rnot_psg:
(1) 1324/     62D : AF                  		xor	a
(1) 1325/     62E : C9                  		ret
(1) 1326/     62F :                     ; ***
(1) 1327/     62F :                     .refill:
(1) 1328/     62F : DD 5E 01            		ld	e,(ix+chnl_Chip)
(1) 1329/     632 :                     .do_newchip:
(1) 1330/     632 : 7B                  		ld	a,e
(1) 1331/     633 :                     
(1) 1332/     633 :                     ; *** NEW CHIP ***
(1) 1333/     633 :                     ; e - Chip to set
(1) 1334/     633 :                     .new_chip:
(1) 1335/     633 : 7B                  		ld	a,e			; Read NEW chip
(1) 1336/     634 : B7                  		or	a			; If non-minus, exit.
(1) 1337/     635 : F0                  		ret	p
(1) 1338/     636 : CD 9E 06            		call	.pick_tbl
(1) 1339/     639 : CF                  		rst	8
(1) 1340/     63A : FD 4E 14            		ld	c,(iy+trk_Priority)	; c - OUR priority level
(1) 1341/     63D : B7                  		or	a
(1) 1342/     63E : FA 89 06            		jp	m,.singl_free
(1) 1343/     641 : E5                  		push	hl			; Backup START table
(1) 1344/     642 :                     ; PASS 1
(1) 1345/     642 :                     .srch_free:
(1) 1346/     642 : 7E                  		ld	a,(hl)			; Read LSB
(1) 1347/     643 : FE FF               		cp	-1			; If -1, return -1
(1) 1348/     645 : 28 0C               		jr	z,.pass_2
(1) 1349/     647 : 23                  		inc	hl
(1) 1350/     648 : 46                  		ld	b,(hl)			; Read MSB
(1) 1351/     649 : CF                  		rst	8
(1) 1352/     64A : 2B                  		dec	hl
(1) 1353/     64B : B0                  		or	b
(1) 1354/     64C : 28 26               		jr	z,.new_link_z
(1) 1355/     64E : CD 6A 06            		call	.nextsrch_tbl
(1) 1356/     651 : 18 EF               		jr	.srch_free
(1) 1357/     653 :                     ; PASS 2
(1) 1358/     653 :                     .pass_2:
(1) 1359/     653 : CF                  		rst	8
(1) 1360/     654 : E1                  		pop	hl
(1) 1361/     655 :                     .next_prio:
(1) 1362/     655 : 7E                  		ld	a,(hl)		; Read LSB
(1) 1363/     656 : FE FF               		cp	-1		; If -1, return -1
(1) 1364/     658 : C8                  		ret	z
(1) 1365/     659 : 23                  		inc	hl
(1) 1366/     65A : 23                  		inc	hl
(1) 1367/     65B : 7E                  		ld	a,(hl)
(1) 1368/     65C : 2B                  		dec	hl
(1) 1369/     65D : 2B                  		dec	hl
(1) 1370/     65E : B9                  		cp	c
(1) 1371/     65F : 38 17               		jr	c,.new_link_o
(1) 1372/     661 : B7                  		or	a
(1) 1373/     662 : 28 14               		jr	z,.new_link
(1) 1374/     664 : CF                  		rst	8
(1) 1375/     665 : CD 6A 06            		call	.nextsrch_tbl
(1) 1376/     668 : 18 EB               		jr	.next_prio
(1) 1377/     66A :                     
(1) 1378/     66A :                     .nextsrch_tbl:
(1) 1379/     66A : D5                  		push	de
(1) 1380/     66B : 11 10 00            		ld	de,MAX_TBLSIZE
(1) 1381/     66E : 19                  		add	hl,de
(1) 1382/     66F : D1                  		pop	de
(1) 1383/     670 : CF                  		rst	8
(1) 1384/     671 : 00                  		nop	; wave sync
(1) 1385/     672 : 00                  		nop
(1) 1386/     673 : C9                  		ret
(1) 1387/     674 :                     .new_link_z:
(1) 1388/     674 : 33                  		inc	sp		; skip backup
(1) 1389/     675 : 33                  		inc	sp
(1) 1390/     676 : 18 00               		jr	.new_link
(1) 1391/     678 :                     
(1) 1392/     678 :                     ; OVERWRITE link
(1) 1393/     678 :                     .new_link_o:
(1) 1394/     678 :                     
(1) 1395/     678 :                     ; NEW link
(1) 1396/     678 :                     .new_link:
(1) 1397/     678 : CF                  		rst	8
(1) 1398/     679 : 23                  		inc	hl
(1) 1399/     67A : 23                  		inc	hl
(1) 1400/     67B :                     ; hl+2
(1) 1401/     67B :                     .l_hiprio:
(1) 1402/     67B : DD 73 01            		ld	(ix+chnl_Chip),e
(1) 1403/     67E : DD E5               		push	ix
(1) 1404/     680 : D1                  		pop	de
(1) 1405/     681 : CF                  		rst	8
(1) 1406/     682 : 71                  		ld	(hl),c		; write priority
(1) 1407/     683 : 2B                  		dec	hl		; -1
(1) 1408/     684 : 72                  		ld 	(hl),d		; MSB
(1) 1409/     685 : 2B                  		dec	hl
(1) 1410/     686 : 73                  		ld	(hl),e		; LSB
(1) 1411/     687 : AF                  		xor	a
(1) 1412/     688 : C9                  		ret
(1) 1413/     689 :                     ; Single slot
(1) 1414/     689 :                     .singl_free:
(1) 1415/     689 : CF                  		rst	8
(1) 1416/     68A : 46                  		ld	b,(hl)
(1) 1417/     68B : 23                  		inc	hl
(1) 1418/     68C : 7E                  		ld	a,(hl)
(1) 1419/     68D : 23                  		inc	hl
(1) 1420/     68E : B0                  		or	b
(1) 1421/     68F : 28 EA               		jr	z,.l_hiprio
(1) 1422/     691 : 7E                  		ld	a,(hl)
(1) 1423/     692 : B9                  		cp	c
(1) 1424/     693 : 28 E6               		jr	z,.l_hiprio
(1) 1425/     695 : 38 E4               		jr	c,.l_hiprio		; PRIORITY
(1) 1426/     697 : B7                  		or	a
(1) 1427/     698 : 28 E1               		jr	z,.l_hiprio
(1) 1428/     69A :                     .sngl_sprio:
(1) 1429/     69A : CF                  		rst	8
(1) 1430/     69B :                     
(1) 1431/     69B :                     ; Set "can't use" table flag
(1) 1432/     69B :                     .set_asfull:
(1) 1433/     69B : 3E FF               		ld	a,-1
(1) 1434/     69D : C9                  		ret
(1) 1435/     69E :                     
(1) 1436/     69E :                     ; Pick chip table
(1) 1437/     69E :                     ; In:
(1) 1438/     69E :                     ;  e - ID
(1) 1439/     69E :                     ;
(1) 1440/     69E :                     ; Out:
(1) 1441/     69E :                     ; hl - Table
(1) 1442/     69E :                     .pick_tbl:
(1) 1443/     69E : D5                  		push	de
(1) 1444/     69F : 0F                  		rrca
(1) 1445/     6A0 : 0F                  		rrca
(1) 1446/     6A1 : 0F                  		rrca
(1) 1447/     6A2 : 0F                  		rrca
(1) 1448/     6A3 : E6 07               		and	00000111b
(1) 1449/     6A5 : 87                  		add	a,a
(1) 1450/     6A6 : 21 2D 14            		ld	hl,tblList
(1) 1451/     6A9 : E5                  		push	hl
(1) 1452/     6AA : 16 00               		ld	d,0
(1) 1453/     6AC : 5F                  		ld	e,a
(1) 1454/     6AD : 19                  		add	hl,de
(1) 1455/     6AE : 5E                  		ld	e,(hl)
(1) 1456/     6AF : 23                  		inc	hl
(1) 1457/     6B0 : 7E                  		ld	a,(hl)
(1) 1458/     6B1 : 57                  		ld	d,a
(1) 1459/     6B2 : CB BA               		res	7,d
(1) 1460/     6B4 : E1                  		pop	hl
(1) 1461/     6B5 : 19                  		add	hl,de
(1) 1462/     6B6 : D1                  		pop	de
(1) 1463/     6B7 : C9                  		ret
(1) 1464/     6B8 :                     
(1) 1465/     6B8 :                     ; d - Silence chip
(1) 1466/     6B8 :                     ;
(1) 1467/     6B8 :                     ; Uses:
(1) 1468/     6B8 :                     ; bc
(1) 1469/     6B8 :                     .reset_link:
(1) 1470/     6B8 : CF                  		rst	8
(1) 1471/     6B9 : 36 00               		ld	(hl),0			; Delete link
(1) 1472/     6BB : 23                  		inc	hl
(1) 1473/     6BC : 36 00               		ld	(hl),0
(1) 1474/     6BE : 23                  		inc	hl
(1) 1475/     6BF : 72                  		ld	(hl),d			; Set "silence" chip ID.
(1) 1476/     6C0 : 01 06 00            		ld	bc,8-2			; Go to 08h
(1) 1477/     6C3 : 09                  		add	hl,bc
(1) 1478/     6C4 : 06 04               		ld	b,8/2
(1) 1479/     6C6 :                     .clrfull:
(1) 1480/     6C6 : 36 00               		ld	(hl),0			; Reset settings 08-0Bh
(1) 1481/     6C8 : 23                  		inc	hl
(1) 1482/     6C9 : 36 00               		ld	(hl),0
(1) 1483/     6CB : 23                  		inc	hl
(1) 1484/     6CC : CF                  		rst	8
(1) 1485/     6CD : 10 F7               		djnz	.clrfull
(1) 1486/     6CF : C9                  		ret
(1) 1487/     6D0 :                     
(1) 1488/     6D0 :                     ; ============================================
(1) 1489/     6D0 :                     ; ----------------------------------------
(1) 1490/     6D0 :                     ; Process chip using it's table
(1) 1491/     6D0 :                     ;
(1) 1492/     6D0 :                     ; iy - table to read
(1) 1493/     6D0 :                     ;  c - Chip ID
(1) 1494/     6D0 :                     ; ----------------------------------------
(1) 1495/     6D0 :                     
(1) 1496/     6D0 :                     dtbl_multi:
(1) 1497/     6D0 : FD 7E 00            		ld	a,(iy)
(1) 1498/     6D3 : FE FF               		cp	-1
(1) 1499/     6D5 : C8                  		ret	z
(1) 1500/     6D6 : CD E7 06            		call	dtbl_frommul
(1) 1501/     6D9 : CF                  		rst	8
(1) 1502/     6DA : 11 10 00            		ld	de,MAX_TBLSIZE
(1) 1503/     6DD : FD 19               		add	iy,de
(1) 1504/     6DF : 00                  		nop	; WAVE SYNC
(1) 1505/     6E0 : 00                  		nop
(1) 1506/     6E1 : 00                  		nop
(1) 1507/     6E2 : 00                  		nop
(1) 1508/     6E3 : CF                  		rst	8
(1) 1509/     6E4 : 18 EA               		jr	dtbl_multi
(1) 1510/     6E6 :                     dtbl_singl:
(1) 1511/     6E6 : CF                  		rst	8
(1) 1512/     6E7 :                     
(1) 1513/     6E7 :                     dtbl_frommul:
(1) 1514/     6E7 : FD 5E 00            		ld	e,(iy)
(1) 1515/     6EA : FD 56 01            		ld	d,(iy+1)
(1) 1516/     6ED : 7A                  		ld	a,d
(1) 1517/     6EE : B3                  		or	e
(1) 1518/     6EF : 20 53               		jr	nz,.linked
(1) 1519/     6F1 : FD 7E 02            		ld	a,(iy+2)	; Any 80h+ Flag?
(1) 1520/     6F4 : B7                  		or	a
(1) 1521/     6F5 : F0                  		ret	p
(1) 1522/     6F6 : FD 7E 02            		ld	a,(iy+2)	; a - chip type
(1) 1523/     6F9 : CF                  		rst	8
(1) 1524/     6FA : FD 36 02 00         		ld	(iy+2),0	; Reset priority
(1) 1525/     6FE :                     
(1) 1526/     6FE :                     ; ----------------------------------------
(1) 1527/     6FE :                     ; chip-silence request
(1) 1528/     6FE :                     ; iy - Table
(1) 1529/     6FE : E6 F0               		and	11110000b
(1) 1530/     700 : FE 80               		cp	80h
(1) 1531/     702 : 28 1A               		jr	z,.siln_psg
(1) 1532/     704 : FE 90               		cp	90h
(1) 1533/     706 : 28 12               		jr	z,.siln_psg_n
(1) 1534/     708 : FE A0               		cp	0A0h
(1) 1535/     70A : 28 1C               		jr	z,.siln_fm
(1) 1536/     70C : FE B0               		cp	0B0h
(1) 1537/     70E : 28 18               		jr	z,.siln_fm
(1) 1538/     710 : CF                  		rst	8
(1) 1539/     711 : FE C0               		cp	0C0h
(1) 1540/     713 : 28 10               		jr	z,.siln_dac
(1) 1541/     715 : FE D0               		cp	0D0h
(1) 1542/     717 : 28 15               		jr	z,.siln_pwm
(1) 1543/     719 : C9                  		ret
(1) 1544/     71A :                     .siln_psg_n:
(1) 1545/     71A : AF                  		xor	a
(1) 1546/     71B : 32 06 17            		ld	(psgHatMode),a
(1) 1547/     71E :                     .siln_psg:
(1) 1548/     71E : CF                  		rst	8
(1) 1549/     71F : DD 21 7B 16         		ld	ix,psgcom
(1) 1550/     723 : 18 13               		jr	.rcyl_com
(1) 1551/     725 :                     
(1) 1552/     725 :                     ; --------------------------------
(1) 1553/     725 :                     
(1) 1554/     725 :                     .siln_dac:
(1) 1555/     725 : CD E0 10            		call	dac_off
(1) 1556/     728 :                     .siln_fm:
(1) 1557/     728 : CD D1 0C            		call	.fm_keyoff
(1) 1558/     72B : C3 D9 0C            		jp	.fm_tloff
(1) 1559/     72E :                     
(1) 1560/     72E :                     ; --------------------------------
(1) 1561/     72E :                     
(1) 1562/     72E :                     .siln_pwm:
(1) 1563/     72E : 3E 01               		ld	a,1
(1) 1564/     730 : 32 3F 00            		ld	(marsUpd),a
(1) 1565/     733 : CF                  		rst	8
(1) 1566/     734 : DD 21 43 16         		ld	ix,pwmcom
(1) 1567/     738 :                     .rcyl_com:
(1) 1568/     738 : 06 00               		ld	b,0
(1) 1569/     73A : FD 4E 05            		ld	c,(iy+05h)
(1) 1570/     73D : DD 09               		add	ix,bc
(1) 1571/     73F : DD 36 00 04         		ld	(ix),100b
(1) 1572/     743 : C9                  		ret
(1) 1573/     744 :                     
(1) 1574/     744 :                     ; ----------------------------------------
(1) 1575/     744 :                     ; Process channel now
(1) 1576/     744 :                     ; iy - Table
(1) 1577/     744 :                     ; ix - Tracker channel
(1) 1578/     744 :                     .linked:
(1) 1579/     744 : 1A                  		ld	a,(de)		; ** chnl_Flags
(1) 1580/     745 : 47                  		ld	b,a		; b - flags to check
(1) 1581/     746 : E6 0F               		and	00001111b	; Filter flags
(1) 1582/     748 : C8                  		ret	z
(1) 1583/     749 : 78                  		ld	a,b
(1) 1584/     74A : E6 F0               		and	11110000b	; Keep OTHER bits
(1) 1585/     74C : 12                  		ld	(de),a		; ** clear chnl_Flags
(1) 1586/     74D : D5                  		push	de
(1) 1587/     74E : DD E1               		pop	ix
(1) 1588/     750 : FD 6E 03            		ld	l,(iy+03h)
(1) 1589/     753 : FD 66 04            		ld	h,(iy+04h)
(1) 1590/     756 :                     
(1) 1591/     756 :                     	;  b - Flags LR00evin (Eff|Vol|Ins|Note)
(1) 1592/     756 :                     	; iy - Our chip table
(1) 1593/     756 :                     	; ix - Track channel
(1) 1594/     756 :                     	; hl - Intrument data
(1) 1595/     756 : CB 40               		bit	0,b		; Note
(1) 1596/     758 : C4 63 0C            		call	nz,.note
(1) 1597/     75B : CB 48               		bit	1,b		; Intrument
(1) 1598/     75D : C4 ED 0A            		call	nz,.inst
(1) 1599/     760 : CF                  		rst	8
(1) 1600/     761 : CB 50               		bit	2,b		; Volume
(1) 1601/     763 : C4 E4 0A            		call	nz,.volu
(1) 1602/     766 : CB 58               		bit	3,b		; Effect
(1) 1603/     768 : C4 1F 0A            		call	nz,.effc
(1) 1604/     76B : 78                  		ld	a,b
(1) 1605/     76C : E6 0F               		and	00001111b
(1) 1606/     76E : C8                  		ret	z
(1) 1607/     76F : CF                  		rst	8
(1) 1608/     770 :                     
(1) 1609/     770 :                     ; ----------------------------------------
(1) 1610/     770 :                     ; Process channel now
(1) 1611/     770 :                     ;
(1) 1612/     770 :                     ; b - Note bits
(1) 1613/     770 :                     ; ----------------------------------------
(1) 1614/     770 :                     
(1) 1615/     770 : 7E                  		ld	a,(hl)
(1) 1616/     771 : E6 70               		and	01110000b	; <--
(1) 1617/     773 : 0F                  		rrca
(1) 1618/     774 : 0F                  		rrca
(1) 1619/     775 : 0F                  		rrca
(1) 1620/     776 : 16 00               		ld	d,0
(1) 1621/     778 : 5F                  		ld	e,a
(1) 1622/     779 : 21 82 07            		ld	hl,.mk_list
(1) 1623/     77C : 19                  		add	hl,de
(1) 1624/     77D : 7E                  		ld	a,(hl)
(1) 1625/     77E : 23                  		inc	hl
(1) 1626/     77F : 66                  		ld	h,(hl)
(1) 1627/     780 : 6F                  		ld	l,a
(1) 1628/     781 : E9                  		jp	(hl)
(1) 1629/     782 :                     ; --------------------------------
(1) 1630/     782 :                     .mk_list:
(1) 1631/     782 : B0 07               		dw .mk_psg
(1) 1632/     784 : 92 07               		dw .mk_psgn
(1) 1633/     786 : 26 08               		dw .mk_fm
(1) 1634/     788 : 98 08               		dw .mk_fmspc
(1) 1635/     78A : 1E 09               		dw .mk_dac
(1) 1636/     78C : 74 09               		dw .mk_pwm
(1) 1637/     78E : 00 00               		dw 0
(1) 1638/     790 : 00 00               		dw 0
(1) 1639/     792 :                     
(1) 1640/     792 :                     ; --------------------------------
(1) 1641/     792 :                     
(1) 1642/     792 :                     .mk_psgn:
(1) 1643/     792 : DD 7E 02            		ld	a,(ix+chnl_Note)
(1) 1644/     795 : DD E5               		push	ix
(1) 1645/     797 : DD 21 7E 16         		ld	ix,psgcom+3	; <-- direct ix point
(1) 1646/     79B : CF                  		rst	8
(1) 1647/     79C : FE FE               		cp	-2
(1) 1648/     79E : 28 76               		jr	z,.kycut_psgn
(1) 1649/     7A0 : FE FF               		cp	-1
(1) 1650/     7A2 : 28 62               		jr	z,.kyoff_psgn
(1) 1651/     7A4 : 5F                  		ld	e,a
(1) 1652/     7A5 : 3A 06 17            		ld	a,(psgHatMode)	; Tone 3?
(1) 1653/     7A8 : E6 03               		and	011b
(1) 1654/     7AA : FE 03               		cp	011b
(1) 1655/     7AC : 20 42               		jr	nz,.psg_keyon	; Normal
(1) 1656/     7AE : 18 19               		jr	.from_psgn	; Tone 3
(1) 1657/     7B0 :                     .mk_psg:
(1) 1658/     7B0 : CF                  		rst	8
(1) 1659/     7B1 : DD 7E 02            		ld	a,(ix+chnl_Note)
(1) 1660/     7B4 : DD E5               		push	ix
(1) 1661/     7B6 : DD 21 7B 16         		ld	ix,psgcom	; ix - psgcom
(1) 1662/     7BA : FD 5E 05            		ld	e,(iy+05h)
(1) 1663/     7BD : 16 00               		ld	d,0
(1) 1664/     7BF : DD 19               		add	ix,de
(1) 1665/     7C1 : FE FE               		cp	-2
(1) 1666/     7C3 : 28 56               		jr	z,.kycut_psg
(1) 1667/     7C5 : FE FF               		cp	-1
(1) 1668/     7C7 : 28 42               		jr	z,.kyoff_psg
(1) 1669/     7C9 :                     .from_psgn:
(1) 1670/     7C9 : CF                  		rst	8
(1) 1671/     7CA : 16 00               		ld	d,0		; de - note*2
(1) 1672/     7CC : FD 5E 06            		ld	e,(iy+06h)	; Freq index
(1) 1673/     7CF : 21 07 12            		ld	hl,psgFreq_List
(1) 1674/     7D2 : 19                  		add	hl,de
(1) 1675/     7D3 : 7E                  		ld	a,(hl)
(1) 1676/     7D4 : 23                  		inc	hl
(1) 1677/     7D5 : 66                  		ld	h,(hl)
(1) 1678/     7D6 : 6F                  		ld	l,a
(1) 1679/     7D7 : FD 7E 07            		ld	a,(iy+07h)	; pitchbend
(1) 1680/     7DA : 07                  		rlca			; << 3
(1) 1681/     7DB : 07                  		rlca
(1) 1682/     7DC : CF                  		rst	8
(1) 1683/     7DD : 07                  		rlca
(1) 1684/     7DE : 57                  		ld	d,a
(1) 1685/     7DF : E6 F8               		and	11111000b
(1) 1686/     7E1 : 5F                  		ld	e,a
(1) 1687/     7E2 : 7A                  		ld	a,d
(1) 1688/     7E3 : E6 07               		and	00000111b
(1) 1689/     7E5 : 57                  		ld	d,a
(1) 1690/     7E6 : 37                  		scf
(1) 1691/     7E7 : 3F                  		ccf
(1) 1692/     7E8 : ED 52               		sbc	hl,de
(1) 1693/     7EA : DD 75 1C            		ld	(ix+DTL),l
(1) 1694/     7ED : DD 74 20            		ld	(ix+DTH),h
(1) 1695/     7F0 :                     .psg_keyon:
(1) 1696/     7F0 : FD 7E 08            		ld	a,(iy+08h)	; Set volume
(1) 1697/     7F3 : ED 44               		neg	a
(1) 1698/     7F5 : CF                  		rst	8
(1) 1699/     7F6 : 87                  		add	a,a
(1) 1700/     7F7 : 87                  		add	a,a
(1) 1701/     7F8 : 30 02               		jr	nc,.vmuch
(1) 1702/     7FA : 3E FF               		ld	a,-1
(1) 1703/     7FC :                     .vmuch:
(1) 1704/     7FC : DD 77 30            		ld	(ix+PVOL),a
(1) 1705/     7FF : DD 36 00 01         		ld	(ix+COM),001b	; Key ON
(1) 1706/     803 : DD E1               		pop	ix
(1) 1707/     805 : C9                  		ret
(1) 1708/     806 :                     ; -1
(1) 1709/     806 :                     .kyoff_psgn:
(1) 1710/     806 : 3E 00               		ld	a,000b
(1) 1711/     808 : 32 06 17            		ld	(psgHatMode),a	; ** GLOBAL SETTING
(1) 1712/     80B :                     .kyoff_psg:
(1) 1713/     80B : CF                  		rst	8
(1) 1714/     80C : 0E 02               		ld	c,010b
(1) 1715/     80E : DD 71 00            		ld	(ix),c
(1) 1716/     811 : DD E1               		pop	ix
(1) 1717/     813 : C3 B5 0D            		jp	.chnl_ulnkoff
(1) 1718/     816 :                     ; -2
(1) 1719/     816 :                     .kycut_psgn:
(1) 1720/     816 : 3E 00               		ld	a,000b
(1) 1721/     818 : 32 06 17            		ld	(psgHatMode),a	; ** GLOBAL SETTING
(1) 1722/     81B :                     .kycut_psg:
(1) 1723/     81B : CF                  		rst	8
(1) 1724/     81C : 0E 04               		ld	c,100b
(1) 1725/     81E : DD 71 00            		ld	(ix),c
(1) 1726/     821 : DD E1               		pop	ix
(1) 1727/     823 : C3 C6 0D            		jp	.chnl_ulnkcut
(1) 1728/     826 :                     
(1) 1729/     826 :                     ; --------------------------------
(1) 1730/     826 :                     
(1) 1731/     826 :                     .mk_fm:
(1) 1732/     826 : DD 7E 02            		ld	a,(ix+chnl_Note)
(1) 1733/     829 : FE FE               		cp	-2
(1) 1734/     82B : CA 15 09            		jp	z,.fm_cut
(1) 1735/     82E : FE FF               		cp	-1
(1) 1736/     830 : CA 0F 09            		jp	z,.fm_off
(1) 1737/     833 :                     ; 		call	.fm_tloff
(1) 1738/     833 : CF                  		rst	8
(1) 1739/     834 : FD 4E 05            		ld	c,(iy+05h)	; c - KeyID
(1) 1740/     837 : 78                  		ld	a,b		; Note bit?
(1) 1741/     838 : E6 01               		and	0001b
(1) 1742/     83A : 28 1F               		jr	z,.nofm_note
(1) 1743/     83C : FD 46 05            		ld	b,(iy+05h)	; Check channel 3
(1) 1744/     83F : 78                  		ld	a,b
(1) 1745/     840 : FE 02               		cp	2
(1) 1746/     842 : 20 0B               		jr	nz,.not_dspc
(1) 1747/     844 : 11 00 27            		ld	de,2700h	; CH3 off
(1) 1748/     847 : CD B5 10            		call	fm_send_1
(1) 1749/     84A : 3E 00               		ld	a,0
(1) 1750/     84C : 32 07 17            		ld	(fmSpecial),a
(1) 1751/     84F :                     .not_dspc:
(1) 1752/     84F : 78                  		ld	a,b
(1) 1753/     850 : FE 06               		cp	6
(1) 1754/     852 : 20 04               		jr	nz,.not_dac
(1) 1755/     854 : CF                  		rst	8
(1) 1756/     855 : CD E0 10            		call	dac_off
(1) 1757/     858 :                     .not_dac:
(1) 1758/     858 : CD D1 0C            		call	.fm_keyoff
(1) 1759/     85B :                     .nofm_note:
(1) 1760/     85B : FD 7E 06            		ld	a,(iy+06h)
(1) 1761/     85E : 47                  		ld	b,a
(1) 1762/     85F : E6 1F               		and	00011111b
(1) 1763/     861 : 5F                  		ld	e,a
(1) 1764/     862 : 16 00               		ld	d,0
(1) 1765/     864 : 21 EF 11            		ld	hl,fmFreq_List
(1) 1766/     867 : 19                  		add	hl,de
(1) 1767/     868 : 7E                  		ld	a,(hl)
(1) 1768/     869 : CF                  		rst	8
(1) 1769/     86A : 23                  		inc	hl
(1) 1770/     86B : 66                  		ld	h,(hl)
(1) 1771/     86C : 6F                  		ld	l,a
(1) 1772/     86D : 78                  		ld	a,b
(1) 1773/     86E : E6 E0               		and	11100000b
(1) 1774/     870 : 0F                  		rrca
(1) 1775/     871 : 0F                  		rrca
(1) 1776/     872 : B4                  		or	h
(1) 1777/     873 : 67                  		ld	h,a
(1) 1778/     874 : FD 5E 07            		ld	e,(iy+07h)	; pitchbend
(1) 1779/     877 : CF                  		rst	8
(1) 1780/     878 : AF                  		xor	a		; Clear high
(1) 1781/     879 : 3F                  		ccf			; Clear carry
(1) 1782/     87A : CB 23               		sla	e		; << 2
(1) 1783/     87C : CB 23               		sla	e
(1) 1784/     87E : 9F                  		sbc	a,a		; -1 if carry is set
(1) 1785/     87F : 57                  		ld	d,a
(1) 1786/     880 : 19                  		add	hl,de
(1) 1787/     881 : CD F0 0C            		call	.fm_setfreq
(1) 1788/     884 :                     .fmspc_set:
(1) 1789/     884 : CD 81 0D            		call	.fm_wrtalpan	; Panning and effects
(1) 1790/     887 : CD 07 0D            		call	.fm_wrtlvol	; FM volume control
(1) 1794/     88A : FD 7E 0F            		ld	a,(iy+0Fh)	; 0Eh - keys
(1) 1795/     88D : E6 F0               		and	11110000b
(1) 1796/     88F : B1                  		or	c
(1) 1797/     890 : 5F                  		ld	e,a
(1) 1798/     891 : 16 28               		ld	d,28h
(1) 1799/     893 : CD B5 10            		call	fm_send_1
(1) 1800/     896 : CF                  		rst	8
(1) 1801/     897 : C9                  		ret
(1) 1803/     898 :                     
(1) 1804/     898 :                     ; --------------------------------
(1) 1805/     898 :                     
(1) 1806/     898 :                     .mk_fmspc:
(1) 1807/     898 : DD 7E 02            		ld	a,(ix+chnl_Note)
(1) 1808/     89B : FE FE               		cp	-2
(1) 1809/     89D : CA 15 09            		jp	z,.fm_cut
(1) 1810/     8A0 : FE FF               		cp	-1
(1) 1811/     8A2 : CA 0F 09            		jp	z,.fm_off
(1) 1812/     8A5 : FD 4E 05            		ld	c,(iy+05h)	; c - KeyID
(1) 1813/     8A8 : 78                  		ld	a,b
(1) 1814/     8A9 : E6 01               		and	0001b
(1) 1815/     8AB : 28 D7               		jr	z,.fmspc_set
(1) 1816/     8AD : CD D1 0C            		call	.fm_keyoff
(1) 1817/     8B0 : 21 E9 13            		ld	hl,fmcach_list	; Manual freqs
(1) 1818/     8B3 : FD 7E 05            		ld	a,(iy+05h)
(1) 1819/     8B6 : E6 07               		and	0111b
(1) 1820/     8B8 : 16 00               		ld	d,0
(1) 1821/     8BA : 87                  		add	a,a
(1) 1822/     8BB : 5F                  		ld	e,a
(1) 1823/     8BC : CF                  		rst	8
(1) 1824/     8BD : 19                  		add	hl,de
(1) 1825/     8BE : 7E                  		ld	a,(hl)
(1) 1826/     8BF : 23                  		inc	hl
(1) 1827/     8C0 : 66                  		ld	h,(hl)
(1) 1828/     8C1 : 6F                  		ld	l,a
(1) 1829/     8C2 : 11 20 00            		ld	de,20h		; point to regs
(1) 1830/     8C5 : 19                  		add	hl,de
(1) 1831/     8C6 : 16 AD               		ld	d,0ADh
(1) 1832/     8C8 : 5E                  		ld	e,(hl)
(1) 1833/     8C9 : CD B5 10            		call	fm_send_1
(1) 1834/     8CC : 23                  		inc	hl
(1) 1835/     8CD : 16 A9               		ld	d,0A9h
(1) 1836/     8CF : 5E                  		ld	e,(hl)
(1) 1837/     8D0 : CD B5 10            		call	fm_send_1
(1) 1838/     8D3 : 23                  		inc	hl
(1) 1839/     8D4 : CF                  		rst	8
(1) 1840/     8D5 : 16 AC               		ld	d,0ACh
(1) 1841/     8D7 : 5E                  		ld	e,(hl)
(1) 1842/     8D8 : CD B5 10            		call	fm_send_1
(1) 1843/     8DB : 23                  		inc	hl
(1) 1844/     8DC : 16 A8               		ld	d,0A8h
(1) 1845/     8DE : 5E                  		ld	e,(hl)
(1) 1846/     8DF : CD B5 10            		call	fm_send_1
(1) 1847/     8E2 : 23                  		inc	hl
(1) 1848/     8E3 : 16 AE               		ld	d,0AEh
(1) 1849/     8E5 : 5E                  		ld	e,(hl)
(1) 1850/     8E6 : CD B5 10            		call	fm_send_1
(1) 1851/     8E9 : 23                  		inc	hl
(1) 1852/     8EA : CF                  		rst	8
(1) 1853/     8EB : 16 AA               		ld	d,0AAh
(1) 1854/     8ED : 5E                  		ld	e,(hl)
(1) 1855/     8EE : CD B5 10            		call	fm_send_1
(1) 1856/     8F1 : 23                  		inc	hl
(1) 1857/     8F2 : 16 A6               		ld	d,0A6h
(1) 1858/     8F4 : 5E                  		ld	e,(hl)
(1) 1859/     8F5 : CD B5 10            		call	fm_send_1
(1) 1860/     8F8 : 23                  		inc	hl
(1) 1861/     8F9 : 16 A2               		ld	d,0A2h
(1) 1862/     8FB : 5E                  		ld	e,(hl)
(1) 1863/     8FC : CD B5 10            		call	fm_send_1
(1) 1864/     8FF : 23                  		inc	hl
(1) 1865/     900 : CF                  		rst	8
(1) 1866/     901 : 11 40 27            		ld	de,2740h	; CH3 on
(1) 1867/     904 : CD B5 10            		call	fm_send_1
(1) 1868/     907 : 3E 01               		ld	a,1
(1) 1869/     909 : 32 07 17            		ld	(fmSpecial),a
(1) 1870/     90C : C3 84 08            		jp	.fmspc_set
(1) 1871/     90F :                     
(1) 1872/     90F :                     ; --------------------------------
(1) 1873/     90F :                     
(1) 1874/     90F :                     .fm_off:
(1) 1875/     90F : CD D1 0C            		call	.fm_keyoff
(1) 1876/     912 : C3 B5 0D            		jp	.chnl_ulnkoff
(1) 1877/     915 :                     .fm_cut:
(1) 1878/     915 : CD D1 0C            		call	.fm_keyoff
(1) 1879/     918 : CD D9 0C            		call	.fm_tloff
(1) 1880/     91B : C3 C6 0D            		jp	.chnl_ulnkcut
(1) 1881/     91E :                     
(1) 1882/     91E :                     ; --------------------------------
(1) 1883/     91E :                     
(1) 1884/     91E :                     .mk_dac:
(1) 1885/     91E : DD 7E 02            		ld	a,(ix+chnl_Note)
(1) 1886/     921 : FE FE               		cp	-2
(1) 1887/     923 : CA 45 09            		jp	z,.dac_cut
(1) 1888/     926 : FE FF               		cp	-1
(1) 1889/     928 : CA 4B 09            		jp	z,.dac_off
(1) 1890/     92B : CD 4E 09            		call	.dac_pitch
(1) 1891/     92E : 78                  		ld	a,b		; Note ONLY?
(1) 1892/     92F : E6 01               		and	0001b
(1) 1893/     931 : C8                  		ret	z
(1) 1894/     932 : CD E0 10            		call	dac_off
(1) 1895/     935 : DD 7E 00            		ld	a,(ix+chnl_Flags)	; Read panning
(1) 1896/     938 : 2F                  		cpl				; REVERSE bits
(1) 1897/     939 : E6 C0               		and	11000000b
(1) 1898/     93B : 5F                  		ld	e,a
(1) 1899/     93C : 16 B6               		ld	d,0B6h		; Channel 6 panning
(1) 1900/     93E : CD C0 10            		call	fm_send_2
(1) 1901/     941 : CF                  		rst	8
(1) 1902/     942 : C3 F5 10            		jp	dac_play
(1) 1903/     945 :                     .dac_cut:
(1) 1904/     945 : CD E0 10            		call	dac_off
(1) 1905/     948 : C3 B5 0D            		jp	.chnl_ulnkoff
(1) 1906/     94B :                     .dac_off:
(1) 1907/     94B : C3 C6 0D            		jp	.chnl_ulnkcut
(1) 1908/     94E :                     
(1) 1909/     94E :                     
(1) 1910/     94E :                     .dac_pitch:
(1) 1911/     94E : 16 00               		ld	d,0		; Freq index
(1) 1912/     950 : FD 5E 06            		ld	e,(iy+06h)
(1) 1913/     953 : 21 F9 12            		ld	hl,wavFreq_List
(1) 1914/     956 : 19                  		add	hl,de
(1) 1915/     957 : 7E                  		ld	a,(hl)
(1) 1916/     958 : 23                  		inc	hl
(1) 1917/     959 : 66                  		ld	h,(hl)
(1) 1918/     95A : CF                  		rst	8
(1) 1919/     95B : 6F                  		ld	l,a
(1) 1920/     95C : FD 5E 07            		ld	e,(iy+07h)	; pitchbend
(1) 1921/     95F : AF                  		xor	a		; Clear high
(1) 1922/     960 : 3F                  		ccf			; Clear carry
(1) 1923/     961 : CB 23               		sla	e		; << 3
(1) 1924/     963 : CB 23               		sla	e
(1) 1925/     965 : CB 23               		sla	e
(1) 1926/     967 : 9F                  		sbc	a,a		; -1 if carry is set
(1) 1927/     968 : 57                  		ld	d,a
(1) 1928/     969 : 19                  		add	hl,de
(1) 1929/     96A : 22 00 17            		ld	(wave_Pitch),hl
(1) 1930/     96D : D9                  		exx			; *
(1) 1931/     96E : ED 5B 00 17         		ld	de,(wave_Pitch)	; *
(1) 1932/     972 : D9                  		exx			; *
(1) 1933/     973 : C9                  		ret
(1) 1934/     974 :                     
(1) 1935/     974 :                     ; --------------------------------
(1) 1936/     974 :                     
(1) 1937/     974 :                     .mk_pwm:
(1) 1938/     974 : DD 7E 02            		ld	a,(ix+chnl_Note)
(1) 1939/     977 : 16 00               		ld	d,0
(1) 1940/     979 : FD 5E 05            		ld	e,(iy+05h)
(1) 1941/     97C : DD 4E 00            		ld	c,(ix+chnl_Flags)	; c - Panning bits
(1) 1942/     97F : DD E5               		push	ix
(1) 1943/     981 : DD 21 43 16         		ld	ix,pwmcom
(1) 1944/     985 : DD 19               		add	ix,de
(1) 1945/     987 : FE FE               		cp	-2
(1) 1946/     989 : CA 10 0A            		jp	z,.pwm_cut
(1) 1947/     98C : FE FF               		cp	-1
(1) 1948/     98E : CA 01 0A            		jp	z,.pwm_off
(1) 1949/     991 : CF                  		rst	8
(1) 1950/     992 : 78                  		ld	a,b
(1) 1951/     993 : CB 40               		bit	0,b			; Note?
(1) 1952/     995 : 20 0E               		jr	nz,.pw_note
(1) 1953/     997 : CB 58               		bit	3,b			; Effect?
(1) 1954/     999 : 20 03               		jr	nz,.pw_effc
(1) 1955/     99B : DD E1               		pop	ix
(1) 1956/     99D : C9                  		ret
(1) 1957/     99E :                     
(1) 1958/     99E :                     ; --------------------------------
(1) 1959/     99E :                     
(1) 1960/     99E :                     .pw_effc:
(1) 1961/     99E : CD CE 09            		call	.pw_setup
(1) 1962/     9A1 : 0E 11               		ld	c,00010001b
(1) 1963/     9A3 : 18 05               		jr	.pw_send
(1) 1964/     9A5 :                     .pw_note:
(1) 1965/     9A5 : CD CE 09            		call	.pw_setup
(1) 1966/     9A8 : 0E 01               		ld	c,00000001b	; KeyON request
(1) 1967/     9AA :                     .pw_send:
(1) 1968/     9AA : DD 71 00            		ld	(ix),c
(1) 1969/     9AD : 01 08 00            		ld	bc,8
(1) 1970/     9B0 : DD 09               		add	ix,bc
(1) 1971/     9B2 : DD 77 00            		ld	(ix),a
(1) 1972/     9B5 : DD 09               		add	ix,bc
(1) 1973/     9B7 : DD 75 00            		ld	(ix),l
(1) 1974/     9BA : DD 09               		add	ix,bc
(1) 1975/     9BC : CF                  		rst	8
(1) 1976/     9BD : DD 7E 00            		ld	a,(ix)
(1) 1977/     9C0 : E6 CF               		and	11001111b
(1) 1978/     9C2 : B3                  		or	e
(1) 1979/     9C3 : DD 77 00            		ld	(ix),a
(1) 1981/     9C6 : 3E 01               		ld	a,1
(1) 1982/     9C8 : 32 3F 00            		ld	(marsUpd),a
(1) 1984/     9CB : DD E1               		pop	ix
(1) 1985/     9CD : C9                  		ret
(1) 1986/     9CE :                     .pw_setup:
(1) 1987/     9CE : 16 00               		ld	d,0		; Freq index
(1) 1988/     9D0 : FD 5E 06            		ld	e,(iy+06h)
(1) 1989/     9D3 : 21 F9 12            		ld	hl,wavFreq_List
(1) 1990/     9D6 : 19                  		add	hl,de
(1) 1991/     9D7 : 7E                  		ld	a,(hl)
(1) 1992/     9D8 : 23                  		inc	hl
(1) 1993/     9D9 : 66                  		ld	h,(hl)
(1) 1994/     9DA : 6F                  		ld	l,a
(1) 1995/     9DB : FD 5E 07            		ld	e,(iy+07h)	; pitchbend
(1) 1996/     9DE : AF                  		xor	a		; Clear high
(1) 1997/     9DF : 3F                  		ccf			; Clear carry
(1) 1998/     9E0 : CB 23               		sla	e		; << 2
(1) 1999/     9E2 : CB 23               		sla	e
(1) 2000/     9E4 : 9F                  		sbc	a,a		; -1 if carry is set
(1) 2001/     9E5 : 57                  		ld	d,a
(1) 2002/     9E6 : 19                  		add	hl,de
(1) 2003/     9E7 : CF                  		rst	8
(1) 2004/     9E8 : 79                  		ld	a,c
(1) 2005/     9E9 : 0F                  		rrca
(1) 2006/     9EA : 0F                  		rrca
(1) 2007/     9EB : 2F                  		cpl
(1) 2008/     9EC : E6 30               		and	00110000b
(1) 2009/     9EE : 5F                  		ld	e,a
(1) 2010/     9EF : AF                  		xor	a
(1) 2011/     9F0 : FD 7E 08            		ld	a,(iy+08h)	; Read volume
(1) 2012/     9F3 : ED 44               		neg	a
(1) 2013/     9F5 : CB 27               		sla	a
(1) 2014/     9F7 : CB 27               		sla	a
(1) 2015/     9F9 : 30 02               		jr	nc,.pwv_much
(1) 2016/     9FB : 3E FF               		ld	a,-1
(1) 2017/     9FD :                     .pwv_much:
(1) 2018/     9FD : E6 FC               		and	11111100b
(1) 2019/     9FF : B4                  		or	h		; Merge MSB freq
(1) 2020/     A00 : C9                  		ret
(1) 2021/     A01 :                     
(1) 2022/     A01 :                     ; --------------------------------
(1) 2023/     A01 :                     ; -1
(1) 2024/     A01 :                     .pwm_off:
(1) 2025/     A01 : CF                  		rst	8
(1) 2026/     A02 : DD 36 00 02         		ld	(ix),010b
(1) 2027/     A06 : 3E 01               		ld	a,1
(1) 2028/     A08 : 32 3F 00            		ld	(marsUpd),a
(1) 2029/     A0B : DD E1               		pop	ix
(1) 2030/     A0D : C3 B5 0D            		jp	.chnl_ulnkoff
(1) 2031/     A10 :                     ; -2
(1) 2032/     A10 :                     .pwm_cut:
(1) 2033/     A10 : CF                  		rst	8
(1) 2034/     A11 : DD 36 00 04         		ld	(ix),100b
(1) 2035/     A15 : 3E 01               		ld	a,1
(1) 2036/     A17 : 32 3F 00            		ld	(marsUpd),a
(1) 2037/     A1A : DD E1               		pop	ix
(1) 2038/     A1C : C3 C6 0D            		jp	.chnl_ulnkcut
(1) 2039/     A1F :                     
(1) 2040/     A1F :                     ; ----------------------------------------
(1) 2041/     A1F :                     ; NEW effect
(1) 2042/     A1F :                     ; ----------------------------------------
(1) 2043/     A1F :                     
(1) 2044/     A1F :                     .effc:
(1) 2045/     A1F : DD 5E 06            		ld	e,(ix+chnl_EffArg)	; e - effect data
(1) 2046/     A22 : DD 7E 05            		ld	a,(ix+chnl_EffId)	; d - effect id
(1) 2047/     A25 : 57                  		ld	d,a
(1) 2048/     A26 : CF                  		rst	8
(1) 2049/     A27 : FE 04               		cp	4			; Effect D?
(1) 2050/     A29 : 28 0F               		jr	z,.effc_D
(1) 2051/     A2B : FE 05               		cp	5			; Effect E?
(1) 2052/     A2D : 28 4E               		jr	z,.effc_E
(1) 2053/     A2F : FE 06               		cp	6			; Effect F?
(1) 2054/     A31 : 28 5F               		jr	z,.effc_F
(1) 2055/     A33 : CF                  		rst	8
(1) 2056/     A34 : FE 18               		cp	24			; Effect X?
(1) 2057/     A36 : CA B3 0A            		jp	z,.effc_X
(1) 2058/     A39 : C9                  		ret
(1) 2059/     A3A :                     
(1) 2060/     A3A :                     ; ----------------------------------------
(1) 2061/     A3A :                     ; Effect D
(1) 2062/     A3A :                     ;
(1) 2063/     A3A :                     ; Volume slide down
(1) 2064/     A3A :                     ;
(1) 2065/     A3A :                     ; 0xh-Exh - Normal
(1) 2066/     A3A :                     ; Fxh-Fxh - Fine slide / 2
(1) 2067/     A3A :                     
(1) 2068/     A3A :                     .effc_D:
(1) 2069/     A3A : CD A7 0A            		call	.save_arg
(1) 2070/     A3D : 79                  		ld	a,c		; Setting == 0?
(1) 2071/     A3E : B7                  		or	a
(1) 2072/     A3F : C8                  		ret	z
(1) 2073/     A40 : E6 F0               		and	0F0h
(1) 2074/     A42 : 28 0F               		jr	z,.norm_down	; 0xh
(1) 2075/     A44 : FE F0               		cp	0F0h
(1) 2076/     A46 : 28 0D               		jr	z,.fine_down	; Fxh
(1) 2077/     A48 : CF                  		rst	8
(1) 2078/     A49 : 79                  		ld	a,c
(1) 2079/     A4A : E6 0F               		and	00Fh
(1) 2080/     A4C : 28 1D               		jr	z,.norm_up	; x0h
(1) 2081/     A4E : FE 0F               		cp	00Fh
(1) 2082/     A50 : 28 17               		jr	z,.fine_up	; xFh
(1) 2083/     A52 : C9                  		ret
(1) 2084/     A53 :                     ; Go down
(1) 2085/     A53 :                     .norm_down:
(1) 2086/     A53 : CB 21               		sla	c
(1) 2087/     A55 :                     .fine_down:
(1) 2088/     A55 : CB 21               		sla	c
(1) 2089/     A57 : 79                  		ld	a,c
(1) 2090/     A58 : E6 3C               		and	00111100b
(1) 2091/     A5A : 4F                  		ld	c,a
(1) 2092/     A5B : FD 7E 08            		ld	a,(iy+08h)	; Current volume
(1) 2093/     A5E : CF                  		rst	8
(1) 2094/     A5F : 91                  		sub	a,c
(1) 2095/     A60 : 1E C0               		ld	e,0C0h
(1) 2096/     A62 : BB                  		cp	e
(1) 2097/     A63 : D2 79 0A            		jp	nc,.vol_dvld
(1) 2098/     A66 : 7B                  		ld	a,e
(1) 2099/     A67 : 18 10               		jr 	.vol_dvld
(1) 2100/     A69 :                     ; Go up
(1) 2101/     A69 :                     .fine_up:
(1) 2102/     A69 : CB 39               		srl	c
(1) 2103/     A6B :                     .norm_up:
(1) 2104/     A6B : CB 39               		srl	c
(1) 2105/     A6D : 79                  		ld	a,c
(1) 2106/     A6E : E6 3C               		and	00111100b
(1) 2107/     A70 : 4F                  		ld	c,a
(1) 2108/     A71 : FD 7E 08            		ld	a,(iy+08h)	; Current volume
(1) 2109/     A74 : CF                  		rst	8
(1) 2110/     A75 : 81                  		add	a,c
(1) 2111/     A76 : 38 01               		jr	c,.vol_dvld
(1) 2112/     A78 : AF                  		xor	a
(1) 2113/     A79 :                     .vol_dvld:
(1) 2114/     A79 : FD 77 08            		ld	(iy+08h),a
(1) 2115/     A7C : C9                  		ret
(1) 2116/     A7D :                     
(1) 2117/     A7D :                     ; ----------------------------------------
(1) 2118/     A7D :                     ; Effect E
(1) 2119/     A7D :                     .effc_E:
(1) 2120/     A7D : CD A7 0A            		call	.save_arg
(1) 2121/     A80 : 79                  		ld	a,c
(1) 2122/     A81 : E6 F0               		and	0F0h
(1) 2123/     A83 : FE F0               		cp	0F0h
(1) 2124/     A85 : C8                  		ret	z
(1) 2125/     A86 : FE E0               		cp	0E0h
(1) 2126/     A88 : C8                  		ret	z
(1) 2127/     A89 : CF                  		rst	8
(1) 2128/     A8A : FD 7E 07            		ld	a,(iy+07h)
(1) 2129/     A8D : 91                  		sub	a,c
(1) 2130/     A8E : FD 77 07            		ld	(iy+07h),a
(1) 2131/     A91 : C9                  		ret
(1) 2132/     A92 :                     
(1) 2133/     A92 :                     ; ----------------------------------------
(1) 2134/     A92 :                     ; Effect F
(1) 2135/     A92 :                     .effc_F:
(1) 2136/     A92 : CD A7 0A            		call	.save_arg
(1) 2137/     A95 : 79                  		ld	a,c
(1) 2138/     A96 : E6 F0               		and	0F0h
(1) 2139/     A98 : FE F0               		cp	0F0h
(1) 2140/     A9A : C8                  		ret	z
(1) 2141/     A9B : FE E0               		cp	0E0h
(1) 2142/     A9D : C8                  		ret	z
(1) 2143/     A9E : CF                  		rst	8
(1) 2144/     A9F : FD 7E 07            		ld	a,(iy+07h)
(1) 2145/     AA2 : 81                  		add	a,c
(1) 2146/     AA3 : FD 77 07            		ld	(iy+07h),a
(1) 2147/     AA6 : C9                  		ret
(1) 2148/     AA7 :                     
(1) 2149/     AA7 :                     ; --------------------------------
(1) 2150/     AA7 :                     ; e - got arg
(1) 2151/     AA7 :                     ; c - new arg
(1) 2152/     AA7 :                     .save_arg:
(1) 2153/     AA7 : FD 4E 09            		ld	c,(iy+09h)	; Current slide setting
(1) 2154/     AAA : 7B                  		ld	a,e		; EffArg is non-zero?
(1) 2155/     AAB : B7                  		or	a
(1) 2156/     AAC : 28 04               		jr	z,.D_cont	; 00h = slide continue
(1) 2157/     AAE : 4F                  		ld	c,a
(1) 2158/     AAF : FD 71 09            		ld	(iy+09h),c	; Store NEW slide setting
(1) 2159/     AB2 :                     .D_cont:
(1) 2160/     AB2 : C9                  		ret
(1) 2161/     AB3 :                     
(1) 2162/     AB3 :                     ; ----------------------------------------
(1) 2163/     AB3 :                     ; Effect X
(1) 2164/     AB3 :                     ;
(1) 2165/     AB3 :                     ; Panning arg:
(1) 2166/     AB3 :                     ; 00h LEFT <- 80h MIDDLE -> FFh RIGHT
(1) 2167/     AB3 :                     ;
(1) 2168/     AB3 :                     ; FM style %LR000000 (REVERSE: 0-on 1-off)
(1) 2169/     AB3 :                     
(1) 2170/     AB3 :                     .effc_X:
(1) 2171/     AB3 : 16 00               		ld	d,0
(1) 2172/     AB5 : 7E                  		ld	a,(hl)
(1) 2173/     AB6 : FE 80               		cp	80h		; PSG?
(1) 2174/     AB8 : 28 18               		jr	z,.res_pan
(1) 2175/     ABA : FE 90               		cp	90h		; PSGN?
(1) 2176/     ABC : 28 14               		jr	z,.res_pan
(1) 2177/     ABE : FD 36 09 00         		ld	(iy+09h),0
(1) 2178/     AC2 : CF                  		rst	8
(1) 2179/     AC3 : E5                  		push	hl
(1) 2180/     AC4 : 21 DC 0A            		ld	hl,.fm_panlist
(1) 2181/     AC7 : 7B                  		ld	a,e
(1) 2182/     AC8 : 07                  		rlca
(1) 2183/     AC9 : 07                  		rlca
(1) 2184/     ACA : 07                  		rlca
(1) 2185/     ACB : E6 07               		and	0111b
(1) 2186/     ACD :                     ; 		ld	d,0
(1) 2187/     ACD : 5F                  		ld	e,a
(1) 2188/     ACE : CF                  		rst	8
(1) 2189/     ACF : 19                  		add	hl,de
(1) 2190/     AD0 : 56                  		ld	d,(hl)
(1) 2191/     AD1 : E1                  		pop	hl
(1) 2192/     AD2 :                     .res_pan:
(1) 2193/     AD2 : DD 7E 00            		ld	a,(ix+chnl_Flags)	; Save panning
(1) 2194/     AD5 : E6 3F               		and	00111111b
(1) 2195/     AD7 : B2                  		or	d
(1) 2196/     AD8 : DD 77 00            		ld	(ix+chnl_Flags),a
(1) 2197/     ADB : C9                  		ret
(1) 2198/     ADC :                     
(1) 2199/     ADC :                     ; 0 - ENABLE, 1 - DISABLE
(1) 2200/     ADC :                     .fm_panlist:
(1) 2201/     ADC : 40                  		db 01000000b
(1) 2202/     ADD : 40                  		db 01000000b
(1) 2203/     ADE : 40                  		db 01000000b
(1) 2204/     ADF : 00                  		db 00000000b
(1) 2205/     AE0 : 00                  		db 00000000b
(1) 2206/     AE1 : 80                  		db 10000000b
(1) 2207/     AE2 : 80                  		db 10000000b
(1) 2208/     AE3 : 80                  		db 10000000b
(1) 2209/     AE4 :                     
(1) 2210/     AE4 :                     ; ----------------------------------------
(1) 2211/     AE4 :                     ; NEW volume
(1) 2212/     AE4 :                     ; ----------------------------------------
(1) 2213/     AE4 :                     
(1) 2214/     AE4 :                     .volu:
(1) 2215/     AE4 : DD 7E 04            		ld	a,(ix+chnl_Vol)
(1) 2216/     AE7 : D6 40               		sub	a,64
(1) 2217/     AE9 : FD 77 08            		ld	(iy+08h),a	; <-- BASE volume
(1) 2218/     AEC : C9                  		ret
(1) 2219/     AED :                     
(1) 2220/     AED :                     ; ----------------------------------------
(1) 2221/     AED :                     ; NEW instrument
(1) 2222/     AED :                     ; ----------------------------------------
(1) 2223/     AED :                     
(1) 2224/     AED :                     .inst:
(1) 2225/     AED : 7E                  		ld	a,(hl)
(1) 2226/     AEE : E6 F0               		and	11110000b
(1) 2227/     AF0 : FE 80               		cp	80h
(1) 2228/     AF2 : 28 1E               		jr	z,.ps_ins
(1) 2229/     AF4 : FE 90               		cp	90h
(1) 2230/     AF6 : 28 14               		jr	z,.pn_ins
(1) 2231/     AF8 : FE A0               		cp	0A0h
(1) 2232/     AFA : 28 4C               		jr	z,.fm_ins
(1) 2233/     AFC : FE B0               		cp	0B0h
(1) 2234/     AFE : 28 48               		jr	z,.fm_ins
(1) 2235/     B00 : FE C0               		cp	0C0h
(1) 2236/     B02 : CA C9 0B            		jp	z,.dac_ins
(1) 2237/     B05 : CF                  		rst	8
(1) 2238/     B06 : FE D0               		cp	0D0h
(1) 2239/     B08 : CA 20 0C            		jp	z,.pwm_ins
(1) 2240/     B0B :                     
(1) 2241/     B0B :                     ; ----------------------------------------
(1) 2242/     B0B :                     
(1) 2243/     B0B :                     .invl_ins:
(1) 2244/     B0B : C9                  		ret
(1) 2245/     B0C :                     
(1) 2246/     B0C :                     ; ----------------------------------------
(1) 2247/     B0C :                     
(1) 2248/     B0C :                     ; PSG
(1) 2249/     B0C :                     .pn_ins:
(1) 2250/     B0C : 7E                  		ld	a,(hl)		; Grab noise setting
(1) 2251/     B0D : E6 07               		and	0111b
(1) 2252/     B0F : 32 06 17            		ld	(psgHatMode),a	; ** GLOBAL SETTING
(1) 2253/     B12 :                     .ps_ins:
(1) 2254/     B12 : CF                  		rst	8
(1) 2255/     B13 : DD E5               		push	ix
(1) 2256/     B15 : E5                  		push	hl
(1) 2257/     B16 : 23                  		inc	hl		; Skip ID
(1) 2258/     B17 : DD 21 7B 16         		ld	ix,psgcom	; Read psg control
(1) 2259/     B1B : FD 5E 05            		ld	e,(iy+05h)
(1) 2260/     B1E : 16 00               		ld	d,0
(1) 2261/     B20 : DD 19               		add	ix,de
(1) 2262/     B22 : 7E                  		ld	a,(hl)
(1) 2263/     B23 : CF                  		rst	8
(1) 2264/     B24 : 23                  		inc	hl
(1) 2265/     B25 : 7E                  		ld	a,(hl)
(1) 2266/     B26 : DD 77 24            		ld	(ix+ALV),a	; ALV
(1) 2267/     B29 : 23                  		inc	hl
(1) 2268/     B2A : 7E                  		ld	a,(hl)
(1) 2269/     B2B : DD 77 08            		ld	(ix+ATK),a	; ATK
(1) 2270/     B2E : 23                  		inc	hl
(1) 2271/     B2F : 7E                  		ld	a,(hl)
(1) 2272/     B30 : CF                  		rst	8
(1) 2273/     B31 : DD 77 10            		ld	(ix+SLV),a	; SLV
(1) 2274/     B34 : 23                  		inc	hl
(1) 2275/     B35 : 7E                  		ld	a,(hl)
(1) 2276/     B36 : DD 77 0C            		ld	(ix+DKY),a	; DKY
(1) 2277/     B39 : 23                  		inc	hl
(1) 2278/     B3A : 7E                  		ld	a,(hl)
(1) 2279/     B3B : DD 77 14            		ld	(ix+RRT),a	; RRT
(1) 2280/     B3E : 23                  		inc	hl
(1) 2281/     B3F : 7E                  		ld	a,(hl)
(1) 2282/     B40 : CF                  		rst	8
(1) 2283/     B41 : DD 77 34            		ld	(ix+PARP),a	; ARP
(1) 2284/     B44 : E1                  		pop	hl
(1) 2285/     B45 : DD E1               		pop	ix
(1) 2286/     B47 : C9                  		ret
(1) 2287/     B48 :                     
(1) 2288/     B48 :                     ; --------
(1) 2289/     B48 :                     
(1) 2290/     B48 :                     .fm_ins:
(1) 2291/     B48 :                     ;  ret
(1) 2292/     B48 : DD E5               		push	ix
(1) 2293/     B4A : E5                  		push	hl
(1) 2294/     B4B : C5                  		push	bc
(1) 2295/     B4C :                     ; 		ld	b,(ix+chnl_Ins)	; b - current Ins
(1) 2296/     B4C : FD 46 02            		ld	b,(iy+02h)
(1) 2297/     B4F : FD 7E 05            		ld	a,(iy+05h)
(1) 2298/     B52 : E6 07               		and	0111b
(1) 2299/     B54 : 16 00               		ld	d,0
(1) 2300/     B56 : 87                  		add	a,a
(1) 2301/     B57 : 5F                  		ld	e,a
(1) 2302/     B58 : DD 21 E9 13         		ld	ix,fmcach_list
(1) 2303/     B5C : DD 19               		add	ix,de
(1) 2304/     B5E : CF                  		rst	8
(1) 2305/     B5F : DD 5E 00            		ld	e,(ix)
(1) 2306/     B62 : DD 23               		inc	ix
(1) 2307/     B64 : DD 56 00            		ld	d,(ix)
(1) 2308/     B67 :                     ; 		ld	a,(iy+0Bh)	; 0Bh: DON'T reload flag
(1) 2309/     B67 :                     ; 		cp	b
(1) 2310/     B67 :                     ; 		jr	z,.same_patch
(1) 2311/     B67 :                     ; 		ld	(iy+0Bh),b
(1) 2312/     B67 : 23                  		inc	hl		; Skip id and pitch
(1) 2313/     B68 : 23                  		inc	hl
(1) 2314/     B69 : 46                  		ld	b,(hl)
(1) 2315/     B6A : 23                  		inc	hl
(1) 2316/     B6B : 4E                  		ld	c,(hl)
(1) 2317/     B6C : 23                  		inc	hl
(1) 2318/     B6D : 6E                  		ld	l,(hl)
(1) 2319/     B6E : 61                  		ld	h,c
(1) 2320/     B6F : FD 7E 0A            		ld	a,(iy+0Ah)
(1) 2321/     B72 : BC                  		cp	h
(1) 2322/     B73 : 20 07               		jr	nz,.new_romdat
(1) 2323/     B75 : CF                  		rst	8
(1) 2324/     B76 : FD 7E 0B            		ld	a,(iy+0Bh)
(1) 2325/     B79 : BD                  		cp	l
(1) 2326/     B7A : 28 38               		jr	z,.same_patch
(1) 2327/     B7C :                     .new_romdat:
(1) 2328/     B7C : FD 74 0A            		ld	(iy+0Ah),h
(1) 2329/     B7F : FD 75 0B            		ld	(iy+0Bh),l
(1) 2330/     B82 : 78                  		ld	a,b
(1) 2331/     B83 : D5                  		push	de
(1) 2332/     B84 : 01 28 00            		ld	bc,28h		; <- size
(1) 2333/     B87 : CD C8 0E            		call	transferRom	; *** ROM ACCESS ***
(1) 2334/     B8A :                     
(1) 2335/     B8A : E1                  		pop	hl
(1) 2336/     B8B : FD 7E 05            		ld	a,(iy+05h)
(1) 2337/     B8E : 4F                  		ld	c,a		; c - FM Key ID
(1) 2338/     B8F :                     ; 		call	.fm_keyoff
(1) 2339/     B8F :                     
(1) 2340/     B8F :                     	; hl - fmcach intrument
(1) 2341/     B8F :                     	; de - FM reg and data: 3000h
(1) 2342/     B8F :                     	;  c - FM keyChannel
(1) 2343/     B8F : 79                  		ld	a,c
(1) 2344/     B90 : E6 03               		and	011b
(1) 2345/     B92 : F6 30               		or	30h		; Start at reg 30h
(1) 2346/     B94 : 57                  		ld	d,a
(1) 2347/     B95 : 1E 00               		ld	e,0
(1) 2348/     B97 : CF                  		rst	8
(1) 2349/     B98 : 06 1C               		ld	b,7*4		; Write ALL base FM registers
(1) 2350/     B9A : CD B9 0B            		call	.fm_setrlist
(1) 2351/     B9D :                     ; 		ld	b,4
(1) 2352/     B9D :                     ; 		call	.fm_setrlist
(1) 2353/     B9D :                     ; 		ld	b,5*4
(1) 2354/     B9D :                     ; 		call	.fm_setrlist
(1) 2355/     B9D : 7E                  		ld	a,(hl)		; 0B0h
(1) 2356/     B9E : FD 77 0C            		ld	(iy+0Ch),a	; ** Save 0B0h to 0Ch
(1) 2357/     BA1 : 23                  		inc	hl
(1) 2358/     BA2 : 7E                  		ld	a,(hl)		; 0B4h
(1) 2359/     BA3 : FD 77 0D            		ld	(iy+0Dh),a	; ** Save 0B4h to 0Dh
(1) 2360/     BA6 : 23                  		inc	hl
(1) 2361/     BA7 : CF                  		rst	8
(1) 2362/     BA8 : 7E                  		ld	a,(hl)
(1) 2363/     BA9 : FD 77 0E            		ld	(iy+0Eh),a	; LFO
(1) 2364/     BAC : 23                  		inc	hl
(1) 2365/     BAD : 7E                  		ld	a,(hl)		; 028h keys
(1) 2366/     BAE : E6 F0               		and	11110000b
(1) 2367/     BB0 : CF                  		rst	8
(1) 2368/     BB1 : FD 77 0F            		ld	(iy+0Fh),a	; ** Save keys to 0Eh
(1) 2369/     BB4 :                     .same_patch:
(1) 2370/     BB4 : C1                  		pop	bc
(1) 2371/     BB5 : E1                  		pop	hl
(1) 2372/     BB6 : DD E1               		pop	ix
(1) 2373/     BB8 : C9                  		ret
(1) 2374/     BB9 :                     ; b - numof_regs
(1) 2375/     BB9 :                     .fm_setrlist:
(1) 2376/     BB9 : 5E                  		ld	e,(hl)
(1) 2377/     BBA : 23                  		inc	hl
(1) 2378/     BBB : CD AC 10            		call	fm_autoreg
(1) 2379/     BBE : 00                  		nop
(1) 2380/     BBF : 00                  		nop
(1) 2381/     BC0 : CF                  		rst	8
(1) 2382/     BC1 : 00                  		nop
(1) 2383/     BC2 : 14                  		inc	d		; +4
(1) 2384/     BC3 : 14                  		inc	d
(1) 2385/     BC4 : 14                  		inc	d
(1) 2386/     BC5 : 14                  		inc	d
(1) 2387/     BC6 : 10 F1               		djnz	.fm_setrlist
(1) 2388/     BC8 : C9                  		ret
(1) 2389/     BC9 :                     ; --------
(1) 2390/     BC9 :                     
(1) 2391/     BC9 :                     .dac_ins:
(1) 2392/     BC9 : DD 5E 03            		ld	e,(ix+chnl_Ins)	; b - current Ins
(1) 2393/     BCC :                     ; 		ld	a,(iy+0Bh)	; 0Bh: DON'T reload flag
(1) 2394/     BCC :                     ; 		cp	e
(1) 2395/     BCC :                     ; 		jr	z,.same_dac
(1) 2396/     BCC : FD 73 0B            		ld	(iy+0Bh),e
(1) 2397/     BCF : E5                  		push	hl
(1) 2398/     BD0 : C5                  		push	bc
(1) 2399/     BD1 : 7E                  		ld	a,(hl)
(1) 2400/     BD2 : E6 0F               		and	01111b
(1) 2401/     BD4 : 32 02 17            		ld	(wave_Flags),a
(1) 2402/     BD7 : CF                  		rst	8
(1) 2403/     BD8 : 23                  		inc	hl
(1) 2404/     BD9 : 23                  		inc	hl
(1) 2405/     BDA : 5E                  		ld	e,(hl)
(1) 2406/     BDB : 23                  		inc	hl
(1) 2407/     BDC : 7E                  		ld	a,(hl)
(1) 2408/     BDD : 23                  		inc	hl
(1) 2409/     BDE : 6E                  		ld	l,(hl)
(1) 2410/     BDF : 67                  		ld	h,a
(1) 2411/     BE0 : E5                  		push	hl
(1) 2412/     BE1 : 7B                  		ld	a,e
(1) 2413/     BE2 : 01 06 00            		ld	bc,6		; Skip header
(1) 2414/     BE5 : 09                  		add	hl,bc
(1) 2415/     BE6 : CE 00               		adc	a,0
(1) 2416/     BE8 : 22 F7 16            		ld	(wave_Start),hl	; Set START point
(1) 2417/     BEB : 32 F9 16            		ld	(wave_Start+2),a
(1) 2418/     BEE : E1                  		pop	hl
(1) 2419/     BEF : 7B                  		ld	a,e
(1) 2420/     BF0 : 11 16 17            		ld	de,sampleHead
(1) 2421/     BF3 : 01 06 00            		ld	bc,6
(1) 2422/     BF6 : D5                  		push	de
(1) 2423/     BF7 : CF                  		rst	8
(1) 2424/     BF8 : CD C8 0E            		call	transferRom	; *** ROM ACCESS ***
(1) 2425/     BFB : E1                  		pop	hl
(1) 2426/     BFC :                     	; hl - temporal header
(1) 2427/     BFC : 5E                  		ld	e,(hl)
(1) 2428/     BFD : 23                  		inc	hl
(1) 2429/     BFE : 56                  		ld	d,(hl)
(1) 2430/     BFF : 23                  		inc	hl
(1) 2431/     C00 : 7E                  		ld	a,(hl)
(1) 2432/     C01 : 23                  		inc	hl
(1) 2433/     C02 : ED 53 FA 16         		ld	(wave_Len),de	; LEN
(1) 2434/     C06 : 32 FC 16            		ld	(wave_Len+2),a
(1) 2435/     C09 : 5E                  		ld	e,(hl)
(1) 2436/     C0A : 23                  		inc	hl
(1) 2437/     C0B : CF                  		rst	8
(1) 2438/     C0C : 56                  		ld	d,(hl)
(1) 2439/     C0D : 23                  		inc	hl
(1) 2440/     C0E : 7E                  		ld	a,(hl)
(1) 2441/     C0F : 23                  		inc	hl
(1) 2442/     C10 : ED 53 FD 16         		ld	(wave_Loop),de	; LOOP
(1) 2443/     C14 : 32 FF 16            		ld	(wave_Loop+2),a
(1) 2444/     C17 : 11 06 28            		ld	de,2806h	; keys off
(1) 2445/     C1A : CD B5 10            		call	fm_send_1
(1) 2446/     C1D : C1                  		pop	bc
(1) 2447/     C1E : E1                  		pop	hl
(1) 2448/     C1F :                     ; .same_dac:
(1) 2449/     C1F : C9                  		ret
(1) 2450/     C20 :                     
(1) 2451/     C20 :                     ; --------
(1) 2452/     C20 :                     
(1) 2453/     C20 :                     .pwm_ins:
(1) 2454/     C20 : DD E5               		push	ix
(1) 2455/     C22 : E5                  		push	hl
(1) 2456/     C23 : C5                  		push	bc
(1) 2457/     C24 : 7E                  		ld	a,(hl)		; Stereo|Loop bits
(1) 2458/     C25 : E6 03               		and	00000011b
(1) 2459/     C27 : 0F                  		rrca
(1) 2460/     C28 : 0F                  		rrca
(1) 2461/     C29 : 4F                  		ld	c,a
(1) 2462/     C2A :                     ; 		ld	(iy+0Ah),a	; 0Ah flags: %SlLR
(1) 2463/     C2A : CF                  		rst	8
(1) 2464/     C2B : 23                  		inc	hl		; Skip ID and Pitch
(1) 2465/     C2C : 23                  		inc	hl
(1) 2466/     C2D : 56                  		ld	d,(hl)
(1) 2467/     C2E : 23                  		inc	hl
(1) 2468/     C2F : 5E                  		ld	e,(hl)
(1) 2469/     C30 : 23                  		inc	hl
(1) 2470/     C31 : 7E                  		ld	a,(hl)
(1) 2471/     C32 : 23                  		inc	hl
(1) 2472/     C33 : 6E                  		ld	l,(hl)
(1) 2473/     C34 : 67                  		ld	h,a
(1) 2474/     C35 : 79                  		ld	a,c
(1) 2475/     C36 : B2                  		or	d
(1) 2476/     C37 : 57                  		ld	d,a
(1) 2477/     C38 : CF                  		rst	8
(1) 2478/     C39 :                     
(1) 2479/     C39 :                     	; de,hl - 32-bit PWM pointer
(1) 2480/     C39 : DD 21 43 16         		ld	ix,pwmcom
(1) 2481/     C3D : 06 00               		ld	b,0
(1) 2482/     C3F : FD 4E 05            		ld	c,(iy+05h)
(1) 2483/     C42 : DD 09               		add	ix,bc
(1) 2484/     C44 : 01 18 00            		ld	bc,PWOUTF
(1) 2485/     C47 : DD 09               		add	ix,bc	; Move to PWOUTF
(1) 2486/     C49 : 01 08 00            		ld	bc,8
(1) 2487/     C4C : DD 72 00            		ld	(ix),d
(1) 2488/     C4F : DD 09               		add	ix,bc
(1) 2489/     C51 : DD 73 00            		ld	(ix),e
(1) 2490/     C54 : DD 09               		add	ix,bc
(1) 2491/     C56 : DD 74 00            		ld	(ix),h
(1) 2492/     C59 : DD 09               		add	ix,bc
(1) 2493/     C5B : DD 75 00            		ld	(ix),l
(1) 2494/     C5E : C1                  		pop	bc
(1) 2495/     C5F : E1                  		pop	hl
(1) 2496/     C60 : DD E1               		pop	ix
(1) 2497/     C62 : C9                  		ret
(1) 2498/     C63 :                     
(1) 2499/     C63 :                     ; ----------------------------------------
(1) 2500/     C63 :                     ; NEW note
(1) 2501/     C63 :                     ; ----------------------------------------
(1) 2502/     C63 :                     
(1) 2503/     C63 :                     .note:
(1) 2504/     C63 : 78                  		ld	a,b		; Volume bit?
(1) 2505/     C64 : E6 04               		and	0100b
(1) 2506/     C66 : 20 05               		jr	nz,.fm_hasvol
(1) 2507/     C68 : FD 36 08 00         		ld	(iy+08h),0	; Reset to default volume
(1) 2508/     C6C : CF                  		rst	8
(1) 2509/     C6D :                     .fm_hasvol:
(1) 2510/     C6D : DD 7E 02            		ld	a,(ix+chnl_Note)
(1) 2511/     C70 : 4F                  		ld	c,a
(1) 2512/     C71 : FE FF               		cp	-1
(1) 2513/     C73 : C8                  		ret	z
(1) 2514/     C74 : FE FE               		cp	-2
(1) 2515/     C76 : C8                  		ret	z
(1) 2516/     C77 : 7E                  		ld	a,(hl)
(1) 2517/     C78 : E6 F0               		and	11110000b
(1) 2518/     C7A : FE 80               		cp	80h
(1) 2519/     C7C : 28 12               		jr	z,.n_indx
(1) 2520/     C7E : CF                  		rst	8
(1) 2521/     C7F : FE 90               		cp	90h
(1) 2522/     C81 : 28 1C               		jr	z,.n_psgn
(1) 2523/     C83 : FE A0               		cp	0A0h
(1) 2524/     C85 : 28 1D               		jr	z,.n_fm
(1) 2525/     C87 :                     ; 		cp	0B0h		; ** Can't use notes on FM3 **
(1) 2526/     C87 :                     ; 		jr	z,.n_fm
(1) 2527/     C87 : FE C0               		cp	0C0h
(1) 2528/     C89 : 28 05               		jr	z,.n_indx
(1) 2529/     C8B : FE D0               		cp	0D0h
(1) 2530/     C8D : 28 01               		jr	z,.n_indx
(1) 2531/     C8F : C9                  		ret
(1) 2532/     C90 :                     
(1) 2533/     C90 :                     ; --------------------------------
(1) 2534/     C90 :                     
(1) 2535/     C90 :                     .n_indx:
(1) 2536/     C90 : 79                  		ld	a,c
(1) 2537/     C91 :                     .n_stfreq:
(1) 2538/     C91 : 23                  		inc	hl		; Skip ID
(1) 2539/     C92 : 5E                  		ld	e,(hl)		; Read pitch
(1) 2540/     C93 : 2B                  		dec	hl
(1) 2541/     C94 : 83                  		add	a,e		; Note + pitch
(1) 2542/     C95 : CF                  		rst	8
(1) 2543/     C96 : 87                  		add	a,a		; * 2
(1) 2544/     C97 : FD 77 06            		ld	(iy+06h),a
(1) 2545/     C9A : FD 36 07 00         		ld	(iy+07h),0	; reset pitchbend
(1) 2546/     C9E : C9                  		ret
(1) 2547/     C9F :                     .n_psgn:
(1) 2548/     C9F : 79                  		ld	a,c
(1) 2549/     CA0 : C6 0C               		add	a,12		; <-- Manual adjust for NOISE
(1) 2550/     CA2 : 18 ED               		jr	.n_stfreq
(1) 2551/     CA4 :                     ; FM
(1) 2552/     CA4 :                     .n_fm:
(1) 2553/     CA4 : 79                  		ld	a,c
(1) 2554/     CA5 : 23                  		inc	hl		; Skip ID
(1) 2555/     CA6 : 5E                  		ld	e,(hl)		; Read pitch
(1) 2556/     CA7 : 2B                  		dec	hl
(1) 2557/     CA8 : CF                  		rst	8
(1) 2558/     CA9 : 83                  		add	a,e		; Note + pitch
(1) 2559/     CAA :                     	; Search for octave and note
(1) 2560/     CAA : 0E 00               		ld	c,0		; c - octave
(1) 2561/     CAC : 16 07               		ld	d,7
(1) 2562/     CAE :                     .get_oct:
(1) 2563/     CAE : 5F                  		ld	e,a		; e - note
(1) 2564/     CAF : D6 0C               		sub	12
(1) 2565/     CB1 : B7                  		or	a
(1) 2566/     CB2 : FA BE 0C            		jp	m,.fnd_oct
(1) 2567/     CB5 : 0C                  		inc	c
(1) 2568/     CB6 : CF                  		rst	8
(1) 2569/     CB7 : 00                  		nop	; wave sync
(1) 2570/     CB8 : 00                  		nop
(1) 2571/     CB9 : 00                  		nop
(1) 2572/     CBA : 00                  		nop
(1) 2573/     CBB : 15                  		dec	d
(1) 2574/     CBC : 20 F0               		jr	nz,.get_oct
(1) 2575/     CBE :                     .fnd_oct:
(1) 2576/     CBE : 7B                  		ld	a,e
(1) 2577/     CBF : 87                  		add	a,a		; Note * 2
(1) 2578/     CC0 : E6 1F               		and	00011111b
(1) 2579/     CC2 : CB 09               		rrc	c
(1) 2580/     CC4 : CB 09               		rrc	c
(1) 2581/     CC6 : CB 09               		rrc	c
(1) 2582/     CC8 : B1                  		or	c
(1) 2583/     CC9 : FD 77 06            		ld	(iy+06h),a	; Save octave + index: OOOiiiiib
(1) 2584/     CCC : FD 36 07 00         		ld	(iy+07h),0
(1) 2585/     CD0 : C9                  		ret
(1) 2586/     CD1 :                     
(1) 2587/     CD1 :                     ; ----------------------------------------
(1) 2588/     CD1 :                     
(1) 2589/     CD1 :                     .fm_keyoff:
(1) 2590/     CD1 : 16 28               		ld	d,28h
(1) 2591/     CD3 : FD 5E 05            		ld	e,(iy+05h)
(1) 2592/     CD6 : C3 B5 10            		jp	fm_send_1
(1) 2593/     CD9 :                     .fm_tloff:
(1) 2594/     CD9 : 06 04               		ld	b,4
(1) 2595/     CDB : FD 4E 05            		ld	c,(iy+05h)
(1) 2596/     CDE : 79                  		ld	a,c
(1) 2597/     CDF : E6 03               		and	011b
(1) 2598/     CE1 : F6 40               		or	40h	; TL regs
(1) 2599/     CE3 :                     .tl_down:
(1) 2600/     CE3 : 57                  		ld	d,a
(1) 2601/     CE4 : 1E 7F               		ld	e,7Fh
(1) 2602/     CE6 : CD AC 10            		call	fm_autoreg
(1) 2603/     CE9 : CF                  		rst	8
(1) 2604/     CEA : 7A                  		ld	a,d
(1) 2605/     CEB : C6 04               		add	a,4
(1) 2606/     CED : 10 F4               		djnz	.tl_down
(1) 2607/     CEF : C9                  		ret
(1) 2608/     CF0 :                     ; c - KeyID
(1) 2609/     CF0 :                     .fm_setfreq:
(1) 2610/     CF0 : 79                  		ld	a,c
(1) 2611/     CF1 : E6 03               		and	011b
(1) 2612/     CF3 : F6 A4               		or	0A4h
(1) 2613/     CF5 : 57                  		ld	d,a
(1) 2614/     CF6 : 5C                  		ld	e,h
(1) 2615/     CF7 : CF                  		rst	8
(1) 2616/     CF8 : CD AC 10            		call	fm_autoreg
(1) 2617/     CFB : 79                  		ld	a,c
(1) 2618/     CFC : E6 03               		and	011b
(1) 2619/     CFE : F6 A0               		or	0A0h
(1) 2620/     D00 : 57                  		ld	d,a
(1) 2621/     D01 : 5D                  		ld	e,l
(1) 2622/     D02 : CD AC 10            		call	fm_autoreg
(1) 2623/     D05 : CF                  		rst	8
(1) 2624/     D06 : C9                  		ret
(1) 2625/     D07 :                     
(1) 2626/     D07 :                     ; --------------------------------
(1) 2627/     D07 :                     ; WRITE TL volume
(1) 2628/     D07 :                     
(1) 2629/     D07 :                     .fm_wrtlvol:
(1) 2630/     D07 : 21 E9 13            		ld	hl,fmcach_list
(1) 2631/     D0A : FD 7E 05            		ld	a,(iy+05h)
(1) 2632/     D0D : E6 07               		and	0111b
(1) 2633/     D0F : 16 00               		ld	d,0
(1) 2634/     D11 : CF                  		rst	8
(1) 2635/     D12 : 87                  		add	a,a
(1) 2636/     D13 : 5F                  		ld	e,a
(1) 2637/     D14 : 19                  		add	hl,de
(1) 2638/     D15 : 7E                  		ld	a,(hl)
(1) 2639/     D16 : 23                  		inc	hl
(1) 2640/     D17 : 66                  		ld	h,(hl)
(1) 2641/     D18 : 6F                  		ld	l,a
(1) 2642/     D19 : 23                  		inc	hl
(1) 2643/     D1A : 23                  		inc	hl
(1) 2644/     D1B : 23                  		inc	hl
(1) 2645/     D1C : CF                  		rst	8
(1) 2646/     D1D : 23                  		inc	hl		; Point to TL's
(1) 2647/     D1E : FD 7E 05            		ld	a,(iy+05h)
(1) 2648/     D21 : E6 03               		and	011b
(1) 2649/     D23 : F6 40               		or	40h		; TL registers
(1) 2650/     D25 : 57                  		ld	d,a
(1) 2651/     D26 :                     ; d - 40h+
(1) 2652/     D26 :                     ; hl - TL data
(1) 2653/     D26 :                     ; .fm_wrtlvol:
(1) 2654/     D26 : C5                  		push	bc
(1) 2655/     D27 : E5                  		push	hl
(1) 2656/     D28 : 21 79 0D            		ld	hl,.fm_cindx
(1) 2657/     D2B : FD 7E 0C            		ld	a,(iy+0Ch)	; Read 0B0h copy
(1) 2658/     D2E : E6 07               		and	0111b
(1) 2659/     D30 : 06 00               		ld	b,0
(1) 2660/     D32 : 4F                  		ld	c,a
(1) 2661/     D33 : 09                  		add	hl,bc
(1) 2662/     D34 : FD 7E 08            		ld	a,(iy+08h)
(1) 2663/     D37 : CB 2F               		sra	a		; volume / 2
(1) 2664/     D39 : E6 7F               		and	01111111b
(1) 2665/     D3B : 4F                  		ld	c,a
(1) 2666/     D3C : CF                  		rst	8
(1) 2667/     D3D : 46                  		ld	b,(hl)
(1) 2668/     D3E : E1                  		pop	hl
(1) 2669/     D3F : CB 08               		rrc	b		; OP1
(1) 2670/     D41 : DC 6C 0D            		call	c,.write_tl
(1) 2671/     D44 : 23                  		inc	hl
(1) 2672/     D45 : 14                  		inc	d
(1) 2673/     D46 : 14                  		inc	d
(1) 2674/     D47 : CF                  		rst	8
(1) 2675/     D48 : 14                  		inc	d
(1) 2676/     D49 : 14                  		inc	d
(1) 2677/     D4A : CB 08               		rrc	b		; OP2
(1) 2678/     D4C : DC 6C 0D            		call	c,.write_tl
(1) 2679/     D4F : 23                  		inc	hl
(1) 2680/     D50 : 14                  		inc	d
(1) 2681/     D51 : 14                  		inc	d
(1) 2682/     D52 : 14                  		inc	d
(1) 2683/     D53 : 14                  		inc	d
(1) 2684/     D54 : CB 08               		rrc	b		; OP3
(1) 2685/     D56 : DC 6C 0D            		call	c,.write_tl
(1) 2686/     D59 : 23                  		inc	hl
(1) 2687/     D5A : CF                  		rst	8
(1) 2688/     D5B : 14                  		inc	d
(1) 2689/     D5C : 14                  		inc	d
(1) 2690/     D5D : 14                  		inc	d
(1) 2691/     D5E : 14                  		inc	d
(1) 2692/     D5F : CB 08               		rrc	b		; OP4
(1) 2693/     D61 : DC 6C 0D            		call	c,.write_tl
(1) 2694/     D64 : 23                  		inc	hl
(1) 2695/     D65 : 14                  		inc	d
(1) 2696/     D66 : 14                  		inc	d
(1) 2697/     D67 : 14                  		inc	d
(1) 2698/     D68 : 14                  		inc	d
(1) 2699/     D69 : CF                  		rst	8
(1) 2700/     D6A : C1                  		pop	bc
(1) 2701/     D6B : C9                  		ret
(1) 2702/     D6C :                     .write_tl:
(1) 2703/     D6C : 7E                  		ld	a,(hl)
(1) 2704/     D6D : 91                  		sub	a,c
(1) 2705/     D6E : C5                  		push	bc
(1) 2706/     D6F : 5F                  		ld	e,a
(1) 2707/     D70 : FD 4E 05            		ld	c,(iy+05h)
(1) 2708/     D73 : CD AC 10            		call	fm_autoreg
(1) 2709/     D76 : CF                  		rst	8
(1) 2710/     D77 : C1                  		pop	bc
(1) 2711/     D78 : C9                  		ret
(1) 2712/     D79 :                     ; Jump carry list
(1) 2713/     D79 :                     .fm_cindx:
(1) 2714/     D79 : 08                  		db 1000b
(1) 2715/     D7A : 08                  		db 1000b
(1) 2716/     D7B : 08                  		db 1000b
(1) 2717/     D7C : 08                  		db 1000b
(1) 2718/     D7D : 0C                  		db 1100b
(1) 2719/     D7E : 0E                  		db 1110b
(1) 2720/     D7F : 0E                  		db 1110b
(1) 2721/     D80 : 0F                  		db 1111b
(1) 2722/     D81 :                     ; c - KeyId
(1) 2723/     D81 :                     .fm_wrtalpan:
(1) 2724/     D81 : FD 7E 0C            		ld	a,(iy+0Ch)	; 0B0h algorithm
(1) 2725/     D84 : 5F                  		ld	e,a
(1) 2726/     D85 : 79                  		ld	a,c
(1) 2727/     D86 : E6 03               		and	011b
(1) 2728/     D88 : F6 B0               		or	0B0h
(1) 2729/     D8A : 57                  		ld	d,a
(1) 2730/     D8B : CD AC 10            		call	fm_autoreg
(1) 2731/     D8E : CF                  		rst	8
(1) 2732/     D8F : DD 7E 00            		ld	a,(ix+chnl_Flags)	; Read panning bits
(1) 2733/     D92 : 2F                  		cpl				; REVERSE bits
(1) 2734/     D93 : E6 C0               		and	11000000b
(1) 2735/     D95 : 5F                  		ld	e,a
(1) 2736/     D96 : FD 7E 0D            		ld	a,(iy+0Dh)		; 0B4h %LRaa0ppp
(1) 2737/     D99 : E6 3F               		and	00111111b
(1) 2738/     D9B : B3                  		or	e
(1) 2739/     D9C : 5F                  		ld	e,a
(1) 2740/     D9D : 79                  		ld	a,c
(1) 2741/     D9E : E6 03               		and	011b
(1) 2742/     DA0 : F6 B4               		or	0B4h
(1) 2743/     DA2 : 57                  		ld	d,a
(1) 2744/     DA3 : CD AC 10            		call	fm_autoreg
(1) 2745/     DA6 : CF                  		rst	8
(1) 2746/     DA7 : FD 7E 0E            		ld	a,(iy+0Eh)
(1) 2747/     DAA : CB 5F               		bit	3,a
(1) 2748/     DAC : 28 06               		jr	z,.no_lfo
(1) 2749/     DAE : 5F                  		ld	e,a
(1) 2750/     DAF : 16 22               		ld	d,22h
(1) 2751/     DB1 : CD B5 10            		call	fm_send_1
(1) 2752/     DB4 :                     .no_lfo:
(1) 2753/     DB4 : C9                  		ret
(1) 2754/     DB5 :                     
(1) 2755/     DB5 :                     ; ----------------------------------------
(1) 2756/     DB5 :                     
(1) 2757/     DB5 :                     .chnl_ulnkoff:
(1) 2758/     DB5 : 0E 00               		ld	c,0
(1) 2759/     DB7 :                     .chnl_ulnk:
(1) 2760/     DB7 : CF                  		rst	8
(1) 2761/     DB8 : AF                  		xor	a
(1) 2762/     DB9 : DD 77 01            		ld	(ix+chnl_Chip),a
(1) 2763/     DBC : FD 77 00            		ld	(iy),a		; Delete link, chip and prio
(1) 2764/     DBF : FD 77 01            		ld	(iy+1),a
(1) 2765/     DC2 : FD 71 02            		ld	(iy+2),c
(1) 2766/     DC5 : C9                  		ret
(1) 2767/     DC6 :                     .chnl_ulnkcut:
(1) 2768/     DC6 : DD 4E 01            		ld	c,(ix+chnl_Chip)
(1) 2769/     DC9 : CD B7 0D            		call	.chnl_ulnk
(1) 2770/     DCC : FD 77 08            		ld	(iy+08h),a
(1) 2771/     DCF : FD 77 09            		ld	(iy+09h),a
(1) 2772/     DD2 : FD 77 0A            		ld	(iy+0Ah),a
(1) 2773/     DD5 : FD 77 0B            		ld	(iy+0Bh),a
(1) 2774/     DD8 :                     ; 		push	iy
(1) 2775/     DD8 :                     ; 		pop	hl
(1) 2776/     DD8 :                     ; 		ld	bc,8-2		; Go to 08h
(1) 2777/     DD8 :                     ; 		add	hl,bc
(1) 2778/     DD8 :                     ; 		rst	8
(1) 2779/     DD8 :                     ; 		ld	b,8/2
(1) 2780/     DD8 :                     ; .clrfull:
(1) 2781/     DD8 :                     ; 		ld	(hl),0		; Reset settings 08-0Bh
(1) 2782/     DD8 :                     ; 		inc	hl
(1) 2783/     DD8 :                     ; 		ld	(hl),0
(1) 2784/     DD8 :                     ; 		inc	hl
(1) 2785/     DD8 :                     ; 		rst	8
(1) 2786/     DD8 :                     ; 		djnz	.clrfull
(1) 2787/     DD8 : C9                  		ret
(1) 2788/     DD9 :                     
(1) 2789/     DD9 :                     ; ============================================================
(1) 2790/     DD9 :                     ; --------------------------------------------------------
(1) 2791/     DD9 :                     ; Communicate with the 32X from here.
(1) 2792/     DD9 :                     ; --------------------------------------------------------
(1) 2793/     DD9 :                     
(1) 2794/     DD9 :                     ex_comm:
(1) 2795/     DD9 : CF                  		rst	8
(1) 2796/     DDA : 00                  		nop
(1) 2910/     DDB : C9                  		ret
(1) 2911/     DDC :                     
(1) 2912/     DDC :                     ; ====================================================================
(1) 2913/     DDC :                     ; ----------------------------------------------------------------
(1) 2914/     DDC :                     ; Subroutines
(1) 2915/     DDC :                     ; ----------------------------------------------------------------
(1) 2916/     DDC :                     
(1) 2917/     DDC :                     ; --------------------------------------------------------
(1) 2918/     DDC :                     ; Init sound engine
(1) 2919/     DDC :                     ; --------------------------------------------------------
(1) 2920/     DDC :                     
(1) 2921/     DDC :                     gema_init:
(1) 2922/     DDC : CD E0 10            		call	dac_off
(1) 2923/     DDF : 3E 00               		ld	a,0
(1) 2924/     DE1 : 32 3F 00            		ld	(marsUpd),a
(1) 2925/     DE4 : 21 00 1D            		ld	hl,dWaveBuff	; hl - Wave buffer START
(1) 2926/     DE7 : 11 01 1D            		ld	de,dWaveBuff+1	; de - Wave next byte
(1) 2927/     DEA : 01 FF 00            		ld	bc,100h-1	; bc - length for copying
(1) 2928/     DED : 36 80               		ld	(hl),80h	; Set first byte
(1) 2929/     DEF : ED B0               		ldir			; Start copying
(1) 2930/     DF1 : 21 11 7F            		ld	hl,Zpsg_ctrl	; Silence PSG channels
(1) 2931/     DF4 : 36 9F               		ld	(hl),09Fh
(1) 2932/     DF6 : 36 BF               		ld	(hl),0BFh
(1) 2933/     DF8 : 36 DF               		ld	(hl),0DFh
(1) 2934/     DFA : 36 FF               		ld	(hl),0FFh
(1) 2935/     DFC : 11 0B 22            		ld	de,2208h|3	; Set Default LFO
(1) 2936/     DFF : CD B5 10            		call	fm_send_1
(1) 2937/     E02 : 11 00 27            		ld	de,2700h	; CH3 special and timers off
(1) 2938/     E05 : CD B5 10            		call	fm_send_1
(1) 2939/     E08 : 11 00 28            		ld	de,2800h	; FM KEYS off
(1) 2940/     E0B : CD B5 10            		call	fm_send_1
(1) 2941/     E0E : 1C                  		inc	e
(1) 2942/     E0F : CD B5 10            		call	fm_send_1
(1) 2943/     E12 : 1C                  		inc	e
(1) 2944/     E13 : CD B5 10            		call	fm_send_1
(1) 2945/     E16 : 1C                  		inc	e
(1) 2946/     E17 : 1C                  		inc	e
(1) 2947/     E18 : CD B5 10            		call	fm_send_1
(1) 2948/     E1B : 1C                  		inc	e
(1) 2949/     E1C : CD B5 10            		call	fm_send_1
(1) 2950/     E1F : 1C                  		inc	e
(1) 2951/     E20 : CD B5 10            		call	fm_send_1
(1) 2952/     E23 : 21 00 60            		ld	hl,6000h
(1) 2953/     E26 : 3E 01               		ld	a,1
(1) 2954/     E28 : 77                  		ld	(hl),a
(1) 2955/     E29 : 77                  		ld	(hl),a
(1) 2956/     E2A : 77                  		ld	(hl),a
(1) 2957/     E2B : 77                  		ld	(hl),a
(1) 2958/     E2C : 77                  		ld	(hl),a
(1) 2959/     E2D : 77                  		ld	(hl),a
(1) 2960/     E2E : 77                  		ld	(hl),a
(1) 2961/     E2F : 77                  		ld	(hl),a
(1) 2962/     E30 : 77                  		ld	(hl),a
(1) 2963/     E31 : FD 21 F7 13         		ld	iy,nikona_BuffList
(1) 2964/     E35 : 0E 01               		ld	c,1		; Start at this priority
(1) 2965/     E37 :                     .setup_list:
(1) 2966/     E37 : FD 7E 00            		ld	a,(iy)
(1) 2967/     E3A : FE FF               		cp	-1
(1) 2968/     E3C : 28 44               		jr	z,.end_setup
(1) 2969/     E3E : FD 23               		inc	iy
(1) 2970/     E40 : 6F                  		ld	l,a
(1) 2971/     E41 : FD 66 00            		ld	h,(iy)
(1) 2972/     E44 : E5                  		push	hl
(1) 2973/     E45 : DD E1               		pop	ix
(1) 2974/     E47 : DD 71 14            		ld	(ix+trk_Priority),c
(1) 2975/     E4A : DD 36 01 FF         		ld	(ix+trk_seqId),-1	; Reset sequence ID
(1) 2976/     E4E : FD 23               		inc	iy
(1) 2977/     E50 : 11 26 00            		ld	de,trk_ChnList		; ** settings
(1) 2978/     E53 : 19                  		add	hl,de
(1) 2979/     E54 :                     	; iy - src
(1) 2980/     E54 :                     	; hl - dst
(1) 2981/     E54 : 06 0A               		ld	b,5*2
(1) 2982/     E56 :                     .st_copy:
(1) 2983/     E56 : FD 7E 00            		ld	a,(iy)
(1) 2984/     E59 : 77                  		ld	(hl),a
(1) 2985/     E5A : FD 23               		inc	iy
(1) 2986/     E5C : 23                  		inc	hl
(1) 2987/     E5D : 10 F7               		djnz	.st_copy
(1) 2988/     E5F : 0C                  		inc	c
(1) 2989/     E60 : FD 7E 00            		ld	a,(iy)			; MAX blocks
(1) 2990/     E63 : DD 77 1D            		ld	(ix+trk_MaxBlks),a
(1) 2991/     E66 : FD 23               		inc	iy
(1) 2992/     E68 : FD 7E 00            		ld	a,(iy)			; MAX heads
(1) 2993/     E6B : DD 77 1E            		ld	(ix+trk_MaxHdrs),a
(1) 2994/     E6E : FD 23               		inc	iy
(1) 2995/     E70 : FD 7E 00            		ld	a,(iy)			; MAX intruments
(1) 2996/     E73 : DD 77 1F            		ld	(ix+trk_MaxIns),a
(1) 2997/     E76 : FD 23               		inc	iy
(1) 2998/     E78 : FD 7E 00            		ld	a,(iy)			; MAX channels
(1) 2999/     E7B : DD 77 1C            		ld	(ix+trk_MaxChnls),a
(1) 3000/     E7E : FD 23               		inc	iy
(1) 3001/     E80 : 18 B5               		jr	.setup_list
(1) 3002/     E82 :                     .end_setup:
(1) 3003/     E82 : 1E 00               		ld	e,0
(1) 3004/     E84 : C3 D9 04            		jp	init_RomTrcks
(1) 3005/     E87 :                     
(1) 3006/     E87 :                     ; --------------------------------------------------------
(1) 3007/     E87 :                     ; get_tick
(1) 3008/     E87 :                     ;
(1) 3009/     E87 :                     ; Checks if VBlank triggred a TICK
(1) 3010/     E87 :                     ; (1/150 NTSC, 1/120 PAL)
(1) 3011/     E87 :                     ; --------------------------------------------------------
(1) 3012/     E87 :                     
(1) 3013/     E87 :                     get_tick:
(1) 3014/     E87 : F3                  		di				; Disable ints
(1) 3015/     E88 : F5                  		push	af
(1) 3016/     E89 : E5                  		push	hl
(1) 3017/     E8A : 21 04 17            		ld	hl,tickFlag		; read last TICK flag
(1) 3018/     E8D : 7E                  		ld	a,(hl)			; non-zero value (1Fh)?
(1) 3019/     E8E : B7                  		or 	a
(1) 3020/     E8F : 28 13               		jr	z,.ctnotick
(1) 3021/     E91 : 36 00               		ld	(hl),0			; Reset TICK flag
(1) 3022/     E93 : 23                  		inc	hl			; Move to tickCnt
(1) 3023/     E94 : 34                  		inc	(hl)			; and increment
(1) 3024/     E95 : CF                  		rst	8
(1) 3025/     E96 : D5                  		push	de
(1) 3026/     E97 : 2A 1C 00            		ld	hl,(sbeatAcc)		; Increment subbeats
(1) 3027/     E9A : ED 5B 1E 00         		ld	de,(sbeatPtck)
(1) 3028/     E9E : CF                  		rst	8
(1) 3029/     E9F : 19                  		add	hl,de
(1) 3030/     EA0 : 22 1C 00            		ld	(sbeatAcc),hl
(1) 3031/     EA3 : D1                  		pop	de
(1) 3032/     EA4 :                     .ctnotick:
(1) 3033/     EA4 : E1                  		pop	hl
(1) 3034/     EA5 : F1                  		pop	af
(1) 3035/     EA6 : FB                  		ei				; Enable ints again
(1) 3036/     EA7 : C9                  		ret
(1) 3037/     EA8 :                     
(1) 3038/     EA8 :                     ; --------------------------------------------------------
(1) 3039/     EA8 :                     ; showRom
(1) 3040/     EA8 :                     ; Get ROM bank position.
(1) 3041/     EA8 :                     ;
(1) 3042/     EA8 :                     ; Input:
(1) 3043/     EA8 :                     ;  b - 68k address $xx0000
(1) 3044/     EA8 :                     ; hl - 68k address $00xxxx
(1) 3045/     EA8 :                     ;
(1) 3046/     EA8 :                     ; Output:
(1) 3047/     EA8 :                     ; hl - ROM position ready to use for reading
(1) 3048/     EA8 :                     ; --------------------------------------------------------
(1) 3049/     EA8 :                     
(1) 3050/     EA8 :                     showRom:
(1) 3051/     EA8 : CF                  		rst	8
(1) 3052/     EA9 : D5                  		push	de
(1) 3053/     EAA : C5                  		push	bc
(1) 3054/     EAB : 11 00 60            		ld	de,6000h
(1) 3055/     EAE : 7C                  		ld	a,h
(1) 3056/     EAF : 07                  		rlca
(1) 3057/     EB0 : CF                  		rst	8
(1) 3058/     EB1 : 12                  		ld	(de),a
(1) 3059/     EB2 : 78                  		ld	a,b
(1) 3060/     EB3 : 12                  		ld	(de),a
(1) 3061/     EB4 : 1F                  		rra
(1) 3062/     EB5 : 12                  		ld	(de),a
(1) 3063/     EB6 : 1F                  		rra
(1) 3064/     EB7 : 12                  		ld	(de),a
(1) 3065/     EB8 : 1F                  		rra
(1) 3066/     EB9 : CF                  		rst	8
(1) 3067/     EBA : 12                  		ld	(de),a
(1) 3068/     EBB : 1F                  		rra
(1) 3069/     EBC : 12                  		ld	(de),a
(1) 3070/     EBD : 1F                  		rra
(1) 3071/     EBE : 12                  		ld	(de),a
(1) 3072/     EBF : 1F                  		rra
(1) 3073/     EC0 : 12                  		ld	(de),a
(1) 3074/     EC1 : 1F                  		rra
(1) 3075/     EC2 : 12                  		ld	(de),a
(1) 3076/     EC3 : C1                  		pop	bc
(1) 3077/     EC4 : D1                  		pop	de
(1) 3078/     EC5 : CB FC               		set	7,h
(1) 3079/     EC7 : C9                  		ret
(1) 3080/     EC8 :                     
(1) 3081/     EC8 :                     ; --------------------------------------------------------
(1) 3082/     EC8 :                     ; transferRom
(1) 3083/     EC8 :                     ;
(1) 3084/     EC8 :                     ; Transfer bytes from ROM to RAM. This also tells
(1) 3085/     EC8 :                     ; to 68k that we want to access ROM
(1) 3086/     EC8 :                     ;
(1) 3087/     EC8 :                     ; Input:
(1) 3088/     EC8 :                     ; a  - 68K Address $xx0000
(1) 3089/     EC8 :                     ;  c - Byte count (size 0 NOT allowed, MAX: 0FFh)
(1) 3090/     EC8 :                     ; hl - 68K Address $00xxxx
(1) 3091/     EC8 :                     ; de - Destination pointer
(1) 3092/     EC8 :                     ;
(1) 3093/     EC8 :                     ; Uses:
(1) 3094/     EC8 :                     ; b
(1) 3095/     EC8 :                     ;
(1) 3096/     EC8 :                     ; Notes:
(1) 3097/     EC8 :                     ; call RST 20h first if transfering anything other
(1) 3098/     EC8 :                     ; than sample data, just to be safe.
(1) 3099/     EC8 :                     ; --------------------------------------------------------
(1) 3100/     EC8 :                     
(1) 3101/     EC8 :                     transferRom:
(1) 3102/     EC8 : CF                  		rst	8
(1) 3103/     EC9 : DD E5               		push	ix
(1) 3104/     ECB : DD 21 81 00         		ld	ix,commZRomBlk	; ix - rom read/block flags
(1) 3105/     ECF : 22 36 00            		ld	(x68ksrclsb),hl	; save hl copy
(1) 3106/     ED2 : CB BC               		res	7,h
(1) 3107/     ED4 : 06 00               		ld	b,0
(1) 3108/     ED6 : 0B                  		dec	bc
(1) 3109/     ED7 : 09                  		add	hl,bc
(1) 3110/     ED8 : CB 7C               		bit	7,h
(1) 3111/     EDA : 20 0B               		jr	nz,.double
(1) 3112/     EDC : 2A 36 00            		ld	hl,(x68ksrclsb)	; single transfer
(1) 3113/     EDF : 0C                  		inc	c
(1) 3114/     EE0 : 47                  		ld	b,a
(1) 3115/     EE1 : CD 0B 0F            		call	.transfer
(1) 3116/     EE4 : DD E1               		pop	ix
(1) 3117/     EE6 : C9                  		ret
(1) 3118/     EE7 :                     .double:
(1) 3119/     EE7 : CF                  		rst	8
(1) 3120/     EE8 : 47                  		ld	b,a		; double transfer
(1) 3121/     EE9 : C5                  		push	bc
(1) 3122/     EEA : E5                  		push	hl
(1) 3123/     EEB : 79                  		ld	a,c
(1) 3124/     EEC : 95                  		sub	a,l
(1) 3125/     EED : 4F                  		ld	c,a
(1) 3126/     EEE : 2A 36 00            		ld	hl,(x68ksrclsb)
(1) 3127/     EF1 : CD 0B 0F            		call	.transfer
(1) 3128/     EF4 : E1                  		pop	hl
(1) 3129/     EF5 : C1                  		pop	bc
(1) 3130/     EF6 :                     ; 		rst	8
(1) 3131/     EF6 : 4D                  		ld	c,l
(1) 3132/     EF7 : 0C                  		inc	c
(1) 3133/     EF8 : 3A 37 00            		ld	a,(x68ksrcmid)
(1) 3134/     EFB : E6 80               		and	80h
(1) 3135/     EFD : C6 80               		add	a,80h
(1) 3136/     EFF : 67                  		ld	h,a
(1) 3137/     F00 : 2E 00               		ld	l,0
(1) 3138/     F02 : 30 01               		jr	nc,.x68knocarry
(1) 3139/     F04 : 04                  		inc	b
(1) 3140/     F05 :                     .x68knocarry:
(1) 3141/     F05 : CD 0B 0F            		call	.transfer
(1) 3142/     F08 : DD E1               		pop	ix
(1) 3143/     F0A : C9                  		ret
(1) 3144/     F0B :                     
(1) 3145/     F0B :                     ; ------------------------------------------------
(1) 3146/     F0B :                     ; b  - Source ROM xx0000
(1) 3147/     F0B :                     ;  c - Bytes to transfer (00h not allowed)
(1) 3148/     F0B :                     ; hl - Source ROM 00xxxx (OR'd with 8000h)
(1) 3149/     F0B :                     ; de - Destination address
(1) 3150/     F0B :                     ; ix - Location of the ROM block flag(s)
(1) 3151/     F0B :                     ;
(1) 3152/     F0B :                     ; Uses:
(1) 3153/     F0B :                     ; a
(1) 3154/     F0B :                     ; ------------------------------------------------
(1) 3155/     F0B :                     
(1) 3156/     F0B :                     .transfer:
(1) 3157/     F0B : CD A8 0E            		call	showRom		; Pick ROM bank
(1) 3158/     F0E :                     
(1) 3159/     F0E :                     	; Transfer ROM data in packets
(1) 3160/     F0E :                     	; while playing the cache'd sample
(1) 3161/     F0E :                     	; *** CRITICAL PROCESS ***
(1) 3162/     F0E :                     	;
(1) 3163/     F0E :                     	; pseudo-reference
(1) 3164/     F0E :                     	; for ldir:
(1) 3165/     F0E :                     	; ld (de),(hl)	; load (hl) to (de), no a
(1) 3166/     F0E :                     	; inc de	; next de
(1) 3167/     F0E :                     	; inc hl	; next hl
(1) 3168/     F0E :                     	; dec bc	; decrement bc
(1) 3169/     F0E :                     	;
(1) 3170/     F0E : 06 00               		ld	b,0
(1) 3171/     F10 : 79                  		ld	a,c		; a - Size counter
(1) 3172/     F11 : D6 08               		sub	MAX_TRFRPZ	; Length lower than MAX_TRFRPZ?
(1) 3173/     F13 : 38 14               		jr	c,.x68klast	; Process single piece only
(1) 3174/     F15 :                     .x68kloop:
(1) 3175/     F15 : CF                  		rst	8
(1) 3176/     F16 : 00                  		nop
(1) 3177/     F17 : 0E 07               		ld	c,MAX_TRFRPZ-1
(1) 3178/     F19 : DD CB 00 46         		bit	0,(ix)		; Genesis requests LOCK?
(1) 3179/     F1D : C4 37 0F            		call	nz,.x68klpwt
(1) 3180/     F20 : ED B0               		ldir			; (de) to (hl) until bc == 0
(1) 3181/     F22 : CF                  		rst	8
(1) 3182/     F23 : 00                  		nop
(1) 3183/     F24 : D6 07               		sub	a,MAX_TRFRPZ-1
(1) 3184/     F26 : D2 15 0F            		jp	nc,.x68kloop
(1) 3185/     F29 :                     ; last block
(1) 3186/     F29 :                     .x68klast:
(1) 3187/     F29 : CF                  		rst	8
(1) 3188/     F2A : C6 08               		add	a,MAX_TRFRPZ
(1) 3189/     F2C : 4F                  		ld	c,a
(1) 3190/     F2D : DD CB 00 46         		bit	0,(ix)		; Genesis requests LOCK?
(1) 3191/     F31 : C4 37 0F            		call	nz,.x68klpwt
(1) 3192/     F34 : ED B0               		ldir
(1) 3193/     F36 : C9                  		ret
(1) 3194/     F37 :                     
(1) 3195/     F37 :                     ; Wait here until Genesis unlocks ROM
(1) 3196/     F37 :                     .x68klpwt:
(1) 3197/     F37 : CF                  		rst	8
(1) 3198/     F38 : 00                  		nop
(1) 3199/     F39 : 00                  		nop
(1) 3200/     F3A : 00                  		nop
(1) 3201/     F3B : 00                  		nop
(1) 3202/     F3C :                     .x68kpwtlp:
(1) 3203/     F3C : CF                  		rst	8
(1) 3204/     F3D : 00                  		nop
(1) 3205/     F3E : 00                  		nop
(1) 3206/     F3F : 00                  		nop
(1) 3207/     F40 : 00                  		nop
(1) 3208/     F41 : DD CB 00 46         		bit	0,(ix)		; 68k finished?
(1) 3209/     F45 : 20 F5               		jr	nz,.x68kpwtlp
(1) 3210/     F47 : CF                  		rst	8
(1) 3211/     F48 : C9                  		ret
(1) 3212/     F49 :                     
(1) 3213/     F49 :                     ; ====================================================================
(1) 3214/     F49 :                     ; ----------------------------------------------------------------
(1) 3215/     F49 :                     ; Sound chip routines
(1) 3216/     F49 :                     ; ----------------------------------------------------------------
(1) 3217/     F49 :                     
(1) 3218/     F49 :                     ; --------------------------------------------------------
(1) 3219/     F49 :                     ; chip_env
(1) 3220/     F49 :                     ;
(1) 3221/     F49 :                     ; Process PSG and FM
(1) 3222/     F49 :                     ; --------------------------------------------------------
(1) 3223/     F49 :                     
(1) 3224/     F49 :                     chip_env:
(1) 3225/     F49 : FD 21 7E 16         		ld	iy,psgcom+3		; Start from NOISE first
(1) 3226/     F4D : DD 21 11 7F         		ld	ix,Zpsg_ctrl
(1) 3227/     F51 : 0E E0               		ld	c,0E0h			; c - PSG first ctrl command
(1) 3228/     F53 : 06 04               		ld	b,4			; b - 4 channels
(1) 3229/     F55 :                     .vloop:
(1) 3230/     F55 : CF                  		rst	8
(1) 3231/     F56 : FD 5E 00            		ld	e,(iy+COM)		; e - current command
(1) 3232/     F59 : FD 36 00 00         		ld	(iy+COM),0
(1) 3233/     F5D :                     
(1) 3234/     F5D :                     	; ----------------------------
(1) 3235/     F5D :                     	; bit 2 - stop sound
(1) 3236/     F5D : CB 53               		bit	2,e
(1) 3237/     F5F : 28 0C               		jr	z,.ckof
(1) 3238/     F61 : FD 36 04 FF         		ld	(iy+LEV),-1		; reset level
(1) 3239/     F65 : FD 36 28 01         		ld	(iy+FLG),1		; and update
(1) 3240/     F69 : FD 36 18 00         		ld	(iy+MODE),0		; envelope off
(1) 3241/     F6D :                     .ckof:
(1) 3242/     F6D :                     
(1) 3243/     F6D :                     	; ----------------------------
(1) 3244/     F6D :                     	; bit 1 - key off
(1) 3245/     F6D : CB 4B               		bit	1,e
(1) 3246/     F6F : 28 0F               		jr      z,.ckon
(1) 3247/     F71 : FD 7E 18            		ld	a,(iy+MODE)		; mode 0?
(1) 3248/     F74 : B7                  		or	a
(1) 3249/     F75 : 28 09               		jr	z,.ckon
(1) 3250/     F77 : FD 36 28 01         		ld	(iy+FLG),1		; psg update flag
(1) 3251/     F7B : FD 36 18 04         		ld	(iy+MODE),100b		; set envelope mode 100b
(1) 3252/     F7F : CF                  		rst	8
(1) 3253/     F80 :                     .ckon:
(1) 3254/     F80 :                     
(1) 3255/     F80 :                     	; ----------------------------
(1) 3256/     F80 :                     	; bit 0 - key on
(1) 3257/     F80 : CB 43               		bit	0,e
(1) 3258/     F82 : 28 1A               		jr	z,.envproc
(1) 3259/     F84 : FD 36 04 FF         		ld	(iy+LEV),-1		; reset level
(1) 3260/     F88 : 78                  		ld	a,b
(1) 3261/     F89 : FE 04               		cp	4			; NOISE channel?
(1) 3262/     F8B : 20 08               		jr	nz,.nskip
(1) 3263/     F8D : CF                  		rst	8			; Set NOISE mode
(1) 3264/     F8E : 3A 06 17            		ld	a,(psgHatMode)		; write hat mode only.
(1) 3265/     F91 : B1                  		or	c
(1) 3266/     F92 : DD 77 00            		ld	(ix),a
(1) 3267/     F95 :                     .nskip:
(1) 3268/     F95 : FD 36 28 01         		ld	(iy+FLG),1		; psg update flag
(1) 3269/     F99 : CF                  		rst	8
(1) 3270/     F9A : FD 36 18 01         		ld	(iy+MODE),001b		; set to attack mode
(1) 3271/     F9E :                     .nblock:
(1) 3272/     F9E :                     
(1) 3273/     F9E :                     	; ----------------------------
(1) 3274/     F9E :                     	; Process effects
(1) 3275/     F9E :                     	; ----------------------------
(1) 3276/     F9E :                     .envproc:
(1) 3277/     F9E : FD 7E 18            		ld	a,(iy+MODE)
(1) 3278/     FA1 : B7                  		or	a			; no modes
(1) 3279/     FA2 : CA 28 10            		jp	z,.vedlp
(1) 3280/     FA5 : FE 01               		cp 	001b			; Attack mode
(1) 3281/     FA7 : 20 2C               		jr	nz,.chk2
(1) 3282/     FA9 : FD 36 28 01         		ld	(iy+FLG),1		; psg update flag
(1) 3283/     FAD : FD 5E 24            		ld	e,(iy+ALV)
(1) 3284/     FB0 : FD 7E 08            		ld	a,(iy+ATK)		; if ATK == 0, don't use
(1) 3285/     FB3 : B7                  		or	a
(1) 3286/     FB4 : 28 16               		jr	z,.atkend
(1) 3287/     FB6 : 57                  		ld	d,a			; c - attack rate
(1) 3288/     FB7 : 7B                  		ld	a,e			; a - attack level
(1) 3289/     FB8 : CF                  		rst	8
(1) 3290/     FB9 : FD 5E 24            		ld	e,(iy+ALV)		; b - OLD attack level
(1) 3291/     FBC : 92                  		sub	a,d			; (attack rate) - (level)
(1) 3292/     FBD : 38 0D               		jr	c,.atkend		; if carry: already finished
(1) 3293/     FBF : 28 0B               		jr	z,.atkend		; if zero: no attack rate
(1) 3294/     FC1 : BB                  		cp	e			; attack rate == level?
(1) 3295/     FC2 : 38 08               		jr	c,.atkend
(1) 3296/     FC4 : 28 06               		jr	z,.atkend
(1) 3297/     FC6 : FD 77 04            		ld	(iy+LEV),a		; set new level
(1) 3298/     FC9 : CF                  		rst	8
(1) 3299/     FCA : 18 5C               		jr	.vedlp
(1) 3300/     FCC :                     .atkend:
(1) 3301/     FCC : FD 73 04            		ld	(iy+LEV),e		; attack level = new level
(1) 3302/     FCF :                     .atkzero:
(1) 3303/     FCF : FD 36 18 02         		ld	(iy+MODE),010b		; set to decay mode
(1) 3304/     FD3 : 18 53               		jr	.vedlp
(1) 3305/     FD5 :                     .chk2:
(1) 3306/     FD5 :                     
(1) 3307/     FD5 : FE 02               		cp	010b			; Decay mode
(1) 3308/     FD7 : 20 31               		jr	nz,.chk4
(1) 3309/     FD9 :                     .dectmr:
(1) 3310/     FD9 : FD 36 28 01         		ld	(iy+FLG),1		; psg update flag
(1) 3311/     FDD : FD 7E 04            		ld	a,(iy+LEV)		; a - Level
(1) 3312/     FE0 : FD 5E 10            		ld	e,(iy+SLV)		; b - Sustain
(1) 3313/     FE3 : BB                  		cp	e
(1) 3314/     FE4 : 38 0D               		jr	c,.dkadd		; if carry: add
(1) 3315/     FE6 : 28 18               		jr	z,.dkyend		; if zero:  finish
(1) 3316/     FE8 : CF                  		rst	8
(1) 3317/     FE9 : FD 96 0C            		sub	(iy+DKY)		; substract decay rate
(1) 3318/     FEC : 38 12               		jr	c,.dkyend		; finish if wraped.
(1) 3319/     FEE : BB                  		cp	e			; compare level
(1) 3320/     FEF : 38 0F               		jr	c,.dkyend		; and finish
(1) 3321/     FF1 : 18 08               		jr	.dksav
(1) 3322/     FF3 :                     .dkadd:
(1) 3323/     FF3 : FD 86 0C            		add	a,(iy+DKY)		;  (level) + (decay rate)
(1) 3324/     FF6 : 38 08               		jr	c,.dkyend		; finish if wraped.
(1) 3325/     FF8 : BB                  		cp	e			; compare level
(1) 3326/     FF9 : 30 05               		jr	nc,.dkyend
(1) 3327/     FFB :                     .dksav:
(1) 3328/     FFB : FD 77 04            		ld	(iy+LEV),a		; save new level
(1) 3329/     FFE : 18 28               		jr	.vedlp
(1) 3330/    1000 :                     .dkyend:
(1) 3331/    1000 : CF                  		rst	8
(1) 3332/    1001 : FD 73 04            		ld	(iy+LEV),e		; save last attack
(1) 3333/    1004 : FD 36 18 04         		ld	(iy+MODE),100b		; and set to sustain
(1) 3334/    1008 : 18 1E               		jr	.vedlp
(1) 3335/    100A :                     .chk4:
(1) 3336/    100A : FE 04               		cp	100b			; Sustain phase
(1) 3337/    100C : 20 1A               		jr	nz,.vedlp
(1) 3338/    100E : FD 36 28 01         		ld	(iy+FLG),1		; psg update flag
(1) 3339/    1012 : FD 7E 04            		ld	a,(iy+LEV)		; a - Level
(1) 3340/    1015 : CF                  		rst	8
(1) 3341/    1016 : FD 86 14            		add 	a,(iy+RRT)		; add Release Rate
(1) 3342/    1019 : 38 05               		jr	c,.killenv		; release done
(1) 3343/    101B : FD 77 04            		ld	(iy+LEV),a		; set new Level
(1) 3344/    101E : 18 08               		jr	.vedlp
(1) 3345/    1020 :                     .killenv:
(1) 3346/    1020 : FD 36 04 FF         		ld	(iy+LEV),-1		; Silence this channel
(1) 3347/    1024 : FD 36 18 00         		ld	(iy+MODE),0		; Reset mode
(1) 3348/    1028 :                     .vedlp:
(1) 3349/    1028 :                     
(1) 3350/    1028 :                     	; ----------------------------
(1) 3351/    1028 :                     	; PSG UPDATE
(1) 3352/    1028 :                     	; ----------------------------
(1) 3353/    1028 : FD 7E 28            		ld	a,(iy+FLG)
(1) 3354/    102B : B7                  		or	a
(1) 3355/    102C : 28 72               		jr	z,.noupd
(1) 3356/    102E : FD 36 28 00         		ld	(iy+FLG),0	; Reset until next one
(1) 3357/    1032 : 59                  		ld	e,c
(1) 3358/    1033 : 3A 06 17            		ld	a,(psgHatMode)
(1) 3359/    1036 : 57                  		ld	d,a
(1) 3360/    1037 : E6 03               		and	011b
(1) 3361/    1039 : FE 03               		cp	011b
(1) 3362/    103B : 20 1D               		jr	nz,.normal
(1) 3363/    103D : CF                  		rst	8
(1) 3364/    103E : 78                  		ld	a,b		; Channel 4?
(1) 3365/    103F : FE 03               		cp	3
(1) 3366/    1041 : 28 13               		jr	z,.silnc_3
(1) 3367/    1043 : FE 04               		cp	4
(1) 3368/    1045 : 20 18               		jr	nz,.do_nfreq
(1) 3369/    1047 : 3A 06 17            		ld	a,(psgHatMode)
(1) 3370/    104A : 57                  		ld	d,a
(1) 3371/    104B : E6 03               		and	011b
(1) 3372/    104D : CF                  		rst	8
(1) 3373/    104E : FE 03               		cp	011b
(1) 3374/    1050 : 20 30               		jr	nz,.vonly
(1) 3375/    1052 : 1E C0               		ld	e,0C0h
(1) 3376/    1054 : 18 09               		jr	.do_nfreq
(1) 3377/    1056 :                     .silnc_3:
(1) 3378/    1056 : 3E FF               		ld	a,-1
(1) 3379/    1058 : 18 32               		jr	.vlmuch
(1) 3380/    105A :                     .normal:
(1) 3381/    105A : 78                  		ld	a,b
(1) 3382/    105B : FE 04               		cp	4
(1) 3383/    105D : 28 23               		jr	z,.vonly
(1) 3384/    105F :                     .do_nfreq:
(1) 3385/    105F : FD 6E 1C            		ld	l,(iy+DTL)
(1) 3386/    1062 : FD 66 20            		ld	h,(iy+DTH)
(1) 3387/    1065 :                     
(1) 3388/    1065 :                     	; freq effects go here
(1) 3389/    1065 :                     	; (save e FIRST.)
(1) 3390/    1065 :                     	;	push	de
(1) 3391/    1065 :                     	;	pop	de
(1) 3392/    1065 : 7D                  		ld	a,l		; Grab LSB 4 right bits
(1) 3393/    1066 : E6 0F               		and	00001111b
(1) 3394/    1068 : B3                  		or	e		; OR with channel set in e
(1) 3395/    1069 : CF                  		rst	8
(1) 3396/    106A : DD 77 00            		ld	(ix),a		; write it
(1) 3397/    106D : 7D                  		ld	a,l		; Grab LSB 4 left bits
(1) 3398/    106E : 0F                  		rrca
(1) 3399/    106F : 0F                  		rrca
(1) 3400/    1070 : 0F                  		rrca
(1) 3401/    1071 : 0F                  		rrca
(1) 3402/    1072 : E6 0F               		and	00001111b
(1) 3403/    1074 : 5F                  		ld	e,a
(1) 3404/    1075 : 7C                  		ld	a,h		; Grab MSB bits
(1) 3405/    1076 : CF                  		rst	8
(1) 3406/    1077 : 07                  		rlca
(1) 3407/    1078 : 07                  		rlca
(1) 3408/    1079 : 07                  		rlca
(1) 3409/    107A : 07                  		rlca
(1) 3410/    107B : E6 30               		and	00110000b
(1) 3411/    107D : B3                  		or	e
(1) 3412/    107E : DD 77 00            		ld	(ix),a
(1) 3413/    1081 : CF                  		rst	8
(1) 3414/    1082 :                     .vonly:
(1) 3415/    1082 : FD 7E 30            		ld	a,(iy+PVOL)		; c - Level
(1) 3416/    1085 : FD 86 04            		add	a,(iy+LEV)		; Add MASTER volume
(1) 3417/    1088 : 30 02               		jr	nc,.vlmuch
(1) 3418/    108A : 3E FF               		ld	a,-1
(1) 3419/    108C :                     .vlmuch:
(1) 3420/    108C : CB 3F               		srl	a			; (Level >> 4)
(1) 3421/    108E : CB 3F               		srl	a
(1) 3422/    1090 : CB 3F               		srl	a
(1) 3423/    1092 : CF                  		rst	8
(1) 3424/    1093 : CB 3F               		srl	a
(1) 3425/    1095 : E6 0F               		and	00001111b		; Filter volume value
(1) 3426/    1097 : B1                  		or	c			; and OR with current channel
(1) 3427/    1098 : F6 90               		or	90h			; Set volume-set mode
(1) 3429/    109A : DD 77 00            		ld	(ix),a			; *** WRITE volume
(1) 3431/    109D : FD 34 38            		inc	(iy+PTMR)		; Update general timer
(1) 3432/    10A0 :                     .noupd:
(1) 3433/    10A0 :                     	; ----------------------------
(1) 3434/    10A0 : FD 2B               		dec	iy			; next COM to check
(1) 3435/    10A2 : 79                  		ld	a,c
(1) 3436/    10A3 : CF                  		rst	8
(1) 3437/    10A4 : D6 20               		sub	a,20h			; next PSG backwards
(1) 3438/    10A6 : 4F                  		ld	c,a
(1) 3439/    10A7 : 05                  		dec	b
(1) 3440/    10A8 : C2 55 0F            		jp	nz,.vloop
(1) 3441/    10AB : C9                  		ret
(1) 3442/    10AC :                     
(1) 3443/    10AC :                     ; ---------------------------------------------
(1) 3444/    10AC :                     ; FM register writes
(1) 3445/    10AC :                     ;
(1) 3446/    10AC :                     ; Input:
(1) 3447/    10AC :                     ; d - ctrl
(1) 3448/    10AC :                     ; e - data
(1) 3449/    10AC :                     ; ---------------------------------------------
(1) 3450/    10AC :                     
(1) 3451/    10AC :                     ; c - KeyID
(1) 3452/    10AC :                     fm_autoreg:
(1) 3453/    10AC : CB 51               		bit	2,c
(1) 3454/    10AE : CC B5 10            		call	z,fm_send_1
(1) 3455/    10B1 : C4 C0 10            		call	nz,fm_send_2
(1) 3456/    10B4 : C9                  		ret
(1) 3457/    10B5 :                     ; Channels 1-3 and global registers
(1) 3458/    10B5 :                     fm_send_1:
(1) 3459/    10B5 : 7A                  		ld	a,d
(1) 3460/    10B6 : 32 00 40            		ld	(Zym_ctrl_1),a
(1) 3461/    10B9 : 00                  		nop
(1) 3462/    10BA : 7B                  		ld	a,e
(1) 3463/    10BB : 32 01 40            		ld	(Zym_data_1),a
(1) 3464/    10BE : 00                  		nop
(1) 3465/    10BF : C9                  		ret
(1) 3466/    10C0 :                     ; Channels 4-6
(1) 3467/    10C0 :                     fm_send_2:
(1) 3468/    10C0 : 7A                  		ld	a,d
(1) 3469/    10C1 : 32 02 40            		ld	(Zym_ctrl_2),a
(1) 3470/    10C4 : 00                  		nop
(1) 3471/    10C5 : 7B                  		ld	a,e
(1) 3472/    10C6 : 32 03 40            		ld	(Zym_data_2),a
(1) 3473/    10C9 : 00                  		nop
(1) 3474/    10CA : C9                  		ret
(1) 3475/    10CB :                     
(1) 3476/    10CB :                     ; --------------------------------------------------------
(1) 3477/    10CB :                     ; brute-force WAVE ON/OFF playback
(1) 3478/    10CB :                     ; --------------------------------------------------------
(1) 3479/    10CB :                     
(1) 3480/    10CB :                     dac_on:
(1) 3481/    10CB : 3E 2B               		ld	a,2Bh
(1) 3482/    10CD : 32 00 40            		ld	(Zym_ctrl_1),a
(1) 3483/    10D0 : 3E 80               		ld	a,80h
(1) 3484/    10D2 : 32 01 40            		ld	(Zym_data_1),a
(1) 3485/    10D5 : 3E D9               		ld 	a,zopcExx
(1) 3486/    10D7 : 32 08 00            		ld	(dac_me),a
(1) 3487/    10DA : 3E F5               		ld 	a,zopcPushAf
(1) 3488/    10DC : 32 20 00            		ld	(dac_fill),a
(1) 3489/    10DF : C9                  		ret
(1) 3490/    10E0 :                     dac_off:
(1) 3491/    10E0 : 3E 2B               		ld	a,2Bh
(1) 3492/    10E2 : 32 00 40            		ld	(Zym_ctrl_1),a
(1) 3493/    10E5 : 3E 00               		ld	a,00h
(1) 3494/    10E7 : 32 01 40            		ld	(Zym_data_1),a
(1) 3495/    10EA : 3E C9               		ld 	a,zopcRet
(1) 3496/    10EC : 32 08 00            		ld	(dac_me),a
(1) 3497/    10EF : 3E C9               		ld 	a,zopcRet
(1) 3498/    10F1 : 32 20 00            		ld	(dac_fill),a
(1) 3499/    10F4 : C9                  		ret
(1) 3500/    10F5 :                     
(1) 3501/    10F5 :                     ; --------------------------------------------------------
(1) 3502/    10F5 :                     ; dac_play
(1) 3503/    10F5 :                     ;
(1) 3504/    10F5 :                     ; Plays a new sample
(1) 3505/    10F5 :                     ;
(1) 3506/    10F5 :                     ; NOTE:
(1) 3507/    10F5 :                     ; Set wave_Flags and wave_Pitch externally
(1) 3508/    10F5 :                     ; getting here.
(1) 3509/    10F5 :                     ; --------------------------------------------------------
(1) 3510/    10F5 :                     
(1) 3511/    10F5 :                     dac_play:
(1) 3512/    10F5 : F3                  		di
(1) 3513/    10F6 : CD E0 10            		call	dac_off
(1) 3514/    10F9 : D9                  		exx				; flip exx regs
(1) 3515/    10FA : 01 1D 00            		ld	bc,dWaveBuff>>8		; bc - WAVFIFO MSB
(1) 3516/    10FD : ED 5B 00 17         		ld	de,(wave_Pitch)		; de - Pitch
(1) 3517/    1101 : 21 00 00            		ld	hl,(dWaveBuff&0FFh)<<8	; hl - WAVFIFO LSB pointer (xx.00)
(1) 3518/    1104 : D9                  		exx				; move them back
(1) 3519/    1105 : 2A F7 16            		ld	hl,(wave_Start)
(1) 3520/    1108 : 3A F9 16            		ld 	a,(wave_Start+2)
(1) 3521/    110B : 22 30 00            		ld	(dDacPntr),hl
(1) 3522/    110E : 32 32 00            		ld	(dDacPntr+2),a
(1) 3523/    1111 : 2A FA 16            		ld	hl,(wave_Len)
(1) 3524/    1114 : 3A FC 16            		ld 	a,(wave_Len+2)
(1) 3525/    1117 : 22 33 00            		ld	(dDacCntr),hl
(1) 3526/    111A : 32 35 00            		ld	(dDacCntr+2),a
(1) 3527/    111D : AF                  		xor	a
(1) 3528/    111E : 32 2F 00            		ld	(dDacFifoMid),a
(1) 3529/    1121 : CD 29 11            		call	dac_firstfill
(1) 3530/    1124 : CD CB 10            		call	dac_on
(1) 3531/    1127 : FB                  		ei
(1) 3532/    1128 : C9                  		ret
(1) 3533/    1129 :                     
(1) 3534/    1129 :                     ; --------------------------------------------------------
(1) 3535/    1129 :                     
(1) 3536/    1129 :                     dac_firstfill:
(1) 3537/    1129 :                     ; 		push	af
(1) 3538/    1129 :                     dac_refill:
(1) 3539/    1129 : CF                  		rst	8
(1) 3540/    112A : C5                  		push	bc
(1) 3541/    112B : D5                  		push	de
(1) 3542/    112C : E5                  		push	hl
(1) 3543/    112D : 3A 02 17            		ld	a,(wave_Flags)	; Already finished?
(1) 3544/    1130 : FE 07               		cp	111b
(1) 3545/    1132 : D2 E8 11            		jp	nc,.dacfill_end
(1) 3546/    1135 : 3A 35 00            		ld	a,(dDacCntr+2)	; Last bytes
(1) 3547/    1138 : 2A 33 00            		ld	hl,(dDacCntr)
(1) 3548/    113B : 01 80 00            		ld	bc,80h
(1) 3549/    113E : 37                  		scf
(1) 3550/    113F : 3F                  		ccf
(1) 3551/    1140 : ED 42               		sbc	hl,bc
(1) 3552/    1142 : DE 00               		sbc	a,0
(1) 3553/    1144 : 32 35 00            		ld	(dDacCntr+2),a
(1) 3554/    1147 : 22 33 00            		ld	(dDacCntr),hl
(1) 3555/    114A : 16 1D               		ld	d,dWaveBuff>>8
(1) 3556/    114C : B7                  		or	a
(1) 3557/    114D : FA 77 11            		jp	m,.dac_over
(1) 3558/    1150 : 3A 2F 00            		ld	a,(dDacFifoMid)	; Update halfway value
(1) 3559/    1153 : 5F                  		ld	e,a
(1) 3560/    1154 : C6 80               		add 	a,80h
(1) 3561/    1156 : 32 2F 00            		ld	(dDacFifoMid),a
(1) 3562/    1159 : 2A 30 00            		ld	hl,(dDacPntr)
(1) 3563/    115C : 3A 32 00            		ld	a,(dDacPntr+2)
(1) 3564/    115F : CD C8 0E            		call	transferRom	; *** ROM ACCESS ***
(1) 3565/    1162 : 2A 30 00            		ld	hl,(dDacPntr)
(1) 3566/    1165 : 3A 32 00            		ld	a,(dDacPntr+2)
(1) 3567/    1168 : 01 80 00            		ld	bc,80h
(1) 3568/    116B : 09                  		add	hl,bc
(1) 3569/    116C : CE 00               		adc	a,0
(1) 3570/    116E : 22 30 00            		ld	(dDacPntr),hl
(1) 3571/    1171 : 32 32 00            		ld	(dDacPntr+2),a
(1) 3572/    1174 : C3 EB 11            		jp	.dacfill_ret
(1) 3573/    1177 :                     
(1) 3574/    1177 :                     ; NOTE:
(1) 3575/    1177 :                     ; This doesn't finish at the exact
(1) 3576/    1177 :                     ; the END point.
(1) 3577/    1177 :                     .dac_over:
(1) 3578/    1177 : 16 1D               		ld	d,dWaveBuff>>8
(1) 3579/    1179 : 3A 02 17            		ld	a,(wave_Flags)	; LOOP enabled?
(1) 3580/    117C : E6 01               		and	001b
(1) 3581/    117E : C2 A1 11            		jp	nz,.dacfill_loop
(1) 3582/    1181 : 7D                  		ld	a,l
(1) 3583/    1182 : C6 80               		add	a,80h
(1) 3584/    1184 : 4F                  		ld	c,a
(1) 3585/    1185 : 06 00               		ld	b,0
(1) 3586/    1187 : C5                  		push	bc
(1) 3587/    1188 : 3A 2F 00            		ld	a,(dDacFifoMid)
(1) 3588/    118B : 5F                  		ld	e,a
(1) 3589/    118C : C6 80               		add	a,80h
(1) 3590/    118E : 32 2F 00            		ld	(dDacFifoMid),a
(1) 3591/    1191 : C1                  		pop	bc
(1) 3592/    1192 : 79                  		ld	a,c
(1) 3593/    1193 : B0                  		or	b
(1) 3594/    1194 : 28 52               		jr	z,.dacfill_end
(1) 3595/    1196 : 2A 30 00            		ld	hl,(dDacPntr)
(1) 3596/    1199 : 3A 32 00            		ld	a,(dDacPntr+2)
(1) 3597/    119C : CD C8 0E            		call	transferRom	; *** ROM ACCESS ***
(1) 3598/    119F : 18 47               		jr	.dacfill_end
(1) 3599/    11A1 :                     .dacfill_loop:
(1) 3600/    11A1 :                     	; loop sample
(1) 3601/    11A1 : C5                  		push	bc
(1) 3602/    11A2 : D5                  		push	de
(1) 3603/    11A3 : 3A FF 16            		ld	a,(wave_Loop+2)
(1) 3604/    11A6 : 4F                  		ld	c,a
(1) 3605/    11A7 : ED 5B FD 16         		ld	de,(wave_Loop)
(1) 3606/    11AB : 2A F7 16            		ld	hl,(wave_Start)
(1) 3607/    11AE : 3A F9 16            		ld 	a,(wave_Start+2)
(1) 3608/    11B1 : 81                  		add	a,c
(1) 3609/    11B2 : 19                  		add	hl,de
(1) 3610/    11B3 : CE 00               		adc	a,0
(1) 3611/    11B5 : 22 30 00            		ld	(dDacPntr),hl
(1) 3612/    11B8 : 32 32 00            		ld	(dDacPntr+2),a
(1) 3613/    11BB : 2A FA 16            		ld	hl,(wave_Len)
(1) 3614/    11BE : 3A FC 16            		ld 	a,(wave_Len+2)
(1) 3615/    11C1 : 91                  		sub	a,c
(1) 3616/    11C2 : 37                  		scf
(1) 3617/    11C3 : 3F                  		ccf
(1) 3618/    11C4 : ED 52               		sbc	hl,de
(1) 3619/    11C6 : DE 00               		sbc	a,0
(1) 3620/    11C8 : 22 33 00            		ld	(dDacCntr),hl
(1) 3621/    11CB : 32 35 00            		ld	(dDacCntr+2),a
(1) 3622/    11CE : D1                  		pop	de
(1) 3623/    11CF : C1                  		pop	bc
(1) 3624/    11D0 : 78                  		ld	a,b
(1) 3625/    11D1 : B1                  		or	c
(1) 3626/    11D2 : 28 17               		jr	z,.dacfill_ret
(1) 3627/    11D4 : 3A 2F 00            		ld	a,(dDacFifoMid)
(1) 3628/    11D7 : 5F                  		ld	e,a
(1) 3629/    11D8 : C6 80               		add	a,80h
(1) 3630/    11DA : 32 2F 00            		ld	(dDacFifoMid),a
(1) 3631/    11DD : 2A 30 00            		ld	hl,(dDacPntr)
(1) 3632/    11E0 : 3A 32 00            		ld	a,(dDacPntr+2)
(1) 3633/    11E3 : CD C8 0E            		call	transferRom	; *** ROM ACCESS ***
(1) 3634/    11E6 : 18 03               		jr	.dacfill_ret
(1) 3635/    11E8 :                     
(1) 3636/    11E8 :                     .dacfill_end:
(1) 3637/    11E8 : CD E0 10            		call	dac_off		; DAC finished
(1) 3638/    11EB :                     
(1) 3639/    11EB :                     .dacfill_ret:
(1) 3640/    11EB : E1                  		pop	hl
(1) 3641/    11EC : D1                  		pop	de
(1) 3642/    11ED : C1                  		pop	bc
(1) 3643/    11EE :                     ; 		pop	af
(1) 3644/    11EE : C9                  		ret
(1) 3645/    11EF :                     
(1) 3646/    11EF :                     ; ====================================================================
(1) 3647/    11EF :                     ; ----------------------------------------------------------------
(1) 3648/    11EF :                     ; Tables
(1) 3649/    11EF :                     ; ----------------------------------------------------------------
(1) 3650/    11EF :                     
(1) 3651/    11EF : 84 02               fmFreq_List:	dw 644
(1) 3652/    11F1 : A9 02               		dw 681
(1) 3653/    11F3 : D2 02               		dw 722
(1) 3654/    11F5 : FD 02               		dw 765
(1) 3655/    11F7 : 2A 03               		dw 810
(1) 3656/    11F9 : 5A 03               		dw 858
(1) 3657/    11FB : 8E 03               		dw 910
(1) 3658/    11FD : C4 03               		dw 964
(1) 3659/    11FF : FD 03               		dw 1021
(1) 3660/    1201 : 39 04               		dw 1081
(1) 3661/    1203 : 7A 04               		dw 1146
(1) 3662/    1205 : BE 04               		dw 1214
(1) 3663/    1207 :                     psgFreq_List:
(1) 3664/    1207 : FF FF               		dw -1		; C-0 00
(1) 3665/    1209 : FF FF               		dw -1
(1) 3666/    120B : FF FF               		dw -1
(1) 3667/    120D : FF FF               		dw -1
(1) 3668/    120F : FF FF               		dw -1
(1) 3669/    1211 : FF FF               		dw -1
(1) 3670/    1213 : FF FF               		dw -1
(1) 3671/    1215 : FF FF               		dw -1
(1) 3672/    1217 : FF FF               		dw -1
(1) 3673/    1219 : FF FF               		dw -1
(1) 3674/    121B : FF FF               		dw -1
(1) 3675/    121D : FF FF               		dw -1
(1) 3676/    121F : FF FF               		dw -1		; C-1 0C
(1) 3677/    1221 : FF FF               		dw -1
(1) 3678/    1223 : FF FF               		dw -1
(1) 3679/    1225 : FF FF               		dw -1
(1) 3680/    1227 : FF FF               		dw -1
(1) 3681/    1229 : FF FF               		dw -1
(1) 3682/    122B : FF FF               		dw -1
(1) 3683/    122D : FF FF               		dw -1
(1) 3684/    122F : FF FF               		dw -1
(1) 3685/    1231 : FF FF               		dw -1
(1) 3686/    1233 : FF FF               		dw -1
(1) 3687/    1235 : FF FF               		dw -1
(1) 3688/    1237 : FF FF               		dw -1		; C-2 18
(1) 3689/    1239 : FF FF               		dw -1
(1) 3690/    123B : FF FF               		dw -1
(1) 3691/    123D : FF FF               		dw -1
(1) 3692/    123F : FF FF               		dw -1
(1) 3693/    1241 : FF FF               		dw -1
(1) 3694/    1243 : FF FF               		dw -1
(1) 3695/    1245 : FF FF               		dw -1
(1) 3696/    1247 : FF FF               		dw -1
(1) 3697/    1249 : FF FF               		dw -1
(1) 3698/    124B : FF FF               		dw -1
(1) 3699/    124D : FF FF               		dw -1
(1) 3700/    124F : FF FF               		dw -1		; C-3 24
(1) 3701/    1251 : FF FF               		dw -1
(1) 3702/    1253 : FF FF               		dw -1
(1) 3703/    1255 : FF FF               		dw -1
(1) 3704/    1257 : FF FF               		dw -1
(1) 3705/    1259 : FF FF               		dw -1
(1) 3706/    125B : FF FF               		dw -1
(1) 3707/    125D : FF FF               		dw -1
(1) 3708/    125F : FF FF               		dw -1
(1) 3709/    1261 : F8 03               		dw 3F8h
(1) 3710/    1263 : BF 03               		dw 3BFh
(1) 3711/    1265 : 89 03               		dw 389h
(1) 3712/    1267 : 56 03               		dw 356h		; C-4 30
(1) 3713/    1269 : 26 03               		dw 326h
(1) 3714/    126B : F9 02               		dw 2F9h
(1) 3715/    126D : CE 02               		dw 2CEh
(1) 3716/    126F : A5 02               		dw 2A5h
(1) 3717/    1271 : 80 02               		dw 280h
(1) 3718/    1273 : 5C 02               		dw 25Ch
(1) 3719/    1275 : 3A 02               		dw 23Ah
(1) 3720/    1277 : 1A 02               		dw 21Ah
(1) 3721/    1279 : FB 01               		dw 1FBh
(1) 3722/    127B : DF 01               		dw 1DFh
(1) 3723/    127D : C4 01               		dw 1C4h
(1) 3724/    127F : AB 01               		dw 1ABh		; C-5 3C
(1) 3725/    1281 : 93 01               		dw 193h
(1) 3726/    1283 : 7D 01               		dw 17Dh
(1) 3727/    1285 : 67 01               		dw 167h
(1) 3728/    1287 : 53 01               		dw 153h
(1) 3729/    1289 : 40 01               		dw 140h
(1) 3730/    128B : 2E 01               		dw 12Eh
(1) 3731/    128D : 1D 01               		dw 11Dh
(1) 3732/    128F : 0D 01               		dw 10Dh
(1) 3733/    1291 : FE 00               		dw 0FEh
(1) 3734/    1293 : EF 00               		dw 0EFh
(1) 3735/    1295 : E2 00               		dw 0E2h
(1) 3736/    1297 : D6 00               		dw 0D6h		; C-6 48
(1) 3737/    1299 : C9 00               		dw 0C9h
(1) 3738/    129B : BE 00               		dw 0BEh
(1) 3739/    129D : B4 00               		dw 0B4h
(1) 3740/    129F : A9 00               		dw 0A9h
(1) 3741/    12A1 : A0 00               		dw 0A0h
(1) 3742/    12A3 : 97 00               		dw 097h
(1) 3743/    12A5 : 8F 00               		dw 08Fh
(1) 3744/    12A7 : 87 00               		dw 087h
(1) 3745/    12A9 : 7F 00               		dw 07Fh
(1) 3746/    12AB : 78 00               		dw 078h
(1) 3747/    12AD : 71 00               		dw 071h
(1) 3748/    12AF : 6B 00               		dw 06Bh		; C-7 54
(1) 3749/    12B1 : 65 00               		dw 065h
(1) 3750/    12B3 : 5F 00               		dw 05Fh
(1) 3751/    12B5 : 5A 00               		dw 05Ah
(1) 3752/    12B7 : 55 00               		dw 055h
(1) 3753/    12B9 : 50 00               		dw 050h
(1) 3754/    12BB : 4B 00               		dw 04Bh
(1) 3755/    12BD : 47 00               		dw 047h
(1) 3756/    12BF : 43 00               		dw 043h
(1) 3757/    12C1 : 40 00               		dw 040h
(1) 3758/    12C3 : 3C 00               		dw 03Ch
(1) 3759/    12C5 : 39 00               		dw 039h
(1) 3760/    12C7 : 36 00               		dw 036h		; C-8 60
(1) 3761/    12C9 : 33 00               		dw 033h
(1) 3762/    12CB : 30 00               		dw 030h
(1) 3763/    12CD : 2D 00               		dw 02Dh
(1) 3764/    12CF : 2B 00               		dw 02Bh
(1) 3765/    12D1 : 28 00               		dw 028h
(1) 3766/    12D3 : 26 00               		dw 026h
(1) 3767/    12D5 : 24 00               		dw 024h
(1) 3768/    12D7 : 22 00               		dw 022h
(1) 3769/    12D9 : 20 00               		dw 020h
(1) 3770/    12DB : 1F 00               		dw 01Fh
(1) 3771/    12DD : 1D 00               		dw 01Dh
(1) 3772/    12DF : 1B 00               		dw 01Bh		; C-9 6C
(1) 3773/    12E1 : 1A 00               		dw 01Ah
(1) 3774/    12E3 : 18 00               		dw 018h
(1) 3775/    12E5 : 17 00               		dw 017h
(1) 3776/    12E7 : 16 00               		dw 016h
(1) 3777/    12E9 : 15 00               		dw 015h
(1) 3778/    12EB : 13 00               		dw 013h
(1) 3779/    12ED : 12 00               		dw 012h
(1) 3780/    12EF : 11 00               		dw 011h
(1) 3781/    12F1 : 10 00                		dw 010h
(1) 3782/    12F3 : 09 00                		dw 009h
(1) 3783/    12F5 : 08 00                		dw 008h
(1) 3784/    12F7 : 06 00               		dw 006h
(1) 3785/    12F9 :                     
(1) 3786/    12F9 : 00 01               wavFreq_List:	dw 100h		; C-0
(1) 3787/    12FB : 00 01               		dw 100h
(1) 3788/    12FD : 00 01               		dw 100h
(1) 3789/    12FF : 00 01               		dw 100h
(1) 3790/    1301 : 00 01               		dw 100h
(1) 3791/    1303 : 00 01               		dw 100h
(1) 3792/    1305 : 00 01               		dw 100h
(1) 3793/    1307 : 00 01               		dw 100h
(1) 3794/    1309 : 00 01               		dw 100h
(1) 3795/    130B : 00 01               		dw 100h
(1) 3796/    130D : 00 01               		dw 100h
(1) 3797/    130F : 00 01               		dw 100h
(1) 3798/    1311 : 00 01               		dw 100h		; C-1
(1) 3799/    1313 : 00 01               		dw 100h
(1) 3800/    1315 : 00 01               		dw 100h
(1) 3801/    1317 : 00 01               		dw 100h
(1) 3802/    1319 : 00 01               		dw 100h
(1) 3803/    131B : 00 01               		dw 100h
(1) 3804/    131D : 00 01               		dw 100h
(1) 3805/    131F : 00 01               		dw 100h
(1) 3806/    1321 : 00 01               		dw 100h
(1) 3807/    1323 : 00 01               		dw 100h
(1) 3808/    1325 : 00 01               		dw 100h
(1) 3809/    1327 : 00 01               		dw 100h
(1) 3810/    1329 : 00 01               		dw 100h		; C-2
(1) 3811/    132B : 00 01               		dw 100h
(1) 3812/    132D : 00 01               		dw 100h
(1) 3813/    132F : 00 01               		dw 100h
(1) 3814/    1331 : 00 01               		dw 100h
(1) 3815/    1333 : 00 01               		dw 100h
(1) 3816/    1335 : 00 01               		dw 100h
(1) 3817/    1337 : 00 01               		dw 100h
(1) 3818/    1339 : 00 01               		dw 100h
(1) 3819/    133B : 00 01               		dw 100h
(1) 3820/    133D : 36 00               		dw 036h
(1) 3821/    133F : 3B 00               		dw 03Bh
(1) 3822/    1341 : 3E 00               		dw 03Eh		; C-3
(1) 3823/    1343 : 43 00               		dw 043h		; C#3
(1) 3824/    1345 : 46 00               		dw 046h		; D-3
(1) 3825/    1347 : 49 00               		dw 049h		; D#3
(1) 3826/    1349 : 4E 00               		dw 04Eh		; E-3
(1) 3827/    134B : 54 00               		dw 054h		; F-3
(1) 3828/    134D : 58 00               		dw 058h		; F#3
(1) 3829/    134F : 5E 00               		dw 05Eh		; G-3 -17
(1) 3830/    1351 : 63 00               		dw 063h		; G#3
(1) 3831/    1353 : 68 00               		dw 068h		; A-3
(1) 3832/    1355 : 70 00               		dw 070h		; A#3
(1) 3833/    1357 : 75 00               		dw 075h		; B-3
(1) 3834/    1359 : 85 00               		dw 085h		; C-4 -12
(1) 3835/    135B : 87 00               		dw 087h		; C#4
(1) 3836/    135D : 8C 00               		dw 08Ch		; D-4
(1) 3837/    135F : 9A 00               		dw 09Ah		; D#4
(1) 3838/    1361 : 9E 00               		dw 09Eh		; E-4
(1) 3839/    1363 : AD 00               		dw 0ADh		; F-4
(1) 3840/    1365 : B2 00               		dw 0B2h		; F#4
(1) 3841/    1367 : C0 00               		dw 0C0h		; G-4
(1) 3842/    1369 : CC 00               		dw 0CCh		; G#4
(1) 3843/    136B : D7 00               		dw 0D7h		; A-4
(1) 3844/    136D : E6 00               		dw 0E6h		; A#4
(1) 3845/    136F : F0 00               		dw 0F0h		; B-4
(1) 3846/    1371 : 00 01               		dw 100h		; C-5 ****
(1) 3847/    1373 : 10 01               		dw 110h		; C#5
(1) 3848/    1375 : 20 01               		dw 120h		; D-5
(1) 3849/    1377 : 2E 01               		dw 12Eh		; D#5
(1) 3850/    1379 : 42 01               		dw 142h		; E-5
(1) 3851/    137B : 5A 01               		dw 15Ah		; F-5
(1) 3852/    137D : 6A 01               		dw 16Ah		; F#5 +6
(1) 3853/    137F : 7F 01               		dw 17Fh		; G-5
(1) 3854/    1381 : 91 01               		dw 191h		; G#5
(1) 3855/    1383 : AC 01               		dw 1ACh		; A-5
(1) 3856/    1385 : C2 01               		dw 1C2h		; A#5
(1) 3857/    1387 : E0 01               		dw 1E0h		; B-5
(1) 3858/    1389 : F8 01               		dw 1F8h		; C-6 +12
(1) 3859/    138B : 10 02               		dw 210h		; C#6
(1) 3860/    138D : 40 02               		dw 240h		; D-6
(1) 3861/    138F : 60 02               		dw 260h		; D#6
(1) 3862/    1391 : 80 02               		dw 280h		; E-6
(1) 3863/    1393 : A0 02               		dw 2A0h		; F-6
(1) 3864/    1395 : D0 02               		dw 2D0h		; F#6
(1) 3865/    1397 : F8 02               		dw 2F8h		; G-6
(1) 3866/    1399 : 20 03               		dw 320h		; G#6
(1) 3867/    139B : 50 03               		dw 350h		; A-6
(1) 3868/    139D : 80 03               		dw 380h		; A#6
(1) 3869/    139F : C0 03               		dw 3C0h		; B-6
(1) 3870/    13A1 : 00 04               		dw 400h		; C-7
(1) 3871/    13A3 : 00 01               		dw 100h
(1) 3872/    13A5 : 00 01               		dw 100h
(1) 3873/    13A7 : 00 01               		dw 100h
(1) 3874/    13A9 : 00 01               		dw 100h
(1) 3875/    13AB : 00 01               		dw 100h
(1) 3876/    13AD : 00 01               		dw 100h
(1) 3877/    13AF : 00 01               		dw 100h
(1) 3878/    13B1 : 00 01               		dw 100h
(1) 3879/    13B3 : 00 01               		dw 100h
(1) 3880/    13B5 : 00 01               		dw 100h
(1) 3881/    13B7 : 00 01               		dw 100h
(1) 3882/    13B9 : 00 01               		dw 100h		; C-8
(1) 3883/    13BB : 00 01               		dw 100h
(1) 3884/    13BD : 00 01               		dw 100h
(1) 3885/    13BF : 00 01               		dw 100h
(1) 3886/    13C1 : 00 01               		dw 100h
(1) 3887/    13C3 : 00 01               		dw 100h
(1) 3888/    13C5 : 00 01               		dw 100h
(1) 3889/    13C7 : 00 01               		dw 100h
(1) 3890/    13C9 : 00 01               		dw 100h
(1) 3891/    13CB : 00 01               		dw 100h
(1) 3892/    13CD : 00 01               		dw 100h
(1) 3893/    13CF : 00 01               		dw 100h
(1) 3894/    13D1 : 00 01               		dw 100h		; C-9
(1) 3895/    13D3 : 00 01               		dw 100h
(1) 3896/    13D5 : 00 01               		dw 100h
(1) 3897/    13D7 : 00 01               		dw 100h
(1) 3898/    13D9 : 00 01               		dw 100h
(1) 3899/    13DB : 00 01               		dw 100h
(1) 3900/    13DD : 00 01               		dw 100h
(1) 3901/    13DF : 00 01               		dw 100h
(1) 3902/    13E1 : 00 01               		dw 100h
(1) 3903/    13E3 : 00 01               		dw 100h
(1) 3904/    13E5 : 00 01               		dw 100h
(1) 3905/    13E7 : 00 01               		dw 100h
(1) 3906/    13E9 :                     
(1) 3907/    13E9 : 53 15               fmcach_list:	dw fmcach_1
(1) 3908/    13EB : 7B 15               		dw fmcach_2
(1) 3909/    13ED : A3 15               		dw fmcach_3
(1) 3910/    13EF : 00 00               		dw 0		; <-- skipped
(1) 3911/    13F1 : CB 15               		dw fmcach_4
(1) 3912/    13F3 : F3 15               		dw fmcach_5
(1) 3913/    13F5 : 1B 16               		dw fmcach_6
(1) 3914/    13F7 :                     
(1) 3915/    13F7 :                     ; ====================================================================
(1) 3916/    13F7 :                     ; ----------------------------------------------------------------
(1) 3917/    13F7 :                     ; MASTER buffers list
(1) 3918/    13F7 :                     ;
(1) 3919/    13F7 :                     ; dw track_buffer
(1) 3920/    13F7 :                     ; dw channel_list,block_cache,header_cache,instr_cache,track_cache
(1) 3921/    13F7 :                     ; db max_blocks,max_headers,max_instr,max_chnls
(1) 3922/    13F7 :                     ;
(1) 3923/    13F7 :                     ; (track_cache: 1BIT SIZES ONLY, ALIGNED)
(1) 3924/    13F7 :                     ; ----------------------------------------------------------------
(1) 3925/    13F7 :                     
(1) 3926/    13F7 :                     nikona_BuffList:
(1) 3927/    13F7 : 1D 17 AD 17 61 1B   	dw trkBuff_0,trkChnl_0,trkBlks_0,trkHdrs_0,trkInsD_0,trkCach_0
                    45 19 F9 19 00 1E 
(1) 3928/    1403 : 18 0F 0F 11         	db MAX_BLOCKS,MAX_HEADS,MAX_INS,MAX_TRKCHN
(1) 3929/    1407 : 4D 17 35 18 79 1B   	dw trkBuff_1,trkChnl_1,trkBlks_1,trkHdrs_1,trkInsD_1,trkCach_1
                    81 19 71 1A 40 1E 
(1) 3930/    1413 : 18 0F 0F 11         	db MAX_BLOCKS,MAX_HEADS,MAX_INS,MAX_TRKCHN
(1) 3931/    1417 : 7D 17 BD 18 91 1B   	dw trkBuff_2,trkChnl_2,trkBlks_2,trkHdrs_2,trkInsD_2,trkCach_2
                    BD 19 E9 1A 80 1E 
(1) 3932/    1423 : 18 0F 0F 11         	db MAX_BLOCKS,MAX_HEADS,MAX_INS,MAX_TRKCHN
(1) 3933/    1427 : FF FF               	dw -1
(1) 3934/    1429 :                     
(1) 3935/    1429 :                     nikona_SetMstrList:
(1) 3936/    1429 : 00                  	db 0				; ** 32-bit 68k address **
(1) 3937/    142A : FF                  	db (Gema_MasterList>>16)&0FFh
(1) 3938/    142B : 42                  	db (Gema_MasterList>>8)&0FFh
(1) 3939/    142C : 5A                  	db Gema_MasterList&0FFh
(1) 3940/    142D :                     
(1) 3941/    142D :                     ; ====================================================================
(1) 3942/    142D :                     ; ----------------------------------------------------------------
(1) 3943/    142D :                     ; Buffer section
(1) 3944/    142D :                     ; ----------------------------------------------------------------
(1) 3945/    142D :                     
(1) 3946/    142D :                     ; --------------------------------------------------------
(1) 3947/    142D :                     ; Channel table struct:
(1) 3948/    142D :                     ; 00  - Linked tracker channel
(1) 3949/    142D :                     ; 02  - 00h-7Fh: Priority level / 80h+ Silence request (chip ID)
(1) 3950/    142D :                     ; 03  - Intrument cache pointer
(1) 3951/    142D :                     ; 05  - Chip index (YM2612: KEY index)
(1) 3952/    142D :                     ; 06  - Frequency list index (YM2612: oct|index)
(1) 3953/    142D :                     ; 07  - Pitchbend add/sub
(1) 3954/    142D :                     ; 08  - Current volume: 00-max
(1) 3955/    142D :                     ; 09  - Stored effect setting
(1) 3956/    142D :                     ; 0A  - FREE
(1) 3957/    142D :                     ; 0B  - FREE
(1) 3958/    142D :                     ; 0C+ - Misc. settings for the current chip
(1) 3959/    142D :                     
(1) 3960/    142D :                     ; PSG   80h
(1) 3961/    142D :                     ; PSGN  90h
(1) 3962/    142D :                     ; FM   0A0h
(1) 3963/    142D :                     ; FM3  0B0h
(1) 3964/    142D :                     ; DAC  0C0h
(1) 3965/    142D :                     ; PWM  0D0h
(1) 3966/    142D :                     ; --------------------------------------------------------
(1) 3967/    142D :                     
(1) 3968/    142D : 10 00               tblList:	dw tblPSG-tblList		;  80h
(1) 3969/    142F : 42 80               		dw tblPSGN-tblList|8000h	;  90h *
(1) 3970/    1431 : 52 00               		dw tblFM-tblList		; 0A0h
(1) 3971/    1433 : 92 80               		dw tblFM3-tblList|8000h		; 0B0h *
(1) 3972/    1435 : A2 80               		dw tblFM6-tblList|8000h		; 0C0h *
(1) 3973/    1437 : B4 00               		dw tblPWM-tblList		; 0D0h
(1) 3974/    1439 : 00 00               		dw 0
(1) 3975/    143B : 00 00               		dw 0
(1) 3976/    143D : 00 00 00 00 00 00   tblPSG:		db 00h,00h,00h,00h,00h,00h,00h,00h	; Channel 1
                    00 00 
(1) 3977/    1445 : 00 00 00 00 00 00   		db 00h,00h,00h,00h,00h,00h,00h,00h
                    00 00 
(1) 3978/    144D : 00 00 00 00 00 01   		db 00h,00h,00h,00h,00h,01h,00h,00h	; Channel 2
                    00 00 
(1) 3979/    1455 : 00 00 00 00 00 00   		db 00h,00h,00h,00h,00h,00h,00h,00h
                    00 00 
(1) 3980/    145D : 00 00 00 00 00 02   		db 00h,00h,00h,00h,00h,02h,00h,00h	; Channel 3
                    00 00 
(1) 3981/    1465 : 00 00 00 00 00 00   		db 00h,00h,00h,00h,00h,00h,00h,00h
                    00 00 
(1) 3982/    146D : FF FF               		dw -1	; end-of-list
(1) 3983/    146F : 00 00 00 00 00 03   tblPSGN:	db 00h,00h,00h,00h,00h,03h,00h,03h	; Noise
                    00 03 
(1) 3984/    1477 : 00 00 00 00 00 00   		db 00h,00h,00h,00h,00h,00h,00h,00h
                    00 00 
(1) 3985/    147F : 00 00 00 00 00 00   tblFM:		db 00h,00h,00h,00h,00h,00h,00h,00h	; Channel 1
                    00 00 
(1) 3986/    1487 : 00 00 00 00 00 00   		db 00h,00h,00h,00h,00h,00h,00h,00h
                    00 00 
(1) 3987/    148F : 00 00 00 00 00 01   		db 00h,00h,00h,00h,00h,01h,00h,00h	; Channel 2
                    00 00 
(1) 3988/    1497 : 00 00 00 00 00 00   		db 00h,00h,00h,00h,00h,00h,00h,00h
                    00 00 
(1) 3989/    149F : 00 00 00 00 00 04   		db 00h,00h,00h,00h,00h,04h,00h,00h	; Channel 4 <--
                    00 00 
(1) 3990/    14A7 : 00 00 00 00 00 00   		db 00h,00h,00h,00h,00h,00h,00h,00h
                    00 00 
(1) 3991/    14AF : 00 00 00 00 00 05   		db 00h,00h,00h,00h,00h,05h,00h,00h	; Channel 5
                    00 00 
(1) 3992/    14B7 : 00 00 00 00 00 00   		db 00h,00h,00h,00h,00h,00h,00h,00h
                    00 00 
(1) 3993/    14BF : 00 00 00 00 00 02   tblFM3:		db 00h,00h,00h,00h,00h,02h,00h,00h	; Channel 3 <--
                    00 00 
(1) 3994/    14C7 : 00 00 00 00 00 00   		db 00h,00h,00h,00h,00h,00h,00h,00h
                    00 00 
(1) 3995/    14CF : 00 00 00 00 00 06   tblFM6:		db 00h,00h,00h,00h,00h,06h,00h,00h	; Channel 6 <--
                    00 00 
(1) 3996/    14D7 : 00 00 00 00 00 00   		db 00h,00h,00h,00h,00h,00h,00h,00h
                    00 00 
(1) 3997/    14DF : FF FF               		dw -1	; end-of-list
(1) 3998/    14E1 : 00 00 00 00 00 00   tblPWM:		db 00h,00h,00h,00h,00h,00h,00h,00h	; Channel 1
                    00 00 
(1) 3999/    14E9 : 00 00 00 00 00 00   		db 00h,00h,00h,00h,00h,00h,00h,00h
                    00 00 
(1) 4000/    14F1 : 00 00 00 00 00 01   		db 00h,00h,00h,00h,00h,01h,00h,00h	; Channel 2
                    00 00 
(1) 4001/    14F9 : 00 00 00 00 00 00   		db 00h,00h,00h,00h,00h,00h,00h,00h
                    00 00 
(1) 4002/    1501 : 00 00 00 00 00 02   		db 00h,00h,00h,00h,00h,02h,00h,00h	; Channel 3
                    00 00 
(1) 4003/    1509 : 00 00 00 00 00 00   		db 00h,00h,00h,00h,00h,00h,00h,00h
                    00 00 
(1) 4004/    1511 : 00 00 00 00 00 03   		db 00h,00h,00h,00h,00h,03h,00h,00h	; Channel 4
                    00 00 
(1) 4005/    1519 : 00 00 00 00 00 00   		db 00h,00h,00h,00h,00h,00h,00h,00h
                    00 00 
(1) 4006/    1521 : 00 00 00 00 00 04   		db 00h,00h,00h,00h,00h,04h,00h,00h	; Channel 5
                    00 00 
(1) 4007/    1529 : 00 00 00 00 00 00   		db 00h,00h,00h,00h,00h,00h,00h,00h
                    00 00 
(1) 4008/    1531 : 00 00 00 00 00 05   		db 00h,00h,00h,00h,00h,05h,00h,00h	; Channel 6
                    00 00 
(1) 4009/    1539 : 00 00 00 00 00 00   		db 00h,00h,00h,00h,00h,00h,00h,00h
                    00 00 
(1) 4010/    1541 : 00 00 00 00 00 06   		db 00h,00h,00h,00h,00h,06h,00h,00h	; Channel 7
                    00 00 
(1) 4011/    1549 : 00 00 00 00 00 00   		db 00h,00h,00h,00h,00h,00h,00h,00h
                    00 00 
(1) 4012/    1551 : FF FF               		dw -1	; end-of-list
(1) 4013/    1553 :                     
(1) 4014/    1553 :                     ; FM patch storage
(1) 4015/    1553 :                     fmcach_1	ds 28h
(1) 4016/    157B :                     fmcach_2	ds 28h
(1) 4017/    15A3 :                     fmcach_3	ds 28h
(1) 4018/    15CB :                     fmcach_4	ds 28h
(1) 4019/    15F3 :                     fmcach_5	ds 28h
(1) 4020/    161B :                     fmcach_6	ds 28h
(1) 4021/    1643 :                     
(1) 4022/    1643 : 00 00 00 00 00 00   pwmcom:	db 00h,00h,00h,00h,00h,00h,00h,00h	; 0 - Playback bits: KeyOn/KeyOff/KeyCut bits
                    00 00 
(1) 4023/    164B : 00 00 00 00 00 00   	db 00h,00h,00h,00h,00h,00h,00h,00h	; 8 - Volume | Pitch MSB
                    00 00 
(1) 4024/    1653 : 00 00 00 00 00 00   	db 00h,00h,00h,00h,00h,00h,00h,00h	; 16 - Pitch LSB
                    00 00 
(1) 4025/    165B : 00 00 00 00 00 00   	db 00h,00h,00h,00h,00h,00h,00h,00h	; 24 - Flags: Stereo/Loop/Left/Right | 32-bit**
                    00 00 
(1) 4026/    1663 : 00 00 00 00 00 00   	db 00h,00h,00h,00h,00h,00h,00h,00h	; 32 - **sample location
                    00 00 
(1) 4027/    166B : 00 00 00 00 00 00   	db 00h,00h,00h,00h,00h,00h,00h,00h
                    00 00 
(1) 4028/    1673 : 00 00 00 00 00 00   	db 00h,00h,00h,00h,00h,00h,00h,00h
                    00 00 
(1) 4029/    167B :                     
(1) 4030/    167B : 00 00 00 00         psgcom:	db 00h,00h,00h,00h	;  0 - command 1 = key on, 2 = key off, 4 = stop snd
(1) 4031/    167F : FF FF FF FF         	db -1, -1, -1, -1	;  4 - output level attenuation (%llll.0000, -1 = silent)
(1) 4032/    1683 : 00 00 00 00         	db 00h,00h,00h,00h	;  8 - attack rate (START)
(1) 4033/    1687 : 00 00 00 00         	db 00h,00h,00h,00h	; 12 - decay rate
(1) 4034/    168B : 00 00 00 00         	db 00h,00h,00h,00h	; 16 - sustain level attenuation (MAXIMUM)
(1) 4035/    168F : 00 00 00 00         	db 00h,00h,00h,00h	; 20 - release rate
(1) 4036/    1693 : 00 00 00 00         	db 00h,00h,00h,00h	; 24 - envelope mode 0 = off, 1 = attack, 2 = decay, 3 = sustain
(1) 4037/    1697 : 00 00 00 00         	db 00h,00h,00h,00h	; 28 - freq bottom 4 bits
(1) 4038/    169B : 00 00 00 00         	db 00h,00h,00h,00h	; 32 - freq upper 6 bits
(1) 4039/    169F : 00 00 00 00         	db 00h,00h,00h,00h	; 36 - attack level attenuation
(1) 4040/    16A3 : 00 00 00 00         	db 00h,00h,00h,00h	; 40 - flags to indicate hardware should be updated
(1) 4041/    16A7 : 00 00 00 00         	db 00h,00h,00h,00h	; 44 - timer for sustain
(1) 4042/    16AB : 00 00 00 00         	db 00h,00h,00h,00h	; 48 - MAX Volume
(1) 4043/    16AF : 00 00 00 00         	db 00h,00h,00h,00h	; 52 - Vibrato value
(1) 4044/    16B3 : 00 00 00 00         	db 00h,00h,00h,00h	; 56 - General timer
(1) 4045/    16B7 :                     
(1) 4046/    16B7 :                     ; mailboxes	ds 40h		; GEMS style mailboxes/events
(1) 4047/    16B7 :                     trkListCach	ds 4*10h	; 40h bytes
(1) 4048/    16F7 : 00 00               wave_Start	dw 0		; START: 68k 24-bit pointer
(1) 4049/    16F9 : 00                  		db 0
(1) 4050/    16FA : 00 00               wave_Len	dw 0		; LENGTH 24-bit
(1) 4051/    16FC : 00                  		db 0
(1) 4052/    16FD : 00 00               wave_Loop	dw 0		; LOOP POINT 24-bit
(1) 4053/    16FF : 00                  		db 0
(1) 4054/    1700 : 00 01               wave_Pitch	dw 0100h	; 01.00h
(1) 4055/    1702 : 00                  wave_Flags	db 0		; WAVE playback flags (%10x: 1 loop / 0 no loop)
(1) 4056/    1703 :                     
(1) 4057/    1703 :                     
(1) 4058/    1703 : 00                  tickSpSet	db 0		; **
(1) 4059/    1704 : 00                  tickFlag	db 0		; Tick flag from VBlank
(1) 4060/    1705 : 00                  tickCnt		db 0		; ** Tick counter (PUT THIS AFTER tickFlag)
(1) 4061/    1706 : 00                  psgHatMode	db 0		; Current PSGN mode
(1) 4062/    1707 : 00                  fmSpecial	db 0		; copy of FM3 enable bit
(1) 4063/    1708 :                     headerOut	ds 00Ch		; Temporal storage for 68k pointers
(1) 4064/    1714 :                     headerOut_e	ds 2
(1) 4065/    1716 :                     sampleHead	ds 006h
(1) 4066/    171C : 00                  commZRead	db 0			; cmd fifo READ pointer (here)
(1) 4067/    171D :                     
(1) 4068/    171D :                     ; --------------------------------------------------------
(1) 4069/    171D :                     ; * USER customizable section *
(1) 4070/    171D :                     ;
(1) 4071/    171D :                     ; trkCach's MUST BE 00h ALIGNED.
(1) 4072/    171D :                     ; --------------------------------------------------------
(1) 4073/    171D :                     
(1) 4074/    171D :                     trkBuff_0	ds 30h			; TRACK BUFFER 0
(1) 4075/    174D :                     trkBuff_1	ds 30h			; TRACK BUFFER 1
(1) 4076/    177D :                     trkBuff_2	ds 30h			; TRACK BUFFER 2
(1) 4077/    17AD :                     ; trkBuff_3	ds 30h			; TRACK BUFFER 3
(1) 4078/    17AD :                     trkChnl_0	ds 8*MAX_TRKCHN
(1) 4079/    1835 :                     trkChnl_1	ds 8*MAX_TRKCHN
(1) 4080/    18BD :                     trkChnl_2	ds 8*MAX_TRKCHN
(1) 4081/    1945 :                     ; trkChnl_3	ds 8*MAX_TRKCHN
(1) 4082/    1945 :                     trkHdrs_0	ds 4*MAX_HEADS		; dw point,rowcntr
(1) 4083/    1981 :                     trkHdrs_1	ds 4*MAX_HEADS
(1) 4084/    19BD :                     trkHdrs_2	ds 4*MAX_HEADS
(1) 4085/    19F9 :                     ; trkHdrs_3	ds 4*MAX_HEADS
(1) 4086/    19F9 :                     trkInsD_0	ds 8*MAX_INS
(1) 4087/    1A71 :                     trkInsD_1	ds 8*MAX_INS
(1) 4088/    1AE9 :                     trkInsD_2	ds 8*MAX_INS
(1) 4089/    1B61 :                     ; trkInsD_3	ds 8*MAX_INS
(1) 4090/    1B61 :                     trkBlks_0	ds MAX_BLOCKS
(1) 4091/    1B79 :                     trkBlks_1	ds MAX_BLOCKS
(1) 4092/    1B91 :                     trkBlks_2	ds MAX_BLOCKS
(1) 4093/    1BA9 :                     ; trkBlks_3	ds MAX_BLOCKS
(1) 4094/    1BA9 :                     
(1) 4095/    1BA9 :                     ; ====================================================================
(1) 4096/    1BA9 :                     ; ----------------------------------------------------------------
(1) 4097/    1BA9 :                     ; WAVE playback buffer
(1) 4098/    1BA9 :                     ;
(1) 4099/    1BA9 :                     ; Located at 200h
(1) 4100/    1BA9 :                     ; ----------------------------------------------------------------
(1) 4101/    1BA9 :                     
(1) 4102/    1BA9 : (MACRO)             		org 1D00h
(1) 4102/    1BA9 : 00                                                  db 0
(1) 4102/    1BAA : 00                                                  db 0
(1) 4102/    1BAB : 00                                                  db 0
(1) 4102/    1BAC : 00                                                  db 0
(1) 4102/    1BAD : 00                                                  db 0
(1) 4102/    1BAE : 00                                                  db 0
(1) 4102/    1BAF : 00                                                  db 0
(1) 4102/    1BB0 : 00                                                  db 0
(1) 4102/    1BB1 : 00                                                  db 0
(1) 4102/    1BB2 : 00                                                  db 0
(1) 4102/    1BB3 : 00                                                  db 0
(1) 4102/    1BB4 : 00                                                  db 0
(1) 4102/    1BB5 : 00                                                  db 0
(1) 4102/    1BB6 : 00                                                  db 0
(1) 4102/    1BB7 : 00                                                  db 0
(1) 4102/    1BB8 : 00                                                  db 0
(1) 4102/    1BB9 : 00                                                  db 0
(1) 4102/    1BBA : 00                                                  db 0
(1) 4102/    1BBB : 00                                                  db 0
(1) 4102/    1BBC : 00                                                  db 0
(1) 4102/    1BBD : 00                                                  db 0
(1) 4102/    1BBE : 00                                                  db 0
(1) 4102/    1BBF : 00                                                  db 0
(1) 4102/    1BC0 : 00                                                  db 0
(1) 4102/    1BC1 : 00                                                  db 0
(1) 4102/    1BC2 : 00                                                  db 0
(1) 4102/    1BC3 : 00                                                  db 0
(1) 4102/    1BC4 : 00                                                  db 0
(1) 4102/    1BC5 : 00                                                  db 0
(1) 4102/    1BC6 : 00                                                  db 0
(1) 4102/    1BC7 : 00                                                  db 0
(1) 4102/    1BC8 : 00                                                  db 0
(1) 4102/    1BC9 : 00                                                  db 0
(1) 4102/    1BCA : 00                                                  db 0
(1) 4102/    1BCB : 00                                                  db 0
(1) 4102/    1BCC : 00                                                  db 0
(1) 4102/    1BCD : 00                                                  db 0
(1) 4102/    1BCE : 00                                                  db 0
(1) 4102/    1BCF : 00                                                  db 0
(1) 4102/    1BD0 : 00                                                  db 0
(1) 4102/    1BD1 : 00                                                  db 0
(1) 4102/    1BD2 : 00                                                  db 0
(1) 4102/    1BD3 : 00                                                  db 0
(1) 4102/    1BD4 : 00                                                  db 0
(1) 4102/    1BD5 : 00                                                  db 0
(1) 4102/    1BD6 : 00                                                  db 0
(1) 4102/    1BD7 : 00                                                  db 0
(1) 4102/    1BD8 : 00                                                  db 0
(1) 4102/    1BD9 : 00                                                  db 0
(1) 4102/    1BDA : 00                                                  db 0
(1) 4102/    1BDB : 00                                                  db 0
(1) 4102/    1BDC : 00                                                  db 0
(1) 4102/    1BDD : 00                                                  db 0
(1) 4102/    1BDE : 00                                                  db 0
(1) 4102/    1BDF : 00                                                  db 0
(1) 4102/    1BE0 : 00                                                  db 0
(1) 4102/    1BE1 : 00                                                  db 0
(1) 4102/    1BE2 : 00                                                  db 0
(1) 4102/    1BE3 : 00                                                  db 0
(1) 4102/    1BE4 : 00                                                  db 0
(1) 4102/    1BE5 : 00                                                  db 0
(1) 4102/    1BE6 : 00                                                  db 0
(1) 4102/    1BE7 : 00                                                  db 0
(1) 4102/    1BE8 : 00                                                  db 0
(1) 4102/    1BE9 : 00                                                  db 0
(1) 4102/    1BEA : 00                                                  db 0
(1) 4102/    1BEB : 00                                                  db 0
(1) 4102/    1BEC : 00                                                  db 0
(1) 4102/    1BED : 00                                                  db 0
(1) 4102/    1BEE : 00                                                  db 0
(1) 4102/    1BEF : 00                                                  db 0
(1) 4102/    1BF0 : 00                                                  db 0
(1) 4102/    1BF1 : 00                                                  db 0
(1) 4102/    1BF2 : 00                                                  db 0
(1) 4102/    1BF3 : 00                                                  db 0
(1) 4102/    1BF4 : 00                                                  db 0
(1) 4102/    1BF5 : 00                                                  db 0
(1) 4102/    1BF6 : 00                                                  db 0
(1) 4102/    1BF7 : 00                                                  db 0
(1) 4102/    1BF8 : 00                                                  db 0
(1) 4102/    1BF9 : 00                                                  db 0
(1) 4102/    1BFA : 00                                                  db 0
(1) 4102/    1BFB : 00                                                  db 0
(1) 4102/    1BFC : 00                                                  db 0
(1) 4102/    1BFD : 00                                                  db 0
(1) 4102/    1BFE : 00                                                  db 0
(1) 4102/    1BFF : 00                                                  db 0
(1) 4102/    1C00 : 00                                                  db 0
(1) 4102/    1C01 : 00                                                  db 0
(1) 4102/    1C02 : 00                                                  db 0
(1) 4102/    1C03 : 00                                                  db 0
(1) 4102/    1C04 : 00                                                  db 0
(1) 4102/    1C05 : 00                                                  db 0
(1) 4102/    1C06 : 00                                                  db 0
(1) 4102/    1C07 : 00                                                  db 0
(1) 4102/    1C08 : 00                                                  db 0
(1) 4102/    1C09 : 00                                                  db 0
(1) 4102/    1C0A : 00                                                  db 0
(1) 4102/    1C0B : 00                                                  db 0
(1) 4102/    1C0C : 00                                                  db 0
(1) 4102/    1C0D : 00                                                  db 0
(1) 4102/    1C0E : 00                                                  db 0
(1) 4102/    1C0F : 00                                                  db 0
(1) 4102/    1C10 : 00                                                  db 0
(1) 4102/    1C11 : 00                                                  db 0
(1) 4102/    1C12 : 00                                                  db 0
(1) 4102/    1C13 : 00                                                  db 0
(1) 4102/    1C14 : 00                                                  db 0
(1) 4102/    1C15 : 00                                                  db 0
(1) 4102/    1C16 : 00                                                  db 0
(1) 4102/    1C17 : 00                                                  db 0
(1) 4102/    1C18 : 00                                                  db 0
(1) 4102/    1C19 : 00                                                  db 0
(1) 4102/    1C1A : 00                                                  db 0
(1) 4102/    1C1B : 00                                                  db 0
(1) 4102/    1C1C : 00                                                  db 0
(1) 4102/    1C1D : 00                                                  db 0
(1) 4102/    1C1E : 00                                                  db 0
(1) 4102/    1C1F : 00                                                  db 0
(1) 4102/    1C20 : 00                                                  db 0
(1) 4102/    1C21 : 00                                                  db 0
(1) 4102/    1C22 : 00                                                  db 0
(1) 4102/    1C23 : 00                                                  db 0
(1) 4102/    1C24 : 00                                                  db 0
(1) 4102/    1C25 : 00                                                  db 0
(1) 4102/    1C26 : 00                                                  db 0
(1) 4102/    1C27 : 00                                                  db 0
(1) 4102/    1C28 : 00                                                  db 0
(1) 4102/    1C29 : 00                                                  db 0
(1) 4102/    1C2A : 00                                                  db 0
(1) 4102/    1C2B : 00                                                  db 0
(1) 4102/    1C2C : 00                                                  db 0
(1) 4102/    1C2D : 00                                                  db 0
(1) 4102/    1C2E : 00                                                  db 0
(1) 4102/    1C2F : 00                                                  db 0
(1) 4102/    1C30 : 00                                                  db 0
(1) 4102/    1C31 : 00                                                  db 0
(1) 4102/    1C32 : 00                                                  db 0
(1) 4102/    1C33 : 00                                                  db 0
(1) 4102/    1C34 : 00                                                  db 0
(1) 4102/    1C35 : 00                                                  db 0
(1) 4102/    1C36 : 00                                                  db 0
(1) 4102/    1C37 : 00                                                  db 0
(1) 4102/    1C38 : 00                                                  db 0
(1) 4102/    1C39 : 00                                                  db 0
(1) 4102/    1C3A : 00                                                  db 0
(1) 4102/    1C3B : 00                                                  db 0
(1) 4102/    1C3C : 00                                                  db 0
(1) 4102/    1C3D : 00                                                  db 0
(1) 4102/    1C3E : 00                                                  db 0
(1) 4102/    1C3F : 00                                                  db 0
(1) 4102/    1C40 : 00                                                  db 0
(1) 4102/    1C41 : 00                                                  db 0
(1) 4102/    1C42 : 00                                                  db 0
(1) 4102/    1C43 : 00                                                  db 0
(1) 4102/    1C44 : 00                                                  db 0
(1) 4102/    1C45 : 00                                                  db 0
(1) 4102/    1C46 : 00                                                  db 0
(1) 4102/    1C47 : 00                                                  db 0
(1) 4102/    1C48 : 00                                                  db 0
(1) 4102/    1C49 : 00                                                  db 0
(1) 4102/    1C4A : 00                                                  db 0
(1) 4102/    1C4B : 00                                                  db 0
(1) 4102/    1C4C : 00                                                  db 0
(1) 4102/    1C4D : 00                                                  db 0
(1) 4102/    1C4E : 00                                                  db 0
(1) 4102/    1C4F : 00                                                  db 0
(1) 4102/    1C50 : 00                                                  db 0
(1) 4102/    1C51 : 00                                                  db 0
(1) 4102/    1C52 : 00                                                  db 0
(1) 4102/    1C53 : 00                                                  db 0
(1) 4102/    1C54 : 00                                                  db 0
(1) 4102/    1C55 : 00                                                  db 0
(1) 4102/    1C56 : 00                                                  db 0
(1) 4102/    1C57 : 00                                                  db 0
(1) 4102/    1C58 : 00                                                  db 0
(1) 4102/    1C59 : 00                                                  db 0
(1) 4102/    1C5A : 00                                                  db 0
(1) 4102/    1C5B : 00                                                  db 0
(1) 4102/    1C5C : 00                                                  db 0
(1) 4102/    1C5D : 00                                                  db 0
(1) 4102/    1C5E : 00                                                  db 0
(1) 4102/    1C5F : 00                                                  db 0
(1) 4102/    1C60 : 00                                                  db 0
(1) 4102/    1C61 : 00                                                  db 0
(1) 4102/    1C62 : 00                                                  db 0
(1) 4102/    1C63 : 00                                                  db 0
(1) 4102/    1C64 : 00                                                  db 0
(1) 4102/    1C65 : 00                                                  db 0
(1) 4102/    1C66 : 00                                                  db 0
(1) 4102/    1C67 : 00                                                  db 0
(1) 4102/    1C68 : 00                                                  db 0
(1) 4102/    1C69 : 00                                                  db 0
(1) 4102/    1C6A : 00                                                  db 0
(1) 4102/    1C6B : 00                                                  db 0
(1) 4102/    1C6C : 00                                                  db 0
(1) 4102/    1C6D : 00                                                  db 0
(1) 4102/    1C6E : 00                                                  db 0
(1) 4102/    1C6F : 00                                                  db 0
(1) 4102/    1C70 : 00                                                  db 0
(1) 4102/    1C71 : 00                                                  db 0
(1) 4102/    1C72 : 00                                                  db 0
(1) 4102/    1C73 : 00                                                  db 0
(1) 4102/    1C74 : 00                                                  db 0
(1) 4102/    1C75 : 00                                                  db 0
(1) 4102/    1C76 : 00                                                  db 0
(1) 4102/    1C77 : 00                                                  db 0
(1) 4102/    1C78 : 00                                                  db 0
(1) 4102/    1C79 : 00                                                  db 0
(1) 4102/    1C7A : 00                                                  db 0
(1) 4102/    1C7B : 00                                                  db 0
(1) 4102/    1C7C : 00                                                  db 0
(1) 4102/    1C7D : 00                                                  db 0
(1) 4102/    1C7E : 00                                                  db 0
(1) 4102/    1C7F : 00                                                  db 0
(1) 4102/    1C80 : 00                                                  db 0
(1) 4102/    1C81 : 00                                                  db 0
(1) 4102/    1C82 : 00                                                  db 0
(1) 4102/    1C83 : 00                                                  db 0
(1) 4102/    1C84 : 00                                                  db 0
(1) 4102/    1C85 : 00                                                  db 0
(1) 4102/    1C86 : 00                                                  db 0
(1) 4102/    1C87 : 00                                                  db 0
(1) 4102/    1C88 : 00                                                  db 0
(1) 4102/    1C89 : 00                                                  db 0
(1) 4102/    1C8A : 00                                                  db 0
(1) 4102/    1C8B : 00                                                  db 0
(1) 4102/    1C8C : 00                                                  db 0
(1) 4102/    1C8D : 00                                                  db 0
(1) 4102/    1C8E : 00                                                  db 0
(1) 4102/    1C8F : 00                                                  db 0
(1) 4102/    1C90 : 00                                                  db 0
(1) 4102/    1C91 : 00                                                  db 0
(1) 4102/    1C92 : 00                                                  db 0
(1) 4102/    1C93 : 00                                                  db 0
(1) 4102/    1C94 : 00                                                  db 0
(1) 4102/    1C95 : 00                                                  db 0
(1) 4102/    1C96 : 00                                                  db 0
(1) 4102/    1C97 : 00                                                  db 0
(1) 4102/    1C98 : 00                                                  db 0
(1) 4102/    1C99 : 00                                                  db 0
(1) 4102/    1C9A : 00                                                  db 0
(1) 4102/    1C9B : 00                                                  db 0
(1) 4102/    1C9C : 00                                                  db 0
(1) 4102/    1C9D : 00                                                  db 0
(1) 4102/    1C9E : 00                                                  db 0
(1) 4102/    1C9F : 00                                                  db 0
(1) 4102/    1CA0 : 00                                                  db 0
(1) 4102/    1CA1 : 00                                                  db 0
(1) 4102/    1CA2 : 00                                                  db 0
(1) 4102/    1CA3 : 00                                                  db 0
(1) 4102/    1CA4 : 00                                                  db 0
(1) 4102/    1CA5 : 00                                                  db 0
(1) 4102/    1CA6 : 00                                                  db 0
(1) 4102/    1CA7 : 00                                                  db 0
(1) 4102/    1CA8 : 00                                                  db 0
(1) 4102/    1CA9 : 00                                                  db 0
(1) 4102/    1CAA : 00                                                  db 0
(1) 4102/    1CAB : 00                                                  db 0
(1) 4102/    1CAC : 00                                                  db 0
(1) 4102/    1CAD : 00                                                  db 0
(1) 4102/    1CAE : 00                                                  db 0
(1) 4102/    1CAF : 00                                                  db 0
(1) 4102/    1CB0 : 00                                                  db 0
(1) 4102/    1CB1 : 00                                                  db 0
(1) 4102/    1CB2 : 00                                                  db 0
(1) 4102/    1CB3 : 00                                                  db 0
(1) 4102/    1CB4 : 00                                                  db 0
(1) 4102/    1CB5 : 00                                                  db 0
(1) 4102/    1CB6 : 00                                                  db 0
(1) 4102/    1CB7 : 00                                                  db 0
(1) 4102/    1CB8 : 00                                                  db 0
(1) 4102/    1CB9 : 00                                                  db 0
(1) 4102/    1CBA : 00                                                  db 0
(1) 4102/    1CBB : 00                                                  db 0
(1) 4102/    1CBC : 00                                                  db 0
(1) 4102/    1CBD : 00                                                  db 0
(1) 4102/    1CBE : 00                                                  db 0
(1) 4102/    1CBF : 00                                                  db 0
(1) 4102/    1CC0 : 00                                                  db 0
(1) 4102/    1CC1 : 00                                                  db 0
(1) 4102/    1CC2 : 00                                                  db 0
(1) 4102/    1CC3 : 00                                                  db 0
(1) 4102/    1CC4 : 00                                                  db 0
(1) 4102/    1CC5 : 00                                                  db 0
(1) 4102/    1CC6 : 00                                                  db 0
(1) 4102/    1CC7 : 00                                                  db 0
(1) 4102/    1CC8 : 00                                                  db 0
(1) 4102/    1CC9 : 00                                                  db 0
(1) 4102/    1CCA : 00                                                  db 0
(1) 4102/    1CCB : 00                                                  db 0
(1) 4102/    1CCC : 00                                                  db 0
(1) 4102/    1CCD : 00                                                  db 0
(1) 4102/    1CCE : 00                                                  db 0
(1) 4102/    1CCF : 00                                                  db 0
(1) 4102/    1CD0 : 00                                                  db 0
(1) 4102/    1CD1 : 00                                                  db 0
(1) 4102/    1CD2 : 00                                                  db 0
(1) 4102/    1CD3 : 00                                                  db 0
(1) 4102/    1CD4 : 00                                                  db 0
(1) 4102/    1CD5 : 00                                                  db 0
(1) 4102/    1CD6 : 00                                                  db 0
(1) 4102/    1CD7 : 00                                                  db 0
(1) 4102/    1CD8 : 00                                                  db 0
(1) 4102/    1CD9 : 00                                                  db 0
(1) 4102/    1CDA : 00                                                  db 0
(1) 4102/    1CDB : 00                                                  db 0
(1) 4102/    1CDC : 00                                                  db 0
(1) 4102/    1CDD : 00                                                  db 0
(1) 4102/    1CDE : 00                                                  db 0
(1) 4102/    1CDF : 00                                                  db 0
(1) 4102/    1CE0 : 00                                                  db 0
(1) 4102/    1CE1 : 00                                                  db 0
(1) 4102/    1CE2 : 00                                                  db 0
(1) 4102/    1CE3 : 00                                                  db 0
(1) 4102/    1CE4 : 00                                                  db 0
(1) 4102/    1CE5 : 00                                                  db 0
(1) 4102/    1CE6 : 00                                                  db 0
(1) 4102/    1CE7 : 00                                                  db 0
(1) 4102/    1CE8 : 00                                                  db 0
(1) 4102/    1CE9 : 00                                                  db 0
(1) 4102/    1CEA : 00                                                  db 0
(1) 4102/    1CEB : 00                                                  db 0
(1) 4102/    1CEC : 00                                                  db 0
(1) 4102/    1CED : 00                                                  db 0
(1) 4102/    1CEE : 00                                                  db 0
(1) 4102/    1CEF : 00                                                  db 0
(1) 4102/    1CF0 : 00                                                  db 0
(1) 4102/    1CF1 : 00                                                  db 0
(1) 4102/    1CF2 : 00                                                  db 0
(1) 4102/    1CF3 : 00                                                  db 0
(1) 4102/    1CF4 : 00                                                  db 0
(1) 4102/    1CF5 : 00                                                  db 0
(1) 4102/    1CF6 : 00                                                  db 0
(1) 4102/    1CF7 : 00                                                  db 0
(1) 4102/    1CF8 : 00                                                  db 0
(1) 4102/    1CF9 : 00                                                  db 0
(1) 4102/    1CFA : 00                                                  db 0
(1) 4102/    1CFB : 00                                                  db 0
(1) 4102/    1CFC : 00                                                  db 0
(1) 4102/    1CFD : 00                                                  db 0
(1) 4102/    1CFE : 00                                                  db 0
(1) 4102/    1CFF : 00                                                  db 0
(1) 4102/    1D00 :                     
(1) 4103/    1D00 :                     dWaveBuff	ds 100h		; WAVE data buffer: 100h bytes, updates every 80h
(1) 4104/    1E00 :                     trkCach_0	ds MAX_RCACH	; ** MUST BE aligned **
(1) 4105/    1E40 :                     trkCach_1	ds MAX_RCACH
(1) 4106/    1E80 :                     trkCach_2	ds MAX_RCACH
(1) 4107/    1EC0 :                     trkCach_3	ds MAX_RCACH
(1) 4108/    1F00 :                     
(1) 4109/    1F00 :                     ; --------------------------------------------------------
(1) 4110/    1F00 :                     
(1) 4111/    1F00 :                     		cpu 68000	; [AS] Exit Z80
(1) 4112/    1F00 :                     		padding off	; [AS] NO padding (again)
(1) 4113/FFFFFFFFFFFF425A :                     		phase Z80_TOP+*	; [AS] Relocate PC
(1) 4114/FFFFFFFFFFFF425A :                     		align 2		; [AS] Align by 2
(1) 4115/FFFFFFFFFFFF425A :                     
     117/FFFFFFFFFFFF425A :                     Z80_CODE_END:
     118/FFFFFFFFFFFF425A :                     Gema_MasterList:	; TEMPORAL
     119/    3C5A :                     		dephase
     120/    3C5A :                     
     121/    3C5A :                     ; ---------------------------------------------
     122/    3C5A :                     ; MD INIT
     123/    3C5A :                     ; ---------------------------------------------
     134/    3C5A :                     
     135/    3C5A :                     ; ====================================================================
     136/    3C5A :                     ; --------------------------------------------------------
     137/    3C5A :                     ; SYSTEM and MODE code
     138/    3C5A :                     ; --------------------------------------------------------
     139/    3C5A :                     
     140/    3C5A :                     ; ---------------------------------------------
     141/    3C5A :                     ; TOP-RAM Genesis system routines
     142/    3C5A :                     ; ---------------------------------------------
     143/    3C5A :                     
     144/    3C5A :                     Md_SysCode:
     146/FFFFFFFFFFFF0000 :                     		phase RAM_SystemCode
     148/FFFFFFFFFFFF0000 :                     
     149/FFFFFFFFFFFF0000 :                     ; ---------------------------------------------
     150/FFFFFFFFFFFF0000 :                     		include	"sound/gema.asm"
(1)    1/FFFFFFFFFFFF0000 :                     ; ====================================================================
(1)    2/FFFFFFFFFFFF0000 :                     ; --------------------------------------------------------
(1)    3/FFFFFFFFFFFF0000 :                     ; GEMA/Nikona sound driver v0.5
(1)    4/FFFFFFFFFFFF0000 :                     ; (C)2023 GenesisFan64
(1)    5/FFFFFFFFFFFF0000 :                     ;
(1)    6/FFFFFFFFFFFF0000 :                     ; Reads custom "miniature" ImpulseTracker files
(1)    7/FFFFFFFFFFFF0000 :                     ; and automaticly picks the soundchip(s) to play.
(1)    8/FFFFFFFFFFFF0000 :                     ;
(1)    9/FFFFFFFFFFFF0000 :                     ; Features:
(1)   10/FFFFFFFFFFFF0000 :                     ; - Support for 32X's PWM:
(1)   11/FFFFFFFFFFFF0000 :                     ;   | 7 extra pseudo-channels in either MONO
(1)   12/FFFFFFFFFFFF0000 :                     ;   | or STEREO.
(1)   13/FFFFFFFFFFFF0000 :                     ;   | ** REQUIRES specific code for the SH2 side
(1)   14/FFFFFFFFFFFF0000 :                     ;   | and enabling the use of CMD interrupt.
(1)   15/FFFFFFFFFFFF0000 :                     ;   | Uses Slave SH2.
(1)   16/FFFFFFFFFFFF0000 :                     ; - DMA-protection
(1)   17/FFFFFFFFFFFF0000 :                     ;   | This keeps DAC samplerate to a decent
(1)   18/FFFFFFFFFFFF0000 :                     ;   | quality.
(1)   19/FFFFFFFFFFFF0000 :                     ; - DAC Playback at 16000hz
(1)   20/FFFFFFFFFFFF0000 :                     ; - FM special mode with custom frequencies
(1)   21/FFFFFFFFFFFF0000 :                     ; - Autodetection for the PSG's Tone3 mode
(1)   22/FFFFFFFFFFFF0000 :                     ;
(1)   23/FFFFFFFFFFFF0000 :                     ; 
(1)   24/FFFFFFFFFFFF0000 :                     ; 
(1)   25/FFFFFFFFFFFF0000 :                     ; 
(1)   26/FFFFFFFFFFFF0000 :                     ; 
(1)   27/FFFFFFFFFFFF0000 :                     ; 
(1)   28/FFFFFFFFFFFF0000 :                     ; 
(1)   29/FFFFFFFFFFFF0000 :                     ; 
(1)   30/FFFFFFFFFFFF0000 :                     ; 
(1)   31/FFFFFFFFFFFF0000 :                     ; 
(1)   32/FFFFFFFFFFFF0000 :                     ; 
(1)   33/FFFFFFFFFFFF0000 :                     ; 
(1)   34/FFFFFFFFFFFF0000 :                     ; 
(1)   35/FFFFFFFFFFFF0000 :                     ; --------------------------------------------------------
(1)   36/FFFFFFFFFFFF0000 :                     
(1)   37/FFFFFFFFFFFF0000 :                     ; ====================================================================
(1)   38/FFFFFFFFFFFF0000 :                     ; --------------------------------------------------------
(1)   39/FFFFFFFFFFFF0000 :                     ; Settings
(1)   40/FFFFFFFFFFFF0000 :                     ; --------------------------------------------------------
(1)   41/FFFFFFFFFFFF0000 :                     
(1)   42/FFFFFFFFFFFF0000 :                     ; --------------------------------------------------------
(1)   43/FFFFFFFFFFFF0000 :                     ; Variables
(1)   44/FFFFFFFFFFFF0000 :                     ; --------------------------------------------------------
(1)   45/FFFFFFFFFFFF0000 :                     
(1)   46/FFFFFFFFFFFF0000 :                     ; z80_cpu	equ $A00000		; Z80 CPU area, size: $2000
(1)   47/FFFFFFFFFFFF0000 :                     ; z80_bus 	equ $A11100		; only read bit 0 (bit 8 as WORD)
(1)   48/FFFFFFFFFFFF0000 :                     ; z80_reset	equ $A11200		; WRITE only: $0000 reset/$0100 cancel
(1)   49/FFFFFFFFFFFF0000 :                     
(1)   50/FFFFFFFFFFFF0000 :                     ; Z80-area points:
(1)   51/FFFFFFFFFFFF0000 : =$40                zDrvFifo	equ commZfifo		; FIFO command storage
(1)   52/FFFFFFFFFFFF0000 : =$80                zDrvFWrt	equ commZWrite		; FIFO command index
(1)   53/FFFFFFFFFFFF0000 : =$81                zDrvRomBlk	equ commZRomBlk		; ROM block flag
(1)   54/FFFFFFFFFFFF0000 : =$82                zDrvMarsBlk	equ marsBlock		; Disable PWM flag
(1)   55/FFFFFFFFFFFF0000 :                     
(1)   56/FFFFFFFFFFFF0000 :                     ; ====================================================================
(1)   57/FFFFFFFFFFFF0000 :                     ; --------------------------------------------------------
(1)   58/FFFFFFFFFFFF0000 :                     ; Initialize Sound
(1)   59/FFFFFFFFFFFF0000 :                     ;
(1)   60/FFFFFFFFFFFF0000 :                     ; Uses:
(1)   61/FFFFFFFFFFFF0000 :                     ; a0-a1,d0-d1
(1)   62/FFFFFFFFFFFF0000 :                     ; --------------------------------------------------------
(1)   63/FFFFFFFFFFFF0000 :                     
(1)   64/FFFFFFFFFFFF0000 :                     ; 		align $80
(1)   65/FFFFFFFFFFFF0000 :                     Sound_Init:
(1)   66/FFFFFFFFFFFF0000 : 46FC 2700           		move.w	#$2700,sr
(1)   67/FFFFFFFFFFFF0004 : 33FC 0100 00A1 1100 		move.w	#$0100,(z80_bus).l		; Get Z80 bus
(1)   68/FFFFFFFFFFFF000C : 33FC 0100 00A1 1200 		move.w	#$0100,(z80_reset).l		; Z80 reset
(1)   69/FFFFFFFFFFFF0014 :                     .wait:
(1)   70/FFFFFFFFFFFF0014 : 0839 0000 00A1 1100 		btst	#0,(z80_bus).l
(1)   71/FFFFFFFFFFFF001C : 66F6                		bne.s	.wait
(1)   72/FFFFFFFFFFFF001E : 41F9 00A0 0000      		lea	(z80_cpu).l,a0			; Clean entire Z80 FIRST.
(1)   73/FFFFFFFFFFFF0024 : 303C 1FFF           		move.w	#$1FFF,d0
(1)   74/FFFFFFFFFFFF0028 : 7200                		moveq	#0,d1
(1)   75/FFFFFFFFFFFF002A :                     .cleanup:
(1)   76/FFFFFFFFFFFF002A : 10C1                		move.b	d1,(a0)+
(1)   77/FFFFFFFFFFFF002C : 51C8 FFFC           		dbf	d0,.cleanup
(1)   78/FFFFFFFFFFFF0030 : 41F9 FFFF 235A      		lea	(Z80_CODE).l,a0			; a0 - Z80 code (on $880000)
(1)   79/FFFFFFFFFFFF0036 : 43F9 00A0 0000      		lea	(z80_cpu).l,a1			; a1 - Z80 CPU area
(1)   80/FFFFFFFFFFFF003C : 303C 1EFF           		move.w	#(Z80_CODE_END-Z80_CODE)-1,d0	; d0 - Size
(1)   81/FFFFFFFFFFFF0040 :                     .copy:
(1)   82/FFFFFFFFFFFF0040 : 12D8                		move.b	(a0)+,(a1)+
(1)   83/FFFFFFFFFFFF0042 : 51C8 FFFC           		dbf	d0,.copy
(1)   84/FFFFFFFFFFFF0046 : 33FC 0000 00A1 1200 		move.w	#0,(z80_reset).l		; Reset cancel
(1)   85/FFFFFFFFFFFF004E : 4E71                		nop
(1)   86/FFFFFFFFFFFF0050 : 4E71                		nop
(1)   87/FFFFFFFFFFFF0052 : 4E71                		nop
(1)   88/FFFFFFFFFFFF0054 : 4E71                		nop
(1)   89/FFFFFFFFFFFF0056 : 33FC 0100 00A1 1200 		move.w	#$100,(z80_reset).l
(1)   90/FFFFFFFFFFFF005E : 33FC 0000 00A1 1100 		move.w	#0,(z80_bus).l			; Start Z80
(1)   91/FFFFFFFFFFFF0066 : 4E75                		rts
(1)   92/FFFFFFFFFFFF0068 :                     
(1)   93/FFFFFFFFFFFF0068 :                     ; ====================================================================
(1)   94/FFFFFFFFFFFF0068 :                     ; ----------------------------------------------------------------
(1)   95/FFFFFFFFFFFF0068 :                     ; Subroutines
(1)   96/FFFFFFFFFFFF0068 :                     ; ----------------------------------------------------------------
(1)   97/FFFFFFFFFFFF0068 :                     
(1)   98/FFFFFFFFFFFF0068 :                     ; ------------------------------------------------
(1)   99/FFFFFFFFFFFF0068 :                     ; Lock Z80, get bus
(1)  100/FFFFFFFFFFFF0068 :                     ; ------------------------------------------------
(1)  101/FFFFFFFFFFFF0068 :                     
(1)  102/FFFFFFFFFFFF0068 :                     sndLockZ80:
(1)  103/FFFFFFFFFFFF0068 : 33FC 0100 00A1 1100 		move.w	#$0100,(z80_bus).l
(1)  104/FFFFFFFFFFFF0070 :                     .wait:
(1)  105/FFFFFFFFFFFF0070 : 0839 0000 00A1 1100 		btst	#0,(z80_bus).l
(1)  106/FFFFFFFFFFFF0078 : 66F6                		bne.s	.wait
(1)  107/FFFFFFFFFFFF007A : 4E75                		rts
(1)  108/FFFFFFFFFFFF007C :                     
(1)  109/FFFFFFFFFFFF007C :                     ; ------------------------------------------------
(1)  110/FFFFFFFFFFFF007C :                     ; Unlock Z80, return bus
(1)  111/FFFFFFFFFFFF007C :                     ; ------------------------------------------------
(1)  112/FFFFFFFFFFFF007C :                     
(1)  113/FFFFFFFFFFFF007C :                     sndUnlockZ80:
(1)  114/FFFFFFFFFFFF007C : 33FC 0000 00A1 1100 		move.w	#0,(z80_bus).l
(1)  115/FFFFFFFFFFFF0084 : 4E75                		rts
(1)  116/FFFFFFFFFFFF0086 :                     
(1)  117/FFFFFFFFFFFF0086 :                     ; ------------------------------------------------
(1)  118/FFFFFFFFFFFF0086 :                     ; 68k-to-z80 Sound request
(1)  119/FFFFFFFFFFFF0086 :                     ; enter/exit routines
(1)  120/FFFFFFFFFFFF0086 :                     ;
(1)  121/FFFFFFFFFFFF0086 :                     ; d6 - commFifo index
(1)  122/FFFFFFFFFFFF0086 :                     ; ------------------------------------------------
(1)  123/FFFFFFFFFFFF0086 :                     
(1)  124/FFFFFFFFFFFF0086 :                     sndReq_Enter:
(1)  125/FFFFFFFFFFFF0086 : 48E7 0306           		movem.l	d6-d7/a5-a6,-(sp)		; Save these regs to the stack
(1)  126/FFFFFFFFFFFF008A : DEFC 0010           		adda	#4*4,sp				; Go back to the RTS jump
(1)  127/FFFFFFFFFFFF008E : 33FC 0100 00A1 1100 		move.w	#$0100,(z80_bus).l		; Request Z80 Stop
(1)  128/FFFFFFFFFFFF0096 : 7C00                		moveq	#0,d6
(1)  129/FFFFFFFFFFFF0098 : 40C6                		move.w	sr,d6
(1)  130/FFFFFFFFFFFF009A : 4846                		swap	d6
(1)  131/FFFFFFFFFFFF009C : 007C 0700           		or.w	#$0700,sr			; Disable interrupts
(1)  132/FFFFFFFFFFFF00A0 : 4BF9 00A0 0080      		lea	(z80_cpu+zDrvFWrt),a5		; a5 - commZWrite
(1)  133/FFFFFFFFFFFF00A6 : 4DF9 00A0 0040      		lea	(z80_cpu+zDrvFifo),a6		; a6 - fifo command list
(1)  134/FFFFFFFFFFFF00AC :                     .wait:
(1)  135/FFFFFFFFFFFF00AC : 0839 0000 00A1 1100 		btst	#0,(z80_bus).l			; Wait for Z80
(1)  136/FFFFFFFFFFFF00B4 : 66F6                		bne.s	.wait
(1)  137/FFFFFFFFFFFF00B6 : 1C15                		move.b	(a5),d6				; d6 - index fifo position
(1)  138/FFFFFFFFFFFF00B8 : 4886                		ext.w	d6				; extend to 16 bits
(1)  139/FFFFFFFFFFFF00BA : 4E75                		rts
(1)  140/FFFFFFFFFFFF00BC :                     ; JUMP ONLY
(1)  141/FFFFFFFFFFFF00BC :                     sndReq_Exit:
(1)  142/FFFFFFFFFFFF00BC : 33FC 0000 00A1 1100 		move.w	#0,(z80_bus).l
(1)  143/FFFFFFFFFFFF00C4 : 4846                		swap	d6
(1)  144/FFFFFFFFFFFF00C6 : 46C6                		move.w	d6,sr
(1)  145/FFFFFFFFFFFF00C8 : 9EFC 0010           		suba	#4*4,sp				; Roll to the last regs
(1)  146/FFFFFFFFFFFF00CC : 4CDF 60C0           		movem.l	(sp)+,d6-d7/a5-a6		; And pop those back
(1)  147/FFFFFFFFFFFF00D0 : 4E75                		rts
(1)  148/FFFFFFFFFFFF00D2 :                     
(1)  149/FFFFFFFFFFFF00D2 :                     ; ------------------------------------------------
(1)  150/FFFFFFFFFFFF00D2 :                     ; Send request id and arguments
(1)  151/FFFFFFFFFFFF00D2 :                     ;
(1)  152/FFFFFFFFFFFF00D2 :                     ; Input:
(1)  153/FFFFFFFFFFFF00D2 :                     ; d7 - byte to write
(1)  154/FFFFFFFFFFFF00D2 :                     ; d6 - index pointer
(1)  155/FFFFFFFFFFFF00D2 :                     ; a5 - commZWrite, update index
(1)  156/FFFFFFFFFFFF00D2 :                     ; a6 - commZfifo command list
(1)  157/FFFFFFFFFFFF00D2 :                     ;
(1)  158/FFFFFFFFFFFF00D2 :                     ; *** CALL sndReq_Enter FIRST ***
(1)  159/FFFFFFFFFFFF00D2 :                     ; ------------------------------------------------
(1)  160/FFFFFFFFFFFF00D2 :                     
(1)  161/FFFFFFFFFFFF00D2 :                     sndReq_scmd:
(1)  162/FFFFFFFFFFFF00D2 : 1DBC 00FF 6000      		move.b	#-1,(a6,d6.w)			; write command-start flag
(1)  163/FFFFFFFFFFFF00D8 : 5206                		addq.b	#1,d6				; next fifo pos
(1)  164/FFFFFFFFFFFF00DA : 0206 003F           		andi.b	#$3F,d6
(1)  165/FFFFFFFFFFFF00DE : 600C                		bra.s	sndReq_sbyte
(1)  166/FFFFFFFFFFFF00E0 :                     sndReq_slong:
(1)  167/FFFFFFFFFFFF00E0 : 610A                		bsr	sndReq_sbyte
(1)  168/FFFFFFFFFFFF00E2 : E09F                		ror.l	#8,d7
(1)  169/FFFFFFFFFFFF00E4 :                     sndReq_saddr:
(1)  170/FFFFFFFFFFFF00E4 : 6106                		bsr	sndReq_sbyte
(1)  171/FFFFFFFFFFFF00E6 : E09F                		ror.l	#8,d7
(1)  172/FFFFFFFFFFFF00E8 :                     sndReq_sword:
(1)  173/FFFFFFFFFFFF00E8 : 6102                		bsr	sndReq_sbyte
(1)  174/FFFFFFFFFFFF00EA : E09F                		ror.l	#8,d7
(1)  175/FFFFFFFFFFFF00EC :                     sndReq_sbyte:
(1)  176/FFFFFFFFFFFF00EC : 1D87 6000           		move.b	d7,(a6,d6.w)			; write byte
(1)  177/FFFFFFFFFFFF00F0 : 5206                		addq.b	#1,d6				; next fifo pos
(1)  178/FFFFFFFFFFFF00F2 : 0206 003F           		andi.b	#$3F,d6
(1)  179/FFFFFFFFFFFF00F6 : 1A86                		move.b	d6,(a5)				; update commZWrite
(1)  180/FFFFFFFFFFFF00F8 : 4E75                		rts
(1)  181/FFFFFFFFFFFF00FA :                     
(1)  182/FFFFFFFFFFFF00FA :                     ; --------------------------------------------------------
(1)  183/FFFFFFFFFFFF00FA :                     ; gemaDmaPause
(1)  184/FFFFFFFFFFFF00FA :                     ;
(1)  185/FFFFFFFFFFFF00FA :                     ; Call this BEFORE doing any DMA transfer
(1)  186/FFFFFFFFFFFF00FA :                     ; --------------------------------------------------------
(1)  187/FFFFFFFFFFFF00FA :                     
(1)  188/FFFFFFFFFFFF00FA :                     gemaDmaPause:
(1)  189/FFFFFFFFFFFF00FA : 4847                		swap	d7
(1)  190/FFFFFFFFFFFF00FC : 4846                		swap	d6
(1)  191/FFFFFFFFFFFF00FE : 6100 FF68           		bsr	sndLockZ80
(1)  192/FFFFFFFFFFFF0102 : 13FC 0001 00A0 0081 		move.b	#1,(z80_cpu+zDrvRomBlk)		; Block flag for Z80
(1)  193/FFFFFFFFFFFF010A : 31FC 0001 0000      		move.w	#1,
(1)  194/FFFFFFFFFFFF0110 : 6100 FF6A           		bsr	sndUnlockZ80
(1)  195/FFFFFFFFFFFF0114 : 3E3C 0060           		move.w	#96,d7				; ...Small delay...
(1)  196/FFFFFFFFFFFF0118 : 51CF FFFE           		dbf	d7,*
(1)  197/FFFFFFFFFFFF011C : 4846                		swap	d6
(1)  198/FFFFFFFFFFFF011E : 4847                		swap	d7
(1)  199/FFFFFFFFFFFF0120 : 4E75                		rts
(1)  200/FFFFFFFFFFFF0122 :                     
(1)  201/FFFFFFFFFFFF0122 :                     ; --------------------------------------------------------
(1)  202/FFFFFFFFFFFF0122 :                     ; gemaDmaResume
(1)  203/FFFFFFFFFFFF0122 :                     ;
(1)  204/FFFFFFFFFFFF0122 :                     ; Call this AFTER finishing DMA transfer
(1)  205/FFFFFFFFFFFF0122 :                     ; --------------------------------------------------------
(1)  206/FFFFFFFFFFFF0122 :                     
(1)  207/FFFFFFFFFFFF0122 :                     gemaDmaResume:
(1)  208/FFFFFFFFFFFF0122 : 4847                		swap	d7
(1)  209/FFFFFFFFFFFF0124 : 4846                		swap	d6
(1)  210/FFFFFFFFFFFF0126 : 6100 FF40           		bsr	sndLockZ80
(1)  211/FFFFFFFFFFFF012A : 13FC 0000 00A0 0081 		move.b	#0,(z80_cpu+zDrvRomBlk)		; Block flag for Z80
(1)  212/FFFFFFFFFFFF0132 : 6100 FF48           		bsr	sndUnlockZ80
(1)  213/FFFFFFFFFFFF0136 : 4846                		swap	d6
(1)  214/FFFFFFFFFFFF0138 : 4847                		swap	d7
(1)  215/FFFFFFFFFFFF013A : 4E75                		rts
(1)  216/FFFFFFFFFFFF013C :                     
(1)  217/FFFFFFFFFFFF013C :                     ; --------------------------------------------------------
(1)  218/FFFFFFFFFFFF013C :                     ; gemaDmaPause
(1)  219/FFFFFFFFFFFF013C :                     ;
(1)  220/FFFFFFFFFFFF013C :                     ; Call this BEFORE doing any DMA transfer
(1)  221/FFFFFFFFFFFF013C :                     ; --------------------------------------------------------
(1)  222/FFFFFFFFFFFF013C :                     
(1)  223/FFFFFFFFFFFF013C :                     gemaDmaPauseRom:
(1)  224/FFFFFFFFFFFF013C : 4847                		swap	d7
(1)  225/FFFFFFFFFFFF013E : 4846                		swap	d6
(1)  226/FFFFFFFFFFFF0140 : 6100 FF26           		bsr	sndLockZ80
(1)  227/FFFFFFFFFFFF0144 : 13FC 0001 00A0 0081 		move.b	#1,(z80_cpu+zDrvRomBlk)		; Block flag for Z80
(1)  228/FFFFFFFFFFFF014C : 6100 FF2E           		bsr	sndUnlockZ80
(1)  229/FFFFFFFFFFFF0150 : 3E3C 0060           		move.w	#96,d7				; ...Small delay...
(1)  230/FFFFFFFFFFFF0154 : 51CF FFFE           		dbf	d7,*
(1)  236/FFFFFFFFFFFF0158 : 4846                		swap	d6
(1)  237/FFFFFFFFFFFF015A : 4847                		swap	d7
(1)  238/FFFFFFFFFFFF015C : 4E75                		rts
(1)  239/FFFFFFFFFFFF015E :                     
(1)  240/FFFFFFFFFFFF015E :                     ; --------------------------------------------------------
(1)  241/FFFFFFFFFFFF015E :                     ; gemaDmaResume
(1)  242/FFFFFFFFFFFF015E :                     ;
(1)  243/FFFFFFFFFFFF015E :                     ; Call this AFTER finishing DMA transfer
(1)  244/FFFFFFFFFFFF015E :                     ; --------------------------------------------------------
(1)  245/FFFFFFFFFFFF015E :                     
(1)  246/FFFFFFFFFFFF015E :                     gemaDmaResumeRom:
(1)  247/FFFFFFFFFFFF015E : 4847                		swap	d7
(1)  248/FFFFFFFFFFFF0160 : 4846                		swap	d6
(1)  249/FFFFFFFFFFFF0162 : 6100 FF04           		bsr	sndLockZ80
(1)  250/FFFFFFFFFFFF0166 : 13FC 0000 00A0 0081 		move.b	#0,(z80_cpu+zDrvRomBlk)		; Block flag for Z80
(1)  251/FFFFFFFFFFFF016E : 6100 FF0C           		bsr	sndUnlockZ80
(1)  257/FFFFFFFFFFFF0172 : 4846                		swap	d6
(1)  258/FFFFFFFFFFFF0174 : 4847                		swap	d7
(1)  259/FFFFFFFFFFFF0176 : 4E75                		rts
(1)  260/FFFFFFFFFFFF0178 :                     
(1)  261/FFFFFFFFFFFF0178 :                     ; ------------------------------------------------
(1)  262/FFFFFFFFFFFF0178 :                     ; 32X ONLY: Request CMD interrupt with
(1)  263/FFFFFFFFFFFF0178 :                     ; command
(1)  264/FFFFFFFFFFFF0178 :                     ;
(1)  265/FFFFFFFFFFFF0178 :                     ; d6 - command
(1)  266/FFFFFFFFFFFF0178 :                     ; ------------------------------------------------
(1)  267/FFFFFFFFFFFF0178 :                     
(1)  268/FFFFFFFFFFFF0178 :                     sndReqCmd:
(1)  269/FFFFFFFFFFFF0178 :                     ; 	if MARS
(1)  270/FFFFFFFFFFFF0178 :                     ; .wait_in:	move.b	(sysmars_reg+comm14),d7
(1)  271/FFFFFFFFFFFF0178 :                     ; 		and.w	#%11110000,d7
(1)  272/FFFFFFFFFFFF0178 :                     ; 		bne.s	.wait_in
(1)  273/FFFFFFFFFFFF0178 :                     ; 		and.w	#%00001111,d6
(1)  274/FFFFFFFFFFFF0178 :                     ; 		or.b	d6,d7
(1)  275/FFFFFFFFFFFF0178 :                     ; 		move.b	d7,(sysmars_reg+comm14).l
(1)  276/FFFFFFFFFFFF0178 :                     ; 		move.b	(sysmars_reg+comm14).l,d7
(1)  277/FFFFFFFFFFFF0178 :                     ; 		and.w	#%00001111,d7
(1)  278/FFFFFFFFFFFF0178 :                     ; 		cmp.b	d6,d7
(1)  279/FFFFFFFFFFFF0178 :                     ; 		bne.s	.wait_in
(1)  280/FFFFFFFFFFFF0178 :                     ; 		bset	#7,(sysmars_reg+comm14).l
(1)  281/FFFFFFFFFFFF0178 :                     ; 		bset	#1,(sysmars_reg+standby).l	; Request Slave CMD
(1)  282/FFFFFFFFFFFF0178 :                     ; ; .wait_cmd:	btst	#1,(sysmars_reg+standby).l
(1)  283/FFFFFFFFFFFF0178 :                     ; ; 		bne.s	.wait_cmd
(1)  284/FFFFFFFFFFFF0178 :                     ; .wait_out:	move.b	(sysmars_reg+comm14),d7
(1)  285/FFFFFFFFFFFF0178 :                     ; 		and.w	#%11110000,d7
(1)  286/FFFFFFFFFFFF0178 :                     ; 		bne.s	.wait_out
(1)  287/FFFFFFFFFFFF0178 :                     ; 	endif
(1)  288/FFFFFFFFFFFF0178 : 4E75                		rts
(1)  289/FFFFFFFFFFFF017A :                     
(1)  290/FFFFFFFFFFFF017A :                     ; ============================================================
(1)  291/FFFFFFFFFFFF017A :                     ; --------------------------------------------------------
(1)  292/FFFFFFFFFFFF017A :                     ; gemaTest
(1)  293/FFFFFFFFFFFF017A :                     ;
(1)  294/FFFFFFFFFFFF017A :                     ; For TESTING only.
(1)  295/FFFFFFFFFFFF017A :                     ; --------------------------------------------------------
(1)  296/FFFFFFFFFFFF017A :                     
(1)  297/FFFFFFFFFFFF017A :                     gemaTest:
(1)  298/FFFFFFFFFFFF017A : 6100 FF0A           		bsr	sndReq_Enter
(1)  299/FFFFFFFFFFFF017E : 3E3C 0000           		move.w	#$00,d7		; Command $00
(1)  300/FFFFFFFFFFFF0182 : 6100 FF4E           		bsr	sndReq_scmd
(1)  301/FFFFFFFFFFFF0186 : 6000 FF34           		bra 	sndReq_Exit
(1)  302/FFFFFFFFFFFF018A :                     
(1)  303/FFFFFFFFFFFF018A :                     ; --------------------------------------------------------
(1)  304/FFFFFFFFFFFF018A :                     ; gemaPlayTrack
(1)  305/FFFFFFFFFFFF018A :                     ;
(1)  306/FFFFFFFFFFFF018A :                     ; Play a track by number
(1)  307/FFFFFFFFFFFF018A :                     ;
(1)  308/FFFFFFFFFFFF018A :                     ; d0.b - Track number
(1)  309/FFFFFFFFFFFF018A :                     ; --------------------------------------------------------
(1)  310/FFFFFFFFFFFF018A :                     
(1)  311/FFFFFFFFFFFF018A :                     gemaPlayTrack:
(1)  312/FFFFFFFFFFFF018A : 6100 FEFA           		bsr	sndReq_Enter
(1)  313/FFFFFFFFFFFF018E : 3E3C 0001           		move.w	#$01,d7		; Command $01
(1)  314/FFFFFFFFFFFF0192 : 6100 FF3E           		bsr	sndReq_scmd
(1)  315/FFFFFFFFFFFF0196 : 1E00                		move.b	d0,d7
(1)  316/FFFFFFFFFFFF0198 : 6100 FF52           		bsr	sndReq_sbyte
(1)  317/FFFFFFFFFFFF019C : 7E00                		moveq	#0,d7
(1)  318/FFFFFFFFFFFF019E : 6100 FF4C           		bsr	sndReq_sbyte
(1)  319/FFFFFFFFFFFF01A2 : 6000 FF18           		bra 	sndReq_Exit
(1)  320/FFFFFFFFFFFF01A6 :                     
(1)  321/FFFFFFFFFFFF01A6 :                     ; --------------------------------------------------------
(1)  322/FFFFFFFFFFFF01A6 :                     ; gemaPlayFromBlk
(1)  323/FFFFFFFFFFFF01A6 :                     ;
(1)  324/FFFFFFFFFFFF01A6 :                     ; Play a track by number
(1)  325/FFFFFFFFFFFF01A6 :                     ;
(1)  326/FFFFFFFFFFFF01A6 :                     ; d0.b - Track number
(1)  327/FFFFFFFFFFFF01A6 :                     ; d1.b - Block number
(1)  328/FFFFFFFFFFFF01A6 :                     ; --------------------------------------------------------
(1)  329/FFFFFFFFFFFF01A6 :                     
(1)  330/FFFFFFFFFFFF01A6 :                     gemaPlayFromBlk:
(1)  331/FFFFFFFFFFFF01A6 : 6100 FEDE           		bsr	sndReq_Enter
(1)  332/FFFFFFFFFFFF01AA : 3E3C 0001           		move.w	#$01,d7		; Command $04
(1)  333/FFFFFFFFFFFF01AE : 6100 FF22           		bsr	sndReq_scmd
(1)  334/FFFFFFFFFFFF01B2 : 1E00                		move.b	d0,d7
(1)  335/FFFFFFFFFFFF01B4 : 6100 FF36           		bsr	sndReq_sbyte
(1)  336/FFFFFFFFFFFF01B8 : 1E01                		move.b	d1,d7
(1)  337/FFFFFFFFFFFF01BA : 6100 FF30           		bsr	sndReq_sbyte
(1)  338/FFFFFFFFFFFF01BE : 6000 FEFC           		bra 	sndReq_Exit
(1)  339/FFFFFFFFFFFF01C2 :                     
(1)  340/FFFFFFFFFFFF01C2 :                     ; --------------------------------------------------------
(1)  341/FFFFFFFFFFFF01C2 :                     ; gemaStopTrack
(1)  342/FFFFFFFFFFFF01C2 :                     ;
(1)  343/FFFFFFFFFFFF01C2 :                     ; Stops a track using that ID
(1)  344/FFFFFFFFFFFF01C2 :                     ;
(1)  345/FFFFFFFFFFFF01C2 :                     ; d0.b - Track number
(1)  346/FFFFFFFFFFFF01C2 :                     ; --------------------------------------------------------
(1)  347/FFFFFFFFFFFF01C2 :                     
(1)  348/FFFFFFFFFFFF01C2 :                     gemaStopTrack:
(1)  349/FFFFFFFFFFFF01C2 : 6100 FEC2           		bsr	sndReq_Enter
(1)  350/FFFFFFFFFFFF01C6 : 3E3C 0002           		move.w	#$02,d7		; Command $02
(1)  351/FFFFFFFFFFFF01CA : 6100 FF06           		bsr	sndReq_scmd
(1)  352/FFFFFFFFFFFF01CE : 1E00                		move.b	d0,d7
(1)  353/FFFFFFFFFFFF01D0 : 6100 FF1A           		bsr	sndReq_sbyte
(1)  354/FFFFFFFFFFFF01D4 : 6000 FEE6           		bra 	sndReq_Exit
(1)  355/FFFFFFFFFFFF01D8 :                     
(1)  356/FFFFFFFFFFFF01D8 :                     ; --------------------------------------------------------
(1)  357/FFFFFFFFFFFF01D8 :                     ; gemaStopAll
(1)  358/FFFFFFFFFFFF01D8 :                     ;
(1)  359/FFFFFFFFFFFF01D8 :                     ; Stop ALL tracks from ALL buffers.
(1)  360/FFFFFFFFFFFF01D8 :                     ;
(1)  361/FFFFFFFFFFFF01D8 :                     ; No arguments.
(1)  362/FFFFFFFFFFFF01D8 :                     ; --------------------------------------------------------
(1)  363/FFFFFFFFFFFF01D8 :                     
(1)  364/FFFFFFFFFFFF01D8 :                     gemaStopAll:
(1)  365/FFFFFFFFFFFF01D8 : 6100 FEAC           		bsr	sndReq_Enter
(1)  366/FFFFFFFFFFFF01DC : 3E3C 0008           		move.w	#$08,d7		; Command $08
(1)  367/FFFFFFFFFFFF01E0 : 6100 FEF0           		bsr	sndReq_scmd
(1)  368/FFFFFFFFFFFF01E4 : 6000 FED6           		bra 	sndReq_Exit
(1)  369/FFFFFFFFFFFF01E8 :                     
(1)  370/FFFFFFFFFFFF01E8 :                     ; --------------------------------------------------------
(1)  371/FFFFFFFFFFFF01E8 :                     ; gemaSetBeats
(1)  372/FFFFFFFFFFFF01E8 :                     ;
(1)  373/FFFFFFFFFFFF01E8 :                     ; Sets global subbeats
(1)  374/FFFFFFFFFFFF01E8 :                     ;
(1)  375/FFFFFFFFFFFF01E8 :                     ; d0.w - sub-beats
(1)  376/FFFFFFFFFFFF01E8 :                     ; --------------------------------------------------------
(1)  377/FFFFFFFFFFFF01E8 :                     
(1)  378/FFFFFFFFFFFF01E8 :                     gemaSetBeats:
(1)  379/FFFFFFFFFFFF01E8 : 6100 FE9C           		bsr	sndReq_Enter
(1)  380/FFFFFFFFFFFF01EC : 3E3C 000C           		move.w	#$0C,d7		; Command $0C
(1)  381/FFFFFFFFFFFF01F0 : 6100 FEE0           		bsr	sndReq_scmd
(1)  382/FFFFFFFFFFFF01F4 : 3E00                		move.w	d0,d7
(1)  383/FFFFFFFFFFFF01F6 : 6100 FEF0           		bsr	sndReq_sword
(1)  384/FFFFFFFFFFFF01FA : 6000 FEC0           		bra 	sndReq_Exit
(1)  385/FFFFFFFFFFFF01FE :                     
     151/FFFFFFFFFFFF01FE :                     		include	"system/md/video.asm"
(1)    1/FFFFFFFFFFFF01FE :                     ; ====================================================================
(1)    2/FFFFFFFFFFFF01FE :                     ; ----------------------------------------------------------------
(1)    3/FFFFFFFFFFFF01FE :                     ; Genesis Video
(1)    4/FFFFFFFFFFFF01FE :                     ; ----------------------------------------------------------------
(1)    5/FFFFFFFFFFFF01FE :                     
(1)    6/FFFFFFFFFFFF01FE : =$FFFFFFFFFF..      RAM_BgBufferM	equ	RAM_MdDreq+Dreq_BgExBuff	; Relocate MARS layer control
(1)    7/FFFFFFFFFFFF01FE :                     
(1)    8/FFFFFFFFFFFF01FE :                     ; ====================================================================
(1)    9/FFFFFFFFFFFF01FE :                     ; --------------------------------------------------------
(1)   10/FFFFFFFFFFFF01FE :                     ; Settings
(1)   11/FFFFFFFFFFFF01FE :                     ; --------------------------------------------------------
(1)   12/FFFFFFFFFFFF01FE :                     
(1)   13/FFFFFFFFFFFF01FE : =$10                MAX_MDOBJ	equ 16		; Max objects for Genesis
(1)   14/FFFFFFFFFFFF01FE : =$7FF               varNullVram	equ $7FF	; Default Blank cell for some video routines
(1)   15/FFFFFFFFFFFF01FE : =$580               varPrintVram	equ $580	; Default location of the PRINT text graphics
(1)   16/FFFFFFFFFFFF01FE : =$3                 varPrintPal	equ 3		; Palette to use for the printable text
(1)   17/FFFFFFFFFFFF01FE :                     
(1)   18/FFFFFFFFFFFF01FE :                     ; --------------------------------------------------------
(1)   19/FFFFFFFFFFFF01FE :                     ; Variables
(1)   20/FFFFFFFFFFFF01FE :                     ; --------------------------------------------------------
(1)   21/FFFFFFFFFFFF01FE :                     
(1)   22/FFFFFFFFFFFF01FE :                     ; VDP Register $80
(1)   23/FFFFFFFFFFFF01FE : =$2                 HVStop		equ $02
(1)   24/FFFFFFFFFFFF01FE : =$10                HintEnbl	equ $10
(1)   25/FFFFFFFFFFFF01FE : =$1                 bitHVStop	equ 1
(1)   26/FFFFFFFFFFFF01FE : =$4                 bitHintEnbl	equ 4
(1)   27/FFFFFFFFFFFF01FE :                     
(1)   28/FFFFFFFFFFFF01FE :                     ; VDP Register $81
(1)   29/FFFFFFFFFFFF01FE : =$40                DispEnbl 	equ $40
(1)   30/FFFFFFFFFFFF01FE : =$20                VintEnbl 	equ $20
(1)   31/FFFFFFFFFFFF01FE : =$10                DmaEnbl		equ $10
(1)   32/FFFFFFFFFFFF01FE : =$6                 bitDispEnbl	equ 6
(1)   33/FFFFFFFFFFFF01FE : =$5                 bitVintEnbl	equ 5
(1)   34/FFFFFFFFFFFF01FE : =$4                 bitDmaEnbl	equ 4
(1)   35/FFFFFFFFFFFF01FE : =$3                 bitV30		equ 3
(1)   36/FFFFFFFFFFFF01FE :                     
(1)   37/FFFFFFFFFFFF01FE :                     ; vdp_ctrl READ bits (full WORD)
(1)   38/FFFFFFFFFFFF01FE : =$9                 bitFifoE	equ 9		; DMA FIFO empty
(1)   39/FFFFFFFFFFFF01FE : =$8                 bitFifoF	equ 8		; DMA FIFO full
(1)   40/FFFFFFFFFFFF01FE : =$7                 bitVInt		equ 7		; Vertical interrupt
(1)   41/FFFFFFFFFFFF01FE : =$6                 bitSprOvr	equ 6		; Sprite overflow
(1)   42/FFFFFFFFFFFF01FE : =$5                 bitSprCol	equ 5		; Sprite collision
(1)   43/FFFFFFFFFFFF01FE : =$4                 bitOdd		equ 4		; EVEN or ODD frame displayed on interlace mode
(1)   44/FFFFFFFFFFFF01FE : =$3                 bitVBlk		equ 3		; Inside VBlank
(1)   45/FFFFFFFFFFFF01FE : =$2                 bitHBlk		equ 2		; Inside HBlank
(1)   46/FFFFFFFFFFFF01FE : =$1                 bitDma		equ 1		; Only works for FILL and COPY
(1)   47/FFFFFFFFFFFF01FE : =$0                 bitPal		equ 0
(1)   48/FFFFFFFFFFFF01FE :                     
(1)   49/FFFFFFFFFFFF01FE :                     ; md_bg_flags
(1)   50/FFFFFFFFFFFF01FE : =$0                 bitDrwR		equ 0
(1)   51/FFFFFFFFFFFF01FE : =$1                 bitDrwL		equ 1
(1)   52/FFFFFFFFFFFF01FE : =$2                 bitDrwD		equ 2
(1)   53/FFFFFFFFFFFF01FE : =$3                 bitDrwU		equ 3
(1)   54/FFFFFFFFFFFF01FE : =$6                 bitMarsBg	equ 6
(1)   55/FFFFFFFFFFFF01FE : =$7                 bitBgOn		equ 7
(1)   56/FFFFFFFFFFFF01FE :                     
(1)   57/FFFFFFFFFFFF01FE :                     ; ====================================================================
(1)   58/FFFFFFFFFFFF01FE :                     ; ----------------------------------------------------------------
(1)   59/FFFFFFFFFFFF01FE :                     ; Structs
(1)   60/FFFFFFFFFFFF01FE :                     ; ----------------------------------------------------------------
(1)   61/FFFFFFFFFFFF01FE :                     
(1)   62/FFFFFFFFFFFF01FE :                     ; IN SH2 ORDER
(1)   63/FFFFFFFFFFFF01FE :                     ; still works fine on this side.
(1)   64/FFFFFFFFFFFF01FE :                     ; md_bg_flags: %EM..UDLR
(1)   65/FFFFFFFFFFFF01FE :                     ; UDLR - off-screen update bits
(1)   66/FFFFFFFFFFFF01FE :                     ;    M - Map belongs to Genesis or 32X
(1)   67/FFFFFFFFFFFF01FE :                     ;    E - Enable this map
(1)   68/FFFFFFFFFFFF01FE :                     
(1)   69/FFFFFFFFFFFF01FE : (MACRO)             		struct 0
(1)   69/FFFFFFFFFFFF01FE : =$FFFFFFFFFF..      GLBL_LASTPC     set *
(1)   69/    3E58 :                                     dephase
(1)   69/    3E58 : =$3E58              GLBL_LASTORG    set *
(1)   69/       0 :                                     phase 0
(1)   70/       0 :                     md_bg_bw	ds.b 1		; Block Width
(1)   71/       1 :                     md_bg_bh	ds.b 1		; Block Height
(1)   72/       2 :                     md_bg_blkw	ds.b 1		; Bitshift block size (LSL)
(1)   73/       3 :                     md_bg_flags	ds.b 1		; Drawing flags: %EM00UDLR
(1)   74/       4 :                     md_bg_xset	ds.b 1		; X-counter
(1)   75/       5 :                     md_bg_yset	ds.b 1		; Y-counter
(1)   76/       6 :                     md_bg_movex	ds.b 1		; *** ALIGNMENT, FREE TO USE
(1)   77/       7 :                     md_bg_movey	ds.b 1		; ***
(1)   78/       8 :                     md_bg_w		ds.w 1		; Width in blocks
(1)   79/       A :                     md_bg_h		ds.w 1		; Height in blocks
(1)   80/       C :                     md_bg_wf	ds.w 1		; FULL Width in pixels
(1)   81/       E :                     md_bg_hf	ds.w 1		; FULL Height in pixels
(1)   82/      10 :                     md_bg_xinc_l	ds.w 1		; Layout draw-beams L/R/U/D
(1)   83/      12 :                     md_bg_xinc_r	ds.w 1
(1)   84/      14 :                     md_bg_yinc_u	ds.w 1
(1)   85/      16 :                     md_bg_yinc_d	ds.w 1
(1)   86/      18 :                     md_bg_x_old	ds.w 1		; OLD X position
(1)   87/      1A :                     md_bg_y_old	ds.w 1		; OLD Y position
(1)   88/      1C :                     md_bg_vpos	ds.w 1		; VRAM output for map
(1)   89/      1E :                     md_bg_vram	ds.w 1		; VRAM start for cells
(1)   90/      20 :                     md_bg_low	ds.l 1		; MAIN layout data
(1)   91/      24 :                     md_bg_hi	ds.l 1		; HI layout data
(1)   92/      28 :                     md_bg_blk	ds.l 1		; Block data
(1)   93/      2C :                     md_bg_col	ds.l 1		; Collision data (if needed)
(1)   94/      30 :                     md_bg_x		ds.l 1		; X pos 0000.0000
(1)   95/      34 :                     md_bg_y		ds.l 1		; Y pos 0000.0000
(1)   96/      38 :                     sizeof_mdbg	ds.l 0
(1)   97/      38 : (MACRO)             		endstruct
(1)   97/       0 :                                     !org GLBL_LASTORG
(1)   97/FFFFFFFFFFFF01FE :                                     phase GLBL_LASTPC
(1)   98/FFFFFFFFFFFF01FE :                     
(1)   99/FFFFFFFFFFFF01FE :                     ; --------------------------------
(1)  100/FFFFFFFFFFFF01FE :                     ; object struct
(1)  101/FFFFFFFFFFFF01FE :                     ; --------------------------------
(1)  102/FFFFFFFFFFFF01FE :                     
(1)  103/FFFFFFFFFFFF01FE : (MACRO)             		struct 0
(1)  103/FFFFFFFFFFFF01FE : =$FFFFFFFFFF..      GLBL_LASTPC     set *
(1)  103/    3E58 :                                     dephase
(1)  103/    3E58 : =$3E58              GLBL_LASTORG    set *
(1)  103/       0 :                                     phase 0
(1)  104/       0 :                     obj_code	ds.l 1		; Object code
(1)  105/       4 :                     obj_size	ds.l 1		; Object size (see below)
(1)  106/       8 :                     obj_x		ds.l 1		; Object X Position
(1)  107/       C :                     obj_y		ds.l 1		; Object Y Position
(1)  108/      10 :                     obj_map		ds.l 1		; Object image settings
(1)  109/      14 :                     obj_vram	ds.w 1		; Object VRAM position (MD-side only)
(1)  110/      16 :                     obj_x_spd	ds.w 1		; Object X Speed
(1)  111/      18 :                     obj_y_spd	ds.w 1		; Object Y Speed
(1)  112/      1A :                     obj_anim_indx	ds.w 1		; Object animation increment (obj_anim + obj_anim_indx)
(1)  113/      1C :                     obj_anim_id	ds.w 1		; Object animation to read (current|saved)
(1)  114/      1E :                     obj_frame	ds.w 1		; Object display frame (MD: $FFFF, MARS: $YY,$XX)
(1)  115/      20 :                     obj_anim_spd	ds.b 1		; Object animation delay
(1)  116/      21 :                     obj_index	ds.b 1		; Object code index
(1)  117/      22 :                     obj_subid	ds.b 1		; Object SubID
(1)  118/      23 :                     obj_set		ds.b 1		; Object settings
(1)  119/      24 :                     obj_status	ds.b 1		; Object custom status
(1)  120/      25 :                     obj_spwnid	ds.b 1		; Object respawn index (this - 1)
(1)  121/      26 :                     obj_ram		ds.b $40	; Object RAM
(1)  122/      66 :                     sizeof_mdobj	ds.l 0
(1)  123/      68 : (MACRO)             		endstruct
(1)  123/       0 :                                     !org GLBL_LASTORG
(1)  123/FFFFFFFFFFFF01FE :                                     phase GLBL_LASTPC
(1)  124/FFFFFFFFFFFF01FE :                     
(1)  125/FFFFFFFFFFFF01FE :                     ; --------------------------------
(1)  126/FFFFFFFFFFFF01FE :                     ; obj_settings
(1)  127/FFFFFFFFFFFF01FE :                     ; --------------------------------
(1)  128/FFFFFFFFFFFF01FE :                     
(1)  129/FFFFFFFFFFFF01FE : =$7                 bitobj_Mars	equ	7	; This object is for 32X side.
(1)  130/FFFFFFFFFFFF01FE : =$1                 bitobj_flipV	equ	1	; set to flip Sprite Vertically
(1)  131/FFFFFFFFFFFF01FE : =$0                 bitobj_flipH	equ	0	; set to flip Sprite Horizontally
(1)  132/FFFFFFFFFFFF01FE :                     
(1)  133/FFFFFFFFFFFF01FE :                     ; --------------------------------
(1)  134/FFFFFFFFFFFF01FE :                     ; obj_set
(1)  135/FFFFFFFFFFFF01FE :                     ; --------------------------------
(1)  136/FFFFFFFFFFFF01FE :                     
(1)  137/FFFFFFFFFFFF01FE : =$0                 bitobj_air	equ	0	; set if floating/jumping
(1)  138/FFFFFFFFFFFF01FE :                     
(1)  139/FFFFFFFFFFFF01FE :                     ; --------------------------------
(1)  140/FFFFFFFFFFFF01FE :                     ; obj_size
(1)  141/FFFFFFFFFFFF01FE :                     ; --------------------------------
(1)  142/FFFFFFFFFFFF01FE :                     
(1)  143/FFFFFFFFFFFF01FE : =$3                 at_u		equ	3
(1)  144/FFFFFFFFFFFF01FE : =$2                 at_d		equ	2
(1)  145/FFFFFFFFFFFF01FE : =$1                 at_l		equ	1
(1)  146/FFFFFFFFFFFF01FE : =$0                 at_r		equ	0
(1)  147/FFFFFFFFFFFF01FE :                     
(1)  148/FFFFFFFFFFFF01FE :                     ; ====================================================================
(1)  149/FFFFFFFFFFFF01FE :                     ; ----------------------------------------------------------------
(1)  150/FFFFFFFFFFFF01FE :                     ; Video RAM
(1)  151/FFFFFFFFFFFF01FE :                     ; ----------------------------------------------------------------
(1)  152/FFFFFFFFFFFF01FE :                     
(1)  153/FFFFFFFFFFFF01FE : (MACRO)             			struct RAM_MdVideo
(1)  153/FFFFFFFFFFFF01FE : =$FFFFFFFFFF..      GLBL_LASTPC     set *
(1)  153/    3E58 :                                     dephase
(1)  153/    3E58 : =$3E58              GLBL_LASTORG    set *
(1)  153/FFFFFFFFFFFF8000 :                                     phase RAM_MDVIDEO
(1)  154/FFFFFFFFFFFF8000 :                     RAM_Objects		ds.b MAX_MDOBJ*sizeof_mdobj
(1)  155/FFFFFFFFFFFF8660 :                     RAM_BgBuffer		ds.b sizeof_mdbg*4	; Map backgrounds, back to front.
(1)  156/FFFFFFFFFFFF8740 :                     RAM_FrameCount		ds.l 1			; Frames counter
(1)  157/FFFFFFFFFFFF8744 :                     RAM_HorScroll		ds.l 240		; DMA Horizontal scroll data
(1)  158/FFFFFFFFFFFF8B04 :                     RAM_VerScroll		ds.l 320/16		; DMA Vertical scroll data
(1)  159/FFFFFFFFFFFF8B54 :                     RAM_ObjDispList		ds.w MAX_MDOBJ		; Objects half-RAM pointers for display (Obj|Extra)
(1)  160/FFFFFFFFFFFF8B74 :                     RAM_SprDrwPz		ds.w 8*70		; External sprite pieces
(1)  161/FFFFFFFFFFFF8FD4 :                     RAM_Sprites		ds.w 8*70		; DMA Sprites
(1)  162/FFFFFFFFFFFF9434 :                     RAM_Palette		ds.w 64			; DMA palette
(1)  163/FFFFFFFFFFFF94B4 :                     RAM_PaletteFd		ds.w 64			; Target MD palette for FadeIn/Out
(1)  164/FFFFFFFFFFFF9534 :                     RAM_MdMarsPalFd		ds.w 256		; Target 32X palette for FadeIn/Out (NOTE: it's slow)
(1)  165/FFFFFFFFFFFF9734 :                     RAM_VdpDmaList		ds.w 7*MAX_MDDMATSK	; DMA BLAST list for VBlank
(1)  166/FFFFFFFFFFFF9814 :                     RAM_VidPrntList		ds.w 3*64		; Video_Print list: Address, Type
(1)  167/FFFFFFFFFFFF9994 :                     RAM_SprDrwCntr		ds.w 1
(1)  168/FFFFFFFFFFFF9996 :                     RAM_SprShowIndx		ds.w 1
(1)  169/FFFFFFFFFFFF9998 :                     RAM_VdpDmaIndx		ds.w 1			; Current index in DMA BLAST list
(1)  170/FFFFFFFFFFFF999A :                     RAM_VdpDmaMod		ds.w 1			; Mid-write flag (just to be safe)
(1)  171/FFFFFFFFFFFF999C :                     RAM_VidPrntVram		ds.w 1			; Default VRAM location for ASCII text used by Video_Print
(1)  172/FFFFFFFFFFFF999E :                     RAM_FadeMdReq		ds.w 1			; FadeIn/Out request for Genesis palette (01-FadeIn 02-FadeOut)
(1)  173/FFFFFFFFFFFF99A0 :                     RAM_FadeMdIncr		ds.w 1			; Fading increment count
(1)  174/FFFFFFFFFFFF99A2 :                     RAM_FadeMdDelay		ds.w 1			; Fading delay
(1)  175/FFFFFFFFFFFF99A4 :                     RAM_FadeMdTmr		ds.w 1			; Fading delay timer
(1)  176/FFFFFFFFFFFF99A6 :                     RAM_FadeMarsReq		ds.w 1			; Same thing but for 32X's 256-color (01-FadeIn 02-FadeOut)
(1)  177/FFFFFFFFFFFF99A8 :                     RAM_FadeMarsIncr	ds.w 1			; (Hint: Set to 4 to syncronize with Genesis' FadeIn/Out)
(1)  178/FFFFFFFFFFFF99AA :                     RAM_FadeMarsDelay	ds.w 1
(1)  179/FFFFFFFFFFFF99AC :                     RAM_FadeMarsTmr		ds.w 1
(1)  180/FFFFFFFFFFFF99AE :                     RAM_VdpRegs		ds.b 24			; VDP Register cache
(1)  181/FFFFFFFFFFFF99C6 :                     sizeof_mdvid		ds.l 0
(1)  182/FFFFFFFFFFFF99C8 : (MACRO)             			endstruct
(1)  182/FFFFFFFFFFFF8000 :                                     !org GLBL_LASTORG
(1)  182/FFFFFFFFFFFF01FE :                                     phase GLBL_LASTPC
(1)  183/FFFFFFFFFFFF01FE :                     
(1)  184/FFFFFFFFFFFF01FE : (MACRO)             			report "MD VIDEO",sizeof_mdvid-RAM_MdVideo,MAX_MdVideo
(1)  185/FFFFFFFFFFFF01FE :                     
(1)  186/FFFFFFFFFFFF01FE :                     ; ====================================================================
(1)  187/FFFFFFFFFFFF01FE :                     ; --------------------------------------------------------
(1)  188/FFFFFFFFFFFF01FE :                     ; Init Genesis video
(1)  189/FFFFFFFFFFFF01FE :                     ; --------------------------------------------------------
(1)  190/FFFFFFFFFFFF01FE :                     
(1)  191/FFFFFFFFFFFF01FE :                     Video_Init:
(1)  192/FFFFFFFFFFFF01FE : 4DF8 8000           		lea	(RAM_MdVideo),a6	; Clear our RAM section
(1)  193/FFFFFFFFFFFF0202 : 7C00                		moveq	#0,d6
(1)  194/FFFFFFFFFFFF0204 : 3E3C 19C5           		move.w	#(sizeof_mdvid-RAM_MdVideo)-1,d7
(1)  195/FFFFFFFFFFFF0208 :                     .clrram:
(1)  196/FFFFFFFFFFFF0208 : 1CC6                		move.b	d6,(a6)+
(1)  197/FFFFFFFFFFFF020A : 51CF FFFC           		dbf	d7,.clrram
(1)  198/FFFFFFFFFFFF020E : 4DFA 0042           		lea	list_vdpregs(pc),a6	; Write "cache'd" VDP registers
(1)  199/FFFFFFFFFFFF0212 : 4BF8 99AE           		lea	(RAM_VdpRegs).w,a5
(1)  200/FFFFFFFFFFFF0216 : 49F9 00C0 0004      		lea	(vdp_ctrl),a4
(1)  201/FFFFFFFFFFFF021C : 3C3C 8000           		move.w	#$8000,d6
(1)  202/FFFFFFFFFFFF0220 : 3E3C 0012           		move.w	#19-1,d7
(1)  203/FFFFFFFFFFFF0224 :                     .loop:
(1)  204/FFFFFFFFFFFF0224 : 1C1E                		move.b	(a6)+,d6
(1)  205/FFFFFFFFFFFF0226 : 1AC6                		move.b	d6,(a5)+
(1)  206/FFFFFFFFFFFF0228 : 3886                		move.w	d6,(a4)
(1)  207/FFFFFFFFFFFF022A : DC7C 0100           		add.w	#$100,d6
(1)  208/FFFFFFFFFFFF022E : 51CF FFF4           		dbf	d7,.loop
(1)  209/FFFFFFFFFFFF0232 :                     .exit:
(1)  210/FFFFFFFFFFFF0232 :                     
(1)  211/FFFFFFFFFFFF0232 :                     ; --------------------------------------------------------
(1)  212/FFFFFFFFFFFF0232 :                     ; Video_Update
(1)  213/FFFFFFFFFFFF0232 :                     ;
(1)  214/FFFFFFFFFFFF0232 :                     ; Writes register data stored in RAM to VDP
(1)  215/FFFFFFFFFFFF0232 :                     ; from Registers $80 to $90
(1)  216/FFFFFFFFFFFF0232 :                     ;
(1)  217/FFFFFFFFFFFF0232 :                     ; WINDOW registers $91 and $92 are written
(1)  218/FFFFFFFFFFFF0232 :                     ; manually.
(1)  219/FFFFFFFFFFFF0232 :                     ;
(1)  220/FFFFFFFFFFFF0232 :                     ; Breaks:
(1)  221/FFFFFFFFFFFF0232 :                     ; d6-d7,a5-a6
(1)  222/FFFFFFFFFFFF0232 :                     ; --------------------------------------------------------
(1)  223/FFFFFFFFFFFF0232 :                     
(1)  224/FFFFFFFFFFFF0232 :                     Video_Update:
(1)  225/FFFFFFFFFFFF0232 : 4DF8 99AE           		lea	(RAM_VdpRegs).w,a6
(1)  226/FFFFFFFFFFFF0236 : 4BF9 00C0 0004      		lea	(vdp_ctrl),a5
(1)  227/FFFFFFFFFFFF023C : 3C3C 8000           		move.w	#$8000,d6
(1)  228/FFFFFFFFFFFF0240 : 3E3C 0010           		move.w	#17-1,d7
(1)  229/FFFFFFFFFFFF0244 :                     .loop:
(1)  230/FFFFFFFFFFFF0244 : 1C1E                		move.b	(a6)+,d6
(1)  231/FFFFFFFFFFFF0246 : 3A86                		move.w	d6,(a5)
(1)  232/FFFFFFFFFFFF0248 : 0646 0100           		addi.w	#$100,d6
(1)  233/FFFFFFFFFFFF024C : 51CF FFF6           		dbf	d7,.loop
(1)  234/FFFFFFFFFFFF0250 :                     .exit:
(1)  235/FFFFFFFFFFFF0250 : 4E75                		rts
(1)  236/FFFFFFFFFFFF0252 :                     
(1)  237/FFFFFFFFFFFF0252 :                     ; --------------------------------------------------------
(1)  238/FFFFFFFFFFFF0252 :                     
(1)  239/FFFFFFFFFFFF0252 :                     list_vdpregs:
(1)  240/FFFFFFFFFFFF0252 : 04                  		dc.b $04			; No HBlank interrupt, HV Counter on
(1)  241/FFFFFFFFFFFF0253 : 04                  		dc.b $04			; Display ON, No VBlank interrupt
(1)  242/FFFFFFFFFFFF0254 : 30                  		dc.b (($C000)>>10)		; Layer A at VRAM $C000 (%00xxx000)
(1)  243/FFFFFFFFFFFF0255 : 34                  		dc.b (($D000)>>10)		; Window  at VRAM $D000 (%00xxxxy0)
(1)  244/FFFFFFFFFFFF0256 : 07                  		dc.b (($E000)>>13)		; Layer B at VRAM $E000 (%00000xxx)
(1)  245/FFFFFFFFFFFF0257 : 7C                  		dc.b (($F800)>>9)		; Sprites at VRAM $F800 (%0xxxxxxy)
(1)  246/FFFFFFFFFFFF0258 : 00                  		dc.b $00			; Unused
(1)  247/FFFFFFFFFFFF0259 : 00                  		dc.b $00			; Background color: 0
(1)  248/FFFFFFFFFFFF025A : 00                  		dc.b $00			; Unused
(1)  249/FFFFFFFFFFFF025B : 00                  		dc.b $00			; Unused
(1)  250/FFFFFFFFFFFF025C : 00                  		dc.b $00			; HInt value
(1)  251/FFFFFFFFFFFF025D : 00                  		dc.b (%000|%00)			; No ExtInt, Scroll: VSCR:full HSCR:full
(1)  252/FFFFFFFFFFFF025E : 81                  		dc.b $81			; H40, No shadow mode, Normal resolution
(1)  253/FFFFFFFFFFFF025F : 3F                  		dc.b (($FC00)>>10)		; HScroll at VRAM $FC00 (%00xxxxxx)
(1)  254/FFFFFFFFFFFF0260 : 00                  		dc.b $00			; Unused
(1)  255/FFFFFFFFFFFF0261 : 02                  		dc.b $02			; VDP Auto increment: $02
(1)  256/FFFFFFFFFFFF0262 : 01                  		dc.b (%00<<4)|%01		; Layer size: V32 H64
(1)  257/FFFFFFFFFFFF0263 : 00                  		dc.b $00
(1)  258/FFFFFFFFFFFF0264 : 00                  		dc.b $00
(1)  259/FFFFFFFFFFFF0265 :                     		align 2
(1)  260/FFFFFFFFFFFF0266 :                     
(1)  261/FFFFFFFFFFFF0266 :                     ; Default PRINT palette
(1)  262/FFFFFFFFFFFF0266 : 0000 0EEE 0CCC 0AAA ASCII_PAL:	dc.w $0000,$0EEE,$0CCC,$0AAA,$0888,$0444,$000E,$0008
                    0888 0444 000E 0008 
(1)  263/FFFFFFFFFFFF0276 : 00EE 0088 00E0 0080 		dc.w $00EE,$0088,$00E0,$0080,$0E00,$0800,$0000,$0000
                    0E00 0800 0000 0000 
(1)  264/FFFFFFFFFFFF0286 :                     ASCII_PAL_e:
(1)  265/FFFFFFFFFFFF0286 :                     		align 2
(1)  266/FFFFFFFFFFFF0286 :                     
(1)  267/FFFFFFFFFFFF0286 :                     ; --------------------------------------------------------
(1)  268/FFFFFFFFFFFF0286 :                     ; Video_Clear
(1)  269/FFFFFFFFFFFF0286 :                     ;
(1)  270/FFFFFFFFFFFF0286 :                     ; Clear all video data from VRAM
(1)  271/FFFFFFFFFFFF0286 :                     ; --------------------------------------------------------
(1)  272/FFFFFFFFFFFF0286 :                     
(1)  273/FFFFFFFFFFFF0286 :                     Video_Clear:
(1)  274/FFFFFFFFFFFF0286 :                     ; 		move.w	#0,d0			; Clears until $57F
(1)  275/FFFFFFFFFFFF0286 :                     ; 		move.w	#0,d1
(1)  276/FFFFFFFFFFFF0286 :                     ; 		move.w	#$57F*$20,d2
(1)  277/FFFFFFFFFFFF0286 :                     ; 		bsr	Video_Fill
(1)  278/FFFFFFFFFFFF0286 :                     
(1)  279/FFFFFFFFFFFF0286 :                     Video_ClearScreen:
(1)  280/FFFFFFFFFFFF0286 : 7000                		moveq	#0,d0
(1)  281/FFFFFFFFFFFF0288 : 343C 0FFF           		move.w	#$FFF,d2		; FG/BG size
(1)  282/FFFFFFFFFFFF028C : 1239 FFFF 99B0      		move.b	(RAM_VdpRegs+2).l,d1	; FG
(1)  283/FFFFFFFFFFFF0292 : 0241 0038           		andi.w	#%111000,d1
(1)  284/FFFFFFFFFFFF0296 : E149                		lsl.w	#8,d1
(1)  285/FFFFFFFFFFFF0298 : E549                		lsl.w	#2,d1
(1)  286/FFFFFFFFFFFF029A : 6100 0536           		bsr	Video_Fill
(1)  287/FFFFFFFFFFFF029E : 1239 FFFF 99B2      		move.b	(RAM_VdpRegs+4).l,d1	; BG
(1)  288/FFFFFFFFFFFF02A4 : 0241 0007           		andi.w	#%000111,d1
(1)  289/FFFFFFFFFFFF02A8 : E149                		lsl.w	#8,d1
(1)  290/FFFFFFFFFFFF02AA : EB49                		lsl.w	#5,d1
(1)  291/FFFFFFFFFFFF02AC : 6100 0524           		bsr	Video_Fill
(1)  292/FFFFFFFFFFFF02B0 : 343C 0FFF           		move.w	#$FFF,d2		; WD Size
(1)  293/FFFFFFFFFFFF02B4 : 1239 FFFF 99B1      		move.b	(RAM_VdpRegs+3).l,d1	; Window
(1)  294/FFFFFFFFFFFF02BA : 0241 003E           		andi.w	#%111110,d1
(1)  295/FFFFFFFFFFFF02BE : E149                		lsl.w	#8,d1
(1)  296/FFFFFFFFFFFF02C0 : E549                		lsl.w	#2,d1
(1)  297/FFFFFFFFFFFF02C2 : 6100 050E           		bsr	Video_Fill
(1)  298/FFFFFFFFFFFF02C6 :                     
(1)  299/FFFFFFFFFFFF02C6 :                     	; RAM cleanup
(1)  300/FFFFFFFFFFFF02C6 : 41F8 8744           		lea	(RAM_HorScroll),a0
(1)  301/FFFFFFFFFFFF02CA : 3E3C 00EF           		move.w	#240-1,d7
(1)  302/FFFFFFFFFFFF02CE : 7000                		moveq	#0,d0
(1)  303/FFFFFFFFFFFF02D0 :                     .xnext:
(1)  304/FFFFFFFFFFFF02D0 : 20C0                		move.l	d0,(a0)+
(1)  305/FFFFFFFFFFFF02D2 : 51CF FFFC           		dbf	d7,.xnext
(1)  306/FFFFFFFFFFFF02D6 : 41F8 8B04           		lea	(RAM_VerScroll),a0
(1)  307/FFFFFFFFFFFF02DA : 3E3C 0013           		move.w	#(320/16)-1,d7
(1)  308/FFFFFFFFFFFF02DE : 7000                		moveq	#0,d0
(1)  309/FFFFFFFFFFFF02E0 :                     .ynext:
(1)  310/FFFFFFFFFFFF02E0 : 20C0                		move.l	d0,(a0)+
(1)  311/FFFFFFFFFFFF02E2 : 51CF FFFC           		dbf	d7,.ynext
(1)  312/FFFFFFFFFFFF02E6 : 41F8 8FD4           		lea	(RAM_Sprites),a0
(1)  313/FFFFFFFFFFFF02EA : 3E3C 008B           		move.w	#((70*8)/4)-1,d7
(1)  314/FFFFFFFFFFFF02EE : 7000                		moveq	#0,d0
(1)  315/FFFFFFFFFFFF02F0 :                     .snext:
(1)  316/FFFFFFFFFFFF02F0 : 20C0                		move.l	d0,(a0)+
(1)  317/FFFFFFFFFFFF02F2 : 51CF FFFC           		dbf	d7,.snext
(1)  318/FFFFFFFFFFFF02F6 : 41F8 9434           		lea	(RAM_Palette),a0
(1)  319/FFFFFFFFFFFF02FA : 43F8 94B4           		lea	(RAM_PaletteFd),a1
(1)  320/FFFFFFFFFFFF02FE : 3E3C 001F           		move.w	#(64/2)-1,d7
(1)  321/FFFFFFFFFFFF0302 : 7000                		moveq	#0,d0
(1)  322/FFFFFFFFFFFF0304 :                     .pnext:
(1)  323/FFFFFFFFFFFF0304 : 20C0                		move.l	d0,(a0)+
(1)  324/FFFFFFFFFFFF0306 : 22C0                		move.l	d0,(a1)+
(1)  325/FFFFFFFFFFFF0308 : 51CF FFFA           		dbf	d7,.pnext
(1)  336/FFFFFFFFFFFF030C : 4E75                		rts
(1)  337/FFFFFFFFFFFF030E :                     
(1)  338/FFFFFFFFFFFF030E :                     ; ====================================================================
(1)  339/FFFFFFFFFFFF030E :                     ; ----------------------------------------------------------------
(1)  340/FFFFFFFFFFFF030E :                     ; Generic screen-drawing routines
(1)  341/FFFFFFFFFFFF030E :                     ; ----------------------------------------------------------------
(1)  342/FFFFFFFFFFFF030E :                     
(1)  343/FFFFFFFFFFFF030E :                     ; --------------------------------------------------------
(1)  344/FFFFFFFFFFFF030E :                     ; Video_LoadMap
(1)  345/FFFFFFFFFFFF030E :                     ;
(1)  346/FFFFFFFFFFFF030E :                     ; Loads map data, in Horizontal order
(1)  347/FFFFFFFFFFFF030E :                     ; Can autodetect layer width, height and
(1)  348/FFFFFFFFFFFF030E :                     ; double interlace mode
(1)  349/FFFFFFFFFFFF030E :                     ;
(1)  350/FFFFFFFFFFFF030E :                     ; Input:
(1)  351/FFFFFFFFFFFF030E :                     ; a0 - Map data
(1)  352/FFFFFFFFFFFF030E :                     ;
(1)  353/FFFFFFFFFFFF030E :                     ; d0 | LONG - locate(lyr,x,y) / 00|Layer|X|Y
(1)  354/FFFFFFFFFFFF030E :                     ; d1 | LONG - mapsize(x,y) / Width|Height (in cells)
(1)  355/FFFFFFFFFFFF030E :                     ; d2 | WORD - VRAM
(1)  356/FFFFFFFFFFFF030E :                     ;
(1)  357/FFFFFFFFFFFF030E :                     ; Breaks:
(1)  358/FFFFFFFFFFFF030E :                     ; d4-d7,a6
(1)  359/FFFFFFFFFFFF030E :                     ; --------------------------------------------------------
(1)  360/FFFFFFFFFFFF030E :                     
(1)  361/FFFFFFFFFFFF030E :                     Video_LoadMap:
(1)  362/FFFFFFFFFFFF030E : 4DF9 00C0 0000      		lea	(vdp_data),a6
(1)  363/FFFFFFFFFFFF0314 : 6100 0224           		bsr	vid_PickLayer
(1)  364/FFFFFFFFFFFF0318 : 3A01                		move.w	d1,d5		; Start here
(1)  365/FFFFFFFFFFFF031A :                     .yloop:
(1)  366/FFFFFFFFFFFF031A : 4845                		swap	d5
(1)  367/FFFFFFFFFFFF031C : 2D44 0004           		move.l	d4,4(a6)
(1)  368/FFFFFFFFFFFF0320 : 2E01                		move.l	d1,d7
(1)  369/FFFFFFFFFFFF0322 : 4847                		swap	d7
(1)  370/FFFFFFFFFFFF0324 :                     .xloop:
(1)  371/FFFFFFFFFFFF0324 : 3A18                		move.w	(a0)+,d5
(1)  372/FFFFFFFFFFFF0326 : BA7C FFFF           		cmp.w	#-1,d5		; -1 ?
(1)  373/FFFFFFFFFFFF032A : 6606                		bne.s	.nonull
(1)  374/FFFFFFFFFFFF032C : 3A3C 07FF           		move.w	#varNullVram,d5	; Replace with custom blank tile
(1)  375/FFFFFFFFFFFF0330 : 6002                		bra.s	.cont
(1)  376/FFFFFFFFFFFF0332 :                     .nonull:
(1)  377/FFFFFFFFFFFF0332 : DA42                		add.w	d2,d5
(1)  378/FFFFFFFFFFFF0334 :                     .cont:
(1)  379/FFFFFFFFFFFF0334 :                     
(1)  380/FFFFFFFFFFFF0334 :                     	; Check for double interlace
(1)  381/FFFFFFFFFFFF0334 : 4847                		swap	d7
(1)  382/FFFFFFFFFFFF0336 : 1E39 FFFF 99BA      		move.b	(RAM_VdpRegs+$C).l,d7
(1)  383/FFFFFFFFFFFF033C : CE7C 0006           		and.w	#%110,d7
(1)  384/FFFFFFFFFFFF0340 : BE7C 0006           		cmp.w	#%110,d7
(1)  385/FFFFFFFFFFFF0344 : 660E                		bne.s	.nodble
(1)  386/FFFFFFFFFFFF0346 : 3E05                		move.w	d5,d7
(1)  387/FFFFFFFFFFFF0348 : E24F                		lsr.w	#1,d7
(1)  388/FFFFFFFFFFFF034A : CE7C 07FF           		and.w	#$7FF,d7
(1)  389/FFFFFFFFFFFF034E : CA7C F800           		and.w	#$F800,d5
(1)  390/FFFFFFFFFFFF0352 : 8A47                		or.w	d7,d5
(1)  391/FFFFFFFFFFFF0354 :                     .nodble:
(1)  392/FFFFFFFFFFFF0354 : 4847                		swap	d7
(1)  393/FFFFFFFFFFFF0356 : 3C85                		move.w	d5,(a6)
(1)  394/FFFFFFFFFFFF0358 : 51CF FFCA           		dbf	d7,.xloop
(1)  395/FFFFFFFFFFFF035C : D886                		add.l	d6,d4
(1)  396/FFFFFFFFFFFF035E : 4845                		swap	d5
(1)  397/FFFFFFFFFFFF0360 : 51CD FFB8           		dbf	d5,.yloop
(1)  398/FFFFFFFFFFFF0364 : 4E75                		rts
(1)  399/FFFFFFFFFFFF0366 :                     
(1)  400/FFFFFFFFFFFF0366 :                     ; --------------------------------------------------------
(1)  401/FFFFFFFFFFFF0366 :                     ; Video_LoadMap_Vert
(1)  402/FFFFFFFFFFFF0366 :                     ;
(1)  403/FFFFFFFFFFFF0366 :                     ; Load map data, Vertical order
(1)  404/FFFFFFFFFFFF0366 :                     ;
(1)  405/FFFFFFFFFFFF0366 :                     ; a0 - Map data
(1)  406/FFFFFFFFFFFF0366 :                     ; d0 | LONG - 00|Lyr|X|Y,  locate(lyr,x,y)
(1)  407/FFFFFFFFFFFF0366 :                     ; d1 | LONG - Width|Height (cells),  mapsize(x,y)
(1)  408/FFFFFFFFFFFF0366 :                     ; d2 | WORD - VRAM
(1)  409/FFFFFFFFFFFF0366 :                     
(1)  410/FFFFFFFFFFFF0366 :                     ; Breaks:
(1)  411/FFFFFFFFFFFF0366 :                     ; a4-a5,d4-d7
(1)  412/FFFFFFFFFFFF0366 :                     ; --------------------------------------------------------
(1)  413/FFFFFFFFFFFF0366 :                     
(1)  414/FFFFFFFFFFFF0366 :                     Video_LoadMap_Vert:
(1)  415/FFFFFFFFFFFF0366 : 49F9 00C0 0000      		lea	(vdp_data),a4
(1)  416/FFFFFFFFFFFF036C : 6100 01CC           		bsr	vid_PickLayer
(1)  417/FFFFFFFFFFFF0370 : 2A01                		move.l	d1,d5		; Start here
(1)  418/FFFFFFFFFFFF0372 : 4845                		swap	d5
(1)  419/FFFFFFFFFFFF0374 :                     .xloop:
(1)  420/FFFFFFFFFFFF0374 : 4845                		swap	d5
(1)  421/FFFFFFFFFFFF0376 : 2F04                		move.l	d4,-(sp)
(1)  422/FFFFFFFFFFFF0378 : 3E01                		move.w	d1,d7
(1)  423/FFFFFFFFFFFF037A : 0839 0002 FFFF 99BA 		btst	#2,(RAM_VdpRegs+$C).l
(1)  424/FFFFFFFFFFFF0382 : 6702                		beq.s	.yloop
(1)  425/FFFFFFFFFFFF0384 : E24F                		lsr.w	#1,d7
(1)  426/FFFFFFFFFFFF0386 :                     .yloop:
(1)  427/FFFFFFFFFFFF0386 : 2944 0004           		move.l	d4,4(a4)
(1)  428/FFFFFFFFFFFF038A : 3A10                		move.w	(a0),d5
(1)  429/FFFFFFFFFFFF038C : BA7C FFFF           		cmp.w	#-1,d5
(1)  430/FFFFFFFFFFFF0390 : 6606                		bne.s	.nonull
(1)  431/FFFFFFFFFFFF0392 : 3A3C 07FF           		move.w	#varNullVram,d5
(1)  432/FFFFFFFFFFFF0396 : 6002                		bra.s	.cont
(1)  433/FFFFFFFFFFFF0398 :                     .nonull:
(1)  434/FFFFFFFFFFFF0398 : DA42                		add.w	d2,d5
(1)  435/FFFFFFFFFFFF039A :                     .cont:
(1)  436/FFFFFFFFFFFF039A : 4847                		swap	d7
(1)  437/FFFFFFFFFFFF039C : D0FC 0002           		adda	#2,a0
(1)  438/FFFFFFFFFFFF03A0 : 0839 0002 FFFF 99BA 		btst	#2,(RAM_VdpRegs+$C).l
(1)  439/FFFFFFFFFFFF03A8 : 6712                		beq.s	.nodble
(1)  440/FFFFFFFFFFFF03AA : D0FC 0002           		adda	#2,a0
(1)  441/FFFFFFFFFFFF03AE : 3E05                		move.w	d5,d7
(1)  442/FFFFFFFFFFFF03B0 : E24F                		lsr.w	#1,d7
(1)  443/FFFFFFFFFFFF03B2 : CE7C 07FF           		and.w	#$7FF,d7
(1)  444/FFFFFFFFFFFF03B6 : CA7C F800           		and.w	#$F800,d5
(1)  445/FFFFFFFFFFFF03BA : 8A47                		or.w	d7,d5
(1)  446/FFFFFFFFFFFF03BC :                     .nodble:
(1)  447/FFFFFFFFFFFF03BC : 4847                		swap	d7
(1)  448/FFFFFFFFFFFF03BE : 3885                		move.w	d5,(a4)
(1)  449/FFFFFFFFFFFF03C0 : D886                		add.l	d6,d4
(1)  450/FFFFFFFFFFFF03C2 : 51CF FFC2           		dbf	d7,.yloop
(1)  451/FFFFFFFFFFFF03C6 :                     .outdbl:
(1)  452/FFFFFFFFFFFF03C6 : 281F                		move.l	(sp)+,d4
(1)  453/FFFFFFFFFFFF03C8 : D8BC 0002 0000      		add.l	#$20000,d4
(1)  454/FFFFFFFFFFFF03CE : 4845                		swap	d5
(1)  455/FFFFFFFFFFFF03D0 : 51CD FFA2           		dbf	d5,.xloop
(1)  456/FFFFFFFFFFFF03D4 : 4E75                		rts
(1)  457/FFFFFFFFFFFF03D6 :                     
(1)  458/FFFFFFFFFFFF03D6 :                     ; ====================================================================
(1)  459/FFFFFFFFFFFF03D6 :                     ; ----------------------------------------------------------------
(1)  460/FFFFFFFFFFFF03D6 :                     ; Custom "PRINT" system, for debugging or quick texts.
(1)  461/FFFFFFFFFFFF03D6 :                     ; ----------------------------------------------------------------
(1)  462/FFFFFFFFFFFF03D6 :                     
(1)  463/FFFFFFFFFFFF03D6 :                     ; --------------------------------------------------------
(1)  464/FFFFFFFFFFFF03D6 :                     ; Video_PrintInit
(1)  465/FFFFFFFFFFFF03D6 :                     ;
(1)  466/FFFFFFFFFFFF03D6 :                     ; Initializes the default Graphics and Palette
(1)  467/FFFFFFFFFFFF03D6 :                     ; for the font.
(1)  468/FFFFFFFFFFFF03D6 :                     ;
(1)  469/FFFFFFFFFFFF03D6 :                     ; *** ON VBLANK OR DISPLAY OFF ONLY ***
(1)  470/FFFFFFFFFFFF03D6 :                     ; *** MAKE SURE SH2 IS NOT READING ROM DATA ***
(1)  471/FFFFFFFFFFFF03D6 :                     ; --------------------------------------------------------
(1)  472/FFFFFFFFFFFF03D6 :                     
(1)  473/FFFFFFFFFFFF03D6 :                     Video_PrintInit:
(1)  474/FFFFFFFFFFFF03D6 : 203C 0020 3800      		move.l	#ASCII_FONT,d0
(1)  475/FFFFFFFFFFFF03DC : 323C B000           		move.w	#varPrintVram*$20,d1
(1)  476/FFFFFFFFFFFF03E0 : 343C 1000           		move.w	#ASCII_FONT_e-ASCII_FONT,d2
(1)  477/FFFFFFFFFFFF03E4 : 363C 6580           		move.w	#varPrintVram|(varPrintPal<<13),d3
(1)  478/FFFFFFFFFFFF03E8 : 31C3 999C           		move.w	d3,(RAM_VidPrntVram).w
(1)  479/FFFFFFFFFFFF03EC : 6100 04DE           		bsr	Video_LoadArt
(1)  480/FFFFFFFFFFFF03F0 :                     Video_PrintPal:
(1)  481/FFFFFFFFFFFF03F0 : 41FA FE74           		lea	ASCII_PAL(pc),a0
(1)  482/FFFFFFFFFFFF03F4 : 7030                		moveq	#(varPrintPal<<4),d0
(1)  483/FFFFFFFFFFFF03F6 : 323C 000F           		move.w	#$F,d1
(1)  484/FFFFFFFFFFFF03FA : 6100 01F6           		bsr	Video_LoadPal	; Write to both palette buffers
(1)  485/FFFFFFFFFFFF03FE : 6000 01E8           		bra	Video_FadePal
(1)  486/FFFFFFFFFFFF0402 :                     
(1)  487/FFFFFFFFFFFF0402 :                     ; --------------------------------------------------------
(1)  488/FFFFFFFFFFFF0402 :                     ; Video_Print
(1)  489/FFFFFFFFFFFF0402 :                     ;
(1)  490/FFFFFFFFFFFF0402 :                     ; Prints string to layer
(1)  491/FFFFFFFFFFFF0402 :                     ; requires ASCII font
(1)  492/FFFFFFFFFFFF0402 :                     ;
(1)  493/FFFFFFFFFFFF0402 :                     ; a0 | DATA - String data w/special characters +
(1)  494/FFFFFFFFFFFF0402 :                     ;             list of RAM locations to read
(1)  495/FFFFFFFFFFFF0402 :                     ; d0 | LONG - Print location on-screen:
(1)  496/FFFFFFFFFFFF0402 :                     ;             00|Lyr|X|Y or locate(layer,x,y)
(1)  497/FFFFFFFFFFFF0402 :                     ;
(1)  498/FFFFFFFFFFFF0402 :                     ; Special characters:
(1)  499/FFFFFFFFFFFF0402 :                     ; "//b" - Shows BYTE value
(1)  500/FFFFFFFFFFFF0402 :                     ; "//w" - Shows WORD value
(1)  501/FFFFFFFFFFFF0402 :                     ; "//l" - Shows LONG value
(1)  502/FFFFFFFFFFFF0402 :                     ;   $0A - Next line
(1)  503/FFFFFFFFFFFF0402 :                     ;   $00 - End of line
(1)  504/FFFFFFFFFFFF0402 :                     ;
(1)  505/FFFFFFFFFFFF0402 :                     ; After $00, put your RAM addresses in LONGS
(1)  506/FFFFFFFFFFFF0402 :                     ; don't forget to put align 2 at the end.
(1)  507/FFFFFFFFFFFF0402 :                     ;
(1)  508/FFFFFFFFFFFF0402 :                     ; CALL Video_PrintInit FIRST before using this.
(1)  509/FFFFFFFFFFFF0402 :                     ;
(1)  510/FFFFFFFFFFFF0402 :                     ; Breaks:
(1)  511/FFFFFFFFFFFF0402 :                     ; d4-d7,a4-a6
(1)  512/FFFFFFFFFFFF0402 :                     ; --------------------------------------------------------
(1)  513/FFFFFFFFFFFF0402 :                     
(1)  514/FFFFFFFFFFFF0402 :                     Video_Print:
(1)  515/FFFFFFFFFFFF0402 :                     ; 		movem.l	d3-d7,-(sp)
(1)  516/FFFFFFFFFFFF0402 :                     ; 		movem.l	a4-a6,-(sp)
(1)  517/FFFFFFFFFFFF0402 :                     
(1)  518/FFFFFFFFFFFF0402 : 4DF9 00C0 0000      		lea	(vdp_data),a6
(1)  519/FFFFFFFFFFFF0408 : 6100 0130           		bsr	vid_PickLayer
(1)  520/FFFFFFFFFFFF040C : 4BF8 9814           		lea	(RAM_VidPrntList),a5
(1)  521/FFFFFFFFFFFF0410 :                     .newjump:
(1)  522/FFFFFFFFFFFF0410 : 2D44 0004           		move.l	d4,4(a6)
(1)  523/FFFFFFFFFFFF0414 : 2A04                		move.l	d4,d5
(1)  524/FFFFFFFFFFFF0416 :                     .loop:
(1)  525/FFFFFFFFFFFF0416 : 1E18                		move.b	(a0)+,d7
(1)  526/FFFFFFFFFFFF0418 : 6772                		beq	.exit
(1)  527/FFFFFFFFFFFF041A : 0C07 000A           		cmpi.b	#$A,d7			; $A - next line?
(1)  528/FFFFFFFFFFFF041E : 6718                		beq.s	.next
(1)  529/FFFFFFFFFFFF0420 : 0C07 005C           		cmpi.b	#$5C,d7			; $27 ("\") special?
(1)  530/FFFFFFFFFFFF0424 : 6716                		beq.s	.special
(1)  531/FFFFFFFFFFFF0426 : 0247 00FF           		andi.w	#$FF,d7
(1)  532/FFFFFFFFFFFF042A :                     .puttext:
(1)  533/FFFFFFFFFFFF042A : DE78 999C           		add.w	(RAM_VidPrntVram).w,d7	; VRAM add
(1)  534/FFFFFFFFFFFF042E : 3C87                		move.w	d7,(a6)
(1)  535/FFFFFFFFFFFF0430 : DABC 0002 0000      		add.l	#$20000,d5
(1)  536/FFFFFFFFFFFF0436 : 60DE                		bra.s	.loop
(1)  537/FFFFFFFFFFFF0438 :                     ; Next line
(1)  538/FFFFFFFFFFFF0438 :                     .next:
(1)  539/FFFFFFFFFFFF0438 : D886                		add.l	d6,d4
(1)  540/FFFFFFFFFFFF043A : 60D4                		bra.s	.newjump
(1)  541/FFFFFFFFFFFF043C :                     
(1)  542/FFFFFFFFFFFF043C :                     ; Specials
(1)  543/FFFFFFFFFFFF043C :                     .special:
(1)  544/FFFFFFFFFFFF043C : 1E18                		move.b	(a0)+,d7
(1)  545/FFFFFFFFFFFF043E : 0C07 0062           		cmpi.b	#"b",d7
(1)  546/FFFFFFFFFFFF0442 : 6712                		beq.s	.isbyte
(1)  547/FFFFFFFFFFFF0444 : 0C07 0077           		cmpi.b	#"w",d7
(1)  548/FFFFFFFFFFFF0448 : 671E                		beq.s	.isword
(1)  549/FFFFFFFFFFFF044A : 0C07 006C           		cmpi.b	#"l",d7
(1)  550/FFFFFFFFFFFF044E : 672A                		beq.s	.islong
(1)  551/FFFFFFFFFFFF0450 : 3E3C 005C           		move.w	#"\\",d7		; normal " \ "
(1)  552/FFFFFFFFFFFF0454 : 60D4                		bra.s	.puttext
(1)  553/FFFFFFFFFFFF0456 :                     
(1)  554/FFFFFFFFFFFF0456 :                     	; TEMPORAL VALUES
(1)  555/FFFFFFFFFFFF0456 :                     .isbyte:
(1)  556/FFFFFFFFFFFF0456 : 2AC5                		move.l	d5,(a5)+
(1)  557/FFFFFFFFFFFF0458 : 3AFC 0001           		move.w	#1,(a5)+
(1)  558/FFFFFFFFFFFF045C : DABC 0004 0000      		add.l	#$40000,d5
(1)  559/FFFFFFFFFFFF0462 : 2D45 0004           		move.l	d5,4(a6)
(1)  560/FFFFFFFFFFFF0466 : 60AE                		bra	.loop
(1)  561/FFFFFFFFFFFF0468 :                     .isword:
(1)  562/FFFFFFFFFFFF0468 : 2AC5                		move.l	d5,(a5)+
(1)  563/FFFFFFFFFFFF046A : 3AFC 0002           		move.w	#2,(a5)+
(1)  564/FFFFFFFFFFFF046E : DABC 0008 0000      		add.l	#$80000,d5
(1)  565/FFFFFFFFFFFF0474 : 2D45 0004           		move.l	d5,4(a6)
(1)  566/FFFFFFFFFFFF0478 : 609C                		bra	.loop
(1)  567/FFFFFFFFFFFF047A :                     .islong:
(1)  568/FFFFFFFFFFFF047A : 2AC5                		move.l	d5,(a5)+
(1)  569/FFFFFFFFFFFF047C : 3AFC 0003           		move.w	#3,(a5)+
(1)  570/FFFFFFFFFFFF0480 : DABC 0010 0000      		add.l	#$100000,d5
(1)  571/FFFFFFFFFFFF0486 : 2D45 0004           		move.l	d5,4(a6)
(1)  572/FFFFFFFFFFFF048A : 608A                		bra	.loop
(1)  573/FFFFFFFFFFFF048C :                     .exit:
(1)  574/FFFFFFFFFFFF048C :                     
(1)  575/FFFFFFFFFFFF048C :                     	; ----------------------------------------
(1)  576/FFFFFFFFFFFF048C :                     	; Print values
(1)  577/FFFFFFFFFFFF048C :                     	;
(1)  578/FFFFFFFFFFFF048C :                     	; vvvv vvvv tttt
(1)  579/FFFFFFFFFFFF048C :                     	; v - vdp pos
(1)  580/FFFFFFFFFFFF048C :                     	; t - value type
(1)  581/FFFFFFFFFFFF048C :                     	; ----------------------------------------
(1)  582/FFFFFFFFFFFF048C :                     
(1)  583/FFFFFFFFFFFF048C :                     	; reading byte by byte because longs doesn't get
(1)  584/FFFFFFFFFFFF048C :                     	; aligned after $00...
(1)  585/FFFFFFFFFFFF048C :                     
(1)  586/FFFFFFFFFFFF048C : 7800                		moveq	#0,d4
(1)  587/FFFFFFFFFFFF048E : 7A00                		moveq	#0,d5
(1)  588/FFFFFFFFFFFF0490 : 7C00                		moveq	#0,d6
(1)  589/FFFFFFFFFFFF0492 : 4BF8 9814           		lea	(RAM_VidPrntList),a5
(1)  590/FFFFFFFFFFFF0496 :                     .nextv:
(1)  591/FFFFFFFFFFFF0496 : 4A95                		tst.l	(a5)
(1)  592/FFFFFFFFFFFF0498 : 6700 009E           		beq	.nothing
(1)  593/FFFFFFFFFFFF049C :                     
(1)  594/FFFFFFFFFFFF049C :                     	; grab value
(1)  595/FFFFFFFFFFFF049C : 7800                		moveq	#0,d4
(1)  596/FFFFFFFFFFFF049E : 1818                		move.b	(a0)+,d4
(1)  597/FFFFFFFFFFFF04A0 : E19C                		rol.l	#8,d4
(1)  598/FFFFFFFFFFFF04A2 : 1818                		move.b	(a0)+,d4
(1)  599/FFFFFFFFFFFF04A4 : E19C                		rol.l	#8,d4
(1)  600/FFFFFFFFFFFF04A6 : 1818                		move.b	(a0)+,d4
(1)  601/FFFFFFFFFFFF04A8 : E19C                		rol.l	#8,d4
(1)  602/FFFFFFFFFFFF04AA : 1818                		move.b	(a0)+,d4
(1)  603/FFFFFFFFFFFF04AC : 2844                		movea.l	d4,a4
(1)  604/FFFFFFFFFFFF04AE : 7800                		moveq	#0,d4
(1)  605/FFFFFFFFFFFF04B0 :                     
(1)  606/FFFFFFFFFFFF04B0 :                     	; get value
(1)  607/FFFFFFFFFFFF04B0 : 3C2D 0004           		move.w	4(a5),d6
(1)  608/FFFFFFFFFFFF04B4 : BC7C 0001           		cmp.w	#1,d6		; byte?
(1)  609/FFFFFFFFFFFF04B8 : 660E                		bne.s	.vbyte
(1)  610/FFFFFFFFFFFF04BA : 1814                		move.b	(a4),d4
(1)  611/FFFFFFFFFFFF04BC : 2D55 0004           		move.l	(a5),4(a6)
(1)  612/FFFFFFFFFFFF04C0 : E91C                		rol.b	#4,d4
(1)  613/FFFFFFFFFFFF04C2 : 6158                		bsr.s	.donibl
(1)  614/FFFFFFFFFFFF04C4 : E91C                		rol.b	#4,d4
(1)  615/FFFFFFFFFFFF04C6 : 6154                		bsr.s	.donibl
(1)  616/FFFFFFFFFFFF04C8 :                     .vbyte:
(1)  617/FFFFFFFFFFFF04C8 : BC7C 0002           		cmp.w	#2,d6		; word?
(1)  618/FFFFFFFFFFFF04CC : 661C                		bne.s	.vword
(1)  619/FFFFFFFFFFFF04CE : 1814                		move.b	(a4),d4
(1)  620/FFFFFFFFFFFF04D0 : E15C                		rol.w	#8,d4
(1)  621/FFFFFFFFFFFF04D2 : 182C 0001           		move.b	1(a4),d4
(1)  622/FFFFFFFFFFFF04D6 : 2D55 0004           		move.l	(a5),4(a6)
(1)  623/FFFFFFFFFFFF04DA : E95C                		rol.w	#4,d4
(1)  624/FFFFFFFFFFFF04DC : 613E                		bsr.s	.donibl
(1)  625/FFFFFFFFFFFF04DE : E95C                		rol.w	#4,d4
(1)  626/FFFFFFFFFFFF04E0 : 613A                		bsr.s	.donibl
(1)  627/FFFFFFFFFFFF04E2 : E95C                		rol.w	#4,d4
(1)  628/FFFFFFFFFFFF04E4 : 6136                		bsr.s	.donibl
(1)  629/FFFFFFFFFFFF04E6 : E95C                		rol.w	#4,d4
(1)  630/FFFFFFFFFFFF04E8 : 6132                		bsr.s	.donibl
(1)  631/FFFFFFFFFFFF04EA :                     .vword:
(1)  632/FFFFFFFFFFFF04EA :                     
(1)  633/FFFFFFFFFFFF04EA :                     	; TODO: might break on negative values
(1)  634/FFFFFFFFFFFF04EA : BC7C 0003           		cmp.w	#3,d6		; long?
(1)  635/FFFFFFFFFFFF04EE : 6624                		bne.s	.vlong
(1)  636/FFFFFFFFFFFF04F0 : 1814                		move.b	(a4),d4
(1)  637/FFFFFFFFFFFF04F2 : E19C                		rol.l	#8,d4
(1)  638/FFFFFFFFFFFF04F4 : 182C 0001           		move.b	1(a4),d4
(1)  639/FFFFFFFFFFFF04F8 : E19C                		rol.l	#8,d4
(1)  640/FFFFFFFFFFFF04FA : 182C 0002           		move.b	2(a4),d4
(1)  641/FFFFFFFFFFFF04FE : E19C                		rol.l	#8,d4
(1)  642/FFFFFFFFFFFF0500 : 182C 0003           		move.b	3(a4),d4
(1)  643/FFFFFFFFFFFF0504 : 2D55 0004           		move.l	(a5),4(a6)
(1)  644/FFFFFFFFFFFF0508 : 3C3C 0007           		move.w	#7,d6
(1)  645/FFFFFFFFFFFF050C : E99C                .lngloop:	rol.l	#4,d4
(1)  646/FFFFFFFFFFFF050E : 610C                		bsr.s	.donibl
(1)  647/FFFFFFFFFFFF0510 : 51CE FFFA           		dbf	d6,.lngloop
(1)  648/FFFFFFFFFFFF0514 :                     .vlong:
(1)  649/FFFFFFFFFFFF0514 : 429D                		clr.l	(a5)+
(1)  650/FFFFFFFFFFFF0516 : 425D                		clr.w	(a5)+
(1)  651/FFFFFFFFFFFF0518 : 6000 FF7C           		bra	.nextv
(1)  652/FFFFFFFFFFFF051C :                     
(1)  653/FFFFFFFFFFFF051C :                     ; make nibble byte
(1)  654/FFFFFFFFFFFF051C :                     .donibl:
(1)  655/FFFFFFFFFFFF051C : 3A04                		move.w	d4,d5
(1)  656/FFFFFFFFFFFF051E : 0245 000F           		andi.w	#%1111,d5
(1)  657/FFFFFFFFFFFF0522 : BA3C 000A           		cmp.b	#$A,d5
(1)  658/FFFFFFFFFFFF0526 : 6D04                		blt.s	.lowr
(1)  659/FFFFFFFFFFFF0528 : DA3C 0007           		add.b	#7,d5
(1)  660/FFFFFFFFFFFF052C :                     .lowr:
(1)  661/FFFFFFFFFFFF052C : DA7C 0030           		add.w	#"0",d5
(1)  662/FFFFFFFFFFFF0530 : DA78 999C           		add.w	(RAM_VidPrntVram),d5
(1)  663/FFFFFFFFFFFF0534 : 3C85                		move.w	d5,(a6)
(1)  664/FFFFFFFFFFFF0536 : 4E75                		rts
(1)  665/FFFFFFFFFFFF0538 :                     ; exit
(1)  666/FFFFFFFFFFFF0538 :                     .nothing:
(1)  667/FFFFFFFFFFFF0538 :                     ; 		movem.l	(sp)+,a4-a6
(1)  668/FFFFFFFFFFFF0538 :                     ; 		movem.l	(sp)+,d3-d7
(1)  669/FFFFFFFFFFFF0538 : 4E75                		rts
(1)  670/FFFFFFFFFFFF053A :                     
(1)  671/FFFFFFFFFFFF053A :                     ; --------------------------------------------------------
(1)  672/FFFFFFFFFFFF053A :                     ; Shared: pick layer / x pos / y pos and set size
(1)  673/FFFFFFFFFFFF053A :                     ; --------------------------------------------------------
(1)  674/FFFFFFFFFFFF053A :                     
(1)  675/FFFFFFFFFFFF053A :                     vid_PickLayer:
(1)  676/FFFFFFFFFFFF053A : 2C00                		move.l	d0,d6			; Pick layer
(1)  677/FFFFFFFFFFFF053C : 4846                		swap	d6
(1)  678/FFFFFFFFFFFF053E : 0806 0000           		btst	#0,d6
(1)  679/FFFFFFFFFFFF0542 : 671E                		beq.s	.plawnd
(1)  680/FFFFFFFFFFFF0544 : 1839 FFFF 99B2      		move.b	(RAM_VdpRegs+4).l,d4	; BG
(1)  681/FFFFFFFFFFFF054A : 3A04                		move.w	d4,d5
(1)  682/FFFFFFFFFFFF054C : E24D                		lsr.w	#1,d5
(1)  683/FFFFFFFFFFFF054E : 0245 0003           		andi.w	#%11,d5
(1)  684/FFFFFFFFFFFF0552 : 4844                		swap	d4
(1)  685/FFFFFFFFFFFF0554 : 3805                		move.w	d5,d4
(1)  686/FFFFFFFFFFFF0556 : 4844                		swap	d4
(1)  687/FFFFFFFFFFFF0558 : 0244 0001           		andi.w	#1,d4
(1)  688/FFFFFFFFFFFF055C : E14C                		lsl.w	#8,d4
(1)  689/FFFFFFFFFFFF055E : EB4C                		lsl.w	#5,d4
(1)  690/FFFFFFFFFFFF0560 : 6028                		bra.s	.golyr
(1)  691/FFFFFFFFFFFF0562 :                     .plawnd:
(1)  692/FFFFFFFFFFFF0562 : 1839 FFFF 99B0      		move.b	(RAM_VdpRegs+2).l,d4	; FG
(1)  693/FFFFFFFFFFFF0568 : 0806 0001           		btst	#1,d6
(1)  694/FFFFFFFFFFFF056C : 6706                		beq.s	.nowd
(1)  695/FFFFFFFFFFFF056E : 1839 FFFF 99B1      		move.b	(RAM_VdpRegs+3).l,d4	; WINDOW
(1)  696/FFFFFFFFFFFF0574 :                     .nowd:
(1)  697/FFFFFFFFFFFF0574 : 3A04                		move.w	d4,d5
(1)  698/FFFFFFFFFFFF0576 : E84D                		lsr.w	#4,d5
(1)  699/FFFFFFFFFFFF0578 : 0245 0003           		andi.w	#%11,d5
(1)  700/FFFFFFFFFFFF057C : 4844                		swap	d4
(1)  701/FFFFFFFFFFFF057E : 3805                		move.w	d5,d4
(1)  702/FFFFFFFFFFFF0580 : 4844                		swap	d4
(1)  703/FFFFFFFFFFFF0582 : 0244 000E           		andi.w	#%00001110,d4
(1)  704/FFFFFFFFFFFF0586 : E14C                		lsl.w	#8,d4
(1)  705/FFFFFFFFFFFF0588 : E54C                		lsl.w	#2,d4
(1)  706/FFFFFFFFFFFF058A :                     .golyr:
(1)  707/FFFFFFFFFFFF058A : 0044 4000           		ori.w	#$4000,d4
(1)  708/FFFFFFFFFFFF058E : 3A00                		move.w	d0,d5			; Y start pos
(1)  709/FFFFFFFFFFFF0590 : 0245 00FF           		andi.w	#$FF,d5			; Y only
(1)  710/FFFFFFFFFFFF0594 : ED4D                		lsl.w	#6,d5
(1)  711/FFFFFFFFFFFF0596 : 1C38 99BE           		move.b	(RAM_VdpRegs+$10).w,d6
(1)  712/FFFFFFFFFFFF059A : 0246 0003           		andi.w	#%11,d6
(1)  713/FFFFFFFFFFFF059E : 670A                		beq.s	.thissz
(1)  714/FFFFFFFFFFFF05A0 : DA45                		add.w	d5,d5			; H64
(1)  715/FFFFFFFFFFFF05A2 : 0246 0002           		andi.w	#%10,d6
(1)  716/FFFFFFFFFFFF05A6 : 6702                		beq.s	.thissz
(1)  717/FFFFFFFFFFFF05A8 : DA45                		add.w	d5,d5			; H128
(1)  718/FFFFFFFFFFFF05AA :                     .thissz:
(1)  719/FFFFFFFFFFFF05AA : D845                		add.w	d5,d4
(1)  720/FFFFFFFFFFFF05AC : 3A00                		move.w	d0,d5
(1)  721/FFFFFFFFFFFF05AE : 0245 FF00           		andi.w	#$FF00,d5		; X only
(1)  722/FFFFFFFFFFFF05B2 : EE4D                		lsr.w	#7,d5
(1)  723/FFFFFFFFFFFF05B4 : D845                		add.w	d5,d4			; X add
(1)  724/FFFFFFFFFFFF05B6 : 4844                		swap	d4
(1)  725/FFFFFFFFFFFF05B8 : 7C00                		moveq	#0,d6
(1)  726/FFFFFFFFFFFF05BA : 3C3C 0040           		move.w	#$40,d6			; Set jump size
(1)  727/FFFFFFFFFFFF05BE : 1A38 99BE           		move.b	(RAM_VdpRegs+$10).w,d5
(1)  728/FFFFFFFFFFFF05C2 : 0245 0003           		andi.w	#%11,d5
(1)  729/FFFFFFFFFFFF05C6 : 670A                		beq.s	.thisszj
(1)  730/FFFFFFFFFFFF05C8 : DC46                		add.w	d6,d6			; H64
(1)  731/FFFFFFFFFFFF05CA : 0245 0002           		andi.w	#%10,d5
(1)  732/FFFFFFFFFFFF05CE : 6702                		beq.s	.thisszj
(1)  733/FFFFFFFFFFFF05D0 : DC46                		add.w	d6,d6			; H128
(1)  734/FFFFFFFFFFFF05D2 :                     .thisszj:
(1)  735/FFFFFFFFFFFF05D2 : 4846                		swap	d6
(1)  736/FFFFFFFFFFFF05D4 : 4E75                		rts
(1)  737/FFFFFFFFFFFF05D6 :                     
(1)  738/FFFFFFFFFFFF05D6 :                     ; ====================================================================
(1)  739/FFFFFFFFFFFF05D6 :                     ; ----------------------------------------------------------------
(1)  740/FFFFFFFFFFFF05D6 :                     ; Palette fade system, Genesis side
(1)  741/FFFFFFFFFFFF05D6 :                     ; ----------------------------------------------------------------
(1)  742/FFFFFFFFFFFF05D6 :                     
(1)  743/FFFFFFFFFFFF05D6 :                     ; --------------------------------------------------------
(1)  744/FFFFFFFFFFFF05D6 :                     ; Video_RunFade
(1)  745/FFFFFFFFFFFF05D6 :                     ;
(1)  746/FFFFFFFFFFFF05D6 :                     ; Processes palette fading and reports if requests
(1)  747/FFFFFFFFFFFF05D6 :                     ; finished on exit.
(1)  748/FFFFFFFFFFFF05D6 :                     ;
(1)  749/FFFFFFFFFFFF05D6 :                     ; Returns:
(1)  750/FFFFFFFFFFFF05D6 :                     ; bne - Still active
(1)  751/FFFFFFFFFFFF05D6 :                     ; beq - Finished
(1)  752/FFFFFFFFFFFF05D6 :                     ;
(1)  753/FFFFFFFFFFFF05D6 :                     ; *** CALL System_WaitFrame FIRST ***
(1)  754/FFFFFFFFFFFF05D6 :                     ; --------------------------------------------------------
(1)  755/FFFFFFFFFFFF05D6 :                     
(1)  756/FFFFFFFFFFFF05D6 :                     Video_RunFade:
(1)  757/FFFFFFFFFFFF05D6 : 613E                		bsr	Video_DoPalFade
(1)  758/FFFFFFFFFFFF05D8 : 6100 0E08           		bsr	Video_MarsPalFade
(1)  759/FFFFFFFFFFFF05DC : 3E38 99A6           		move.w	(RAM_FadeMarsReq),d7
(1)  760/FFFFFFFFFFFF05E0 : 3C38 999E           		move.w	(RAM_FadeMdReq),d6
(1)  761/FFFFFFFFFFFF05E4 : 8E46                		or.w	d6,d7
(1)  762/FFFFFFFFFFFF05E6 : 4E75                		rts
(1)  763/FFFFFFFFFFFF05E8 :                     
(1)  764/FFFFFFFFFFFF05E8 :                     ; --------------------------------------------------------
(1)  765/FFFFFFFFFFFF05E8 :                     ; Video_LoadPal
(1)  766/FFFFFFFFFFFF05E8 :                     ;
(1)  767/FFFFFFFFFFFF05E8 :                     ; Input:
(1)  768/FFFFFFFFFFFF05E8 :                     ; a0 - Palette data
(1)  769/FFFFFFFFFFFF05E8 :                     ; d0 - Start position
(1)  770/FFFFFFFFFFFF05E8 :                     ; d1 - Number of colors
(1)  771/FFFFFFFFFFFF05E8 :                     ;
(1)  772/FFFFFFFFFFFF05E8 :                     ; Breaks:
(1)  773/FFFFFFFFFFFF05E8 :                     ; d5-d7,a6
(1)  774/FFFFFFFFFFFF05E8 :                     ; --------------------------------------------------------
(1)  775/FFFFFFFFFFFF05E8 :                     
(1)  776/FFFFFFFFFFFF05E8 :                     Video_FadePal:
(1)  777/FFFFFFFFFFFF05E8 : 4DF8 94B4           		lea	(RAM_PaletteFd),a6
(1)  778/FFFFFFFFFFFF05EC : 4278 99A4           		clr.w	(RAM_FadeMdTmr).w
(1)  779/FFFFFFFFFFFF05F0 : 6004                		bra.s	vidMd_Pal
(1)  780/FFFFFFFFFFFF05F2 :                     Video_LoadPal:
(1)  781/FFFFFFFFFFFF05F2 : 4DF8 9434           		lea	(RAM_Palette),a6
(1)  782/FFFFFFFFFFFF05F6 :                     vidMd_Pal:
(1)  783/FFFFFFFFFFFF05F6 : 2A48                		move.l	a0,a5
(1)  784/FFFFFFFFFFFF05F8 : 7E00                		moveq	#0,d7
(1)  785/FFFFFFFFFFFF05FA : 3E00                		move.w	d0,d7
(1)  786/FFFFFFFFFFFF05FC : DE47                		add.w	d7,d7
(1)  787/FFFFFFFFFFFF05FE : DCC7                		adda	d7,a6
(1)  788/FFFFFFFFFFFF0600 : 3E01                		move.w	d1,d7
(1)  789/FFFFFFFFFFFF0602 : 9E7C 0001           		sub.w	#1,d7
(1)  790/FFFFFFFFFFFF0606 : 3C02                		move.w	d2,d6
(1)  791/FFFFFFFFFFFF0608 : CC7C 0001           		and.w	#1,d6
(1)  792/FFFFFFFFFFFF060C : E25E                		ror.w	#1,d6
(1)  793/FFFFFFFFFFFF060E :                     .loop:
(1)  794/FFFFFFFFFFFF060E : 3CDD                		move.w	(a5)+,(a6)+
(1)  795/FFFFFFFFFFFF0610 : 51CF FFFC           		dbf	d7,.loop
(1)  796/FFFFFFFFFFFF0614 : 4E75                		rts
(1)  797/FFFFFFFFFFFF0616 :                     
(1)  798/FFFFFFFFFFFF0616 :                     ; --------------------------------------------------------
(1)  799/FFFFFFFFFFFF0616 :                     ; Video_DoPalFade
(1)  800/FFFFFFFFFFFF0616 :                     ;
(1)  801/FFFFFFFFFFFF0616 :                     ; RAM_ReqFadeMars: (WORD)
(1)  802/FFFFFFFFFFFF0616 :                     ; $00 - No task or finished.
(1)  803/FFFFFFFFFFFF0616 :                     ; $01 - Fade in
(1)  804/FFFFFFFFFFFF0616 :                     ; $02 - Fade out to black
(1)  805/FFFFFFFFFFFF0616 :                     ;
(1)  806/FFFFFFFFFFFF0616 :                     ; NOTE: ONLY CALL THIS OUTSIDE OF VBLANK
(1)  807/FFFFFFFFFFFF0616 :                     ; --------------------------------------------------------
(1)  808/FFFFFFFFFFFF0616 :                     
(1)  809/FFFFFFFFFFFF0616 :                     Video_DoPalFade:
(1)  810/FFFFFFFFFFFF0616 : 0478 0001 99A4      		sub.w	#1,(RAM_FadeMdTmr).w
(1)  811/FFFFFFFFFFFF061C : 6A14                		bpl.s	.active
(1)  812/FFFFFFFFFFFF061E : 31F8 99A2 99A4      		move.w	(RAM_FadeMdDelay).w,(RAM_FadeMdTmr).w
(1)  813/FFFFFFFFFFFF0624 : 3E38 999E           		move.w	(RAM_FadeMdReq).w,d7
(1)  814/FFFFFFFFFFFF0628 : DE47                		add.w	d7,d7
(1)  815/FFFFFFFFFFFF062A : 3E3B 7008           		move.w	.fade_list(pc,d7.w),d7
(1)  816/FFFFFFFFFFFF062E : 4EFB 7004           		jmp	.fade_list(pc,d7.w)
(1)  817/FFFFFFFFFFFF0632 :                     .active:
(1)  818/FFFFFFFFFFFF0632 : 4E75                		rts
(1)  819/FFFFFFFFFFFF0634 :                     
(1)  820/FFFFFFFFFFFF0634 :                     ; --------------------------------------------
(1)  821/FFFFFFFFFFFF0634 :                     
(1)  822/FFFFFFFFFFFF0634 :                     .fade_list:
(1)  823/FFFFFFFFFFFF0634 : 0006                		dc.w .fade_done-.fade_list
(1)  824/FFFFFFFFFFFF0636 : 0008                		dc.w .fade_in-.fade_list
(1)  825/FFFFFFFFFFFF0638 : 00AC                		dc.w .fade_out-.fade_list
(1)  826/FFFFFFFFFFFF063A :                     
(1)  827/FFFFFFFFFFFF063A :                     ; --------------------------------------------
(1)  828/FFFFFFFFFFFF063A :                     ; No fade or finished.
(1)  829/FFFFFFFFFFFF063A :                     ; --------------------------------------------
(1)  830/FFFFFFFFFFFF063A :                     
(1)  831/FFFFFFFFFFFF063A :                     .fade_done:
(1)  832/FFFFFFFFFFFF063A : 4E75                		rts
(1)  833/FFFFFFFFFFFF063C :                     
(1)  834/FFFFFFFFFFFF063C :                     ; --------------------------------------------
(1)  835/FFFFFFFFFFFF063C :                     ; Fade in
(1)  836/FFFFFFFFFFFF063C :                     ; --------------------------------------------
(1)  837/FFFFFFFFFFFF063C :                     
(1)  838/FFFFFFFFFFFF063C :                     .fade_in:
(1)  839/FFFFFFFFFFFF063C : 4DF8 94B4           		lea	(RAM_PaletteFd),a6
(1)  840/FFFFFFFFFFFF0640 : 4BF8 9434           		lea	(RAM_Palette),a5
(1)  841/FFFFFFFFFFFF0644 : 303C 0040           		move.w	#64,d0				; Num of colors
(1)  842/FFFFFFFFFFFF0648 : 3238 99A0           		move.w	(RAM_FadeMdIncr).w,d1		; Speed
(1)  843/FFFFFFFFFFFF064C : D241                		add.w	d1,d1
(1)  844/FFFFFFFFFFFF064E : 3C00                		move.w	d0,d6
(1)  845/FFFFFFFFFFFF0650 : 4846                		swap	d6
(1)  846/FFFFFFFFFFFF0652 : 907C 0001           		sub.w	#1,d0
(1)  847/FFFFFFFFFFFF0656 :                     .nxt_pal:
(1)  848/FFFFFFFFFFFF0656 : 4242                		clr.w	d2		; Reset finished colorbits
(1)  849/FFFFFFFFFFFF0658 : 3E16                		move.w	(a6),d7		; d7 - Input
(1)  850/FFFFFFFFFFFF065A : 3C15                		move.w	(a5),d6		; d6 - Output
(1)  851/FFFFFFFFFFFF065C : 3607                		move.w	d7,d3		; RED
(1)  852/FFFFFFFFFFFF065E : 3806                		move.w	d6,d4
(1)  853/FFFFFFFFFFFF0660 : CC7C 0EE0           		and.w	#%0000111011100000,d6
(1)  854/FFFFFFFFFFFF0664 : C87C 000E           		and.w	#%0000000000001110,d4
(1)  855/FFFFFFFFFFFF0668 : C67C 000E           		and.w	#%0000000000001110,d3
(1)  856/FFFFFFFFFFFF066C : D841                		add.w	d1,d4
(1)  857/FFFFFFFFFFFF066E : B843                		cmp.w	d3,d4
(1)  858/FFFFFFFFFFFF0670 : 6506                		bcs.s	.no_red
(1)  859/FFFFFFFFFFFF0672 : 3803                		move.w	d3,d4
(1)  860/FFFFFFFFFFFF0674 : 847C 0001           		or.w	#%001,d2	; RED is ready
(1)  861/FFFFFFFFFFFF0678 :                     .no_red:
(1)  862/FFFFFFFFFFFF0678 : 8C44                		or.w	d4,d6
(1)  863/FFFFFFFFFFFF067A : E949                		lsl.w	#4,d1
(1)  864/FFFFFFFFFFFF067C : 3607                		move.w	d7,d3		; GREEN
(1)  865/FFFFFFFFFFFF067E : 3806                		move.w	d6,d4
(1)  866/FFFFFFFFFFFF0680 : CC7C 0E0E           		and.w	#%0000111000001110,d6
(1)  867/FFFFFFFFFFFF0684 : C87C 00E0           		and.w	#%0000000011100000,d4
(1)  868/FFFFFFFFFFFF0688 : C67C 00E0           		and.w	#%0000000011100000,d3
(1)  869/FFFFFFFFFFFF068C : D841                		add.w	d1,d4
(1)  870/FFFFFFFFFFFF068E : B843                		cmp.w	d3,d4
(1)  871/FFFFFFFFFFFF0690 : 6506                		bcs.s	.no_grn
(1)  872/FFFFFFFFFFFF0692 : 3803                		move.w	d3,d4
(1)  873/FFFFFFFFFFFF0694 : 847C 0002           		or.w	#%010,d2	; GREEN is ready
(1)  874/FFFFFFFFFFFF0698 :                     .no_grn:
(1)  875/FFFFFFFFFFFF0698 : 8C44                		or.w	d4,d6
(1)  876/FFFFFFFFFFFF069A : E949                		lsl.w	#4,d1
(1)  877/FFFFFFFFFFFF069C : 3607                		move.w	d7,d3		; BLUE
(1)  878/FFFFFFFFFFFF069E : 3806                		move.w	d6,d4
(1)  879/FFFFFFFFFFFF06A0 : CC7C 00EE           		and.w	#%0000000011101110,d6
(1)  880/FFFFFFFFFFFF06A4 : C87C 0E00           		and.w	#%0000111000000000,d4
(1)  881/FFFFFFFFFFFF06A8 : C67C 0E00           		and.w	#%0000111000000000,d3
(1)  882/FFFFFFFFFFFF06AC : D841                		add.w	d1,d4
(1)  883/FFFFFFFFFFFF06AE : B843                		cmp.w	d3,d4
(1)  884/FFFFFFFFFFFF06B0 : 6506                		bcs.s	.no_blu
(1)  885/FFFFFFFFFFFF06B2 : 3803                		move.w	d3,d4
(1)  886/FFFFFFFFFFFF06B4 : 847C 0004           		or.w	#%100,d2	; BLUE is ready
(1)  887/FFFFFFFFFFFF06B8 :                     .no_blu:
(1)  888/FFFFFFFFFFFF06B8 : 8C44                		or.w	d4,d6
(1)  889/FFFFFFFFFFFF06BA : E049                		lsr.w	#8,d1
(1)  890/FFFFFFFFFFFF06BC : 3AC6                		move.w	d6,(a5)+
(1)  891/FFFFFFFFFFFF06BE : DCFC 0002           		adda	#2,a6
(1)  892/FFFFFFFFFFFF06C2 : B47C 0007           		cmp.w	#%111,d2
(1)  893/FFFFFFFFFFFF06C6 : 6608                		bne.s	.no_fnsh
(1)  894/FFFFFFFFFFFF06C8 : 4846                		swap	d6
(1)  895/FFFFFFFFFFFF06CA : 9C7C 0001           		sub.w	#1,d6
(1)  896/FFFFFFFFFFFF06CE : 4846                		swap	d6
(1)  897/FFFFFFFFFFFF06D0 :                     .no_fnsh:
(1)  898/FFFFFFFFFFFF06D0 : 51C8 FF84           		dbf	d0,.nxt_pal
(1)  899/FFFFFFFFFFFF06D4 : 4846                		swap	d6
(1)  900/FFFFFFFFFFFF06D6 : 4A46                		tst.w	d6
(1)  901/FFFFFFFFFFFF06D8 : 6604                		bne.s	.no_move
(1)  902/FFFFFFFFFFFF06DA : 4278 999E           		clr.w	(RAM_FadeMdReq).w
(1)  903/FFFFFFFFFFFF06DE :                     .no_move:
(1)  904/FFFFFFFFFFFF06DE : 4E75                		rts
(1)  905/FFFFFFFFFFFF06E0 :                     
(1)  906/FFFFFFFFFFFF06E0 :                     ; --------------------------------------------
(1)  907/FFFFFFFFFFFF06E0 :                     ; Fade out
(1)  908/FFFFFFFFFFFF06E0 :                     ; --------------------------------------------
(1)  909/FFFFFFFFFFFF06E0 :                     
(1)  910/FFFFFFFFFFFF06E0 :                     .fade_out:
(1)  911/FFFFFFFFFFFF06E0 : 4DF8 9434           		lea	(RAM_Palette),a6
(1)  912/FFFFFFFFFFFF06E4 : 303C 0040           		move.w	#64,d0				; Num of colors
(1)  913/FFFFFFFFFFFF06E8 : 3238 99A0           		move.w	(RAM_FadeMdIncr).w,d1		; Speed
(1)  914/FFFFFFFFFFFF06EC : 3C00                		move.w	d0,d6
(1)  915/FFFFFFFFFFFF06EE : 4846                		swap	d6
(1)  916/FFFFFFFFFFFF06F0 : 907C 0001           		sub.w	#1,d0
(1)  917/FFFFFFFFFFFF06F4 :                     .nxt_pal_o:
(1)  918/FFFFFFFFFFFF06F4 : 4242                		clr.w	d2			; Reset finished colorbits
(1)  919/FFFFFFFFFFFF06F6 : 3E16                		move.w	(a6),d7			; d7 - Input
(1)  920/FFFFFFFFFFFF06F8 : 3C07                		move.w	d7,d6
(1)  921/FFFFFFFFFFFF06FA : CE7C 0EE0           		and.w	#%0000111011100000,d7
(1)  922/FFFFFFFFFFFF06FE : CC7C 000E           		and.w	#%0000000000001110,d6
(1)  923/FFFFFFFFFFFF0702 : 9C41                		sub.w	d1,d6
(1)  924/FFFFFFFFFFFF0704 : 6A06                		bpl.s	.no_red_o
(1)  925/FFFFFFFFFFFF0706 : 4246                		clr.w	d6
(1)  926/FFFFFFFFFFFF0708 : 847C 0001           		or.w	#%001,d2		; RED is ready
(1)  927/FFFFFFFFFFFF070C :                     .no_red_o:
(1)  928/FFFFFFFFFFFF070C : 8E46                		or.w	d6,d7
(1)  929/FFFFFFFFFFFF070E : E949                		lsl.w	#4,d1
(1)  930/FFFFFFFFFFFF0710 : 3C07                		move.w	d7,d6
(1)  931/FFFFFFFFFFFF0712 : CE7C 0E0E           		and.w	#%0000111000001110,d7
(1)  932/FFFFFFFFFFFF0716 : CC7C 00E0           		and.w	#%0000000011100000,d6
(1)  933/FFFFFFFFFFFF071A : 9C41                		sub.w	d1,d6
(1)  934/FFFFFFFFFFFF071C : 6A06                		bpl.s	.no_grn_o
(1)  935/FFFFFFFFFFFF071E : 4246                		clr.w	d6
(1)  936/FFFFFFFFFFFF0720 : 847C 0002           		or.w	#%010,d2		; GREEN is ready
(1)  937/FFFFFFFFFFFF0724 :                     .no_grn_o:
(1)  938/FFFFFFFFFFFF0724 : 8E46                		or.w	d6,d7
(1)  939/FFFFFFFFFFFF0726 : E949                		lsl.w	#4,d1
(1)  940/FFFFFFFFFFFF0728 : 3C07                		move.w	d7,d6
(1)  941/FFFFFFFFFFFF072A : CE7C 00EE           		and.w	#%0000000011101110,d7
(1)  942/FFFFFFFFFFFF072E : CC7C 0E00           		and.w	#%0000111000000000,d6
(1)  943/FFFFFFFFFFFF0732 : 9C41                		sub.w	d1,d6
(1)  944/FFFFFFFFFFFF0734 : 6A06                		bpl.s	.no_blu_o
(1)  945/FFFFFFFFFFFF0736 : 4246                		clr.w	d6
(1)  946/FFFFFFFFFFFF0738 : 847C 0004           		or.w	#%100,d2		; BLUE is ready
(1)  947/FFFFFFFFFFFF073C :                     .no_blu_o:
(1)  948/FFFFFFFFFFFF073C : 8E46                		or.w	d6,d7
(1)  949/FFFFFFFFFFFF073E : E049                		lsr.w	#8,d1
(1)  950/FFFFFFFFFFFF0740 : 3CC7                		move.w	d7,(a6)+
(1)  951/FFFFFFFFFFFF0742 : B47C 0007           		cmp.w	#%111,d2
(1)  952/FFFFFFFFFFFF0746 : 6608                		bne.s	.no_fnsh_o
(1)  953/FFFFFFFFFFFF0748 : 4846                		swap	d6
(1)  954/FFFFFFFFFFFF074A : 9C7C 0001           		sub.w	#1,d6
(1)  955/FFFFFFFFFFFF074E : 4846                		swap	d6
(1)  956/FFFFFFFFFFFF0750 :                     .no_fnsh_o:
(1)  957/FFFFFFFFFFFF0750 : 51C8 FFA2           		dbf	d0,.nxt_pal_o
(1)  958/FFFFFFFFFFFF0754 : 4846                		swap	d6
(1)  959/FFFFFFFFFFFF0756 : 4A46                		tst.w	d6
(1)  960/FFFFFFFFFFFF0758 : 6604                		bne.s	.no_move_o
(1)  961/FFFFFFFFFFFF075A : 4278 999E           		clr.w	(RAM_FadeMdReq).w
(1)  962/FFFFFFFFFFFF075E :                     .no_move_o:
(1)  963/FFFFFFFFFFFF075E : 4E75                		rts
(1)  964/FFFFFFFFFFFF0760 :                     
(1)  965/FFFFFFFFFFFF0760 :                     ; ====================================================================
(1)  966/FFFFFFFFFFFF0760 :                     ; --------------------------------------------------------
(1)  967/FFFFFFFFFFFF0760 :                     ; Genesis DMA
(1)  968/FFFFFFFFFFFF0760 :                     ; --------------------------------------------------------
(1)  969/FFFFFFFFFFFF0760 :                     
(1)  970/FFFFFFFFFFFF0760 :                     ; --------------------------------------------------------
(1)  971/FFFFFFFFFFFF0760 :                     ; Video_DmaMkEntry
(1)  972/FFFFFFFFFFFF0760 :                     ;
(1)  973/FFFFFFFFFFFF0760 :                     ; Sets a new DMA transfer task to the BLAST list
(1)  974/FFFFFFFFFFFF0760 :                     ;
(1)  975/FFFFFFFFFFFF0760 :                     ; *** ONLY CALL THIS OUTSIDE OF VBLANK ***
(1)  976/FFFFFFFFFFFF0760 :                     ;
(1)  977/FFFFFFFFFFFF0760 :                     ; d0 | LONG - Art data
(1)  978/FFFFFFFFFFFF0760 :                     ; d1 | WORD - VRAM location
(1)  979/FFFFFFFFFFFF0760 :                     ; d2 | WORD - Size
(1)  980/FFFFFFFFFFFF0760 :                     ;
(1)  981/FFFFFFFFFFFF0760 :                     ; Breaks:
(1)  982/FFFFFFFFFFFF0760 :                     ; d6-d7,a6
(1)  983/FFFFFFFFFFFF0760 :                     ; --------------------------------------------------------
(1)  984/FFFFFFFFFFFF0760 :                     
(1)  985/FFFFFFFFFFFF0760 :                     Video_DmaMkEntry:
(1)  986/FFFFFFFFFFFF0760 : 31FC 0001 999A      		move.w	#1,(RAM_VdpDmaMod).w
(1)  987/FFFFFFFFFFFF0766 : 4DF8 9734           		lea	(RAM_VdpDmaList).w,a6
(1)  988/FFFFFFFFFFFF076A : 3E38 9998           		move.w	(RAM_VdpDmaIndx).w,d7
(1)  989/FFFFFFFFFFFF076E : DCC7                		adda	d7,a6
(1)  990/FFFFFFFFFFFF0770 : DE7C 000E           		add.w	#7*2,d7
(1)  991/FFFFFFFFFFFF0774 : 31C7 9998           		move.w	d7,(RAM_VdpDmaIndx).w
(1)  992/FFFFFFFFFFFF0778 : 3E02                		move.w	d2,d7			; Length
(1)  993/FFFFFFFFFFFF077A : 2C3C 9400 9300      		move.l	#$94009300,d6
(1)  994/FFFFFFFFFFFF0780 : E24F                		lsr.w	#1,d7
(1)  995/FFFFFFFFFFFF0782 : 1C07                		move.b	d7,d6
(1)  996/FFFFFFFFFFFF0784 : 4846                		swap	d6
(1)  997/FFFFFFFFFFFF0786 : E04F                		lsr.w	#8,d7
(1)  998/FFFFFFFFFFFF0788 : 1C07                		move.b	d7,d6
(1)  999/FFFFFFFFFFFF078A : 4846                		swap	d6
(1) 1000/FFFFFFFFFFFF078C : 2CC6                		move.l	d6,(a6)+
(1) 1001/FFFFFFFFFFFF078E : 2E00                		move.l	d0,d7			; Source
(1) 1002/FFFFFFFFFFFF0790 : E28F                  		lsr.l	#1,d7
(1) 1003/FFFFFFFFFFFF0792 : 2C3C 9600 9500       		move.l	#$96009500,d6
(1) 1004/FFFFFFFFFFFF0798 : 1C07                 		move.b	d7,d6
(1) 1005/FFFFFFFFFFFF079A : E08F                 		lsr.l	#8,d7
(1) 1006/FFFFFFFFFFFF079C : 4846                 		swap	d6
(1) 1007/FFFFFFFFFFFF079E : 1C07                 		move.b	d7,d6
(1) 1008/FFFFFFFFFFFF07A0 : 2CC6                 		move.l	d6,(a6)+
(1) 1009/FFFFFFFFFFFF07A2 : 3C3C 9700            		move.w	#$9700,d6
(1) 1010/FFFFFFFFFFFF07A6 : E08F                 		lsr.l	#8,d7
(1) 1011/FFFFFFFFFFFF07A8 : 1C07                 		move.b	d7,d6
(1) 1012/FFFFFFFFFFFF07AA : 3CC6                 		move.w	d6,(a6)+
(1) 1013/FFFFFFFFFFFF07AC : 3E01                		move.w	d1,d7			; Destination
(1) 1014/FFFFFFFFFFFF07AE :                     ; 		and.w	#$7FF,d7
(1) 1015/FFFFFFFFFFFF07AE :                     ; 		lsl.w	#5,d7
(1) 1016/FFFFFFFFFFFF07AE : 3C07                		move.w	d7,d6
(1) 1017/FFFFFFFFFFFF07B0 : CEBC 0000 3FE0      		and.l	#$3FE0,d7
(1) 1018/FFFFFFFFFFFF07B6 : 0047 4000           		ori.w	#$4000,d7
(1) 1019/FFFFFFFFFFFF07BA : E04E                		lsr.w	#8,d6
(1) 1020/FFFFFFFFFFFF07BC : EC4E                		lsr.w	#6,d6
(1) 1021/FFFFFFFFFFFF07BE : 0246 0003           		andi.w	#%11,d6
(1) 1022/FFFFFFFFFFFF07C2 : 0046 0080           		ori.w	#$80,d6
(1) 1023/FFFFFFFFFFFF07C6 : 3CC7                		move.w	d7,(a6)+
(1) 1024/FFFFFFFFFFFF07C8 : 3CC6                		move.w	d6,(a6)+
(1) 1025/FFFFFFFFFFFF07CA : 31FC 0000 999A      		move.w	#0,(RAM_VdpDmaMod).w
(1) 1026/FFFFFFFFFFFF07D0 : 4E75                		rts
(1) 1027/FFFFFFFFFFFF07D2 :                     
(1) 1028/FFFFFFFFFFFF07D2 :                     ; --------------------------------------------------------
(1) 1029/FFFFFFFFFFFF07D2 :                     ; Video_Fill
(1) 1030/FFFFFFFFFFFF07D2 :                     ;
(1) 1031/FFFFFFFFFFFF07D2 :                     ; Fill data to VRAM
(1) 1032/FFFFFFFFFFFF07D2 :                     ;
(1) 1033/FFFFFFFFFFFF07D2 :                     ; d0 | WORD - WORD to fill
(1) 1034/FFFFFFFFFFFF07D2 :                     ; d1 | WORD - VRAM position
(1) 1035/FFFFFFFFFFFF07D2 :                     ; d2 | WORD - Size
(1) 1036/FFFFFFFFFFFF07D2 :                     ;
(1) 1037/FFFFFFFFFFFF07D2 :                     ; Breaks:
(1) 1038/FFFFFFFFFFFF07D2 :                     ; d6-d7,a6
(1) 1039/FFFFFFFFFFFF07D2 :                     ; --------------------------------------------------------
(1) 1040/FFFFFFFFFFFF07D2 :                     
(1) 1041/FFFFFFFFFFFF07D2 :                     Video_Fill:
(1) 1042/FFFFFFFFFFFF07D2 : 4DF9 00C0 0004      		lea	(vdp_ctrl),a6
(1) 1043/FFFFFFFFFFFF07D8 : 3E3C 8100           		move.w	#$8100,d7
(1) 1044/FFFFFFFFFFFF07DC : 1E38 99AF           		move.b	(RAM_VdpRegs+1),d7
(1) 1045/FFFFFFFFFFFF07E0 : 08C7 0004           		bset	#bitDmaEnbl,d7
(1) 1046/FFFFFFFFFFFF07E4 : 3C87                		move.w	d7,(a6)
(1) 1047/FFFFFFFFFFFF07E6 : 3E16                .dmaw:		move.w	(a6),d7
(1) 1048/FFFFFFFFFFFF07E8 : 0807 0001           		btst	#bitDma,d7
(1) 1049/FFFFFFFFFFFF07EC : 66F8                		bne.s	.dmaw
(1) 1050/FFFFFFFFFFFF07EE : 3CBC 8F01           		move.w	#$8F01,(a6)	; Increment $01
(1) 1051/FFFFFFFFFFFF07F2 : 3E02                		move.w	d2,d7		; d2 - Size
(1) 1052/FFFFFFFFFFFF07F4 : 9E7C 0001           		sub.w	#1,d7
(1) 1053/FFFFFFFFFFFF07F8 : 2C3C 9400 9300      		move.l	#$94009300,d6
(1) 1054/FFFFFFFFFFFF07FE : 1C07                		move.b	d7,d6
(1) 1055/FFFFFFFFFFFF0800 : 4846                		swap	d6
(1) 1056/FFFFFFFFFFFF0802 : E04F                		lsr.w	#8,d7
(1) 1057/FFFFFFFFFFFF0804 : 1C07                		move.b	d7,d6
(1) 1058/FFFFFFFFFFFF0806 : 4846                		swap	d6
(1) 1059/FFFFFFFFFFFF0808 : 2C86                		move.l	d6,(a6)
(1) 1060/FFFFFFFFFFFF080A : 3CBC 9780           		move.w	#$9780,(a6)	; DMA Fill mode
(1) 1061/FFFFFFFFFFFF080E : 3E01                		move.w	d1,d7		; d1 - Destination
(1) 1062/FFFFFFFFFFFF0810 :                     ; 		lsl.w	#5,d7
(1) 1063/FFFFFFFFFFFF0810 : 3C07                		move.w	d7,d6
(1) 1064/FFFFFFFFFFFF0812 : 0246 3FFF           		andi.w	#$3FFF,d6
(1) 1065/FFFFFFFFFFFF0816 : 0046 4000           		ori.w	#$4000,d6
(1) 1066/FFFFFFFFFFFF081A : 4846                		swap	d6
(1) 1067/FFFFFFFFFFFF081C : 3C07                		move.w	d7,d6
(1) 1068/FFFFFFFFFFFF081E : E04E                		lsr.w	#8,d6
(1) 1069/FFFFFFFFFFFF0820 : EC4E                		lsr.w	#6,d6
(1) 1070/FFFFFFFFFFFF0822 : 0246 0003           		andi.w	#%11,d6
(1) 1071/FFFFFFFFFFFF0826 : 0046 0080           		ori.w	#$80,d6
(1) 1072/FFFFFFFFFFFF082A : 2C86                		move.l	d6,(a6)
(1) 1073/FFFFFFFFFFFF082C : 3D40 FFFC           		move.w	d0,-4(a6)
(1) 1074/FFFFFFFFFFFF0830 : 3E16                .dmawe:		move.w	(a6),d7
(1) 1075/FFFFFFFFFFFF0832 : 0807 0001           		btst	#bitDma,d7
(1) 1076/FFFFFFFFFFFF0836 : 66F8                		bne.s	.dmawe
(1) 1077/FFFFFFFFFFFF0838 : 3CBC 8F02           		move.w	#$8F02,(a6)	; Increment $02
(1) 1078/FFFFFFFFFFFF083C : 3E3C 8100           		move.w	#$8100,d7
(1) 1079/FFFFFFFFFFFF0840 : 1E38 99AF           		move.b	(RAM_VdpRegs+1),d7
(1) 1080/FFFFFFFFFFFF0844 : 3C87                		move.w	d7,(a6)
(1) 1081/FFFFFFFFFFFF0846 : 4E75                		rts
(1) 1082/FFFFFFFFFFFF0848 :                     
(1) 1083/FFFFFFFFFFFF0848 :                     ; --------------------------------------------------------
(1) 1084/FFFFFFFFFFFF0848 :                     ; Video_Copy
(1) 1085/FFFFFFFFFFFF0848 :                     ;
(1) 1086/FFFFFFFFFFFF0848 :                     ; Copy VRAM data to another location
(1) 1087/FFFFFFFFFFFF0848 :                     ;
(1) 1088/FFFFFFFFFFFF0848 :                     ; d0 | WORD - VRAM Source
(1) 1089/FFFFFFFFFFFF0848 :                     ; d1 | WORD - VRAM Destination
(1) 1090/FFFFFFFFFFFF0848 :                     ; d2 | WORD - Size
(1) 1091/FFFFFFFFFFFF0848 :                     ;
(1) 1092/FFFFFFFFFFFF0848 :                     ; Breaks:
(1) 1093/FFFFFFFFFFFF0848 :                     ; d6-d7,a6
(1) 1094/FFFFFFFFFFFF0848 :                     ; --------------------------------------------------------
(1) 1095/FFFFFFFFFFFF0848 :                     
(1) 1096/FFFFFFFFFFFF0848 :                     ; TODO: test if this works again...
(1) 1097/FFFFFFFFFFFF0848 :                     
(1) 1098/FFFFFFFFFFFF0848 :                     Video_Copy:
(1) 1099/FFFFFFFFFFFF0848 : 4DF9 00C0 0004      		lea	(vdp_ctrl),a6
(1) 1100/FFFFFFFFFFFF084E : 3E3C 8100           		move.w	#$8100,d7
(1) 1101/FFFFFFFFFFFF0852 : 1E38 99AF           		move.b	(RAM_VdpRegs+1),d7
(1) 1102/FFFFFFFFFFFF0856 : 08C7 0004           		bset	#bitDmaEnbl,d7
(1) 1103/FFFFFFFFFFFF085A : 3C87                		move.w	d7,(a6)
(1) 1104/FFFFFFFFFFFF085C : 3E16                .dmaw:		move.w	(a6),d7
(1) 1105/FFFFFFFFFFFF085E : 0807 0001           		btst	#bitDma,d7
(1) 1106/FFFFFFFFFFFF0862 : 66F8                		bne.s	.dmaw
(1) 1107/FFFFFFFFFFFF0864 : 3CBC 8F01           		move.w	#$8F01,(a6)		; Increment $01
(1) 1108/FFFFFFFFFFFF0868 : 3E02                		move.w	d2,d7			; SIZE
(1) 1109/FFFFFFFFFFFF086A : 2C3C 9400 9300      		move.l	#$94009300,d6
(1) 1110/FFFFFFFFFFFF0870 :                     ; 		lsr.w	#1,d7
(1) 1111/FFFFFFFFFFFF0870 : 1C07                		move.b	d7,d6
(1) 1112/FFFFFFFFFFFF0872 : 4846                		swap	d6
(1) 1113/FFFFFFFFFFFF0874 : E04F                		lsr.w	#8,d7
(1) 1114/FFFFFFFFFFFF0876 : 1C07                		move.b	d7,d6
(1) 1115/FFFFFFFFFFFF0878 : 4846                		swap	d6
(1) 1116/FFFFFFFFFFFF087A : 2C86                		move.l	d6,(a6)
(1) 1117/FFFFFFFFFFFF087C : 2C3C 9600 9500      		move.l	#$96009500,d6		; SOURCE
(1) 1118/FFFFFFFFFFFF0882 : 3E00                		move.w	d0,d7
(1) 1119/FFFFFFFFFFFF0884 : 1C07                		move.b	d7,d6
(1) 1120/FFFFFFFFFFFF0886 : 4846                		swap	d6
(1) 1121/FFFFFFFFFFFF0888 : E04F                		lsr.w	#8,d7
(1) 1122/FFFFFFFFFFFF088A : 1C07                		move.b	d7,d6
(1) 1123/FFFFFFFFFFFF088C : 2C86                		move.l	d6,(a6)
(1) 1124/FFFFFFFFFFFF088E : 3CBC 97C0           		move.w	#$97C0,(a6)		; DMA Copy mode
(1) 1125/FFFFFFFFFFFF0892 : 2E02                		move.l	d2,d7			; DESTINATION
(1) 1126/FFFFFFFFFFFF0894 :                     ; 		lsl.w	#5,d7
(1) 1127/FFFFFFFFFFFF0894 : 3C07                		move.w	d7,d6
(1) 1128/FFFFFFFFFFFF0896 : 0246 3FFF           		andi.w	#$3FFF,d6
(1) 1129/FFFFFFFFFFFF089A : 0046 4000           		ori.w	#$4000,d6
(1) 1130/FFFFFFFFFFFF089E : 4846                		swap	d6
(1) 1131/FFFFFFFFFFFF08A0 : 3C07                		move.w	d7,d6
(1) 1132/FFFFFFFFFFFF08A2 : E04E                		lsr.w	#8,d6
(1) 1133/FFFFFFFFFFFF08A4 : EC4E                		lsr.w	#6,d6
(1) 1134/FFFFFFFFFFFF08A6 : 0246 0003           		andi.w	#%11,d6
(1) 1135/FFFFFFFFFFFF08AA : 0046 00C0           		ori.w	#$C0,d6
(1) 1136/FFFFFFFFFFFF08AE : 2C86                		move.l	d6,(a6)
(1) 1137/FFFFFFFFFFFF08B0 : 3D41 FFFC           		move.w	d1,-4(a6)
(1) 1138/FFFFFFFFFFFF08B4 : 3E16                .dmawe:		move.w	(a6),d7
(1) 1139/FFFFFFFFFFFF08B6 : 0807 0001           		btst	#bitDma,d7
(1) 1140/FFFFFFFFFFFF08BA : 66F8                		bne.s	.dmawe
(1) 1141/FFFFFFFFFFFF08BC : 3CBC 8F02           		move.w	#$8F02,(a6)		; Increment $02
(1) 1142/FFFFFFFFFFFF08C0 : 3E3C 8100           		move.w	#$8100,d7
(1) 1143/FFFFFFFFFFFF08C4 : 1E38 99AF           		move.b	(RAM_VdpRegs+1),d7
(1) 1144/FFFFFFFFFFFF08C8 : 3C87                		move.w	d7,(a6)
(1) 1145/FFFFFFFFFFFF08CA : 4E75                		rts
(1) 1146/FFFFFFFFFFFF08CC :                     
(1) 1147/FFFFFFFFFFFF08CC :                     ; --------------------------------------------------------
(1) 1148/FFFFFFFFFFFF08CC :                     ; Load graphics using DMA, direct
(1) 1149/FFFFFFFFFFFF08CC :                     ;
(1) 1150/FFFFFFFFFFFF08CC :                     ; d0 | LONG - Art data
(1) 1151/FFFFFFFFFFFF08CC :                     ; d1 | WORD - VRAM location
(1) 1152/FFFFFFFFFFFF08CC :                     ; d2 | WORD - Size
(1) 1153/FFFFFFFFFFFF08CC :                     ;
(1) 1154/FFFFFFFFFFFF08CC :                     ; Breaks:
(1) 1155/FFFFFFFFFFFF08CC :                     ; d5-d7,a4-a6
(1) 1156/FFFFFFFFFFFF08CC :                     ;
(1) 1157/FFFFFFFFFFFF08CC :                     ; *** For faster transfers call this during VBlank ***
(1) 1158/FFFFFFFFFFFF08CC :                     ; *** MAKE SURE SH2 IS NOT IN THE MIDDLE OF READING
(1) 1159/FFFFFFFFFFFF08CC :                     ; ROM ***
(1) 1160/FFFFFFFFFFFF08CC :                     ; --------------------------------------------------------
(1) 1161/FFFFFFFFFFFF08CC :                     
(1) 1162/FFFFFFFFFFFF08CC :                     Video_LoadArt:
(1) 1164/FFFFFFFFFFFF08CC : 2E00                		move.l	d0,d7
(1) 1165/FFFFFFFFFFFF08CE : 0287 00FF 0000      		andi.l	#$FF0000,d7
(1) 1166/FFFFFFFFFFFF08D4 : BEBC 00FF 0000      		cmp.l	#$FF0000,d7
(1) 1167/FFFFFFFFFFFF08DA : 670C                		beq.s	.ram_range
(1) 1168/FFFFFFFFFFFF08DC : 2040                		move.l	d0,a0
(1) 1169/FFFFFFFFFFFF08DE : 3E18                		move.w	(a0)+,d7
(1) 1170/FFFFFFFFFFFF08E0 : 3F07                		move.w	d7,-(sp)
(1) 1171/FFFFFFFFFFFF08E2 : 0680 0000 0002      		addi.l	#2,d0
(1) 1172/FFFFFFFFFFFF08E8 :                     .ram_range:
(1) 1174/FFFFFFFFFFFF08E8 : 40E7                		move.w	sr,-(sp)
(1) 1175/FFFFFFFFFFFF08EA : 007C 0700           		or	#$700,sr
(1) 1176/FFFFFFFFFFFF08EE : 49F9 00C0 0004      		lea	(vdp_ctrl),a4
(1) 1177/FFFFFFFFFFFF08F4 : 3C3C 8100           		move.w	#$8100,d6		; DMA ON
(1) 1178/FFFFFFFFFFFF08F8 : 1C38 99AF           		move.b	(RAM_VdpRegs+1),d6
(1) 1179/FFFFFFFFFFFF08FC : 08C6 0004           		bset	#bitDmaEnbl,d6
(1) 1180/FFFFFFFFFFFF0900 : 3886                		move.w	d6,(a4)
(1) 1181/FFFFFFFFFFFF0902 : 3C02                		move.w	d2,d6			; Length
(1) 1182/FFFFFFFFFFFF0904 : 2A3C 9400 9300      		move.l	#$94009300,d5
(1) 1183/FFFFFFFFFFFF090A : E24E                		lsr.w	#1,d6
(1) 1184/FFFFFFFFFFFF090C : 1A06                		move.b	d6,d5
(1) 1185/FFFFFFFFFFFF090E : 4845                		swap	d5
(1) 1186/FFFFFFFFFFFF0910 : E04E                		lsr.w	#8,d6
(1) 1187/FFFFFFFFFFFF0912 : 1A06                		move.b	d6,d5
(1) 1188/FFFFFFFFFFFF0914 : 4845                		swap	d5
(1) 1189/FFFFFFFFFFFF0916 : 2885                		move.l	d5,(a4)
(1) 1190/FFFFFFFFFFFF0918 : 2C00                		move.l	d0,d6			; Source
(1) 1191/FFFFFFFFFFFF091A : E28E                  		lsr.l	#1,d6
(1) 1192/FFFFFFFFFFFF091C : 2A3C 9600 9500       		move.l	#$96009500,d5
(1) 1193/FFFFFFFFFFFF0922 : 1A06                 		move.b	d6,d5
(1) 1194/FFFFFFFFFFFF0924 : E08E                 		lsr.l	#8,d6
(1) 1195/FFFFFFFFFFFF0926 : 4845                 		swap	d5
(1) 1196/FFFFFFFFFFFF0928 : 1A06                 		move.b	d6,d5
(1) 1197/FFFFFFFFFFFF092A : 2885                 		move.l	d5,(a4)
(1) 1198/FFFFFFFFFFFF092C : 3A3C 9700            		move.w	#$9700,d5
(1) 1199/FFFFFFFFFFFF0930 : E08E                 		lsr.l	#8,d6
(1) 1200/FFFFFFFFFFFF0932 : 1A06                 		move.b	d6,d5
(1) 1201/FFFFFFFFFFFF0934 : 3885                 		move.w	d5,(a4)
(1) 1202/FFFFFFFFFFFF0936 : 3C01                		move.w	d1,d6			; Destination
(1) 1203/FFFFFFFFFFFF0938 : 3A06                		move.w	d6,d5
(1) 1204/FFFFFFFFFFFF093A : CCBC 0000 3FE0      		and.l	#$3FE0,d6
(1) 1205/FFFFFFFFFFFF0940 : 0046 4000           		ori.w	#$4000,d6
(1) 1206/FFFFFFFFFFFF0944 : E04D                		lsr.w	#8,d5
(1) 1207/FFFFFFFFFFFF0946 : EC4D                		lsr.w	#6,d5
(1) 1208/FFFFFFFFFFFF0948 : 0245 0003           		andi.w	#%11,d5
(1) 1209/FFFFFFFFFFFF094C : 0045 0080           		ori.w	#$80,d5
(1) 1210/FFFFFFFFFFFF0950 : 2E00                		move.l	d0,d7
(1) 1211/FFFFFFFFFFFF0952 : 4847                		swap	d7
(1) 1212/FFFFFFFFFFFF0954 : E04F                		lsr.w	#8,d7
(1) 1213/FFFFFFFFFFFF0956 : BE3C 00FF           		cmp.b	#$FF,d7
(1) 1214/FFFFFFFFFFFF095A : 6722                		beq.s	.from_ram
(1) 1215/FFFFFFFFFFFF095C : 6100 0D02           		bsr	System_DmaEnter_ROM
(1) 1216/FFFFFFFFFFFF0960 : 3F05                 		move.w	d5,-(sp)
(1) 1217/FFFFFFFFFFFF0962 : 3886                		move.w	d6,(a4)				; d6 - First word
(1) 1218/FFFFFFFFFFFF0964 : 389F                		move.w	(sp)+,(a4)			; *** Second write, 68k freezes until DMA ends
(1) 1219/FFFFFFFFFFFF0966 : 3C3C 8100           		move.w	#$8100,d6			; DMA OFF
(1) 1220/FFFFFFFFFFFF096A : 1C38 99AF           		move.b	(RAM_VdpRegs+1),d6
(1) 1221/FFFFFFFFFFFF096E : 3886                		move.w	d6,(a4)
(1) 1222/FFFFFFFFFFFF0970 : 46DF                		move.w	(sp)+,sr
(1) 1224/FFFFFFFFFFFF0972 : 6100 0CF0           		bsr	System_DmaExit_ROM
(1) 1225/FFFFFFFFFFFF0976 : 3E1F                		move.w	(sp)+,d7
(1) 1226/FFFFFFFFFFFF0978 : 4E75                		rts
(1) 1228/FFFFFFFFFFFF097A : 6000 0CE8           		bra	System_DmaExit_ROM
(1) 1229/FFFFFFFFFFFF097E :                     .from_ram:
(1) 1230/FFFFFFFFFFFF097E : 3887                		move.w	d7,(a4)
(1) 1231/FFFFFFFFFFFF0980 : 3F05                 		move.w	d5,-(sp)
(1) 1232/FFFFFFFFFFFF0982 : 389F                		move.w	(sp)+,(a4)			; Second write
(1) 1233/FFFFFFFFFFFF0984 : 3E3C 8100           		move.w	#$8100,d7
(1) 1234/FFFFFFFFFFFF0988 : 1E38 99AF           		move.b	(RAM_VdpRegs+1),d7
(1) 1235/FFFFFFFFFFFF098C : 3887                		move.w	d7,(a4)
(1) 1236/FFFFFFFFFFFF098E : 46DF                		move.w	(sp)+,sr
(1) 1237/FFFFFFFFFFFF0990 : 4E75                		rts
(1) 1238/FFFFFFFFFFFF0992 :                     
(1) 1239/FFFFFFFFFFFF0992 :                     ; --------------------------------------------------------
(1) 1240/FFFFFFFFFFFF0992 :                     ; Video_DmaBlast
(1) 1241/FFFFFFFFFFFF0992 :                     ;
(1) 1242/FFFFFFFFFFFF0992 :                     ; Process DMA tasks from a predefined list in RAM
(1) 1243/FFFFFFFFFFFF0992 :                     ; **CALL THIS DURING VBLANK ONLY**
(1) 1244/FFFFFFFFFFFF0992 :                     ;
(1) 1245/FFFFFFFFFFFF0992 :                     ; Breaks:
(1) 1246/FFFFFFFFFFFF0992 :                     ; d5-d7,a3-a4
(1) 1247/FFFFFFFFFFFF0992 :                     ; --------------------------------------------------------
(1) 1248/FFFFFFFFFFFF0992 :                     
(1) 1249/FFFFFFFFFFFF0992 :                     ; Entry format:
(1) 1250/FFFFFFFFFFFF0992 :                     ; $94xx,$93xx,$96xx,$95xx,$97xx (SIZE,SOURCE)
(1) 1251/FFFFFFFFFFFF0992 :                     ; $40000080 (vdp destination + dma bit)
(1) 1252/FFFFFFFFFFFF0992 :                     
(1) 1253/FFFFFFFFFFFF0992 :                     Video_DmaBlast:
(1) 1254/FFFFFFFFFFFF0992 : 4A78 999A           		tst.w	(RAM_VdpDmaMod).w		; Got mid-write?
(1) 1255/FFFFFFFFFFFF0996 : 6656                		bne.s	.exit
(1) 1256/FFFFFFFFFFFF0998 : 4A78 9998           		tst.w	(RAM_VdpDmaIndx).w		; Any requests?
(1) 1257/FFFFFFFFFFFF099C : 6750                		beq.s	.exit
(1) 1258/FFFFFFFFFFFF099E : 49F9 00C0 0004      		lea	(vdp_ctrl),a4			; Enter processing loop
(1) 1259/FFFFFFFFFFFF09A4 : 47F8 9734           		lea	(RAM_VdpDmaList).w,a3
(1) 1260/FFFFFFFFFFFF09A8 : 3E3C 8100           		move.w	#$8100,d7			; DMA ON
(1) 1261/FFFFFFFFFFFF09AC : 1E38 99AF           		move.b	(RAM_VdpRegs+1),d7
(1) 1262/FFFFFFFFFFFF09B0 : 08C7 0004           		bset	#bitDmaEnbl,d7
(1) 1263/FFFFFFFFFFFF09B4 : 3887                		move.w	d7,(a4)
(1) 1264/FFFFFFFFFFFF09B6 : 6100 0CA8           		bsr	System_DmaEnter_ROM		; Request Z80 stop and SH2 backup
(1) 1268/FFFFFFFFFFFF09BA : 4A78 9998           .next:		tst.w	(RAM_VdpDmaIndx).w
(1) 1269/FFFFFFFFFFFF09BE : 6720                		beq.s	.end
(1) 1270/FFFFFFFFFFFF09C0 : 2893                		move.l	(a3),(a4)			; Size
(1) 1271/FFFFFFFFFFFF09C2 : 429B                		clr.l	(a3)+
(1) 1272/FFFFFFFFFFFF09C4 : 2893                		move.l	(a3),(a4)			; Source
(1) 1273/FFFFFFFFFFFF09C6 : 429B                		clr.l	(a3)+
(1) 1274/FFFFFFFFFFFF09C8 : 3893                		move.w	(a3),(a4)
(1) 1275/FFFFFFFFFFFF09CA : 425B                		clr.w	(a3)+
(1) 1276/FFFFFFFFFFFF09CC : 3C13                		move.w	(a3),d6				; Destination
(1) 1277/FFFFFFFFFFFF09CE : 425B                		clr.w	(a3)+
(1) 1278/FFFFFFFFFFFF09D0 : 3A13                		move.w	(a3),d5
(1) 1279/FFFFFFFFFFFF09D2 : 425B                		clr.w	(a3)+
(1) 1280/FFFFFFFFFFFF09D4 : 3886                		move.w	d6,(a4)
(1) 1281/FFFFFFFFFFFF09D6 : 3885                		move.w	d5,(a4)
(1) 1282/FFFFFFFFFFFF09D8 : 0478 000E 9998      		sub.w	#7*2,(RAM_VdpDmaIndx).w
(1) 1283/FFFFFFFFFFFF09DE : 60DA                		bra.s	.next
(1) 1284/FFFFFFFFFFFF09E0 :                     .end:
(1) 1288/FFFFFFFFFFFF09E0 : 6100 0C82           		bsr	System_DmaExit_ROM		; Resume Z80 and SH2 direct
(1) 1289/FFFFFFFFFFFF09E4 : 3E3C 8100           		move.w	#$8100,d7			; DMA OFF
(1) 1290/FFFFFFFFFFFF09E8 : 1E38 99AF           		move.b	(RAM_VdpRegs+1).w,d7
(1) 1291/FFFFFFFFFFFF09EC : 3887                		move.w	d7,(a4)
(1) 1292/FFFFFFFFFFFF09EE :                     .exit:
(1) 1293/FFFFFFFFFFFF09EE : 4E75                		rts
(1) 1294/FFFFFFFFFFFF09F0 :                     
(1) 1295/FFFFFFFFFFFF09F0 :                     ; ====================================================================
(1) 1296/FFFFFFFFFFFF09F0 :                     ; ----------------------------------------------------------------
(1) 1297/FFFFFFFFFFFF09F0 :                     ; MAP layout system
(1) 1298/FFFFFFFFFFFF09F0 :                     ;
(1) 1299/FFFFFFFFFFFF09F0 :                     ; Note: uses some RAM'd video registers.
(1) 1300/FFFFFFFFFFFF09F0 :                     ; ----------------------------------------------------------------
(1) 1301/FFFFFFFFFFFF09F0 :                     
(1) 1302/FFFFFFFFFFFF09F0 :                     ; --------------------------------------------------------
(1) 1303/FFFFFFFFFFFF09F0 :                     ; MdMap_Init
(1) 1304/FFFFFFFFFFFF09F0 :                     ;
(1) 1305/FFFFFFFFFFFF09F0 :                     ; Initializes all BG buffers
(1) 1306/FFFFFFFFFFFF09F0 :                     ; --------------------------------------------------------
(1) 1307/FFFFFFFFFFFF09F0 :                     
(1) 1308/FFFFFFFFFFFF09F0 :                     MdMap_Init:
(1) 1309/FFFFFFFFFFFF09F0 : 41F8 8660           		lea	(RAM_BgBuffer),a0
(1) 1310/FFFFFFFFFFFF09F4 : 323C 0037           		move.w	#((sizeof_mdbg*4)/4)-1,d1
(1) 1311/FFFFFFFFFFFF09F8 : 7000                		moveq	#0,d0
(1) 1312/FFFFFFFFFFFF09FA :                     .clr:
(1) 1313/FFFFFFFFFFFF09FA : 20C0                		move.l	d0,(a0)+
(1) 1314/FFFFFFFFFFFF09FC : 51C9 FFFC           		dbf	d1,.clr
(1) 1315/FFFFFFFFFFFF0A00 : 4E75                		rts
(1) 1316/FFFFFFFFFFFF0A02 :                     
(1) 1317/FFFFFFFFFFFF0A02 :                     ; --------------------------------------------------------
(1) 1318/FFFFFFFFFFFF0A02 :                     ; MdMap_Set
(1) 1319/FFFFFFFFFFFF0A02 :                     ;
(1) 1320/FFFFFFFFFFFF0A02 :                     ; Sets a new scrolling section to use.
(1) 1321/FFFFFFFFFFFF0A02 :                     ;
(1) 1322/FFFFFFFFFFFF0A02 :                     ; **SET YOUR X and Y COORDS EXTERNALLY
(1) 1323/FFFFFFFFFFFF0A02 :                     ; BEFORE GETTING HERE**
(1) 1324/FFFFFFFFFFFF0A02 :                     ;
(1) 1325/FFFFFFFFFFFF0A02 :                     ; Input:
(1) 1326/FFFFFFFFFFFF0A02 :                     ; ** Genesis side **
(1) 1327/FFFFFFFFFFFF0A02 :                     ; d0 | WORD - BG internal slot (-1: 32X only)
(1) 1328/FFFFFFFFFFFF0A02 :                     ; d1 | WORD - VRAM location for map data
(1) 1329/FFFFFFFFFFFF0A02 :                     ; d2 | WORD - VRAM add + palette
(1) 1330/FFFFFFFFFFFF0A02 :                     ; a0 - Level header data:
(1) 1331/FFFFFFFFFFFF0A02 :                     ; 	dc.w width,height
(1) 1332/FFFFFFFFFFFF0A02 :                     ; 	dc.b blkwidth,blkheight
(1) 1333/FFFFFFFFFFFF0A02 :                     ; a1 - Block data
(1) 1334/FFFFFFFFFFFF0A02 :                     ; a2 - LOW priority layout data
(1) 1335/FFFFFFFFFFFF0A02 :                     ; a3 - HIGH priority layout data
(1) 1336/FFFFFFFFFFFF0A02 :                     ; d4 - Collision data
(1) 1337/FFFFFFFFFFFF0A02 :                     ;
(1) 1338/FFFFFFFFFFFF0A02 :                     ; Then load the graphics externally at the same
(1) 1339/FFFFFFFFFFFF0A02 :                     ; VRAM location set in d2
(1) 1340/FFFFFFFFFFFF0A02 :                     ;
(1) 1341/FFFFFFFFFFFF0A02 :                     ; ** 32X side **
(1) 1342/FFFFFFFFFFFF0A02 :                     ; d0 | WORD - Write as -1
(1) 1343/FFFFFFFFFFFF0A02 :                     ; d1 | WORD - Scroll buffer to use on the 32X side (0 - default)
(1) 1344/FFFFFFFFFFFF0A02 :                     ; d2 | WORD - Index-palette increment
(1) 1345/FFFFFFFFFFFF0A02 :                     ; a0 - Level header data: (68K AREA)
(1) 1346/FFFFFFFFFFFF0A02 :                     ; 	dc.w width,height
(1) 1347/FFFFFFFFFFFF0A02 :                     ; 	dc.b blkwidth,blkheight
(1) 1348/FFFFFFFFFFFF0A02 :                     ; a1 - Graphics data stored as blocks (SH2 AREA)
(1) 1349/FFFFFFFFFFFF0A02 :                     ; a2 - MAIN layout (SH2 AREA)
(1) 1350/FFFFFFFFFFFF0A02 :                     ; a3 - *** UNUSED, set to 0
(1) 1351/FFFFFFFFFFFF0A02 :                     ; a4 - Collision data (68K AREA)
(1) 1352/FFFFFFFFFFFF0A02 :                     ;
(1) 1353/FFFFFFFFFFFF0A02 :                     ; Uses:
(1) 1354/FFFFFFFFFFFF0A02 :                     ; d0,d6-d7
(1) 1355/FFFFFFFFFFFF0A02 :                     ; --------------------------------------------------------
(1) 1356/FFFFFFFFFFFF0A02 :                     
(1) 1357/FFFFFFFFFFFF0A02 :                     MdMap_Set:
(1) 1358/FFFFFFFFFFFF0A02 : 4A40                		tst.w	d0
(1) 1359/FFFFFFFFFFFF0A04 : 6A0C                		bpl.s	.md_side
(1) 1360/FFFFFFFFFFFF0A06 : 4DF8 AA00           		lea	(RAM_BgBufferM),a6
(1) 1361/FFFFFFFFFFFF0A0A : 08EE 0006 0003      		bset	#bitMarsBg,md_bg_flags(a6)
(1) 1362/FFFFFFFFFFFF0A10 : 6010                		bra.s	.mars_side
(1) 1363/FFFFFFFFFFFF0A12 :                     .md_side:
(1) 1364/FFFFFFFFFFFF0A12 : 4DF8 8660           		lea	(RAM_BgBuffer),a6
(1) 1365/FFFFFFFFFFFF0A16 : C0FC 0038           		mulu.w	#sizeof_mdbg,d0
(1) 1366/FFFFFFFFFFFF0A1A : DCC0                		adda	d0,a6
(1) 1367/FFFFFFFFFFFF0A1C : 08AE 0006 0003      		bclr	#bitMarsBg,md_bg_flags(a6)
(1) 1368/FFFFFFFFFFFF0A22 :                     .mars_side:
(1) 1369/FFFFFFFFFFFF0A22 : 3D41 001C           		move.w	d1,md_bg_vpos(a6)
(1) 1370/FFFFFFFFFFFF0A26 : 3D42 001E           		move.w	d2,md_bg_vram(a6)
(1) 1371/FFFFFFFFFFFF0A2A :                     
(1) 1372/FFFFFFFFFFFF0A2A : 7E00                		moveq	#0,d7
(1) 1373/FFFFFFFFFFFF0A2C : 3E2E 0030           		move.w	md_bg_x(a6),d7
(1) 1374/FFFFFFFFFFFF0A30 : 1D47 0004           		move.b	d7,md_bg_xset(a6)
(1) 1375/FFFFFFFFFFFF0A34 : 3D47 0018           		move.w	d7,md_bg_x_old(a6)
(1) 1376/FFFFFFFFFFFF0A38 : 4847                		swap	d7
(1) 1377/FFFFFFFFFFFF0A3A : 2D47 0030           		move.l	d7,md_bg_x(a6)
(1) 1378/FFFFFFFFFFFF0A3E : 7E00                		moveq	#0,d7
(1) 1379/FFFFFFFFFFFF0A40 : 3E2E 0034           		move.w	md_bg_y(a6),d7
(1) 1380/FFFFFFFFFFFF0A44 : 1D47 0005           		move.b	d7,md_bg_yset(a6)
(1) 1381/FFFFFFFFFFFF0A48 : 3D47 001A           		move.w	d7,md_bg_y_old(a6)
(1) 1382/FFFFFFFFFFFF0A4C : 4847                		swap	d7
(1) 1383/FFFFFFFFFFFF0A4E : 2D47 0034           		move.l	d7,md_bg_y(a6)
(1) 1384/FFFFFFFFFFFF0A52 : C67C 000F           		and.w	#$F,d3
(1) 1385/FFFFFFFFFFFF0A56 : C87C 000F           		and.w	#$F,d4
(1) 1386/FFFFFFFFFFFF0A5A :                     
(1) 1387/FFFFFFFFFFFF0A5A : 4843                		swap	d3
(1) 1388/FFFFFFFFFFFF0A5C : 4844                		swap	d4
(1) 1389/FFFFFFFFFFFF0A5E : 2D49 0028           		move.l	a1,md_bg_blk(a6)
(1) 1390/FFFFFFFFFFFF0A62 : 2D4A 0020           		move.l	a2,md_bg_low(a6)
(1) 1391/FFFFFFFFFFFF0A66 : 2D4B 0024           		move.l	a3,md_bg_hi(a6)
(1) 1392/FFFFFFFFFFFF0A6A : 2D4C 002C           		move.l	a4,md_bg_col(a6)
(1) 1393/FFFFFFFFFFFF0A6E : 2A48                		move.l	a0,a5
(1) 1394/FFFFFFFFFFFF0A70 : 3E1D                		move.w	(a5)+,d7	; Layout Width (blocks)
(1) 1395/FFFFFFFFFFFF0A72 : 3C1D                		move.w	(a5)+,d6	; Layout Height (blocks)
(1) 1396/FFFFFFFFFFFF0A74 : 181D                		move.b	(a5)+,d4	; BLOCK width
(1) 1397/FFFFFFFFFFFF0A76 : 161D                		move.b	(a5)+,d3	; BLOCK height
(1) 1398/FFFFFFFFFFFF0A78 : C87C 00FF           		and.w	#$FF,d4
(1) 1399/FFFFFFFFFFFF0A7C : C67C 00FF           		and.w	#$FF,d3
(1) 1400/FFFFFFFFFFFF0A80 : 3D47 0008           		move.w	d7,md_bg_w(a6)
(1) 1401/FFFFFFFFFFFF0A84 : 3D46 000A           		move.w	d6,md_bg_h(a6)
(1) 1402/FFFFFFFFFFFF0A88 : 1C84                		move.b	d4,md_bg_bw(a6)
(1) 1403/FFFFFFFFFFFF0A8A : 1D43 0001           		move.b	d3,md_bg_bh(a6)
(1) 1404/FFFFFFFFFFFF0A8E : CEC4                		mulu.w	d4,d7
(1) 1405/FFFFFFFFFFFF0A90 : CCC3                		mulu.w	d3,d6
(1) 1406/FFFFFFFFFFFF0A92 : 3D47 000C           		move.w	d7,md_bg_wf(a6)
(1) 1407/FFFFFFFFFFFF0A96 : 3D46 000E           		move.w	d6,md_bg_hf(a6)
(1) 1408/FFFFFFFFFFFF0A9A : 987C 0001           		sub.w	#1,d4
(1) 1409/FFFFFFFFFFFF0A9E : 967C 0001           		sub.w	#1,d3
(1) 1410/FFFFFFFFFFFF0AA2 : C92E 0004           		and.b	d4,md_bg_xset(a6)
(1) 1411/FFFFFFFFFFFF0AA6 : C72E 0005           		and.b	d3,md_bg_yset(a6)
(1) 1412/FFFFFFFFFFFF0AAA : 4843                		swap	d3
(1) 1413/FFFFFFFFFFFF0AAC : 4844                		swap	d4
(1) 1414/FFFFFFFFFFFF0AAE :                     
(1) 1415/FFFFFFFFFFFF0AAE :                     	; TODO: improve this...
(1) 1416/FFFFFFFFFFFF0AAE : 362E 0030           		move.w	md_bg_x(a6),d3
(1) 1417/FFFFFFFFFFFF0AB2 : 382E 0034           		move.w	md_bg_y(a6),d4
(1) 1418/FFFFFFFFFFFF0AB6 :                     	; X beams
(1) 1419/FFFFFFFFFFFF0AB6 : B647                .xl_l:		cmp.w	d7,d3
(1) 1420/FFFFFFFFFFFF0AB8 : 6D04                		blt.s	.xl_g
(1) 1421/FFFFFFFFFFFF0ABA : 9647                		sub.w	d7,d3
(1) 1422/FFFFFFFFFFFF0ABC : 60F8                		bra.s	.xl_l
(1) 1423/FFFFFFFFFFFF0ABE :                     .xl_g:
(1) 1424/FFFFFFFFFFFF0ABE : 3D43 0010           		move.w	d3,md_bg_xinc_l(a6)
(1) 1425/FFFFFFFFFFFF0AC2 : D67C 0140           		add.w	#320,d3				; <-- X resolution R
(1) 1426/FFFFFFFFFFFF0AC6 : B647                .xr_l:		cmp.w	d7,d3
(1) 1427/FFFFFFFFFFFF0AC8 : 6D04                		blt.s	.xr_g
(1) 1428/FFFFFFFFFFFF0ACA : 9647                		sub.w	d7,d3
(1) 1429/FFFFFFFFFFFF0ACC : 60F8                		bra.s	.xr_l
(1) 1430/FFFFFFFFFFFF0ACE :                     .xr_g:
(1) 1431/FFFFFFFFFFFF0ACE : 3D43 0012           		move.w	d3,md_bg_xinc_r(a6)
(1) 1432/FFFFFFFFFFFF0AD2 :                     
(1) 1433/FFFFFFFFFFFF0AD2 :                     	; Y beams
(1) 1434/FFFFFFFFFFFF0AD2 : B846                .yt_l:		cmp.w	d6,d4
(1) 1435/FFFFFFFFFFFF0AD4 : 6D04                		blt.s	.yt_g
(1) 1436/FFFFFFFFFFFF0AD6 : 9846                		sub.w	d6,d4
(1) 1437/FFFFFFFFFFFF0AD8 : 60F8                		bra.s	.yt_l
(1) 1438/FFFFFFFFFFFF0ADA :                     .yt_g:
(1) 1439/FFFFFFFFFFFF0ADA : 3D44 0014           		move.w	d4,md_bg_yinc_u(a6)
(1) 1440/FFFFFFFFFFFF0ADE : D87C 00E0           		add.w	#224,d4				; <-- Y resolution B
(1) 1441/FFFFFFFFFFFF0AE2 : B846                .yb_l:		cmp.w	d6,d4
(1) 1442/FFFFFFFFFFFF0AE4 : 6D04                		blt.s	.yb_g
(1) 1443/FFFFFFFFFFFF0AE6 : 9846                		sub.w	d6,d4
(1) 1444/FFFFFFFFFFFF0AE8 : 60F8                		bra.s	.yb_l
(1) 1445/FFFFFFFFFFFF0AEA :                     .yb_g:
(1) 1446/FFFFFFFFFFFF0AEA : 3D44 0016           		move.w	d4,md_bg_yinc_d(a6)
(1) 1447/FFFFFFFFFFFF0AEE :                     
(1) 1448/FFFFFFFFFFFF0AEE : 08EE 0007 0003      		bset	#bitBgOn,md_bg_flags(a6)	; Enable this BG
(1) 1449/FFFFFFFFFFFF0AF4 : 4E75                		rts
(1) 1450/FFFFFFFFFFFF0AF6 :                     
(1) 1451/FFFFFFFFFFFF0AF6 :                     ; --------------------------------------------------------
(1) 1452/FFFFFFFFFFFF0AF6 :                     ; MdMap_Move
(1) 1453/FFFFFFFFFFFF0AF6 :                     ;
(1) 1454/FFFFFFFFFFFF0AF6 :                     ; Moves the current background/foreground
(1) 1455/FFFFFFFFFFFF0AF6 :                     ; and checks for overflow.
(1) 1456/FFFFFFFFFFFF0AF6 :                     ;
(1) 1457/FFFFFFFFFFFF0AF6 :                     ; Input:
(1) 1458/FFFFFFFFFFFF0AF6 :                     ; d0 | WORD - Background slot, if -1 32X's
(1) 1459/FFFFFFFFFFFF0AF6 :                     ; d1 | WORD - Current X position
(1) 1460/FFFFFFFFFFFF0AF6 :                     ; d2 | WORD - Current Y position
(1) 1461/FFFFFFFFFFFF0AF6 :                     ; a0 - Background to move and check.
(1) 1462/FFFFFFFFFFFF0AF6 :                     ;
(1) 1463/FFFFFFFFFFFF0AF6 :                     ; Uses:
(1) 1464/FFFFFFFFFFFF0AF6 :                     ; d6-d7
(1) 1465/FFFFFFFFFFFF0AF6 :                     ; --------------------------------------------------------
(1) 1466/FFFFFFFFFFFF0AF6 :                     
(1) 1467/FFFFFFFFFFFF0AF6 :                     MdMap_Move:
(1) 1468/FFFFFFFFFFFF0AF6 : 4DF8 AA00           		lea	(RAM_BgBufferM),a6
(1) 1469/FFFFFFFFFFFF0AFA : 4A40                		tst.w	d0
(1) 1470/FFFFFFFFFFFF0AFC : 6B0A                		bmi.s	.mars_side
(1) 1471/FFFFFFFFFFFF0AFE : 4DF8 8660           		lea	(RAM_BgBuffer),a6
(1) 1472/FFFFFFFFFFFF0B02 : C0FC 0038           		mulu.w	#sizeof_mdbg,d0
(1) 1473/FFFFFFFFFFFF0B06 : DCC0                		adda	d0,a6
(1) 1474/FFFFFFFFFFFF0B08 :                     .mars_side:
(1) 1475/FFFFFFFFFFFF0B08 :                     ; 		btst	#bitBgOn,md_bg_flags(a6)
(1) 1476/FFFFFFFFFFFF0B08 :                     ; 		beq	.not_enabld
(1) 1477/FFFFFFFFFFFF0B08 : 302E 000C           		move.w	md_bg_wf(a6),d0
(1) 1478/FFFFFFFFFFFF0B0C : 4A41                		tst.w	d1
(1) 1479/FFFFFFFFFFFF0B0E : 6A02                		bpl.s	.x_left
(1) 1480/FFFFFFFFFFFF0B10 : 4241                		clr.w	d1
(1) 1481/FFFFFFFFFFFF0B12 :                     .x_left:
(1) 1482/FFFFFFFFFFFF0B12 : 907C 0140           		sub.w	#320,d0
(1) 1483/FFFFFFFFFFFF0B16 : B240                		cmp.w	d0,d1
(1) 1484/FFFFFFFFFFFF0B18 : 6502                		bcs.s	.x_right
(1) 1485/FFFFFFFFFFFF0B1A : 3200                		move.w	d0,d1
(1) 1486/FFFFFFFFFFFF0B1C :                     .x_right:
(1) 1487/FFFFFFFFFFFF0B1C : 302E 000E           		move.w	md_bg_hf(a6),d0
(1) 1488/FFFFFFFFFFFF0B20 : 4A42                		tst.w	d2
(1) 1489/FFFFFFFFFFFF0B22 : 6A02                		bpl.s	.y_left
(1) 1490/FFFFFFFFFFFF0B24 : 4242                		clr.w	d2
(1) 1491/FFFFFFFFFFFF0B26 :                     .y_left:
(1) 1492/FFFFFFFFFFFF0B26 : 907C 00E0           		sub.w	#224,d0
(1) 1493/FFFFFFFFFFFF0B2A : B440                		cmp.w	d0,d2
(1) 1494/FFFFFFFFFFFF0B2C : 6502                		bcs.s	.y_right
(1) 1495/FFFFFFFFFFFF0B2E : 3400                		move.w	d0,d2
(1) 1496/FFFFFFFFFFFF0B30 :                     .y_right:
(1) 1497/FFFFFFFFFFFF0B30 : 3D41 0030           		move.w	d1,md_bg_x(a6)
(1) 1498/FFFFFFFFFFFF0B34 : 3D42 0034           		move.w	d2,md_bg_y(a6)
(1) 1499/FFFFFFFFFFFF0B38 :                     .not_enabld:
(1) 1500/FFFFFFFFFFFF0B38 : 4E75                		rts
(1) 1501/FFFFFFFFFFFF0B3A :                     
(1) 1502/FFFFFFFFFFFF0B3A :                     ; --------------------------------------------------------
(1) 1503/FFFFFFFFFFFF0B3A :                     ; MdMap_Update
(1) 1504/FFFFFFFFFFFF0B3A :                     ;
(1) 1505/FFFFFFFFFFFF0B3A :                     ; Updates backgrounds internally, call this
(1) 1506/FFFFFFFFFFFF0B3A :                     ; BEFORE going into VBlank.
(1) 1507/FFFFFFFFFFFF0B3A :                     ;
(1) 1508/FFFFFFFFFFFF0B3A :                     ; Then later call MdMap_DrawScrl on VBlank,
(1) 1509/FFFFFFFFFFFF0B3A :                     ; this also applies for the 32X as this routine also
(1) 1510/FFFFFFFFFFFF0B3A :                     ; resets the drawing bits.
(1) 1511/FFFFFFFFFFFF0B3A :                     ;
(1) 1512/FFFFFFFFFFFF0B3A :                     ; For the 32X:
(1) 1513/FFFFFFFFFFFF0B3A :                     ; Call System_MarsUpdate AFTER this.
(1) 1514/FFFFFFFFFFFF0B3A :                     ; --------------------------------------------------------
(1) 1515/FFFFFFFFFFFF0B3A :                     
(1) 1516/FFFFFFFFFFFF0B3A :                     MdMap_Update:
(1) 1517/FFFFFFFFFFFF0B3A : 4DF8 AA00           		lea	(RAM_BgBufferM),a6
(1) 1518/FFFFFFFFFFFF0B3E : 610A                		bsr.s	.this_bg
(1) 1519/FFFFFFFFFFFF0B40 : 4DF8 8660           		lea	(RAM_BgBuffer),a6
(1) 1520/FFFFFFFFFFFF0B44 : 6104                		bsr.s	.this_bg
(1) 1521/FFFFFFFFFFFF0B46 : DCFC 0038           		adda	#sizeof_mdbg,a6
(1) 1522/FFFFFFFFFFFF0B4A :                     .this_bg:
(1) 1523/FFFFFFFFFFFF0B4A : 082E 0007 0003      		btst	#bitBgOn,md_bg_flags(a6)
(1) 1524/FFFFFFFFFFFF0B50 : 6700 00AE           		beq	.no_bg
(1) 1525/FFFFFFFFFFFF0B54 : 7200                		moveq	#0,d1
(1) 1526/FFFFFFFFFFFF0B56 : 7400                		moveq	#0,d2
(1) 1527/FFFFFFFFFFFF0B58 : 362E 0030           		move.w	md_bg_x(a6),d3
(1) 1528/FFFFFFFFFFFF0B5C : 302E 0018           		move.w	md_bg_x_old(a6),d0
(1) 1529/FFFFFFFFFFFF0B60 : B640                		cmp.w	d0,d3
(1) 1530/FFFFFFFFFFFF0B62 : 6708                		beq.s	.xequ
(1) 1531/FFFFFFFFFFFF0B64 : 3203                		move.w	d3,d1
(1) 1532/FFFFFFFFFFFF0B66 : 9240                		sub.w	d0,d1
(1) 1533/FFFFFFFFFFFF0B68 : 3D43 0018           		move.w	d3,md_bg_x_old(a6)
(1) 1534/FFFFFFFFFFFF0B6C :                     .xequ:
(1) 1535/FFFFFFFFFFFF0B6C : 362E 0034           		move.w	md_bg_y(a6),d3
(1) 1536/FFFFFFFFFFFF0B70 : 302E 001A           		move.w	md_bg_y_old(a6),d0
(1) 1537/FFFFFFFFFFFF0B74 : B640                		cmp.w	d0,d3
(1) 1538/FFFFFFFFFFFF0B76 : 6708                		beq.s	.yequ
(1) 1539/FFFFFFFFFFFF0B78 : 3403                		move.w	d3,d2
(1) 1540/FFFFFFFFFFFF0B7A : 9440                		sub.w	d0,d2
(1) 1541/FFFFFFFFFFFF0B7C : 3D43 001A           		move.w	d3,md_bg_y_old(a6)
(1) 1542/FFFFFFFFFFFF0B80 :                     .yequ:
(1) 1543/FFFFFFFFFFFF0B80 :                     
(1) 1544/FFFFFFFFFFFF0B80 :                     	; Increment drawing beams
(1) 1545/FFFFFFFFFFFF0B80 : 3001                		move.w	d1,d0
(1) 1546/FFFFFFFFFFFF0B82 : 3A2E 000C           		move.w	md_bg_wf(a6),d5
(1) 1547/FFFFFFFFFFFF0B86 : 382E 0010           		move.w	md_bg_xinc_l(a6),d4
(1) 1548/FFFFFFFFFFFF0B8A : 6176                		bsr.s	.beam_incr
(1) 1549/FFFFFFFFFFFF0B8C : 3D44 0010           		move.w	d4,md_bg_xinc_l(a6)
(1) 1550/FFFFFFFFFFFF0B90 : 382E 0012           		move.w	md_bg_xinc_r(a6),d4
(1) 1551/FFFFFFFFFFFF0B94 : 616C                		bsr.s	.beam_incr
(1) 1552/FFFFFFFFFFFF0B96 : 3D44 0012           		move.w	d4,md_bg_xinc_r(a6)
(1) 1553/FFFFFFFFFFFF0B9A : 3002                		move.w	d2,d0
(1) 1554/FFFFFFFFFFFF0B9C : 3A2E 000E           		move.w	md_bg_hf(a6),d5
(1) 1555/FFFFFFFFFFFF0BA0 : 382E 0014           		move.w	md_bg_yinc_u(a6),d4
(1) 1556/FFFFFFFFFFFF0BA4 : 615C                		bsr.s	.beam_incr
(1) 1557/FFFFFFFFFFFF0BA6 : 3D44 0014           		move.w	d4,md_bg_yinc_u(a6)
(1) 1558/FFFFFFFFFFFF0BAA : 382E 0016           		move.w	md_bg_yinc_d(a6),d4
(1) 1559/FFFFFFFFFFFF0BAE : 6152                		bsr.s	.beam_incr
(1) 1560/FFFFFFFFFFFF0BB0 : 3D44 0016           		move.w	d4,md_bg_yinc_d(a6)
(1) 1561/FFFFFFFFFFFF0BB4 :                     
(1) 1562/FFFFFFFFFFFF0BB4 :                     	; Update internal counters
(1) 1563/FFFFFFFFFFFF0BB4 : 7600                		moveq	#0,d3
(1) 1564/FFFFFFFFFFFF0BB6 : 1616                		move.b	md_bg_bw(a6),d3		; X set
(1) 1565/FFFFFFFFFFFF0BB8 : 102E 0004           		move.b	md_bg_xset(a6),d0
(1) 1566/FFFFFFFFFFFF0BBC : D001                		add.b	d1,d0
(1) 1567/FFFFFFFFFFFF0BBE : 1800                		move.b	d0,d4
(1) 1568/FFFFFFFFFFFF0BC0 : C843                		and.w	d3,d4
(1) 1569/FFFFFFFFFFFF0BC2 : 670C                		beq.s	.x_k
(1) 1570/FFFFFFFFFFFF0BC4 : 7800                		moveq	#bitDrwR,d4
(1) 1571/FFFFFFFFFFFF0BC6 : 4A41                		tst.w	d1
(1) 1572/FFFFFFFFFFFF0BC8 : 6A02                		bpl.s	.x_r
(1) 1573/FFFFFFFFFFFF0BCA : 7801                		moveq	#bitDrwL,d4
(1) 1574/FFFFFFFFFFFF0BCC :                     .x_r:
(1) 1575/FFFFFFFFFFFF0BCC : 09EE 0003           		bset	d4,md_bg_flags(a6)
(1) 1576/FFFFFFFFFFFF0BD0 :                     .x_k:
(1) 1577/FFFFFFFFFFFF0BD0 : 967C 0001           		sub.w	#1,d3
(1) 1578/FFFFFFFFFFFF0BD4 : C003                		and.b	d3,d0
(1) 1579/FFFFFFFFFFFF0BD6 : 1D40 0004           		move.b	d0,md_bg_xset(a6)
(1) 1580/FFFFFFFFFFFF0BDA : 162E 0001           		move.b	md_bg_bh(a6),d3		; Y set
(1) 1581/FFFFFFFFFFFF0BDE : 102E 0005           		move.b	md_bg_yset(a6),d0
(1) 1582/FFFFFFFFFFFF0BE2 : D002                		add.b	d2,d0
(1) 1583/FFFFFFFFFFFF0BE4 : 1800                		move.b	d0,d4
(1) 1584/FFFFFFFFFFFF0BE6 : C843                		and.w	d3,d4
(1) 1585/FFFFFFFFFFFF0BE8 : 670C                		beq.s	.y_k
(1) 1586/FFFFFFFFFFFF0BEA : 7802                		moveq	#bitDrwD,d4
(1) 1587/FFFFFFFFFFFF0BEC : 4A42                		tst.w	d2
(1) 1588/FFFFFFFFFFFF0BEE : 6A02                		bpl.s	.y_d
(1) 1589/FFFFFFFFFFFF0BF0 : 7803                		moveq	#bitDrwU,d4
(1) 1590/FFFFFFFFFFFF0BF2 :                     .y_d:
(1) 1591/FFFFFFFFFFFF0BF2 : 09EE 0003           		bset	d4,md_bg_flags(a6)
(1) 1592/FFFFFFFFFFFF0BF6 :                     .y_k:
(1) 1593/FFFFFFFFFFFF0BF6 : 967C 0001           		sub.w	#1,d3
(1) 1594/FFFFFFFFFFFF0BFA : C003                		and.b	d3,d0
(1) 1595/FFFFFFFFFFFF0BFC : 1D40 0005           		move.b	d0,md_bg_yset(a6)
(1) 1596/FFFFFFFFFFFF0C00 :                     .no_bg:
(1) 1597/FFFFFFFFFFFF0C00 : 4E75                		rts
(1) 1598/FFFFFFFFFFFF0C02 :                     
(1) 1599/FFFFFFFFFFFF0C02 :                     ; d0 - Increment by
(1) 1600/FFFFFFFFFFFF0C02 :                     ; d4 - X/Y beam
(1) 1601/FFFFFFFFFFFF0C02 :                     ; d5 - Max Width/Height
(1) 1602/FFFFFFFFFFFF0C02 :                     .beam_incr:
(1) 1603/FFFFFFFFFFFF0C02 : D840                		add.w	d0,d4
(1) 1604/FFFFFFFFFFFF0C04 : 4A44                .xd_l:		tst.w	d4
(1) 1605/FFFFFFFFFFFF0C06 : 6A04                		bpl.s	.xd_g
(1) 1606/FFFFFFFFFFFF0C08 : D845                		add.w	d5,d4
(1) 1607/FFFFFFFFFFFF0C0A : 60F8                		bra.s	.xd_l
(1) 1608/FFFFFFFFFFFF0C0C : B845                .xd_g:		cmp.w	d5,d4
(1) 1609/FFFFFFFFFFFF0C0E : 6D04                		blt.s	.val_h
(1) 1610/FFFFFFFFFFFF0C10 : 9845                		sub.w	d5,d4
(1) 1611/FFFFFFFFFFFF0C12 : 60F8                		bra.s	.xd_g
(1) 1612/FFFFFFFFFFFF0C14 :                     .val_h:
(1) 1613/FFFFFFFFFFFF0C14 : 4E75                		rts
(1) 1614/FFFFFFFFFFFF0C16 :                     
(1) 1615/FFFFFFFFFFFF0C16 :                     ; --------------------------------------------------------
(1) 1616/FFFFFFFFFFFF0C16 :                     ; MdMap_DrawAll
(1) 1617/FFFFFFFFFFFF0C16 :                     ;
(1) 1618/FFFFFFFFFFFF0C16 :                     ; Call this only if DISPLAY is OFF or in VBlank
(1) 1619/FFFFFFFFFFFF0C16 :                     ;
(1) 1620/FFFFFFFFFFFF0C16 :                     ; Notes:
(1) 1621/FFFFFFFFFFFF0C16 :                     ; - Does NOT check for off-bounds blocks
(1) 1622/FFFFFFFFFFFF0C16 :                     ; - Blocks with ID $00 are skipped.
(1) 1623/FFFFFFFFFFFF0C16 :                     ; --------------------------------------------------------
(1) 1624/FFFFFFFFFFFF0C16 :                     
(1) 1625/FFFFFFFFFFFF0C16 :                     MdMap_DrawAll:
(1) 1626/FFFFFFFFFFFF0C16 : 4DF8 8660           		lea	(RAM_BgBuffer),a6
(1) 1627/FFFFFFFFFFFF0C1A : 6104                		bsr	.this_bg
(1) 1628/FFFFFFFFFFFF0C1C : DCFC 0038           		adda	#sizeof_mdbg,a6
(1) 1629/FFFFFFFFFFFF0C20 :                     .this_bg:
(1) 1630/FFFFFFFFFFFF0C20 : 082E 0007 0003      		btst	#bitBgOn,md_bg_flags(a6)
(1) 1631/FFFFFFFFFFFF0C26 : 6700 00E8           		beq	.no_bg
(1) 1632/FFFFFFFFFFFF0C2A : 2A6E 0028           		move.l	md_bg_blk(a6),a5
(1) 1633/FFFFFFFFFFFF0C2E : 286E 0020           		move.l	md_bg_low(a6),a4
(1) 1634/FFFFFFFFFFFF0C32 : 266E 0024           		move.l	md_bg_hi(a6),a3
(1) 1635/FFFFFFFFFFFF0C36 : 302E 0030           		move.w	md_bg_x(a6),d0		; X start
(1) 1636/FFFFFFFFFFFF0C3A : 322E 0034           		move.w	md_bg_y(a6),d1		; Y start
(1) 1637/FFFFFFFFFFFF0C3E : 1416                		move.b	md_bg_bw(a6),d2
(1) 1638/FFFFFFFFFFFF0C40 : 162E 0001           		move.b	md_bg_bh(a6),d3
(1) 1639/FFFFFFFFFFFF0C44 : 382E 0008           		move.w	md_bg_w(a6),d4
(1) 1640/FFFFFFFFFFFF0C48 :                     ; 		move.w	md_bg_wf(a6),d5
(1) 1641/FFFFFFFFFFFF0C48 :                     ; 		move.w	md_bg_hf(a6),d6
(1) 1642/FFFFFFFFFFFF0C48 :                     
(1) 1643/FFFFFFFFFFFF0C48 : 7C00                		moveq	#0,d6
(1) 1644/FFFFFFFFFFFF0C4A : 3C00                		move.w	d0,d6
(1) 1645/FFFFFFFFFFFF0C4C : CC7C FFF0           		and.w	#-$10,d6
(1) 1646/FFFFFFFFFFFF0C50 : E44E                		lsr.w	#2,d6
(1) 1647/FFFFFFFFFFFF0C52 : CC7C 007F           		and.w	#$7F,d6
(1) 1648/FFFFFFFFFFFF0C56 :                     
(1) 1649/FFFFFFFFFFFF0C56 : 7A00                		moveq	#0,d5
(1) 1650/FFFFFFFFFFFF0C58 : 3A01                		move.w	d1,d5
(1) 1651/FFFFFFFFFFFF0C5A : CA7C FFF0           		and.w	#-$10,d5
(1) 1652/FFFFFFFFFFFF0C5E : E94D                		lsl.w	#4,d5
(1) 1653/FFFFFFFFFFFF0C60 : CA7C 0F00           		and.w	#$F00,d5
(1) 1654/FFFFFFFFFFFF0C64 :                     
(1) 1655/FFFFFFFFFFFF0C64 : DC45                		add.w	d5,d6
(1) 1656/FFFFFFFFFFFF0C66 : DC6E 001C           		add.w	md_bg_vpos(a6),d6
(1) 1657/FFFFFFFFFFFF0C6A : 3A06                		move.w	d6,d5
(1) 1658/FFFFFFFFFFFF0C6C : E55E                		rol.w	#2,d6
(1) 1659/FFFFFFFFFFFF0C6E : CC7C 0003           		and.w	#%11,d6
(1) 1660/FFFFFFFFFFFF0C72 : 4846                		swap	d6
(1) 1661/FFFFFFFFFFFF0C74 : CA7C 3FFF           		and.w	#$3FFF,d5
(1) 1662/FFFFFFFFFFFF0C78 : 3C05                		move.w	d5,d6			; d6 - VDP 2nd|1st writes
(1) 1663/FFFFFFFFFFFF0C7A :                     
(1) 1664/FFFFFFFFFFFF0C7A : C47C 00FF           		and.w	#$FF,d2
(1) 1665/FFFFFFFFFFFF0C7E : C1C2                		muls.w	d2,d0
(1) 1666/FFFFFFFFFFFF0C80 : E048                		lsr.w	#8,d0
(1) 1667/FFFFFFFFFFFF0C82 : C67C 00FF           		and.w	#$FF,d3
(1) 1668/FFFFFFFFFFFF0C86 : C3C3                		muls.w	d3,d1
(1) 1669/FFFFFFFFFFFF0C88 : E049                		lsr.w	#8,d1
(1) 1670/FFFFFFFFFFFF0C8A : C3C4                		muls.w	d4,d1
(1) 1671/FFFFFFFFFFFF0C8C : D081                		add.l	d1,d0
(1) 1672/FFFFFFFFFFFF0C8E : D9C0                		add.l	d0,a4
(1) 1673/FFFFFFFFFFFF0C90 : D7C0                		add.l	d0,a3
(1) 1674/FFFFFFFFFFFF0C92 : 323C 0080           		move.w	#$80,d1
(1) 1675/FFFFFFFFFFFF0C96 : 3601                		move.w	d1,d3
(1) 1676/FFFFFFFFFFFF0C98 : 4841                		swap	d1
(1) 1677/FFFFFFFFFFFF0C9A : 967C 0001           		sub.w	#1,d3
(1) 1678/FFFFFFFFFFFF0C9E : 7400                		moveq	#0,d2
(1) 1679/FFFFFFFFFFFF0CA0 : 342E 001E           		move.w	md_bg_vram(a6),d2	; d2 - VRAM cell pos
(1) 1680/FFFFFFFFFFFF0CA4 : 4843                		swap	d3
(1) 1681/FFFFFFFFFFFF0CA6 : 363C 0004           		move.w	#4,d3			; d3 - X wrap | X next block
(1) 1682/FFFFFFFFFFFF0CAA : 383C 0FFF           		move.w	#$0FFF,d4		; d4 - Y wrap | Y next block + bits
(1) 1683/FFFFFFFFFFFF0CAE : 4844                		swap	d4
(1) 1684/FFFFFFFFFFFF0CB0 : 383C 0100           		move.w	#$100,d4
(1) 1685/FFFFFFFFFFFF0CB4 : 3005                		move.w	d5,d0
(1) 1686/FFFFFFFFFFFF0CB6 : 7A00                		moveq	#0,d5			; d5 - temporal | X-add read
(1) 1687/FFFFFFFFFFFF0CB8 : 3E3C 001F           		move.w	#(512/16)-1,d7		; d7 - X cells | Y cells
(1) 1688/FFFFFFFFFFFF0CBC : 4847                		swap	d7
(1) 1689/FFFFFFFFFFFF0CBE : 3E3C 000F           		move.w	#(256/16)-1,d7
(1) 1690/FFFFFFFFFFFF0CC2 :                     
(1) 1691/FFFFFFFFFFFF0CC2 :                     	; a6 - Current BG buffer
(1) 1692/FFFFFFFFFFFF0CC2 :                     	; a5 - Block-data base
(1) 1693/FFFFFFFFFFFF0CC2 :                     	; a4 - LOW layout data Y
(1) 1694/FFFFFFFFFFFF0CC2 :                     	; a3 - HI layout data Y
(1) 1695/FFFFFFFFFFFF0CC2 :                     	; a2 - a4 current
(1) 1696/FFFFFFFFFFFF0CC2 :                     	; a1 - a3 current
(1) 1697/FFFFFFFFFFFF0CC2 :                     	; a0 - Block-data read
(1) 1698/FFFFFFFFFFFF0CC2 :                     
(1) 1699/FFFFFFFFFFFF0CC2 :                     	; d7 - X loop        | Y loop
(1) 1700/FFFFFFFFFFFF0CC2 :                     	; d6 - VDP 2nd Write | X/Y VDP pos + addr bits
(1) 1701/FFFFFFFFFFFF0CC2 :                     	; d5 - X loop-save   | X VDP current
(1) 1702/FFFFFFFFFFFF0CC2 :                     	; d4 - Y wrap        | Y next block pos
(1) 1703/FFFFFFFFFFFF0CC2 :                     	; d3 - X wrap        | X next block pos
(1) 1704/FFFFFFFFFFFF0CC2 :                     	; d2 - Y block size  | VRAM-cell base
(1) 1705/FFFFFFFFFFFF0CC2 :                     	; d1 - Y-next line   | VRAM-cell read + prio
(1) 1706/FFFFFFFFFFFF0CC2 :                     	; d0 -    ---        | ---
(1) 1707/FFFFFFFFFFFF0CC2 :                     
(1) 1708/FFFFFFFFFFFF0CC2 :                     .y_loop:
(1) 1709/FFFFFFFFFFFF0CC2 : 4847                		swap	d7
(1) 1710/FFFFFFFFFFFF0CC4 : 244C                		move.l	a4,a2		; a2 - LOW line
(1) 1711/FFFFFFFFFFFF0CC6 : 224B                		move.l	a3,a1		; a1 - HI line
(1) 1712/FFFFFFFFFFFF0CC8 : 3A07                		move.w	d7,d5
(1) 1713/FFFFFFFFFFFF0CCA :                     .x_loop:
(1) 1714/FFFFFFFFFFFF0CCA : 4845                		swap	d5
(1) 1715/FFFFFFFFFFFF0CCC : 3202                		move.w	d2,d1
(1) 1716/FFFFFFFFFFFF0CCE : 1012                		move.b	(a2),d0		; HI block?
(1) 1717/FFFFFFFFFFFF0CD0 : 6608                		bne.s	.got_blk
(1) 1718/FFFFFFFFFFFF0CD2 : D27C 8000           		add.w	#$8000,d1
(1) 1719/FFFFFFFFFFFF0CD6 : 1011                		move.b	(a1),d0
(1) 1720/FFFFFFFFFFFF0CD8 : 6702                		beq.s	.blank
(1) 1721/FFFFFFFFFFFF0CDA :                     .got_blk:
(1) 1722/FFFFFFFFFFFF0CDA : 6136                		bsr	.mk_block
(1) 1723/FFFFFFFFFFFF0CDC :                     .blank:
(1) 1724/FFFFFFFFFFFF0CDC : 2003                		move.l	d3,d0
(1) 1725/FFFFFFFFFFFF0CDE : 4840                		swap	d0
(1) 1726/FFFFFFFFFFFF0CE0 : DA43                		add.w	d3,d5		; next VDP X pos
(1) 1727/FFFFFFFFFFFF0CE2 : CA40                		and.w	d0,d5
(1) 1728/FFFFFFFFFFFF0CE4 : D4FC 0001           		adda	#1,a2
(1) 1729/FFFFFFFFFFFF0CE8 : D2FC 0001           		adda	#1,a1
(1) 1730/FFFFFFFFFFFF0CEC : 4845                		swap	d5
(1) 1731/FFFFFFFFFFFF0CEE : 51CD FFDA           		dbf	d5,.x_loop
(1) 1732/FFFFFFFFFFFF0CF2 :                     
(1) 1733/FFFFFFFFFFFF0CF2 : 3006                		move.w	d6,d0
(1) 1734/FFFFFFFFFFFF0CF4 : C07C 3000           		and.w	#$3000,d0
(1) 1735/FFFFFFFFFFFF0CF8 : DC44                		add.w	d4,d6		; <-- next VDP Y block
(1) 1736/FFFFFFFFFFFF0CFA : 4844                		swap	d4
(1) 1737/FFFFFFFFFFFF0CFC : CC44                		and.w	d4,d6
(1) 1738/FFFFFFFFFFFF0CFE : 8C40                		or.w	d0,d6
(1) 1739/FFFFFFFFFFFF0D00 : 4844                		swap	d4
(1) 1740/FFFFFFFFFFFF0D02 :                     
(1) 1741/FFFFFFFFFFFF0D02 : 302E 0008           		move.w	md_bg_w(a6),d0 ; ***
(1) 1742/FFFFFFFFFFFF0D06 : D8C0                		adda	d0,a4
(1) 1743/FFFFFFFFFFFF0D08 : D6C0                		adda	d0,a3
(1) 1744/FFFFFFFFFFFF0D0A : 4847                		swap	d7
(1) 1745/FFFFFFFFFFFF0D0C : 51CF FFB4           		dbf	d7,.y_loop
(1) 1746/FFFFFFFFFFFF0D10 :                     .no_bg:
(1) 1747/FFFFFFFFFFFF0D10 : 4E75                		rts
(1) 1748/FFFFFFFFFFFF0D12 :                     
(1) 1749/FFFFFFFFFFFF0D12 :                     ; barely got free regs without using stack
(1) 1750/FFFFFFFFFFFF0D12 :                     .mk_block:
(1) 1751/FFFFFFFFFFFF0D12 : 4842                		swap	d2
(1) 1752/FFFFFFFFFFFF0D14 : 204D                		move.l	a5,a0
(1) 1753/FFFFFFFFFFFF0D16 : C07C 00FF           		and.w	#$FF,d0
(1) 1754/FFFFFFFFFFFF0D1A : E748                		lsl.w	#3,d0		; * 8 bytes
(1) 1755/FFFFFFFFFFFF0D1C : D0C0                		adda	d0,a0		; a0 - cell word data
(1) 1756/FFFFFFFFFFFF0D1E : 3006                		move.w	d6,d0
(1) 1757/FFFFFFFFFFFF0D20 : D045                		add.w	d5,d0
(1) 1758/FFFFFFFFFFFF0D22 : 807C 4000           		or.w	#$4000,d0
(1) 1759/FFFFFFFFFFFF0D26 : 4846                		swap	d6
(1) 1760/FFFFFFFFFFFF0D28 :                     
(1) 1761/FFFFFFFFFFFF0D28 :                     	; d0 - topleft VDP write | $4000
(1) 1762/FFFFFFFFFFFF0D28 :                     	; d6 - right VDP write
(1) 1763/FFFFFFFFFFFF0D28 :                     	; d2 is free
(1) 1764/FFFFFFFFFFFF0D28 :                     	;
(1) 1765/FFFFFFFFFFFF0D28 :                     	; currently working: 16x16
(1) 1766/FFFFFFFFFFFF0D28 : 610C                		bsr.s	.drwy_16	; 1-
(1) 1767/FFFFFFFFFFFF0D2A : D07C 0002           		add.w	#2,d0		; 2-
(1) 1768/FFFFFFFFFFFF0D2E : 6106                		bsr.s	.drwy_16	; -3
(1) 1769/FFFFFFFFFFFF0D30 :                     					; -4
(1) 1770/FFFFFFFFFFFF0D30 : 4846                		swap	d6
(1) 1771/FFFFFFFFFFFF0D32 : 4842                		swap	d2
(1) 1772/FFFFFFFFFFFF0D34 : 4E75                		rts
(1) 1773/FFFFFFFFFFFF0D36 :                     
(1) 1774/FFFFFFFFFFFF0D36 :                     ; d0 - left vdp
(1) 1775/FFFFFFFFFFFF0D36 :                     ; d6 - right vdp
(1) 1776/FFFFFFFFFFFF0D36 :                     .drwy_16:
(1) 1777/FFFFFFFFFFFF0D36 : 3400                		move.w	d0,d2
(1) 1778/FFFFFFFFFFFF0D38 : 4840                		swap	d0
(1) 1779/FFFFFFFFFFFF0D3A : 3018                		move.w	(a0)+,d0
(1) 1780/FFFFFFFFFFFF0D3C : D041                		add.w	d1,d0
(1) 1781/FFFFFFFFFFFF0D3E : 33C2 00C0 0004      		move.w	d2,(vdp_ctrl).l
(1) 1782/FFFFFFFFFFFF0D44 : 33C6 00C0 0004      		move.w	d6,(vdp_ctrl).l
(1) 1783/FFFFFFFFFFFF0D4A : 33C0 00C0 0000      		move.w	d0,(vdp_data).l
(1) 1784/FFFFFFFFFFFF0D50 : 4841                		swap	d1
(1) 1785/FFFFFFFFFFFF0D52 : D441                		add.w	d1,d2		; Next line
(1) 1786/FFFFFFFFFFFF0D54 : 4841                		swap	d1
(1) 1787/FFFFFFFFFFFF0D56 : 3018                		move.w	(a0)+,d0
(1) 1788/FFFFFFFFFFFF0D58 : D041                		add.w	d1,d0
(1) 1789/FFFFFFFFFFFF0D5A : 33C2 00C0 0004      		move.w	d2,(vdp_ctrl).l
(1) 1790/FFFFFFFFFFFF0D60 : 33C6 00C0 0004      		move.w	d6,(vdp_ctrl).l
(1) 1791/FFFFFFFFFFFF0D66 : 33C0 00C0 0000      		move.w	d0,(vdp_data).l
(1) 1792/FFFFFFFFFFFF0D6C : 4840                		swap	d0
(1) 1793/FFFFFFFFFFFF0D6E : 4E75                		rts
(1) 1794/FFFFFFFFFFFF0D70 :                     
(1) 1795/FFFFFFFFFFFF0D70 :                     	; Block: 16x16 as 13
(1) 1796/FFFFFFFFFFFF0D70 :                     	;                 24
(1) 1797/FFFFFFFFFFFF0D70 :                     	; d0 - block ID
(1) 1798/FFFFFFFFFFFF0D70 :                     	; d1 - VRAM-add base
(1) 1799/FFFFFFFFFFFF0D70 :                     	; d6 - VDP out R | VDP out L
(1) 1800/FFFFFFFFFFFF0D70 :                     ; 		and.w	#$FF,d0
(1) 1801/FFFFFFFFFFFF0D70 :                     ; 		lsl.w	#3,d0		; * 8 bytes
(1) 1802/FFFFFFFFFFFF0D70 :                     ; 		move.l	(a5,d0.w),d2
(1) 1803/FFFFFFFFFFFF0D70 :                     ; 		add.l	d1,d2
(1) 1804/FFFFFFFFFFFF0D70 :                     ; 		swap	d2
(1) 1805/FFFFFFFFFFFF0D70 :                     ; 		move.l	4(a5,d0.w),d3
(1) 1806/FFFFFFFFFFFF0D70 :                     ; 		add.l	d1,d3
(1) 1807/FFFFFFFFFFFF0D70 :                     ; 		swap	d3
(1) 1808/FFFFFFFFFFFF0D70 :                     ; 		move.w	d6,d0
(1) 1809/FFFFFFFFFFFF0D70 :                     ; 		swap	d5
(1) 1810/FFFFFFFFFFFF0D70 :                     ; 		add.w	d5,d0
(1) 1811/FFFFFFFFFFFF0D70 :                     ; 		or.w	#$4000,d0
(1) 1812/FFFFFFFFFFFF0D70 :                     ; 		swap	d5
(1) 1813/FFFFFFFFFFFF0D70 :                     ; 		move.l	a0,d1
(1) 1814/FFFFFFFFFFFF0D70 :                     ; 		and.w	d1,d5
(1) 1815/FFFFFFFFFFFF0D70 :                     ; 		add.w	d5,d0
(1) 1816/FFFFFFFFFFFF0D70 :                     ; 		swap	d6
(1) 1817/FFFFFFFFFFFF0D70 :                     ; 		move.w	d0,(vdp_ctrl).l
(1) 1818/FFFFFFFFFFFF0D70 :                     ; 		move.w	d6,(vdp_ctrl).l
(1) 1819/FFFFFFFFFFFF0D70 :                     ; 		move.w	d2,(vdp_data).l
(1) 1820/FFFFFFFFFFFF0D70 :                     ; 		move.w	d3,(vdp_data).l
(1) 1821/FFFFFFFFFFFF0D70 :                     ; 		swap	d2
(1) 1822/FFFFFFFFFFFF0D70 :                     ; 		swap	d3
(1) 1823/FFFFFFFFFFFF0D70 :                     ; 		add.w	#$80,d0		; line add
(1) 1824/FFFFFFFFFFFF0D70 :                     ; 		move.w	d0,(vdp_ctrl).l
(1) 1825/FFFFFFFFFFFF0D70 :                     ; 		move.w	d6,(vdp_ctrl).l
(1) 1826/FFFFFFFFFFFF0D70 :                     ; 		move.w	d2,(vdp_data).l
(1) 1827/FFFFFFFFFFFF0D70 :                     ; 		move.w	d3,(vdp_data).l
(1) 1828/FFFFFFFFFFFF0D70 :                     ; 		swap	d6
(1) 1829/FFFFFFFFFFFF0D70 :                     ; 		rts
(1) 1830/FFFFFFFFFFFF0D70 :                     
(1) 1831/FFFFFFFFFFFF0D70 :                     ; --------------------------------------------------------
(1) 1832/FFFFFFFFFFFF0D70 :                     ; MdMap_DrawScrlMd
(1) 1833/FFFFFFFFFFFF0D70 :                     ;
(1) 1834/FFFFFFFFFFFF0D70 :                     ; Draws map off-screen changes, only on Genesis-side.
(1) 1835/FFFFFFFFFFFF0D70 :                     ;
(1) 1836/FFFFFFFFFFFF0D70 :                     ; CALL THIS ON VBLANK ONLY, MUST BE QUICK.
(1) 1837/FFFFFFFFFFFF0D70 :                     ; --------------------------------------------------------
(1) 1838/FFFFFFFFFFFF0D70 :                     
(1) 1839/FFFFFFFFFFFF0D70 :                     MdMap_DrawScrlMd:
(1) 1840/FFFFFFFFFFFF0D70 : 4DF8 8660           		lea	(RAM_BgBuffer),a6
(1) 1841/FFFFFFFFFFFF0D74 : 4BF9 00C0 0000      		lea	(vdp_data),a5
(1) 1842/FFFFFFFFFFFF0D7A : 6104                		bsr.s	.this_bg
(1) 1843/FFFFFFFFFFFF0D7C : DCFC 0038           		adda	#sizeof_mdbg,a6
(1) 1844/FFFFFFFFFFFF0D80 :                     	; SH2-side handles the
(1) 1845/FFFFFFFFFFFF0D80 :                     	; RAM_BgBufferM's drawing
(1) 1846/FFFFFFFFFFFF0D80 :                     
(1) 1847/FFFFFFFFFFFF0D80 :                     .this_bg:
(1) 1848/FFFFFFFFFFFF0D80 : 1E2E 0003           		move.b	md_bg_flags(a6),d7
(1) 1849/FFFFFFFFFFFF0D84 : 0807 0007           		btst	#bitBgOn,d7
(1) 1850/FFFFFFFFFFFF0D88 : 6758                		beq	.no_bg
(1) 1851/FFFFFFFFFFFF0D8A : 302E 0030           		move.w	md_bg_x(a6),d0		; X start
(1) 1852/FFFFFFFFFFFF0D8E : 322E 0034           		move.w	md_bg_y(a6),d1		; Y start
(1) 1853/FFFFFFFFFFFF0D92 : 342E 0010           		move.w	md_bg_xinc_l(a6),d2
(1) 1854/FFFFFFFFFFFF0D96 : 362E 0014           		move.w	md_bg_yinc_u(a6),d3
(1) 1855/FFFFFFFFFFFF0D9A : 0887 0003           		bclr	#bitDrwU,d7
(1) 1856/FFFFFFFFFFFF0D9E : 6704                		beq.s	.no_u
(1) 1857/FFFFFFFFFFFF0DA0 : 6100 00F4           		bsr	.mk_row
(1) 1858/FFFFFFFFFFFF0DA4 :                     .no_u:
(1) 1859/FFFFFFFFFFFF0DA4 : 0887 0002           		bclr	#bitDrwD,d7
(1) 1860/FFFFFFFFFFFF0DA8 : 670C                		beq.s	.no_d
(1) 1861/FFFFFFFFFFFF0DAA : 362E 0016           		move.w	md_bg_yinc_d(a6),d3
(1) 1862/FFFFFFFFFFFF0DAE : D27C 00E0           		add.w	#224,d1			; X add
(1) 1863/FFFFFFFFFFFF0DB2 : 6100 00E2           		bsr	.mk_row
(1) 1864/FFFFFFFFFFFF0DB6 :                     .no_d:
(1) 1865/FFFFFFFFFFFF0DB6 : 302E 0030           		move.w	md_bg_x(a6),d0		; X start
(1) 1866/FFFFFFFFFFFF0DBA : 322E 0034           		move.w	md_bg_y(a6),d1		; Y start
(1) 1867/FFFFFFFFFFFF0DBE : 342E 0010           		move.w	md_bg_xinc_l(a6),d2
(1) 1868/FFFFFFFFFFFF0DC2 : 362E 0014           		move.w	md_bg_yinc_u(a6),d3
(1) 1869/FFFFFFFFFFFF0DC6 : 0887 0001           		bclr	#bitDrwL,d7
(1) 1870/FFFFFFFFFFFF0DCA : 6702                		beq.s	.no_l
(1) 1871/FFFFFFFFFFFF0DCC : 6116                		bsr.s	.mk_clmn
(1) 1872/FFFFFFFFFFFF0DCE :                     .no_l:
(1) 1873/FFFFFFFFFFFF0DCE : 0887 0000           		bclr	#bitDrwR,d7
(1) 1874/FFFFFFFFFFFF0DD2 : 670A                		beq.s	.no_r
(1) 1875/FFFFFFFFFFFF0DD4 : 342E 0012           		move.w	md_bg_xinc_r(a6),d2
(1) 1876/FFFFFFFFFFFF0DD8 : D07C 0140           		add.w	#320,d0			; X add
(1) 1877/FFFFFFFFFFFF0DDC : 6106                		bsr.s	.mk_clmn
(1) 1878/FFFFFFFFFFFF0DDE :                     .no_r:
(1) 1879/FFFFFFFFFFFF0DDE :                     
(1) 1880/FFFFFFFFFFFF0DDE : 1D47 0003           		move.b	d7,md_bg_flags(a6)
(1) 1881/FFFFFFFFFFFF0DE2 :                     .no_bg:
(1) 1882/FFFFFFFFFFFF0DE2 : 4E75                		rts
(1) 1883/FFFFFFFFFFFF0DE4 :                     
(1) 1884/FFFFFFFFFFFF0DE4 :                     ; ------------------------------------------------
(1) 1885/FFFFFFFFFFFF0DE4 :                     ; Make column
(1) 1886/FFFFFFFFFFFF0DE4 :                     ; d0 - X
(1) 1887/FFFFFFFFFFFF0DE4 :                     ; d1 - Y
(1) 1888/FFFFFFFFFFFF0DE4 :                     ; d2 - X increment
(1) 1889/FFFFFFFFFFFF0DE4 :                     ; d3 - Y increment
(1) 1890/FFFFFFFFFFFF0DE4 :                     ; ------------------------------------------------
(1) 1891/FFFFFFFFFFFF0DE4 :                     
(1) 1892/FFFFFFFFFFFF0DE4 :                     .mk_clmn:
(1) 1893/FFFFFFFFFFFF0DE4 :                     ; 		btst	#bitMarsBg,d7
(1) 1894/FFFFFFFFFFFF0DE4 :                     ; 		bne	.mars_ret_c
(1) 1895/FFFFFFFFFFFF0DE4 : 4847                		swap	d7
(1) 1896/FFFFFFFFFFFF0DE6 : 6100 016A           		bsr	.get_coords
(1) 1897/FFFFFFFFFFFF0DEA : 4840                		swap	d0
(1) 1898/FFFFFFFFFFFF0DEC : 3004                		move.w	d4,d0
(1) 1899/FFFFFFFFFFFF0DEE : 4840                		swap	d0
(1) 1900/FFFFFFFFFFFF0DF0 : 363C 0FFF           		move.w	#$FFF,d3
(1) 1901/FFFFFFFFFFFF0DF4 : 4843                		swap	d3
(1) 1902/FFFFFFFFFFFF0DF6 : 363C 0100           		move.w	#$100,d3
(1) 1903/FFFFFFFFFFFF0DFA :                     
(1) 1904/FFFFFFFFFFFF0DFA :                     	; d0 -    X curr | Current cell X/Y (1st)
(1) 1905/FFFFFFFFFFFF0DFA :                     	; d1 -    Y curr | VDP 1st write
(1) 1906/FFFFFFFFFFFF0DFA :                     	; d2 - Cell VRAM | VDP 2nd write
(1) 1907/FFFFFFFFFFFF0DFA :                     	; d3 -    Y wrap | Y add
(1) 1908/FFFFFFFFFFFF0DFA :                     	; d4 -         *****
(1) 1909/FFFFFFFFFFFF0DFA :                     	; d5 -         *****
(1) 1910/FFFFFFFFFFFF0DFA :                     	; d6 -         *****
(1) 1911/FFFFFFFFFFFF0DFA :                     	; d7 - lastflags | loop blocks
(1) 1912/FFFFFFFFFFFF0DFA :                     
(1) 1913/FFFFFFFFFFFF0DFA : 3E3C 000F           		move.w	#(256/16)-1,d7
(1) 1914/FFFFFFFFFFFF0DFE :                     .y_blk:
(1) 1915/FFFFFFFFFFFF0DFE : 7800                		moveq	#0,d4
(1) 1916/FFFFFFFFFFFF0E00 : 7A00                		moveq	#0,d5
(1) 1917/FFFFFFFFFFFF0E02 : 1C13                		move.b	(a3),d6
(1) 1918/FFFFFFFFFFFF0E04 : 6616                		bne.s	.vld
(1) 1919/FFFFFFFFFFFF0E06 : 1C12                		move.b	(a2),d6
(1) 1920/FFFFFFFFFFFF0E08 : 6606                		bne.s	.prio
(1) 1921/FFFFFFFFFFFF0E0A :                     .blnk:
(1) 1922/FFFFFFFFFFFF0E0A : 7800                		moveq	#0,d4
(1) 1923/FFFFFFFFFFFF0E0C : 7A00                		moveq	#0,d5
(1) 1924/FFFFFFFFFFFF0E0E : 602E                		bra.s	.frce
(1) 1925/FFFFFFFFFFFF0E10 :                     .prio:
(1) 1926/FFFFFFFFFFFF0E10 : 283C 8000 8000      		move.l	#$80008000,d4
(1) 1927/FFFFFFFFFFFF0E16 : 2A3C 8000 8000      		move.l	#$80008000,d5
(1) 1928/FFFFFFFFFFFF0E1C :                     .vld:
(1) 1929/FFFFFFFFFFFF0E1C : 204C                		move.l	a4,a0
(1) 1930/FFFFFFFFFFFF0E1E : CC7C 00FF           		and.w	#$FF,d6
(1) 1931/FFFFFFFFFFFF0E22 : E74E                		lsl.w	#3,d6
(1) 1932/FFFFFFFFFFFF0E24 : D0C6                		adda	d6,a0
(1) 1933/FFFFFFFFFFFF0E26 : 4842                		swap	d2
(1) 1934/FFFFFFFFFFFF0E28 : D858                		add.w	(a0)+,d4
(1) 1935/FFFFFFFFFFFF0E2A : DA58                		add.w	(a0)+,d5
(1) 1936/FFFFFFFFFFFF0E2C : D842                		add.w	d2,d4
(1) 1937/FFFFFFFFFFFF0E2E : DA42                		add.w	d2,d5
(1) 1938/FFFFFFFFFFFF0E30 : 4844                		swap	d4
(1) 1939/FFFFFFFFFFFF0E32 : 4845                		swap	d5
(1) 1940/FFFFFFFFFFFF0E34 : D858                		add.w	(a0)+,d4
(1) 1941/FFFFFFFFFFFF0E36 : DA58                		add.w	(a0)+,d5
(1) 1942/FFFFFFFFFFFF0E38 : D842                		add.w	d2,d4
(1) 1943/FFFFFFFFFFFF0E3A : DA42                		add.w	d2,d5
(1) 1944/FFFFFFFFFFFF0E3C : 4842                		swap	d2
(1) 1945/FFFFFFFFFFFF0E3E :                     .frce:
(1) 1946/FFFFFFFFFFFF0E3E : 3C00                		move.w	d0,d6
(1) 1947/FFFFFFFFFFFF0E40 : DC41                		add.w	d1,d6
(1) 1948/FFFFFFFFFFFF0E42 : 8C7C 4000           		or.w	#$4000,d6
(1) 1949/FFFFFFFFFFFF0E46 : 3B46 0004           		move.w	d6,4(a5)
(1) 1950/FFFFFFFFFFFF0E4A : 3B42 0004           		move.w	d2,4(a5)
(1) 1951/FFFFFFFFFFFF0E4E : 2A84                		move.l	d4,(a5)
(1) 1952/FFFFFFFFFFFF0E50 : DC7C 0080           		add.w	#$80,d6
(1) 1953/FFFFFFFFFFFF0E54 : 3B46 0004           		move.w	d6,4(a5)
(1) 1954/FFFFFFFFFFFF0E58 : 3B42 0004           		move.w	d2,4(a5)
(1) 1955/FFFFFFFFFFFF0E5C : 2A85                		move.l	d5,(a5)
(1) 1956/FFFFFFFFFFFF0E5E : 2803                		move.l	d3,d4		; Next Y block
(1) 1957/FFFFFFFFFFFF0E60 : 4844                		swap	d4
(1) 1958/FFFFFFFFFFFF0E62 : D043                		add.w	d3,d0
(1) 1959/FFFFFFFFFFFF0E64 : C044                		and.w	d4,d0
(1) 1960/FFFFFFFFFFFF0E66 : 3C2E 0008           		move.w	md_bg_w(a6),d6
(1) 1961/FFFFFFFFFFFF0E6A : D6C6                		adda	d6,a3
(1) 1962/FFFFFFFFFFFF0E6C : D4C6                		adda	d6,a2
(1) 1963/FFFFFFFFFFFF0E6E : 4841                		swap	d1		; <-- TODO: improve this later.
(1) 1964/FFFFFFFFFFFF0E70 : D27C 0010           		add.w	#$10,d1
(1) 1965/FFFFFFFFFFFF0E74 : B26E 000E           		cmp.w	md_bg_hf(a6),d1
(1) 1966/FFFFFFFFFFFF0E78 : 6D12                		blt.s	.y_low
(1) 1967/FFFFFFFFFFFF0E7A : 4840                		swap	d0
(1) 1968/FFFFFFFFFFFF0E7C : 4241                		clr.w	d1
(1) 1969/FFFFFFFFFFFF0E7E : 266E 0020           		move.l	md_bg_low(a6),a3
(1) 1970/FFFFFFFFFFFF0E82 : 246E 0024           		move.l	md_bg_hi(a6),a2
(1) 1971/FFFFFFFFFFFF0E86 : D4C0                		adda	d0,a2
(1) 1972/FFFFFFFFFFFF0E88 : D6C0                		adda	d0,a3
(1) 1973/FFFFFFFFFFFF0E8A : 4840                		swap	d0
(1) 1974/FFFFFFFFFFFF0E8C :                     .y_low:
(1) 1975/FFFFFFFFFFFF0E8C : 4841                		swap	d1
(1) 1976/FFFFFFFFFFFF0E8E :                     
(1) 1977/FFFFFFFFFFFF0E8E : 51CF FF6E           		dbf	d7,.y_blk
(1) 1978/FFFFFFFFFFFF0E92 : 4847                		swap	d7
(1) 1979/FFFFFFFFFFFF0E94 :                     .mars_ret_c:
(1) 1980/FFFFFFFFFFFF0E94 : 4E75                		rts
(1) 1981/FFFFFFFFFFFF0E96 :                     
(1) 1982/FFFFFFFFFFFF0E96 :                     ; ------------------------------------------------
(1) 1983/FFFFFFFFFFFF0E96 :                     ; Make row
(1) 1984/FFFFFFFFFFFF0E96 :                     ; d0 - X
(1) 1985/FFFFFFFFFFFF0E96 :                     ; d1 - Y
(1) 1986/FFFFFFFFFFFF0E96 :                     ; d2 - X increment
(1) 1987/FFFFFFFFFFFF0E96 :                     ; d3 - Y increment
(1) 1988/FFFFFFFFFFFF0E96 :                     ; ------------------------------------------------
(1) 1989/FFFFFFFFFFFF0E96 :                     
(1) 1990/FFFFFFFFFFFF0E96 :                     .mk_row:
(1) 1991/FFFFFFFFFFFF0E96 :                     ; 		btst	#bitMarsBg,d7
(1) 1992/FFFFFFFFFFFF0E96 :                     ; 		bne.s	.mars_ret_c
(1) 1993/FFFFFFFFFFFF0E96 : 4847                		swap	d7
(1) 1994/FFFFFFFFFFFF0E98 : 6100 00B8           		bsr	.get_coords
(1) 1995/FFFFFFFFFFFF0E9C : 4841                		swap	d1
(1) 1996/FFFFFFFFFFFF0E9E : 3205                		move.w	d5,d1
(1) 1997/FFFFFFFFFFFF0EA0 : 4841                		swap	d1
(1) 1998/FFFFFFFFFFFF0EA2 : 363C 007F           		move.w	#$7F,d3
(1) 1999/FFFFFFFFFFFF0EA6 : 4843                		swap	d3
(1) 2000/FFFFFFFFFFFF0EA8 : 363C 0004           		move.w	#4,d3
(1) 2001/FFFFFFFFFFFF0EAC :                     
(1) 2002/FFFFFFFFFFFF0EAC :                     	; d0 -    X curr | Current cell X/Y (1st)
(1) 2003/FFFFFFFFFFFF0EAC :                     	; d1 -    Y curr | VDP 1st write
(1) 2004/FFFFFFFFFFFF0EAC :                     	; d2 - Cell VRAM | VDP 2nd write
(1) 2005/FFFFFFFFFFFF0EAC :                     	; d3 -    X wrap | X add
(1) 2006/FFFFFFFFFFFF0EAC :                     	; d4 -         *****
(1) 2007/FFFFFFFFFFFF0EAC :                     	; d5 -         *****
(1) 2008/FFFFFFFFFFFF0EAC :                     	; d6 - loopflags | *****
(1) 2009/FFFFFFFFFFFF0EAC :                     	; d7 - lastflags | loop blocks
(1) 2010/FFFFFFFFFFFF0EAC :                     
(1) 2011/FFFFFFFFFFFF0EAC : 3C00                		move.w	d0,d6
(1) 2012/FFFFFFFFFFFF0EAE : CC7C FF00           		and.w	#-$100,d6	; Merge d1
(1) 2013/FFFFFFFFFFFF0EB2 : D246                		add.w	d6,d1
(1) 2014/FFFFFFFFFFFF0EB4 : 2A03                		move.l	d3,d5
(1) 2015/FFFFFFFFFFFF0EB6 : 4845                		swap	d5
(1) 2016/FFFFFFFFFFFF0EB8 : C045                		and.w	d5,d0
(1) 2017/FFFFFFFFFFFF0EBA : 3E3C 0014           		move.w	#((320+16)/16)-1,d7
(1) 2018/FFFFFFFFFFFF0EBE :                     .x_blk:
(1) 2019/FFFFFFFFFFFF0EBE : 7800                		moveq	#0,d4
(1) 2020/FFFFFFFFFFFF0EC0 : 7A00                		moveq	#0,d5
(1) 2021/FFFFFFFFFFFF0EC2 : 1C13                		move.b	(a3),d6
(1) 2022/FFFFFFFFFFFF0EC4 : 6616                		bne.s	.xvld
(1) 2023/FFFFFFFFFFFF0EC6 : 1C12                		move.b	(a2),d6
(1) 2024/FFFFFFFFFFFF0EC8 : 6606                		bne.s	.xprio
(1) 2025/FFFFFFFFFFFF0ECA :                     .xblnk:
(1) 2026/FFFFFFFFFFFF0ECA : 7800                		moveq	#0,d4
(1) 2027/FFFFFFFFFFFF0ECC : 7A00                		moveq	#0,d5
(1) 2028/FFFFFFFFFFFF0ECE : 602E                		bra.s	.xfrce
(1) 2029/FFFFFFFFFFFF0ED0 :                     .xprio:
(1) 2030/FFFFFFFFFFFF0ED0 : 283C 8000 8000      		move.l	#$80008000,d4
(1) 2031/FFFFFFFFFFFF0ED6 : 2A3C 8000 8000      		move.l	#$80008000,d5
(1) 2032/FFFFFFFFFFFF0EDC :                     .xvld:
(1) 2033/FFFFFFFFFFFF0EDC : 204C                		move.l	a4,a0
(1) 2034/FFFFFFFFFFFF0EDE : CC7C 00FF           		and.w	#$FF,d6
(1) 2035/FFFFFFFFFFFF0EE2 : E74E                		lsl.w	#3,d6
(1) 2036/FFFFFFFFFFFF0EE4 : D0C6                		adda	d6,a0
(1) 2037/FFFFFFFFFFFF0EE6 : 4842                		swap	d2
(1) 2038/FFFFFFFFFFFF0EE8 : D858                		add.w	(a0)+,d4
(1) 2039/FFFFFFFFFFFF0EEA : DA58                		add.w	(a0)+,d5
(1) 2040/FFFFFFFFFFFF0EEC : D842                		add.w	d2,d4
(1) 2041/FFFFFFFFFFFF0EEE : DA42                		add.w	d2,d5
(1) 2042/FFFFFFFFFFFF0EF0 : 4844                		swap	d4
(1) 2043/FFFFFFFFFFFF0EF2 : 4845                		swap	d5
(1) 2044/FFFFFFFFFFFF0EF4 : D858                		add.w	(a0)+,d4
(1) 2045/FFFFFFFFFFFF0EF6 : DA58                		add.w	(a0)+,d5
(1) 2046/FFFFFFFFFFFF0EF8 : D842                		add.w	d2,d4
(1) 2047/FFFFFFFFFFFF0EFA : DA42                		add.w	d2,d5
(1) 2048/FFFFFFFFFFFF0EFC : 4842                		swap	d2
(1) 2049/FFFFFFFFFFFF0EFE :                     .xfrce:
(1) 2050/FFFFFFFFFFFF0EFE : 3C00                		move.w	d0,d6
(1) 2051/FFFFFFFFFFFF0F00 : DC41                		add.w	d1,d6
(1) 2052/FFFFFFFFFFFF0F02 : 8C7C 4000           		or.w	#$4000,d6
(1) 2053/FFFFFFFFFFFF0F06 : 3B46 0004           		move.w	d6,4(a5)
(1) 2054/FFFFFFFFFFFF0F0A : 3B42 0004           		move.w	d2,4(a5)
(1) 2055/FFFFFFFFFFFF0F0E : 2A84                		move.l	d4,(a5)
(1) 2056/FFFFFFFFFFFF0F10 : DC7C 0080           		add.w	#$80,d6
(1) 2057/FFFFFFFFFFFF0F14 : 3B46 0004           		move.w	d6,4(a5)
(1) 2058/FFFFFFFFFFFF0F18 : 3B42 0004           		move.w	d2,4(a5)
(1) 2059/FFFFFFFFFFFF0F1C : 2A85                		move.l	d5,(a5)
(1) 2060/FFFFFFFFFFFF0F1E : D043                		add.w	d3,d0
(1) 2061/FFFFFFFFFFFF0F20 : 4843                		swap	d3
(1) 2062/FFFFFFFFFFFF0F22 : C043                		and.w	d3,d0
(1) 2063/FFFFFFFFFFFF0F24 : 4843                		swap	d3
(1) 2064/FFFFFFFFFFFF0F26 :                     
(1) 2065/FFFFFFFFFFFF0F26 :                     	; X wrap
(1) 2066/FFFFFFFFFFFF0F26 : 4840                		swap	d0
(1) 2067/FFFFFFFFFFFF0F28 : D07C 0010           		add.w	#$10,d0
(1) 2068/FFFFFFFFFFFF0F2C : B06E 000C           		cmp.w	md_bg_wf(a6),d0
(1) 2069/FFFFFFFFFFFF0F30 : 6D0E                		blt.s	.x_low
(1) 2070/FFFFFFFFFFFF0F32 : 906E 000C           		sub.w	md_bg_wf(a6),d0
(1) 2071/FFFFFFFFFFFF0F36 : 7800                		moveq	#0,d4
(1) 2072/FFFFFFFFFFFF0F38 : 382E 0008           		move.w	md_bg_w(a6),d4
(1) 2073/FFFFFFFFFFFF0F3C : 95C4                		sub.l	d4,a2
(1) 2074/FFFFFFFFFFFF0F3E : 97C4                		sub.l	d4,a3
(1) 2075/FFFFFFFFFFFF0F40 :                     .x_low:
(1) 2076/FFFFFFFFFFFF0F40 : D6FC 0001           		adda	#1,a3
(1) 2077/FFFFFFFFFFFF0F44 : D4FC 0001           		adda	#1,a2
(1) 2078/FFFFFFFFFFFF0F48 :                     .x_new:
(1) 2079/FFFFFFFFFFFF0F48 : 4840                		swap	d0
(1) 2080/FFFFFFFFFFFF0F4A :                     
(1) 2081/FFFFFFFFFFFF0F4A : 51CF FF72           		dbf	d7,.x_blk
(1) 2082/FFFFFFFFFFFF0F4E : 4847                		swap	d7
(1) 2083/FFFFFFFFFFFF0F50 : 4E75                		rts
(1) 2084/FFFFFFFFFFFF0F52 :                     
(1) 2085/FFFFFFFFFFFF0F52 :                     ; ------------------------------------------------
(1) 2086/FFFFFFFFFFFF0F52 :                     ; Input
(1) 2087/FFFFFFFFFFFF0F52 :                     ; d0 - X position
(1) 2088/FFFFFFFFFFFF0F52 :                     ; d1 - Y position
(1) 2089/FFFFFFFFFFFF0F52 :                     ; d2 - X increment beam
(1) 2090/FFFFFFFFFFFF0F52 :                     ; d3 - Y increment beam
(1) 2091/FFFFFFFFFFFF0F52 :                     ;
(1) 2092/FFFFFFFFFFFF0F52 :                     ; Out:
(1) 2093/FFFFFFFFFFFF0F52 :                     ; d4 - X LEFT increment
(1) 2094/FFFFFFFFFFFF0F52 :                     ; d5 - Y TOP increment
(1) 2095/FFFFFFFFFFFF0F52 :                     
(1) 2096/FFFFFFFFFFFF0F52 :                     .get_coords:
(1) 2097/FFFFFFFFFFFF0F52 : 286E 0028           		move.l	md_bg_blk(a6),a4
(1) 2098/FFFFFFFFFFFF0F56 : 266E 0020           		move.l	md_bg_low(a6),a3
(1) 2099/FFFFFFFFFFFF0F5A : 246E 0024           		move.l	md_bg_hi(a6),a2
(1) 2100/FFFFFFFFFFFF0F5E : C07C FFF0           		and.w	#-$10,d0		; block X/Y limit
(1) 2101/FFFFFFFFFFFF0F62 : C27C FFF0           		and.w	#-$10,d1
(1) 2102/FFFFFFFFFFFF0F66 : C47C FFF0           		and.w	#-$10,d2
(1) 2103/FFFFFFFFFFFF0F6A : C67C FFF0           		and.w	#-$10,d3
(1) 2104/FFFFFFFFFFFF0F6E : 4840                		swap	d0
(1) 2105/FFFFFFFFFFFF0F70 : 4841                		swap	d1
(1) 2106/FFFFFFFFFFFF0F72 : 3002                		move.w	d2,d0
(1) 2107/FFFFFFFFFFFF0F74 : 3203                		move.w	d3,d1
(1) 2108/FFFFFFFFFFFF0F76 : 4840                		swap	d0
(1) 2109/FFFFFFFFFFFF0F78 : 4841                		swap	d1
(1) 2110/FFFFFFFFFFFF0F7A :                     
(1) 2111/FFFFFFFFFFFF0F7A : 7800                		moveq	#0,d4
(1) 2112/FFFFFFFFFFFF0F7C : 7A00                		moveq	#0,d5
(1) 2113/FFFFFFFFFFFF0F7E : 1C16                		move.b	md_bg_bw(a6),d6
(1) 2114/FFFFFFFFFFFF0F80 : 1E2E 0001           		move.b	md_bg_bh(a6),d7
(1) 2115/FFFFFFFFFFFF0F84 : CC7C 00FF           		and.w	#$FF,d6
(1) 2116/FFFFFFFFFFFF0F88 : CE7C 00FF           		and.w	#$FF,d7
(1) 2117/FFFFFFFFFFFF0F8C :                     
(1) 2118/FFFFFFFFFFFF0F8C : 3802                		move.w	d2,d4
(1) 2119/FFFFFFFFFFFF0F8E : C9C6                		muls.w	d6,d4
(1) 2120/FFFFFFFFFFFF0F90 : E044                		asr.w	#8,d4
(1) 2121/FFFFFFFFFFFF0F92 : 3A03                		move.w	d3,d5
(1) 2122/FFFFFFFFFFFF0F94 : CBC7                		muls.w	d7,d5
(1) 2123/FFFFFFFFFFFF0F96 : E045                		asr.w	#8,d5
(1) 2124/FFFFFFFFFFFF0F98 : CBEE 0008           		muls.w	md_bg_w(a6),d5
(1) 2125/FFFFFFFFFFFF0F9C : 7600                		moveq	#0,d3
(1) 2126/FFFFFFFFFFFF0F9E : 2604                		move.l	d4,d3
(1) 2127/FFFFFFFFFFFF0FA0 : D685                		add.l	d5,d3
(1) 2128/FFFFFFFFFFFF0FA2 : D7C3                		add.l	d3,a3
(1) 2129/FFFFFFFFFFFF0FA4 : D5C3                		add.l	d3,a2
(1) 2130/FFFFFFFFFFFF0FA6 :                     
(1) 2131/FFFFFFFFFFFF0FA6 : 342E 001E           		move.w	md_bg_vram(a6),d2
(1) 2132/FFFFFFFFFFFF0FAA : 4842                		swap	d2
(1) 2133/FFFFFFFFFFFF0FAC : E449                		lsr.w	#2,d1			; Y >> 2
(1) 2134/FFFFFFFFFFFF0FAE : ED49                		lsl.w	#6,d1			; Y * $40
(1) 2135/FFFFFFFFFFFF0FB0 : E448                		lsr.w	#2,d0			; X >> 2
(1) 2136/FFFFFFFFFFFF0FB2 : C27C 0FFF           		and.w	#$FFF,d1
(1) 2137/FFFFFFFFFFFF0FB6 : C07C 007C           		and.w	#$7C,d0
(1) 2138/FFFFFFFFFFFF0FBA : D041                		add.w	d1,d0
(1) 2139/FFFFFFFFFFFF0FBC : 322E 001C           		move.w	md_bg_vpos(a6),d1
(1) 2140/FFFFFFFFFFFF0FC0 : 3401                		move.w	d1,d2
(1) 2141/FFFFFFFFFFFF0FC2 : C27C 3FFF           		and.w	#$3FFF,d1
(1) 2142/FFFFFFFFFFFF0FC6 : E55A                		rol.w	#2,d2
(1) 2143/FFFFFFFFFFFF0FC8 : C47C 0003           		and.w	#%11,d2
(1) 2144/FFFFFFFFFFFF0FCC : 4E75                		rts
(1) 2145/FFFFFFFFFFFF0FCE :                     
(1) 2146/FFFFFFFFFFFF0FCE :                     ; ====================================================================
(1) 2147/FFFFFFFFFFFF0FCE :                     ; ----------------------------------------------------------------
(1) 2148/FFFFFFFFFFFF0FCE :                     ; Objects system
(1) 2149/FFFFFFFFFFFF0FCE :                     ;
(1) 2150/FFFFFFFFFFFF0FCE :                     ; MD and MARS
(1) 2151/FFFFFFFFFFFF0FCE :                     ; ----------------------------------------------------------------
(1) 2152/FFFFFFFFFFFF0FCE :                     
(1) 2153/FFFFFFFFFFFF0FCE :                     ; --------------------------------------------------------
(1) 2154/FFFFFFFFFFFF0FCE :                     ; Init objects
(1) 2155/FFFFFFFFFFFF0FCE :                     ; --------------------------------------------------------
(1) 2156/FFFFFFFFFFFF0FCE :                     
(1) 2157/FFFFFFFFFFFF0FCE :                     Objects_Init:
(1) 2158/FFFFFFFFFFFF0FCE : 4DF8 8000           		lea	(RAM_Objects),a6
(1) 2159/FFFFFFFFFFFF0FD2 : 3E3C 065F           		move.w	#(sizeof_mdobj*MAX_MDOBJ)-1,d7
(1) 2160/FFFFFFFFFFFF0FD6 :                     .clr:
(1) 2161/FFFFFFFFFFFF0FD6 : 421E                		clr.b	(a6)+
(1) 2162/FFFFFFFFFFFF0FD8 : 51CF FFFC           		dbf	d7,.clr
(1) 2163/FFFFFFFFFFFF0FDC : 4DF8 8B54           		lea	(RAM_ObjDispList),a6
(1) 2164/FFFFFFFFFFFF0FE0 : 3E3C 000F           		move.w	#MAX_MDOBJ-1,d7
(1) 2165/FFFFFFFFFFFF0FE4 :                     .clr_d:
(1) 2166/FFFFFFFFFFFF0FE4 : 425E                		clr.w	(a6)+
(1) 2167/FFFFFFFFFFFF0FE6 : 51CF FFFC           		dbf	d7,.clr_d
(1) 2168/FFFFFFFFFFFF0FEA : 4278 9994           		clr.w	(RAM_SprDrwCntr).w
(1) 2169/FFFFFFFFFFFF0FEE : 4E75                		rts
(1) 2170/FFFFFFFFFFFF0FF0 :                     
(1) 2171/FFFFFFFFFFFF0FF0 :                     ; --------------------------------------------------------
(1) 2172/FFFFFFFFFFFF0FF0 :                     ; Process objects
(1) 2173/FFFFFFFFFFFF0FF0 :                     ; --------------------------------------------------------
(1) 2174/FFFFFFFFFFFF0FF0 :                     
(1) 2175/FFFFFFFFFFFF0FF0 :                     Objects_Run:
(1) 2176/FFFFFFFFFFFF0FF0 : 4DF8 8000           		lea	(RAM_Objects),a6
(1) 2177/FFFFFFFFFFFF0FF4 : 3E3C 000F           		move.w	#MAX_MDOBJ-1,d7
(1) 2178/FFFFFFFFFFFF0FF8 :                     .next_one:
(1) 2179/FFFFFFFFFFFF0FF8 : 2C16                		move.l	obj_code(a6),d6
(1) 2180/FFFFFFFFFFFF0FFA : 6708                		beq.s	.no_code	; Free slot
(1) 2181/FFFFFFFFFFFF0FFC : 2F07                		move.l	d7,-(sp)
(1) 2182/FFFFFFFFFFFF0FFE : 2A46                		move.l	d6,a5
(1) 2183/FFFFFFFFFFFF1000 : 4E95                		jsr	(a5)
(1) 2184/FFFFFFFFFFFF1002 : 2E1F                		move.l	(sp)+,d7
(1) 2185/FFFFFFFFFFFF1004 :                     .no_code:
(1) 2186/FFFFFFFFFFFF1004 : DCFC 0066           		adda	#sizeof_mdobj,a6
(1) 2187/FFFFFFFFFFFF1008 : 51CF FFEE           		dbf	d7,.next_one
(1) 2188/FFFFFFFFFFFF100C : 4E75                		rts
(1) 2189/FFFFFFFFFFFF100E :                     
(1) 2190/FFFFFFFFFFFF100E :                     ; --------------------------------------------------------
(1) 2191/FFFFFFFFFFFF100E :                     ; Draw ALL Objects from display list
(1) 2192/FFFFFFFFFFFF100E :                     ;
(1) 2193/FFFFFFFFFFFF100E :                     ; Call this BEFORE VBlank.
(1) 2194/FFFFFFFFFFFF100E :                     ; --------------------------------------------------------
(1) 2195/FFFFFFFFFFFF100E :                     
(1) 2196/FFFFFFFFFFFF100E :                     Objects_Show:
(1) 2197/FFFFFFFFFFFF100E : 7E01                		moveq	#1,d7				; d7 - MD Link
(1) 2198/FFFFFFFFFFFF1010 : 4DF8 8FD4           		lea	(RAM_Sprites),a6		; a6 - Genesis sprites
(1) 2199/FFFFFFFFFFFF1014 :                     
(1) 2200/FFFFFFFFFFFF1014 : 3C38 9994           		move.w	(RAM_SprDrwCntr),d6
(1) 2201/FFFFFFFFFFFF1018 : 6732                		beq.s	.no_sprdrw
(1) 2202/FFFFFFFFFFFF101A : 4278 9994           		clr.w	(RAM_SprDrwCntr).w
(1) 2203/FFFFFFFFFFFF101E : 4BF8 8B74           		lea	(RAM_SprDrwPz),a5
(1) 2204/FFFFFFFFFFFF1022 : 9C7C 0001           		sub.w	#1,d6
(1) 2205/FFFFFFFFFFFF1026 :                     .nexts:
(1) 2206/FFFFFFFFFFFF1026 : BE7C 0046           		cmp.w	#70,d7
(1) 2207/FFFFFFFFFFFF102A : 6C20                		bge.s	.no_sprdrw
(1) 2208/FFFFFFFFFFFF102C : 301D                		move.w	(a5)+,d0
(1) 2209/FFFFFFFFFFFF102E : 321D                		move.w	(a5)+,d1	; custom
(1) 2210/FFFFFFFFFFFF1030 : C27C 00FF           		and.w	#$FF,d1
(1) 2211/FFFFFFFFFFFF1034 : E149                		lsl.w	#8,d1
(1) 2212/FFFFFFFFFFFF1036 : 8247                		or.w	d7,d1
(1) 2213/FFFFFFFFFFFF1038 : 341D                		move.w	(a5)+,d2
(1) 2214/FFFFFFFFFFFF103A : 361D                		move.w	(a5)+,d3
(1) 2215/FFFFFFFFFFFF103C : 3CC0                		move.w	d0,(a6)+
(1) 2216/FFFFFFFFFFFF103E : 3CC1                		move.w	d1,(a6)+
(1) 2217/FFFFFFFFFFFF1040 : 3CC2                		move.w	d2,(a6)+
(1) 2218/FFFFFFFFFFFF1042 : 3CC3                		move.w	d3,(a6)+
(1) 2219/FFFFFFFFFFFF1044 : DE7C 0001           		add.w	#1,d7
(1) 2220/FFFFFFFFFFFF1048 : 51CE FFDC           		dbf	d6,.nexts
(1) 2221/FFFFFFFFFFFF104C :                     .no_sprdrw:
(1) 2222/FFFFFFFFFFFF104C :                     
(1) 2223/FFFFFFFFFFFF104C :                     	; Draw mappings from sprites
(1) 2224/FFFFFFFFFFFF104C : 4BF8 8B54           		lea	(RAM_ObjDispList),a5
(1) 2225/FFFFFFFFFFFF1050 : 49F8 AC18           		lea	(RAM_MdDreq+Dreq_SuperSpr),a4	; a4 - 32X SUPER Sprites
(1) 2226/FFFFFFFFFFFF1054 : 3C3C 000F           		move.w	#MAX_MDOBJ-1,d6
(1) 2227/FFFFFFFFFFFF1058 :                     .next:
(1) 2228/FFFFFFFFFFFF1058 : 3015                		move.w	(a5),d0
(1) 2229/FFFFFFFFFFFF105A : 6700 00E2           		beq	.finish
(1) 2230/FFFFFFFFFFFF105E : 72FF                		moveq	#-1,d1
(1) 2231/FFFFFFFFFFFF1060 : 3200                		move.w	d0,d1
(1) 2232/FFFFFFFFFFFF1062 : 2441                		move.l	d1,a2
(1) 2233/FFFFFFFFFFFF1064 : 206A 0010           		move.l	obj_map(a2),a0		; Read mapping
(1) 2234/FFFFFFFFFFFF1068 : 082A 0007 0023      		btst	#bitobj_Mars,obj_set(a2)
(1) 2235/FFFFFFFFFFFF106E : 6656                		bne.s	.mars_mode
(1) 2236/FFFFFFFFFFFF1070 : BE7C 0046           		cmp.w	#70,d7
(1) 2237/FFFFFFFFFFFF1074 : 6C00 00C2           		bge	.mk_spr
(1) 2238/FFFFFFFFFFFF1078 : 302A 001E           		move.w	obj_frame(a2),d0
(1) 2239/FFFFFFFFFFFF107C : D040                		add.w	d0,d0
(1) 2240/FFFFFFFFFFFF107E : 3030 0000           		move.w	(a0,d0.w),d0
(1) 2241/FFFFFFFFFFFF1082 : D0C0                		adda	d0,a0
(1) 2242/FFFFFFFFFFFF1084 : 3A18                		move.w	(a0)+,d5
(1) 2243/FFFFFFFFFFFF1086 : 6700 00B0           		beq	.mk_spr
(1) 2244/FFFFFFFFFFFF108A : 9A7C 0001           		sub.w	#1,d5
(1) 2245/FFFFFFFFFFFF108E :                     .mk_pz:
(1) 2246/FFFFFFFFFFFF108E :                     	; TODO: H/V flip
(1) 2247/FFFFFFFFFFFF108E : 1018                		move.b	(a0)+,d0
(1) 2248/FFFFFFFFFFFF1090 : 4880                		ext.w	d0
(1) 2249/FFFFFFFFFFFF1092 : D06A 000C           		add.w	obj_y(a2),d0
(1) 2250/FFFFFFFFFFFF1096 : D07C 0080           		add.w	#$80,d0
(1) 2251/FFFFFFFFFFFF109A : 1218                		move.b	(a0)+,d1
(1) 2252/FFFFFFFFFFFF109C : E149                		lsl.w	#8,d1
(1) 2253/FFFFFFFFFFFF109E : 8247                		or.w	d7,d1
(1) 2254/FFFFFFFFFFFF10A0 : 3418                		move.w	(a0)+,d2
(1) 2255/FFFFFFFFFFFF10A2 : D46A 0014           		add.w	obj_vram(a2),d2
(1) 2256/FFFFFFFFFFFF10A6 : D0FC 0002           		adda	#2,a0
(1) 2257/FFFFFFFFFFFF10AA : 3618                		move.w	(a0)+,d3
(1) 2258/FFFFFFFFFFFF10AC : D66A 0008           		add.w	obj_x(a2),d3
(1) 2259/FFFFFFFFFFFF10B0 : D67C 0080           		add.w	#$80,d3
(1) 2260/FFFFFFFFFFFF10B4 : 3CC0                		move.w	d0,(a6)+
(1) 2261/FFFFFFFFFFFF10B6 : 3CC1                		move.w	d1,(a6)+
(1) 2262/FFFFFFFFFFFF10B8 : 3CC2                		move.w	d2,(a6)+
(1) 2263/FFFFFFFFFFFF10BA : 3CC3                		move.w	d3,(a6)+
(1) 2264/FFFFFFFFFFFF10BC : DE7C 0001           		add.w	#1,d7
(1) 2265/FFFFFFFFFFFF10C0 : 51CD FFCC           		dbf	d5,.mk_pz
(1) 2266/FFFFFFFFFFFF10C4 : 6072                		bra.s	.mk_spr
(1) 2267/FFFFFFFFFFFF10C6 :                     
(1) 2268/FFFFFFFFFFFF10C6 :                     .mars_mode:
(1) 2269/FFFFFFFFFFFF10C6 : 2958 0010           		move.l	(a0)+,marsspr_data(a4)
(1) 2270/FFFFFFFFFFFF10CA : 3958 0008           		move.w	(a0)+,marsspr_dwidth(a4)
(1) 2271/FFFFFFFFFFFF10CE : 3958 000A           		move.w	(a0)+,marsspr_indx(a4)
(1) 2272/FFFFFFFFFFFF10D2 : 1418                		move.b	(a0)+,d2
(1) 2273/FFFFFFFFFFFF10D4 : 1618                		move.b	(a0)+,d3
(1) 2274/FFFFFFFFFFFF10D6 : 1942 0002           		move.b	d2,marsspr_xs(a4)
(1) 2275/FFFFFFFFFFFF10DA : 1943 0003           		move.b	d3,marsspr_ys(a4)
(1) 2276/FFFFFFFFFFFF10DE : 302A 001E           		move.w	obj_frame(a2),d0	; Read frame
(1) 2277/FFFFFFFFFFFF10E2 : 1880                		move.b	d0,marsspr_xfrm(a4)
(1) 2278/FFFFFFFFFFFF10E4 : E058                		ror.w	#8,d0
(1) 2279/FFFFFFFFFFFF10E6 : 1940 0001           		move.b	d0,marsspr_yfrm(a4)
(1) 2280/FFFFFFFFFFFF10EA : 382A 0008           		move.w	obj_x(a2),d4
(1) 2281/FFFFFFFFFFFF10EE : 3A2A 000C           		move.w	obj_y(a2),d5
(1) 2282/FFFFFFFFFFFF10F2 : C47C 00FF           		and.w	#$FF,d2
(1) 2283/FFFFFFFFFFFF10F6 : C67C 00FF           		and.w	#$FF,d3
(1) 2284/FFFFFFFFFFFF10FA : E24A                		lsr.w	#1,d2
(1) 2285/FFFFFFFFFFFF10FC : E24B                		lsr.w	#1,d3
(1) 2286/FFFFFFFFFFFF10FE :                     ; 		divu.w	#2,d2			; **
(1) 2287/FFFFFFFFFFFF10FE : 9842                		sub.w	d2,d4
(1) 2288/FFFFFFFFFFFF1100 :                     ; 		divu.w	#2,d3			; **
(1) 2289/FFFFFFFFFFFF1100 : 9A43                		sub.w	d3,d5
(1) 2290/FFFFFFFFFFFF1102 :                     ; 		move.l	obj_size(a2),d2		; d2 - UDLR sizes
(1) 2291/FFFFFFFFFFFF1102 :                     ; 		move.w	d2,d3			; Grab LR
(1) 2292/FFFFFFFFFFFF1102 :                     ; 		lsr.w	#5,d3
(1) 2293/FFFFFFFFFFFF1102 :                     ; 		and.w	#%11111000,d3
(1) 2294/FFFFFFFFFFFF1102 :                     ; 		sub.w	d3,d4			; Subtract X
(1) 2295/FFFFFFFFFFFF1102 :                     ; 		swap	d2
(1) 2296/FFFFFFFFFFFF1102 :                     ; 		move.w	d2,d3			; Grab UD
(1) 2297/FFFFFFFFFFFF1102 :                     ; 		lsr.w	#8,d3
(1) 2298/FFFFFFFFFFFF1102 :                     ; 		lsl.b	#3,d3
(1) 2299/FFFFFFFFFFFF1102 :                     ; 		and.w	#$FF,d3
(1) 2300/FFFFFFFFFFFF1102 :                     ; 		sub.w	d3,d5			; Subtract Y
(1) 2301/FFFFFFFFFFFF1102 : 43F8 AA00           		lea	(RAM_BgBufferM),a1
(1) 2302/FFFFFFFFFFFF1106 : 9869 0030           		sub.w	md_bg_x(a1),d4
(1) 2303/FFFFFFFFFFFF110A : 9A69 0034           		sub.w	md_bg_y(a1),d5
(1) 2304/FFFFFFFFFFFF110E : 3944 0004           		move.w	d4,marsspr_x(a4)
(1) 2305/FFFFFFFFFFFF1112 : 3945 0006           		move.w	d5,marsspr_y(a4)
(1) 2306/FFFFFFFFFFFF1116 : 7800                		moveq	#0,d4
(1) 2307/FFFFFFFFFFFF1118 : 082A 0000 0023      		btst	#bitobj_flipH,obj_set(a2)
(1) 2308/FFFFFFFFFFFF111E : 6704                		beq.s	.flip_h
(1) 2309/FFFFFFFFFFFF1120 : 08C4 0000           		bset	#0,d4
(1) 2310/FFFFFFFFFFFF1124 :                     .flip_h:
(1) 2311/FFFFFFFFFFFF1124 : 082A 0001 0023      		btst	#bitobj_flipV,obj_set(a2)
(1) 2312/FFFFFFFFFFFF112A : 6704                		beq.s	.flip_v
(1) 2313/FFFFFFFFFFFF112C : 08C4 0001           		bset	#1,d4
(1) 2314/FFFFFFFFFFFF1130 :                     .flip_v:
(1) 2315/FFFFFFFFFFFF1130 : 3944 000C           		move.w	d4,marsspr_flags(a4)
(1) 2316/FFFFFFFFFFFF1134 : D8FC 0014           		adda	#sizeof_marsspr,a4	; Next SuperSprite
(1) 2317/FFFFFFFFFFFF1138 :                     .mk_spr:
(1) 2318/FFFFFFFFFFFF1138 : 425D                		clr.w	(a5)+			; Clear request
(1) 2319/FFFFFFFFFFFF113A : 51CE FF1C           		dbf	d6,.next
(1) 2320/FFFFFFFFFFFF113E :                     .finish:
(1) 2321/FFFFFFFFFFFF113E : 4DF8 8FD4           		lea	(RAM_Sprites),a6	; a6 - Genesis sprites
(1) 2322/FFFFFFFFFFFF1142 : 3C07                		move.w	d7,d6
(1) 2323/FFFFFFFFFFFF1144 : BE7C 0046           		cmp.w	#70,d7
(1) 2324/FFFFFFFFFFFF1148 : 6C0A                		bge.s	.ran_out
(1) 2325/FFFFFFFFFFFF114A : 9C7C 0001           		sub.w	#1,d6
(1) 2326/FFFFFFFFFFFF114E : E74E                		lsl.w	#3,d6
(1) 2327/FFFFFFFFFFFF1150 : DCC6                		adda	d6,a6
(1) 2328/FFFFFFFFFFFF1152 : 4296                		clr.l	(a6)			; TODO: endoflist check
(1) 2329/FFFFFFFFFFFF1154 :                     .ran_out:
(1) 2330/FFFFFFFFFFFF1154 : 4E75                		rts
(1) 2331/FFFFFFFFFFFF1156 :                     
(1) 2332/FFFFFFFFFFFF1156 :                     ; ----------------------------------------------------------------
(1) 2333/FFFFFFFFFFFF1156 :                     ; Subroutines
(1) 2334/FFFFFFFFFFFF1156 :                     ; ----------------------------------------------------------------
(1) 2335/FFFFFFFFFFFF1156 :                     
(1) 2336/FFFFFFFFFFFF1156 :                     ; --------------------------------------------------------
(1) 2337/FFFFFFFFFFFF1156 :                     ; object_Display
(1) 2338/FFFFFFFFFFFF1156 :                     ;
(1) 2339/FFFFFFFFFFFF1156 :                     ; Builds a sprite using map data specified in
(1) 2340/FFFFFFFFFFFF1156 :                     ; obj_map(a6)
(1) 2341/FFFFFFFFFFFF1156 :                     ;
(1) 2342/FFFFFFFFFFFF1156 :                     ; *** GENESIS map ***
(1) 2343/FFFFFFFFFFFF1156 :                     ; mapdata:
(1) 2344/FFFFFFFFFFFF1156 :                     ;       dc.w .frame0-mapdata
(1) 2345/FFFFFFFFFFFF1156 :                     ;       dc.w .frame1-mapdata
(1) 2346/FFFFFFFFFFFF1156 :                     ;       ...
(1) 2347/FFFFFFFFFFFF1156 :                     ; .frame0:
(1) 2348/FFFFFFFFFFFF1156 :                     ;       dc.w numofpz
(1) 2349/FFFFFFFFFFFF1156 :                     ;       dc.b YY,SS
(1) 2350/FFFFFFFFFFFF1156 :                     ;       dc.w vram_normal
(1) 2351/FFFFFFFFFFFF1156 :                     ;       dc.w vram_half
(1) 2352/FFFFFFFFFFFF1156 :                     ;       dc.w XXXX
(1) 2353/FFFFFFFFFFFF1156 :                     ;       align 2
(1) 2354/FFFFFFFFFFFF1156 :                     ;
(1) 2355/FFFFFFFFFFFF1156 :                     ; *** 32X map ***
(1) 2356/FFFFFFFFFFFF1156 :                     ; mapdata:
(1) 2357/FFFFFFFFFFFF1156 :                     ; 	dc.l SH2_ADDR|TH ; Spritesheet location (TH opt.)
(1) 2358/FFFFFFFFFFFF1156 :                     ; 	dc.w 512	 ; Spritesheet WIDTH
(1) 2359/FFFFFFFFFFFF1156 :                     ; 	dc.b 64,72	 ; Frame width and height
(1) 2360/FFFFFFFFFFFF1156 :                     ; 	dc.w $80	 ; Palette index
(1) 2361/FFFFFFFFFFFF1156 :                     ;
(1) 2362/FFFFFFFFFFFF1156 :                     ; obj_frame(a6) is in YYXX direction
(1) 2363/FFFFFFFFFFFF1156 :                     ;
(1) 2364/FFFFFFFFFFFF1156 :                     ; Input:
(1) 2365/FFFFFFFFFFFF1156 :                     ; a6 - Object
(1) 2366/FFFFFFFFFFFF1156 :                     ;
(1) 2367/FFFFFFFFFFFF1156 :                     ; Uses:
(1) 2368/FFFFFFFFFFFF1156 :                     ; a5,d7
(1) 2369/FFFFFFFFFFFF1156 :                     ; --------------------------------------------------------
(1) 2370/FFFFFFFFFFFF1156 :                     
(1) 2371/FFFFFFFFFFFF1156 :                     object_Display:
(1) 2372/FFFFFFFFFFFF1156 : 4BF8 8B54           		lea	(RAM_ObjDispList),a5
(1) 2373/FFFFFFFFFFFF115A : 3E3C 000F           		move.w	#MAX_MDOBJ-1,d7
(1) 2374/FFFFFFFFFFFF115E :                     .srch:
(1) 2375/FFFFFFFFFFFF115E : 4A55                		tst.w	(a5)
(1) 2376/FFFFFFFFFFFF1160 : 6708                		beq.s	.this_one
(1) 2377/FFFFFFFFFFFF1162 : DAFC 0002           		adda	#2,a5
(1) 2378/FFFFFFFFFFFF1166 : 51CF FFF6           		dbf	d7,.srch
(1) 2379/FFFFFFFFFFFF116A :                     .this_one:
(1) 2380/FFFFFFFFFFFF116A : 3A8E                		move.w	a6,(a5)
(1) 2381/FFFFFFFFFFFF116C : 4E75                		rts
(1) 2382/FFFFFFFFFFFF116E :                     
(1) 2383/FFFFFFFFFFFF116E :                     ; --------------------------------------------------------
(1) 2384/FFFFFFFFFFFF116E :                     ; object_MkSprPz
(1) 2385/FFFFFFFFFFFF116E :                     ;
(1) 2386/FFFFFFFFFFFF116E :                     ; Makes separate sprite pieces using
(1) 2387/FFFFFFFFFFFF116E :                     ;
(1) 2388/FFFFFFFFFFFF116E :                     ; Input:
(1) 2389/FFFFFFFFFFFF116E :                     ; d0 - X pos
(1) 2390/FFFFFFFFFFFF116E :                     ; d1 - Y pos
(1) 2391/FFFFFFFFFFFF116E :                     ; d2 - VRAM
(1) 2392/FFFFFFFFFFFF116E :                     ; d3 - Size
(1) 2393/FFFFFFFFFFFF116E :                     :
(1) 2394/FFFFFFFFFFFF116E :                     ; Uses:
(1) 2395/FFFFFFFFFFFF116E :                     ; a5,d7
(1) 2396/FFFFFFFFFFFF116E :                     ; --------------------------------------------------------
(1) 2397/FFFFFFFFFFFF116E :                     
(1) 2398/FFFFFFFFFFFF116E :                     object_MkSprPz:
(1) 2399/FFFFFFFFFFFF116E : 3E38 9994           		move.w	(RAM_SprDrwCntr).w,d7
(1) 2400/FFFFFFFFFFFF1172 : BE7C 0046           		cmp.w	#70,d7
(1) 2401/FFFFFFFFFFFF1176 : 6C22                		bge.s	.nope
(1) 2402/FFFFFFFFFFFF1178 : E74F                		lsl.w	#3,d7
(1) 2403/FFFFFFFFFFFF117A : 4BF8 8B74           		lea	(RAM_SprDrwPz),a5
(1) 2404/FFFFFFFFFFFF117E : DAC7                		adda	d7,a5
(1) 2405/FFFFFFFFFFFF1180 : D07C 0080           		add.w	#$80,d0
(1) 2406/FFFFFFFFFFFF1184 : D27C 0080           		add.w	#$80,d1
(1) 2407/FFFFFFFFFFFF1188 : C67C 00FF           		and.w	#$FF,d3
(1) 2408/FFFFFFFFFFFF118C :                     ; 		lsl.w	#8,d3
(1) 2409/FFFFFFFFFFFF118C : 3AC1                		move.w	d1,(a5)+
(1) 2410/FFFFFFFFFFFF118E : 3AC3                		move.w	d3,(a5)+
(1) 2411/FFFFFFFFFFFF1190 : 3AC2                		move.w	d2,(a5)+
(1) 2412/FFFFFFFFFFFF1192 : 3AC0                		move.w	d0,(a5)+
(1) 2413/FFFFFFFFFFFF1194 : 0678 0001 9994      		add.w	#1,(RAM_SprDrwCntr).w
(1) 2414/FFFFFFFFFFFF119A :                     .nope:
(1) 2415/FFFFFFFFFFFF119A : 4E75                		rts
(1) 2416/FFFFFFFFFFFF119C :                     
(1) 2417/FFFFFFFFFFFF119C :                     ; --------------------------------------------------------
(1) 2418/FFFFFFFFFFFF119C :                     ; Object_Animate
(1) 2419/FFFFFFFFFFFF119C :                     ;
(1) 2420/FFFFFFFFFFFF119C :                     ; Animates the sprite
(1) 2421/FFFFFFFFFFFF119C :                     ;
(1) 2422/FFFFFFFFFFFF119C :                     ; Input
(1) 2423/FFFFFFFFFFFF119C :                     ; a0 | LONG - Animation data
(1) 2424/FFFFFFFFFFFF119C :                     ;
(1) 2425/FFFFFFFFFFFF119C :                     ; Output
(1) 2426/FFFFFFFFFFFF119C :                     ; d0 | WORD - Frame
(1) 2427/FFFFFFFFFFFF119C :                     ;
(1) 2428/FFFFFFFFFFFF119C :                     ; Uses:
(1) 2429/FFFFFFFFFFFF119C :                     ; d2
(1) 2430/FFFFFFFFFFFF119C :                     ; --------------------------------------------------------
(1) 2431/FFFFFFFFFFFF119C :                     
(1) 2432/FFFFFFFFFFFF119C :                     ; NOTE: to restart an animation
(1) 2433/FFFFFFFFFFFF119C :                     ; clear obj_anim_indx(a6) manually
(1) 2434/FFFFFFFFFFFF119C :                     
(1) 2435/FFFFFFFFFFFF119C :                     Object_Animate:
(1) 2436/FFFFFFFFFFFF119C :                     ;  		tst.l	d1
(1) 2437/FFFFFFFFFFFF119C :                     ;   		beq.s	.return
(1) 2438/FFFFFFFFFFFF119C : 7400                 		moveq	#0,d2
(1) 2439/FFFFFFFFFFFF119E : 142E 001D            		move.b	obj_anim_id+1(a6),d2
(1) 2440/FFFFFFFFFFFF11A2 : B42E 001C            		cmp.b	obj_anim_id(a6),d2
(1) 2441/FFFFFFFFFFFF11A6 : 670E                 		beq.s	.sameThing
(1) 2442/FFFFFFFFFFFF11A8 : 1D6E 001C 001D       		move.b	obj_anim_id(a6),obj_anim_id+1(a6)
(1) 2443/FFFFFFFFFFFF11AE : 426E 001A            		clr.w	obj_anim_indx(a6)
(1) 2444/FFFFFFFFFFFF11B2 : 422E 0020            		clr.b	obj_anim_spd(a6)
(1) 2445/FFFFFFFFFFFF11B6 :                     .sameThing:
(1) 2446/FFFFFFFFFFFF11B6 : 142E 001C            		move.b	obj_anim_id(a6),d2
(1) 2447/FFFFFFFFFFFF11BA : B43C 00FF            		cmp.b	#-1,d2
(1) 2448/FFFFFFFFFFFF11BE : 6748                 		beq.s	.return
(1) 2449/FFFFFFFFFFFF11C0 : D442                 		add.w	d2,d2
(1) 2450/FFFFFFFFFFFF11C2 : 3430 2000            		move.w	(a0,d2.w),d2
(1) 2451/FFFFFFFFFFFF11C6 : 41F0 2000            		lea	(a0,d2.w),a0
(1) 2452/FFFFFFFFFFFF11CA :                     
(1) 2453/FFFFFFFFFFFF11CA : 3418                 		move.w	(a0)+,d2
(1) 2454/FFFFFFFFFFFF11CC : B47C FFFF            		cmp.w	#-1,d2
(1) 2455/FFFFFFFFFFFF11D0 : 670C                 		beq.s	.keepspd
(1) 2456/FFFFFFFFFFFF11D2 : 042E 0001 0020       		sub.b	#1,obj_anim_spd(a6)
(1) 2457/FFFFFFFFFFFF11D8 : 6A2E                 		bpl.s	.return
(1) 2458/FFFFFFFFFFFF11DA : 1D42 0020           		move.b	d2,obj_anim_spd(a6)
(1) 2459/FFFFFFFFFFFF11DE :                     .keepspd:
(1) 2460/FFFFFFFFFFFF11DE : 7200                 		moveq	#0,d1
(1) 2461/FFFFFFFFFFFF11E0 : 342E 001A            		move.w	obj_anim_indx(a6),d2
(1) 2462/FFFFFFFFFFFF11E4 : D442                 		add.w	d2,d2
(1) 2463/FFFFFFFFFFFF11E6 : 3210                 		move.w	(a0),d1
(1) 2464/FFFFFFFFFFFF11E8 : D0C2                 		adda	d2,a0
(1) 2465/FFFFFFFFFFFF11EA : 3010                 		move.w	(a0),d0
(1) 2466/FFFFFFFFFFFF11EC : B07C FFFF            		cmp.w	#-1,d0
(1) 2467/FFFFFFFFFFFF11F0 : 6718                 		beq.s	.noAnim		; loop
(1) 2468/FFFFFFFFFFFF11F2 : B07C FFFE            		cmp.w	#-2,d0
(1) 2469/FFFFFFFFFFFF11F6 : 6720                 		beq.s	.lastFrame	; finish
(1) 2470/FFFFFFFFFFFF11F8 : B07C FFFD            		cmp.w	#-3,d0
(1) 2471/FFFFFFFFFFFF11FC : 6720                 		beq.s	.goToFrame
(1) 2472/FFFFFFFFFFFF11FE :                     
(1) 2473/FFFFFFFFFFFF11FE : 3D40 001E            		move.w	d0,obj_frame(a6)
(1) 2474/FFFFFFFFFFFF1202 : 066E 0001 001A       		add.w	#1,obj_anim_indx(a6)
(1) 2475/FFFFFFFFFFFF1208 :                     .return:
(1) 2476/FFFFFFFFFFFF1208 : 4E75                 		rts
(1) 2477/FFFFFFFFFFFF120A :                     
(1) 2478/FFFFFFFFFFFF120A :                     .noAnim:
(1) 2479/FFFFFFFFFFFF120A : 3D7C 0001 001A       		move.w	#1,obj_anim_indx(a6)
(1) 2480/FFFFFFFFFFFF1210 : 3001                 		move.w	d1,d0
(1) 2481/FFFFFFFFFFFF1212 : 3D40 001E            		move.w	d0,obj_frame(a6)
(1) 2482/FFFFFFFFFFFF1216 : 4E75                		rts
(1) 2483/FFFFFFFFFFFF1218 :                     .lastFrame:
(1) 2484/FFFFFFFFFFFF1218 : 422E 0020            		clr.b	obj_anim_spd(a6)
(1) 2485/FFFFFFFFFFFF121C : 4E75                		rts
(1) 2486/FFFFFFFFFFFF121E :                     .goToFrame:
(1) 2487/FFFFFFFFFFFF121E : 426E 001A           		clr.w	obj_anim_indx(a6)
(1) 2488/FFFFFFFFFFFF1222 : 3D68 0002 001A      		move.w	2(a0),obj_anim_indx(a6)
(1) 2489/FFFFFFFFFFFF1228 : 4E75                		rts
(1) 2490/FFFFFFFFFFFF122A :                     
(1) 2491/FFFFFFFFFFFF122A :                     ; --------------------------------------------------------
(1) 2492/FFFFFFFFFFFF122A :                     ; object_Speed
(1) 2493/FFFFFFFFFFFF122A :                     ;
(1) 2494/FFFFFFFFFFFF122A :                     ; Moves the object using speed settings
(1) 2495/FFFFFFFFFFFF122A :                     ;
(1) 2496/FFFFFFFFFFFF122A :                     ; Input:
(1) 2497/FFFFFFFFFFFF122A :                     ; a6 - Object
(1) 2498/FFFFFFFFFFFF122A :                     ;
(1) 2499/FFFFFFFFFFFF122A :                     ; Uses:
(1) 2500/FFFFFFFFFFFF122A :                     ; d7
(1) 2501/FFFFFFFFFFFF122A :                     ; --------------------------------------------------------
(1) 2502/FFFFFFFFFFFF122A :                     
(1) 2503/FFFFFFFFFFFF122A :                     object_UpdX:
(1) 2504/FFFFFFFFFFFF122A : 7E00                		moveq	#0,d7
(1) 2505/FFFFFFFFFFFF122C : 3E2E 0016           		move.w	obj_x_spd(a6),d7
(1) 2506/FFFFFFFFFFFF1230 : 48C7                		ext.l	d7
(1) 2507/FFFFFFFFFFFF1232 : E187                		asl.l	#8,d7
(1) 2508/FFFFFFFFFFFF1234 : DFAE 0008           		add.l	d7,obj_x(a6)
(1) 2509/FFFFFFFFFFFF1238 : 4E75                		rts
(1) 2510/FFFFFFFFFFFF123A :                     object_Speed:
(1) 2511/FFFFFFFFFFFF123A : 61EE                		bsr.s	object_UpdX
(1) 2512/FFFFFFFFFFFF123C :                     object_UpdY:
(1) 2513/FFFFFFFFFFFF123C : 7E00                		moveq	#0,d7
(1) 2514/FFFFFFFFFFFF123E : 3E2E 0018           		move.w	obj_y_spd(a6),d7
(1) 2515/FFFFFFFFFFFF1242 : 48C7                		ext.l	d7
(1) 2516/FFFFFFFFFFFF1244 : E187                		asl.l	#8,d7
(1) 2517/FFFFFFFFFFFF1246 : DFAE 000C           		add.l	d7,obj_y(a6)
(1) 2518/FFFFFFFFFFFF124A : 4E75                		rts
(1) 2519/FFFFFFFFFFFF124C :                     
(1) 2520/FFFFFFFFFFFF124C :                     ; --------------------------------------------------------
(1) 2521/FFFFFFFFFFFF124C :                     ; object_ColM_Floor
(1) 2522/FFFFFFFFFFFF124C :                     ;
(1) 2523/FFFFFFFFFFFF124C :                     ; Check object collision on 32X map's floor
(1) 2524/FFFFFFFFFFFF124C :                     ;
(1) 2525/FFFFFFFFFFFF124C :                     ; Input:
(1) 2526/FFFFFFFFFFFF124C :                     ; a6 - Object to check
(1) 2527/FFFFFFFFFFFF124C :                     ;
(1) 2528/FFFFFFFFFFFF124C :                     ; Returns:
(1) 2529/FFFFFFFFFFFF124C :                     ; beq  - No collision
(1) 2530/FFFFFFFFFFFF124C :                     ; bne  - Found collision
(1) 2531/FFFFFFFFFFFF124C :                     ; d4.b - Collision block number
(1) 2532/FFFFFFFFFFFF124C :                     ; d5.w - Y-pos center snap
(1) 2533/FFFFFFFFFFFF124C :                     ;
(1) 2534/FFFFFFFFFFFF124C :                     ; Uses:
(1) 2535/FFFFFFFFFFFF124C :                     ; d4-d7,a4-a5
(1) 2536/FFFFFFFFFFFF124C :                     ; --------------------------------------------------------
(1) 2537/FFFFFFFFFFFF124C :                     
(1) 2538/FFFFFFFFFFFF124C :                     ; 32X MAP SIDE
(1) 2539/FFFFFFFFFFFF124C :                     
(1) 2540/FFFFFFFFFFFF124C :                     object_ColM_Floor:
(1) 2541/FFFFFFFFFFFF124C : 4BF8 AA00           		lea	(RAM_BgBufferM),a5
(1) 2542/FFFFFFFFFFFF1250 : 7A00                		moveq	#0,d5
(1) 2543/FFFFFFFFFFFF1252 : 7800                		moveq	#0,d4
(1) 2544/FFFFFFFFFFFF1254 : 286D 002C           		move.l	md_bg_col(a5),a4
(1) 2545/FFFFFFFFFFFF1258 : 3E2D 000C           		move.w	md_bg_wf(a5),d7
(1) 2546/FFFFFFFFFFFF125C : 9E7C 0001           		sub.w	#1,d7
(1) 2547/FFFFFFFFFFFF1260 : 382E 0008           		move.w	obj_x(a6),d4
(1) 2548/FFFFFFFFFFFF1264 : 6A02                		bpl.s	.v_x
(1) 2549/FFFFFFFFFFFF1266 : 4244                		clr.w	d4
(1) 2550/FFFFFFFFFFFF1268 :                     .v_x:
(1) 2551/FFFFFFFFFFFF1268 : B847                		cmp.w	d7,d4
(1) 2552/FFFFFFFFFFFF126A : 6D02                		blt.s	.v_xr
(1) 2553/FFFFFFFFFFFF126C : 3807                		move.w	d7,d4
(1) 2554/FFFFFFFFFFFF126E :                     .v_xr:
(1) 2555/FFFFFFFFFFFF126E : 3E2D 000E           		move.w	md_bg_hf(a5),d7
(1) 2556/FFFFFFFFFFFF1272 : 9E7C 0001           		sub.w	#1,d7
(1) 2557/FFFFFFFFFFFF1276 : 3A2E 000C           		move.w	obj_y(a6),d5
(1) 2558/FFFFFFFFFFFF127A : 6A02                		bpl.s	.v_y
(1) 2559/FFFFFFFFFFFF127C : 4245                		clr.w	d5
(1) 2560/FFFFFFFFFFFF127E :                     .v_y:
(1) 2561/FFFFFFFFFFFF127E : BA47                		cmp.w	d7,d5
(1) 2562/FFFFFFFFFFFF1280 : 6D02                		blt.s	.v_yd
(1) 2563/FFFFFFFFFFFF1282 : 3A07                		move.w	d7,d5
(1) 2564/FFFFFFFFFFFF1284 :                     .v_yd:
(1) 2565/FFFFFFFFFFFF1284 : 2E2E 0004           		move.l	obj_size(a6),d7
(1) 2566/FFFFFFFFFFFF1288 : 4847                		swap	d7		; Add Y
(1) 2567/FFFFFFFFFFFF128A : CE7C 00FF           		and.w	#$FF,d7
(1) 2568/FFFFFFFFFFFF128E : 3C07                		move.w	d7,d6
(1) 2569/FFFFFFFFFFFF1290 : E74E                		lsl.w	#3,d6
(1) 2570/FFFFFFFFFFFF1292 : DA46                		add.w	d6,d5
(1) 2571/FFFFFFFFFFFF1294 :                     
(1) 2572/FFFFFFFFFFFF1294 :                     	; d5 - Ypos + size
(1) 2573/FFFFFFFFFFFF1294 :                     	; d6 - Xpos
(1) 2574/FFFFFFFFFFFF1294 :                     	; d7 - Dsize/2
(1) 2575/FFFFFFFFFFFF1294 :                     
(1) 2576/FFFFFFFFFFFF1294 :                     	; 16x16 only
(1) 2577/FFFFFFFFFFFF1294 : E24F                		lsr.w	#1,d7		; Dsize/2
(1) 2578/FFFFFFFFFFFF1296 : E844                		asr.w	#4,d4		; X >> 16
(1) 2579/FFFFFFFFFFFF1298 : D9C4                		add.l	d4,a4		; Add X
(1) 2580/FFFFFFFFFFFF129A : 2805                		move.l	d5,d4		; Copy d5 to d4
(1) 2581/FFFFFFFFFFFF129C : E844                		asr.w	#4,d4		; Y >> 16
(1) 2582/FFFFFFFFFFFF129E : 7C00                		moveq	#0,d6
(1) 2583/FFFFFFFFFFFF12A0 : 3C2D 0008           		move.w	md_bg_w(a5),d6	; d6: map width
(1) 2584/FFFFFFFFFFFF12A4 : C8C6                		mulu.w	d6,d4		; (Y>>16)*(mwidth)
(1) 2585/FFFFFFFFFFFF12A6 : D9C4                		add.l	d4,a4		; Add Y
(1) 2586/FFFFFFFFFFFF12A8 : CA7C FFF0           		and.w	#-$10,d5	; Filter Y Snap
(1) 2587/FFFFFFFFFFFF12AC : 1814                		move.b	(a4),d4		; d4: Start ID
(1) 2588/FFFFFFFFFFFF12AE : 99C6                		sub.l	d6,a4
(1) 2589/FFFFFFFFFFFF12B0 : 9E7C 0001           		sub.w	#1,d7		; Dsize - 1
(1) 2590/FFFFFFFFFFFF12B4 : 6B14                		bmi.s	.valid
(1) 2591/FFFFFFFFFFFF12B6 :                     .next:
(1) 2592/FFFFFFFFFFFF12B6 : 4847                		swap	d7
(1) 2593/FFFFFFFFFFFF12B8 : 1E14                		move.b	(a4),d7		; New ID != 0?
(1) 2594/FFFFFFFFFFFF12BA : 6706                		beq.s	.blnk
(1) 2595/FFFFFFFFFFFF12BC : 1807                		move.b	d7,d4		; Set new ID
(1) 2596/FFFFFFFFFFFF12BE : 9A7C 0010           		sub.w	#$10,d5		; Decrement Y Snap
(1) 2597/FFFFFFFFFFFF12C2 :                     .blnk:
(1) 2598/FFFFFFFFFFFF12C2 : 99C6                		sub.l	d6,a4		; Decrement width
(1) 2599/FFFFFFFFFFFF12C4 : 4847                		swap	d7
(1) 2600/FFFFFFFFFFFF12C6 : 51CF FFEE           		dbf	d7,.next
(1) 2601/FFFFFFFFFFFF12CA :                     .valid:
(1) 2602/FFFFFFFFFFFF12CA : C87C 00FF           		and.w	#$FF,d4		; Filter ID
(1) 2603/FFFFFFFFFFFF12CE : 4E75                		rts
(1) 2604/FFFFFFFFFFFF12D0 :                     
(1) 2605/FFFFFFFFFFFF12D0 :                     ; ----------------------------------------
(1) 2606/FFFFFFFFFFFF12D0 :                     ; object_SetColFloor
(1) 2607/FFFFFFFFFFFF12D0 :                     ;
(1) 2608/FFFFFFFFFFFF12D0 :                     ; Snaps the object to the map's floor.
(1) 2609/FFFFFFFFFFFF12D0 :                     ;
(1) 2610/FFFFFFFFFFFF12D0 :                     ; Call object_ColM_Floor first
(1) 2611/FFFFFFFFFFFF12D0 :                     ;
(1) 2612/FFFFFFFFFFFF12D0 :                     ; Input:
(1) 2613/FFFFFFFFFFFF12D0 :                     ; d4.b - Collision block
(1) 2614/FFFFFFFFFFFF12D0 :                     ; d5.w - Y-pos center snap
(1) 2615/FFFFFFFFFFFF12D0 :                     ; ----------------------------------------
(1) 2616/FFFFFFFFFFFF12D0 :                     
(1) 2617/FFFFFFFFFFFF12D0 :                     object_SetColFloor:
(1) 2618/FFFFFFFFFFFF12D0 : C87C 00FF           		and.w	#$FF,d4
(1) 2619/FFFFFFFFFFFF12D4 : 6744                		beq.s	.no_col
(1) 2620/FFFFFFFFFFFF12D6 : E94C                		lsl.w	#4,d4
(1) 2621/FFFFFFFFFFFF12D8 : 3E2E 0008           		move.w	obj_x(a6),d7		; Grab CENTER X
(1) 2622/FFFFFFFFFFFF12DC : CE7C 000F           		and.w	#$0F,d7			; limit to 16
(1) 2623/FFFFFFFFFFFF12E0 : 41FA 003A           		lea	slope_data_16(pc),a0
(1) 2624/FFFFFFFFFFFF12E4 : D0C4                		adda	d4,a0
(1) 2625/FFFFFFFFFFFF12E6 : 1830 7000           		move.b	(a0,d7.w),d4
(1) 2626/FFFFFFFFFFFF12EA : C87C 000F           		and.w	#$0F,d4
(1) 2627/FFFFFFFFFFFF12EE :                     
(1) 2628/FFFFFFFFFFFF12EE : 7C00                		moveq	#0,d6
(1) 2629/FFFFFFFFFFFF12F0 : 3E2E 000C           		move.w	obj_y(a6),d7
(1) 2630/FFFFFFFFFFFF12F4 : 2C2E 0004           		move.l	obj_size(a6),d6
(1) 2631/FFFFFFFFFFFF12F8 : 4846                		swap	d6
(1) 2632/FFFFFFFFFFFF12FA : CC7C 00FF           		and.w	#$FF,d6
(1) 2633/FFFFFFFFFFFF12FE : E74E                		lsl.w	#3,d6
(1) 2634/FFFFFFFFFFFF1300 : 9A46                		sub.w	d6,d5
(1) 2635/FFFFFFFFFFFF1302 : DA44                		add.w	d4,d5	; target slope
(1) 2636/FFFFFFFFFFFF1304 : BE45                		cmp.w	d5,d7
(1) 2637/FFFFFFFFFFFF1306 : 6F12                		ble.s	.no_col
(1) 2638/FFFFFFFFFFFF1308 : 3C3C 0800           		move.w	#$800,d6
(1) 2639/FFFFFFFFFFFF130C : 3D46 0018           		move.w	d6,obj_y_spd(a6)
(1) 2640/FFFFFFFFFFFF1310 :                     ; .set_me:
(1) 2641/FFFFFFFFFFFF1310 :                     ; 		move.w	obj_x_spd(a6),d6
(1) 2642/FFFFFFFFFFFF1310 :                     ; 		bpl.s	.x_spd
(1) 2643/FFFFFFFFFFFF1310 :                     ; 		neg.w	d6
(1) 2644/FFFFFFFFFFFF1310 :                     ; .x_spd:
(1) 2645/FFFFFFFFFFFF1310 :                     
(1) 2646/FFFFFFFFFFFF1310 : 08AE 0000 0024      		bclr	#bitobj_air,obj_status(a6)
(1) 2647/FFFFFFFFFFFF1316 : 3D45 000C           		move.w	d5,obj_y(a6)
(1) 2648/FFFFFFFFFFFF131A :                     .no_col:
(1) 2649/FFFFFFFFFFFF131A : 4E75                		rts
(1) 2650/FFFFFFFFFFFF131C :                     
(1) 2651/FFFFFFFFFFFF131C :                     ; ----------------------------------------
(1) 2652/FFFFFFFFFFFF131C :                     
(1) 2653/FFFFFFFFFFFF131C :                     ; Slope data 16x16
(1) 2654/FFFFFFFFFFFF131C :                     slope_data_16:
(1) 2655/FFFFFFFFFFFF131C : 0000 0000 0000 0000 		dc.b  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
                    0000 0000 0000 0000 
(1) 2656/FFFFFFFFFFFF132C : 0000 0000 0000 0000 		dc.b  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
                    0000 0000 0000 0000 
(1) 2657/FFFFFFFFFFFF133C : 0000 0000 0000 0000 		dc.b  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
                    0000 0000 0000 0000 
(1) 2658/FFFFFFFFFFFF134C : 0F0E 0D0C 0B0A 0908 		dc.b 15,14,13,12,11,10, 9, 8, 7, 6, 5, 4, 3, 2, 1, 0
                    0706 0504 0302 0100 
(1) 2659/FFFFFFFFFFFF135C : 0001 0203 0405 0607 		dc.b  0, 1, 2, 3, 4, 5, 6, 7, 8, 9,10,11,12,13,14,15
                    0809 0A0B 0C0D 0E0F 
(1) 2660/FFFFFFFFFFFF136C : 0F0F 0E0E 0D0D 0C0C 		dc.b 15,15,14,14,13,13,12,12,11,11,10,10, 9, 9, 8, 8
                    0B0B 0A0A 0909 0808 
(1) 2661/FFFFFFFFFFFF137C : 0707 0606 0505 0404 		dc.b  7, 7, 6, 6, 5, 5, 4, 4, 3, 3, 2, 2, 1, 1, 0, 0
                    0303 0202 0101 0000 
(1) 2662/FFFFFFFFFFFF138C : 0000 0101 0202 0303 		dc.b  0, 0, 1, 1, 2, 2, 3, 3, 4, 4, 5, 5, 6, 6, 7, 7
                    0404 0505 0606 0707 
(1) 2663/FFFFFFFFFFFF139C : 0808 0909 0A0A 0B0B 		dc.b  8, 8, 9, 9,10,10,11,11,12,12,13,13,14,14,15,15
                    0C0C 0D0D 0E0E 0F0F 
(1) 2664/FFFFFFFFFFFF13AC :                     		align 2
(1) 2665/FFFFFFFFFFFF13AC :                     
(1) 2666/FFFFFFFFFFFF13AC :                     ; ====================================================================
(1) 2667/FFFFFFFFFFFF13AC :                     ; ----------------------------------------------------------------
(1) 2668/FFFFFFFFFFFF13AC :                     ; Video routines for 32X
(1) 2669/FFFFFFFFFFFF13AC :                     ; ----------------------------------------------------------------
(1) 2670/FFFFFFFFFFFF13AC :                     
(1) 2671/FFFFFFFFFFFF13AC :                     ; --------------------------------------------------------
(1) 2672/FFFFFFFFFFFF13AC :                     ; Video_Mars_GfxMode
(1) 2673/FFFFFFFFFFFF13AC :                     ; Sets graphics mode on the 32X side
(1) 2674/FFFFFFFFFFFF13AC :                     ;
(1) 2675/FFFFFFFFFFFF13AC :                     ; Input:
(1) 2676/FFFFFFFFFFFF13AC :                     ; d0 - Graphics mode
(1) 2677/FFFFFFFFFFFF13AC :                     ; --------------------------------------------------------
(1) 2678/FFFFFFFFFFFF13AC :                     
(1) 2679/FFFFFFFFFFFF13AC :                     Video_Mars_GfxMode:
(1) 2680/FFFFFFFFFFFF13AC :                     ; 	if MARS
(1) 2681/FFFFFFFFFFFF13AC :                     ; 		move.w	d0,d7
(1) 2682/FFFFFFFFFFFF13AC :                     ; 		and.w	#%00000111,d7			; Current limit: 8 Master modes
(1) 2683/FFFFFFFFFFFF13AC :                     ; 		or.w	#$C0,d7
(1) 2684/FFFFFFFFFFFF13AC :                     ; 		move.b	d7,(sysmars_reg+comm12+1).l
(1) 2685/FFFFFFFFFFFF13AC :                     ; 		bsr	System_MarsUpdate
(1) 2686/FFFFFFFFFFFF13AC :                     ; .wait_slv:	move.w	(sysmars_reg+comm14).l,d7	; Wait for Slave
(1) 2687/FFFFFFFFFFFF13AC :                     ; 		and.w	#%00001111,d7
(1) 2688/FFFFFFFFFFFF13AC :                     ; 		bne.s	.wait_slv
(1) 2689/FFFFFFFFFFFF13AC :                     ; .wait:		move.w	(sysmars_reg+comm12).l,d7	; Wait for Master
(1) 2690/FFFFFFFFFFFF13AC :                     ; 		and.w	#%11000000,d7
(1) 2691/FFFFFFFFFFFF13AC :                     ; 		bne.s	.wait
(1) 2692/FFFFFFFFFFFF13AC :                     ; 	endif
(1) 2693/FFFFFFFFFFFF13AC : 4E75                		rts
(1) 2694/FFFFFFFFFFFF13AE :                     
(1) 2695/FFFFFFFFFFFF13AE :                     ; --------------------------------------------------------
(1) 2696/FFFFFFFFFFFF13AE :                     ; Video_Mars_WaitFrame
(1) 2697/FFFFFFFFFFFF13AE :                     ; --------------------------------------------------------
(1) 2698/FFFFFFFFFFFF13AE :                     
(1) 2699/FFFFFFFFFFFF13AE :                     Video_Mars_WaitFrame:
(1) 2700/FFFFFFFFFFFF13AE :                     ; 	if MARS
(1) 2701/FFFFFFFFFFFF13AE :                     ; 		bset	#5,(sysmars_reg+comm12+1).l	; Set R bit
(1) 2702/FFFFFFFFFFFF13AE :                     ; .wait:
(1) 2703/FFFFFFFFFFFF13AE :                     ; ; 		move.w	(vdp_ctrl),d7
(1) 2704/FFFFFFFFFFFF13AE :                     ; ; 		btst	#bitVBlk,d7
(1) 2705/FFFFFFFFFFFF13AE :                     ; ; 		bne.s	.late
(1) 2706/FFFFFFFFFFFF13AE :                     ; 		move.w	(sysmars_reg+comm12).l,d7
(1) 2707/FFFFFFFFFFFF13AE :                     ; 		btst	#5,d7
(1) 2708/FFFFFFFFFFFF13AE :                     ; 		bne.s	.wait
(1) 2709/FFFFFFFFFFFF13AE :                     ; .late:
(1) 2710/FFFFFFFFFFFF13AE :                     ; 	endif
(1) 2711/FFFFFFFFFFFF13AE : 4E75                		rts
(1) 2712/FFFFFFFFFFFF13B0 :                     
(1) 2713/FFFFFFFFFFFF13B0 :                     ; --------------------------------------------------------
(1) 2714/FFFFFFFFFFFF13B0 :                     ; Video_LoadPal_Mars
(1) 2715/FFFFFFFFFFFF13B0 :                     ;
(1) 2716/FFFFFFFFFFFF13B0 :                     ; Load Indexed palette directly to Buffer
(1) 2717/FFFFFFFFFFFF13B0 :                     ;
(1) 2718/FFFFFFFFFFFF13B0 :                     ; d0 - Start at
(1) 2719/FFFFFFFFFFFF13B0 :                     ; d1 - Number of colors
(1) 2720/FFFFFFFFFFFF13B0 :                     ; d2 - Priority bit OFF/ON
(1) 2721/FFFFFFFFFFFF13B0 :                     ; --------------------------------------------------------
(1) 2722/FFFFFFFFFFFF13B0 :                     
(1) 2723/FFFFFFFFFFFF13B0 :                     Video_FadePal_Mars:
(1) 2724/FFFFFFFFFFFF13B0 : 4DF8 9534           		lea	(RAM_MdMarsPalFd),a6
(1) 2725/FFFFFFFFFFFF13B4 : 4278 99AC           		clr.w	(RAM_FadeMarsTmr).w
(1) 2726/FFFFFFFFFFFF13B8 : 6004                		bra.s	vidMars_Pal
(1) 2727/FFFFFFFFFFFF13BA :                     Video_LoadPal_Mars:
(1) 2728/FFFFFFFFFFFF13BA : 4DF8 A800           		lea	(RAM_MdDreq+Dreq_Palette),a6
(1) 2729/FFFFFFFFFFFF13BE :                     vidMars_Pal:
(1) 2730/FFFFFFFFFFFF13BE : 2A48                		move.l	a0,a5
(1) 2731/FFFFFFFFFFFF13C0 : 7E00                		moveq	#0,d7
(1) 2732/FFFFFFFFFFFF13C2 : 3E00                		move.w	d0,d7
(1) 2733/FFFFFFFFFFFF13C4 : DE47                		add.w	d7,d7
(1) 2734/FFFFFFFFFFFF13C6 : DCC7                		adda	d7,a6
(1) 2735/FFFFFFFFFFFF13C8 : 3E01                		move.w	d1,d7
(1) 2736/FFFFFFFFFFFF13CA : 9E7C 0001           		sub.w	#1,d7
(1) 2737/FFFFFFFFFFFF13CE : 3C02                		move.w	d2,d6
(1) 2738/FFFFFFFFFFFF13D0 : CC7C 0001           		and.w	#1,d6
(1) 2739/FFFFFFFFFFFF13D4 : E25E                		ror.w	#1,d6
(1) 2740/FFFFFFFFFFFF13D6 :                     .loop:
(1) 2741/FFFFFFFFFFFF13D6 : 3A1D                		move.w	(a5)+,d5
(1) 2742/FFFFFFFFFFFF13D8 : 8A46                		or.w	d6,d5
(1) 2743/FFFFFFFFFFFF13DA : 3CC5                		move.w	d5,(a6)+
(1) 2744/FFFFFFFFFFFF13DC : 51CF FFF8           		dbf	d7,.loop
(1) 2745/FFFFFFFFFFFF13E0 : 4E75                		rts
(1) 2746/FFFFFFFFFFFF13E2 :                     
(1) 2747/FFFFFFFFFFFF13E2 :                     ; --------------------------------------------------------
(1) 2748/FFFFFFFFFFFF13E2 :                     ; Video_MarsPalFade
(1) 2749/FFFFFFFFFFFF13E2 :                     ;
(1) 2750/FFFFFFFFFFFF13E2 :                     ; a0 - Palette data
(1) 2751/FFFFFFFFFFFF13E2 :                     ; d0 - Number of colors
(1) 2752/FFFFFFFFFFFF13E2 :                     ; d1 - Speed
(1) 2753/FFFFFFFFFFFF13E2 :                     ;
(1) 2754/FFFFFFFFFFFF13E2 :                     ; RAM_ReqFadeMars: (WORD)
(1) 2755/FFFFFFFFFFFF13E2 :                     ; $00 - No task (or finished)
(1) 2756/FFFFFFFFFFFF13E2 :                     ; $01 - Fade in
(1) 2757/FFFFFFFFFFFF13E2 :                     ; $02 - Fade out to black
(1) 2758/FFFFFFFFFFFF13E2 :                     ;
(1) 2759/FFFFFFFFFFFF13E2 :                     ; CALL THIS OUTSIDE OF VBLANK
(1) 2760/FFFFFFFFFFFF13E2 :                     ; --------------------------------------------------------
(1) 2761/FFFFFFFFFFFF13E2 :                     
(1) 2762/FFFFFFFFFFFF13E2 :                     ; TODO: luego ver que hago con el priority bit
(1) 2763/FFFFFFFFFFFF13E2 :                     
(1) 2764/FFFFFFFFFFFF13E2 :                     Video_MarsPalFade:
(1) 2765/FFFFFFFFFFFF13E2 : 0478 0001 99AC      		sub.w	#1,(RAM_FadeMarsTmr).w
(1) 2766/FFFFFFFFFFFF13E8 : 6A14                		bpl.s	.active
(1) 2767/FFFFFFFFFFFF13EA : 31F8 99AA 99AC      		move.w	(RAM_FadeMarsDelay).w,(RAM_FadeMarsTmr).w
(1) 2768/FFFFFFFFFFFF13F0 : 3E38 99A6           		move.w	(RAM_FadeMarsReq).w,d7
(1) 2769/FFFFFFFFFFFF13F4 : DE47                		add.w	d7,d7
(1) 2770/FFFFFFFFFFFF13F6 : 3E3B 7008           		move.w	.fade_list(pc,d7.w),d7
(1) 2771/FFFFFFFFFFFF13FA : 4EFB 7004           		jmp	.fade_list(pc,d7.w)
(1) 2772/FFFFFFFFFFFF13FE :                     .active:
(1) 2773/FFFFFFFFFFFF13FE : 4E75                		rts
(1) 2774/FFFFFFFFFFFF1400 :                     
(1) 2775/FFFFFFFFFFFF1400 :                     ; --------------------------------------------
(1) 2776/FFFFFFFFFFFF1400 :                     
(1) 2777/FFFFFFFFFFFF1400 :                     .fade_list:
(1) 2778/FFFFFFFFFFFF1400 : 0006                		dc.w .fade_done-.fade_list
(1) 2779/FFFFFFFFFFFF1402 : 0008                		dc.w .fade_in-.fade_list
(1) 2780/FFFFFFFFFFFF1404 : 00B2                		dc.w .fade_out-.fade_list
(1) 2781/FFFFFFFFFFFF1406 :                     
(1) 2782/FFFFFFFFFFFF1406 :                     ; --------------------------------------------
(1) 2783/FFFFFFFFFFFF1406 :                     ; No fade or finished.
(1) 2784/FFFFFFFFFFFF1406 :                     ; --------------------------------------------
(1) 2785/FFFFFFFFFFFF1406 :                     
(1) 2786/FFFFFFFFFFFF1406 :                     .fade_done:
(1) 2787/FFFFFFFFFFFF1406 : 4E75                		rts
(1) 2788/FFFFFFFFFFFF1408 :                     
(1) 2789/FFFFFFFFFFFF1408 :                     ; --------------------------------------------
(1) 2790/FFFFFFFFFFFF1408 :                     ; Fade in
(1) 2791/FFFFFFFFFFFF1408 :                     ; --------------------------------------------
(1) 2792/FFFFFFFFFFFF1408 :                     
(1) 2793/FFFFFFFFFFFF1408 :                     .fade_in:
(1) 2794/FFFFFFFFFFFF1408 : 4DF8 9534           		lea	(RAM_MdMarsPalFd),a6
(1) 2795/FFFFFFFFFFFF140C : 4BF8 A800           		lea	(RAM_MdDreq+Dreq_Palette),a5
(1) 2796/FFFFFFFFFFFF1410 : 303C 0100           		move.w	#256,d0				; Num of colors
(1) 2797/FFFFFFFFFFFF1414 : 3238 99A8           		move.w	(RAM_FadeMarsIncr).w,d1		; Speed
(1) 2798/FFFFFFFFFFFF1418 : 3C00                		move.w	d0,d6
(1) 2799/FFFFFFFFFFFF141A : 4846                		swap	d6
(1) 2800/FFFFFFFFFFFF141C : 907C 0001           		sub.w	#1,d0
(1) 2801/FFFFFFFFFFFF1420 :                     .nxt_pal:
(1) 2802/FFFFFFFFFFFF1420 : 4242                		clr.w	d2		; Reset finished colorbits
(1) 2803/FFFFFFFFFFFF1422 : 3E16                		move.w	(a6),d7		; d7 - Input
(1) 2804/FFFFFFFFFFFF1424 : 3C15                		move.w	(a5),d6		; d6 - Output
(1) 2805/FFFFFFFFFFFF1426 : 3607                		move.w	d7,d3		; RED
(1) 2806/FFFFFFFFFFFF1428 : 3806                		move.w	d6,d4
(1) 2807/FFFFFFFFFFFF142A : CC7C FFE0           		and.w	#%1111111111100000,d6
(1) 2808/FFFFFFFFFFFF142E : C87C 001F           		and.w	#%0000000000011111,d4
(1) 2809/FFFFFFFFFFFF1432 : C67C 001F           		and.w	#%0000000000011111,d3
(1) 2810/FFFFFFFFFFFF1436 : D841                		add.w	d1,d4
(1) 2811/FFFFFFFFFFFF1438 : B843                		cmp.w	d3,d4
(1) 2812/FFFFFFFFFFFF143A : 6506                		bcs.s	.no_red
(1) 2813/FFFFFFFFFFFF143C : 3803                		move.w	d3,d4
(1) 2814/FFFFFFFFFFFF143E : 847C 0001           		or.w	#%001,d2	; RED is ready
(1) 2815/FFFFFFFFFFFF1442 :                     .no_red:
(1) 2816/FFFFFFFFFFFF1442 : 8C44                		or.w	d4,d6
(1) 2817/FFFFFFFFFFFF1444 : EB49                		lsl.w	#5,d1
(1) 2818/FFFFFFFFFFFF1446 : 3607                		move.w	d7,d3		; GREEN
(1) 2819/FFFFFFFFFFFF1448 : 3806                		move.w	d6,d4
(1) 2820/FFFFFFFFFFFF144A : CC7C FC1F           		and.w	#%1111110000011111,d6
(1) 2821/FFFFFFFFFFFF144E : C87C 03E0           		and.w	#%0000001111100000,d4
(1) 2822/FFFFFFFFFFFF1452 : C67C 03E0           		and.w	#%0000001111100000,d3
(1) 2823/FFFFFFFFFFFF1456 : D841                		add.w	d1,d4
(1) 2824/FFFFFFFFFFFF1458 : B843                		cmp.w	d3,d4
(1) 2825/FFFFFFFFFFFF145A : 6506                		bcs.s	.no_grn
(1) 2826/FFFFFFFFFFFF145C : 3803                		move.w	d3,d4
(1) 2827/FFFFFFFFFFFF145E : 847C 0002           		or.w	#%010,d2	; GREEN is ready
(1) 2828/FFFFFFFFFFFF1462 :                     .no_grn:
(1) 2829/FFFFFFFFFFFF1462 : 8C44                		or.w	d4,d6
(1) 2830/FFFFFFFFFFFF1464 : EB49                		lsl.w	#5,d1
(1) 2831/FFFFFFFFFFFF1466 : 3607                		move.w	d7,d3		; BLUE
(1) 2832/FFFFFFFFFFFF1468 : 3806                		move.w	d6,d4
(1) 2833/FFFFFFFFFFFF146A : CC7C 83FF           		and.w	#%1000001111111111,d6
(1) 2834/FFFFFFFFFFFF146E : C87C 7C00           		and.w	#%0111110000000000,d4
(1) 2835/FFFFFFFFFFFF1472 : C67C 7C00           		and.w	#%0111110000000000,d3
(1) 2836/FFFFFFFFFFFF1476 : D841                		add.w	d1,d4
(1) 2837/FFFFFFFFFFFF1478 : B843                		cmp.w	d3,d4
(1) 2838/FFFFFFFFFFFF147A : 6506                		bcs.s	.no_blu
(1) 2839/FFFFFFFFFFFF147C : 3803                		move.w	d3,d4
(1) 2840/FFFFFFFFFFFF147E : 847C 0004           		or.w	#%100,d2	; BLUE is ready
(1) 2841/FFFFFFFFFFFF1482 :                     .no_blu:
(1) 2842/FFFFFFFFFFFF1482 : 8C44                		or.w	d4,d6
(1) 2843/FFFFFFFFFFFF1484 : E049                		lsr.w	#8,d1
(1) 2844/FFFFFFFFFFFF1486 : E449                		lsr.w	#2,d1
(1) 2845/FFFFFFFFFFFF1488 : CE7C 8000           		and.w	#$8000,d7	; Keep priority bit
(1) 2846/FFFFFFFFFFFF148C : 8C47                		or.w	d7,d6
(1) 2847/FFFFFFFFFFFF148E : 3AC6                		move.w	d6,(a5)+
(1) 2848/FFFFFFFFFFFF1490 : DCFC 0002           		adda	#2,a6
(1) 2849/FFFFFFFFFFFF1494 : B47C 0007           		cmp.w	#%111,d2
(1) 2850/FFFFFFFFFFFF1498 : 6608                		bne.s	.no_fnsh
(1) 2851/FFFFFFFFFFFF149A : 4846                		swap	d6
(1) 2852/FFFFFFFFFFFF149C : 9C7C 0001           		sub.w	#1,d6
(1) 2853/FFFFFFFFFFFF14A0 : 4846                		swap	d6
(1) 2854/FFFFFFFFFFFF14A2 :                     .no_fnsh:
(1) 2855/FFFFFFFFFFFF14A2 : 51C8 FF7C           		dbf	d0,.nxt_pal
(1) 2856/FFFFFFFFFFFF14A6 : 4846                		swap	d6
(1) 2857/FFFFFFFFFFFF14A8 : 4A46                		tst.w	d6
(1) 2858/FFFFFFFFFFFF14AA : 6604                		bne.s	.no_move
(1) 2859/FFFFFFFFFFFF14AC : 4278 99A6           		clr.w	(RAM_FadeMarsReq).w
(1) 2860/FFFFFFFFFFFF14B0 :                     .no_move:
(1) 2861/FFFFFFFFFFFF14B0 : 4E75                		rts
(1) 2862/FFFFFFFFFFFF14B2 :                     
(1) 2863/FFFFFFFFFFFF14B2 :                     ; --------------------------------------------
(1) 2864/FFFFFFFFFFFF14B2 :                     ; Fade out
(1) 2865/FFFFFFFFFFFF14B2 :                     ; --------------------------------------------
(1) 2866/FFFFFFFFFFFF14B2 :                     
(1) 2867/FFFFFFFFFFFF14B2 :                     .fade_out:
(1) 2868/FFFFFFFFFFFF14B2 : 4DF8 A800           		lea	(RAM_MdDreq+Dreq_Palette),a6
(1) 2869/FFFFFFFFFFFF14B6 : 303C 0100           		move.w	#256,d0				; Num of colors
(1) 2870/FFFFFFFFFFFF14BA : 3238 99A8           		move.w	(RAM_FadeMarsIncr).w,d1		; Speed
(1) 2871/FFFFFFFFFFFF14BE : 3C00                		move.w	d0,d6
(1) 2872/FFFFFFFFFFFF14C0 : 4846                		swap	d6
(1) 2873/FFFFFFFFFFFF14C2 : 907C 0001           		sub.w	#1,d0
(1) 2874/FFFFFFFFFFFF14C6 :                     .nxt_pal_o:
(1) 2875/FFFFFFFFFFFF14C6 : 4242                		clr.w	d2		; Reset finished colorbits
(1) 2876/FFFFFFFFFFFF14C8 : 3E16                		move.w	(a6),d7		; d7 - Input
(1) 2877/FFFFFFFFFFFF14CA : 3C07                		move.w	d7,d6
(1) 2878/FFFFFFFFFFFF14CC : CE7C FFE0           		and.w	#%1111111111100000,d7
(1) 2879/FFFFFFFFFFFF14D0 : CC7C 001F           		and.w	#%0000000000011111,d6
(1) 2880/FFFFFFFFFFFF14D4 : 9C41                		sub.w	d1,d6
(1) 2881/FFFFFFFFFFFF14D6 : 6A06                		bpl.s	.no_red_o
(1) 2882/FFFFFFFFFFFF14D8 : 4246                		clr.w	d6
(1) 2883/FFFFFFFFFFFF14DA : 847C 0001           		or.w	#%001,d2	; RED is ready
(1) 2884/FFFFFFFFFFFF14DE :                     .no_red_o:
(1) 2885/FFFFFFFFFFFF14DE : 8E46                		or.w	d6,d7
(1) 2886/FFFFFFFFFFFF14E0 : EB49                		lsl.w	#5,d1
(1) 2887/FFFFFFFFFFFF14E2 : 3C07                		move.w	d7,d6
(1) 2888/FFFFFFFFFFFF14E4 : CE7C FC1F           		and.w	#%1111110000011111,d7
(1) 2889/FFFFFFFFFFFF14E8 : CC7C 03E0           		and.w	#%0000001111100000,d6
(1) 2890/FFFFFFFFFFFF14EC : 9C41                		sub.w	d1,d6
(1) 2891/FFFFFFFFFFFF14EE : 6A06                		bpl.s	.no_grn_o
(1) 2892/FFFFFFFFFFFF14F0 : 4246                		clr.w	d6
(1) 2893/FFFFFFFFFFFF14F2 : 847C 0002           		or.w	#%010,d2	; GREEN is ready
(1) 2894/FFFFFFFFFFFF14F6 :                     .no_grn_o:
(1) 2895/FFFFFFFFFFFF14F6 : 8E46                		or.w	d6,d7
(1) 2896/FFFFFFFFFFFF14F8 : EB49                		lsl.w	#5,d1
(1) 2897/FFFFFFFFFFFF14FA : 3C07                		move.w	d7,d6
(1) 2898/FFFFFFFFFFFF14FC : CE7C 83FF           		and.w	#%1000001111111111,d7
(1) 2899/FFFFFFFFFFFF1500 : CC7C 7C00           		and.w	#%0111110000000000,d6
(1) 2900/FFFFFFFFFFFF1504 : 9C41                		sub.w	d1,d6
(1) 2901/FFFFFFFFFFFF1506 : 6A06                		bpl.s	.no_blu_o
(1) 2902/FFFFFFFFFFFF1508 : 4246                		clr.w	d6
(1) 2903/FFFFFFFFFFFF150A : 847C 0004           		or.w	#%100,d2	; BLUE is ready
(1) 2904/FFFFFFFFFFFF150E :                     .no_blu_o:
(1) 2905/FFFFFFFFFFFF150E : 8E46                		or.w	d6,d7
(1) 2906/FFFFFFFFFFFF1510 : E049                		lsr.w	#8,d1
(1) 2907/FFFFFFFFFFFF1512 : E449                		lsr.w	#2,d1
(1) 2908/FFFFFFFFFFFF1514 : 3CC7                		move.w	d7,(a6)+
(1) 2909/FFFFFFFFFFFF1516 : B47C 0007           		cmp.w	#%111,d2
(1) 2910/FFFFFFFFFFFF151A : 6608                		bne.s	.no_fnsh_o
(1) 2911/FFFFFFFFFFFF151C : 4846                		swap	d6
(1) 2912/FFFFFFFFFFFF151E : 9C7C 0001           		sub.w	#1,d6
(1) 2913/FFFFFFFFFFFF1522 : 4846                		swap	d6
(1) 2914/FFFFFFFFFFFF1524 :                     .no_fnsh_o:
(1) 2915/FFFFFFFFFFFF1524 : 51C8 FFA0           		dbf	d0,.nxt_pal_o
(1) 2916/FFFFFFFFFFFF1528 : 4846                		swap	d6
(1) 2917/FFFFFFFFFFFF152A : 4A46                		tst.w	d6
(1) 2918/FFFFFFFFFFFF152C : 6604                		bne.s	.no_move_o
(1) 2919/FFFFFFFFFFFF152E : 4278 99A6           		clr.w	(RAM_FadeMarsReq).w
(1) 2920/FFFFFFFFFFFF1532 :                     .no_move_o:
(1) 2921/FFFFFFFFFFFF1532 : 4E75                		rts
(1) 2922/FFFFFFFFFFFF1534 :                     
     152/FFFFFFFFFFFF1534 :                     		include	"system/md/system.asm"
(1)    1/FFFFFFFFFFFF1534 :                     ; ====================================================================
(1)    2/FFFFFFFFFFFF1534 :                     ; ----------------------------------------------------------------
(1)    3/FFFFFFFFFFFF1534 :                     ; Genesis system routines
(1)    4/FFFFFFFFFFFF1534 :                     ; ----------------------------------------------------------------
(1)    5/FFFFFFFFFFFF1534 :                     
(1)    6/FFFFFFFFFFFF1534 :                     ; ====================================================================
(1)    7/FFFFFFFFFFFF1534 :                     ; ----------------------------------------------------------------
(1)    8/FFFFFFFFFFFF1534 :                     ; RAM section
(1)    9/FFFFFFFFFFFF1534 :                     ; ----------------------------------------------------------------
(1)   10/FFFFFFFFFFFF1534 :                     
(1)   11/FFFFFFFFFFFF1534 : (MACRO)             		struct RAM_MdSystem
(1)   11/FFFFFFFFFFFF1534 : =$FFFFFFFFFF..      GLBL_LASTPC     set *
(1)   11/    518E :                                     dephase
(1)   11/    518E : =$518E              GLBL_LASTORG    set *
(1)   11/FFFFFFFFFFFFA000 :                                     phase RAM_MDSYSTEM
(1)   12/FFFFFFFFFFFFA000 :                     RAM_InputData	ds.b sizeof_input*4		; Input data section
(1)   13/FFFFFFFFFFFFA040 :                     RAM_SaveData	ds.b $200			; SRAM data cache
(1)   14/FFFFFFFFFFFFA240 :                     RAM_DmaCode	ds.b $200
(1)   15/FFFFFFFFFFFFA440 :                     RAM_SysRandVal	ds.l 1				; Random value
(1)   16/FFFFFFFFFFFFA444 :                     RAM_SysRandSeed	ds.l 1				; Randomness seed
(1)   17/FFFFFFFFFFFFA448 :                     RAM_initflug	ds.l 1				; "INIT" flag
(1)   18/FFFFFFFFFFFFA44C :                     RAM_MdMarsVInt	ds.w 3				; VBlank jump (JMP xxxx xxxx)
(1)   19/FFFFFFFFFFFFA452 :                     RAM_MdMarsHint	ds.w 3				; HBlank jump (JMP xxxx xxxx)
(1)   20/FFFFFFFFFFFFA458 :                     RAM_MdVBlkWait	ds.w 1
(1)   21/FFFFFFFFFFFFA45A :                     sizeof_mdsys	ds.l 0
(1)   22/FFFFFFFFFFFFA45A : (MACRO)             		endstruct
(1)   22/FFFFFFFFFFFFA000 :                                     !org GLBL_LASTORG
(1)   22/FFFFFFFFFFFF1534 :                                     phase GLBL_LASTPC
(1)   23/FFFFFFFFFFFF1534 : (MACRO)             		report "MD SYS-SUBS",sizeof_mdsys-RAM_MdSystem,MAX_MdSystem
(1)   24/FFFFFFFFFFFF1534 :                     
(1)   25/FFFFFFFFFFFF1534 :                     ; ====================================================================
(1)   26/FFFFFFFFFFFF1534 :                     ; --------------------------------------------------------
(1)   27/FFFFFFFFFFFF1534 :                     ; Init System
(1)   28/FFFFFFFFFFFF1534 :                     ; 
(1)   29/FFFFFFFFFFFF1534 :                     ; Uses:
(1)   30/FFFFFFFFFFFF1534 :                     ; a0-a2,d0-d1
(1)   31/FFFFFFFFFFFF1534 :                     ; --------------------------------------------------------
(1)   32/FFFFFFFFFFFF1534 :                     
(1)   33/FFFFFFFFFFFF1534 :                     System_Init:
(1)   34/FFFFFFFFFFFF1534 : 40E7                		move.w	sr,-(sp)
(1)   35/FFFFFFFFFFFF1536 : 46FC 2700           		move.w	#$2700,sr		; Disable interrupts
(1)   36/FFFFFFFFFFFF153A : 33FC 0100 00A1 1100 		move.w	#$0100,(z80_bus).l	; Stop Z80
(1)   37/FFFFFFFFFFFF1542 :                     .wait:
(1)   38/FFFFFFFFFFFF1542 : 0839 0000 00A1 1100 		btst	#0,(z80_bus).l		; Wait for it
(1)   39/FFFFFFFFFFFF154A : 66F6                		bne.s	.wait
(1)   40/FFFFFFFFFFFF154C : 7040                		moveq	#%01000000,d0		; Init ports, TH=1
(1)   41/FFFFFFFFFFFF154E : 13C0 00A1 0009      		move.b	d0,(sys_ctrl_1).l	; Controller 1
(1)   42/FFFFFFFFFFFF1554 : 13C0 00A1 000B      		move.b	d0,(sys_ctrl_2).l	; Controller 2
(1)   43/FFFFFFFFFFFF155A : 13C0 00A1 000D      		move.b	d0,(sys_ctrl_3).l	; Modem
(1)   44/FFFFFFFFFFFF1560 : 33FC 0000 00A1 1100 		move.w	#0,(z80_bus).l		; Enable Z80
(1)   45/FFFFFFFFFFFF1568 : 303C 4EF9           		move.w	#$4EF9,d0		; Set JMP opcode for the Hblank/VBlank jumps
(1)   46/FFFFFFFFFFFF156C : 33C0 FFFF A44C       		move.w	d0,(RAM_MdMarsVInt).l
(1)   47/FFFFFFFFFFFF1572 : 33C0 FFFF A452      		move.w	d0,(RAM_MdMarsHInt).l
(1)   48/FFFFFFFFFFFF1578 : 203C FFFF 1AF8      		move.l	#VInt_Default,d0	; Set default ints
(1)   49/FFFFFFFFFFFF157E : 223C FFFF 1B10      		move.l	#Hint_Default,d1
(1)   50/FFFFFFFFFFFF1584 : 6100 04C2           		bsr	System_SetInts
(1)   51/FFFFFFFFFFFF1588 : 41F8 A000           		lea	(RAM_InputData),a0	; Clear input data buffer
(1)   52/FFFFFFFFFFFF158C : 323C 0007           		move.w	#(sizeof_input/2)-1,d1
(1)   53/FFFFFFFFFFFF1590 : 7000                		moveq	#0,d0
(1)   54/FFFFFFFFFFFF1592 :                     .clrinput:
(1)   55/FFFFFFFFFFFF1592 : 30C0                		move.w	d0,(a0)+
(1)   56/FFFFFFFFFFFF1594 : 51C9 FFFC           		dbf	d1,.clrinput
(1)   57/FFFFFFFFFFFF1598 :                     ; 		move.l	#$56255769,d0		; Set these random values
(1)   58/FFFFFFFFFFFF1598 :                     ; 		move.l	#$95116102,d1
(1)   59/FFFFFFFFFFFF1598 :                     ; 		move.l	d0,(RAM_SysRandVal).l
(1)   60/FFFFFFFFFFFF1598 :                     ; 		move.l	d1,(RAM_SysRandSeed).l
(1)   61/FFFFFFFFFFFF1598 : 46DF                		move.w	(sp)+,sr
(1)   62/FFFFFFFFFFFF159A : 4E75                		rts
(1)   63/FFFFFFFFFFFF159C :                     
(1)   64/FFFFFFFFFFFF159C :                     ; --------------------------------------------------------
(1)   65/FFFFFFFFFFFF159C :                     ; System_WaitFrame
(1)   66/FFFFFFFFFFFF159C :                     ;
(1)   67/FFFFFFFFFFFF159C :                     ; Call this on the loop your current screen.
(1)   68/FFFFFFFFFFFF159C :                     ;
(1)   69/FFFFFFFFFFFF159C :                     ; Calling this it will:
(1)   70/FFFFFFFFFFFF159C :                     ; - Update the controller data
(1)   71/FFFFFFFFFFFF159C :                     ; - Transfer the Genesis palette, sprites and scroll
(1)   72/FFFFFFFFFFFF159C :                     ;   data from from RAM to VDP, RV bit is not required.
(1)   73/FFFFFFFFFFFF159C :                     ;
(1)   74/FFFFFFFFFFFF159C :                     ; But before entering VBlank:
(1)   75/FFFFFFFFFFFF159C :                     ; - The DREQ data stored here will be transfered
(1)   76/FFFFFFFFFFFF159C :                     ; to the 32X side
(1)   77/FFFFFFFFFFFF159C :                     ; --------------------------------------------------------
(1)   78/FFFFFFFFFFFF159C :                     
(1)   79/FFFFFFFFFFFF159C :                     System_WaitFrame:
(1)   80/FFFFFFFFFFFF159C : 4DF9 00C0 0004      		lea	(vdp_ctrl),a6		; Inside VBlank?
(1)   81/FFFFFFFFFFFF15A2 : 3816                .wait_lag:	move.w	(a6),d4			; then it's a lag frame.
(1)   82/FFFFFFFFFFFF15A4 : 0804 0003           		btst	#bitVBlk,d4
(1)   83/FFFFFFFFFFFF15A8 : 66F8                		bne.s	.wait_lag
(1)   84/FFFFFFFFFFFF15AA : 6100 00D6           		bsr	System_MarsUpdate	; Update 32X stuff
(1)   85/FFFFFFFFFFFF15AE : 4DF9 00C0 0004      		lea	(vdp_ctrl),a6		; Check if we are on DISPLAY
(1)   86/FFFFFFFFFFFF15B4 : 3816                .wait_in:	move.w	(a6),d4
(1)   87/FFFFFFFFFFFF15B6 : 0804 0003           		btst	#bitVBlk,d4
(1)   88/FFFFFFFFFFFF15BA : 67F8                		beq.s	.wait_in
(1)   89/FFFFFFFFFFFF15BC : 6100 0172           		bsr	System_Input		; Read inputs FIRST
(1)   90/FFFFFFFFFFFF15C0 :                     	; *** DMA'd Scroll and Palette
(1)   91/FFFFFFFFFFFF15C0 :                     	;
(1)   92/FFFFFFFFFFFF15C0 :                     	; The palette is transferred at the end so
(1)   93/FFFFFFFFFFFF15C0 :                     	; it doesn't show the dots on screen. (hopefully)
(1)   94/FFFFFFFFFFFF15C0 : 4DF9 00C0 0004      		lea	(vdp_ctrl),a6
(1)   95/FFFFFFFFFFFF15C6 : 3E3C 8100           		move.w	#$8100,d7		; DMA ON
(1)   96/FFFFFFFFFFFF15CA : 1E38 99AF           		move.b	(RAM_VdpRegs+1),d7
(1)   97/FFFFFFFFFFFF15CE : 08C7 0004           		bset	#bitDmaEnbl,d7
(1)   98/FFFFFFFFFFFF15D2 : 3C87                		move.w	d7,(a6)
(1)   99/FFFFFFFFFFFF15D4 : 6100 0082           		bsr	System_DmaEnter_RAM
(1)  100/FFFFFFFFFFFF15D8 : 2CBC 9400 9328      		move.l	#$94009328,(a6)
(1)  101/FFFFFFFFFFFF15DE : 2CBC 96C5 9582      		move.l	#$96009500|(RAM_VerScroll<<7&$FF0000)|(RAM_VerScroll>>1&$FF),(a6)
(1)  102/FFFFFFFFFFFF15E4 : 3CBC 977F           		move.w	#$9700|(RAM_VerScroll>>17&$7F),(a6)
(1)  103/FFFFFFFFFFFF15E8 : 3CBC 4000           		move.w	#$4000,(a6)
(1)  104/FFFFFFFFFFFF15EC : 3F3C 0090           		move.w	#$0010|$80,-(sp)
(1)  105/FFFFFFFFFFFF15F0 : 3C9F                		move.w	(sp)+,(a6)
(1)  106/FFFFFFFFFFFF15F2 : 2CBC 9401 93E0      		move.l	#$940193E0,(a6)
(1)  107/FFFFFFFFFFFF15F8 : 2CBC 96C3 95A2      		move.l	#$96009500|(RAM_HorScroll<<7&$FF0000)|(RAM_HorScroll>>1&$FF),(a6)
(1)  108/FFFFFFFFFFFF15FE : 3CBC 977F           		move.w	#$9700|(RAM_HorScroll>>17&$7F),(a6)
(1)  109/FFFFFFFFFFFF1602 : 3CBC 7C00           		move.w	#$7C00,(a6)
(1)  110/FFFFFFFFFFFF1606 : 3F3C 0083           		move.w	#$0003|$80,-(sp)
(1)  111/FFFFFFFFFFFF160A : 3C9F                		move.w	(sp)+,(a6)
(1)  112/FFFFFFFFFFFF160C : 2CBC 9401 93C0      		move.l	#$940193C0,(a6)
(1)  113/FFFFFFFFFFFF1612 : 2CBC 96C7 95EA      		move.l	#$96009500|(RAM_Sprites<<7&$FF0000)|(RAM_Sprites>>1&$FF),(a6)
(1)  114/FFFFFFFFFFFF1618 : 3CBC 977F           		move.w	#$9700|(RAM_Sprites>>17&$7F),(a6)
(1)  115/FFFFFFFFFFFF161C : 3CBC 7800           		move.w	#$7800,(a6)
(1)  116/FFFFFFFFFFFF1620 : 3F3C 0083           		move.w	#$0003|$80,-(sp)
(1)  117/FFFFFFFFFFFF1624 : 3C9F                		move.w	(sp)+,(a6)
(1)  118/FFFFFFFFFFFF1626 : 2CBC 9400 9340      		move.l	#$94009340,(a6)
(1)  119/FFFFFFFFFFFF162C : 2CBC 96CA 951A      		move.l	#$96009500|(RAM_Palette<<7&$FF0000)|(RAM_Palette>>1&$FF),(a6)
(1)  120/FFFFFFFFFFFF1632 : 3CBC 977F           		move.w	#$9700|(RAM_Palette>>17&$7F),(a6)
(1)  121/FFFFFFFFFFFF1636 : 3CBC C000           		move.w	#$C000,(a6)
(1)  122/FFFFFFFFFFFF163A : 3F3C 0080           		move.w	#$0000|$80,-(sp)
(1)  123/FFFFFFFFFFFF163E : 3C9F                		move.w	(sp)+,(a6)
(1)  124/FFFFFFFFFFFF1640 : 611A                		bsr	System_DmaExit_RAM
(1)  125/FFFFFFFFFFFF1642 : 3E3C 8100           		move.w	#$8100,d7
(1)  126/FFFFFFFFFFFF1646 : 1E38 99AF           		move.b	(RAM_VdpRegs+1).w,d7
(1)  127/FFFFFFFFFFFF164A : 3C87                		move.w	d7,(a6)
(1)  128/FFFFFFFFFFFF164C : 06B9 0000 0001 FFFF 		add.l	#1,(RAM_Framecount).l
                    8740                
(1)  129/FFFFFFFFFFFF1656 : 4E75                		rts
(1)  130/FFFFFFFFFFFF1658 :                     
(1)  131/FFFFFFFFFFFF1658 :                     ; --------------------------------------------------------
(1)  132/FFFFFFFFFFFF1658 :                     ; System_DmaEnter_(from) and System_DmaEnter_(from)
(1)  133/FFFFFFFFFFFF1658 :                     ; (from): ROM or RAM
(1)  134/FFFFFFFFFFFF1658 :                     ;
(1)  135/FFFFFFFFFFFF1658 :                     ; Call to these labels BEFORE and AFTER doing
(1)  136/FFFFFFFFFFFF1658 :                     ; DMA-to-VDP transers.
(1)  137/FFFFFFFFFFFF1658 :                     ; These calls are not needed for FILL or COPY.
(1)  138/FFFFFFFFFFFF1658 :                     ;
(1)  139/FFFFFFFFFFFF1658 :                     ; ** For stock Genesis:
(1)  140/FFFFFFFFFFFF1658 :                     ;  | The Z80 cannot read from ROM while the
(1)  141/FFFFFFFFFFFF1658 :                     ;  | DMA ROM-to-VDP transfer is active.
(1)  142/FFFFFFFFFFFF1658 :                     ;  | THIS INCLUDES RAM TRANSFERS.
(1)  143/FFFFFFFFFFFF1658 :                     ;  | ** Solution:
(1)  144/FFFFFFFFFFFF1658 :                     ;  | STOP the Z80 entirely OR:
(1)  145/FFFFFFFFFFFF1658 :                     ;  | First stop, set a flag and turn ON the
(1)  146/FFFFFFFFFFFF1658 :                     ;  | Z80 again, if the Z80 reads the flag it
(1)  147/FFFFFFFFFFFF1658 :                     ;  | should be stuck on a loop until you clear
(1)  148/FFFFFFFFFFFF1658 :                     ;  | that flag from here after finishing your
(1)  149/FFFFFFFFFFFF1658 :                     ;  | DMA transfer(s)
(1)  150/FFFFFFFFFFFF1658 :                     ;
(1)  151/FFFFFFFFFFFF1658 :                     ; ** For the 32X:
(1)  152/FFFFFFFFFFFF1658 :                     ;  | SAME rule for the Genesis, but this time the
(1)  153/FFFFFFFFFFFF1658 :                     ;  | ROM-to-VDP transfer requires the RV bit to be set.
(1)  154/FFFFFFFFFFFF1658 :                     ;  | (RAM transfers doesn't require this bit at all.)
(1)  155/FFFFFFFFFFFF1658 :                     ;  | Setting the RV bit blocks the SH2 from accessing
(1)  156/FFFFFFFFFFFF1658 :                     ;  | the ROM area, THIS ALSO affects the Z80.
(1)  157/FFFFFFFFFFFF1658 :                     ;  | ** Solution:
(1)  158/FFFFFFFFFFFF1658 :                     ;  | First, make sure the SH2 isn't reading from ROM
(1)  159/FFFFFFFFFFFF1658 :                     ;  | while the bit is active, or it will read garbage
(1)  160/FFFFFFFFFFFF1658 :                     ;  | data.
(1)  161/FFFFFFFFFFFF1658 :                     ;  | In the case where you need to read from ROM
(1)  162/FFFFFFFFFFFF1658 :                     ;  | a lot (Playing PWM's for example):
(1)  163/FFFFFFFFFFFF1658 :                     ;  | First request an CMD interrupt and tell the
(1)  164/FFFFFFFFFFFF1658 :                     ;  | SH2 to backup a small amount of sample data
(1)  165/FFFFFFFFFFFF1658 :                     ;  | and temporally relocate the read point to the
(1)  166/FFFFFFFFFFFF1658 :                     ;  | backup until you make another
(1)  167/FFFFFFFFFFFF1658 :                     ;  | interrupt telling that you finished here and set
(1)  168/FFFFFFFFFFFF1658 :                     ;  | RV back to 0.
(1)  169/FFFFFFFFFFFF1658 :                     ;
(1)  170/FFFFFFFFFFFF1658 :                     ; This is where you put your Sound driver's Z80 stop
(1)  171/FFFFFFFFFFFF1658 :                     ; or pause calls go here
(1)  172/FFFFFFFFFFFF1658 :                     ; --------------------------------------------------------
(1)  173/FFFFFFFFFFFF1658 :                     
(1)  174/FFFFFFFFFFFF1658 :                     System_DmaEnter_RAM:
(1)  175/FFFFFFFFFFFF1658 : 6000 EAA0           		bra	gemaDmaPause
(1)  176/FFFFFFFFFFFF165C :                     System_DmaExit_RAM:
(1)  177/FFFFFFFFFFFF165C : 6000 EAC4           		bra	gemaDmaResume
(1)  178/FFFFFFFFFFFF1660 :                     
(1)  179/FFFFFFFFFFFF1660 :                     ; --------------------------------------------------------
(1)  180/FFFFFFFFFFFF1660 :                     
(1)  181/FFFFFFFFFFFF1660 :                     System_DmaEnter_ROM:
(1)  182/FFFFFFFFFFFF1660 : 6000 EADA           		bra	gemaDmaPauseRom
(1)  183/FFFFFFFFFFFF1664 :                     System_DmaExit_ROM:
(1)  184/FFFFFFFFFFFF1664 : 6000 EAF8           		bra	gemaDmaResumeRom
(1)  185/FFFFFFFFFFFF1668 :                     
(1)  186/FFFFFFFFFFFF1668 :                     ; ====================================================================
(1)  187/FFFFFFFFFFFF1668 :                     ; ----------------------------------------------------------------
(1)  188/FFFFFFFFFFFF1668 :                     ; SEGA CD / CD+32X ONLY
(1)  189/FFFFFFFFFFFF1668 :                     ;
(1)  190/FFFFFFFFFFFF1668 :                     ; a6 - Communication ports RW/RO
(1)  191/FFFFFFFFFFFF1668 :                     ; ----------------------------------------------------------------
(1)  192/FFFFFFFFFFFF1668 :                     
(1)  194/FFFFFFFFFFFF1668 :                     System_McdSubTask:
(1)  195/FFFFFFFFFFFF1668 : 4DF9 00A1 200E      		lea	(sysmcd_reg+mcd_comm_m),a6
(1)  196/FFFFFFFFFFFF166E : 1E2E 0001           .wait_sub_s:	move.b	1(a6),d7		; Wait if SUB is BUSY
(1)  197/FFFFFFFFFFFF1672 : 6BFA                		bmi.s	.wait_sub_s
(1)  198/FFFFFFFFFFFF1674 : 1C80                		move.b	d0,(a6)			; Set this command
(1)  199/FFFFFFFFFFFF1676 : 1E2E 0001           .wait_sub_i:	move.b	1(a6),d7		; Wait until SUB gets busy
(1)  200/FFFFFFFFFFFF167A : 6AFA                		bpl.s	.wait_sub_i
(1)  201/FFFFFFFFFFFF167C : 1CBC 0000           		move.b	#$00,(a6)		; Clear value, SUB already got the ID
(1)  202/FFFFFFFFFFFF1680 :                     ; .wait_sub_o:	move.b	1(a6),d7		; Wait until SUB finishes
(1)  203/FFFFFFFFFFFF1680 :                     ; 		bmi.s	.wait_sub_o
(1)  204/FFFFFFFFFFFF1680 : 4E75                		rts
(1)  206/FFFFFFFFFFFF1682 :                     
(1)  207/FFFFFFFFFFFF1682 :                     ; ====================================================================
(1)  208/FFFFFFFFFFFF1682 :                     ; ----------------------------------------------------------------
(1)  209/FFFFFFFFFFFF1682 :                     ; 32X ONLY
(1)  210/FFFFFFFFFFFF1682 :                     ; ----------------------------------------------------------------
(1)  211/FFFFFFFFFFFF1682 :                     
(1)  212/FFFFFFFFFFFF1682 :                     ; --------------------------------------------------------
(1)  213/FFFFFFFFFFFF1682 :                     ; System_MarsUpdate
(1)  214/FFFFFFFFFFFF1682 :                     ; --------------------------------------------------------
(1)  215/FFFFFFFFFFFF1682 :                     
(1)  216/FFFFFFFFFFFF1682 :                     System_MarsUpdate:
(1)  218/FFFFFFFFFFFF1682 : 41F8 A800           		lea	(RAM_MdDreq),a0		; Send DREQ
(1)  219/FFFFFFFFFFFF1686 : 303C 05F8           		move.w	#sizeof_dreq,d0
(1)  220/FFFFFFFFFFFF168A : 4EF9 FFFF 1B12      		jmp	(System_RomSendDreq).l	; <-- EXTERNAL JUMP to $880000 area
(1)  224/FFFFFFFFFFFF1690 :                     
(1)  225/FFFFFFFFFFFF1690 :                     ; --------------------------------------------------------
(1)  226/FFFFFFFFFFFF1690 :                     ; System_GrabRamCode
(1)  227/FFFFFFFFFFFF1690 :                     ;
(1)  228/FFFFFFFFFFFF1690 :                     ; MCD, 32X and CD32X only.
(1)  229/FFFFFFFFFFFF1690 :                     ;
(1)  230/FFFFFFFFFFFF1690 :                     ; Send new code to the USER side of RAM and
(1)  231/FFFFFFFFFFFF1690 :                     ; jump into it.
(1)  232/FFFFFFFFFFFF1690 :                     ;
(1)  233/FFFFFFFFFFFF1690 :                     ; ** FOR SEGA CD/CD+32X
(1)  234/FFFFFFFFFFFF1690 :                     ; Input:
(1)  235/FFFFFFFFFFFF1690 :                     ; a0 -
(1)  236/FFFFFFFFFFFF1690 :                     ;
(1)  237/FFFFFFFFFFFF1690 :                     ; ** FOR SEGA 32X
(1)  238/FFFFFFFFFFFF1690 :                     ; a0 - Filename string 8-bytes
(1)  239/FFFFFFFFFFFF1690 :                     ;
(1)  240/FFFFFFFFFFFF1690 :                     ; Input:
(1)  241/FFFFFFFFFFFF1690 :                     ; d0 - Location of the RAM code to copy
(1)  242/FFFFFFFFFFFF1690 :                     ;      in the $880000/$900000 areas
(1)  243/FFFFFFFFFFFF1690 :                     ; --------------------------------------------------------
(1)  244/FFFFFFFFFFFF1690 :                     
(1)  245/FFFFFFFFFFFF1690 :                     System_GrabRamCode:
(1)  247/FFFFFFFFFFFF1690 : 43F9 00A1 2010      		lea	(sysmcd_reg+mcd_dcomm_m),a1
(1)  248/FFFFFFFFFFFF1696 : 32D8                		move.w	(a0)+,(a1)+			; 0 copy filename
(1)  249/FFFFFFFFFFFF1698 : 32D8                		move.w	(a0)+,(a1)+			; 2
(1)  250/FFFFFFFFFFFF169A : 32D8                		move.w	(a0)+,(a1)+			; 4
(1)  251/FFFFFFFFFFFF169C : 32D8                		move.w	(a0)+,(a1)+			; 6
(1)  252/FFFFFFFFFFFF169E : 32D8                		move.w	(a0)+,(a1)+			; 8
(1)  253/FFFFFFFFFFFF16A0 : 32FC 0000           		move.w	#0,(a1)+			; A <-- zero end
(1)  254/FFFFFFFFFFFF16A4 : 7001                		moveq	#$01,d0				; COMMAND: READ CD AND PASS DATA
(1)  255/FFFFFFFFFFFF16A6 : 61C0                		bsr	System_McdSubTask
(1)  256/FFFFFFFFFFFF16A8 :                     
(1)  257/FFFFFFFFFFFF16A8 : 41F9 FFFF 2000      		lea	(RAM_UserCode),a0
(1)  258/FFFFFFFFFFFF16AE : 303C 2000           		move.w	#(MAX_UserCode),d0
(1)  259/FFFFFFFFFFFF16B2 :                     
(1)  260/FFFFFFFFFFFF16B2 :                     	; a0 - Output location
(1)  261/FFFFFFFFFFFF16B2 :                     	; d0 - Number of $10-byte packets
(1)  262/FFFFFFFFFFFF16B2 : E848                		lsr.w	#4,d0				; size >> 4
(1)  263/FFFFFFFFFFFF16B4 : 5340                		subq.w	#1,d0				; -1
(1)  264/FFFFFFFFFFFF16B6 : 4DF9 00A1 2020      		lea	(sysmcd_reg+mcd_dcomm_s),a6
(1)  265/FFFFFFFFFFFF16BC : 1E39 00A1 200E      		move.b	(sysmcd_reg+mcd_comm_m).l,d7	; UNLOCK
(1)  266/FFFFFFFFFFFF16C2 : 08C7 0007           		bset	#7,d7
(1)  267/FFFFFFFFFFFF16C6 : 13C7 00A1 200E      		move.b	d7,(sysmcd_reg+mcd_comm_m).l
(1)  268/FFFFFFFFFFFF16CC : 1E39 00A1 200F      .copy_ram:	move.b	(sysmcd_reg+mcd_comm_s).l,d7	; Wait if sub PASSed the packet
(1)  269/FFFFFFFFFFFF16D2 : 0807 0006           		btst	#6,d7
(1)  270/FFFFFFFFFFFF16D6 : 67F4                		beq.s	.copy_ram
(1)  271/FFFFFFFFFFFF16D8 : 2A4E                		move.l	a6,a5
(1)  272/FFFFFFFFFFFF16DA : 30DD                		move.w	(a5)+,(a0)+
(1)  273/FFFFFFFFFFFF16DC : 30DD                		move.w	(a5)+,(a0)+
(1)  274/FFFFFFFFFFFF16DE : 30DD                		move.w	(a5)+,(a0)+
(1)  275/FFFFFFFFFFFF16E0 : 30DD                		move.w	(a5)+,(a0)+
(1)  276/FFFFFFFFFFFF16E2 : 30DD                		move.w	(a5)+,(a0)+
(1)  277/FFFFFFFFFFFF16E4 : 30DD                		move.w	(a5)+,(a0)+
(1)  278/FFFFFFFFFFFF16E6 : 30DD                		move.w	(a5)+,(a0)+
(1)  279/FFFFFFFFFFFF16E8 : 30DD                		move.w	(a5)+,(a0)+
(1)  280/FFFFFFFFFFFF16EA : 1E39 00A1 200E      		move.b	(sysmcd_reg+mcd_comm_m).l,d7	; Tell SUB we got the pack
(1)  281/FFFFFFFFFFFF16F0 : 08C7 0006           		bset	#6,d7
(1)  282/FFFFFFFFFFFF16F4 : 13C7 00A1 200E      		move.b	d7,(sysmcd_reg+mcd_comm_m).l
(1)  283/FFFFFFFFFFFF16FA : 1E39 00A1 200F      .wait_sub:	move.b	(sysmcd_reg+mcd_comm_s).l,d7	; Wait clear
(1)  284/FFFFFFFFFFFF1700 : 0807 0006           		btst	#6,d7
(1)  285/FFFFFFFFFFFF1704 : 66F4                		bne.s	.wait_sub
(1)  286/FFFFFFFFFFFF1706 : 1E39 00A1 200E      		move.b	(sysmcd_reg+mcd_comm_m).l,d7	; and clear our bit too.
(1)  287/FFFFFFFFFFFF170C : 0887 0006           		bclr	#6,d7
(1)  288/FFFFFFFFFFFF1710 : 13C7 00A1 200E      		move.b	d7,(sysmcd_reg+mcd_comm_m).l
(1)  289/FFFFFFFFFFFF1716 : 51C8 FFB4           		dbf	d0,.copy_ram
(1)  290/FFFFFFFFFFFF171A : 1E39 00A1 200E      		move.b	(sysmcd_reg+mcd_comm_m).l,d7	; UNLOCK
(1)  291/FFFFFFFFFFFF1720 : 0887 0007           		bclr	#7,d7
(1)  292/FFFFFFFFFFFF1724 : 13C7 00A1 200E      		move.b	d7,(sysmcd_reg+mcd_comm_m).l
(1)  293/FFFFFFFFFFFF172A :                     
(1)  294/FFFFFFFFFFFF172A : 4EF9 FFFF 2000      		jmp	(RAM_UserCode).l
(1)  295/FFFFFFFFFFFF1730 :                     ; 		move.l	#$C0000000,(vdp_ctrl).l
(1)  296/FFFFFFFFFFFF1730 :                     ; 		move.w	#$080,(vdp_data).l
(1)  297/FFFFFFFFFFFF1730 :                     ; 		bra.s	*
(1)  298/FFFFFFFFFFFF1730 :                     
(1)  314/FFFFFFFFFFFF1730 :                     
(1)  315/FFFFFFFFFFFF1730 :                     ; ====================================================================
(1)  316/FFFFFFFFFFFF1730 :                     ; ----------------------------------------------------------------
(1)  317/FFFFFFFFFFFF1730 :                     ; Subroutines
(1)  318/FFFFFFFFFFFF1730 :                     ; ----------------------------------------------------------------
(1)  319/FFFFFFFFFFFF1730 :                     
(1)  320/FFFFFFFFFFFF1730 :                     ; --------------------------------------------------------
(1)  321/FFFFFFFFFFFF1730 :                     ; System_Input
(1)  322/FFFFFFFFFFFF1730 :                     ;
(1)  323/FFFFFFFFFFFF1730 :                     ; Reads data from the Controller ports
(1)  324/FFFFFFFFFFFF1730 :                     ; *** CALL THIS ON VBLANK ONLY ***
(1)  325/FFFFFFFFFFFF1730 :                     ;
(1)  326/FFFFFFFFFFFF1730 :                     ; Uses:
(1)  327/FFFFFFFFFFFF1730 :                     ; d5-d7,a5-a6
(1)  328/FFFFFFFFFFFF1730 :                     ; --------------------------------------------------------
(1)  329/FFFFFFFFFFFF1730 :                     
(1)  330/FFFFFFFFFFFF1730 :                     System_Input:
(1)  331/FFFFFFFFFFFF1730 :                     ; 		move.w	#$0100,(z80_bus).l
(1)  332/FFFFFFFFFFFF1730 :                     .wait:
(1)  333/FFFFFFFFFFFF1730 :                     ; 		btst	#0,(z80_bus).l
(1)  334/FFFFFFFFFFFF1730 :                     ; 		bne.s	.wait
(1)  335/FFFFFFFFFFFF1730 : 4BF9 00A1 0003      		lea	(sys_data_1),a5		; a5 - BASE Genesis Input regs area
(1)  336/FFFFFFFFFFFF1736 : 4DF8 A000           		lea	(RAM_InputData),a6	; a6 - Output
(1)  337/FFFFFFFFFFFF173A : 6108                		bsr.s	.this_one
(1)  338/FFFFFFFFFFFF173C : DAFC 0002           		adda	#2,a5
(1)  339/FFFFFFFFFFFF1740 : DCFC 0010           		adda	#sizeof_input,a6
(1)  340/FFFFFFFFFFFF1744 :                     ; 		bsr.s	.this_one
(1)  341/FFFFFFFFFFFF1744 :                     ; ; 		move.w	#0,(z80_bus).l
(1)  342/FFFFFFFFFFFF1744 :                     ; 		rts
(1)  343/FFFFFFFFFFFF1744 :                     
(1)  344/FFFFFFFFFFFF1744 :                     ; --------------------------------------------------------
(1)  345/FFFFFFFFFFFF1744 :                     ; Read port
(1)  346/FFFFFFFFFFFF1744 :                     ;
(1)  347/FFFFFFFFFFFF1744 :                     ; a5 - Current port
(1)  348/FFFFFFFFFFFF1744 :                     ; a6 - Output data
(1)  349/FFFFFFFFFFFF1744 :                     ; --------------------------------------------------------
(1)  350/FFFFFFFFFFFF1744 :                     
(1)  351/FFFFFFFFFFFF1744 :                     .this_one:
(1)  352/FFFFFFFFFFFF1744 : 6100 0166           		bsr	.pick_id
(1)  353/FFFFFFFFFFFF1748 : 1C87                		move.b	d7,pad_id(a6)
(1)  354/FFFFFFFFFFFF174A : 0C47 000F           		cmpi.w	#$0F,d7
(1)  355/FFFFFFFFFFFF174E : 670E                		beq.s	.exit
(1)  356/FFFFFFFFFFFF1750 : 0247 000F           		andi.w	#$0F,d7
(1)  357/FFFFFFFFFFFF1754 : DE47                		add.w	d7,d7
(1)  358/FFFFFFFFFFFF1756 : 3C3B 700C           		move.w	.list(pc,d7.w),d6
(1)  359/FFFFFFFFFFFF175A : 4EFB 6008           		jmp	.list(pc,d6.w)
(1)  360/FFFFFFFFFFFF175E :                     .exit:
(1)  361/FFFFFFFFFFFF175E : 422E 0001           		clr.b	pad_ver(a6)
(1)  362/FFFFFFFFFFFF1762 : 4E75                		rts
(1)  363/FFFFFFFFFFFF1764 :                     
(1)  364/FFFFFFFFFFFF1764 :                     ; --------------------------------------------------------
(1)  365/FFFFFFFFFFFF1764 :                     ; Grab ID
(1)  366/FFFFFFFFFFFF1764 :                     ; --------------------------------------------------------
(1)  367/FFFFFFFFFFFF1764 :                     
(1)  368/FFFFFFFFFFFF1764 :                     .list:
(1)  369/FFFFFFFFFFFF1764 : FFFA                		dc.w .exit-.list	; $00
(1)  370/FFFFFFFFFFFF1766 : FFFA                		dc.w .exit-.list
(1)  371/FFFFFFFFFFFF1768 : FFFA                		dc.w .exit-.list
(1)  372/FFFFFFFFFFFF176A : 0020                		dc.w .id_03-.list	; $03 - Mega mouse
(1)  373/FFFFFFFFFFFF176C : FFFA                		dc.w .exit-.list	; $04
(1)  374/FFFFFFFFFFFF176E : FFFA                		dc.w .exit-.list
(1)  375/FFFFFFFFFFFF1770 : FFFA                		dc.w .exit-.list
(1)  376/FFFFFFFFFFFF1772 : FFFA                		dc.w .exit-.list
(1)  377/FFFFFFFFFFFF1774 : FFFA                		dc.w .exit-.list	; $08
(1)  378/FFFFFFFFFFFF1776 : FFFA                		dc.w .exit-.list
(1)  379/FFFFFFFFFFFF1778 : FFFA                		dc.w .exit-.list
(1)  380/FFFFFFFFFFFF177A : FFFA                		dc.w .exit-.list
(1)  381/FFFFFFFFFFFF177C : FFFA                		dc.w .exit-.list	; $0C
(1)  382/FFFFFFFFFFFF177E : 00CA                		dc.w .id_0D-.list	; $0D - Genesis controller (3 or 6 button)
(1)  383/FFFFFFFFFFFF1780 : FFFA                		dc.w .exit-.list
(1)  384/FFFFFFFFFFFF1782 : FFFA                		dc.w .exit-.list	; $0F - No controller OR Master System controller (2 Buttons: 1(B),2(C))
(1)  385/FFFFFFFFFFFF1784 :                     
(1)  386/FFFFFFFFFFFF1784 :                     ; --------------------------------------------------------
(1)  387/FFFFFFFFFFFF1784 :                     ; ID $03
(1)  388/FFFFFFFFFFFF1784 :                     ;
(1)  389/FFFFFFFFFFFF1784 :                     ; Mega Mouse
(1)  390/FFFFFFFFFFFF1784 :                     ; --------------------------------------------------------
(1)  391/FFFFFFFFFFFF1784 :                     
(1)  392/FFFFFFFFFFFF1784 :                     ; *** NOT TESTED ON HARDWARE ***
(1)  393/FFFFFFFFFFFF1784 :                     .id_03:
(1)  394/FFFFFFFFFFFF1784 : 1ABC 0020           		move.b	#$20,(a5)
(1)  395/FFFFFFFFFFFF1788 : 1B7C 0060 0006      		move.b	#$60,6(a5)
(1)  396/FFFFFFFFFFFF178E : 0815 0004           		btst	#4,(a5)
(1)  397/FFFFFFFFFFFF1792 : 6700 0094           		beq.w	.invalid
(1)  398/FFFFFFFFFFFF1796 : 1ABC 0000           		move.b	#$00,(a5)	; $0F
(1)  399/FFFFFFFFFFFF179A : 4E71                		nop
(1)  400/FFFFFFFFFFFF179C : 4E71                		nop
(1)  401/FFFFFFFFFFFF179E : 1ABC 0020           		move.b	#$20,(a5)	; $0F
(1)  402/FFFFFFFFFFFF17A2 : 4E71                		nop
(1)  403/FFFFFFFFFFFF17A4 : 4E71                		nop
(1)  404/FFFFFFFFFFFF17A6 : 1ABC 0000           		move.b	#$00,(a5)	; Yo | Xo | Ys | Xs
(1)  405/FFFFFFFFFFFF17AA : 4E71                		nop
(1)  406/FFFFFFFFFFFF17AC : 4E71                		nop
(1)  407/FFFFFFFFFFFF17AE : 1A15                		move.b	(a5),d5		; d5 - X/Y direction bits (Ys Xs)
(1)  408/FFFFFFFFFFFF17B0 : 1ABC 0020           		move.b	#$20,(a5)	; C | M | R | L
(1)  409/FFFFFFFFFFFF17B4 : 4E71                		nop
(1)  410/FFFFFFFFFFFF17B6 : 4E71                		nop
(1)  411/FFFFFFFFFFFF17B8 : 1E15                		move.b	(a5),d7
(1)  412/FFFFFFFFFFFF17BA : 0247 000F            		andi.w	#%1111,d7
(1)  413/FFFFFFFFFFFF17BE : 3C2E 0002           		move.w	on_hold(a6),d6
(1)  414/FFFFFFFFFFFF17C2 : BF46                		eor.w	d7,d6
(1)  415/FFFFFFFFFFFF17C4 : 3D47 0002           		move.w	d7,on_hold(a6)
(1)  416/FFFFFFFFFFFF17C8 : CC47                		and.w	d7,d6
(1)  417/FFFFFFFFFFFF17CA : 3D46 0004           		move.w	d6,on_press(a6)
(1)  418/FFFFFFFFFFFF17CE : 1ABC 0000           		move.b	#$00,(a5)	; X7 | X6 | X5 | X4
(1)  419/FFFFFFFFFFFF17D2 : 4E71                		nop
(1)  420/FFFFFFFFFFFF17D4 : 4E71                		nop
(1)  421/FFFFFFFFFFFF17D6 : 1E15                		move.b	(a5),d7
(1)  422/FFFFFFFFFFFF17D8 : 1ABC 0020           		move.b	#$20,(a5)	; X3 | X2 | X1 | X0
(1)  423/FFFFFFFFFFFF17DC : 0247 000F           		andi.w	#%1111,d7
(1)  424/FFFFFFFFFFFF17E0 : E94F                		lsl.w	#4,d7
(1)  425/FFFFFFFFFFFF17E2 : 4E71                		nop
(1)  426/FFFFFFFFFFFF17E4 : 1C15                		move.b	(a5),d6
(1)  427/FFFFFFFFFFFF17E6 : 0246 000F           		andi.w	#%1111,d6
(1)  428/FFFFFFFFFFFF17EA : 8E46                		or.w	d6,d7
(1)  429/FFFFFFFFFFFF17EC : 0805 0000           		btst    #0,d5
(1)  430/FFFFFFFFFFFF17F0 : 6704                		beq.s	.x_neg
(1)  431/FFFFFFFFFFFF17F2 : 4407                		neg.b	d7
(1)  432/FFFFFFFFFFFF17F4 : 4447                		neg.w	d7
(1)  433/FFFFFFFFFFFF17F6 :                     .x_neg:
(1)  434/FFFFFFFFFFFF17F6 : 3D47 0006           		move.w	d7,mouse_x(a6)
(1)  435/FFFFFFFFFFFF17FA : 1ABC 0000           		move.b	#$00,(a5)	; Y7 | Y6 | Y5 | Y4
(1)  436/FFFFFFFFFFFF17FE : 4E71                		nop
(1)  437/FFFFFFFFFFFF1800 : 4E71                		nop
(1)  438/FFFFFFFFFFFF1802 : 1E15                		move.b	(a5),d7
(1)  439/FFFFFFFFFFFF1804 : 1ABC 0020           		move.b	#$20,(a5)	; Y3 | Y2 | Y1 | Y0
(1)  440/FFFFFFFFFFFF1808 : 0247 000F           		andi.w	#%1111,d7
(1)  441/FFFFFFFFFFFF180C : E94F                		lsl.w	#4,d7
(1)  442/FFFFFFFFFFFF180E : 4E71                		nop
(1)  443/FFFFFFFFFFFF1810 : 1C15                		move.b	(a5),d6
(1)  444/FFFFFFFFFFFF1812 : 0246 000F           		andi.w	#%1111,d6
(1)  445/FFFFFFFFFFFF1816 : 8E46                		or.w	d6,d7
(1)  446/FFFFFFFFFFFF1818 : 0805 0001           		btst    #1,d5
(1)  447/FFFFFFFFFFFF181C : 6704                		beq.s	.y_neg
(1)  448/FFFFFFFFFFFF181E : 4407                		neg.b	d7
(1)  449/FFFFFFFFFFFF1820 : 4447                		neg.w	d7
(1)  450/FFFFFFFFFFFF1822 :                     .y_neg:
(1)  451/FFFFFFFFFFFF1822 : 4447                		neg.w	d7		; Reverse Y
(1)  452/FFFFFFFFFFFF1824 : 3D47 0008           		move.w	d7,mouse_y(a6)
(1)  453/FFFFFFFFFFFF1828 :                     
(1)  454/FFFFFFFFFFFF1828 :                     .invalid:
(1)  455/FFFFFFFFFFFF1828 : 1ABC 0060           		move.b	#$60,(a5)
(1)  456/FFFFFFFFFFFF182C : 4E75                		rts
(1)  457/FFFFFFFFFFFF182E :                     
(1)  458/FFFFFFFFFFFF182E :                     ; --------------------------------------------------------
(1)  459/FFFFFFFFFFFF182E :                     ; ID $0D
(1)  460/FFFFFFFFFFFF182E :                     ;
(1)  461/FFFFFFFFFFFF182E :                     ; Normal controller: 3 button or 6 button.
(1)  462/FFFFFFFFFFFF182E :                     ; --------------------------------------------------------
(1)  463/FFFFFFFFFFFF182E :                     
(1)  464/FFFFFFFFFFFF182E :                     .id_0D:
(1)  465/FFFFFFFFFFFF182E : 1ABC 0040           		move.b	#$40,(a5)	; Show CB|RLDU
(1)  466/FFFFFFFFFFFF1832 : 4E71                		nop
(1)  467/FFFFFFFFFFFF1834 : 4E71                		nop
(1)  468/FFFFFFFFFFFF1836 : 1A15                		move.b	(a5),d5
(1)  469/FFFFFFFFFFFF1838 : 0245 003F           		andi.w	#%00111111,d5
(1)  470/FFFFFFFFFFFF183C : 1ABC 0000           		move.b	#$00,(a5)	; Show SA|RLDU
(1)  471/FFFFFFFFFFFF1840 : 4E71                		nop
(1)  472/FFFFFFFFFFFF1842 : 4E71                		nop
(1)  473/FFFFFFFFFFFF1844 : 1E15                		move.b	(a5),d7		; The following flips are for
(1)  474/FFFFFFFFFFFF1846 : E54F                		lsl.w	#2,d7		; the 6pad's internal counter:
(1)  475/FFFFFFFFFFFF1848 : 0247 00C0           		andi.w	#%11000000,d7
(1)  476/FFFFFFFFFFFF184C : 8E45                		or.w	d5,d7
(1)  477/FFFFFFFFFFFF184E : 1ABC 0040           		move.b	#$40,(a5)	; Show CB|RLDU (2)
(1)  478/FFFFFFFFFFFF1852 : 4647                		not.w	d7
(1)  479/FFFFFFFFFFFF1854 : 1A2E 0003           		move.b	on_hold+1(a6),d5
(1)  480/FFFFFFFFFFFF1858 : BF05                		eor.b	d7,d5
(1)  481/FFFFFFFFFFFF185A : 1ABC 0000           		move.b	#$00,(a5)	; Show SA|RLDU (3)
(1)  482/FFFFFFFFFFFF185E : 1D47 0003           		move.b	d7,on_hold+1(a6)
(1)  483/FFFFFFFFFFFF1862 : CA07                		and.b	d7,d5
(1)  484/FFFFFFFFFFFF1864 : 1D45 0005           		move.b	d5,on_press+1(a6)
(1)  485/FFFFFFFFFFFF1868 : 1ABC 0040           		move.b	#$40,(a5)	; 6 button responds (4)
(1)  486/FFFFFFFFFFFF186C : 4E71                		nop
(1)  487/FFFFFFFFFFFF186E : 4E71                		nop
(1)  488/FFFFFFFFFFFF1870 : 1E15                		move.b	(a5),d7		; Grab ??|MXYZ
(1)  489/FFFFFFFFFFFF1872 : 1ABC 0000            		move.b	#$00,(a5)	; (5)
(1)  490/FFFFFFFFFFFF1876 : 4E71                  		nop
(1)  491/FFFFFFFFFFFF1878 : 4E71                  		nop
(1)  492/FFFFFFFFFFFF187A : 1C15                 		move.b	(a5),d6		; Type: $03 old, $0F new
(1)  493/FFFFFFFFFFFF187C : 1ABC 0040            		move.b	#$40,(a5)	; (6)
(1)  494/FFFFFFFFFFFF1880 : 4E71                 		nop
(1)  495/FFFFFFFFFFFF1882 : 4E71                 		nop
(1)  496/FFFFFFFFFFFF1884 : 0246 000F           		andi.w	#$F,d6
(1)  497/FFFFFFFFFFFF1888 : E44E                		lsr.w	#2,d6
(1)  498/FFFFFFFFFFFF188A : 0246 0001           		andi.w	#1,d6
(1)  499/FFFFFFFFFFFF188E : 6716                		beq.s	.oldpad
(1)  500/FFFFFFFFFFFF1890 : 4607                		not.b	d7
(1)  501/FFFFFFFFFFFF1892 : 0247 000F            		andi.w	#%1111,d7
(1)  502/FFFFFFFFFFFF1896 : 1A2E 0002           		move.b	on_hold(a6),d5
(1)  503/FFFFFFFFFFFF189A : BF05                		eor.b	d7,d5
(1)  504/FFFFFFFFFFFF189C : 1D47 0002           		move.b	d7,on_hold(a6)
(1)  505/FFFFFFFFFFFF18A0 : CA07                		and.b	d7,d5
(1)  506/FFFFFFFFFFFF18A2 : 1D45 0004           		move.b	d5,on_press(a6)
(1)  507/FFFFFFFFFFFF18A6 :                     .oldpad:
(1)  508/FFFFFFFFFFFF18A6 : 1D46 0001           		move.b	d6,pad_ver(a6)
(1)  509/FFFFFFFFFFFF18AA : 4E75                		rts
(1)  510/FFFFFFFFFFFF18AC :                     
(1)  511/FFFFFFFFFFFF18AC :                     ; --------------------------------------------------------
(1)  512/FFFFFFFFFFFF18AC :                     ; Grab ID
(1)  513/FFFFFFFFFFFF18AC :                     ; --------------------------------------------------------
(1)  514/FFFFFFFFFFFF18AC :                     
(1)  515/FFFFFFFFFFFF18AC :                     .pick_id:
(1)  516/FFFFFFFFFFFF18AC : 7E00                		moveq	#0,d7
(1)  517/FFFFFFFFFFFF18AE : 1ABC 0070           		move.b	#%01110000,(a5)		; TH=1,TR=1,TL=1
(1)  518/FFFFFFFFFFFF18B2 : 4E71                		nop
(1)  519/FFFFFFFFFFFF18B4 : 4E71                		nop
(1)  520/FFFFFFFFFFFF18B6 : 610A                		bsr	.read
(1)  521/FFFFFFFFFFFF18B8 : 1ABC 0030           		move.b	#%00110000,(a5)		; TH=0,TR=1,TL=1
(1)  522/FFFFFFFFFFFF18BC : 4E71                		nop
(1)  523/FFFFFFFFFFFF18BE : 4E71                		nop
(1)  524/FFFFFFFFFFFF18C0 : DE47                		add.w	d7,d7
(1)  525/FFFFFFFFFFFF18C2 :                     .read:
(1)  526/FFFFFFFFFFFF18C2 : 1A15                		move.b	(a5),d5
(1)  527/FFFFFFFFFFFF18C4 : 1C05                		move.b	d5,d6
(1)  528/FFFFFFFFFFFF18C6 : 0206 000C           		andi.b	#$C,d6
(1)  529/FFFFFFFFFFFF18CA : 6702                		beq.s	.step_1
(1)  530/FFFFFFFFFFFF18CC : 5247                		addq.w	#1,d7
(1)  531/FFFFFFFFFFFF18CE :                     .step_1:
(1)  532/FFFFFFFFFFFF18CE : DE47                		add.w	d7,d7
(1)  533/FFFFFFFFFFFF18D0 : 1C05                		move.b	d5,d6
(1)  534/FFFFFFFFFFFF18D2 : 0246 0003           		andi.w	#3,d6
(1)  535/FFFFFFFFFFFF18D6 : 6702                		beq.s	.step_2
(1)  536/FFFFFFFFFFFF18D8 : 5247                		addq.w	#1,d7
(1)  537/FFFFFFFFFFFF18DA :                     .step_2:
(1)  538/FFFFFFFFFFFF18DA : 4E75                		rts
(1)  539/FFFFFFFFFFFF18DC :                     
(1)  540/FFFFFFFFFFFF18DC :                     ; --------------------------------------------------------
(1)  541/FFFFFFFFFFFF18DC :                     ; System_Random
(1)  542/FFFFFFFFFFFF18DC :                     ; 
(1)  543/FFFFFFFFFFFF18DC :                     ; Makes a random number.
(1)  544/FFFFFFFFFFFF18DC :                     ; 
(1)  545/FFFFFFFFFFFF18DC :                     ; Input:
(1)  546/FFFFFFFFFFFF18DC :                     ; d0 | Seed
(1)  547/FFFFFFFFFFFF18DC :                     ;
(1)  548/FFFFFFFFFFFF18DC :                     ; Output:
(1)  549/FFFFFFFFFFFF18DC :                     ; d0 | LONG
(1)  550/FFFFFFFFFFFF18DC :                     ;
(1)  551/FFFFFFFFFFFF18DC :                     ; Uses:
(1)  552/FFFFFFFFFFFF18DC :                     ; d4-d5
(1)  553/FFFFFFFFFFFF18DC :                     ; --------------------------------------------------------
(1)  554/FFFFFFFFFFFF18DC :                     
(1)  555/FFFFFFFFFFFF18DC :                     System_Random:
(1)  556/FFFFFFFFFFFF18DC : 2F04                		move.l	d4,-(sp)
(1)  557/FFFFFFFFFFFF18DE : 2839 FFFF A444      		move.l	(RAM_SysRandSeed).l,d4
(1)  558/FFFFFFFFFFFF18E4 : 6606                		bne.s	.good_s
(1)  559/FFFFFFFFFFFF18E6 : 283C 23B5 1947      		move.l	#$23B51947,d4
(1)  560/FFFFFFFFFFFF18EC :                     .good_s:
(1)  561/FFFFFFFFFFFF18EC : 2004                		move.l	d4,d0
(1)  562/FFFFFFFFFFFF18EE : EB9C                		rol.l	#5,d4
(1)  563/FFFFFFFFFFFF18F0 : D880                		add.l	d0,d4
(1)  564/FFFFFFFFFFFF18F2 : E644                		asr.w	#3,d4
(1)  565/FFFFFFFFFFFF18F4 : D880                		add.l	d0,d4
(1)  566/FFFFFFFFFFFF18F6 : 3004                		move.w	d4,d0
(1)  567/FFFFFFFFFFFF18F8 : 4844                		swap	d4
(1)  568/FFFFFFFFFFFF18FA : D044                		add.w	d4,d0
(1)  569/FFFFFFFFFFFF18FC : 3800                		move.w	d0,d4
(1)  570/FFFFFFFFFFFF18FE : 4844                		swap	d4
(1)  571/FFFFFFFFFFFF1900 : 23C4 FFFF A444      		move.l	d4,(RAM_SysRandSeed).l
(1)  572/FFFFFFFFFFFF1906 : 281F                		move.l	(sp)+,d4
(1)  573/FFFFFFFFFFFF1908 : 4E75                		rts
(1)  574/FFFFFFFFFFFF190A :                     
(1)  575/FFFFFFFFFFFF190A :                     ; --------------------------------------------------------
(1)  576/FFFFFFFFFFFF190A :                     ; System_SineWave_Cos / System_SineWave
(1)  577/FFFFFFFFFFFF190A :                     ;
(1)  578/FFFFFFFFFFFF190A :                     ; Get sinewave value
(1)  579/FFFFFFFFFFFF190A :                     ;
(1)  580/FFFFFFFFFFFF190A :                     ; Input:
(1)  581/FFFFFFFFFFFF190A :                     ; d0 | WORD - Tan
(1)  582/FFFFFFFFFFFF190A :                     ; d1 | WORD - Multiply
(1)  583/FFFFFFFFFFFF190A :                     ;
(1)  584/FFFFFFFFFFFF190A :                     ; Output:
(1)  585/FFFFFFFFFFFF190A :                     ; d2 | LONG - Result (as 0000.0000)
(1)  586/FFFFFFFFFFFF190A :                     ; --------------------------------------------------------
(1)  587/FFFFFFFFFFFF190A :                     
(1)  588/FFFFFFFFFFFF190A :                     ; TODO: improve this.
(1)  589/FFFFFFFFFFFF190A :                     System_SineWave_Cos:
(1)  590/FFFFFFFFFFFF190A : 48A7 8000           		movem.w	d0,-(sp)
(1)  591/FFFFFFFFFFFF190E : 7400                		moveq	#0,d2
(1)  592/FFFFFFFFFFFF1910 : 0600 0040           		addi.b	#$40,d0
(1)  593/FFFFFFFFFFFF1914 : 1400                		move.b	d0,d2
(1)  594/FFFFFFFFFFFF1916 : E302                		asl.b	#1,d2
(1)  595/FFFFFFFFFFFF1918 : 343B 202E           		move.w	MdSys_SineData(pc,d2.w),d2
(1)  596/FFFFFFFFFFFF191C : C4C1                		mulu.w	d1,d2
(1)  597/FFFFFFFFFFFF191E : 8000                		or.b	d0,d0
(1)  598/FFFFFFFFFFFF1920 : 6A02                		bpl.s	.dont_neg
(1)  599/FFFFFFFFFFFF1922 : 4482                		neg.l	d2
(1)  600/FFFFFFFFFFFF1924 :                     .dont_neg:
(1)  601/FFFFFFFFFFFF1924 : 4C9F 0001           		movem.w	(sp)+,d0
(1)  602/FFFFFFFFFFFF1928 : 4E75                		rts
(1)  603/FFFFFFFFFFFF192A :                     
(1)  604/FFFFFFFFFFFF192A :                     System_SineWave:
(1)  605/FFFFFFFFFFFF192A : 48A7 8000           		movem.w	d0,-(sp)
(1)  606/FFFFFFFFFFFF192E : 0240 007F           		andi.w	#$7F,d0
(1)  607/FFFFFFFFFFFF1932 : E340                		asl.w	#1,d0
(1)  608/FFFFFFFFFFFF1934 : 343B 0012           		move.w	MdSys_SineData(pc,d0.w),d2
(1)  609/FFFFFFFFFFFF1938 : C4C1                		mulu.w	d1,d2
(1)  610/FFFFFFFFFFFF193A : 4C9F 0001           		movem.w	(sp)+,d0
(1)  611/FFFFFFFFFFFF193E : 5182                		subq.l	#8,d2
(1)  612/FFFFFFFFFFFF1940 : 8000                		or.b	d0,d0
(1)  613/FFFFFFFFFFFF1942 : 6A02                		bpl.s	.dont_neg
(1)  614/FFFFFFFFFFFF1944 : 4482                		neg.l	d2
(1)  615/FFFFFFFFFFFF1946 :                     .dont_neg:
(1)  616/FFFFFFFFFFFF1946 : 4E75                		rts
(1)  617/FFFFFFFFFFFF1948 :                     
(1)  618/FFFFFFFFFFFF1948 : 0000 0006 000D 0013 MdSys_SineData:	dc.w 0,	6, $D, $13, $19, $1F, $26, $2C,	$32, $38, $3E
                    0019 001F 0026 002C 
                    0032 0038 003E      
(1)  619/FFFFFFFFFFFF195E : 0044 004A 0050 0056 		dc.w $44, $4A, $50, $56, $5C, $62, $68,	$6D, $73, $79
                    005C 0062 0068 006D 
                    0073 0079           
(1)  620/FFFFFFFFFFFF1972 : 007E 0084 0089 008E 		dc.w $7E, $84, $89, $8E, $93, $98, $9D,	$A2, $A7, $AC
                    0093 0098 009D 00A2 
                    00A7 00AC           
(1)  621/FFFFFFFFFFFF1986 : 00B1 00B5 00B9 00BE 		dc.w $B1, $B5, $B9, $BE, $C2, $C6, $CA,	$CE, $D1, $D5
                    00C2 00C6 00CA 00CE 
                    00D1 00D5           
(1)  622/FFFFFFFFFFFF199A : 00D8 00DC 00DF 00E2 		dc.w $D8, $DC, $DF, $E2, $E5, $E7, $EA,	$ED, $EF, $F1
                    00E5 00E7 00EA 00ED 
                    00EF 00F1           
(1)  623/FFFFFFFFFFFF19AE : 00F3 00F5 00F7 00F8 		dc.w $F3, $F5, $F7, $F8, $FA, $FB, $FC,	$FD, $FE, $FF
                    00FA 00FB 00FC 00FD 
                    00FE 00FF           
(1)  624/FFFFFFFFFFFF19C2 : 00FF 0100 0100 0100 		dc.w $FF, $100,	$100, $100, $100, $100,	$FF, $FF, $FE
                    0100 0100 00FF 00FF 
                    00FE                
(1)  625/FFFFFFFFFFFF19D4 : 00FD 00FC 00FB 00FA 		dc.w $FD, $FC, $FB, $FA, $F8, $F7, $F5,	$F3, $F1, $EF
                    00F8 00F7 00F5 00F3 
                    00F1 00EF           
(1)  626/FFFFFFFFFFFF19E8 : 00ED 00EA 00E7 00E5 		dc.w $ED, $EA, $E7, $E5, $E2, $DF, $DC,	$D8, $D5, $D1
                    00E2 00DF 00DC 00D8 
                    00D5 00D1           
(1)  627/FFFFFFFFFFFF19FC : 00CE 00CA 00C6 00C2 		dc.w $CE, $CA, $C6, $C2, $BE, $B9, $B5,	$B1, $AC, $A7
                    00BE 00B9 00B5 00B1 
                    00AC 00A7           
(1)  628/FFFFFFFFFFFF1A10 : 00A2 009D 0098 0093 		dc.w $A2, $9D, $98, $93, $8E, $89, $84,	$7E, $79, $73
                    008E 0089 0084 007E 
                    0079 0073           
(1)  629/FFFFFFFFFFFF1A24 : 006D 0068 0062 005C 		dc.w $6D, $68, $62, $5C, $56, $50, $4A,	$44, $3E, $38
                    0056 0050 004A 0044 
                    003E 0038           
(1)  630/FFFFFFFFFFFF1A38 : 0032 002C 0026 001F 		dc.w $32, $2C, $26, $1F, $19, $13, $D, 6
                    0019 0013 000D 0006 
(1)  631/FFFFFFFFFFFF1A48 :                     
(1)  632/FFFFFFFFFFFF1A48 :                     ; --------------------------------------------------------
(1)  633/FFFFFFFFFFFF1A48 :                     ; System_SetInts
(1)  634/FFFFFFFFFFFF1A48 :                     ;
(1)  635/FFFFFFFFFFFF1A48 :                     ; Set new interrputs
(1)  636/FFFFFFFFFFFF1A48 :                     ;
(1)  637/FFFFFFFFFFFF1A48 :                     ; d0 | LONG - VBlank
(1)  638/FFFFFFFFFFFF1A48 :                     ; d1 | LONG - HBlank
(1)  639/FFFFFFFFFFFF1A48 :                     ;
(1)  640/FFFFFFFFFFFF1A48 :                     ; Uses:
(1)  641/FFFFFFFFFFFF1A48 :                     ; d4
(1)  642/FFFFFFFFFFFF1A48 :                     ;
(1)  643/FFFFFFFFFFFF1A48 :                     ; Notes:
(1)  644/FFFFFFFFFFFF1A48 :                     ; Writing 0 or a negative number will skip change
(1)  645/FFFFFFFFFFFF1A48 :                     ; to the interrupt pointer
(1)  646/FFFFFFFFFFFF1A48 :                     ; --------------------------------------------------------
(1)  647/FFFFFFFFFFFF1A48 :                     
(1)  648/FFFFFFFFFFFF1A48 :                     System_SetInts:
(1)  649/FFFFFFFFFFFF1A48 : 2800                		move.l	d0,d4
(1)  650/FFFFFFFFFFFF1A4A : 670E                		beq.s	.novint
(1)  651/FFFFFFFFFFFF1A4C : 6B0C                		bmi.s	.novint
(1)  652/FFFFFFFFFFFF1A4E : 88BC 0088 0000      		or.l	#$880000,d4
(1)  653/FFFFFFFFFFFF1A54 : 23C4 FFFF A44E       		move.l	d4,(RAM_MdMarsVInt+2).l
(1)  654/FFFFFFFFFFFF1A5A :                     .novint:
(1)  655/FFFFFFFFFFFF1A5A : 2801                		move.l	d1,d4
(1)  656/FFFFFFFFFFFF1A5C : 670E                		beq.s	.nohint
(1)  657/FFFFFFFFFFFF1A5E : 6B0C                		bmi.s	.nohint
(1)  658/FFFFFFFFFFFF1A60 : 88BC 0088 0000      		or.l	#$880000,d4
(1)  659/FFFFFFFFFFFF1A66 : 23C4 FFFF A454      		move.l	d4,(RAM_MdMarsHInt+2).l
(1)  660/FFFFFFFFFFFF1A6C :                     .nohint:
(1)  661/FFFFFFFFFFFF1A6C : 4E75                		rts
(1)  662/FFFFFFFFFFFF1A6E :                     
(1)  663/FFFFFFFFFFFF1A6E :                     ; --------------------------------------------------------
(1)  664/FFFFFFFFFFFF1A6E :                     ; System_SramInit
(1)  665/FFFFFFFFFFFF1A6E :                     ; 
(1)  666/FFFFFFFFFFFF1A6E :                     ; Init save data
(1)  667/FFFFFFFFFFFF1A6E :                     ; 
(1)  668/FFFFFFFFFFFF1A6E :                     ; Uses:
(1)  669/FFFFFFFFFFFF1A6E :                     ; a4,d4-d5
(1)  670/FFFFFFFFFFFF1A6E :                     ; --------------------------------------------------------
(1)  671/FFFFFFFFFFFF1A6E :                     
(1)  672/FFFFFFFFFFFF1A6E :                     ; TODO: Check if RV bit is needed here...
(1)  673/FFFFFFFFFFFF1A6E :                     System_SramInit:
(1)  674/FFFFFFFFFFFF1A6E : 13FC 0001 00A1 30F1 		move.b	#1,(md_bank_sram).l
(1)  675/FFFFFFFFFFFF1A76 : 49F9 0020 0001      		lea	($200001).l,a4
(1)  676/FFFFFFFFFFFF1A7C : 7800                		moveq	#0,d4
(1)  677/FFFFFFFFFFFF1A7E : 3A3C 1FFF           		move.w	#($4000/2)-1,d5
(1)  678/FFFFFFFFFFFF1A82 :                     .initsave:
(1)  679/FFFFFFFFFFFF1A82 : 1884                		move.b	d4,(a4)
(1)  680/FFFFFFFFFFFF1A84 : D8FC 0002           		adda	#2,a4
(1)  681/FFFFFFFFFFFF1A88 : 51CD FFF8           		dbf	d5,.initsave
(1)  682/FFFFFFFFFFFF1A8C : 13FC 0000 00A1 30F1 		move.b	#0,(md_bank_sram).l
(1)  683/FFFFFFFFFFFF1A94 : 4E75                		rts
(1)  684/FFFFFFFFFFFF1A96 :                     
(1)  685/FFFFFFFFFFFF1A96 :                     ; ====================================================================
(1)  686/FFFFFFFFFFFF1A96 :                     ; ----------------------------------------------------------------
(1)  687/FFFFFFFFFFFF1A96 :                     ; Screen mode subroutines
(1)  688/FFFFFFFFFFFF1A96 :                     ; ----------------------------------------------------------------
(1)  689/FFFFFFFFFFFF1A96 :                     
(1)  690/FFFFFFFFFFFF1A96 :                     ; --------------------------------------------------------
(1)  691/FFFFFFFFFFFF1A96 :                     ; Initialize current screen mode
(1)  692/FFFFFFFFFFFF1A96 :                     ; --------------------------------------------------------
(1)  693/FFFFFFFFFFFF1A96 :                     
(1)  694/FFFFFFFFFFFF1A96 :                     Mode_Init:
(1)  695/FFFFFFFFFFFF1A96 : 4EB9 FFFF 0286      		jsr	(Video_Clear).l
(1)  696/FFFFFFFFFFFF1A9C : 49F8 D800           		lea	(RAM_ScreenBuff),a4
(1)  697/FFFFFFFFFFFF1AA0 : 3A3C 0FFF           		move.w	#(MAX_ScrnBuff/2)-1,d5
(1)  698/FFFFFFFFFFFF1AA4 : 7800                		moveq	#0,d4
(1)  699/FFFFFFFFFFFF1AA6 :                     .clr:
(1)  700/FFFFFFFFFFFF1AA6 : 38C4                		move.w	d4,(a4)+
(1)  701/FFFFFFFFFFFF1AA8 : 51CD FFFC           		dbf	d5,.clr
(1)  702/FFFFFFFFFFFF1AAC :                     
(1)  703/FFFFFFFFFFFF1AAC : 49F8 AA98           		lea	(RAM_MdDreq+Dreq_Objects),a4	; Patch
(1)  704/FFFFFFFFFFFF1AB0 : 3A3C 000F           		move.w	#MAX_MODELS-1,d5
(1)  705/FFFFFFFFFFFF1AB4 :                     .clr_mdls:
(1)  706/FFFFFFFFFFFF1AB4 : 2884                		move.l	d4,mdl_data(a4)
(1)  707/FFFFFFFFFFFF1AB6 : D8FC 0018           		adda	#sizeof_mdlobj,a4
(1)  708/FFFFFFFFFFFF1ABA : 51CD FFF8           		dbf	d5,.clr_mdls
(1)  709/FFFFFFFFFFFF1ABE :                     
(1)  710/FFFFFFFFFFFF1ABE : 303C 0000           		move.w	#0,d0
(1)  711/FFFFFFFFFFFF1AC2 : 6000 F8E8           		bra	Video_Mars_GfxMode
(1)  712/FFFFFFFFFFFF1AC6 :                     
(1)  713/FFFFFFFFFFFF1AC6 :                     ; --------------------------------------------------------
(1)  714/FFFFFFFFFFFF1AC6 :                     
(1)  715/FFFFFFFFFFFF1AC6 :                     Mode_FadeOut:
(1)  716/FFFFFFFFFFFF1AC6 : 31FC 0002 999E      		move.w	#2,(RAM_FadeMdReq).w
(1)  717/FFFFFFFFFFFF1ACC : 31FC 0002 99A6      		move.w	#2,(RAM_FadeMarsReq).w
(1)  718/FFFFFFFFFFFF1AD2 : 31FC 0001 99A0      		move.w	#1,(RAM_FadeMdIncr).w
(1)  719/FFFFFFFFFFFF1AD8 : 31FC 0004 99A8      		move.w	#4,(RAM_FadeMarsIncr).w
(1)  720/FFFFFFFFFFFF1ADE : 31FC 0000 99A2      		move.w	#0,(RAM_FadeMdDelay).w
(1)  721/FFFFFFFFFFFF1AE4 : 31FC 0000 99AA      		move.w	#0,(RAM_FadeMarsDelay).w
(1)  722/FFFFFFFFFFFF1AEA :                     .loopw:
(1)  723/FFFFFFFFFFFF1AEA : 6100 FAB0           		bsr	System_WaitFrame
(1)  724/FFFFFFFFFFFF1AEE : 4EB9 FFFF 05D6      		jsr	(Video_RunFade).l
(1)  725/FFFFFFFFFFFF1AF4 : 66F4                		bne.s	.loopw
(1)  726/FFFFFFFFFFFF1AF6 : 4E75                		rts
(1)  727/FFFFFFFFFFFF1AF8 :                     
(1)  728/FFFFFFFFFFFF1AF8 :                     ; ====================================================================
(1)  729/FFFFFFFFFFFF1AF8 :                     ; ----------------------------------------------------------------
(1)  730/FFFFFFFFFFFF1AF8 :                     ; Default interrupts
(1)  731/FFFFFFFFFFFF1AF8 :                     ; ----------------------------------------------------------------
(1)  732/FFFFFFFFFFFF1AF8 :                     
(1)  733/FFFFFFFFFFFF1AF8 :                     ; --------------------------------------------------------
(1)  734/FFFFFFFFFFFF1AF8 :                     ; VBlank
(1)  735/FFFFFFFFFFFF1AF8 :                     ; --------------------------------------------------------
(1)  736/FFFFFFFFFFFF1AF8 :                     
(1)  737/FFFFFFFFFFFF1AF8 :                     VInt_Default:
(1)  738/FFFFFFFFFFFF1AF8 : 48E7 FFFE           		movem.l	d0-a6,-(sp)
(1)  739/FFFFFFFFFFFF1AFC : 6100 FC32           		bsr	System_Input
(1)  740/FFFFFFFFFFFF1B00 : 06B9 0000 0001 FFFF 		addi.l	#1,(RAM_FrameCount).l
                    8740                
(1)  741/FFFFFFFFFFFF1B0A : 4CDF 7FFF           		movem.l	(sp)+,d0-a6		
(1)  742/FFFFFFFFFFFF1B0E : 4E73                		rte
(1)  743/FFFFFFFFFFFF1B10 :                     
(1)  744/FFFFFFFFFFFF1B10 :                     ; --------------------------------------------------------
(1)  745/FFFFFFFFFFFF1B10 :                     ; HBlank
(1)  746/FFFFFFFFFFFF1B10 :                     ; --------------------------------------------------------
(1)  747/FFFFFFFFFFFF1B10 :                     
(1)  748/FFFFFFFFFFFF1B10 :                     HInt_Default:
(1)  749/FFFFFFFFFFFF1B10 : 4E73                		rte
(1)  750/FFFFFFFFFFFF1B12 :                     
(1)  751/FFFFFFFFFFFF1B12 :                     ; ====================================================================
(1)  752/FFFFFFFFFFFF1B12 :                     ; ----------------------------------------------------------------
(1)  753/FFFFFFFFFFFF1B12 :                     ; System data
(1)  754/FFFFFFFFFFFF1B12 :                     ; ----------------------------------------------------------------
(1)  755/FFFFFFFFFFFF1B12 :                     
     154/FFFFFFFFFFFF1B12 :                     		include "system/md/sub_dreq.asm"	; Will fail on hardware anyway.
(1)    1/FFFFFFFFFFFF1B12 :                     ; ====================================================================
(1)    2/FFFFFFFFFFFF1B12 :                     ; ----------------------------------------------------------------
(1)    3/FFFFFFFFFFFF1B12 :                     ; DREQ transfer section at $880000
(1)    4/FFFFFFFFFFFF1B12 :                     ; ----------------------------------------------------------------
(1)    5/FFFFFFFFFFFF1B12 :                     
(1)    6/FFFFFFFFFFFF1B12 :                     ; --------------------------------------------------------
(1)    7/FFFFFFFFFFFF1B12 :                     ; System_MarsSendDreq
(1)    8/FFFFFFFFFFFF1B12 :                     ;
(1)    9/FFFFFFFFFFFF1B12 :                     ; Transfers data to the 32X using DREQ
(1)   10/FFFFFFFFFFFF1B12 :                     ;
(1)   11/FFFFFFFFFFFF1B12 :                     ; Input:
(1)   12/FFFFFFFFFFFF1B12 :                     ; a0 - LONG | Source data to transfer
(1)   13/FFFFFFFFFFFF1B12 :                     ; d0 - WORD | Size aligned by 8, MUST end with 0 or 8.
(1)   14/FFFFFFFFFFFF1B12 :                     ;
(1)   15/FFFFFFFFFFFF1B12 :                     ; Uses:
(1)   16/FFFFFFFFFFFF1B12 :                     ; a4-a5/d5-d7
(1)   17/FFFFFFFFFFFF1B12 :                     ;
(1)   18/FFFFFFFFFFFF1B12 :                     ; Notes:
(1)   19/FFFFFFFFFFFF1B12 :                     ; Only call this during DISPLAY, not during VBlank.
(1)   20/FFFFFFFFFFFF1B12 :                     ;
(1)   21/FFFFFFFFFFFF1B12 :                     ; ** Hardware NOTE **
(1)   22/FFFFFFFFFFFF1B12 :                     ; THIS CODE ONLY WORKS PROPERLY ON THE $880000/$900000
(1)   23/FFFFFFFFFFFF1B12 :                     ; AREAS.
(1)   24/FFFFFFFFFFFF1B12 :                     ; Emulators ignore this limitation.
(1)   25/FFFFFFFFFFFF1B12 :                     ; --------------------------------------------------------
(1)   26/FFFFFFFFFFFF1B12 :                     
(1)   27/FFFFFFFFFFFF1B12 :                     System_RomSendDreq:
(1)   28/FFFFFFFFFFFF1B12 : 40C7                		move.w	sr,d7
(1)   29/FFFFFFFFFFFF1B14 : 46FC 2700           		move.w	#$2700,sr
(1)   30/FFFFFFFFFFFF1B18 : 4BF9 00A1 5100      		lea	(sysmars_reg).l,a5
(1)   31/FFFFFFFFFFFF1B1E : 49ED 0012           		lea	dreqfifo(a5),a4
(1)   32/FFFFFFFFFFFF1B22 :                     ; 		btst	#7,comm12(a5)
(1)   33/FFFFFFFFFFFF1B22 :                     ; 		bne.s	.bad
(1)   34/FFFFFFFFFFFF1B22 :                     ; 		btst	#7,dreqctl+1(a5)	; If FIFO got full, skip.
(1)   35/FFFFFFFFFFFF1B22 :                     ; 		bne.s	.bad
(1)   36/FFFFFFFFFFFF1B22 : 3B7C 0000 0006      		move.w	#%000,dreqctl(a5)	; Reset 68S
(1)   37/FFFFFFFFFFFF1B28 : 3C00                		move.w	d0,d6			; d6 - Size in bytes
(1)   38/FFFFFFFFFFFF1B2A : E24E                		lsr.w	#1,d6			; (length/2)
(1)   39/FFFFFFFFFFFF1B2C : 3B46 0010           		move.w	d6,dreqlen(a5)		; Set transfer length (size/2)
(1)   40/FFFFFFFFFFFF1B30 : 3A06                		move.w	d6,d5			; d5 - (length/2)/4
(1)   41/FFFFFFFFFFFF1B32 : E44D                		lsr.w	#2,d5
(1)   42/FFFFFFFFFFFF1B34 : 0445 0001           		subi.w	#1,d5
(1)   43/FFFFFFFFFFFF1B38 : 08ED 0000 0003      		bset	#0,standby(a5)		; Set CMD interrupt to MASTER
(1)   44/FFFFFFFFFFFF1B3E : 082D 0006 002C      .wait_bit:	btst	#6,comm12(a5)		; Wait signal bit from Master
(1)   45/FFFFFFFFFFFF1B44 : 67F8                		beq.s	.wait_bit
(1)   46/FFFFFFFFFFFF1B46 : 08AD 0006 002C      		bclr	#6,comm12(a5)		; Clear it for later.
(1)   47/FFFFFFFFFFFF1B4C : 3B7C 0004 0006      		move.w	#%100,dreqctl(a5)	; Set 68S
(1)   48/FFFFFFFFFFFF1B52 : 3898                .l0:		move.w  (a0)+,(a4)		; *** CRITICAL PART ***
(1)   49/FFFFFFFFFFFF1B54 : 3898                		move.w  (a0)+,(a4)
(1)   50/FFFFFFFFFFFF1B56 : 3898                		move.w  (a0)+,(a4)
(1)   51/FFFFFFFFFFFF1B58 : 3898                		move.w  (a0)+,(a4)
(1)   52/FFFFFFFFFFFF1B5A : 51CD FFF6           		dbf	d5,.l0
(1)   53/FFFFFFFFFFFF1B5E : 3B7C 0000 0006      		move.w	#%000,dreqctl(a5)	; Clear 68S on exit
(1)   54/FFFFFFFFFFFF1B64 : 46C7                		move.w	d7,sr
(1)   55/FFFFFFFFFFFF1B66 : 4E75                		rts
(1)   56/FFFFFFFFFFFF1B68 :                     
     156/FFFFFFFFFFFF1B68 :                     ; ---------------------------------------------
     158/FFFFFFFFFFFF1B68 :                     .end:
     159/FFFFFFFFFFFF1B68 : (MACRO)             		report "RAM TOP-CODE SUBS",(.end-RAM_SystemCode),MAX_SysCode
     160/    57C2 :                     		dephase
     162/    57C2 :                     Md_SysCode_e:
     163/    57C2 :                     		align 2
     164/    57C2 :                     
     165/    57C2 :                     ; ---------------------------------------------
     166/    57C2 :                     ; JUMP code for switching screen modes
     167/    57C2 :                     ; ---------------------------------------------
     168/    57C2 :                     
     169/    57C2 :                     Md_JumpCode:
     171/FFFFFFFFFFFFFE00 :                     		phase RAM_ScreenJump
     172/FFFFFFFFFFFFFE00 :                     mdjumpcode_s:
     174/FFFFFFFFFFFFFE00 :                     ; ---------------------------------------------
     175/FFFFFFFFFFFFFE00 :                     
     176/FFFFFFFFFFFFFE00 :                     Md_ReadModes:
     177/FFFFFFFFFFFFFE00 : 7000                		moveq	#0,d0
     178/FFFFFFFFFFFFFE02 : 3038 C800           		move.w	(RAM_Glbl_Scrn).w,d0
     179/FFFFFFFFFFFFFE06 : C07C 000F           		and.w	#%1111,d0		; <-- current limit
     181/FFFFFFFFFFFFFE0A : E948                		lsl.w	#4,d0			; * 8
     182/FFFFFFFFFFFFFE0C : 41FA 000A           		lea	.pick_boot(pc),a0
     183/FFFFFFFFFFFFFE10 : 4EB9 FFFF 1690      		jsr	(System_GrabRamCode).l
     194/FFFFFFFFFFFFFE16 : 60E8                		bra.s	Md_ReadModes
     195/FFFFFFFFFFFFFE18 :                     
     196/FFFFFFFFFFFFFE18 :                     .pick_boot:
     197/FFFFFFFFFFFFFE18 :                     	; size $10
     199/FFFFFFFFFFFFFE18 : 5343 5245 454E 3030 		dc.b "SCREEN00.BIN"
                    2E42 494E           
     200/FFFFFFFFFFFFFE24 : 0000 0000           		dc.l 0
     201/FFFFFFFFFFFFFE28 : 5343 5245 454E 3030 		dc.b "SCREEN00.BIN"
                    2E42 494E           
     202/FFFFFFFFFFFFFE34 : 0000 0000           		dc.l 0
     203/FFFFFFFFFFFFFE38 : 5343 5245 454E 3030 		dc.b "SCREEN00.BIN"
                    2E42 494E           
     204/FFFFFFFFFFFFFE44 : 0000 0000           		dc.l 0
     205/FFFFFFFFFFFFFE48 : 5343 5245 454E 3030 		dc.b "SCREEN00.BIN"
                    2E42 494E           
     206/FFFFFFFFFFFFFE54 : 0000 0000           		dc.l 0
     207/FFFFFFFFFFFFFE58 :                     	; size 4
     214/FFFFFFFFFFFFFE58 :                     
     215/FFFFFFFFFFFFFE58 :                     ; ---------------------------------------------
     217/FFFFFFFFFFFFFE58 :                     mdjumpcode_e:
     218/FFFFFFFFFFFFFE58 : (MACRO)             		report "RAM JUMP-CODE SUBS",(mdjumpcode_e-mdjumpcode_s),$180
     219/    581A :                     		dephase
     221/    581A :                     Md_JumpCode_e:
     222/    581A :                     		align 2
     223/    581A :                     
     224/    581A :                     ; ===========================================================================
     225/    581A :                     ; ----------------------------------------------------------------
     226/    581A :                     ; SEGA CD ONLY
     227/    581A :                     ;
     228/    581A :                     ; ISO file
     229/    581A :                     ; ----------------------------------------------------------------
     230/    581A :                     
     232/    581A :                     
     233/    581A :                     ; --------------------------------------------------------
     234/    581A :                     
     235/    581A :                     		align $8000
     236/    8000 :                     		binclude "system/mcd/fshead.bin"
     237/    B800 : (MACRO)             IsoFsSector:	iso_setfs 0,IsoFileList,IsoFileList_e	; Two copies of this
     237/    B800 : 22                  .fstrt:         dc.b .fend-.fstrt                               ; Block size
     237/    B801 : 00                                  dc.b 0                                          ; zero
     237/    B802 : 1700                                dc.b (ISOFILELIST>>11&$FF),(ISOFILELIST>>19&$FF)            ; ISOFILELIST sector, little
     237/    B804 : 0000                                dc.b (ISOFILELIST>>27&$FF),(ISOFILELIST>>35&$FF)
     237/    B806 : 0000 0017                           dc.l ISOFILELIST>>11                                  ; ISOFILELIST sector, big
     237/    B80A : DE07                                dc.b ((ISOFILELIST_E-ISOFILELIST)&$FF),((ISOFILELIST_E-ISOFILELIST)>>8&$FF)     ; Filesize, little
     237/    B80C : 0000                                dc.b ((ISOFILELIST_E-ISOFILELIST)>>16&$FF),((ISOFILELIST_E-ISOFILELIST)>>24&$FF)
     237/    B80E : 0000 07DE                           dc.l ISOFILELIST_E-ISOFILELIST                                  ; Filesize, big
     237/    B812 : 77                                  dc.b (2018-1900)+1                              ; Year
     237/    B813 : 0000 0000 0000                      dc.b 0,0,0,0,0,0                                ; TODO
     237/    B819 : 02                                  dc.b 2                                          ; File flags
     237/    B81A : 0000                                dc.b 0,0
     237/    B81C : 0100                                dc.b 1,0                                        ; Volume sequence number, little
     237/    B81E : 0001                                dc.b 0,1                                        ; Volume sequence number, big
     237/    B820 : 0100                                dc.b 1,0
     237/    B822 :                     .fend:
     238/    B822 :                     ; 		iso_setfs 1,IsoFileList,IsoFileList_e
     239/    B822 :                     IsoFileList:
     240/    B822 : (MACRO)             		iso_file "SCREEN00.BIN",SAT_Main,SAT_Main_e
     240/    B822 : 30                  .fstrt:         dc.b .fend-.fstrt                               ; Block size
     240/    B823 : 00                                  dc.b 0                                          ; zero
     240/    B824 : 1800                                dc.b (SAT_MAIN>>11&$FF),(SAT_MAIN>>19&$FF)            ; SAT_MAIN sector, little
     240/    B826 : 0000                                dc.b (SAT_MAIN>>27&$FF),(SAT_MAIN>>35&$FF)
     240/    B828 : 0000 0018                           dc.l SAT_MAIN>>11                                  ; SAT_MAIN sector, big
     240/    B82C : 0008                                dc.b ((SAT_MAIN_E-SAT_MAIN)&$FF),((SAT_MAIN_E-SAT_MAIN)>>8&$FF)     ; Filesize, little
     240/    B82E : 0000                                dc.b ((SAT_MAIN_E-SAT_MAIN)>>16&$FF),((SAT_MAIN_E-SAT_MAIN)>>24&$FF)
     240/    B830 : 0000 0800                           dc.l SAT_MAIN_E-SAT_MAIN                                  ; Filesize, big
     240/    B834 : 7C                                  dc.b (2023-1900)+1                              ; Year
     240/    B835 : 0000 0000 0000                      dc.b 0,0,0,0,0,0                                ; TODO
     240/    B83B : 00                                  dc.b 0                                          ; File flags
     240/    B83C : 0000                                dc.b 0,0
     240/    B83E : 0100                                dc.b 1,0                                        ; Volume sequence number, little
     240/    B840 : 0001                                dc.b 0,1                                        ; Volume sequence number, big
     240/    B842 : 0E                                  dc.b .flend-.flen
     240/    B843 : 5343 5245 454E 3030 .flen:          dc.b "SCREEN00.BIN",";1"
                    2E42 494E 3B31      
     240/    B851 : 00                  .flend:         dc.b 0
     240/    B852 :                     .fend:
     241/    B852 : (MACRO)             		iso_file "WORDDATA.BIN",GFXDMA_WRAM,GFXDMA_WRAM_e
     241/    B852 : 30                  .fstrt:         dc.b .fend-.fstrt                               ; Block size
     241/    B853 : 00                                  dc.b 0                                          ; zero
     241/    B854 : 1900                                dc.b (GFXDMA_WRAM>>11&$FF),(GFXDMA_WRAM>>19&$FF)            ; GFXDMA_WRAM sector, little
     241/    B856 : 0000                                dc.b (GFXDMA_WRAM>>27&$FF),(GFXDMA_WRAM>>35&$FF)
     241/    B858 : 0000 0019                           dc.l GFXDMA_WRAM>>11                                  ; GFXDMA_WRAM sector, big
     241/    B85C : 0018                                dc.b ((GFXDMA_WRAM_E-GFXDMA_WRAM)&$FF),((GFXDMA_WRAM_E-GFXDMA_WRAM)>>8&$FF)     ; Filesize, little
     241/    B85E : 0100                                dc.b ((GFXDMA_WRAM_E-GFXDMA_WRAM)>>16&$FF),((GFXDMA_WRAM_E-GFXDMA_WRAM)>>24&$FF)
     241/    B860 : 0001 1800                           dc.l GFXDMA_WRAM_E-GFXDMA_WRAM                                  ; Filesize, big
     241/    B864 : 7C                                  dc.b (2023-1900)+1                              ; Year
     241/    B865 : 0000 0000 0000                      dc.b 0,0,0,0,0,0                                ; TODO
     241/    B86B : 00                                  dc.b 0                                          ; File flags
     241/    B86C : 0000                                dc.b 0,0
     241/    B86E : 0100                                dc.b 1,0                                        ; Volume sequence number, little
     241/    B870 : 0001                                dc.b 0,1                                        ; Volume sequence number, big
     241/    B872 : 0E                                  dc.b .flend-.flen
     241/    B873 : 574F 5244 4441 5441 .flen:          dc.b "WORDDATA.BIN",";1"
                    2E42 494E 3B31      
     241/    B881 : 00                  .flend:         dc.b 0
     241/    B882 :                     .fend:
     242/    B882 : (MACRO)             		iso_file "MARSCODE.BIN",CD32_Start,CD32_End
     242/    B882 : 30                  .fstrt:         dc.b .fend-.fstrt                               ; Block size
     242/    B883 : 00                                  dc.b 0                                          ; zero
     242/    B884 : 3C00                                dc.b (CD32_START>>11&$FF),(CD32_START>>19&$FF)            ; CD32_START sector, little
     242/    B886 : 0000                                dc.b (CD32_START>>27&$FF),(CD32_START>>35&$FF)
     242/    B888 : 0000 003C                           dc.l CD32_START>>11                                  ; CD32_START sector, big
     242/    B88C : 0050                                dc.b ((CD32_END-CD32_START)&$FF),((CD32_END-CD32_START)>>8&$FF)     ; Filesize, little
     242/    B88E : 0100                                dc.b ((CD32_END-CD32_START)>>16&$FF),((CD32_END-CD32_START)>>24&$FF)
     242/    B890 : 0001 5000                           dc.l CD32_END-CD32_START                                  ; Filesize, big
     242/    B894 : 7C                                  dc.b (2023-1900)+1                              ; Year
     242/    B895 : 0000 0000 0000                      dc.b 0,0,0,0,0,0                                ; TODO
     242/    B89B : 00                                  dc.b 0                                          ; File flags
     242/    B89C : 0000                                dc.b 0,0
     242/    B89E : 0100                                dc.b 1,0                                        ; Volume sequence number, little
     242/    B8A0 : 0001                                dc.b 0,1                                        ; Volume sequence number, big
     242/    B8A2 : 0E                                  dc.b .flend-.flen
     242/    B8A3 : 4D41 5253 434F 4445 .flen:          dc.b "MARSCODE.BIN",";1"
                    2E42 494E 3B31      
     242/    B8B1 : 00                  .flend:         dc.b 0
     242/    B8B2 :                     .fend:
     243/    B8B2 :                     		align $800
     244/    C000 :                     IsoFileList_e:
     245/    C000 :                     
     246/    C000 :                     ; ----------------------------------------------------------------
     247/    C000 :                     ; Files
     248/    C000 :                     ; ----------------------------------------------------------------
     249/    C000 :                     
     250/    C000 :                     ; --------------------------------------------------------
     251/    C000 :                     ; Screen modes
     252/    C000 :                     ; --------------------------------------------------------
     253/    C000 :                     
     254/    C000 :                     		align $800
     255/    C000 :                     SAT_Main:
     256/FFFFFFFFFFFF2000 :                     		phase RAM_UserCode
     257/FFFFFFFFFFFF2000 :                     		include "game/screen_0.asm"
(1)    1/FFFFFFFFFFFF2000 :                     ; ====================================================================
(1)    2/FFFFFFFFFFFF2000 :                     ; ----------------------------------------------------------------
(1)    3/FFFFFFFFFFFF2000 :                     ; 2D Part
(1)    4/FFFFFFFFFFFF2000 :                     ; ----------------------------------------------------------------
(1)    5/FFFFFFFFFFFF2000 :                     
(1)    6/FFFFFFFFFFFF2000 :                     ; ====================================================================
(1)    7/FFFFFFFFFFFF2000 :                     ; ------------------------------------------------------
(1)    8/FFFFFFFFFFFF2000 :                     ; Settings
(1)    9/FFFFFFFFFFFF2000 :                     ; ------------------------------------------------------
(1)   10/FFFFFFFFFFFF2000 :                     
(1)   11/FFFFFFFFFFFF2000 : =$4                 TEST_MAINSPD	equ $04
(1)   12/FFFFFFFFFFFF2000 :                     
(1)   13/FFFFFFFFFFFF2000 :                     ; ====================================================================
(1)   14/FFFFFFFFFFFF2000 :                     ; ------------------------------------------------------
(1)   15/FFFFFFFFFFFF2000 :                     ; Structs
(1)   16/FFFFFFFFFFFF2000 :                     ; ------------------------------------------------------
(1)   17/FFFFFFFFFFFF2000 :                     
(1)   18/FFFFFFFFFFFF2000 :                     ; 		struct 0
(1)   19/FFFFFFFFFFFF2000 :                     ; strc_xpos	ds.w 1
(1)   20/FFFFFFFFFFFF2000 :                     ; strc_ypos	ds.w 1
(1)   21/FFFFFFFFFFFF2000 :                     ; 		endstruct
(1)   22/FFFFFFFFFFFF2000 :                     
(1)   23/FFFFFFFFFFFF2000 :                     ; ====================================================================
(1)   24/FFFFFFFFFFFF2000 :                     ; ------------------------------------------------------
(1)   25/FFFFFFFFFFFF2000 :                     ; This screen's RAM
(1)   26/FFFFFFFFFFFF2000 :                     ; ------------------------------------------------------
(1)   27/FFFFFFFFFFFF2000 :                     
(1)   28/FFFFFFFFFFFF2000 : (MACRO)             		struct RAM_ScreenBuff
(1)   28/FFFFFFFFFFFF2000 : =$FFFFFFFFFF..      GLBL_LASTPC     set *
(1)   28/    C000 :                                     dephase
(1)   28/    C000 : =$C000              GLBL_LASTORG    set *
(1)   28/FFFFFFFFFFFFD800 :                                     phase RAM_SCREENBUFF
(1)   29/FFFFFFFFFFFFD800 :                     RAM_MapX	ds.w 1
(1)   30/FFFFFFFFFFFFD802 :                     RAM_MapY	ds.w 1
(1)   31/FFFFFFFFFFFFD804 : (MACRO)             		endstruct
(1)   31/FFFFFFFFFFFFD800 :                                     !org GLBL_LASTORG
(1)   31/FFFFFFFFFFFF2000 :                                     phase GLBL_LASTPC
(1)   32/FFFFFFFFFFFF2000 :                     
(1)   33/FFFFFFFFFFFF2000 :                     ; ====================================================================
(1)   34/FFFFFFFFFFFF2000 :                     ; ------------------------------------------------------
(1)   35/FFFFFFFFFFFF2000 :                     ; Code start
(1)   36/FFFFFFFFFFFF2000 :                     ; ------------------------------------------------------
(1)   37/FFFFFFFFFFFF2000 :                     
(1)   38/FFFFFFFFFFFF2000 : 46FC 2700           		move.w	#$2700,sr
(1)   39/FFFFFFFFFFFF2004 : 08B9 0006 FFFF 99AF 		bclr	#bitDispEnbl,(RAM_VdpRegs+1).l
(1)   40/FFFFFFFFFFFF200C : 6100 E224           		bsr	Video_Update
(1)   41/FFFFFFFFFFFF2010 : 6100 E3C4           		bsr	Video_PrintInit
(1)   42/FFFFFFFFFFFF2014 : 6100 FA80           		bsr	Mode_Init
(1)   43/FFFFFFFFFFFF2018 :                     
(1)   44/FFFFFFFFFFFF2018 : 6100 E1BE           		bsr	gemaStopAll
(1)   45/FFFFFFFFFFFF201C :                     
(1)   46/FFFFFFFFFFFF201C : 41F8 9514           		lea	(RAM_PaletteFd+$60),a0
(1)   47/FFFFFFFFFFFF2020 : 30FC 0000           		move.w	#0,(a0)+
(1)   48/FFFFFFFFFFFF2024 : 30FC 0EEE           		move.w	#$EEE,(a0)+
(1)   49/FFFFFFFFFFFF2028 : 30FC 0CCC           		move.w	#$CCC,(a0)+
(1)   50/FFFFFFFFFFFF202C : 30FC 0AAA           		move.w	#$AAA,(a0)+
(1)   51/FFFFFFFFFFFF2030 : 30FC 0888           		move.w	#$888,(a0)+
(1)   52/FFFFFFFFFFFF2034 : 30FC 0222           		move.w	#$222,(a0)+
(1)   53/FFFFFFFFFFFF2038 : 4278 94B4           		clr.w	(RAM_PaletteFd).w		; <-- quick patch
(1)   54/FFFFFFFFFFFF203C : 4278 9534           		clr.w	(RAM_MdMarsPalFd).w
(1)   55/FFFFFFFFFFFF2040 : 41F9 0020 4800      		lea	(PalMars_TEST),a0
(1)   56/FFFFFFFFFFFF2046 : 7000                		moveq	#0,d0
(1)   57/FFFFFFFFFFFF2048 : 323C 0100           		move.w	#256,d1
(1)   58/FFFFFFFFFFFF204C : 7400                		moveq	#0,d2
(1)   59/FFFFFFFFFFFF204E : 6100 F360           		bsr	Video_FadePal_Mars
(1)   60/FFFFFFFFFFFF2052 :                     
(1)   61/FFFFFFFFFFFF2052 : 41FA 00BE           		lea	str_Stats(pc),a0
(1)   62/FFFFFFFFFFFF2056 : 203C 0000 0101      		move.l	#locate(0,1,1),d0
(1)   63/FFFFFFFFFFFF205C : 6100 E3A4           		bsr	Video_Print
(1)   64/FFFFFFFFFFFF2060 :                     
(1)   65/FFFFFFFFFFFF2060 :                     
(1)   66/FFFFFFFFFFFF2060 :                     ; 	Set Fade-in settings
(1)   67/FFFFFFFFFFFF2060 :                     
(1)   68/FFFFFFFFFFFF2060 :                     
(1)   69/FFFFFFFFFFFF2060 : 08F9 0006 FFFF 99AF 		bset	#bitDispEnbl,(RAM_VdpRegs+1).l
(1)   70/FFFFFFFFFFFF2068 : 11FC 0081 99BA      		move.b	#%10000001,(RAM_VdpRegs+$C).w		; H40 + shadow mode
(1)   71/FFFFFFFFFFFF206E : 6100 E1C2           		bsr	Video_Update
(1)   72/FFFFFFFFFFFF2072 :                     ; 		bsr	.fade_in
(1)   73/FFFFFFFFFFFF2072 :                     
(1)   74/FFFFFFFFFFFF2072 : 31FC 0001 99A0      		move.w	#1,(RAM_FadeMdIncr).w
(1)   75/FFFFFFFFFFFF2078 : 31FC 0002 99A8      		move.w	#2,(RAM_FadeMarsIncr).w
(1)   76/FFFFFFFFFFFF207E : 31FC 0001 99A2      		move.w	#1,(RAM_FadeMdDelay).w
(1)   77/FFFFFFFFFFFF2084 : 31FC 0000 99AA      		move.w	#0,(RAM_FadeMarsDelay).w
(1)   78/FFFFFFFFFFFF208A : 31FC 0001 999E      		move.w	#1,(RAM_FadeMdReq).w
(1)   79/FFFFFFFFFFFF2090 : 31FC 0001 99A6      		move.w	#1,(RAM_FadeMarsReq).w
(1)   80/FFFFFFFFFFFF2096 :                     
(1)   82/FFFFFFFFFFFF2096 : 7010                		moveq	#$10,d0
(1)   83/FFFFFFFFFFFF2098 : 6100 F5CE           		bsr	System_McdSubTask
(1)   85/FFFFFFFFFFFF209C :                     
(1)   86/FFFFFFFFFFFF209C :                     ; ====================================================================
(1)   87/FFFFFFFFFFFF209C :                     ; ------------------------------------------------------
(1)   88/FFFFFFFFFFFF209C :                     ; Loop
(1)   89/FFFFFFFFFFFF209C :                     ; ------------------------------------------------------
(1)   90/FFFFFFFFFFFF209C :                     
(1)   91/FFFFFFFFFFFF209C :                     .loop:
(1)   92/FFFFFFFFFFFF209C : 6100 F4FE           		bsr	System_WaitFrame
(1)   93/FFFFFFFFFFFF20A0 : 6100 E534           		bsr	Video_RunFade
(1)   94/FFFFFFFFFFFF20A4 :                     
(1)   95/FFFFFFFFFFFF20A4 : 41FA 0092           		lea	str_Stats2(pc),a0
(1)   96/FFFFFFFFFFFF20A8 : 203C 0000 0103      		move.l	#locate(0,1,3),d0
(1)   97/FFFFFFFFFFFF20AE : 6100 E352           		bsr	Video_Print
(1)   98/FFFFFFFFFFFF20B2 :                     
(1)   99/FFFFFFFFFFFF20B2 : 06B8 0000 0001 8740 		addi.l	#1,(RAM_Framecount).w
(1)  100/FFFFFFFFFFFF20BA : 60E0                		bra.s	.loop
(1)  101/FFFFFFFFFFFF20BC :                     
(1)  102/FFFFFFFFFFFF20BC :                     ; ====================================================================
(1)  103/FFFFFFFFFFFF20BC :                     ; ----------------------------------------------
(1)  104/FFFFFFFFFFFF20BC :                     ; common subs
(1)  105/FFFFFFFFFFFF20BC :                     ; ----------------------------------------------
(1)  106/FFFFFFFFFFFF20BC :                     
(1)  107/FFFFFFFFFFFF20BC :                     .fade_in:
(1)  108/FFFFFFFFFFFF20BC : 31FC 0001 999E      		move.w	#1,(RAM_FadeMdReq).w
(1)  109/FFFFFFFFFFFF20C2 : 31FC 0001 99A6      		move.w	#1,(RAM_FadeMarsReq).w
(1)  110/FFFFFFFFFFFF20C8 : 31FC 0001 99A0      		move.w	#1,(RAM_FadeMdIncr).w
(1)  111/FFFFFFFFFFFF20CE : 31FC 0001 99A8      		move.w	#1,(RAM_FadeMarsIncr).w
(1)  112/FFFFFFFFFFFF20D4 : 31FC 0004 99A2      		move.w	#4,(RAM_FadeMdDelay).w
(1)  113/FFFFFFFFFFFF20DA : 31FC 0000 99AA      		move.w	#0,(RAM_FadeMarsDelay).w
(1)  114/FFFFFFFFFFFF20E0 : 6024                		bra.s	.loop2
(1)  115/FFFFFFFFFFFF20E2 :                     
(1)  116/FFFFFFFFFFFF20E2 :                     .fade_out:
(1)  117/FFFFFFFFFFFF20E2 : 31FC 0002 999E      		move.w	#2,(RAM_FadeMdReq).w
(1)  118/FFFFFFFFFFFF20E8 : 31FC 0002 99A6      		move.w	#2,(RAM_FadeMarsReq).w
(1)  119/FFFFFFFFFFFF20EE : 31FC 0001 99A0      		move.w	#1,(RAM_FadeMdIncr).w
(1)  120/FFFFFFFFFFFF20F4 : 31FC 0001 99A8      		move.w	#1,(RAM_FadeMarsIncr).w
(1)  121/FFFFFFFFFFFF20FA : 31FC 0004 99A2      		move.w	#4,(RAM_FadeMdDelay).w
(1)  122/FFFFFFFFFFFF2100 : 31FC 0000 99AA      		move.w	#0,(RAM_FadeMarsDelay).w
(1)  123/FFFFFFFFFFFF2106 :                     .loop2:
(1)  124/FFFFFFFFFFFF2106 : 6100 F494           		bsr	System_WaitFrame
(1)  125/FFFFFFFFFFFF210A : 6100 E4CA           		bsr	Video_RunFade
(1)  126/FFFFFFFFFFFF210E : 66F6                		bne.s	.loop2
(1)  127/FFFFFFFFFFFF2110 : 4E75                		rts
(1)  128/FFFFFFFFFFFF2112 :                     
(1)  129/FFFFFFFFFFFF2112 :                     ; ====================================================================
(1)  130/FFFFFFFFFFFF2112 :                     ; ------------------------------------------------------
(1)  131/FFFFFFFFFFFF2112 :                     ; Subroutines
(1)  132/FFFFFFFFFFFF2112 :                     ; ------------------------------------------------------
(1)  133/FFFFFFFFFFFF2112 :                     
(1)  134/FFFFFFFFFFFF2112 :                     ; ====================================================================
(1)  135/FFFFFFFFFFFF2112 :                     ; ------------------------------------------------------
(1)  136/FFFFFFFFFFFF2112 :                     ; DATA
(1)  137/FFFFFFFFFFFF2112 :                     ;
(1)  138/FFFFFFFFFFFF2112 :                     ; Small stuff goes here
(1)  139/FFFFFFFFFFFF2112 :                     ; ------------------------------------------------------
(1)  140/FFFFFFFFFFFF2112 :                     
(1)  141/FFFFFFFFFFFF2112 :                     str_Stats:
(1)  142/FFFFFFFFFFFF2112 : 4D41 5253 4941 4E4F 		dc.b "MARSIANO SCD32X! NO FEIK! AYY LMAO!",$A
                    2053 4344 3332 5821 
                    204E 4F20 4645 494B 
                    2120 4159 5920 4C4D 
                    414F 210A           
(1)  143/FFFFFFFFFFFF2136 :                     ; 		dc.b $A
(1)  144/FFFFFFFFFFFF2136 : 00                  		dc.b 0
(1)  145/FFFFFFFFFFFF2137 :                     		align 2
(1)  146/FFFFFFFFFFFF2138 :                     
(1)  147/FFFFFFFFFFFF2138 :                     str_Stats2:
(1)  148/FFFFFFFFFFFF2138 :                     ; 	if MARS
(1)  149/FFFFFFFFFFFF2138 : 5C6C 0A0A           		dc.b "\\l",$A,$A
(1)  150/FFFFFFFFFFFF213C : 4D43 4420 434F 4D4D 		dc.b "MCD COMM: \\b \\b RW/RD",$A,$A
                    3A20 5C62 205C 6220 
                    5257 2F52 440A 0A   
(1)  151/FFFFFFFFFFFF2153 : 5C77 205C 7720 5C77 		dc.b "\\w \\w \\w \\w RW",$A
                    205C 7720 5257 0A   
(1)  152/FFFFFFFFFFFF2162 : 5C77 205C 7720 5C77 		dc.b "\\w \\w \\w \\w",$A,$A
                    205C 770A 0A        
(1)  153/FFFFFFFFFFFF216F : 5C77 205C 7720 5C77 		dc.b "\\w \\w \\w \\w RD",$A
                    205C 7720 5244 0A   
(1)  154/FFFFFFFFFFFF217E : 5C77 205C 7720 5C77 		dc.b "\\w \\w \\w \\w",$A
                    205C 770A           
(1)  155/FFFFFFFFFFFF218A : 0A                  		dc.b $A
(1)  156/FFFFFFFFFFFF218B : 4D41 5253 2043 4F4D 		dc.b "MARS COMM",$A,$A
                    4D0A 0A             
(1)  157/FFFFFFFFFFFF2196 : 5C77 205C 7720 5C77 		dc.b "\\w \\w \\w \\w",$A
                    205C 770A           
(1)  158/FFFFFFFFFFFF21A2 : 5C77 205C 7720 5C77 		dc.b "\\w \\w \\w \\w",$A,$A
                    205C 770A 0A        
(1)  159/FFFFFFFFFFFF21AF : 5C6C 0A             		dc.b "\\l",$A
(1)  160/FFFFFFFFFFFF21B2 : 00                  		dc.b 0
(1)  161/FFFFFFFFFFFF21B3 :                     ; ; 	else
(1)  162/FFFFFFFFFFFF21B3 :                     ; 		dc.b "\\l",0
(1)  163/FFFFFFFFFFFF21B3 :                     ; 	endif
(1)  164/FFFFFFFFFFFF21B3 : FFFF 8740           		dc.l RAM_Framecount
(1)  165/FFFFFFFFFFFF21B7 :                     ; 	if MARS
(1)  166/FFFFFFFFFFFF21B7 : 00A1 200E           		dc.l sysmcd_reg+mcd_comm_m
(1)  167/FFFFFFFFFFFF21BB : 00A1 200F           		dc.l sysmcd_reg+mcd_comm_s
(1)  168/FFFFFFFFFFFF21BF :                     
(1)  169/FFFFFFFFFFFF21BF : 00A1 2010           		dc.l sysmcd_reg+mcd_dcomm_m
(1)  170/FFFFFFFFFFFF21C3 : 00A1 2012           		dc.l sysmcd_reg+mcd_dcomm_m+2
(1)  171/FFFFFFFFFFFF21C7 : 00A1 2014           		dc.l sysmcd_reg+mcd_dcomm_m+4
(1)  172/FFFFFFFFFFFF21CB : 00A1 2016           		dc.l sysmcd_reg+mcd_dcomm_m+6
(1)  173/FFFFFFFFFFFF21CF : 00A1 2018           		dc.l sysmcd_reg+mcd_dcomm_m+8
(1)  174/FFFFFFFFFFFF21D3 : 00A1 201A           		dc.l sysmcd_reg+mcd_dcomm_m+10
(1)  175/FFFFFFFFFFFF21D7 : 00A1 201C           		dc.l sysmcd_reg+mcd_dcomm_m+12
(1)  176/FFFFFFFFFFFF21DB : 00A1 201E           		dc.l sysmcd_reg+mcd_dcomm_m+14
(1)  177/FFFFFFFFFFFF21DF : 00A1 2020           		dc.l sysmcd_reg+mcd_dcomm_s
(1)  178/FFFFFFFFFFFF21E3 : 00A1 2022           		dc.l sysmcd_reg+mcd_dcomm_s+2
(1)  179/FFFFFFFFFFFF21E7 : 00A1 2024           		dc.l sysmcd_reg+mcd_dcomm_s+4
(1)  180/FFFFFFFFFFFF21EB : 00A1 2026           		dc.l sysmcd_reg+mcd_dcomm_s+6
(1)  181/FFFFFFFFFFFF21EF : 00A1 2028           		dc.l sysmcd_reg+mcd_dcomm_s+8
(1)  182/FFFFFFFFFFFF21F3 : 00A1 202A           		dc.l sysmcd_reg+mcd_dcomm_s+10
(1)  183/FFFFFFFFFFFF21F7 : 00A1 202C           		dc.l sysmcd_reg+mcd_dcomm_s+12
(1)  184/FFFFFFFFFFFF21FB : 00A1 202E           		dc.l sysmcd_reg+mcd_dcomm_s+14
(1)  185/FFFFFFFFFFFF21FF :                     
(1)  186/FFFFFFFFFFFF21FF : 00A1 5120           		dc.l sysmars_reg+comm0
(1)  187/FFFFFFFFFFFF2203 : 00A1 5122           		dc.l sysmars_reg+comm2
(1)  188/FFFFFFFFFFFF2207 : 00A1 5124           		dc.l sysmars_reg+comm4
(1)  189/FFFFFFFFFFFF220B : 00A1 5126           		dc.l sysmars_reg+comm6
(1)  190/FFFFFFFFFFFF220F : 00A1 5128           		dc.l sysmars_reg+comm8
(1)  191/FFFFFFFFFFFF2213 : 00A1 512A           		dc.l sysmars_reg+comm10
(1)  192/FFFFFFFFFFFF2217 : 00A1 512C           		dc.l sysmars_reg+comm12
(1)  193/FFFFFFFFFFFF221B : 00A1 512E           		dc.l sysmars_reg+comm14
(1)  194/FFFFFFFFFFFF221F :                     
(1)  195/FFFFFFFFFFFF221F : FFFF FFF0           		dc.l $FFFFFFF0
(1)  196/FFFFFFFFFFFF2223 :                     ; 	endif
(1)  197/FFFFFFFFFFFF2223 :                     		align 2
(1)  198/FFFFFFFFFFFF2224 :                     
(1)  199/FFFFFFFFFFFF2224 :                     ; ====================================================================
(1)  200/FFFFFFFFFFFF2224 :                     
     258/    C224 :                     		dephase
     259/    C224 :                     		align $800
     260/    C800 :                     SAT_Main_e:
     261/    C800 :                     
     262/    C800 :                     ; --------------------------------------------------------
     263/    C800 :                     ; Screen modes
     264/    C800 :                     ; --------------------------------------------------------
     265/    C800 :                     
     266/    C800 :                     		align $800
     267/    C800 :                     GFXDMA_WRAM:
     268/  200000 :                     		phase sysmcd_wram
     269/  200000 :                     		include "game/data/md_dma.asm"
(1)    1/  200000 :                     ; ====================================================================
(1)    2/  200000 :                     ; ----------------------------------------------------------------
(1)    3/  200000 :                     ; DMA ROM-DATA Transfer section
(1)    4/  200000 :                     ; 
(1)    5/  200000 :                     ; RV bit must be enabled to read from here
(1)    6/  200000 :                     ; ----------------------------------------------------------------
(1)    7/  200000 :                     
(1)    8/  200000 :                     		align $8000
(1)    9/  203800 :                     ASCII_FONT:	binclude "system/md/data/font.bin"
(1)   10/  204800 :                     ASCII_FONT_e:
(1)   11/  204800 :                     ; 		align $8000
(1)   12/  204800 :                     ; ART_TEST3D:	binclude "game/data/maps/3D/md_bg/md_bg_art.bin"
(1)   13/  204800 :                     ; ART_TEST3D_e:
(1)   14/  204800 :                     ; 		align $8000
(1)   15/  204800 :                     ; Art_level0:	binclude "game/data/maps/2D/level0/art.bin"
(1)   16/  204800 :                     ; Art_level0_e:
(1)   17/  204800 :                     
(1)   18/  204800 :                     
(1)   19/  204800 :                     
(1)   20/  204800 :                     
(1)   21/  204800 :                     
     270/  204800 :                     		include "game/data/md_bank0.asm"	; <-- 68K ONLY bank data
(1)    1/  204800 :                     ; ====================================================================
(1)    2/  204800 :                     ; ----------------------------------------------------------------
(1)    3/  204800 :                     ; BANK 0 of 68k data ($900000-$9FFFFF)
(1)    4/  204800 :                     ; for big stuff like maps, levels, etc.
(1)    5/  204800 :                     ;
(1)    6/  204800 :                     ; For graphics use DMA and place your files at
(1)    7/  204800 :                     ; md_dma.asm (Watch out for the $20000 limit.)
(1)    8/  204800 :                     ;
(1)    9/  204800 :                     ; Maximum size: $0FFFFF bytes per bank
(1)   10/  204800 :                     ; ----------------------------------------------------------------
(1)   11/  204800 :                     
(1)   12/  204800 :                     		include "game/data/m_palettes.asm"	; All 32X palettes will be here.
(2)    1/  204800 :                     ; ====================================================================
(2)    2/  204800 :                     ; ----------------------------------------------------------------
(2)    3/  204800 :                     ; Put your 32X palettes here
(2)    4/  204800 :                     ;
(2)    5/  204800 :                     ; These are located on a single 68K $900000+ bank
(2)    6/  204800 :                     ;
(2)    7/  204800 :                     ; Labels MUST be aligned by 2
(2)    8/  204800 :                     ; ----------------------------------------------------------------
(2)    9/  204800 :                     
(2)   10/  204800 :                     		align 2
(2)   11/  204800 :                     PalMars_TEST:
(2)   12/  204800 :                     		binclude "game/data/TESTS/test_pal.bin"
(2)   13/  204A00 :                     		align 2
(2)   14/  204A00 :                     
(2)   15/  204A00 :                     ; PalMars_MarsCity:
(2)   16/  204A00 :                     ; 		binclude "game/data/maps/3D/mcity/mtrl/marscity_pal.bin"
(2)   17/  204A00 :                     ; 		align 2
(2)   18/  204A00 :                     ;
(2)   19/  204A00 :                     ; MapPal_M:	binclude "game/data/maps/2D/level0/m_pal.bin"
(2)   20/  204A00 :                     ; 		align 2
(2)   21/  204A00 :                     ; TestSupSpr_Pal:
(2)   22/  204A00 :                     ; 		binclude "game/data/sprites/mars/nicole/sprites_pal.bin"
(2)   23/  204A00 :                     ; 		align 2
(2)   24/  204A00 :                     
(1)   13/  204A00 :                     
(1)   14/  204A00 :                     		align 2
(1)   15/  204A00 :                     Pal_level0:	binclude "game/data/maps/2D/level0/pal.bin"
(1)   16/  204A20 :                     		align 2
(1)   17/  204A20 :                     Pal_Test3D:	binclude "game/data/maps/3D/md_bg/md_bg_pal.bin"
(1)   18/  204A30 :                     		align 2
(1)   19/  204A30 :                     Map_Test3D:	binclude "game/data/maps/3D/md_bg/md_bg_map.bin"
(1)   20/  205830 :                     		align 2
(1)   21/  205830 :                     
(1)   22/  205830 :                     ; ----------------------------------------------------------------
(1)   23/  205830 :                     
(1)   24/  205830 :                     		align 2
(1)   25/  205830 :                     MapHead_0:	binclude "game/data/maps/2D/level0/head.bin"
(1)   26/  20583A :                     MapBlk_0:	binclude "game/data/maps/2D/level0/blocks.bin"
(1)   27/  206042 :                     		align 2
(1)   28/  206042 :                     MapFgL_0:	binclude "game/data/maps/2D/level0/fg_low.bin"
(1)   29/  206CA2 :                     		align 2
(1)   30/  206CA2 :                     MapFgH_0:	binclude "game/data/maps/2D/level0/fg_hi.bin"
(1)   31/  207902 :                     		align 2
(1)   32/  207902 :                     MapFgC_0:	binclude "game/data/maps/2D/level0/fg_col.bin"
(1)   33/  208562 :                     		align 2
(1)   34/  208562 :                     MapBgL_0:	binclude "game/data/maps/2D/level0/bg_low.bin"
(1)   35/  2091C2 :                     		align 2
(1)   36/  2091C2 :                     MapBgH_0:	binclude "game/data/maps/2D/level0/bg_hi.bin"
(1)   37/  209E22 :                     		align 2
(1)   38/  209E22 :                     
(1)   39/  209E22 :                     ; ----------------------------------------------------------------
(1)   40/  209E22 :                     ; 68k data for 32X maps go here:
(1)   41/  209E22 :                     ; Headers and Collision
(1)   42/  209E22 :                     
(1)   43/  209E22 :                     		align 2
(1)   44/  209E22 :                     MapHead_M:	binclude "game/data/maps/2D/level0/m_head.bin"
(1)   45/  209E28 :                     		align 2
(1)   46/  209E28 :                     MapCol_M:	binclude "game/data/maps/2D/level0/m_col.bin"
(1)   47/  20AA28 :                     		align 2
(1)   48/  20AA28 :                     
(1)   49/  20AA28 :                     ; ----------------------------------------------------------------
(1)   50/  20AA28 :                     
(1)   51/  20AA28 :                     MapCamera_0:
(1)   52/  20AA28 :                     		binclude "game/data/maps/3D/mcity/anim/mcity_anim.bin"
(1)   53/  21114C :                     		align 4
(1)   54/  21114C :                     
     271/   1D94C :                     		dephase
     272/   1D94C :                     		align $800
     273/   1E000 :                     GFXDMA_WRAM_e:
     274/   1E000 :                     
     275/   1E000 :                     ; --------------------------------------------------------
     276/   1E000 :                     ; Screen modes
     277/   1E000 :                     ; --------------------------------------------------------
     278/   1E000 :                     
     279/   1E000 :                     ; 	if MARS
     280/   1E000 :                     		align $800
     281/   1E000 :                     CD32_Start:
     282/   1E000 :                     		include "system/mars/code.asm"
(1)    1/   1E000 :                     ; ====================================================================
(1)    2/   1E000 :                     ; ----------------------------------------------------------------
(1)    3/   1E000 :                     ; MARS SH2 SDRAM section, shared for both CPUs
(1)    4/   1E000 :                     ; ----------------------------------------------------------------
(1)    5/   1E000 :                     
(1)    6/   1E000 :                     ; *************************************************
(1)    7/   1E000 :                     ; comm ports:
(1)    8/   1E000 :                     ;
(1)    9/   1E000 :                     ; comm0-comm7  - ** FREE ***
(1)   10/   1E000 :                     ; comm8-comm11 - Used by Z80 for getting it's data
(1)   11/   1E000 :                     ;                packets
(1)   12/   1E000 :                     ; comm12       - Master CPU control
(1)   13/   1E000 :                     ; comm14       - Slave CPU control
(1)   14/   1E000 :                     ; *************************************************
(1)   15/   1E000 :                     
(1)   16/ 6000000 :                     		phase CS3	; Now we are at SDRAM
(1)   17/ 6000000 :                     		cpu SH7600	; Should be SH7095 but this CPU mode works.
(1)   18/ 6000000 :                     
(1)   19/ 6000000 :                     ; ; CPU METER MACRO
(1)   20/ 6000000 :                     ; testme macro color
(1)   21/ 6000000 :                     ; 		mov	#color,r1
(1)   22/ 6000000 :                     ; 		mov	#_vdpreg,r2
(1)   23/ 6000000 :                     ; 		mov	#_vdpreg+bitmapmd,r3
(1)   24/ 6000000 :                     ; -		mov.b	@(vdpsts,r2),r0
(1)   25/ 6000000 :                     ; 		tst	#HBLK,r0
(1)   26/ 6000000 :                     ; 		bt	-
(1)   27/ 6000000 :                     ; 		mov.b	r1,@r3
(1)   28/ 6000000 :                     ; 	endm
(1)   29/ 6000000 :                     
(1)   30/ 6000000 :                     ; ====================================================================
(1)   31/ 6000000 :                     ; ----------------------------------------------------------------
(1)   32/ 6000000 :                     ; Settings
(1)   33/ 6000000 :                     ; ----------------------------------------------------------------
(1)   34/ 6000000 :                     
(1)   35/ 6000000 : =$1                 SH2_DEBUG	equ 1			; Set to 1 too see if CPUs are active using comm counters (0 and 1)
(1)   36/ 6000000 : =$6040000           STACK_MSTR	equ CS3|$40000
(1)   37/ 6000000 : =$603F000           STACK_SLV	equ CS3|$3F000
(1)   38/ 6000000 :                     
(1)   39/ 6000000 :                     ; ====================================================================
(1)   40/ 6000000 :                     ; ----------------------------------------------------------------
(1)   41/ 6000000 :                     ; MARS GLOBAL gbr variables for both SH2
(1)   42/ 6000000 :                     ; ----------------------------------------------------------------
(1)   43/ 6000000 :                     
(1)   44/ 6000000 : (MACRO)             		struct 0
(1)   44/ 6000000 : =$6000000           GLBL_LASTPC     set *
(1)   44/   1E000 :                                     dephase
(1)   44/   1E000 : =$1E000             GLBL_LASTORG    set *
(1)   44/       0 :                                     phase 0
(1)   45/       0 :                     marsGbl_XShift	ds.w 1
(1)   46/       2 :                     marsGbl_Null	ds.w 1
(1)   47/       4 :                     sizeof_MarsGbl	ds.l 0
(1)   48/       4 : (MACRO)             		endstruct
(1)   48/       0 :                                     !org GLBL_LASTORG
(1)   48/ 6000000 :                                     phase GLBL_LASTPC
(1)   49/ 6000000 :                     
(1)   50/ 6000000 :                     ; ====================================================================
(1)   51/ 6000000 :                     ; ----------------------------------------------------------------
(1)   52/ 6000000 :                     ; MASTER CPU VECTOR LIST (vbr)
(1)   53/ 6000000 :                     ; ----------------------------------------------------------------
(1)   54/ 6000000 :                     
(1)   55/ 6000000 :                     		align 4
(1)   56/ 6000000 :                     SH2_Master:
(1)   57/ 6000000 : 0600 0710 0604 0000 		dc.l SH2_M_Entry,STACK_MSTR	; Power PC, Stack
(1)   58/ 6000008 : 0600 0710 0604 0000 		dc.l SH2_M_Entry,STACK_MSTR	; Reset PC, Stack
(1)   59/ 6000010 : 0600 0324           		dc.l SH2_M_ErrIllg		; Illegal instruction
(1)   60/ 6000014 : 0000 0000           		dc.l 0				; reserved
(1)   61/ 6000018 : 0600 0328           		dc.l SH2_M_ErrInvl		; Invalid slot instruction
(1)   62/ 600001C : 2010 0400           		dc.l $20100400			; reserved
(1)   63/ 6000020 : 2010 0420           		dc.l $20100420			; reserved
(1)   64/ 6000024 : 0600 032C           		dc.l SH2_M_ErrAddr		; CPU address error
(1)   65/ 6000028 : 0600 0330           		dc.l SH2_M_ErrDma		; DMA address error
(1)   66/ 600002C : 0600 0334           		dc.l SH2_M_ErrNmi		; NMI vector
(1)   67/ 6000030 : 0600 0338           		dc.l SH2_M_ErrUser		; User break vector
(1)   68/ 6000034 : 0000 0000 0000 0000 		dc.l 0,0,0,0,0,0,0,0,0		; reserved
                    0000 0000 0000 0000 
                    0000 0000 0000 0000 
                    0000 0000 0000 0000 
                    0000 0000           
(1)   69/ 6000058 : 0000 0000 0000 0000 		dc.l 0,0,0,0,0,0,0,0,0
                    0000 0000 0000 0000 
                    0000 0000 0000 0000 
                    0000 0000 0000 0000 
                    0000 0000           
(1)   70/ 600007C : 0000 0000           		dc.l 0
(1)   71/ 6000080 : 0600 0320           		dc.l SH2_M_Error		; Trap user vectors
(1)   72/ 6000084 : 0600 0320           		dc.l SH2_M_Error
(1)   73/ 6000088 : 0600 0320           		dc.l SH2_M_Error
(1)   74/ 600008C : 0600 0320           		dc.l SH2_M_Error
(1)   75/ 6000090 : 0600 0320           		dc.l SH2_M_Error
(1)   76/ 6000094 : 0600 0320           		dc.l SH2_M_Error
(1)   77/ 6000098 : 0600 0320           		dc.l SH2_M_Error
(1)   78/ 600009C : 0600 0320           		dc.l SH2_M_Error
(1)   79/ 60000A0 : 0600 0320           		dc.l SH2_M_Error
(1)   80/ 60000A4 : 0600 0320           		dc.l SH2_M_Error
(1)   81/ 60000A8 : 0600 0320           		dc.l SH2_M_Error
(1)   82/ 60000AC : 0600 0320           		dc.l SH2_M_Error
(1)   83/ 60000B0 : 0600 0320           		dc.l SH2_M_Error
(1)   84/ 60000B4 : 0600 0320           		dc.l SH2_M_Error
(1)   85/ 60000B8 : 0600 0320           		dc.l SH2_M_Error
(1)   86/ 60000BC : 0600 0320           		dc.l SH2_M_Error
(1)   87/ 60000C0 : 0600 0320           		dc.l SH2_M_Error
(1)   88/ 60000C4 : 0600 0320           		dc.l SH2_M_Error
(1)   89/ 60000C8 : 0600 0320           		dc.l SH2_M_Error
(1)   90/ 60000CC : 0600 0320           		dc.l SH2_M_Error
(1)   91/ 60000D0 : 0600 0320           		dc.l SH2_M_Error
(1)   92/ 60000D4 : 0600 0320           		dc.l SH2_M_Error
(1)   93/ 60000D8 : 0600 0320           		dc.l SH2_M_Error
(1)   94/ 60000DC : 0600 0320           		dc.l SH2_M_Error
(1)   95/ 60000E0 : 0600 0320           		dc.l SH2_M_Error
(1)   96/ 60000E4 : 0600 0320           		dc.l SH2_M_Error
(1)   97/ 60000E8 : 0600 0320           		dc.l SH2_M_Error
(1)   98/ 60000EC : 0600 0320           		dc.l SH2_M_Error
(1)   99/ 60000F0 : 0600 0320           		dc.l SH2_M_Error
(1)  100/ 60000F4 : 0600 0320           		dc.l SH2_M_Error
(1)  101/ 60000F8 : 0600 0320           		dc.l SH2_M_Error
(1)  102/ 60000FC : 0600 0320           		dc.l SH2_M_Error
(1)  103/ 6000100 : 0600 0250            		dc.l master_irq		; Level 1 IRQ
(1)  104/ 6000104 : 0600 0250           		dc.l master_irq		; Level 2 & 3 IRQ
(1)  105/ 6000108 : 0600 0250           		dc.l master_irq		; Level 4 & 5 IRQ
(1)  106/ 600010C : 0600 0250           		dc.l master_irq		; Level 6 & 7 IRQ: PWM interupt
(1)  107/ 6000110 : 0600 0250           		dc.l master_irq		; Level 8 & 9 IRQ: Command interupt
(1)  108/ 6000114 : 0600 0250           		dc.l master_irq		; Level 10 & 11 IRQ: H Blank interupt
(1)  109/ 6000118 : 0600 0250           		dc.l master_irq		; Level 12 & 13 IRQ: V Blank interupt
(1)  110/ 600011C : 0600 0250           		dc.l master_irq		; Level 14 & 15 IRQ: Reset Button
(1)  111/ 6000120 :                     	; Extra ON-chip interrupts (vbr+$120)
(1)  112/ 6000120 : 0600 0250           		dc.l master_irq		; Watchdog (custom)
(1)  113/ 6000124 : 0600 0250           		dc.l master_irq		; DMA
(1)  114/ 6000128 :                     
(1)  115/ 6000128 :                     ; ====================================================================
(1)  116/ 6000128 :                     ; ----------------------------------------------------------------
(1)  117/ 6000128 :                     ; SLAVE CPU VECTOR LIST (vbr)
(1)  118/ 6000128 :                     ; ----------------------------------------------------------------
(1)  119/ 6000128 :                     
(1)  120/ 6000128 :                     		align 4
(1)  121/ 6000128 :                     SH2_Slave:
(1)  122/ 6000128 : 0600 0888 0603 F000 		dc.l SH2_S_Entry,STACK_SLV	; Cold PC,SP
(1)  123/ 6000130 : 0600 0888 0603 F000 		dc.l SH2_S_Entry,STACK_SLV	; Manual PC,SP
(1)  124/ 6000138 : 0600 0350           		dc.l SH2_S_ErrIllg		; Illegal instruction
(1)  125/ 600013C : 0000 0000           		dc.l 0				; reserved
(1)  126/ 6000140 : 0600 0354           		dc.l SH2_S_ErrInvl		; Invalid slot instruction
(1)  127/ 6000144 : 2010 0400           		dc.l $20100400			; reserved
(1)  128/ 6000148 : 2010 0420           		dc.l $20100420			; reserved
(1)  129/ 600014C : 0600 0358           		dc.l SH2_S_ErrAddr		; CPU address error
(1)  130/ 6000150 : 0600 035C           		dc.l SH2_S_ErrDma		; DMA address error
(1)  131/ 6000154 : 0600 0360           		dc.l SH2_S_ErrNmi		; NMI vector
(1)  132/ 6000158 : 0600 0364           		dc.l SH2_S_ErrUser		; User break vector
(1)  133/ 600015C : 0000 0000 0000 0000 		dc.l 0,0,0,0,0,0,0,0,0		; reserved
                    0000 0000 0000 0000 
                    0000 0000 0000 0000 
                    0000 0000 0000 0000 
                    0000 0000           
(1)  134/ 6000180 : 0000 0000 0000 0000 		dc.l 0,0,0,0,0,0,0,0,0
                    0000 0000 0000 0000 
                    0000 0000 0000 0000 
                    0000 0000 0000 0000 
                    0000 0000           
(1)  135/ 60001A4 : 0000 0000           		dc.l 0
(1)  136/ 60001A8 : 0600 034C           		dc.l SH2_S_Error		; Trap user vectors
(1)  137/ 60001AC : 0600 034C           		dc.l SH2_S_Error
(1)  138/ 60001B0 : 0600 034C           		dc.l SH2_S_Error
(1)  139/ 60001B4 : 0600 034C           		dc.l SH2_S_Error
(1)  140/ 60001B8 : 0600 034C           		dc.l SH2_S_Error
(1)  141/ 60001BC : 0600 034C           		dc.l SH2_S_Error
(1)  142/ 60001C0 : 0600 034C           		dc.l SH2_S_Error
(1)  143/ 60001C4 : 0600 034C           		dc.l SH2_S_Error
(1)  144/ 60001C8 : 0600 034C           		dc.l SH2_S_Error
(1)  145/ 60001CC : 0600 034C           		dc.l SH2_S_Error
(1)  146/ 60001D0 : 0600 034C           		dc.l SH2_S_Error
(1)  147/ 60001D4 : 0600 034C           		dc.l SH2_S_Error
(1)  148/ 60001D8 : 0600 034C           		dc.l SH2_S_Error
(1)  149/ 60001DC : 0600 034C           		dc.l SH2_S_Error
(1)  150/ 60001E0 : 0600 034C           		dc.l SH2_S_Error
(1)  151/ 60001E4 : 0600 034C           		dc.l SH2_S_Error
(1)  152/ 60001E8 : 0600 034C           		dc.l SH2_S_Error
(1)  153/ 60001EC : 0600 034C           		dc.l SH2_S_Error
(1)  154/ 60001F0 : 0600 034C           		dc.l SH2_S_Error
(1)  155/ 60001F4 : 0600 034C           		dc.l SH2_S_Error
(1)  156/ 60001F8 : 0600 034C           		dc.l SH2_S_Error
(1)  157/ 60001FC : 0600 034C           		dc.l SH2_S_Error
(1)  158/ 6000200 : 0600 034C           		dc.l SH2_S_Error
(1)  159/ 6000204 : 0600 034C           		dc.l SH2_S_Error
(1)  160/ 6000208 : 0600 034C           		dc.l SH2_S_Error
(1)  161/ 600020C : 0600 034C           		dc.l SH2_S_Error
(1)  162/ 6000210 : 0600 034C           		dc.l SH2_S_Error
(1)  163/ 6000214 : 0600 034C           		dc.l SH2_S_Error
(1)  164/ 6000218 : 0600 034C           		dc.l SH2_S_Error
(1)  165/ 600021C : 0600 034C           		dc.l SH2_S_Error
(1)  166/ 6000220 : 0600 034C           		dc.l SH2_S_Error
(1)  167/ 6000224 : 0600 034C           		dc.l SH2_S_Error
(1)  168/ 6000228 : 0600 0278            		dc.l slave_irq		; Level 1 IRQ
(1)  169/ 600022C : 0600 0278           		dc.l slave_irq		; Level 2 & 3 IRQ
(1)  170/ 6000230 : 0600 0278           		dc.l slave_irq		; Level 4 & 5 IRQ
(1)  171/ 6000234 : 0600 0278           		dc.l slave_irq		; Level 6 & 7 IRQ: PWM interupt
(1)  172/ 6000238 : 0600 0278           		dc.l slave_irq		; Level 8 & 9 IRQ: Command interupt
(1)  173/ 600023C : 0600 0278           		dc.l slave_irq		; Level 10 & 11 IRQ: H Blank interupt
(1)  174/ 6000240 : 0600 0278           		dc.l slave_irq		; Level 12 & 13 IRQ: V Blank interupt
(1)  175/ 6000244 : 0600 0278           		dc.l slave_irq		; Level 14 & 15 IRQ: Reset Button
(1)  176/ 6000248 :                     	; Extra ON-chip interrupts (vbr+$120)
(1)  177/ 6000248 : 0600 0278           		dc.l slave_irq		; Watchdog
(1)  178/ 600024C : 0600 0278           		dc.l slave_irq		; DMA
(1)  179/ 6000250 :                     
(1)  180/ 6000250 :                     ; ====================================================================
(1)  181/ 6000250 :                     ; ----------------------------------------------------------------
(1)  182/ 6000250 :                     ; IRQ
(1)  183/ 6000250 :                     ;
(1)  184/ 6000250 :                     ; r0-r1 are saved
(1)  185/ 6000250 :                     ;
(1)  186/ 6000250 :                     ; sr: %xxxxMQIIIIxxST
(1)  187/ 6000250 :                     ; ----------------------------------------------------------------
(1)  188/ 6000250 :                     
(1)  189/ 6000250 :                     		align 4
(1)  190/ 6000250 :                     master_irq:
(1)  191/ 6000250 : 2F06                		mov.l	r0,@-r15
(1)  192/ 6000252 : 2F16                		mov.l	r1,@-r15
(1)  193/ 6000254 : 4F22                		sts.l	pr,@-r15
(1)  194/ 6000256 : 0002                		stc	sr,r0
(1)  195/ 6000258 : 4009                		shlr2	r0
(1)  196/ 600025A : C93C                		and	#$3C,r0
(1)  197/ 600025C : 6103                		mov	r0,r1
(1)  198/ 600025E : E0F0                		mov.b	#$F0,r0		; ** $F0
(1)  199/ 6000260 : 600C                		extu.b	r0,r0
(1)  200/ 6000262 : 400E                		ldc	r0,sr
(1)  201/ 6000264 : C70E                		mova	int_m_list,r0
(1)  202/ 6000266 : 301C                		add	r1,r0
(1)  203/ 6000268 : 6102                		mov	@r0,r1
(1)  204/ 600026A : 410B                		jsr	@r1
(1)  205/ 600026C : 0009                		nop
(1)  206/ 600026E : 4F26                		lds.l	@r15+,pr
(1)  207/ 6000270 : 61F6                		mov.l	@r15+,r1
(1)  208/ 6000272 : 60F6                		mov.l	@r15+,r0
(1)  209/ 6000274 : 002B                		rte
(1)  210/ 6000276 : 0009                		nop
(1)  211/ 6000278 :                     		align 4
(1)  212/ 6000278 :                     
(1)  213/ 6000278 :                     ; ====================================================================
(1)  214/ 6000278 :                     
(1)  215/ 6000278 :                     slave_irq:
(1)  216/ 6000278 : 2F06                		mov.l	r0,@-r15
(1)  217/ 600027A : 2F16                		mov.l	r1,@-r15
(1)  218/ 600027C : 4F22                		sts.l	pr,@-r15
(1)  219/ 600027E : 0002                		stc	sr,r0
(1)  220/ 6000280 : 4009                		shlr2	r0
(1)  221/ 6000282 : C93C                		and	#$3C,r0
(1)  222/ 6000284 : 6103                		mov	r0,r1
(1)  223/ 6000286 : E0F0                		mov.b	#$F0,r0		; ** $F0
(1)  224/ 6000288 : 600C                		extu.b	r0,r0
(1)  225/ 600028A : 400E                		ldc	r0,sr
(1)  226/ 600028C : C714                		mova	int_s_list,r0
(1)  227/ 600028E : 301C                		add	r1,r0
(1)  228/ 6000290 : 6102                		mov	@r0,r1
(1)  229/ 6000292 : 410B                		jsr	@r1
(1)  230/ 6000294 : 0009                		nop
(1)  231/ 6000296 : 4F26                		lds.l	@r15+,pr
(1)  232/ 6000298 : 61F6                		mov.l	@r15+,r1
(1)  233/ 600029A : 60F6                		mov.l	@r15+,r0
(1)  234/ 600029C : 002B                		rte
(1)  235/ 600029E : 0009                		nop
(1)  236/ 60002A0 :                     		align 4
(1)  237/ 60002A0 :                     
(1)  238/ 60002A0 :                     ; ====================================================================
(1)  239/ 60002A0 :                     ; ------------------------------------------------
(1)  240/ 60002A0 :                     ; irq list
(1)  241/ 60002A0 :                     ; ------------------------------------------------
(1)  242/ 60002A0 :                     
(1)  243/ 60002A0 :                     		align 4
(1)  244/ 60002A0 :                     ;				  Level:
(1)  245/ 60002A0 :                     int_m_list:
(1)  246/ 60002A0 : 0600 0380           		dc.l m_irq_bad	; 0
(1)  247/ 60002A4 : 0600 0380           		dc.l m_irq_bad	; 1
(1)  248/ 60002A8 : 0600 0380           		dc.l m_irq_bad	; 2
(1)  249/ 60002AC : C000 0000           		dc.l $C0000000	; 3 Watchdog (TOP code on Cache)
(1)  250/ 60002B0 : 0600 0380           		dc.l m_irq_bad	; 4
(1)  251/ 60002B4 : 0600 046C           		dc.l m_irq_dma	; 5 DMA exit
(1)  252/ 60002B8 : 0600 0384           		dc.l m_irq_pwm	; 6
(1)  253/ 60002BC : 0600 0384           		dc.l m_irq_pwm	; 7
(1)  254/ 60002C0 : 0600 039C           		dc.l m_irq_cmd	; 8
(1)  255/ 60002C4 : 0600 039C           		dc.l m_irq_cmd	; 9
(1)  256/ 60002C8 : 0600 03E8           		dc.l m_irq_h	; A
(1)  257/ 60002CC : 0600 03E8           		dc.l m_irq_h	; B
(1)  258/ 60002D0 : 0600 0404           		dc.l m_irq_v	; C
(1)  259/ 60002D4 : 0600 0404           		dc.l m_irq_v	; D
(1)  260/ 60002D8 : 0600 0420           		dc.l m_irq_vres	; E
(1)  261/ 60002DC : 0600 0420           		dc.l m_irq_vres	; F
(1)  262/ 60002E0 :                     int_s_list:
(1)  263/ 60002E0 : 0600 04BC           		dc.l s_irq_bad	; 0
(1)  264/ 60002E4 : 0600 04BC           		dc.l s_irq_bad	; 1
(1)  265/ 60002E8 : 0600 04BC           		dc.l s_irq_bad	; 2
(1)  266/ 60002EC : C000 0000           		dc.l $C0000000	; 3 Watchdog (TOP code on Cache)
(1)  267/ 60002F0 : 0600 04BC           		dc.l s_irq_bad	; 4
(1)  268/ 60002F4 : 0600 05A8           		dc.l s_irq_dma	; 5 DMA exit
(1)  269/ 60002F8 : 0600 04C0           		dc.l s_irq_pwm	; 6
(1)  270/ 60002FC : 0600 04C0           		dc.l s_irq_pwm	; 7
(1)  271/ 6000300 : 0600 04DC           		dc.l s_irq_cmd	; 8
(1)  272/ 6000304 : 0600 04DC           		dc.l s_irq_cmd	; 9
(1)  273/ 6000308 : 0600 0524           		dc.l s_irq_h	; A
(1)  274/ 600030C : 0600 0524           		dc.l s_irq_h	; B
(1)  275/ 6000310 : 0600 0540           		dc.l s_irq_v	; C
(1)  276/ 6000314 : 0600 0540           		dc.l s_irq_v	; D
(1)  277/ 6000318 : 0600 055C           		dc.l s_irq_vres	; E
(1)  278/ 600031C : 0600 055C           		dc.l s_irq_vres	; F
(1)  279/ 6000320 :                     
(1)  280/ 6000320 :                     ; ====================================================================
(1)  281/ 6000320 :                     ; ----------------------------------------------------------------
(1)  282/ 6000320 :                     ; Error handler
(1)  283/ 6000320 :                     ; ----------------------------------------------------------------
(1)  284/ 6000320 :                     
(1)  285/ 6000320 :                     ; *** Only works on HARDWARE ***
(1)  286/ 6000320 :                     ;
(1)  287/ 6000320 :                     ; comm2: (CPU)(CODE)
(1)  288/ 6000320 :                     ; comm4: PC counter
(1)  289/ 6000320 :                     ;
(1)  290/ 6000320 :                     ;  CPU | The CPU who got the error:
(1)  291/ 6000320 :                     ;        $00 - Master
(1)  292/ 6000320 :                     ;        $01 - Slave
(1)  293/ 6000320 :                     ;
(1)  294/ 6000320 :                     ; CODE | Error type:
(1)  295/ 6000320 :                     ;	 $00: Unknown error
(1)  296/ 6000320 :                     ;	 $01: Illegal instruction
(1)  297/ 6000320 :                     ;	 $02: Invalid slot instruction
(1)  298/ 6000320 :                     ;	 $03: Address error
(1)  299/ 6000320 :                     ;	 $04: DMA error
(1)  300/ 6000320 :                     ;	 $05: NMI vector
(1)  301/ 6000320 :                     ;	 $06: User break
(1)  302/ 6000320 :                     
(1)  303/ 6000320 :                     SH2_M_Error:
(1)  304/ 6000320 : A00C                		bra	SH2_M_ErrCode
(1)  305/ 6000322 : E000                		mov	#0,r0
(1)  306/ 6000324 :                     SH2_M_ErrIllg:
(1)  307/ 6000324 : A00A                		bra	SH2_M_ErrCode
(1)  308/ 6000326 : E001                		mov	#1,r0
(1)  309/ 6000328 :                     SH2_M_ErrInvl:
(1)  310/ 6000328 : A008                		bra	SH2_M_ErrCode
(1)  311/ 600032A : E002                		mov	#2,r0
(1)  312/ 600032C :                     SH2_M_ErrAddr:
(1)  313/ 600032C : A006                		bra	SH2_M_ErrCode
(1)  314/ 600032E : E003                		mov	#3,r0
(1)  315/ 6000330 :                     SH2_M_ErrDma:
(1)  316/ 6000330 : A004                		bra	SH2_M_ErrCode
(1)  317/ 6000332 : E004                		mov	#4,r0
(1)  318/ 6000334 :                     SH2_M_ErrNmi:
(1)  319/ 6000334 : A002                		bra	SH2_M_ErrCode
(1)  320/ 6000336 : E005                		mov	#5,r0
(1)  321/ 6000338 :                     SH2_M_ErrUser:
(1)  322/ 6000338 : A000                		bra	SH2_M_ErrCode
(1)  323/ 600033A : E006                		mov	#6,r0
(1)  324/ 600033C :                     ; r0 - value
(1)  325/ 600033C :                     SH2_M_ErrCode:
(1)  326/ 600033C : D10E                		mov	#_sysreg+comm2,r1
(1)  327/ 600033E : 2101                		mov.w	r0,@r1
(1)  328/ 6000340 : D10E                		mov	#_sysreg+comm4,r1
(1)  329/ 6000342 : 60F2                		mov	@r15,r0
(1)  330/ 6000344 : 2102                		mov	r0,@r1
(1)  331/ 6000346 : AFFE                		bra	*
(1)  332/ 6000348 : 0009                		nop
(1)  333/ 600034A :                     		align 4
(1)  334/ 600034C :                     
(1)  335/ 600034C :                     ; ----------------------------------------------------
(1)  336/ 600034C :                     
(1)  337/ 600034C :                     SH2_S_Error:
(1)  338/ 600034C : A00C                		bra	SH2_S_ErrCode
(1)  339/ 600034E : E000                		mov	#0,r0
(1)  340/ 6000350 :                     SH2_S_ErrIllg:
(1)  341/ 6000350 : A00A                		bra	SH2_S_ErrCode
(1)  342/ 6000352 : E0FF                		mov	#-1,r0
(1)  343/ 6000354 :                     SH2_S_ErrInvl:
(1)  344/ 6000354 : A008                		bra	SH2_S_ErrCode
(1)  345/ 6000356 : E0FE                		mov	#-2,r0
(1)  346/ 6000358 :                     SH2_S_ErrAddr:
(1)  347/ 6000358 : A006                		bra	SH2_S_ErrCode
(1)  348/ 600035A : E0FD                		mov	#-3,r0
(1)  349/ 600035C :                     SH2_S_ErrDma:
(1)  350/ 600035C : A004                		bra	SH2_S_ErrCode
(1)  351/ 600035E : E0FC                		mov	#-4,r0
(1)  352/ 6000360 :                     SH2_S_ErrNmi:
(1)  353/ 6000360 : A002                		bra	SH2_S_ErrCode
(1)  354/ 6000362 : E0FB                		mov	#-5,r0
(1)  355/ 6000364 :                     SH2_S_ErrUser:
(1)  356/ 6000364 : A000                		bra	SH2_S_ErrCode
(1)  357/ 6000366 : E0FA                		mov	#-6,r0
(1)  358/ 6000368 :                     ; r0 - value
(1)  359/ 6000368 :                     SH2_S_ErrCode:
(1)  360/ 6000368 : D103                		mov	#_sysreg+comm2,r1
(1)  361/ 600036A : 2101                		mov.w	r0,@r1
(1)  362/ 600036C : D103                		mov	#_sysreg+comm4,r1
(1)  363/ 600036E : 60F2                		mov	@r15,r0
(1)  364/ 6000370 : 2102                		mov	r0,@r1
(1)  365/ 6000372 : AFFE                		bra	*
(1)  366/ 6000374 : 0009                		nop
(1)  367/ 6000376 :                     		align 4
(1)  368/ 6000378 : 2000 4022 2000 4024 		ltorg
(1)  369/ 6000380 :                     
(1)  370/ 6000380 :                     ; ====================================================================
(1)  371/ 6000380 :                     ; ----------------------------------------------------------------
(1)  372/ 6000380 :                     ; Interrupts
(1)  373/ 6000380 :                     ; ----------------------------------------------------------------
(1)  374/ 6000380 :                     
(1)  375/ 6000380 :                     ; =================================================================
(1)  376/ 6000380 :                     ; ------------------------------------------------
(1)  377/ 6000380 :                     ; Master | Unused interrupt
(1)  378/ 6000380 :                     ; ------------------------------------------------
(1)  379/ 6000380 :                     
(1)  380/ 6000380 :                     		align 4
(1)  381/ 6000380 :                     m_irq_bad:
(1)  382/ 6000380 : 000B                		rts
(1)  383/ 6000382 : 0009                		nop
(1)  384/ 6000384 :                     		align 4
(1)  385/ 6000384 :                     
(1)  386/ 6000384 :                     ; =================================================================
(1)  387/ 6000384 :                     ; ------------------------------------------------
(1)  388/ 6000384 :                     ; Master | PWM Interrupt
(1)  389/ 6000384 :                     ; ------------------------------------------------
(1)  390/ 6000384 :                     
(1)  391/ 6000384 :                     m_irq_pwm:
(1)  392/ 6000384 : 9196                		mov	#_FRT,r1
(1)  393/ 6000386 : 8417                		mov.b	@(7,r1),r0
(1)  394/ 6000388 : CA02                		xor	#2,r0
(1)  395/ 600038A : 8017                		mov.b	r0,@(7,r1)
(1)  396/ 600038C : D13E                		mov	#_sysreg+pwmintclr,r1
(1)  397/ 600038E : 2101                		mov.w	r0,@r1
(1)  398/ 6000390 : 0009                		nop
(1)  399/ 6000392 : 0009                		nop
(1)  400/ 6000394 : 0009                		nop
(1)  401/ 6000396 : 0009                		nop
(1)  402/ 6000398 : 000B                		rts
(1)  403/ 600039A : 0009                		nop
(1)  404/ 600039C :                     		align 4
(1)  405/ 600039C :                     
(1)  406/ 600039C :                     ; =================================================================
(1)  407/ 600039C :                     ; ------------------------------------------------
(1)  408/ 600039C :                     ; Master | CMD Interrupt
(1)  409/ 600039C :                     ; ------------------------------------------------
(1)  410/ 600039C :                     
(1)  411/ 600039C :                     m_irq_cmd:
(1)  412/ 600039C : 918A                		mov	#_FRT,r1
(1)  413/ 600039E : 8417                		mov.b	@(7,r1),r0
(1)  414/ 60003A0 : CA02                		xor	#2,r0
(1)  415/ 60003A2 : 8017                		mov.b	r0,@(7,r1)
(1)  416/ 60003A4 : D139                		mov	#_sysreg+cmdintclr,r1	; Clear CMD flag
(1)  417/ 60003A6 : 2101                		mov.w	r0,@r1
(1)  418/ 60003A8 : 2F26                		mov	r2,@-r15
(1)  419/ 60003AA : 2F36                		mov	r3,@-r15
(1)  420/ 60003AC : 2F46                		mov	r4,@-r15
(1)  421/ 60003AE : D438                		mov	#_sysreg,r4		; r4 - sysreg base
(1)  422/ 60003B0 : E380                		mov	#_DMASOURCE0,r3		; r3 - DMA base register
(1)  423/ 60003B2 : D238                		mov	#_sysreg+comm12,r2	; r2 - comm to write the signal
(1)  424/ 60003B4 : D138                		mov	#_sysreg+dreqfifo,r1	; r1 - Source point: DREQ FIFO
(1)  425/ 60003B6 :                     ; 		mov	#0,r0			; _DMAOPERATION = 0
(1)  426/ 60003B6 :                     ; 		mov	r0,@($30,r3)
(1)  427/ 60003B6 : 907E                		mov	#%0100010011100000,r0	; Transfer mode + DMA enable OFF
(1)  428/ 60003B8 : 1303                		mov	r0,@($C,r3)
(1)  429/ 60003BA : D038                		mov	#RAM_Mars_DreqDma,r0
(1)  430/ 60003BC : 1301                		mov	r0,@(4,r3)		; Destination
(1)  431/ 60003BE : 8548                		mov.w	@(dreqlen,r4),r0	; NOTE: NO size check, be careful.
(1)  432/ 60003C0 : 600D                		extu.w	r0,r0
(1)  433/ 60003C2 : 1302                		mov	r0,@(8,r3)		; Length (set by 68k)
(1)  434/ 60003C4 : 2312                		mov	r1,@r3			; Source
(1)  435/ 60003C6 : 9077                		mov	#%0100010011100101,r0	; Transfer mode + DMA enable + Use DMA interrupt
(1)  436/ 60003C8 : 1303                		mov	r0,@($C,r3)		; Dest:Incr(01) Src:Keep(00) Size:Word(01)
(1)  437/ 60003CA : E001                		mov	#1,r0			; _DMAOPERATION = 1
(1)  438/ 60003CC : 130C                		mov	r0,@($30,r3)
(1)  439/ 60003CE : 6020                		mov.b	@r2,r0			; Set PASS bit to Genesis side.
(1)  440/ 60003D0 : CB40                		or	#%01000000,r0
(1)  441/ 60003D2 : 2200                		mov.b	r0,@r2
(1)  442/ 60003D4 : 64F6                		mov	@r15+,r4
(1)  443/ 60003D6 : 63F6                		mov	@r15+,r3
(1)  444/ 60003D8 : 62F6                		mov	@r15+,r2
(1)  445/ 60003DA : 0009                		nop
(1)  446/ 60003DC : 0009                		nop
(1)  447/ 60003DE : 0009                		nop
(1)  448/ 60003E0 : 0009                		nop
(1)  449/ 60003E2 : 0009                		nop
(1)  450/ 60003E4 : 000B                		rts
(1)  451/ 60003E6 : 0009                		nop
(1)  452/ 60003E8 :                     		align 4
(1)  453/ 60003E8 :                     
(1)  454/ 60003E8 :                     ; =================================================================
(1)  455/ 60003E8 :                     ; ------------------------------------------------
(1)  456/ 60003E8 :                     ; Master | HBlank
(1)  457/ 60003E8 :                     ; ------------------------------------------------
(1)  458/ 60003E8 :                     
(1)  459/ 60003E8 :                     m_irq_h:
(1)  460/ 60003E8 : 9164                		mov	#_FRT,r1
(1)  461/ 60003EA : 8417                		mov.b	@(7,r1),r0
(1)  462/ 60003EC : CA02                		xor	#2,r0
(1)  463/ 60003EE : 8017                		mov.b	r0,@(7,r1)
(1)  464/ 60003F0 : D12B                		mov	#_sysreg+hintclr,r1
(1)  465/ 60003F2 : 2101                		mov.w	r0,@r1
(1)  466/ 60003F4 : 0009                		nop
(1)  467/ 60003F6 : 0009                		nop
(1)  468/ 60003F8 : 0009                		nop
(1)  469/ 60003FA : 0009                		nop
(1)  470/ 60003FC : 0009                		nop
(1)  471/ 60003FE : 000B                		rts
(1)  472/ 6000400 : 0009                		nop
(1)  473/ 6000402 :                     		align 4
(1)  474/ 6000404 :                     
(1)  475/ 6000404 :                     ; =================================================================
(1)  476/ 6000404 :                     ; ------------------------------------------------
(1)  477/ 6000404 :                     ; Master | VBlank
(1)  478/ 6000404 :                     ; ------------------------------------------------
(1)  479/ 6000404 :                     
(1)  480/ 6000404 :                     m_irq_v:
(1)  481/ 6000404 : 9156                		mov	#_FRT,r1
(1)  482/ 6000406 : 8417                		mov.b	@(7,r1),r0
(1)  483/ 6000408 : CA02                		xor	#2,r0
(1)  484/ 600040A : 8017                		mov.b	r0,@(7,r1)
(1)  485/ 600040C : D125                		mov	#_sysreg+vintclr,r1
(1)  486/ 600040E : 2101                		mov.w	r0,@r1
(1)  487/ 6000410 : 0009                		nop
(1)  488/ 6000412 : 0009                		nop
(1)  489/ 6000414 : 0009                		nop
(1)  490/ 6000416 : 0009                		nop
(1)  491/ 6000418 : 0009                		nop
(1)  492/ 600041A : 000B                		rts
(1)  493/ 600041C : 0009                		nop
(1)  494/ 600041E :                     		align 4
(1)  495/ 6000420 :                     
(1)  496/ 6000420 :                     ; =================================================================
(1)  497/ 6000420 :                     ; ------------------------------------------------
(1)  498/ 6000420 :                     ; Master | VRES Interrupt (RESET button)
(1)  499/ 6000420 :                     ; ------------------------------------------------
(1)  500/ 6000420 :                     
(1)  501/ 6000420 :                     m_irq_vres:
(1)  502/ 6000420 : D11B                		mov	#_sysreg,r1
(1)  503/ 6000422 : 60F3                		mov	r15,r0
(1)  504/ 6000424 : 811A                		mov.w	r0,@(vresintclr,r1)
(1)  505/ 6000426 : E180                		mov	#_DMASOURCE0,r1		; Quickly cancel both DMA's
(1)  506/ 6000428 : E000                		mov	#0,r0
(1)  507/ 600042A : 110C                		mov	r0,@($30,r1)
(1)  508/ 600042C : 9043                		mov	#%0100010011100000,r0
(1)  509/ 600042E : 1103                		mov	r0,@($C,r1)
(1)  510/ 6000430 : E190                		mov	#_DMASOURCE1,r1
(1)  511/ 6000432 : E000                		mov	#0,r0
(1)  512/ 6000434 : 110C                		mov	r0,@($30,r1)
(1)  513/ 6000436 : 903E                		mov	#%0100010011100000,r0
(1)  514/ 6000438 : 1103                		mov	r0,@($C,r1)
(1)  515/ 600043A : D115                		mov	#_sysreg,r1		; If RV was active, freeze.
(1)  516/ 600043C : 8513                		mov.w	@(dreqctl,r1),r0
(1)  517/ 600043E : C801                		tst	#1,r0
(1)  518/ 6000440 : 8B0E                		bf	.rv_busy
(1)  519/ 6000442 : DF19                		mov	#(STACK_MSTR)-8,r15	; Reset Master's STACK
(1)  520/ 6000444 : D019                		mov	#SH2_M_HotStart,r0	; Write return point and status
(1)  521/ 6000446 : 2F02                		mov	r0,@r15
(1)  522/ 6000448 : 9037                		mov.w   #$F0,r0
(1)  523/ 600044A : 1F01                		mov	r0,@(4,r15)
(1)  524/ 600044C : D110                		mov	#_sysreg,r1		; Report as OK to everyone
(1)  525/ 600044E : D018                		mov	#"M_OK",r0
(1)  526/ 6000450 : 1108                		mov	r0,@(comm0,r1)
(1)  527/ 6000452 : 0009                		nop
(1)  528/ 6000454 : 0009                		nop
(1)  529/ 6000456 : 0009                		nop
(1)  530/ 6000458 : 0009                		nop
(1)  531/ 600045A : 0009                		nop
(1)  532/ 600045C : 002B                		rte
(1)  533/ 600045E : 0009                		nop
(1)  534/ 6000460 :                     		align 4
(1)  535/ 6000460 :                     .rv_busy:
(1)  536/ 6000460 : 9128                		mov	#_FRT,r1
(1)  537/ 6000462 : 8417                		mov.b	@(7,r1),r0
(1)  538/ 6000464 : CA02                		xor	#2,r0
(1)  539/ 6000466 : 8017                		mov.b	r0,@(7,r1)
(1)  540/ 6000468 : AFFE                		bra	*
(1)  541/ 600046A : 0009                		nop
(1)  542/ 600046C :                     		align 4
(1)  543/ 600046C :                     
(1)  544/ 600046C :                     ; =================================================================
(1)  545/ 600046C :                     ; ------------------------------------------------
(1)  546/ 600046C :                     ; Master | DMA Exit
(1)  547/ 600046C :                     ;
(1)  548/ 600046C :                     ; This will trigger when one of the DMA channels
(1)  549/ 600046C :                     ; with the interrupt bit enabled is a FEW writes
(1)  550/ 600046C :                     ; away from finishing the transfer.
(1)  551/ 600046C :                     ;
(1)  552/ 600046C :                     ; Does NOT exactly trigger at the very last
(1)  553/ 600046C :                     ; packet, I think.
(1)  554/ 600046C :                     ;
(1)  555/ 600046C :                     ; Check for the DMA-active bit BEFORE
(1)  556/ 600046C :                     ; writing _DMAOPERATION = 0
(1)  557/ 600046C :                     ; ------------------------------------------------
(1)  558/ 600046C :                     
(1)  559/ 600046C :                     		align 4
(1)  560/ 600046C :                     m_irq_dma:
(1)  561/ 600046C : 9122                		mov	#_FRT,r1
(1)  562/ 600046E : 8417                		mov.b	@(7,r1),r0
(1)  563/ 6000470 : CA02                		xor	#2,r0
(1)  564/ 6000472 : 8017                		mov.b	r0,@(7,r1)
(1)  565/ 6000474 : E180                		mov	#_DMASOURCE0,r1		; Pick DMA Channel 0
(1)  566/ 6000476 : 5013                .wait_dma:	mov	@($C,r1),r0
(1)  567/ 6000478 : C802                		tst	#%10,r0			; DMA finished?
(1)  568/ 600047A : 89FC                		bt	.wait_dma
(1)  569/ 600047C : E000                		mov	#0,r0			; _DMAOPERATION = 0
(1)  570/ 600047E : 110C                		mov	r0,@($30,r1)
(1)  571/ 6000480 : 9019                		mov	#%0100010011100000,r0	; Transfer mode + DMA enable OFF
(1)  572/ 6000482 : 1103                		mov	r0,@($C,r1)
(1)  573/ 6000484 : 000B                		rts
(1)  574/ 6000486 : 0009                		nop
(1)  575/ 6000488 :                     		align 4
(1)  576/ 6000488 :                     
(1)  577/ 6000488 :                     	; Save literals
(1)  578/ 6000488 : 2000 401C 2000 401A 		ltorg
                    2000 4000 2000 402C 
                    2000 4012 2601 4A00 
                    2000 4018 2000 4016 
                    0603 FFF8 0600 0752 
                    4D5F 4F4B FE10 44E0 
                    44E5 00F0           
(1)  579/ 60004BC :                     
(1)  580/ 60004BC :                     ; =================================================================
(1)  581/ 60004BC :                     ; ------------------------------------------------
(1)  582/ 60004BC :                     ; Slave | Unused Interrupt
(1)  583/ 60004BC :                     ; ------------------------------------------------
(1)  584/ 60004BC :                     
(1)  585/ 60004BC :                     		align 4
(1)  586/ 60004BC :                     s_irq_bad:
(1)  587/ 60004BC : 000B                		rts
(1)  588/ 60004BE : 0009                		nop
(1)  589/ 60004C0 :                     		align 4
(1)  590/ 60004C0 :                     
(1)  591/ 60004C0 :                     ; =================================================================
(1)  592/ 60004C0 :                     ; ------------------------------------------------
(1)  593/ 60004C0 :                     ; Slave | PWM Interrupt
(1)  594/ 60004C0 :                     ; ------------------------------------------------
(1)  595/ 60004C0 :                     
(1)  596/ 60004C0 :                     s_irq_pwm:
(1)  597/ 60004C0 : 9192                		mov	#_FRT,r1
(1)  598/ 60004C2 : 8417                		mov.b	@(7,r1),r0
(1)  599/ 60004C4 : CA02                		xor	#2,r0
(1)  600/ 60004C6 : 8017                		mov.b	r0,@(7,r1)
(1)  601/ 60004C8 : D13C                		mov	#_sysreg+pwmintclr,r1	; Clear CMD flag
(1)  602/ 60004CA : 2101                		mov.w	r0,@r1
(1)  603/ 60004CC : 0009                		nop
(1)  604/ 60004CE : 0009                		nop
(1)  605/ 60004D0 : 0009                		nop
(1)  606/ 60004D2 : 0009                		nop
(1)  607/ 60004D4 : 0009                		nop
(1)  608/ 60004D6 : 000B                		rts
(1)  609/ 60004D8 : 0009                		nop
(1)  610/ 60004DA :                     		align 4
(1)  611/ 60004DC :                     
(1)  612/ 60004DC :                     ; =================================================================
(1)  613/ 60004DC :                     ; ------------------------------------------------
(1)  614/ 60004DC :                     ; Slave | CMD Interrupt
(1)  615/ 60004DC :                     ; ------------------------------------------------
(1)  616/ 60004DC :                     
(1)  617/ 60004DC :                     ; TEMPORAL
(1)  618/ 60004DC : =$C0000000          MarsGema_Table	equ $C0000000
(1)  619/ 60004DC :                     
(1)  620/ 60004DC :                     		align 4
(1)  621/ 60004DC :                     s_irq_cmd:
(1)  622/ 60004DC : 9184                		mov	#_FRT,r1
(1)  623/ 60004DE : 8417                		mov.b	@(7,r1),r0
(1)  624/ 60004E0 : CA02                		xor	#2,r0
(1)  625/ 60004E2 : 8017                		mov.b	r0,@(7,r1)
(1)  626/ 60004E4 : D136                		mov	#_sysreg+cmdintclr,r1	; Clear CMD flag
(1)  627/ 60004E6 : 2101                		mov.w	r0,@r1
(1)  628/ 60004E8 :                     	; --------------------------------
(1)  629/ 60004E8 : 2F26                		mov	r2,@-r15
(1)  630/ 60004EA : 2F36                		mov	r3,@-r15
(1)  631/ 60004EC : 2F46                		mov	r4,@-r15
(1)  632/ 60004EE :                     
(1)  633/ 60004EE :                     	; --------------------------------
(1)  634/ 60004EE :                     	; Task $01
(1)  635/ 60004EE :                     	; --------------------------------
(1)  636/ 60004EE : D135                		mov	#_sysreg+comm8,r1	; Input
(1)  637/ 60004F0 : D235                		mov	#MarsGema_Table,r2	; Output
(1)  638/ 60004F2 : D336                		mov	#_sysreg+comm14,r3	; comm
(1)  639/ 60004F4 : 0009                		nop
(1)  640/ 60004F6 :                     .wait_1:
(1)  641/ 60004F6 : 6030                		mov.b	@r3,r0
(1)  642/ 60004F8 : C9F0                		and	#%11110000,r0
(1)  643/ 60004FA : C880                		tst	#%10000000,r0		; LOCK exit?
(1)  644/ 60004FC : 8908                		bt	.exit_c
(1)  645/ 60004FE : C840                		tst	#%01000000,r0		; Wait PASS
(1)  646/ 6000500 : 89F9                		bt	.wait_1
(1)  647/ 6000502 :                     .copy_1:
(1)  648/ 6000502 : 6012                		mov	@r1,r0			; Copy entire LONG
(1)  649/ 6000504 : 2202                		mov	r0,@r2
(1)  650/ 6000506 : 7204                		add	#4,r2			; Increment table pos
(1)  651/ 6000508 : 6030                		mov.b	@r3,r0
(1)  652/ 600050A : C9BF                		and	#%10111111,r0
(1)  653/ 600050C : AFF3                		bra	.wait_1
(1)  654/ 600050E : 2300                		mov.b	r0,@r3			; Clear PASS bit, Z80 loops
(1)  655/ 6000510 :                     .exit_c:
(1)  656/ 6000510 : 64F6                		mov	@r15+,r4
(1)  657/ 6000512 : 63F6                		mov	@r15+,r3
(1)  658/ 6000514 : 62F6                		mov	@r15+,r2
(1)  659/ 6000516 : 0009                		nop
(1)  660/ 6000518 : 0009                		nop
(1)  661/ 600051A : 0009                		nop
(1)  662/ 600051C : 0009                		nop
(1)  663/ 600051E : 0009                		nop
(1)  664/ 6000520 : 000B                		rts
(1)  665/ 6000522 : 0009                		nop
(1)  666/ 6000524 :                     		align 4
(1)  667/ 6000524 :                     
(1)  668/ 6000524 :                     ; =================================================================
(1)  669/ 6000524 :                     ; ------------------------------------------------
(1)  670/ 6000524 :                     ; Slave | HBlank
(1)  671/ 6000524 :                     ; ------------------------------------------------
(1)  672/ 6000524 :                     
(1)  673/ 6000524 :                     s_irq_h:
(1)  674/ 6000524 : 9160                		mov	#_FRT,r1
(1)  675/ 6000526 : 8417                		mov.b	@(7,r1),r0
(1)  676/ 6000528 : CA02                		xor	#2,r0
(1)  677/ 600052A : 8017                		mov.b	r0,@(7,r1)
(1)  678/ 600052C : D128                		mov	#_sysreg+hintclr,r1
(1)  679/ 600052E : 2101                		mov.w	r0,@r1
(1)  680/ 6000530 : 0009                		nop
(1)  681/ 6000532 : 0009                		nop
(1)  682/ 6000534 : 0009                		nop
(1)  683/ 6000536 : 0009                		nop
(1)  684/ 6000538 : 0009                		nop
(1)  685/ 600053A : 000B                		rts
(1)  686/ 600053C : 0009                		nop
(1)  687/ 600053E :                     		align 4
(1)  688/ 6000540 :                     
(1)  689/ 6000540 :                     ; =================================================================
(1)  690/ 6000540 :                     ; ------------------------------------------------
(1)  691/ 6000540 :                     ; Slave | VBlank
(1)  692/ 6000540 :                     ; ------------------------------------------------
(1)  693/ 6000540 :                     
(1)  694/ 6000540 :                     s_irq_v:
(1)  695/ 6000540 : 9152                		mov	#_FRT,r1
(1)  696/ 6000542 : 8417                		mov.b	@(7,r1),r0
(1)  697/ 6000544 : CA02                		xor	#2,r0
(1)  698/ 6000546 : 8017                		mov.b	r0,@(7,r1)
(1)  699/ 6000548 : D122                		mov	#_sysreg+vintclr,r1
(1)  700/ 600054A : 2101                		mov.w	r0,@r1
(1)  701/ 600054C : 0009                		nop
(1)  702/ 600054E : 0009                		nop
(1)  703/ 6000550 : 0009                		nop
(1)  704/ 6000552 : 0009                		nop
(1)  705/ 6000554 : 0009                		nop
(1)  706/ 6000556 : 000B                		rts
(1)  707/ 6000558 : 0009                		nop
(1)  708/ 600055A :                     		align 4
(1)  709/ 600055C :                     
(1)  710/ 600055C :                     ; =================================================================
(1)  711/ 600055C :                     ; ------------------------------------------------
(1)  712/ 600055C :                     ; Slave | VRES Interrupt (RESET button on Genesis)
(1)  713/ 600055C :                     ; ------------------------------------------------
(1)  714/ 600055C :                     
(1)  715/ 600055C :                     s_irq_vres:
(1)  716/ 600055C : D11E                		mov	#_sysreg,r1
(1)  717/ 600055E : 60F3                		mov	r15,r0
(1)  718/ 6000560 : 811A                		mov.w	r0,@(vresintclr,r1)
(1)  719/ 6000562 : E180                		mov	#_DMASOURCE0,r1		; Quickly cancel both DMA's
(1)  720/ 6000564 : E000                		mov	#0,r0
(1)  721/ 6000566 : 110C                		mov	r0,@($30,r1)
(1)  722/ 6000568 : 903F                		mov	#%0100010011100000,r0
(1)  723/ 600056A : 1103                		mov	r0,@($C,r1)
(1)  724/ 600056C : E190                		mov	#_DMASOURCE1,r1
(1)  725/ 600056E : E000                		mov	#0,r0
(1)  726/ 6000570 : 110C                		mov	r0,@($30,r1)
(1)  727/ 6000572 : 903A                		mov	#%0100010011100000,r0
(1)  728/ 6000574 : 1103                		mov	r0,@($C,r1)
(1)  729/ 6000576 : D118                		mov	#_sysreg,r1		; If RV was active, freeze.
(1)  730/ 6000578 : 8513                		mov.w	@(dreqctl,r1),r0
(1)  731/ 600057A : C801                		tst	#1,r0
(1)  732/ 600057C : 8B0E                		bf	.rv_busy
(1)  733/ 600057E : DF17                		mov	#(STACK_SLV)-8,r15	; Reset Slave's STACK
(1)  734/ 6000580 : D017                		mov	#SH2_S_HotStart,r0	; Write return point and status
(1)  735/ 6000582 : 2F02                		mov	r0,@r15
(1)  736/ 6000584 : 9032                		mov.w   #$F0,r0
(1)  737/ 6000586 : 1F01                		mov	r0,@(4,r15)
(1)  738/ 6000588 : D113                		mov	#_sysreg,r1
(1)  739/ 600058A : D016                		mov	#"S_OK",r0		; Report as OK to everyone
(1)  740/ 600058C : 1109                		mov	r0,@(comm4,r1)
(1)  741/ 600058E : 0009                		nop
(1)  742/ 6000590 : 0009                		nop
(1)  743/ 6000592 : 0009                		nop
(1)  744/ 6000594 : 0009                		nop
(1)  745/ 6000596 : 0009                		nop
(1)  746/ 6000598 : 002B                		rte
(1)  747/ 600059A : 0009                		nop
(1)  748/ 600059C :                     		align 4
(1)  749/ 600059C :                     .rv_busy:
(1)  750/ 600059C : 9124                		mov	#_FRT,r1
(1)  751/ 600059E : 8417                		mov.b	@(7,r1),r0
(1)  752/ 60005A0 : CA02                		xor	#2,r0
(1)  753/ 60005A2 : 8017                		mov.b	r0,@(7,r1)
(1)  754/ 60005A4 : AFFE                		bra	*
(1)  755/ 60005A6 : 0009                		nop
(1)  756/ 60005A8 :                     		align 4
(1)  757/ 60005A8 :                     
(1)  758/ 60005A8 :                     ; =================================================================
(1)  759/ 60005A8 :                     ; ------------------------------------------------
(1)  760/ 60005A8 :                     ; Master | DMA Exit
(1)  761/ 60005A8 :                     ;
(1)  762/ 60005A8 :                     ; This will trigger when one of the DMA channels
(1)  763/ 60005A8 :                     ; with the interrupt bit enabled is a FEW writes
(1)  764/ 60005A8 :                     ; away from finishing the transfer.
(1)  765/ 60005A8 :                     ;
(1)  766/ 60005A8 :                     ; Does NOT exactly trigger at the very last
(1)  767/ 60005A8 :                     ; packet, I think.
(1)  768/ 60005A8 :                     ;
(1)  769/ 60005A8 :                     ; Check for the DMA-active bit BEFORE
(1)  770/ 60005A8 :                     ; writing _DMAOPERATION = 0
(1)  771/ 60005A8 :                     ; ------------------------------------------------
(1)  772/ 60005A8 :                     
(1)  773/ 60005A8 :                     		align 4
(1)  774/ 60005A8 :                     s_irq_dma:
(1)  775/ 60005A8 : 911E                		mov	#_FRT,r1
(1)  776/ 60005AA : 8417                		mov.b	@(7,r1),r0
(1)  777/ 60005AC : CA02                		xor	#2,r0
(1)  778/ 60005AE : 8017                		mov.b	r0,@(7,r1)
(1)  779/ 60005B0 : E190                		mov	#_DMASOURCE1,r1		; Pick DMA Channel 1
(1)  780/ 60005B2 : 5013                .wait_dma:	mov	@($C,r1),r0
(1)  781/ 60005B4 : C802                		tst	#%10,r0			; DMA finished?
(1)  782/ 60005B6 : 89FC                		bt	.wait_dma
(1)  783/ 60005B8 :                     
(1)  784/ 60005B8 :                     ; 		mov	r2,@-r15
(1)  785/ 60005B8 :                     ; 		mov	r3,@-r15
(1)  786/ 60005B8 :                     ; 		mov	r4,@-r15
(1)  787/ 60005B8 :                     ;
(1)  788/ 60005B8 :                     ; ; 		mov	#_DMA
(1)  789/ 60005B8 :                     ; 		mov	@r15+,r4
(1)  790/ 60005B8 :                     ; 		mov	@r15+,r3
(1)  791/ 60005B8 :                     ; 		mov	@r15+,r2
(1)  792/ 60005B8 :                     
(1)  793/ 60005B8 :                     ; 		mov
(1)  794/ 60005B8 :                     ; 		mov	#0,r0			; _DMAOPERATION = 0
(1)  795/ 60005B8 :                     ; 		mov	r0,@($30,r1)
(1)  796/ 60005B8 :                     ; 		mov	#%0100010011100000,r0	; Transfer mode + DMA enable OFF
(1)  797/ 60005B8 :                     ; 		mov	r0,@($C,r1)
(1)  798/ 60005B8 : 000B                		rts
(1)  799/ 60005BA : 0009                		nop
(1)  800/ 60005BC :                     		align 4
(1)  801/ 60005BC :                     
(1)  802/ 60005BC : 2000 401C 2000 401A 		ltorg		; Save literals
                    2000 4028 C000 0000 
                    2000 402E 2000 4018 
                    2000 4016 2000 4000 
                    0603 EFF8 0600 08D8 
                    535F 4F4B FE10 44E0 
                    00F0                
(1)  803/ 60005EE :                     
(1)  804/ 60005EE :                     ; ; =================================================================
(1)  805/ 60005EE :                     ; ; ------------------------------------------------
(1)  806/ 60005EE :                     ; ; Master | Watchdog interrupt
(1)  807/ 60005EE :                     ; ; ------------------------------------------------
(1)  808/ 60005EE :                     ;
(1)  809/ 60005EE :                     ; ; m_irq_wdg:
(1)  810/ 60005EE :                     ; ; check cache_m_plgn.asm
(1)  811/ 60005EE :                     ;
(1)  812/ 60005EE :                     ; ; =================================================================
(1)  813/ 60005EE :                     ; ; ------------------------------------------------
(1)  814/ 60005EE :                     ; ; Slave | Watchdog interrupt
(1)  815/ 60005EE :                     ; ; ------------------------------------------------
(1)  816/ 60005EE :                     ;
(1)  817/ 60005EE :                     ; 		align 4
(1)  818/ 60005EE :                     ; s_irq_wdg:
(1)  819/ 60005EE :                     ; ; 		mov	#$F0,r0
(1)  820/ 60005EE :                     ; ; 		ldc	r0,sr
(1)  821/ 60005EE :                     ; 		mov	r2,@-r15
(1)  822/ 60005EE :                     ; 		mov	#_FRT,r1
(1)  823/ 60005EE :                     ; 		mov.b   @(7,r1),r0
(1)  824/ 60005EE :                     ; 		xor     #2,r0
(1)  825/ 60005EE :                     ; 		mov.b   r0,@(7,r1)
(1)  826/ 60005EE :                     ;
(1)  827/ 60005EE :                     ; 		mov.w	#$FE80,r1
(1)  828/ 60005EE :                     ; 		mov.w   #$A518,r0		; Watchdog OFF
(1)  829/ 60005EE :                     ; 		mov.w   r0,@r1
(1)  830/ 60005EE :                     ; 		or      #$20,r0			; ON again
(1)  831/ 60005EE :                     ; 		mov.w   r0,@r1
(1)  832/ 60005EE :                     ; 		mov	#$10,r2
(1)  833/ 60005EE :                     ; 		mov.w   #$5A00,r0		; Timer for the next one
(1)  834/ 60005EE :                     ; 		or	r2,r0
(1)  835/ 60005EE :                     ; 		mov.w	r0,@r1
(1)  836/ 60005EE :                     ;
(1)  837/ 60005EE :                     ; 		mov	@r15+,r2
(1)  838/ 60005EE :                     ; 		rts
(1)  839/ 60005EE :                     ; 		nop
(1)  840/ 60005EE :                     ; 		align 4
(1)  841/ 60005EE :                     ; 		ltorg
(1)  842/ 60005EE :                     
(1)  843/ 60005EE :                     ; ====================================================================
(1)  844/ 60005EE :                     ; ; ----------------------------------------------------------------
(1)  845/ 60005EE :                     ; ; Mars_ClearCacheRam
(1)  846/ 60005EE :                     ; ;
(1)  847/ 60005EE :                     ; ; Clear the entire "fast code" section for the current CPU
(1)  848/ 60005EE :                     ; ; ----------------------------------------------------------------
(1)  849/ 60005EE :                     ;
(1)  850/ 60005EE :                     ; 		align 4
(1)  851/ 60005EE :                     ; Mars_ClearCacheRam:
(1)  852/ 60005EE :                     ; 		mov.l	#$C0000000+$800,r1
(1)  853/ 60005EE :                     ; 		mov	#0,r0
(1)  854/ 60005EE :                     ; 		mov.w	#$80,r2
(1)  855/ 60005EE :                     ; .loop:
(1)  856/ 60005EE :                     ; 		mov	r0,@-r1
(1)  857/ 60005EE :                     ; 		mov	r0,@-r1
(1)  858/ 60005EE :                     ; 		mov	r0,@-r1
(1)  859/ 60005EE :                     ; 		mov	r0,@-r1
(1)  860/ 60005EE :                     ; 		dt	r2
(1)  861/ 60005EE :                     ; 		bf	.loop
(1)  862/ 60005EE :                     ; 		rts
(1)  863/ 60005EE :                     ; 		nop
(1)  864/ 60005EE :                     ; 		align 4
(1)  865/ 60005EE :                     
(1)  866/ 60005EE :                     ; ; ----------------------------------------------------------------
(1)  867/ 60005EE :                     ; ; Mars_LoadCacheRam
(1)  868/ 60005EE :                     ; ;
(1)  869/ 60005EE :                     ; ; Loads "fast code" into the SH2's cache, $800 bytes maximum.
(1)  870/ 60005EE :                     ; ;
(1)  871/ 60005EE :                     ; ; Input:
(1)  872/ 60005EE :                     ; ; r1 - CACHE Code to send
(1)  873/ 60005EE :                     ; ; r2 - Size/4
(1)  874/ 60005EE :                     ; ;
(1)  875/ 60005EE :                     ; ; Breaks:
(1)  876/ 60005EE :                     ; ; r3
(1)  877/ 60005EE :                     ; ; ----------------------------------------------------------------
(1)  878/ 60005EE :                     ;
(1)  879/ 60005EE :                     ; 		align 4
(1)  880/ 60005EE :                     ; Mars_LoadCacheRam:
(1)  881/ 60005EE :                     ; 		stc	sr,@-r15	; Interrupts OFF
(1)  882/ 60005EE :                     ; 		mov.b	#$F0,r0		; ** $F0
(1)  883/ 60005EE :                     ; 		extu.b	r0,r0
(1)  884/ 60005EE :                     ; 		ldc	r0,sr
(1)  885/ 60005EE :                     ; 		mov	#_CCR,r3
(1)  886/ 60005EE :                     ; 		mov	#%00010000,r0	; Cache purge + Disable
(1)  887/ 60005EE :                     ; 		mov.w	r0,@r3
(1)  888/ 60005EE :                     ; 		nop
(1)  889/ 60005EE :                     ; 		nop
(1)  890/ 60005EE :                     ; 		nop
(1)  891/ 60005EE :                     ; 		nop
(1)  892/ 60005EE :                     ; 		nop
(1)  893/ 60005EE :                     ; 		nop
(1)  894/ 60005EE :                     ; 		nop
(1)  895/ 60005EE :                     ; 		nop
(1)  896/ 60005EE :                     ; 		mov	#%00001001,r0	; Cache two-way mode + Enable
(1)  897/ 60005EE :                     ; 		mov.w	r0,@r3
(1)  898/ 60005EE :                     ; 		mov 	#$C0000000,r3
(1)  899/ 60005EE :                     ; .copy:
(1)  900/ 60005EE :                     ; 		mov 	@r1+,r0
(1)  901/ 60005EE :                     ; 		mov 	r0,@r3
(1)  902/ 60005EE :                     ; 		dt	r2
(1)  903/ 60005EE :                     ; 		bf/s	.copy
(1)  904/ 60005EE :                     ; 		add 	#4,r3
(1)  905/ 60005EE :                     ; 		rts
(1)  906/ 60005EE :                     ; 		ldc	@r15+,sr
(1)  907/ 60005EE :                     ; 		align 4
(1)  908/ 60005EE :                     ; 		ltorg
(1)  909/ 60005EE :                     
(1)  910/ 60005EE :                     ; ; --------------------------------------------------------
(1)  911/ 60005EE :                     ; ; Mars_SetWatchdog
(1)  912/ 60005EE :                     ; ;
(1)  913/ 60005EE :                     ; ; Prepares watchdog interrupt
(1)  914/ 60005EE :                     ; ;
(1)  915/ 60005EE :                     ; ; Input:
(1)  916/ 60005EE :                     ; ; r1 - Watchdog CPU clock divider
(1)  917/ 60005EE :                     ; ; r2 - Watchdog Pre-timer
(1)  918/ 60005EE :                     ; ; --------------------------------------------------------
(1)  919/ 60005EE :                     ;
(1)  920/ 60005EE :                     ; 		align 4
(1)  921/ 60005EE :                     ; Mars_SetWatchdog:
(1)  922/ 60005EE :                     ; 		stc	sr,r4
(1)  923/ 60005EE :                     ; 		mov.b	#$F0,r0			; ** $F0
(1)  924/ 60005EE :                     ; 		extu.b	r0,r0
(1)  925/ 60005EE :                     ; 		ldc 	r0,sr
(1)  926/ 60005EE :                     ; 		mov.w	#_CCR&$FFFF,r3		; Reset CACHE
(1)  927/ 60005EE :                     ; 		mov	#%00001000,r0		; Two-way mode
(1)  928/ 60005EE :                     ; 		mov.w	r0,@r3
(1)  929/ 60005EE :                     ; 		mov	#%00011001,r0		; Cache purge / Two-way mode / Cache ON
(1)  930/ 60005EE :                     ; 		mov.w	r0,@r3
(1)  931/ 60005EE :                     ; 		mov.w	#$FE80,r3		; $FFFFFE80
(1)  932/ 60005EE :                     ; 		mov.w	#$5A00,r0		; Watchdog pre-timer
(1)  933/ 60005EE :                     ; 		or	r2,r0
(1)  934/ 60005EE :                     ; 		mov.w	r0,@r3
(1)  935/ 60005EE :                     ; 		mov.w	#$A538,r0		; Enable Watchdog
(1)  936/ 60005EE :                     ; 		or	r1,r0
(1)  937/ 60005EE :                     ; 		mov.w	r0,@r3
(1)  938/ 60005EE :                     ; 		ldc	r4,sr
(1)  939/ 60005EE :                     ; 		rts
(1)  940/ 60005EE :                     ; 		nop
(1)  941/ 60005EE :                     ; 		align 4
(1)  942/ 60005EE :                     ; 		ltorg
(1)  943/ 60005EE :                     
(1)  944/ 60005EE :                     ; ====================================================================
(1)  945/ 60005EE :                     ; ----------------------------------------------------------------
(1)  946/ 60005EE :                     ; MARS System features
(1)  947/ 60005EE :                     ; ----------------------------------------------------------------
(1)  948/ 60005EE :                     
(1)  949/ 60005EE :                     		include "system/mars/video.asm"
(2)    1/ 60005EE :                     ; ====================================================================
(2)    2/ 60005EE :                     ; ----------------------------------------------------------------
(2)    3/ 60005EE :                     ; 32X Video
(2)    4/ 60005EE :                     ;
(2)    5/ 60005EE :                     ; Some routines are located on the cache folder for
(2)    6/ 60005EE :                     ; speed reasons.
(2)    7/ 60005EE :                     ; ----------------------------------------------------------------
(2)    8/ 60005EE :                     
(2)    9/ 60005EE :                     ; --------------------------------------------------------
(2)   10/ 60005EE :                     ; Settings
(2)   11/ 60005EE :                     ; --------------------------------------------------------
(2)   12/ 60005EE :                     
(2)   13/ 60005EE :                     ; ; SDRAM
(2)   14/ 60005EE :                     ; MAX_MSCRNBUFF	equ $2C000	; MAX SDRAM for each Screen mode
(2)   15/ 60005EE :                     ; MAX_SSPRSPD	equ 8		; Supersprite box increment: Size+this (maximum Super Sprite speed)
(2)   16/ 60005EE :                     ; MAX_FACES	equ 980		; MAX polygon faces for 3D models
(2)   17/ 60005EE :                     ; MAX_SVDP_PZ	equ 980+96	; MAX polygon pieces to draw
(2)   18/ 60005EE :                     ; MAX_ZDIST	equ -$1900	; Maximum 3D field distance (-Z)
(2)   19/ 60005EE :                     
(2)   20/ 60005EE :                     ; FRAMEBUFFER
(2)   21/ 60005EE : =$1F800             FBVRAM_BLANK	equ $1F800	; Location of the BLANK line
(2)   22/ 60005EE : =$1D000             FBVRAM_PATCH	equ $1D000	; Framebuffer location for the affected XShift lines
(2)   23/ 60005EE :                     
(2)   24/ 60005EE :                     ; --------------------------------------------------------
(2)   25/ 60005EE :                     ; Variables
(2)   26/ 60005EE :                     ; --------------------------------------------------------
(2)   27/ 60005EE :                     
(2)   28/ 60005EE :                     ; ; Variables for 3D mode.
(2)   29/ 60005EE :                     ; SCREEN_WIDTH	equ 320		; Screen width and height positions used
(2)   30/ 60005EE :                     ; SCREEN_HEIGHT	equ 224		; by 3D object rendering
(2)   31/ 60005EE :                     ; PLGN_TEXURE	equ %10000000	; plypz_type (MSB)
(2)   32/ 60005EE :                     ; PLGN_TRI	equ %01000000
(2)   33/ 60005EE :                     
(2)   34/ 60005EE :                     ; ; --------------------------------------------------------
(2)   35/ 60005EE :                     ; ; Structs
(2)   36/ 60005EE :                     ; ; --------------------------------------------------------
(2)   37/ 60005EE :                     ;
(2)   38/ 60005EE :                     ; 		struct 0
(2)   39/ 60005EE :                     ; scrl_xpos_old	ds.l 1		; OLD Xpos position
(2)   40/ 60005EE :                     ; scrl_ypos_old	ds.l 1		; OLD Ypos position
(2)   41/ 60005EE :                     ; scrl_xset	ds.l 1		; Scroll X counter
(2)   42/ 60005EE :                     ; scrl_yset	ds.l 1		; Scroll Y counter
(2)   43/ 60005EE :                     ; scrl_blksize	ds.l 1		; Block size for scrolling
(2)   44/ 60005EE :                     ; scrl_intrl_size	ds.l 1		; Internal scroll FULL size (scrl_intrl_w*scrl_intrl_h)
(2)   45/ 60005EE :                     ; scrl_intrl_w	ds.l 1		; Internal scroll Width (MUST be larger than 320)
(2)   46/ 60005EE :                     ; scrl_intrl_h	ds.l 1		; Internal scroll Height
(2)   47/ 60005EE :                     ; scrl_fbpos_y	ds.l 1		; Screen's Y position
(2)   48/ 60005EE :                     ; scrl_fbpos	ds.l 1		; Screen's TOP-LEFT position
(2)   49/ 60005EE :                     ; scrl_fbdata	ds.l 1		; Screen data location on framebuffer
(2)   50/ 60005EE :                     ; scrl_xpos	ds.l 1		; $0000.0000
(2)   51/ 60005EE :                     ; scrl_ypos	ds.l 1		; $0000.0000
(2)   52/ 60005EE :                     ; sizeof_mscrl	ds.l 0
(2)   53/ 60005EE :                     ; 		endstruct
(2)   54/ 60005EE :                     ;
(2)   55/ 60005EE :                     ; 		struct 0
(2)   56/ 60005EE :                     ; plypz_type	ds.l 1		; Type + Material settings (width + index add)
(2)   57/ 60005EE :                     ; plypz_mtrl	ds.l 1		; Material data (ROM or SDRAM)
(2)   58/ 60005EE :                     ; plypz_ytb	ds.l 1		; Ytop | Ybottom
(2)   59/ 60005EE :                     ; plypz_xl	ds.l 1		;  Screen X-Left | X-Right  16-bit
(2)   60/ 60005EE :                     ; plypz_src_xl	ds.l 1		; Texture X-Left | X-Right  16-bit
(2)   61/ 60005EE :                     ; plypz_src_yl	ds.l 1		; Texture Y-Top  | Y-Bottom 16-bit
(2)   62/ 60005EE :                     ; plypz_xl_dx	ds.l 1		; 0000.0000
(2)   63/ 60005EE :                     ; plypz_xr_dx	ds.l 1		; 0000.0000
(2)   64/ 60005EE :                     ; plypz_src_xl_dx	ds.l 1
(2)   65/ 60005EE :                     ; plypz_src_xr_dx	ds.l 1
(2)   66/ 60005EE :                     ; plypz_src_yl_dx	ds.l 1
(2)   67/ 60005EE :                     ; plypz_src_yr_dx	ds.l 1
(2)   68/ 60005EE :                     ; sizeof_plypz	ds.l 0
(2)   69/ 60005EE :                     ; 		endstruct
(2)   70/ 60005EE :                     ;
(2)   71/ 60005EE :                     ; ; Polygon data
(2)   72/ 60005EE :                     ; ; Size: $38
(2)   73/ 60005EE :                     ; 		struct 0
(2)   74/ 60005EE :                     ; polygn_type	ds.l 1		; %MSww wwww aaaa aaaa | %MS w-Texture width, a-Pixel increment
(2)   75/ 60005EE :                     ; polygn_mtrl	ds.l 1		; Material Type: Color (0-255) or Texture data address
(2)   76/ 60005EE :                     ; polygn_points	ds.l 4*2	; X/Y positions
(2)   77/ 60005EE :                     ; polygn_srcpnts	ds.w 4*2	; X/Y texture points 16-bit, Ignored on solid color.
(2)   78/ 60005EE :                     ; sizeof_polygn	ds.l 0
(2)   79/ 60005EE :                     ; 		endstruct
(2)   80/ 60005EE :                     
(2)   81/ 60005EE :                     ; ====================================================================
(2)   82/ 60005EE :                     ; ----------------------------------------------------------------
(2)   83/ 60005EE :                     ; Init MARS Video
(2)   84/ 60005EE :                     ;
(2)   85/ 60005EE :                     ; Breaks:
(2)   86/ 60005EE :                     ; r1-r4
(2)   87/ 60005EE :                     ; ----------------------------------------------------------------
(2)   88/ 60005EE :                     
(2)   89/ 60005EE :                     		align 4
(2)   90/ 60005F0 :                     MarsVideo_Init:
(2)   91/ 60005F0 : 4F22                		sts	pr,@-r15
(2)   92/ 60005F2 : D10F                		mov	#_sysreg,r1
(2)   93/ 60005F4 : 9024                		mov 	#FM,r0			; Set SuperVDP permission for SH2
(2)   94/ 60005F6 : 8010                  		mov.b	r0,@(adapter,r1)	; ** The Genesis side will control the
(2)   95/ 60005F8 : D10E                		mov 	#_vdpreg,r1		; 256-color palette using DREQ **
(2)   96/ 60005FA : E000                		mov	#0,r0			; Start at BLANK
(2)   97/ 60005FC : 8011                		mov.b	r0,@(bitmapmd,r1)
(2)   98/ 60005FE : D20E                		mov	#_framebuffer,r2	; Make default nametables
(2)   99/ 6000600 : B006                		bsr	.def_fb
(2)  100/ 6000602 : 0009                		nop
(2)  101/ 6000604 : B004                		bsr	.def_fb
(2)  102/ 6000606 : 0009                		nop
(2)  103/ 6000608 : 4F26                		lds	@r15+,pr
(2)  104/ 600060A : 000B                		rts
(2)  105/ 600060C : 0009                		nop
(2)  106/ 600060E :                     		align 4
(2)  107/ 6000610 :                     .def_fb:
(2)  108/ 6000610 : 6323                		mov	r2,r3
(2)  109/ 6000612 : D00A                		mov	#FBVRAM_BLANK/2,r0	; The very last usable (blank) line.
(2)  110/ 6000614 : 9415                		mov	#240,r4
(2)  111/ 6000616 :                     .nxt_lne:
(2)  112/ 6000616 : 2301                		mov.w	r0,@r3
(2)  113/ 6000618 : 4410                		dt	r4
(2)  114/ 600061A : 8FFC                		bf/s	.nxt_lne
(2)  115/ 600061C : 7302                		add	#2,r3
(2)  116/ 600061E : 841B                		mov.b	@(framectl,r1),r0	; Frameswap request
(2)  117/ 6000620 : CA01                		xor	#1,r0
(2)  118/ 6000622 : 6303                		mov	r0,r3
(2)  119/ 6000624 : 801B                		mov.b	r0,@(framectl,r1)
(2)  120/ 6000626 : 841B                .wait_frm:	mov.b	@(framectl,r1),r0	; And wait until it flips
(2)  121/ 6000628 : 3300                		cmp/eq	r0,r3
(2)  122/ 600062A : 8BFC                		bf	.wait_frm
(2)  123/ 600062C : 000B                		rts
(2)  124/ 600062E : 0009                		nop
(2)  125/ 6000630 :                     		align 4
(2)  126/ 6000630 : 2000 4000 2000 4100 		ltorg
                    2400 0000 0000 FC00 
                    0080 00F0           
(2)  127/ 6000644 :                     
(2)  128/ 6000644 :                     ; ====================================================================
(2)  129/ 6000644 :                     ; ----------------------------------------------------------------
(2)  130/ 6000644 :                     ; Subroutines
(2)  131/ 6000644 :                     ; ----------------------------------------------------------------
(2)  132/ 6000644 :                     
(2)  133/ 6000644 :                     ; ; --------------------------------------------------------
(2)  134/ 6000644 :                     ; ; VideoMars_ClearScreen
(2)  135/ 6000644 :                     ; ;
(2)  136/ 6000644 :                     ; ; Clears screen using VDPFILL
(2)  137/ 6000644 :                     ; ;
(2)  138/ 6000644 :                     ; ; Input:
(2)  139/ 6000644 :                     ; ; r1 | Framebuffer VRAM location
(2)  140/ 6000644 :                     ; ; r2 | Width/2
(2)  141/ 6000644 :                     ; ; r3 | Height
(2)  142/ 6000644 :                     ; ; r4 | Pixel(s) to write
(2)  143/ 6000644 :                     ; ;
(2)  144/ 6000644 :                     ; ; Uses:
(2)  145/ 6000644 :                     ; ; r5-r6
(2)  146/ 6000644 :                     ; ; --------------------------------------------------------
(2)  147/ 6000644 :                     ;
(2)  148/ 6000644 :                     ; ; TODO: Fix this.
(2)  149/ 6000644 :                     ;
(2)  150/ 6000644 :                     ; 		align 4
(2)  151/ 6000644 :                     ; MarsVideo_ClearScreen:
(2)  152/ 6000644 :                     ; 		shlr	r1
(2)  153/ 6000644 :                     ; 		mov	r1,r5
(2)  154/ 6000644 :                     ; 		mov	#_vdpreg,r6
(2)  155/ 6000644 :                     ; .fb_loop:
(2)  156/ 6000644 :                     ; 		mov	r2,r0
(2)  157/ 6000644 :                     ; 		mov.w	r0,@(filllength,r6)
(2)  158/ 6000644 :                     ; 		mov	r1,r0
(2)  159/ 6000644 :                     ; 		mov.w	r0,@(fillstart,r6)
(2)  160/ 6000644 :                     ; 		mov	r4,r0
(2)  161/ 6000644 :                     ; 		mov.w	r0,@(filldata,r6)
(2)  162/ 6000644 :                     ; .wait_fb2:	mov.w	@(vdpsts,r6),r0
(2)  163/ 6000644 :                     ; 		tst	#%10,r0
(2)  164/ 6000644 :                     ; 		bf	.wait_fb2
(2)  165/ 6000644 :                     ; 		dt	r3
(2)  166/ 6000644 :                     ; 		bf/s	.fb_loop
(2)  167/ 6000644 :                     ; 		add	r5,r1
(2)  168/ 6000644 :                     ; .no_redraw_2:
(2)  169/ 6000644 :                     ; 		rts
(2)  170/ 6000644 :                     ; 		nop
(2)  171/ 6000644 :                     ; 		align 4
(2)  172/ 6000644 :                     ;
(2)  173/ 6000644 :                     ; ; --------------------------------------------------------
(2)  174/ 6000644 :                     ; ; MarsVideo_ResetNameTbl
(2)  175/ 6000644 :                     ; ;
(2)  176/ 6000644 :                     ; ; Reset the nametable, points all lines into a blank
(2)  177/ 6000644 :                     ; ; line (FBVRAM_BLANK)
(2)  178/ 6000644 :                     ; ;
(2)  179/ 6000644 :                     ; ; Breaks:
(2)  180/ 6000644 :                     ; ; r1-r2
(2)  181/ 6000644 :                     ; ; --------------------------------------------------------
(2)  182/ 6000644 :                     ;
(2)  183/ 6000644 :                     ; MarsVideo_ResetNameTbl:
(2)  184/ 6000644 :                     ; 		mov	#_framebuffer,r1
(2)  185/ 6000644 :                     ; 		mov	#FBVRAM_BLANK,r0
(2)  186/ 6000644 :                     ; 		mov	#240,r2
(2)  187/ 6000644 :                     ; .nxt_lne2:
(2)  188/ 6000644 :                     ; 		mov.w	r0,@r1
(2)  189/ 6000644 :                     ; 		dt	r2
(2)  190/ 6000644 :                     ; 		bf/s	.nxt_lne2
(2)  191/ 6000644 :                     ; 		add	#2,r1
(2)  192/ 6000644 :                     ; 		rts
(2)  193/ 6000644 :                     ; 		nop
(2)  194/ 6000644 :                     ; 		align 4
(2)  195/ 6000644 :                     ;
(2)  196/ 6000644 :                     ; --------------------------------------------------------
(2)  197/ 6000644 :                     ; MarsVideo_MakeNameTbl
(2)  198/ 6000644 :                     ;
(2)  199/ 6000644 :                     ; Builds the nametable for a normal screen, if
(2)  200/ 6000644 :                     ; marsGbl_WaveEnable is set, it will add a
(2)  201/ 6000644 :                     ; wave effect to the linetable (in WORDS)
(2)  202/ 6000644 :                     ;
(2)  203/ 6000644 :                     ; Input:
(2)  204/ 6000644 :                     ; r1 | Framebuffer position
(2)  205/ 6000644 :                     ; r2 | Width (Width*2 for Direct color)
(2)  206/ 6000644 :                     ; r3 | Height
(2)  207/ 6000644 :                     ; r4 | Y line position
(2)  208/ 6000644 :                     ;
(2)  209/ 6000644 :                     ; Uses:
(2)  210/ 6000644 :                     ; r1-r11
(2)  211/ 6000644 :                     ; --------------------------------------------------------
(2)  212/ 6000644 :                     
(2)  213/ 6000644 :                     MarsVideo_MakeNameTbl:
(2)  214/ 6000644 : DA1E                		mov	#_framebuffer,r10
(2)  215/ 6000646 : 4400                		shll	r4
(2)  216/ 6000648 : 3A4C                		add	r4,r10
(2)  217/ 600064A : D51E                		mov 	#_vdpreg,r5
(2)  218/ 600064C : 8451                		mov.b	@(bitmapmd,r5),r0
(2)  219/ 600064E : C903                		and	#%11,r0
(2)  220/ 6000650 : 8803                		cmp/eq	#3,r0			; Don't mess with the RLE lines.
(2)  221/ 6000652 : 8906                		bt	.cant_use
(2)  222/ 6000654 :                     ; 		mov.w	@(marsGbl_WaveEnable,gbr),r0
(2)  223/ 6000654 :                     ; 		tst	r0,r0
(2)  224/ 6000654 :                     ; 		bt	.linetbl_normal
(2)  225/ 6000654 :                     ;
(2)  226/ 6000654 :                     ; 	; Special linetable with
(2)  227/ 6000654 :                     ; 	; wave deformation.
(2)  228/ 6000654 :                     ; 		mov.w	@(marsGbl_WaveSpd,gbr),r0
(2)  229/ 6000654 :                     ; 		mov	r0,r4
(2)  230/ 6000654 :                     ; 		mov.w	@(marsGbl_WaveTan,gbr),r0
(2)  231/ 6000654 :                     ; 		mov	#$7FF,r5
(2)  232/ 6000654 :                     ; 		add	r4,r0			; wave speed
(2)  233/ 6000654 :                     ; 		and	r5,r0
(2)  234/ 6000654 :                     ; 		mov.w	r0,@(marsGbl_WaveTan,gbr)
(2)  235/ 6000654 :                     ; 		mov	r0,r7
(2)  236/ 6000654 :                     ; 		mov.w	@(marsGbl_WaveMax,gbr),r0
(2)  237/ 6000654 :                     ; 		mov	r0,r5
(2)  238/ 6000654 :                     ; 		mov.w	@(marsGbl_WaveDeform,gbr),r0
(2)  239/ 6000654 :                     ; 		mov	r0,r4
(2)  240/ 6000654 :                     ; 		mov	#0,r6
(2)  241/ 6000654 :                     ; 		mov	#$7FF,r11
(2)  242/ 6000654 :                     ; 		mov	#sin_table,r12
(2)  243/ 6000654 :                     ; .nxt_lne:
(2)  244/ 6000654 :                     ; 		mov	r7,r0
(2)  245/ 6000654 :                     ; 		add	r4,r7			; wave distord
(2)  246/ 6000654 :                     ; 		and	r11,r7
(2)  247/ 6000654 :                     ; 		shll2	r0
(2)  248/ 6000654 :                     ; 		mov	@(r0,r12),r9
(2)  249/ 6000654 :                     ; 		dmuls	r5,r9
(2)  250/ 6000654 :                     ; 		sts	macl,r9
(2)  251/ 6000654 :                     ; 		shlr16	r9
(2)  252/ 6000654 :                     ; 		exts.w	r9,r9
(2)  253/ 6000654 :                     ; 		mov	r1,r0
(2)  254/ 6000654 :                     ; 		add	r6,r0
(2)  255/ 6000654 :                     ; 		add	r9,r0
(2)  256/ 6000654 :                     ; 		shlr	r0
(2)  257/ 6000654 :                     ; 		mov.w	r0,@r10
(2)  258/ 6000654 :                     ; 		add	r2,r6
(2)  259/ 6000654 :                     ; 		dt	r3
(2)  260/ 6000654 :                     ; 		bf/s	.nxt_lne
(2)  261/ 6000654 :                     ; 		add	#2,r10
(2)  262/ 6000654 :                     ; 		rts
(2)  263/ 6000654 :                     ; 		nop
(2)  264/ 6000654 :                     ; 		align 4
(2)  265/ 6000654 :                     
(2)  266/ 6000654 :                     .linetbl_normal:
(2)  267/ 6000654 : 4101                		shlr	r1
(2)  268/ 6000656 : 4201                		shlr	r2
(2)  269/ 6000658 :                     .nxt_lne2:
(2)  270/ 6000658 : 2A11                		mov.w	r1,@r10
(2)  271/ 600065A : 312C                		add	r2,r1
(2)  272/ 600065C : 4310                		dt	r3
(2)  273/ 600065E : 8FFB                		bf/s	.nxt_lne2
(2)  274/ 6000660 : 7A02                		add	#2,r10
(2)  275/ 6000662 :                     .cant_use:
(2)  276/ 6000662 : 000B                		rts
(2)  277/ 6000664 : 0009                		nop
(2)  278/ 6000666 :                     		align 4
(2)  279/ 6000668 :                     
(2)  280/ 6000668 :                     ; --------------------------------------------------------
(2)  281/ 6000668 :                     ; MarsVideo_FixTblShift
(2)  282/ 6000668 :                     ;
(2)  283/ 6000668 :                     ; Fix the affected $xxFF lines by scrolling using the
(2)  284/ 6000668 :                     ; linetable. MUST call this BEFORE flipping
(2)  285/ 6000668 :                     ; the Framebuffer.
(2)  286/ 6000668 :                     ;
(2)  287/ 6000668 :                     ; Input:
(2)  288/ 6000668 :                     ; r1 | Start line
(2)  289/ 6000668 :                     ; r2 | Number of lines
(2)  290/ 6000668 :                     ; r3 | Location for the fixed lines
(2)  291/ 6000668 :                     ;
(2)  292/ 6000668 :                     ; Break:
(2)  293/ 6000668 :                     ; r7-r14
(2)  294/ 6000668 :                     ; --------------------------------------------------------
(2)  295/ 6000668 :                     
(2)  296/ 6000668 :                     MarsVideo_FixTblShift:
(2)  297/ 6000668 : DE16                		mov	#_vdpreg,r14
(2)  298/ 600066A : 84E1                		mov.b	@(bitmapmd,r14),r0		; Check if we are on indexed mode
(2)  299/ 600066C : C903                		and	#%11,r0
(2)  300/ 600066E : 8801                		cmp/eq	#1,r0
(2)  301/ 6000670 : 8B23                		bf	.ptchset
(2)  302/ 6000672 : C500                		mov.w	@(marsGbl_XShift,gbr),r0	; XShift is set?
(2)  303/ 6000674 : C901                		and	#1,r0
(2)  304/ 6000676 : 2008                		tst	r0,r0
(2)  305/ 6000678 : 891F                		bt	.ptchset
(2)  306/ 600067A :                     
(2)  307/ 600067A : DE11                		mov	#_framebuffer,r14		; r14 - Framebuffer BASE
(2)  308/ 600067C : 6CE3                		mov	r14,r12				; r12 - Framebuffer output for the patched pixel lines
(2)  309/ 600067E : 3C3C                		add	r3,r12
(2)  310/ 6000680 : 6013                		mov	r1,r0
(2)  311/ 6000682 : 4008                		shll2	r0
(2)  312/ 6000684 : 3E0C                		add	r0,r14
(2)  313/ 6000686 : 6DE3                		mov	r14,r13				; r13 - Framebuffer lines to check
(2)  314/ 6000688 : 6B23                		mov	r2,r11				; r11 - Lines to check
(2)  315/ 600068A : E0FF                		mov	#-1,r0
(2)  316/ 600068C : 6A0C                		extu.b	r0,r10				; r10 - AND byte to check ($FF)
(2)  317/ 600068E : 690D                		extu.w	r0,r9				;  r9 - AND word limit ($FFFF)
(2)  318/ 6000690 :                     .loop:
(2)  319/ 6000690 : 60D1                		mov.w	@r13,r0
(2)  320/ 6000692 : 2099                		and	r9,r0
(2)  321/ 6000694 : 6703                		mov	r0,r7
(2)  322/ 6000696 : 20A9                		and	r10,r0
(2)  323/ 6000698 : 30A0                		cmp/eq	r10,r0
(2)  324/ 600069A : 8B0B                		bf	.tblexit
(2)  325/ 600069C : 4700                		shll	r7
(2)  326/ 600069E : 37EC                		add	r14,r7
(2)  327/ 60006A0 : 60C3                		mov	r12,r0
(2)  328/ 60006A2 : 4001                		shlr	r0
(2)  329/ 60006A4 : 2D01                		mov.w	r0,@r13
(2)  330/ 60006A6 : 930F                		mov	#(320+4)/2,r3
(2)  331/ 60006A8 :                     .copy:
(2)  332/ 60006A8 : 6071                		mov.w	@r7,r0
(2)  333/ 60006AA : 2C01                		mov.w	r0,@r12
(2)  334/ 60006AC : 7702                		add	#2,r7
(2)  335/ 60006AE : 4310                		dt	r3
(2)  336/ 60006B0 : 8FFA                		bf/s	.copy
(2)  337/ 60006B2 : 7C02                		add	#2,r12
(2)  338/ 60006B4 :                     .tblexit:
(2)  339/ 60006B4 : 4B10                		dt	r11
(2)  340/ 60006B6 : 8FEB                		bf/s	.loop
(2)  341/ 60006B8 : 7D02                		add	#2,r13
(2)  342/ 60006BA :                     .ptchset:
(2)  343/ 60006BA : 000B                		rts
(2)  344/ 60006BC : 0009                		nop
(2)  345/ 60006BE :                     		align 4
(2)  346/ 60006C0 : 2400 0000 2000 4100 		ltorg
                    00A2                
(2)  347/ 60006CA :                     
(2)  348/ 60006CA :                     ; ; ====================================================================
(2)  349/ 60006CA :                     ; ; ----------------------------------------------------------------
(2)  350/ 60006CA :                     ; ; 2D Section
(2)  351/ 60006CA :                     ; ;
(2)  352/ 60006CA :                     ; ; Routines that write to the framebuffer are
(2)  353/ 60006CA :                     ; ; located at cache_m_2D.asm
(2)  354/ 60006CA :                     ; ; ----------------------------------------------------------------
(2)  355/ 60006CA :                     ;
(2)  356/ 60006CA :                     ; ; --------------------------------------------------------
(2)  357/ 60006CA :                     ; ; MarsVideo_MkScrlField
(2)  358/ 60006CA :                     ; ;
(2)  359/ 60006CA :                     ; ; This builds a new internal scrolling background
(2)  360/ 60006CA :                     ; ;
(2)  361/ 60006CA :                     ; ; Input:
(2)  362/ 60006CA :                     ; ; r1 | Background buffer to initialize
(2)  363/ 60006CA :                     ; ; r2 | Framebuffer VRAM position
(2)  364/ 60006CA :                     ; ; r3 | Scroll Width (320 or large)
(2)  365/ 60006CA :                     ; ; r4 | Scroll Height
(2)  366/ 60006CA :                     ; ; r5 | Scroll block size (4 pixels minimum)
(2)  367/ 60006CA :                     ; ; r6 | X start
(2)  368/ 60006CA :                     ; ; r7 | Y start
(2)  369/ 60006CA :                     ; ;
(2)  370/ 60006CA :                     ; ; NOTE:
(2)  371/ 60006CA :                     ; ; At the very last scrollable line: The next 320
(2)  372/ 60006CA :                     ; ; pixels will be visible until that line resets
(2)  373/ 60006CA :                     ; ; into 0 again.
(2)  374/ 60006CA :                     ; ; When you write pixels in in the range of 0-320,
(2)  375/ 60006CA :                     ; ; write the same pixels at the very end of
(2)  376/ 60006CA :                     ; ; the scrolling area (add width*height)
(2)  377/ 60006CA :                     ; ;
(2)  378/ 60006CA :                     ; ; Breaks:
(2)  379/ 60006CA :                     ; ; r3-r5,macl
(2)  380/ 60006CA :                     ; ; --------------------------------------------------------
(2)  381/ 60006CA :                     ;
(2)  382/ 60006CA :                     ; 		align 4
(2)  383/ 60006CA :                     ; MarsVideo_MkScrlField:
(2)  384/ 60006CA :                     ; 		mov	#sizeof_mscrl,r0
(2)  385/ 60006CA :                     ; 		mulu	r0,r1
(2)  386/ 60006CA :                     ; 		sts	macl,r1
(2)  387/ 60006CA :                     ; 		mov	#RAM_Mars_ScrlBuff,r0
(2)  388/ 60006CA :                     ; 		add	r0,r1
(2)  389/ 60006CA :                     ;
(2)  390/ 60006CA :                     ; 		mov	r5,@(scrl_blksize,r1)
(2)  391/ 60006CA :                     ; 		add	r5,r3	; add "block"
(2)  392/ 60006CA :                     ; 		mov	r2,@(scrl_fbdata,r1)
(2)  393/ 60006CA :                     ; 		add	r5,r4
(2)  394/ 60006CA :                     ; 		mov	r3,@(scrl_intrl_w,r1)
(2)  395/ 60006CA :                     ; 		mulu	r3,r4
(2)  396/ 60006CA :                     ; 		mov	r4,@(scrl_intrl_h,r1)
(2)  397/ 60006CA :                     ; 		sts	macl,r0
(2)  398/ 60006CA :                     ; 		mov	r0,@(scrl_intrl_size,r1)
(2)  399/ 60006CA :                     ; 		xor	r0,r0
(2)  400/ 60006CA :                     ; 		mov	r0,@(scrl_xpos_old,r1)
(2)  401/ 60006CA :                     ; 		mov	r0,@(scrl_ypos_old,r1)
(2)  402/ 60006CA :                     ; 		mov	r0,@(scrl_fbpos,r1)
(2)  403/ 60006CA :                     ; 		mov	r0,@(scrl_fbpos_y,r1)
(2)  404/ 60006CA :                     ; 		mov	r0,@(scrl_xset,r1)
(2)  405/ 60006CA :                     ; 		mov	r0,@(scrl_yset,r1)
(2)  406/ 60006CA :                     ; 		rts
(2)  407/ 60006CA :                     ; 		nop
(2)  408/ 60006CA :                     ; 		align 4
(2)  409/ 60006CA :                     ;
(2)  410/ 60006CA :                     ; ; --------------------------------------------------------
(2)  411/ 60006CA :                     ; ; MarsVideo_ShowScrlBg
(2)  412/ 60006CA :                     ; ;
(2)  413/ 60006CA :                     ; ; Make a visible section of any scrolling area
(2)  414/ 60006CA :                     ; ; into the current framebuffer.
(2)  415/ 60006CA :                     ; ;
(2)  416/ 60006CA :                     ; ; Input:
(2)  417/ 60006CA :                     ; ; r1 | Background buffer
(2)  418/ 60006CA :                     ; ; r2 | Top Y
(2)  419/ 60006CA :                     ; ; r3 | Bottom Y
(2)  420/ 60006CA :                     ; ;
(2)  421/ 60006CA :                     ; ; Breaks:
(2)  422/ 60006CA :                     ; ; r4-r14
(2)  423/ 60006CA :                     ; ;
(2)  424/ 60006CA :                     ; ; NOTE:
(2)  425/ 60006CA :                     ; ; After finishing all your screens call
(2)  426/ 60006CA :                     ; ; MarsVideo_FixTblShift before doing frameswap
(2)  427/ 60006CA :                     ; ; --------------------------------------------------------
(2)  428/ 60006CA :                     ;
(2)  429/ 60006CA :                     ; 		align 4
(2)  430/ 60006CA :                     ; MarsVideo_ShowScrlBg:
(2)  431/ 60006CA :                     ; 		mov	#_framebuffer,r14		; r14 - Framebuffer BASE
(2)  432/ 60006CA :                     ; 		mov	#0,r11				; r11 - line counter
(2)  433/ 60006CA :                     ; 		mov	@(scrl_fbdata,r1),r13		; r13 - Framebuffer pixeldata position
(2)  434/ 60006CA :                     ; 		mov	r2,r6
(2)  435/ 60006CA :                     ; 		mov	@(scrl_intrl_size,r1),r12	; r12 - Full size of screen-scroll
(2)  436/ 60006CA :                     ; 		mov	r2,r0
(2)  437/ 60006CA :                     ; 		mov	@(scrl_intrl_w,r1),r10		; r10 - Next line to add
(2)  438/ 60006CA :                     ; 		shll	r0
(2)  439/ 60006CA :                     ; 		mov	@(scrl_fbpos,r1),r7
(2)  440/ 60006CA :                     ; 		add	r0,r14
(2)  441/ 60006CA :                     ; 		mov	@(scrl_fbpos_y,r1),r0
(2)  442/ 60006CA :                     ; 		mulu	r10,r0
(2)  443/ 60006CA :                     ; 		sts	macl,r0
(2)  444/ 60006CA :                     ; 		add	r0,r7
(2)  445/ 60006CA :                     ; 		mov.w	@(marsGbl_WaveEnable,gbr),r0
(2)  446/ 60006CA :                     ; 		tst	r0,r0
(2)  447/ 60006CA :                     ; 		bf	.ln_wavy
(2)  448/ 60006CA :                     ; .ln_loop:
(2)  449/ 60006CA :                     ; 		mov	r7,r8
(2)  450/ 60006CA :                     ; 		cmp/ge	r12,r8
(2)  451/ 60006CA :                     ; 		bf	.xl_r
(2)  452/ 60006CA :                     ; 		sub	r12,r8
(2)  453/ 60006CA :                     ; .xl_r:
(2)  454/ 60006CA :                     ; 		cmp/pz	r8
(2)  455/ 60006CA :                     ; 		bt	.xl_l
(2)  456/ 60006CA :                     ; 		add	r12,r8
(2)  457/ 60006CA :                     ; .xl_l:
(2)  458/ 60006CA :                     ; 		mov	r8,r7
(2)  459/ 60006CA :                     ; 		add	r10,r7			; Add Y
(2)  460/ 60006CA :                     ; 		add	r13,r8			; Add Framebuffer position
(2)  461/ 60006CA :                     ; 		shlr	r8			; Divide by 2, use Xshift for the missing bit
(2)  462/ 60006CA :                     ; 		mov.w	r8,@r14			; Send to FB's table
(2)  463/ 60006CA :                     ; 		add	#2,r14
(2)  464/ 60006CA :                     ; 		add	#2,r11
(2)  465/ 60006CA :                     ; 		cmp/eq	r3,r6
(2)  466/ 60006CA :                     ; 		bf/s	.ln_loop
(2)  467/ 60006CA :                     ; 		add	#1,r6
(2)  468/ 60006CA :                     ; 		rts
(2)  469/ 60006CA :                     ; 		nop
(2)  470/ 60006CA :                     ; 		align 4
(2)  471/ 60006CA :                     ; .ln_wavy:
(2)  472/ 60006CA :                     ; 		mov.w	@(marsGbl_WaveSpd,gbr),r0
(2)  473/ 60006CA :                     ; 		mov	r0,r4
(2)  474/ 60006CA :                     ; 		mov.w	@(marsGbl_WaveTan,gbr),r0
(2)  475/ 60006CA :                     ; 		mov	#$7FF,r5
(2)  476/ 60006CA :                     ; 		add	r4,r0			; wave speed
(2)  477/ 60006CA :                     ; 		and	r5,r0
(2)  478/ 60006CA :                     ; 		mov.w	r0,@(marsGbl_WaveTan,gbr)
(2)  479/ 60006CA :                     ; 		mov	r0,r9
(2)  480/ 60006CA :                     ; 		mov.w	@(marsGbl_WaveMax,gbr),r0
(2)  481/ 60006CA :                     ; 		mov	r0,r5
(2)  482/ 60006CA :                     ; 		mov.w	@(marsGbl_WaveDeform,gbr),r0
(2)  483/ 60006CA :                     ; 		mov	r0,r4
(2)  484/ 60006CA :                     ; .ln_loop_w:
(2)  485/ 60006CA :                     ; 		mov	#$7FF,r8
(2)  486/ 60006CA :                     ; 		mov	r9,r0
(2)  487/ 60006CA :                     ; 		add	r4,r9		; wave distord
(2)  488/ 60006CA :                     ; 		and	r8,r9
(2)  489/ 60006CA :                     ; 		shll2	r0
(2)  490/ 60006CA :                     ; 		mov	#sin_table,r8
(2)  491/ 60006CA :                     ; 		mov	@(r0,r8),r0
(2)  492/ 60006CA :                     ; 		dmuls	r5,r0
(2)  493/ 60006CA :                     ; 		sts	macl,r0
(2)  494/ 60006CA :                     ; 		shlr16	r0
(2)  495/ 60006CA :                     ; 		exts.w	r0,r0
(2)  496/ 60006CA :                     ; 		mov	r7,r8
(2)  497/ 60006CA :                     ; 		cmp/ge	r12,r8
(2)  498/ 60006CA :                     ; 		bf	.wxl_r
(2)  499/ 60006CA :                     ; 		sub	r12,r8
(2)  500/ 60006CA :                     ; .wxl_r:
(2)  501/ 60006CA :                     ; 		cmp/pz	r8
(2)  502/ 60006CA :                     ; 		bt	.wxl_l
(2)  503/ 60006CA :                     ; 		add	r12,r8
(2)  504/ 60006CA :                     ; .wxl_l:
(2)  505/ 60006CA :                     ; 		mov	r8,r7
(2)  506/ 60006CA :                     ; 		add	r10,r7		; Add Y
(2)  507/ 60006CA :                     ; 		add	r13,r8		; Add Framebuffer position
(2)  508/ 60006CA :                     ; 		add	r0,r8
(2)  509/ 60006CA :                     ; 		shlr	r8		; divide by 2 (shift reg does the missing bit 0)
(2)  510/ 60006CA :                     ; 		mov.w	r8,@r14		; send to FB's table
(2)  511/ 60006CA :                     ; 		add	#2,r14
(2)  512/ 60006CA :                     ; 		add	#2,r11
(2)  513/ 60006CA :                     ; 		cmp/eq	r3,r6
(2)  514/ 60006CA :                     ; 		bf/s	.ln_loop_w
(2)  515/ 60006CA :                     ; 		add	#1,r6
(2)  516/ 60006CA :                     ; 		rts
(2)  517/ 60006CA :                     ; 		nop
(2)  518/ 60006CA :                     ; 		align 4
(2)  519/ 60006CA :                     ; .no_lines:
(2)  520/ 60006CA :                     ; 		rts
(2)  521/ 60006CA :                     ; 		nop
(2)  522/ 60006CA :                     ; 		align 4
(2)  523/ 60006CA :                     ; 		ltorg
(2)  524/ 60006CA :                     ;
(2)  525/ 60006CA :                     ; ; --------------------------------------------------------
(2)  526/ 60006CA :                     ; ; MarsVideo_Bg_UpdPos
(2)  527/ 60006CA :                     ; ;
(2)  528/ 60006CA :                     ; ; Moves the scrolling area using X/Y values from
(2)  529/ 60006CA :                     ; ; the Genesis side.
(2)  530/ 60006CA :                     ; ;
(2)  531/ 60006CA :                     ; ; Input:
(2)  532/ 60006CA :                     ; ; r14 | Genesis background buffer
(2)  533/ 60006CA :                     ; ; r13 | Scrolling-area buffer
(2)  534/ 60006CA :                     ; ;
(2)  535/ 60006CA :                     ; ; Breaks:
(2)  536/ 60006CA :                     ; ; ALL
(2)  537/ 60006CA :                     ; ; --------------------------------------------------------
(2)  538/ 60006CA :                     ;
(2)  539/ 60006CA :                     ; 		align 4
(2)  540/ 60006CA :                     ; MarsVideo_Bg_UpdPos:
(2)  541/ 60006CA :                     ; 		mov	#0,r1
(2)  542/ 60006CA :                     ; 		mov	#0,r2
(2)  543/ 60006CA :                     ; 		mov	@(scrl_xpos,r13),r0		; 0000.0000
(2)  544/ 60006CA :                     ; 		shlr16	r0				; **
(2)  545/ 60006CA :                     ; 		mov.w	r0,@(marsGbl_XShift,gbr)	; ** Grab missing bit for xshift
(2)  546/ 60006CA :                     ; 		exts.w	r0,r0
(2)  547/ 60006CA :                     ; 		mov	r0,r3
(2)  548/ 60006CA :                     ; 		mov	@(scrl_xpos_old,r13),r0
(2)  549/ 60006CA :                     ; 		cmp/eq	r0,r3
(2)  550/ 60006CA :                     ; 		bt	.xequ
(2)  551/ 60006CA :                     ; 		mov	r3,r1
(2)  552/ 60006CA :                     ; 		sub	r0,r1
(2)  553/ 60006CA :                     ; .xequ:
(2)  554/ 60006CA :                     ; 		mov	r3,r0
(2)  555/ 60006CA :                     ; 		mov	r0,@(scrl_xpos_old,r13)
(2)  556/ 60006CA :                     ; 		mov	@(scrl_ypos,r13),r0	; 0000.0000
(2)  557/ 60006CA :                     ; 		shlr16	r0
(2)  558/ 60006CA :                     ; 		exts.w	r0,r0
(2)  559/ 60006CA :                     ; 		mov	r0,r3
(2)  560/ 60006CA :                     ; 		mov	@(scrl_ypos_old,r13),r0
(2)  561/ 60006CA :                     ; 		cmp/eq	r0,r3
(2)  562/ 60006CA :                     ; 		bt	.yequ
(2)  563/ 60006CA :                     ; 		mov	r3,r2
(2)  564/ 60006CA :                     ; 		sub	r0,r2
(2)  565/ 60006CA :                     ; .yequ:
(2)  566/ 60006CA :                     ; 		mov	r3,r0
(2)  567/ 60006CA :                     ; 		mov	r0,@(scrl_ypos_old,r13)
(2)  568/ 60006CA :                     ; 		exts.w	r1,r1			; r1 - X increment
(2)  569/ 60006CA :                     ; 		exts.w	r2,r2			; r2 - Y increment
(2)  570/ 60006CA :                     ;
(2)  571/ 60006CA :                     ; 	; ---------------------------------------
(2)  572/ 60006CA :                     ; 	; Increment Y pos (REAL)
(2)  573/ 60006CA :                     ; 	; ---------------------------------------
(2)  574/ 60006CA :                     ;
(2)  575/ 60006CA :                     ; 		mov	@(scrl_fbpos_y,r13),r4
(2)  576/ 60006CA :                     ; 		add	r2,r4
(2)  577/ 60006CA :                     ; 		mov	@(scrl_intrl_h,r13),r3
(2)  578/ 60006CA :                     ; 		cmp/pl	r2
(2)  579/ 60006CA :                     ; 		bf	.ypu_negtv
(2)  580/ 60006CA :                     ; 		cmp/ge	r3,r4
(2)  581/ 60006CA :                     ; 		bf	.ypu_negtv
(2)  582/ 60006CA :                     ; 		sub	r3,r4
(2)  583/ 60006CA :                     ; .ypu_negtv:
(2)  584/ 60006CA :                     ; 		cmp/pz	r2
(2)  585/ 60006CA :                     ; 		bt	.ypu_postv
(2)  586/ 60006CA :                     ; 		cmp/pz	r4
(2)  587/ 60006CA :                     ; 		bt	.ypu_postv
(2)  588/ 60006CA :                     ; 		add	r3,r4
(2)  589/ 60006CA :                     ; .ypu_postv:
(2)  590/ 60006CA :                     ; 		mov	r4,@(scrl_fbpos_y,r13)
(2)  591/ 60006CA :                     ;
(2)  592/ 60006CA :                     ; 	; ---------------------------------------
(2)  593/ 60006CA :                     ; 	; Update Framebuffer top-left position
(2)  594/ 60006CA :                     ; 	; ---------------------------------------
(2)  595/ 60006CA :                     ;
(2)  596/ 60006CA :                     ; 		mov	@(scrl_intrl_size,r13),r3
(2)  597/ 60006CA :                     ; 		mov	@(scrl_fbpos,r13),r0
(2)  598/ 60006CA :                     ; 		add	r1,r0
(2)  599/ 60006CA :                     ; 		cmp/pl	r1
(2)  600/ 60006CA :                     ; 		bf	.yx_negtv
(2)  601/ 60006CA :                     ; 		cmp/ge	r3,r0
(2)  602/ 60006CA :                     ; 		bf	.yx_negtv
(2)  603/ 60006CA :                     ; 		sub	r3,r0
(2)  604/ 60006CA :                     ; .yx_negtv:
(2)  605/ 60006CA :                     ; 		cmp/pz	r1
(2)  606/ 60006CA :                     ; 		bt	.yx_postv
(2)  607/ 60006CA :                     ; 		cmp/pz	r0
(2)  608/ 60006CA :                     ; 		bt	.yx_postv
(2)  609/ 60006CA :                     ; 		add	r3,r0
(2)  610/ 60006CA :                     ; .yx_postv:
(2)  611/ 60006CA :                     ; 		mov	r0,@(scrl_fbpos,r13)
(2)  612/ 60006CA :                     ; 		rts
(2)  613/ 60006CA :                     ; 		nop
(2)  614/ 60006CA :                     ; 		align 4
(2)  615/ 60006CA :                     ;
(2)  616/ 60006CA :                     ; ; --------------------------------------------------------
(2)  617/ 60006CA :                     ; ; MarsVideo_Bg_MdReq
(2)  618/ 60006CA :                     ; ;
(2)  619/ 60006CA :                     ; ; Input:
(2)  620/ 60006CA :                     ; ;  r1 | X increment
(2)  621/ 60006CA :                     ; ;  r2 | Y increment
(2)  622/ 60006CA :                     ; ; r14 | Genesis background buffer
(2)  623/ 60006CA :                     ; ; r13 | Scrolling-area buffer
(2)  624/ 60006CA :                     ; ;
(2)  625/ 60006CA :                     ; ; Breaks:
(2)  626/ 60006CA :                     ; ; ALL
(2)  627/ 60006CA :                     ; ; --------------------------------------------------------
(2)  628/ 60006CA :                     ;
(2)  629/ 60006CA :                     ; 		align 4
(2)  630/ 60006CA :                     ; MarsVideo_Bg_DrawReq:
(2)  631/ 60006CA :                     ; ; 		sts	pr,@-r15
(2)  632/ 60006CA :                     ;
(2)  633/ 60006CA :                     ; ; 	; ---------------------------------------
(2)  634/ 60006CA :                     ; ; 	; Set block update timers
(2)  635/ 60006CA :                     ; ; 	; ---------------------------------------
(2)  636/ 60006CA :                     ; ;
(2)  637/ 60006CA :                     ; ; 	; X timers
(2)  638/ 60006CA :                     ; ; 		mov	#2,r7
(2)  639/ 60006CA :                     ; ; 		xor	r6,r6
(2)  640/ 60006CA :                     ; ; 		mov	#Cach_DrawTimers,r8
(2)  641/ 60006CA :                     ; ; 		mov.b	@(md_bg_flags,r14),r0
(2)  642/ 60006CA :                     ; ; 		extu.b	r0,r0
(2)  643/ 60006CA :                     ; ; 		and	#%1111,r0
(2)  644/ 60006CA :                     ; ; 		tst	#%0001,r0		; bitDrwR
(2)  645/ 60006CA :                     ; ; 		bf	.x_r
(2)  646/ 60006CA :                     ; ; 		tst	#%0010,r0		; bitDrwL
(2)  647/ 60006CA :                     ; ; 		bt	.x_k
(2)  648/ 60006CA :                     ; ; 		mov	r6,@r8
(2)  649/ 60006CA :                     ; ; 		mov	r7,@(4,r8)
(2)  650/ 60006CA :                     ; ; 		bra	.x_k
(2)  651/ 60006CA :                     ; ; 		nop
(2)  652/ 60006CA :                     ; ; .x_r:
(2)  653/ 60006CA :                     ; ; 		mov	r7,@r8
(2)  654/ 60006CA :                     ; ; 		mov	r6,@(4,r8)
(2)  655/ 60006CA :                     ; ; .x_k:
(2)  656/ 60006CA :                     ; ; 		add	#8,r8
(2)  657/ 60006CA :                     ; ;
(2)  658/ 60006CA :                     ; ; 	; Y timers
(2)  659/ 60006CA :                     ; ; 		tst	#%0100,r0		; bitDrwD
(2)  660/ 60006CA :                     ; ; 		bf	.y_r
(2)  661/ 60006CA :                     ; ; 		tst	#%1000,r0		; bitDrwU
(2)  662/ 60006CA :                     ; ; 		bt	.y_k
(2)  663/ 60006CA :                     ; ; 		mov	r6,@r8
(2)  664/ 60006CA :                     ; ; 		mov	r7,@(4,r8)
(2)  665/ 60006CA :                     ; ; 		bra	.y_k
(2)  666/ 60006CA :                     ; ; 		nop
(2)  667/ 60006CA :                     ; ; .y_r:
(2)  668/ 60006CA :                     ; ; 		mov	r7,@r8
(2)  669/ 60006CA :                     ; ; 		mov	r6,@(4,r8)
(2)  670/ 60006CA :                     ; ; .y_k:
(2)  671/ 60006CA :                     ; ; 		rts
(2)  672/ 60006CA :                     ; ; 		nop
(2)  673/ 60006CA :                     ; ; 		align 4
(2)  674/ 60006CA :                     ;
(2)  675/ 60006CA :                     ; ; 	; ---------------------------------------
(2)  676/ 60006CA :                     ; ; 	; Set block update timers
(2)  677/ 60006CA :                     ; ; 	; ---------------------------------------
(2)  678/ 60006CA :                     ; ;
(2)  679/ 60006CA :                     ; 	; X timers
(2)  680/ 60006CA :                     ; 		mov	#2,r7
(2)  681/ 60006CA :                     ; 		mov	#Cach_DrawTimers,r8
(2)  682/ 60006CA :                     ; 		mov	r8,r5
(2)  683/ 60006CA :                     ; 		mov	@(scrl_blksize,r13),r6
(2)  684/ 60006CA :                     ; 		mov	r6,r4
(2)  685/ 60006CA :                     ; 		dt	r4
(2)  686/ 60006CA :                     ; 		neg	r6,r6
(2)  687/ 60006CA :                     ; 		mov	@(scrl_xset,r13),r3
(2)  688/ 60006CA :                     ; 		add	r1,r3
(2)  689/ 60006CA :                     ; 		mov	r3,r0
(2)  690/ 60006CA :                     ; 		and	r6,r0
(2)  691/ 60006CA :                     ; 		tst	r0,r0
(2)  692/ 60006CA :                     ; 		bt	.x_k
(2)  693/ 60006CA :                     ; 		cmp/pz	r1
(2)  694/ 60006CA :                     ; 		bt	.x_r
(2)  695/ 60006CA :                     ; 		add	#4,r5
(2)  696/ 60006CA :                     ; .x_r:
(2)  697/ 60006CA :                     ; 		mov	r7,@r5
(2)  698/ 60006CA :                     ; 		and	r4,r3
(2)  699/ 60006CA :                     ; .x_k:
(2)  700/ 60006CA :                     ; 		mov	r3,@(scrl_xset,r13)
(2)  701/ 60006CA :                     ;
(2)  702/ 60006CA :                     ; 	; Y timers
(2)  703/ 60006CA :                     ; 		add	#8,r8
(2)  704/ 60006CA :                     ; 		mov	@(scrl_yset,r13),r3
(2)  705/ 60006CA :                     ; 		add	r2,r3
(2)  706/ 60006CA :                     ; 		mov	r3,r0
(2)  707/ 60006CA :                     ; 		and	r6,r0
(2)  708/ 60006CA :                     ; 		tst	r0,r0
(2)  709/ 60006CA :                     ; 		bt	.y_k
(2)  710/ 60006CA :                     ; 		cmp/pz	r2
(2)  711/ 60006CA :                     ; 		bt	.y_r
(2)  712/ 60006CA :                     ; 		add	#4,r8
(2)  713/ 60006CA :                     ; .y_r:
(2)  714/ 60006CA :                     ; 		mov	r7,@r8
(2)  715/ 60006CA :                     ; 		and	r4,r3
(2)  716/ 60006CA :                     ; .y_k:
(2)  717/ 60006CA :                     ; 		mov	r3,@(scrl_yset,r13)
(2)  718/ 60006CA :                     ;
(2)  719/ 60006CA :                     ; 		rts
(2)  720/ 60006CA :                     ; 		nop
(2)  721/ 60006CA :                     ; 		align 4
(2)  722/ 60006CA :                     ;
(2)  723/ 60006CA :                     ; ; --------------------------------------------------------
(2)  724/ 60006CA :                     ; ; MarsVideo_DmaDraw
(2)  725/ 60006CA :                     ; ;
(2)  726/ 60006CA :                     ; ; Input:
(2)  727/ 60006CA :                     ; ; r1 - Source
(2)  728/ 60006CA :                     ; ; r2 - Destination
(2)  729/ 60006CA :                     ; ; r3 - Size / 4
(2)  730/ 60006CA :                     ; ; --------------------------------------------------------
(2)  731/ 60006CA :                     ;
(2)  732/ 60006CA :                     ; 		align 4
(2)  733/ 60006CA :                     ; MarsVideo_DmaDraw:
(2)  734/ 60006CA :                     ; 		mov	#_DMASOURCE1,r4
(2)  735/ 60006CA :                     ; 		mov	#%0101101011100000,r0
(2)  736/ 60006CA :                     ; 		mov	r0,@($0C,r4)
(2)  737/ 60006CA :                     ; 		mov	r1,r0
(2)  738/ 60006CA :                     ; 		mov	r0,@r4
(2)  739/ 60006CA :                     ; 		mov	r2,r0			; <-- point fbdata here
(2)  740/ 60006CA :                     ; 		mov	r0,@($04,r4)
(2)  741/ 60006CA :                     ; 		mov	r3,r0
(2)  742/ 60006CA :                     ; 		mov	r0,@($08,r4)
(2)  743/ 60006CA :                     ; 		mov	#%0101101011100001,r0
(2)  744/ 60006CA :                     ; 		mov	r0,@($0C,r4)
(2)  745/ 60006CA :                     ; .wait_dma:	mov	@($C,r4),r0		; Still on DMA?
(2)  746/ 60006CA :                     ; 		tst	#%10,r0
(2)  747/ 60006CA :                     ; 		bt	.wait_dma
(2)  748/ 60006CA :                     ; 		mov	#%0101101011100000,r0
(2)  749/ 60006CA :                     ; 		mov	r0,@($C,r4)
(2)  750/ 60006CA :                     ; 		rts
(2)  751/ 60006CA :                     ; 		nop
(2)  752/ 60006CA :                     ; 		align 4
(2)  753/ 60006CA :                     ; 		ltorg
(2)  754/ 60006CA :                     ;
(2)  755/ 60006CA :                     ; ; --------------------------------------------------------
(2)  756/ 60006CA :                     ; ; MarsVideo_Bg_DrawScrl
(2)  757/ 60006CA :                     ; ;
(2)  758/ 60006CA :                     ; ; Input:
(2)  759/ 60006CA :                     ; ; r14 | Background buffer
(2)  760/ 60006CA :                     ; ; r13 | Scrolling-area buffer
(2)  761/ 60006CA :                     ; ; r12 | Draw timers
(2)  762/ 60006CA :                     ; ;
(2)  763/ 60006CA :                     ; ; Breaks:
(2)  764/ 60006CA :                     ; ; ALL
(2)  765/ 60006CA :                     ; ; --------------------------------------------------------
(2)  766/ 60006CA :                     ;
(2)  767/ 60006CA :                     ; 		align 4
(2)  768/ 60006CA :                     ; MarsVideo_Bg_DrawScrl:
(2)  769/ 60006CA :                     ; 		sts	pr,@-r15
(2)  770/ 60006CA :                     ;
(2)  771/ 60006CA :                     ; 		mov	#_framebuffer,r0
(2)  772/ 60006CA :                     ; 		mov	@(scrl_fbdata,r13),r1
(2)  773/ 60006CA :                     ; 		add	r0,r1
(2)  774/ 60006CA :                     ; 		mov	@(scrl_intrl_w,r13),r11		; r11 - FB width
(2)  775/ 60006CA :                     ; 		lds	r1,mach				; mach - FB base
(2)  776/ 60006CA :                     ; 		mov	@(scrl_fbpos_y,r13),r0
(2)  777/ 60006CA :                     ; 		mov	#-$10,r1			; <-- CUSTOM BLOCK SIZE
(2)  778/ 60006CA :                     ; 		mov	@(scrl_fbpos,r13),r10		; r10 - FB x/y pos
(2)  779/ 60006CA :                     ; 		and	r1,r0
(2)  780/ 60006CA :                     ; 		mov	@(md_bg_blk,r14),r9		; r9 - Block data
(2)  781/ 60006CA :                     ; 		mulu	r0,r11
(2)  782/ 60006CA :                     ; 		mov.w	@(md_bg_w,r14),r0		; r7 - Layout increment
(2)  783/ 60006CA :                     ; 		extu.w	r0,r7
(2)  784/ 60006CA :                     ; 		mov	@(scrl_intrl_size,r13),r12	; r12 - FB full size
(2)  785/ 60006CA :                     ; 		sts	macl,r0
(2)  786/ 60006CA :                     ; 		add	r0,r10
(2)  787/ 60006CA :                     ; 		and	r1,r10
(2)  788/ 60006CA :                     ; 		mov	@(md_bg_low,r14),r8		; r8 - Layout data
(2)  789/ 60006CA :                     ; 		mov	#RAM_Mars_ScrlData,r13
(2)  790/ 60006CA :                     ; 		cmp/ge	r12,r10
(2)  791/ 60006CA :                     ; 		bf	.fb_y
(2)  792/ 60006CA :                     ; 		sub	r12,r10
(2)  793/ 60006CA :                     ; .fb_y:
(2)  794/ 60006CA :                     ; 		mov	#Cach_DrawTimers,r1
(2)  795/ 60006CA :                     ; 		mov	@r1,r0
(2)  796/ 60006CA :                     ; 		tst	r0,r0
(2)  797/ 60006CA :                     ; 		bt	.no_r
(2)  798/ 60006CA :                     ; 		bsr	.draw_r
(2)  799/ 60006CA :                     ; 		nop
(2)  800/ 60006CA :                     ; .no_r:
(2)  801/ 60006CA :                     ; 		mov	#Cach_DrawTimers+4,r1
(2)  802/ 60006CA :                     ; 		mov	@r1,r0
(2)  803/ 60006CA :                     ; 		tst	r0,r0
(2)  804/ 60006CA :                     ; 		bt	.no_l
(2)  805/ 60006CA :                     ; 		bsr	.draw_l
(2)  806/ 60006CA :                     ; 		nop
(2)  807/ 60006CA :                     ; .no_l:
(2)  808/ 60006CA :                     ; 		mov	#Cach_DrawTimers+8,r1
(2)  809/ 60006CA :                     ; 		mov	@r1,r0
(2)  810/ 60006CA :                     ; 		tst	r0,r0
(2)  811/ 60006CA :                     ; 		bt	.no_d
(2)  812/ 60006CA :                     ; 		bsr	.draw_d
(2)  813/ 60006CA :                     ; 		nop
(2)  814/ 60006CA :                     ; .no_d:
(2)  815/ 60006CA :                     ; 		mov	#Cach_DrawTimers+$C,r1
(2)  816/ 60006CA :                     ; 		mov	@r1,r0
(2)  817/ 60006CA :                     ; 		tst	r0,r0
(2)  818/ 60006CA :                     ; 		bt	.no_u
(2)  819/ 60006CA :                     ; 		bsr	.draw_u
(2)  820/ 60006CA :                     ; 		nop
(2)  821/ 60006CA :                     ; .no_u:
(2)  822/ 60006CA :                     ;
(2)  823/ 60006CA :                     ; 		lds	@r15+,pr
(2)  824/ 60006CA :                     ; 		rts
(2)  825/ 60006CA :                     ; 		nop
(2)  826/ 60006CA :                     ;
(2)  827/ 60006CA :                     ; ; mach - FB base
(2)  828/ 60006CA :                     ; ; r13 - Background copy
(2)  829/ 60006CA :                     ; ; r12 - FB full size
(2)  830/ 60006CA :                     ; ; r11 - FB width
(2)  831/ 60006CA :                     ; ; r10 - FB x/y pos
(2)  832/ 60006CA :                     ; ; r9 - Block data
(2)  833/ 60006CA :                     ; ; r8 - Layout data
(2)  834/ 60006CA :                     ; ; r7 - Layout increment
(2)  835/ 60006CA :                     ;
(2)  836/ 60006CA :                     ; ; RIGHT/LEFT
(2)  837/ 60006CA :                     ; .draw_r:
(2)  838/ 60006CA :                     ; 		dt	r0
(2)  839/ 60006CA :                     ; 		mov	r0,@r1
(2)  840/ 60006CA :                     ; 		mov.w	@(md_bg_xinc_r,r14),r0		; r7 - Layout increment
(2)  841/ 60006CA :                     ; 		exts.w	r0,r2
(2)  842/ 60006CA :                     ; 		mov	#320,r1
(2)  843/ 60006CA :                     ; 		bra	.go_lr
(2)  844/ 60006CA :                     ; 		nop
(2)  845/ 60006CA :                     ; .draw_l:
(2)  846/ 60006CA :                     ; 		dt	r0
(2)  847/ 60006CA :                     ; 		mov	r0,@r1
(2)  848/ 60006CA :                     ; 		mov.w	@(md_bg_xinc_l,r14),r0		; r7 - Layout increment
(2)  849/ 60006CA :                     ; 		exts.w	r0,r2
(2)  850/ 60006CA :                     ; 		mov	#0,r1
(2)  851/ 60006CA :                     ; .go_lr:
(2)  852/ 60006CA :                     ; 		mov	r10,r6
(2)  853/ 60006CA :                     ; 		add	r1,r6
(2)  854/ 60006CA :                     ; ; 		mov	#-$10,r0
(2)  855/ 60006CA :                     ; ; 		and	r0,r6		; r6 - curr out pos
(2)  856/ 60006CA :                     ; 		mov	r8,@-r15
(2)  857/ 60006CA :                     ; 		mov.w	@(md_bg_yinc_u,r14),r0		; r7 - Layout increment
(2)  858/ 60006CA :                     ; 		exts.w	r0,r1
(2)  859/ 60006CA :                     ; 		mov	#16,r3		; <-- MANUAL BLOCK SIZE
(2)  860/ 60006CA :                     ; 		mulu	r3,r1
(2)  861/ 60006CA :                     ; 		sts	macl,r0
(2)  862/ 60006CA :                     ; 		shlr8	r0
(2)  863/ 60006CA :                     ; 		mulu	r7,r0
(2)  864/ 60006CA :                     ; 		sts	macl,r0
(2)  865/ 60006CA :                     ; 		add	r0,r8
(2)  866/ 60006CA :                     ; 		mulu	r3,r2
(2)  867/ 60006CA :                     ; 		sts	macl,r0
(2)  868/ 60006CA :                     ; 		shlr8	r0
(2)  869/ 60006CA :                     ; 		add	r0,r8
(2)  870/ 60006CA :                     ; 		mov	#((224+16)/16),r1
(2)  871/ 60006CA :                     ; .y_blk:
(2)  872/ 60006CA :                     ; 		mov	r1,@-r15
(2)  873/ 60006CA :                     ; 		mov	r9,r5
(2)  874/ 60006CA :                     ; 		mov.b	@r8,r0
(2)  875/ 60006CA :                     ; 		extu.b	r0,r0		; BYTE
(2)  876/ 60006CA :                     ; 		mov	#16*16,r3
(2)  877/ 60006CA :                     ; 		mulu	r3,r0
(2)  878/ 60006CA :                     ; 		sts	macl,r0
(2)  879/ 60006CA :                     ; 		mov	r9,r5
(2)  880/ 60006CA :                     ; 		add	r0,r5
(2)  881/ 60006CA :                     ;
(2)  882/ 60006CA :                     ; 		mov	#16,r3
(2)  883/ 60006CA :                     ; .y_lne:
(2)  884/ 60006CA :                     ; 		cmp/ge	r12,r6
(2)  885/ 60006CA :                     ; 		bf	.y_res
(2)  886/ 60006CA :                     ; 		sub	r12,r6
(2)  887/ 60006CA :                     ; .y_res:
(2)  888/ 60006CA :                     ; 		mov	#16/4,r4
(2)  889/ 60006CA :                     ; .x_lne:
(2)  890/ 60006CA :                     ; 		mov	@r5+,r0
(2)  891/ 60006CA :                     ; 		lds	r0,macl
(2)  892/ 60006CA :                     ; 		sts	mach,r1
(2)  893/ 60006CA :                     ; 		add	r6,r1
(2)  894/ 60006CA :                     ; 		mov	r13,r2
(2)  895/ 60006CA :                     ; 		add	r6,r2
(2)  896/ 60006CA :                     ; 		mov	r0,@r1
(2)  897/ 60006CA :                     ; 		add	#4,r6
(2)  898/ 60006CA :                     ; 		mov	r0,@r2
(2)  899/ 60006CA :                     ; 		mov	#320,r0
(2)  900/ 60006CA :                     ; 		cmp/ge	r0,r6
(2)  901/ 60006CA :                     ; 		bt	.x_ex
(2)  902/ 60006CA :                     ; 		sts	macl,r0
(2)  903/ 60006CA :                     ; 		add	r12,r1
(2)  904/ 60006CA :                     ; 		mov	r0,@r1
(2)  905/ 60006CA :                     ; 		add	r12,r2
(2)  906/ 60006CA :                     ; 		mov	r0,@r2
(2)  907/ 60006CA :                     ; 		nop
(2)  908/ 60006CA :                     ; .x_ex:
(2)  909/ 60006CA :                     ; 		dt	r4
(2)  910/ 60006CA :                     ; 		bf	.x_lne
(2)  911/ 60006CA :                     ; 		add	#-16,r6	; bring point back
(2)  912/ 60006CA :                     ; 		dt	r3
(2)  913/ 60006CA :                     ; 		bf/s	.y_lne
(2)  914/ 60006CA :                     ; 		add	r11,r6
(2)  915/ 60006CA :                     ; 		mov	@r15+,r1
(2)  916/ 60006CA :                     ; 		dt	r1
(2)  917/ 60006CA :                     ; 		bf/s	.y_blk
(2)  918/ 60006CA :                     ; 		add	r7,r8
(2)  919/ 60006CA :                     ; 		mov	@r15+,r8
(2)  920/ 60006CA :                     ; 		rts
(2)  921/ 60006CA :                     ; 		nop
(2)  922/ 60006CA :                     ;
(2)  923/ 60006CA :                     ; ; DOWN/UP
(2)  924/ 60006CA :                     ; .draw_d:
(2)  925/ 60006CA :                     ; 		dt	r0
(2)  926/ 60006CA :                     ; 		mov	r0,@r1
(2)  927/ 60006CA :                     ; 		mov.w	@(md_bg_yinc_d,r14),r0		; r7 - Layout increment
(2)  928/ 60006CA :                     ; 		exts.w	r0,r2
(2)  929/ 60006CA :                     ; 		mov	#224,r1
(2)  930/ 60006CA :                     ; 		bra	.go_du
(2)  931/ 60006CA :                     ; 		nop
(2)  932/ 60006CA :                     ; .draw_u:
(2)  933/ 60006CA :                     ; 		dt	r0
(2)  934/ 60006CA :                     ; 		mov	r0,@r1
(2)  935/ 60006CA :                     ; 		mov.w	@(md_bg_yinc_u,r14),r0		; r7 - Layout increment
(2)  936/ 60006CA :                     ; 		exts.w	r0,r2
(2)  937/ 60006CA :                     ; 		mov	#0,r1
(2)  938/ 60006CA :                     ; .go_du:
(2)  939/ 60006CA :                     ; 		mov	#CS3|$40,r3
(2)  940/ 60006CA :                     ; 		mov	r2,@r3
(2)  941/ 60006CA :                     ;
(2)  942/ 60006CA :                     ; 		mulu	r1,r11
(2)  943/ 60006CA :                     ; 		sts	macl,r0
(2)  944/ 60006CA :                     ; 		mov	r10,r6
(2)  945/ 60006CA :                     ; 		add	r0,r6
(2)  946/ 60006CA :                     ; ; 		mov	#-$10,r0
(2)  947/ 60006CA :                     ; ; 		and	r0,r6				; r6 - curr out pos
(2)  948/ 60006CA :                     ; 		mov	r8,@-r15
(2)  949/ 60006CA :                     ; 		mov.w	@(md_bg_xinc_l,r14),r0		; r7 - Layout increment
(2)  950/ 60006CA :                     ; 		exts.w	r0,r1
(2)  951/ 60006CA :                     ; 		mov	#16,r3				; <-- MANUAL BLOCK SIZE
(2)  952/ 60006CA :                     ; 		mulu	r3,r1
(2)  953/ 60006CA :                     ; 		sts	macl,r0
(2)  954/ 60006CA :                     ; 		shlr8	r0
(2)  955/ 60006CA :                     ; 		add	r0,r8
(2)  956/ 60006CA :                     ; 		mulu	r3,r2
(2)  957/ 60006CA :                     ; 		sts	macl,r0
(2)  958/ 60006CA :                     ; 		shlr8	r0
(2)  959/ 60006CA :                     ; 		mulu	r7,r0
(2)  960/ 60006CA :                     ; 		sts	macl,r0
(2)  961/ 60006CA :                     ; 		add	r0,r8
(2)  962/ 60006CA :                     ; 		mov	#((320+16)/16),r1
(2)  963/ 60006CA :                     ; .yd_blk:
(2)  964/ 60006CA :                     ; 		mov	r6,@-r15
(2)  965/ 60006CA :                     ; 		mov	r1,@-r15
(2)  966/ 60006CA :                     ; 		mov	r9,r5
(2)  967/ 60006CA :                     ; 		mov.b	@r8,r0
(2)  968/ 60006CA :                     ; 		extu.b	r0,r0		; BYTE
(2)  969/ 60006CA :                     ; 		mov	#16*16,r3
(2)  970/ 60006CA :                     ; 		mulu	r3,r0
(2)  971/ 60006CA :                     ; 		sts	macl,r0
(2)  972/ 60006CA :                     ; 		mov	r9,r5
(2)  973/ 60006CA :                     ; 		add	r0,r5
(2)  974/ 60006CA :                     ; ;
(2)  975/ 60006CA :                     ; 		mov	#16,r3
(2)  976/ 60006CA :                     ; .yd_lne:
(2)  977/ 60006CA :                     ; 		cmp/ge	r12,r6
(2)  978/ 60006CA :                     ; 		bf	.yd_res
(2)  979/ 60006CA :                     ; 		sub	r12,r6
(2)  980/ 60006CA :                     ; .yd_res:
(2)  981/ 60006CA :                     ; 		mov	#16/4,r4
(2)  982/ 60006CA :                     ; .xd_lne:
(2)  983/ 60006CA :                     ; 		mov	@r5+,r0
(2)  984/ 60006CA :                     ; 		lds	r0,macl
(2)  985/ 60006CA :                     ; 		sts	mach,r1
(2)  986/ 60006CA :                     ; 		add	r6,r1
(2)  987/ 60006CA :                     ; 		mov	r13,r2
(2)  988/ 60006CA :                     ; 		add	r6,r2
(2)  989/ 60006CA :                     ; 		mov	r0,@r1
(2)  990/ 60006CA :                     ; 		add	#4,r6
(2)  991/ 60006CA :                     ; 		mov	r0,@r2
(2)  992/ 60006CA :                     ; 		mov	#320,r0
(2)  993/ 60006CA :                     ; 		cmp/ge	r0,r6
(2)  994/ 60006CA :                     ; 		bt	.xd_ex
(2)  995/ 60006CA :                     ; 		sts	macl,r0
(2)  996/ 60006CA :                     ; 		add	r12,r1
(2)  997/ 60006CA :                     ; 		mov	r0,@r1
(2)  998/ 60006CA :                     ; 		add	r12,r2
(2)  999/ 60006CA :                     ; 		mov	r0,@r2
(2) 1000/ 60006CA :                     ; 		nop
(2) 1001/ 60006CA :                     ; .xd_ex:
(2) 1002/ 60006CA :                     ; 		dt	r4
(2) 1003/ 60006CA :                     ; 		bf	.xd_lne
(2) 1004/ 60006CA :                     ; 		add	#-16,r6	; bring point back
(2) 1005/ 60006CA :                     ; 		dt	r3
(2) 1006/ 60006CA :                     ; 		bf/s	.yd_lne
(2) 1007/ 60006CA :                     ; 		add	r11,r6
(2) 1008/ 60006CA :                     ;
(2) 1009/ 60006CA :                     ; 		mov	@r15+,r1
(2) 1010/ 60006CA :                     ; 		mov	@r15+,r6
(2) 1011/ 60006CA :                     ; 		mov	#16,r0
(2) 1012/ 60006CA :                     ; 		add	r0,r6
(2) 1013/ 60006CA :                     ; 		dt	r1
(2) 1014/ 60006CA :                     ; 		bf/s	.yd_blk
(2) 1015/ 60006CA :                     ; 		add	#1,r8
(2) 1016/ 60006CA :                     ; 		mov	@r15+,r8
(2) 1017/ 60006CA :                     ; 		rts
(2) 1018/ 60006CA :                     ; 		nop
(2) 1019/ 60006CA :                     ;
(2) 1020/ 60006CA :                     ; 		align 4
(2) 1021/ 60006CA :                     ; 		ltorg
(2) 1022/ 60006CA :                     ;
(2) 1023/ 60006CA :                     ; ; ; --------------------------------------------------------
(2) 1024/ 60006CA :                     ; ; ; MarsVideo_Bg_DrawScrl_UD
(2) 1025/ 60006CA :                     ; ; ;
(2) 1026/ 60006CA :                     ; ; ; Input:
(2) 1027/ 60006CA :                     ; ; ; r14 | Background buffer
(2) 1028/ 60006CA :                     ; ; ; r13 | Scrolling-area buffer
(2) 1029/ 60006CA :                     ; ; ; r12 | Draw timers
(2) 1030/ 60006CA :                     ; ; ;
(2) 1031/ 60006CA :                     ; ; ; Breaks:
(2) 1032/ 60006CA :                     ; ; ; ALL
(2) 1033/ 60006CA :                     ; ; ; --------------------------------------------------------
(2) 1034/ 60006CA :                     ; ;
(2) 1035/ 60006CA :                     ; ; 		align 4
(2) 1036/ 60006CA :                     ; ; MarsVideo_Bg_DrawScrl_UD:
(2) 1037/ 60006CA :                     ; ; 		sts	pr,@-r15
(2) 1038/ 60006CA :                     ; ;
(2) 1039/ 60006CA :                     ; ; 		mov	#_framebuffer,r0
(2) 1040/ 60006CA :                     ; ; 		mov	@(scrl_fbdata,r13),r1
(2) 1041/ 60006CA :                     ; ; 		add	r0,r1
(2) 1042/ 60006CA :                     ; ; 		mov	@(scrl_intrl_w,r13),r11		; r11 - FB width
(2) 1043/ 60006CA :                     ; ; 		lds	r1,mach				; mach - FB base
(2) 1044/ 60006CA :                     ; ; 		mov	@(scrl_fbpos_y,r13),r0
(2) 1045/ 60006CA :                     ; ; 		mov	#-$10,r1			; <-- CUSTOM BLOCK SIZE
(2) 1046/ 60006CA :                     ; ; 		mov	@(scrl_fbpos,r13),r10		; r10 - FB x/y pos
(2) 1047/ 60006CA :                     ; ; 		and	r1,r0
(2) 1048/ 60006CA :                     ; ; 		mov	@(md_bg_blk,r14),r9		; r9 - Block data
(2) 1049/ 60006CA :                     ; ; 		mulu	r0,r11
(2) 1050/ 60006CA :                     ; ; 		mov.w	@(md_bg_w,r14),r0		; r7 - Layout increment
(2) 1051/ 60006CA :                     ; ; 		extu.w	r0,r7
(2) 1052/ 60006CA :                     ; ; 		mov	@(scrl_intrl_size,r13),r12	; r12 - FB full size
(2) 1053/ 60006CA :                     ; ; 		sts	macl,r0
(2) 1054/ 60006CA :                     ; ; 		add	r0,r10
(2) 1055/ 60006CA :                     ; ; 		and	r1,r10
(2) 1056/ 60006CA :                     ; ; 		mov	@(md_bg_low,r14),r8		; r8 - Layout data
(2) 1057/ 60006CA :                     ; ; 		mov	#RAM_Mars_ScrlData,r13
(2) 1058/ 60006CA :                     ; ; 		cmp/ge	r12,r10
(2) 1059/ 60006CA :                     ; ; 		bf	.fb_y
(2) 1060/ 60006CA :                     ; ; 		sub	r12,r10
(2) 1061/ 60006CA :                     ; ; .fb_y:
(2) 1062/ 60006CA :                     ; ; 		mov	#Cach_DrawTimers+8,r1
(2) 1063/ 60006CA :                     ; ; 		mov	@r1,r0
(2) 1064/ 60006CA :                     ; ; 		tst	r0,r0
(2) 1065/ 60006CA :                     ; ; 		bt	.no_d
(2) 1066/ 60006CA :                     ; ; 		bsr	.draw_d
(2) 1067/ 60006CA :                     ; ; 		nop
(2) 1068/ 60006CA :                     ; ; .no_d:
(2) 1069/ 60006CA :                     ; ; 		mov	#Cach_DrawTimers+$C,r1
(2) 1070/ 60006CA :                     ; ; 		mov	@r1,r0
(2) 1071/ 60006CA :                     ; ; 		tst	r0,r0
(2) 1072/ 60006CA :                     ; ; 		bt	.no_u
(2) 1073/ 60006CA :                     ; ; 		bsr	.draw_u
(2) 1074/ 60006CA :                     ; ; 		nop
(2) 1075/ 60006CA :                     ; ; .no_u:
(2) 1076/ 60006CA :                     ; ; 		lds	@r15+,pr
(2) 1077/ 60006CA :                     ; ; 		rts
(2) 1078/ 60006CA :                     ; ; 		nop
(2) 1079/ 60006CA :                     ; ; ; DOWN/UP
(2) 1080/ 60006CA :                     ; ; .draw_d:
(2) 1081/ 60006CA :                     ; ; 		dt	r0
(2) 1082/ 60006CA :                     ; ; 		mov	r0,@r1
(2) 1083/ 60006CA :                     ; ; 		mov.w	@(md_bg_yinc_d,r14),r0		; r7 - Layout increment
(2) 1084/ 60006CA :                     ; ; 		exts.w	r0,r2
(2) 1085/ 60006CA :                     ; ; 		mov	#224,r1
(2) 1086/ 60006CA :                     ; ; 		bra	.go_du
(2) 1087/ 60006CA :                     ; ; 		nop
(2) 1088/ 60006CA :                     ; ; .draw_u:
(2) 1089/ 60006CA :                     ; ; 		dt	r0
(2) 1090/ 60006CA :                     ; ; 		mov	r0,@r1
(2) 1091/ 60006CA :                     ; ; 		mov.w	@(md_bg_yinc_u,r14),r0		; r7 - Layout increment
(2) 1092/ 60006CA :                     ; ; 		exts.w	r0,r2
(2) 1093/ 60006CA :                     ; ; 		mov	#0,r1
(2) 1094/ 60006CA :                     ; ; .go_du:
(2) 1095/ 60006CA :                     ; ; 		mulu	r1,r11
(2) 1096/ 60006CA :                     ; ; 		sts	macl,r0
(2) 1097/ 60006CA :                     ; ; 		mov	r10,r6
(2) 1098/ 60006CA :                     ; ; 		add	r0,r6
(2) 1099/ 60006CA :                     ; ; ; 		mov	#-$10,r0
(2) 1100/ 60006CA :                     ; ; ; 		and	r0,r6			; r6 - curr out pos
(2) 1101/ 60006CA :                     ; ; 		mov	r8,@-r15
(2) 1102/ 60006CA :                     ; ; 		mov.w	@(md_bg_xinc_l,r14),r0		; r7 - Layout increment
(2) 1103/ 60006CA :                     ; ; 		exts.w	r0,r1
(2) 1104/ 60006CA :                     ; ; 		mov	#16,r3		; <-- MANUAL BLOCK SIZE
(2) 1105/ 60006CA :                     ; ; 		mulu	r3,r1
(2) 1106/ 60006CA :                     ; ; 		sts	macl,r0
(2) 1107/ 60006CA :                     ; ; 		shlr8	r0
(2) 1108/ 60006CA :                     ; ; 		add	r0,r8
(2) 1109/ 60006CA :                     ; ; 		mulu	r3,r2
(2) 1110/ 60006CA :                     ; ; 		sts	macl,r0
(2) 1111/ 60006CA :                     ; ; 		shlr8	r0
(2) 1112/ 60006CA :                     ; ; 		mulu	r7,r0
(2) 1113/ 60006CA :                     ; ; 		sts	macl,r0
(2) 1114/ 60006CA :                     ; ; 		add	r0,r8
(2) 1115/ 60006CA :                     ; ; 		mov	#((320+16)/16),r1
(2) 1116/ 60006CA :                     ; ; .yd_blk:
(2) 1117/ 60006CA :                     ; ; 		mov	r6,@-r15
(2) 1118/ 60006CA :                     ; ; 		mov	r1,@-r15
(2) 1119/ 60006CA :                     ; ; 		mov	r9,r5
(2) 1120/ 60006CA :                     ; ; 		mov.b	@r8,r0
(2) 1121/ 60006CA :                     ; ; 		extu.b	r0,r0		; BYTE
(2) 1122/ 60006CA :                     ; ; 		mov	#16*16,r3
(2) 1123/ 60006CA :                     ; ; 		mulu	r3,r0
(2) 1124/ 60006CA :                     ; ; 		sts	macl,r0
(2) 1125/ 60006CA :                     ; ; 		mov	r9,r5
(2) 1126/ 60006CA :                     ; ; 		add	r0,r5
(2) 1127/ 60006CA :                     ; ; ;
(2) 1128/ 60006CA :                     ; ; 		mov	#16,r3
(2) 1129/ 60006CA :                     ; ; .yd_lne:
(2) 1130/ 60006CA :                     ; ; 		cmp/ge	r12,r6
(2) 1131/ 60006CA :                     ; ; 		bf	.yd_res
(2) 1132/ 60006CA :                     ; ; 		sub	r12,r6
(2) 1133/ 60006CA :                     ; ; .yd_res:
(2) 1134/ 60006CA :                     ; ; 		mov	#16/4,r4
(2) 1135/ 60006CA :                     ; ; .xd_lne:
(2) 1136/ 60006CA :                     ; ; 		mov	@r5+,r0
(2) 1137/ 60006CA :                     ; ; 		lds	r0,macl
(2) 1138/ 60006CA :                     ; ; 		sts	mach,r1
(2) 1139/ 60006CA :                     ; ; 		add	r6,r1
(2) 1140/ 60006CA :                     ; ; 		mov	r13,r2
(2) 1141/ 60006CA :                     ; ; 		add	r6,r2
(2) 1142/ 60006CA :                     ; ; 		mov	r0,@r1
(2) 1143/ 60006CA :                     ; ; 		add	#4,r6
(2) 1144/ 60006CA :                     ; ; 		mov	r0,@r2
(2) 1145/ 60006CA :                     ; ; 		mov	#320,r0
(2) 1146/ 60006CA :                     ; ; 		cmp/ge	r0,r6
(2) 1147/ 60006CA :                     ; ; 		bt	.xd_ex
(2) 1148/ 60006CA :                     ; ; 		sts	macl,r0
(2) 1149/ 60006CA :                     ; ; 		add	r12,r1
(2) 1150/ 60006CA :                     ; ; 		mov	r0,@r1
(2) 1151/ 60006CA :                     ; ; 		add	r12,r2
(2) 1152/ 60006CA :                     ; ; 		mov	r0,@r2
(2) 1153/ 60006CA :                     ; ; 		nop
(2) 1154/ 60006CA :                     ; ; .xd_ex:
(2) 1155/ 60006CA :                     ; ; 		dt	r4
(2) 1156/ 60006CA :                     ; ; 		bf	.xd_lne
(2) 1157/ 60006CA :                     ; ; 		add	#-16,r6	; bring point back
(2) 1158/ 60006CA :                     ; ; 		dt	r3
(2) 1159/ 60006CA :                     ; ; 		bf/s	.yd_lne
(2) 1160/ 60006CA :                     ; ; 		add	r11,r6
(2) 1161/ 60006CA :                     ; ;
(2) 1162/ 60006CA :                     ; ; 		mov	@r15+,r1
(2) 1163/ 60006CA :                     ; ; 		mov	@r15+,r6
(2) 1164/ 60006CA :                     ; ; 		mov	#16,r0
(2) 1165/ 60006CA :                     ; ; 		add	r0,r6
(2) 1166/ 60006CA :                     ; ; 		dt	r1
(2) 1167/ 60006CA :                     ; ; 		bf/s	.yd_blk
(2) 1168/ 60006CA :                     ; ; 		add	#1,r8
(2) 1169/ 60006CA :                     ; ; 		mov	@r15+,r8
(2) 1170/ 60006CA :                     ; ; 		rts
(2) 1171/ 60006CA :                     ; ; 		nop
(2) 1172/ 60006CA :                     ; ; 		align 4
(2) 1173/ 60006CA :                     ; ; 		ltorg
(2) 1174/ 60006CA :                     ;
(2) 1175/ 60006CA :                     ; ; ----------------------------------------------------------------
(2) 1176/ 60006CA :                     ; ; Super Sprites
(2) 1177/ 60006CA :                     ; ; ----------------------------------------------------------------
(2) 1178/ 60006CA :                     ;
(2) 1179/ 60006CA :                     ; ; --------------------------------------------------------
(2) 1180/ 60006CA :                     ; ; MarsVideo_MkSprCoords
(2) 1181/ 60006CA :                     ; ;
(2) 1182/ 60006CA :                     ; ; This creates a backup of the screen's position for
(2) 1183/ 60006CA :                     ; ; the sprite-refill boxes
(2) 1184/ 60006CA :                     ; ;
(2) 1185/ 60006CA :                     ; ; Input:
(2) 1186/ 60006CA :                     ; ; r1 - VRAM base
(2) 1187/ 60006CA :                     ; ; r2 - X Top-Left position
(2) 1188/ 60006CA :                     ; ; r3 - Y (real) position
(2) 1189/ 60006CA :                     ; ; r4 - Scrolling area Width
(2) 1190/ 60006CA :                     ; ; r5 - Scrolling area Height
(2) 1191/ 60006CA :                     ; ; r6 - Scroll area size
(2) 1192/ 60006CA :                     ; ; r7 - Output settings to this area
(2) 1193/ 60006CA :                     ; ;
(2) 1194/ 60006CA :                     ; ; Breaks:
(2) 1195/ 60006CA :                     ; ; r7
(2) 1196/ 60006CA :                     ; ; --------------------------------------------------------
(2) 1197/ 60006CA :                     ;
(2) 1198/ 60006CA :                     ; 		align 4
(2) 1199/ 60006CA :                     ; MarsVideo_MkSprCoords:
(2) 1200/ 60006CA :                     ; 		add	#4,r7
(2) 1201/ 60006CA :                     ; 		mov	r6,@-r7
(2) 1202/ 60006CA :                     ; 		mov	r5,@-r7
(2) 1203/ 60006CA :                     ; 		mov	r4,@-r7
(2) 1204/ 60006CA :                     ; 		mov	r3,@-r7
(2) 1205/ 60006CA :                     ; 		mov	r2,@-r7
(2) 1206/ 60006CA :                     ; 		mov	r1,@-r7
(2) 1207/ 60006CA :                     ; 		rts
(2) 1208/ 60006CA :                     ; 		nop
(2) 1209/ 60006CA :                     ; 		align 4
(2) 1210/ 60006CA :                     ;
(2) 1211/ 60006CA :                     ; ; --------------------------------------------------------
(2) 1212/ 60006CA :                     ; ; MarsVideo_MkSprBoxes
(2) 1213/ 60006CA :                     ; ; --------------------------------------------------------
(2) 1214/ 60006CA :                     ;
(2) 1215/ 60006CA :                     ; 		align 4
(2) 1216/ 60006CA :                     ; MarsVideo_MkSprBoxes:
(2) 1217/ 60006CA :                     ;  		mov	#RAM_Mars_DreqRead+Dreq_SuperSpr,r14
(2) 1218/ 60006CA :                     ; 		mov	#Cach_SprBoxList,r13
(2) 1219/ 60006CA :                     ; .next_save:
(2) 1220/ 60006CA :                     ; 		mov	@(marsspr_data,r14),r0
(2) 1221/ 60006CA :                     ; 		tst	r0,r0
(2) 1222/ 60006CA :                     ; 		bt	.last
(2) 1223/ 60006CA :                     ; 		mov	#MAX_SSPRSPD,r0		; expand box (max speed)
(2) 1224/ 60006CA :                     ; 		mov	@(marsspr_x,r14),r5	; XXXX YYYY
(2) 1225/ 60006CA :                     ; 		exts.w	r5,r6
(2) 1226/ 60006CA :                     ; 		mov	@(marsspr_xfrm,r14),r7	; ?? ?? XX YY
(2) 1227/ 60006CA :                     ; 		shlr16	r5
(2) 1228/ 60006CA :                     ; 		exts.w	r5,r5
(2) 1229/ 60006CA :                     ; 		extu.b	r7,r8
(2) 1230/ 60006CA :                     ; 		shlr8	r7
(2) 1231/ 60006CA :                     ; 		extu.b	r7,r7
(2) 1232/ 60006CA :                     ; 		add	r5,r7
(2) 1233/ 60006CA :                     ; 		add	r6,r8
(2) 1234/ 60006CA :                     ; ; 		mov.w	@(marsspr_x,r14),r0
(2) 1235/ 60006CA :                     ; ; 		exts.w	r0,r5
(2) 1236/ 60006CA :                     ; ; 		mov.w	@(marsspr_y,r14),r0
(2) 1237/ 60006CA :                     ; ; 		exts.w	r0,r6
(2) 1238/ 60006CA :                     ; ; 		mov.b	@(marsspr_xs,r14),r0
(2) 1239/ 60006CA :                     ; ; 		exts.b	r0,r7
(2) 1240/ 60006CA :                     ; ; 		mov.b	@(marsspr_ys,r14),r0
(2) 1241/ 60006CA :                     ; ; 		exts.b	r0,r8
(2) 1242/ 60006CA :                     ; ; 		add	r5,r7
(2) 1243/ 60006CA :                     ; ; 		add	r6,r8
(2) 1244/ 60006CA :                     ;
(2) 1245/ 60006CA :                     ; 		sub	r0,r5	; expand box
(2) 1246/ 60006CA :                     ; 		sub	r0,r6
(2) 1247/ 60006CA :                     ; 		add	r0,r7
(2) 1248/ 60006CA :                     ; 		add	r0,r8
(2) 1249/ 60006CA :                     ; ; 		shlr	r0
(2) 1250/ 60006CA :                     ; 		add	r0,r7
(2) 1251/ 60006CA :                     ; ; 		add	r0,r8
(2) 1252/ 60006CA :                     ; 		mov	#-4,r0	; align by 4
(2) 1253/ 60006CA :                     ; 		and	r0,r5
(2) 1254/ 60006CA :                     ; 		and	r0,r7
(2) 1255/ 60006CA :                     ; 		and	r0,r6
(2) 1256/ 60006CA :                     ; 		and	r0,r8
(2) 1257/ 60006CA :                     ; 		mov	#320+16,r1
(2) 1258/ 60006CA :                     ; 		mov	#224+16,r2
(2) 1259/ 60006CA :                     ; 		cmp/pl	r7
(2) 1260/ 60006CA :                     ; 		bf	.spr_out
(2) 1261/ 60006CA :                     ; 		cmp/pl	r8
(2) 1262/ 60006CA :                     ; 		bf	.spr_out
(2) 1263/ 60006CA :                     ; 		cmp/ge	r1,r5
(2) 1264/ 60006CA :                     ; 		bt	.spr_out
(2) 1265/ 60006CA :                     ; 		cmp/ge	r2,r6
(2) 1266/ 60006CA :                     ; 		bt	.spr_out
(2) 1267/ 60006CA :                     ; 		cmp/pz	r5
(2) 1268/ 60006CA :                     ; 		bt	.xl_l
(2) 1269/ 60006CA :                     ; 		xor	r5,r5
(2) 1270/ 60006CA :                     ; .xl_l:
(2) 1271/ 60006CA :                     ; 		cmp/pz	r6
(2) 1272/ 60006CA :                     ; 		bt	.yl_l
(2) 1273/ 60006CA :                     ; 		xor	r6,r6
(2) 1274/ 60006CA :                     ; .yl_l:
(2) 1275/ 60006CA :                     ; 		cmp/gt	r1,r7
(2) 1276/ 60006CA :                     ; 		bf	.xr_l
(2) 1277/ 60006CA :                     ; 		mov	r1,r7
(2) 1278/ 60006CA :                     ; .xr_l:
(2) 1279/ 60006CA :                     ; 		cmp/gt	r2,r8
(2) 1280/ 60006CA :                     ; 		bf	.yr_l
(2) 1281/ 60006CA :                     ; 		mov	r2,r8
(2) 1282/ 60006CA :                     ; .yr_l:
(2) 1283/ 60006CA :                     ; 		mulu	r11,r6
(2) 1284/ 60006CA :                     ; 		sts	macl,r0
(2) 1285/ 60006CA :                     ; 		add	r0,r4
(2) 1286/ 60006CA :                     ; .y_lp:
(2) 1287/ 60006CA :                     ; 		cmp/gt	r12,r4
(2) 1288/ 60006CA :                     ; 		bf	.y_keep
(2) 1289/ 60006CA :                     ; 		sub	r12,r4
(2) 1290/ 60006CA :                     ; .y_keep:
(2) 1291/ 60006CA :                     ;
(2) 1292/ 60006CA :                     ; 	; r5 - X left
(2) 1293/ 60006CA :                     ; 	; r6 - Y top
(2) 1294/ 60006CA :                     ; 	; r7 - X right
(2) 1295/ 60006CA :                     ; 	; r8 - Y bottom
(2) 1296/ 60006CA :                     ; 	;
(2) 1297/ 60006CA :                     ; 	; (Xend>>2)|$80,(Xstart>>2),Ybottom,Ytop
(2) 1298/ 60006CA :                     ; 		mov	r7,r0
(2) 1299/ 60006CA :                     ; 		shlr2	r0
(2) 1300/ 60006CA :                     ; 		extu.b	r0,r0
(2) 1301/ 60006CA :                     ; 		or	#$80,r0
(2) 1302/ 60006CA :                     ; 		shll16	r0
(2) 1303/ 60006CA :                     ; 		shll8	r0
(2) 1304/ 60006CA :                     ; 		mov	r5,r2
(2) 1305/ 60006CA :                     ; 		shll16	r2
(2) 1306/ 60006CA :                     ; 		shlr2	r2
(2) 1307/ 60006CA :                     ; 		mov	r0,r3
(2) 1308/ 60006CA :                     ; 		mov	r6,r0
(2) 1309/ 60006CA :                     ; 		mov	r8,r1
(2) 1310/ 60006CA :                     ; 		extu.b	r1,r1
(2) 1311/ 60006CA :                     ; 		shll8	r1
(2) 1312/ 60006CA :                     ; 		and	#$FF,r0
(2) 1313/ 60006CA :                     ; 		or	r3,r0
(2) 1314/ 60006CA :                     ; 		or	r2,r0
(2) 1315/ 60006CA :                     ; 		or	r1,r0
(2) 1316/ 60006CA :                     ; 		mov	r0,@r13
(2) 1317/ 60006CA :                     ; 		add	#4,r13
(2) 1318/ 60006CA :                     ; .spr_out:
(2) 1319/ 60006CA :                     ; 		bra	.next_save
(2) 1320/ 60006CA :                     ; 		add 	#sizeof_marsspr,r14
(2) 1321/ 60006CA :                     ; .last:
(2) 1322/ 60006CA :                     ; 		rts
(2) 1323/ 60006CA :                     ; 		nop
(2) 1324/ 60006CA :                     ; 		align 4
(2) 1325/ 60006CA :                     ; 		ltorg
(2) 1326/ 60006CA :                     ;
(2) 1327/ 60006CA :                     ; ; ====================================================================
(2) 1328/ 60006CA :                     ; ; ----------------------------------------------------------------
(2) 1329/ 60006CA :                     ; ; 3D Section
(2) 1330/ 60006CA :                     ; ;
(2) 1331/ 60006CA :                     ; ; Nothing to see here (yet), all stuff is
(2) 1332/ 60006CA :                     ; ; located at cache_m_3D.asm
(2) 1333/ 60006CA :                     ; ; ----------------------------------------------------------------
(2) 1334/ 60006CA :                     
(1)  950/ 60006CA :                     		include "system/mars/sound.asm"
(2)    1/ 60006CA :                     ; ====================================================================
(2)    2/ 60006CA :                     ; ----------------------------------------------------------------
(2)    3/ 60006CA :                     ; 32X Sound (For SLAVE CPU ONLY)
(2)    4/ 60006CA :                     ;
(2)    5/ 60006CA :                     ; Playback code (the PWM interrupt) is located at cache_slv.asm
(2)    6/ 60006CA :                     ; ----------------------------------------------------------------
(2)    7/ 60006CA :                     
(2)    8/ 60006CA :                     ; --------------------------------------------------------
(2)    9/ 60006CA :                     ; Settings
(2)   10/ 60006CA :                     ; --------------------------------------------------------
(2)   11/ 60006CA :                     
(2)   12/ 60006CA :                     ; MAX_PWMCHNL	equ 7		; MAXIMUM usable PWM channels (TODO: keep it like this)
(2)   13/ 60006CA :                     ; MAX_PWMBACKUP	equ $80		; 1-bit sizes only: $40,$80,$100...
(2)   14/ 60006CA : =$5622              SAMPLE_RATE	equ 22050
(2)   15/ 60006CA :                     
(2)   16/ 60006CA :                     ; --------------------------------------------------------
(2)   17/ 60006CA :                     ; Structs
(2)   18/ 60006CA :                     ; --------------------------------------------------------
(2)   19/ 60006CA :                     
(2)   20/ 60006CA :                     ; ; 32X sound channel
(2)   21/ 60006CA :                     ; 		struct 0
(2)   22/ 60006CA :                     ; mchnsnd_enbl	ds.l 1
(2)   23/ 60006CA :                     ; mchnsnd_read	ds.l 1		; 0 - off
(2)   24/ 60006CA :                     ; mchnsnd_cchread	ds.l 1
(2)   25/ 60006CA :                     ; mchnsnd_bank	ds.l 1		; CS0-3 OR value
(2)   26/ 60006CA :                     ; mchnsnd_start	ds.l 1
(2)   27/ 60006CA :                     ; mchnsnd_end	ds.l 1
(2)   28/ 60006CA :                     ; mchnsnd_loop	ds.l 1
(2)   29/ 60006CA :                     ; mchnsnd_pitch	ds.l 1
(2)   30/ 60006CA :                     ; mchnsnd_flags	ds.l 1		; %SLR S-wave format mono/stereo | LR-wave output bits
(2)   31/ 60006CA :                     ; mchnsnd_vol	ds.l 1
(2)   32/ 60006CA :                     ; sizeof_sndchn	ds.l 0
(2)   33/ 60006CA :                     ; 		finish
(2)   34/ 60006CA :                     
(2)   35/ 60006CA :                     ; ====================================================================
(2)   36/ 60006CA :                     ; --------------------------------------------------------
(2)   37/ 60006CA :                     ; Init Sound PWM
(2)   38/ 60006CA :                     ;
(2)   39/ 60006CA :                     ; Cycle register formulas:
(2)   40/ 60006CA :                     ; NTSC ((((23011361<<1)/SAMPLE_RATE+1)>>1)+1)
(2)   41/ 60006CA :                     ; PAL  ((((22801467<<1)/SAMPLE_RATE+1)>>1)+1)
(2)   42/ 60006CA :                     ;
(2)   43/ 60006CA :                     ; NOTE: The CLICK sound after calling this is normal.
(2)   44/ 60006CA :                     ; --------------------------------------------------------
(2)   45/ 60006CA :                     
(2)   46/ 60006CA :                     		align 4
(2)   47/ 60006CC :                     MarsSound_Init:
(2)   48/ 60006CC : 4F13                		stc	gbr,@-r15
(2)   49/ 60006CE : D00B                		mov	#_sysreg,r0
(2)   50/ 60006D0 : 401E                		ldc	r0,gbr
(2)   51/ 60006D2 : 9019                		mov	#$0105,r0					; Timing interval $01, output L/R
(2)   52/ 60006D4 : C118                		mov.w	r0,@(timerctl,gbr)
(2)   53/ 60006D6 : 9018                		mov	#((((23011361<<1)/SAMPLE_RATE+1)>>1)+1),r0	; Samplerate
(2)   54/ 60006D8 : C119                		mov.w	r0,@(cycle,gbr)
(2)   55/ 60006DA : E001                		mov	#1,r0
(2)   56/ 60006DC : C11C                		mov.w	r0,@(monowidth,gbr)
(2)   57/ 60006DE : C11C                		mov.w	r0,@(monowidth,gbr)
(2)   58/ 60006E0 : C11C                		mov.w	r0,@(monowidth,gbr)
(2)   59/ 60006E2 : 4F17                		ldc	@r15+,gbr
(2)   60/ 60006E4 : 000B                		rts
(2)   61/ 60006E6 : 0009                		nop
(2)   62/ 60006E8 :                     		align 4
(2)   63/ 60006E8 :                     
(2)   64/ 60006E8 :                     ; ====================================================================
(2)   65/ 60006E8 :                     ; ----------------------------------------------------------------
(2)   66/ 60006E8 :                     ; Subroutines
(2)   67/ 60006E8 :                     ; ----------------------------------------------------------------
(2)   68/ 60006E8 :                     
(2)   69/ 60006E8 :                     ; --------------------------------------------------------
(2)   70/ 60006E8 :                     ; Input:
(2)   71/ 60006E8 :                     ; r1 - Source
(2)   72/ 60006E8 :                     ; r2 - Destination
(2)   73/ 60006E8 :                     ; r3 - Size / 4
(2)   74/ 60006E8 :                     ; --------------------------------------------------------
(2)   75/ 60006E8 :                     
(2)   76/ 60006E8 :                     MarsSound_FirstFill:
(2)   77/ 60006E8 : D105                		mov	#RAM_Mars_GemaWave_0,r1
(2)   78/ 60006EA : 920F                		mov	#($1000*2)/4,r2
(2)   79/ 60006EC : D005                		mov	#$00800080,r0
(2)   80/ 60006EE :                     .fill_both:
(2)   81/ 60006EE : 2102                		mov	r0,@r1
(2)   82/ 60006F0 : 4210                		dt	r2
(2)   83/ 60006F2 : 8FFC                		bf/s	.fill_both
(2)   84/ 60006F4 : 7104                		add	#4,r1
(2)   85/ 60006F6 :                     
(2)   86/ 60006F6 : E1B0                		mov	#_DMAOPERATION,r1
(2)   87/ 60006F8 :                     
(2)   88/ 60006F8 :                     ; 		mov	#,r1
(2)   89/ 60006F8 :                     ; 		mov	#,r2
(2)   90/ 60006F8 :                     ;
(2)   91/ 60006F8 :                     ; 		mov	#_DMAOPERATION,r5
(2)   92/ 60006F8 :                     ; 		mov	#_DMASOURCE1,r4
(2)   93/ 60006F8 :                     ; 		mov	#0,r0
(2)   94/ 60006F8 :                     ; 		mov	r0,@r5
(2)   95/ 60006F8 :                     ; 		mov	#%0101101011100000,r0
(2)   96/ 60006F8 :                     ; 		mov	r0,@($0C,r4)
(2)   97/ 60006F8 :                     ; 		mov	r1,r0
(2)   98/ 60006F8 :                     ; 		mov	r0,@r4
(2)   99/ 60006F8 :                     ; 		mov	r2,r0			; <-- point fbdata here
(2)  100/ 60006F8 :                     ; 		mov	r0,@($04,r4)
(2)  101/ 60006F8 :                     ; 		mov	r3,r0
(2)  102/ 60006F8 :                     ; 		mov	r0,@($08,r4)
(2)  103/ 60006F8 :                     ; 		mov	#%0101101011100001,r0
(2)  104/ 60006F8 :                     ; 		mov	r0,@($0C,r4)
(2)  105/ 60006F8 :                     ; 		mov	#1,r0
(2)  106/ 60006F8 :                     ; 		mov	r0,@r5
(2)  107/ 60006F8 :                     ; .wait_dma:	mov	@($C,r4),r0		; Still on DMA?
(2)  108/ 60006F8 :                     ; 		tst	#%10,r0
(2)  109/ 60006F8 :                     ; 		bt	.wait_dma
(2)  110/ 60006F8 :                     ; 		mov	#0,r0
(2)  111/ 60006F8 :                     ; 		mov	r0,@r5
(2)  112/ 60006F8 :                     ; 		mov	#%0101101011100000,r0
(2)  113/ 60006F8 :                     ; 		mov	r0,@($C,r4)
(2)  114/ 60006F8 : 000B                		rts
(2)  115/ 60006FA : 0009                		nop
(2)  116/ 60006FC :                     		align 4
(2)  117/ 60006FC : 2000 4000 2601 55F0 		ltorg
                    0080 0080 0105 0415 
                    0800                
(2)  118/ 600070E :                     
(2)  119/ 600070E :                     ; ; --------------------------------------------------------
(2)  120/ 600070E :                     ; ; MarsSound_SetPwm
(2)  121/ 600070E :                     ; ;
(2)  122/ 600070E :                     ; ; Sets new sound data to a channel slot, automaticly
(2)  123/ 600070E :                     ; ; plays.
(2)  124/ 600070E :                     ; ;
(2)  125/ 600070E :                     ; ; Input:
(2)  126/ 600070E :                     ; ; r1 | Channel (0-6)
(2)  127/ 600070E :                     ; ; r2 | Start address (SH2 AREA)
(2)  128/ 600070E :                     ; ; r3 | End address (SH2 AREA)
(2)  129/ 600070E :                     ; ; r4 | Loop address (SH2 AREA, ignored if loop bit isn't set)
(2)  130/ 600070E :                     ; ; r5 | Starting pitch ($xxxxxx.xx, $100 default speed)
(2)  131/ 600070E :                     ; ; r6 | Volume (0-High)
(2)  132/ 600070E :                     ; ; r7 | Flags: %xxxxslLR
(2)  133/ 600070E :                     ; ;      LR - Enable output to these speakers
(2)  134/ 600070E :                     ; ;       l - LOOP flag
(2)  135/ 600070E :                     ; ;       s - Sample data is in Stereo (16-bit)
(2)  136/ 600070E :                     ; ;
(2)  137/ 600070E :                     ; ; Breaks:
(2)  138/ 600070E :                     ; ; r0,r8-r9,macl
(2)  139/ 600070E :                     ; ; --------------------------------------------------------
(2)  140/ 600070E :                     ;
(2)  141/ 600070E :                     ; MarsSound_SetPwm:
(2)  142/ 600070E :                     ; 		mov	#MarsSnd_PwmChnls,r8
(2)  143/ 600070E :                     ; 		mov 	#sizeof_sndchn,r0
(2)  144/ 600070E :                     ; 		mulu	r1,r0
(2)  145/ 600070E :                     ; 		sts	macl,r0
(2)  146/ 600070E :                     ; 		add 	r0,r8
(2)  147/ 600070E :                     ; 		mov 	#0,r0
(2)  148/ 600070E :                     ; 		mov 	r0,@(mchnsnd_enbl,r8)
(2)  149/ 600070E :                     ; ; 		mov 	r0,@(mchnsnd_read,r8)
(2)  150/ 600070E :                     ; ; 		mov 	r0,@(mchnsnd_bank,r8)
(2)  151/ 600070E :                     ; 		mov 	r5,@(mchnsnd_pitch,r8)
(2)  152/ 600070E :                     ; 		mov 	r6,@(mchnsnd_vol,r8)
(2)  153/ 600070E :                     ; 		mov 	r7,@(mchnsnd_flags,r8)
(2)  154/ 600070E :                     ; 		mov 	r2,r0				; Set MSB
(2)  155/ 600070E :                     ; 		mov	#-1,r9				; r9 - FF000000
(2)  156/ 600070E :                     ; 		shll16	r9
(2)  157/ 600070E :                     ; 		shll8	r9
(2)  158/ 600070E :                     ; 		and	r9,r0
(2)  159/ 600070E :                     ; ; 		mov 	#$FF000000,r9
(2)  160/ 600070E :                     ; ; 		and 	r9,r0
(2)  161/ 600070E :                     ; 		mov 	r0,@(mchnsnd_bank,r8)
(2)  162/ 600070E :                     ; 		mov 	r4,r0				; Set POINTS
(2)  163/ 600070E :                     ; 		cmp/eq	#-1,r0
(2)  164/ 600070E :                     ; 		bt	.endmrk
(2)  165/ 600070E :                     ; 		shll8	r0
(2)  166/ 600070E :                     ; .endmrk:
(2)  167/ 600070E :                     ; 		mov	r0,@(mchnsnd_loop,r8)
(2)  168/ 600070E :                     ; 		mov 	r3,r0
(2)  169/ 600070E :                     ; 		shll8	r0
(2)  170/ 600070E :                     ; 		mov	r0,@(mchnsnd_end,r8)
(2)  171/ 600070E :                     ; 		mov 	r2,r0
(2)  172/ 600070E :                     ; 		shll8	r0
(2)  173/ 600070E :                     ; 		mov 	r0,@(mchnsnd_start,r8)
(2)  174/ 600070E :                     ; 		mov 	r0,@(mchnsnd_read,r8)
(2)  175/ 600070E :                     ; 		mov 	#1,r0
(2)  176/ 600070E :                     ; 		mov 	r0,@(mchnsnd_enbl,r8)
(2)  177/ 600070E :                     ; 		rts
(2)  178/ 600070E :                     ; 		nop
(2)  179/ 600070E :                     ; 		align 4
(2)  180/ 600070E :                     ;
(2)  181/ 600070E :                     ; ; --------------------------------------------------------
(2)  182/ 600070E :                     ; ; MarsSound_SetPwmPitch
(2)  183/ 600070E :                     ; ;
(2)  184/ 600070E :                     ; ; Sets pitch data of a channel slot
(2)  185/ 600070E :                     ; ;
(2)  186/ 600070E :                     ; ; Input:
(2)  187/ 600070E :                     ; ; r1 | Channel (0-6)
(2)  188/ 600070E :                     ; ; r2 | Pitch ($xxxxxx.xx, $100 default speed)
(2)  189/ 600070E :                     ; ;
(2)  190/ 600070E :                     ; ; Breaks:
(2)  191/ 600070E :                     ; ; r8,macl
(2)  192/ 600070E :                     ; ; --------------------------------------------------------
(2)  193/ 600070E :                     ;
(2)  194/ 600070E :                     ; MarsSound_SetPwmPitch:
(2)  195/ 600070E :                     ; 		mov	#MarsSnd_PwmChnls,r8
(2)  196/ 600070E :                     ; 		mov 	#sizeof_sndchn,r0
(2)  197/ 600070E :                     ; 		mulu	r1,r0
(2)  198/ 600070E :                     ; 		sts	macl,r0
(2)  199/ 600070E :                     ; 		add 	r0,r8
(2)  200/ 600070E :                     ; 		mov	@(mchnsnd_enbl,r8),r0
(2)  201/ 600070E :                     ; 		cmp/eq	#1,r0
(2)  202/ 600070E :                     ; 		bf	.off_1
(2)  203/ 600070E :                     ; 		mov	@(mchnsnd_read,r8),r0
(2)  204/ 600070E :                     ; 		mov	r2,@(mchnsnd_pitch,r8)
(2)  205/ 600070E :                     ; .off_1:
(2)  206/ 600070E :                     ; 		rts
(2)  207/ 600070E :                     ; 		nop
(2)  208/ 600070E :                     ; 		align 4
(2)  209/ 600070E :                     ;
(2)  210/ 600070E :                     ; ; --------------------------------------------------------
(2)  211/ 600070E :                     ; ; MarsSound_SetVolume
(2)  212/ 600070E :                     ; ;
(2)  213/ 600070E :                     ; ; Changes the volume of a channel slot
(2)  214/ 600070E :                     ; ;
(2)  215/ 600070E :                     ; ; Input:
(2)  216/ 600070E :                     ; ; r1 | Channel (0-6)
(2)  217/ 600070E :                     ; ; r2 | Volume (in reverse: higher value is low)
(2)  218/ 600070E :                     ; ;
(2)  219/ 600070E :                     ; ; Breaks:
(2)  220/ 600070E :                     ; ; r8,macl
(2)  221/ 600070E :                     ; ; --------------------------------------------------------
(2)  222/ 600070E :                     ;
(2)  223/ 600070E :                     ; MarsSound_SetVolume:
(2)  224/ 600070E :                     ; 		mov	#MarsSnd_PwmChnls,r8
(2)  225/ 600070E :                     ; 		mov 	#sizeof_sndchn,r0
(2)  226/ 600070E :                     ; 		mulu	r1,r0
(2)  227/ 600070E :                     ; 		sts	macl,r0
(2)  228/ 600070E :                     ; 		add 	r0,r8
(2)  229/ 600070E :                     ; 		mov	@(mchnsnd_enbl,r8),r0
(2)  230/ 600070E :                     ; 		cmp/eq	#1,r0
(2)  231/ 600070E :                     ; 		bf	.off_1
(2)  232/ 600070E :                     ; 		mov	r2,r0
(2)  233/ 600070E :                     ; 		mov	r0,@(mchnsnd_vol,r8)
(2)  234/ 600070E :                     ; .off_1:
(2)  235/ 600070E :                     ; 		rts
(2)  236/ 600070E :                     ; 		nop
(2)  237/ 600070E :                     ; 		align 4
(2)  238/ 600070E :                     ;
(2)  239/ 600070E :                     ; ; --------------------------------------------------------
(2)  240/ 600070E :                     ; ; MarsSound_PwmEnable
(2)  241/ 600070E :                     ; ;
(2)  242/ 600070E :                     ; ; Turns ON or OFF Current PWM slot
(2)  243/ 600070E :                     ; ;
(2)  244/ 600070E :                     ; ; Input:
(2)  245/ 600070E :                     ; ; r1 | Channel (0-6)
(2)  246/ 600070E :                     ; ; r2 | Enable/Disable
(2)  247/ 600070E :                     ; ;
(2)  248/ 600070E :                     ; ; Breaks:
(2)  249/ 600070E :                     ; ; r8,macl
(2)  250/ 600070E :                     ; ; --------------------------------------------------------
(2)  251/ 600070E :                     ;
(2)  252/ 600070E :                     ; MarsSound_PwmEnable:
(2)  253/ 600070E :                     ; 		mov	#MarsSnd_PwmChnls,r8
(2)  254/ 600070E :                     ; 		mov 	#sizeof_sndchn,r0
(2)  255/ 600070E :                     ; 		mulu	r1,r0
(2)  256/ 600070E :                     ; 		sts	macl,r0
(2)  257/ 600070E :                     ; 		add 	r0,r8
(2)  258/ 600070E :                     ; 		mov 	r2,@(mchnsnd_enbl,r8)
(2)  259/ 600070E :                     ; ; 		mov 	#0,r0
(2)  260/ 600070E :                     ; ; 		mov 	r0,@(mchnsnd_read,r8)
(2)  261/ 600070E :                     ; ; 		mov 	r0,@(mchnsnd_bank,r8)
(2)  262/ 600070E :                     ; 		rts
(2)  263/ 600070E :                     ; 		nop
(2)  264/ 600070E :                     ; 		align 4
(2)  265/ 600070E :                     ;
(2)  266/ 600070E :                     ; ; --------------------------------------------------------
(2)  267/ 600070E :                     ; ; MarsSound_Refill
(2)  268/ 600070E :                     ; ;
(2)  269/ 600070E :                     ; ; Call this before the 68K side closes ROM access
(2)  270/ 600070E :                     ; ; (before 68k side sets RV=1)
(2)  271/ 600070E :                     ; ;
(2)  272/ 600070E :                     ; ; Breaks:
(2)  273/ 600070E :                     ; ; r1-r8
(2)  274/ 600070E :                     ; ;
(2)  275/ 600070E :                     ; ; NOTE:
(2)  276/ 600070E :                     ; ; The trick here is to keep PWM interrupt enabled
(2)  277/ 600070E :                     ; ; while filling the backup data
(2)  278/ 600070E :                     ; ; --------------------------------------------------------
(2)  279/ 600070E :                     ;
(2)  280/ 600070E :                     ; MarsSnd_Refill:
(2)  281/ 600070E :                     ; 		mov	#MarsSnd_PwmChnls,r8
(2)  282/ 600070E :                     ; 		mov	#MAX_PWMCHNL,r6
(2)  283/ 600070E :                     ; 		mov	#sizeof_sndchn,r7
(2)  284/ 600070E :                     ; 		mov	#MarsSnd_PwmCache,r5
(2)  285/ 600070E :                     ; .next_one:
(2)  286/ 600070E :                     ; 		mov	@(mchnsnd_enbl,r8),r0	; This channel is active?
(2)  287/ 600070E :                     ; 		cmp/eq	#1,r0
(2)  288/ 600070E :                     ; 		bf	.not_enbl
(2)  289/ 600070E :                     ; 		mov	@(mchnsnd_bank,r8),r0	; ROM area?
(2)  290/ 600070E :                     ; 		mov	#CS1,r2
(2)  291/ 600070E :                     ; 		cmp/eq	r2,r0
(2)  292/ 600070E :                     ; 		bf	.not_enbl
(2)  293/ 600070E :                     ; 		mov	#0,r1			; Reset backup LSB
(2)  294/ 600070E :                     ; 		mov	r1,@(mchnsnd_cchread,r8)
(2)  295/ 600070E :                     ; 		mov	r5,r1
(2)  296/ 600070E :                     ; 		mov	#MAX_PWMBACKUP/4,r2	; Max bytes / 4
(2)  297/ 600070E :                     ; 		mov	@(mchnsnd_read,r8),r4	; r4 - OLD READ pos
(2)  298/ 600070E :                     ; 		mov	r4,r3
(2)  299/ 600070E :                     ; 		shlr8	r3
(2)  300/ 600070E :                     ; 		add	r0,r3
(2)  301/ 600070E :                     ; .copy_now:
(2)  302/ 600070E :                     ; 	rept 4-1
(2)  303/ 600070E :                     ; 		mov.b	@r3+,r0		; byte by byte...
(2)  304/ 600070E :                     ; 		mov.b	r0,@r1
(2)  305/ 600070E :                     ; 		add	#1,r1
(2)  306/ 600070E :                     ; 	endm
(2)  307/ 600070E :                     ; 		mov.b	@r3+,r0
(2)  308/ 600070E :                     ; 		mov.b	r0,@r1
(2)  309/ 600070E :                     ; 		dt	r2
(2)  310/ 600070E :                     ; 		bf/s	.copy_now
(2)  311/ 600070E :                     ; 		add	#1,r1
(2)  312/ 600070E :                     ; .not_enbl:
(2)  313/ 600070E :                     ; 		mov	#MAX_PWMBACKUP,r0
(2)  314/ 600070E :                     ; 		add	r0,r5
(2)  315/ 600070E :                     ; 		dt	r6
(2)  316/ 600070E :                     ; 		bf/s	.next_one
(2)  317/ 600070E :                     ; 		add	r7,r8
(2)  318/ 600070E :                     ; 		rts
(2)  319/ 600070E :                     ; 		nop
(2)  320/ 600070E :                     ; 		align 4
(2)  321/ 600070E :                     
(2)  322/ 600070E :                     ; ====================================================================
(2)  323/ 600070E :                     
(2)  324/ 600070E :                     		ltorg			; Save literals
(2)  325/ 600070E :                     
(1)  951/ 600070E :                     ; 		align 4
(1)  952/ 600070E :                     
(1)  953/ 600070E :                     ; ====================================================================
(1)  954/ 600070E :                     ; ----------------------------------------------------------------
(1)  955/ 600070E :                     ; Master entry
(1)  956/ 600070E :                     ; ----------------------------------------------------------------
(1)  957/ 600070E :                     
(1)  958/ 600070E :                     		align 4
(1)  959/ 6000710 :                     SH2_M_Entry:
(1)  960/ 6000710 : DF2C                		mov	#STACK_MSTR,r15			; Reset stack
(1)  961/ 6000712 : D02D                		mov	#SH2_Master,r0			; Reset vbr
(1)  962/ 6000714 : 402E                		ldc	r0,vbr
(1)  963/ 6000716 : 9167                		mov.l	#_FRT,r1
(1)  964/ 6000718 : E000                		mov	#0,r0
(1)  965/ 600071A : 8010                		mov.b	r0,@(0,r1)
(1)  966/ 600071C : E0E2                		mov.b	#$E2,r0
(1)  967/ 600071E : 8017                		mov.b	r0,@(7,r1)
(1)  968/ 6000720 : E000                		mov	#0,r0
(1)  969/ 6000722 : 8014                		mov.b	r0,@(4,r1)
(1)  970/ 6000724 : E001                		mov	#1,r0
(1)  971/ 6000726 : 8015                		mov.b	r0,@(5,r1)
(1)  972/ 6000728 : E000                		mov	#0,r0
(1)  973/ 600072A : 8016                		mov.b	r0,@(6,r1)
(1)  974/ 600072C : E001                		mov	#1,r0
(1)  975/ 600072E : 8011                		mov.b	r0,@(1,r1)
(1)  976/ 6000730 : E000                		mov	#0,r0
(1)  977/ 6000732 : 8013                		mov.b	r0,@(3,r1)
(1)  978/ 6000734 : 8012                		mov.b	r0,@(2,r1)
(1)  979/ 6000736 :                     ; 		mov.b	#$F2,r0				; <-- not needed here
(1)  980/ 6000736 :                     ; 		mov.b	r0,@(7,r1)
(1)  981/ 6000736 :                     ; 		mov	#0,r0
(1)  982/ 6000736 :                     ; 		mov.b	r0,@(4,r1)
(1)  983/ 6000736 :                     ; 		mov	#1,r0
(1)  984/ 6000736 :                     ; 		mov.b	r0,@(5,r1)
(1)  985/ 6000736 :                     ; 		mov.b	#$E2,r0
(1)  986/ 6000736 :                     ; 		mov.b	r0,@(7,r1)
(1)  987/ 6000736 :                     
(1)  988/ 6000736 :                     	; Extra interrupt settings
(1)  989/ 6000736 : 9058                		mov.w   #$FEE2,r0			; Extra interrupt priority levels ($FFFFFEE2)
(1)  990/ 6000738 : 9158                		mov     #(3<<4)|(5<<8),r1		; (DMA_LVL<<8)|(WDG_LVL<<4) Current: WDG 3 DMA 5
(1)  991/ 600073A : 2011                		mov.w   r1,@r0
(1)  992/ 600073C : 9057                		mov.w   #$FEE4,r0			; Vector jump number for Watchdog ($FFFFFEE4)
(1)  993/ 600073E : 9157                		mov     #($120/4)<<8,r1			; (vbr+POINTER)<<8
(1)  994/ 6000740 : 2011                		mov.w   r1,@r0
(1)  995/ 6000742 : E0A0                		mov.b	#$A0,r0				; Vector jump number for DMACHANNEL0 ($FFFFFFA0)
(1)  996/ 6000744 : E149                		mov     #($124/4),r1			; (vbr+POINTER)
(1)  997/ 6000746 : 2012                		mov	r1,@r0
(1)  998/ 6000748 : D020                		mov	#RAM_Mars_Global,r0		; Reset gbr
(1)  999/ 600074A : 401E                		ldc	r0,gbr
(1) 1000/ 600074C : D020                		mov	#MarsVideo_Init,r0		; Init Video
(1) 1001/ 600074E : 400B                		jsr	@r0
(1) 1002/ 6000750 : 0009                		nop
(1) 1003/ 6000752 :                     
(1) 1004/ 6000752 :                     ; ====================================================================
(1) 1005/ 6000752 :                     ; ----------------------------------------------------------------
(1) 1006/ 6000752 :                     ; Master MAIN code
(1) 1007/ 6000752 :                     ; ----------------------------------------------------------------
(1) 1008/ 6000752 :                     
(1) 1009/ 6000752 :                     SH2_M_HotStart:
(1) 1010/ 6000752 : 914E                		mov.w	#$FE80,r1		; ($FFFFFE80)
(1) 1011/ 6000754 : 904E                		mov.w	#$A518,r0		; Disable Watchdog
(1) 1012/ 6000756 : 2101                		mov.w	r0,@r1
(1) 1013/ 6000758 : 914D                		mov.w	#_CCR&$FFFF,r1		; Reset CACHE
(1) 1014/ 600075A : E010                		mov	#$10,r0
(1) 1015/ 600075C : 2100                		mov.b	r0,@r1
(1) 1016/ 600075E : 0009                		nop
(1) 1017/ 6000760 : 0009                		nop
(1) 1018/ 6000762 : 0009                		nop
(1) 1019/ 6000764 : 0009                		nop
(1) 1020/ 6000766 : 0009                		nop
(1) 1021/ 6000768 : 0009                		nop
(1) 1022/ 600076A : 0009                		nop
(1) 1023/ 600076C : E009                		mov	#9,r0
(1) 1024/ 600076E : 2100                		mov.b	r0,@r1
(1) 1025/ 6000770 : D118                		mov	#_sysreg,r1
(1) 1026/ 6000772 : 200A                    		xor	r0,r0
(1) 1027/ 6000774 : 811A                		mov.w	r0,@(vresintclr,r1)
(1) 1028/ 6000776 : 811B                		mov.w	r0,@(vintclr,r1)
(1) 1029/ 6000778 : 811C                		mov.w	r0,@(hintclr,r1)
(1) 1030/ 600077A : 811D                		mov.w	r0,@(cmdintclr,r1)
(1) 1031/ 600077C : 811E                		mov.w	r0,@(pwmintclr,r1)
(1) 1032/ 600077E : 6011                		mov.w	@r1,r0
(1) 1033/ 6000780 : CB02                		or	#CMDIRQ_ON,r0
(1) 1034/ 6000782 : 2101                		mov.w	r0,@r1
(1) 1035/ 6000784 : D114                		mov	#_sysreg+comm14,r1
(1) 1036/ 6000786 : 6011                .wait_slv:	mov.w	@r1,r0
(1) 1037/ 6000788 : 2008                		tst	r0,r0
(1) 1038/ 600078A : 8BFC                		bf	.wait_slv
(1) 1039/ 600078C :                     
(1) 1040/ 600078C :                     	; TEMPORAL
(1) 1041/ 600078C : D113                		mov	#ArtMars_TEST,r1
(1) 1042/ 600078E : D214                		mov	#_framebuffer+$200,r2
(1) 1043/ 6000790 : 9332                		mov	#(320*224)/4,r3
(1) 1044/ 6000792 :                     .loopin:
(1) 1045/ 6000792 : 6016                		mov	@r1+,r0
(1) 1046/ 6000794 : 2202                		mov	r0,@r2
(1) 1047/ 6000796 : 4310                		dt	r3
(1) 1048/ 6000798 : 8FFB                		bf/s	.loopin
(1) 1049/ 600079A : 7204                		add	#4,r2
(1) 1050/ 600079C : 9121                		mov	#$200,r1
(1) 1051/ 600079E : 922C                		mov	#320,r2
(1) 1052/ 60007A0 : 932C                		mov	#224,r3
(1) 1053/ 60007A2 : BF4F                		bsr	MarsVideo_MakeNameTbl
(1) 1054/ 60007A4 : E400                		mov	#0,r4
(1) 1055/ 60007A6 :                     
(1) 1056/ 60007A6 : D10F                		mov	#_vdpreg,r1
(1) 1057/ 60007A8 : E001                		mov	#1,r0				; Start at BLANK
(1) 1058/ 60007AA : 8011                		mov.b	r0,@(bitmapmd,r1)
(1) 1059/ 60007AC : 841B                		mov.b	@(framectl,r1),r0		; Frameswap request
(1) 1060/ 60007AE : CA01                		xor	#1,r0
(1) 1061/ 60007B0 : 6303                		mov	r0,r3
(1) 1062/ 60007B2 : 801B                		mov.b	r0,@(framectl,r1)
(1) 1063/ 60007B4 : 841B                .wait_frm:	mov.b	@(framectl,r1),r0		; And wait until it flips
(1) 1064/ 60007B6 : 3300                		cmp/eq	r0,r3
(1) 1065/ 60007B8 : 8BFC                		bf	.wait_frm
(1) 1066/ 60007BA :                     
(1) 1067/ 60007BA : E020                		mov.b	#$20,r0				; Interrupts ON
(1) 1068/ 60007BC : 400E                		ldc	r0,sr
(1) 1069/ 60007BE : A01F                		bra	master_loop
(1) 1070/ 60007C0 : 0009                		nop
(1) 1071/ 60007C2 :                     		align 4
(1) 1072/ 60007C4 : 0604 0000 0600 0000 		ltorg
                    0601 4960 0600 05F0 
                    2000 4000 2000 402E 
                    0600 3158 2400 0200 
                    2000 4100 FE10 FEE2 
                    0530 FEE4 4800 FE80 
                    A518 FE92 4600 0140 
                    00E0                
(1) 1073/ 60007FE :                     
(1) 1074/ 60007FE :                     ; ----------------------------------------------------------------
(1) 1075/ 60007FE :                     ; MASTER CPU loop
(1) 1076/ 60007FE :                     ;
(1) 1077/ 60007FE :                     ; comm12:
(1) 1078/ 60007FE :                     ; bssscccc iir00lll
(1) 1079/ 60007FE :                     ;
(1) 1080/ 60007FE :                     ; b - Busy bit, this CPU can't be interrupted for CMD requests
(1) 1081/ 60007FE :                     ; r - Clears when frame is ready.
(1) 1082/ 60007FE :                     ; s - Status bits for some of the CMD interrupt tasks
(1) 1083/ 60007FE :                     ; c - Command number for CMD interrupt
(1) 1084/ 60007FE :                     ; i - Screen initialization bit(s)
(1) 1085/ 60007FE :                     ; l - MAIN LOOP command/task, For any mode change fill the
(1) 1086/ 60007FE :                     ;     ii bits: $C0+mode.
(1) 1087/ 60007FE :                     ; ----------------------------------------------------------------
(1) 1088/ 60007FE :                     
(1) 1089/ 60007FE :                     		align 4
(1) 1090/ 6000800 :                     master_loop:
(1) 1092/ 6000800 : D119                		mov	#_sysreg+comm6,r1		; DEBUG counter
(1) 1093/ 6000802 : 6010                		mov.b	@r1,r0
(1) 1094/ 6000804 : 7001                		add	#1,r0
(1) 1095/ 6000806 : 2100                		mov.b	r0,@r1
(1) 1097/ 6000808 :                     
(1) 1098/ 6000808 :                     	; ---------------------------------------
(1) 1099/ 6000808 :                     	; Copy the NEW DREQ data we just
(1) 1100/ 6000808 :                     	; got to the READ buffer
(1) 1101/ 6000808 :                     	; ---------------------------------------
(1) 1102/ 6000808 : D118                		mov	#_vdpreg,r1			; Check if we got late
(1) 1103/ 600080A : 841A                .waitl:		mov.b	@(vdpsts,r1),r0			; on VBlank
(1) 1104/ 600080C : C880                		tst	#VBLK,r0
(1) 1105/ 600080E : 8BFC                		bf	.waitl
(1) 1106/ 6000810 : 4F03                		stc	sr,@-r15
(1) 1107/ 6000812 : E0F0                		mov.b	#$F0,r0				; ** $F0
(1) 1108/ 6000814 : 600C                		extu.b	r0,r0
(1) 1109/ 6000816 : 400E                		ldc	r0,sr
(1) 1110/ 6000818 : D115                		mov	#RAM_Mars_DreqDma,r1		; Copy DREQ data into a safe
(1) 1111/ 600081A : D216                		mov	#RAM_Mars_DreqRead,r2		; location for reading
(1) 1112/ 600081C : 9332                		mov	#sizeof_dreq/4,r3
(1) 1113/ 600081E :                     .copy_safe:
(1) 1114/ 600081E : 6016                		mov	@r1+,r0
(1) 1115/ 6000820 : 2202                		mov	r0,@r2
(1) 1116/ 6000822 : 4310                		dt	r3
(1) 1117/ 6000824 : 8FFB                		bf/s	.copy_safe
(1) 1118/ 6000826 : 7204                		add	#4,r2
(1) 1119/ 6000828 : 4F07                		ldc	@r15+,sr
(1) 1120/ 600082A :                     
(1) 1121/ 600082A :                     	; ---------------------------------------
(1) 1122/ 600082A :                     	; Write palette using DREQ data
(1) 1123/ 600082A :                     	; ---------------------------------------
(1) 1124/ 600082A : D110                		mov	#_vdpreg,r1			; Wait until VBlank
(1) 1125/ 600082C : 841A                .waitv:		mov.b	@(vdpsts,r1),r0
(1) 1126/ 600082E : C880                		tst	#VBLK,r0
(1) 1127/ 6000830 : 89FC                		bt	.waitv
(1) 1128/ 6000832 : C500                 		mov.w	@(marsGbl_XShift,gbr),r0	; Set SHIFT bit first (Xpos & 1)
(1) 1129/ 6000834 : C901                		and	#1,r0
(1) 1130/ 6000836 : 8111                		mov.w	r0,@(shift,r1)
(1) 1131/ 6000838 : D10F                		mov	#RAM_Mars_DreqRead+Dreq_Palette,r1
(1) 1132/ 600083A : D210                		mov	#_palette,r2
(1) 1133/ 600083C : E320                 		mov	#(256/8),r3
(1) 1134/ 600083E :                     .copy_pal:
(1) 1135/ 600083E :                     	rept 4
(1) 1136/ 600083E :                     		mov	@r1+,r0				; Copy colors as LONGs, tested on hardware.
(1) 1137/ 600083E :                     		mov	r0,@r2
(1) 1138/ 600083E :                     		add	#4,r2
(1) 1139/ 600083E :                     	endm
(1) 1136/ 600083E : 6016                		mov	@r1+,r0				; Copy colors as LONGs, tested on hardware.
(1) 1137/ 6000840 : 2202                		mov	r0,@r2
(1) 1138/ 6000842 : 7204                		add	#4,r2
(1) 1136/ 6000844 : 6016                		mov	@r1+,r0				; Copy colors as LONGs, tested on hardware.
(1) 1137/ 6000846 : 2202                		mov	r0,@r2
(1) 1138/ 6000848 : 7204                		add	#4,r2
(1) 1136/ 600084A : 6016                		mov	@r1+,r0				; Copy colors as LONGs, tested on hardware.
(1) 1137/ 600084C : 2202                		mov	r0,@r2
(1) 1138/ 600084E : 7204                		add	#4,r2
(1) 1136/ 6000850 : 6016                		mov	@r1+,r0				; Copy colors as LONGs, tested on hardware.
(1) 1137/ 6000852 : 2202                		mov	r0,@r2
(1) 1138/ 6000854 : 7204                		add	#4,r2
(1) 1140/ 6000856 : 4310                		dt	r3
(1) 1141/ 6000858 : 8BF1                		bf	.copy_pal
(1) 1142/ 600085A :                     .not_ready:
(1) 1143/ 600085A : D109                		mov	#_sysreg+comm12+1,r1		; Clear comm R bit
(1) 1144/ 600085C : 6010                		mov.b	@r1,r0				; this tells to 68k that the frame is ready
(1) 1145/ 600085E : C9DF                		and	#%11011111,r0
(1) 1146/ 6000860 : 2100                		mov.b	r0,@r1
(1) 1147/ 6000862 :                     
(1) 1148/ 6000862 : AFCD                		bra	master_loop
(1) 1149/ 6000864 : 0009                		nop
(1) 1150/ 6000866 :                     		align 4
(1) 1151/ 6000868 : 2000 4026 2000 4100 		ltorg
                    2601 4A00 2601 4FF8 
                    2601 4FF8 2000 4200 
                    2000 402D 017E      
(1) 1152/ 6000886 :                     
(1) 1153/ 6000886 :                     ; ====================================================================
(1) 1154/ 6000886 :                     ; ----------------------------------------------------------------
(1) 1155/ 6000886 :                     ; Slave entry
(1) 1156/ 6000886 :                     ; ----------------------------------------------------------------
(1) 1157/ 6000886 :                     
(1) 1158/ 6000886 :                     		align 4
(1) 1159/ 6000888 :                     SH2_S_Entry:
(1) 1160/ 6000888 : DF25                		mov	#STACK_SLV,r15		; Reset stack
(1) 1161/ 600088A : D026                		mov	#SH2_Slave,r0		; Reset vbr
(1) 1162/ 600088C : 402E                		ldc	r0,vbr
(1) 1163/ 600088E : 9153                		mov.l	#_FRT,r1		; Free-run timer settings
(1) 1164/ 6000890 : E000                		mov	#0,r0			; ** REQUIRED FOR REAL HARDWARE **
(1) 1165/ 6000892 : 8010                		mov.b	r0,@(0,r1)
(1) 1166/ 6000894 : E0E2                		mov.b	#$E2,r0
(1) 1167/ 6000896 : 8017                		mov.b	r0,@(7,r1)
(1) 1168/ 6000898 : E000                		mov	#0,r0
(1) 1169/ 600089A : 8014                		mov.b	r0,@(4,r1)
(1) 1170/ 600089C : E001                		mov	#1,r0
(1) 1171/ 600089E : 8015                		mov.b	r0,@(5,r1)
(1) 1172/ 60008A0 : E000                		mov	#0,r0
(1) 1173/ 60008A2 : 8016                		mov.b	r0,@(6,r1)
(1) 1174/ 60008A4 : E001                		mov	#1,r0
(1) 1175/ 60008A6 : 8011                		mov.b	r0,@(1,r1)
(1) 1176/ 60008A8 : E000                		mov	#0,r0
(1) 1177/ 60008AA : 8013                		mov.b	r0,@(3,r1)
(1) 1178/ 60008AC : 8012                		mov.b	r0,@(2,r1)
(1) 1179/ 60008AE : E0F2                		mov.b	#$F2,r0			; <-- PWM interrupt needs this
(1) 1180/ 60008B0 : 8017                		mov.b	r0,@(7,r1)
(1) 1181/ 60008B2 : E000                		mov	#0,r0
(1) 1182/ 60008B4 : 8014                		mov.b	r0,@(4,r1)
(1) 1183/ 60008B6 : E001                		mov	#1,r0
(1) 1184/ 60008B8 : 8015                		mov.b	r0,@(5,r1)
(1) 1185/ 60008BA : E0E2                		mov.b	#$E2,r0
(1) 1186/ 60008BC : 8017                		mov.b	r0,@(7,r1)		; <-- ***
(1) 1187/ 60008BE :                     	; Extra interrupt settings
(1) 1188/ 60008BE : 903C                		mov.w   #$FEE2,r0		; Extra interrupt priority levels ($FFFFFEE2)
(1) 1189/ 60008C0 : 913C                		mov     #(3<<4)|(5<<8),r1	; (DMA_LVL<<8)|(WDG_LVL<<4) Current: WDG 3 DMA 5
(1) 1190/ 60008C2 : 2011                		mov.w   r1,@r0
(1) 1191/ 60008C4 : 903B                		mov.w   #$FEE4,r0		; Vector jump number for Watchdog ($FFFFFEE4)
(1) 1192/ 60008C6 : 913B                		mov     #($120/4)<<8,r1		; (vbr+POINTER)<<8
(1) 1193/ 60008C8 : 2011                		mov.w   r1,@r0
(1) 1194/ 60008CA : E0A8                		mov.b	#$A8,r0			; Vector jump number for DMACHANNEL1 ($FFFFFFA8)
(1) 1195/ 60008CC : E149                		mov     #($124/4),r1		; (vbr+POINTER)
(1) 1196/ 60008CE : 2012                		mov	r1,@r0
(1) 1197/ 60008D0 : D015                		mov	#RAM_Mars_Global,r0	; Reset gbr
(1) 1198/ 60008D2 : 401E                		ldc	r0,gbr
(1) 1199/ 60008D4 : BEFA                		bsr	MarsSound_Init		; Init sound
(1) 1200/ 60008D6 : 0009                		nop
(1) 1201/ 60008D8 :                     
(1) 1202/ 60008D8 :                     ; ====================================================================
(1) 1203/ 60008D8 :                     ; ----------------------------------------------------------------
(1) 1204/ 60008D8 :                     ; Slave main code
(1) 1205/ 60008D8 :                     ; ----------------------------------------------------------------
(1) 1206/ 60008D8 :                     
(1) 1207/ 60008D8 :                     SH2_S_HotStart:
(1) 1208/ 60008D8 : 9133                		mov.w	#$FE80,r1
(1) 1209/ 60008DA : 9033                		mov.w	#$A518,r0		; Disable Watchdog
(1) 1210/ 60008DC : 2101                		mov.w	r0,@r1
(1) 1211/ 60008DE : 9132                		mov.w	#_CCR&$FFFF,r1		; Reset CACHE
(1) 1212/ 60008E0 : E010                		mov	#$10,r0
(1) 1213/ 60008E2 : 2100                		mov.b	r0,@r1
(1) 1214/ 60008E4 : 0009                		nop
(1) 1215/ 60008E6 : 0009                		nop
(1) 1216/ 60008E8 : 0009                		nop
(1) 1217/ 60008EA : 0009                		nop
(1) 1218/ 60008EC : 0009                		nop
(1) 1219/ 60008EE : 0009                		nop
(1) 1220/ 60008F0 : 0009                		nop
(1) 1221/ 60008F2 : E009                		mov	#9,r0
(1) 1222/ 60008F4 : 2100                		mov.b	r0,@r1
(1) 1223/ 60008F6 :                     ; 		mov	#CACHE_SLAVE,r1
(1) 1224/ 60008F6 :                     ; 		mov	#(CACHE_SLAVE_E-CACHE_SLAVE)/4,r2
(1) 1225/ 60008F6 :                     ; 		mov	#Mars_LoadCacheRam,r0
(1) 1226/ 60008F6 :                     ; 		jsr	@r0
(1) 1227/ 60008F6 :                     ; 		nop
(1) 1228/ 60008F6 : D10D                		mov	#_sysreg,r1
(1) 1229/ 60008F8 : 200A                    		xor	r0,r0
(1) 1230/ 60008FA : 811A                		mov.w	r0,@(vresintclr,r1)
(1) 1231/ 60008FC : 811B                		mov.w	r0,@(vintclr,r1)
(1) 1232/ 60008FE : 811C                		mov.w	r0,@(hintclr,r1)
(1) 1233/ 6000900 : 811D                		mov.w	r0,@(cmdintclr,r1)
(1) 1234/ 6000902 : 811E                		mov.w	r0,@(pwmintclr,r1)
(1) 1235/ 6000904 : 6011                		mov.w	@r1,r0
(1) 1236/ 6000906 : CB03                		or	#CMDIRQ_ON|PWMIRQ_ON,r0
(1) 1237/ 6000908 :                     ; 		or	#CMDIRQ_ON,r0
(1) 1238/ 6000908 : 2101                		mov.w	r0,@r1
(1) 1239/ 600090A : D109                		mov	#_sysreg+comm12,r1
(1) 1240/ 600090C : 6011                .wait_mst:	mov.w	@r1,r0
(1) 1241/ 600090E : 2008                		tst	r0,r0
(1) 1242/ 6000910 : 8BFC                		bf	.wait_mst
(1) 1243/ 6000912 :                     
(1) 1244/ 6000912 :                     ; 	; ****
(1) 1245/ 6000912 : BEE9                		bsr	MarsSound_FirstFill
(1) 1246/ 6000914 : 0009                		nop
(1) 1247/ 6000916 :                     ; 	; ****
(1) 1248/ 6000916 :                     
(1) 1249/ 6000916 : E020                		mov.b	#$20,r0				; Interrupts ON
(1) 1250/ 6000918 : 400E                		ldc	r0,sr
(1) 1251/ 600091A : D006                		mov	#slave_loop,r0
(1) 1252/ 600091C : 402B                		jmp	@r0
(1) 1253/ 600091E : 0009                		nop
(1) 1254/ 6000920 :                     		align 4
(1) 1255/ 6000920 : 0603 F000 0600 0128 		ltorg
                    0601 4960 2000 4000 
                    2000 402C 0600 0948 
                    FE10 FEE2 0530 FEE4 
                    4800 FE80 A518 FE92 
(1) 1256/ 6000948 :                     
(1) 1257/ 6000948 :                     ; ----------------------------------------------------------------
(1) 1258/ 6000948 :                     ; SLAVE CPU loop
(1) 1259/ 6000948 :                     ;
(1) 1260/ 6000948 :                     ; comm14:
(1) 1261/ 6000948 :                     ; bssscccc llllllll
(1) 1262/ 6000948 :                     ;
(1) 1263/ 6000948 :                     ; b - busy bit on the CMD interrupt
(1) 1264/ 6000948 :                     ;     (so 68k knows that the interrupt is active)
(1) 1265/ 6000948 :                     ; s - status bits for some CMD interrupt tasks
(1) 1266/ 6000948 :                     ; c - command number for CMD interrupt
(1) 1267/ 6000948 :                     ; l - MAIN LOOP command/task, clears on endstruct
(1) 1268/ 6000948 :                     ; ----------------------------------------------------------------
(1) 1269/ 6000948 :                     
(1) 1270/ 6000948 :                     		align 4
(1) 1271/ 6000948 :                     slave_loop:
(1) 1272/ 6000948 : D102                		mov	#_sysreg+comm7,r1
(1) 1273/ 600094A : 6010                		mov.b	@r1,r0
(1) 1274/ 600094C : 7001                		add	#1,r0
(1) 1275/ 600094E : 2100                		mov.b	r0,@r1
(1) 1276/ 6000950 : AFFA                		bra	slave_loop
(1) 1277/ 6000952 : 0009                		nop
(1) 1278/ 6000954 :                     		align 4
(1) 1279/ 6000954 : 2000 4027           		ltorg
(1) 1280/ 6000958 :                     
(1) 1281/ 6000958 :                     ; ------------------------------------------------
(1) 1282/ 6000958 :                     ; Includes
(1) 1283/ 6000958 :                     ; ------------------------------------------------
(1) 1284/ 6000958 :                     
(1) 1285/ 6000958 :                     ; 		include "system/mars/cache/cache_m_2D.asm"
(1) 1286/ 6000958 :                     ; 		include "system/mars/cache/cache_m_3D.asm"
(1) 1287/ 6000958 :                     ; 		include "system/mars/cache/cache_slv.asm"
(1) 1288/ 6000958 :                     
(1) 1289/ 6000958 :                     ; ====================================================================
(1) 1290/ 6000958 :                     ; ----------------------------------------------------------------
(1) 1291/ 6000958 :                     ; Data
(1) 1292/ 6000958 :                     ; ----------------------------------------------------------------
(1) 1293/ 6000958 :                     
(1) 1294/ 6000958 :                     		align 4
(1) 1295/ 6000958 :                     sin_table	binclude "system/mars/data/sinedata.bin"
(1) 1296/ 6003158 :                     ; m_ascii	binclude "system/mars/data/m_ascii.bin"
(1) 1297/ 6003158 :                     		align 4
(1) 1298/ 6003158 :                     		include "game/data/mars_sdram.asm"
(2)    1/ 6003158 :                     ; ====================================================================
(2)    2/ 6003158 :                     ; ----------------------------------------------------------------
(2)    3/ 6003158 :                     ; SH2 SDRAM data
(2)    4/ 6003158 :                     ; 
(2)    5/ 6003158 :                     ; This data is stored on SDRAM, always available to use on the 32X
(2)    6/ 6003158 :                     ; side and can be rewritible, but it is smaller than ROM
(2)    7/ 6003158 :                     ;
(2)    8/ 6003158 :                     ; PWM samples can be used here but those take a lot of space...
(2)    9/ 6003158 :                     ; use ROM (mars_rom.asm) instead, those are RV-protected on SH2
(2)   10/ 6003158 :                     ; ----------------------------------------------------------------
(2)   11/ 6003158 :                     
(2)   12/ 6003158 :                     		align 4
(2)   13/ 6003158 :                     ArtMars_TEST:
(2)   14/ 6003158 :                     		binclude "game/data/TESTS/test_art.bin"
(2)   15/ 6014958 :                     		align 2
(2)   16/ 6014958 :                     
(1) 1299/ 6014958 :                     
(1) 1300/ 6014958 :                     ; ====================================================================
(1) 1301/ 6014958 :                     ; ----------------------------------------------------------------
(1) 1302/ 6014958 :                     ; GLOBAL GBR Variables
(1) 1303/ 6014958 :                     ;
(1) 1304/ 6014958 :                     ; Watch out for the Read/Write conflicts.
(1) 1305/ 6014958 :                     ; ----------------------------------------------------------------
(1) 1306/ 6014958 :                     
(1) 1307/ 6014958 :                     			align $10
(1) 1308/ 6014960 :                     RAM_Mars_Global		ds.l sizeof_MarsGbl	; gbr values go here
(1) 1309/ 6014970 :                     
(1) 1310/ 6014970 :                     ; ====================================================================
(1) 1311/ 6014970 :                     ; ----------------------------------------------------------------
(1) 1312/ 6014970 :                     ; MARS SH2 RAM
(1) 1313/ 6014970 :                     ; ----------------------------------------------------------------
(1) 1314/ 6014970 :                     
(1) 1315/ 6014970 :                     			align $100
(1) 1316/ 6014A00 :                     SH2_RAM:
(1) 1317/ 6014A00 : (MACRO)             			struct SH2_RAM|TH	; CACHE-THRU
(1) 1317/ 6014A00 : =$6014A00           GLBL_LASTPC     set *
(1) 1317/   32A00 :                                     dephase
(1) 1317/   32A00 : =$32A00             GLBL_LASTORG    set *
(1) 1317/26014A00 :                                     phase SH2_RAM|TH
(1) 1318/26014A00 :                     RAM_Mars_DreqDma	ds.b sizeof_dreq	; DREQ data from Genesis ***DO NOT READ FROM HERE***
(1) 1319/26014FF8 :                     RAM_Mars_DreqRead	ds.b sizeof_dreq	; Copy of DREQ for reading.
(1) 1320/260155F0 :                     RAM_Mars_GemaWave_0	ds.b $1000
(1) 1321/260165F0 :                     RAM_Mars_GemaWave_1	ds.b $1000
(1) 1322/260175F0 : (MACRO)             			endstruct
(1) 1322/26014A00 :                                     !org GLBL_LASTORG
(1) 1322/ 6014A00 :                                     phase GLBL_LASTPC
(1) 1323/ 6014A00 :                     
(1) 1324/ 6014A00 :                     ; ; ====================================================================
(1) 1325/ 6014A00 :                     ; ; ----------------------------------------------------------------
(1) 1326/ 6014A00 :                     ; ; MARS Video RAM
(1) 1327/ 6014A00 :                     ; ;
(1) 1328/ 6014A00 :                     ; ; RAM_Mars_ScrnBuff is recycled for all pseudo-screen modes
(1) 1329/ 6014A00 :                     ; ; ----------------------------------------------------------------
(1) 1330/ 6014A00 :                     ;
(1) 1331/ 6014A00 :                     ; 			struct MarsRam_Video
(1) 1332/ 6014A00 :                     ; RAM_Mars_ScrnBuff	ds.b MAX_SCRNBUFF		; Single buffer for all screen modes
(1) 1333/ 6014A00 :                     ; sizeof_marsvid		ds.l 0
(1) 1334/ 6014A00 :                     ; 			endstruct
(1) 1335/ 6014A00 :                     ;
(1) 1336/ 6014A00 :                     ; ; --------------------------------------------------------
(1) 1337/ 6014A00 :                     ; ; per-screen RAM
(1) 1338/ 6014A00 :                     ; 			struct RAM_Mars_ScrnBuff
(1) 1339/ 6014A00 :                     ; Cach_DrawTimers		ds.l 4				; Screen draw-request timers, write $02 to these
(1) 1340/ 6014A00 :                     ; RAM_Mars_ScrlBuff	ds.b sizeof_mscrl*2		; Scrolling buffers
(1) 1341/ 6014A00 :                     ; RAM_Mars_ScrlData	ds.b ((320+16)*(224+16))+320	; Entire pixeldata for one scroll: (w*h)+320
(1) 1342/ 6014A00 :                     ; end_scrn02		ds.l 0
(1) 1343/ 6014A00 :                     ; 			endstruct
(1) 1344/ 6014A00 :                     ; 			struct RAM_Mars_ScrnBuff
(1) 1345/ 6014A00 :                     ; RAM_Mars_SVdpDrwList	ds.b sizeof_plypz*MAX_SVDP_PZ	; Sprites / Polygon pieces
(1) 1346/ 6014A00 :                     ; RAM_Mars_SVdpDrwList_e	ds.l 0				; (END point label)
(1) 1347/ 6014A00 :                     ; RAM_Mars_Polygons_0	ds.b sizeof_polygn*MAX_FACES	; Read/Write polygon data
(1) 1348/ 6014A00 :                     ; RAM_Mars_Polygons_1	ds.b sizeof_polygn*MAX_FACES
(1) 1349/ 6014A00 :                     ; RAM_Mars_PlgnList_0	ds.l MAX_FACES*2		; Polygon order list: Zpos, pointer
(1) 1350/ 6014A00 :                     ; RAM_Mars_PlgnList_1	ds.l MAX_FACES*2
(1) 1351/ 6014A00 :                     ; RAM_Mars_PlgnNum_0	ds.l 1				; Number of polygons to process
(1) 1352/ 6014A00 :                     ; RAM_Mars_PlgnNum_1	ds.l 1
(1) 1353/ 6014A00 :                     ; RAM_Mars_Objects	ds.b sizeof_mdlobj*MAX_MODELS	; Slave's Objects
(1) 1354/ 6014A00 :                     ; RAM_Mars_ObjCamera	ds.b sizeof_camera		; Slave's Camera
(1) 1355/ 6014A00 :                     ; sizeof_scrn04		ds.l 0
(1) 1356/ 6014A00 :                     ; 			endstruct
(1) 1357/ 6014A00 :                     ; 	if MOMPASS=6
(1) 1358/ 6014A00 :                     ; 	if end_scrn02-RAM_Mars_ScrnBuff > MAX_SCRNBUFF
(1) 1359/ 6014A00 :                     ; 		error "RAN OUT OF RAM FOR 2D STUFF (\{(end_scrn02-RAM_Mars_ScrnBuff)} of \{(MAX_SCRNBUFF)})"
(1) 1360/ 6014A00 :                     ; 	elseif sizeof_scrn04-RAM_Mars_ScrnBuff > MAX_SCRNBUFF
(1) 1361/ 6014A00 :                     ; 		error "RAN OUT OF RAM FOR 3D STUFF (\{(sizeof_scrn04-RAM_Mars_ScrnBuff)} of \{(MAX_SCRNBUFF)})"
(1) 1362/ 6014A00 :                     ; 	endif
(1) 1363/ 6014A00 :                     ; 	endif
(1) 1364/ 6014A00 :                     
(1) 1365/ 6014A00 :                     ; ====================================================================
(1) 1366/ 6014A00 :                     ; ----------------------------------------------------------------
(1) 1367/ 6014A00 :                     ; MARS Sound RAM
(1) 1368/ 6014A00 :                     ; ----------------------------------------------------------------
(1) 1369/ 6014A00 :                     
(1) 1370/ 6014A00 :                     ; 			struct MarsRam_Sound
(1) 1371/ 6014A00 :                     ; MarsSnd_PwmCache	ds.b $80*MAX_PWMCHNL
(1) 1372/ 6014A00 :                     ; sizeof_marssnd		ds.l 0
(1) 1373/ 6014A00 :                     ; 			endstruct
(1) 1374/ 6014A00 :                     
(1) 1375/ 6014A00 :                     ; ====================================================================
(1) 1376/ 6014A00 :                     ; ----------------------------------------------------------------
(1) 1377/ 6014A00 :                     ; MARS System RAM
(1) 1378/ 6014A00 :                     ; ----------------------------------------------------------------
(1) 1379/ 6014A00 :                     
(1) 1380/ 6014A00 :                     ; 			struct MarsRam_System
(1) 1381/ 6014A00 :                     ; RAM_Mars_DreqDma	ds.b sizeof_dreq	; DREQ data from Genesis ***DO NOT READ FROM HERE***
(1) 1382/ 6014A00 :                     ; RAM_Mars_DreqRead	ds.b sizeof_dreq	; Copy of DREQ for reading.
(1) 1383/ 6014A00 :                     
(1) 1384/ 6014A00 :                     ; sizeof_marssys		ds.l 0
(1) 1385/ 6014A00 :                     ; 			endstruct
(1) 1386/ 6014A00 :                     
(1) 1387/ 6014A00 :                     ; ====================================================================
(1) 1388/ 6014A00 :                     
(1) 1389/ 6014A00 :                     
(1) 1390/ 6014A00 :                     
     283/ 6014A00 :                     		cpu 68000
     284/ 6014A00 :                     		padding off
     285/   32A00 :                     		dephase
     286/   32A00 :                     		align $800
     287/   33000 :                     CD32_End:
     288/   33000 :                     		align 4
     289/   33000 :                     
     291/   33000 :                     
     292/   33000 :                     ; ====================================================================
     293/   33000 :                     ; --------------------------------------------------------
     294/   33000 :                     ; Genesis and Sega 32X ROM section
     295/   33000 :                     ;
     296/   33000 :                     ; 32X: $880000+ area
     297/   33000 :                     ; --------------------------------------------------------
     298/   33000 :                     
     425/   33000 :                     
     426/   33000 :                     
     427/   33000 :                     ; ====================================================================
     428/   33000 :                     ; ---------------------------------------------
     429/   33000 :                     ; End
     430/   33000 :                     ; ---------------------------------------------
     431/   33000 :                     
     432/   33000 :                     ROM_END:
     433/   33000 :                     		align $8000
     434/   38000 :                     
 AS V1.42 Beta [Bld 118] - source file main.asm - page 2 - 7/19/2023 0:10:13


  symbol table (* = unused):
  ------------------------

 ADAPTER :                        0 - | *ADEN :                           2 - |
 ALV :                           24 - |
*ARCHITECTURE :                                        x86_64-unknown-linux - |
 ARTMARS_TEST :             6003158 C |  ASCII_FONT :                203800 C |
 ASCII_FONT_E :              204800 C |  ASCII_PAL :       FFFFFFFFFFFF0266 C |
*ASCII_PAL_E :     FFFFFFFFFFFF0286 C |  ATK :                            8 - |
*AT_D :                           2 - | *AT_L :                           1 - |
*AT_R :                           0 - | *AT_U :                           3 - |
*BIGENDIAN :                      0 - |  BITBGON :                        7 - |
*BITCLICKL :                      1 - | *BITCLICKM :                      2 - |
*BITCLICKR :                      0 - | *BITCLICKS :                      3 - |
 BITDISPENBL :                    6 - |  BITDMA :                         1 - |
 BITDMAENBL :                     4 - |  BITDRWD :                        2 - |
 BITDRWL :                        1 - |  BITDRWR :                        0 - |
 BITDRWU :                        3 - | *BITFIFOE :                       9 - |
*BITFIFOF :                       8 - | *BITHBLK :                        2 - |
*BITHINTENBL :                    4 - | *BITHVSTOP :                      1 - |
*BITJOYA :                        6 - | *BITJOYB :                        4 - |
*BITJOYC :                        5 - | *BITJOYDOWN :                     1 - |
*BITJOYLEFT :                     2 - | *BITJOYMODE :                     B - |
*BITJOYRIGHT :                    3 - | *BITJOYSTART :                    7 - |
*BITJOYUP :                       0 - | *BITJOYX :                        A - |
*BITJOYY :                        9 - | *BITJOYZ :                        8 - |
 BITMAPMD :                       1 - |  BITMARSBG :                      6 - |
 BITOBJ_AIR :                     0 - |  BITOBJ_FLIPH :                   0 - |
 BITOBJ_FLIPV :                   1 - |  BITOBJ_MARS :                    7 - |
*BITODD :                         4 - | *BITPAL :                         0 - |
*BITSPRCOL :                      5 - | *BITSPROVR :                      6 - |
*BITV30 :                         3 - |  BITVBLK :                        3 - |
*BITVINT :                        7 - | *BITVINTENBL :                    5 - |
 BITWRAMMODE :                    2 - | *BRANCHEXT :                      0 - |
*BRMDEL :                         5 - | *BRMDIR :                         7 - |
*BRMFORMAT :                      6 - | *BRMINIT :                        0 - |
*BRMREAD :                        3 - | *BRMSERCH :                       2 - |
*BRMSTAT :                        1 - | *BRMVERIFY :                      8 - |
*BRMWRITE :                       4 - | *CAM_X_POS :                      0 C |
*CAM_X_ROT :                      C C | *CAM_Y_POS :                      4 C |
*CAM_Y_ROT :                     10 C | *CAM_Z_POS :                      8 C |
*CAM_Z_ROT :                     14 C | *CART :                           1 - |
*CASESENSITIVE :                  0 - | *CBTCHKDISC :                     4 - |
*CBTCHKSTAT :                     5 - | *CBTINIT :                        0 - |
*CBTINT :                         1 - | *CBTIPDISC :                      6 - |
*CBTIPSTAT :                      7 - | *CBTOPENDISC :                    2 - |
*CBTOPENSTAT :                    3 - | *CBTSPDISC :                      8 - |
*CBTSPSTAT :                      9 - |  CD32_END :                   33000 C |
 CD32_START :                 1E000 C | *CDBCHK :                        80 - |
*CDBPAUSE :                      84 - | *CDBSTAT :                       81 - |
*CDBTOCREAD :                    83 - | *CDBTOCWRITE :                   82 - |
 CDCACK :                        8D - |  CDCREAD :                       8B - |
*CDCSETMODE :                    96 - | *CDCSTART :                      87 - |
*CDCSTARTP :                     88 - |  CDCSTAT :                       8A - |
 CDCSTOP :                       89 - |  CDCTRN :                        8C - |
 CHIP_ENV :                     F49 C |  CHIP_ENV.ATKEND :              FCC C |
*CHIP_ENV.ATKZERO :             FCF C |  CHIP_ENV.CHK2 :                FD5 C |
 CHIP_ENV.CHK4 :               100A C |  CHIP_ENV.CKOF :                F6D C |
 CHIP_ENV.CKON :                F80 C | *CHIP_ENV.DECTMR :              FD9 C |
 CHIP_ENV.DKADD :               FF3 C |  CHIP_ENV.DKSAV :               FFB C |
 CHIP_ENV.DKYEND :             1000 C |  CHIP_ENV.DO_NFREQ :           105F C |
 CHIP_ENV.ENVPROC :             F9E C |  CHIP_ENV.KILLENV :            1020 C |
*CHIP_ENV.NBLOCK :              F9E C |  CHIP_ENV.NORMAL :             105A C |
 CHIP_ENV.NOUPD :              10A0 C |  CHIP_ENV.NSKIP :               F95 C |
 CHIP_ENV.SILNC_3 :            1056 C |  CHIP_ENV.VEDLP :              1028 C |
 CHIP_ENV.VLMUCH :             108C C |  CHIP_ENV.VLOOP :               F55 C |
 CHIP_ENV.VONLY :              1082 C |  CHNL_CHIP :                      1 - |
 CHNL_EFFARG :                    6 - |  CHNL_EFFID :                     5 - |
 CHNL_FLAGS :                     0 - |  CHNL_INS :                       3 - |
 CHNL_NOTE :                      2 - |  CHNL_TYPE :                      7 - |
 CHNL_VOL :                       4 - | *CLICKL :                         2 - |
*CLICKM :                         4 - | *CLICKR :                         1 - |
*CLICKS :                         8 - |  CMDINTCLR :                     1A - |
 CMDIRQ_ON :                      2 - |  COM :                            0 - |
 COMM0 :                         20 - | *COMM1 :                         21 - |
 COMM10 :                        2A - | *COMM11 :                        2B - |
 COMM12 :                        2C - | *COMM13 :                        2D - |
 COMM14 :                        2E - | *COMM15 :                        2F - |
 COMM2 :                         22 - | *COMM3 :                         23 - |
 COMM4 :                         24 - | *COMM5 :                         25 - |
 COMM6 :                         26 - |  COMM7 :                         27 - |
 COMM8 :                         28 - | *COMM9 :                         29 - |
 COMMZFIFO :                     40 C |  COMMZREAD :                   171C C |
 COMMZROMBLK :                   81 C |  COMMZWRITE :                    80 C |
*CONSTPI :        3.141592653589793 - | *CONTROLLER_1 :    FFFFFFFFFFFFA000 - |
*CONTROLLER_2 :    FFFFFFFFFFFFA010 - | *COPYRIGHTDATA :               1A4C C |
*CS0 :                            0 - | *CS1 :                      2000000 - |
 CS2 :                      4000000 - |  CS3 :                      6000000 - |
*CTRL :                           F - |  CURRTICKBITS :                  2E C |
 CYCLE :                         32 - |  DAC_FILL :                      20 C |
 DAC_FIRSTFILL :               1129 C |  DAC_ME :                         8 C |
 DAC_OFF :                     10E0 C |  DAC_ON :                      10CB C |
 DAC_PLAY :                    10F5 C |  DAC_REFILL :                  1129 C |
 DAC_REFILL.DACFILL_END :      11E8 C |  DAC_REFILL.DACFILL_LOOP :     11A1 C |
 DAC_REFILL.DACFILL_RET :      11EB C |  DAC_REFILL.DAC_OVER :         1177 C |
*DATE :                   7/19/2023 - |  DDACCNTR :                      33 C |
 DDACFIFOMID :                   2F C |  DDACPNTR :                      30 C |
*DISPENBL :                      40 - |  DKY :                            C - |
*DMAENBL :                       10 - | *DOTTEDSTRUCTS :                  0 - |
 DREQCTL :                        6 - | *DREQDEST :                       C - |
 DREQFIFO :                      12 - |  DREQLEN :                       10 - |
*DREQSOURCE :                     8 - |  DREQ_BGEXBUFF :                200 C |
*DREQ_OBJCAM :                  280 C |  DREQ_OBJECTS :                 298 C |
 DREQ_PALETTE :                   0 C |  DREQ_SUPERSPR :                418 C |
*DRVINIT :                       10 - | *DRVOPEN :                        A - |
 DRV_LOOP :                      87 C |  DRV_LOOP.CMND_0 :              12F C |
 DRV_LOOP.CMND_1 :              132 C |  DRV_LOOP.CMND_2 :              14F C |
 DRV_LOOP.CMND_8 :              16C C |  DRV_LOOP.CMND_C :              18E C |
 DRV_LOOP.FOUND :               1CC C |  DRV_LOOP.GETCBYTEL :            F2 C |
 DRV_LOOP.GRAB_ARG :             F0 C |  DRV_LOOP.LIST :                10F C |
 DRV_LOOP.NEITHER :              C7 C |  DRV_LOOP.NEXT :                1A6 C |
 DRV_LOOP.NEXT_CMD :             CD C |  DRV_LOOP.NEXT_SALL :           170 C |
 DRV_LOOP.NOBEATS :              AE C |  DRV_LOOP.NOTICKS :              A1 C |
 DRV_LOOP.NOT_FND :             1C7 C |  DRV_LOOP.NOT_ON :              186 C |
 DRV_LOOP.SRCH_FRID :           19F C |  DTBL_FROMMUL :                 6E7 C |
 DTBL_FROMMUL.CHNL_ULNK :       DB7 C |  DTBL_FROMMUL.CHNL_ULNKCUT :    DC6 C |
 DTBL_FROMMUL.CHNL_ULNKOFF :    DB5 C |  DTBL_FROMMUL.DAC_CUT :         945 C |
 DTBL_FROMMUL.DAC_INS :         BC9 C |  DTBL_FROMMUL.DAC_OFF :         94B C |
 DTBL_FROMMUL.DAC_PITCH :       94E C |  DTBL_FROMMUL.D_CONT :          AB2 C |
 DTBL_FROMMUL.EFFC :            A1F C |  DTBL_FROMMUL.EFFC_D :          A3A C |
 DTBL_FROMMUL.EFFC_E :          A7D C |  DTBL_FROMMUL.EFFC_F :          A92 C |
 DTBL_FROMMUL.EFFC_X :          AB3 C |  DTBL_FROMMUL.FINE_DOWN :       A55 C |
 DTBL_FROMMUL.FINE_UP :         A69 C |  DTBL_FROMMUL.FMSPC_SET :       884 C |
 DTBL_FROMMUL.FM_CINDX :        D79 C |  DTBL_FROMMUL.FM_CUT :          915 C |
 DTBL_FROMMUL.FM_HASVOL :       C6D C |  DTBL_FROMMUL.FM_INS :          B48 C |
 DTBL_FROMMUL.FM_KEYOFF :       CD1 C |  DTBL_FROMMUL.FM_OFF :          90F C |
 DTBL_FROMMUL.FM_PANLIST :      ADC C |  DTBL_FROMMUL.FM_SETFREQ :      CF0 C |
 DTBL_FROMMUL.FM_SETRLIST :     BB9 C |  DTBL_FROMMUL.FM_TLOFF :        CD9 C |
 DTBL_FROMMUL.FM_WRTALPAN :     D81 C |  DTBL_FROMMUL.FM_WRTLVOL :      D07 C |
 DTBL_FROMMUL.FND_OCT :         CBE C |  DTBL_FROMMUL.FROM_PSGN :       7C9 C |
 DTBL_FROMMUL.GET_OCT :         CAE C |  DTBL_FROMMUL.INST :            AED C |
*DTBL_FROMMUL.INVL_INS :        B0B C |  DTBL_FROMMUL.KYCUT_PSG :       81B C |
 DTBL_FROMMUL.KYCUT_PSGN :      816 C |  DTBL_FROMMUL.KYOFF_PSG :       80B C |
 DTBL_FROMMUL.KYOFF_PSGN :      806 C |  DTBL_FROMMUL.LINKED :          744 C |
 DTBL_FROMMUL.MK_DAC :          91E C |  DTBL_FROMMUL.MK_FM :           826 C |
 DTBL_FROMMUL.MK_FMSPC :        898 C |  DTBL_FROMMUL.MK_LIST :         782 C |
 DTBL_FROMMUL.MK_PSG :          7B0 C |  DTBL_FROMMUL.MK_PSGN :         792 C |
 DTBL_FROMMUL.MK_PWM :          974 C |  DTBL_FROMMUL.NEW_ROMDAT :      B7C C |
 DTBL_FROMMUL.NOFM_NOTE :       85B C |  DTBL_FROMMUL.NORM_DOWN :       A53 C |
 DTBL_FROMMUL.NORM_UP :         A6B C |  DTBL_FROMMUL.NOTE :            C63 C |
 DTBL_FROMMUL.NOT_DAC :         858 C |  DTBL_FROMMUL.NOT_DSPC :        84F C |
 DTBL_FROMMUL.NO_LFO :          DB4 C |  DTBL_FROMMUL.N_FM :            CA4 C |
 DTBL_FROMMUL.N_INDX :          C90 C |  DTBL_FROMMUL.N_PSGN :          C9F C |
 DTBL_FROMMUL.N_STFREQ :        C91 C |  DTBL_FROMMUL.PN_INS :          B0C C |
 DTBL_FROMMUL.PSG_KEYON :       7F0 C |  DTBL_FROMMUL.PS_INS :          B12 C |
 DTBL_FROMMUL.PWM_CUT :         A10 C |  DTBL_FROMMUL.PWM_INS :         C20 C |
 DTBL_FROMMUL.PWM_OFF :         A01 C |  DTBL_FROMMUL.PWV_MUCH :        9FD C |
 DTBL_FROMMUL.PW_EFFC :         99E C |  DTBL_FROMMUL.PW_NOTE :         9A5 C |
 DTBL_FROMMUL.PW_SEND :         9AA C |  DTBL_FROMMUL.PW_SETUP :        9CE C |
 DTBL_FROMMUL.RCYL_COM :        738 C |  DTBL_FROMMUL.RES_PAN :         AD2 C |
 DTBL_FROMMUL.SAME_PATCH :      BB4 C |  DTBL_FROMMUL.SAVE_ARG :        AA7 C |
 DTBL_FROMMUL.SILN_DAC :        725 C |  DTBL_FROMMUL.SILN_FM :         728 C |
 DTBL_FROMMUL.SILN_PSG :        71E C |  DTBL_FROMMUL.SILN_PSG_N :      71A C |
 DTBL_FROMMUL.SILN_PWM :        72E C |  DTBL_FROMMUL.TL_DOWN :         CE3 C |
 DTBL_FROMMUL.VMUCH :           7FC C |  DTBL_FROMMUL.VOLU :            AE4 C |
 DTBL_FROMMUL.VOL_DVLD :        A79 C |  DTBL_FROMMUL.WRITE_TL :        D6C C |
 DTBL_MULTI :                   6D0 C |  DTBL_SINGL :                   6E6 C |
 DTH :                           20 - |  DTL :                           1C - |
 DWAVEBUFF :                   1D00 C | *ENV :                            1 - |
*EXTR_3 :                         A C | *EXTR_4 :                         C C |
*EXTR_5 :                         E C |  EX_COMM :                      DD9 C |
*FALSE :                          0 - |  FBVRAM_BLANK :               1F800 - |
*FBVRAM_PATCH :               1D000 - | *FDH :                            7 - |
*FDL :                            5 - | *FDRCHG :                        86 - |
*FDRSET :                        85 - | *FEN :                            2 - |
*FILLDATA :                       8 - | *FILLLENGTH :                     4 - |
*FILLSTART :                      6 - |  FLG :                           28 - |
 FM :                            80 - |  FMCACH_1 :                    1553 C |
 FMCACH_2 :                    157B C |  FMCACH_3 :                    15A3 C |
 FMCACH_4 :                    15CB C |  FMCACH_5 :                    15F3 C |
 FMCACH_6 :                    161B C |  FMCACH_LIST :                 13E9 C |
 FMFREQ_LIST :                 11EF C |  FMSPECIAL :                   1707 C |
 FM_AUTOREG :                  10AC C |  FM_SEND_1 :                   10B5 C |
 FM_SEND_2 :                   10C0 C |  FNAME_MARS :                  605E C |
 FRAMECLEAR :                  1AE8 C |  FRAMECLEAR.FEN0 :             1B12 C |
 FRAMECLEAR.FILL0 :            1B08 C |  FRAMECLEAR.FM1 :              1AF2 C |
 FRAMECTL :                       B - | *FS :                             1 - |
*FULLPMMU :                       1 - |  GEMADMAPAUSE :    FFFFFFFFFFFF00FA C |
 GEMADMAPAUSEROM : FFFFFFFFFFFF013C C |  GEMADMARESUME :   FFFFFFFFFFFF0122 C |
 GEMADMARESUMEROM :                                        FFFFFFFFFFFF015E C |
*GEMAPLAYFROMBLK : FFFFFFFFFFFF01A6 C | *GEMAPLAYTRACK :   FFFFFFFFFFFF018A C |
*GEMASETBEATS :    FFFFFFFFFFFF01E8 C |  GEMASTOPALL :     FFFFFFFFFFFF01D8 C |
*GEMASTOPTRACK :   FFFFFFFFFFFF01C2 C | *GEMATEST :        FFFFFFFFFFFF017A C |
 GEMA_INIT :                    DDC C |  GEMA_INIT.END_SETUP :          E82 C |
 GEMA_INIT.SETUP_LIST :         E37 C |  GEMA_INIT.ST_COPY :            E56 C |
 GEMA_MASTERLIST : FFFFFFFFFFFF425A C |  GET_ROMTRCKS :                 4D1 C |
 GET_TICK :                     E87 C |  GET_TICK.CTNOTICK :            EA4 C |
 GFXDMA_WRAM :                 C800 C |  GFXDMA_WRAM_E :              1E000 C |
 GLBL_LASTORG :               32A00 - |  GLBL_LASTPC :              6014A00 - |
*HAS64 :                          1 - | *HASDSP :                         0 - |
*HASFPU :                         0 - | *HASPMMU :                        0 - |
*HBLK :                          40 - | *HCOUNT :                         5 - |
 HEADEROUT :                   1708 C |  HEADEROUT_E :                 1714 C |
 HINTCLR :                       18 - | *HINTENBL :                      10 - |
 HINT_DEFAULT :    FFFFFFFFFFFF1B10 C | *HIRQ_ON :                        4 - |
 HOT_START :                   1C1A C | *HVSTOP :                         2 - |
 ICDALLEND :                   1C2E C |  ID_LOOP :                     1A26 C |
*ID_LOOP.COLD_START :          1A42 C |  ID_LOOP.SH_WAIT :             1A30 C |
*INEXTMODE :                      0 - |  INIT_ROMTRCKS :                4D9 C |
*INLWORDMODE :                    0 - | *INMAXMODE :                      0 - |
*INSRCMODE :                      0 - | *INSUPMODE :                      1 - |
*INTMASK :                        1 - |  INT_M_LIST :               60002A0 C |
 INT_S_LIST :               60002E0 C |  IP_END :                       792 C |
 IP_START :                     784 C |  ISOFILELIST :                 B822 C |
 ISOFILELIST_E :               C000 C | *ISOFSSECTOR :                 B800 C |
 ISO_FILES :                   6500 C |  ISO_OUTPUT :                  E500 C |
*JOYA :                          40 - | *JOYB :                          10 - |
*JOYC :                          20 - | *JOYDOWN :                        2 - |
*JOYLEFT :                        4 - | *JOYMODE :                      800 - |
*JOYRIGHT :                       8 - | *JOYSTART :                      80 - |
*JOYUP :                          1 - | *JOYX :                         400 - |
*JOYY :                         200 - | *JOYZ :                         100 - |
*LCHWIDTH :                      34 - | *LEDSET :                        95 - |
 LEV :                            4 - | *LISTON :                         3 - |
 LIST_VDPREGS :    FFFFFFFFFFFF0252 C |  LITERAL_F_00000000_1 :     600049C C |
 LITERAL_F_00000001_1 :     60004AC C |  LITERAL_F_00000002_1 :     60005E0 C |
 LITERAL_F_00000003_1 :     6000700 C |  LITERAL_F_00000004_1 :     60007CC C |
 LITERAL_F_00000005_1 :     60007DC C |  LITERAL_F_00000006_1 :     6000870 C |
 LITERAL_F_00000007_1 :     6000874 C |  LITERAL_F_00000008_1 :     6000878 C |
 LITERAL_F_00000009_1 :     6000928 C |  LITERAL_F_0000000A_1 :     6000934 C |
 LITERAL_L_0000FC00_1 :     600063C C |  LITERAL_L_00800080_1 :     6000704 C |
 LITERAL_L_06000000_1 :     60007C8 C |  LITERAL_L_06000128_1 :     6000924 C |
 LITERAL_L_060005F0_1 :     60007D0 C |  LITERAL_L_0603EFF8_1 :     60005DC C |
 LITERAL_L_0603F000_1 :     6000920 C |  LITERAL_L_0603FFF8_1 :     60004A8 C |
 LITERAL_L_06040000_1 :     60007C4 C |  LITERAL_L_20004000_1 :     6000490 C |
 LITERAL_L_20004000_2 :     60005D8 C |  LITERAL_L_20004000_3 :     6000630 C |
 LITERAL_L_20004000_4 :     60006FC C |  LITERAL_L_20004000_5 :     60007D4 C |
 LITERAL_L_20004000_6 :     600092C C |  LITERAL_L_20004012_1 :     6000498 C |
 LITERAL_L_20004016_1 :     60004A4 C |  LITERAL_L_20004016_2 :     60005D4 C |
 LITERAL_L_20004018_1 :     60004A0 C |  LITERAL_L_20004018_2 :     60005D0 C |
 LITERAL_L_2000401A_1 :     600048C C |  LITERAL_L_2000401A_2 :     60005C0 C |
 LITERAL_L_2000401C_1 :     6000488 C |  LITERAL_L_2000401C_2 :     60005BC C |
 LITERAL_L_20004022_1 :     6000378 C |  LITERAL_L_20004024_1 :     600037C C |
 LITERAL_L_20004026_1 :     6000868 C |  LITERAL_L_20004027_1 :     6000954 C |
 LITERAL_L_20004028_1 :     60005C4 C |  LITERAL_L_2000402C_1 :     6000494 C |
 LITERAL_L_2000402C_2 :     6000930 C |  LITERAL_L_2000402D_1 :     6000880 C |
 LITERAL_L_2000402E_1 :     60005CC C |  LITERAL_L_2000402E_2 :     60007D8 C |
 LITERAL_L_20004100_1 :     6000634 C |  LITERAL_L_20004100_2 :     60006C4 C |
 LITERAL_L_20004100_3 :     60007E4 C |  LITERAL_L_20004100_4 :     600086C C |
 LITERAL_L_20004200_1 :     600087C C |  LITERAL_L_24000000_1 :     6000638 C |
 LITERAL_L_24000000_2 :     60006C0 C |  LITERAL_L_24000200_1 :     60007E0 C |
 LITERAL_L_4D5F4F4B_1 :     60004B0 C |  LITERAL_L_535F4F4B_1 :     60005E4 C |
 LITERAL_L_FFFFFFFFC0000000_1 :                                     60005C8 C |
 LITERAL_W_0080_1 :         6000640 C |  LITERAL_W_00A2_1 :         60006C8 C |
 LITERAL_W_00E0_1 :         60007FC C |  LITERAL_W_00F0_1 :         60004BA C |
 LITERAL_W_00F0_2 :         60005EC C |  LITERAL_W_00F0_3 :         6000642 C |
 LITERAL_W_0105_1 :         6000708 C |  LITERAL_W_0140_1 :         60007FA C |
 LITERAL_W_017E_1 :         6000884 C |  LITERAL_W_0415_1 :         600070A C |
 LITERAL_W_0530_1 :         60007EC C |  LITERAL_W_0530_2 :         600093C C |
 LITERAL_W_0800_1 :         600070C C |  LITERAL_W_44E0_1 :         60004B6 C |
 LITERAL_W_44E0_2 :         60005EA C |  LITERAL_W_44E5_1 :         60004B8 C |
 LITERAL_W_4600_1 :         60007F8 C |  LITERAL_W_4800_1 :         60007F0 C |
 LITERAL_W_4800_2 :         6000940 C |  LITERAL_W_A518_1 :         60007F4 C |
 LITERAL_W_A518_2 :         6000944 C |  LITERAL_W_FE10_1 :         60004B4 C |
 LITERAL_W_FE10_2 :         60005E8 C |  LITERAL_W_FE10_3 :         60007E8 C |
 LITERAL_W_FE10_4 :         6000938 C |  LITERAL_W_FE80_1 :         60007F2 C |
 LITERAL_W_FE80_2 :         6000942 C |  LITERAL_W_FE92_1 :         60007F6 C |
 LITERAL_W_FE92_2 :         6000946 C |  LITERAL_W_FEE2_1 :         60007EA C |
 LITERAL_W_FEE2_2 :         600093A C |  LITERAL_W_FEE4_1 :         60007EE C |
 LITERAL_W_FEE4_2 :         600093E C |  LOC_1DA :                     1BE6 C |
 LOC_1E2 :                     1BEE C |  LOC_21E :                     1C2A C |
 LOC_2EE :                     1C34 C |  LOC_302 :                     1C48 C |
 LOC_314 :                     1C62 C |  LOC_332 :                     1C7E C |
 LOC_332.MASTER :              1C92 C |  LOC_332.SLAVE :               1C9C C |
*LSH :                            B - | *LSL :                            9 - |
*MACEXP :                         7 - | *MAPBGH_0 :                  2091C2 C |
*MAPBGL_0 :                  208562 C | *MAPBLK_0 :                  20583A C |
*MAPCAMERA_0 :               20AA28 C | *MAPCOL_M :                  209E28 C |
*MAPFGC_0 :                  207902 C | *MAPFGH_0 :                  206CA2 C |
*MAPFGL_0 :                  206042 C | *MAPHEAD_0 :                 205830 C |
*MAPHEAD_M :                 209E22 C | *MAP_TEST3D :                204A30 C |
 MARS :                           0 - |  MARSBLOCK :                     82 C |
 MARSCD :                         1 - |  MARSERROR :                   1CB8 C |
*MARSGBL_NULL :                   2 C |  MARSGBL_XSHIFT :                 0 C |
 MARSGEMA_TABLE :          C0000000 - |  MARSINITHEADER :              1CBA C |
 MARSJUMPHERE :                1CF2 C |  MARSJUMPHERE.COPYME :         1D00 C |
 MARSJUMPHERE.COPYME_2 :       1D12 C |  MARSSOUND_FIRSTFILL :      60006E8 C |
 MARSSOUND_FIRSTFILL.FILL_BOTH :                                    60006EE C |
 MARSSOUND_INIT :           60006CC C |  MARSSPR_DATA :                  10 C |
 MARSSPR_DWIDTH :                 8 C | *MARSSPR_FILL :                   E C |
 MARSSPR_FLAGS :                  C C |  MARSSPR_INDX :                   A C |
 MARSSPR_X :                      4 C |  MARSSPR_XFRM :                   0 C |
 MARSSPR_XS :                     2 C |  MARSSPR_Y :                      6 C |
 MARSSPR_YFRM :                   1 C |  MARSSPR_YS :                     3 C |
 MARSUPD :                       3F C | *MARSVIDEO_FIXTBLSHIFT :    6000668 C |
 MARSVIDEO_FIXTBLSHIFT.COPY :                                       60006A8 C |
 MARSVIDEO_FIXTBLSHIFT.LOOP :                                       6000690 C |
 MARSVIDEO_FIXTBLSHIFT.PTCHSET :                                    60006BA C |
 MARSVIDEO_FIXTBLSHIFT.TBLEXIT :                                    60006B4 C |
 MARSVIDEO_INIT :           60005F0 C |  MARSVIDEO_INIT.DEF_FB :    6000610 C |
 MARSVIDEO_INIT.NXT_LNE :   6000616 C |  MARSVIDEO_INIT.WAIT_FRM :  6000626 C |
 MARSVIDEO_MAKENAMETBL :    6000644 C |
 MARSVIDEO_MAKENAMETBL.CANT_USE :                                   6000662 C |
*MARSVIDEO_MAKENAMETBL.LINETBL_NORMAL :                             6000654 C |
 MARSVIDEO_MAKENAMETBL.NXT_LNE2 :                                   6000658 C |
 MASTER_IRQ :               6000250 C |  MASTER_LOOP :              6000800 C |
 MASTER_LOOP.COPY_PAL :     600083E C |  MASTER_LOOP.COPY_SAFE :    600081E C |
*MASTER_LOOP.NOT_READY :    600085A C |  MASTER_LOOP.WAITL :        600080A C |
 MASTER_LOOP.WAITV :        600082C C |  MAX_BLOCKS :                    18 - |
 MAX_HEADS :                      F - |  MAX_INS :                        F - |
 MAX_MDDMATSK :                  10 - |  MAX_MDGLOBAL :                1000 - |
 MAX_MDOBJ :                     10 - |  MAX_MDOTHER :                 2000 - |
 MAX_MDSYSTEM :                 800 - |  MAX_MDVIDEO :                 2000 - |
 MAX_MODELS :                    10 - |  MAX_RCACH :                     40 - |
 MAX_SCRNBUFF :                2000 - |  MAX_SUPERSPR :                  18 - |
 MAX_SYSCODE :                 2000 - |  MAX_TBLSIZE :                   10 - |
 MAX_TRFRPZ :                     8 - |  MAX_TRKCHN :                    11 - |
 MAX_USERCODE :                2000 - |  MCD :                            0 - |
 MCDIN_END :                   1D5A C |  MCDIN_TOP :                   1A00 C |
 MCDIN_TOP.NORMAL :            1A1E C | *MCDIN_TOP.RETRY :             1A12 C |
 MCD_COMM_M :                     E - |  MCD_COMM_S :                     F - |
 MCD_DCOMM_M :                   10 - |  MCD_DCOMM_S :                   20 - |
 MCD_HINT :                       6 - |  MCD_MAIN :                    1A00 C |
 MCD_MEMORY :                     3 - | *MDJUMPCODE_E :    FFFFFFFFFFFFFE58 C |
*MDJUMPCODE_S :    FFFFFFFFFFFFFE00 C |  MDL_DATA :                       0 C |
*MDL_FLAGS :                     16 C | *MDL_FRAME :                     14 C |
*MDL_OPTION :                     4 C | *MDL_X_POS :                      8 C |
*MDL_X_ROT :                      E C | *MDL_Y_POS :                      A C |
*MDL_Y_ROT :                     10 C | *MDL_Z_POS :                      C C |
*MDL_Z_ROT :                     12 C | *MDMAP_DRAWALL :   FFFFFFFFFFFF0C16 C |
 MDMAP_DRAWALL.BLANK :                                     FFFFFFFFFFFF0CDC C |
 MDMAP_DRAWALL.DRWY_16 :                                   FFFFFFFFFFFF0D36 C |
 MDMAP_DRAWALL.GOT_BLK :                                   FFFFFFFFFFFF0CDA C |
 MDMAP_DRAWALL.MK_BLOCK :                                  FFFFFFFFFFFF0D12 C |
 MDMAP_DRAWALL.NO_BG :                                     FFFFFFFFFFFF0D10 C |
 MDMAP_DRAWALL.THIS_BG :                                   FFFFFFFFFFFF0C20 C |
 MDMAP_DRAWALL.X_LOOP :                                    FFFFFFFFFFFF0CCA C |
 MDMAP_DRAWALL.Y_LOOP :                                    FFFFFFFFFFFF0CC2 C |
*MDMAP_DRAWSCRLMD :                                        FFFFFFFFFFFF0D70 C |
*MDMAP_DRAWSCRLMD.BLNK :                                   FFFFFFFFFFFF0E0A C |
 MDMAP_DRAWSCRLMD.FRCE :                                   FFFFFFFFFFFF0E3E C |
 MDMAP_DRAWSCRLMD.GET_COORDS :                             FFFFFFFFFFFF0F52 C |
*MDMAP_DRAWSCRLMD.MARS_RET_C :                             FFFFFFFFFFFF0E94 C |
 MDMAP_DRAWSCRLMD.MK_CLMN :                                FFFFFFFFFFFF0DE4 C |
 MDMAP_DRAWSCRLMD.MK_ROW :                                 FFFFFFFFFFFF0E96 C |
 MDMAP_DRAWSCRLMD.NO_BG :                                  FFFFFFFFFFFF0DE2 C |
 MDMAP_DRAWSCRLMD.NO_D :                                   FFFFFFFFFFFF0DB6 C |
 MDMAP_DRAWSCRLMD.NO_L :                                   FFFFFFFFFFFF0DCE C |
 MDMAP_DRAWSCRLMD.NO_R :                                   FFFFFFFFFFFF0DDE C |
 MDMAP_DRAWSCRLMD.NO_U :                                   FFFFFFFFFFFF0DA4 C |
 MDMAP_DRAWSCRLMD.PRIO :                                   FFFFFFFFFFFF0E10 C |
 MDMAP_DRAWSCRLMD.THIS_BG :                                FFFFFFFFFFFF0D80 C |
 MDMAP_DRAWSCRLMD.VLD :                                    FFFFFFFFFFFF0E1C C |
*MDMAP_DRAWSCRLMD.XBLNK :                                  FFFFFFFFFFFF0ECA C |
 MDMAP_DRAWSCRLMD.XFRCE :                                  FFFFFFFFFFFF0EFE C |
 MDMAP_DRAWSCRLMD.XPRIO :                                  FFFFFFFFFFFF0ED0 C |
 MDMAP_DRAWSCRLMD.XVLD :                                   FFFFFFFFFFFF0EDC C |
 MDMAP_DRAWSCRLMD.X_BLK :                                  FFFFFFFFFFFF0EBE C |
 MDMAP_DRAWSCRLMD.X_LOW :                                  FFFFFFFFFFFF0F40 C |
*MDMAP_DRAWSCRLMD.X_NEW :                                  FFFFFFFFFFFF0F48 C |
 MDMAP_DRAWSCRLMD.Y_BLK :                                  FFFFFFFFFFFF0DFE C |
 MDMAP_DRAWSCRLMD.Y_LOW :                                  FFFFFFFFFFFF0E8C C |
*MDMAP_INIT :      FFFFFFFFFFFF09F0 C |  MDMAP_INIT.CLR :  FFFFFFFFFFFF09FA C |
*MDMAP_MOVE :      FFFFFFFFFFFF0AF6 C |
 MDMAP_MOVE.MARS_SIDE :                                    FFFFFFFFFFFF0B08 C |
*MDMAP_MOVE.NOT_ENABLD :                                   FFFFFFFFFFFF0B38 C |
 MDMAP_MOVE.X_LEFT :                                       FFFFFFFFFFFF0B12 C |
 MDMAP_MOVE.X_RIGHT :                                      FFFFFFFFFFFF0B1C C |
 MDMAP_MOVE.Y_LEFT :                                       FFFFFFFFFFFF0B26 C |
 MDMAP_MOVE.Y_RIGHT :                                      FFFFFFFFFFFF0B30 C |
*MDMAP_SET :       FFFFFFFFFFFF0A02 C |
 MDMAP_SET.MARS_SIDE :                                     FFFFFFFFFFFF0A22 C |
 MDMAP_SET.MD_SIDE :                                       FFFFFFFFFFFF0A12 C |
 MDMAP_SET.XL_G :  FFFFFFFFFFFF0ABE C |  MDMAP_SET.XL_L :  FFFFFFFFFFFF0AB6 C |
 MDMAP_SET.XR_G :  FFFFFFFFFFFF0ACE C |  MDMAP_SET.XR_L :  FFFFFFFFFFFF0AC6 C |
 MDMAP_SET.YB_G :  FFFFFFFFFFFF0AEA C |  MDMAP_SET.YB_L :  FFFFFFFFFFFF0AE2 C |
 MDMAP_SET.YT_G :  FFFFFFFFFFFF0ADA C |  MDMAP_SET.YT_L :  FFFFFFFFFFFF0AD2 C |
*MDMAP_UPDATE :    FFFFFFFFFFFF0B3A C |
 MDMAP_UPDATE.BEAM_INCR :                                  FFFFFFFFFFFF0C02 C |
 MDMAP_UPDATE.NO_BG :                                      FFFFFFFFFFFF0C00 C |
 MDMAP_UPDATE.THIS_BG :                                    FFFFFFFFFFFF0B4A C |
 MDMAP_UPDATE.VAL_H :                                      FFFFFFFFFFFF0C14 C |
 MDMAP_UPDATE.XD_G :                                       FFFFFFFFFFFF0C0C C |
 MDMAP_UPDATE.XD_L :                                       FFFFFFFFFFFF0C04 C |
 MDMAP_UPDATE.XEQU :                                       FFFFFFFFFFFF0B6C C |
 MDMAP_UPDATE.X_K :                                        FFFFFFFFFFFF0BD0 C |
 MDMAP_UPDATE.X_R :                                        FFFFFFFFFFFF0BCC C |
 MDMAP_UPDATE.YEQU :                                       FFFFFFFFFFFF0B80 C |
 MDMAP_UPDATE.Y_D :                                        FFFFFFFFFFFF0BF2 C |
 MDMAP_UPDATE.Y_K :                                        FFFFFFFFFFFF0BF6 C |
 MDSYS_SINEDATA :  FFFFFFFFFFFF1948 C |  MD_BANK_SRAM :              A130F1 - |
 MD_BG_BH :                       1 C |  MD_BG_BLK :                     28 C |
*MD_BG_BLKW :                     2 C |  MD_BG_BW :                       0 C |
 MD_BG_COL :                     2C C |  MD_BG_FLAGS :                    3 C |
 MD_BG_H :                        A C |  MD_BG_HF :                       E C |
 MD_BG_HI :                      24 C |  MD_BG_LOW :                     20 C |
*MD_BG_MOVEX :                    6 C | *MD_BG_MOVEY :                    7 C |
 MD_BG_VPOS :                    1C C |  MD_BG_VRAM :                    1E C |
 MD_BG_W :                        8 C |  MD_BG_WF :                       C C |
 MD_BG_X :                       30 C |  MD_BG_XINC_L :                  10 C |
 MD_BG_XINC_R :                  12 C |  MD_BG_XSET :                     4 C |
 MD_BG_X_OLD :                   18 C |  MD_BG_Y :                       34 C |
 MD_BG_YINC_D :                  16 C |  MD_BG_YINC_U :                  14 C |
 MD_BG_YSET :                     5 C |  MD_BG_Y_OLD :                   1A C |
 MD_JUMPCODE :                 57C2 C |  MD_JUMPCODE_E :               581A C |
 MD_READMODES :    FFFFFFFFFFFFFE00 C |
 MD_READMODES.PICK_BOOT :                                  FFFFFFFFFFFFFE18 C |
 MD_SYSCODE :                  3C5A C |  MD_SYSCODE_E :                57C2 C |
 MODE :                          18 - | *MODE_FADEOUT :    FFFFFFFFFFFF1AC6 C |
 MODE_FADEOUT.LOOPW :                                      FFFFFFFFFFFF1AEA C |
 MODE_INIT :       FFFFFFFFFFFF1A96 C |  MODE_INIT.CLR :   FFFFFFFFFFFF1AA6 C |
 MODE_INIT.CLR_MDLS :                                      FFFFFFFFFFFF1AB4 C |
 MOMCPU :                     68000 - | *MOMCPUNAME :                 68000 - |
 MONOWIDTH :                     38 - |  MOUSE_X :                        6 C |
 MOUSE_Y :                        8 C | *MSCPAUSEOFF :                    4 - |
*MSCPAUSEON :                     3 - | *MSCPLAY :                       11 - |
*MSCPLAY1 :                      12 - |  MSCPLAYR :                      13 - |
*MSCPLAYT :                      14 - | *MSCSCANFF :                      5 - |
*MSCSCANFR :                      6 - | *MSCSCANOFF :                     7 - |
*MSCSEEK :                       15 - | *MSCSEEK1 :                      19 - |
*MSCSEEKT :                      16 - | *MSCSTOP :                        2 - |
 M_IRQ_BAD :                6000380 C |  M_IRQ_CMD :                600039C C |
 M_IRQ_DMA :                600046C C |  M_IRQ_DMA.WAIT_DMA :       6000476 C |
 M_IRQ_H :                  60003E8 C |  M_IRQ_PWM :                6000384 C |
 M_IRQ_V :                  6000404 C |  M_IRQ_VRES :               6000420 C |
 M_IRQ_VRES.RV_BUSY :       6000460 C | *NESTMAX :                      100 - |
 NIKONA_BUFFLIST :             13F7 C |  NIKONA_SETMSTRLIST :          1429 C |
*OBJECTS_INIT :    FFFFFFFFFFFF0FCE C |
 OBJECTS_INIT.CLR :                                        FFFFFFFFFFFF0FD6 C |
 OBJECTS_INIT.CLR_D :                                      FFFFFFFFFFFF0FE4 C |
*OBJECTS_RUN :     FFFFFFFFFFFF0FF0 C |
 OBJECTS_RUN.NEXT_ONE :                                    FFFFFFFFFFFF0FF8 C |
 OBJECTS_RUN.NO_CODE :                                     FFFFFFFFFFFF1004 C |
*OBJECTS_SHOW :    FFFFFFFFFFFF100E C |
 OBJECTS_SHOW.FINISH :                                     FFFFFFFFFFFF113E C |
 OBJECTS_SHOW.FLIP_H :                                     FFFFFFFFFFFF1124 C |
 OBJECTS_SHOW.FLIP_V :                                     FFFFFFFFFFFF1130 C |
 OBJECTS_SHOW.MARS_MODE :                                  FFFFFFFFFFFF10C6 C |
 OBJECTS_SHOW.MK_PZ :                                      FFFFFFFFFFFF108E C |
 OBJECTS_SHOW.MK_SPR :                                     FFFFFFFFFFFF1138 C |
 OBJECTS_SHOW.NEXT :                                       FFFFFFFFFFFF1058 C |
 OBJECTS_SHOW.NEXTS :                                      FFFFFFFFFFFF1026 C |
 OBJECTS_SHOW.NO_SPRDRW :                                  FFFFFFFFFFFF104C C |
 OBJECTS_SHOW.RAN_OUT :                                    FFFFFFFFFFFF1154 C |
*OBJECT_ANIMATE :  FFFFFFFFFFFF119C C |
 OBJECT_ANIMATE.GOTOFRAME :                                FFFFFFFFFFFF121E C |
 OBJECT_ANIMATE.KEEPSPD :                                  FFFFFFFFFFFF11DE C |
 OBJECT_ANIMATE.LASTFRAME :                                FFFFFFFFFFFF1218 C |
 OBJECT_ANIMATE.NOANIM :                                   FFFFFFFFFFFF120A C |
 OBJECT_ANIMATE.RETURN :                                   FFFFFFFFFFFF1208 C |
 OBJECT_ANIMATE.SAMETHING :                                FFFFFFFFFFFF11B6 C |
*OBJECT_COLM_FLOOR :                                       FFFFFFFFFFFF124C C |
 OBJECT_COLM_FLOOR.BLNK :                                  FFFFFFFFFFFF12C2 C |
 OBJECT_COLM_FLOOR.NEXT :                                  FFFFFFFFFFFF12B6 C |
 OBJECT_COLM_FLOOR.VALID :                                 FFFFFFFFFFFF12CA C |
 OBJECT_COLM_FLOOR.V_X :                                   FFFFFFFFFFFF1268 C |
 OBJECT_COLM_FLOOR.V_XR :                                  FFFFFFFFFFFF126E C |
 OBJECT_COLM_FLOOR.V_Y :                                   FFFFFFFFFFFF127E C |
 OBJECT_COLM_FLOOR.V_YD :                                  FFFFFFFFFFFF1284 C |
*OBJECT_DISPLAY :  FFFFFFFFFFFF1156 C |
 OBJECT_DISPLAY.SRCH :                                     FFFFFFFFFFFF115E C |
 OBJECT_DISPLAY.THIS_ONE :                                 FFFFFFFFFFFF116A C |
*OBJECT_MKSPRPZ :  FFFFFFFFFFFF116E C |
 OBJECT_MKSPRPZ.NOPE :                                     FFFFFFFFFFFF119A C |
*OBJECT_SETCOLFLOOR :                                      FFFFFFFFFFFF12D0 C |
 OBJECT_SETCOLFLOOR.NO_COL :                               FFFFFFFFFFFF131A C |
*OBJECT_SPEED :    FFFFFFFFFFFF123A C |  OBJECT_UPDX :     FFFFFFFFFFFF122A C |
*OBJECT_UPDY :     FFFFFFFFFFFF123C C |  OBJ_ANIM_ID :                   1C C |
 OBJ_ANIM_INDX :                 1A C |  OBJ_ANIM_SPD :                  20 C |
 OBJ_CODE :                       0 C |  OBJ_FRAME :                     1E C |
*OBJ_INDEX :                     21 C |  OBJ_MAP :                       10 C |
*OBJ_RAM :                       26 C |  OBJ_SET :                       23 C |
 OBJ_SIZE :                       4 C | *OBJ_SPWNID :                    25 C |
 OBJ_STATUS :                    24 C | *OBJ_SUBID :                     22 C |
 OBJ_VRAM :                      14 C |  OBJ_X :                          8 C |
 OBJ_X_SPD :                     16 C |  OBJ_Y :                          C C |
 OBJ_Y_SPD :                     18 C | *ONOFF :                         11 - |
 ON_HOLD :                        2 C |  ON_PRESS :                       4 C |
*PACKING :                        0 - | *PADDING :                        0 - |
*PADDINGSOFAR :                   0 - |  PAD_ID :                         0 C |
 PAD_VER :                        1 C |  PALETTECLEAR :                1B28 C |
 PALETTECLEAR.FM2 :            1B32 C |  PALETTECLEAR.PL :             1B3E C |
 PALMARS_TEST :              204800 C | *PAL_LEVEL0 :                204A00 C |
*PAL_TEST3D :                204A20 C | *PAN :                            3 - |
 PARP :                          34 - | *PCM :                       FF0000 - |
*PCM_WAIT :                    6288 C |  PCM_WAIT.WAITLOOP :           6290 C |
*PEN :                           20 - |  PROC_CHIPS :                   523 C |
 PSGCOM :                      167B C |  PSGFREQ_LIST :                1207 C |
 PSGHATMODE :                  1706 C | *PSG_CTRL :                  C00011 - |
 PTMR :                          38 - |  PVOL :                          30 - |
*PWCOM :                          0 - | *PWINSH :                        20 - |
*PWINSL :                        30 - | *PWINSM :                        28 - |
 PWMCOM :                      1643 C | *PWMCTL :                        31 - |
 PWMINTCLR :                     1C - |  PWMIRQ_ON :                      1 - |
 PWOUTF :                        18 - | *PWPHL :                         10 - |
*PWPTH_V :                        8 - |  RAM_BGBUFFER :    FFFFFFFFFFFF8660 C |
 RAM_BGBUFFERM :   FFFFFFFFFFFFAA00 - | *RAM_DMACODE :     FFFFFFFFFFFFA240 C |
 RAM_FADEMARSDELAY :                                       FFFFFFFFFFFF99AA C |
 RAM_FADEMARSINCR :                                        FFFFFFFFFFFF99A8 C |
 RAM_FADEMARSREQ : FFFFFFFFFFFF99A6 C |  RAM_FADEMARSTMR : FFFFFFFFFFFF99AC C |
 RAM_FADEMDDELAY : FFFFFFFFFFFF99A2 C |  RAM_FADEMDINCR :  FFFFFFFFFFFF99A0 C |
 RAM_FADEMDREQ :   FFFFFFFFFFFF999E C |  RAM_FADEMDTMR :   FFFFFFFFFFFF99A4 C |
 RAM_FRAMECOUNT :  FFFFFFFFFFFF8740 C |  RAM_GLBL_SCRN :   FFFFFFFFFFFFC800 C |
 RAM_HORSCROLL :   FFFFFFFFFFFF8744 C | *RAM_INITFLUG :    FFFFFFFFFFFFA448 C |
 RAM_INPUTDATA :   FFFFFFFFFFFFA000 C | *RAM_MAPX :        FFFFFFFFFFFFD800 C |
*RAM_MAPY :        FFFFFFFFFFFFD802 C |
*RAM_MAPY.FADE_IN :                                        FFFFFFFFFFFF20BC C |
*RAM_MAPY.FADE_OUT :                                       FFFFFFFFFFFF20E2 C |
 RAM_MAPY.LOOP :   FFFFFFFFFFFF209C C |  RAM_MAPY.LOOP2 :  FFFFFFFFFFFF2106 C |
 RAM_MARS_DREQDMA :        26014A00 C |  RAM_MARS_DREQREAD :       26014FF8 C |
 RAM_MARS_GEMAWAVE_0 :     260155F0 C | *RAM_MARS_GEMAWAVE_1 :     260165F0 C |
 RAM_MARS_GLOBAL :          6014960 C |  RAM_MDDREQ :      FFFFFFFFFFFFA800 - |
 RAM_MDGLOBAL :    FFFFFFFFFFFFC800 C |  RAM_MDMARSHINT :  FFFFFFFFFFFFA452 C |
 RAM_MDMARSPALFD : FFFFFFFFFFFF9534 C |  RAM_MDMARSVINT :  FFFFFFFFFFFFA44C C |
 RAM_MDOTHER :     FFFFFFFFFFFFA800 C |  RAM_MDSYSTEM :    FFFFFFFFFFFFA000 C |
*RAM_MDVBLKWAIT :  FFFFFFFFFFFFA458 C |  RAM_MDVIDEO :     FFFFFFFFFFFF8000 C |
 RAM_MEGACD :              FFFFFD00 - |  RAM_OBJDISPLIST : FFFFFFFFFFFF8B54 C |
 RAM_OBJECTS :     FFFFFFFFFFFF8000 C |  RAM_PALETTE :     FFFFFFFFFFFF9434 C |
 RAM_PALETTEFD :   FFFFFFFFFFFF94B4 C | *RAM_SAVEDATA :    FFFFFFFFFFFFA040 C |
 RAM_SCREENBUFF :  FFFFFFFFFFFFD800 C |  RAM_SCREENJUMP :          FFFFFE00 - |
 RAM_SPRDRWCNTR :  FFFFFFFFFFFF9994 C |  RAM_SPRDRWPZ :    FFFFFFFFFFFF8B74 C |
 RAM_SPRITES :     FFFFFFFFFFFF8FD4 C | *RAM_SPRSHOWINDX : FFFFFFFFFFFF9996 C |
*RAM_STACK :               FFFFFD00 - |  RAM_SYSRANDSEED : FFFFFFFFFFFFA444 C |
*RAM_SYSRANDVAL :  FFFFFFFFFFFFA440 C |  RAM_SYSTEMCODE :  FFFFFFFFFFFF0000 C |
 RAM_USERCODE :    FFFFFFFFFFFF2000 C |  RAM_VDPDMAINDX :  FFFFFFFFFFFF9998 C |
 RAM_VDPDMALIST :  FFFFFFFFFFFF9734 C |  RAM_VDPDMAMOD :   FFFFFFFFFFFF999A C |
 RAM_VDPREGS :     FFFFFFFFFFFF99AE C |  RAM_VERSCROLL :   FFFFFFFFFFFF8B04 C |
 RAM_VIDPRNTLIST : FFFFFFFFFFFF9814 C |  RAM_VIDPRNTVRAM : FFFFFFFFFFFF999C C |
*RCHWIDTH :                      36 - | *RELAXED :                        0 - |
 RESTARTPRG :                  1B50 C |  RESTARTPRG.FM3 :              1B6E C |
 RESTARTPRG.FS0 :              1BA2 C |  RESTARTPRG.FS1 :              1BAE C |
 RESTARTPRG.RES_WAIT :         1B54 C | *ROMPAUSEOFF :                    9 - |
*ROMPAUSEON :                     8 - | *ROMREAD :                       17 - |
*ROMREADE :                      21 - |  ROMREADN :                      20 - |
*ROMSEEK :                       18 - | *ROM_END :                    33000 C |
 RRT :                           14 - |  SAMPLEHEAD :                  1716 C |
 SAMPLE_RATE :                 5622 - |  SAT_MAIN :                    C000 C |
 SAT_MAIN_E :                  C800 C |  SBEATACC :                      1C C |
 SBEATPTCK :                     1E C | *SCDINIT :                       8E - |
*SCDPQ :                         93 - | *SCDPQL :                        94 - |
*SCDREAD :                       92 - | *SCDSTART :                      8F - |
*SCDSTAT :                       91 - | *SCDSTOP :                       90 - |
 SCPU_REG :                FFFF8000 - |  SCPU_WRAM :                  80000 - |
 SET_CHIPS :                    4FE C |  SET_CHIPS.TRK_BUFFRS :         506 C |
 SH2_DEBUG :                      1 - |  SH2_MASTER :               6000000 C |
 SH2_M_ENTRY :              6000710 C |  SH2_M_ERRADDR :            600032C C |
 SH2_M_ERRCODE :            600033C C |  SH2_M_ERRDMA :             6000330 C |
 SH2_M_ERRILLG :            6000324 C |  SH2_M_ERRINVL :            6000328 C |
 SH2_M_ERRNMI :             6000334 C |  SH2_M_ERROR :              6000320 C |
 SH2_M_ERRUSER :            6000338 C |  SH2_M_HOTSTART :           6000752 C |
 SH2_M_HOTSTART.LOOPIN :    6000792 C |  SH2_M_HOTSTART.WAIT_FRM :  60007B4 C |
 SH2_M_HOTSTART.WAIT_SLV :  6000786 C |  SH2_RAM :                  6014A00 C |
 SH2_SLAVE :                6000128 C |  SH2_S_ENTRY :              6000888 C |
 SH2_S_ERRADDR :            6000358 C |  SH2_S_ERRCODE :            6000368 C |
 SH2_S_ERRDMA :             600035C C |  SH2_S_ERRILLG :            6000350 C |
 SH2_S_ERRINVL :            6000354 C |  SH2_S_ERRNMI :             6000360 C |
 SH2_S_ERROR :              600034C C |  SH2_S_ERRUSER :            6000364 C |
 SH2_S_HOTSTART :           60008D8 C |  SH2_S_HOTSTART.WAIT_MST :  600090C C |
 SHIFT :                          2 - |  SHOWROM :                      EA8 C |
*SIN_TABLE :                6000958 C |  SIZEOF_CAMERA :                 18 C |
 SIZEOF_DREQ :                  5F8 C |  SIZEOF_INPUT :                  10 C |
 SIZEOF_MARSGBL :                 4 C |  SIZEOF_MARSSPR :                14 C |
 SIZEOF_MDBG :                   38 C | *SIZEOF_MDGLBL :   FFFFFFFFFFFFC802 C |
 SIZEOF_MDLOBJ :                 18 C |  SIZEOF_MDOBJ :                  66 C |
*SIZEOF_MDRAM :    FFFFFFFFFFFFF800 C | *SIZEOF_MDSYS :    FFFFFFFFFFFFA45A C |
 SIZEOF_MDVID :    FFFFFFFFFFFF99C6 C |  SLAVE_IRQ :                6000278 C |
 SLAVE_LOOP :               6000948 C |  SLOPE_DATA_16 :   FFFFFFFFFFFF131C C |
 SLV :                           10 - |  SNDLOCKZ80 :      FFFFFFFFFFFF0068 C |
 SNDLOCKZ80.WAIT : FFFFFFFFFFFF0070 C | *SNDREQCMD :       FFFFFFFFFFFF0178 C |
 SNDREQ_ENTER :    FFFFFFFFFFFF0086 C |
 SNDREQ_ENTER.WAIT :                                       FFFFFFFFFFFF00AC C |
 SNDREQ_EXIT :     FFFFFFFFFFFF00BC C | *SNDREQ_SADDR :    FFFFFFFFFFFF00E4 C |
 SNDREQ_SBYTE :    FFFFFFFFFFFF00EC C |  SNDREQ_SCMD :     FFFFFFFFFFFF00D2 C |
*SNDREQ_SLONG :    FFFFFFFFFFFF00E0 C |  SNDREQ_SWORD :    FFFFFFFFFFFF00E8 C |
 SNDUNLOCKZ80 :    FFFFFFFFFFFF007C C |  SOUND_INIT :      FFFFFFFFFFFF0000 C |
 SOUND_INIT.CLEANUP :                                      FFFFFFFFFFFF002A C |
 SOUND_INIT.COPY : FFFFFFFFFFFF0040 C |  SOUND_INIT.WAIT : FFFFFFFFFFFF0014 C |
 SP_CMDLIST :                  60AE C |  SP_CMND00 :                   60D0 C |
 SP_CMND01 :                   60D2 C |  SP_CMND01.EXIT_NOW :          6134 C |
 SP_CMND01.NEXT_PACKET :       60EE C |  SP_CMND01.WAIT_MAIN :         610C C |
 SP_CMND01.WAIT_MAIN_O :       6128 C |  SP_CMND02 :                   6142 C |
 SP_CMND10 :                   6168 C |  SP_CMND10.THIS :              6176 C |
 SP_END :                       B00 C |  SP_FINDFILE :                 622E C |
 SP_FINDFILE.CHECKCHARS :      6240 C |  SP_FINDFILE.FINDFIRSTCHAR :   623A C |
 SP_FINDFILE.GETINFO :         624A C |  SP_FINDFILE.NEXT_FILE :       6236 C |
 SP_INIT :                     6028 C |  SP_INITISO :                  61EC C |
 SP_IRQ :                      60AC C |  SP_ISOREADN :                 6178 C |
 SP_ISOREADN.WAITREAD :        61B0 C |  SP_ISOREADN.WAITSTAT :        61A6 C |
 SP_ISOREADN.WAITTRANSFER :    61BA C |  SP_MAIN :                     606C C |
 SP_MAIN.WAIT_MAIN :           6074 C |  SP_RAM :                      6300 C |
 SP_START :                     800 C | *ST :                             D - |
 STACK_MSTR :               6040000 - |  STACK_SLV :                603F000 - |
 STANDBY :                        3 - |  STR_STATS :       FFFFFFFFFFFF2112 C |
 STR_STATS2 :      FFFFFFFFFFFF2138 C |  SUB_BIOSARGS :                6300 C |
*SUB_BIOSOUT :                 6400 C | *SYSMARS_ID :                A130EC - |
 SYSMARS_REG :               A15100 - |  SYSMCD_REG :                A12000 - |
 SYSMCD_WRAM :               200000 - |
 SYSTEM_DMAENTER_RAM :                                     FFFFFFFFFFFF1658 C |
 SYSTEM_DMAENTER_ROM :                                     FFFFFFFFFFFF1660 C |
 SYSTEM_DMAEXIT_RAM :                                      FFFFFFFFFFFF165C C |
 SYSTEM_DMAEXIT_ROM :                                      FFFFFFFFFFFF1664 C |
 SYSTEM_GRABRAMCODE :                                      FFFFFFFFFFFF1690 C |
 SYSTEM_GRABRAMCODE.COPY_RAM :                             FFFFFFFFFFFF16CC C |
 SYSTEM_GRABRAMCODE.WAIT_SUB :                             FFFFFFFFFFFF16FA C |
 SYSTEM_INIT :     FFFFFFFFFFFF1534 C |
 SYSTEM_INIT.CLRINPUT :                                    FFFFFFFFFFFF1592 C |
 SYSTEM_INIT.WAIT :                                        FFFFFFFFFFFF1542 C |
 SYSTEM_INPUT :    FFFFFFFFFFFF1730 C |
 SYSTEM_INPUT.EXIT :                                       FFFFFFFFFFFF175E C |
 SYSTEM_INPUT.ID_03 :                                      FFFFFFFFFFFF1784 C |
 SYSTEM_INPUT.ID_0D :                                      FFFFFFFFFFFF182E C |
 SYSTEM_INPUT.INVALID :                                    FFFFFFFFFFFF1828 C |
 SYSTEM_INPUT.LIST :                                       FFFFFFFFFFFF1764 C |
 SYSTEM_INPUT.OLDPAD :                                     FFFFFFFFFFFF18A6 C |
 SYSTEM_INPUT.PICK_ID :                                    FFFFFFFFFFFF18AC C |
 SYSTEM_INPUT.READ :                                       FFFFFFFFFFFF18C2 C |
 SYSTEM_INPUT.STEP_1 :                                     FFFFFFFFFFFF18CE C |
 SYSTEM_INPUT.STEP_2 :                                     FFFFFFFFFFFF18DA C |
 SYSTEM_INPUT.THIS_ONE :                                   FFFFFFFFFFFF1744 C |
*SYSTEM_INPUT.WAIT :                                       FFFFFFFFFFFF1730 C |
 SYSTEM_INPUT.X_NEG :                                      FFFFFFFFFFFF17F6 C |
 SYSTEM_INPUT.Y_NEG :                                      FFFFFFFFFFFF1822 C |
 SYSTEM_MARSUPDATE :                                       FFFFFFFFFFFF1682 C |
 SYSTEM_MCDSUBTASK :                                       FFFFFFFFFFFF1668 C |
 SYSTEM_MCDSUBTASK.WAIT_SUB_I :                            FFFFFFFFFFFF1676 C |
 SYSTEM_MCDSUBTASK.WAIT_SUB_S :                            FFFFFFFFFFFF166E C |
*SYSTEM_RANDOM :   FFFFFFFFFFFF18DC C |
 SYSTEM_RANDOM.GOOD_S :                                    FFFFFFFFFFFF18EC C |
 SYSTEM_ROMSENDDREQ :                                      FFFFFFFFFFFF1B12 C |
*SYSTEM_ROMSENDDREQ.END :                                  FFFFFFFFFFFF1B68 C |
 SYSTEM_ROMSENDDREQ.L0 :                                   FFFFFFFFFFFF1B52 C |
 SYSTEM_ROMSENDDREQ.WAIT_BIT :                             FFFFFFFFFFFF1B3E C |
 SYSTEM_SETINTS :  FFFFFFFFFFFF1A48 C |
 SYSTEM_SETINTS.NOHINT :                                   FFFFFFFFFFFF1A6C C |
 SYSTEM_SETINTS.NOVINT :                                   FFFFFFFFFFFF1A5A C |
*SYSTEM_SINEWAVE : FFFFFFFFFFFF192A C |
 SYSTEM_SINEWAVE.DONT_NEG :                                FFFFFFFFFFFF1946 C |
*SYSTEM_SINEWAVE_COS :                                     FFFFFFFFFFFF190A C |
 SYSTEM_SINEWAVE_COS.DONT_NEG :                            FFFFFFFFFFFF1924 C |
*SYSTEM_SRAMINIT : FFFFFFFFFFFF1A6E C |
 SYSTEM_SRAMINIT.INITSAVE :                                FFFFFFFFFFFF1A82 C |
 SYSTEM_WAITFRAME :                                        FFFFFFFFFFFF159C C |
 SYSTEM_WAITFRAME.WAIT_IN :                                FFFFFFFFFFFF15B4 C |
 SYSTEM_WAITFRAME.WAIT_LAG :                               FFFFFFFFFFFF15A2 C |
 SYS_CTRL_1 :                A10009 - |  SYS_CTRL_2 :                A1000B - |
 SYS_CTRL_3 :                A1000D - |  SYS_DATA_1 :                A10003 - |
*SYS_DATA_2 :                A10005 - | *SYS_DATA_3 :                A10007 - |
*SYS_EXRAM :                 200000 - | *SYS_IO :                    A10001 - |
*SYS_TMSS :                  A14000 - |  S_IRQ_BAD :                60004BC C |
 S_IRQ_CMD :                60004DC C | *S_IRQ_CMD.COPY_1 :         6000502 C |
 S_IRQ_CMD.EXIT_C :         6000510 C |  S_IRQ_CMD.WAIT_1 :         60004F6 C |
 S_IRQ_DMA :                60005A8 C |  S_IRQ_DMA.WAIT_DMA :       60005B2 C |
 S_IRQ_H :                  6000524 C |  S_IRQ_PWM :                60004C0 C |
 S_IRQ_V :                  6000540 C |  S_IRQ_VRES :               600055C C |
 S_IRQ_VRES.RV_BUSY :       600059C C |  TBLBUFF_READ :                 543 C |
 TBLBUFF_READ.CHK_PSG :         607 C |  TBLBUFF_READ.CLRFULL :         6C6 C |
 TBLBUFF_READ.DO_CHIP :         579 C |  TBLBUFF_READ.DO_NEWCHIP :      632 C |
 TBLBUFF_READ.GRAB_LINK :       5AF C |  TBLBUFF_READ.INVLDL :          5F0 C |
 TBLBUFF_READ.L_HIPRIO :        67B C |  TBLBUFF_READ.NEW_CHIP :        633 C |
 TBLBUFF_READ.NEW_LINK :        678 C |  TBLBUFF_READ.NEW_LINK_O :      678 C |
 TBLBUFF_READ.NEW_LINK_Z :      674 C |  TBLBUFF_READ.NEXTSRCH_TBL :    66A C |
 TBLBUFF_READ.NEXT_CHNL :       566 C |  TBLBUFF_READ.NEXT_PRIO :       655 C |
 TBLBUFF_READ.PASS_2 :          653 C |  TBLBUFF_READ.PICK_TBL :        69E C |
 TBLBUFF_READ.REFILL :          62F C |  TBLBUFF_READ.REROLL :          5F9 C |
 TBLBUFF_READ.RESET_LINK :      6B8 C |  TBLBUFF_READ.RNOT_PSG :        62D C |
 TBLBUFF_READ.SET_ASFULL :      69B C |  TBLBUFF_READ.SINGL_FREE :      689 C |
 TBLBUFF_READ.SINGL_LINK :      61F C | *TBLBUFF_READ.SNGL_SPRIO :      69A C |
 TBLBUFF_READ.SRCH_FREE :       642 C |  TBLBUFF_READ.SRCH_LINK :       5D6 C |
 TBLBUFF_READ.SRCH_LLOOP :      5E0 C |  TBLBUFF_READ.TRACK_CONT :      559 C |
 TBLFM :                       147F C |  TBLFM3 :                      14BF C |
 TBLFM6 :                      14CF C |  TBLLIST :                     142D C |
 TBLPSG :                      143D C |  TBLPSGN :                     146F C |
 TBLPWM :                      14E1 C | *TESTENTRY :                     1E - |
*TESTENTRYLOOP :                 1F - | *TEST_MAINSPD :                   4 - |
 TH :                      20000000 - |  TICKCNT :                     1705 C |
 TICKFLAG :                    1704 C |  TICKSPSET :                   1703 C |
*TIME :                     0:10:13 - |  TIMERCTL :                      30 - |
*TMR :                           2C - |  TRACK_OUT :                    493 C |
 TRACK_OUT.CLRFE :              4A4 C |  TRACK_OUT.NOCHIP :             4C7 C |
 TRANSFERROM :                  EC8 C |  TRANSFERROM.DOUBLE :           EE7 C |
 TRANSFERROM.TRANSFER :         F0B C |  TRANSFERROM.X68KLAST :         F29 C |
 TRANSFERROM.X68KLOOP :         F15 C |  TRANSFERROM.X68KLPWT :         F37 C |
 TRANSFERROM.X68KNOCARRY :      F05 C |  TRANSFERROM.X68KPWTLP :        F3C C |
 TRKBLKS_0 :                   1B61 C |  TRKBLKS_1 :                   1B79 C |
 TRKBLKS_2 :                   1B91 C |  TRKBUFF_0 :                   171D C |
 TRKBUFF_1 :                   174D C |  TRKBUFF_2 :                   177D C |
 TRKCACH_0 :                   1E00 C |  TRKCACH_1 :                   1E40 C |
 TRKCACH_2 :                   1E80 C | *TRKCACH_3 :                   1EC0 C |
 TRKCHNL_0 :                   17AD C |  TRKCHNL_1 :                   1835 C |
 TRKCHNL_2 :                   18BD C |  TRKHDRS_0 :                   1945 C |
 TRKHDRS_1 :                   1981 C |  TRKHDRS_2 :                   19BD C |
 TRKINSD_0 :                   19F9 C |  TRKINSD_1 :                   1A71 C |
 TRKINSD_2 :                   1AE9 C |  TRKLISTCACH :                 16B7 C |
 TRKLISTPAGE :                   3E C | *TRK_BANKBLK :                   16 - |
*TRK_BANKHEAD :                  17 - | *TRK_BANKINS :                   15 - |
 TRK_BLOCKS :                     4 - |  TRK_CACHHALF :                   E - |
*TRK_CACHINC :                    F - |  TRK_CHNCACH :                   2E - |
 TRK_CHNCBLK :                   28 - |  TRK_CHNCHEAD :                  2A - |
 TRK_CHNCINS :                   2C - |  TRK_CHNLIST :                   26 - |
 TRK_CURRBLK :                   12 - |  TRK_INSTR :                      8 - |
 TRK_MAXBLKS :                   1D - |  TRK_MAXCHNLS :                  1C - |
 TRK_MAXHDRS :                   1E - |  TRK_MAXINS :                    1F - |
*TRK_PANNING :                   13 - |  TRK_PATT :                       6 - |
 TRK_PRIORITY :                  14 - |  TRK_READ :                       A - |
 TRK_ROMCPATT :                  20 - |  TRK_ROMPATT :                   23 - |
 TRK_ROWPAUSE :                  10 - |  TRK_ROWS :                       C - |
 TRK_SEQID :                      1 - |  TRK_SETBLK :                     2 - |
 TRK_STATUS :                     0 - |  TRK_TICKSET :                    3 - |
 TRK_TICKTMR :                   11 - | *TRUE :                           1 - |
*TVMODE :                         0 - |  UPD_TRACK :                    1CF C |
 UPD_TRACK.DECROW :             265 C |  UPD_TRACK.DECROW_E :           268 C |
 UPD_TRACK.EFFECT_FILL :        3DB C |  UPD_TRACK.EFF_A :              303 C |
 UPD_TRACK.EFF_B :              315 C |  UPD_TRACK.EFF_C :              32B C |
 UPD_TRACK.EXIT :               259 C |  UPD_TRACK.FIRST_FILL :         3E2 C |
 UPD_TRACK.GRAB_RHEAD :         47F C |  UPD_TRACK.HAS_NOTE :           270 C |
 UPD_TRACK.INC_CPATT :          32E C |  UPD_TRACK.NEXT_NOTE :          249 C |
 UPD_TRACK.NO_EFF :             2CF C |  UPD_TRACK.NO_GLBL :            40D C |
 UPD_TRACK.NO_INS :             2B1 C |  UPD_TRACK.NO_NOTE :            2A6 C |
 UPD_TRACK.NO_VOL :             2BC C |  UPD_TRACK.OLD_TYPE :           29A C |
 UPD_TRACK.RAN_OUT :            33C C |  UPD_TRACK.READ_TRACK :         1F0 C |
 UPD_TRACK.ROW_ACTIVE :         242 C |  UPD_TRACK.SET_TRACK :          366 C |
 UPD_TRACK.SFXMD :              209 C |  UPD_TRACK.TRACK_END :          3CA C |
 UPD_TRACK.TRK_BUFFRS :         1D4 C |  VARNULLVRAM :                  7FF - |
 VARPRINTPAL :                    3 - |  VARPRINTVRAM :                 580 - |
 VBLK :                          80 - |  VDPSTS :                         A - |
 VDP_CTRL :                  C00004 - |  VDP_DATA :                  C00000 - |
*VERSION :                     142F - |  VIDEO_CLEAR :     FFFFFFFFFFFF0286 C |
*VIDEO_CLEARSCREEN :                                       FFFFFFFFFFFF0286 C |
 VIDEO_CLEARSCREEN.PNEXT :                                 FFFFFFFFFFFF0304 C |
 VIDEO_CLEARSCREEN.SNEXT :                                 FFFFFFFFFFFF02F0 C |
 VIDEO_CLEARSCREEN.XNEXT :                                 FFFFFFFFFFFF02D0 C |
 VIDEO_CLEARSCREEN.YNEXT :                                 FFFFFFFFFFFF02E0 C |
*VIDEO_COPY :      FFFFFFFFFFFF0848 C |  VIDEO_COPY.DMAW : FFFFFFFFFFFF085C C |
 VIDEO_COPY.DMAWE :                                        FFFFFFFFFFFF08B4 C |
*VIDEO_DMABLAST :  FFFFFFFFFFFF0992 C |
 VIDEO_DMABLAST.END :                                      FFFFFFFFFFFF09E0 C |
 VIDEO_DMABLAST.EXIT :                                     FFFFFFFFFFFF09EE C |
 VIDEO_DMABLAST.NEXT :                                     FFFFFFFFFFFF09BA C |
*VIDEO_DMAMKENTRY :                                        FFFFFFFFFFFF0760 C |
 VIDEO_DOPALFADE : FFFFFFFFFFFF0616 C |
 VIDEO_DOPALFADE.ACTIVE :                                  FFFFFFFFFFFF0632 C |
 VIDEO_DOPALFADE.FADE_DONE :                               FFFFFFFFFFFF063A C |
 VIDEO_DOPALFADE.FADE_IN :                                 FFFFFFFFFFFF063C C |
 VIDEO_DOPALFADE.FADE_LIST :                               FFFFFFFFFFFF0634 C |
 VIDEO_DOPALFADE.FADE_OUT :                                FFFFFFFFFFFF06E0 C |
 VIDEO_DOPALFADE.NO_BLU :                                  FFFFFFFFFFFF06B8 C |
 VIDEO_DOPALFADE.NO_BLU_O :                                FFFFFFFFFFFF073C C |
 VIDEO_DOPALFADE.NO_FNSH :                                 FFFFFFFFFFFF06D0 C |
 VIDEO_DOPALFADE.NO_FNSH_O :                               FFFFFFFFFFFF0750 C |
 VIDEO_DOPALFADE.NO_GRN :                                  FFFFFFFFFFFF0698 C |
 VIDEO_DOPALFADE.NO_GRN_O :                                FFFFFFFFFFFF0724 C |
 VIDEO_DOPALFADE.NO_MOVE :                                 FFFFFFFFFFFF06DE C |
 VIDEO_DOPALFADE.NO_MOVE_O :                               FFFFFFFFFFFF075E C |
 VIDEO_DOPALFADE.NO_RED :                                  FFFFFFFFFFFF0678 C |
 VIDEO_DOPALFADE.NO_RED_O :                                FFFFFFFFFFFF070C C |
 VIDEO_DOPALFADE.NXT_PAL :                                 FFFFFFFFFFFF0656 C |
 VIDEO_DOPALFADE.NXT_PAL_O :                               FFFFFFFFFFFF06F4 C |
 VIDEO_FADEPAL :   FFFFFFFFFFFF05E8 C |
 VIDEO_FADEPAL_MARS :                                      FFFFFFFFFFFF13B0 C |
 VIDEO_FILL :      FFFFFFFFFFFF07D2 C |  VIDEO_FILL.DMAW : FFFFFFFFFFFF07E6 C |
 VIDEO_FILL.DMAWE :                                        FFFFFFFFFFFF0830 C |
 VIDEO_INIT :      FFFFFFFFFFFF01FE C |
 VIDEO_INIT.CLRRAM :                                       FFFFFFFFFFFF0208 C |
*VIDEO_INIT.EXIT : FFFFFFFFFFFF0232 C |  VIDEO_INIT.LOOP : FFFFFFFFFFFF0224 C |
 VIDEO_LOADART :   FFFFFFFFFFFF08CC C |
 VIDEO_LOADART.FROM_RAM :                                  FFFFFFFFFFFF097E C |
 VIDEO_LOADART.RAM_RANGE :                                 FFFFFFFFFFFF08E8 C |
*VIDEO_LOADMAP :   FFFFFFFFFFFF030E C |
 VIDEO_LOADMAP.CONT :                                      FFFFFFFFFFFF0334 C |
 VIDEO_LOADMAP.NODBLE :                                    FFFFFFFFFFFF0354 C |
 VIDEO_LOADMAP.NONULL :                                    FFFFFFFFFFFF0332 C |
 VIDEO_LOADMAP.XLOOP :                                     FFFFFFFFFFFF0324 C |
 VIDEO_LOADMAP.YLOOP :                                     FFFFFFFFFFFF031A C |
*VIDEO_LOADMAP_VERT :                                      FFFFFFFFFFFF0366 C |
 VIDEO_LOADMAP_VERT.CONT :                                 FFFFFFFFFFFF039A C |
 VIDEO_LOADMAP_VERT.NODBLE :                               FFFFFFFFFFFF03BC C |
 VIDEO_LOADMAP_VERT.NONULL :                               FFFFFFFFFFFF0398 C |
*VIDEO_LOADMAP_VERT.OUTDBL :                               FFFFFFFFFFFF03C6 C |
 VIDEO_LOADMAP_VERT.XLOOP :                                FFFFFFFFFFFF0374 C |
 VIDEO_LOADMAP_VERT.YLOOP :                                FFFFFFFFFFFF0386 C |
 VIDEO_LOADPAL :   FFFFFFFFFFFF05F2 C |
*VIDEO_LOADPAL_MARS :                                      FFFFFFFFFFFF13BA C |
 VIDEO_MARSPALFADE :                                       FFFFFFFFFFFF13E2 C |
 VIDEO_MARSPALFADE.ACTIVE :                                FFFFFFFFFFFF13FE C |
 VIDEO_MARSPALFADE.FADE_DONE :                             FFFFFFFFFFFF1406 C |
 VIDEO_MARSPALFADE.FADE_IN :                               FFFFFFFFFFFF1408 C |
 VIDEO_MARSPALFADE.FADE_LIST :                             FFFFFFFFFFFF1400 C |
 VIDEO_MARSPALFADE.FADE_OUT :                              FFFFFFFFFFFF14B2 C |
 VIDEO_MARSPALFADE.NO_BLU :                                FFFFFFFFFFFF1482 C |
 VIDEO_MARSPALFADE.NO_BLU_O :                              FFFFFFFFFFFF150E C |
 VIDEO_MARSPALFADE.NO_FNSH :                               FFFFFFFFFFFF14A2 C |
 VIDEO_MARSPALFADE.NO_FNSH_O :                             FFFFFFFFFFFF1524 C |
 VIDEO_MARSPALFADE.NO_GRN :                                FFFFFFFFFFFF1462 C |
 VIDEO_MARSPALFADE.NO_GRN_O :                              FFFFFFFFFFFF14F6 C |
 VIDEO_MARSPALFADE.NO_MOVE :                               FFFFFFFFFFFF14B0 C |
 VIDEO_MARSPALFADE.NO_MOVE_O :                             FFFFFFFFFFFF1532 C |
 VIDEO_MARSPALFADE.NO_RED :                                FFFFFFFFFFFF1442 C |
 VIDEO_MARSPALFADE.NO_RED_O :                              FFFFFFFFFFFF14DE C |
 VIDEO_MARSPALFADE.NXT_PAL :                               FFFFFFFFFFFF1420 C |
 VIDEO_MARSPALFADE.NXT_PAL_O :                             FFFFFFFFFFFF14C6 C |
 VIDEO_MARS_GFXMODE :                                      FFFFFFFFFFFF13AC C |
*VIDEO_MARS_WAITFRAME :                                    FFFFFFFFFFFF13AE C |
 VIDEO_PRINT :     FFFFFFFFFFFF0402 C |
 VIDEO_PRINT.DONIBL :                                      FFFFFFFFFFFF051C C |
 VIDEO_PRINT.EXIT :                                        FFFFFFFFFFFF048C C |
 VIDEO_PRINT.ISBYTE :                                      FFFFFFFFFFFF0456 C |
 VIDEO_PRINT.ISLONG :                                      FFFFFFFFFFFF047A C |
 VIDEO_PRINT.ISWORD :                                      FFFFFFFFFFFF0468 C |
 VIDEO_PRINT.LNGLOOP :                                     FFFFFFFFFFFF050C C |
 VIDEO_PRINT.LOOP :                                        FFFFFFFFFFFF0416 C |
 VIDEO_PRINT.LOWR :                                        FFFFFFFFFFFF052C C |
 VIDEO_PRINT.NEWJUMP :                                     FFFFFFFFFFFF0410 C |
 VIDEO_PRINT.NEXT :                                        FFFFFFFFFFFF0438 C |
 VIDEO_PRINT.NEXTV :                                       FFFFFFFFFFFF0496 C |
 VIDEO_PRINT.NOTHING :                                     FFFFFFFFFFFF0538 C |
 VIDEO_PRINT.PUTTEXT :                                     FFFFFFFFFFFF042A C |
 VIDEO_PRINT.SPECIAL :                                     FFFFFFFFFFFF043C C |
 VIDEO_PRINT.VBYTE :                                       FFFFFFFFFFFF04C8 C |
 VIDEO_PRINT.VLONG :                                       FFFFFFFFFFFF0514 C |
 VIDEO_PRINT.VWORD :                                       FFFFFFFFFFFF04EA C |
 VIDEO_PRINTINIT : FFFFFFFFFFFF03D6 C | *VIDEO_PRINTPAL :  FFFFFFFFFFFF03F0 C |
 VIDEO_RUNFADE :   FFFFFFFFFFFF05D6 C |  VIDEO_UPDATE :    FFFFFFFFFFFF0232 C |
*VIDEO_UPDATE.EXIT :                                       FFFFFFFFFFFF0250 C |
 VIDEO_UPDATE.LOOP :                                       FFFFFFFFFFFF0244 C |
 VIDMARS_PAL :     FFFFFFFFFFFF13BE C |
 VIDMARS_PAL.LOOP :                                        FFFFFFFFFFFF13D6 C |
 VIDMD_PAL :       FFFFFFFFFFFF05F6 C |  VIDMD_PAL.LOOP :  FFFFFFFFFFFF060E C |
 VID_PICKLAYER :   FFFFFFFFFFFF053A C |
 VID_PICKLAYER.GOLYR :                                     FFFFFFFFFFFF058A C |
 VID_PICKLAYER.NOWD :                                      FFFFFFFFFFFF0574 C |
 VID_PICKLAYER.PLAWND :                                    FFFFFFFFFFFF0562 C |
 VID_PICKLAYER.THISSZ :                                    FFFFFFFFFFFF05AA C |
 VID_PICKLAYER.THISSZJ :                                   FFFFFFFFFFFF05D2 C |
 VINTCLR :                       16 - | *VINTENBL :                      20 - |
 VINT_DEFAULT :    FFFFFFFFFFFF1AF8 C | *VIRQ_ON :                        8 - |
 VRESINTCLR :                    14 - |  WAVE_FLAGS :                  1702 C |
 WAVE_LEN :                    16FA C |  WAVE_LOOP :                   16FD C |
 WAVE_PITCH :                  1700 C |  WAVE_START :                  16F7 C |
 WAVFREQ_LIST :                12F9 C | *WONDERCHK :                     98 - |
*WONDERREQ :                     97 - |  X68KSRCLSB :                    36 C |
 X68KSRCMID :                    37 C | *YM_CTRL_1 :                 A04000 - |
*YM_CTRL_2 :                 A04002 - | *YM_DATA_1 :                 A04001 - |
*YM_DATA_2 :                 A04003 - |  Z80_BUS :                   A11100 - |
 Z80_CODE :        FFFFFFFFFFFF235A C |  Z80_CODE_END :    FFFFFFFFFFFF425A C |
 Z80_CPU :                   A00000 - |  Z80_INIT :                      83 C |
 Z80_RESET :                 A11200 - |  Z80_TOP :         FFFFFFFFFFFF235A C |
*ZBANK :                       6000 - |  ZDRVFIFO :                      40 - |
 ZDRVFWRT :                      80 - | *ZDRVMARSBLK :                   82 - |
 ZDRVROMBLK :                    81 - | *ZOPCEX :                         8 - |
 ZOPCEXX :                       D9 - | *ZOPCNOP :                        0 - |
 ZOPCPUSHAF :                    F5 - |  ZOPCRET :                       C9 - |
 ZPSG_CTRL :                   7F11 - |  ZSET_TESTME :                    0 - |
 ZYM_CTRL_1 :                  4000 - |  ZYM_CTRL_2 :                  4002 - |
 ZYM_DATA_1 :                  4001 - |  ZYM_DATA_2 :                  4003 - |
*_ADRERR :                     5F40 - | *_BOOTSTAT :                   5EA0 - |
*_BURAM :                      5F16 - |  _CCR :                    FFFFFE92 - |
 _CDBIOS :                     5F22 - | *_CDBOOT :                     5F1C - |
*_CDSTAT :                     5E80 - | *_CHKERR :                     5F52 - |
*_CODERR :                     5F46 - | *_DEVERR :                     5F4C - |
*_DMACHANNEL0 :            FFFFFF8C - | *_DMACHANNEL1 :            FFFFFF9C - |
*_DMACOUNT0 :              FFFFFF88 - | *_DMACOUNT1 :              FFFFFF98 - |
*_DMADEST0 :               FFFFFF84 - | *_DMADEST1 :               FFFFFF94 - |
 _DMAOPERATION :           FFFFFFB0 - | *_DMAREQACK0 :             FFFFFFB4 - |
*_DMAREQACK1 :             FFFFFFB8 - |  _DMASOURCE0 :             FFFFFF80 - |
 _DMASOURCE1 :             FFFFFF90 - | *_DMAVECTORE0 :            FFFFFFA4 - |
*_DMAVECTORE1 :            FFFFFFAC - | *_DMAVECTORN0 :            FFFFFFA0 - |
*_DMAVECTORN1 :            FFFFFFA8 - |  _FRAMEBUFFER :            24000000 - |
*_FRC_H :                         2 - | *_FRC_L :                         3 - |
 _FRT :                    FFFFFE10 - | *_HRH :                    FFFFFF10 - |
*_HRL :                    FFFFFF14 - | *_HRL32 :                  FFFFFF04 - |
*_JR :                     FFFFFF00 - | *_LEVEL1 :                     5F76 - |
*_LEVEL2 :                     5F7C - | *_LEVEL3 :                     5F82 - |
*_LEVEL4 :                     5F88 - | *_LEVEL5 :                     5F8E - |
*_LEVEL6 :                     5F94 - | *_LEVEL7 :                     5F9A - |
*_NOCOD0 :                     5F6A - | *_NOCOD1 :                     5F70 - |
*_OCR_H :                         4 - | *_OCR_L :                         5 - |
*_OVERWRITE :              24020000 - |  _PALETTE :                20004200 - |
*_SERIAL :                 FFFFFE00 - | *_SETJMPTBL :                  5F0A - |
*_SPVERR :                     5F5E - |  _SYSREG :                 20004000 - |
*_TCR :                           6 - | *_TCSR :                          1 - |
*_TIER :                          0 - | *_TOCR :                          7 - |
*_TRACE :                      5F64 - | *_TRAP00 :                     5FA0 - |
*_TRAP01 :                     5FA6 - | *_TRAP02 :                     5FAC - |
*_TRAP03 :                     5FB2 - | *_TRAP04 :                     5FB8 - |
*_TRAP05 :                     5FBE - | *_TRAP06 :                     5FC4 - |
*_TRAP07 :                     5FCA - | *_TRAP08 :                     5FD0 - |
*_TRAP09 :                     5FD6 - | *_TRAP10 :                     5FDC - |
*_TRAP11 :                     5FE2 - | *_TRAP12 :                     5FE8 - |
*_TRAP13 :                     5FEE - | *_TRAP14 :                     5FF4 - |
*_TRAP15 :                     5FFA - | *_TRPERR :                     5F58 - |
*_USERCALL0 :                  5F28 - | *_USERCALL1 :                  5F2E - |
*_USERCALL2 :                  5F34 - | *_USERCALL3 :                  5F3A - |
*_USERMODE :                   5EA6 - |  _VDPREG :                 20004100 - |
*_WAITVSYNC :                  5F10 - |  _WAITVSYNC.TABLE :            6020 C |

   1495 symbols
    405 unused symbols

 AS V1.42 Beta [Bld 118] - source file main.asm - page 3 - 7/19/2023 0:10:13


  defined macros:
  ---------------

BIOS_BRMDEL                           | BIOS_BRMDIR                          
BIOS_BRMFORMAT                        | BIOS_BRMINIT                         
BIOS_BRMREAD                          | BIOS_BRMSERCH                        
BIOS_BRMSTAT                          | BIOS_BRMVERIFY                       
BIOS_BRMWRITE                         | BIOS_CDBCHK                          
BIOS_CDBPAUSE                         | BIOS_CDBSTAT                         
BIOS_CDBTOCREAD                       | BIOS_CDBTOCWRITE                     
BIOS_CDCACK                           | BIOS_CDCREAD                         
BIOS_CDCSETMODE                       | BIOS_CDCSTART                        
BIOS_CDCSTAT                          | BIOS_CDCSTOP                         
BIOS_CDCTRN                           | BIOS_DRVINIT                         
BIOS_DRVOPEN                          | BIOS_FDRCHG                          
BIOS_FDRSET                           | BIOS_LEDSET                          
BIOS_MSCPAUSEOFF                      | BIOS_MSCPAUSEON                      
BIOS_MSCPLAY                          | BIOS_MSCPLAY1                        
BIOS_MSCPLAYR                         | BIOS_MSCPLAYT                        
BIOS_MSCSCANFF                        | BIOS_MSCSCANFR                       
BIOS_MSCSCANOFF                       | BIOS_MSCSEEK                         
BIOS_MSCSEEK1                         | BIOS_MSCSEEKT                        
BIOS_MSCSTOP                          | BIOS_ROMPAUSEOFF                     
BIOS_ROMPAUSEON                       | BIOS_ROMREAD                         
BIOS_ROMREADE                         | BIOS_ROMREADN                        
BIOS_ROMSEEK                          | BIOS_SCDINIT                         
BIOS_SCDPQ                            | BIOS_SCDPQL                          
BIOS_SCDREAD                          | BIOS_SCDSTART                        
BIOS_SCDSTAT                          | BIOS_SCDSTOP                         
BURAM                                 | CDBIOS                               
COLORME                               | ENDSTRUCT                            
ISO_FILE                              | ISO_SETFS                            
ORG                                   | REPORT                               
STRUCT                                |

     61 macros

 AS V1.42 Beta [Bld 118] - source file main.asm - page 4 - 7/19/2023 0:10:13


  defined functions:
  ------------------

NOTZ80                                | LOCATE                               
MAPSIZE                               | DWORD                                

 AS V1.42 Beta [Bld 118] - source file main.asm - page 5 - 7/19/2023 0:10:13


  codepages:
  ----------

STANDARD (0 changed characters)


0.12 seconds assembly time

  14456 lines source file
  15150 lines incl. macro expansions
      4 passes
      0 errors
      0 warnings
